import{aS as n,as as S}from"./index-BsVRzvOf.js";var D=Object.defineProperty,E=(P,t,e)=>t in P?D(P,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):P[t]=e,T=(P,t,e)=>E(P,typeof t!="symbol"?t+"":t,e);class _{static getProfitPinKey(t){return t?`${this.PROFIT_PIN_KEY_BASE}_${t}`:this.PROFIT_PIN_KEY_BASE}static getMasterPinKey(t){return t?`${this.MASTER_PIN_KEY_BASE}_${t}`:this.MASTER_PIN_KEY_BASE}static setProfitPin(t,e){console.warn("setProfitPin is deprecated. Using master PIN instead.")}static hasProfitPin(t){try{const e=localStorage.getItem(this.getMasterPinKey(t));return!!e&&e.length>0}catch{return!1}}static verifyProfitPin(t,e){try{const i=localStorage.getItem(this.getMasterPinKey(e));return i?atob(i)===t:!1}catch{return!1}}static getProfitData(t){n.autoResetReportsIfNeeded(t);const e=n.getProfits(t),i=this.getWithdrawTransferProfits(t);return{dailyProfit:e.dailyProfit,monthlyProfit:e.monthlyProfit,dailyWithdrawProfit:i.dailyWithdrawProfit,monthlyWithdrawProfit:i.monthlyWithdrawProfit,dailyTransferProfit:i.dailyTransferProfit,monthlyTransferProfit:i.monthlyTransferProfit,lastUpdated:new Date}}static addProfit(t,e){n.addProfit(t,"daily",e),n.addProfit(t,"monthly",e)}static calculateProfitFromTransaction(t){return n.calculateTransactionProfit(t)}static resetProfits(t,e,i){if(!this.verifyProfitPin(e,i))return!1;const f=i?`reportsData_${i}`:"reportsData",s=n.getReportsData(i);if(t==="daily"?(s.dailyProfit=0,s.lastDailyProfitResetDate=new Date):(s.monthlyProfit=0,s.lastMonthlyProfitResetDate=new Date),localStorage.setItem(f,JSON.stringify(s)),i)try{S.updateUserData(i,{reportsData:{...s}})}catch(y){console.warn("تعذر مزامنة تصفير الأرباح مع Firebase:",y)}return!0}static clearProfitPin(t){localStorage.removeItem(this.getProfitPinKey(t))}static updateProfitsFromTransactions(t,e){const i=e?`reportsData_${e}`:"reportsData",f=n.getReportsData(e);let s=0,y=0;const u=new Date,m=u.getMonth(),g=u.getFullYear(),w=n.filterVisibleTransactions(t,"daily",e),p=n.filterVisibleTransactions(t,"monthly",e);if(w.forEach(r=>{const a=String(r.type||r.txnType||"").toLowerCase(),h=String(r.title||"");if(a==="cash_addition"||h.includes("إيصال إضافة نقدية"))return;const d=new Date(r.createdAt);if(String(r.status||"confirmed").toLowerCase(),d.toDateString()!==u.toDateString())return;const c=String(r.type||r.txnType||"").toLowerCase(),l={type:c==="withdrawal"?"withdraw":c,amount:Number(r.amount||0),commission:r.commission};s+=this.calculateProfitFromTransaction(l)}),p.forEach(r=>{const a=String(r.type||r.txnType||"").toLowerCase(),h=String(r.title||"");if(a==="cash_addition"||h.includes("إيصال إضافة نقدية"))return;const d=new Date(r.createdAt);if(String(r.status||"confirmed").toLowerCase(),d.getMonth()!==m||d.getFullYear()!==g)return;const c=String(r.type||r.txnType||"").toLowerCase(),l={type:c==="withdrawal"?"withdraw":c,amount:Number(r.amount||0),commission:r.commission};y+=this.calculateProfitFromTransaction(l)}),f.dailyProfit=Math.round(s*100)/100,f.monthlyProfit=Math.round(y*100)/100,localStorage.setItem(i,JSON.stringify(f)),e)try{S.updateUserData(e,{reportsData:{...f}})}catch(r){console.warn("تعذر مزامنة تحديث الأرباح من المعاملات مع Firebase:",r)}}static getWithdrawTransferProfits(t){n.getReportsData(t);const e=new Date,i=e.getMonth(),f=e.getFullYear(),s=`transactions_${t||"default"}`,y=JSON.parse(localStorage.getItem(s)||"[]");let u=0,m=0,g=0,w=0;const p=n.filterVisibleTransactions(y,"daily",t),r=n.filterVisibleTransactions(y,"monthly",t);return p.forEach(a=>{const h=String(a.type||a.txnType||"").toLowerCase(),d=String(a.title||"");if(h==="cash_addition"||d.includes("إيصال إضافة نقدية"))return;const c=new Date(a.createdAt);if(String(a.status||"confirmed").toLowerCase(),c.toDateString()!==e.toDateString())return;const l=String(a.type||a.txnType||"").toLowerCase(),o={type:l==="withdrawal"?"withdraw":l,amount:Number(a.amount||0),commission:a.commission};o.type==="withdraw"?u+=this.calculateProfitFromTransaction(o):(o.type==="receive"||o.type==="send"||o.type==="transfer")&&(g+=this.calculateProfitFromTransaction(o))}),r.forEach(a=>{const h=String(a.type||a.txnType||"").toLowerCase(),d=String(a.title||"");if(h==="cash_addition"||d.includes("إيصال إضافة نقدية"))return;const c=new Date(a.createdAt);if(String(a.status||"confirmed").toLowerCase(),c.getMonth()!==i||c.getFullYear()!==f)return;const l=String(a.type||a.txnType||"").toLowerCase(),o={type:l==="withdrawal"?"withdraw":l,amount:Number(a.amount||0),commission:a.commission};o.type==="withdraw"?m+=this.calculateProfitFromTransaction(o):(o.type==="receive"||o.type==="send"||o.type==="transfer")&&(w+=this.calculateProfitFromTransaction(o))}),{dailyWithdrawProfit:Math.round(u*100)/100,monthlyWithdrawProfit:Math.round(m*100)/100,dailyTransferProfit:Math.round(g*100)/100,monthlyTransferProfit:Math.round(w*100)/100}}}T(_,"PROFIT_PIN_KEY_BASE","profit_pin"),T(_,"MASTER_PIN_KEY_BASE","master_pin");export{_ as ProfitService};
//# sourceMappingURL=profitService-4r9FqAF7-Hn6SWIj-.js.map
