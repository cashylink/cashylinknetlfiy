{"version":3,"file":"ReceiptModal-Dqs_G1Fp.js","sources":["../../src/components/ReceiptModal.tsx"],"sourcesContent":["import React from \"react\";\r\nimport { formatNumberEnglish } from \"@/utils/formatters\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Receipt, Printer, X, Trash2, Lock, Eye, EyeOff, CheckCircle, MessageCircle, Download } from \"lucide-react\";\r\nimport { MasterPinService } from \"@/utils/masterPinService\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { useFirebaseAuth } from \"@/contexts/FirebaseAuthContext\";\r\nimport { createWhatsAppLink, validatePhoneNumber, formatPhoneNumber } from \"@/utils/whatsappService\";\r\nimport html2canvas from \"html2canvas\";\r\nimport { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from \"firebase/storage\";\r\nimport { httpsCallable } from \"firebase/functions\";\r\nimport { functions } from \"@/firebase\";\r\n\r\ninterface Transaction {\r\n  id: string;\r\n  type: 'transfer' | 'withdraw';\r\n  sender_msisdn: string;\r\n  receiver_msisdn: string;\r\n  amount: number;\r\n  commission: number;\r\n  status: 'completed' | 'pending' | 'failed';\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  reference?: string;\r\n  note?: string;\r\n  sender?: string;\r\n  receiver?: string;\r\n  txnType?: string;\r\n  commissionMode?: 'add' | 'deduct';\r\n  totalCharged?: number;\r\n  fee?: number;\r\n}\r\n\r\ninterface ReceiptModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  transaction: Transaction | null;\r\n  onPrint: () => void;\r\n  onDelete?: (transactionId: string) => void;\r\n  onComplete?: (transactionId: string) => void;\r\n}\r\n\r\nconst ReceiptModal: React.FC<ReceiptModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  transaction,\r\n  onPrint,\r\n  onDelete,\r\n  onComplete\r\n}) => {\r\n  const { toast } = useToast();\r\n  const { profile } = useFirebaseAuth();\r\n  const userId = (profile as any)?.userId || undefined;\r\n  const isReceiptNoteEnabled = React.useMemo(() => {\r\n    try {\r\n      const key = userId ? `receiptNoteEnabled_${userId}` : 'receiptNoteEnabled';\r\n      const v = localStorage.getItem(key) ?? localStorage.getItem('receiptNoteEnabled');\r\n      // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù…ÙØ¹Ù‘Ù„ Ø¥Ù† Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø¥Ø¹Ø¯Ø§Ø¯\r\n      return v === null ? true : v === 'true';\r\n    } catch {\r\n      return true;\r\n    }\r\n  }, [userId]);\r\n  const [isDeletePinDialogOpen, setIsDeletePinDialogOpen] = React.useState(false);\r\n  const [deletePin, setDeletePin] = React.useState(\"\");\r\n  const [showDeletePin, setShowDeletePin] = React.useState(false);\r\n  const [deleteError, setDeleteError] = React.useState(\"\");\r\n  const [isVerifying, setIsVerifying] = React.useState(false);\r\n\r\n  const [isCompletePinDialogOpen, setIsCompletePinDialogOpen] = React.useState(false);\r\n  const [completePin, setCompletePin] = React.useState(\"\");\r\n  const [showCompletePin, setShowCompletePin] = React.useState(false);\r\n  const [completeError, setCompleteError] = React.useState(\"\");\r\n  const receiptRef = React.useRef<HTMLDivElement>(null);\r\n  const [isVerifyingComplete, setIsVerifyingComplete] = React.useState(false);\r\n  const [simLabel, setSimLabel] = React.useState<string>(\"\");\r\n\r\n  React.useEffect(() => {\r\n    if (!transaction?.receiver_msisdn) return;\r\n\r\n    const normalize = (num: string) => {\r\n      let s = String(num || '').replace(/[^0-9]/g, '');\r\n      if (s.startsWith('20')) s = '0' + s.slice(2);\r\n      if (s.startsWith('0')) return s;\r\n      if (/^(10|11|12|15)/.test(s)) return '0' + s;\r\n      return s;\r\n    };\r\n\r\n    const currentUid = userId || 'default';\r\n    const s1 = localStorage.getItem(`sim1Number_${currentUid}`) || localStorage.getItem('sim1Number');\r\n    const s2 = localStorage.getItem(`sim2Number_${currentUid}`) || localStorage.getItem('sim2Number');\r\n    \r\n    const rec = normalize(transaction.receiver_msisdn);\r\n    if (s1 && normalize(s1) === rec) {\r\n      setSimLabel('SIM 1');\r\n    } else if (s2 && normalize(s2) === rec) {\r\n      setSimLabel('SIM 2');\r\n    } else {\r\n        setSimLabel('');\r\n    }\r\n  }, [transaction, userId]);\r\n\r\n  if (!transaction) return null;\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return <Badge className=\"bg-green-100 text-green-800 border-green-200\">Ù…ÙƒØªÙ…Ù„Ø©</Badge>;\r\n      case 'pending':\r\n        return <Badge className=\"bg-yellow-100 text-yellow-800 border-yellow-200\">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</Badge>;\r\n      case 'failed':\r\n        return <Badge className=\"bg-red-100 text-red-800 border-red-200\">ÙØ§Ø´Ù„Ø©</Badge>;\r\n      default:\r\n        return <Badge className=\"bg-gray-100 text-gray-800 border-gray-200\">{status}</Badge>;\r\n    }\r\n  };\r\n\r\n  const getTransactionTypeText = (type: string) => {\r\n    return type === 'transfer' ? 'ØªØ­ÙˆÙŠÙ„' : 'Ø³Ø­Ø¨';\r\n  };\r\n\r\n  const transactionTitleText = (() => {\r\n    const t = transaction as any;\r\n    const desc = String(t?.description || '');\r\n    const title = String(t?.title || '');\r\n\r\n    // ÙØ­ÙˆØµØ§Øª Ø´Ø§Ù…Ù„Ø© Ù„Ø§ÙƒØªØ´Ø§Ù ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø©\r\n    if (desc.includes('ØªØ­ÙˆÙŠÙ„ Ù…ÙƒÙ†Ù‡') || desc.includes('ØªØ­ÙˆÙŠÙ„ Ù…ÙƒÙŠÙ†Ù‡') || desc.includes('machine transfer')) return 'ØªØ­ÙˆÙŠÙ„ Ù…ÙƒÙŠÙ†Ù‡';\r\n    if (title.includes('ØªØ­ÙˆÙŠÙ„ Ù…ÙƒÙ†Ù‡') || title.includes('ØªØ­ÙˆÙŠÙ„ Ù…ÙƒÙŠÙ†Ù‡')) return 'ØªØ­ÙˆÙŠÙ„ Ù…ÙƒÙŠÙ†Ù‡';\r\n    if (String((t?.txnType || '')).toLowerCase() === 'sales' || String((t?.type || '')).toLowerCase() === 'sales' || title.includes('Ø¥ÙŠØµØ§Ù„ Ù…Ø¨ÙŠØ¹Ø§Øª') || String(t?.senderMsisdn || '') === 'Ù…Ø¨ÙŠØ¹Ø§Øª') return 'Ù…Ø¨ÙŠØ¹Ø§Øª';\r\n    if (transaction.type === 'atm_withdraw') return 'Ø³Ø­Ø¨ ATM';\r\n    \r\n    const base = title || getTransactionTypeText(transaction.type);\r\n    const p = String(t?.provider || '').toLowerCase();\r\n    const n = String(t?.note || '').toLowerCase();\r\n    const ap = p.includes('vodafone') ? 'vf-cash' : (p.includes('instapay') ? 'instapay' : '');\r\n    const an = n.includes('vodafone') ? 'vf-cash' : (n.includes('instapay') ? 'instapay' : '');\r\n    const prov = ap || an;\r\n    if (base === 'Ø³Ø­Ø¨' && prov) return `Ø³Ø­Ø¨ ${prov}`;\r\n    if (base === 'Ø¥ÙŠØµØ§Ù„ ØªØ­ÙˆÙŠÙ„ Ù…ÙƒÙŠÙ†Ù‡') return 'ØªØ­ÙˆÙŠÙ„ Ù…ÙƒÙŠÙ†Ù‡';\r\n    return base;\r\n  })();\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleString('ar-EG', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  const getTotalAmount = (t: Transaction) => {\r\n    if ((t as any)?.totalCharged !== undefined && (t as any)?.totalCharged !== null) {\r\n      return Number((t as any).totalCharged) || 0;\r\n    }\r\n    const commission = Number((t as any)?.commission || 0);\r\n    const fee = Number((t as any)?.fee || 0);\r\n    const amount = Number(t.amount || 0);\r\n    const mode = (t as any)?.commissionMode;\r\n    const type = (t as any)?.type || 'transfer';\r\n    if (String(type) === 'withdraw' || String(type) === 'atm_withdraw') {\r\n      return amount + commission + fee;\r\n    }\r\n    if (mode === 'add') return amount + commission + fee;\r\n    return amount;\r\n  };\r\n\r\n  const totalAmount = getTotalAmount(transaction);\r\n\r\n  const getStatusText = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return 'Ù…ÙƒØªÙ…Ù„Ø©';\r\n      case 'pending':\r\n        return 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©';\r\n      case 'failed':\r\n        return 'ÙØ§Ø´Ù„Ø©';\r\n      default:\r\n        return status;\r\n    }\r\n  };\r\n\r\n  const handlePrint = () => {\r\n    try {\r\n      const statusText = getStatusText(transaction.status);\r\n      const typeText = transactionTitleText;\r\n      const shop = (transaction as any)?.shopName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';\r\n      const cashier = (transaction as any)?.cashierName || '';\r\n      const ref = transaction.reference || transaction.id;\r\n      const created = new Date(transaction.createdAt).toLocaleString('ar-EG');\r\n      const amountEn = formatNumberEnglish(transaction.amount);\r\n      const commissionEn = formatNumberEnglish(transaction.commission || 0);\r\n      const feeEn = formatNumberEnglish((transaction as any)?.fee || 0);\r\n      const totalEn = formatNumberEnglish(getTotalAmount(transaction));\r\n      const noteText = String(transaction.note || '').trim();\r\n      const managerPhone = String((profile as any)?.phone || '').trim();\r\n      const isNoteEnabled = (() => {\r\n        try {\r\n          const key = userId ? `receiptNoteEnabled_${userId}` : 'receiptNoteEnabled';\r\n          const v = localStorage.getItem(key) ?? localStorage.getItem('receiptNoteEnabled');\r\n          return v === null ? true : v === 'true';\r\n        } catch {\r\n          return true;\r\n        }\r\n      })();\r\n      const baseColor = (transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? '#dc2626' : '#16a34a';\r\n\r\n      const printContent = `\r\n        <div class=\"receipt-root\" style=\"font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 520px; margin: 0 auto; padding: 24px; background: #fff; direction: rtl;\">\r\n          <div style=\"text-align: center; margin-bottom: 20px; border-bottom: 2px solid ${baseColor}; padding-bottom: 16px;\">\r\n            <h1 style=\"color: ${baseColor}; margin: 0 0 6px 0; font-size: 26px;\">Ø¥ÙŠØµØ§Ù„ ${typeText}</h1>\r\n            <p style=\"color: #666; font-size: 14px; margin: 0;\">Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹: ${ref}</p>\r\n            <p style=\"color: #888; font-size: 13px; margin: 6px 0 0 0;\">${created}</p>\r\n          </div>\r\n\r\n          <div style=\"background: #f8fafc; border-radius: 12px; padding: 16px; margin-bottom: 16px;\">\r\n            <h3 style=\"color: #1e293b; margin: 0 0 12px 0; font-size: 16px;\">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ù„</h3>\r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 8px;\">\r\n              <span style=\"font-weight: 600; color: #475569;\">Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„:</span>\r\n              <span style=\"color: #1e293b;\">${shop}</span>\r\n            </div>\r\n            ${cashier ? `<div style=\"display:flex; justify-content:space-between;\">\r\n              <span style=\"font-weight:600; color:#475569;\">Ø§Ù„ÙƒØ§Ø´ÙŠØ±:</span>\r\n              <span style=\"color:#1e293b;\">${cashier}</span>\r\n            </div>` : ''}\r\n          </div>\r\n\r\n          <div style=\"background: #fff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 16px;\">\r\n            <h3 style=\"color: #1e293b; margin: 0 0 12px 0; font-size: 16px;\">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</h3>\r\n\r\n            <div style=\"display:flex; justify-content:space-between; margin-bottom:8px; padding:6px 0; border-bottom:1px solid #f1f5f9;\">\r\n              <span style=\"font-weight:600; color:#475569;\">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©:</span>\r\n              <span style=\"color:${baseColor}; font-weight:600;\">${typeText}</span>\r\n            </div>\r\n\r\n            <div style=\"display:flex; justify-content:space-between; margin-bottom:8px; padding:6px 0; border-bottom:1px solid #f1f5f9;\">\r\n              <span style=\"font-weight:600; color:#475569;\">Ø§Ù„Ø­Ø§Ù„Ø©:</span>\r\n              <span style=\"color:${transaction.status === 'completed' ? '#16a34a' : transaction.status === 'pending' ? '#ca8a04' : '#dc2626'}; font-weight:600;\">${statusText}</span>\r\n            </div>\r\n            ${String(((transaction as any)?.txnType || '')).toLowerCase() === 'sales' || String(((transaction as any)?.type || '')).toLowerCase() === 'sales' ? `\r\n            <div style=\"display:flex; justify-content:space-between; margin-bottom:8px; padding:6px 0; border-bottom:1px solid #f1f5f9;\">\r\n              <span style=\"font-weight:600; color:#475569;\">Ø§Ù„Ù…Ù†ØªØ¬:</span>\r\n              <span style=\"font-weight:600; color:#1e293b;\">${(transaction as any)?.saleProductName || 'Ù…Ù†ØªØ¬'}</span>\r\n            </div>\r\n            <div style=\"display:flex; justify-content:space-between; margin-bottom:8px;\">\r\n              <span style=\"font-weight:600; color:#475569;\">Ø§Ù„ÙƒÙ…ÙŠØ©:</span>\r\n              <span style=\"font-weight:600; color:#1e293b;\">${(transaction as any)?.saleQuantity ?? ''}</span>\r\n            </div>\r\n            ` : ''}\r\n\r\n            <div style=\"display:flex; justify-content:space-between; margin-bottom:8px;\">\r\n              <span style=\"font-weight:600; color:#475569;\">Ù…Ù†:</span>\r\n              <span style=\"font-family:monospace;\">${transactionTitleText.includes('ØªØ­ÙˆÙŠÙ„ Ù…ÙƒÙŠÙ†Ù‡') ? ((transaction as any).senderName || 'Ù…Ø§ÙƒÙŠÙ†Ø©') : transaction.sender_msisdn}</span>\r\n            </div>\r\n            ${(transaction as any)?.senderName ? `<div style=\"display:flex; justify-content:space-between; margin-bottom:8px;\">\r\n              <span style=\"font-weight:600; color:#475569;\">Ø§Ø³Ù… Ø§Ù„Ø±Ø§Ø³Ù„:</span>\r\n              <span>${(transaction as any).senderName}</span>\r\n            </div>` : ''}\r\n            <div style=\"display:flex; justify-content:space-between; margin-bottom:8px;\">\r\n              <span style=\"font-weight:600; color:#475569;\">Ø¥Ù„Ù‰:</span>\r\n              <div style=\"display:flex; align-items:center;\">\r\n                ${simLabel ? `<span style=\"background:${simLabel === 'SIM 1' ? '#eff6ff' : '#f3e8ff'}; color:${simLabel === 'SIM 1' ? '#1d4ed8' : '#7e22ce'}; padding:2px 6px; border-radius:4px; font-size:11px; margin-left:6px; border:1px solid ${simLabel === 'SIM 1' ? '#bfdbfe' : '#e9d5ff'}; font-weight:bold;\">${simLabel}</span>` : ''}\r\n                <span style=\"font-family:monospace;\">${transaction.receiver_msisdn}</span>\r\n              </div>\r\n            </div>\r\n\r\n            <div style=\"display:flex; justify-content:space-between; margin-bottom:8px;\">\r\n              <span style=\"font-weight:600; color:#475569;\">Ø§Ù„Ù…Ø¨Ù„Øº:</span>\r\n              <span style=\"font-weight:600;\" dir=\"ltr\"><span style=\"font-family:monospace;\">${amountEn}</span>&nbsp;Ø¬Ù†ÙŠÙ‡</span>\r\n            </div>\r\n            ${transaction.commission > 0 ? `<div style=\"display:flex; justify-content:space-between; margin-bottom:8px;\">\r\n              <span style=\"font-weight:600; color:#475569;\">Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©:</span>\r\n              <span dir=\"ltr\"><span style=\"font-family:monospace;\">${commissionEn}</span>&nbsp;Ø¬Ù†ÙŠÙ‡</span>\r\n            </div>` : ''}\r\n            ${((transaction as any)?.fee || 0) > 0 ? `<div style=\"display:flex; justify-content:space-between; margin-bottom:8px;\">\r\n              <span style=\"font-weight:600; color:#475569;\">Ø§Ù„Ø±Ø³ÙˆÙ…:</span>\r\n              <span dir=\"ltr\"><span style=\"font-family:monospace;\">${feeEn}</span>&nbsp;Ø¬Ù†ÙŠÙ‡</span>\r\n            </div>` : ''}\r\n\r\n            <div style=\"display:flex; justify-content:space-between; margin-top:10px; font-weight:700; font-size:16px;\">\r\n              <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>\r\n              <span style=\"color:${baseColor};\" dir=\"ltr\"><span style=\"font-family:monospace;\">${totalEn}</span>&nbsp;Ø¬Ù†ÙŠÙ‡</span>\r\n            </div>\r\n          </div>\r\n          ${isNoteEnabled && noteText ? `\r\n          <div style=\"background:#eff6ff; border:1px solid #bfdbfe; border-radius:10px; padding:12px; margin-top:12px; display:flex; gap:8px;\">\r\n            <div style=\"color:${baseColor};\">ğŸ—’ï¸</div>\r\n            <div style=\"color:${baseColor}; font-size:13px; word-break:break-word;\">${noteText}</div>\r\n          </div>\r\n          ` : ''}\r\n          <div style=\"margin-top: 16px; font-size: 13px; color: #475569; border-top: 1px solid #e2e8f0; padding-top: 10px; text-align: center;\">\r\n            ${managerPhone ? `\r\n            <div>\r\n              ÙÙŠ Ø­Ø§Ù„Ø© ÙˆØ¬ÙˆØ¯ Ø£ÙŠ Ø´ÙƒÙˆÙ‰ Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø­Ù„ Ø¹Ù„Ù‰ Ø±Ù‚Ù…: <span style=\"direction:ltr; unicode-bidi:embed; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\">${managerPhone}</span>\r\n            </div>\r\n            ` : ''}\r\n            <div style=\"margin-top:6px;\">\r\n              <a href=\"https://cashy-link.com\" target=\"_blank\" style=\"font-size: 12px; color: ${baseColor}; text-decoration: none; direction: ltr; unicode-bidi: embed; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\">cashy-link.com</a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      `;\r\n\r\n      const w = window.open('', '_blank');\r\n      if (!w) return;\r\n      w.document.write(`\r\n        <html>\r\n          <head>\r\n            <title>Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© - ${ref}</title>\r\n            <meta charset=\"UTF-8\">\r\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n            <style>\r\n              body { margin: 0; padding: 20px; background: #f8fafc; }\r\n              @media print { body { background: white; } }\r\n              .receipt-root, .receipt-root * { color: ${baseColor} !important; }\r\n            </style>\r\n          </head>\r\n          <body dir=\"rtl\">\r\n            ${printContent}\r\n          </body>\r\n        </html>\r\n      `);\r\n      w.document.close();\r\n      w.print();\r\n    } catch {}\r\n  };\r\n\r\n  const handleWhatsAppShare = async () => {\r\n    try {\r\n      // Ø§Ø®ØªÙŠØ§Ø± Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„ØµØ­ÙŠØ­: Ø§Ù„ØªØ­ÙˆÙŠÙ„ -> Ø§Ù„Ù…Ø³ØªÙ„Ù…ØŒ Ø§Ù„Ø³Ø­Ø¨ -> Ø§Ù„Ø¹Ù…ÙŠÙ„\r\n      const rawNumber = transaction.type === 'transfer'\r\n        ? transaction.receiver_msisdn\r\n        : transaction.sender_msisdn;\r\n\r\n      // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ù‚Ù… ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…ÙˆØ­Ø¯Ø©\r\n      const normalized = formatPhoneNumber(rawNumber);\r\n      if (!validatePhoneNumber(normalized)) {\r\n        toast({\r\n          title: 'Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ ØºÙŠØ± ØµØ§Ù„Ø­',\r\n          description: `Ø§Ù„Ø±Ù‚Ù…: ${rawNumber}`,\r\n          duration: 3000\r\n        });\r\n        return;\r\n      }\r\n\r\n      // Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„\r\n      const refEl = receiptRef.current;\r\n      if (!refEl) {\r\n        toast({ title: 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¥ÙŠØµØ§Ù„', description: 'Ø£Ø¹Ø¯ ÙØªØ­ Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø«Ù… Ø­Ø§ÙˆÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©', duration: 3000 });\r\n        return;\r\n      }\r\n\r\n      // Ø§Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·ÙˆØ· Ù„ØªÙØ§Ø¯ÙŠ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø¹Ø±Ø¶\r\n      try { await (document as any).fonts?.ready; } catch {}\r\n\r\n      // Ø§Ù„ØªÙ‚Ø· Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¹ Ø¶Ø¨Ø· Ø§Ù„Ø­Ø¬Ù… ÙˆØ§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ«Ø¨Ø§Øª Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯\r\n      const targetWidth = 1080;\r\n      const scale = Math.max(2, Math.ceil((window.devicePixelRatio || 1)));\r\n      const baseCanvas = await html2canvas(refEl, {\r\n        scale,\r\n        useCORS: true,\r\n        allowTaint: true,\r\n        backgroundColor: '#ffffff',\r\n        width: refEl.scrollWidth,\r\n        height: refEl.scrollHeight,\r\n        scrollX: 0,\r\n        scrollY: 0,\r\n      });\r\n\r\n      // Ø·Ø¨Ù‘Ø¹ Ø§Ù„Ø¹Ø±Ø¶ Ø¥Ù„Ù‰ 1080px Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ØªÙ†Ø§Ø³Ù‚ Ø§Ù„Ø¹Ø±Ø¶ ÙÙŠ ÙˆØ§ØªØ³Ø§Ø¨\r\n      let finalCanvas: HTMLCanvasElement = baseCanvas;\r\n      try {\r\n        const ratio = baseCanvas.height / baseCanvas.width;\r\n        const normalizedCanvas = document.createElement('canvas');\r\n        normalizedCanvas.width = targetWidth;\r\n        normalizedCanvas.height = Math.round(targetWidth * ratio);\r\n        const ctx = normalizedCanvas.getContext('2d');\r\n        if (ctx) {\r\n          ctx.imageSmoothingEnabled = true;\r\n          // @ts-ignore: ÙŠØ¯Ø¹Ù… Ù…Ø¹Ø¸Ù… Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯\r\n          ctx.imageSmoothingQuality = 'high';\r\n          ctx.drawImage(baseCanvas, 0, 0, normalizedCanvas.width, normalizedCanvas.height);\r\n          finalCanvas = normalizedCanvas;\r\n        }\r\n      } catch {}\r\n\r\n      const blob: Blob | null = await new Promise((resolve) => finalCanvas.toBlob(resolve, 'image/png'));\r\n      if (!blob) {\r\n        toast({ title: 'ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø©', description: 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„', duration: 3000 });\r\n        return;\r\n      }\r\n\r\n      // Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ø¨Ø± Web Share API Ø¥Ù† ØªÙˆÙØ±Øª (ØºØ§Ù„Ø¨Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„)\r\n      const fileName = `receipt-${transaction.reference || transaction.id}.png`;\r\n      const file = new File([blob], fileName, { type: 'image/png' });\r\n      if ((navigator as any).canShare && (navigator as any).canShare({ files: [file] })) {\r\n        try {\r\n          await (navigator as any).share({ files: [file], title: 'ØµÙˆØ±Ø© Ø¥ÙŠØµØ§Ù„', text: 'ØµÙˆØ±Ø© Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©' });\r\n          // Ù„Ø§ Ù†ÙÙ†Ù‡ÙŠ Ø§Ù„ØªØ¯ÙÙ‚ Ù‡Ù†Ø§Ø› Ø³Ù†ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ Ø£ÙŠØ¶Ù‹Ø§\r\n        } catch (shareErr) {\r\n          // ÙÙŠ Ø­Ø§Ù„ Ø±ÙØ¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙØ´Ù„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©ØŒ Ù†ÙƒÙ…Ù„ Ø¨Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©\r\n        }\r\n      }\r\n\r\n      // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Firebase Storage Ø«Ù… Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ø¨Ø± WhatsApp Cloud API\r\n      const storage = getStorage();\r\n      const path = `public/receipts/${fileName}`;\r\n      const sRef = storageRef(storage, path);\r\n      await uploadBytes(sRef, blob, { contentType: 'image/png' });\r\n      const url = await getDownloadURL(sRef);\r\n\r\n      const typeText = getTransactionTypeText(transaction.type);\r\n      const ref = transaction.reference || transaction.id;\r\n      const total = getTotalAmount(transaction);\r\n      const caption = `Ø¥ÙŠØµØ§Ù„ ${typeText} - Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total}\\u00A0Ø¬Ù†ÙŠÙ‡ - Ø§Ù„Ù…Ø±Ø¬Ø¹: ${ref || ''}`;\r\n\r\n      try {\r\n        const message = `${caption}\\n${url}`;\r\n        const waLink = createWhatsAppLink(normalized, message);\r\n        window.open(waLink, '_blank');\r\n      } catch (linkErr) {\r\n        // ØªØ¬Ø§Ù‡Ù„ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ÙØªØ­ØŒ Ø³ÙŠØ¨Ù‚Ù‰ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ø¨Ø± Cloud API\r\n      }\r\n\r\n      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ø¨Ø± WhatsApp Cloud API\r\n      try {\r\n        const sendWhatsAppImage = httpsCallable(functions, 'sendWhatsAppImage');\r\n        await sendWhatsAppImage({ to: normalized, imageUrl: url, caption });\r\n        toast({ title: 'ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§', description: 'ØªÙ… ÙØªØ­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ ÙˆØ³ÙŠØµÙ„Ù‡ Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø£ÙŠØ¶Ù‹Ø§', duration: 3000 });\r\n      } catch (apiErr) {\r\n        toast({ title: 'ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§', description: 'ØªÙ… ÙØªØ­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©Ø› ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Cloud API Ù„Ø¥Ø±Ø³Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ', duration: 4000 });\r\n      }\r\n    } catch (e) {\r\n      toast({ title: 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©', description: 'Ø¬Ø±Ù‘Ø¨ Ù…Ø¬Ø¯Ø¯Ø§Ù‹', duration: 3000 });\r\n    }\r\n  };\r\n\r\n  const handleSaveImage = async () => {\r\n    try {\r\n      const ref = receiptRef.current;\r\n      if (!ref) {\r\n        toast({ title: \"ØªØ¹Ø°Ù‘Ø± Ø­ÙØ¸ Ø§Ù„Ø¥ÙŠØµØ§Ù„\", description: \"Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥ÙŠØµØ§Ù„\", duration: 3000 });\r\n        return;\r\n      }\r\n      const canvas = await html2canvas(ref, { scale: 2, useCORS: true, backgroundColor: \"#ffffff\" });\r\n      const dataUrl = canvas.toDataURL(\"image/png\");\r\n      const fileName = `receipt-${transaction.reference || transaction.id}.png`;\r\n      const link = document.createElement(\"a\");\r\n      link.href = dataUrl;\r\n      link.download = fileName;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n      toast({ title: \"ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥ÙŠØµØ§Ù„\", description: `ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©: ${fileName}`, duration: 2000 });\r\n    } catch (error) {\r\n      toast({ title: \"ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¥ÙŠØµØ§Ù„\", description: \"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©\", duration: 3000 });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-md md:max-w-sm w-full mx-auto overflow-hidden md:scale-[0.95] lg:scale-[0.9]\" dir=\"rtl\">\r\n        <DialogHeader className=\"text-center\">\r\n          <DialogTitle className={`flex items-center justify-center gap-2 text-xl md:text-lg font-bold ${transaction.type === 'withdraw' ? 'text-red-600' : 'text-green-600'}`}>\r\n            <Receipt className=\"h-6 w-6\" />\r\n            Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div ref={receiptRef}>\r\n          <Card className=\"overflow-hidden rounded-2xl shadow-xl border border-gray-200 dark:border-slate-800 bg-white dark:bg-slate-900\">\r\n            <CardContent className=\"p-5 md:p-4 space-y-5 md:space-y-4 break-words md:text-[13px] bg-gradient-to-b from-gray-50 via-white to-gray-50 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950\">\r\n            <div className=\"text-center space-y-1\">\r\n              <h3 className={`text-xl md:text-lg font-extrabold tracking-tight ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-700' : 'text-emerald-600'}`}>cashy link</h3>\r\n              <p className=\"text-xs text-gray-500\">Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</p>\r\n              <p className={`text-sm font-semibold ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-700' : 'text-green-700'}`}>\r\n                {transactionTitleText}\r\n              </p>\r\n              <div className=\"flex items-center justify-center gap-2 flex-wrap\">\r\n                {getStatusBadge(transaction.status)}\r\n                {(transaction as any)?.shopName && (\r\n                  <span className=\"px-2 py-0.5 rounded-full bg-gray-100 dark:bg-slate-800 text-[11px] font-medium text-gray-700 dark:text-slate-200\">\r\n                    Ø§Ù„Ù…Ø­Ù„: {(transaction as any).shopName}\r\n                  </span>\r\n                )}\r\n                {(transaction as any)?.cashierName && (\r\n                  <span className=\"px-2 py-0.5 rounded-full bg-gray-100 dark:bg-slate-800 text-[11px] font-medium text-gray-700 dark:text-slate-200\">\r\n                    Ø§Ù„ÙƒØ§Ø´ÙŠØ±: {(transaction as any).cashierName}\r\n                  </span>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            <Separator className=\"my-2\" />\r\n\r\n            <div className=\"grid grid-cols-1 gap-2\">\r\n              <div className=\"flex justify-between items-center\">\r\n                <span className=\"text-xs font-medium text-gray-500\">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</span>\r\n                <span className={`text-sm font-mono break-all ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-700' : 'text-green-700'}`} dir=\"ltr\">{transaction.id}</span>\r\n              </div>\r\n\r\n              <div className=\"flex justify-between items-center\">\r\n                <span className=\"text-xs font-medium text-gray-500\">Ù…Ù†</span>\r\n                <span className={`text-sm font-mono break-all ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-700' : 'text-green-700'}`} dir=\"ltr\">{transaction.sender_msisdn}</span>\r\n              </div>\r\n\r\n              {(transaction as any)?.senderName && (\r\n                <div className=\"flex justify-between items-center\">\r\n                  <span className=\"text-xs font-medium text-gray-500\">Ø§Ø³Ù… Ø§Ù„Ø±Ø§Ø³Ù„</span>\r\n                  <span className={`text-sm ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-700' : 'text-green-700'}`}>{(transaction as any).senderName}</span>\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"flex justify-between items-center\">\r\n                <span className=\"text-xs font-medium text-gray-500\">Ø¥Ù„Ù‰</span>\r\n                <div className=\"flex items-center gap-2\">\r\n                  {simLabel && (\r\n                    <Badge variant=\"outline\" className={`${simLabel === 'SIM 1' ? 'bg-blue-50 text-blue-700 border-blue-200' : 'bg-purple-50 text-purple-700 border-purple-200'} h-5 px-1.5 text-[10px]`}>\r\n                      {simLabel}\r\n                    </Badge>\r\n                  )}\r\n                  <span className={`text-sm font-mono break-all ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-700' : 'text-green-700'}`} dir=\"ltr\">{transaction.receiver_msisdn}</span>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex justify-between items-center\">\r\n                <span className=\"text-xs font-medium text-gray-500\">Ø§Ù„Ù…Ø¨Ù„Øº</span>\r\n                <span className={`text-sm font-semibold ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-700' : 'text-green-700'}`} dir=\"ltr\">\r\n                  <span className=\"font-mono\">{formatNumberEnglish(transaction.amount)}</span>&nbsp;Ø¬Ù†ÙŠÙ‡\r\n                </span>\r\n              </div>\r\n\r\n              {transaction.commission > 0 && (\r\n                <div className=\"flex justify-between items-center\">\r\n                  <span className=\"text-xs font-medium text-gray-500\">Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</span>\r\n                  <span className={`text-sm ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-700' : 'text-green-700'}`} dir=\"ltr\">\r\n                    <span className=\"font-mono\">{formatNumberEnglish(transaction.commission || 0)}</span>&nbsp;Ø¬Ù†ÙŠÙ‡\r\n                  </span>\r\n                </div>\r\n              )}\r\n              {((transaction as any)?.fee || 0) > 0 && (\r\n                <div className=\"flex justify-between items-center\">\r\n                  <span className=\"text-xs font-medium text-gray-500\">Ø§Ù„Ø±Ø³ÙˆÙ…</span>\r\n                  <span className={`text-sm ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-700' : 'text-green-700'}`} dir=\"ltr\">\r\n                    <span className=\"font-mono\">{formatNumberEnglish((transaction as any).fee || 0)}</span>&nbsp;Ø¬Ù†ÙŠÙ‡\r\n                  </span>\r\n                </div>\r\n              )}\r\n\r\n              {(String(((transaction as any)?.txnType || '')).toLowerCase() === 'sales' ||\r\n                String(((transaction as any)?.type || '')).toLowerCase() === 'sales') && (\r\n                <>\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <span className=\"text-xs font-medium text-gray-500\">Ø§Ù„Ù…Ù†ØªØ¬</span>\r\n                    <span className={`text-sm font-semibold ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-700' : 'text-green-700'}`}>{(transaction as any)?.saleProductName || 'Ù…Ù†ØªØ¬'}</span>\r\n                  </div>\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <span className=\"text-xs font-medium text-gray-500\">Ø§Ù„ÙƒÙ…ÙŠØ©</span>\r\n                    <span className={`text-sm font-semibold ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-700' : 'text-green-700'}`}>{(transaction as any)?.saleQuantity ?? ''}</span>\r\n                  </div>\r\n                </>\r\n              )}\r\n\r\n              <Separator className=\"my-1\" />\r\n\r\n              <div className=\"flex justify-between items-center font-bold text-lg md:text-base\">\r\n                <span className=\"text-sm text-gray-800 dark:text-slate-100\">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>\r\n                <span className={`${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-600' : 'text-green-600'}`} dir=\"ltr\">\r\n                  <span className=\"font-mono\">{formatNumberEnglish(totalAmount)}</span>&nbsp;Ø¬Ù†ÙŠÙ‡\r\n                </span>\r\n              </div>\r\n\r\n              <div className=\"flex justify-between items-center\">\r\n                <span className=\"text-xs font-medium text-gray-500\">Ø§Ù„ØªØ§Ø±ÙŠØ®</span>\r\n                <span className={`text-sm ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-700' : 'text-green-700'}`}>{formatDate(transaction.createdAt)}</span>\r\n              </div>\r\n\r\n              {transaction.reference && (\r\n                <div className=\"flex justify-between items-center\">\r\n                  <span className=\"text-xs font-medium text-gray-500\">Ø§Ù„Ù…Ø±Ø¬Ø¹</span>\r\n                  <span className={`text-sm font-mono break-all ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-700' : 'text-green-700'}`} dir=\"ltr\">{transaction.reference}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n            {isReceiptNoteEnabled && String(transaction.note || '').trim() && (\r\n              <div className={`p-3 rounded-md border flex gap-2 ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'bg-red-50 border-red-200' : 'bg-green-50 border-green-200'}`}>\r\n                <MessageCircle className={`h-4 w-4 ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-600' : 'text-green-600'}`} />\r\n                <div className={`text-sm break-words ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-800' : 'text-green-800'}`}>{String(transaction.note || '').trim()}</div>\r\n              </div>\r\n            )}\r\n            <div className={`pt-2 mt-2 border-t text-xs text-center ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-700' : 'text-green-700'}`}>\r\n              {String((profile as any)?.phone || '').trim() && (\r\n                <div>\r\n                  ÙÙŠ Ø­Ø§Ù„Ø© ÙˆØ¬ÙˆØ¯ Ø£ÙŠ Ø´ÙƒÙˆÙ‰ Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø­Ù„ Ø¹Ù„Ù‰ Ø±Ù‚Ù…: <span dir=\"ltr\" className=\"font-mono\">{String((profile as any)?.phone || '').trim()}</span>\r\n                </div>\r\n              )}\r\n              <a href=\"https://cashy-link.com\" target=\"_blank\" rel=\"noopener noreferrer\" dir=\"ltr\" className={`block mt-1 hover:underline font-mono ${(transaction.type === 'withdraw' || transaction.type === 'atm_withdraw') ? 'text-red-600' : 'text-green-600'}`}>cashy-link.com</a>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        </div>\r\n\r\n        {/* Action Buttons */}\r\n        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2 pt-3\">\r\n          {onDelete && (\r\n            <Button\r\n              onClick={() => {\r\n                // Ø§ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø´Ø§Ø¨Ù‡Ø© Ù„Ù†Ø§ÙØ°Ø© ØªØµÙÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª\r\n                setDeleteError(\"\");\r\n                setDeletePin(\"\");\r\n                setShowDeletePin(false);\r\n                setIsDeletePinDialogOpen(true);\r\n              }}\r\n              variant=\"destructive\"\r\n              size=\"sm\"\r\n              aria-label=\"Ø­Ø°Ù Ø§Ù„Ø¥ÙŠØµØ§Ù„\"\r\n              title=\"Ø­Ø°Ù Ø§Ù„Ø¥ÙŠØµØ§Ù„\"\r\n              className=\"w-full h-9 px-2 justify-center\"\r\n            >\r\n              <Trash2 className=\"h-4 w-4\" />\r\n            </Button>\r\n          )}\r\n          {onComplete && transaction.status === 'pending' && (\r\n            <Button\r\n              onClick={() => {\r\n                setCompleteError(\"\");\r\n                setCompletePin(\"\");\r\n                setShowCompletePin(false);\r\n                setIsCompletePinDialogOpen(true);\r\n              }}\r\n              className=\"w-full h-9 px-3 bg-emerald-600 hover:bg-emerald-700 text-white\"\r\n              size=\"sm\"\r\n            >\r\n              <CheckCircle className=\"h-4 w-4 mr-1\" />\r\n              Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©\r\n            </Button>\r\n          )}\r\n          <Button\r\n            onClick={handleWhatsAppShare}\r\n            className=\"w-full h-9 px-2 bg-green-600 hover:bg-green-700 text-white justify-center\"\r\n            size=\"sm\"\r\n            aria-label=\"Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨\"\r\n            title=\"Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨\"\r\n          >\r\n            <MessageCircle className=\"h-4 w-4\" />\r\n          </Button>\r\n          <Button\r\n            onClick={handlePrint}\r\n            className=\"w-full h-9 px-2 bg-blue-600 hover:bg-blue-700 text-white justify-center\"\r\n            size=\"sm\"\r\n            aria-label=\"Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„\"\r\n            title=\"Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„\"\r\n          >\r\n            <Printer className=\"h-4 w-4\" />\r\n          </Button>\r\n          <Button\r\n            onClick={handleSaveImage}\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            aria-label=\"Ø­ÙØ¸ Ø§Ù„Ø¥ÙŠØµØ§Ù„\"\r\n            title=\"Ø­ÙØ¸ Ø§Ù„Ø¥ÙŠØµØ§Ù„\"\r\n            className=\"w-full h-9 px-2 justify-center\"\r\n          >\r\n            <Download className=\"h-4 w-4\" />\r\n          </Button>\r\n          <Button\r\n            onClick={onClose}\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            aria-label=\"Ø¥ØºÙ„Ø§Ù‚\"\r\n            title=\"Ø¥ØºÙ„Ø§Ù‚\"\r\n            className=\"w-full h-9 px-2 justify-center\"\r\n          >\r\n            <X className=\"h-4 w-4\" />\r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n    {/* Delete Confirmation Dialog */}\r\n    <Dialog open={isDeletePinDialogOpen} onOpenChange={setIsDeletePinDialogOpen}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-center justify-center\">\r\n            <Lock className=\"h-5 w-5 text-red-600\" />\r\n            ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"text-center text-sm text-gray-600 mb-4\">\r\n          Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©\r\n        </div>\r\n\r\n        <div className=\"space-y-4\">\r\n          <div className=\"space-y-2\">\r\n            <label htmlFor=\"deletePin\" className=\"text-right block\">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>\r\n            <div className=\"relative\">\r\n              <input\r\n                id=\"deletePin\"\r\n                type={showDeletePin ? 'text' : 'password'}\r\n                autoComplete=\"off\"\r\n                value={deletePin}\r\n                onChange={(e) => setDeletePin(e.target.value)}\r\n                placeholder=\"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ\"\r\n                className=\"pr-10 w-full border rounded-md h-10 px-3\"\r\n                dir=\"ltr\"\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowDeletePin(!showDeletePin)}\r\n                className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600\"\r\n              >\r\n                {showDeletePin ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {deleteError && (\r\n            <div className=\"flex items-center gap-2 text-red-600 text-sm\">\r\n              {deleteError}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex gap-2 pt-2\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              className=\"flex-1\"\r\n              onClick={() => {\r\n                setIsDeletePinDialogOpen(false);\r\n                setDeletePin(\"\");\r\n                setDeleteError(\"\");\r\n                setShowDeletePin(false);\r\n              }}\r\n              disabled={isVerifying}\r\n            >\r\n              Ø¥Ù„ØºØ§Ø¡\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              className=\"flex-1 bg-red-600 hover:bg-red-700\"\r\n              disabled={isVerifying}\r\n              onClick={async () => {\r\n                setDeleteError(\"\");\r\n                setIsVerifying(true);\r\n                try {\r\n                  const hasPin = await MasterPinService.hasMasterPin(userId);\r\n                  if (!hasPin) {\r\n                    setDeleteError('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± Ù…ÙØ¹ÙŠÙÙ‘Ù†ØŒ ÙŠØ±Ø¬Ù‰ ØªØ¹ÙŠÙŠÙ†Ù‡ Ø£ÙˆÙ„Ø§Ù‹');\r\n                    toast({\r\n                      title: 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± Ù…ÙØ¹ÙŠÙÙ‘Ù†',\r\n                      description: 'ÙŠØ±Ø¬Ù‰ ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù…Ù† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø³Ø±ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø°Ù.',\r\n                      variant: 'destructive',\r\n                    });\r\n                    return;\r\n                  }\r\n\r\n                  if (!deletePin) {\r\n                    setDeleteError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ');\r\n                    return;\r\n                  }\r\n\r\n                  const valid = await MasterPinService.verifyMasterPin(deletePin, userId);\r\n                  if (!valid) {\r\n                    setDeleteError('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­');\r\n                    toast({\r\n                      title: 'Ø±Ù‚Ù… Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­',\r\n                      description: 'ØªØ¹Ø°Ø± ØªÙ†ÙÙŠØ° Ø§Ù„Ø­Ø°Ù Ø¨Ø³Ø¨Ø¨ Ø±Ù‚Ù… Ø³Ø±ÙŠ Ø®Ø§Ø·Ø¦.',\r\n                      variant: 'destructive',\r\n                    });\r\n                    return;\r\n                  }\r\n\r\n                  // Ù†Ø¬Ø§Ø­ Ø§Ù„ØªØ­Ù‚Ù‚: ØªÙ†ÙÙŠØ° Ø§Ù„Ø­Ø°Ù\r\n                  try {\r\n                    onDelete && transaction && onDelete(transaction.id);\r\n                    setIsDeletePinDialogOpen(false);\r\n                    setDeletePin(\"\");\r\n                    setDeleteError(\"\");\r\n                    setShowDeletePin(false);\r\n                    onClose();\r\n                  } catch (e) {}\r\n                } finally {\r\n                  setIsVerifying(false);\r\n                }\r\n              }}\r\n            >\r\n              ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n\r\n    {/* Complete Confirmation Dialog */}\r\n    <Dialog\r\n      open={isCompletePinDialogOpen}\r\n      onOpenChange={(open) => {\r\n        if (!open) {\r\n          setIsCompletePinDialogOpen(false);\r\n          setCompletePin(\"\");\r\n          setCompleteError(\"\");\r\n          setShowCompletePin(false);\r\n        } else {\r\n          setIsCompletePinDialogOpen(true);\r\n        }\r\n      }}\r\n    >\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-center justify-center\">\r\n            <Lock className=\"h-5 w-5 text-emerald-600\" />\r\n            ØªØ£ÙƒÙŠØ¯ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"text-center text-sm text-gray-600 mb-4\">\r\n          Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„ØªØ£ÙƒÙŠØ¯ Ø¥ÙƒÙ…Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø§Ù„Ù…Ø¤Ø¬Ù„Ø©\r\n        </div>\r\n\r\n        <div className=\"space-y-4\">\r\n          <div className=\"space-y-2\">\r\n            <label htmlFor=\"completePin\" className=\"text-right block\">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>\r\n            <div className=\"relative\">\r\n              <input\r\n                id=\"completePin\"\r\n                type={showCompletePin ? 'text' : 'password'}\r\n                autoComplete=\"off\"\r\n                value={completePin}\r\n                onChange={(e) => setCompletePin(e.target.value)}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    document.getElementById('confirm-complete-btn')?.click();\r\n                  }\r\n                }}\r\n                placeholder=\"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ\"\r\n                className=\"pr-10 w-full border rounded-md h-10 px-3\"\r\n                dir=\"ltr\"\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowCompletePin(!showCompletePin)}\r\n                className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600\"\r\n              >\r\n                {showCompletePin ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {completeError && (\r\n            <div className=\"flex items-center gap-2 text-red-600 text-sm\">\r\n              {completeError}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex gap-2 pt-2\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              className=\"flex-1\"\r\n              onClick={() => {\r\n                setIsCompletePinDialogOpen(false);\r\n                setCompletePin(\"\");\r\n                setCompleteError(\"\");\r\n                setShowCompletePin(false);\r\n              }}\r\n              disabled={isVerifyingComplete}\r\n            >\r\n              Ø¥Ù„ØºØ§Ø¡\r\n            </Button>\r\n            <Button\r\n              id=\"confirm-complete-btn\"\r\n              type=\"button\"\r\n              className=\"flex-1 bg-emerald-600 hover:bg-emerald-700\"\r\n              disabled={isVerifyingComplete}\r\n              onClick={async () => {\r\n                setCompleteError(\"\");\r\n                setIsVerifyingComplete(true);\r\n                try {\r\n                  const hasPin = await MasterPinService.hasMasterPin(userId);\r\n                  if (!hasPin) {\r\n                    setCompleteError('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± Ù…ÙØ¹ÙŠÙÙ‘Ù†ØŒ ÙŠØ±Ø¬Ù‰ ØªØ¹ÙŠÙŠÙ†Ù‡ Ø£ÙˆÙ„Ø§Ù‹');\r\n                    toast({\r\n                      title: 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± Ù…ÙØ¹ÙŠÙÙ‘Ù†',\r\n                      description: 'ÙŠØ±Ø¬Ù‰ ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù…Ù† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø³Ø±ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„.',\r\n                      variant: 'destructive',\r\n                    });\r\n                    return;\r\n                  }\r\n\r\n                  if (!completePin) {\r\n                    setCompleteError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ');\r\n                    return;\r\n                  }\r\n\r\n                  const valid = await MasterPinService.verifyMasterPin(completePin, userId);\r\n                  if (!valid) {\r\n                    setCompleteError('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­');\r\n                    toast({\r\n                      title: 'Ø±Ù‚Ù… Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­',\r\n                      description: 'ØªØ¹Ø°Ø± ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø¨Ø³Ø¨Ø¨ Ø±Ù‚Ù… Ø³Ø±ÙŠ Ø®Ø§Ø·Ø¦.',\r\n                      variant: 'destructive',\r\n                    });\r\n                    return;\r\n                  }\r\n\r\n                  // Ù†Ø¬Ø§Ø­ Ø§Ù„ØªØ­Ù‚Ù‚: ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„\r\n                  try {\r\n                    onComplete && transaction && onComplete(transaction.id);\r\n                    setIsCompletePinDialogOpen(false);\r\n                    setCompletePin(\"\");\r\n                    setCompleteError(\"\");\r\n                    setShowCompletePin(false);\r\n                    onClose();\r\n                  } catch (e) {}\r\n                } finally {\r\n                  setIsVerifyingComplete(false);\r\n                }\r\n              }}\r\n            >\r\n              ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ReceiptModal;\r\n"],"names":["ReceiptModal","isOpen","onClose","transaction","onPrint","onDelete","onComplete","toast","useToast","profile","useFirebaseAuth","userId","isReceiptNoteEnabled","React","key","v","isDeletePinDialogOpen","setIsDeletePinDialogOpen","deletePin","setDeletePin","showDeletePin","setShowDeletePin","deleteError","setDeleteError","isVerifying","setIsVerifying","isCompletePinDialogOpen","setIsCompletePinDialogOpen","completePin","setCompletePin","showCompletePin","setShowCompletePin","completeError","setCompleteError","receiptRef","isVerifyingComplete","setIsVerifyingComplete","simLabel","setSimLabel","normalize","num","s","currentUid","s1","s2","rec","getStatusBadge","status","jsx","Badge","getTransactionTypeText","type","transactionTitleText","t","desc","title","base","p","n","ap","an","prov","formatDate","dateString","getTotalAmount","commission","fee","amount","mode","totalAmount","getStatusText","handlePrint","statusText","typeText","shop","cashier","ref","created","amountEn","formatNumberEnglish","commissionEn","feeEn","totalEn","noteText","managerPhone","isNoteEnabled","baseColor","printContent","w","handleWhatsAppShare","rawNumber","normalized","formatPhoneNumber","validatePhoneNumber","refEl","_a","targetWidth","scale","baseCanvas","html2canvas","finalCanvas","ratio","normalizedCanvas","ctx","blob","resolve","fileName","file","storage","getStorage","path","sRef","storageRef","uploadBytes","url","getDownloadURL","total","caption","message","waLink","createWhatsAppLink","httpsCallable","functions","handleSaveImage","dataUrl","link","jsxs","Fragment","Dialog","DialogContent","DialogHeader","DialogTitle","Receipt","Card","CardContent","Separator","MessageCircle","Button","Trash2","CheckCircle","Printer","Download","X","Lock","e","EyeOff","Eye","MasterPinService","open"],"mappings":"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"}