import{r as t,m as T,ar as o,j as e,aa as A,ab as J,ac as K,ad as R,aD as M,y as u,H as f,I as g,J as j,K as N,B as L}from"./index-DhbnydJl.js";import{D as q}from"./dollar-sign-AUKMnGdi.js";function U({open:w,onOpenChange:F,userId:i}){const[c,y]=t.useState(""),[n,b]=t.useState(""),[v,P]=t.useState(""),[h,C]=t.useState(!1),[x,S]=t.useState(!1),[m,D]=t.useState(!1),[k,a]=t.useState(""),[E,l]=t.useState(!1),[r,H]=t.useState(!1),{toast:B}=T();t.useEffect(()=>{let s=!0;return(async()=>{const p=await o.hasMasterPin(i);s&&H(p)})(),()=>{s=!1}},[i,w]);const O=async s=>{s.preventDefault(),a(""),l(!0);try{if(!n||n.length<4){a("يجب أن يكون الرقم السري 4 أرقام على الأقل"),l(!1);return}if(n!==v){a("الرقم السري الجديد وتأكيده غير متطابقين"),l(!1);return}if(r){if(!c){a("يرجى إدخال الرقم السري الرئيسي الحالي"),l(!1);return}if(!await o.verifyMasterPin(c,i)){a("الرقم السري الرئيسي الحالي غير صحيح"),l(!1);return}}if(!(r?await o.changeMasterPin(c,n,i):await o.createMasterPin(n,i))){a("تعذر حفظ الرقم السري الرئيسي"),l(!1);return}B({title:r?"تم تغيير الرقم السري الرئيسي":"تم تعيين الرقم السري الرئيسي",description:r?"تم تغيير الرقم السري الرئيسي بنجاح (سيتم تطبيقه على جميع النوافذ)":"تم تعيين الرقم السري الرئيسي بنجاح (سيتم تطبيقه على جميع النوافذ)"}),d()}catch{a("حدث خطأ أثناء حفظ الرقم السري الرئيسي")}finally{l(!1)}},d=()=>{y(""),b(""),P(""),a(""),C(!1),S(!1),D(!1),F(!1)};return e.jsx(A,{open:w,onOpenChange:d,children:e.jsxs(J,{className:"sm:max-w-[425px]",children:[e.jsx(K,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-purple-600"}),r?"تغيير الرقم السري الرئيسي":"تعيين الرقم السري الرئيسي"]})}),e.jsxs("form",{onSubmit:O,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-md text-sm text-blue-700 mb-4 flex items-start gap-2",children:[e.jsx(M,{className:"h-4 w-4 mt-0.5 shrink-0"}),e.jsx("p",{children:"هذا الرقم السري موحد لجميع العمليات الحساسة في التطبيق (الديون، التقسيط، درج النقدية، إلخ)."})]}),k&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded-md text-sm flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),k]}),r&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"current-pin",children:"الرقم السري الحالي"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(g,{id:"current-pin",type:h?"text":"password",value:c,onChange:s=>y(s.target.value),className:"pr-10 pl-10 text-left",dir:"ltr",placeholder:"****"}),e.jsx("button",{type:"button",onClick:()=>C(!h),className:"absolute left-3 top-2.5 text-gray-500 hover:text-gray-700",children:h?e.jsx(j,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"new-pin",children:"الرقم السري الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(g,{id:"new-pin",type:x?"text":"password",value:n,onChange:s=>b(s.target.value),className:"pr-10 pl-10 text-left",dir:"ltr",placeholder:"****"}),e.jsx("button",{type:"button",onClick:()=>S(!x),className:"absolute left-3 top-2.5 text-gray-500 hover:text-gray-700",children:x?e.jsx(j,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"confirm-pin",children:"تأكيد الرقم السري الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(g,{id:"confirm-pin",type:m?"text":"password",value:v,onChange:s=>P(s.target.value),className:"pr-10 pl-10 text-left",dir:"ltr",placeholder:"****"}),e.jsx("button",{type:"button",onClick:()=>D(!m),className:"absolute left-3 top-2.5 text-gray-500 hover:text-gray-700",children:m?e.jsx(j,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(L,{type:"button",variant:"outline",onClick:d,children:"إلغاء"}),e.jsx(L,{type:"submit",disabled:E,className:"bg-purple-600 hover:bg-purple-700",children:E?"جاري الحفظ...":r?"تغيير الرقم السري":"تعيين الرقم السري"})]})]})]})})}export{U as ChangeCashPinDialog};
//# sourceMappingURL=ChangeCashPinDialog-D25KmpUO.js.map
