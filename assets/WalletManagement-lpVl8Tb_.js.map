{"version":3,"mappings":"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","names":["__iconNode","Building","createLucideIcon","IdCard","walletProviders","WalletsViewPage","isOpen","onClose","onWalletSelect","onEditWallet","onDeleteWallet","allowedWalletIds","user","useFirebaseAuth","wallets","setWallets","useState","selectMode","setSelectMode","selectedIds","setSelectedIds","isLoading","setIsLoading","toast","useToast","calculateWalletMonthlyUsage","walletId","transactions","currentMonth","currentYear","monthlyTransactions","t","transactionDate","isWithdrawTx","type","isSendTx","withdrawalUsage","sum","amount","transferUsage","checkAndResetMonthlyUsage","wallet","today","lastReset","lastResetDate","currentDate","useEffect","firebaseWallets","merchantWalletService","transactionService","sourceWallets","allowedSet","id","w","walletsWithResetCheck","limits","walletDailyLimitsService","error","getProviderInfo","providerId","p","getUsagePercentage","used","limit","formatNumber","num","jsx","Dialog","jsxs","DialogContent","DialogHeader","DialogTitle","Wallet","Badge","Fragment","Button","ops","prev","e","providerInfo","isSelected","cardClasses","Card","CardHeader","CardTitle","CreditCard","Star","Edit","Trash2","CardContent","Phone","User","monthlyWithdrawalLimit","monthlyTransferLimit","monthlyWithdrawUsed","monthlyTransferUsed","remainingWithdraw","remainingTransfer","ArrowLeft","WalletDetailsPage","onBack","setTransactions","selectedPeriod","setSelectedPeriod","walletTransactions","a","b","formatDate","dateString","filteredTransactions","now","startDate","xn","totalWithdrawals","totalTransfers","totalDeposits","completedTransactions","operationsCount","totalProfit","calculateProfit","withdrawalPercentage","transferPercentage","getTransactionIcon","TrendingDown","TrendingUp","DollarSign","Activity","getStatusIcon","status","CheckCircle","Clock","XCircle","AlertCircle","getTransactionTypeText","getStatusText","Calendar","BarChart3","Progress","Separator","transaction","WalletManagement","onWalletUpdate","initialEditingWallet","autoStartAdd","userSubscription","raw","_a","_b","s","SubscriptionPlan","useNavigate","isAddingWallet","setIsAddingWallet","editingWallet","setEditingWallet","walletName","setWalletName","walletPhone","setWalletPhone","walletOwnerName","setWalletOwnerName","walletNationalId","setWalletNationalId","walletProvider","setWalletProvider","setMonthlyWithdrawalLimit","setMonthlyTransferLimit","dailyWithdrawalLimit","setDailyWithdrawalLimit","dailyTransferLimit","setDailyTransferLimit","defaultTransferCommission","setDefaultTransferCommission","defaultWithdrawCommission","setDefaultWithdrawCommission","isDefault","setIsDefault","showProviderInfo","setShowProviderInfo","showWalletsView","setShowWalletsView","isMasterPinDialogOpen","setIsMasterPinDialogOpen","selectedWallet","setSelectedWallet","getWalletsKey","lastResetMonth","lastResetYear","calculateWalletDailyUsage","currentDay","dailyTransactions","auth","__vitePreload","n","retryCount","maxRetries","resolve","dailyWithdrawalUsage","dailyTransferUsage","resetForm","startAddWallet","saveWallet","updatedWallets","newWalletData","newWalletId","walletToAdd","newWallets","handleEditWallet","handleDeleteWallet","walletToDelete","handleSetDefault","Eye","Plus","Select","SelectTrigger","SelectValue","SelectContent","provider","SelectItem","Input","Settings","MasterPinDialog","updated","err"],"ignoreList":[0,1],"sources":["../../node_modules/lucide-react/dist/esm/icons/building.js","../../node_modules/lucide-react/dist/esm/icons/id-card.js","../../src/components/WalletsViewPage.tsx","../../src/components/WalletDetailsPage.tsx","../../src/components/WalletManagement.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 10h.01\", key: \"1nrarc\" }],\n  [\"path\", { d: \"M12 14h.01\", key: \"1etili\" }],\n  [\"path\", { d: \"M12 6h.01\", key: \"1vi96p\" }],\n  [\"path\", { d: \"M16 10h.01\", key: \"1m94wz\" }],\n  [\"path\", { d: \"M16 14h.01\", key: \"1gbofw\" }],\n  [\"path\", { d: \"M16 6h.01\", key: \"1x0f13\" }],\n  [\"path\", { d: \"M8 10h.01\", key: \"19clt8\" }],\n  [\"path\", { d: \"M8 14h.01\", key: \"6423bh\" }],\n  [\"path\", { d: \"M8 6h.01\", key: \"1dz90k\" }],\n  [\"path\", { d: \"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3\", key: \"cabbwy\" }],\n  [\"rect\", { x: \"4\", y: \"2\", width: \"16\", height: \"20\", rx: \"2\", key: \"1uxh74\" }]\n];\nconst Building = createLucideIcon(\"building\", __iconNode);\n\nexport { __iconNode, Building as default };\n//# sourceMappingURL=building.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 10h2\", key: \"8sgtl7\" }],\n  [\"path\", { d: \"M16 14h2\", key: \"epxaof\" }],\n  [\"path\", { d: \"M6.17 15a3 3 0 0 1 5.66 0\", key: \"n6f512\" }],\n  [\"circle\", { cx: \"9\", cy: \"11\", r: \"2\", key: \"yxgjnd\" }],\n  [\"rect\", { x: \"2\", y: \"5\", width: \"20\", height: \"14\", rx: \"2\", key: \"qneu4z\" }]\n];\nconst IdCard = createLucideIcon(\"id-card\", __iconNode);\n\nexport { __iconNode, IdCard as default };\n//# sourceMappingURL=id-card.js.map\n","import React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Progress } from '@/components/ui/progress';\nimport { Wallet, Phone, DollarSign, Star, CreditCard, TrendingUp, TrendingDown, ArrowLeft, IdCard, Building, Edit, Trash2, User } from 'lucide-react';\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\nimport { merchantWalletService, transactionService } from '@/integrations/firebase/services';\nimport walletDailyLimitsService from '@/utils/walletDailyLimitsService';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface Wallet {\n  id: string;\n  name: string;\n  phone: string;\n  ownerName?: string;\n  nationalId?: string;\n  isDefault: boolean;\n  isActive?: boolean;\n  monthlyWithdrawalLimit: number;\n  monthlyTransferLimit: number;\n  monthlyWithdrawalUsage?: number;\n  monthlyTransferUsage?: number;\n  lastResetDate?: string;\n  walletProvider?: string;\n}\n\ninterface WalletsViewPageProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onWalletSelect: (wallet: Wallet) => void;\n  onEditWallet?: (wallet: Wallet) => void;\n  onDeleteWallet?: (walletId: string) => void;\n  allowedWalletIds?: string[] | null;\n}\n\n// بيانات شركات المحفظة\nconst walletProviders = [\n  {\n    id: 'vodafone',\n    name: 'فودافون كاش',\n    ownerName: 'أحمد محمد علي',\n    nationalId: '29012345678901'\n  },\n  {\n    id: 'etisalat',\n    name: 'اتصالات كاش',\n    ownerName: 'فاطمة حسن محمود',\n    nationalId: '28506789012345'\n  },\n  {\n    id: 'orange',\n    name: 'أورنج كاش',\n    ownerName: 'محمد أحمد السيد',\n    nationalId: '29309876543210'\n  },\n  {\n    id: 'we_pay',\n    name: 'وي باي',\n    ownerName: 'نورا عبد الرحمن',\n    nationalId: '29112345678901'\n  },\n  {\n    id: 'smart_wallet',\n    name: 'سمارت ولت',\n    ownerName: 'خالد محمد عبد الله',\n    nationalId: '28809876543210'\n  },\n  {\n    id: 'access_pay',\n    name: 'أكسس باي',\n    ownerName: 'مريم أحمد حسن',\n    nationalId: '29456789012345'\n  },\n  {\n    id: 'insta_pay',\n    name: 'انستا باي',\n    ownerName: 'عمر سعد محمد',\n    nationalId: '29012345678901'\n  }\n];\n\nconst WalletsViewPage: React.FC<WalletsViewPageProps> = ({ isOpen, onClose, onWalletSelect, onEditWallet, onDeleteWallet, allowedWalletIds }) => {\n  const { user } = useFirebaseAuth();\n  const [wallets, setWallets] = useState<Wallet[]>([]);\n  const [selectMode, setSelectMode] = useState<boolean>(false);\n  const [selectedIds, setSelectedIds] = useState<string[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n\n  // دالة للحصول على مفتاح localStorage المرتبط بالمستخدم\n  const getWalletsKey = () => `wallets_${user?.uid || 'default'}`;\n\n  // محاولة تحميل المحافظ من المفاتيح القديمة ثم نقلها للمفتاح الحالي\n  const loadWalletsFromLocalWithMigration = (): any[] | null => {\n    try {\n      const currentKey = getWalletsKey();\n      const current = localStorage.getItem(currentKey);\n      if (current) {\n        const parsed = JSON.parse(current);\n        if (Array.isArray(parsed) && parsed.length > 0) return parsed;\n      }\n      const legacyDefaultKey = 'wallets_default';\n      const legacyDefault = localStorage.getItem(legacyDefaultKey);\n      if (legacyDefault) {\n        const parsed = JSON.parse(legacyDefault);\n        if (Array.isArray(parsed) && parsed.length > 0) {\n          localStorage.setItem(currentKey, legacyDefault);\n          try { localStorage.removeItem(legacyDefaultKey); } catch {}\n          return parsed;\n        }\n      }\n      const keys = Object.keys(localStorage).filter(k => k.startsWith('wallets_') && k !== currentKey);\n      let best: any[] | null = null;\n      let bestKey: string | null = null;\n      for (const k of keys) {\n        try {\n          const s = localStorage.getItem(k);\n          if (!s) continue;\n          const parsed = JSON.parse(s);\n          if (Array.isArray(parsed) && parsed.length > 0) {\n            if (!best || parsed.length > (best?.length || 0)) {\n              best = parsed;\n              bestKey = k;\n            }\n          }\n        } catch {}\n      }\n      if (best && bestKey) {\n        localStorage.setItem(currentKey, JSON.stringify(best));\n        try { localStorage.removeItem(bestKey); } catch {}\n        return best;\n      }\n    } catch (e) {\n      console.warn('WalletsViewPage migration failed:', e);\n    }\n    return null;\n  };\n\n  // دالة لحساب الاستخدام الشهري للمحفظة\n  const calculateWalletMonthlyUsage = async (walletId: string, transactions: any[]) => {\n    const currentMonth = new Date().getMonth();\n    const currentYear = new Date().getFullYear();\n    \n    const monthlyTransactions = transactions.filter(t => {\n      const transactionDate = new Date(t.createdAt);\n      return (\n        transactionDate.getMonth() === currentMonth && \n        transactionDate.getFullYear() === currentYear &&\n        // مطابقة المعاملات لهذه المحفظة (توافق مع الحقول المختلفة)\n        (t.lineId === walletId || t.fromWallet === walletId)\n      );\n    });\n\n    // توحيد أنواع المعاملات والحقول المستخدمة لضمان دقة الحسابات عبر المخططات المختلفة\n    const isWithdrawTx = (t: any) => {\n      const type = t.type;\n      const xn = (t as any).txnType;\n      return (\n        xn === 'receive' ||\n        type === 'withdraw' ||\n        type === 'withdrawal' ||\n        type === 'receive'\n      );\n    };\n\n    const isSendTx = (t: any) => {\n      const type = t.type;\n      const xn = (t as any).txnType;\n      return (\n        xn === 'send' ||\n        type === 'send' ||\n        type === 'transfer'\n      );\n    };\n\n    const withdrawalUsage = monthlyTransactions\n      .filter(isWithdrawTx)\n      .reduce((sum, t) => {\n        const amount = (t as any).withdrawnAmount !== undefined ? (t as any).withdrawnAmount : t.amount;\n        return sum + (amount || 0);\n      }, 0);\n\n    const transferUsage = monthlyTransactions\n      .filter(isSendTx)\n      .reduce((sum, t) => {\n        const amount = (t as any).sentAmount !== undefined ? (t as any).sentAmount : t.amount;\n        return sum + (amount || 0);\n      }, 0);\n\n    return { withdrawalUsage, transferUsage };\n  };\n\n  // دالة لفحص وإعادة تعيين العدادات الشهرية\n  const checkAndResetMonthlyUsage = (wallet: Wallet): Wallet => {\n    const today = new Date().toISOString().split('T')[0];\n    const lastReset = wallet.lastResetDate;\n    \n    if (!lastReset) {\n      return {\n        ...wallet,\n        monthlyWithdrawalUsage: 0,\n        monthlyTransferUsage: 0,\n        lastResetDate: today\n      };\n    }\n\n    const lastResetDate = new Date(lastReset);\n    const currentDate = new Date();\n    \n    // فحص إذا كان الشهر قد تغير\n    if (lastResetDate.getMonth() !== currentDate.getMonth() || \n        lastResetDate.getFullYear() !== currentDate.getFullYear()) {\n      return {\n        ...wallet,\n        monthlyWithdrawalUsage: 0,\n        monthlyTransferUsage: 0,\n        lastResetDate: today\n      };\n    }\n\n    return wallet;\n  };\n\n  // تحميل المحافظ\n  useEffect(() => {\n    if (!user?.uid || !isOpen) return;\n\n    const loadWallets = async () => {\n      setIsLoading(true);\n      try {\n        const firebaseWallets = await merchantWalletService.getByMerchantId(user.uid);\n        const transactions = await transactionService.getByUserId(user.uid);\n\n        // في حالة وجود قائمة محافظ مسموحة، فلتر من المصدر لتقليل الحسابات قدر الإمكان\n        let sourceWallets = firebaseWallets;\n        if (allowedWalletIds && allowedWalletIds.length > 0) {\n          const allowedSet = new Set(allowedWalletIds.map(id => String(id)));\n          sourceWallets = firebaseWallets.filter((w: any) => allowedSet.has(String(w.id)));\n        }\n\n        const formattedWallets = await Promise.all(sourceWallets.map(async w => {\n          const { withdrawalUsage, transferUsage } = await calculateWalletMonthlyUsage(w.id, transactions);\n          const limits = await walletDailyLimitsService.getWalletLimits(w.id);\n          return {\n            id: w.id,\n            name: w.label || 'محفظة بدون اسم',\n            phone: w.msisdn,\n            ownerName: w.ownerName,\n            nationalId: w.nationalId || '',\n            isDefault: false,\n            isActive: (w as any).isActive === true,\n            monthlyWithdrawalLimit: (limits?.monthlyWithdrawLimit ?? w.withdrawLimit ?? 200000),\n            monthlyTransferLimit: (limits?.monthlyTransferLimit ?? w.transferLimit ?? 200000),\n            monthlyWithdrawalUsage: (limits?.monthlyWithdrawUsed ?? withdrawalUsage ?? 0),\n            monthlyTransferUsage: (limits?.monthlyTransferUsed ?? transferUsage ?? 0),\n            lastResetDate: new Date().toISOString().split('T')[0],\n            walletProvider: (w.walletProvider || '')\n          };\n        }));\n\n        const walletsWithResetCheck = formattedWallets.map(checkAndResetMonthlyUsage);\n        setWallets(walletsWithResetCheck);\n        \n      } catch (error) {\n        console.error('Error loading wallets:', error);\n        toast({\n          title: 'فشل جلب بيانات المحافظ',\n          description: 'قد تكون المشكلة بسبب الصلاحيات أو الاتصال. سيتم عرض البيانات المحلية إن وُجدت. جرّب تسجيل الدخول مجددًا أو افتح صفحة اختبار المصادقة من القائمة.',\n          variant: 'destructive'\n        });\n     } finally {\n       setIsLoading(false);\n     }\n    };\n\n    loadWallets();\n  }, [user?.uid, isOpen, allowedWalletIds]);\n\n  // دالة للحصول على معلومات شركة المحفظة\n  const getProviderInfo = (providerId: string) => {\n    return walletProviders.find(p => p.id === providerId);\n  };\n\n  // دالة لحساب النسبة المئوية للاستخدام\n  const getUsagePercentage = (used: number, limit: number) => {\n    return limit > 0 ? Math.min((used / limit) * 100, 100) : 0;\n  };\n\n  // دالة لتنسيق الأرقام\n  const formatNumber = (num: number) => {\n    return new Intl.NumberFormat('ar-EG', { maximumFractionDigits: 0 }).format(num);\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader className=\"pb-4\">\n          <DialogTitle className=\"flex items-center gap-2 text-lg\">\n            <Wallet className=\"h-5 w-5\" />\n            الاطلاع على جميع المحافظ\n            <Badge variant=\"secondary\" className=\"mr-2\">\n              {wallets.length} محفظة\n            </Badge>\n          </DialogTitle>\n          <div className=\"flex items-center gap-2 mt-2\">\n            {!selectMode ? (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setSelectMode(true)}\n                className=\"h-7\"\n              >\n                تحديد المحافظ\n              </Button>\n            ) : (\n              <>\n                <Button\n                  size=\"sm\"\n                  onClick={async () => {\n                    try {\n                      if (!user?.uid) return;\n                      const ops = wallets.map(w => merchantWalletService.update(w.id, { isActive: selectedIds.includes(w.id) }));\n                      await Promise.all(ops);\n                      setWallets(prev => prev.map(w => ({ ...w, isActive: selectedIds.includes(w.id) })));\n                      setSelectMode(false);\n                      toast({ title: 'تم تفعيل المحافظ', description: 'فقط المحافظ المحددة ستظهر في الاختيار الخارجي' });\n                      try { window.dispatchEvent(new CustomEvent('wallets:activation-updated')); } catch {}\n                    } catch (e) {\n                      console.error('Error activating wallets:', e);\n                      toast({ title: 'فشل التفعيل', description: 'تعذر تفعيل المحافظ المحددة', variant: 'destructive' });\n                    }\n                  }}\n                  className=\"h-7\"\n                >\n                  تفعيل المحافظ\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => { setSelectMode(false); setSelectedIds([]); }}\n                  className=\"h-7\"\n                >\n                  إلغاء\n                </Button>\n              </>\n            )}\n          </div>\n        </DialogHeader>\n\n        {isLoading ? (\n          <div className=\"flex justify-center items-center py-8\">\n            <div className=\"text-center\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2\"></div>\n              <p className=\"text-sm text-gray-600\">جاري تحميل المحافظ...</p>\n            </div>\n          </div>\n        ) : wallets.length === 0 ? (\n          <div className=\"text-center py-8\">\n            <Wallet className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n            <p className=\"text-gray-600\">لا توجد محافظ مضافة حتى الآن</p>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {wallets.map((wallet) => {\n              const providerInfo = getProviderInfo(wallet.walletProvider || '');\n              const withdrawalPercentage = getUsagePercentage(\n                wallet.monthlyWithdrawalUsage || 0,\n                wallet.monthlyWithdrawalLimit\n              );\n              const transferPercentage = getUsagePercentage(\n                wallet.monthlyTransferUsage || 0,\n                wallet.monthlyTransferLimit\n              );\n\n              const isSelected = selectedIds.includes(wallet.id);\n              const cardClasses = selectMode\n                ? `cursor-pointer transition-shadow border-2 ${isSelected ? 'border-blue-500 shadow-lg' : 'hover:border-blue-300'}`\n                : 'cursor-pointer hover:shadow-lg transition-shadow border-2 hover:border-blue-300';\n\n              return (\n                <Card \n                  key={wallet.id} \n                  className={cardClasses}\n                  onClick={() => {\n                    if (selectMode) {\n                      setSelectedIds(prev => prev.includes(wallet.id) ? prev.filter(id => id !== wallet.id) : [...prev, wallet.id]);\n                    } else {\n                      onWalletSelect(wallet);\n                    }\n                  }}\n                >\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"flex items-center justify-between text-sm\">\n                      <div className=\"flex items-center gap-2\">\n                        <CreditCard className=\"h-4 w-4\" />\n                        <span>{wallet.name}</span>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        {wallet.isActive && (\n                          <Badge variant=\"default\" className=\"text-xs\">نشطة</Badge>\n                        )}\n                        {wallet.isDefault && (\n                          <Badge variant=\"default\" className=\"text-xs\">\n                            <Star className=\"h-3 w-3 mr-1\" />\n                            افتراضية\n                          </Badge>\n                        )}\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            onEditWallet?.(wallet);\n                          }}\n                          className=\"h-7 px-2\"\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            onDeleteWallet?.(wallet.id);\n                          }}\n                          className=\"h-7 px-2 text-destructive hover:text-destructive\"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </CardTitle>\n                  </CardHeader>\n                  \n                  <CardContent className=\"space-y-3\">\n                    {/* معلومات أساسية */}\n                    <div className=\"space-y-2\">\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <Phone className=\"h-3 w-3 text-gray-500\" />\n                        <span className=\"font-mono\">{wallet.phone}</span>\n                      </div>\n\n                      {wallet.ownerName && (\n                        <div className=\"flex items-center gap-2 text-sm\">\n                          <User className=\"h-3 w-3 text-gray-500\" />\n                          <span>{wallet.ownerName}</span>\n                        </div>\n                      )}\n                      \n                      {wallet.nationalId && (\n                        <div className=\"flex items-center gap-2 text-sm\">\n                          <IdCard className=\"h-3 w-3 text-gray-500\" />\n                          <span className=\"font-mono\">{wallet.nationalId}</span>\n                        </div>\n                      )}\n                      \n                      {providerInfo && (\n                        <div className=\"flex items-center gap-2 text-sm\">\n                          <Building className=\"h-3 w-3 text-gray-500\" />\n                          <span>{providerInfo.name}</span>\n                        </div>\n                      )}\n                    </div>\n\n                    {/* الحدود الشهرية بشكل موحد كما في الخارج */}\n                    {(() => {\n                      const monthlyWithdrawalLimit = wallet.monthlyWithdrawalLimit;\n                      const monthlyTransferLimit = wallet.monthlyTransferLimit;\n                      const monthlyWithdrawUsed = wallet.monthlyWithdrawalUsage || 0;\n                      const monthlyTransferUsed = wallet.monthlyTransferUsage || 0;\n                      const remainingWithdraw = Math.max(monthlyWithdrawalLimit - monthlyWithdrawUsed, 0);\n                      const remainingTransfer = Math.max(monthlyTransferLimit - monthlyTransferUsed, 0);\n\n                      return (\n                        <div className=\"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2\">\n                          <div className=\"text-xs text-gray-600 font-medium text-center\">\n                            الحدود الشهرية: {providerInfo?.name || wallet.walletProvider} - {wallet.phone}\n                          </div>\n                          <div className=\"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex\">\n                            <div className=\"w-1/2 bg-red-200 relative\">\n                              <div\n                                className=\"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-200 ease-out shadow-sm\"\n                                style={{ width: `${Math.min(((monthlyWithdrawUsed / Math.max(monthlyWithdrawalLimit, 1)) * 100), 100)}%` }}\n                              ></div>\n                            </div>\n                            <div className=\"w-1/2 bg-blue-200 relative\">\n                              <div\n                                className=\"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-200 ease-out shadow-sm\"\n                                style={{ width: `${Math.min(((monthlyTransferUsed / Math.max(monthlyTransferLimit, 1)) * 100), 100)}%` }}\n                              ></div>\n                            </div>\n                          </div>\n                          <div className=\"flex justify-between items-center mt-1\">\n                            <div className=\"text-xs text-red-600 font-medium\">\n                              متبقي سحب: {formatNumber(remainingWithdraw)} جنيه\n                            </div>\n                            <div className=\"text-xs text-blue-600 font-medium\">\n                              متبقي تحويل: {formatNumber(remainingTransfer)} جنيه\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })()}\n\n                    {/* زر عرض التفاصيل */}\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\" \n                      className=\"w-full text-xs\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onWalletSelect(wallet);\n                      }}\n                    >\n                      عرض التفاصيل الكاملة\n                    </Button>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        )}\n\n        <div className=\"flex justify-end pt-4 border-t\">\n          <Button onClick={onClose} variant=\"outline\">\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            إغلاق\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default WalletsViewPage;\n","import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { \r\n  Wallet, \r\n  Phone, \r\n  DollarSign, \r\n  Star, \r\n  CreditCard, \r\n  TrendingUp, \r\n  TrendingDown, \r\n  ArrowLeft, \r\n  IdCard, \r\n  Building, \r\n  Calendar,\r\n  Activity,\r\n  BarChart3,\r\n  Clock,\r\n  CheckCircle,\r\n  XCircle,\r\n  AlertCircle\r\n} from 'lucide-react';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { transactionService } from '@/integrations/firebase/services';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { calculateProfit } from '@/utils/commissionCalculator';\r\n\r\ninterface Wallet {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  nationalId?: string;\r\n  isDefault: boolean;\r\n  monthlyWithdrawalLimit: number;\r\n  monthlyTransferLimit: number;\r\n  monthlyWithdrawalUsage?: number;\r\n  monthlyTransferUsage?: number;\r\n  lastResetDate?: string;\r\n  walletProvider?: string;\r\n}\r\n\r\ninterface Transaction {\r\n  id: string;\r\n  type: 'withdrawal' | 'transfer' | 'deposit';\r\n  amount: number;\r\n  status: 'completed' | 'pending' | 'failed';\r\n  createdAt: string;\r\n  description?: string;\r\n  walletId: string;\r\n}\r\n\r\ninterface WalletDetailsPageProps {\r\n  wallet: Wallet | null;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onBack: () => void;\r\n}\r\n\r\n// بيانات شركات المحفظة\r\nconst walletProviders = [\r\n  {\r\n    id: 'vodafone',\r\n    name: 'فودافون كاش',\r\n    ownerName: 'أحمد محمد علي',\r\n    nationalId: '29012345678901'\r\n  },\r\n  {\r\n    id: 'etisalat',\r\n    name: 'اتصالات كاش',\r\n    ownerName: 'فاطمة حسن محمود',\r\n    nationalId: '28506789012345'\r\n  },\r\n  {\r\n    id: 'orange',\r\n    name: 'أورنج كاش',\r\n    ownerName: 'محمد أحمد السيد',\r\n    nationalId: '29309876543210'\r\n  },\r\n  {\r\n    id: 'we_pay',\r\n    name: 'وي باي',\r\n    ownerName: 'نورا عبد الرحمن',\r\n    nationalId: '29112345678901'\r\n  },\r\n  {\r\n    id: 'smart_wallet',\r\n    name: 'سمارت ولت',\r\n    ownerName: 'خالد محمد عبد الله',\r\n    nationalId: '28809876543210'\r\n  },\r\n  {\r\n    id: 'access_pay',\r\n    name: 'أكسس باي',\r\n    ownerName: 'مريم أحمد حسن',\r\n    nationalId: '29456789012345'\r\n  },\r\n  {\r\n    id: 'insta_pay',\r\n    name: 'انستا باي',\r\n    ownerName: 'عمر سعد محمد',\r\n    nationalId: '29012345678901'\r\n  }\r\n];\r\n\r\nconst WalletDetailsPage: React.FC<WalletDetailsPageProps> = ({ wallet, isOpen, onClose, onBack }) => {\r\n  const { user } = useFirebaseAuth();\r\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [selectedPeriod, setSelectedPeriod] = useState<'week' | 'month' | 'all'>('month');\r\n  const { toast } = useToast();\r\n\r\n  // تحميل المعاملات\r\n  useEffect(() => {\r\n    if (!wallet || !user?.uid || !isOpen) return;\r\n\r\n    const loadTransactions = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        const allTransactions = await transactionService.getByUserId(user.uid);\r\n        const walletTransactions = allTransactions\r\n          .filter(t => t.walletId === wallet.id)\r\n          .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n        \r\n        setTransactions(walletTransactions);\r\n      } catch (error) {\r\n        console.error('Error loading transactions:', error);\r\n        toast({\r\n          title: 'فشل جلب معاملات المحفظة',\r\n          description: 'قد تكون المشكلة بسبب صلاحيات Firestore أو الاتصال. تم عرض ما أمكن محليًا. جرّب تسجيل الدخول مجددًا أو صفحة اختبار المصادقة.',\r\n          variant: 'destructive'\r\n        });\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    loadTransactions();\r\n  }, [wallet, user?.uid, isOpen]);\r\n\r\n  if (!wallet) return null;\r\n\r\n  // دالة للحصول على معلومات شركة المحفظة\r\n  const getProviderInfo = (providerId: string) => {\r\n    return walletProviders.find(p => p.id === providerId);\r\n  };\r\n\r\n  // دالة لحساب النسبة المئوية للاستخدام\r\n  const getUsagePercentage = (used: number, limit: number) => {\r\n    return limit > 0 ? Math.min((used / limit) * 100, 100) : 0;\r\n  };\r\n\r\n  // دالة لتنسيق الأرقام\r\n  const formatNumber = (num: number) => {\r\n    return new Intl.NumberFormat('ar-EG').format(num);\r\n  };\r\n\r\n  // دالة لتنسيق التاريخ\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('ar-EG', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  // دالة لفلترة المعاملات حسب الفترة\r\n  const getFilteredTransactions = () => {\r\n    const now = new Date();\r\n    let startDate: Date;\r\n\r\n    switch (selectedPeriod) {\r\n      case 'week':\r\n        startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n        break;\r\n      case 'month':\r\n        startDate = new Date(now.getFullYear(), now.getMonth(), 1);\r\n        break;\r\n      default:\r\n        return transactions;\r\n    }\r\n\r\n    return transactions.filter(t => new Date(t.createdAt) >= startDate);\r\n  };\r\n\r\n  // حساب الإحصائيات\r\n  const filteredTransactions = getFilteredTransactions();\r\n  // توحيد أنواع المعاملات عبر المخططات المختلفة لضمان عدم اختفاء القيم\r\n  const isWithdrawTx = (t: any) => {\r\n    const type = t.type;\r\n    const xn = (t as any).txnType;\r\n    return (\r\n      type === 'withdraw' ||\r\n      type === 'withdrawal' ||\r\n      type === 'receive' ||\r\n      xn === 'receive'\r\n    );\r\n  };\r\n  const isSendTx = (t: any) => {\r\n    const type = t.type;\r\n    const xn = (t as any).txnType;\r\n    return (\r\n      type === 'send' ||\r\n      type === 'transfer' ||\r\n      xn === 'send'\r\n    );\r\n  };\r\n\r\n  const totalWithdrawals = filteredTransactions\r\n    .filter(t => isWithdrawTx(t) && t.status === 'completed')\r\n    .reduce((sum, t) => {\r\n      const amount = (t as any).withdrawnAmount !== undefined ? (t as any).withdrawnAmount : t.amount;\r\n      return sum + (amount || 0);\r\n    }, 0);\r\n  const totalTransfers = filteredTransactions\r\n    .filter(t => isSendTx(t) && t.status === 'completed' && (t as any).title !== 'إيصال تحويل مكينه')\r\n    .reduce((sum, t) => {\r\n      const amount = (t as any).sentAmount !== undefined ? (t as any).sentAmount : t.amount;\r\n      return sum + (amount || 0);\r\n    }, 0);\r\n  const totalDeposits = filteredTransactions\r\n    .filter(t => t.type === 'deposit' && t.status === 'completed')\r\n    .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n  // حساب الأرباح وعدد العمليات خلال الفترة المحددة\r\n  const completedTransactions = filteredTransactions.filter(t => t.status === 'completed');\r\n  const operationsCount = completedTransactions.length;\r\n  const totalProfit = completedTransactions.reduce((sum, t: any) => {\r\n    if (isWithdrawTx(t)) {\r\n      const amount = t.withdrawnAmount ?? t.receivedAmount ?? t.amount ?? 0;\r\n      return sum + calculateProfit(Number(amount) || 0, 'receive');\r\n    }\r\n    if (isSendTx(t)) {\r\n      const amount = t.sentAmount ?? t.transferredAmount ?? t.amount ?? 0;\r\n      return sum + calculateProfit(Number(amount) || 0, 'send');\r\n    }\r\n    return sum;\r\n  }, 0);\r\n\r\n  const providerInfo = getProviderInfo(wallet.walletProvider || '');\r\n  const withdrawalPercentage = getUsagePercentage(\r\n    wallet.monthlyWithdrawalUsage || 0,\r\n    wallet.monthlyWithdrawalLimit\r\n  );\r\n  const transferPercentage = getUsagePercentage(\r\n    wallet.monthlyTransferUsage || 0,\r\n    wallet.monthlyTransferLimit\r\n  );\r\n\r\n  // دالة للحصول على أيقونة نوع المعاملة\r\n  const getTransactionIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'withdrawal':\r\n        return <TrendingDown className=\"h-4 w-4 text-red-500\" />;\r\n      case 'transfer':\r\n        return <TrendingUp className=\"h-4 w-4 text-blue-500\" />;\r\n      case 'deposit':\r\n        return <DollarSign className=\"h-4 w-4 text-green-500\" />;\r\n      default:\r\n        return <Activity className=\"h-4 w-4 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  // دالة للحصول على أيقونة حالة المعاملة\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return <CheckCircle className=\"h-4 w-4 text-green-500\" />;\r\n      case 'pending':\r\n        return <Clock className=\"h-4 w-4 text-yellow-500\" />;\r\n      case 'failed':\r\n        return <XCircle className=\"h-4 w-4 text-red-500\" />;\r\n      default:\r\n        return <AlertCircle className=\"h-4 w-4 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  // دالة للحصول على نص نوع المعاملة\r\n  const getTransactionTypeText = (type: string) => {\r\n    switch (type) {\r\n      case 'withdrawal':\r\n        return 'سحب';\r\n      case 'transfer':\r\n        return 'تحويل';\r\n      case 'deposit':\r\n        return 'إيداع';\r\n      default:\r\n        return 'معاملة';\r\n    }\r\n  };\r\n\r\n  // دالة للحصول على نص حالة المعاملة\r\n  const getStatusText = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return 'مكتملة';\r\n      case 'pending':\r\n        return 'قيد الانتظار';\r\n      case 'failed':\r\n        return 'فاشلة';\r\n      default:\r\n        return 'غير محدد';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader className=\"pb-4\">\r\n          <DialogTitle className=\"flex items-center gap-2 text-lg\">\r\n            <CreditCard className=\"h-5 w-5\" />\r\n            تفاصيل المحفظة: {wallet.name}\r\n            {wallet.isDefault && (\r\n              <Badge variant=\"default\" className=\"mr-2\">\r\n                <Star className=\"h-3 w-3 mr-1\" />\r\n                افتراضية\r\n              </Badge>\r\n            )}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n          {/* معلومات المحفظة الأساسية */}\r\n          <div className=\"lg:col-span-1 space-y-4\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"text-sm flex items-center gap-2\">\r\n                  <IdCard className=\"h-4 w-4\" />\r\n                  المعلومات الأساسية\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-3\">\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  <Phone className=\"h-4 w-4 text-gray-500\" />\r\n                  <span className=\"font-mono\">{wallet.phone}</span>\r\n                </div>\r\n                \r\n                {wallet.nationalId && (\r\n                  <div className=\"flex items-center gap-2 text-sm\">\r\n                    <IdCard className=\"h-4 w-4 text-gray-500\" />\r\n                    <span className=\"font-mono\">{wallet.nationalId}</span>\r\n                  </div>\r\n                )}\r\n                \r\n                {providerInfo && (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex items-center gap-2 text-sm\">\r\n                      <Building className=\"h-4 w-4 text-gray-500\" />\r\n                      <span>{providerInfo.name}</span>\r\n                    </div>\r\n                    <div className=\"text-xs text-gray-600 pr-6\">\r\n                      <div>المالك: {providerInfo.ownerName}</div>\r\n                      <div className=\"font-mono\">الرقم القومي: {providerInfo.nationalId}</div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {wallet.lastResetDate && (\r\n                  <div className=\"flex items-center gap-2 text-sm\">\r\n                    <Calendar className=\"h-4 w-4 text-gray-500\" />\r\n                    <span>آخر إعادة تعيين: {new Date(wallet.lastResetDate).toLocaleDateString('ar-EG')}</span>\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* حدود الاستخدام */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"text-sm flex items-center gap-2\">\r\n                  <BarChart3 className=\"h-4 w-4\" />\r\n                  حدود الاستخدام الشهري\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                {/* حدود السحب */}\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"flex items-center justify-between text-xs\">\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <TrendingDown className=\"h-3 w-3 text-red-500\" />\r\n                      السحب الشهري\r\n                    </span>\r\n                    <span className=\"font-mono\">\r\n                      {formatNumber(wallet.monthlyWithdrawalUsage || 0)} / {formatNumber(wallet.monthlyWithdrawalLimit)}\r\n                    </span>\r\n                  </div>\r\n                  <Progress \r\n                    value={withdrawalPercentage} \r\n                    className=\"h-2\"\r\n                  />\r\n                  <div className=\"text-xs text-gray-600\">\r\n                    متبقي: {formatNumber(wallet.monthlyWithdrawalLimit - (wallet.monthlyWithdrawalUsage || 0))} جنيه\r\n                  </div>\r\n                </div>\r\n\r\n                <Separator />\r\n\r\n                {/* حدود التحويل */}\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"flex items-center justify-between text-xs\">\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <TrendingUp className=\"h-3 w-3 text-green-500\" />\r\n                      التحويل الشهري\r\n                    </span>\r\n                    <span className=\"font-mono\">\r\n                      {formatNumber(wallet.monthlyTransferUsage || 0)} / {formatNumber(wallet.monthlyTransferLimit)}\r\n                    </span>\r\n                  </div>\r\n                  <Progress \r\n                    value={transferPercentage} \r\n                    className=\"h-2\"\r\n                  />\r\n                  <div className=\"text-xs text-gray-600\">\r\n                    متبقي: {formatNumber(wallet.monthlyTransferLimit - (wallet.monthlyTransferUsage || 0))} جنيه\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* المعاملات والإحصائيات */}\r\n          <div className=\"lg:col-span-2 space-y-4\">\r\n            {/* إحصائيات سريعة */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <TrendingDown className=\"h-5 w-5 text-red-500\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalWithdrawals)}</div>\r\n                  <div className=\"text-xs text-gray-600\">إجمالي السحب</div>\r\n                </CardContent>\r\n              </Card>\r\n              \r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <TrendingUp className=\"h-5 w-5 text-blue-500\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalTransfers)}</div>\r\n                  <div className=\"text-xs text-gray-600\">إجمالي التحويل</div>\r\n                </CardContent>\r\n              </Card>\r\n              \r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <DollarSign className=\"h-5 w-5 text-green-500\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalDeposits)}</div>\r\n                  <div className=\"text-xs text-gray-600\">إجمالي الإيداع</div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* أرباح الفترة */}\r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <BarChart3 className=\"h-5 w-5 text-emerald-600\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalProfit)}</div>\r\n                  <div className=\"text-xs text-gray-600\">أرباح الفترة</div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* عدد العمليات */}\r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <Activity className=\"h-5 w-5 text-purple-600\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(operationsCount)}</div>\r\n                  <div className=\"text-xs text-gray-600\">عدد العمليات</div>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n\r\n            {/* فلتر الفترة الزمنية */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"text-sm flex items-center justify-between\">\r\n                  <span className=\"flex items-center gap-2\">\r\n                    <Activity className=\"h-4 w-4\" />\r\n                    سجل المعاملات\r\n                  </span>\r\n                  <div className=\"flex gap-2\">\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant={selectedPeriod === 'week' ? 'default' : 'outline'}\r\n                      onClick={() => setSelectedPeriod('week')}\r\n                      className=\"text-xs\"\r\n                    >\r\n                      أسبوع\r\n                    </Button>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant={selectedPeriod === 'month' ? 'default' : 'outline'}\r\n                      onClick={() => setSelectedPeriod('month')}\r\n                      className=\"text-xs\"\r\n                    >\r\n                      شهر\r\n                    </Button>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant={selectedPeriod === 'all' ? 'default' : 'outline'}\r\n                      onClick={() => setSelectedPeriod('all')}\r\n                      className=\"text-xs\"\r\n                    >\r\n                      الكل\r\n                    </Button>\r\n                  </div>\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                {isLoading ? (\r\n                  <div className=\"flex justify-center items-center py-8\">\r\n                    <div className=\"text-center\">\r\n                      <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2\"></div>\r\n                      <p className=\"text-sm text-gray-600\">جاري تحميل المعاملات...</p>\r\n                    </div>\r\n                  </div>\r\n                ) : filteredTransactions.length === 0 ? (\r\n                  <div className=\"text-center py-8\">\r\n                    <Activity className=\"h-8 w-8 text-gray-400 mx-auto mb-2\" />\r\n                    <p className=\"text-gray-600\">لا توجد معاملات في هذه الفترة</p>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-2 max-h-96 overflow-y-auto\">\r\n                    {filteredTransactions.map((transaction) => (\r\n                      <div key={transaction.id} className=\"flex items-center justify-between p-3 border rounded-lg\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          {getTransactionIcon(transaction.type)}\r\n                          <div>\r\n                            <div className=\"text-sm font-medium\">\r\n                              {getTransactionTypeText(transaction.type)} - {formatNumber(transaction.amount)} جنيه\r\n                            </div>\r\n                            <div className=\"text-xs text-gray-600\">\r\n                              {formatDate(transaction.createdAt)}\r\n                            </div>\r\n                            {transaction.description && (\r\n                              <div className=\"text-xs text-gray-500 mt-1\">\r\n                                {transaction.description}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          {getStatusIcon(transaction.status)}\r\n                          <span className=\"text-xs\">{getStatusText(transaction.status)}</span>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex justify-between pt-4 border-t\">\r\n          <Button onClick={onBack} variant=\"outline\">\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n            العودة للمحافظ\r\n          </Button>\r\n          <Button onClick={onClose} variant=\"outline\">\r\n            إغلاق\r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default WalletDetailsPage;","import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Wallet, Plus, Edit, Trash2, Phone, DollarSign, X, Settings, Info, Star, StarOff, CreditCard, TrendingUp, TrendingDown, Save, IdCard, Eye, Printer, ArrowLeft, User } from 'lucide-react';\r\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { SubscriptionPlan } from '@/utils/subscriptionService';\r\nimport { merchantWalletService, transactionService } from '@/integrations/firebase/services';\r\nimport { walletSelectionPinService } from '@/utils/walletSelectionPinService';\r\nimport { walletDailyLimitsService } from '@/utils/walletDailyLimitsService';\r\nimport WalletsViewPage from './WalletsViewPage';\r\nimport WalletDetailsPage from './WalletDetailsPage';\r\n\r\ninterface Wallet {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  ownerName?: string; // اسم مالك المحفظة\r\n  nationalId?: string; // الرقم القومي للخط\r\n  isDefault: boolean;\r\n  monthlyWithdrawalLimit: number;\r\n  monthlyTransferLimit: number;\r\n  monthlyWithdrawalUsage?: number; // المبلغ المسحوب هذا الشهر\r\n  monthlyTransferUsage?: number; // المبلغ المحول هذا الشهر\r\n  dailyWithdrawalLimit: number; // الحد الأقصى للسحب اليومي\r\n  dailyTransferLimit: number; // الحد الأقصى للتحويل اليومي\r\n  dailyWithdrawalUsage?: number; // المبلغ المسحوب اليوم\r\n  dailyTransferUsage?: number; // المبلغ المحول اليوم\r\n  lastResetDate?: string; // تاريخ آخر إعادة تعيين للعدادات\r\n  walletProvider?: string; // شركة المحفظة\r\n}\r\n\r\ninterface WalletManagementProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onWalletUpdate?: () => void;\r\n  initialEditingWallet?: Wallet | null;\r\n  autoStartAdd?: boolean;\r\n}\r\n\r\n// بيانات شركات المحفظة\r\nconst walletProviders = [\r\n  {\r\n    id: 'vodafone',\r\n    name: 'فودافون كاش'\r\n  },\r\n  {\r\n    id: 'etisalat',\r\n    name: 'اتصالات كاش'\r\n  },\r\n  {\r\n    id: 'orange',\r\n    name: 'أورنج كاش'\r\n  },\r\n  {\r\n    id: 'we_pay',\r\n    name: 'وي باي'\r\n  },\r\n  {\r\n    id: 'smart_wallet',\r\n    name: 'سمارت ولت'\r\n  },\r\n  {\r\n    id: 'access_pay',\r\n    name: 'أكسس باي'\r\n  },\r\n  {\r\n    id: 'insta_pay',\r\n    name: 'انستا باي'\r\n  }\r\n];\r\n\r\nconst WalletManagement: React.FC<WalletManagementProps> = ({ isOpen, onClose, onWalletUpdate, initialEditingWallet, autoStartAdd }) => {\r\n  const { toast } = useToast();\r\n  const { user, userSubscription } = useFirebaseAuth();\r\n  const isTahweelaPlan = (() => {\r\n    const raw = (userSubscription as any)?.subscription?.planType ?? (userSubscription as any)?.subscription?.plan ?? (userSubscription as any)?.planType ?? (userSubscription as any)?.plan ?? null;\r\n    const s = typeof raw === 'string' ? String(raw).trim().toLowerCase() : null;\r\n    return raw === SubscriptionPlan.TAHWEELA || s === 'tahweela' || s === 'تحويله';\r\n  })();\r\n  const navigate = useNavigate();\r\n  const [wallets, setWallets] = useState<Wallet[]>([]);\r\n  const [isAddingWallet, setIsAddingWallet] = useState(false);\r\n  const [editingWallet, setEditingWallet] = useState<Wallet | null>(null);\r\n  const [walletName, setWalletName] = useState('');\r\n  const [walletPhone, setWalletPhone] = useState('');\r\n  const [walletOwnerName, setWalletOwnerName] = useState('');\r\n  const [walletNationalId, setWalletNationalId] = useState('');\r\n  const [walletProvider, setWalletProvider] = useState('');\r\n  const [monthlyWithdrawalLimit, setMonthlyWithdrawalLimit] = useState('200000');\r\n  const [monthlyTransferLimit, setMonthlyTransferLimit] = useState('200000');\r\n  const [dailyWithdrawalLimit, setDailyWithdrawalLimit] = useState('100000');\r\n  const [dailyTransferLimit, setDailyTransferLimit] = useState('60000');\r\n  const [defaultTransferCommission, setDefaultTransferCommission] = useState('');\r\n  const [defaultWithdrawCommission, setDefaultWithdrawCommission] = useState('');\r\n  const [isDefault, setIsDefault] = useState(false);\r\n  const [showProviderInfo, setShowProviderInfo] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [showWalletsView, setShowWalletsView] = useState(false);\r\n  const [isMasterPinDialogOpen, setIsMasterPinDialogOpen] = useState(false);\r\n  const [selectedWallet, setSelectedWallet] = useState<Wallet | null>(null);\r\n\r\n  // دالة للحصول على مفتاح localStorage المرتبط بالمستخدم\r\n  const getWalletsKey = () => `wallets_${user?.uid || 'default'}`;\r\n\r\n  // افتح نموذج التعديل مباشرة إذا تم تمرير محفظة للتعديل\r\n  useEffect(() => {\r\n    if (initialEditingWallet) {\r\n      setEditingWallet(initialEditingWallet);\r\n      setIsAddingWallet(true);\r\n      setWalletName(initialEditingWallet.name || '');\r\n      setWalletPhone(initialEditingWallet.phone || '');\r\n      setWalletOwnerName(initialEditingWallet.ownerName || '');\r\n      setWalletNationalId(initialEditingWallet.nationalId || '');\r\n      setWalletProvider(initialEditingWallet.walletProvider || '');\r\n      setMonthlyWithdrawalLimit((initialEditingWallet.monthlyWithdrawalLimit || 200000).toString());\r\n      setMonthlyTransferLimit((initialEditingWallet.monthlyTransferLimit || 200000).toString());\r\n      setDailyWithdrawalLimit((initialEditingWallet.dailyWithdrawalLimit || 100000).toString());\r\n      setDailyTransferLimit((initialEditingWallet.dailyTransferLimit || 60000).toString());\r\n      setDefaultTransferCommission(\r\n        (initialEditingWallet as any).defaultTransferCommission != null\r\n          ? String((initialEditingWallet as any).defaultTransferCommission)\r\n          : ''\r\n      );\r\n      setDefaultWithdrawCommission(\r\n        (initialEditingWallet as any).defaultWithdrawCommission != null\r\n          ? String((initialEditingWallet as any).defaultWithdrawCommission)\r\n          : ''\r\n      );\r\n      setIsDefault(!!initialEditingWallet.isDefault);\r\n    }\r\n  }, [initialEditingWallet]);\r\n\r\n  // دالة لفحص وإعادة تعيين العدادات الشهرية\r\n  const checkAndResetMonthlyUsage = (wallet: Wallet): Wallet => {\r\n    const currentDate = new Date();\r\n    const currentMonth = currentDate.getMonth();\r\n    const currentYear = currentDate.getFullYear();\r\n    \r\n    if (!wallet.lastResetDate) {\r\n      // إذا لم يكن هناك تاريخ إعادة تعيين، قم بتعيين التاريخ الحالي\r\n      return {\r\n        ...wallet,\r\n        monthlyWithdrawalUsage: wallet.monthlyWithdrawalUsage || 0,\r\n        monthlyTransferUsage: wallet.monthlyTransferUsage || 0,\r\n        lastResetDate: currentDate.toISOString().split('T')[0]\r\n      };\r\n    }\r\n    \r\n    const lastResetDate = new Date(wallet.lastResetDate);\r\n    const lastResetMonth = lastResetDate.getMonth();\r\n    const lastResetYear = lastResetDate.getFullYear();\r\n    \r\n    // إذا كان الشهر أو السنة مختلفة، قم بإعادة تعيين العدادات\r\n    if (currentMonth !== lastResetMonth || currentYear !== lastResetYear) {\r\n      return {\r\n        ...wallet,\r\n        monthlyWithdrawalUsage: 0,\r\n        monthlyTransferUsage: 0,\r\n        lastResetDate: currentDate.toISOString().split('T')[0]\r\n      };\r\n    }\r\n    \r\n    return wallet;\r\n  };\r\n\r\n  // دالة لحساب الاستخدام الشهري للمحفظة من Firebase (تستخدم مخطط المعاملة الحالي)\r\n  const calculateWalletMonthlyUsage = async (walletId: string, transactions: any[]) => {\r\n    const currentMonth = new Date().getMonth();\r\n    const currentYear = new Date().getFullYear();\r\n    \r\n    const monthlyTransactions = transactions.filter((t: any) => {\r\n      const transactionDate = new Date(t.createdAt);\r\n      return (\r\n        transactionDate.getMonth() === currentMonth && \r\n        transactionDate.getFullYear() === currentYear &&\r\n        t.lineId === walletId\r\n      );\r\n    });\r\n\r\n    // \"receive\" = عمليات السحب من المحفظة، \"send\" = عمليات التحويل من المحفظة\r\n    const withdrawalUsage = monthlyTransactions\r\n      .filter((t: any) => t.txnType === 'receive')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    const transferUsage = monthlyTransactions\r\n      .filter((t: any) => t.txnType === 'send')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    return { withdrawalUsage, transferUsage };\r\n  };\r\n\r\n  // دالة لحساب الاستخدام اليومي للمحفظة (تستخدم مخطط المعاملة الحالي)\r\n  const calculateWalletDailyUsage = async (walletId: string, transactions: any[]) => {\r\n    const today = new Date();\r\n    const currentDay = today.getDate();\r\n    const currentMonth = today.getMonth();\r\n    const currentYear = today.getFullYear();\r\n    \r\n    const dailyTransactions = transactions.filter((t: any) => {\r\n      const transactionDate = new Date(t.createdAt);\r\n      return (\r\n        transactionDate.getDate() === currentDay &&\r\n        transactionDate.getMonth() === currentMonth && \r\n        transactionDate.getFullYear() === currentYear &&\r\n        t.lineId === walletId\r\n      );\r\n    });\r\n\r\n    const withdrawalUsage = dailyTransactions\r\n      .filter((t: any) => t.txnType === 'receive')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    const transferUsage = dailyTransactions\r\n      .filter((t: any) => t.txnType === 'send')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    return { withdrawalUsage, transferUsage };\r\n  };\r\n\r\n  // دالة لتحديث استخدام المحفظة\r\n  const updateWalletUsage = async (walletId: string) => {\r\n    try {\r\n      // جلب المعاملات من Firebase\r\n      const transactions = await transactionService.getByUserId(user?.uid || '');\r\n      const { withdrawalUsage, transferUsage } = await calculateWalletMonthlyUsage(walletId, transactions);\r\n      \r\n      setWallets(prevWallets => \r\n        prevWallets.map(wallet => {\r\n          if (wallet.id === walletId) {\r\n            const updatedWallet = checkAndResetMonthlyUsage(wallet);\r\n            return {\r\n              ...updatedWallet,\r\n              monthlyWithdrawalUsage: withdrawalUsage,\r\n              monthlyTransferUsage: transferUsage\r\n            };\r\n          }\r\n          return checkAndResetMonthlyUsage(wallet);\r\n        })\r\n      );\r\n    } catch (error) {\r\n      console.error('Error updating wallet usage:', error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Load wallets from Firebase for the current user\r\n    const loadWallets = async () => {\r\n      // التحقق من وجود المستخدم وحالة المصادقة\r\n      if (!user?.uid) {\r\n        console.log('No user authenticated, skipping wallet loading');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      \r\n      console.log('Loading wallets for user:', user.uid);\r\n      setIsLoading(true);\r\n      \r\n      try {\r\n        // التحقق من حالة المصادقة قبل الطلبات مع انتظار أطول\r\n        const { auth } = await import('@/firebase');\r\n        \r\n        // انتظار حتى يتم تحميل حالة المصادقة بالكامل\r\n        let retryCount = 0;\r\n        const maxRetries = 5;\r\n        \r\n        while (!auth.currentUser && retryCount < maxRetries) {\r\n          console.log(`Waiting for auth state... attempt ${retryCount + 1}`);\r\n          await new Promise(resolve => setTimeout(resolve, 1000));\r\n          retryCount++;\r\n        }\r\n        \r\n        if (!auth.currentUser) {\r\n          console.error('User not authenticated in Firebase Auth after retries');\r\n          throw new Error('not authenticated');\r\n        }\r\n        \r\n        console.log('Firebase Auth User:', auth.currentUser.uid);\r\n        console.log('Context User:', user.uid);\r\n        \r\n        console.log('Fetching wallets from Firebase...');\r\n        const firebaseWallets = await merchantWalletService.getByMerchantId(user.uid);\r\n        console.log('Fetched wallets:', firebaseWallets);\r\n        \r\n        console.log('Fetching transactions from Firebase...');\r\n        const transactions = await transactionService.getByUserId(user.uid);\r\n        console.log('Fetched transactions:', transactions);\r\n        \r\n        const formattedWallets = await Promise.all(firebaseWallets.map(async w => {\r\n          const { withdrawalUsage, transferUsage } = await calculateWalletMonthlyUsage(w.id, transactions);\r\n          const { withdrawalUsage: dailyWithdrawalUsage, transferUsage: dailyTransferUsage } = await calculateWalletDailyUsage(w.id, transactions);\r\n          \r\n          return {\r\n            id: w.id,\r\n            name: w.label || 'محفظة بدون اسم',\r\n            phone: w.msisdn,\r\n            ownerName: w.ownerName,\r\n            nationalId: w.nationalId,\r\n            isDefault: false, // يمكن تحديد المحفظة الافتراضية لاحقاً\r\n            monthlyWithdrawalLimit: w.withdrawLimit || 200000,\r\n            monthlyTransferLimit: w.transferLimit || 200000,\r\n            dailyWithdrawalLimit: (w as any).dailyWithdrawLimit || 100000, // الحد الأقصى للسحب اليومي\r\n            dailyTransferLimit: (w as any).dailyTransferLimit || 60000, // الحد الأقصى للتحويل اليومي\r\n            monthlyWithdrawalUsage: withdrawalUsage,\r\n            monthlyTransferUsage: transferUsage,\r\n            dailyWithdrawalUsage: dailyWithdrawalUsage,\r\n            dailyTransferUsage: dailyTransferUsage,\r\n            lastResetDate: new Date().toISOString().split('T')[0],\r\n            // ضم حقول العمولات الافتراضية إن كانت محفوظة في Firebase\r\n            defaultTransferCommission: (w.defaultTransferCommission != null ? Number(w.defaultTransferCommission) : null),\r\n            defaultWithdrawCommission: (w.defaultWithdrawCommission != null ? Number(w.defaultWithdrawCommission) : null)\r\n          };\r\n        }));\r\n        \r\n        // تطبيق فحص إعادة التعيين على جميع المحافظ\r\n        const walletsWithResetCheck = formattedWallets.map(checkAndResetMonthlyUsage);\r\n        setWallets(walletsWithResetCheck);\r\n        console.log('Wallets loaded successfully:', walletsWithResetCheck);\r\n        \r\n      } catch (error) {\r\n        console.error('Error loading wallets:', error);\r\n        // عدم استخدام بيانات محلية للعرض عند الفشل؛ سيظهر المحتوى فارغًا حتى يعود الاتصال\r\n        setWallets([]);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    loadWallets();\r\n  }, [user?.uid]);\r\n\r\n  const resetForm = () => {\r\n    setWalletName('');\r\n    setWalletPhone('');\r\n    setWalletOwnerName('');\r\n    setWalletNationalId('');\r\n    setWalletProvider('');\r\n    setMonthlyWithdrawalLimit('200000');\r\n    setMonthlyTransferLimit('200000');\r\n    setDailyWithdrawalLimit('100000');\r\n    setDailyTransferLimit('60000');\r\n     setDefaultTransferCommission('');\r\n     setDefaultWithdrawCommission('');\r\n    setIsDefault(false);\r\n    setEditingWallet(null);\r\n    setIsAddingWallet(false);\r\n  };\r\n\r\n  const startAddWallet = () => {\r\n    setWalletName('');\r\n    setWalletPhone('');\r\n    setWalletOwnerName('');\r\n    setWalletNationalId('');\r\n    setWalletProvider('');\r\n    setMonthlyWithdrawalLimit('200000');\r\n    setMonthlyTransferLimit('200000');\r\n    setDailyWithdrawalLimit('100000');\r\n    setDailyTransferLimit('60000');\r\n    setDefaultTransferCommission('');\r\n    setDefaultWithdrawCommission('');\r\n    setIsDefault(false);\r\n    setEditingWallet(null);\r\n    setIsAddingWallet(true);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isOpen && autoStartAdd && !isAddingWallet && !editingWallet) {\r\n      startAddWallet();\r\n    }\r\n  }, [isOpen, autoStartAdd, isAddingWallet, editingWallet]);\r\n\r\n  const startEdit = (wallet: Wallet) => {\r\n    setWalletName(wallet.name);\r\n    setWalletPhone(wallet.phone);\r\n    setWalletOwnerName(wallet.ownerName || '');\r\n    setWalletNationalId(wallet.nationalId || '');\r\n    setMonthlyWithdrawalLimit(wallet.monthlyWithdrawalLimit.toString());\r\n    setMonthlyTransferLimit(wallet.monthlyTransferLimit.toString());\r\n    setDailyWithdrawalLimit(wallet.dailyWithdrawalLimit.toString());\r\n    setDailyTransferLimit(wallet.dailyTransferLimit.toString());\r\n    setDefaultTransferCommission(\r\n      (wallet as any).defaultTransferCommission != null\r\n        ? String((wallet as any).defaultTransferCommission)\r\n        : ''\r\n    );\r\n    setDefaultWithdrawCommission(\r\n      (wallet as any).defaultWithdrawCommission != null\r\n        ? String((wallet as any).defaultWithdrawCommission)\r\n        : ''\r\n    );\r\n    setIsDefault(wallet.isDefault);\r\n    setEditingWallet(wallet);\r\n    setIsAddingWallet(true);\r\n  };\r\n\r\n  const saveWallet = async () => {\r\n    if (!walletName.trim() || !walletPhone.trim() || !walletProvider.trim()) {\r\n      toast({\r\n        title: \"خطأ\",\r\n        description: \"يرجى ملء جميع الحقول المطلوبة\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!user?.uid) {\r\n      toast({\r\n        title: \"خطأ\",\r\n        description: \"يجب تسجيل الدخول أولاً\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      if (editingWallet) {\r\n        await merchantWalletService.update(editingWallet.id, {\r\n          label: walletName.trim(),\r\n          msisdn: walletPhone.trim(),\r\n          ownerName: walletOwnerName.trim(),\r\n          nationalId: walletNationalId.trim(),\r\n          withdrawLimit: parseInt(monthlyWithdrawalLimit),\r\n          transferLimit: parseInt(monthlyTransferLimit),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit),\r\n          dailyTransferLimit: parseInt(dailyTransferLimit),\r\n          defaultTransferCommission:\r\n            defaultTransferCommission != null && defaultTransferCommission.trim() !== ''\r\n              ? parseFloat(defaultTransferCommission)\r\n              : null,\r\n          defaultWithdrawCommission:\r\n            defaultWithdrawCommission != null && defaultWithdrawCommission.trim() !== ''\r\n              ? parseFloat(defaultWithdrawCommission)\r\n              : null\r\n        });\r\n\r\n        // Sync limits to walletLimits collection for enforcement\r\n        await walletDailyLimitsService.setLimits(editingWallet.id, {\r\n          dailyTransferLimit: parseInt(dailyTransferLimit || '0'),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit || '0'),\r\n          monthlyTransferLimit: parseInt(monthlyTransferLimit || '0'),\r\n          monthlyWithdrawLimit: parseInt(monthlyWithdrawalLimit || '0')\r\n        });\r\n\r\n        // Update existing wallet in local state\r\n        const updatedWallets = wallets.map(w => \r\n          w.id === editingWallet.id \r\n            ? { \r\n                ...w, \r\n                name: walletName.trim(), \r\n                phone: walletPhone.trim(),\r\n                ownerName: walletOwnerName.trim(),\r\n                nationalId: walletNationalId.trim(),\r\n                walletProvider: walletProvider,\r\n                monthlyWithdrawalLimit: parseInt(monthlyWithdrawalLimit),\r\n                monthlyTransferLimit: parseInt(monthlyTransferLimit),\r\n                dailyWithdrawalLimit: parseInt(dailyWithdrawalLimit),\r\n                dailyTransferLimit: parseInt(dailyTransferLimit),\r\n                defaultTransferCommission:\r\n                  defaultTransferCommission != null && defaultTransferCommission.trim() !== ''\r\n                    ? parseFloat(defaultTransferCommission)\r\n                    : null,\r\n                defaultWithdrawCommission:\r\n                  defaultWithdrawCommission != null && defaultWithdrawCommission.trim() !== ''\r\n                    ? parseFloat(defaultWithdrawCommission)\r\n                    : null\r\n              }\r\n            : w\r\n        );\r\n        \r\n        setWallets(updatedWallets);\r\n        \r\n        // Also save to localStorage for backward compatibility\r\n        localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n        \r\n        toast({\r\n          title: \"تم التحديث\",\r\n          description: \"تم تحديث المحفظة بنجاح\",\r\n        });\r\n\r\n      } else {\r\n        // Create new wallet in Firebase\r\n        const newWalletData = {\r\n          merchantUserId: user.uid,\r\n          provider: walletProvider as 'vodafone_cash' | 'etisalat_cash' | 'orange_cash' | 'instapay',\r\n          msisdn: walletPhone.trim(),\r\n          label: walletName.trim(),\r\n          ownerName: walletOwnerName.trim(),\r\n          nationalId: walletNationalId.trim(),\r\n          isActive: true,\r\n          dailyLimit: 200000,\r\n          monthlyLimit: 200000,\r\n          withdrawLimit: parseInt(monthlyWithdrawalLimit),\r\n          transferLimit: parseInt(monthlyTransferLimit),\r\n          dailyTransferLimit: parseInt(dailyTransferLimit),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit),\r\n          dailyUsage: 0,\r\n          monthlyUsage: 0,\r\n          transferUsage: 0,\r\n          withdrawUsage: 0,\r\n          defaultTransferCommission:\r\n            defaultTransferCommission != null && defaultTransferCommission.trim() !== ''\r\n              ? parseFloat(defaultTransferCommission)\r\n              : null,\r\n          defaultWithdrawCommission:\r\n            defaultWithdrawCommission != null && defaultWithdrawCommission.trim() !== ''\r\n              ? parseFloat(defaultWithdrawCommission)\r\n              : null\r\n        };\r\n\r\n        const newWalletId = await merchantWalletService.create(newWalletData);\r\n        \r\n        // Sync limits to walletLimits collection for enforcement\r\n        await walletDailyLimitsService.setLimits(newWalletId, {\r\n          dailyTransferLimit: parseInt(dailyTransferLimit || '0'),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit || '0'),\r\n          monthlyTransferLimit: parseInt(monthlyTransferLimit || '0'),\r\n          monthlyWithdrawLimit: parseInt(monthlyWithdrawalLimit || '0')\r\n        });\r\n        \r\n        // Add to local state with reset usage counters\r\n        const currentDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format\r\n        const walletToAdd = {\r\n          id: newWalletId,\r\n          name: walletName.trim(),\r\n          phone: walletPhone.trim(),\r\n          ownerName: walletOwnerName.trim(),\r\n          nationalId: walletNationalId.trim(),\r\n          walletProvider: walletProvider,\r\n          isDefault: isDefault,\r\n          monthlyWithdrawalLimit: parseInt(monthlyWithdrawalLimit),\r\n          monthlyTransferLimit: parseInt(monthlyTransferLimit),\r\n          dailyWithdrawalLimit: parseInt(dailyWithdrawalLimit),\r\n          dailyTransferLimit: parseInt(dailyTransferLimit),\r\n          monthlyWithdrawalUsage: 0, // بدء من الصفر للمحفظة الجديدة\r\n          monthlyTransferUsage: 0, // بدء من الصفر للمحفظة الجديدة\r\n          dailyWithdrawalUsage: 0, // بدء من الصفر للمحفظة الجديدة\r\n          dailyTransferUsage: 0, // بدء من الصفر للمحفظة الجديدة\r\n          lastResetDate: currentDate, // تسجيل تاريخ الإنشاء\r\n          defaultTransferCommission:\r\n            defaultTransferCommission != null && defaultTransferCommission.trim() !== ''\r\n              ? parseFloat(defaultTransferCommission)\r\n              : null,\r\n          defaultWithdrawCommission:\r\n            defaultWithdrawCommission != null && defaultWithdrawCommission.trim() !== ''\r\n              ? parseFloat(defaultWithdrawCommission)\r\n              : null\r\n        };\r\n        \r\n        const newWallets = [...wallets, walletToAdd];\r\n        setWallets(newWallets);\r\n        \r\n        // Also save to localStorage for backward compatibility\r\n        localStorage.setItem(getWalletsKey(), JSON.stringify(newWallets));\r\n        \r\n        toast({\r\n          title: \"تم الإنشاء\",\r\n          description: \"تم إنشاء المحفظة بنجاح\",\r\n        });\r\n      }\r\n      \r\n      if (onWalletUpdate) {\r\n        onWalletUpdate();\r\n      }\r\n\r\n      resetForm();\r\n      setIsAddingWallet(false);\r\n      setEditingWallet(null);\r\n    } catch (error) {\r\n      console.error('Error saving wallet:', error);\r\n      toast({\r\n        title: \"خطأ\",\r\n        description: \"حدث خطأ أثناء حفظ المحفظة\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleEditWallet = (wallet: Wallet) => {\r\n    setEditingWallet(wallet);\r\n    setWalletName(wallet.name);\r\n    setWalletPhone(wallet.phone);\r\n    setWalletOwnerName(wallet.ownerName || '');\r\n    setWalletNationalId(wallet.nationalId || '');\r\n    setWalletProvider(wallet.walletProvider || '');\r\n    setMonthlyWithdrawalLimit(wallet.monthlyWithdrawalLimit.toString());\r\n    setMonthlyTransferLimit(wallet.monthlyTransferLimit.toString());\r\n    setIsDefault(wallet.isDefault);\r\n    setIsAddingWallet(true);\r\n  };\r\n\r\n  const handleUpdateWallet = async () => {\r\n    if (!editingWallet || !walletName || !walletPhone) {\r\n      toast({\r\n        title: \"خطأ\",\r\n        description: \"يرجى ملء جميع الحقول المطلوبة\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      // Update in Firebase\r\n      await merchantWalletService.update(editingWallet.id, {\r\n        label: walletName,\r\n        msisdn: walletPhone,\r\n        ownerName: walletOwnerName.trim(),\r\n        nationalId: walletNationalId.trim(),\r\n        monthlyWithdrawalLimit: parseInt(monthlyWithdrawalLimit),\r\n        monthlyTransferLimit: parseInt(monthlyTransferLimit)\r\n      });\r\n\r\n      const updatedWallets = wallets.map(w => \r\n        w.id === editingWallet.id \r\n          ? { \r\n              ...w, \r\n              name: walletName, \r\n              phone: walletPhone, \r\n              ownerName: walletOwnerName.trim(),\r\n              nationalId: walletNationalId.trim(),\r\n              monthlyWithdrawalLimit: parseInt(monthlyWithdrawalLimit), \r\n              monthlyTransferLimit: parseInt(monthlyTransferLimit) \r\n            }\r\n          : w\r\n      );\r\n\r\n      setWallets(updatedWallets);\r\n      localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n      setEditingWallet(null);\r\n      resetForm();\r\n\r\n      // Call the update callback if provided\r\n      if (onWalletUpdate) {\r\n        onWalletUpdate();\r\n      }\r\n\r\n      toast({\r\n        title: \"تم تحديث المحفظة\",\r\n        description: \"تم تحديث بيانات المحفظة بنجاح\",\r\n      });\r\n    } catch (error) {\r\n      console.error('Error updating wallet:', error);\r\n      toast({\r\n        title: \"خطأ\",\r\n        description: \"حدث خطأ أثناء تحديث المحفظة\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteWallet = async (walletId: string) => {\r\n    const walletToDelete = wallets.find(w => w.id === walletId);\r\n    \r\n    if (walletToDelete?.isDefault) {\r\n      toast({\r\n        title: \"تحذير\",\r\n        description: \"لا يمكن حذف المحفظة الافتراضية\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!user?.uid) {\r\n      toast({\r\n        title: \"خطأ\",\r\n        description: \"يجب تسجيل الدخول أولاً\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      // Delete from Firebase\r\n      await merchantWalletService.delete(walletId);\r\n      \r\n      // Update local state\r\n      const updatedWallets = wallets.filter(w => w.id !== walletId);\r\n      setWallets(updatedWallets);\r\n      \r\n      // Also update localStorage for backward compatibility\r\n      localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n      \r\n      if (onWalletUpdate) {\r\n        onWalletUpdate();\r\n      }\r\n\r\n      toast({\r\n        title: \"تم الحذف\",\r\n        description: \"تم حذف المحفظة بنجاح\",\r\n      });\r\n    } catch (error) {\r\n      console.error('Error deleting wallet:', error);\r\n      toast({\r\n        title: \"خطأ\",\r\n        description: \"حدث خطأ أثناء حذف المحفظة\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSetDefault = (walletId: string) => {\r\n    const updatedWallets = wallets.map(w => ({\r\n      ...w,\r\n      isDefault: w.id === walletId\r\n    }));\r\n\r\n    setWallets(updatedWallets);\r\n    localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n    \r\n    // Call the update callback if provided\r\n    if (onWalletUpdate) {\r\n      onWalletUpdate();\r\n    }\r\n\r\n    toast({\r\n      title: \"تم تحديث المحفظة الافتراضية\",\r\n      description: \"تم تعيين المحفظة كافتراضية بنجاح\",\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"sm:max-w-3xl w-[95vw] max-h-[80vh] overflow-hidden p-0 rounded-2xl shadow-[0_0_40px_rgba(15,23,42,0.35)]\">\r\n        <div className=\"max-h-[80vh] overflow-y-auto scrollbar-hide\">\r\n        <DialogHeader className=\"px-4 pt-3 pb-2\">\r\n          <DialogTitle className=\"flex items-center gap-1 text-sm\">\r\n            <Wallet className=\"h-3 w-3\" />\r\n            إدارة المحافظ\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-3 px-4 pb-4\">\r\n          {/* Add New Wallet Button */}\r\n          <div className=\"flex justify-between items-center\">\r\n            <h3 className=\"text-sm font-semibold\">المحافظ المتاحة ({wallets.length})</h3>\r\n            <div className=\"flex gap-2\">\r\n              <Button\r\n                onClick={() => {\r\n                  // اجبار ادخال الرقم السري الرئيسي قبل الاطلاع على المحافظ\r\n                  setIsMasterPinDialogOpen(true);\r\n                }}\r\n                className=\"flex items-center gap-1 h-6 px-2 text-xs\"\r\n                size=\"sm\"\r\n                variant=\"outline\"\r\n              >\r\n                <Eye className=\"h-3 w-3\" />\r\n                الاطلاع على المحافظ\r\n              </Button>\r\n              <Button\r\n                onClick={() => {\r\n                  startAddWallet();\r\n                }}\r\n                className=\"flex items-center gap-1 h-6 px-2 text-xs\"\r\n                size=\"sm\"\r\n              >\r\n                <Plus className=\"h-3 w-3\" />\r\n                إضافة محفظة جديدة\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {(isAddingWallet || editingWallet) && (\r\n            <Card className=\"border-0 bg-gradient-to-b from-blue-50/70 via-white to-white rounded-2xl shadow-md\">\r\n              <CardHeader className=\"pb-3 border-b border-blue-50\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <div className=\"h-8 w-8 rounded-full bg-blue-600 text-white flex items-center justify-center\">\r\n                      <Wallet className=\"h-4 w-4\" />\r\n                    </div>\r\n                    <div className=\"flex flex-col\">\r\n                      <CardTitle className=\"text-sm font-semibold text-gray-800\">\r\n                        {editingWallet ? 'تعديل المحفظة' : 'إضافة محفظة جديدة'}\r\n                      </CardTitle>\r\n                      <span className=\"text-[11px] text-gray-500\">\r\n                        اربط بيانات المحفظة بالحدود اليومية والشهرية بسهولة\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  {editingWallet && (\r\n                    <Badge variant=\"outline\" className=\"text-[10px] px-2 py-0.5 border-blue-200 text-blue-700 bg-blue-50\">\r\n                      وضع التعديل\r\n                    </Badge>\r\n                  )}\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4 pt-4\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n                  <div className=\"space-y-2 bg-white/70 rounded-xl border border-gray-100 px-3 py-2\">\r\n                    <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                      شركة المحفظة\r\n                    </label>\r\n                    <div className=\"flex gap-1 items-center\">\r\n                      <Select value={walletProvider} onValueChange={setWalletProvider}>\r\n                        <SelectTrigger className=\"h-8 text-xs flex-1 bg-gray-50\">\r\n                          <SelectValue placeholder=\"اختر شركة المحفظة\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          {walletProviders.map((provider) => (\r\n                            <SelectItem key={provider.id} value={provider.id} className=\"text-xs\">\r\n                              <div className=\"flex items-center justify-between w-full\">\r\n                                <span>{provider.name}</span>\r\n                              </div>\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2 bg-white/70 rounded-xl border border-gray-100 px-3 py-2\">\r\n                    <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                      اسم المحفظة\r\n                    </label>\r\n                    <Input\r\n                      value={walletName}\r\n                      onChange={(e) => setWalletName(e.target.value)}\r\n                      placeholder=\"مثال: محفظة العمل\"\r\n                      className=\"h-8 text-xs bg-gray-50\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-2 bg-white/70 rounded-xl border border-gray-100 px-3 py-2\">\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                    رقم الهاتف\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <Phone className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                    <Input\r\n                      value={walletPhone}\r\n                      onChange={(e) => setWalletPhone(e.target.value)}\r\n                      placeholder=\"أدخل رقم المحفظة\"\r\n                      className=\"pl-6 h-8 text-xs bg-gray-50\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white/70 rounded-xl border border-gray-100 px-3 py-3 space-y-2\">\r\n                  <div className=\"flex items-center justify-between mb-1\">\r\n                    <span className=\"text-xs font-semibold text-gray-800\">الحدود الشهرية واليومية</span>\r\n                    <span className=\"text-[10px] text-gray-500\">اضبط حدود السحب والتحويل</span>\r\n                  </div>\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\r\n                  <div>\r\n                    <label className=\"text-xs font-medium text-gray-700 mb-1 block text-right\">\r\n                      الحد الشهري للسحب (جنيه)\r\n                    </label>\r\n                    <div className=\"relative\">\r\n                      <DollarSign className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                      <Input\r\n                        type=\"number\"\r\n                        value={monthlyWithdrawalLimit}\r\n                        onChange={(e) => setMonthlyWithdrawalLimit(e.target.value)}\r\n                        placeholder=\"200000\"\r\n                        className=\"pl-6 pr-2 h-6 text-xs text-right\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"text-xs font-medium text-gray-700 mb-1 block text-right\">\r\n                      الحد الشهري للتحويل (جنيه)\r\n                    </label>\r\n                    <div className=\"relative\">\r\n                      <DollarSign className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                      <Input\r\n                        type=\"number\"\r\n                        value={monthlyTransferLimit}\r\n                        onChange={(e) => setMonthlyTransferLimit(e.target.value)}\r\n                        placeholder=\"200000\"\r\n                        className=\"pl-6 pr-2 h-6 text-xs text-right\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  </div>\r\n\r\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2\">\r\n                  <div>\r\n                    <label className=\"text-xs font-medium text-gray-700 mb-1 block text-right\">\r\n                      الحد اليومي للسحب (جنيه)\r\n                    </label>\r\n                    <div className=\"relative\">\r\n                      <TrendingDown className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-red-400\" />\r\n                      <Input\r\n                        type=\"number\"\r\n                        value={dailyWithdrawalLimit}\r\n                        onChange={(e) => setDailyWithdrawalLimit(e.target.value)}\r\n                        placeholder=\"100000\"\r\n                        className=\"pl-6 pr-2 h-6 text-xs text-right\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"text-xs font-medium text-gray-700 mb-1 block text-right\">\r\n                      الحد اليومي للتحويل (جنيه)\r\n                    </label>\r\n                    <div className=\"relative\">\r\n                      <TrendingUp className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-blue-400\" />\r\n                      <Input\r\n                        type=\"number\"\r\n                        value={dailyTransferLimit}\r\n                        onChange={(e) => setDailyTransferLimit(e.target.value)}\r\n                        placeholder=\"60000\"\r\n                        className=\"pl-6 pr-2 h-6 text-xs text-right\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-2 mt-1\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id=\"isDefault\"\r\n                    checked={isDefault}\r\n                    onChange={(e) => setIsDefault(e.target.checked)}\r\n                    className=\"rounded w-3 h-3\"\r\n                  />\r\n                  <label htmlFor=\"isDefault\" className=\"text-xs font-medium text-gray-700\">\r\n                    تعيين كمحفظة افتراضية\r\n                  </label>\r\n                </div>\r\n\r\n                <div className=\"mt-3 bg-white/70 rounded-xl border border-gray-100 px-3 py-3\">\r\n                  <div className=\"flex items-center gap-1 mb-1\">\r\n                    <Settings className=\"h-3 w-3 text-gray-600\" />\r\n                    <label className=\"text-xs font-medium text-gray-700\">\r\n                      إعدادات العمولة الافتراضية\r\n                    </label>\r\n                  </div>\r\n                  <p className=\"text-[10px] text-gray-500 mb-2\">\r\n                    يمكنك ترك قيم العمولات فارغة لإدخال العمولة يدويًا أثناء العملية، أو تحديدها هنا لتُستخدم تلقائيًا كمبلغ افتراضي.\r\n                  </p>\r\n\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\r\n                    <div>\r\n                      <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                        عمولة التحويل الافتراضية (جنيه)\r\n                      </label>\r\n                      <Input\r\n                        type=\"number\"\r\n                        step=\"0.01\"\r\n                        min=\"0\"\r\n                        value={defaultTransferCommission}\r\n                        onChange={(e) => setDefaultTransferCommission(e.target.value)}\r\n                        placeholder=\"مثال: 5\"\r\n                        className=\"h-6 text-xs\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                        عمولة السحب الافتراضية (جنيه)\r\n                      </label>\r\n                      <Input\r\n                        type=\"number\"\r\n                        step=\"0.01\"\r\n                        min=\"0\"\r\n                        value={defaultWithdrawCommission}\r\n                        onChange={(e) => setDefaultWithdrawCommission(e.target.value)}\r\n                        placeholder=\"مثال: 5\"\r\n                        className=\"h-6 text-xs\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                </div>\r\n\r\n                <div className=\"flex flex-col gap-2 mt-3\">\r\n                  <Button\r\n                    onClick={saveWallet}\r\n                    className=\"w-full h-9 text-xs bg-blue-600 hover:bg-blue-700 text-white\"\r\n                    size=\"sm\"\r\n                  >\r\n                    {editingWallet ? 'تحديث المحفظة' : 'إضافة المحفظة'}\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    onClick={() => {\r\n                      resetForm();\r\n                      onClose();\r\n                    }}\r\n                    className=\"w-full h-9 text-xs bg-white border border-gray-300 hover:bg-gray-50\"\r\n                    size=\"sm\"\r\n                  >\r\n                    إغلاق\r\n                  </Button>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n\r\n          {!isAddingWallet && !editingWallet && (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\r\n            {wallets.map((wallet) => (\r\n              <Card key={wallet.id} className={`${wallet.isDefault ? 'border-green-300 bg-green-50' : ''}`}>\r\n                <CardHeader className=\"pb-1\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <CardTitle className=\"text-sm flex items-center gap-1\">\r\n                      <Wallet className=\"h-3 w-3\" />\r\n                      {wallet.name}\r\n                    </CardTitle>\r\n                    {wallet.isDefault && (\r\n                      <Badge variant=\"default\" className=\"bg-green-600 text-xs px-1 py-0\">\r\n                        افتراضية\r\n                      </Badge>\r\n                    )}\r\n                  </div>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-1 pt-0\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <Phone className=\"h-3 w-3 text-gray-500\" />\r\n                    <span className=\"text-xs\">{wallet.phone}</span>\r\n                  </div>\r\n                  {wallet.walletProvider && (\r\n                    <div className=\"text-xs text-blue-600 mt-1\">\r\n                      {walletProviders.find(p => p.id === wallet.walletProvider)?.name || wallet.walletProvider}\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* شريط تقدم الحدود الشهرية واليومية لكل محفظة */}\r\n                  <div className=\"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2\">\r\n                    {/* الحدود الشهرية */}\r\n                    <div>\r\n                      <div className=\"text-xs font-medium text-gray-600 mb-1\">الحدود الشهرية</div>\r\n                      <div className=\"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex\">\r\n                        {/* نصف السحب */}\r\n                        <div className=\"w-1/2 bg-red-200 relative\">\r\n                          <div \r\n                            className=\"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                            style={{ \r\n                              width: `${Math.min(((wallet.monthlyWithdrawalUsage || 0) / wallet.monthlyWithdrawalLimit) * 100, 100)}%` \r\n                            }}\r\n                          ></div>\r\n                        </div>\r\n                        {/* نصف التحويل */}\r\n                        <div className=\"w-1/2 bg-blue-200 relative\">\r\n                          <div \r\n                            className=\"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                            style={{ \r\n                              width: `${Math.min(((wallet.monthlyTransferUsage || 0) / wallet.monthlyTransferLimit) * 100, 100)}%` \r\n                            }}\r\n                          ></div>\r\n                        </div>\r\n                      </div>\r\n                      \r\n                      {/* تفاصيل المبالغ المتبقية الشهرية */}\r\n                      <div className=\"flex justify-between items-center mt-0.5\">\r\n                        <div className=\"text-xs text-red-600 font-medium\">\r\n                          متبقي سحب: {Math.max(wallet.monthlyWithdrawalLimit - (wallet.monthlyWithdrawalUsage || 0), 0)} جنيه\r\n                        </div>\r\n                        <div className=\"text-xs text-blue-600 font-medium\">\r\n                          متبقي تحويل: {Math.max(wallet.monthlyTransferLimit - (wallet.monthlyTransferUsage || 0), 0)} جنيه\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* الحدود اليومية */}\r\n                    {(\r\n                      <div>\r\n                        <div className=\"text-xs font-medium text-gray-600 mb-1\">الحدود اليومية</div>\r\n                        <div className=\"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex\">\r\n                          {/* نصف السحب اليومي */}\r\n                          <div className=\"w-1/2 bg-orange-200 relative\">\r\n                            <div \r\n                              className=\"bg-gradient-to-r from-orange-400 to-orange-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                              style={{ \r\n                                width: `${Math.min(((wallet.dailyWithdrawalUsage || 0) / wallet.dailyWithdrawalLimit) * 100, 100)}%` \r\n                              }}\r\n                            ></div>\r\n                          </div>\r\n                          {/* نصف التحويل اليومي */}\r\n                          <div className=\"w-1/2 bg-green-200 relative\">\r\n                            <div \r\n                              className=\"bg-gradient-to-r from-green-400 to-green-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                              style={{ \r\n                                width: `${Math.min(((wallet.dailyTransferUsage || 0) / wallet.dailyTransferLimit) * 100, 100)}%` \r\n                              }}\r\n                            ></div>\r\n                          </div>\r\n                        </div>\r\n                        \r\n                        {/* تفاصيل المبالغ المتبقية اليومية */}\r\n                        <div className=\"flex justify بين items-center mt-0.5\">\r\n                          <div className=\"text-xs text-orange-600 font-medium\">\r\n                            متبقي سحب يومي: {Math.max(wallet.dailyWithdrawalLimit - (wallet.dailyWithdrawalUsage || 0), 0)} جنيه\r\n                          </div>\r\n                          <div className=\"text-xs text-green-600 font-medium\">\r\n                            متبقي تحويل يومي: {Math.max(wallet.dailyTransferLimit - (wallet.dailyTransferUsage || 0), 0)} جنيه\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div className=\"flex gap-1 pt-1\">\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"outline\"\r\n                      onClick={() => handleEditWallet(wallet)}\r\n                      className=\"flex-1 h-5 text-xs px-1\"\r\n                    >\r\n                      <Edit className=\"h-2 w-2 mr-0.5\" />\r\n                      تعديل\r\n                    </Button>\r\n                    \r\n                    {!wallet.isDefault && (\r\n                      <>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"outline\"\r\n                          onClick={() => handleSetDefault(wallet.id)}\r\n                          className=\"flex-1 h-5 text-xs px-1\"\r\n                        >\r\n                          جعلها افتراضية\r\n                        </Button>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"destructive\"\r\n                          onClick={() => handleDeleteWallet(wallet.id)}\r\n                          className=\"h-5 px-1\"\r\n                        >\r\n                          <Trash2 className=\"h-2 w-2\" />\r\n                        </Button>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n          )}\r\n\r\n          {!isAddingWallet && !editingWallet && wallets.length === 0 && (\r\n            <div className=\"text-center py-4 text-gray-500 text-xs\">\r\n              لا توجد محافظ متاحة. قم بإضافة محفظة جديدة للبدء.\r\n            </div>\r\n          )}\r\n        </div>\r\n        </div>\r\n      </DialogContent>\r\n\r\n      {/* رقم سري رئيسي قبل فتح عرض المحافظ */}\r\n      <MasterPinDialog\r\n        open={isMasterPinDialogOpen}\r\n        onOpenChange={setIsMasterPinDialogOpen}\r\n        mode=\"verify\"\r\n        title=\"إدخال الرقم السري الرئيسي\"\r\n        description=\"لا يمكن الاطلاع على المحافظ إلا بإدخال الرقم السري الرئيسي\"\r\n        userId={user?.uid}\r\n        onSuccess={() => {\r\n          setIsMasterPinDialogOpen(false);\r\n          setShowWalletsView(true);\r\n        }}\r\n      />\r\n\r\n      {/* صفحة عرض المحافظ */}\r\n      <WalletsViewPage\r\n        isOpen={showWalletsView}\r\n        onClose={() => setShowWalletsView(false)}\r\n        onWalletSelect={(wallet) => {\r\n          setSelectedWallet(wallet);\r\n          setShowWalletsView(false);\r\n        }}\r\n        onEditWallet={(wallet) => {\r\n          handleEditWallet(wallet);\r\n          setShowWalletsView(false);\r\n        }}\r\n        onDeleteWallet={async (walletId) => {\r\n          // حذف نهائي بدون تأكيد\r\n          try {\r\n            await merchantWalletService.delete(walletId);\r\n            // حدّث الحالة المحلية وقم بمزامنة localStorage لضمان انعكاس الحذف في القوائم\r\n            setWallets(prev => {\r\n              const updated = prev.filter(w => w.id !== walletId);\r\n              try {\r\n                localStorage.setItem(getWalletsKey(), JSON.stringify(updated));\r\n              } catch (e) {\r\n                console.error('Failed to update localStorage wallets after delete:', e);\r\n              }\r\n              return updated;\r\n            });\r\n\r\n            // إعلام الصفحة/المكوّن الأب لتحديث القوائم (مثل صفحة لوحة المستخدم)\r\n            if (onWalletUpdate) {\r\n              try {\r\n                await onWalletUpdate();\r\n              } catch (e) {\r\n                console.error('onWalletUpdate callback failed:', e);\r\n              }\r\n            }\r\n          } catch (err) {\r\n            console.error('Error deleting wallet:', err);\r\n          }\r\n        }}\r\n      />\r\n\r\n      {/* صفحة تفاصيل المحفظة */}\r\n      <WalletDetailsPage\r\n        wallet={selectedWallet}\r\n        isOpen={!!selectedWallet}\r\n        onClose={() => setSelectedWallet(null)}\r\n        onBack={() => {\r\n          setSelectedWallet(null);\r\n          setShowWalletsView(true);\r\n        }}\r\n      />\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default WalletManagement;\r\n"],"file":"assets/WalletManagement-lpVl8Tb_.js"}