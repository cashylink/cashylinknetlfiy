import{aL as w,r as n,u as D,V as j,t as p,a0 as S,j as e,af as E,ag as k,ah as I,ai as A,y as C,I as P,aQ as F,B as v}from"./index-B_gBGKq7.js";const B=({open:d,onOpenChange:h})=>{const{shiftUser:l,endShift:U,setShiftUser:N}=w(),[m,u]=n.useState(""),[g,f]=n.useState(""),[b,o]=n.useState([]),{user:s}=D();n.useEffect(()=>{(async()=>{try{if(s!=null&&s.uid){const t=j(p,"profiles",s.uid,"cashierUsers","list"),a=await S(t);if(a.exists()){const r=a.data(),i=Array.isArray(r==null?void 0:r.users)?r.users:[];if(i&&i.length>0){o(i);return}}}}catch{}try{const t=`cashierUsers_${(s==null?void 0:s.uid)||"default"}`;let a=localStorage.getItem(t);if(!a){const r=localStorage.getItem("cashierUsers");r&&(a=r)}o(a?JSON.parse(a):[])}catch{o([])}})()},[d,s==null?void 0:s.uid]),n.useEffect(()=>{if(!d||!(s!=null&&s.uid))return;const t=async()=>{try{const r=j(p,"profiles",s.uid,"cashierUsers","list"),i=await S(r);if(i.exists()){const c=i.data(),x=Array.isArray(c==null?void 0:c.users)?c.users:[];x&&x.length>0?o(x):a()}else a()}catch(r){console.warn("ShiftProfileDialog cashierUsers fetch error:",r),a()}},a=()=>{try{const r=`cashierUsers_${(s==null?void 0:s.uid)||"default"}`;let i=localStorage.getItem(r);if(!i){const c=localStorage.getItem("cashierUsers");c&&(i=c)}o(i?JSON.parse(i):[])}catch{o([])}};t()},[d,s==null?void 0:s.uid]);const y=async()=>{if(f(""),!l)return;const t=b.find(a=>a.username===l.username);if(!t){f("لا يوجد مستخدم مطابق لهذه الوردية");return}if(m.trim()!==t.password){f("الرقم السري غير صحيح");return}U(),N(null),u(""),h(!1)};return e.jsx(E,{open:d,onOpenChange:t=>{u(""),f(""),h(t)},children:e.jsxs(k,{className:"sm:max-w-md",children:[e.jsx(I,{children:e.jsx(A,{children:"بروفيل الوردية"})}),l?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-lg border p-3 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-800",children:l.name}),e.jsx("div",{className:"text-xs text-gray-600",children:l.username})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{className:"block",children:"أدخل الرقم السري لتسليم الوردية"}),e.jsx(P,{type:"password",value:m,onChange:t=>u(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),y())},placeholder:"الرقم السري للمستخدم",dir:"ltr"}),g&&e.jsx("div",{className:"text-red-600 text-xs",children:g})]})]}):e.jsx("div",{className:"text-sm text-gray-600",children:"لا يوجد مستخدم وردية نشط حالياً"}),e.jsxs(F,{className:"flex justify-between",children:[e.jsx(v,{variant:"outline",onClick:()=>h(!1),children:"إغلاق"}),e.jsx(v,{onClick:y,disabled:!l,children:"تسليم الوردية"})]})]})})};export{B as default};
//# sourceMappingURL=ShiftProfileDialog-DXoVuBIT.js.map
