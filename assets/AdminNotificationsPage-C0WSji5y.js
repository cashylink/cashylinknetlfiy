import{c as I,r,j as e,I as x,B as N,m as k,n as C,p as w,h as F,i as L,s as U,f as B}from"./index-TGIFU2Cb.js";import{C as D,a as A,b as E,d as H}from"./card-Dhy3zl0F.js";import{L as m}from"./label-BAt1qffg.js";import{B as K,T as M}from"./textarea-BcjosInG.js";import{L as P}from"./link-CU5kuRAi.js";const J=()=>{const{toast:a}=I(),[u,v]=r.useState(""),[h,y]=r.useState(""),[f,j]=r.useState(""),[c,d]=r.useState(!1),[o,b]=r.useState(""),S=async s=>{var n;if(s.preventDefault(),!u.trim()||!h.trim()){a({title:"خطأ",description:"العنوان والنص مطلوبان",variant:"destructive"});return}try{d(!0);const t={title:u.trim(),body:h.trim(),link:f.trim()||""};if(o.trim()){const g=k(C,"sendFcmToUser"),l={};t.link&&(l.link=t.link);const i=await g({userId:o.trim(),title:t.title,body:t.body,data:l}),p=!!((n=i==null?void 0:i.data)!=null&&n.ok);a({title:p?"تم الإرسال":"تحذير",description:p?`أُرسل إلى المستخدم ${o}`:"لا توجد أجهزة مسجلة لهذا المستخدم",variant:p?void 0:"destructive"})}else await w(F(L,"broadcasts"),{title:t.title,message:t.body,linkUrl:t.link||void 0,audienceKey:"global",active:!0,createdAt:U()}),a({title:"تم الإرسال",description:"تم إنشاء بث عام وسيتم إرسال الإشعار"});v(""),y(""),j(""),b("")}catch(t){a({title:"فشل الإرسال",description:String((t==null?void 0:t.message)||t),variant:"destructive"})}finally{d(!1)}},T=async()=>{var s,n;try{const t=((s=B.currentUser)==null?void 0:s.uid)||"";if(!t){a({title:"غير مسجل",description:"سجّل الدخول كأدمن لإرسال اختبار",variant:"destructive"});return}d(!0);const l=await k(C,"sendFcmToUser")({userId:t,title:"إشعار اختبار",body:"تم إرسال إشعار تجريبي بنجاح",data:{type:"test"}}),i=!!((n=l==null?void 0:l.data)!=null&&n.ok);a({title:i?"تم إرسال الاختبار":"فشل الاختبار",description:i?"تفقد هاتفك الآن":"تحقق من حفظ توكن الجهاز",variant:i?void 0:"destructive"})}catch(t){a({title:"فشل الاختبار",description:String((t==null?void 0:t.message)||t),variant:"destructive"})}finally{d(!1)}};return e.jsx("div",{className:"min-h-screen p-4",children:e.jsxs(D,{className:"max-w-xl mx-auto",children:[e.jsx(A,{children:e.jsxs(E,{className:"flex items-center gap-2 text-base",children:[e.jsx(K,{className:"h-4 w-4"}),"إرسال إشعار خارجي"]})}),e.jsx(H,{className:"space-y-4",children:e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"userId",children:"إرسال لمستخدم محدد (اختياري)"}),e.jsx(x,{id:"userId",value:o,onChange:s=>b(s.target.value),placeholder:"أدخل معرف المستخدم (UID)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"إذا تركته فارغاً سيتم إرسال إشعار عام للجميع."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"title",children:"العنوان"}),e.jsx(x,{id:"title",value:u,onChange:s=>v(s.target.value),placeholder:"عنوان الإشعار"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"body",children:"النص"}),e.jsx(M,{id:"body",value:h,onChange:s=>y(s.target.value),placeholder:"نص الإشعار",className:"min-h-[120px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{htmlFor:"link",className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"})," رابط اختياري"]}),e.jsx(x,{id:"link",value:f,onChange:s=>j(s.target.value),placeholder:"https://example.com أو cashy://..."})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(N,{type:"button",onClick:T,disabled:c,variant:"outline",children:c?"...":"إرسال اختبار لنفسي"}),e.jsx(N,{type:"submit",disabled:c,className:"px-6",children:c?"جاري الإرسال...":"إرسال"})]})]})})]})})};export{J as default};
