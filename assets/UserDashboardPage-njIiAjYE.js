const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-CzMrJEuC.js","./index-BqdiC7Gy.css","./WalletManagement-BXKugYvA.js","./badge-D-234tiw.js","./select-DHMtOuee.js","./wallet-BpRPCgGm.js","./star-C4GDXCGa.js","./square-pen-BXn6dQmK.js","./arrow-left-DE7YICBa.js","./progress-62em--G3.js","./separator-CRdC0eUh.js","./calendar-DNLMAp6O.js","./chart-column-CC631eCQ.js","./trending-down-CokIdY6w.js","./dollar-sign-0aC_iCk7.js","./activity-BBo3HBz8.js","./circle-x-BIAaVYIX.js","./circle-check-big-CujdvfsP.js","./TransactionDetailsModal-CwrtpD6g.js","./SimCardsAccessDialog-p84rP6ZI.js","./printer-BxRsauDr.js","./ReceiptModal-D6AabDSr.js","./html2canvas.esm-BfYXEYrK.js","./download-CJ061BPe.js","./EditBalanceDialog-DShyKpUy.js","./ChangePinDialog-CUjyQfB4.js","./ChangeCashPinDialog-Cu1lc5K-.js","./ChangeWalletTotalPinDialog-BZgEPQgv.js","./AddToWalletDialog-tfSlr_jZ.js","./CalculatorDialog-B1fj1m0a.js","./SalesDataDialog-e3zvXpQc.js","./table-B3xDson-.js","./tabs-CUOI6ynQ.js","./index-BBRmOonx.js","./dropdown-menu-BbnyNGMu.js","./alert-dialog-BuOo2tJw.js","./refresh-cw-oGf6rkWG.js","./save-C_zXO1pj.js","./pen-line-CXGYdlEQ.js","./ProfileSettingsPage-C3UNZtns.js","./switch-BsQLD5QZ.js","./textarea-DH9YvORw.js","./users-DCm2SxTc.js","./crown-CHbbJHO0.js","./ProfileIcon-CoHGJzAB.js","./freeTrialService-BlbSJwfx.js","./broadcastService-D5PHNSZD.js","./bell-BJOCCReM.js","./profitService-D3SXiBSD.js","./arrow-down-left-Do7B1AJE.js","./CashSummaryDialog-BIfXXuAb.js","./battery-charging-CICy0gwc.js","./CreditCardsDialog-CyASBCao.js","./InstallmentModal-Bs1CUlVN.js","./SimCardsDialog-BHAHmV75.js","./wifi--Er0opd2.js","./AdslCardsDialog-COHSnb4z.js","./MaintenanceDialog-QMSenSC7.js","./MachineDailyDialog-DNWYmXVC.js","./WalletsManagement-DWC2pV-z.js","./WalletPrinterDialog-C-dhuDER.js","./WalletsListDialog-C6GZurWU.js","./building-2-PwAzrvCc.js","./CashierShiftModal-B_RIDGAK.js","./functions-B25VVZyV.js","./ShiftProfileDialog-x0kyOIbL.js","./ChangeLogDialog-DVwwA8-N.js","./sparkles-BifW4KGb.js","./dailyOperationCountService-BnqD6y-f.js"])))=>i.map(i=>d[i]);
import{_ as Jr,r as u,j as e,bt as hf,bu as _u,ap as ff,bv as gf,aj as pf,al as xf,ao as Au,am as Tu,an as Yr,bw as Pu,ba as Ou,bx as yf,by as bf,bB as vf,bA as wf,bC as Nf,bD as jf,bE as Sf,bF as Df,a9 as Ys,bm as Hd,a0 as ii,T as Te,s as V,Z as Qt,D as ft,o as Vs,ct as rs,$ as ca,q as Oe,p as me,aF as X,w as ke,u as yl,ab as Eu,bI as kf,B as I,aU as di,R as G,ac as St,J as Js,af as he,ag as fe,ah as xe,ai as ye,aE as Cf,b6 as Qd,a4 as Zt,a5 as Mu,l as bl,av as Bt,G as Gd,x as ee,I as K,H as Xd,a3 as If,ae as Wu,a6 as cs,aG as Xe,aP as Pe,a as _f,cu as Af,aK as Tf,cj as Pf,aT as Of,m as Ef,b4 as ns,ad as ae,aL as Z,Q as Mf,cv as Wr,V as Wf,aI as Zd,cw as Rr,aZ as Rf,C as Ca,c as is,d as os,at as oa,aR as ei,aW as Lr,f as Ia,a1 as jt,S as Lf,b8 as Ff,E as Fr,a2 as Bf,cx as $f,U as Br,b3 as eu,aM as Uf,as as $r,bK as tu,P as ti,aQ as ai,a8 as au,au as si,M as tl,aD as ri,bL as Vf,bM as qf,bN as zf,bO as Yf,bP as Kf,A as ni,bQ as Jf,bR as su,ar as Xt,aJ as Hf,W as ru,t as al,v as Qf,b7 as Ur,br as Gf,cy as Xf,b_ as sl,cz as nu,cA as Zf}from"./index-CzMrJEuC.js";import{C as eg,P as tg,a as ag,w as sg}from"./ProfileSettingsPage-C3UNZtns.js";import{B as _a}from"./badge-D-234tiw.js";import{S as rg,T as ng,a as ig,b as iu,c as ou}from"./tabs-CUOI6ynQ.js";import{C as og,f as lg,S as Rs,a as Ls,b as Fs,c as Bs,d as Aa}from"./select-DHMtOuee.js";import{C as cg,D as dg,a as ug,b as mg,c as hg,d as fg}from"./dropdown-menu-BbnyNGMu.js";import{L as Vr,S as gg}from"./switch-BsQLD5QZ.js";import{P as pg}from"./ProfileIcon-CoHGJzAB.js";import{E as xg,a as yg}from"./broadcastService-D5PHNSZD.js";import{B as rl}from"./bell-BJOCCReM.js";import{C as oi}from"./circle-check-big-CujdvfsP.js";import{ProfitService as xa}from"./profitService-D3SXiBSD.js";import{C as li}from"./calendar-DNLMAp6O.js";import{A as qs}from"./arrow-down-left-Do7B1AJE.js";import{A as Ru,u as qr,f as Ot,B as nl,C as bg,a as il,S as lu,b as cu}from"./SimCardsAccessDialog-p84rP6ZI.js";import{D as Pa}from"./dollar-sign-0aC_iCk7.js";import{FreeTrialService as du}from"./freeTrialService-BlbSJwfx.js";import{W as $s}from"./wallet-BpRPCgGm.js";import{C as vg}from"./crown-CHbbJHO0.js";import{R as ol}from"./refresh-cw-oGf6rkWG.js";import{S as uu}from"./square-pen-BXn6dQmK.js";import{P as wg}from"./printer-BxRsauDr.js";import{S as Ng}from"./star-C4GDXCGa.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jg=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],mu=Jr("calendar-days",jg);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sg=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Dg=Jr("chevron-left",Sg);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Cg=Jr("circle-plus",kg);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ig=[["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["path",{d:"M16 2v20",key:"rotuqe"}]],hu=Jr("notebook",Ig);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _g=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Lu=Jr("package",_g);function Ag(r){const t=Tg(r),n=u.forwardRef((o,c)=>{const{children:h,...b}=o,w=u.Children.toArray(h),D=w.find(Og);if(D){const k=D.props.children,j=w.map(P=>P===D?u.Children.count(k)>1?u.Children.only(null):u.isValidElement(k)?k.props.children:null:P);return e.jsx(t,{...b,ref:c,children:u.isValidElement(k)?u.cloneElement(k,void 0,j):null})}return e.jsx(t,{...b,ref:c,children:h})});return n.displayName=`${r}.Slot`,n}function Tg(r){const t=u.forwardRef((n,o)=>{const{children:c,...h}=n;if(u.isValidElement(c)){const b=Mg(c),w=Eg(h,c.props);return c.type!==u.Fragment&&(w.ref=o?hf(o,b):b),u.cloneElement(c,w)}return u.Children.count(c)>1?u.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var Pg=Symbol("radix.slottable");function Og(r){return u.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===Pg}function Eg(r,t){const n={...t};for(const o in t){const c=r[o],h=t[o];/^on[A-Z]/.test(o)?c&&h?n[o]=(...w)=>{const D=h(...w);return c(...w),D}:c&&(n[o]=c):o==="style"?n[o]={...c,...h}:o==="className"&&(n[o]=[c,h].filter(Boolean).join(" "))}return{...r,...n}}function Mg(r){var o,c;let t=(o=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?r.ref:(t=(c=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:c.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?r.props.ref:r.props.ref||r.ref)}var hi="Popover",[Fu]=pf(hi,[_u]),Hr=_u(),[Wg,qa]=Fu(hi),Bu=r=>{const{__scopePopover:t,children:n,open:o,defaultOpen:c,onOpenChange:h,modal:b=!1}=r,w=Hr(t),D=u.useRef(null),[k,j]=u.useState(!1),[P,M]=ff({prop:o,defaultProp:c??!1,onChange:h,caller:hi});return e.jsx(gf,{...w,children:e.jsx(Wg,{scope:t,contentId:xf(),triggerRef:D,open:P,onOpenChange:M,onOpenToggle:u.useCallback(()=>M(W=>!W),[M]),hasCustomAnchor:k,onCustomAnchorAdd:u.useCallback(()=>j(!0),[]),onCustomAnchorRemove:u.useCallback(()=>j(!1),[]),modal:b,children:n})})};Bu.displayName=hi;var $u="PopoverAnchor",Rg=u.forwardRef((r,t)=>{const{__scopePopover:n,...o}=r,c=qa($u,n),h=Hr(n),{onCustomAnchorAdd:b,onCustomAnchorRemove:w}=c;return u.useEffect(()=>(b(),()=>w()),[b,w]),e.jsx(Pu,{...h,...o,ref:t})});Rg.displayName=$u;var Uu="PopoverTrigger",Vu=u.forwardRef((r,t)=>{const{__scopePopover:n,...o}=r,c=qa(Uu,n),h=Hr(n),b=Au(t,c.triggerRef),w=e.jsx(Tu.button,{type:"button","aria-haspopup":"dialog","aria-expanded":c.open,"aria-controls":c.contentId,"data-state":Ju(c.open),...o,ref:b,onClick:Yr(r.onClick,c.onOpenToggle)});return c.hasCustomAnchor?w:e.jsx(Pu,{asChild:!0,...h,children:w})});Vu.displayName=Uu;var vl="PopoverPortal",[Lg,Fg]=Fu(vl,{forceMount:void 0}),qu=r=>{const{__scopePopover:t,forceMount:n,children:o,container:c}=r,h=qa(vl,t);return e.jsx(Lg,{scope:t,forceMount:n,children:e.jsx(Ou,{present:n||h.open,children:e.jsx(yf,{asChild:!0,container:c,children:o})})})};qu.displayName=vl;var Hs="PopoverContent",zu=u.forwardRef((r,t)=>{const n=Fg(Hs,r.__scopePopover),{forceMount:o=n.forceMount,...c}=r,h=qa(Hs,r.__scopePopover);return e.jsx(Ou,{present:o||h.open,children:h.modal?e.jsx($g,{...c,ref:t}):e.jsx(Ug,{...c,ref:t})})});zu.displayName=Hs;var Bg=Ag("PopoverContent.RemoveScroll"),$g=u.forwardRef((r,t)=>{const n=qa(Hs,r.__scopePopover),o=u.useRef(null),c=Au(t,o),h=u.useRef(!1);return u.useEffect(()=>{const b=o.current;if(b)return bf(b)},[]),e.jsx(vf,{as:Bg,allowPinchZoom:!0,children:e.jsx(Yu,{...r,ref:c,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Yr(r.onCloseAutoFocus,b=>{var w;b.preventDefault(),h.current||(w=n.triggerRef.current)==null||w.focus()}),onPointerDownOutside:Yr(r.onPointerDownOutside,b=>{const w=b.detail.originalEvent,D=w.button===0&&w.ctrlKey===!0,k=w.button===2||D;h.current=k},{checkForDefaultPrevented:!1}),onFocusOutside:Yr(r.onFocusOutside,b=>b.preventDefault(),{checkForDefaultPrevented:!1})})})}),Ug=u.forwardRef((r,t)=>{const n=qa(Hs,r.__scopePopover),o=u.useRef(!1),c=u.useRef(!1);return e.jsx(Yu,{...r,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:h=>{var b,w;(b=r.onCloseAutoFocus)==null||b.call(r,h),h.defaultPrevented||(o.current||(w=n.triggerRef.current)==null||w.focus(),h.preventDefault()),o.current=!1,c.current=!1},onInteractOutside:h=>{var D,k;(D=r.onInteractOutside)==null||D.call(r,h),h.defaultPrevented||(o.current=!0,h.detail.originalEvent.type==="pointerdown"&&(c.current=!0));const b=h.target;((k=n.triggerRef.current)==null?void 0:k.contains(b))&&h.preventDefault(),h.detail.originalEvent.type==="focusin"&&c.current&&h.preventDefault()}})}),Yu=u.forwardRef((r,t)=>{const{__scopePopover:n,trapFocus:o,onOpenAutoFocus:c,onCloseAutoFocus:h,disableOutsidePointerEvents:b,onEscapeKeyDown:w,onPointerDownOutside:D,onFocusOutside:k,onInteractOutside:j,...P}=r,M=qa(Hs,n),W=Hr(n);return wf(),e.jsx(Nf,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:c,onUnmountAutoFocus:h,children:e.jsx(jf,{asChild:!0,disableOutsidePointerEvents:b,onInteractOutside:j,onEscapeKeyDown:w,onPointerDownOutside:D,onFocusOutside:k,onDismiss:()=>M.onOpenChange(!1),children:e.jsx(Sf,{"data-state":Ju(M.open),role:"dialog",id:M.contentId,...W,...P,ref:t,style:{...P.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Ku="PopoverClose",Vg=u.forwardRef((r,t)=>{const{__scopePopover:n,...o}=r,c=qa(Ku,n);return e.jsx(Tu.button,{type:"button",...o,ref:t,onClick:Yr(r.onClick,()=>c.onOpenChange(!1))})});Vg.displayName=Ku;var qg="PopoverArrow",zg=u.forwardRef((r,t)=>{const{__scopePopover:n,...o}=r,c=Hr(n);return e.jsx(Df,{...c,...o,ref:t})});zg.displayName=qg;function Ju(r){return r?"open":"closed"}var Yg=Bu,Kg=Vu,Jg=qu,Hu=zu;const fu=Yg,gu=Kg,fl=u.forwardRef(({className:r,align:t="center",sideOffset:n=4,...o},c)=>e.jsx(Jg,{children:e.jsx(Hu,{ref:c,align:t,sideOffset:n,className:Ys("z-[9999] w-72 rounded-xl border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...o})}));fl.displayName=Hu.displayName;function Ae(r){const t=Object.prototype.toString.call(r);return r instanceof Date||typeof r=="object"&&t==="[object Date]"?new r.constructor(+r):typeof r=="number"||t==="[object Number]"||typeof r=="string"||t==="[object String]"?new Date(r):new Date(NaN)}function Gt(r,t){return r instanceof Date?new r.constructor(t):new Date(t)}function Et(r,t){const n=Ae(r);return isNaN(t)?Gt(r,NaN):(t&&n.setDate(n.getDate()+t),n)}function ua(r,t){const n=Ae(r);if(isNaN(t))return Gt(r,NaN);if(!t)return n;const o=n.getDate(),c=Gt(r,n.getTime());c.setMonth(n.getMonth()+t+1,0);const h=c.getDate();return o>=h?c:(n.setFullYear(c.getFullYear(),c.getMonth(),o),n)}const wl=6048e5,Hg=864e5;let Qg={};function Qr(){return Qg}function wa(r,t){var w,D,k,j;const n=Qr(),o=(t==null?void 0:t.weekStartsOn)??((D=(w=t==null?void 0:t.locale)==null?void 0:w.options)==null?void 0:D.weekStartsOn)??n.weekStartsOn??((j=(k=n.locale)==null?void 0:k.options)==null?void 0:j.weekStartsOn)??0,c=Ae(r),h=c.getDay(),b=(h<o?7:0)+h-o;return c.setDate(c.getDate()-b),c.setHours(0,0,0,0),c}function ds(r){return wa(r,{weekStartsOn:1})}function Qu(r){const t=Ae(r),n=t.getFullYear(),o=Gt(r,0);o.setFullYear(n+1,0,4),o.setHours(0,0,0,0);const c=ds(o),h=Gt(r,0);h.setFullYear(n,0,4),h.setHours(0,0,0,0);const b=ds(h);return t.getTime()>=c.getTime()?n+1:t.getTime()>=b.getTime()?n:n-1}function Qs(r){const t=Ae(r);return t.setHours(0,0,0,0),t}function ui(r){const t=Ae(r),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+r-+n}function va(r,t){const n=Qs(r),o=Qs(t),c=+n-ui(n),h=+o-ui(o);return Math.round((c-h)/Hg)}function Gg(r){const t=Qu(r),n=Gt(r,0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),ds(n)}function gl(r,t){const n=t*7;return Et(r,n)}function Xg(r,t){return ua(r,t*12)}function Zg(r){let t;return r.forEach(function(n){const o=Ae(n);(t===void 0||t<o||isNaN(Number(o)))&&(t=o)}),t||new Date(NaN)}function ep(r){let t;return r.forEach(n=>{const o=Ae(n);(!t||t>o||isNaN(+o))&&(t=o)}),t||new Date(NaN)}function $t(r,t){const n=Qs(r),o=Qs(t);return+n==+o}function Nl(r){return r instanceof Date||typeof r=="object"&&Object.prototype.toString.call(r)==="[object Date]"}function tp(r){if(!Nl(r)&&typeof r!="number")return!1;const t=Ae(r);return!isNaN(Number(t))}function Kr(r,t){const n=Ae(r),o=Ae(t),c=n.getFullYear()-o.getFullYear(),h=n.getMonth()-o.getMonth();return c*12+h}function ap(r,t,n){const o=wa(r,n),c=wa(t,n),h=+o-ui(o),b=+c-ui(c);return Math.round((h-b)/wl)}function jl(r){const t=Ae(r),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function Ut(r){const t=Ae(r);return t.setDate(1),t.setHours(0,0,0,0),t}function Gu(r){const t=Ae(r),n=Gt(r,0);return n.setFullYear(t.getFullYear(),0,1),n.setHours(0,0,0,0),n}function Sl(r,t){var w,D,k,j;const n=Qr(),o=(t==null?void 0:t.weekStartsOn)??((D=(w=t==null?void 0:t.locale)==null?void 0:w.options)==null?void 0:D.weekStartsOn)??n.weekStartsOn??((j=(k=n.locale)==null?void 0:k.options)==null?void 0:j.weekStartsOn)??0,c=Ae(r),h=c.getDay(),b=(h<o?-7:0)+6-(h-o);return c.setDate(c.getDate()+b),c.setHours(23,59,59,999),c}function Xu(r){return Sl(r,{weekStartsOn:1})}const sp={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},rp=(r,t,n)=>{let o;const c=sp[r];return typeof c=="string"?o=c:t===1?o=c.one:o=c.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+o:o+" ago":o};function Ks(r){return(t={})=>{const n=t.width?String(t.width):r.defaultWidth;return r.formats[n]||r.formats[r.defaultWidth]}}const np={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},ip={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},op={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},lp={date:Ks({formats:np,defaultWidth:"full"}),time:Ks({formats:ip,defaultWidth:"full"}),dateTime:Ks({formats:op,defaultWidth:"full"})},cp={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},dp=(r,t,n,o)=>cp[r];function ya(r){return(t,n)=>{const o=n!=null&&n.context?String(n.context):"standalone";let c;if(o==="formatting"&&r.formattingValues){const b=r.defaultFormattingWidth||r.defaultWidth,w=n!=null&&n.width?String(n.width):b;c=r.formattingValues[w]||r.formattingValues[b]}else{const b=r.defaultWidth,w=n!=null&&n.width?String(n.width):r.defaultWidth;c=r.values[w]||r.values[b]}const h=r.argumentCallback?r.argumentCallback(t):t;return c[h]}}const up={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},mp={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},hp={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},fp={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},gp={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},pp={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},xp=(r,t)=>{const n=Number(r),o=n%100;if(o>20||o<10)switch(o%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},yp={ordinalNumber:xp,era:ya({values:up,defaultWidth:"wide"}),quarter:ya({values:mp,defaultWidth:"wide",argumentCallback:r=>r-1}),month:ya({values:hp,defaultWidth:"wide"}),day:ya({values:fp,defaultWidth:"wide"}),dayPeriod:ya({values:gp,defaultWidth:"wide",formattingValues:pp,defaultFormattingWidth:"wide"})};function ba(r){return(t,n={})=>{const o=n.width,c=o&&r.matchPatterns[o]||r.matchPatterns[r.defaultMatchWidth],h=t.match(c);if(!h)return null;const b=h[0],w=o&&r.parsePatterns[o]||r.parsePatterns[r.defaultParseWidth],D=Array.isArray(w)?vp(w,P=>P.test(b)):bp(w,P=>P.test(b));let k;k=r.valueCallback?r.valueCallback(D):D,k=n.valueCallback?n.valueCallback(k):k;const j=t.slice(b.length);return{value:k,rest:j}}}function bp(r,t){for(const n in r)if(Object.prototype.hasOwnProperty.call(r,n)&&t(r[n]))return n}function vp(r,t){for(let n=0;n<r.length;n++)if(t(r[n]))return n}function Zu(r){return(t,n={})=>{const o=t.match(r.matchPattern);if(!o)return null;const c=o[0],h=t.match(r.parsePattern);if(!h)return null;let b=r.valueCallback?r.valueCallback(h[0]):h[0];b=n.valueCallback?n.valueCallback(b):b;const w=t.slice(c.length);return{value:b,rest:w}}}const wp=/^(\d+)(th|st|nd|rd)?/i,Np=/\d+/i,jp={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Sp={any:[/^b/i,/^(a|c)/i]},Dp={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},kp={any:[/1/i,/2/i,/3/i,/4/i]},Cp={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Ip={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},_p={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Ap={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Tp={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Pp={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Op={ordinalNumber:Zu({matchPattern:wp,parsePattern:Np,valueCallback:r=>parseInt(r,10)}),era:ba({matchPatterns:jp,defaultMatchWidth:"wide",parsePatterns:Sp,defaultParseWidth:"any"}),quarter:ba({matchPatterns:Dp,defaultMatchWidth:"wide",parsePatterns:kp,defaultParseWidth:"any",valueCallback:r=>r+1}),month:ba({matchPatterns:Cp,defaultMatchWidth:"wide",parsePatterns:Ip,defaultParseWidth:"any"}),day:ba({matchPatterns:_p,defaultMatchWidth:"wide",parsePatterns:Ap,defaultParseWidth:"any"}),dayPeriod:ba({matchPatterns:Tp,defaultMatchWidth:"any",parsePatterns:Pp,defaultParseWidth:"any"})},em={code:"en-US",formatDistance:rp,formatLong:lp,formatRelative:dp,localize:yp,match:Op,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Ep(r){const t=Ae(r);return va(t,Gu(t))+1}function tm(r){const t=Ae(r),n=+ds(t)-+Gg(t);return Math.round(n/wl)+1}function am(r,t){var j,P,M,W;const n=Ae(r),o=n.getFullYear(),c=Qr(),h=(t==null?void 0:t.firstWeekContainsDate)??((P=(j=t==null?void 0:t.locale)==null?void 0:j.options)==null?void 0:P.firstWeekContainsDate)??c.firstWeekContainsDate??((W=(M=c.locale)==null?void 0:M.options)==null?void 0:W.firstWeekContainsDate)??1,b=Gt(r,0);b.setFullYear(o+1,0,h),b.setHours(0,0,0,0);const w=wa(b,t),D=Gt(r,0);D.setFullYear(o,0,h),D.setHours(0,0,0,0);const k=wa(D,t);return n.getTime()>=w.getTime()?o+1:n.getTime()>=k.getTime()?o:o-1}function Mp(r,t){var w,D,k,j;const n=Qr(),o=(t==null?void 0:t.firstWeekContainsDate)??((D=(w=t==null?void 0:t.locale)==null?void 0:w.options)==null?void 0:D.firstWeekContainsDate)??n.firstWeekContainsDate??((j=(k=n.locale)==null?void 0:k.options)==null?void 0:j.firstWeekContainsDate)??1,c=am(r,t),h=Gt(r,0);return h.setFullYear(c,0,o),h.setHours(0,0,0,0),wa(h,t)}function sm(r,t){const n=Ae(r),o=+wa(n,t)-+Mp(n,t);return Math.round(o/wl)+1}function Me(r,t){const n=r<0?"-":"",o=Math.abs(r).toString().padStart(t,"0");return n+o}const Ua={y(r,t){const n=r.getFullYear(),o=n>0?n:1-n;return Me(t==="yy"?o%100:o,t.length)},M(r,t){const n=r.getMonth();return t==="M"?String(n+1):Me(n+1,2)},d(r,t){return Me(r.getDate(),t.length)},a(r,t){const n=r.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(r,t){return Me(r.getHours()%12||12,t.length)},H(r,t){return Me(r.getHours(),t.length)},m(r,t){return Me(r.getMinutes(),t.length)},s(r,t){return Me(r.getSeconds(),t.length)},S(r,t){const n=t.length,o=r.getMilliseconds(),c=Math.trunc(o*Math.pow(10,n-3));return Me(c,t.length)}},Us={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},pu={G:function(r,t,n){const o=r.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(o,{width:"abbreviated"});case"GGGGG":return n.era(o,{width:"narrow"});case"GGGG":default:return n.era(o,{width:"wide"})}},y:function(r,t,n){if(t==="yo"){const o=r.getFullYear(),c=o>0?o:1-o;return n.ordinalNumber(c,{unit:"year"})}return Ua.y(r,t)},Y:function(r,t,n,o){const c=am(r,o),h=c>0?c:1-c;if(t==="YY"){const b=h%100;return Me(b,2)}return t==="Yo"?n.ordinalNumber(h,{unit:"year"}):Me(h,t.length)},R:function(r,t){const n=Qu(r);return Me(n,t.length)},u:function(r,t){const n=r.getFullYear();return Me(n,t.length)},Q:function(r,t,n){const o=Math.ceil((r.getMonth()+1)/3);switch(t){case"Q":return String(o);case"QQ":return Me(o,2);case"Qo":return n.ordinalNumber(o,{unit:"quarter"});case"QQQ":return n.quarter(o,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(o,{width:"wide",context:"formatting"})}},q:function(r,t,n){const o=Math.ceil((r.getMonth()+1)/3);switch(t){case"q":return String(o);case"qq":return Me(o,2);case"qo":return n.ordinalNumber(o,{unit:"quarter"});case"qqq":return n.quarter(o,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(o,{width:"wide",context:"standalone"})}},M:function(r,t,n){const o=r.getMonth();switch(t){case"M":case"MM":return Ua.M(r,t);case"Mo":return n.ordinalNumber(o+1,{unit:"month"});case"MMM":return n.month(o,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(o,{width:"wide",context:"formatting"})}},L:function(r,t,n){const o=r.getMonth();switch(t){case"L":return String(o+1);case"LL":return Me(o+1,2);case"Lo":return n.ordinalNumber(o+1,{unit:"month"});case"LLL":return n.month(o,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(o,{width:"wide",context:"standalone"})}},w:function(r,t,n,o){const c=sm(r,o);return t==="wo"?n.ordinalNumber(c,{unit:"week"}):Me(c,t.length)},I:function(r,t,n){const o=tm(r);return t==="Io"?n.ordinalNumber(o,{unit:"week"}):Me(o,t.length)},d:function(r,t,n){return t==="do"?n.ordinalNumber(r.getDate(),{unit:"date"}):Ua.d(r,t)},D:function(r,t,n){const o=Ep(r);return t==="Do"?n.ordinalNumber(o,{unit:"dayOfYear"}):Me(o,t.length)},E:function(r,t,n){const o=r.getDay();switch(t){case"E":case"EE":case"EEE":return n.day(o,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(o,{width:"short",context:"formatting"});case"EEEE":default:return n.day(o,{width:"wide",context:"formatting"})}},e:function(r,t,n,o){const c=r.getDay(),h=(c-o.weekStartsOn+8)%7||7;switch(t){case"e":return String(h);case"ee":return Me(h,2);case"eo":return n.ordinalNumber(h,{unit:"day"});case"eee":return n.day(c,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(c,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(c,{width:"short",context:"formatting"});case"eeee":default:return n.day(c,{width:"wide",context:"formatting"})}},c:function(r,t,n,o){const c=r.getDay(),h=(c-o.weekStartsOn+8)%7||7;switch(t){case"c":return String(h);case"cc":return Me(h,t.length);case"co":return n.ordinalNumber(h,{unit:"day"});case"ccc":return n.day(c,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(c,{width:"narrow",context:"standalone"});case"cccccc":return n.day(c,{width:"short",context:"standalone"});case"cccc":default:return n.day(c,{width:"wide",context:"standalone"})}},i:function(r,t,n){const o=r.getDay(),c=o===0?7:o;switch(t){case"i":return String(c);case"ii":return Me(c,t.length);case"io":return n.ordinalNumber(c,{unit:"day"});case"iii":return n.day(o,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(o,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(o,{width:"short",context:"formatting"});case"iiii":default:return n.day(o,{width:"wide",context:"formatting"})}},a:function(r,t,n){const c=r.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(c,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(c,{width:"wide",context:"formatting"})}},b:function(r,t,n){const o=r.getHours();let c;switch(o===12?c=Us.noon:o===0?c=Us.midnight:c=o/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(c,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(c,{width:"wide",context:"formatting"})}},B:function(r,t,n){const o=r.getHours();let c;switch(o>=17?c=Us.evening:o>=12?c=Us.afternoon:o>=4?c=Us.morning:c=Us.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(c,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(c,{width:"wide",context:"formatting"})}},h:function(r,t,n){if(t==="ho"){let o=r.getHours()%12;return o===0&&(o=12),n.ordinalNumber(o,{unit:"hour"})}return Ua.h(r,t)},H:function(r,t,n){return t==="Ho"?n.ordinalNumber(r.getHours(),{unit:"hour"}):Ua.H(r,t)},K:function(r,t,n){const o=r.getHours()%12;return t==="Ko"?n.ordinalNumber(o,{unit:"hour"}):Me(o,t.length)},k:function(r,t,n){let o=r.getHours();return o===0&&(o=24),t==="ko"?n.ordinalNumber(o,{unit:"hour"}):Me(o,t.length)},m:function(r,t,n){return t==="mo"?n.ordinalNumber(r.getMinutes(),{unit:"minute"}):Ua.m(r,t)},s:function(r,t,n){return t==="so"?n.ordinalNumber(r.getSeconds(),{unit:"second"}):Ua.s(r,t)},S:function(r,t){return Ua.S(r,t)},X:function(r,t,n){const o=r.getTimezoneOffset();if(o===0)return"Z";switch(t){case"X":return yu(o);case"XXXX":case"XX":return ls(o);case"XXXXX":case"XXX":default:return ls(o,":")}},x:function(r,t,n){const o=r.getTimezoneOffset();switch(t){case"x":return yu(o);case"xxxx":case"xx":return ls(o);case"xxxxx":case"xxx":default:return ls(o,":")}},O:function(r,t,n){const o=r.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+xu(o,":");case"OOOO":default:return"GMT"+ls(o,":")}},z:function(r,t,n){const o=r.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+xu(o,":");case"zzzz":default:return"GMT"+ls(o,":")}},t:function(r,t,n){const o=Math.trunc(r.getTime()/1e3);return Me(o,t.length)},T:function(r,t,n){const o=r.getTime();return Me(o,t.length)}};function xu(r,t=""){const n=r>0?"-":"+",o=Math.abs(r),c=Math.trunc(o/60),h=o%60;return h===0?n+String(c):n+String(c)+t+Me(h,2)}function yu(r,t){return r%60===0?(r>0?"-":"+")+Me(Math.abs(r)/60,2):ls(r,t)}function ls(r,t=""){const n=r>0?"-":"+",o=Math.abs(r),c=Me(Math.trunc(o/60),2),h=Me(o%60,2);return n+c+t+h}const bu=(r,t)=>{switch(r){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},rm=(r,t)=>{switch(r){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Wp=(r,t)=>{const n=r.match(/(P+)(p+)?/)||[],o=n[1],c=n[2];if(!c)return bu(r,t);let h;switch(o){case"P":h=t.dateTime({width:"short"});break;case"PP":h=t.dateTime({width:"medium"});break;case"PPP":h=t.dateTime({width:"long"});break;case"PPPP":default:h=t.dateTime({width:"full"});break}return h.replace("{{date}}",bu(o,t)).replace("{{time}}",rm(c,t))},Rp={p:rm,P:Wp},Lp=/^D+$/,Fp=/^Y+$/,Bp=["D","DD","YY","YYYY"];function $p(r){return Lp.test(r)}function Up(r){return Fp.test(r)}function Vp(r,t,n){const o=qp(r,t,n);if(console.warn(o),Bp.includes(r))throw new RangeError(o)}function qp(r,t,n){const o=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${t}\`) for formatting ${o} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const zp=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Yp=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Kp=/^'([^]*?)'?$/,Jp=/''/g,Hp=/[a-zA-Z]/;function da(r,t,n){var j,P,M,W,x,te,U,de;const o=Qr(),c=(n==null?void 0:n.locale)??o.locale??em,h=(n==null?void 0:n.firstWeekContainsDate)??((P=(j=n==null?void 0:n.locale)==null?void 0:j.options)==null?void 0:P.firstWeekContainsDate)??o.firstWeekContainsDate??((W=(M=o.locale)==null?void 0:M.options)==null?void 0:W.firstWeekContainsDate)??1,b=(n==null?void 0:n.weekStartsOn)??((te=(x=n==null?void 0:n.locale)==null?void 0:x.options)==null?void 0:te.weekStartsOn)??o.weekStartsOn??((de=(U=o.locale)==null?void 0:U.options)==null?void 0:de.weekStartsOn)??0,w=Ae(r);if(!tp(w))throw new RangeError("Invalid time value");let D=t.match(Yp).map(F=>{const H=F[0];if(H==="p"||H==="P"){const se=Rp[H];return se(F,c.formatLong)}return F}).join("").match(zp).map(F=>{if(F==="''")return{isToken:!1,value:"'"};const H=F[0];if(H==="'")return{isToken:!1,value:Qp(F)};if(pu[H])return{isToken:!0,value:F};if(H.match(Hp))throw new RangeError("Format string contains an unescaped latin alphabet character `"+H+"`");return{isToken:!1,value:F}});c.localize.preprocessor&&(D=c.localize.preprocessor(w,D));const k={firstWeekContainsDate:h,weekStartsOn:b,locale:c};return D.map(F=>{if(!F.isToken)return F.value;const H=F.value;(!(n!=null&&n.useAdditionalWeekYearTokens)&&Up(H)||!(n!=null&&n.useAdditionalDayOfYearTokens)&&$p(H))&&Vp(H,t,String(r));const se=pu[H[0]];return se(w,H,c.localize,k)}).join("")}function Qp(r){const t=r.match(Kp);return t?t[1].replace(Jp,"'"):r}function Gp(r){const t=Ae(r),n=t.getFullYear(),o=t.getMonth(),c=Gt(r,0);return c.setFullYear(n,o+1,0),c.setHours(0,0,0,0),c.getDate()}function Xp(r){return Math.trunc(+Ae(r)/1e3)}function Zp(r){const t=Ae(r),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(0,0,0,0),t}function ex(r,t){return ap(Zp(r),Ut(r),t)+1}function pl(r,t){const n=Ae(r),o=Ae(t);return n.getTime()>o.getTime()}function nm(r,t){const n=Ae(r),o=Ae(t);return+n<+o}function Dl(r,t){const n=Ae(r),o=Ae(t);return n.getFullYear()===o.getFullYear()&&n.getMonth()===o.getMonth()}function tx(r,t){const n=Ae(r),o=Ae(t);return n.getFullYear()===o.getFullYear()}function ll(r,t){return Et(r,-t)}function cl(r,t){const n=Ae(r),o=n.getFullYear(),c=n.getDate(),h=Gt(r,0);h.setFullYear(o,t,15),h.setHours(0,0,0,0);const b=Gp(h);return n.setMonth(t,Math.min(c,b)),n}function vu(r,t){const n=Ae(r);return isNaN(+n)?Gt(r,NaN):(n.setFullYear(t),n)}const ax={lessThanXSeconds:{one:"أقل من ثانية",two:"أقل من ثانيتين",threeToTen:"أقل من {{count}} ثواني",other:"أقل من {{count}} ثانية"},xSeconds:{one:"ثانية واحدة",two:"ثانيتان",threeToTen:"{{count}} ثواني",other:"{{count}} ثانية"},halfAMinute:"نصف دقيقة",lessThanXMinutes:{one:"أقل من دقيقة",two:"أقل من دقيقتين",threeToTen:"أقل من {{count}} دقائق",other:"أقل من {{count}} دقيقة"},xMinutes:{one:"دقيقة واحدة",two:"دقيقتان",threeToTen:"{{count}} دقائق",other:"{{count}} دقيقة"},aboutXHours:{one:"ساعة واحدة تقريباً",two:"ساعتين تقريبا",threeToTen:"{{count}} ساعات تقريباً",other:"{{count}} ساعة تقريباً"},xHours:{one:"ساعة واحدة",two:"ساعتان",threeToTen:"{{count}} ساعات",other:"{{count}} ساعة"},xDays:{one:"يوم واحد",two:"يومان",threeToTen:"{{count}} أيام",other:"{{count}} يوم"},aboutXWeeks:{one:"أسبوع واحد تقريبا",two:"أسبوعين تقريبا",threeToTen:"{{count}} أسابيع تقريبا",other:"{{count}} أسبوعا تقريبا"},xWeeks:{one:"أسبوع واحد",two:"أسبوعان",threeToTen:"{{count}} أسابيع",other:"{{count}} أسبوعا"},aboutXMonths:{one:"شهر واحد تقريباً",two:"شهرين تقريبا",threeToTen:"{{count}} أشهر تقريبا",other:"{{count}} شهرا تقريباً"},xMonths:{one:"شهر واحد",two:"شهران",threeToTen:"{{count}} أشهر",other:"{{count}} شهرا"},aboutXYears:{one:"سنة واحدة تقريباً",two:"سنتين تقريبا",threeToTen:"{{count}} سنوات تقريباً",other:"{{count}} سنة تقريباً"},xYears:{one:"سنة واحد",two:"سنتان",threeToTen:"{{count}} سنوات",other:"{{count}} سنة"},overXYears:{one:"أكثر من سنة",two:"أكثر من سنتين",threeToTen:"أكثر من {{count}} سنوات",other:"أكثر من {{count}} سنة"},almostXYears:{one:"ما يقارب سنة واحدة",two:"ما يقارب سنتين",threeToTen:"ما يقارب {{count}} سنوات",other:"ما يقارب {{count}} سنة"}},sx=(r,t,n)=>{const o=ax[r];let c;return typeof o=="string"?c=o:t===1?c=o.one:t===2?c=o.two:t<=10?c=o.threeToTen.replace("{{count}}",String(t)):c=o.other.replace("{{count}}",String(t)),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"خلال "+c:"منذ "+c:c},rx={full:"EEEE، do MMMM y",long:"do MMMM y",medium:"d MMM y",short:"dd/MM/yyyy"},nx={full:"HH:mm:ss",long:"HH:mm:ss",medium:"HH:mm:ss",short:"HH:mm"},ix={full:"{{date}} 'عند الساعة' {{time}}",long:"{{date}} 'عند الساعة' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ox={date:Ks({formats:rx,defaultWidth:"full"}),time:Ks({formats:nx,defaultWidth:"full"}),dateTime:Ks({formats:ix,defaultWidth:"full"})},lx={lastWeek:"eeee 'الماضي عند الساعة' p",yesterday:"'الأمس عند الساعة' p",today:"'اليوم عند الساعة' p",tomorrow:"'غدا عند الساعة' p",nextWeek:"eeee 'القادم عند الساعة' p",other:"P"},cx=r=>lx[r],dx={narrow:["ق","ب"],abbreviated:["ق.م.","ب.م."],wide:["قبل الميلاد","بعد الميلاد"]},ux={narrow:["1","2","3","4"],abbreviated:["ر1","ر2","ر3","ر4"],wide:["الربع الأول","الربع الثاني","الربع الثالث","الربع الرابع"]},mx={narrow:["ي","ف","م","أ","م","ي","ي","أ","س","أ","ن","د"],abbreviated:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],wide:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"]},hx={narrow:["ح","ن","ث","ر","خ","ج","س"],short:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],abbreviated:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],wide:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"]},fx={narrow:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"},abbreviated:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"},wide:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"}},gx={narrow:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"},abbreviated:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"},wide:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"}},px=r=>String(r),xx={ordinalNumber:px,era:ya({values:dx,defaultWidth:"wide"}),quarter:ya({values:ux,defaultWidth:"wide",argumentCallback:r=>r-1}),month:ya({values:mx,defaultWidth:"wide"}),day:ya({values:hx,defaultWidth:"wide"}),dayPeriod:ya({values:fx,defaultWidth:"wide",formattingValues:gx,defaultFormattingWidth:"wide"})},yx=/^(\d+)(th|st|nd|rd)?/i,bx=/\d+/i,vx={narrow:/[قب]/,abbreviated:/[قب]\.م\./,wide:/(قبل|بعد) الميلاد/},wx={any:[/قبل/,/بعد/]},Nx={narrow:/^[1234]/i,abbreviated:/ر[1234]/,wide:/الربع (الأول|الثاني|الثالث|الرابع)/},jx={any:[/1/i,/2/i,/3/i,/4/i]},Sx={narrow:/^[أيفمسند]/,abbreviated:/^(يناير|فبراير|مارس|أبريل|مايو|يونيو|يوليو|أغسطس|سبتمبر|أكتوبر|نوفمبر|ديسمبر)/,wide:/^(يناير|فبراير|مارس|أبريل|مايو|يونيو|يوليو|أغسطس|سبتمبر|أكتوبر|نوفمبر|ديسمبر)/},Dx={narrow:[/^ي/i,/^ف/i,/^م/i,/^أ/i,/^م/i,/^ي/i,/^ي/i,/^أ/i,/^س/i,/^أ/i,/^ن/i,/^د/i],any:[/^يناير/i,/^فبراير/i,/^مارس/i,/^أبريل/i,/^مايو/i,/^يونيو/i,/^يوليو/i,/^أغسطس/i,/^سبتمبر/i,/^أكتوبر/i,/^نوفمبر/i,/^ديسمبر/i]},kx={narrow:/^[حنثرخجس]/i,short:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,abbreviated:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,wide:/^(الأحد|الاثنين|الثلاثاء|الأربعاء|الخميس|الجمعة|السبت)/i},Cx={narrow:[/^ح/i,/^ن/i,/^ث/i,/^ر/i,/^خ/i,/^ج/i,/^س/i],wide:[/^الأحد/i,/^الاثنين/i,/^الثلاثاء/i,/^الأربعاء/i,/^الخميس/i,/^الجمعة/i,/^السبت/i],any:[/^أح/i,/^اث/i,/^ث/i,/^أر/i,/^خ/i,/^ج/i,/^س/i]},Ix={narrow:/^(ص|م|منتصف الليل|الظهر|بعد الظهر|في الصباح|في المساء|في الليل)/,any:/^(ص|م|منتصف الليل|الظهر|بعد الظهر|في الصباح|في المساء|في الليل)/},_x={any:{am:/^ص/,pm:/^م/,midnight:/منتصف الليل/,noon:/الظهر/,afternoon:/بعد الظهر/,morning:/في الصباح/,evening:/في المساء/,night:/في الليل/}},Ax={ordinalNumber:Zu({matchPattern:yx,parsePattern:bx,valueCallback:r=>parseInt(r,10)}),era:ba({matchPatterns:vx,defaultMatchWidth:"wide",parsePatterns:wx,defaultParseWidth:"any"}),quarter:ba({matchPatterns:Nx,defaultMatchWidth:"wide",parsePatterns:jx,defaultParseWidth:"any",valueCallback:r=>r+1}),month:ba({matchPatterns:Sx,defaultMatchWidth:"wide",parsePatterns:Dx,defaultParseWidth:"any"}),day:ba({matchPatterns:kx,defaultMatchWidth:"wide",parsePatterns:Cx,defaultParseWidth:"any"}),dayPeriod:ba({matchPatterns:Ix,defaultMatchWidth:"any",parsePatterns:_x,defaultParseWidth:"any"})},wu={code:"ar",formatDistance:sx,formatLong:ox,formatRelative:cx,localize:xx,match:Ax,options:{weekStartsOn:6,firstWeekContainsDate:1}};var le=function(){return le=Object.assign||function(t){for(var n,o=1,c=arguments.length;o<c;o++){n=arguments[o];for(var h in n)Object.prototype.hasOwnProperty.call(n,h)&&(t[h]=n[h])}return t},le.apply(this,arguments)};function Tx(r,t){var n={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&t.indexOf(o)<0&&(n[o]=r[o]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,o=Object.getOwnPropertySymbols(r);c<o.length;c++)t.indexOf(o[c])<0&&Object.prototype.propertyIsEnumerable.call(r,o[c])&&(n[o[c]]=r[o[c]]);return n}function im(r,t,n){for(var o=0,c=t.length,h;o<c;o++)(h||!(o in t))&&(h||(h=Array.prototype.slice.call(t,0,o)),h[o]=t[o]);return r.concat(h||Array.prototype.slice.call(t))}function Gr(r){return r.mode==="multiple"}function Xr(r){return r.mode==="range"}function fi(r){return r.mode==="single"}var Px={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function Ox(r,t){return da(r,"LLLL y",t)}function Ex(r,t){return da(r,"d",t)}function Mx(r,t){return da(r,"LLLL",t)}function Wx(r){return"".concat(r)}function Rx(r,t){return da(r,"cccccc",t)}function Lx(r,t){return da(r,"yyyy",t)}var Fx=Object.freeze({__proto__:null,formatCaption:Ox,formatDay:Ex,formatMonthCaption:Mx,formatWeekNumber:Wx,formatWeekdayName:Rx,formatYearCaption:Lx}),Bx=function(r,t,n){return da(r,"do MMMM (EEEE)",n)},$x=function(){return"Month: "},Ux=function(){return"Go to next month"},Vx=function(){return"Go to previous month"},qx=function(r,t){return da(r,"cccc",t)},zx=function(r){return"Week n. ".concat(r)},Yx=function(){return"Year: "},Kx=Object.freeze({__proto__:null,labelDay:Bx,labelMonthDropdown:$x,labelNext:Ux,labelPrevious:Vx,labelWeekNumber:zx,labelWeekday:qx,labelYearDropdown:Yx});function Jx(){var r="buttons",t=Px,n=em,o={},c={},h=1,b={},w=new Date;return{captionLayout:r,classNames:t,formatters:Fx,labels:Kx,locale:n,modifiersClassNames:o,modifiers:c,numberOfMonths:h,styles:b,today:w,mode:"default"}}function Hx(r){var t=r.fromYear,n=r.toYear,o=r.fromMonth,c=r.toMonth,h=r.fromDate,b=r.toDate;return o?h=Ut(o):t&&(h=new Date(t,0,1)),c?b=jl(c):n&&(b=new Date(n,11,31)),{fromDate:h?Qs(h):void 0,toDate:b?Qs(b):void 0}}var om=u.createContext(void 0);function Qx(r){var t,n=r.initialProps,o=Jx(),c=Hx(n),h=c.fromDate,b=c.toDate,w=(t=n.captionLayout)!==null&&t!==void 0?t:o.captionLayout;w!=="buttons"&&(!h||!b)&&(w="buttons");var D;(fi(n)||Gr(n)||Xr(n))&&(D=n.onSelect);var k=le(le(le({},o),n),{captionLayout:w,classNames:le(le({},o.classNames),n.classNames),components:le({},n.components),formatters:le(le({},o.formatters),n.formatters),fromDate:h,labels:le(le({},o.labels),n.labels),mode:n.mode||o.mode,modifiers:le(le({},o.modifiers),n.modifiers),modifiersClassNames:le(le({},o.modifiersClassNames),n.modifiersClassNames),onSelect:D,styles:le(le({},o.styles),n.styles),toDate:b});return e.jsx(om.Provider,{value:k,children:r.children})}function Re(){var r=u.useContext(om);if(!r)throw new Error("useDayPicker must be used within a DayPickerProvider.");return r}function lm(r){var t=Re(),n=t.locale,o=t.classNames,c=t.styles,h=t.formatters.formatCaption;return e.jsx("div",{className:o.caption_label,style:c.caption_label,"aria-live":"polite",role:"presentation",id:r.id,children:h(r.displayMonth,{locale:n})})}function Gx(r){return e.jsx("svg",le({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},r,{children:e.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function cm(r){var t,n,o=r.onChange,c=r.value,h=r.children,b=r.caption,w=r.className,D=r.style,k=Re(),j=(n=(t=k.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&n!==void 0?n:Gx;return e.jsxs("div",{className:w,style:D,children:[e.jsx("span",{className:k.classNames.vhidden,children:r["aria-label"]}),e.jsx("select",{name:r.name,"aria-label":r["aria-label"],className:k.classNames.dropdown,style:k.styles.dropdown,value:c,onChange:o,children:h}),e.jsxs("div",{className:k.classNames.caption_label,style:k.styles.caption_label,"aria-hidden":"true",children:[b,e.jsx(j,{className:k.classNames.dropdown_icon,style:k.styles.dropdown_icon})]})]})}function Xx(r){var t,n=Re(),o=n.fromDate,c=n.toDate,h=n.styles,b=n.locale,w=n.formatters.formatMonthCaption,D=n.classNames,k=n.components,j=n.labels.labelMonthDropdown;if(!o)return e.jsx(e.Fragment,{});if(!c)return e.jsx(e.Fragment,{});var P=[];if(tx(o,c))for(var M=Ut(o),W=o.getMonth();W<=c.getMonth();W++)P.push(cl(M,W));else for(var M=Ut(new Date),W=0;W<=11;W++)P.push(cl(M,W));var x=function(U){var de=Number(U.target.value),F=cl(Ut(r.displayMonth),de);r.onChange(F)},te=(t=k==null?void 0:k.Dropdown)!==null&&t!==void 0?t:cm;return e.jsx(te,{name:"months","aria-label":j(),className:D.dropdown_month,style:h.dropdown_month,onChange:x,value:r.displayMonth.getMonth(),caption:w(r.displayMonth,{locale:b}),children:P.map(function(U){return e.jsx("option",{value:U.getMonth(),children:w(U,{locale:b})},U.getMonth())})})}function Zx(r){var t,n=r.displayMonth,o=Re(),c=o.fromDate,h=o.toDate,b=o.locale,w=o.styles,D=o.classNames,k=o.components,j=o.formatters.formatYearCaption,P=o.labels.labelYearDropdown,M=[];if(!c)return e.jsx(e.Fragment,{});if(!h)return e.jsx(e.Fragment,{});for(var W=c.getFullYear(),x=h.getFullYear(),te=W;te<=x;te++)M.push(vu(Gu(new Date),te));var U=function(F){var H=vu(Ut(n),Number(F.target.value));r.onChange(H)},de=(t=k==null?void 0:k.Dropdown)!==null&&t!==void 0?t:cm;return e.jsx(de,{name:"years","aria-label":P(),className:D.dropdown_year,style:w.dropdown_year,onChange:U,value:n.getFullYear(),caption:j(n,{locale:b}),children:M.map(function(F){return e.jsx("option",{value:F.getFullYear(),children:j(F,{locale:b})},F.getFullYear())})})}function ey(r,t){var n=u.useState(r),o=n[0],c=n[1],h=t===void 0?o:t;return[h,c]}function ty(r){var t=r.month,n=r.defaultMonth,o=r.today,c=t||n||o||new Date,h=r.toDate,b=r.fromDate,w=r.numberOfMonths,D=w===void 0?1:w;if(h&&Kr(h,c)<0){var k=-1*(D-1);c=ua(h,k)}return b&&Kr(c,b)<0&&(c=b),Ut(c)}function ay(){var r=Re(),t=ty(r),n=ey(t,r.month),o=n[0],c=n[1],h=function(b){var w;if(!r.disableNavigation){var D=Ut(b);c(D),(w=r.onMonthChange)===null||w===void 0||w.call(r,D)}};return[o,h]}function sy(r,t){for(var n=t.reverseMonths,o=t.numberOfMonths,c=Ut(r),h=Ut(ua(c,o)),b=Kr(h,c),w=[],D=0;D<b;D++){var k=ua(c,D);w.push(k)}return n&&(w=w.reverse()),w}function ry(r,t){if(!t.disableNavigation){var n=t.toDate,o=t.pagedNavigation,c=t.numberOfMonths,h=c===void 0?1:c,b=o?h:1,w=Ut(r);if(!n)return ua(w,b);var D=Kr(n,r);if(!(D<h))return ua(w,b)}}function ny(r,t){if(!t.disableNavigation){var n=t.fromDate,o=t.pagedNavigation,c=t.numberOfMonths,h=c===void 0?1:c,b=o?h:1,w=Ut(r);if(!n)return ua(w,-b);var D=Kr(w,n);if(!(D<=0))return ua(w,-b)}}var dm=u.createContext(void 0);function iy(r){var t=Re(),n=ay(),o=n[0],c=n[1],h=sy(o,t),b=ry(o,t),w=ny(o,t),D=function(P){return h.some(function(M){return Dl(P,M)})},k=function(P,M){D(P)||(M&&nm(P,M)?c(ua(P,1+t.numberOfMonths*-1)):c(P))},j={currentMonth:o,displayMonths:h,goToMonth:c,goToDate:k,previousMonth:w,nextMonth:b,isDateDisplayed:D};return e.jsx(dm.Provider,{value:j,children:r.children})}function Zr(){var r=u.useContext(dm);if(!r)throw new Error("useNavigation must be used within a NavigationProvider");return r}function Nu(r){var t,n=Re(),o=n.classNames,c=n.styles,h=n.components,b=Zr().goToMonth,w=function(j){b(ua(j,r.displayIndex?-r.displayIndex:0))},D=(t=h==null?void 0:h.CaptionLabel)!==null&&t!==void 0?t:lm,k=e.jsx(D,{id:r.id,displayMonth:r.displayMonth});return e.jsxs("div",{className:o.caption_dropdowns,style:c.caption_dropdowns,children:[e.jsx("div",{className:o.vhidden,children:k}),e.jsx(Xx,{onChange:w,displayMonth:r.displayMonth}),e.jsx(Zx,{onChange:w,displayMonth:r.displayMonth})]})}function oy(r){return e.jsx("svg",le({width:"16px",height:"16px",viewBox:"0 0 120 120"},r,{children:e.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function ly(r){return e.jsx("svg",le({width:"16px",height:"16px",viewBox:"0 0 120 120"},r,{children:e.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var mi=u.forwardRef(function(r,t){var n=Re(),o=n.classNames,c=n.styles,h=[o.button_reset,o.button];r.className&&h.push(r.className);var b=h.join(" "),w=le(le({},c.button_reset),c.button);return r.style&&Object.assign(w,r.style),e.jsx("button",le({},r,{ref:t,type:"button",className:b,style:w}))});function cy(r){var t,n,o=Re(),c=o.dir,h=o.locale,b=o.classNames,w=o.styles,D=o.labels,k=D.labelPrevious,j=D.labelNext,P=o.components;if(!r.nextMonth&&!r.previousMonth)return e.jsx(e.Fragment,{});var M=k(r.previousMonth,{locale:h}),W=[b.nav_button,b.nav_button_previous].join(" "),x=j(r.nextMonth,{locale:h}),te=[b.nav_button,b.nav_button_next].join(" "),U=(t=P==null?void 0:P.IconRight)!==null&&t!==void 0?t:ly,de=(n=P==null?void 0:P.IconLeft)!==null&&n!==void 0?n:oy;return e.jsxs("div",{className:b.nav,style:w.nav,children:[!r.hidePrevious&&e.jsx(mi,{name:"previous-month","aria-label":M,className:W,style:w.nav_button_previous,disabled:!r.previousMonth,onClick:r.onPreviousClick,children:c==="rtl"?e.jsx(U,{className:b.nav_icon,style:w.nav_icon}):e.jsx(de,{className:b.nav_icon,style:w.nav_icon})}),!r.hideNext&&e.jsx(mi,{name:"next-month","aria-label":x,className:te,style:w.nav_button_next,disabled:!r.nextMonth,onClick:r.onNextClick,children:c==="rtl"?e.jsx(de,{className:b.nav_icon,style:w.nav_icon}):e.jsx(U,{className:b.nav_icon,style:w.nav_icon})})]})}function ju(r){var t=Re().numberOfMonths,n=Zr(),o=n.previousMonth,c=n.nextMonth,h=n.goToMonth,b=n.displayMonths,w=b.findIndex(function(x){return Dl(r.displayMonth,x)}),D=w===0,k=w===b.length-1,j=t>1&&(D||!k),P=t>1&&(k||!D),M=function(){o&&h(o)},W=function(){c&&h(c)};return e.jsx(cy,{displayMonth:r.displayMonth,hideNext:j,hidePrevious:P,nextMonth:c,previousMonth:o,onPreviousClick:M,onNextClick:W})}function dy(r){var t,n=Re(),o=n.classNames,c=n.disableNavigation,h=n.styles,b=n.captionLayout,w=n.components,D=(t=w==null?void 0:w.CaptionLabel)!==null&&t!==void 0?t:lm,k;return c?k=e.jsx(D,{id:r.id,displayMonth:r.displayMonth}):b==="dropdown"?k=e.jsx(Nu,{displayMonth:r.displayMonth,id:r.id}):b==="dropdown-buttons"?k=e.jsxs(e.Fragment,{children:[e.jsx(Nu,{displayMonth:r.displayMonth,displayIndex:r.displayIndex,id:r.id}),e.jsx(ju,{displayMonth:r.displayMonth,displayIndex:r.displayIndex,id:r.id})]}):k=e.jsxs(e.Fragment,{children:[e.jsx(D,{id:r.id,displayMonth:r.displayMonth,displayIndex:r.displayIndex}),e.jsx(ju,{displayMonth:r.displayMonth,id:r.id})]}),e.jsx("div",{className:o.caption,style:h.caption,children:k})}function uy(r){var t=Re(),n=t.footer,o=t.styles,c=t.classNames.tfoot;return n?e.jsx("tfoot",{className:c,style:o.tfoot,children:e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:n})})}):e.jsx(e.Fragment,{})}function my(r,t,n){for(var o=n?ds(new Date):wa(new Date,{locale:r,weekStartsOn:t}),c=[],h=0;h<7;h++){var b=Et(o,h);c.push(b)}return c}function hy(){var r=Re(),t=r.classNames,n=r.styles,o=r.showWeekNumber,c=r.locale,h=r.weekStartsOn,b=r.ISOWeek,w=r.formatters.formatWeekdayName,D=r.labels.labelWeekday,k=my(c,h,b);return e.jsxs("tr",{style:n.head_row,className:t.head_row,children:[o&&e.jsx("td",{style:n.head_cell,className:t.head_cell}),k.map(function(j,P){return e.jsx("th",{scope:"col",className:t.head_cell,style:n.head_cell,"aria-label":D(j,{locale:c}),children:w(j,{locale:c})},P)})]})}function fy(){var r,t=Re(),n=t.classNames,o=t.styles,c=t.components,h=(r=c==null?void 0:c.HeadRow)!==null&&r!==void 0?r:hy;return e.jsx("thead",{style:o.head,className:n.head,children:e.jsx(h,{})})}function gy(r){var t=Re(),n=t.locale,o=t.formatters.formatDay;return e.jsx(e.Fragment,{children:o(r.date,{locale:n})})}var kl=u.createContext(void 0);function py(r){if(!Gr(r.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return e.jsx(kl.Provider,{value:t,children:r.children})}return e.jsx(xy,{initialProps:r.initialProps,children:r.children})}function xy(r){var t=r.initialProps,n=r.children,o=t.selected,c=t.min,h=t.max,b=function(k,j,P){var M,W;(M=t.onDayClick)===null||M===void 0||M.call(t,k,j,P);var x=!!(j.selected&&c&&(o==null?void 0:o.length)===c);if(!x){var te=!!(!j.selected&&h&&(o==null?void 0:o.length)===h);if(!te){var U=o?im([],o):[];if(j.selected){var de=U.findIndex(function(F){return $t(k,F)});U.splice(de,1)}else U.push(k);(W=t.onSelect)===null||W===void 0||W.call(t,U,k,j,P)}}},w={disabled:[]};o&&w.disabled.push(function(k){var j=h&&o.length>h-1,P=o.some(function(M){return $t(M,k)});return!!(j&&!P)});var D={selected:o,onDayClick:b,modifiers:w};return e.jsx(kl.Provider,{value:D,children:n})}function Cl(){var r=u.useContext(kl);if(!r)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return r}function yy(r,t){var n=t||{},o=n.from,c=n.to;return o&&c?$t(c,r)&&$t(o,r)?void 0:$t(c,r)?{from:c,to:void 0}:$t(o,r)?void 0:pl(o,r)?{from:r,to:c}:{from:o,to:r}:c?pl(r,c)?{from:c,to:r}:{from:r,to:c}:o?nm(r,o)?{from:r,to:o}:{from:o,to:r}:{from:r,to:void 0}}var Il=u.createContext(void 0);function by(r){if(!Xr(r.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return e.jsx(Il.Provider,{value:t,children:r.children})}return e.jsx(vy,{initialProps:r.initialProps,children:r.children})}function vy(r){var t=r.initialProps,n=r.children,o=t.selected,c=o||{},h=c.from,b=c.to,w=t.min,D=t.max,k=function(W,x,te){var U,de;(U=t.onDayClick)===null||U===void 0||U.call(t,W,x,te);var F=yy(W,o);(de=t.onSelect)===null||de===void 0||de.call(t,F,W,x,te)},j={range_start:[],range_end:[],range_middle:[],disabled:[]};if(h?(j.range_start=[h],b?(j.range_end=[b],$t(h,b)||(j.range_middle=[{after:h,before:b}])):j.range_end=[h]):b&&(j.range_start=[b],j.range_end=[b]),w&&(h&&!b&&j.disabled.push({after:ll(h,w-1),before:Et(h,w-1)}),h&&b&&j.disabled.push({after:h,before:Et(h,w-1)}),!h&&b&&j.disabled.push({after:ll(b,w-1),before:Et(b,w-1)})),D){if(h&&!b&&(j.disabled.push({before:Et(h,-D+1)}),j.disabled.push({after:Et(h,D-1)})),h&&b){var P=va(b,h)+1,M=D-P;j.disabled.push({before:ll(h,M)}),j.disabled.push({after:Et(b,M)})}!h&&b&&(j.disabled.push({before:Et(b,-D+1)}),j.disabled.push({after:Et(b,D-1)}))}return e.jsx(Il.Provider,{value:{selected:o,onDayClick:k,modifiers:j},children:n})}function _l(){var r=u.useContext(Il);if(!r)throw new Error("useSelectRange must be used within a SelectRangeProvider");return r}function ci(r){return Array.isArray(r)?im([],r):r!==void 0?[r]:[]}function wy(r){var t={};return Object.entries(r).forEach(function(n){var o=n[0],c=n[1];t[o]=ci(c)}),t}var ma;(function(r){r.Outside="outside",r.Disabled="disabled",r.Selected="selected",r.Hidden="hidden",r.Today="today",r.RangeStart="range_start",r.RangeEnd="range_end",r.RangeMiddle="range_middle"})(ma||(ma={}));var Ny=ma.Selected,Ta=ma.Disabled,jy=ma.Hidden,Sy=ma.Today,dl=ma.RangeEnd,ul=ma.RangeMiddle,ml=ma.RangeStart,Dy=ma.Outside;function ky(r,t,n){var o,c=(o={},o[Ny]=ci(r.selected),o[Ta]=ci(r.disabled),o[jy]=ci(r.hidden),o[Sy]=[r.today],o[dl]=[],o[ul]=[],o[ml]=[],o[Dy]=[],o);return r.fromDate&&c[Ta].push({before:r.fromDate}),r.toDate&&c[Ta].push({after:r.toDate}),Gr(r)?c[Ta]=c[Ta].concat(t.modifiers[Ta]):Xr(r)&&(c[Ta]=c[Ta].concat(n.modifiers[Ta]),c[ml]=n.modifiers[ml],c[ul]=n.modifiers[ul],c[dl]=n.modifiers[dl]),c}var um=u.createContext(void 0);function Cy(r){var t=Re(),n=Cl(),o=_l(),c=ky(t,n,o),h=wy(t.modifiers),b=le(le({},c),h);return e.jsx(um.Provider,{value:b,children:r.children})}function mm(){var r=u.useContext(um);if(!r)throw new Error("useModifiers must be used within a ModifiersProvider");return r}function Iy(r){return!!(r&&typeof r=="object"&&"before"in r&&"after"in r)}function _y(r){return!!(r&&typeof r=="object"&&"from"in r)}function Ay(r){return!!(r&&typeof r=="object"&&"after"in r)}function Ty(r){return!!(r&&typeof r=="object"&&"before"in r)}function Py(r){return!!(r&&typeof r=="object"&&"dayOfWeek"in r)}function Oy(r,t){var n,o=t.from,c=t.to;if(o&&c){var h=va(c,o)<0;h&&(n=[c,o],o=n[0],c=n[1]);var b=va(r,o)>=0&&va(c,r)>=0;return b}return c?$t(c,r):o?$t(o,r):!1}function Ey(r){return Nl(r)}function My(r){return Array.isArray(r)&&r.every(Nl)}function Wy(r,t){return t.some(function(n){if(typeof n=="boolean")return n;if(Ey(n))return $t(r,n);if(My(n))return n.includes(r);if(_y(n))return Oy(r,n);if(Py(n))return n.dayOfWeek.includes(r.getDay());if(Iy(n)){var o=va(n.before,r),c=va(n.after,r),h=o>0,b=c<0,w=pl(n.before,n.after);return w?b&&h:h||b}return Ay(n)?va(r,n.after)>0:Ty(n)?va(n.before,r)>0:typeof n=="function"?n(r):!1})}function Al(r,t,n){var o=Object.keys(t).reduce(function(h,b){var w=t[b];return Wy(r,w)&&h.push(b),h},[]),c={};return o.forEach(function(h){return c[h]=!0}),n&&!Dl(r,n)&&(c.outside=!0),c}function Ry(r,t){for(var n=Ut(r[0]),o=jl(r[r.length-1]),c,h,b=n;b<=o;){var w=Al(b,t),D=!w.disabled&&!w.hidden;if(!D){b=Et(b,1);continue}if(w.selected)return b;w.today&&!h&&(h=b),c||(c=b),b=Et(b,1)}return h||c}var Ly=365;function hm(r,t){var n=t.moveBy,o=t.direction,c=t.context,h=t.modifiers,b=t.retry,w=b===void 0?{count:0,lastFocused:r}:b,D=c.weekStartsOn,k=c.fromDate,j=c.toDate,P=c.locale,M={day:Et,week:gl,month:ua,year:Xg,startOfWeek:function(U){return c.ISOWeek?ds(U):wa(U,{locale:P,weekStartsOn:D})},endOfWeek:function(U){return c.ISOWeek?Xu(U):Sl(U,{locale:P,weekStartsOn:D})}},W=M[n](r,o==="after"?1:-1);o==="before"&&k?W=Zg([k,W]):o==="after"&&j&&(W=ep([j,W]));var x=!0;if(h){var te=Al(W,h);x=!te.disabled&&!te.hidden}return x?W:w.count>Ly?w.lastFocused:hm(W,{moveBy:n,direction:o,context:c,modifiers:h,retry:le(le({},w),{count:w.count+1})})}var fm=u.createContext(void 0);function Fy(r){var t=Zr(),n=mm(),o=u.useState(),c=o[0],h=o[1],b=u.useState(),w=b[0],D=b[1],k=Ry(t.displayMonths,n),j=c??(w&&t.isDateDisplayed(w))?w:k,P=function(){D(c),h(void 0)},M=function(U){h(U)},W=Re(),x=function(U,de){if(c){var F=hm(c,{moveBy:U,direction:de,context:W,modifiers:n});$t(c,F)||(t.goToDate(F,c),M(F))}},te={focusedDay:c,focusTarget:j,blur:P,focus:M,focusDayAfter:function(){return x("day","after")},focusDayBefore:function(){return x("day","before")},focusWeekAfter:function(){return x("week","after")},focusWeekBefore:function(){return x("week","before")},focusMonthBefore:function(){return x("month","before")},focusMonthAfter:function(){return x("month","after")},focusYearBefore:function(){return x("year","before")},focusYearAfter:function(){return x("year","after")},focusStartOfWeek:function(){return x("startOfWeek","before")},focusEndOfWeek:function(){return x("endOfWeek","after")}};return e.jsx(fm.Provider,{value:te,children:r.children})}function Tl(){var r=u.useContext(fm);if(!r)throw new Error("useFocusContext must be used within a FocusProvider");return r}function By(r,t){var n=mm(),o=Al(r,n,t);return o}var Pl=u.createContext(void 0);function $y(r){if(!fi(r.initialProps)){var t={selected:void 0};return e.jsx(Pl.Provider,{value:t,children:r.children})}return e.jsx(Uy,{initialProps:r.initialProps,children:r.children})}function Uy(r){var t=r.initialProps,n=r.children,o=function(h,b,w){var D,k,j;if((D=t.onDayClick)===null||D===void 0||D.call(t,h,b,w),b.selected&&!t.required){(k=t.onSelect)===null||k===void 0||k.call(t,void 0,h,b,w);return}(j=t.onSelect)===null||j===void 0||j.call(t,h,h,b,w)},c={selected:t.selected,onDayClick:o};return e.jsx(Pl.Provider,{value:c,children:n})}function gm(){var r=u.useContext(Pl);if(!r)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return r}function Vy(r,t){var n=Re(),o=gm(),c=Cl(),h=_l(),b=Tl(),w=b.focusDayAfter,D=b.focusDayBefore,k=b.focusWeekAfter,j=b.focusWeekBefore,P=b.blur,M=b.focus,W=b.focusMonthBefore,x=b.focusMonthAfter,te=b.focusYearBefore,U=b.focusYearAfter,de=b.focusStartOfWeek,F=b.focusEndOfWeek,H=function(Y){var z,Dt,Mt,kt;fi(n)?(z=o.onDayClick)===null||z===void 0||z.call(o,r,t,Y):Gr(n)?(Dt=c.onDayClick)===null||Dt===void 0||Dt.call(c,r,t,Y):Xr(n)?(Mt=h.onDayClick)===null||Mt===void 0||Mt.call(h,r,t,Y):(kt=n.onDayClick)===null||kt===void 0||kt.call(n,r,t,Y)},se=function(Y){var z;M(r),(z=n.onDayFocus)===null||z===void 0||z.call(n,r,t,Y)},je=function(Y){var z;P(),(z=n.onDayBlur)===null||z===void 0||z.call(n,r,t,Y)},re=function(Y){var z;(z=n.onDayMouseEnter)===null||z===void 0||z.call(n,r,t,Y)},Be=function(Y){var z;(z=n.onDayMouseLeave)===null||z===void 0||z.call(n,r,t,Y)},ue=function(Y){var z;(z=n.onDayPointerEnter)===null||z===void 0||z.call(n,r,t,Y)},Ie=function(Y){var z;(z=n.onDayPointerLeave)===null||z===void 0||z.call(n,r,t,Y)},ze=function(Y){var z;(z=n.onDayTouchCancel)===null||z===void 0||z.call(n,r,t,Y)},at=function(Y){var z;(z=n.onDayTouchEnd)===null||z===void 0||z.call(n,r,t,Y)},Ye=function(Y){var z;(z=n.onDayTouchMove)===null||z===void 0||z.call(n,r,t,Y)},ea=function(Y){var z;(z=n.onDayTouchStart)===null||z===void 0||z.call(n,r,t,Y)},Le=function(Y){var z;(z=n.onDayKeyUp)===null||z===void 0||z.call(n,r,t,Y)},Fe=function(Y){var z;switch(Y.key){case"ArrowLeft":Y.preventDefault(),Y.stopPropagation(),n.dir==="rtl"?w():D();break;case"ArrowRight":Y.preventDefault(),Y.stopPropagation(),n.dir==="rtl"?D():w();break;case"ArrowDown":Y.preventDefault(),Y.stopPropagation(),k();break;case"ArrowUp":Y.preventDefault(),Y.stopPropagation(),j();break;case"PageUp":Y.preventDefault(),Y.stopPropagation(),Y.shiftKey?te():W();break;case"PageDown":Y.preventDefault(),Y.stopPropagation(),Y.shiftKey?U():x();break;case"Home":Y.preventDefault(),Y.stopPropagation(),de();break;case"End":Y.preventDefault(),Y.stopPropagation(),F();break}(z=n.onDayKeyDown)===null||z===void 0||z.call(n,r,t,Y)},$={onClick:H,onFocus:se,onBlur:je,onKeyDown:Fe,onKeyUp:Le,onMouseEnter:re,onMouseLeave:Be,onPointerEnter:ue,onPointerLeave:Ie,onTouchCancel:ze,onTouchEnd:at,onTouchMove:Ye,onTouchStart:ea};return $}function qy(){var r=Re(),t=gm(),n=Cl(),o=_l(),c=fi(r)?t.selected:Gr(r)?n.selected:Xr(r)?o.selected:void 0;return c}function zy(r){return Object.values(ma).includes(r)}function Yy(r,t){var n=[r.classNames.day];return Object.keys(t).forEach(function(o){var c=r.modifiersClassNames[o];if(c)n.push(c);else if(zy(o)){var h=r.classNames["day_".concat(o)];h&&n.push(h)}}),n}function Ky(r,t){var n=le({},r.styles.day);return Object.keys(t).forEach(function(o){var c;n=le(le({},n),(c=r.modifiersStyles)===null||c===void 0?void 0:c[o])}),n}function Jy(r,t,n){var o,c,h,b=Re(),w=Tl(),D=By(r,t),k=Vy(r,D),j=qy(),P=!!(b.onDayClick||b.mode!=="default");u.useEffect(function(){var re;D.outside||w.focusedDay&&P&&$t(w.focusedDay,r)&&((re=n.current)===null||re===void 0||re.focus())},[w.focusedDay,r,n,P,D.outside]);var M=Yy(b,D).join(" "),W=Ky(b,D),x=!!(D.outside&&!b.showOutsideDays||D.hidden),te=(h=(c=b.components)===null||c===void 0?void 0:c.DayContent)!==null&&h!==void 0?h:gy,U=e.jsx(te,{date:r,displayMonth:t,activeModifiers:D}),de={style:W,className:M,children:U,role:"gridcell"},F=w.focusTarget&&$t(w.focusTarget,r)&&!D.outside,H=w.focusedDay&&$t(w.focusedDay,r),se=le(le(le({},de),(o={disabled:D.disabled,role:"gridcell"},o["aria-selected"]=D.selected,o.tabIndex=H||F?0:-1,o)),k),je={isButton:P,isHidden:x,activeModifiers:D,selectedDays:j,buttonProps:se,divProps:de};return je}function Hy(r){var t=u.useRef(null),n=Jy(r.date,r.displayMonth,t);return n.isHidden?e.jsx("div",{role:"gridcell"}):n.isButton?e.jsx(mi,le({name:"day",ref:t},n.buttonProps)):e.jsx("div",le({},n.divProps))}function Qy(r){var t=r.number,n=r.dates,o=Re(),c=o.onWeekNumberClick,h=o.styles,b=o.classNames,w=o.locale,D=o.labels.labelWeekNumber,k=o.formatters.formatWeekNumber,j=k(Number(t),{locale:w});if(!c)return e.jsx("span",{className:b.weeknumber,style:h.weeknumber,children:j});var P=D(Number(t),{locale:w}),M=function(W){c(t,n,W)};return e.jsx(mi,{name:"week-number","aria-label":P,className:b.weeknumber,style:h.weeknumber,onClick:M,children:j})}function Gy(r){var t,n,o=Re(),c=o.styles,h=o.classNames,b=o.showWeekNumber,w=o.components,D=(t=w==null?void 0:w.Day)!==null&&t!==void 0?t:Hy,k=(n=w==null?void 0:w.WeekNumber)!==null&&n!==void 0?n:Qy,j;return b&&(j=e.jsx("td",{className:h.cell,style:c.cell,children:e.jsx(k,{number:r.weekNumber,dates:r.dates})})),e.jsxs("tr",{className:h.row,style:c.row,children:[j,r.dates.map(function(P){return e.jsx("td",{className:h.cell,style:c.cell,role:"presentation",children:e.jsx(D,{displayMonth:r.displayMonth,date:P})},Xp(P))})]})}function Su(r,t,n){for(var o=n!=null&&n.ISOWeek?Xu(t):Sl(t,n),c=n!=null&&n.ISOWeek?ds(r):wa(r,n),h=va(o,c),b=[],w=0;w<=h;w++)b.push(Et(c,w));var D=b.reduce(function(k,j){var P=n!=null&&n.ISOWeek?tm(j):sm(j,n),M=k.find(function(W){return W.weekNumber===P});return M?(M.dates.push(j),k):(k.push({weekNumber:P,dates:[j]}),k)},[]);return D}function Xy(r,t){var n=Su(Ut(r),jl(r),t);if(t!=null&&t.useFixedWeeks){var o=ex(r,t);if(o<6){var c=n[n.length-1],h=c.dates[c.dates.length-1],b=gl(h,6-o),w=Su(gl(h,1),b,t);n.push.apply(n,w)}}return n}function Zy(r){var t,n,o,c=Re(),h=c.locale,b=c.classNames,w=c.styles,D=c.hideHead,k=c.fixedWeeks,j=c.components,P=c.weekStartsOn,M=c.firstWeekContainsDate,W=c.ISOWeek,x=Xy(r.displayMonth,{useFixedWeeks:!!k,ISOWeek:W,locale:h,weekStartsOn:P,firstWeekContainsDate:M}),te=(t=j==null?void 0:j.Head)!==null&&t!==void 0?t:fy,U=(n=j==null?void 0:j.Row)!==null&&n!==void 0?n:Gy,de=(o=j==null?void 0:j.Footer)!==null&&o!==void 0?o:uy;return e.jsxs("table",{id:r.id,className:b.table,style:w.table,role:"grid","aria-labelledby":r["aria-labelledby"],children:[!D&&e.jsx(te,{}),e.jsx("tbody",{className:b.tbody,style:w.tbody,children:x.map(function(F){return e.jsx(U,{displayMonth:r.displayMonth,dates:F.dates,weekNumber:F.weekNumber},F.weekNumber)})}),e.jsx(de,{displayMonth:r.displayMonth})]})}function eb(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var tb=eb()?u.useLayoutEffect:u.useEffect,hl=!1,ab=0;function Du(){return"react-day-picker-".concat(++ab)}function sb(r){var t,n=r??(hl?Du():null),o=u.useState(n),c=o[0],h=o[1];return tb(function(){c===null&&h(Du())},[]),u.useEffect(function(){hl===!1&&(hl=!0)},[]),(t=r??c)!==null&&t!==void 0?t:void 0}function rb(r){var t,n,o=Re(),c=o.dir,h=o.classNames,b=o.styles,w=o.components,D=Zr().displayMonths,k=sb(o.id?"".concat(o.id,"-").concat(r.displayIndex):void 0),j=o.id?"".concat(o.id,"-grid-").concat(r.displayIndex):void 0,P=[h.month],M=b.month,W=r.displayIndex===0,x=r.displayIndex===D.length-1,te=!W&&!x;c==="rtl"&&(t=[W,x],x=t[0],W=t[1]),W&&(P.push(h.caption_start),M=le(le({},M),b.caption_start)),x&&(P.push(h.caption_end),M=le(le({},M),b.caption_end)),te&&(P.push(h.caption_between),M=le(le({},M),b.caption_between));var U=(n=w==null?void 0:w.Caption)!==null&&n!==void 0?n:dy;return e.jsxs("div",{className:P.join(" "),style:M,children:[e.jsx(U,{id:k,displayMonth:r.displayMonth,displayIndex:r.displayIndex}),e.jsx(Zy,{id:j,"aria-labelledby":k,displayMonth:r.displayMonth})]},r.displayIndex)}function nb(r){var t=Re(),n=t.classNames,o=t.styles;return e.jsx("div",{className:n.months,style:o.months,children:r.children})}function ib(r){var t,n,o=r.initialProps,c=Re(),h=Tl(),b=Zr(),w=u.useState(!1),D=w[0],k=w[1];u.useEffect(function(){c.initialFocus&&h.focusTarget&&(D||(h.focus(h.focusTarget),k(!0)))},[c.initialFocus,D,h.focus,h.focusTarget,h]);var j=[c.classNames.root,c.className];c.numberOfMonths>1&&j.push(c.classNames.multiple_months),c.showWeekNumber&&j.push(c.classNames.with_weeknumber);var P=le(le({},c.styles.root),c.style),M=Object.keys(o).filter(function(x){return x.startsWith("data-")}).reduce(function(x,te){var U;return le(le({},x),(U={},U[te]=o[te],U))},{}),W=(n=(t=o.components)===null||t===void 0?void 0:t.Months)!==null&&n!==void 0?n:nb;return e.jsx("div",le({className:j.join(" "),style:P,dir:c.dir,id:c.id,nonce:o.nonce,title:o.title,lang:o.lang},M,{children:e.jsx(W,{children:b.displayMonths.map(function(x,te){return e.jsx(rb,{displayIndex:te,displayMonth:x},te)})})}))}function ob(r){var t=r.children,n=Tx(r,["children"]);return e.jsx(Qx,{initialProps:n,children:e.jsx(iy,{children:e.jsx($y,{initialProps:n,children:e.jsx(py,{initialProps:n,children:e.jsx(by,{initialProps:n,children:e.jsx(Cy,{children:e.jsx(Fy,{children:t})})})})})})})}function lb(r){return e.jsx(ob,le({},r,{children:e.jsx(ib,{initialProps:r})}))}function xl({className:r,classNames:t,showOutsideDays:n=!0,...o}){return e.jsx(lb,{showOutsideDays:n,className:Ys("p-3",r),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:Ys(Hd({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:Ys(Hd({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...c})=>e.jsx(Dg,{className:"h-4 w-4"}),IconRight:({...c})=>e.jsx(cg,{className:"h-4 w-4"})},...o})}xl.displayName="Calendar";const ku={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_VERSION:"0.0.0",VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"false",VITE_FIREBASE_API_KEY:["AI","za","SyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s"].join(""),VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_AUTH_EMULATOR_URL:"http://localhost:9099",VITE_FIREBASE_FIRESTORE_EMULATOR_HOST:"localhost:8080",VITE_FIREBASE_FUNCTIONS_EMULATOR_HOST:"localhost:5001",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.appspot.com",VITE_FORCE_HASH_ROUTER:"true",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"محل كاشي لينك التجريبي",VITE_SHOW_ENV_BANNER:"true",VITE_USE_EMULATORS:"false",VITE_USE_FIREBASE_EMULATOR:"false"},Va=r=>typeof r=="string"&&r.trim().length>0,cb={getCurrentMonthId(){const r=new Date;return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`},async getWalletUsage(r){var t;try{if(!Va(r))return console.error("Error getting wallet usage: invalid walletId",r),null;const n=Te(V,"walletLimits",r),o=await ca(n);if(o.exists()){const h=o.data();return{walletId:r,used_transfer:h.monthlyTransferUsed??h.used_transfer??0,used_withdraw:h.monthlyWithdrawUsed??h.used_withdraw??0,monthly_limit:h.monthlyLimit??h.monthlyTransferLimit??h.monthlyWithdrawLimit??2e5,last_reset:h.lastMonthlyReset??h.last_reset??null,updatedAt:h.updatedAt||rs.now()}}const c={walletId:r,used_transfer:0,used_withdraw:0,monthly_limit:2e5,last_reset:null,updatedAt:rs.now()};return await Qt(n,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,monthlyTransferLimit:2e5,monthlyWithdrawLimit:2e5,lastMonthlyReset:null,updatedAt:ft(),ownerId:(t=Vs.currentUser)==null?void 0:t.uid}),c}catch(n){return console.error("Error getting wallet usage:",n),{walletId:r,used_transfer:0,used_withdraw:0,monthly_limit:2e5,last_reset:null,updatedAt:rs.now()}}},shouldResetLimits(r){const t=new Date,n=t.getDate();if(!r)return n===1;if(n===1){const o=r.toDate(),c=t.getMonth(),h=t.getFullYear();return o.getMonth()!==c||o.getFullYear()!==h}return!1},async autoResetLimitsIfNeeded(r){try{if(!Va(r))return console.error("خطأ في التصفير التلقائي للحدود: walletId غير صالح",r),!1;typeof import.meta<"u";const t=await this.getWalletUsage(r);return t&&this.shouldResetLimits(t.last_reset)?(console.log(`🔄 تصفير تلقائي للحدود للمحفظة ${r} - اليوم الأول من الشهر`),await this.resetWalletUsage(r)):!1}catch(t){return console.error("خطأ في التصفير التلقائي للحدود:",t),!1}},async resetWalletUsage(r){try{if(!Va(r))return console.error("خطأ في تصفير استخدام المحفظة: walletId غير صالح",r),!1;const t=Te(V,"walletLimits",r);return await Qt(t,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:ft(),updatedAt:ft()},{merge:!0}),console.log(`🔄 تم تصفير استخدام المحفظة ${r} بنجاح`),!0}catch(t){return console.error("خطأ في تصفير استخدام المحفظة:",t),!1}},async calculateUsageFromTransactions(r){var t,n;try{if(!Va(r))return console.error("خطأ في حساب الاستخدام من المعاملات: walletId غير صالح",r),{used_transfer:0,used_withdraw:0};const o=Te(V,"walletLimits",r),c=new Date;let h=rs.fromDate(new Date(c.getFullYear(),c.getMonth(),1));try{const j=await ca(o);h=j.exists()?((t=j.data())==null?void 0:t.lastMonthlyReset)??((n=j.data())==null?void 0:n.last_reset)??h:h}catch{}const b=Oe(me(V,"tx"),X("uid","==",r),...h?[X("createdAt",">=",h)]:[]),w=await ke(b);let D=0,k=0;return w.forEach(j=>{const P=j.data();P.status==="completed"&&(P.type==="transfer"?D+=P.amount:P.type==="withdraw"&&(k+=P.amount))}),{used_transfer:D,used_withdraw:k}}catch(o){return console.error("خطأ في حساب الاستخدام من المعاملات:",o),{used_transfer:0,used_withdraw:0}}},async getWalletUsageWithRefresh(r){var t,n;try{if(!Va(r))return console.error("خطأ في الحصول على الاستخدام مع التحديث: walletId غير صالح",r),null;typeof import.meta<"u";const o=await this.getWalletUsage(r);if(!o){const h=await this.calculateUsageFromTransactions(r),b=Te(V,"walletLimits",r);try{await Qt(b,{monthlyTransferUsed:h.used_transfer,monthlyWithdrawUsed:h.used_withdraw,updatedAt:ft(),ownerId:(t=Vs.currentUser)==null?void 0:t.uid},{merge:!0})}catch{}return{walletId:r,used_transfer:h.used_transfer,used_withdraw:h.used_withdraw,monthly_limit:2e5,last_reset:null,updatedAt:rs.now()}}const c=await this.calculateUsageFromTransactions(r);if(o.used_transfer!==c.used_transfer||o.used_withdraw!==c.used_withdraw){const h=Te(V,"walletLimits",r);try{await Qt(h,{monthlyTransferUsed:c.used_transfer,monthlyWithdrawUsed:c.used_withdraw,updatedAt:ft(),ownerId:(n=Vs.currentUser)==null?void 0:n.uid},{merge:!0})}catch{}return await this.getWalletUsage(r)}return o}catch(o){return console.error("خطأ في الحصول على الاستخدام مع التحديث:",o),{walletId:r,used_transfer:0,used_withdraw:0,monthly_limit:2e5,last_reset:null,updatedAt:rs.now()}}},calculateRemaining(r){return{remainingTransfer:Math.max(0,r.monthly_limit-r.used_transfer),remainingWithdraw:Math.max(0,r.monthly_limit-r.used_withdraw)}},async canPerformOperation(r,t,n){try{if(!Va(r))return console.error("Error checking operation limits: invalid walletId",r),{canPerform:!1,message:"walletId غير صالح"};const o=await this.getWalletUsageWithRefresh(r);if(!o)return{canPerform:!1,message:"لا يمكن العثور على بيانات الاستخدام للمحفظة"};const c=this.calculateRemaining(o);return n==="transfer"&&t>c.remainingTransfer?{canPerform:!1,message:`تجاوز حد التحويل المسموح. المتبقي: ${c.remainingTransfer.toLocaleString()} ج.م من أصل ${o.monthly_limit.toLocaleString()} ج.م`,remaining:c.remainingTransfer}:n==="withdraw"&&t>c.remainingWithdraw?{canPerform:!1,message:`تجاوز حد السحب المسموح. المتبقي: ${c.remainingWithdraw.toLocaleString()} ج.م من أصل ${o.monthly_limit.toLocaleString()} ج.م`,remaining:c.remainingWithdraw}:{canPerform:!0}}catch(o){return console.error("Error checking operation limits:",o),{canPerform:!1,message:"خطأ في التحقق من الحدود"}}},async updateUsage(r,t,n){var o;try{if(!Va(r))throw new Error("walletId غير صالح");const c=await this.getWalletUsageWithRefresh(r);if(!c)throw new Error("لا يمكن العثور على بيانات الاستخدام للمحفظة");const h=await this.canPerformOperation(r,t,n);if(!h.canPerform)throw new Error(h.message||"لا يمكن إجراء العملية");const b=n==="transfer"?c.used_transfer+t:c.used_transfer,w=n==="withdraw"?c.used_withdraw+t:c.used_withdraw,D=Te(V,"walletLimits",c.walletId);try{await Qt(D,{monthlyTransferUsed:b,monthlyWithdrawUsed:w,updatedAt:ft(),ownerId:(o=Vs.currentUser)==null?void 0:o.uid},{merge:!0})}catch{}let k=await this.getWalletUsageWithRefresh(r);return k||(k={walletId:r,used_transfer:b,used_withdraw:w,monthly_limit:c.monthly_limit,last_reset:c.last_reset,updatedAt:rs.now()}),k}catch(c){throw console.error("Error updating wallet usage:",c),c}},async resetWalletUsageManually(r){try{if(!Va(r))throw new Error("walletId غير صالح");const t=Te(V,"walletLimits",r),n={walletId:r,used_transfer:0,used_withdraw:0,monthly_limit:0,last_reset:null,updatedAt:new Date};return Qt(t,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:ft(),updatedAt:ft()},{merge:!0}).catch(o=>{console.error("خطأ في حفظ تصفير الاستخدام في Firebase:",o)}),console.log(`✅ تم تصفير استخدام المحفظة ${r} بنجاح`),n}catch(t){throw console.error("Error resetting wallet usage:",t),t}},async getAllWalletsUsage(r){try{const n=(await ii.getByMerchantId(r)).map(c=>this.getWalletUsageWithRefresh(c.id));return(await Promise.all(n)).filter(c=>c!==null)}catch(t){return console.error("Error getting all wallets usage:",t),[]}}};function db(r){return r?`readBroadcastIds_${r}`:"readBroadcastIds_guest"}function ub({className:r}){const{user:t,profile:n,isSubscriptionActive:o}=yl(),c=Eu(),[h,b]=u.useState([]),[w,D]=u.useState(new Set),[k,j]=u.useState(!1),[P,M]=u.useState(""),[W,x]=u.useState(!1),[te,U]=u.useState(null),[de,F]=u.useState("none"),[H,se]=u.useState(null),[je,re]=u.useState(!1),Be=u.useRef(new Set);u.useRef(!1);const ue=u.useRef(!0),Ie=u.useRef(null),ze=u.useRef(null),at=u.useRef(null),[Ye,ea]=u.useState({position:"fixed",top:0,left:0,zIndex:1e4}),Le=u.useMemo(()=>{const Q=["global"];return t!=null&&t.uid&&Q.push(`user:${t.uid}`),n!=null&&n.shopId&&Q.push(`shop:${n.shopId}`),Q},[t==null?void 0:t.uid,n==null?void 0:n.shopId]),Fe=db(t==null?void 0:t.uid),$=u.useMemo(()=>{var ge;const Q=(ge=c==null?void 0:c.pathname)==null?void 0:ge.includes("/user/pending-approval");return!!(t!=null&&t.uid)&&!Q},[t==null?void 0:t.uid,c==null?void 0:c.pathname]);u.useEffect(()=>{try{const Q=localStorage.getItem(Fe);if(Q){const ve=JSON.parse(Q);Array.isArray(ve)&&D(new Set(ve.filter(Boolean)))}else D(new Set)}catch(Q){console.warn("Failed to load read ids",Q),D(new Set)}},[Fe]),u.useEffect(()=>{if(!$){b([]);return}ue.current=!0;const Q=()=>{yg(Le,ge=>{if(ue.current){const Ke=Date.now(),lt=60*1e3,Na=ge.filter(He=>{var Gs,Vt;const Wt=(Gs=He.createdAt)!=null&&Gs.toMillis?He.createdAt.toMillis():(Vt=He.createdAt)!=null&&Vt.seconds?He.createdAt.seconds*1e3:0;return!(Ke-Wt<lt)}).map(He=>He.id).filter(Boolean);Be.current=new Set(Na),ue.current=!1}b(ge)})};Q();const ve=ge=>{console.log("🔔 OneSignal Notification received",ge);try{const Ke=ge.notification||ge;if(Ke&&(Ke.title||Ke.body)){const lt={id:`temp_${Date.now()}`,title:Ke.title||"إشعار جديد",message:Ke.body||Ke.message||"",audienceKey:"global",active:!0,createdAt:{toMillis:()=>Date.now(),seconds:Math.floor(Date.now()/1e3),nanoseconds:0}};se(lt),re(!0),Ie.current&&clearTimeout(Ie.current),Ie.current=window.setTimeout(()=>{re(!1),se(null)},5e3)}}catch(Ke){console.error("Error parsing OneSignal event for instant alert",Ke)}Q()};try{const ge=window.OneSignal;ge&&ge.Notifications&&ge.Notifications.addEventListener&&ge.Notifications.addEventListener("foregroundWillDisplay",ve)}catch(ge){console.error("Failed to add OneSignal listener",ge)}return()=>{try{const ge=window.OneSignal;ge&&ge.Notifications&&ge.Notifications.removeEventListener&&ge.Notifications.removeEventListener("foregroundWillDisplay",ve)}catch{}}},[Le,$]),u.useEffect(()=>{const Q=new Set(h.map(ge=>ge.id).filter(Boolean)),ve=h.filter(ge=>ge.id&&!Be.current.has(ge.id));ve.length>0&&(se(ve[0]),re(!0),Ie.current&&clearTimeout(Ie.current),Ie.current=window.setTimeout(()=>{re(!1),se(null)},5e3)),Be.current=Q},[h]),u.useEffect(()=>()=>{Ie.current&&clearTimeout(Ie.current)},[]);const Y=h.reduce((Q,ve)=>Q+(ve.id&&!w.has(ve.id)?1:0),0),z=Q=>{if(!Q||w.has(Q))return;const ve=new Set(w);ve.add(Q),D(ve);try{localStorage.setItem(Fe,JSON.stringify(Array.from(ve)))}catch{}},Dt=()=>{const Q=h.map(ge=>ge.id).filter(Boolean),ve=new Set(w);Q.forEach(ge=>ve.add(ge)),D(ve);try{localStorage.setItem(Fe,JSON.stringify(Array.from(ve)))}catch{}},Mt=(Q,ve)=>{var ge;if(Q)try{const Ke=((ge=di)==null?void 0:ge.isNativePlatform)&&di.getPlatform()==="android",lt=/\.apk(\?|$)/i.test(Q);if(Ke&&lt){const Na=`cashy://update?url=${encodeURIComponent(Q)}`;window.location.href=Na}else window.open(Q,"_blank")}catch{try{window.open(Q,"_blank")}catch{}}ve&&z(ve)},kt=()=>{if(!ze.current||!at.current)return;const Q=ze.current.getBoundingClientRect(),ve=8,ge=at.current.offsetWidth||320,Ke=Q.bottom+ve;let lt=Q.right-ge;const Na=window.innerWidth;lt=Math.min(Math.max(lt,ve),Na-ge-ve),ea(He=>({...He,top:Ke,left:lt}))};return u.useEffect(()=>{if(!je)return;kt();const Q=()=>kt();return window.addEventListener("resize",Q),window.addEventListener("scroll",Q,!0),()=>{window.removeEventListener("resize",Q),window.removeEventListener("scroll",Q,!0)}},[je]),u.useEffect(()=>{if(!(t!=null&&t.uid)){F("none");return}(async()=>{try{const ve=Oe(me(V,"waiting_list"),X("userId","==",t.uid)),Ke=(await ke(ve)).docs.map(He=>({id:He.id,...He.data()})).sort((He,Wt)=>{var Vt,Ea,us,za,ms,Xs;const Oa=((Ea=(Vt=He==null?void 0:He.createdAt)==null?void 0:Vt.toMillis)==null?void 0:Ea.call(Vt))??((us=He==null?void 0:He.createdAt)==null?void 0:us.seconds)*1e3??0;return(((ms=(za=Wt==null?void 0:Wt.createdAt)==null?void 0:za.toMillis)==null?void 0:ms.call(za))??((Xs=Wt==null?void 0:Wt.createdAt)==null?void 0:Xs.seconds)*1e3??0)-Oa});if(Ke.length===0){F("none");return}const lt=Ke[0],Na=(lt==null?void 0:lt.contacted)===!0||(lt==null?void 0:lt.status)==="contacted";F(Na?"contacted":"pending")}catch(ve){console.warn("⚠️ فشل جلب حالة waiting_list:",ve),F("none")}})()},[t==null?void 0:t.uid]),$?e.jsxs("div",{className:`relative inline-flex items-center gap-2 ${r||""}`,ref:ze,children:[e.jsxs(dg,{onOpenChange:Q=>{Q&&Y>0&&Dt()},children:[e.jsx(ug,{asChild:!0,children:e.jsx(I,{variant:"ghost",className:"relative h-8 w-8 rounded-full p-0 hover:bg-transparent focus:ring-1 focus:ring-primary focus:ring-offset-1 transition-all",title:"الإشعارات",children:e.jsxs("div",{className:"relative h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center border border-border shadow-sm hover:shadow-md",children:[e.jsx(rl,{className:"h-4 w-4 text-primary"}),Y>0&&e.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-red-500 text-white text-[10px] font-bold flex items-center justify-center shadow",children:Y})]})})}),e.jsxs(mg,{className:"w-80",align:"end",forceMount:!0,children:[e.jsxs(hg,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"الإشعارات"}),h.length>0&&e.jsxs(I,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:Dt,children:[e.jsx(oi,{className:"h-3 w-3 mr-1"}),"تمييز الكل كمقروء"]})]}),e.jsx(fg,{}),h.length===0?e.jsx("div",{className:"p-3 text-sm text-muted-foreground",children:"لا توجد إشعارات حالياً"}):e.jsx("div",{className:"max-h-64 overflow-y-auto pr-1",children:h.map(Q=>{const ve=Q.id?!w.has(Q.id):!1;return e.jsx("div",{className:`px-2 py-2 rounded-md ${ve?"bg-primary/5":""}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(rl,{className:`h-4 w-4 ${ve?"text-primary":"text-muted-foreground"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:Q.title||"إشعار"}),e.jsx("div",{className:"text-xs text-muted-foreground whitespace-pre-line",children:Q.message}),Q.linkUrl&&e.jsxs(I,{variant:"link",className:"px-0 h-6 text-xs",onClick:()=>Mt(Q.linkUrl,Q.id),children:["فتح الرابط ",e.jsx(xg,{className:"h-3 w-3 ml-1"})]})]}),ve?e.jsx(I,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>z(Q.id),title:"تمييز كمقروء",children:e.jsx(oi,{className:"h-4 w-4 text-primary"})}):e.jsx(I,{variant:"ghost",size:"icon",className:"h-6 w-6",disabled:!0,title:"مقروء",children:e.jsx(oi,{className:"h-4 w-4 text-muted-foreground"})})]})},Q.id)})})]})]}),H&&kf.createPortal(e.jsx("div",{ref:at,style:Ye,className:`pointer-events-auto transition-all duration-300 ${je?"opacity-100 translate-y-0":"opacity-0 -translate-y-3"}`,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-gray-200 p-4 w-80 max-w-[calc(100vw-16px)] flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(rl,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-semibold",children:H.title||"إشعار جديد"}),e.jsx("div",{className:"text-xs text-muted-foreground whitespace-pre-line",children:H.message}),H.linkUrl&&e.jsx(I,{variant:"link",className:"px-0 h-6 text-xs",onClick:()=>Mt(H.linkUrl,H.id),children:"فتح الرابط"})]})]})}),document.body)]}):null}function mb(r,t=300){const[n,o]=G.useState(r);return G.useEffect(()=>{const c=setTimeout(()=>o(r),t);return()=>clearTimeout(c)},[r,t]),n}const hb=({userId:r,transactions:t})=>{const[n,o]=u.useState(!1),[c,h]=u.useState(!1),[b,w]=u.useState(!1),[D,k]=u.useState({monthlyWithdrawalProfit:0,monthlyTransferProfit:0,monthlySalesProfit:0,lastUpdated:new Date}),{userSubscription:j}=yl();u.useEffect(()=>{r&&n&&b&&M()},[r,n,b]),u.useEffect(()=>{if(!n||!b)return;const F=setInterval(()=>{const H=new Date;(D.lastUpdated.getMonth()!==H.getMonth()||D.lastUpdated.getFullYear()!==H.getFullYear())&&M()},3e4);return()=>clearInterval(F)},[n,b,D.lastUpdated]);const P=async()=>{try{if(!r)return 0;const F=new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Cairo"}),H=new Date,se=F.format(H),[je,re]=se.split("-"),Be=`${je}-${re}-01`,ue=parseInt(je),Ie=parseInt(re),ze=new Date(ue,Ie,0).getDate(),at=`${je}-${re}-${String(ze).padStart(2,"0")}`;let Ye;try{const Le=Oe(me(V,"dailySales"),X("userId","==",r));Ye=await ke(Le)}catch{const Le=Oe(me(V,"users",r,"dailySales"));Ye=await ke(Le)}let ea=0;return Ye.forEach(Le=>{const Fe=Le.data(),$=String(Fe.date??"").slice(0,10);if($&&!Fe.isDeferred&&$>=Be&&$<=at){const Y=Number(Fe.sellingPrice??Fe.price??0),z=Number(Fe.wholesalePrice??0),Dt=Number(Fe.quantity??Fe.qty??0),Mt=Number(Fe.profit??(Y-z)*Dt);ea+=Mt}}),Math.round(ea*100)/100}catch(F){return console.warn("تعذر حساب أرباح المبيعات الشهرية:",F),0}},M=async()=>{if(r)try{if(Array.isArray(t)&&t.length>0){const se=new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Cairo"}),je=new Date,[re,Be]=se.format(je).split("-"),ue=parseInt(re),Ie=parseInt(Be)-1,ze=St.filterVisibleTransactions(t,"monthly",r);let at=0,Ye=0;ze.forEach(Le=>{var Q,ve,ge;let Fe;Le.createdAt instanceof Date?Fe=Le.createdAt:typeof((Q=Le.createdAt)==null?void 0:Q.toDate)=="function"?Fe=Le.createdAt.toDate():Fe=new Date(Le.createdAt||0);const $=se.formatToParts(Fe),Y=parseInt(((ve=$.find(Ke=>Ke.type==="year"))==null?void 0:ve.value)||"0"),z=parseInt(((ge=$.find(Ke=>Ke.type==="month"))==null?void 0:ge.value)||"0")-1,Dt=String(Le.status||"confirmed").toLowerCase();if(Y!==ue||z!==Ie||Dt!=="completed"&&Dt!=="confirmed")return;const Mt=(Le.type||Le.txnType||"").toLowerCase(),kt={type:Mt==="withdrawal"||Mt==="machine_withdrawal"?"withdraw":Mt,amount:Number(Le.amount||0),commission:Le.commission};kt.type==="withdraw"?at+=xa.calculateProfitFromTransaction(kt):(kt.type==="send"||kt.type==="receive"||kt.type==="transfer")&&(Ye+=xa.calculateProfitFromTransaction(kt))});const ea=await P();k({monthlyWithdrawalProfit:Math.round(at*100)/100,monthlyTransferProfit:Math.round(Ye*100)/100,monthlySalesProfit:ea,lastUpdated:new Date});return}const F=xa.getWithdrawTransferProfits(r),H=await P();k({monthlyWithdrawalProfit:F.monthlyWithdrawProfit||0,monthlyTransferProfit:F.monthlyTransferProfit||0,monthlySalesProfit:H,lastUpdated:new Date})}catch(F){console.error("Error loading profit data:",F)}},W=F=>`${F.toFixed(2)} ج.م`,x=async()=>{try{const F=(j==null?void 0:j.subscription)||null,H=(F==null?void 0:F.planType)??(F==null?void 0:F.plan)??null,se=typeof H=="string"?H.toLowerCase():null;if(H===Zt.ZERO||se==="zero"||se==="0"||H===0)return!0}catch{}try{if(r){const F=await Mu(r),H=(F==null?void 0:F.planType)??(F==null?void 0:F.plan)??null,se=typeof H=="string"?H.toLowerCase():null;if(H===Zt.ZERO||se==="zero"||se==="0"||H===0)return!0}}catch{}return!1},te=()=>{try{const F=r?`monthlyReportsLockEnabled_${r}`:"monthlyReportsLockEnabled";return(localStorage.getItem(F)??localStorage.getItem("monthlyReportsLockEnabled"))==="true"}catch{return!1}},U=async()=>{try{if(await x()){Qd({title:"الخطة زيرو",description:"عرض الأرباح الشهرية غير متاح في خطة زيرو. قم بالترقية للوصول إلى التقارير.",variant:"destructive"});return}}catch{}te()?h(!0):(w(!0),o(!0))},de=async()=>{try{if(await x()){Qd({title:"الخطة زيرو",description:"عرض الأرباح الشهرية غير متاح في خطة زيرو. قم بالترقية للوصول إلى التقارير.",variant:"destructive"}),h(!1);return}}catch{}w(!0),o(!0),h(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(I,{size:"sm",variant:"ghost",onClick:U,className:"h-6 w-6 p-0 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded-full transition-colors duration-200",title:"عرض الأرباح الشهرية",children:e.jsx(Js,{className:"h-4 w-4"})}),e.jsx(he,{open:n,onOpenChange:o,children:e.jsxs(fe,{className:"max-w-[280px] sm:max-w-[320px] mx-auto bg-white dark:bg-[#0f172a] border border-gray-200 dark:border-slate-800 shadow-xl rounded-xl p-0 overflow-hidden",children:[e.jsx(xe,{className:"bg-gray-50 dark:bg-slate-900/50 px-4 py-3 border-b border-gray-100 dark:border-slate-800",children:e.jsxs(ye,{className:"text-sm font-bold text-gray-900 dark:text-slate-100 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white dark:bg-slate-800 rounded-full border border-gray-200 dark:border-slate-700",children:e.jsx(li,{className:"h-4 w-4 text-purple-600 dark:text-purple-400"})}),"أرباح الشهر"]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-red-50 dark:bg-red-900/20 rounded-md",children:e.jsx(qs,{className:"h-3.5 w-3.5 text-red-600 dark:text-red-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"سحب"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:W(D.monthlyWithdrawalProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-green-50 dark:bg-green-900/20 rounded-md",children:e.jsx(Ru,{className:"h-3.5 w-3.5 text-green-600 dark:text-green-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"تحويل"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:W(D.monthlyTransferProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-violet-50 dark:bg-violet-900/20 rounded-md",children:e.jsx(Lu,{className:"h-3.5 w-3.5 text-violet-600 dark:text-violet-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"أرباح المبيعات"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:W(D.monthlySalesProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-100 dark:border-purple-900/30 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white dark:bg-slate-800 rounded-md shadow-sm",children:e.jsx(Pa,{className:"h-3.5 w-3.5 text-purple-600 dark:text-purple-400"})}),e.jsx("span",{className:"font-bold text-purple-900 dark:text-purple-100 text-sm",children:"الإجمالي"})]}),e.jsx("span",{className:"font-bold text-base text-purple-700 dark:text-purple-300",children:W(D.monthlyWithdrawalProfit+D.monthlyTransferProfit+D.monthlySalesProfit)})]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-slate-900/50 px-4 py-3 border-t border-gray-100 dark:border-slate-800 flex justify-center",children:e.jsx(I,{onClick:()=>o(!1),className:"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 hover:text-gray-900 w-full sm:w-auto px-8 rounded-lg text-sm font-medium shadow-sm",children:"إغلاق"})})]})}),e.jsx(Cf,{open:c,onOpenChange:h,onSuccess:de,description:"لا يمكن الاطلاع على الأرباح الشهرية إلا بإدخال الرقم السري الرئيسي"})]})},fb=r=>e.jsx(hb,{...r});function gb({open:r,onOpenChange:t,onSuccess:n,userId:o}){const[c,h]=u.useState(""),[b,w]=u.useState(""),[D,k]=u.useState(!1),[j,P]=u.useState(!1),[M,W]=u.useState(""),[x,te]=u.useState(!1),[U,de]=u.useState(!1),{toast:F}=bl();u.useEffect(()=>{let je=!0;return(async()=>{const re=await Bt.hasMasterPin(o);je&&de(re)})(),()=>{je=!1}},[o,r]);const H=()=>{h(""),w(""),W(""),k(!1),P(!1),t(!1)},se=async je=>{je.preventDefault(),W(""),te(!0);try{if(U){if(!await Bt.verifyMasterPin(c,o)){W("الرقم السري غير صحيح"),te(!1);return}}else{if(c.length<4){W("يجب أن يكون الرقم السري 4 أرقام على الأقل"),te(!1);return}if(c!==b){W("الرقم السري غير متطابق"),te(!1);return}if(!await Bt.createMasterPin(c,o)){W("تعذر إنشاء الرقم السري الرئيسي"),te(!1);return}}F({title:"نجح العملية",description:U?"تم التحقق من الرقم السري الرئيسي بنجاح":"تم إنشاء الرقم السري الرئيسي بنجاح"}),n(),H()}catch{W("حدث خطأ أثناء معالجة الرقم السري")}finally{te(!1)}};return e.jsx(he,{open:r,onOpenChange:t,children:e.jsxs(fe,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(xe,{children:e.jsxs(ye,{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(Gd,{className:"h-5 w-5 text-green-600"}),U?"أدخل الرقم السري الرئيسي":"إنشاء الرقم السري الرئيسي"]})}),e.jsxs("form",{onSubmit:se,className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 bg-blue-50 p-3 rounded-lg",children:U?"أدخل الرقم السري الرئيسي لعرض بيانات الأرباح":"قم بإنشاء الرقم السري الرئيسي لحماية بيانات الأرباح. يمكنك تغييره لاحقاً من إعدادات البروفيل."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"pin",children:U?"الرقم السري الرئيسي":"الرقم السري الرئيسي الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{id:"pin",type:D?"text":"password",value:c,onChange:je=>h(je.target.value),placeholder:U?"أدخل الرقم السري":"أدخل رقم سري جديد (4 أرقام على الأقل)",className:"pr-10",dir:"ltr",autoComplete:"off",required:!0}),e.jsx(I,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>k(!D),children:D?e.jsx(Xd,{className:"h-4 w-4"}):e.jsx(Js,{className:"h-4 w-4"})})]})]}),!U&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"confirmPin",children:"تأكيد الرقم السري"}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{id:"confirmPin",type:j?"text":"password",value:b,onChange:je=>w(je.target.value),placeholder:"أعد إدخال الرقم السري",className:"pr-10",dir:"ltr",autoComplete:"off",required:!0}),e.jsx(I,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>P(!j),children:j?e.jsx(Xd,{className:"h-4 w-4"}):e.jsx(Js,{className:"h-4 w-4"})})]})]}),M&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(If,{className:"h-4 w-4"}),M]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(I,{type:"submit",disabled:x,className:"flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx(Gd,{className:"h-4 w-4 mr-2"}),x?"جاري المعالجة...":U?"عرض الأرباح":"إنشاء وعرض الأرباح"]}),e.jsx(I,{type:"button",variant:"outline",onClick:H,disabled:x,children:"إلغاء"})]})]})]})})}const pb=({userId:r,transactions:t})=>{const[n,o]=u.useState(!1),[c,h]=u.useState(!1),[b,w]=u.useState(!1),[D,k]=u.useState({dailyWithdrawalProfit:0,dailyTransferProfit:0,dailySalesProfit:0,lastUpdated:new Date}),{shopId:j}=Wu();u.useEffect(()=>{r&&n&&b&&M()},[r,n,b,t,j]),u.useEffect(()=>{if(!n||!b)return;const U=setInterval(()=>{const de=new Date;D.lastUpdated.getDate()!==de.getDate()&&M()},3e4);return()=>clearInterval(U)},[n,b,D.lastUpdated]);const P=async()=>{if(!r)return 0;const U=new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Cairo"}),de=U.format(new Date);let F=0;try{const H=Oe(me(V,"dailySales"),X("userId","==",r),...j?[X("shopId","==",j)]:[]),se=await ke(H),je=[];se.forEach(ue=>{je.push({id:ue.id,data:ue.data()})}),(await ke(me(V,"users",r,"dailySales"))).forEach(ue=>{const Ie=ue.data();j&&Ie.shopId&&Ie.shopId!==j||je.push({id:ue.id,data:Ie})});const Be=new Map;je.forEach(ue=>{const Ie=String(ue.data.clientId||ue.id);Be.has(Ie)||Be.set(Ie,ue.data)}),Be.forEach(ue=>{if(ue.isDeferred)return;let Ie=null;if(ue.createdAt)typeof ue.createdAt.toDate=="function"?Ie=ue.createdAt.toDate():ue.createdAt instanceof Date?Ie=ue.createdAt:typeof ue.createdAt=="number"?Ie=new Date(ue.createdAt):typeof ue.createdAt=="string"&&(Ie=new Date(ue.createdAt));else if(ue.date){const at=ue.time||"00:00";Ie=new Date(`${ue.date}T${at}:00`)}let ze=!1;if(Ie&&!isNaN(Ie.getTime())?U.format(Ie)===de&&(ze=!0):String(ue.date||"").slice(0,10)===de&&(ze=!0),ze){const at=Number(ue.quantity||1),Ye=Number(ue.profit??(Number(ue.sellingPrice||0)-Number(ue.wholesalePrice||0))*at);F+=Ye}})}catch(H){console.warn("تعذر جلب أرباح المبيعات اليومية:",H)}return Math.round(F*100)/100},M=async()=>{if(r)try{if(Array.isArray(t)&&t.length>0){const F=new Date,H=St.filterVisibleTransactions(t,"daily",r);let se=0,je=0;H.forEach(Be=>{const ue=new Date(Be.createdAt),Ie=String(Be.status||"confirmed").toLowerCase();if(ue.toDateString()!==F.toDateString())return;const ze=(Be.type||Be.txnType||"").toLowerCase(),at=String(Be.title||"");if(ze==="cash_addition"||at.includes("إيصال إضافة نقدية"))return;const Ye={type:ze==="withdrawal"||ze==="machine_withdrawal"?"withdraw":ze,amount:Number(Be.amount||0),commission:Be.commission};Ye.type==="withdraw"?se+=xa.calculateProfitFromTransaction(Ye):(Ye.type==="send"||Ye.type==="receive"||Ye.type==="transfer")&&(je+=xa.calculateProfitFromTransaction(Ye))});const re=await P();k({dailyWithdrawalProfit:Math.round(se*100)/100,dailyTransferProfit:Math.round(je*100)/100,dailySalesProfit:re,lastUpdated:new Date});try{xa.updateProfitsFromTransactions(t,r)}catch{}return}const U=xa.getWithdrawTransferProfits(r),de=await P();k({dailyWithdrawalProfit:U.dailyWithdrawProfit||0,dailyTransferProfit:U.dailyTransferProfit||0,dailySalesProfit:de,lastUpdated:new Date})}catch(U){console.error("Error loading profit data:",U)}},W=U=>`${U.toFixed(2)} ج.م`,x=()=>{xa.hasProfitPin(r),h(!0)},te=()=>{w(!0),o(!0),h(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(I,{size:"sm",variant:"ghost",onClick:x,className:"h-6 w-6 p-0 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-colors duration-200",title:"عرض الأرباح اليومية",children:e.jsx(Js,{className:"h-4 w-4"})}),e.jsx(he,{open:n,onOpenChange:o,children:e.jsxs(fe,{className:"max-w-[280px] sm:max-w-[320px] mx-auto bg-white dark:bg-[#0f172a] border border-gray-200 dark:border-slate-800 shadow-xl rounded-xl p-0 overflow-hidden",children:[e.jsx(xe,{className:"bg-gray-50 dark:bg-slate-900/50 px-4 py-3 border-b border-gray-100 dark:border-slate-800",children:e.jsxs(ye,{className:"text-sm font-bold text-gray-900 dark:text-slate-100 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white dark:bg-slate-800 rounded-full border border-gray-200 dark:border-slate-700",children:e.jsx(Pa,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})}),"أرباح اليوم"]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-red-50 dark:bg-red-900/20 rounded-md",children:e.jsx(qs,{className:"h-3.5 w-3.5 text-red-600 dark:text-red-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"سحب"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:W(D.dailyWithdrawalProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-green-50 dark:bg-green-900/20 rounded-md",children:e.jsx(Ru,{className:"h-3.5 w-3.5 text-green-600 dark:text-green-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"تحويل"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:W(D.dailyTransferProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-violet-50 dark:bg-violet-900/20 rounded-md",children:e.jsx(Lu,{className:"h-3.5 w-3.5 text-violet-600 dark:text-violet-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"أرباح المبيعات"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:W(D.dailySalesProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-900/30 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white dark:bg-slate-800 rounded-md shadow-sm",children:e.jsx(Pa,{className:"h-3.5 w-3.5 text-blue-600 dark:text-blue-400"})}),e.jsx("span",{className:"font-bold text-blue-900 dark:text-blue-100 text-sm",children:"الإجمالي"})]}),e.jsx("span",{className:"font-bold text-base text-blue-700 dark:text-blue-300",children:W(D.dailyWithdrawalProfit+D.dailyTransferProfit+D.dailySalesProfit)})]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-slate-900/50 px-4 py-3 border-t border-gray-100 dark:border-slate-800 flex justify-center",children:e.jsx(I,{onClick:()=>o(!1),className:"bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-700 text-gray-700 dark:text-slate-200 hover:bg-gray-50 dark:hover:bg-slate-700 hover:text-gray-900 w-full sm:w-auto px-8 rounded-lg text-sm font-medium shadow-sm",children:"إغلاق"})})]})}),e.jsx(gb,{open:c,onOpenChange:h,onSuccess:te,userId:r})]})},xb=r=>e.jsx(pb,{...r});class zs{static async processTransfer(t){const{amount:n,currentCashBalance:o,currentWalletBalances:c,wallets:h,selectedWalletId:b}=t;if(n<=0)return{success:!1,newCashBalance:o,newWalletBalances:c,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};if(b&&!t.skipRemoteLimitsCheck)try{const j=await cs.canPerformOperation(b,n,"transfer");if(!j.canPerform)return{success:!1,newCashBalance:o,newWalletBalances:c,message:j.message||"تم تجاوز الحد الأقصى",error:"LIMIT_EXCEEDED"}}catch(j){return console.error("خطأ في التحقق من حدود التحويل:",j),{success:!1,newCashBalance:o,newWalletBalances:c,message:"خطأ في التحقق من حدود التحويل",error:"LIMIT_CHECK_ERROR"}}if(n<=0)return{success:!1,newCashBalance:o,newWalletBalances:c,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};if(b){const j=Math.max(c[b]||0,0);if(j<n){const P=h.find(M=>M.id===b);return{success:!1,newCashBalance:o,newWalletBalances:c,message:`رصيد غير كافي في المحفظة${P?` ${P.name}`:""}. المتاح: ${j} جنيه، المطلوب: ${n} جنيه`,error:"INSUFFICIENT_WALLET_BALANCE"}}}else{const j=zs.calculateTotalWalletBalance(c);if(j<n)return{success:!1,newCashBalance:o,newWalletBalances:c,message:`رصيد غير كافي في المحافظ. الرصيد المتاح: ${j} جنيه، المبلغ المطلوب: ${n} جنيه`,error:"INSUFFICIENT_WALLET_BALANCE"}}const w={...c};if(b){const j=w[b]||0;w[b]=j-n}else{let j=n;for(const P of h){if(j<=0)break;const M=Math.max(w[P.id]||0,0),W=Math.min(M,j);W>0&&(w[P.id]=(w[P.id]||0)-W,j-=W)}}const D=o+n;let k="تم التحويل بنجاح";if(b){const j=w[b]||0;j<0&&(k=`تم التحويل بنجاح مع تحذير: رصيد محفظة ${b} أصبح ${j} جنيه.`)}return{success:!0,newCashBalance:D,newWalletBalances:w,message:k}}static processDeposit(t){const{amount:n,currentCashBalance:o,currentWalletBalances:c,wallets:h}=t;if(n<=0)return{success:!1,newCashBalance:o,newWalletBalances:c,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};const b=this.calculateTotalWalletBalance(c);if(b<n)return{success:!1,newCashBalance:o,newWalletBalances:c,message:`رصيد غير كافي في المحافظ. الرصيد المتاح: ${b} جنيه، المبلغ المطلوب: ${n} جنيه`,error:"INSUFFICIENT_WALLET_BALANCE"};const w=o+n,D={...c};let k=n;const j=h.find(M=>M.isDefault);if(j&&D[j.id]>=k)D[j.id]-=k,k=0;else for(const M of h){if(k<=0)break;const W=D[M.id]||0;if(W>0){const x=Math.min(W,k);D[M.id]=W-x,k-=x}}const P=k>0?`تم الإيداع جزئياً. تم إيداع ${n-k} جنيه في صندوق النقدية`:`تم الإيداع بنجاح. تم إضافة ${n} جنيه إلى صندوق النقدية`;return{success:!0,newCashBalance:w,newWalletBalances:D,message:P}}static async processWithdraw(t){const{amount:n,currentCashBalance:o,currentWalletBalances:c,wallets:h,selectedWalletId:b}=t;if(n<=0)return{success:!1,newCashBalance:o,newWalletBalances:c,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};if(b&&!t.skipRemoteLimitsCheck)try{const j=await cs.canPerformOperation(b,n,"withdraw");if(!j.canPerform)return{success:!1,newCashBalance:o,newWalletBalances:c,message:j.message||"تم تجاوز الحد الأقصى",error:"LIMIT_EXCEEDED"}}catch(j){return console.error("خطأ في التحقق من حدود السحب:",j),{success:!1,newCashBalance:o,newWalletBalances:c,message:"خطأ في التحقق من حدود السحب",error:"LIMIT_CHECK_ERROR"}}if(o<n)return{success:!1,newCashBalance:o,newWalletBalances:c,message:`رصيد غير كافي في صندوق النقدية. الرصيد المتاح: ${o} جنيه، المبلغ المطلوب: ${n} جنيه`,error:"INSUFFICIENT_CASH_BALANCE"};const w=o-n,D={...c},k=b?h.find(j=>j.id===b):h.find(j=>j.isDefault)||h[0];if(k){const j=D[k.id]||0;D[k.id]=j+n}else return{success:!1,newCashBalance:o,newWalletBalances:c,message:"لا توجد محافظ متاحة لإضافة المبلغ إليها",error:"NO_WALLETS_AVAILABLE"};return{success:!0,newCashBalance:w,newWalletBalances:D,message:`تم السحب بنجاح. تم إضافة ${n} جنيه إلى محفظة ${(k==null?void 0:k.name)||""}`}}static validateOperation(t,n){return t<=0?{valid:!1,error:"المبلغ يجب أن يكون أكبر من الصفر"}:!n||n.length===0?{valid:!1,error:"لا توجد محافظ متاحة"}:{valid:!0}}static calculateTotalWalletBalance(t){return Object.values(t).reduce((n,o)=>n+Math.max(o,0),0)}static deductFromWalletsAddToCash(t,n,o,c){return this.processTransfer({amount:t,currentCashBalance:n,currentWalletBalances:o,wallets:c})}static deductFromWalletsAddToCashDeposit(t,n,o,c){return this.processDeposit({amount:t,currentCashBalance:n,currentWalletBalances:o,wallets:c})}static deductFromCashAddToWallets(t,n,o,c){return this.processWithdraw({amount:t,currentCashBalance:n,currentWalletBalances:o,wallets:c})}static applyTransactionResult(t,n,o){t.success&&(n(t.newCashBalance),o(t.newWalletBalances))}static validateTransaction(t,n,o,c){if(t<=0)return{isValid:!1,error:"المبلغ يجب أن يكون أكبر من الصفر"};if(n==="transfer"){const h=this.calculateTotalWalletBalance(c);if(h<t)return{isValid:!1,error:`الرصيد المتاح في المحافظ (${h} جنيه) غير كافي للمبلغ المطلوب (${t} جنيه)`}}else if(n==="withdraw"){if(o<t)return{isValid:!1,error:`الرصيد المتاح في صندوق النقدية (${o} جنيه) غير كافي للمبلغ المطلوب (${t} جنيه)`}}else if(n==="deposit"){const h=this.calculateTotalWalletBalance(c);if(h<t)return{isValid:!1,error:`الرصيد المتاح في المحافظ (${h} جنيه) غير كافي للمبلغ المطلوب (${t} جنيه)`}}return{isValid:!0}}static getDeductionPreview(t,n,o){const c=[];let h=t;for(const b of o){if(h<=0)break;const w=n[b.id]||0,D=Math.min(Math.max(w,0),h);D>0&&(c.push({walletId:b.id,walletName:b.name,currentBalance:w,deductedAmount:D,newBalance:w-D}),h-=D)}return c}}let zr=null;function yb(){const r=window;if(!zr){const t=r.AudioContext||r.webkitAudioContext;zr=new t}return zr.state==="suspended"&&zr.resume(),zr}function bb(r,t,n){const o=n/1e3,c=Math.floor(r.sampleRate*o),h=r.createBuffer(1,c,r.sampleRate),b=h.getChannelData(0);for(let j=0;j<c;j++)b[j]=(Math.random()*2-1)*.6;const w=r.createBufferSource();w.buffer=h;const D=r.createBiquadFilter();D.type="highpass",D.frequency.value=1500,D.Q.value=.7;const k=r.createGain();k.gain.setValueAtTime(1e-4,t),k.gain.exponentialRampToValueAtTime(.4,t+.015),k.gain.exponentialRampToValueAtTime(1e-4,t+o),w.connect(D),D.connect(k),k.connect(r.destination),w.start(t),w.stop(t+o+.01)}function vb(r,t,n,o,c,h="triangle"){const b=r.createOscillator(),w=r.createGain();b.type=h;const D=c/1e3;b.frequency.setValueAtTime(n,t),b.frequency.linearRampToValueAtTime(o,t+D),w.gain.setValueAtTime(1e-4,t),w.gain.exponentialRampToValueAtTime(.25,t+.02),w.gain.exponentialRampToValueAtTime(1e-4,t+D),b.connect(w),w.connect(r.destination),b.start(t),b.stop(t+D+.02)}function wb(){try{const r=yb(),t=r.currentTime;bb(r,t,90),vb(r,t+.12,1900,1100,180,"sawtooth")}catch{}}function Nb(r){if(!r)return!1;const n=r.replace(/[^0-9٠-٩]/g,"").replace(/[٠-٩]/g,o=>"0123456789"["٠١٢٣٤٥٦٧٨٩".indexOf(o)]);return/^(010|011|012|015)[0-9]{8}$/.test(n)}const jb=({isOpen:r,onClose:t,senderPhone:n,receiverPhone:o,amount:c,deviceId:h,api:b})=>{const{toast:w}=bl(),[D,k]=u.useState(1),[j,P]=u.useState(!1),[M,W]=u.useState("");u.useEffect(()=>{r&&(k(1),W(""))},[r]);const x=async se=>{try{return b&&typeof b.enterPin=="function"?(await b.enterPin(h,se),!0):!1}catch(je){return console.error("ADB error:",je),w({title:"خطأ ADB",description:je.message||"فشل الاتصال",variant:"destructive"}),!1}},te=async()=>{if(!M){w({title:"أدخل الرقم السري",variant:"destructive"});return}P(!0);const se=await x(M);P(!1),se&&k(2)},U=async()=>{P(!0);const se=await x(String(c));P(!1),se&&k(3)},de=async()=>{P(!0);const se=await x(o);P(!1),se&&k(4)},F=async()=>{P(!0);const se=await x(o);P(!1),se&&k(5)},H=async()=>{P(!0);const se=await x("1");P(!1),se&&(w({title:"تم التحويل بنجاح",description:"تم تأكيد العملية"}),t())};return e.jsx(he,{open:r,onOpenChange:se=>!se&&t(),children:e.jsxs(fe,{className:"sm:max-w-[400px]",children:[e.jsxs(xe,{children:[e.jsx(ye,{children:"تحويل اتصالات كاش (USSD)"}),e.jsxs(Xe,{children:[D===1&&"الخطوة 1: أدخل الرقم السري للمحفظة",D===2&&"الخطوة 2: تأكيد مبلغ التحويل",D===3&&"الخطوة 3: إدخال رقم المستقبل",D===4&&"الخطوة 4: تأكيد رقم المستقبل",D===5&&"الخطوة 5: تأكيد العملية النهائية"]})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[D===1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"الرقم السري (PIN)"}),e.jsx(K,{type:"password",value:M,onChange:se=>W(se.target.value),placeholder:"****",autoFocus:!0,className:"text-center text-lg tracking-widest",maxLength:6,onKeyDown:se=>{se.key==="Enter"&&M&&te()}})]}),D===2&&e.jsxs("div",{className:"text-center bg-gray-50 dark:bg-slate-800 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"سيتم إرسال المبلغ:"}),e.jsx("p",{className:"text-2xl font-bold font-mono tracking-wider",children:c})]}),D===3&&e.jsxs("div",{className:"text-center bg-gray-50 dark:bg-slate-800 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"سيتم إرسال رقم المستقبل:"}),e.jsx("p",{className:"text-2xl font-bold font-mono tracking-wider",children:o})]}),D===4&&e.jsxs("div",{className:"text-center bg-gray-50 dark:bg-slate-800 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"تأكيد الرقم مرة أخرى:"}),e.jsx("p",{className:"text-2xl font-bold font-mono tracking-wider",children:o})]}),D===5&&e.jsxs("div",{className:"text-center bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-100 dark:border-green-900",children:[e.jsx("p",{className:"text-lg font-bold text-green-700 dark:text-green-400 mb-2",children:"جاهز للتأكيد"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"سيتم إرسال رقم 1 لتأكيد التحويل"})]})]}),e.jsxs(Pe,{children:[D===1&&e.jsx(I,{onClick:te,disabled:j||!M,className:"w-full bg-black hover:bg-neutral-800 text-white",children:j?e.jsx(Vr,{className:"animate-spin h-4 w-4 mr-2"}):"إرسال الرقم السري"}),D===2&&e.jsx(I,{onClick:U,disabled:j,className:"w-full bg-black hover:bg-neutral-800 text-white",children:j?e.jsx(Vr,{className:"animate-spin h-4 w-4 mr-2"}):"إرسال المبلغ"}),D===3&&e.jsx(I,{onClick:de,disabled:j,className:"w-full bg-black hover:bg-neutral-800 text-white",children:j?e.jsx(Vr,{className:"animate-spin h-4 w-4 mr-2"}):"إرسال الرقم"}),D===4&&e.jsx(I,{onClick:F,disabled:j,className:"w-full bg-black hover:bg-neutral-800 text-white",children:j?e.jsx(Vr,{className:"animate-spin h-4 w-4 mr-2"}):"تأكيد الرقم"}),D===5&&e.jsx(I,{onClick:H,disabled:j,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:j?e.jsx(Vr,{className:"animate-spin h-4 w-4 mr-2"}):"تأكيد (1)"})]})]})})},Sb=G.lazy(()=>Z(()=>import("./index-CzMrJEuC.js").then(r=>r.cI),__vite__mapDeps([0,1]),import.meta.url).then(r=>({default:r.BranchRequestDialog}))),Db=G.lazy(()=>Z(()=>import("./WalletManagement-BXKugYvA.js"),__vite__mapDeps([2,0,1,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),import.meta.url)),kb=G.lazy(()=>Z(()=>import("./TransactionDetailsModal-CwrtpD6g.js"),__vite__mapDeps([18,0,1,19,4,3,14,11,20,16,17]),import.meta.url)),Cb=G.lazy(()=>Z(()=>import("./ReceiptModal-D6AabDSr.js"),__vite__mapDeps([21,0,1,19,4,10,3,22,17,20,23]),import.meta.url)),Cu=G.lazy(()=>Z(()=>import("./EditBalanceDialog-DShyKpUy.js"),__vite__mapDeps([24,0,1,14]),import.meta.url).then(r=>({default:r.EditBalanceDialog}))),Ib=G.lazy(()=>Z(()=>import("./ChangePinDialog-CUjyQfB4.js"),__vite__mapDeps([25,0,1]),import.meta.url).then(r=>({default:r.ChangePinDialog}))),_b=G.lazy(()=>Z(()=>import("./ChangeCashPinDialog-Cu1lc5K-.js"),__vite__mapDeps([26,0,1,14]),import.meta.url).then(r=>({default:r.ChangeCashPinDialog}))),Ab=G.lazy(()=>Z(()=>import("./ChangeWalletTotalPinDialog-BZgEPQgv.js"),__vite__mapDeps([27,0,1,5]),import.meta.url).then(r=>({default:r.ChangeWalletTotalPinDialog}))),Tb=G.lazy(()=>Z(()=>import("./index-CzMrJEuC.js").then(r=>r.cG),__vite__mapDeps([0,1]),import.meta.url)),la=G.lazy(()=>Z(()=>import("./index-CzMrJEuC.js").then(r=>r.cH),__vite__mapDeps([0,1]),import.meta.url)),Pb=G.lazy(()=>Z(()=>import("./AddToWalletDialog-tfSlr_jZ.js"),__vite__mapDeps([28,0,1]),import.meta.url).then(r=>({default:r.AddToWalletDialog}))),Ob=G.lazy(()=>Z(()=>import("./CalculatorDialog-B1fj1m0a.js"),__vite__mapDeps([29,0,1,19,4]),import.meta.url).then(r=>({default:r.CalculatorDialog}))),Eb=G.lazy(()=>Z(()=>import("./SalesDataDialog-e3zvXpQc.js"),__vite__mapDeps([30,0,1,31,3,32,33,4,34,10,35,12,36,14,11,37,20,38,8,13,16,39,40,7,41,42,17,43,44,45,46,47,48,49,19,5,6]),import.meta.url).then(r=>({default:r.SalesDataDialog}))),Mb=G.lazy(()=>Z(()=>import("./CashSummaryDialog-BIfXXuAb.js"),__vite__mapDeps([50,0,1,14,19,4,51,39,40,7,41,42,16,17,37,36,43,8,3,32,33,34,44,45,46,47,48,11,49,5,20,6]),import.meta.url).then(r=>({default:r.CashSummaryDialog}))),Wb=G.lazy(()=>Z(()=>import("./CreditCardsDialog-CyASBCao.js"),__vite__mapDeps([52,0,1,17,38,11,14]),import.meta.url)),Rb=G.lazy(()=>Z(()=>import("./InstallmentModal-Bs1CUlVN.js"),__vite__mapDeps([53,0,1,3,11]),import.meta.url)),Lb=G.lazy(()=>Z(()=>import("./SimCardsDialog-BHAHmV75.js"),__vite__mapDeps([54,0,1,41,31,19,4,32,33,55,37]),import.meta.url).then(r=>({default:r.SimCardsDialog}))),Fb=G.lazy(()=>Z(()=>import("./AdslCardsDialog-COHSnb4z.js"),__vite__mapDeps([56,0,1,41,31,55,19,4,32,33,37]),import.meta.url).then(r=>({default:r.AdslCardsDialog}))),Bb=G.lazy(()=>Z(()=>import("./MaintenanceDialog-QMSenSC7.js"),__vite__mapDeps([57,0,1,3,10,48,36,17]),import.meta.url).then(r=>({default:r.default}))),$b=G.lazy(()=>Z(()=>import("./MachineDailyDialog-DNWYmXVC.js"),__vite__mapDeps([58,0,1,3,10,35,4,11]),import.meta.url)),Ub=G.lazy(()=>Z(()=>import("./WalletsManagement-DWC2pV-z.js"),__vite__mapDeps([59,0,1,3,9,4,60,41,22,20,5,8,37,23,7]),import.meta.url).then(r=>({default:r.WalletsManagement}))),Vb=G.lazy(()=>Z(()=>import("./WalletsListDialog-C6GZurWU.js"),__vite__mapDeps([61,0,1,4,5,62]),import.meta.url).then(r=>({default:r.WalletsListDialog}))),Iu=G.lazy(()=>Z(()=>import("./WalletPrinterDialog-C-dhuDER.js"),__vite__mapDeps([60,0,1,41,22,20,5,8,37,23]),import.meta.url)),qb=G.lazy(()=>Z(()=>import("./CashierShiftModal-B_RIDGAK.js"),__vite__mapDeps([63,0,1,4,64]),import.meta.url)),zb=G.lazy(()=>Z(()=>import("./ShiftProfileDialog-x0kyOIbL.js"),__vite__mapDeps([65,0,1]),import.meta.url)),Yb=G.lazy(()=>Z(()=>import("./ChangeLogDialog-DVwwA8-N.js"),__vite__mapDeps([66,0,1,67]),import.meta.url));function Kb({userId:r}){const[t,n]=G.useState(null),[o,c]=G.useState("");return null}const Jb=()=>{var $d,Ud,Vd,qd,zd,Yd,Kd;console.log("🔥 UserDashboardPage component is loading...");const{signOut:r,user:t,profile:n,userData:o}=yl(),c=((t==null?void 0:t.email)||"").toLowerCase()==="vodafonecash00@gmail.com",h=Eu(),b=_f(),w=Af(),{isShiftActive:D,shiftUser:k}=Tf(),{shopId:j,shopName:P}=Wu(),M=Pf(),W=Of(),{toast:x}=bl(),te=u.useRef(null),[U,de]=u.useState(0),[F,H]=u.useState(!1),[se,je]=u.useState(!1),re=(a,s)=>{if(D&&(k!=null&&k.permissions)&&k.permissions[a]===!1){je(!0);return}s()},[Be,ue]=u.useState(!1),[Ie,ze]=u.useState(!1),[at,Ye]=u.useState(!1),[ea,Le]=u.useState(!1),Fe=u.useRef(!1),[$,Y]=u.useState(()=>{try{const a=Object.keys(localStorage).find(i=>i.startsWith("wallets_")),s=a?localStorage.getItem(a):null;if(s){const i=JSON.parse(s);if(Array.isArray(i))return i}}catch{}return[]}),[z,Dt]=u.useState([]);u.useEffect(()=>{var a;(a=h.state)!=null&&a.openProfileSettings&&(H(!0),window.history.replaceState({},document.title))},[h.state]);const Mt=async()=>{var i,l,d;const a="alkaptin678678@gmail.com",s=(l=(i=Vs.currentUser)==null?void 0:i.email)==null?void 0:l.toLowerCase();if(!s||s!==a){x({title:"قيد التطوير",description:"هذه الميزة غير متاحة حالياً."});return}if(!Mn||!Wn||!Rn){x({title:"بيانات ناقصة",description:"أدخل رقم الموبايل، الشركة والمبلغ",variant:"destructive"});return}try{fd(!0);const m=await((d=Vs.currentUser)==null?void 0:d.getIdToken()),f=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...m?{Authorization:`Bearer ${m}`}:{}},body:JSON.stringify({phone:Mn,countryCode:"EG",operator:Wn,amount:Number(Rn),useLocalAmount:!0})}),g=await f.json().catch(()=>({}));f.ok&&(g!=null&&g.success)?(x({title:"تم الشحن",description:(g==null?void 0:g.message)||"تم تنفيذ عملية الشحن بنجاح"}),Eo(!1),dd(""),ud(""),md("")):x({title:"فشل الشحن",description:(g==null?void 0:g.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(m){console.error("Topup request error:",m),x({title:"خطأ غير متوقع",description:"تعذّر تنفيذ عملية الشحن. حاول لاحقاً.",variant:"destructive"})}finally{fd(!1)}};(()=>{try{return!!window.electronAPI||typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("electron")||typeof window<"u"&&window.location&&window.location.protocol==="file:"}catch{return!1}})();const[kt,Q]=u.useState(!1),[ve,ge]=u.useState(!1),[Ke,lt]=u.useState(!1),[Na,He]=u.useState(!1),[Wt,Oa]=u.useState(!1),[Gs,Vt]=u.useState(!1),[Ea,us]=u.useState([]),[za,ms]=u.useState(""),[Xs,gi]=u.useState(""),[Ol,pi]=u.useState(""),[El,xi]=u.useState(""),[yi,en]=u.useState(!1),[pm,bi]=u.useState(!1),[xm,Hb]=u.useState(null),[Ml,Wl]=u.useState(""),[Rl,Ll]=u.useState(""),[ym,Fl]=u.useState(!1),[bm,tn]=u.useState(!1),[vm,Bl]=u.useState(!1),[Ct,wm]=u.useState(null),[hs,$l]=u.useState(!1),[Ul,Nm]=u.useState(!1),[it,jm]=u.useState(null);u.useEffect(()=>{Ef().then(jm).catch(()=>{})},[]);const[Vl,Sm]=u.useState(void 0);u.useEffect(()=>{try{const a=window.electronAPI;a&&typeof a.appVersion=="function"&&a.appVersion().then(s=>{typeof s=="string"&&!s.startsWith("err:")&&Sm(s)}).catch(()=>{})}catch{}},[]);const ql=(()=>{var i,l;const a=(l=(i=import.meta)==null?void 0:i.env)==null?void 0:l.VITE_APP_VERSION,s=typeof window<"u"&&(window.electronAPI||window.location.protocol==="file:"||typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("electron"));if(s&&(n!=null&&n.desktopInstalledVersion))return n==null?void 0:n.desktopInstalledVersion;if(s&&Vl)return Vl;if(a)return a;if(!(!it&&!n))return W?(n==null?void 0:n.androidInstalledVersion)||(n==null?void 0:n.lastAckAndroidVersion)||(it==null?void 0:it.androidVersion)||(it==null?void 0:it.pcVersion):(it==null?void 0:it.pcVersion)||(it==null?void 0:it.androidVersion)})();u.useEffect(()=>{Wt&&(t!=null&&t.uid)&&!Ul&&(async()=>{en(!0);try{let s=[],i=[];try{const f=me(V,"users",t.uid,"branches");s=(await ke(f)).docs.map(v=>({id:v.id,...v.data(),source:"sub"}))}catch(f){console.warn("Failed to fetch subcollection branches:",f)}try{const f=Oe(me(V,"branches"),X("ownerId","==",t.uid));i=(await ke(f)).docs.map(v=>({id:v.id,...v.data(),source:"root"}))}catch(f){console.warn("Failed to fetch root branches:",f)}const l=[...s,...i],d=new Map;l.forEach(f=>{const g=f.branchUserId||f.id;(!d.has(g)||f.source==="sub")&&d.set(g,f)});const m=Array.from(d.values());console.log("Loaded branches:",m),us(m),Nm(!0)}catch(s){console.error("Error in branch loading process:",s),x({title:"تنبيه",description:"حدث خطأ أثناء تحديث القائمة",variant:"destructive"})}finally{en(!1)}})()},[Wt,t==null?void 0:t.uid,Ul]),u.useEffect(()=>{Wt||$l(!1)},[Wt]);const[Dm,an]=u.useState(!1),[fs,km]=u.useState(null),[sn,zl]=u.useState(""),[rn,Yl]=u.useState(""),[Cm,Im]=u.useState(""),[Kl,Jl]=u.useState(!1),_m=a=>{km(a),zl(a.branchName||""),Yl(a.managerName||""),Im(a.loginUsername||a.email||a.username||""),an(!0)},Am=async()=>{if(!(!fs||!sn||!rn)){Jl(!0);try{const a={branchName:sn,managerName:rn,updatedAt:new Date};if(fs.branchUserId)try{await Qt(Te(V,"users",(t==null?void 0:t.uid)||"","branches",String(fs.branchUserId)),a,{merge:!0});try{await Xt(Te(V,"users",fs.branchUserId),{displayName:sn,managerName:rn})}catch(s){console.warn("Could not update branch root user doc",s)}}catch(s){console.warn("Sub branch update failed:",s)}try{await Xt(Te(V,"branches",fs.id),a)}catch{}us(s=>s.map(i=>i.id===fs.id?{...i,...a}:i)),x({title:"تم تحديث بيانات الفرع بنجاح"}),an(!1)}catch(a){console.error("Error updating branch:",a),x({title:"فشل تحديث البيانات",description:a.message,variant:"destructive"})}finally{Jl(!1)}}},Tm=async a=>{if(!(a!=null&&a.branchUserId)){x({title:"خطأ",description:"بيانات الفرع غير مكتملة",variant:"destructive"});return}Bl(!0),tn(!0);try{const s=a.branchUserId;if(t!=null&&t.uid&&a.branchUserId&&a.source!=="sub")try{await Qt(Te(V,"users",t.uid,"branches",a.branchUserId),{branchUserId:a.branchUserId,branchName:a.branchName||"Unknown Branch",managerName:a.managerName||"",active:!0,lastSynced:ft()},{merge:!0}),console.log("✅ Branch link synced successfully"),await new Promise(Se=>setTimeout(Se,500))}catch(Se){console.error("❌ Failed to sync branch link:",Se)}const[i,l,d,m]=await Promise.all([ca(Te(V,"users",s)),(async()=>{try{const Se=Oe(me(V,"merchantWallets"),X("merchantUserId","==",s)),ce=await ke(Se);if(!ce.empty)return ce;const nt=await ke(me(V,"users",s,"wallets"));return nt.empty?await ke(Oe(me(V,"wallets"),X("userId","==",s))):nt}catch(Se){console.error("Error fetching wallets",Se);try{return await ke(Oe(me(V,"wallets"),X("userId","==",s)))}catch{return{docs:[]}}}})(),(async()=>{try{return await ke(Oe(me(V,"debts"),X("userId","==",s)))}catch{return await ke(me(V,"users",s,"debts"))}})(),(async()=>{try{const Se=Oe(me(V,"dailySales"),X("userId","==",s)),ce=await ke(Se);return ce.empty?await ke(me(V,"users",s,"dailySales")):ce}catch(Se){return console.error("Error fetching sales",Se),await ke(me(V,"users",s,"dailySales"))}})()]),f=i.exists()?i.data():{},g=Number(f.cashBalance||0),v=f.reportsData||{},y=Number(v.dailyProfit||0),p=Number(v.monthlyProfit||0),N=f.walletBalances||{},C=l.docs.filter(Se=>Se.data().isActive===!0),S=new Set(C.map(Se=>Se.id));let A=0;S.size>0&&(A=Object.entries(N).filter(([Se])=>S.has(Se)).reduce((Se,[ce,nt])=>Se+Number(nt||0),0)),A===0&&C.length>0&&(A=C.reduce((Se,ce)=>Se+Number(ce.data().balance||ce.data().amount||0),0));let O=0;d.forEach(Se=>{const ce=Se.data();if(ce.type!=="debtor"){const nt=Number(ce.paidAmount||0),ut=Math.max(0,Number(ce.amount||0)-nt);O+=ut}});const T=new Date().toISOString().split("T")[0],B=T.slice(0,7);let J=0,ne=0,tt=y,bt=p,dt=0;console.log(`Branch Details - UID: ${s}, Wallets: ${l.size}, Sales: ${m.size}, ReportsDaily: ${y}`),m.forEach(Se=>{const ce=Se.data(),nt=String(ce.date||""),ut=Number(ce.sellingPrice||0)*Number(ce.quantity||1),mt=Number(ce.profit||0);dt+=ut,nt===T&&(J+=ut,tt+=mt),nt.startsWith(B)&&(ne+=ut,bt+=mt)}),wm({branchName:a.branchName,managerName:a.managerName,todaySales:J,monthSales:ne,todayProfit:tt,monthProfit:bt,walletsTotal:A,cashBalance:g,totalSalesSection:dt,debtsTotal:O})}catch(s){console.error("Error fetching branch details:",s),x({title:"تعذر تحميل بيانات الفرع",description:s.message,variant:"destructive"}),tn(!1)}finally{Bl(!1)}},[E,Zs]=u.useState("");u.useEffect(()=>{const a=w==null?void 0:w.shopId;if(a&&(t!=null&&t.uid))try{const s=`selectedShopId_${t.uid}`;localStorage.setItem(s,String(a)),window.dispatchEvent(new Event("selectedShopIdChanged"))}catch{}},[w==null?void 0:w.shopId,t==null?void 0:t.uid]);const[vi,Pm]=u.useState([]),[Ya,Ka]=u.useState(()=>{try{return localStorage.getItem("cashySelectedDevice")||null}catch{return null}});u.useEffect(()=>{},[]),u.useEffect(()=>{(async()=>{if(E)try{await Rr.set({key:"selected_wallet_id",value:E}),console.log("📱 Synced selected_wallet_id to Native:",E)}catch(s){console.error("Failed to sync wallet to native:",s)}else await Rr.remove({key:"selected_wallet_id"})})()},[E]),u.useEffect(()=>{(async()=>{if(j)try{await Rr.set({key:"shopId",value:j}),console.log("📱 Synced shopId to Native:",j)}catch(s){console.error("Failed to sync shopId to native:",s)}})()},[j]);const wi=a=>!!(a&&vi.some(s=>s.id===a));async function Ni(){const a=window.electronAPI,s=Ya||"";if(!a||typeof a.sendUssd!="function")return null;if(!s)return x({title:"الجهاز غير محدد",description:"اتصل بالموبايل أولاً ثم اختر الجهاز من القائمة",variant:"destructive"}),null;if(wi(s))return s;try{const m=vi.find(f=>f&&f.id&&!String(f.id).includes(":"));if(m&&m.id)return Ka(m.id),m.id}catch{}const i=s.includes(":")?s.split(":").slice(0,2).join(":"):"";if(i&&typeof a.connectWifi=="function"){try{const m=await a.connectWifi(i);if(typeof m=="string"&&(m.includes("✅")||m.toLowerCase().includes("connected")))return s}catch{}if(typeof a.refreshAdbDevices=="function")try{await a.refreshAdbDevices()}catch{}await new Promise(m=>setTimeout(m,250))}const l=s.split(":")[0],d=vi.find(m=>(m.id.startsWith(l)||m.id.includes(l))&&m.id.includes(":"));if(d!=null&&d.id){const m=d.id.split(":").slice(0,2).join(":");if(!wi(d.id)&&typeof a.connectWifi=="function"){try{const f=await a.connectWifi(m);if(typeof f=="string"&&(f.includes("✅")||f.toLowerCase().includes("connected")))return Ka(d.id),d.id}catch{}await new Promise(f=>setTimeout(f,250))}if(wi(d.id))return Ka(d.id),d.id}return s&&i?s:(x({title:"الجهاز غير متصل",description:"فعّل Wireless debugging أو استخدم اتصال Wi‑Fi ثم أعد المحاولة",variant:"destructive"}),null)}u.useEffect(()=>{const a=window.electronAPI;a&&typeof a.onAdbDevices=="function"&&a.onAdbDevices(s=>{var m;const i=Array.isArray(s)?s:[];Pm(i);const l=(()=>{try{return localStorage.getItem("cashySelectedDevice")||""}catch{return""}})();if(l&&i.some(f=>f.id===l))Ka(l);else{const f=l?String(l).split(":")[0]:"",g=f?i.find(v=>(v.id.startsWith(f)||v.id.includes(f))&&String(v.type||"").toLowerCase().includes("wifi")):void 0;g!=null&&g.id?Ka(g.id):!l&&((m=i[0])!=null&&m.id)?Ka(v=>v||i[0].id):i.length||Ka(null)}})},[]);function Om(a,s){try{const i=Qe==null?void 0:Qe(),l=(i==null?void 0:i.phone)||"";if(!l){x({title:"يجب اختيار محفظة",description:"اختر محفظة المُرسل أولاً",variant:"destructive"});return}if(W&&l.startsWith("011")){sl("*777*1#"),x({title:"تم إرسال كود التحويل",description:"تم طلب كود اتصالات *777*1#"}),ra(!1),Sa(!1);return}Zf(l,a,s),x({title:"تم إرسال كود التحويل",description:"تم تنفيذ الاتصال مباشرة على الهاتف"}),ra(!1),Sa(!1)}catch(i){const l=(i==null?void 0:i.message)||"تعذر إرسال الكود — تحقق من البيانات";throw x({title:"فشل الإرسال",description:l,variant:"destructive"}),i}}const[Rt,ji]=u.useState(null),Em=async()=>{var f;if(!rt||!rt.receiver||!rt.amount){x({title:"بيانات غير مكتملة",description:"تأكد من إدخال رقم المستقبل والمبلغ قبل الإرسال",variant:"destructive"});return}const a=String(rt.receiver),s=Math.round(Number(rt.amount));na(!0);const i=Qe==null?void 0:Qe(),l=(i==null?void 0:i.phone)||"",d=Xf(l),m=window.electronAPI;if(d==="etisalat"&&l.startsWith("011")&&m&&typeof m.sendUssd=="function"&&Ya){try{const g=await Ni();if(!g){na(!1);return}let v=g;Rt!==null&&(v=`${g}:sim${Rt}`),so(v),await m.sendUssd(v,"*777*1#"),Tc(!0),ra(!1)}catch(g){console.error("Etisalat flow init error",g),x({title:"خطأ",description:"فشل بدء تحويل اتصالات: "+(g.message||""),variant:"destructive"})}finally{na(!1)}return}if(d==="orange"&&l.startsWith("012")&&m&&typeof m.sendUssd=="function"&&Ya){try{const g=await Ni();if(!g){na(!1);return}const v=`*7115*7*${a}*${s}#`;let y=g;Rt!==null&&(y=`${g}:sim${Rt}`),so(y),await m.sendUssd(y,v),Sa(!0),ra(!1)}catch(g){console.error("Orange flow init error",g),x({title:"خطأ",description:"فشل بدء تحويل أورنج: "+(g.message||""),variant:"destructive"})}finally{na(!1)}return}try{if((f=di)!=null&&f.isNativePlatform&&di.getPlatform()==="android"){const v=Qe==null?void 0:Qe(),y=(v==null?void 0:v.phone)||"";if(!y){x({title:"يجب اختيار محفظة",description:"اختر محفظة المُرسل أولاً",variant:"destructive"}),na(!1);return}if(y.startsWith("011")){sl("*777*1#",Rt===0?"sim1":Rt===1?"sim2":void 0),x({title:"تم الاتصال",description:"تم طلب كود اتصالات *777*1#"}),ra(!1),Sa(!1);return}const p=nu(y,a,s);if(!p){x({title:"رقم غير مدعوم",description:"تحقق من بداية الرقم 010/011/012/015",variant:"destructive"}),na(!1);return}sl(p,Rt===0?"sim1":Rt===1?"sim2":void 0),x({title:"تم إرسال كود التحويل",description:"تم تنفيذ الاتصال مباشرة على الهاتف"}),ra(!1),Sa(!1);return}const g=window.electronAPI;if(g&&typeof g.sendUssd=="function"&&Ya){const v=Qe==null?void 0:Qe(),y=(v==null?void 0:v.phone)||"";if(!y){x({title:"يجب اختيار محفظة",description:"اختر محفظة المُرسل أولاً",variant:"destructive"}),na(!1);return}const p=await Ni();if(!p){na(!1);return}const N=nu(y,a,s);if(!N){x({title:"رقم غير مدعوم",description:"تحقق من بداية الرقم 010/011/012/015",variant:"destructive"}),na(!1);return}try{let C="";if(Rt!==null)C=`${p}:sim${Rt}`;else{const S=typeof g.pickSimAutomatically=="function"?await g.pickSimAutomatically(p,y):{deviceId:p,slot:0};C=`${S.deviceId}:sim${S.slot}`}so(C),await g.sendUssd(C,N)}catch{try{await g.sendUssd(p,N)}catch(S){const A=p.includes(":")?p.split(":").slice(0,2).join(":"):"";if(A&&typeof g.connectWifi=="function")await g.connectWifi(A),await g.sendUssd(p,N);else throw S}}x({title:"تم إرسال كود التحويل",description:"تم التنفيذ بنجاح"}),ra(!1),Sa(!0)}else Om(a,s)}catch(g){const v=g&&g.message?g.message:"حدث خطأ غير متوقع أثناء الإرسال";x({title:"خطأ أثناء الإرسال",description:`الجهاز: ${ao||Ya||"غير معروف"} — ${v}`,variant:"destructive"})}finally{na(!1)}},Mm=async(a,s)=>{const i=window.electronAPI;try{if(i&&typeof i.enterPin=="function"&&a){await i.enterPin(a,s),Sa(!1);return}const l=String((n==null?void 0:n.bridgeLink)||"").trim(),d=String((n==null?void 0:n.bridgeDeviceId)||"").trim()||void 0;if(!l){x({title:"الرابط غير مُعدّ",description:"احفظ رابط الجسر أولاً",variant:"destructive"});return}const m=String((rt==null?void 0:rt.receiver)||xt||"").replace(/\D/g,""),f=Math.max(1,Math.round(Number((rt==null?void 0:rt.amount)||ot||0))||0),g=String(s||"").replace(/\D/g,""),y=(p=>{let N=(p||"").trim();return N=N.replace(/\/+$/,""),/^https?:\/\//i.test(N)||(N=`https://${N}`),N})(l);Sa(!1)}catch(l){const d=(l==null?void 0:l.message)||"حدث خطأ أثناء إدخال الرقم السري";x({title:"فشل الإدخال",description:d,variant:"destructive"})}};console.log("🔥 UserDashboardPage - user:",t?"exists":"null");const[er,Ma]=u.useState(!0),[Si,tr]=u.useState(!0),[Wm,Ja]=u.useState(!1),[Rm,gs]=u.useState(!1),[nn,Hl]=u.useState(""),[Di,Ql]=u.useState(""),[ki,Gl]=u.useState(""),[on,Ci]=u.useState([]),[Lm,ln]=u.useState(!1),[gt,ar]=u.useState(null),[ps,Ii]=u.useState(""),[Qb,Gb]=u.useState(!1),[Fm,_i]=u.useState(!1),[Bm,Wa]=u.useState(!1),[$m,sr]=u.useState(!1),[rr,Ai]=u.useState(""),[Xl,Ti]=u.useState(""),[Zl,xs]=u.useState([]),[Um,cn]=u.useState(!1),[Pi,ys]=u.useState({}),[dn,un]=u.useState(null),[ec,nr]=u.useState(""),[tc,ir]=u.useState(""),[Xb,ac]=u.useState(!1),[Zb,sc]=u.useState(0),[ev,rc]=u.useState(!1),[It,nc]=u.useState(null),[pt,Vm]=u.useState(null),[tv,ic]=u.useState(!1),[qt,bs]=u.useState(""),[xt,or]=u.useState(""),[ot,vs]=u.useState(""),[Ha,oc]=u.useState(""),[lr,lc]=u.useState(""),[Oi,ws]=u.useState(!1),[Ei,Mi]=u.useState(""),[qm,Qa]=u.useState(""),[cc,dc]=u.useState(""),[Wi,zm]=u.useState(""),[ta,Ri]=u.useState(null),[Ym,uc]=u.useState(!1),[Km,mc]=u.useState(!1),[Jm,mn]=u.useState(!1),[Hm,Li]=u.useState(!1),[hc,Fi]=u.useState(null),[st,hn]=u.useState(""),[yt,fn]=u.useState(""),[fc,Qm]=u.useState(""),[Gm,gc]=u.useState(!1),[av,sv]=u.useState(null),[Bi,pc]=u.useState(null),[Xm,$i]=u.useState(!1);u.useEffect(()=>{(async()=>{try{const s=t!=null&&t.uid?`withdrawSenderNameInputEnabled_${t==null?void 0:t.uid}`:"withdrawSenderNameInputEnabled";let i=null;try{i=localStorage.getItem(s)??localStorage.getItem("withdrawSenderNameInputEnabled")}catch{}if(t!=null&&t.uid)try{const l=await ss(()=>ae.getUserData(t.uid)),d=l==null?void 0:l.withdrawSenderNameInputEnabled;if(typeof d=="boolean"){$i(d);try{localStorage.setItem(s,d?"true":"false")}catch{}return}}catch{}$i(i==="true")}catch{$i(!1)}})()},[t==null?void 0:t.uid]),u.useEffect(()=>{try{const a=`clientNumberAssignments_${(t==null?void 0:t.uid)||"default"}`,s=localStorage.getItem(a);if(!s){ys({});return}const i=JSON.parse(s);if(i&&typeof i=="object"){const l={};Object.entries(i).forEach(([d,m])=>{if(typeof m=="string")l[d]={name:m,amount:""};else if(m&&typeof m=="object"){const f=m,g=typeof f.name=="string"?f.name:"",v=typeof f.amount=="string"||typeof f.amount=="number"?String(f.amount):"";(g||v)&&(l[d]={name:g,amount:v})}}),ys(l)}else ys({})}catch{ys({})}},[t==null?void 0:t.uid]);const cr=a=>{const s="٠١٢٣٤٥٦٧٨٩",i="۰۱۲۳۴۵۶۷۸۹";return(a||"").split("").map(l=>{const d=s.indexOf(l);if(d>-1)return String(d);const m=i.indexOf(l);return m>-1?String(m):l}).join("")},[$e,Zm]=u.useState(!0),Ui=G.useMemo(()=>{if((n==null?void 0:n.transferFeesEnabled)!==void 0)return n.transferFeesEnabled;try{const a=t!=null&&t.uid?`transferFeesEnabled_${t.uid}`:"transferFeesEnabled";return(localStorage.getItem(a)??localStorage.getItem("transferFeesEnabled"))!=="false"}catch{return!0}},[n,t==null?void 0:t.uid]),[L,Vi]=u.useState("transfer"),eh=G.useMemo(()=>{const a=cr(qt||"").replace(/\D/g,""),s=cr(xt||"").replace(/\D/g,"");return!Ui||L!=="transfer"?!1:a.startsWith("010")&&s.startsWith("010")||a.startsWith("010")&&(s.startsWith("011")||s.startsWith("012")||s.startsWith("015"))||a.startsWith("012")&&s.startsWith("010")||a.startsWith("011")&&s.startsWith("010")||a.startsWith("015")&&s.startsWith("010")},[qt,xt,Ui,L]),[oe,zt]=u.useState([]),[aa,gn]=u.useState("all"),[_e,Lt]=u.useState([]),[qi,th]=u.useState(!1),[zi,ah]=u.useState([]),[Ns,sh]=u.useState(new Date().toISOString().split("T")[0]),[Ga,xc]=u.useState("day");u.useEffect(()=>{if(!qi||!(t!=null&&t.uid))return;(async()=>{try{let s;if(Ga==="day"){const d=new Date(Ns);d.setHours(0,0,0,0);const m=new Date(Ns);m.setHours(23,59,59,999),s=Oe(me(V,"debtReceipts"),X("userId","==",t.uid),X("createdAt",">=",d),X("createdAt","<=",m),al("createdAt","desc"))}else{const[d,m]=Ns.split("-").map(Number),f=new Date(d,m-1,1),g=new Date(d,m,0,23,59,59,999);s=Oe(me(V,"debtReceipts"),X("userId","==",t.uid),X("createdAt",">=",f),X("createdAt","<=",g),al("createdAt","desc"))}const l=(await ke(s)).docs.map(d=>({id:d.id,...d.data()}));ah(l)}catch(s){console.error("Error fetching debt receipts:",s),x({title:"خطأ",description:"تعذر تحميل سجل السداد",variant:"destructive"})}})()},[qi,t==null?void 0:t.uid,Ns,Ga]);const ja=u.useRef([]),[Yi,Ki]=u.useState(!1),[Ra,rh]=u.useState(""),[pn,nh]=u.useState("daily"),[La,ih]=u.useState(""),[js,dr]=u.useState(null),oh=a=>{if(!a){dr(null);return}const s=new Date(a),i=new Date(s.setHours(0,0,0,0)),l=new Date(s.setHours(23,59,59,999)),d=oe.filter(p=>{const N=new Date(p.createdAt);return N>=i&&N<=l});let m=0,f=0,g=0,v=0,y=0;d.forEach(p=>{m++,f+=Number(p.amount||0);const N=(p.type||p.txnType||"").toLowerCase(),C=N==="machine_withdrawal"||p.title==="إيصال سحب فوري";!C&&(N==="withdraw"||N==="withdrawal"||N==="receive")?g+=Number(p.amount||0):!C&&(N==="send"||N==="transfer")&&(v+=Number(p.amount||0)),y+=xa.calculateProfitFromTransaction(p)}),dr({count:m,totalAmount:f,totalWithdrawn:g,totalSent:v,totalProfit:y})},lh=a=>{if(!a){dr(null);return}const[s,i]=a.split("-"),l=Number(s),d=Number(i)-1,m=new Date(l,d,1,0,0,0,0),f=new Date(l,d+1,0,23,59,59,999),g=oe.filter(S=>{const A=new Date(S.createdAt),O=String(S.status||S.status||"completed").toLowerCase();return A>=m&&A<=f&&(O==="completed"||O==="confirmed")});let v=0,y=0,p=0,N=0,C=0;g.forEach(S=>{v++,y+=Number(S.amount||0);const A=(S.type||S.txnType||"").toLowerCase(),O=A==="machine_withdrawal"||S.title==="إيصال سحب فوري";!O&&(A==="withdraw"||A==="withdrawal"||A==="receive")?p+=Number(S.amount||0):!O&&(A==="send"||A==="transfer")&&(N+=Number(S.amount||0)),C+=xa.calculateProfitFromTransaction(S)}),dr({count:v,totalAmount:y,totalWithdrawn:p,totalSent:N,totalProfit:C})};u.useEffect(()=>{Yi&&(pn==="daily"&&Ra?oh(Ra):pn==="monthly"&&La?lh(La):dr(null))},[Ra,La,pn,oe,Yi]);const ur=qr({enabled:!!(t!=null&&t.uid),queryKey:["recentTransactions",t==null?void 0:t.uid,j||"main"],queryFn:async()=>{const{collection:a,query:s,where:i,orderBy:l,limit:d,getDocs:m}=await Z(async()=>{const{collection:_,query:T,where:B,orderBy:J,limit:ne,getDocs:tt}=await import("./index-CzMrJEuC.js").then(bt=>bt.cC);return{collection:_,query:T,where:B,orderBy:J,limit:ne,getDocs:tt}},__vite__mapDeps([0,1]),import.meta.url),{db:f}=await Z(async()=>{const{db:_}=await import("./index-CzMrJEuC.js").then(T=>T.cD);return{db:_}},__vite__mapDeps([0,1]),import.meta.url),g=s(a(f,"userTransactions"),i("userId","==",String((t==null?void 0:t.uid)||"")),l("createdAt","desc"),d(100)),p=(await m(g)).docs.map(_=>{var ce;const T=_.data(),B=(ce=T.createdAt)!=null&&ce.toDate?T.createdAt.toDate():new Date(T.createdAt),J=String(T.transactionType||T.txnType||T.type||"").toLowerCase();let ne="send";J==="withdraw"||J==="receive"?ne="withdraw":J==="machine_withdrawal"?ne="machine_withdrawal":J==="cash_addition"||J==="add"?ne="cash_addition":ne="send";const tt=T.status==="confirmed"?"completed":T.status||"completed",bt=T.senderMsisdn||T.senderPhone||"",dt=T.receiverMsisdn||T.receiverPhone||"",Se=Number(T.amount??T.transferredAmount??T.withdrawnAmount??0);return{id:_.id,...T,type:ne,status:tt,senderPhone:bt,receiverPhone:dt,amount:Se,createdAt:B}}).filter(_=>!((_==null?void 0:_.type)==="report"||String((_==null?void 0:_.title)||"").includes("إيصال تسليم وردية"))),N=new Set((hr||[]).map(_=>String(_.id||_.originalTransactionId||""))),C=p.filter(_=>!N.has(String(_.id||""))),S=_=>{var T;return String(_.transactionId||_.id||_.reference||((T=_.receipt)==null?void 0:T.reference)||`${new Date(_.createdAt).getTime()}`)},A=new Set,O=[];for(const _ of C){const T=S(_);A.has(T)||(A.add(T),O.push(_))}return O},staleTime:6e4,gcTime:3e5,refetchOnWindowFocus:!1,refetchOnReconnect:!0});u.useEffect(()=>{const a=()=>{try{ur.refetch()}catch{}};return window.addEventListener("transaction-created",a),()=>{window.removeEventListener("transaction-created",a)}},[ur]),u.useEffect(()=>{const a=ur.data;if(a&&Array.isArray(a)){const s=ja.current,i=Date.now(),l=s.filter(g=>{const v=a.some(N=>N.id===g.id),y=g.reference?a.some(N=>N.reference===g.reference):!1,p=i-new Date(g.createdAt).getTime()>3e5;return!v&&!y&&!p});ja.current=l;const d=[...l,...a].sort((g,v)=>new Date(v.createdAt).getTime()-new Date(g.createdAt).getTime()),m=new Set,f=[];for(const g of d)m.has(g.id)||(m.add(g.id),f.push(g));zt(f)}},[ur.data]),u.useEffect(()=>{try{if(localStorage.setItem("commissionMode",$e?"add":"deduct"),t!=null&&t.uid){const a=`commissionMode_${t.uid}`;localStorage.setItem(a,$e?"add":"deduct")}}catch{}},[$e,t==null?void 0:t.uid]),u.useEffect(()=>{try{const a=new Set((oe||[]).filter(l=>String((l==null?void 0:l.status)||"")==="completed"&&(l==null?void 0:l.linkedDebtId)).map(l=>String(l.linkedDebtId)));if(a.size===0||_e.length===0)return;const s=_e.map(l=>{if(!a.has(String(l.id)))return l;const d=Number(l.amount||0),m=Number(l.paidAmount||0),f=Array.isArray(l.partialPayments)?l.partialPayments.reduce((v,y)=>v+Number(y.amount||0),0):0;return m+f>=d&&l.status!=="paid"?{...l,amount:d,paidAmount:d,status:"paid"}:m>d?{...l,amount:d,paidAmount:d}:l});if(s.some((l,d)=>l!==_e[d])){Lt(s),(async()=>await Da(s))();try{t!=null&&t.uid&&s.filter((d,m)=>d!==_e[m]&&d.status==="paid").forEach(d=>{try{const m=Number(d.paidAmount||0),f=m>0?m:Number(d.amount||0);ns.send(t.uid,`تم سداد الدين بالكامل للعميل ${d.debtorName}: المدفوع ${f} جنيه`).catch(()=>{})}catch{}})}catch{}}}catch{}},[oe,_e,t==null?void 0:t.uid]),u.useEffect(()=>{try{const a=t!=null&&t.uid?localStorage.getItem(`commissionMode_${t.uid}`):null,s=localStorage.getItem("commissionMode"),i=localStorage.getItem("commissionMode_default"),l=a??s??i;l&&Zm(l==="add")}catch{}},[t==null?void 0:t.uid]);const[Ji,Ss]=u.useState(!1),[ch,dh]=u.useState(null),xn=G.useRef(""),yc=G.useRef(0);u.useEffect(()=>{const a=s=>{var l;if(Ji)return;try{const d=document.activeElement;if(d){const m=(l=d.tagName)==null?void 0:l.toLowerCase();if(m==="input"||m==="textarea"||m==="select"||m==="button"||d.isContentEditable===!0)return}}catch{}const i=Date.now();if(s.key==="Enter"){const d=(xn.current||"").trim();xn.current="",d&&(dh(d),Ss(!0));return}s.key.length===1&&(i-(yc.current||0)>100&&(xn.current=""),xn.current+=s.key,yc.current=i)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[Ji]);const[uh,mh]=u.useState(!1),[hh,Hi]=u.useState(!1),[fh,rv]=u.useState(null);u.useEffect(()=>{if(!Oi)return;const a=Qe(),s=parseFloat(ot||"0")||0;let i=0;if(L==="transfer"){if((a==null?void 0:a.defaultTransferCommission)!=null){const d=Number(a.defaultTransferCommission)||0;i=Math.round(d*s/1e3*100)/100}else{const d=yt&&yt.trim()!==""?parseFloat(yt):0;i=Math.max(0,d)}const l=s+i;Qa((l||0).toString())}else{if((a==null?void 0:a.defaultWithdrawCommission)!=null){const d=Number(a.defaultWithdrawCommission)||0;i=Math.round(d*s/1e3*100)/100}else{const d=st&&st.trim()!==""?parseFloat(st):Math.round(s*.01*100)/100;i=Math.max(0,d)}const l=$e?s:Math.max(0,Math.round((s-i)*100)/100);Qa((l||0).toString())}},[Oi,ot,yt,st,E,$e,L]);const Qe=()=>{var s,i;let a=$.find(l=>l.id===E);if(!a)try{const l=localStorage.getItem(bd());if(l){const d=JSON.parse(l);if(Array.isArray(d)&&d.length>0){const f=localStorage.getItem(ts())||((s=d.find(g=>g.isDefault))==null?void 0:s.id)||((i=d[0])==null?void 0:i.id);a=d.find(g=>g.id===f)}}}catch{}return a};u.useLayoutEffect(()=>{try{const a=`wallets_${(t==null?void 0:t.uid)||"default"}`;let s=localStorage.getItem(a);if(!s){const i=Object.keys(localStorage).find(l=>l.startsWith("wallets_"));i&&(s=localStorage.getItem(i)||null)}if(s){const i=JSON.parse(s);if(Array.isArray(i)&&i.length>0){Y(i);const l=localStorage.getItem(ts()),d=l&&i.find(m=>m.id===l)||i.find(m=>m.isDefault)||i[0];d&&(Zs(d.id),bs(d.phone))}}}catch(a){console.error("تهيئة فورية للمحافظ من التخزين المحلي فشلت:",a)}},[]),u.useEffect(()=>{console.log("🔍 selectedWallet state changed to:",E)},[E]),u.useEffect(()=>{xd()},[t==null?void 0:t.uid]),u.useEffect(()=>{A0()},[]);const yn=qr({enabled:!!(t!=null&&t.uid),queryKey:["wallets",t==null?void 0:t.uid],queryFn:async()=>{const{merchantWalletService:a}=await Z(async()=>{const{merchantWalletService:l}=await import("./index-CzMrJEuC.js").then(d=>d.cE);return{merchantWalletService:l}},__vite__mapDeps([0,1]),import.meta.url),s=await a.getByMerchantId(String((t==null?void 0:t.uid)||""));return(Array.isArray(s)?s:[]).filter(l=>l.isActive===!0).map(l=>({id:l.id,name:l.label||"محفظة بدون اسم",phone:l.msisdn,isDefault:!!l.isDefault,monthlyWithdrawalLimit:l.monthlyWithdrawalLimit??l.withdrawLimit??2e5,monthlyTransferLimit:l.monthlyTransferLimit??l.transferLimit??2e5,defaultTransferCommission:l.defaultTransferCommission!=null?Number(l.defaultTransferCommission):null,defaultWithdrawCommission:l.defaultWithdrawCommission!=null?Number(l.defaultWithdrawCommission):null}))},staleTime:6e4,gcTime:3e5,refetchOnReconnect:!0});u.useEffect(()=>{var s;const a=yn.data;if(a&&Array.isArray(a)){Y(a);const i=localStorage.getItem(ts());if(!!!(E&&a.find(d=>d.id===E))){const d=i&&a.find(m=>m.id===i)?i:((s=a[0])==null?void 0:s.id)||"";if(d){Zs(d);const m=a.find(f=>f.id===d);bs(String((m==null?void 0:m.phone)||""))}}}},[yn.data]),u.useEffect(()=>{const a=s=>{const{cashBalance:i,walletBalances:l,newTransaction:d,limitUpdate:m,delta:f}=s.detail||{};if(f){const{amount:g,type:v,walletId:y,commission:p}=f,N=Number(g||0),C=Number(p||0);Ze(S=>{let A=0;v==="withdraw"?A=-N+C:(v==="send"||v==="transfer")&&(A=N+C);const O=S+A;try{const _=Ve();localStorage.setItem(_,String(O));const T=new Date().toISOString();if(localStorage.setItem(_+"_lastUpdated",T),t!=null&&t.uid){const B=`userData_${t.uid}`,J=localStorage.getItem(B),tt={...J?JSON.parse(J):{},cashBalance:O,lastUpdated:T};localStorage.setItem(B,JSON.stringify(tt)),pe(!0)}}catch{}return O}),y&&ct(S=>{const A=Number(S[y]||0);let O=0;v==="withdraw"?O=N:(v==="send"||v==="transfer")&&(O=-N);const _=A+O,T={...S,[y]:_};try{const B=et();localStorage.setItem(B,JSON.stringify(T));const J=new Date().toISOString();if(localStorage.setItem(B+"_lastUpdated",J),t!=null&&t.uid){const ne=`userData_${t.uid}`,tt=localStorage.getItem(ne),dt={...tt?JSON.parse(tt):{},walletBalances:T,lastUpdated:J};localStorage.setItem(ne,JSON.stringify(dt)),pe(!0)}}catch{}return T})}if(typeof i=="number"){Ze(i);try{const g=Ve();localStorage.setItem(g,String(i));const v=new Date().toISOString();if(localStorage.setItem(g+"_lastUpdated",v),t!=null&&t.uid){const y=`userData_${t.uid}`,p=localStorage.getItem(y),C={...p?JSON.parse(p):{},cashBalance:i,lastUpdated:v};localStorage.setItem(y,JSON.stringify(C)),pe(!0)}}catch{}}if(l&&typeof l=="object"){ct(l);try{const g=et();localStorage.setItem(g,JSON.stringify(l));const v=new Date().toISOString();if(localStorage.setItem(g+"_lastUpdated",v),t!=null&&t.uid){const y=`userData_${t.uid}`,p=localStorage.getItem(y),C={...p?JSON.parse(p):{},walletBalances:l,lastUpdated:v};localStorage.setItem(y,JSON.stringify(C)),pe(!0)}}catch{}}if(m&&m.walletId===E&&As(g=>{if(!g)return g;const v=Number(m.amount||0),y=m.type==="transfer",p={...g};return y?(p.dailyTransferUsed=(p.dailyTransferUsed||0)+v,p.monthlyTransferUsed=(p.monthlyTransferUsed||0)+v):(p.dailyWithdrawUsed=(p.dailyWithdrawUsed||0)+v,p.monthlyWithdrawUsed=(p.monthlyWithdrawUsed||0)+v),p}),d){const g=d.type==="machine_withdrawal"||d.txnType==="machine_withdrawal",v=Sc.current||[];if(g&&v.find(p=>{if((p.type||p.txnType)!=="machine_withdrawal")return!1;const C=Number(p.amount)===Number(d.amount),S=p.senderName===d.senderName,A=new Date(p.createdAt).getTime(),O=new Date(d.createdAt||Date.now()).getTime(),_=Math.abs(O-A);return C&&S&&_<6e4})){console.log("Skipping duplicate machine withdrawal event (fuzzy match):",d);return}try{ja.current&&(ja.current.some(y=>y.id===d.id)||ja.current.push(d))}catch{}zt(y=>y.some(p=>p.id===d.id)?y:[d,...y]),x({title:"تم تسجيل عملية خارجية",description:"تم تحديث الأرصدة والسجلات بنجاح"});try{ur.refetch()}catch{}}};return window.addEventListener("dashboard:external-update",a),()=>window.removeEventListener("dashboard:external-update",a)},[E]);const[bc,gh]=u.useState(""),vc=(()=>{const a=bc.replace(/\D/g,"");return a?$.filter(s=>(s.phone||"").replace(/\D/g,"").includes(a)):$})();u.useEffect(()=>{(async()=>{try{let s=[];if(t!=null&&t.uid)try{const i=await ss(()=>ae.getUserData(t.uid)),l=i==null?void 0:i.favoriteWalletIds;Array.isArray(l)&&(s=l.map(d=>String(d)))}catch{}if(!s.length)try{const i=t!=null&&t.uid?`favoriteWallets_${t.uid}`:"favoriteWallets",l=localStorage.getItem(i)??localStorage.getItem("favoriteWallets");if(l){const d=JSON.parse(l);Array.isArray(d)&&(s=d.filter(m=>typeof m=="string"))}}catch{}s.length&&Dt(s)}catch{Dt([])}})()},[t==null?void 0:t.uid]),u.useEffect(()=>{try{const a=t!=null&&t.uid?`favoriteWallets_${t.uid}`:"favoriteWallets";localStorage.setItem(a,JSON.stringify(z)),t!=null&&t.uid&&ae.updateUserData(t.uid,{favoriteWalletIds:z})}catch{}},[z,t==null?void 0:t.uid]);const wc=G.useMemo(()=>{const a=new Set(z);return[...vc].sort((s,i)=>{const l=a.has(s.id),d=a.has(i.id);return l===d?0:l?-1:1})},[vc,z]),ph=a=>{Dt(s=>s.includes(a)?s.filter(i=>i!==a):[...s,a])},[xh,nv]=u.useState(null),[yh,Nc]=u.useState(!1),[bh,bn]=u.useState(!1),[vh,wh]=u.useState(null),[iv,Nh]=u.useState([]),[ov,lv]=u.useState([]),[jh,mr]=u.useState(!1),[Qi,jc]=u.useState("daily"),[hr,fr]=u.useState([]),[Sh,cv]=u.useState(!1),ha=G.useRef(new Set);G.useRef(new Set);const Sc=G.useRef([]);u.useEffect(()=>{Sc.current=oe},[oe]);const Gi=async a=>{try{if(!t)return;const s=Ve(),i=et(),l=localStorage.getItem(s),d=localStorage.getItem(i);let m=l?parseFloat(l):We,f=d?JSON.parse(d):{...we};const g=Number(a.withdrawnAmount??a.sentAmount??a.transferredAmount??a.amount??0);if(a.type==="send"&&(a.fromWallet||E)){m-=g;const N=a.fromWallet||E;f[N]=(f[N]||0)+g}else if(a.type==="withdraw"&&(a.fromWallet||E)){m+=g;const N=a.fromWallet||E;f[N]=Math.max(0,(f[N]||0)-g)}Ze(m),ct(f);const v=new Date().toISOString();localStorage.setItem(s,m.toString()),localStorage.setItem(s+"_lastUpdated",v),localStorage.setItem(i,JSON.stringify(f)),localStorage.setItem(i+"_lastUpdated",v);const y={cashBalance:m,walletBalances:f,lastUpdated:new Date().toISOString()},p=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(p,JSON.stringify(y));try{await ae.updateUserData(t.uid,y),localStorage.removeItem(p),pe(!1)}catch(N){console.warn("تعذر حفظ الأرصدة في Firebase بعد الحذف (مزامنة تلقائية):",N),pe(!0)}try{const N=a.fromWallet||E,C=a.type==="send"?"transfer":"withdraw";await cs.rollbackUsage(N,g,C,a.createdAt)}catch(N){console.warn("تعذر تحديث حدود المحفظة بعد الحذف (مزامنة):",N)}try{St.removeTransactionEffects(a,t.uid)}catch(N){console.warn("تعذر تحديث التقارير بعد الحذف (مزامنة):",N)}}catch(s){console.warn("خطأ أثناء تطبيق تأثيرات الحذف محليًا:",s)}},Dh=async a=>{try{const s=oe.find(f=>f.id===a);if(!s||!t)return;const i=String(a),l=String((s==null?void 0:s.transactionId)||(s==null?void 0:s.reference)||""),d=ha.current.has(i)||l&&ha.current.has(l),m=oe.filter(f=>f.id!==a);zt(m);try{await ae.removeUserTransaction(t.uid,a),await Ur.permanentlyDeleteTransaction(a,t.uid)}catch(f){console.warn("تعذر الحذف النهائي من قواعد البيانات أثناء حذف الإيصال:",f)}if(!d){ha.current.add(i),l&&ha.current.add(l),await Gi(s);try{t!=null&&t.uid&&ae.removeLocalReceiptById(t.uid,a)}catch{}}x({title:"تم الحذف نهائيًا",description:"تم حذف الإيصال نهائيًا وعكس تأثيراته على الأرصدة والحدود والتقارير."}),bn(!1)}catch(s){console.error("خطأ أثناء حذف الإيصال:",s),x({title:"خطأ في حذف الإيصال",description:"حدث خطأ غير متوقع أثناء الحذف.",variant:"destructive"})}},kh=async a=>{try{const s=oe.find(i=>i.id===a);if(!s||!t)return;try{const i=It==null?void 0:It.planType;if(i===Zt.ZERO){const{dailyOperationCountService:l}=await Z(async()=>{const{dailyOperationCountService:f}=await import("./dailyOperationCountService-BnqD6y-f.js");return{dailyOperationCountService:f}},__vite__mapDeps([68,0,1]),import.meta.url),d=s.type==="send"?"transfer":"withdraw";if(!(await l.checkAndIncrement(t.uid,d,5)).allowed){x({title:"تم بلوغ حد باقة الزيرو",description:"مسموح بحد أقصى 5 تأكيدات يوميًا للتحويل/السحب. جرّب غدًا أو قم بالترقية.",variant:"destructive"});return}}else if(i===Zt.TAHWEELA){const{dailyOperationCountService:l}=await Z(async()=>{const{dailyOperationCountService:f}=await import("./dailyOperationCountService-BnqD6y-f.js");return{dailyOperationCountService:f}},__vite__mapDeps([68,0,1]),import.meta.url),d=s.type==="send"?"transfer":"withdraw";if(!(await l.checkAndIncrementCombined(t.uid,d,40)).allowed){x({title:"تم بلوغ حد باقة تحويله",description:"هذه الباقة تسمح بحد أقصى 40 عملية تحويل/سحب يومياً.",variant:"destructive"});return}}}catch(i){console.warn("تعذر التحقق من حد التأكيد اليومي:",i)}await Xt(Te(V,"userTransactions",a),{status:"completed",confirmedAt:new Date}),zt(i=>i.map(l=>l.id===a?{...l,status:"completed"}:l)),x({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),bn(!1)}catch(s){console.error("خطأ أثناء إكمال الإيصال:",s),x({title:"فشل الإكمال",description:"حدث خطأ غير متوقع أثناء تحديث الحالة.",variant:"destructive"})}};u.useEffect(()=>{if(!t)return;(async()=>{try{const s=Oe(me(V,"deletedTransactions"),X("userId","==",t.uid),al("createdAt","desc"),Qf(50));(await ke(s)).docs.forEach(l=>{const d=l.data(),m=String((d==null?void 0:d.originalTransactionId)||""),f=String((d==null?void 0:d.transactionId)||""),g=String((d==null?void 0:d.reference)||""),v=m||f||g||String(l.id);v&&(ha.current.has(v)||(ha.current.add(v),zt(y=>{const p=y.find(N=>N.id===m);return p?((async()=>await Gi(p))(),y.filter(N=>N.id!==m)):y})))})}catch(s){console.warn("تعذر جلب المعاملات المحذوفة:",s)}})()},[t==null?void 0:t.uid]),u.useEffect(()=>{if(!t)return;(async()=>{try{const s=Te(V,"users",t.uid),i=await ca(s);if(!i.exists())return;const l=i.data();if(!(l!=null&&l.reportsData))return;try{await St.syncReportsDataFromFirebase(t.uid),Nh(Ld())}catch(d){console.warn("تعذر مزامنة reportsData من السحابة:",d)}}catch(s){console.warn("تعذر جلب users.reportsData:",s)}})()},[t==null?void 0:t.uid]);const[Dc,Ch]=u.useState(""),kc=mb(Dc,300),[vn,Cc]=u.useState(""),[wn,Ic]=u.useState(""),[fa,dv]=u.useState(""),[Xi,Ds]=u.useState(!1),[Zi,gr]=u.useState(!1),[Ih,_c]=u.useState(null),[sa,eo]=u.useState(!1),[_h,ra]=u.useState(!1),[Ue,to]=u.useState(null),[rt,Ah]=u.useState(null),[Ac,na]=u.useState(!1),[Th,Sa]=u.useState(!1),[Ph,Tc]=u.useState(!1),[ao,so]=u.useState(""),[Oh,ro]=u.useState(!1),[Eh,pr]=u.useState(!1),[Mh,Pc]=u.useState(!1),[Wh,Nn]=u.useState(!1),[Rh,Oc]=u.useState(!1),[Lh,xr]=u.useState(!1),[Fh,yr]=u.useState(!1),[Bh,br]=u.useState(!1),[$h,no]=u.useState(()=>{try{const a=t!=null&&t.uid?`monthlyReportsLockEnabled_${t==null?void 0:t.uid}`:"monthlyReportsLockEnabled";return(localStorage.getItem(a)??localStorage.getItem("monthlyReportsLockEnabled"))==="true"}catch{return!1}});u.useEffect(()=>{try{const a=t!=null&&t.uid?`monthlyReportsLockEnabled_${t==null?void 0:t.uid}`:"monthlyReportsLockEnabled",s=localStorage.getItem(a)??localStorage.getItem("monthlyReportsLockEnabled");no(s==="true")}catch{}},[t==null?void 0:t.uid]);const[vr,Uh]=u.useState(!1),[Vh,jn]=u.useState(!1),[qh,Ec]=u.useState(!1),[Sn,zh]=u.useState(""),[Mc,Yh]=u.useState(!1),[Kh,io]=u.useState(!1),[Yt,Wc]=u.useState(()=>{try{const a=(t==null?void 0:t.uid)||"default",s=localStorage.getItem(`hiddenQuickActions_${a}`)??localStorage.getItem("hiddenQuickActions"),i=s?JSON.parse(s):[];return Array.isArray(i)?i.filter(l=>typeof l=="string"):[]}catch{return[]}}),[Jh,Rc]=u.useState(()=>{try{const a=t!=null&&t.uid?`dailyReportsLockEnabled_${t==null?void 0:t.uid}`:"dailyReportsLockEnabled";return(localStorage.getItem(a)??localStorage.getItem("dailyReportsLockEnabled"))==="true"}catch{return!1}}),[Hh,oo]=u.useState(!1);u.useEffect(()=>{try{const a=t!=null&&t.uid?`dailyReportsLockEnabled_${t==null?void 0:t.uid}`:"dailyReportsLockEnabled",s=localStorage.getItem(a)??localStorage.getItem("dailyReportsLockEnabled");Rc(s==="true")}catch{}},[t==null?void 0:t.uid]);const[Qh,ks]=u.useState(!1),[Gh,lo]=u.useState(!1),[Xh,Lc]=u.useState(()=>{try{const a=t==null?void 0:t.uid,s=a?`debtsPinRequired_${a}`:"debtsPinRequired";return(localStorage.getItem(s)??localStorage.getItem("debtsPinRequired"))==="true"}catch{return!1}}),[Zh,Fc]=u.useState(!1),[Bc,e0]=u.useState(null),[co,$c]=u.useState(""),[uo,Uc]=u.useState(""),[mo,Vc]=u.useState(""),[ga,qc]=u.useState(null),[R,wr]=u.useState(null),[t0,Fa]=u.useState(!1),[a0,Dn]=u.useState(!1),[pa,s0]=u.useState(null),[zc,Yc]=u.useState(""),[Kc,kn]=u.useState(""),[Ge,Jc]=u.useState(null),[uv,mv]=u.useState(!1),[r0,Cn]=u.useState(!1),[Hc,Nr]=u.useState(""),[ho,Xa]=u.useState(!1),[Qc,fo]=u.useState(1),n0=W?10:20,go=G.useMemo(()=>_e.slice(0,Qc*n0),[_e,Qc]);u.useEffect(()=>{ho&&fo(1)},[ho]),u.useEffect(()=>{try{const a=(t==null?void 0:t.uid)||"default",s=localStorage.getItem(`hiddenQuickActions_${a}`)??localStorage.getItem("hiddenQuickActions"),i=s?JSON.parse(s):[];Array.isArray(i)&&Wc(i.filter(l=>typeof l=="string"))}catch{}},[t==null?void 0:t.uid]),u.useEffect(()=>{const a=s=>{var i;try{const l=(i=s==null?void 0:s.detail)==null?void 0:i.hiddenQuickActions;Array.isArray(l)&&Wc(l.map(d=>String(d)))}catch{}};try{window.addEventListener("hiddenQuickActionsChanged",a)}catch{}return()=>{try{window.removeEventListener("hiddenQuickActionsChanged",a)}catch{}}},[]);const In=async()=>{if(Ne){x({title:"غير متاح",description:"إدارة الديون/الأجل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"});return}try{const a=await Bt.hasMasterPin(t==null?void 0:t.uid);Xh&&a?lo(!0):ks(!0)}catch{ks(!0)}};u.useEffect(()=>{try{const a=t==null?void 0:t.uid,s=a?`debtsPinRequired_${a}`:"debtsPinRequired",i=localStorage.getItem(s)??localStorage.getItem("debtsPinRequired");(i==="true"||i==="false")&&Lc(i==="true")}catch{}},[t==null?void 0:t.uid]),u.useEffect(()=>{const a=()=>{try{_o()}catch{}};try{window.addEventListener("debtsUpdated",a)}catch{}return()=>{try{window.removeEventListener("debtsUpdated",a)}catch{}}},[t==null?void 0:t.uid,j,n==null?void 0:n.shopId]);const[i0,po]=u.useState(!1),[Cs,xo]=u.useState("customers_list"),[_t,yo]=u.useState([]),[bo,Gc]=u.useState(""),[vo,Xc]=u.useState(""),[Za,Zc]=u.useState(""),[ed,o0]=u.useState(""),[l0,_n]=u.useState(!1),[c0,td]=u.useState(""),[ad,wo]=u.useState(""),[sd,No]=u.useState(""),[d0,An]=u.useState(!1),[u0,jo]=u.useState(""),[rd,So]=u.useState(""),[m0,Do]=u.useState(!1),[ko,h0]=u.useState(""),[f0,Is]=u.useState(!1),[es,jr]=u.useState(null),[At,Sr]=u.useState(null),[Dr,Co]=u.useState(""),[g0,_s]=u.useState(!1),[nd,Tn]=u.useState(0),[Kt,Ba]=u.useState(null),[$a,Io]=u.useState(""),[be,As]=u.useState(null),[p0,id]=u.useState(""),Da=async a=>{try{const s=JSON.stringify(a);localStorage.setItem(Cr(),s);try{localStorage.setItem(Ro(),s)}catch{}try{localStorage.setItem(Lo(),Date.now().toString())}catch{}if(t!=null&&t.uid){try{localStorage.setItem(`debts_unsynced_${t.uid}`,"true")}catch{}const i=[];i.push(ae.updateUserData(t.uid,{debts:a,debtsDeletedAt:null})),Promise.all(i).then(()=>{try{localStorage.removeItem(`debts_unsynced_${t.uid}`)}catch{}}).catch(l=>{console.error("فشل مزامنة الديون:",l),pe(!0)})}}catch(s){console.error("خطأ في حفظ الديون:",s)}},_o=async()=>{try{const a=Cr(),s=Ro(),i=Lo(),l=localStorage.getItem(a),d=localStorage.getItem(s),m=localStorage.getItem(i),f=m?Number(m):0,g=y=>{if(!y)return null;try{const p=JSON.parse(y);return Array.isArray(p)?p.map(N=>{var C;return{...N,createdAt:(C=N.createdAt)!=null&&C.toDate?N.createdAt.toDate():new Date(N.createdAt),partialPayments:Array.isArray(N.partialPayments)?N.partialPayments.map(S=>{var A;return{amount:Number(S.amount)||0,paidAt:(A=S.paidAt)!=null&&A.toDate?S.paidAt.toDate():new Date(S.paidAt)}}):[],additionReceipts:Array.isArray(N.additionReceipts)?N.additionReceipts.map(S=>{var A;return{amount:Number(S.amount)||0,note:typeof S.note=="string"?S.note:void 0,addedAt:(A=S.addedAt)!=null&&A.toDate?S.addedAt.toDate():new Date(S.addedAt)}}):[]}}):[]}catch(p){return console.warn("فشل في تحليل ديون localStorage:",p),null}};let v=g(l);if(!v||v.length===0){const y=g(d);if(y&&y.length>0){v=y,Lt(y);try{localStorage.setItem(Cr(),JSON.stringify(y)),localStorage.removeItem(s)}catch(p){console.warn("تعذر ترحيل الديون محلياً من المفتاح الافتراضي:",p)}}}if(v&&v.length>0&&Lt(v),t!=null&&t.uid)try{const y=`debts_unsynced_${t.uid}`,p=localStorage.getItem(y)==="true",N=await ca(Te(V,"users",t.uid)),C=[];try{const S=query(me(V,"debts"),X("userId","==",t.uid));(await ke(S)).forEach(O=>{var T;const _=O.data();C.push({id:O.id,..._,amount:Number(_.amount||0),paidAmount:Number(_.paidAmount||0),createdAt:(T=_.createdAt)!=null&&T.toDate?_.createdAt.toDate():new Date(_.createdAt||Date.now()),partialPayments:Array.isArray(_.partialPayments)?_.partialPayments:[],additionReceipts:Array.isArray(_.additionReceipts)?_.additionReceipts.map(B=>{var J;return{amount:Number(B.amount)||0,note:typeof B.note=="string"?B.note:void 0,addedAt:(J=B.addedAt)!=null&&J.toDate?B.addedAt.toDate():new Date(B.addedAt)}}):[]})})}catch(S){console.warn("Failed to fetch from debts collection:",S)}if(N.exists()){const S=N.data();let A=S.debts&&Array.isArray(S.debts)?S.debts.map(T=>{var B;return{...T,amount:Number(T.amount||0),paidAmount:Number(T.paidAmount||0),createdAt:(B=T.createdAt)!=null&&B.toDate?T.createdAt.toDate():new Date(T.createdAt),partialPayments:Array.isArray(T.partialPayments)?T.partialPayments.map(J=>{var ne;return{amount:Number(J.amount)||0,paidAt:(ne=J.paidAt)!=null&&ne.toDate?J.paidAt.toDate():new Date(J.paidAt)}}):[],additionReceipts:Array.isArray(T.additionReceipts)?T.additionReceipts.map(J=>{var ne;return{amount:Number(J.amount)||0,note:typeof J.note=="string"?J.note:void 0,addedAt:(ne=J.addedAt)!=null&&ne.toDate?J.addedAt.toDate():new Date(J.addedAt)}}):[]}}):[];if(!!S.debtsDeletedAt){Lt([]);try{localStorage.setItem(a,JSON.stringify([])),localStorage.setItem(s,JSON.stringify([]))}catch{}return}if(((A==null?void 0:A.length)||0)>0)if(p)console.log("⚠️ تم اكتشاف ديون غير متزامنة محلياً، سيتم تجاهل نسخة السحابة مؤقتاً للحفاظ على البيانات الجديدة.");else{Lt(A);try{localStorage.setItem(a,JSON.stringify(A))}catch{}}}else if(C.length>0){Lt(C);try{localStorage.setItem(a,JSON.stringify(C))}catch{}}else v&&v.length>0}catch(y){console.warn("تعذر تحميل الديون من Firebase، الاعتماد على المحلي:",y)}}catch(a){console.error("خطأ في تحميل الديون:",a)}};u.useEffect(()=>{try{window.exportDebts=()=>{try{return JSON.stringify(_e||[])}catch{return"[]"}},window.importDebts=async a=>{try{const s=JSON.parse(a);if(!Array.isArray(s))throw new Error("صيغة غير صحيحة — يجب أن تكون مصفوفة");return await Da(s),{ok:!0,count:s.length}}catch(s){return console.error("فشل استيراد الديون:",s),{ok:!1,error:String(s)}}},window.fixWalletsForCurrentUser=async a=>{try{if(!(t!=null&&t.uid))throw new Error("يجب تسجيل الدخول أولاً");return await(await Z(async()=>{const{merchantWalletService:i}=await import("./index-CzMrJEuC.js").then(l=>l.cE);return{merchantWalletService:i}},__vite__mapDeps([0,1]),import.meta.url)).merchantWalletService.reassignByMsisdns(a,t.uid)}catch(s){return console.error("فشل إصلاح المحافظ للمستخدم الحالي:",s),{updated:0,failed:(a==null?void 0:a.length)||0,error:String(s)}}}}catch{}},[_e,t==null?void 0:t.uid]),u.useEffect(()=>{t!=null&&t.uid&&_o()},[t==null?void 0:t.uid]),u.useEffect(()=>{if(!(t!=null&&t.uid))return;const a=Mf(Te(V,"users",t.uid),async s=>{var i;if(s.exists()){const l=s.data(),d=l.isActive===!0;l.subscription&&nc(l.subscription),Vm(l.branchPackage||null);const m=await du.checkTrialValidity(t.uid),f=m.isValid&&!m.isExpired;Ma(d||f),ac(f),sc(m.hoursRemaining),rc(m.hasUsedTrial);const g=!d&&!f;Wa(g),g&&(console.log("⛔ User not active, redirecting to pending approval..."),b("/user/pending-approval",{replace:!0})),console.log("🔄 تحديث فوري لحالة المستخدم (Real-time):",{isActive:d,isOnTrial:f,plan:(i=l.subscription)==null?void 0:i.planType,showModal:g})}});return()=>a()},[t==null?void 0:t.uid]);const x0=async()=>{if(t!=null&&t.uid)try{ic(!0);const a=await Mu(t.uid);nc(a)}catch(a){console.error("خطأ في جلب بيانات الاشتراك:",a)}finally{ic(!1)}},[hv,fv]=u.useState(!1),[y0,Ao]=u.useState(!1),[We,Ze]=u.useState(0),[we,ct]=u.useState({}),[b0,od]=u.useState(!1),[v0,ld]=u.useState(!1),[w0,To]=u.useState(!1),[N0,Pn]=u.useState(!1),[cd,Po]=u.useState(""),[j0,kr]=u.useState(!1),[S0,On]=u.useState(!1),[Oo,En]=u.useState(""),[D0,Eo]=u.useState(!1),[Mn,dd]=u.useState(""),[Wn,ud]=u.useState(""),[Rn,md]=u.useState(""),[hd,fd]=u.useState(!1),[Mo,Wo]=u.useState(!1),[k0,gd]=u.useState(!1),[pd,C0]=u.useState([]);u.useEffect(()=>{(async()=>{try{if(!(t!=null&&t.uid)||!Mo)return;try{await Wr.trimToMaxCount(t.uid,30)}catch{}const a=await Wr.getByUser(t.uid,30);C0(a)}catch{}})()},[t==null?void 0:t.uid,Mo]);const et=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`walletBalances_${(t==null?void 0:t.uid)||"default"}_${a}`},Ve=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`cashBalance_${(t==null?void 0:t.uid)||"default"}_${a}`},Cr=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`debts_${(t==null?void 0:t.uid)||"default"}_${a}`},I0=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`customers_${(t==null?void 0:t.uid)||"default"}_${a}`},Ro=()=>`debts_default_${j||(n==null?void 0:n.shopId)||"main"}`,Lo=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`debts_last_write_${(t==null?void 0:t.uid)||"default"}_${a}`},Fo=()=>`shopExpenses_${j||(n==null?void 0:n.shopId)||(t==null?void 0:t.uid)||"default"}`,xd=()=>{try{const a=localStorage.getItem(Fo());if(a){const s=JSON.parse(a);Ci(s.map(i=>({...i,createdAt:new Date(i.createdAt)})))}}catch(a){console.error("خطأ أثناء تحميل مصروفات المحل من التخزين:",a)}},yd=async a=>{try{localStorage.setItem(Fo(),JSON.stringify(a)),Ci(a)}catch(s){console.error("خطأ أثناء حفظ مصروفات المحل في التخزين:",s)}},_0=async a=>{try{const s=on.filter(i=>i.id!==a);await yd(s);try{if(t!=null&&t.uid&&a){const{doc:i,deleteDoc:l}=await Z(async()=>{const{doc:f,deleteDoc:g}=await import("./index-CzMrJEuC.js").then(v=>v.cC);return{doc:f,deleteDoc:g}},__vite__mapDeps([0,1]),import.meta.url),{db:d}=await Z(async()=>{const{db:f}=await import("./index-CzMrJEuC.js").then(g=>g.cD);return{db:f}},__vite__mapDeps([0,1]),import.meta.url),m=i(d,"shop_expenses",a);await l(m)}}catch(i){console.warn("تعذر حذف المصروف من السحابة الآن، تم الحذف محليًا وسيبقى مخزّنًا دون هذا الإيصال:",i)}x({title:"تم الحذف",description:"تم حذف إيصال المصروف نهائيًا."})}catch(s){console.error("خطأ أثناء الحذف النهائي لإيصال المصروف:",s),x({title:"فشل الحذف",description:"تعذر حذف الإيصال. حاول مرة أخرى.",variant:"destructive"})}};G.useEffect(()=>{let a;return(async()=>{try{if(!(t!=null&&t.uid)){xd();return}const{collection:s,query:i,where:l,getDocs:d}=await Z(async()=>{const{collection:N,query:C,where:S,getDocs:A}=await import("./index-CzMrJEuC.js").then(O=>O.cC);return{collection:N,query:C,where:S,getDocs:A}},__vite__mapDeps([0,1]),import.meta.url),{db:m}=await Z(async()=>{const{db:N}=await import("./index-CzMrJEuC.js").then(C=>C.cD);return{db:N}},__vite__mapDeps([0,1]),import.meta.url),f=j||(n==null?void 0:n.shopId),g=f?i(s(m,"shop_expenses"),l("shopId","==",f)):i(s(m,"shop_expenses"),l("userId","==",t.uid)),p=(await d(g)).docs.map(N=>{var A;const C=N.data(),S=(A=C.createdAt)!=null&&A.toDate?C.createdAt.toDate():C.createdAt?new Date(C.createdAt):new Date;return{id:N.id,name:String(C.name||""),amount:Number(C.amount||0),notes:C.notes?String(C.notes):void 0,source:C.source==="wallet"?"wallet":"cash",walletId:C.walletId?String(C.walletId):void 0,createdAt:S}}).sort((N,C)=>{const S=N.createdAt instanceof Date?N.createdAt.getTime():0;return(C.createdAt instanceof Date?C.createdAt.getTime():0)-S});Ci(p);try{localStorage.setItem(Fo(),JSON.stringify(p))}catch{}}catch(s){console.error("خطأ في مزامنة مصروفات المحل من Firestore:",s)}})(),()=>a==null?void 0:a()},[t==null?void 0:t.uid,n==null?void 0:n.shopId,j]);const Ln=()=>`deficiencies_${j||(n==null?void 0:n.shopId)||(t==null?void 0:t.uid)||"default-shop"}`,A0=()=>{try{const a=Ln(),s=`deficiencies_${(t==null?void 0:t.uid)||"default"}`;if(s!==a){const l=localStorage.getItem(s),d=localStorage.getItem(a);if(l)try{const m=JSON.parse(l)||[],f=d?JSON.parse(d):[],g=Array.isArray(f)?[...f]:[],v=(y,p)=>y.some(N=>(N==null?void 0:N.id)&&(p==null?void 0:p.id)&&String(N.id)===String(p.id)||String((N==null?void 0:N.name)||"")===String((p==null?void 0:p.name)||"")&&String((N==null?void 0:N.status)||"pending")===String((p==null?void 0:p.status)||"pending"));if(Array.isArray(m))for(const y of m)v(g,y)||g.push(y);localStorage.setItem(a,JSON.stringify(g));try{localStorage.removeItem(s)}catch{}}catch{}}const i=localStorage.getItem(a);if(i){const l=JSON.parse(i);xs(l.map(d=>({...d,createdAt:new Date(d.createdAt)})))}}catch(a){console.error("خطأ أثناء تحميل النواقص من التخزين:",a)}},Bo=async a=>{try{localStorage.setItem(Ln(),JSON.stringify(a)),xs(a)}catch(s){console.error("خطأ أثناء حفظ النواقص في التخزين:",s)}};G.useEffect(()=>{(async()=>{try{if(!(t!=null&&t.uid))return;const{collection:s,query:i,where:l,orderBy:d,getDocs:m}=await Z(async()=>{const{collection:N,query:C,where:S,orderBy:A,getDocs:O}=await import("./index-CzMrJEuC.js").then(_=>_.cC);return{collection:N,query:C,where:S,orderBy:A,getDocs:O}},__vite__mapDeps([0,1]),import.meta.url),{db:f}=await Z(async()=>{const{db:N}=await import("./index-CzMrJEuC.js").then(C=>C.cD);return{db:N}},__vite__mapDeps([0,1]),import.meta.url),g=j||(n==null?void 0:n.shopId)||t.uid||"default-shop",v=i(s(f,"deficiencies"),l("shopId","==",g),d("createdAt","desc")),p=(await m(v)).docs.map(N=>{var A;const C=N.data(),S=(A=C.createdAt)!=null&&A.toDate?C.createdAt.toDate():C.createdAt?new Date(C.createdAt):new Date;return{id:N.id,name:String(C.name||""),quantity:Number(C.quantity||1),status:C.status==="purchased"?"purchased":"pending",createdAt:S}});xs(p);try{localStorage.setItem(Ln(),JSON.stringify(p))}catch{}}catch(s){console.warn("فشل جلب النواقص من Firestore:",s)}})()},[t==null?void 0:t.uid,n==null?void 0:n.shopId,j]);const $o=async a=>{try{localStorage.setItem(I0(),JSON.stringify(a)),yo(a),t!=null&&t.uid&&await ae.updateUserData(t.uid,{customers:a})}catch(s){console.error("خطأ أثناء حفظ العملاء في التخزين:",s)}},T0=async()=>{try{if(t!=null&&t.uid){const a=await ca(Te(V,"users",t.uid));if(a.exists()){const s=a.data();if(s.customers&&Array.isArray(s.customers)){const i=s.customers.map(l=>{var d;return{...l,createdAt:(d=l.createdAt)!=null&&d.toDate?l.createdAt.toDate():new Date(l.createdAt)}});yo(i);return}}}yo([])}catch(a){console.error("خطأ أثناء تحميل العملاء من Firestore:",a)}},Uo=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`transactions_${(t==null?void 0:t.uid)||"default"}_${a}`},bd=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`wallets_${(t==null?void 0:t.uid)||"default"}_${a}`},ts=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`selectedWallet_${(t==null?void 0:t.uid)||"default"}_${a}`},vd=a=>{var d;const s=String((a==null?void 0:a.transactionId)||(a==null?void 0:a.id)||""),i=String((a==null?void 0:a.reference)||(a==null?void 0:a.transactionReference)||((d=a==null?void 0:a.receipt)==null?void 0:d.reference)||""),l=new Date((a==null?void 0:a.createdAt)||0).getTime();return s||i||`${i||"ref"}-${l}`},{data:Vo,refetch:gv}=qr({queryKey:["userTransactions",t==null?void 0:t.uid],queryFn:async()=>{if(!(t!=null&&t.uid))return[];const{collection:a,query:s,where:i,orderBy:l,limit:d,getDocs:m}=await Z(async()=>{const{collection:y,query:p,where:N,orderBy:C,limit:S,getDocs:A}=await import("./index-CzMrJEuC.js").then(O=>O.cC);return{collection:y,query:p,where:N,orderBy:C,limit:S,getDocs:A}},__vite__mapDeps([0,1]),import.meta.url),{db:f}=await Z(async()=>{const{db:y}=await import("./index-CzMrJEuC.js").then(p=>p.cD);return{db:y}},__vite__mapDeps([0,1]),import.meta.url),g=s(a(f,"userTransactions"),i("userId","==",t.uid),l("createdAt","desc"),d(100));return(await m(g)).docs.map(y=>{var B;const p=y.data(),N=(B=p.createdAt)!=null&&B.toDate?p.createdAt.toDate():new Date(p.createdAt),C=(p.txnType||"").toLowerCase(),S=C==="send"?"send":C==="receive"?"withdraw":p.type||"withdraw",A=p.status==="confirmed"?"completed":p.status||"completed",O=p.senderMsisdn||p.senderPhone||"",_=p.receiverMsisdn||p.receiverPhone||"",T=Number(p.amount??p.transferredAmount??p.withdrawnAmount??0);return{id:y.id,...p,type:S,status:A,senderPhone:O,receiverPhone:_,amount:T,createdAt:N,provider:p.provider||void 0}})},enabled:!!(t!=null&&t.uid),staleTime:1e3*60*5,gcTime:1e3*60*10});u.useEffect(()=>{if(Vo){const s=Vo.filter(f=>!((f==null?void 0:f.type)==="report"||String((f==null?void 0:f.title)||"").includes("إيصال تسليم وردية"))),i=new Set((hr||[]).map(f=>String(f.id||f.originalTransactionId||""))),l=s.filter(f=>!i.has(String(f.id||""))),d=new Set,m=[];for(const f of l){const g=vd(f);d.has(g)||(d.add(g),m.push(f))}zt(m)}},[Vo,hr]),u.useEffect(()=>{if(!(t!=null&&t.uid))return;let a=!0;return(async()=>{try{const{collection:i,query:l,where:d,getDocs:m,orderBy:f,limit:g}=await Z(async()=>{const{collection:N,query:C,where:S,getDocs:A,orderBy:O,limit:_}=await import("./index-CzMrJEuC.js").then(T=>T.cC);return{collection:N,query:C,where:S,getDocs:A,orderBy:O,limit:_}},__vite__mapDeps([0,1]),import.meta.url),{db:v}=await Z(async()=>{const{db:N}=await import("./index-CzMrJEuC.js").then(C=>C.cD);return{db:N}},__vite__mapDeps([0,1]),import.meta.url),y=l(i(v,"deletedTransactions"),d("userId","==",t.uid),f("createdAt","desc"),g(50)),p=await m(y);if(!a)return;p.docs.forEach(N=>{const C=N.data(),S=String((C==null?void 0:C.originalTransactionId)||""),A=String((C==null?void 0:C.transactionId)||""),O=String((C==null?void 0:C.reference)||""),_=S||A||O||String(N.id);_&&(ha.current.has(_)||(ha.current.add(_),zt(T=>{const B=T.find(J=>J.id===S);return B?((async()=>await Gi(B))(),T.filter(J=>J.id!==S)):T})))})}catch(i){console.warn("تعذر جلب المعاملات المحذوفة:",i)}})(),()=>{a=!1}},[t==null?void 0:t.uid]);const[qo,Fn]=u.useState(""),[Ft,wd]=u.useState(""),Jt=G.useMemo(()=>{const a=It;if(!a)return!1;const s=Wf(a),i=a.planType??a.plan??null,l=typeof i=="string"?i.toLowerCase():null,d=l==="monthly"||l==="quarterly"||l==="yearly"||l==="lifetime"||i===Zt.MONTHLY||i===Zt.QUARTERLY||i===Zt.YEARLY||i===Zt.LIFETIME;return s&&d},[It]),Ne=G.useMemo(()=>{var l,d;const a=It;if(!a)return!1;const s=((l=a.subscription)==null?void 0:l.planType)??((d=a.subscription)==null?void 0:d.plan)??a.planType??a.plan??null,i=typeof s=="string"?s.toLowerCase():null;return s===Zt.ZERO||i==="zero"},[It]),Ce=G.useMemo(()=>{var l,d;const a=It;if(!a)return!1;const s=((l=a.subscription)==null?void 0:l.planType)??((d=a.subscription)==null?void 0:d.plan)??a.planType??a.plan??null,i=typeof s=="string"?String(s).trim().toLowerCase():null;return s===Zt.TAHWEELA||i==="tahweela"||i==="تحويله"},[It]),P0=()=>{if(!Jt){x({title:"غير متاح",description:"هذه الميزة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة. يرجى تفعيل اشتراكك.",variant:"destructive"});return}Q(!0)},[pv,xv]=u.useState(!1),[O0,E0]=u.useState(!1),[M0,W0]=u.useState(!1),[R0,L0]=u.useState(!1),[F0,Ir]=u.useState(!1),[as,Bn]=u.useState(""),[_r,$n]=u.useState(""),[Nd,Un]=u.useState(!1),[Ar,Tr]=u.useState(null),[zo,Vn]=u.useState(""),[B0,jd]=u.useState(!1),[yv,bv]=u.useState(!1),[$0,qn]=u.useState(!1),[Sd,Yo]=u.useState(""),[Dd,Ko]=u.useState(""),[kd,Cd]=u.useState(!1);u.useEffect(()=>{const a=s=>{var d,m;const i=(d=s.detail)==null?void 0:d.action,l=((m=s.detail)==null?void 0:m.payload)||{};if(console.log("🔔 Dashboard Navigation Action:",i,l),i==="lines")re("lines",()=>{const f=(o==null?void 0:o.simSubscription)||(t==null?void 0:t.simSubscription);let g=!1;f!=null&&f.active&&(f!=null&&f.endsAt)&&(f.endsAt.seconds?new Date(f.endsAt.seconds*1e3):new Date(f.endsAt))>new Date&&(g=!0),g?Nn(!0):ze(!0)});else if(i==="profile-settings")re("settings",()=>H(!0));else if(i==="debts")re("debts",()=>In());else if(i==="sales")re("sales",()=>{Ne||Ce?x({title:"غير متاح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Ss(!0)});else if(i==="maintenance")re("maintenance",()=>{Ne||Ce?x({title:"غير متاح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):yr(!0)});else if(i==="credit-cards")re("cards",()=>{Ne||Ce?x({title:"غير متاح",description:"كروت الائتمان غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):xr(!0)});else if(i==="shop-expenses")re("expenses",()=>{Ne||Ce?x({title:"غير متاح",description:"مصروفات المحل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Bt.hasMasterPin()?gs(!0):Ja(!0)});else if(i==="deficiencies")re("deficiencies",()=>{Ne||Ce?x({title:"غير متاح",description:"النواقص غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):sr(!0)});else if(i==="installment")re("installments",()=>{Ne||Ce?x({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"}):pr(!0)});else if(i==="cashier-shift")!Jt||Ce?x({title:"غير متاح",description:"وردية الكاشير متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"}):Q(!0);else if(i==="machine-daily")re("machines",()=>{!Jt||Ce?x({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"}):br(!0)});else if(i==="branch-management")re("branches",()=>{(pt==null?void 0:pt.status)==="active"?Oa(!0):Vt(!0)});else if(i==="my-client-numbers")re("myNumbers",()=>cn(!0));else if(i==="transaction-section"){const f=()=>{const g=document.getElementById("transaction-section");if(g){const v=l.skipAnimation?"auto":"smooth";g.scrollIntoView({behavior:v})}l.transactionType&&Vi(l.transactionType),l.startNewTransaction&&(or(""),vs(""),hn(""),fn(""),console.log("🔒 Starting new transaction via event"))};l.transactionType==="transfer"?re("transfers",f):l.transactionType==="withdraw"?re("withdrawals",f):f()}};return window.addEventListener("dashboard-navigation-action",a),()=>window.removeEventListener("dashboard-navigation-action",a)},[$,Ce,pt,Ne,Jt]);const Id=async()=>{var a;if(t!=null&&t.uid)try{const s=`userData_${t.uid}`,i=localStorage.getItem(s),l=`debts_unsynced_${t.uid}`,d=localStorage.getItem(Cr()),m=localStorage.getItem(l)==="true";if(i){const f=JSON.parse(i);console.log("🔄 مزامنة البيانات المحلية مع Firebase...",f);const g={lastSynced:new Date().toISOString()};typeof f.cashBalance=="number"&&(g.cashBalance=f.cashBalance),f.walletBalances&&typeof f.walletBalances=="object"&&(g.walletBalances=f.walletBalances),await ae.updateUserData(t.uid,g),localStorage.removeItem(s),pe(!1),console.log("✅ تمت المزامنة بنجاح وحذف البيانات المحلية")}else console.log("لا توجد بيانات محلية تحتاج للمزامنة");if(m&&d)try{const f=JSON.parse(d)||[],g=_=>_ instanceof Date?_:typeof(_==null?void 0:_.toDate)=="function"?_.toDate():_?new Date(String(_)):new Date,v=_=>(Array.isArray(_)?_:[]).map(T=>({...T,amount:Number(T.amount||0),paidAmount:Number(T.paidAmount||0),createdAt:g(T.createdAt),partialPayments:Array.isArray(T.partialPayments)?T.partialPayments.map(B=>({amount:Number(B.amount||0),paidAt:g(B.paidAt)})):[]})),y=await ca(Te(V,"users",t.uid)),p=y.exists()?((a=y.data())==null?void 0:a.debts)||[]:[],N=v(p),C=v(f),S={};for(const _ of N)S[String(_.id||"")]=_;const A=[],O=new Set;for(const _ of C){const T=String(_.id||""),B=S[T];if(B){const J=Number(B.paidAmount||0)+(Array.isArray(B.partialPayments)?B.partialPayments.reduce((Se,ce)=>Se+Number(ce.amount||0),0):0),ne=Number(_.paidAmount||0)+(Array.isArray(_.partialPayments)?_.partialPayments.reduce((Se,ce)=>Se+Number(ce.amount||0),0):0),tt=String(B.status||"pending"),bt=String(_.status||"pending"),dt=tt==="paid"||J>=Number(B.amount||0)?B:bt==="paid"?{...B,paidAmount:Number(_.paidAmount||0),partialPayments:_.partialPayments,status:"paid"}:ne>J?{...B,paidAmount:Number(_.paidAmount||0),partialPayments:_.partialPayments,status:ne>=Number(B.amount||0)?"paid":"pending"}:B;A.push(dt),O.add(T)}else A.push(_),O.add(T)}for(const _ of N){const T=String(_.id||"");O.has(T)||A.push(_)}await ae.updateUserData(t.uid,{debts:A});try{localStorage.removeItem(l)}catch{}pe(!1)}catch{pe(!0)}}catch(s){console.error("❌ فشل في مزامنة البيانات:",s),x({title:"فشل في المزامنة",description:"حدث خطأ أثناء مزامنة البيانات مع الخادم",variant:"destructive"})}},[_d,zn]=u.useState({keepLastCount:30,intervalDays:7,lastResetAt:null});u.useEffect(()=>{(async()=>{if(t!=null&&t.uid)try{const s=await ae.getUserData(t.uid),i=(s==null?void 0:s.recentReset)||{},l=Number(i==null?void 0:i.keepLastCount)>0?Number(i.keepLastCount):30,d=Number(i==null?void 0:i.intervalDays)>0?Number(i.intervalDays):7,m=y=>y instanceof Date?y:typeof(y==null?void 0:y.toDate)=="function"?y.toDate():y?new Date(String(y)):null,f=i!=null&&i.lastResetAt?m(i.lastResetAt):null,g=new Date;!f||g.getTime()-f.getTime()>=d*24*60*60*1e3?(await ae.updateUserData(t.uid,{recentReset:{keepLastCount:l,intervalDays:d,lastResetAt:g}}),zn({keepLastCount:l,intervalDays:d,lastResetAt:g})):zn({keepLastCount:l,intervalDays:d,lastResetAt:f})}catch{zn({keepLastCount:30,intervalDays:7,lastResetAt:null})}})()},[t==null?void 0:t.uid]);const Ad=G.useMemo(()=>{const a=oe||[],s=f=>f instanceof Date?f:typeof(f==null?void 0:f.toDate)=="function"?f.toDate():new Date(String(f)),i=new Date,l=new Date(i.getFullYear(),i.getMonth(),1),d=new Date(i.getFullYear(),i.getMonth()+1,1);return[...a].sort((f,g)=>s(g.createdAt).getTime()-s(f.createdAt).getTime()).filter(f=>{const g=s(f.createdAt);return g>=l&&g<d})},[oe]),U0=G.useMemo(()=>{const a=oe||[],s=f=>f instanceof Date?f:typeof(f==null?void 0:f.toDate)=="function"?f.toDate():new Date(String(f)),i=new Date,l=new Date(i.getFullYear(),i.getMonth(),1),d=new Date(i.getFullYear(),i.getMonth()+1,1),m=a.filter(f=>{const g=s(f.createdAt);return g>=l&&g<d}).length;return Math.max(0,((oe==null?void 0:oe.length)||0)-m)},[oe==null?void 0:oe.length]),Yn=G.useMemo(()=>{const a=new Date,s=new Date(a.getFullYear(),a.getMonth(),1),i=new Date(a.getFullYear(),a.getMonth()+1,1),l={};for(const m of oe){const f=new Date(m.createdAt||0);if(!(f>=s&&f<i))continue;const g=String(m.type||m.txnType||"").toLowerCase();if(!(g==="send"||g==="withdraw"||g==="transfer"))continue;const v=String(m.receiverPhone||m.senderPhone||"").trim();if(!v)continue;const y=Ot(v),p=Number(m.amount||m.withdrawnAmount||m.sentAmount||0)||0;l[y]||(l[y]={phone:y,count:0,total:0}),l[y].count+=1,l[y].total+=p}return Object.values(l).sort((m,f)=>f.count!==m.count?f.count-m.count:f.total-m.total).slice(0,10)},[oe]),V0=a=>{const s=Ot(String(a));return s.startsWith("+20")?"20"+s.slice(3):s.startsWith("0")?"20"+s.slice(1):s.replace(/[^0-9]/g,"")},q0=a=>{const s=V0(a.phone),i=`عميل VIP هذا الشهر
عدد العمليات: ${a.count}
الإجمالي: ${a.total} جنيه`,l=`https://wa.me/${s}?text=${encodeURIComponent(i)}`;try{window.open(l,"_blank")}catch{}};u.useEffect(()=>{(async()=>{try{if(!(t!=null&&t.uid))return;const a=`${new Date().getFullYear()}-${new Date().getMonth()+1}`;await ae.updateUserData(t.uid,{vipTop10:Yn,vipMonthTag:a})}catch{}})()},[t==null?void 0:t.uid,Yn]);async function Td(){const a=new Date,s=new Intl.DateTimeFormat("ar-EG",{timeZone:"Africa/Cairo",year:"numeric",month:"2-digit",day:"2-digit"}).format(a),i=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),l=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59,999),d=(oe||[]).filter(S=>{const A=new Date(S.createdAt||0);return A>=i&&A<=l}),m=d.length,f=d.filter(S=>String(S.type||S.txnType||"").toLowerCase()==="withdraw"||String(S.type||"").toLowerCase()==="receive").reduce((S,A)=>S+(A.withdrawnAmount!=null?Number(A.withdrawnAmount):Number(A.amount||0)),0),g=d.filter(S=>String(S.type||S.txnType||"").toLowerCase()==="send"||String(S.type||"").toLowerCase()==="transfer").reduce((S,A)=>S+(A.sentAmount!=null?Number(A.sentAmount):Number(A.amount||0)),0);let v=0;try{v=d.reduce((S,A)=>S+St.calculateTransactionProfit(A),0)}catch{}let y=0;try{const S=new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Cairo"}).format(a),A=Oe(me(V,"dailySales"),X("userId","==",(t==null?void 0:t.uid)||""));y=(await ke(A)).docs.map(T=>T.data()).filter(T=>String(T.date||S)===S).reduce((T,B)=>T+Number(B.sellingPrice||B.price||0)*Number(B.quantity||1),0)}catch{}let p=0;try{p=(_e||[]).filter(A=>String(A.status||"")==="pending").reduce((A,O)=>{const _=Number(O.paidAmount||0)+(Array.isArray(O.partialPayments)?O.partialPayments:[]).reduce((T,B)=>T+Number(B.amount||0),0);return A+Math.max(0,Number(O.amount||0)-_)},0)}catch{}let N="";try{const S=j||(n==null?void 0:n.shopId)||null,A=S?Oe(me(V,"deficiencies"),X("shopId","==",S)):Oe(me(V,"deficiencies"),X("userId","==",(t==null?void 0:t.uid)||""));N=(await ke(A)).docs.map(B=>B.data()).filter(B=>String(B.status||"pending")==="pending").slice(0,10).map((B,J)=>`${J+1}- ${String(B.name||B.productName||"عنصر")} × ${Number(B.quantity||B.qty||0)}`).join(`
`)}catch{}return[`تقرير يومي - ${s}`,`عدد العمليات: ${m}`,`إجمالي المسحوبات: ${f} جنيه`,`إجمالي الإرسال: ${g} جنيه`,`الأرباح: ${v} جنيه`,`إجمالي مبيعات الاكسسوار: ${y} جنيه`,`إجمالي الديون: ${p} جنيه`,"نواقص الاكسسوار:",N||"لا توجد عناصر مسجلة"].join(`
`)}const Pd=G.useCallback(()=>{let a=Ad;const s=kc.trim();if(s&&(a=a.filter(i=>{const l=i;return String(l.type||"").toLowerCase()==="cash_addition"||String(l.txnType||"").toLowerCase()==="cash_addition"||String(l.title||"").includes("إيصال إضافة نقدية")?!0:i.senderPhone&&i.senderPhone.includes(s)||i.receiverPhone&&i.receiverPhone.includes(s)})),vn){const i=new Date(vn);a=a.filter(l=>{const d=new Date(l.createdAt);if(wn){const[m,f]=wn.split(":"),g=new Date(i);g.setHours(parseInt(m),parseInt(f),0,0);const v=new Date(g);return v.setHours(v.getHours()+1),d>=g&&d<v}else return d.toDateString()===i.toDateString()})}try{a=[...a].sort((i,l)=>{const d=new Date(i.createdAt||0).getTime();return new Date(l.createdAt||0).getTime()-d})}catch{}return a},[Ad,kc,vn,wn]),Od=async()=>{if(Ne||Ce){x({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"});return}if(!(t!=null&&t.uid)){x({title:"خطأ في المصادقة",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}try{const a=await Td(),s=t!=null&&t.uid?`tg_daily_report_last_${t.uid}`:"tg_daily_report_last",i=Date.now();let l=!0;try{const d=localStorage.getItem(s);if(d){const m=JSON.parse(d),f=Number((m==null?void 0:m.at)||0);i-f<3e4&&(l=!1)}}catch{}if(l){await ns.send(t.uid,a);try{localStorage.setItem(s,JSON.stringify({at:i}))}catch{}}x({title:"تم الإرسال",description:"تم إرسال التقرير اليومي إلى تليجرام",variant:"default"})}catch{x({title:"فشل الإرسال",description:"تعذّر إرسال التقرير اليومي إلى تليجرام",variant:"destructive"})}},[z0,Kn]=u.useState(!1),[Ed,Jn]=u.useState(""),[Y0,Hn]=u.useState(!1),[Jo,Ho]=u.useState(""),[K0,pe]=u.useState(!1),[J0,Qo]=u.useState(!1),ss=async(a,s=2,i=700)=>{let l;for(let d=0;d<=s;d++)try{return await a()}catch(m){if(l=m,d===s)break;await new Promise(f=>setTimeout(f,i*Math.pow(2,d)))}throw l};$.reduce((a,s)=>a+(we[s.id]||0),0);const H0=async a=>await Bt.verifyMasterPin(a,t==null?void 0:t.uid),Qn=async a=>await Bt.verifyMasterPin(a,t==null?void 0:t.uid);u.useEffect(()=>{if(t!=null&&t.uid){try{const a=et(),s=`walletBalances_${t.uid}`,i=localStorage.getItem(a)??localStorage.getItem(s);if(i){const l=JSON.parse(i);ct(l&&typeof l=="object"?l:{});try{localStorage.setItem(a,JSON.stringify(l||{}))}catch{}}}catch{}try{const a=Ve(),s=`cashBalance_${t.uid}`,i=`userCashBalance_${t.uid}`;let l=localStorage.getItem(a)??localStorage.getItem(s)??localStorage.getItem(i);if(l!=null){const d=parseFloat(l);Ze(Number.isFinite(d)?d:0);try{localStorage.setItem(a,String(Number.isFinite(d)?d:0)),localStorage.removeItem(s),localStorage.removeItem(i)}catch{}}}catch{}}},[t==null?void 0:t.uid,j,n==null?void 0:n.shopId]),u.useEffect(()=>{const a=s=>{var i;try{const l=Number((i=s==null?void 0:s.detail)==null?void 0:i.value);if(Number.isFinite(l))Ze(l);else{const d=localStorage.getItem(Ve());d!=null&&Ze(parseFloat(d)||0)}}catch{const l=localStorage.getItem(Ve());l!=null&&Ze(parseFloat(l)||0)}};return window.addEventListener("cashBalanceChanged",a),()=>window.removeEventListener("cashBalanceChanged",a)},[t==null?void 0:t.uid,j,n==null?void 0:n.shopId]);const{data:Go}=qr({queryKey:["dashboardData",j||(n==null?void 0:n.shopId)],queryFn:async()=>{const a=j||(n==null?void 0:n.shopId);if(!a)return null;const s=Te(V,"dashboardData",a),i=await ca(s);return i.exists()?i.data():null},enabled:!!(t!=null&&t.uid&&(j||n!=null&&n.shopId)),staleTime:1e3*60*5,refetchInterval:1e3*60*5});u.useEffect(()=>{if(Go){const a=Go,s=Number((a==null?void 0:a.cashBalance)||0),i=a!=null&&a.walletBalances&&typeof a.walletBalances=="object"?a.walletBalances:{};try{const l=a!=null&&a.lastUpdated?new Date(a.lastUpdated).getTime():0,d=localStorage.getItem(Ve()+"_lastUpdated"),m=d?new Date(d).getTime():0;l>=m&&(Ze(s),ct(i),localStorage.setItem(Ve(),String(s)),localStorage.setItem(et(),JSON.stringify(i)),a!=null&&a.lastUpdated&&(localStorage.setItem(Ve()+"_lastUpdated",a.lastUpdated),localStorage.setItem(et()+"_lastUpdated",a.lastUpdated)))}catch{}}},[Go]);const Md=a=>`walletLimits_${(t==null?void 0:t.uid)||"default"}_${a||"none"}`,{data:Gn}=qr({queryKey:["walletLimits",E],queryFn:async()=>{if(!E)return null;const a=Te(V,"walletLimits",String(E)),s=await ca(a);return s.exists()?s.data():null},enabled:!!E,staleTime:1e3*60*5});u.useEffect(()=>{if(E)try{const a=Md(E),s=localStorage.getItem(a);if(s&&!Gn){const i=JSON.parse(s);As(i)}if(Gn){const i=Gn,l={walletId:E,dailyTransferLimit:i.dailyTransferLimit??6e4,dailyWithdrawLimit:i.dailyWithdrawLimit??1e5,dailyTransferUsed:i.dailyTransferUsed??0,dailyWithdrawUsed:i.dailyWithdrawUsed??0,monthlyTransferLimit:i.monthlyTransferLimit??2e5,monthlyWithdrawLimit:i.monthlyWithdrawLimit??2e5,monthlyTransferUsed:i.monthlyTransferUsed??0,monthlyWithdrawUsed:i.monthlyWithdrawUsed??0};As(l);try{localStorage.setItem(Md(E),JSON.stringify(l))}catch{}}}catch{}},[E,Gn]),u.useEffect(()=>{if(!E)return;const a=$.find(s=>s.id===E);if(a!=null&&a.name){id(String(a.name));try{localStorage.setItem(`walletName_${(t==null?void 0:t.uid)||"default"}_${E}`,String(a.name))}catch{}return}try{const s=localStorage.getItem(`walletName_${(t==null?void 0:t.uid)||"default"}_${E}`);s&&id(String(s))}catch{}},[E,$]);const Xo=async()=>{try{if(!E)return;const a=await cs.autoResetLimitsIfNeeded(E);As(a)}catch(a){console.error("خطأ في جلب حدود المحفظة المختارة:",a)}};u.useEffect(()=>{Xo()},[E]),u.useEffect(()=>{const a=s=>{var i;(i=s==null?void 0:s.detail)!=null&&i.walletId&&s.detail.walletId===E&&Xo()};return window.addEventListener("walletLimitsUpdated",a),()=>window.removeEventListener("walletLimitsUpdated",a)},[E]),u.useEffect(()=>{const a=s=>{var i;try{const l=String(((i=s==null?void 0:s.detail)==null?void 0:i.walletId)||"");l&&Pr(l,"sms:auto")}catch{}};return window.addEventListener("walletSelection:update",a),()=>window.removeEventListener("walletSelection:update",a)},[$]),u.useEffect(()=>{if(h.state){if(console.log("Location state:",h.state),h.state.openDebtDialog&&(In(),window.history.replaceState({},document.title)),h.state.openSalesDialog&&(Ne||Ce?x({title:"غير متاح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Ss(!0),window.history.replaceState({},document.title)),h.state.openMaintenanceDialog&&(Ne||Ce?x({title:"غير متاح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):yr(!0),window.history.replaceState({},document.title)),h.state.openCreditCardsDialog&&(console.log("Opening credit cards dialog"),Ne||Ce?x({title:"غير متاح",description:"كروت الائتمان غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):xr(!0),window.history.replaceState({},document.title)),h.state.openShopExpensesDialog&&(Ne||Ce?x({title:"غير متاح",description:"مصروفات المحل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Bt.hasMasterPin()?gs(!0):Ja(!0),window.history.replaceState({},document.title)),h.state.openDeficienciesDialog&&(Ne||Ce?x({title:"غير متاح",description:"النواقص غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):sr(!0),window.history.replaceState({},document.title)),h.state.openInstallment&&(Ne||Ce?x({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"}):pr(!0),window.history.replaceState({},document.title)),h.state.openTransactionSection){const a=document.getElementById("transaction-section");a&&a.scrollIntoView({behavior:"smooth"}),h.state.transactionType&&Vi(h.state.transactionType),h.state.startNewTransaction&&(or(""),vs(""),hn(""),fn(""),console.log("🔒 Starting new transaction without changing wallet selection")),h.state.focusWalletSelection&&setTimeout(()=>{const s=document.querySelector('[data-testid="wallet-select"]');s&&s.focus()},500),window.history.replaceState({},document.title)}h.state.openCashierShiftModal&&(!Jt||Ce?x({title:"غير متاح",description:"وردية الكاشير متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"}):Q(!0),window.history.replaceState({},document.title)),h.state.openMachineDailyDialog&&(!Jt||Ce?x({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"}):br(!0),window.history.replaceState({},document.title)),h.state.openBranchManagement&&((pt==null?void 0:pt.status)==="active"?Oa(!0):Vt(!0),window.history.replaceState({},document.title)),h.state.openMyClientNumbersDialog&&(cn(!0),window.history.replaceState({},document.title))}},[h.state,$,Ce,pt]),u.useEffect(()=>{h.pathname==="/user/dashboard"&&sessionStorage.getItem("previousPath")==="/user/add-wallet"&&(console.log("🔄 Returned from wallet addition page - reloading wallets"),Zo(),sessionStorage.removeItem("previousPath")),sessionStorage.setItem("previousPath",h.pathname)},[h.pathname,t==null?void 0:t.uid]),u.useEffect(()=>{if(!(t!=null&&t.uid))return;(async()=>{try{const s=Te(V,"users",t.uid),i=await ca(s);if(i.exists()){const d=i.data().isActive===!0;d&&!er?(Ma(!0),Wa(!1),tr(!1)):!d&&er&&(Ma(!1),Wa(!0))}}catch(s){console.error("Check user status error",s)}})()},[t==null?void 0:t.uid]),u.useEffect(()=>{if(!(t!=null&&t.uid))return;const a=i=>{const{userId:l}=i.detail;l===t.uid&&(console.log("🎉 Subscription activation event received for current user!"),Ma(!0),Wa(!1),tr(!1),setTimeout(()=>{console.log("✅ User activation completed - data updated")},1e3))},s=i=>{const l=i.detail||{},{userId:d,isActive:m}=l;d&&d===t.uid&&(console.log("🔄 User subscription update event received:",{userId:d,isActive:m}),m&&!er&&(Ma(!0),Wa(!1),tr(!1),setTimeout(()=>{console.log("✅ User subscription updated - data refreshed")},1e3)))};return window.addEventListener("subscriptionActivated",a),window.addEventListener("userSubscriptionUpdated",s),()=>{window.removeEventListener("subscriptionActivated",a),window.removeEventListener("userSubscriptionUpdated",s)}},[t==null?void 0:t.uid,er]),u.useEffect(()=>{const a=s=>{var m;const i=s.target,l=(m=i==null?void 0:i.tagName)==null?void 0:m.toLowerCase();if(!(l==="input"||l==="textarea"||l==="select"||((i==null?void 0:i.isContentEditable)??!1))&&!(s.ctrlKey||s.altKey||s.metaKey)&&!s.repeat){if((Ne||Ce)&&s.key>="1"&&s.key<="9"){s.preventDefault();return}switch(s.key){case"1":break;case"2":ro(!0);break;case"3":Ne||Ce?x({title:"غير متاح",description:"كروت الائتمان غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):xr(!0);break;case"4":Jt?Q(!0):x({title:"غير متاح",description:"وردية الكاشير متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"});break;case"5":Ne||Ce?x({title:"غير متاح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Ss(!0);break;case"6":In();break;case"7":Ne||Ce?x({title:"غير متاح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):yr(!0);break;case"8":Jt?br(!0):x({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"});break;case"9":Ne||Ce?x({title:"غير متاح",description:"مصروفات المحل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Bt.hasMasterPin()?gs(!0):Ja(!0);break}}};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[Ne,Ce,Jt]),u.useEffect(()=>{console.log("🔥 useEffect loadUserData started",{user:t==null?void 0:t.uid,isCheckingActivation:Si}),(async()=>{try{if(!(t!=null&&t.uid)){console.log("🔥 No user UID, setting isCheckingActivation to false"),tr(!1);return}try{const m=await ca(Te(V,"users",t.uid));if(m.exists()){const g=m.data().isActive===!0,v=await du.checkTrialValidity(t.uid),y=v.isValid&&!v.isExpired;Ma(g||y),ac(y),sc(v.hoursRemaining),rc(v.hasUsedTrial),Wa(!g&&!y),console.log("📊 حالة المستخدم:",{isActive:g,isOnTrial:y,hoursRemaining:v.hoursRemaining,hasUsedTrial:v.hasUsedTrial})}else Ma(!1),Wa(!0)}catch(m){console.error("خطأ في فحص حالة تفعيل المستخدم:",m),Ma(!1),Wa(!0)}finally{tr(!1)}if(console.log("🔄 بدء تحميل بيانات المستخدم من Firebase...",{userId:t==null?void 0:t.uid}),t!=null&&t.uid){const m=await ss(()=>ae.getUserData(t.uid)),f=`userData_${t==null?void 0:t.uid}`;let g=null;try{const v=localStorage.getItem(f);v&&(g=JSON.parse(v))}catch{}if(m){let v=(m==null?void 0:m.walletBalances)||{},y=m==null?void 0:m.cashBalance;const p=m.lastUpdated?new Date(m.lastUpdated).getTime():0;g&&(g.lastUpdated?new Date(g.lastUpdated).getTime():0)>=p&&(g.walletBalances&&(v=g.walletBalances),g.cashBalance!==void 0&&(y=g.cashBalance));try{const N=Ve(),C=et(),S=localStorage.getItem(N+"_lastUpdated"),A=localStorage.getItem(C+"_lastUpdated"),O=S?new Date(S).getTime():0,_=A?new Date(A).getTime():0;if(O>p){const T=localStorage.getItem(N);T!==null&&(y=parseFloat(T))}if(_>p){const T=localStorage.getItem(C);if(T!==null)try{v=JSON.parse(T)}catch{}}}catch(N){console.error("Error checking individual keys fallback:",N)}ct(v),y!==void 0&&Ze(y);try{const N=t!=null&&t.uid?await ss(()=>Ur.getDeletedTransactionsByUser(t.uid)):[];fr(N||[])}catch{fr([])}}else{ct({});try{const v=t!=null&&t.uid?await Ur.getDeletedTransactionsByUser(t.uid):[];fr(v||[])}catch{fr([])}}}console.log("🔄 بدء تحميل المحافظ من Firebase...");try{const m=await ss(()=>ii.getByMerchantId((t==null?void 0:t.uid)||""));if(m&&m.length>0){console.log("✅ تم العثور على محافظ في Firebase:",m.length);const g=m.filter(p=>p.isActive===!0).map(p=>({id:p.id,name:p.label||"محفظة بدون اسم",phone:p.msisdn,isDefault:!1,monthlyWithdrawalLimit:p.monthlyWithdrawalLimit??p.withdrawLimit??2e5,monthlyTransferLimit:p.monthlyTransferLimit??p.transferLimit??2e5,defaultTransferCommission:p.defaultTransferCommission!=null?Number(p.defaultTransferCommission):null,defaultWithdrawCommission:p.defaultWithdrawCommission!=null?Number(p.defaultWithdrawCommission):null,ownerName:p.ownerName,nationalId:p.nationalId,providerName:p.provider}));Y(g);const v=localStorage.getItem(ts());let y=null;v&&g.find(p=>p.id===v)?y=g.find(p=>p.id===v):y=g[0],y&&(Zs(y.id),bs(y.phone)),console.log("🔄 تم تحديث المحافظ من Firebase وحفظها في localStorage")}else console.log("⚠️ لا توجد محافظ في Firebase. سيتم عرض قائمة فارغة بدون أي استرجاع محلي."),Y([])}catch(m){console.error("خطأ في تحميل المحافظ من Firebase:",m),Y([])}const d=t!=null&&t.uid?await ss(()=>ae.getUserTransactions(t.uid)):[];if(d&&d.length>0){console.log("📊 تم تحميل المعاملات من Firebase:",d.length);const m=d.map(p=>({...p,createdAt:new Date(p.createdAt),senderPhone:p.senderMsisdn||p.senderPhone||"",receiverPhone:p.receiverMsisdn||p.receiverPhone||"",type:p.txnType==="send"?"send":p.txnType==="receive"?"withdraw":p.type||"withdraw",status:p.status==="confirmed"?"completed":p.status||"completed"})),f=hr.map(p=>p.id||p.originalTransactionId);let g=[];try{const p=Oe(me(V,"deletedTransactions"),X("userId","==",(t==null?void 0:t.uid)||""),X("permanent","==",!0));g=(await ke(p)).docs.map(C=>{const S=C.data();return String(S.originalTransactionId||S.transactionId||C.id||"")}).filter(Boolean)}catch{}const v=new Set(g),y=m.filter(p=>{var _;const N=String(p.id||""),C=String(p.transactionId||""),S=String(p.reference||p.transactionReference||((_=p.receipt)==null?void 0:_.reference)||""),A=f.includes(N),O=v.has(N)||C&&v.has(C);return!A&&!O});console.log("✅ تم فلترة المعاملات المحذوفة:",{total:d.length,deleted:f.length,active:y.length});{const p=new Set,N=[];for(const C of y){const S=vd(C);p.has(S)||(p.add(S),N.push(C))}Sh||zt(N)}}await Id()}catch(d){console.error("خطأ في تحميل بيانات المستخدم من Firebase:",d)}})().then(async()=>{await l(),await s(),await i()});const s=async()=>{try{if(!(t!=null&&t.uid))return;const d=await ii.getByMerchantId(t.uid);await Promise.all(d.map(m=>cb.autoResetLimitsIfNeeded(m.id)))}catch(d){console.error("خطأ في التصفير التلقائي للحدود:",d)}},i=async()=>{try{await St.syncReportsDataFromFirebase(t==null?void 0:t.uid);const d=St.getReportsData(t==null?void 0:t.uid);if((d.lastDailyResetDate?St.shouldResetDailyReports(d.lastDailyResetDate):!1)&&(t!=null&&t.uid)&&d.lastDailyResetDate){const g=new Date(d.lastDailyResetDate),v=g.toDateString(),y=oe.filter(_=>new Date(_.createdAt).toDateString()===v&&_.status==="completed"),p=y.length,N=y.reduce((_,T)=>_+T.amount,0),C=y.filter(Or).reduce((_,T)=>{const B=T.withdrawnAmount!==void 0?T.withdrawnAmount:T.amount;return _+B},0),S=y.filter(Er).reduce((_,T)=>{const B=T.sentAmount!==void 0?T.sentAmount:T.amount;return _+B},0),A=y.reduce((_,T)=>_+St.calculateTransactionProfit(T),0),O=new Date(g).toISOString().slice(0,10);await Wr.add({userId:t.uid,reportDate:O,totalTransactions:p,totalAmount:Number(N.toFixed(2)),totalWithdrawn:Number(C.toFixed(2)),totalSent:Number(S.toFixed(2)),profit:Number(A.toFixed(2)),walletId:null})}const f=St.autoResetReportsIfNeeded(t==null?void 0:t.uid);(f.dailyReset||f.monthlyReset)&&console.log("تم التصفير التلقائي:",f)}catch(d){console.error("خطأ في التصفير التلقائي للتقارير:",d)}},l=async()=>{try{if(!(t!=null&&t.uid))return;const d=new Date;if(d.getDate()!==1)return;const m=`${d.getFullYear()}-${d.getMonth()+1}`,f=`lastMonthlyDbCleanup:${t.uid}`;if(localStorage.getItem(f)===m)return;const v=new Date(d.getFullYear(),d.getMonth(),1,0,0,0,0),y=C=>C instanceof Date?C:typeof(C==null?void 0:C.toDate)=="function"?C.toDate():new Date(String(C));let p=[];try{const C=Oe(me(V,"userTransactions"),X("userId","==",t.uid),X("createdAt","<",v));p=(await ke(C)).docs}catch{const C=Oe(me(V,"userTransactions"),X("userId","==",t.uid));p=(await ke(C)).docs.filter(A=>{var O;return y((O=A.data())==null?void 0:O.createdAt)<v})}await Promise.allSettled(p.map(C=>Zd(C.ref)));let N=[];try{const C=Oe(me(V,"transactions"),X("userId","==",t.uid),X("createdAt","<",v));N=(await ke(C)).docs}catch{const C=Oe(me(V,"transactions"),X("userId","==",t.uid));N=(await ke(C)).docs.filter(A=>{var O;return y((O=A.data())==null?void 0:O.createdAt)<v})}await Promise.allSettled(N.map(C=>Zd(C.ref)));try{localStorage.setItem(f,m)}catch{}console.log("✅ تم تنظيف قاعدة البيانات شهريًا (Firebase فقط):",{userTransactionsDeleted:p.length,globalTransactionsDeleted:N.length,monthStart:v})}catch(d){console.error("فشل التنظيف الشهري التلقائي لقاعدة البيانات:",d)}};x0(),_o(),T0(),console.log("🔥 useEffect loadUserData completed")},[t==null?void 0:t.uid]);const Zo=async()=>{var a;if(t!=null&&t.uid)try{const s=await ss(()=>ii.getByMerchantId(t.uid));if(s&&s.length>0){const l=s.filter(d=>d.isActive===!0).map(d=>({id:d.id,name:d.label||"محفظة بدون اسم",phone:d.msisdn,isDefault:!1,monthlyWithdrawalLimit:d.monthlyWithdrawalLimit??d.withdrawLimit??2e5,monthlyTransferLimit:d.monthlyTransferLimit??d.transferLimit??2e5,defaultTransferCommission:d.defaultTransferCommission!=null?Number(d.defaultTransferCommission):void 0,defaultWithdrawCommission:d.defaultWithdrawCommission!=null?Number(d.defaultWithdrawCommission):void 0}));if(Y(l),t!=null&&t.uid){const d=localStorage.getItem(ts());if(!!(E&&l.find(f=>f.id===E)))console.log("🔒 Preserving current wallet selection:",E);else{const g=(d&&l.find(v=>v.id===d)?d:null)||((a=l[0])==null?void 0:a.id);g&&(console.log("🔄 Fixing invalid wallet selection:",g),Pr(g))}}console.log("🔄 تم تحديث المحافظ من Firebase:",l.length)}}catch(s){console.error("خطأ في تحميل المحافظ من Firebase:",s)}};u.useEffect(()=>{const a=h.pathname;if(sessionStorage.getItem("previousPath")==="/user/add-wallet"&&a==="/user/dashboard"){M.invalidateQueries({queryKey:["wallets",t==null?void 0:t.uid]});try{yn.refetch()}catch{}sessionStorage.removeItem("previousPath")}sessionStorage.setItem("previousPath",a)},[h.pathname,t==null?void 0:t.uid]),u.useEffect(()=>{const a=()=>{M.invalidateQueries({queryKey:["wallets",t==null?void 0:t.uid]});try{yn.refetch()}catch{}};return window.addEventListener("focus",a),()=>{window.removeEventListener("focus",a)}},[t==null?void 0:t.uid,E,$]);const Pr=async(a,s="unknown")=>{console.log(`🎯 setWalletSelection called from ${s} with walletId:`,a),console.log("🔍 Previous selectedWallet:",E),Zs(a);const i=$.find(l=>l.id===a);if(i&&(bs(i.phone),console.log("✅ Wallet set successfully:",a,"Phone:",i.phone)),t!=null&&t.uid){localStorage.setItem(ts(),a),console.log("💾 Saved wallet to localStorage:",a);try{await Rr.set({key:"selected_wallet_id",value:a}),await Rr.set({key:"current_user_id",value:t.uid}),console.log("📱 Saved wallet and user ID to Capacitor Preferences:",a,t.uid)}catch(l){console.error("❌ Failed to save to Capacitor Preferences:",l)}}};u.useEffect(()=>{const a=()=>{Zo()};try{window.addEventListener("wallets:activation-updated",a)}catch{}return()=>{try{window.removeEventListener("wallets:activation-updated",a)}catch{}}},[t==null?void 0:t.uid]);const Q0=a=>{if(a==="__add_wallet"){b("/user/add-wallet");return}if(a==="__view_wallets"){mn(!0);return}sg.isEnabled(t==null?void 0:t.uid)?(Fi(a),Li(!0)):Pr(a,"walletSelectionNoPin")},Xn=a=>{console.log("🔄 handleTransactionTypeChange called with type:",a),console.log("🔍 Current selectedWallet before change:",E),console.log("🔍 Available wallets count:",$.length),Vi(a),or(""),vs(""),hn(""),fn(""),console.log("✅ Transaction type changed to:",a,"- Wallet selection preserved:",E),setTimeout(()=>{const s=document.getElementById("transaction-section");s&&s.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)};u.useEffect(()=>{const a=s=>{const i=s.target;if(!!i&&(i.tagName==="INPUT"||i.tagName==="TEXTAREA"||i.tagName==="SELECT"||i.isContentEditable)||(s.key==="ArrowLeft"?(s.preventDefault(),Xn("withdraw")):s.key==="ArrowRight"&&(s.preventDefault(),Xn("transfer"))),s.key==="Enter"){const d=L==="transfer"?"transferSubmitButton":"withdrawSubmitButton",m=document.getElementById(d);m&&!m.disabled&&(s.preventDefault(),m.click())}};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[L]);const Wd=a=>{wh((i=>{const l=String(i.description||""),d=String(i.title||""),m=l.includes("تحويل مكنه")||l.includes("تحويل مكينه")||l.includes("machine transfer")||d.includes("تحويل مكنه")||d.includes("تحويل مكينه"),f=String((i==null?void 0:i.provider)||"").toLowerCase(),g=f.includes("vodafone")?"vf-cash":f.includes("instapay")?"instapay":"",v=i.type==="send"?"تحويل":"سحب";let y=i.type==="withdraw"&&g?`${v} ${g}`:v;return m?y="تحويل مكينه":i.title&&(y=i.title),{id:i.id,type:m||i.type==="send"||i.type==="transfer"?"transfer":"withdraw",sender_msisdn:i.senderPhone,receiver_msisdn:i.receiverPhone,amount:i.amount,commission:i.commission||0,fee:(i==null?void 0:i.fee)??0,status:i.status==="failed"?"failed":i.status==="completed"?"completed":"pending",createdAt:new Date(i.createdAt).toISOString(),updatedAt:new Date(i.createdAt).toISOString(),shopName:P??(n==null?void 0:n.shopName)??(t==null?void 0:t.displayName)??"المحل",cashierName:(i==null?void 0:i.cashierName)??null,commissionMode:(i==null?void 0:i.commissionMode)??(i.type==="send"||$e?"add":"deduct"),totalCharged:(i==null?void 0:i.totalCharged)??(i.type==="send"?Number(i.amount||0)+Number(i.commission||0)+Number((i==null?void 0:i.fee)||0):$e?Number(i.amount||0)+Number(i.commission||0):Number(i.amount||0)),note:(i==null?void 0:i.note)??(i==null?void 0:i.notes)??void 0,senderName:(i==null?void 0:i.senderName)??void 0,provider:(i==null?void 0:i.provider)??void 0,title:y,description:(i==null?void 0:i.description)??void 0}})(a)),bn(!0)},G0=async a=>{var d;if(!(t!=null&&t.uid)){x({title:"خطأ في المصادقة",description:"يجب تسجيل الدخول أولاً لحذف المعاملات",variant:"destructive"});return}const s=oe.find(m=>m.id===a);if(!s){x({title:"خطأ في الحذف",description:"لم يتم العثور على المعاملة المطلوب حذفها",variant:"destructive"});return}const i=String(a),l=String((s==null?void 0:s.transactionId)||(s==null?void 0:s.reference)||"");ha.current.add(i),l&&ha.current.add(l);try{console.log("🗑️ بدء عملية حذف المعاملة:",a),console.log("🔄 حذف المعاملة نهائياً من Firebase...",{transactionId:s.id,userId:t.uid,transactionData:s}),await ae.removeUserTransaction(t.uid,s.id),console.log("✅ تم حذف المعاملة نهائياً من Firebase userTransactions");try{await Ur.saveDeletedTransaction({...s,userId:t.uid,originalTransactionId:s.id,transactionId:s.transactionId||s.id,reference:s.reference||s.transactionReference||((d=s.receipt)==null?void 0:d.reference),deletedAt:new Date().toISOString(),permanent:!0}),console.log("✅ تم حفظ المعاملة في سجل المحذوفات مع تاريخ الحذف")}catch(g){console.warn("⚠️ فشل في حفظ المعاملة في سجل المحذوفات، لكن الحذف من Firebase نجح:",g)}try{await Ur.permanentlyDeleteTransaction(s.id,t.uid)}catch(g){console.warn("⚠️ فشل وسم الحذف النهائي أو التنظيف الإضافي:",g)}const m=[...hr,s],f=oe.filter(g=>g.id!==a);fr(m),zt(f),Nc(!1),console.log("✅ تم تحديث الحالة بعد الحذف من Firebase (بدون نسخ محلية)");try{const g=s.fromWallet;if(g){const{walletDailyLimitsService:v}=await Z(async()=>{const{walletDailyLimitsService:p}=await import("./index-CzMrJEuC.js").then(N=>N.cL);return{walletDailyLimitsService:p}},__vite__mapDeps([0,1]),import.meta.url),y=await v.getWalletLimits(g);if(y){const p=s.type==="send",N={updatedAt:(await Z(async()=>{const{serverTimestamp:_}=await import("./index-CzMrJEuC.js").then(T=>T.cC);return{serverTimestamp:_}},__vite__mapDeps([0,1]),import.meta.url)).serverTimestamp()};p?(N.dailyTransferUsed=Math.max(0,(y.dailyTransferUsed||0)-s.amount),N.monthlyTransferUsed=Math.max(0,(y.monthlyTransferUsed||0)-s.amount)):(N.dailyWithdrawUsed=Math.max(0,(y.dailyWithdrawUsed||0)-s.amount),N.monthlyWithdrawUsed=Math.max(0,(y.monthlyWithdrawUsed||0)-s.amount));const{doc:C,setDoc:S}=await Z(async()=>{const{doc:_,setDoc:T}=await import("./index-CzMrJEuC.js").then(B=>B.cC);return{doc:_,setDoc:T}},__vite__mapDeps([0,1]),import.meta.url),{db:A}=await Z(async()=>{const{db:_}=await import("./index-CzMrJEuC.js").then(T=>T.cD);return{db:_}},__vite__mapDeps([0,1]),import.meta.url),O=C(A,"walletLimits",g);await S(O,N,{merge:!0})}}}catch(g){console.warn("فشل استرجاع حدود المحفظة بعد الحذف:",g)}try{const{ProfitService:g}=await Z(async()=>{const{ProfitService:C}=await import("./profitService-D3SXiBSD.js");return{ProfitService:C}},__vite__mapDeps([48,0,1]),import.meta.url),{ReportsService:v}=await Z(async()=>{const{ReportsService:C}=await import("./index-CzMrJEuC.js").then(S=>S.cK);return{ReportsService:C}},__vite__mapDeps([0,1]),import.meta.url),p={txnType:s.type==="send"?"send":"receive",amount:s.amount,commission:s.commission||0,createdAt:s.createdAt,status:"confirmed"},N=g.calculateProfitFromTransaction(p);N>0&&g.addProfit(-N,t.uid);try{v.removeTransactionEffects(s,t.uid)}catch{}}catch(g){console.warn("فشل تحديث الأرباح/التقارير بعد الحذف:",g)}x({title:"تم حذف المعاملة نهائياً",description:"تم حذف المعاملة نهائياً من النظام. يمكنك العثور عليها في قائمة المحذوفات"})}catch(m){console.error("❌ خطأ في حذف المعاملة من Firebase:",m);let f="فشل في حذف المعاملة من الخادم. يرجى المحاولة مرة أخرى";m instanceof Error&&(m.message.includes("network")||m.message.includes("offline")?f="مشكلة في الاتصال بالإنترنت. تحقق من الاتصال وحاول مرة أخرى":m.message.includes("permission")||m.message.includes("unauthorized")?f="ليس لديك صلاحية لحذف هذه المعاملة":m.message.includes("not-found")&&(f="المعاملة غير موجودة أو تم حذفها مسبقاً")),x({title:"خطأ في الحذف",description:f,variant:"destructive"})}},Or=a=>{const s=(a.type||"").toLowerCase(),i=(a.txnType||"").toLowerCase();return s==="withdraw"||s==="withdrawal"||s==="receive"||i==="receive"},Er=a=>{const s=(a.type||"").toLowerCase(),i=(a.txnType||"").toLowerCase();return s==="send"||s==="transfer"||i==="send"},Rd=a=>a.title==="إيصال سحب فوري",Ld=(a,s)=>{const i=new Date().toDateString();let l=oe.filter(y=>{const p=new Date(y.createdAt).toDateString()===i,N=String(y.status||"").toLowerCase();return p&&(N==="completed"||N==="confirmed"||N==="pending")});fa&&fa.trim()!==""&&(l=l.filter(y=>y.senderPhone&&y.senderPhone.includes(fa)||y.receiverPhone&&y.receiverPhone.includes(fa)));const d=St.filterVisibleTransactions(l,"daily",t==null?void 0:t.uid),m=d.length,f=d.reduce((y,p)=>y+p.amount,0),g=d.filter(Or).reduce((y,p)=>{const N=p.withdrawnAmount!==void 0?p.withdrawnAmount:p.amount;return y+N},0),v=d.filter(y=>Er(y)&&!Rd(y)).reduce((y,p)=>{const N=p.sentAmount!==void 0?p.sentAmount:p.amount;return y+N},0);return{totalTransactions:m,totalAmount:f,totalWithdrawn:g,totalSent:v}},X0=a=>{const s=new Date().getMonth(),i=new Date().getFullYear();let l=oe.filter(y=>{const p=new Date(y.createdAt);return p.getMonth()===s&&p.getFullYear()===i&&y.status==="completed"});fa&&fa.trim()!==""&&(l=l.filter(y=>y.senderPhone&&y.senderPhone.includes(fa)||y.receiverPhone&&y.receiverPhone.includes(fa)));const d=St.filterVisibleTransactions(l,"monthly",t==null?void 0:t.uid),m=d.length,f=d.reduce((y,p)=>y+p.amount,0),g=d.filter(Or).reduce((y,p)=>{const N=p.withdrawnAmount!==void 0?p.withdrawnAmount:p.amount;return y+N},0),v=d.filter(y=>Er(y)&&!Rd(y)).reduce((y,p)=>{const N=p.sentAmount!==void 0?p.sentAmount:p.amount;return y+N},0);return{totalTransactions:m,totalAmount:f,totalWithdrawn:g,totalSent:v}},Z0=a=>{const s=new Date().getMonth(),i=new Date().getFullYear(),l=oe.filter(f=>{const g=new Date(f.createdAt);return g.getMonth()===s&&g.getFullYear()===i&&f.status==="completed"&&f.fromWallet===a}),d=l.filter(Or).reduce((f,g)=>{const v=g.withdrawnAmount||g.amount;return f+v},0),m=l.filter(Er).reduce((f,g)=>{const v=g.sentAmount||g.amount;return f+v},0);return{totalWithdrawn:d,totalTransferred:m}},ef=a=>{const s=new Date,i=s.getDate(),l=s.getMonth(),d=s.getFullYear(),m=oe.filter(v=>{const y=new Date(v.createdAt);return y.getDate()===i&&y.getMonth()===l&&y.getFullYear()===d&&v.status==="completed"&&v.fromWallet===a}),f=m.filter(Or).reduce((v,y)=>{const p=y.withdrawnAmount||y.amount;return v+p},0),g=m.filter(Er).reduce((v,y)=>{const p=y.sentAmount||y.amount;return v+p},0);return{totalWithdrawn:f,totalTransferred:g}},Ts=G.useMemo(()=>X0(),[oe,E,fa]),Zn=G.useMemo(()=>Ld(),[oe,E,fa,t==null?void 0:t.uid]);Ts.totalWithdrawn,Ts.totalSent;const ka=G.useMemo(()=>Z0(E),[oe,E]),tf=G.useMemo(()=>ef(E),[oe,E]),Ps=G.useMemo(()=>{try{return JSON.parse(localStorage.getItem(bd())||"[]")}catch{return[]}},[t==null?void 0:t.uid]);u.useEffect(()=>{try{if(!E||$.length===0)return;const a=$.find(S=>S.id===E);if(!a)return;const s=(be==null?void 0:be.monthlyWithdrawLimit)??(a==null?void 0:a.monthlyWithdrawalLimit)??2e5,i=(be==null?void 0:be.monthlyTransferLimit)??(a==null?void 0:a.monthlyTransferLimit)??2e5,l=parseFloat(ot||"0")||0,d=(ka==null?void 0:ka.totalWithdrawn)??(be==null?void 0:be.monthlyWithdrawUsed)??0,m=(ka==null?void 0:ka.totalTransferred)??(be==null?void 0:be.monthlyTransferUsed)??0,f=d+(L==="withdraw"?l:0),g=m+(L==="transfer"?l:0),v=.85,y=Math.floor(Math.max(s,1)*v),p=Math.floor(Math.max(i,1)*v),N=(()=>{const S=new Date;return`${S.getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}`})(),C=`monthlyLimitWarnShown:${E}:${N}`;if(f>=y){const S=`${C}:withdraw`;if(!(localStorage.getItem(S)==="true")){pc({type:"withdraw",used:f,limit:s,walletName:a.name}),gc(!0);try{localStorage.setItem(S,"true")}catch{}return}}if(g>=p){const S=`${C}:transfer`;if(!(localStorage.getItem(S)==="true")){pc({type:"transfer",used:g,limit:i,walletName:a.name}),gc(!0);try{localStorage.setItem(S,"true")}catch{}return}}}catch{}},[E,$,be,ka,L,ot]);const Fd=async(a,s=!1)=>{var d,m,f,g;if(Fe.current)return;if(D&&(k!=null&&k.permissions)){if(L==="transfer"&&k.permissions.transfers===!1){je(!0);return}if(L==="withdraw"&&k.permissions.withdrawals===!1){je(!0);return}}const i=L==="withdraw"&&(s||sa||!$e);Fe.current=!0,Le(!0);const l=()=>{L==="transfer"?Ds(!1):gr(!1),Fe.current=!1,Le(!1)};try{if(wb(),console.log("🔄 بدء عملية التحويل/السحب"),console.log("📊 البيانات المدخلة:",{senderPhone:qt,receiverPhone:xt,amount:ot,transactionType:L}),(()=>{L==="transfer"?Ds(!0):gr(!0)})(),!qt||!ot){console.log("❌ خطأ: بيانات ناقصة"),x({title:"خطأ في البيانات",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"}),l();return}if(L==="transfer"&&!xt&&!c){console.log("❌ خطأ: رقم المستقبل مفقود"),x({title:"خطأ في البيانات",description:"يرجى إدخال رقم المستقبل",variant:"destructive"}),l();return}if(L==="transfer"&&!c){const q=String(xt||"").replace(/[^0-9٠-٩]/g,"");if(!/[^0-9٠-٩\s]/.test(String(xt||""))&&!Nb(xt)){x({title:"رقم المستقبل غير صالح",description:"اكتب رقم صحيح مكون من 11 رقم ويبدأ بـ 015 أو 010 أو 012 أو 011",variant:"destructive"}),l();return}}const y=parseFloat(ot);if(console.log("💰 المبلغ المحول:",y),y<=0){console.log("❌ خطأ: مبلغ غير صحيح"),x({title:"خطأ في المبلغ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"}),l();return}if(Ne)try{const q=new Date,ie=q.getFullYear(),Ee=String(q.getMonth()+1).padStart(2,"0"),qe=String(q.getDate()).padStart(2,"0"),ht=`zeroPlanDailyConfirmCount:${(t==null?void 0:t.uid)||"default"}:${ie}-${Ee}-${qe}`,Tt=localStorage.getItem(ht);if((Tt&&parseInt(Tt,10)||0)>=10){x({title:"حد التأكيد اليومي",description:"باقة زيرو تسمح بـ 10 تأكيدات تحويل/سحب يومياً فقط.",variant:"destructive"}),l();return}}catch(q){console.warn("فشل قراءة عداد تأكيدات باقة زيرو من التخزين المحلي:",q)}const p=$.find(q=>q.id===E);if(!p){x({title:"خطأ في المحفظة",description:"يرجى اختيار محفظة صحيحة",variant:"destructive"}),l();return}const N=ka;if(console.log("📈 فحص الحدود الشهرية للمحفظة المختارة"),console.log("📊 الإحصائيات الشهرية للمحفظة:",{walletId:E,walletName:p.name,currentWithdrawn:N.totalWithdrawn,currentTransferred:N.totalTransferred,withdrawalLimit:p.monthlyWithdrawalLimit,transferLimit:p.monthlyTransferLimit}),L==="withdraw"){if(console.log("🏧 فحص حد السحب الشهري للمحفظة"),console.log(`💸 المسحوب حالياً من المحفظة: ${N.totalWithdrawn}, المبلغ الجديد: ${y}, الحد الأقصى: ${p.monthlyWithdrawalLimit}`),N.totalWithdrawn+y>p.monthlyWithdrawalLimit){console.log("❌ تجاوز حد السحب الشهري للمحفظة"),x({title:"تجاوز حد السحب الشهري",description:`لا يمكن سحب أكثر من ${p.monthlyWithdrawalLimit} جنيه شهرياً من محفظة ${p.name}`,variant:"destructive"}),l();return}}else if(console.log("💸 فحص حد التحويل الشهري للمحفظة"),console.log(`📤 المحول حالياً من المحفظة: ${N.totalTransferred}, المبلغ الجديد: ${y}, الحد الأقصى: ${p.monthlyTransferLimit}`),N.totalTransferred+y>p.monthlyTransferLimit){console.log("❌ تجاوز حد التحويل الشهري للمحفظة"),x({title:"تجاوز حد التحويل الشهري",description:`لا يمكن تحويل أكثر من ${p.monthlyTransferLimit} جنيه شهرياً من محفظة ${p.name}`,variant:"destructive"}),l();return}const C=(n==null?void 0:n.shopName)||(t==null?void 0:t.displayName)||"محل كاشي لينك",S={id:Date.now().toString(),type:L==="transfer"?"send":L==="deposit"?"deposit":"withdraw",senderPhone:qt,receiverPhone:L==="transfer"?xt:qt,amount:y,status:"completed",createdAt:new Date,withdrawnAmount:L==="withdraw"?y:void 0,sentAmount:L==="transfer"?y:void 0,depositedAmount:void 0,fromWallet:E,senderNumber:qt,senderName:L==="withdraw"&&lr.trim()!==""?lr.trim():void 0,shopName:(p==null?void 0:p.name)||"المحفظة الرئيسية",transferredAmount:L==="transfer"?y:void 0,receiverNumber:L==="transfer"?xt:void 0,withdrawnAmountDetailed:L==="withdraw"?y:void 0,depositedAmountDetailed:void 0,merchantShopName:C,transactionReference:`TXN-${Date.now()}`,commission:0,notes:L==="transfer"?void 0:Ha&&Ha.trim()!==""?Ha.trim():void 0};D&&(k!=null&&k.name||k!=null&&k.username)&&(S.cashierName=(k==null?void 0:k.name)||(k==null?void 0:k.username));const A=zs.validateTransaction(y,L,We,we);if(!A.isValid){x({title:"خطأ في العملية",description:A.error,variant:"destructive"}),l();return}A.warning&&x({title:"تحذير",description:A.warning,variant:"destructive"});let O;if(L==="transfer")if((p==null?void 0:p.defaultTransferCommission)!=null){const q=Number(p.defaultTransferCommission)||0;O=Math.round(q*y/1e3*100)/100}else yt&&yt.trim()!==""?O=Math.max(0,parseFloat(yt)):O=0;else if((p==null?void 0:p.defaultWithdrawCommission)!=null){const q=Number(p.defaultWithdrawCommission)||0;O=Math.round(q*y/1e3*100)/100}else st&&st.trim()!==""?O=Math.max(0,parseFloat(st)):O=Math.round(y*.01*100)/100;if(S.commission=O,L!=="transfer"&&!$e&&O>=y){x({title:"خطأ في العمولة",description:"العمولة أكبر من أو تساوي المبلغ المدخل",variant:"destructive"}),l();return}const _=L==="transfer"?y:i?Math.round((y-O)*100)/100:y;L==="withdraw"&&_c(i?`سلم للعميل: ${_} جنيه`:null),S.amount=i?y:_,S.withdrawnAmount=L==="withdraw"?i?y:_:void 0,S.sentAmount=L==="transfer"?_:void 0,S.transferredAmount=L==="transfer"?_:void 0,S.withdrawnAmountDetailed=L==="withdraw"?i?y:_:void 0;let T;const B=L==="transfer"&&!!ta,J=L==="withdraw"&&!!ta,ne=B||J;let tt=null;const bt=cr(qt||"").replace(/\D/g,""),dt=cr(xt||"").replace(/\D/g,""),Se=L==="transfer"&&(bt.startsWith("010")&&(dt.startsWith("011")||dt.startsWith("012")||dt.startsWith("015"))||bt.startsWith("012")&&dt.startsWith("010")||bt.startsWith("011")&&dt.startsWith("010")||bt.startsWith("015")&&dt.startsWith("010")),ce=Math.max(0,parseFloat(fc||"0")),nt=Math.round(O*100)/100;if(S.commission=nt,S.fee=ce,S.totalCharged=L==="transfer"?Number(_)+Number(nt)+Number(ce):$e?Number(_)+Number(nt):Number(y),Ui&&Se&&!ne&&ce<=0){x({title:"خطأ",description:"أدخل رسوم التحويل لعمليات 010 → 011/012/015 أو 012 → 010 أو 011 → 010 أو 015 → 010",variant:"destructive"}),l();return}if(L==="transfer"&&!ne){const q=Number(we[E]||0),ie=Number(_)+Number(ce);if(q<ie){x({title:"رصيد المحفظة غير كافٍ",description:`الرصيد الحالي ${q} لا يكفي لخصم ${ie}`,variant:"destructive"}),l();return}}if(ne)if(B){const q=zs.validateTransaction(_,"transfer",We,we);if(!q.isValid)T={success:!1,newCashBalance:We,newWalletBalances:we,message:q.error||"رصيد غير كافٍ للتحويل المؤجل",error:"INSUFFICIENT_WALLET_BALANCE"};else{const ie=E||((d=$.find(De=>De.isDefault))==null?void 0:d.id)||((m=$[0])==null?void 0:m.id),Ee=be??await cs.getWalletLimits(ie),qe=new Date().toDateString(),ht=oe.filter(De=>De.type==="send"&&String(De.status||"").toLowerCase()==="pending"&&De.fromWallet===ie&&new Date(De.createdAt).toDateString()===qe).reduce((De,Nt)=>De+Number(Nt.sentAmount??Nt.transferredAmount??Nt.amount??0),0),Tt=Number((Ee==null?void 0:Ee.dailyTransferLimit)??6e4),Ht=Number((Ee==null?void 0:Ee.dailyTransferUsed)??0);if(Ht+ht+Number(_)>Tt){x({title:"تجاوز الحد اليومي للتحويل",description:`المتبقي اليوم: ${(Tt-Ht-ht).toLocaleString()} ج.م`,variant:"destructive"}),l();return}const Je=new Date,wt=oe.filter(De=>De.type==="send"&&String(De.status||"").toLowerCase()==="pending"&&De.fromWallet===ie&&new Date(De.createdAt).getMonth()===Je.getMonth()&&new Date(De.createdAt).getFullYear()===Je.getFullYear()).reduce((De,Nt)=>De+Number(Nt.sentAmount??Nt.transferredAmount??Nt.amount??0),0),Pt=Number((Ee==null?void 0:Ee.monthlyTransferLimit)??2e5),Es=Number((Ee==null?void 0:Ee.monthlyTransferUsed)??0);if(Es+wt+Number(_)>Pt){x({title:"تجاوز الحد الشهري للتحويل",description:`المتبقي هذا الشهر: ${(Pt-Es-wt).toLocaleString()} ج.م`,variant:"destructive"}),l();return}T={success:!0,newCashBalance:We,newWalletBalances:we}}}else{const q=E||((f=$.find(De=>De.isDefault))==null?void 0:f.id)||((g=$[0])==null?void 0:g.id),ie=be??await cs.getWalletLimits(q),Ee=new Date().toDateString(),qe=oe.filter(De=>De.type==="withdraw"&&String(De.status||"").toLowerCase()==="pending"&&De.fromWallet===q&&new Date(De.createdAt).toDateString()===Ee).reduce((De,Nt)=>De+Number(Nt.withdrawnAmount??Nt.amount??0),0),ht=Number((ie==null?void 0:ie.dailyWithdrawLimit)??1e5),Tt=Number((ie==null?void 0:ie.dailyWithdrawUsed)??0);if(Tt+qe+Number(_)>ht){x({title:"تجاوز الحد اليومي للسحب",description:`المتبقي اليوم: ${(ht-Tt-qe).toLocaleString()} ج.م`,variant:"destructive"}),l();return}const Ht=new Date,Je=oe.filter(De=>De.type==="withdraw"&&String(De.status||"").toLowerCase()==="pending"&&De.fromWallet===q&&new Date(De.createdAt).getMonth()===Ht.getMonth()&&new Date(De.createdAt).getFullYear()===Ht.getFullYear()).reduce((De,Nt)=>De+Number(Nt.withdrawnAmount??Nt.amount??0),0),wt=Number((ie==null?void 0:ie.monthlyWithdrawLimit)??2e5),Pt=Number((ie==null?void 0:ie.monthlyWithdrawUsed)??0);if(Pt+Je+Number(_)>wt){x({title:"تجاوز الحد الشهري للسحب",description:`المتبقي هذا الشهر: ${(wt-Pt-Je).toLocaleString()} ج.م`,variant:"destructive"}),l();return}T={success:!0,newCashBalance:Math.round((Number(We)-Number(_))*100)/100,newWalletBalances:we}}else L==="transfer"?T=await zs.processTransfer({amount:_,currentCashBalance:We,currentWalletBalances:we,wallets:$,selectedWalletId:E,skipRemoteLimitsCheck:!1,nonBlockingUsageUpdate:!0}):T=await zs.processWithdraw({amount:_,currentCashBalance:We,currentWalletBalances:we,wallets:$,selectedWalletId:E,skipRemoteLimitsCheck:!1,nonBlockingUsageUpdate:!0});if(!T.success){x({title:"فشل في العملية",description:T.error||T.message,variant:"destructive"}),l();return}let ut=ne?J?T.newCashBalance:We:T.newCashBalance,mt=ne?we:T.newWalletBalances;if(!ne&&i&&L==="withdraw"){const q=E,ie=Number(mt[q]||0);mt={...mt,[q]:Math.round((ie+O)*100)/100}}if(!ne&&L==="transfer"&&ce>0){const q=Number(mt[E]||0);mt={...mt,[E]:Math.round((q-Number(ce))*100)/100}}if(ne&&B){const q=$.find(qe=>qe.id===E)??$.find(qe=>qe.isDefault)??$[0],ie=(q==null?void 0:q.id)||E;if(ie!==E)try{Pr(ie)}catch{}const Ee=Number(we[ie]||0);mt={...we,[ie]:Math.round((Ee-Number(_)-Number(ce))*100)/100}}if((B||J)&&ta&&!Ym){const q={id:`DEBT-${Date.now()}`,debtorName:ta.debtorName,amount:ta.amount,reason:ta.notes||"",customerId:ta.customerId,mobile:ta.mobile,status:"pending",createdAt:new Date};tt=q.id,S.linkedDebtId=tt;const ie=[q,..._e];Lt(ie);try{if(await Da(ie),t!=null&&t.uid){const Ee=Te(V,"debts",q.id),qe={...q,userId:t.uid,shopId:j||(n==null?void 0:n.shopId)||null,lastUpdated:new Date().toISOString()};Object.keys(qe).forEach(ht=>qe[ht]===void 0&&delete qe[ht]),await Qt(Ee,qe,{merge:!0})}}catch(Ee){console.error("⚠️ فشل حفظ الدين المؤجل محلياً أو سحابياً:",Ee)}x({title:"تم إضافة الدين",description:"أضيف إلى إيصالات الديون حتى يتم السداد",variant:"default"})}if(!ne&&!i){const q=Math.max(0,Number(O))+Math.max(0,Number(ce));q>0&&(ut=Math.round((ut+q)*100)/100,console.log(`💰 تم إضافة عمولة/رسوم ${q} جنيه لدرج النقدية`))}console.log("⚡ تحديث الواجهة فوراً بدون حجب باستخدام startTransition...");const vt="temp_"+Date.now()+"_"+Math.random().toString(36).substring(7),ia={reference:vt,shopId:j||(n==null?void 0:n.shopId)||(t==null?void 0:t.uid)||"default-shop",lineId:E||"default-line",walletId:E||void 0,merchantUserId:(t==null?void 0:t.uid)||null,provider:"vodafone_cash",txnType:L==="transfer"?"send":"receive",originType:L==="transfer"?"transfer":"withdraw",amount:i?y:_,commission:nt,fee:ce,profit:0,senderMsisdn:qt,receiverMsisdn:L==="transfer"?xt:qt,note:L==="transfer"?void 0:Ha&&Ha.trim()!==""?Ha.trim():void 0,status:ne?"pending":"confirmed",linkedDebtId:tt||void 0,createdBy:(t==null?void 0:t.uid)||null,walletEffectAppliedOnCreation:!1,cashEffectAppliedOnCreation:!!(ne&&J),limitsReservedOnCreation:!!ne,limitReservedType:L==="transfer"?"transfer":"withdraw",profitAddedOnCreation:!1},Os={...ia,id:vt,status:ne?"pending":"completed",commissionMode:L==="transfer"||$e?"add":"deduct",totalCharged:L==="transfer"?_+nt+ce:$e?_+O:y,walletEffectAppliedOnCreation:!1,cashEffectAppliedOnCreation:!!(ne&&J),limitsReservedOnCreation:!!ne,limitReservedType:L==="transfer"?"transfer":"withdraw",sentAmount:L==="transfer"?_:void 0,transferredAmount:L==="transfer"?_:void 0,withdrawnAmount:L==="withdraw"?i?y:_:void 0,senderName:L==="withdraw"&&lr.trim()!==""?lr.trim():void 0,createdAt:new Date,type:L==="transfer"?"send":"withdraw",senderPhone:qt||"",receiverPhone:xt||""};try{ja.current=[Os,...ja.current],M.setQueryData(["recentTransactions",t==null?void 0:t.uid,j||"main"],q=>!q||!Array.isArray(q)?[Os]:[Os,...q])}catch(q){console.error("Error in optimistic update:",q)}if(E&&be)try{const q=L==="transfer",ie={...be};q?(ie.dailyTransferUsed=(ie.dailyTransferUsed||0)+_,ie.monthlyTransferUsed=(ie.monthlyTransferUsed||0)+_):(ie.dailyWithdrawUsed=(ie.dailyWithdrawUsed||0)+_,ie.monthlyWithdrawUsed=(ie.monthlyWithdrawUsed||0)+_),As(ie)}catch(q){console.error("Error in optimistic limit update:",q)}const Jd=[Os,...oe];G.startTransition(()=>{Ze(ut),ct(mt),ne&&(S.status="pending"),zt(Jd),i&&!ne&&x({title:"تم خصم العموله",description:`سلم للعميل: ${_} جنيه`,variant:"default",duration:5e3})});try{setTimeout(()=>{try{localStorage.setItem(Uo(),JSON.stringify(Jd))}catch{}},0)}catch{}if(Ne)try{const q=new Date,ie=q.getFullYear(),Ee=String(q.getMonth()+1).padStart(2,"0"),qe=String(q.getDate()).padStart(2,"0"),ht=`zeroPlanDailyConfirmCount:${(t==null?void 0:t.uid)||"default"}:${ie}-${Ee}-${qe}`,Tt=localStorage.getItem(ht),Ht=Tt&&parseInt(Tt,10)||0;localStorage.setItem(ht,String(Ht+1))}catch{}setTimeout(()=>{try{const q=new Date().toISOString();localStorage.setItem(Ve(),ut.toString()),localStorage.setItem(Ve()+"_lastUpdated",q),localStorage.setItem(et(),JSON.stringify(mt)),localStorage.setItem(et()+"_lastUpdated",q)}catch{}},0);try{if(t!=null&&t.uid){const q=$.find(Ms=>Ms.id===E)??$.find(Ms=>Ms.isDefault)??$[0],ie=(q==null?void 0:q.id)||E,Ee=Number(mt[ie]||0),qe=String((q==null?void 0:q.phone)||qt||"").trim(),ht=String(xt||"").trim(),Tt=Number(ce)>0,Ht=L==="transfer"?"🟢":"🔴",Je=Number(nt)>0?`${Number(nt)} جنيه`:"0 جنيه",wt=Tt?` و رسوم ${Number(ce)} جنيه`:"",Pt=L==="transfer"?`${Ht} تم تحويل مبلغ ${Number(_)} جنيه من رقم المحفظة ${qe} إلى رقم المحفظة ${ht} وتم أخذ عمولة ${Je}${wt}. الرصيد المتبقي في المحفظة: ${Ee} جنيه. الفلوس النقدية المتبقية: ${Number(ut)} جنيه.`:`${Ht} تم السحب مبلغ ${Number(_)} جنيه من الدرج إلى رقم المحفظة ${qe} وتم أخذ عمولة ${Je}${wt}. الرصيد المتبقي في المحفظة: ${Ee} جنيه. الفلوس النقدية المتبقية: ${Number(ut)} جنيه.`,Es=t!=null&&t.uid?`tg_last_msg_${t.uid}`:"tg_last_msg",De=Date.now();let Nt=!0;try{const Ms=localStorage.getItem(Es);if(Ms){const Ws=JSON.parse(Ms),uf=String((Ws==null?void 0:Ws.text)||""),mf=Number((Ws==null?void 0:Ws.at)||0);uf===Pt&&De-mf<5e3&&(Nt=!1)}}catch{}if(Nt){Promise.resolve(ns.send(t.uid,Pt)).catch(()=>{});try{localStorage.setItem(Es,JSON.stringify({text:Pt,at:De}))}catch{}}}}catch{}if((async()=>{try{console.log("🔄 بدء حفظ المعاملة في Firebase في الخلفية...");const q={...ia},ie={...Os},{ProfitService:Ee}=await Z(async()=>{const{ProfitService:Je}=await import("./profitService-D3SXiBSD.js");return{ProfitService:Je}},__vite__mapDeps([48,0,1]),import.meta.url),qe=Ee.calculateProfitFromTransaction({...ie,status:"confirmed"});qe>0&&(Ee.addProfit(qe,t==null?void 0:t.uid),q.profitAddedOnCreation=!0,ie.profitAddedOnCreation=!0,console.log("✅ تم إضافة الربح:",qe,"جنيه"));const ht=await Gf.create(q);if(E)try{const Je=await cs.updateUsage(E,_,L==="transfer"?"transfer":"withdraw");Je&&As(Je);try{window.dispatchEvent(new CustomEvent("walletLimitsUpdated",{detail:{walletId:E}}))}catch{}}catch{}await Promise.all([...t!=null&&t.uid?[ae.updateUserData(t.uid,{cashBalance:ut,walletBalances:mt,lastUpdated:new Date().toISOString()})]:[],...t!=null&&t.uid?[ae.saveUserTransaction(t.uid,{...ie,transactionId:ht,transactionType:L,fromWallet:E,toWallet:L==="transfer"?B?null:"cash":null,cashierName:D&&((k==null?void 0:k.name)||(k==null?void 0:k.username))||"الحساب الرئيسي",linkedDebtId:tt||void 0,description:`${L==="transfer"?"تحويل":"سحب"} ${_} من ${E} ${L==="transfer"?B?"":"إلى الدرج النقدي":""} — عمولة: ${O} (${L==="transfer"||$e?"مضافة":"مخصومة"})${ce>0?` — رسوم: ${ce}`:""}${ne?" — دين مؤجل (قيد المراجعة)":""}`})]:[]]),console.log("✅ تم حفظ جميع البيانات في Firebase بنجاح");try{const Je={...Os,id:ht};ja.current=ja.current.map(wt=>wt.id===vt?Je:wt),M.setQueryData(["recentTransactions",t==null?void 0:t.uid,j||"main"],wt=>!wt||!Array.isArray(wt)?[Je]:wt.map(Pt=>Pt.id===vt?Je:Pt)),G.startTransition(()=>{zt(wt=>wt.map(Pt=>Pt.id===vt?Je:Pt))})}catch(Je){console.error("Error updating query cache with real ID:",Je)}setTimeout(()=>{try{console.log("🔄 تنفيذ التحديث المؤجل (10 ثواني) لضمان تطابق البيانات..."),M.invalidateQueries({queryKey:["recentTransactions",t==null?void 0:t.uid,j||"main"]}),M.invalidateQueries({queryKey:["dashboardData",j||(n==null?void 0:n.shopId)]}),E&&(M.invalidateQueries({queryKey:["walletLimits",E]}),Xo())}catch(Je){console.error("Error in delayed refresh:",Je)}},1e4);const Tt=`userData_${t==null?void 0:t.uid}`,Ht={cashBalance:ut,walletBalances:mt,lastUpdated:new Date().toISOString()};localStorage.setItem(Tt,JSON.stringify(Ht))}catch(q){console.error("❌ خطأ في حفظ المعاملة في Firebase (في الخلفية):",q);try{t!=null&&t.uid&&ae.saveLocalReceipt(t.uid,{...transactionDataForUser,transactionType:L,fromWallet:E,toWallet:L==="transfer"?B?null:"cash":null,cashierName:D&&((k==null?void 0:k.name)||(k==null?void 0:k.username))||"الحساب الرئيسي",linkedDebtId:tt||void 0,description:`${L==="transfer"?"تحويل":"سحب"} ${_} من ${E} ${L==="transfer"?B?"":"إلى الدرج النقدي":""} — عمولة: ${O} (${L==="transfer"||$e?"مضافة":"مخصومة"})${ce>0?` — رسوم: ${ce}`:""}${ne?" — دين مؤجل (قيد المراجعة)":""}`})}catch{}x({title:"تحذير",description:"تم تنفيذ العملية محلياً، لكن فشلت المزامنة مع الخادم. ستتم المحاولة مرة أخرى تلقائياً.",variant:"destructive"})}})(),L==="transfer"){Ds(!0);const q=Number(y)+Number(O)+Math.max(0,Number(ce));to({type:"transfer",amount:Math.max(0,Math.round(q*100)/100)}),Ah({receiver:xt,amount:y}),ji(null),ra(!0),setTimeout(()=>{Ds(!1)},2e3)}else gr(!0),to({type:"withdraw",amount:_,isDeduct:i}),ra(!0),setTimeout(()=>{gr(!1)},2e3);or(""),vs(""),eo(!1),oc(""),lc(""),Ri(null),Mi(""),Qa(""),dc(""),uc(!1),setTimeout(()=>{Fe.current=!1,Le(!1)},1500)}catch(v){console.error("CRITICAL ERROR IN TRANSACTION:",v),x({title:"خطأ غير متوقع",description:"حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.",variant:"destructive"}),l()}},Mr=G.useMemo(()=>new Intl.DateTimeFormat("ar-EG"),[]),Bd=G.useMemo(()=>new Intl.DateTimeFormat("ar-EG",{hour:"2-digit",minute:"2-digit"}),[]),af=G.useMemo(()=>{try{return _e.reduce((a,s)=>{if(s.type==="debtor")return a;const i=Number(s.paidAmount||0),l=Math.max(0,Number(s.amount||0)-i);return a+l},0)}catch{return 0}},[_e]),el=G.useMemo(()=>Pd().filter(s=>aa==="all"?!0:aa==="send"?s.type==="send":aa==="receive"?s.type==="receive":aa==="withdraw"?s.type==="withdraw":aa==="deferred"?s.status==="pending":aa!=="deleted"),[Pd,aa]),sf=()=>{if(Qi==="daily"){const a=St.resetReportsManually("daily",oe,t==null?void 0:t.uid);mr(!1),x({title:"تم تصفير المعاملات اليومية",description:`تم إخفاء ${a.length} معاملة من تقارير اليوم (الحدود لم تتأثر)`})}else{const a=St.resetReportsManually("monthly",oe,t==null?void 0:t.uid);mr(!1),x({title:"تم تصفير المعاملات الشهرية",description:`تم إخفاء ${a.length} معاملة من تقارير الشهر (الحدود لم تتأثر)`})}},rf=()=>Qi==="daily"?"تصفير المعاملات اليومية":"تصفير المعاملات الشهرية",nf=()=>Qi==="daily"?"أدخل الرقم السري الرئيسي لتصفير تقارير اليوم عن طريق إخفاء معاملات اليوم من التقارير":"أدخل الرقم السري الرئيسي لتصفير تقارير الشهر عن طريق إخفاء معاملات الشهر من التقارير",of=a=>{wd(a),To(!0)},lf=a=>{const s=We,i=Number(a)-Number(s);Ze(a);const l=new Date().toISOString();localStorage.setItem(Ve(),a.toString()),localStorage.setItem(Ve()+"_lastUpdated",l),od(!1);const d={cashBalance:a,lastUpdated:l},m=`userData_${t==null?void 0:t.uid}`;try{localStorage.setItem(m,JSON.stringify(d))}catch{}const f=[];if(t!=null&&t.uid){f.push(ae.updateUserData(t.uid,d).then(()=>{try{localStorage.removeItem(m)}catch{}}).catch(()=>{}));const g=`${i>0?"CASHADD":"CASHDEDUCT"}-${(t==null?void 0:t.uid)||"anon"}-${Date.now()}`,v=i>0?{txnType:"cash_addition",type:"cash_addition",amount:i,status:"confirmed",senderMsisdn:"إضافة نقدية",receiverMsisdn:"",reference:g,title:"إيصال إضافة نقدية",merchantUserId:t.uid,createdBy:t.uid,shopId:(n==null?void 0:n.shopId)||void 0}:i<0?{amount:Math.abs(i),status:"completed",title:"ايصال خصم من الفلوس النقديه",merchantUserId:t.uid,createdBy:t.uid,shopId:(n==null?void 0:n.shopId)||void 0}:null;v&&f.push(ae.saveUserTransaction(t.uid,v));const y=n==null?void 0:n.shopId;if(y){const p=Te(V,"dashboardData",y);f.push(Xt(p,{cashBalance:a}))}}Promise.allSettled(f).then(()=>{}).catch(()=>{}),x({title:i>0?"تم إضافة نقدية":i<0?"تم خصم نقدية":"تم تحديث الرصيد النقدي",description:i!==0?`التغيير: ${Math.abs(i)} جنيه، الرصيد الجديد: ${a} جنيه`:`تم تحديث الرصيد النقدي إلى ${a} جنيه`})},cf=async a=>{var f;if(!Ft){console.warn("لا يوجد معرف محفظة محدد لتعديل الرصيد");return}const s={...we,[Ft]:a};ct(s);const i=new Date().toISOString(),l={walletBalances:s,lastUpdated:i},d=`userData_${t==null?void 0:t.uid}`;try{localStorage.setItem(d,JSON.stringify(l)),localStorage.setItem(et(),JSON.stringify(s)),localStorage.setItem(et()+"_lastUpdated",i),localStorage.setItem(`walletBalances_backup_${i}`,JSON.stringify(s))}catch{}try{t!=null&&t.uid&&await ae.updateUserData(t.uid,l)}catch(g){console.error("خطأ أثناء حفظ رصيد المحفظة في Firebase:",g)}ld(!1);const m=((f=$.find(g=>g.id===Ft))==null?void 0:f.name)||"المحفظة";x({title:"تم تحديث رصيد المحفظة",description:`تم تحديث رصيد ${m} إلى ${a.toLocaleString()} جنيه`})},df=async a=>{var s;if(console.log("💰 بدء تحديث رصيد المحفظة"),console.log("📊 معرف المحفظة المحررة:",Ft),console.log("💵 المبلغ المضاف/المخصوم:",a),Ft){const i=we[Ft]||0;console.log("💰 الرصيد الحالي:",i);const l=i+a;console.log("💰 الرصيد الجديد:",l);const d={...we,[Ft]:l};console.log("📊 الأرصدة المحدثة:",d),ct(d);const m=new Date().toISOString(),f={walletBalances:d,lastUpdated:m},g=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(g,JSON.stringify(f)),localStorage.setItem(et(),JSON.stringify(d)),localStorage.setItem(`walletBalances_backup_${m}`,JSON.stringify(d));try{if(t!=null&&t.uid){console.log("🔄 حفظ البيانات في Firebase...");try{await ae.updateUserData(t.uid,f),console.log("✅ تم حفظ الأرصدة في Firebase بنجاح"),setTimeout(()=>{localStorage.removeItem(g),console.log("🧹 تم حذف النسخة المحلية المؤقتة بعد دقيقة واحدة")},6e4)}catch(N){console.error("❌ فشل في حفظ البيانات في Firebase:",N),pe(!0)}}else console.log("⚠️ المستخدم غير مسجل دخول، حفظ في localStorage"),localStorage.setItem(et(),JSON.stringify(d));const v=((s=$.find(N=>N.id===Ft))==null?void 0:s.name)||"المحفظة",y=a>0?"إضافة":"خصم",p=Math.abs(a);x({title:`تم ${y} مبلغ ${y==="إضافة"?"إلى":"من"} رصيد المحفظة`,description:`تم ${y} ${p} جنيه ${y==="إضافة"?"إلى":"من"} رصيد ${v}. الرصيد الجديد: ${l.toLocaleString()} جنيه`})}catch(v){if(console.error("❌ فشل في حفظ البيانات في Firebase:",v),localStorage.setItem(et(),JSON.stringify(d)),t!=null&&t.uid){const y=`userData_${t.uid}`,p={walletBalances:d,lastUpdated:new Date().toISOString()};localStorage.setItem(y,JSON.stringify(p)),pe(!0)}x({title:"تم حفظ البيانات محلياً",description:"تم حفظ التغييرات محلياً وسيتم مزامنتها مع الخادم لاحقاً",variant:"default"})}}else console.log("❌ لا يوجد معرف محفظة للتحرير");setTimeout(()=>{const l=Object.keys(localStorage).filter(d=>d.startsWith("walletBalances_backup_")).sort();l.length>5&&l.slice(0,l.length-5).forEach(m=>{localStorage.removeItem(m),console.log("🗑️ حذف النسخة الاحتياطية القديمة:",m)})},5e3),To(!1),wd("")};return console.log("🔥 UserDashboardPage - Render conditions:",{isCheckingActivation:Si,isUserActive:er,showActivationModal:Bm}),Si?(console.log("🔥 UserDashboardPage - Showing loading screen"),e.jsx(Rf,{})):(console.log("🔥 UserDashboardPage - Rendering main dashboard"),e.jsxs("div",{id:"dashboard-content-container",className:"user-dashboard h-[100dvh] overflow-y-auto px-2 sm:px-4 pt-2 sm:py-4 relative bg-gray-100 bg-[radial-gradient(140%_140%_at_10%_10%,#e5e7eb_0%,#d1d5db_45%,#9ca3af_100%)] no-scrollbar",children:[e.jsx(Kb,{userId:t==null?void 0:t.uid}),e.jsxs("div",{className:"max-w-screen-2xl mx-auto grid grid-cols-1 xl:grid-cols-3 gap-4 xl:gap-6 relative z-10",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-2 sm:gap-3 fade-in-up",children:[!vr&&e.jsxs(Ca,{className:"bg-gray-100 dark:bg-card border border-gray-200 dark:border-gray-800 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 relative overflow-hidden",children:[e.jsx(is,{className:"pb-2 px-3 pt-3 relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(os,{className:"text-sm font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 rounded-md bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700",children:e.jsx(mu,{className:"h-4 w-4 text-gray-700 dark:text-gray-300"})}),e.jsx("span",{className:"text-sm",children:"الشهر"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>{jc("monthly"),mr(!0)},className:"h-8 w-8 p-0 bg-transparent hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 rounded-full transition-colors duration-200",title:"تصفير معاملات الشهر",children:e.jsx(oa,{className:"h-3.5 w-3.5"})}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>Ki(!0),className:"h-8 w-8 p-0 bg-transparent hover:bg-purple-50 dark:hover:bg-purple-900/20 text-purple-600 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300 rounded-full transition-colors duration-200",title:"عرض تقارير يوم/شهر محدد",children:e.jsx(li,{className:"h-3.5 w-3.5"})}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>Ki(!0),className:"h-8 w-8 p-0 bg-transparent hover:bg-blue-50 dark:hover:bg-blue-900/20 text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 rounded-full transition-colors duration-200",title:"تقاريرك",children:e.jsx(ei,{className:"h-3.5 w-3.5"})}),e.jsx("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 rounded-full border border-green-100 dark:border-green-900/30",children:e.jsx(Lr,{className:"h-3.5 w-3.5 text-green-600 dark:text-green-400"})})]})]})}),!vr&&e.jsxs(Ia,{className:"pt-0 px-2 pb-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-0 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-800 divide-x divide-y divide-gray-200 dark:divide-gray-800 bg-white dark:bg-gray-900",children:[e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-blue-600 dark:text-blue-400",children:"عدد المعاملات"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-blue-800 dark:text-blue-300 mt-0.5 sm:mt-0",children:Ts.totalTransactions})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-gray-600 dark:text-gray-400",children:"إجمالي المبالغ"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-gray-900 dark:text-gray-100 mt-0.5 sm:mt-0",children:Ts.totalAmount.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-red-600 dark:text-red-400",children:"المسحوب"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-red-800 dark:text-red-300 mt-0.5 sm:mt-0",children:Ts.totalWithdrawn.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-green-600 dark:text-green-400",children:"المرسل"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-green-800 dark:text-green-300 mt-0.5 sm:mt-0",children:Ts.totalSent.toFixed(2)})]})]}),e.jsxs("div",{className:"mt-2 rounded-lg border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-900 px-2 py-1.5 flex items-center justify-between",children:[e.jsx("span",{className:"text-[12px] font-bold text-yellow-600 dark:text-yellow-400",children:"الأرباح"}),e.jsx(fb,{userId:t==null?void 0:t.uid,transactions:oe})]})]}),$h&&e.jsx("div",{className:"absolute inset-0 z-20 backdrop-blur-sm bg-amber-50/60 dark:bg-amber-900/10 flex items-center justify-center p-0 pointer-events-auto",children:e.jsxs(I,{size:"sm",variant:"ghost",onClick:async()=>{if(Ne){x({title:"غير متاح",description:"تقارير الشهر غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"});return}jn(!0)},className:"px-4 py-2 rounded-full bg-white dark:bg-card border border-gray-100 dark:border-gray-800 text-gray-900 dark:text-gray-100 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-800 hover:shadow-md transition-all duration-200 flex items-center gap-2 text-xs font-medium",title:"عرض تقارير الشهر (يتطلب الرقم السري)",children:[e.jsx("span",{children:"عرض تقارير الشهر"}),e.jsx(Js,{className:"h-3.5 w-3.5 text-gray-600 dark:text-gray-400"})]})})]}),e.jsx(la,{open:Vh,onOpenChange:jn,mode:"verify",title:"الرقم السري لفتح تقارير الشهر",description:"لا يمكن الاطلاع على إحصائيات الشهر إلا بإدخال الرقم السري الرئيسي",onSuccess:()=>{if(Ne){x({title:"غير متاح",description:"تقارير الشهر غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}),jn(!1),no(!0);return}no(!1),jn(!1)},userId:t==null?void 0:t.uid}),(It==null?void 0:It.planType)!==Zt.TAHWEELA&&e.jsxs(Ca,{className:"bg-gray-50 dark:bg-card border border-gray-200 dark:border-gray-800 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 relative overflow-hidden",children:[e.jsx(is,{className:"pb-2 px-3 pt-3 relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(os,{className:"text-sm font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 rounded-md bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700",children:e.jsx(mu,{className:"h-4 w-4 text-gray-700 dark:text-gray-300"})}),e.jsx("span",{className:"text-sm",children:"اليوم"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>{jc("daily"),mr(!0)},className:"h-8 w-8 p-0 bg-transparent hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 rounded-full transition-colors duration-200",title:"تصفير معاملات اليوم",children:e.jsx(oa,{className:"h-3.5 w-3.5"})}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>Uh(a=>!a),className:"h-8 w-8 p-0 bg-transparent hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 rounded-full transition-colors duration-200",title:vr?"توسيع اليوم والشهر":"طي اليوم والشهر",children:vr?e.jsx(og,{className:"h-3.5 w-3.5"}):e.jsx(lg,{className:"h-3.5 w-3.5"})}),e.jsx("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 rounded-full border border-green-100 dark:border-green-900/30",children:e.jsx(Lr,{className:"h-3.5 w-3.5 text-green-600 dark:text-green-400"})})]})]})}),!vr&&e.jsxs(Ia,{className:"pt-0 px-2 pb-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-0 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-800 divide-x divide-y divide-gray-200 dark:divide-gray-800 bg-white dark:bg-gray-900",children:[e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-blue-600 dark:text-blue-400",children:"عدد المعاملات"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-blue-800 dark:text-blue-300 mt-0.5 sm:mt-0",children:Zn.totalTransactions})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-gray-600 dark:text-gray-400",children:"إجمالي المبالغ"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-gray-900 dark:text-gray-100 mt-0.5 sm:mt-0",children:Zn.totalAmount.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-red-600 dark:text-red-400",children:"المسحوب"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-red-800 dark:text-red-300 mt-0.5 sm:mt-0",children:Zn.totalWithdrawn.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-green-600 dark:text-green-400",children:"المرسل"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-green-800 dark:text-green-300 mt-0.5 sm:mt-0",children:Zn.totalSent.toFixed(2)})]})]}),e.jsxs("div",{className:"mt-2 rounded-lg border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-900 px-2 py-1.5 flex items-center justify-between",children:[e.jsx("span",{className:"text-[12px] font-bold text-yellow-600 dark:text-yellow-400",children:"الأرباح"}),e.jsx(xb,{userId:t==null?void 0:t.uid,transactions:oe})]})]}),Jh&&e.jsx("div",{className:"absolute inset-0 z-20 backdrop-blur-sm bg-white/60 dark:bg-black/60 flex items-center justify-center p-0 pointer-events-auto",children:e.jsxs(I,{size:"sm",variant:"ghost",onClick:()=>oo(!0),className:"px-4 py-2 rounded-full bg-white dark:bg-card border border-gray-100 dark:border-gray-800 text-gray-900 dark:text-gray-100 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-800 hover:shadow-md transition-all duration-200 flex items-center gap-2 text-xs font-medium",title:"عرض تقارير اليوم (يتطلب الرقم السري)",children:[e.jsx("span",{children:"عرض تقارير اليوم"}),e.jsx(Js,{className:"h-3.5 w-3.5 text-gray-600 dark:text-gray-400"})]})})]}),e.jsx(la,{open:Hh,onOpenChange:oo,mode:"verify",title:"الرقم السري لفتح تقارير اليوم",description:"لا يمكن الاطلاع على تقارير اليوم إلا بإدخال الرقم السري الرئيسي",onSuccess:()=>{Rc(!1),oo(!1)},userId:t==null?void 0:t.uid})]}),e.jsxs(Ca,{className:"balance-bar bg-gray-200 border-2 border-gray-200/50 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 group relative overflow-hidden   transform fade-in-up mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-500/5 via-blue-500/5 to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),e.jsx("div",{className:"absolute top-0 left-0 w-40 h-40 bg-gradient-to-br from-emerald-300/10 to-transparent rounded-full -translate-y-20 -translate-x-20 group-hover:scale-150 transition-transform duration-200"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-blue-300/10 to-transparent rounded-full translate-y-20 translate-x-20 group-hover:scale-150 transition-transform duration-200"}),e.jsx(Ia,{className:"p-2 relative z-10",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:[e.jsxs("div",{className:"bg-white dark:bg-card border border-gray-200 dark:border-gray-800 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/cash relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-500/10 to-transparent opacity-0 group-hover/cash:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex flex-col relative z-10 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-emerald-100 to-emerald-200 dark:from-emerald-900/30 dark:to-emerald-800/30 rounded-lg shadow-sm",children:e.jsx(Pa,{className:"h-1.5 w-1.5 text-emerald-600 dark:text-emerald-400"})}),e.jsx("span",{className:"text-[11px] font-extrabold text-emerald-800 dark:text-emerald-300",children:"الفلوس النقدية"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors",onClick:()=>Ir(!0),children:e.jsx(jt,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-emerald-600 dark:text-emerald-400 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-colors",onClick:()=>jd(!0),title:"تفاصيل الفلوس النقدية",children:e.jsx(nl,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",onClick:()=>Hn(!0),children:e.jsx(oa,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-0.5",children:e.jsxs("span",{className:"text-[14px] sm:text-xl font-bold text-emerald-800 dark:text-emerald-200 bg-gradient-to-r from-emerald-100 to-emerald-200 dark:from-emerald-900/30 dark:to-emerald-800/30 px-1 py-0.5 rounded-lg shadow-sm block w-fit",children:[We.toLocaleString("en-US")," جنيه"]})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-card border border-gray-200 dark:border-gray-800 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/wallet relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/10 to-transparent opacity-0 group-hover/wallet:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex flex-col relative z-10 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-blue-100 to-blue-200 dark:from-blue-900/30 dark:to-blue-800/30 rounded-lg shadow-sm",children:e.jsx($s,{className:"h-1.5 w-1.5 text-blue-600 dark:text-blue-400"})}),e.jsx("span",{className:"text-[11px] font-extrabold text-blue-800 dark:text-blue-300",children:"الأرصدة علي المحافظ"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors",onClick:()=>qn(!0),title:"إضافة أموال لإجمالي المحفظة",children:e.jsx(jt,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors",onClick:()=>Hi(!0),title:"عرض المحافظ",children:e.jsx($s,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",onClick:()=>{Kn(!0),Jn("")},title:"تصفير إجمالي المحفظة",children:e.jsx(oa,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-0.5",children:e.jsxs("span",{className:"text-[14px] sm:text-xl font-bold text-blue-800 dark:text-blue-200 bg-gradient-to-r from-blue-100 to-blue-200 dark:from-blue-900/30 dark:to-blue-800/30 px-1 py-0.5 rounded-lg shadow-sm block w-fit",children:[$.reduce((a,s)=>a+(Number(we[s.id])||0),0).toLocaleString("en-US")," جنيه"]})})]})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1 bg-white dark:bg-card border border-gray-200 dark:border-gray-800 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/selwallet relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-transparent opacity-0 group-hover/selwallet:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex flex-col relative z-10 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-indigo-100 to-indigo-200 dark:from-indigo-900/30 dark:to-indigo-800/30 rounded-lg shadow-sm",children:e.jsx($s,{className:"h-1.5 w-1.5 text-indigo-600 dark:text-indigo-400"})}),e.jsx("span",{className:"text-[11px] font-extrabold text-indigo-800 dark:text-indigo-300",children:"رصيد المحفظه"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors",onClick:()=>{if(!E){x({title:"اختر محفظة",description:"يرجى اختيار محفظة من اختيار المحافظ بالأعلى أولاً",variant:"destructive"});return}of(E)},title:"إضافة/خصم إلى رصيد المحفظة المختارة",children:e.jsx(jt,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",onClick:()=>{if(!E){x({title:"اختر محفظة",description:"يرجى اختيار محفظة لتصفير رصيدها فقط",variant:"destructive"});return}Pn(!0)},title:"تصفير رصيد المحفظة المختارة",children:e.jsx(oa,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-0.5",children:e.jsxs("span",{className:"text-[14px] sm:text-xl font-bold text-indigo-800 dark:text-indigo-200 bg-gradient-to-r from-indigo-100 to-indigo-200 dark:from-indigo-900/30 dark:to-indigo-800/30 px-1 py-0.5 rounded-lg shadow-sm block w-fit",children:[(E&&we[E]||0).toLocaleString("en-US")," جنيه"]})})]})]})]})})]}),e.jsxs(Ca,{className:"bg-gray-100 dark:bg-card border border-gray-200 dark:border-gray-800 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 group relative overflow-hidden fade-in-up",children:[e.jsxs(is,{className:`pb-2 px-4 pt-4 relative z-10 ${W?"sticky top-0 z-20 bg-white/90 dark:bg-card/90 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:supports-[backdrop-filter]:bg-card/60":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(os,{className:"text-sm font-bold flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[!W&&e.jsx("div",{className:"p-1.5 sm:p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Lr,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5 text-gray-700 dark:text-gray-300"})}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:"المعاملات الأخيرة"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!W&&e.jsxs("div",{className:"flex items-center gap-0.5 bg-gray-100 dark:bg-gray-800 rounded px-1 py-0.5 border border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-500 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[e.jsx(rg,{className:"h-2 w-2 text-gray-400 dark:text-gray-500 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors"}),e.jsx(K,{placeholder:"بحث...",value:Dc,onChange:a=>Ch(a.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 dark:text-gray-200 placeholder:text-gray-400 dark:placeholder:text-gray-500"})]}),!W&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"خطوط"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>re("lines",()=>{const a=(o==null?void 0:o.simSubscription)||(t==null?void 0:t.simSubscription);let s=!1;a!=null&&a.active&&(a!=null&&a.endsAt)&&(a.endsAt.seconds?new Date(a.endsAt.seconds*1e3):new Date(a.endsAt))>new Date&&(s=!0),s?Nn(!0):ze(!0)}),title:"إدارة الخطوط",children:e.jsx(Lf,{className:"h-5 w-5 text-purple-600"})})]}),!Yt.includes("installment")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"تقسيط"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>re("installments",()=>{if(Ne||Ce){x({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"});return}pr(!0)}),title:"إدارة التقسيط",children:e.jsx(Ff,{className:"h-5 w-5 text-purple-600"})})]}),!Yt.includes("store")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 mb-1",children:"متجرك"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600",onClick:()=>Ye(!0),title:"متجرك",children:e.jsx(Fr,{className:"h-5 w-5 text-blue-600"})})]}),!Yt.includes("calculator")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"حاسبة"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>ro(!0),title:"آلة حاسبة",children:e.jsx(bg,{className:"h-5 w-5 text-purple-600"})})]}),!Yt.includes("credit-cards")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"كروت"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>re("cards",()=>{Ne||Ce?x({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):xr(!0)}),title:"كروت الائتمان",children:e.jsx(Bf,{className:"h-5 w-5 text-purple-600"})})]}),e.jsxs("div",{className:"hidden flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 mb-1",children:"تقاريرك"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600",onClick:()=>{if(Ne||Ce){x({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"});return}gd(!0)},title:"تقاريرك",children:e.jsx(hu,{className:"h-5 w-5 text-blue-600"})})]}),!Yt.includes("telegram")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-sky-600 mb-1",children:"تلجرام"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-sky-100 text-sky-600 hover:bg-sky-200 border border-sky-200 ring-3 ring-sky-300 transition-all duration-200 hover:scale-105 active:bg-sky-600 active:text-white active:border-sky-600",onClick:()=>{Ne||Ce?x({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):Bt.hasMasterPin()?Qo(!0):Od()},title:"إرسال تقرير يومي إلى تليجرام",children:e.jsx($f,{className:"h-5 w-5 text-sky-600"})})]}),!Yt.includes("cashier-shift")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 mb-1",children:"الوردية"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600",onClick:P0,title:D&&(k!=null&&k.name||k!=null&&k.username)?`بروفيل الوردية: ${(k==null?void 0:k.name)||(k==null?void 0:k.username)}`:"وردية الكاشير",children:e.jsx(Br,{className:"h-5 w-5 text-blue-600"})})]}),!Yt.includes("sales")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"المبيعات"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>re("sales",()=>{Ne||Ce?x({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):Ss(!0)}),title:"بيانات المبيعات",children:e.jsx(il,{className:"h-5 w-5 text-purple-600"})})]}),!Yt.includes("debts")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600",children:"الديون"}),_e.filter(a=>a.status==="pending").length>0&&e.jsx("span",{className:"h-4 w-4 rounded-full bg-red-600 text-white text-[10px] flex items-center justify-center ring-2 ring-white",children:_e.filter(a=>a.status==="pending").length})]}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>re("debts",()=>{In()}),title:"الديون",children:e.jsx(ei,{className:"h-5 w-5 text-purple-600"})})]}),!Yt.includes("maintenance")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-amber-700 mb-1",children:"الصيانة"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-amber-100 text-amber-700 hover:bg-amber-200 border border-amber-200 ring-3 ring-amber-300 transition-all duration-200 hover:scale-105 active:bg-amber-600 active:text-white active:border-amber-600",onClick:()=>re("maintenance",()=>{Ne||Ce?x({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):yr(!0)}),title:"الصيانة",children:e.jsx(eu,{className:"h-5 w-5 text-amber-700"})})]}),!Yt.includes("machine")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-yellow-500 mb-1",children:"المكنة"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-violet-100 text-violet-700 hover:bg-violet-200 border border-violet-200 ring-3 ring-violet-300 transition-all duration-200 hover:scale-105 active:bg-violet-700 active:text-white active:border-violet-700",onClick:()=>re("machines",()=>{!Jt||Ce?x({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):br(!0)}),title:"يومية المكنة",children:e.jsx(Uf,{className:"h-5 w-5 text-yellow-500"})})]}),!Yt.includes("shop-expenses")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-orange-600 mb-1",children:"مصروفات"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-orange-100 text-orange-600 hover:bg-orange-200 border border-orange-200 ring-3 ring-orange-300 transition-all duration-200 hover:scale-105 active:bg-orange-600 active:text-white active:border-orange-600",onClick:()=>re("expenses",()=>{Ne||Ce?x({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):Bt.hasMasterPin()?gs(!0):Ja(!0)}),title:"مصروفات المحل",children:e.jsx($r,{className:"h-5 w-5 text-orange-600"})})]}),!Yt.includes("deficiencies")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-rose-600 mb-1",children:"النواقص"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-rose-100 text-rose-600 hover:bg-rose-200 border border-rose-200 ring-3 ring-rose-300 transition-all duration-200 hover:scale-105 active:bg-rose-600 active:text-white active:border-rose-600",onClick:()=>re("deficiencies",()=>{Ne||Ce?x({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):sr(!0)}),title:"النواقص",children:e.jsx(tu,{className:"h-5 w-5 text-rose-600"})})]}),!Yt.includes("my-client-numbers")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-emerald-600 mb-1",children:"أرقامي"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-emerald-100 text-emerald-700 hover:bg-emerald-200 border border-emerald-200 ring-3 ring-emerald-300 transition-all duration-200 hover:scale-105 active:bg-emerald-600 active:text-white active:border-emerald-600",onClick:()=>re("myNumbers",()=>{Ne||Ce?x({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):cn(!0)}),title:"أرقامي",children:e.jsx(ti,{className:"h-5 w-5 text-emerald-700"})})]})]})]})]}),!W&&e.jsx("div",{className:"mt-2 w-full",children:e.jsxs("div",{className:"filters-bar flex items-center justify-center gap-3 bg-gray-100 rounded-md p-3 border border-gray-200",children:[e.jsx(I,{variant:"ghost",size:"sm",className:`btn-filter-send h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${aa==="send"?"bg-green-600 text-white border-green-600":"text-green-700 border-green-300 hover:bg-green-100"}`,onClick:()=>gn("send"),title:"تصفية التحويل",children:"التحويل"}),e.jsx(I,{variant:"ghost",size:"sm",className:`btn-filter-withdraw h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${aa==="withdraw"?"bg-red-600 text-white border-red-600":"text-red-700 border-red-300 hover:bg-red-100"}`,onClick:()=>gn("withdraw"),title:"تصفية السحب",children:"السحب"}),e.jsx(I,{variant:"ghost",size:"sm",className:`btn-filter-deferred h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${aa==="deferred"?"bg-yellow-600 text-white border-yellow-600":"text-yellow-700 border-yellow-300 hover:bg-yellow-100"}`,onClick:()=>gn("deferred"),title:"تصفية المؤجل",children:"مؤجل"}),e.jsx(I,{variant:"ghost",size:"sm",className:`btn-filter-all h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${aa==="all"?"bg-green-600 text-white border-green-600":"text-green-700 border-green-300 hover:bg-green-100"}`,onClick:()=>gn("all"),title:"عرض الكل",children:"الكل"}),e.jsxs("div",{className:"relative ml-1",children:[e.jsxs(I,{variant:"ghost",size:"sm",className:"h-auto px-2 py-1 text-xs text-red-600 hover:bg-red-50 rounded-md font-medium",onClick:()=>kr(!0),title:"تصفير المعاملات الأخيرة",children:[e.jsx(oa,{className:"h-3 w-3 mr-1"}),"تصفير"]}),U0>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"})]})]})})]}),e.jsx(la,{open:Eh,onOpenChange:pr,mode:"verify",title:"فتح إدارة التقسيط",description:"أدخل الرقم السري الرئيسي للوصول إلى إدارة التقسيط",onSuccess:()=>{pr(!1),Pc(!0)}}),e.jsx(Rb,{open:Mh,onOpenChange:Pc}),e.jsx(Lb,{isOpen:Wh,onClose:()=>Nn(!1),shopId:j,onOpenAdsl:()=>{Nn(!1),Oc(!0)}}),e.jsx(lu,{isOpen:Ie,onClose:()=>ze(!1),userId:(t==null?void 0:t.uid)||"",userEmail:(t==null?void 0:t.email)||""}),e.jsx(Fb,{isOpen:Rh,onClose:()=>Oc(!1),shopId:j}),e.jsx(la,{open:J0,onOpenChange:Qo,mode:"verify",title:"إرسال تقرير يومي إلى تليجرام",description:"أدخل الرقم السري الرئيسي لإرسال التقرير اليومي إلى تليجرام",onSuccess:()=>{Qo(!1),Od()}}),e.jsxs(Ia,{className:"space-y-2 pt-0 px-4 pb-4 relative z-10",children:[el.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Lr,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"لا توجد معاملات حتى الآن"})]}):W?e.jsx("div",{className:"overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors max-h-[310px]",children:e.jsx("div",{className:"space-y-2 pr-2",children:el.map(a=>e.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>Wd(a),children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center shrink-0 ${a.type==="withdraw"?"bg-red-100":"bg-green-100"}`,children:(()=>{const s=a,i=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("إيصال تسليم وردية"),l=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("إيصال إضافة نقدية"),d=String((s==null?void 0:s.type)||"").toLowerCase()==="sales"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="sales"||String((s==null?void 0:s.title)||"").includes("إيصال مبيعات")||String((s==null?void 0:s.senderMsisdn)||"")==="مبيعات";return i?e.jsx($r,{className:"h-5 w-5 text-gray-600"}):l?e.jsx(jt,{className:"h-5 w-5 text-green-600"}):d?e.jsx($r,{className:"h-5 w-5 text-green-600"}):a.type==="withdraw"?e.jsx(qs,{className:"h-5 w-5 text-red-600"}):e.jsx(cu,{className:"h-5 w-5 text-green-600"})})()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"text-base font-bold truncate",children:(()=>{const s=a,i=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("إيصال تسليم وردية"),l=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("إيصال إضافة نقدية"),d=String((s==null?void 0:s.type)||"").toLowerCase()==="sales"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="sales"||String((s==null?void 0:s.title)||"").includes("إيصال مبيعات")||String((s==null?void 0:s.senderMsisdn)||"")==="مبيعات",m=String((s==null?void 0:s.title)||"").includes("إيصال تحويل مكينه")||String((s==null?void 0:s.description)||"").includes("تحويل مكنه");return i?e.jsx("span",{className:"text-foreground",children:"تسليم وردية"}):m?e.jsx("span",{className:"text-foreground",children:"إيصال تحويل مكينه"}):l?e.jsx("span",{className:"text-foreground",children:"إضافة نقدية"}):d?e.jsx("span",{className:"text-foreground",children:"مبيعات"}):a.type==="send"?e.jsx("span",{className:"text-green-600",children:"تحويل أموال"}):e.jsx("span",{className:"text-red-600",children:"سحب نقدي"})})()}),e.jsxs("span",{className:`text-base font-bold whitespace-nowrap ${a.type==="withdraw"?"text-red-600":"text-green-600"}`,children:[a.type==="withdraw"||a.type==="cash_addition"||a.txnType==="cash_addition"||a.type==="sales"||a.txnType==="sales"?"+":"-"," ",Ot(a.amount)," ج.م"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:(()=>{const s=a,i=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("إيصال تسليم وردية"),l=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("إيصال إضافة نقدية"),d=String((s==null?void 0:s.type)||"").toLowerCase()==="sales"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="sales"||String((s==null?void 0:s.title)||"").includes("إيصال مبيعات")||String((s==null?void 0:s.senderMsisdn)||"")==="مبيعات",m=String((s==null?void 0:s.title)||"").includes("إيصال تحويل مكينه")||String((s==null?void 0:s.description)||"").includes("تحويل مكنه"),f=(s==null?void 0:s.note)||(s==null?void 0:s.notes)||"";if(i)return`إلى: ${a.receiverPhone}`;if(l)return f||"إضافة يدوية";if(d){const g=((s==null?void 0:s.saleProductName)||"").trim(),v=((s==null?void 0:s.saleQuantity)??"").toString();return g&&v?`${g} × ${v}`:g||"عملية بيع"}return m?`من: ${s.senderName||"ماكينة"}`:a.type==="send"?e.jsx("span",{dir:"ltr",children:a.receiverPhone}):e.jsx("span",{dir:"ltr",children:a.senderPhone})})()}),e.jsxs("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:[Mr.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))," - ",Bd.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))]})]}),e.jsxs("div",{className:`px-2 py-0.5 rounded-full text-[10px] font-medium flex items-center gap-1 ${a.status==="completed"?a.type==="withdraw"?"bg-red-100 text-red-700":"bg-green-100 text-green-700":a.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[a.status==="completed"&&e.jsx(ai,{className:"h-3 w-3"}),a.status==="pending"&&e.jsx(au,{className:"h-3 w-3"}),a.status==="failed"&&e.jsx(si,{className:"h-3 w-3"}),e.jsx("span",{children:a.status==="completed"?"ناجحة":a.status==="pending"?"معالجة":"فشلت"})]})]})]})]},a.id))})}):e.jsx("div",{className:"overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors max-h-[calc(100dvh-300px)]",children:e.jsx("div",{className:"space-y-2 pr-2",children:el.map(a=>e.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>Wd(a),children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center shrink-0 ${a.type==="withdraw"?"bg-red-100":"bg-green-100"}`,children:(()=>{const s=a,i=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("إيصال تسليم وردية"),l=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("إيصال إضافة نقدية"),d=String((s==null?void 0:s.type)||"").toLowerCase()==="sales"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="sales"||String((s==null?void 0:s.title)||"").includes("إيصال مبيعات")||String((s==null?void 0:s.senderMsisdn)||"")==="مبيعات";return i?e.jsx($r,{className:"h-5 w-5 text-gray-600"}):l?e.jsx(jt,{className:"h-5 w-5 text-green-600"}):d?e.jsx($r,{className:"h-5 w-5 text-green-600"}):a.type==="withdraw"?e.jsx(qs,{className:"h-5 w-5 text-red-600"}):e.jsx(cu,{className:"h-5 w-5 text-green-600"})})()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"text-base font-bold truncate",children:(()=>{const s=a,i=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("إيصال تسليم وردية"),l=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("إيصال إضافة نقدية"),d=String((s==null?void 0:s.type)||"").toLowerCase()==="sales"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="sales"||String((s==null?void 0:s.title)||"").includes("إيصال مبيعات")||String((s==null?void 0:s.senderMsisdn)||"")==="مبيعات",m=String((s==null?void 0:s.title)||"").includes("إيصال تحويل مكينه")||String((s==null?void 0:s.description)||"").includes("تحويل مكنه");return i?e.jsx("span",{className:"text-foreground",children:"تسليم وردية"}):l?e.jsx("span",{className:"text-foreground",children:"إضافة نقدية"}):d?e.jsx("span",{className:"text-foreground",children:"مبيعات"}):m?e.jsx("span",{className:"text-foreground",children:"إيصال تحويل مكينه"}):a.type==="send"?e.jsx("span",{className:"text-green-600",children:"تحويل أموال"}):e.jsx("span",{className:"text-red-600",children:"سحب نقدي"})})()}),e.jsxs("span",{className:`text-base font-bold whitespace-nowrap ${a.type==="withdraw"?"text-red-600":"text-green-600"}`,children:[a.type==="withdraw"||a.type==="cash_addition"||a.txnType==="cash_addition"||a.type==="sales"||a.txnType==="sales"?"+":"-"," ",Ot(a.amount)," ج.م"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:(()=>{const s=a,i=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("إيصال تسليم وردية"),l=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("إيصال إضافة نقدية"),d=String((s==null?void 0:s.type)||"").toLowerCase()==="sales"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="sales"||String((s==null?void 0:s.title)||"").includes("إيصال مبيعات")||String((s==null?void 0:s.senderMsisdn)||"")==="مبيعات",m=String((s==null?void 0:s.title)||"").includes("إيصال تحويل مكينه")||String((s==null?void 0:s.description)||"").includes("تحويل مكنه"),f=(s==null?void 0:s.note)||(s==null?void 0:s.notes)||"";if(i)return`إلى: ${a.receiverPhone}`;if(l)return f||"إضافة يدوية";if(d){const g=((s==null?void 0:s.saleProductName)||"").trim(),v=((s==null?void 0:s.saleQuantity)??"").toString();return g&&v?`${g} × ${v}`:g||"عملية بيع"}return m?`من: ${s.senderName||"ماكينة"}`:a.type==="send"?e.jsx("span",{dir:"ltr",children:a.receiverPhone}):e.jsx("span",{dir:"ltr",children:a.senderPhone})})()}),e.jsxs("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:[Mr.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))," - ",Bd.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))]})]}),e.jsxs("div",{className:`px-2 py-0.5 rounded-full text-[10px] font-medium flex items-center gap-1 ${a.status==="completed"?a.type==="withdraw"?"bg-red-100 text-red-700":"bg-green-100 text-green-700":a.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[a.status==="completed"&&e.jsx(ai,{className:"h-3 w-3"}),a.status==="pending"&&e.jsx(au,{className:"h-3 w-3"}),a.status==="failed"&&e.jsx(si,{className:"h-3 w-3"}),e.jsx("span",{children:a.status==="completed"?"ناجحة":a.status==="pending"?"معالجة":"فشلت"})]})]})]})]},a.id))})}),W&&e.jsxs("div",{className:"mt-2 flex justify-end",children:[e.jsxs(I,{variant:"ghost",size:"sm",className:"h-7 px-2 text-[11px] rounded-full border bg-red-100 text-red-700 border-red-300 hover:bg-red-200",onClick:()=>kr(!0),title:"تصفير المعاملات الأخيرة",children:[e.jsx(oa,{className:"h-3 w-3 mr-1"}),"تصفير"]}),(t==null?void 0:t.uid)&&localStorage.getItem(`recentTransactionsResetAt:${t.uid}`)&&e.jsx("span",{className:"inline-block h-1.5 w-1.5 rounded-full bg-red-500 ml-1 align-middle"})]})]})]})]}),e.jsx(Cb,{isOpen:bh,onClose:()=>bn(!1),transaction:vh,onPrint:()=>window.print(),onDelete:Dh,onComplete:kh}),e.jsx(he,{open:Na,onOpenChange:He,children:e.jsxs(fe,{className:"sm:max-w-md",children:[e.jsx(xe,{children:e.jsx(ye,{children:"معلومات المطور"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4 bg-gradient-to-br from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 p-6 rounded-xl border border-blue-100 dark:border-blue-800 text-center",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400 shadow-sm",children:e.jsx(eg,{className:"h-8 w-8"})}),e.jsxs("div",{className:"space-y-3 w-full",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"معلومات التطوير"}),e.jsx("p",{className:"text-lg font-bold bg-gradient-to-r from-blue-700 to-indigo-700 dark:from-blue-400 dark:to-indigo-400 bg-clip-text text-transparent leading-relaxed",children:"تم تطوير الابلكيشن بالكامل بواسطة م/أحمد عبد الرحيم محمد"}),e.jsxs("div",{className:"flex flex-col items-center gap-1 mt-4",children:[e.jsx("p",{className:"text-base font-semibold text-gray-800 dark:text-gray-300",children:"رقم خدمة العملاء الوحيد لنا"}),e.jsx("a",{href:"tel:01000392539",className:"text-2xl font-black text-blue-600 dark:text-blue-400 tracking-wider hover:underline",dir:"ltr",children:"01000392539"})]}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 font-bold bg-red-50 dark:bg-red-900/20 py-1 px-3 rounded-full inline-block mt-2",children:"ليس لنا اي ارقام اخري"})]})]}),e.jsx("div",{className:"text-center text-xs text-gray-400 mt-2",children:ql?`v${ql}`:"v1.0.0"})]}),e.jsx(Pe,{children:e.jsx(I,{onClick:()=>He(!1),children:"إغلاق"})})]})}),e.jsxs("div",{className:"space-y-1 fade-in-right w-full",children:[e.jsxs(Ca,{id:"transaction-section",className:"bg-gray-100 border border-blue-200/40 rounded-lg shadow-lg hover:shadow-lg transition-all duration-200 group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/5 via-indigo-500/3 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-28 sm:h-28 lg:w-20 lg:h-20 bg-gradient-to-bl from-blue-400/10 to-transparent rounded-full  "}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-indigo-400/10 to-transparent rounded-full  ",style:{animationDelay:"1s"}}),e.jsx(is,{className:"sticky top-0 z-20 bg-white/80 dark:bg-gray-900/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:supports-[backdrop-filter]:bg-gray-900/60 pb-0.5 px-3 pt-1 lg:pt-0.5 lg:pb-0.5 lg:px-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(os,{className:"text-sm font-bold flex items-center gap-2 text-gray-800",children:[e.jsxs("div",{className:"relative",children:[e.jsx(oi,{className:"h-1 w-1 text-emerald-500 "}),e.jsx("div",{className:"absolute inset-0 h-1 w-1 bg-emerald-400 rounded-full opacity-20 "})]}),e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"إجراء معاملة جديدة"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"top-icons-bar hidden md:flex items-center gap-2 bg-gradient-to-r from-gray-50 to-slate-50 hover:from-gray-100 hover:to-slate-100 border border-gray-200 transition-all duration-300 hover:scale-105 h-9 px-3 rounded-xl shadow-sm",children:[e.jsx(ub,{}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"VIP",onClick:()=>io(!0),children:e.jsx(vg,{className:"h-5 w-5 text-yellow-500"})}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"إدارة الفروع",onClick:()=>(pt==null?void 0:pt.status)==="active"?Oa(!0):Vt(!0),children:e.jsx(Fr,{className:"h-5 w-5"})}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"معلومات المطور",onClick:()=>He(!0),children:e.jsx(eu,{className:"h-5 w-5 text-gray-600"})}),e.jsx(pg,{})]})}),K0&&e.jsxs(I,{variant:"outline",size:"sm",className:"hidden flex items-center gap-1.5 sm:gap-2 bg-gradient-to-r from-cyan-50 to-blue-50 hover:from-cyan-100 hover:to-blue-100 border-cyan-200 text-cyan-800 text-xs sm:text-sm transition-all duration-300 hover:scale-105 hover:shadow-lg h-10 sm:h-12 px-4 sm:px-5 rounded-xl min-w-[44px] touch-manipulation",onClick:Id,title:"مزامنة البيانات المحفوظة محلياً مع الخادم",children:[e.jsx(ol,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 animate-spin"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold whitespace-nowrap",children:"مزامنة"})]})]})}),e.jsx(he,{open:Kh,onOpenChange:io,children:e.jsxs(fe,{className:"sm:max-w-md",children:[e.jsx(xe,{children:e.jsx(ye,{children:"أفضل 10 عملاء هذا الشهر"})}),e.jsx("div",{className:"space-y-2",children:Yn.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"لا توجد بيانات لهذا الشهر"}):Yn.map((a,s)=>e.jsxs("div",{className:`flex items-center justify-between border rounded-md px-3 py-2 bg-white dark:bg-gray-800 dark:border-gray-700 ${s===0?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-300 dark:border-yellow-700":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_a,{variant:"outline",className:`min-w-[28px] justify-center ${s===0?"border-yellow-300 text-yellow-700 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20":""}`,children:s+1}),e.jsx("span",{className:`font-semibold ${s===0?"text-yellow-700":""}`,children:a.phone})]}),e.jsxs("div",{className:"text-sm text-gray-700 flex items-center gap-3",children:[e.jsxs("span",{children:["عدد: ",a.count]}),e.jsxs("span",{children:["إجمالي: ",a.total]}),e.jsx(I,{variant:"outline",size:"sm",className:"h-8",onClick:()=>q0(a),title:"إرسال واتساب",children:e.jsx(tl,{className:"h-4 w-4"})})]})]},a.phone+s))}),e.jsx(Pe,{children:e.jsx(I,{onClick:()=>io(!1),children:"إغلاق"})})]})}),e.jsx(he,{open:qh,onOpenChange:Ec,children:e.jsxs(fe,{className:"sm:max-w-md",children:[e.jsx(xe,{children:e.jsx(ye,{children:"ربط بوت التلجرام"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ee,{children:"Telegram Chat ID"}),e.jsx(K,{value:Sn,onChange:a=>zh(a.target.value),placeholder:"اكتب رقم المحادثة"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ee,{children:"إرسال يومي 12 صباحاً"}),e.jsx(gg,{checked:Mc,onCheckedChange:a=>Yh(!!a)})]})]}),e.jsxs(Pe,{children:[e.jsx(I,{variant:"outline",onClick:()=>Ec(!1),children:"إغلاق"}),e.jsx(I,{onClick:async()=>{t!=null&&t.uid&&(await ae.updateUserData(t.uid,{telegramChatId:Sn,telegramDailyEnabled:Mc}),x({title:"تم الحفظ"}))},children:"حفظ"}),e.jsx(I,{onClick:async()=>{if(!(t!=null&&t.uid)||!Sn){x({title:"أدخل Chat ID"});return}const a=await Td();try{const{sendTelegramMessage:s}=await Z(async()=>{const{sendTelegramMessage:i}=await import("./functions-B25VVZyV.js");return{sendTelegramMessage:i}},__vite__mapDeps([64,0,1]),import.meta.url);await s({chatId:Sn,text:a}),x({title:"تم الإرسال"})}catch{x({title:"تعذر الإرسال",description:"تحقق من ربط البوت",variant:"destructive"})}},children:"إرسال الآن"})]})]})}),e.jsx(he,{open:Wt,onOpenChange:Oa,children:e.jsxs(fe,{className:"sm:max-w-2xl bg-gray-50/80 backdrop-blur-sm",children:[e.jsx(xe,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg",children:e.jsx(Fr,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx(ye,{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"إدارة الفروع"}),e.jsx(Xe,{className:"text-gray-500 dark:text-gray-400 mt-1",children:"أضف فروعاً جديدة وتابع أداء كل فرع بسهولة"})]})]}),e.jsx(I,{size:"icon",variant:hs?"destructive":"default",className:`rounded-full transition-all duration-300 ${hs?"bg-red-50 text-red-600 hover:bg-red-100 border border-red-200":"bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg hover:shadow-indigo-200"}`,onClick:()=>$l(!hs),title:hs?"إلغاء الإضافة":"إضافة فرع جديد",children:hs?e.jsx(ri,{className:"w-6 h-6"}):e.jsx(jt,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"space-y-6",children:[hs&&e.jsxs("div",{className:"bg-white dark:bg-card p-5 rounded-xl border border-gray-200 dark:border-gray-800 shadow-sm space-y-4 animate-in slide-in-from-top-4 fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-700 dark:text-indigo-400 font-semibold",children:[e.jsx(jt,{className:"w-5 h-5"}),e.jsx("h3",{children:"إضافة فرع جديد"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{onClick:()=>checkSubscriptionStatus(!0).then(()=>x({title:"تم تحديث البيانات"})),variant:"ghost",size:"icon",title:"تحديث بيانات الاشتراك",children:e.jsx(ol,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})}),e.jsxs(I,{onClick:()=>Vt(!0),variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(Cg,{className:"w-4 h-4"}),"طلب زيادة فرع"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{className:"text-gray-700 dark:text-gray-300",children:"اسم المدير"}),e.jsxs("div",{className:"relative",children:[e.jsx(Br,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(K,{className:"pr-9 bg-white dark:bg-gray-950 dark:border-gray-700 dark:text-gray-100",value:za,onChange:a=>ms(a.target.value),placeholder:"مثال: أحمد محمد"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{className:"text-gray-700 dark:text-gray-300",children:"اسم الفرع"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fr,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(K,{className:"pr-9 bg-white dark:bg-gray-950 dark:border-gray-700 dark:text-gray-100",value:Xs,onChange:a=>gi(a.target.value),placeholder:"مثال: فرع وسط البلد"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{className:"text-gray-700 dark:text-gray-300",children:"البريد الإلكتروني للدخول"}),e.jsxs("div",{className:"relative",children:[e.jsx(tl,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(K,{className:"pr-9 bg-white dark:bg-gray-950 dark:border-gray-700 dark:text-gray-100",value:Ol,onChange:a=>pi(a.target.value),placeholder:"branch@example.com"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{className:"text-gray-700 dark:text-gray-300",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400",children:"🔒"}),e.jsx(K,{type:"password",className:"pr-9 bg-white dark:bg-gray-950 dark:border-gray-700 dark:text-gray-100",value:El,onChange:a=>xi(a.target.value),placeholder:"••••••"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-2",children:[e.jsx(I,{variant:"ghost",onClick:()=>{ms(""),gi(""),pi(""),xi("")},className:"text-gray-500 hover:text-gray-700",children:"مسح الحقول"}),e.jsx(I,{className:"bg-indigo-600 hover:bg-indigo-700 text-white min-w-[120px]",disabled:yi,onClick:async()=>{if(!(t!=null&&t.uid))return;const a=za.trim(),s=Xs.trim(),i=Ol.trim(),l=El.trim();if(!a||!s||!i||!l){x({title:"يرجى ملء جميع الحقول المطلوبة"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){x({title:"البريد الإلكتروني غير صالح",variant:"destructive"});return}if(l.length<6){x({title:"كلمة السر يجب أن تكون 6 أحرف على الأقل",variant:"destructive"});return}const m=(pt==null?void 0:pt.limit)||0;if(Ea.length>=m){x({title:"عفواً",description:`لقد وصلت للحد الأقصى من الفروع (${m} فروع)`,variant:"destructive"});return}try{en(!0);let f="",g="";const v=`tempApp_${Date.now()}`,y=Vf(qf,v),p=zf(y),N=Yf(y);try{f=(await Kf(p,i,l)).user.uid;try{await Qt(Te(N,"users",f),{email:i,isActive:!0,isBranch:!0,ownerId:t.uid,createdAt:ft(),updatedAt:ft(),role:"branch",isActive:!1,subscription:{isActive:!1,planType:null,startDate:null,endDate:null}})}catch(A){console.error("Error creating branch user document:",A)}try{g=(await ni(me(N,"shops"),{name:s,ownerId:f,managerName:a,createdAt:ft(),updatedAt:ft(),isActive:!0})).id}catch(A){console.error("Error creating shop as new user:",A);try{g=(await ni(me(N,"users",f,"shops"),{name:s,ownerId:f,managerName:a,createdAt:ft(),updatedAt:ft(),isActive:!0})).id}catch(O){throw console.error("Error creating shop in subcollection:",O),A}}await Jf(p)}catch(S){console.error("Registration/Shop Creation Error:",S);let A="تعذر إنشاء المستخدم أو المتجر";S.code==="auth/email-already-in-use"&&(A="البريد الإلكتروني مستخدم بالفعل"),S.code==="auth/invalid-email"&&(A="البريد الإلكتروني غير صالح"),S.code==="auth/weak-password"&&(A="كلمة المرور ضعيفة"),S.code==="permission-denied"&&(A="ليس لديك صلاحية لإنشاء متجر لهذا المستخدم"),x({title:A,description:S.message,variant:"destructive"});try{await su(y)}catch{}return}finally{try{await su(y)}catch(S){console.warn("Error deleting temp app:",S)}}if(!f||!g)return;const C=S=>{try{return btoa(unescape(encodeURIComponent(S)))}catch{return btoa(S)}};try{const S={ownerId:t.uid,shopId:g,branchUserId:f,branchName:s,managerName:a,loginUsername:i,passwordEncoded:C(l),createdAt:ft()};await Qt(Te(V,"users",t.uid,"branches",f),S);try{await ni(me(V,"branches"),S)}catch(O){console.warn("Branch ref creation error in root collection (non-fatal):",O)}const A={id:f,branchUserId:f,branchName:s,managerName:a,source:"sub",...S};us(O=>[...O,A])}catch(S){console.error("Branch ref creation error:",S),x({title:"خطأ في حفظ بيانات الفرع",description:"تم إنشاء المستخدم ولكن فشل حفظ البيانات",variant:"destructive"})}ms(""),gi(""),pi(""),xi(""),x({title:"تم إضافة الفرع وإنشاء المستخدم بنجاح"})}catch(f){console.error("General Error adding branch:",f),x({title:"تعذّر إضافة الفرع",description:f.message||"حدث خطأ غير متوقع"})}finally{en(!1)}},children:yi?"جارٍ الإضافة...":"إضافة فرع"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-6 bg-indigo-500 rounded-full"}),"الفروع الحالية",e.jsxs(_a,{variant:"secondary",className:"mr-auto",children:[Ea.length," / ",(pt==null?void 0:pt.limit)||0]})]}),yi&&Ea.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:[e.jsx(ol,{className:"w-8 h-8 animate-spin mb-2 text-indigo-400"}),e.jsx("p",{children:"جارٍ تحميل الفروع..."})]}):Ea.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-xl bg-gray-50 dark:bg-gray-900/50",children:[e.jsx(Fr,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"لا يوجد فروع مضافة حالياً"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-3",children:Ea.map(a=>{var s;return e.jsx("div",{className:"group relative bg-white dark:bg-card border border-gray-200 dark:border-gray-800 rounded-xl p-4 shadow-sm hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-700 dark:text-indigo-400 font-bold text-lg",children:((s=a.branchName)==null?void 0:s.charAt(0))||"B"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-gray-900 dark:text-gray-100 text-lg",children:a.branchName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(Br,{className:"w-3 h-3"}),e.jsxs("span",{children:["المدير: ",a.managerName]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto mt-2 sm:mt-0",children:[e.jsxs(I,{className:"flex-1 sm:flex-none bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200 dark:bg-indigo-900/20 dark:text-indigo-300 dark:hover:bg-indigo-900/30 dark:border-indigo-800",onClick:()=>Tm(a),children:[e.jsx(il,{className:"w-4 h-4 ml-2"}),"عرض البيانات"]}),e.jsx(I,{variant:"ghost",size:"icon",className:"text-blue-500 hover:text-blue-700 hover:bg-blue-50 dark:text-blue-400 dark:hover:text-blue-300 dark:hover:bg-blue-900/20",title:"تعديل بيانات الفرع",onClick:()=>_m(a),children:e.jsx(uu,{className:"w-4 h-4"})})]})]})},a.id)})})]})]})]})}),e.jsx(he,{open:pm,onOpenChange:bi,children:e.jsxs(fe,{className:"sm:max-w-md",children:[e.jsxs(xe,{children:[e.jsx(ye,{children:"دخول الفرع"}),e.jsx(Xe,{children:"أدخل بيانات الدخول للفرع المحدد"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(ee,{children:"اسم المستخدم (البريد الإلكتروني)"}),e.jsx(K,{value:Ml,onChange:a=>Wl(a.target.value),placeholder:"example@email.com"})]}),e.jsxs("div",{children:[e.jsx(ee,{children:"كلمة السر"}),e.jsx(K,{type:"password",value:Rl,onChange:a=>Ll(a.target.value),placeholder:"••••••"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{Wl(""),Ll("")},children:"مسح"}),e.jsx(I,{className:"bg-blue-600 hover:bg-blue-700",disabled:ym,onClick:async()=>{const a=xm;if(!a){bi(!1);return}const s=String(a.loginUsername||"");let i="";try{const m=String(a.passwordEncoded||"");i=m?decodeURIComponent(escape(atob(m))):""}catch{try{i=a.passwordEncoded?atob(String(a.passwordEncoded)):""}catch{i=""}}const l=Ml.trim(),d=Rl.trim();if(!l||!d){x({title:"يرجى إدخال اسم المستخدم وكلمة السر"});return}if(l!==s||d!==i){x({title:"بيانات الدخول غير صحيحة",variant:"destructive"});return}try{Fl(!0);const m=t!=null&&t.uid?`selectedShopId_${t.uid}`:"selectedShopId";localStorage.setItem(m,String(a.shopId)),x({title:"تم الدخول إلى الفرع",description:String(a.branchName||"")}),bi(!1),Oa(!1),b("/user/dashboard")}catch{}Fl(!1)},children:"دخول"})]})]})]})}),e.jsx(he,{open:bm,onOpenChange:tn,children:e.jsxs(fe,{className:"sm:max-w-2xl",children:[e.jsxs(xe,{children:[e.jsxs(ye,{children:["بيانات فرع ",Ct==null?void 0:Ct.branchName]}),e.jsxs(Xe,{children:["مدير الفرع: ",Ct==null?void 0:Ct.managerName]})]}),vm?e.jsx("div",{className:"py-8 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):Ct?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 py-4",children:[e.jsxs("div",{className:"p-4 border rounded-xl bg-green-50 dark:bg-green-950/20 dark:border-green-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"مبيعات اليوم"}),e.jsxs("div",{className:"text-xl font-bold text-green-700 dark:text-green-400",children:[Ot(Ct.todaySales)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-blue-50 dark:bg-blue-950/20 dark:border-blue-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"مبيعات الشهر"}),e.jsxs("div",{className:"text-xl font-bold text-blue-700 dark:text-blue-400",children:[Ot(Ct.monthSales)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-emerald-50 dark:bg-emerald-950/20 dark:border-emerald-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"ارباح اليوم"}),e.jsxs("div",{className:"text-xl font-bold text-emerald-700 dark:text-emerald-400",children:[Ot(Ct.todayProfit)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-cyan-50 dark:bg-cyan-950/20 dark:border-cyan-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"ارباح الشهر"}),e.jsxs("div",{className:"text-xl font-bold text-cyan-700 dark:text-cyan-400",children:[Ot(Ct.monthProfit)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-purple-50 dark:bg-purple-950/20 dark:border-purple-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"أرصدة المحافظ"}),e.jsxs("div",{className:"text-xl font-bold text-purple-700 dark:text-purple-400",children:[Ot(Ct.walletsTotal)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-yellow-50 dark:bg-yellow-950/20 dark:border-yellow-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"نقدية الدرج"}),e.jsxs("div",{className:"text-xl font-bold text-yellow-700 dark:text-yellow-400",children:[Ot(Ct.cashBalance)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-indigo-50 dark:bg-indigo-950/20 dark:border-indigo-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"مبيعات قسم المبيعات"}),e.jsxs("div",{className:"text-xl font-bold text-indigo-700 dark:text-indigo-400",children:[Ot(Ct.totalSalesSection)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-red-50 dark:bg-red-950/20 dark:border-red-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"مجموع الديون"}),e.jsxs("div",{className:"text-xl font-bold text-red-700 dark:text-red-400",children:[Ot(Ct.debtsTotal)," ج.م"]})]})]}):null,e.jsx(Pe,{children:e.jsx(I,{onClick:()=>tn(!1),children:"إغلاق"})})]})}),e.jsx(he,{open:Dm,onOpenChange:an,children:e.jsxs(fe,{className:"sm:max-w-md",children:[e.jsxs(xe,{children:[e.jsx(ye,{children:"تعديل بيانات الفرع"}),e.jsx(Xe,{children:"تعديل اسم الفرع واسم المدير"})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{children:"البريد الإلكتروني (اسم المستخدم)"}),e.jsx(K,{value:Cm,readOnly:!0,disabled:!0,placeholder:"لا يوجد بريد مسجل",className:"bg-gray-100 dark:bg-gray-800 text-black dark:text-gray-100 opacity-100 font-medium"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{children:"اسم الفرع"}),e.jsx(K,{value:sn,onChange:a=>zl(a.target.value),placeholder:"مثال: فرع القاهرة"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{children:"اسم المدير"}),e.jsx(K,{value:rn,onChange:a=>Yl(a.target.value),placeholder:"مثال: أحمد محمد"})]})]}),e.jsxs(Pe,{children:[e.jsx(I,{variant:"outline",onClick:()=>an(!1),children:"إلغاء"}),e.jsx(I,{onClick:Am,disabled:Kl,children:Kl?"جارٍ الحفظ...":"حفظ التعديلات"})]})]})}),e.jsxs(Ia,{ref:te,className:"space-y-1 px-2 pb-2 relative z-10 transition-transform duration-200 ease-out will-change-transform",style:{transform:U?`translateY(${U}px)`:void 0},onFocusCapture:a=>{const s=a.target;if(!((s==null?void 0:s.id)==="transferExtraFeeInput")){de(0);return}const l=document.getElementById("transferSubmitButton");if(l){const d=l.getBoundingClientRect(),m=window.innerHeight;if(d.bottom>m){const f=d.bottom-m,g=Math.min(f,220);de(-g)}else de(0)}else de(0)},onBlurCapture:a=>{a.currentTarget.contains(a.relatedTarget)||de(0)},children:[e.jsxs("div",{className:"transaction-type-tabs flex w-full rounded-full border border-gray-300 dark:border-gray-700 overflow-hidden bg-surface dark:bg-card",children:[e.jsxs("button",{type:"button",onClick:()=>Xn("transfer"),className:`flex-1 h-10 text-sm font-medium transition-colors duration-200 flex items-center justify-center gap-2 ${L==="transfer"?"bg-blue-100 text-blue-900 dark:bg-blue-900/40 dark:text-blue-100":"bg-transparent text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[L==="transfer"&&e.jsx(ai,{className:"h-4 w-4"}),e.jsx(Lr,{className:"h-4 w-4"}),"تحويل"]}),e.jsx("div",{className:"w-[1px] bg-gray-300 dark:bg-gray-700"}),e.jsxs("button",{type:"button",onClick:()=>re("withdrawals",()=>Xn("withdraw")),className:`flex-1 h-10 text-sm font-medium transition-colors duration-200 flex items-center justify-center gap-2 ${L==="withdraw"?"bg-red-100 text-red-900 dark:bg-red-900/40 dark:text-red-100":"bg-transparent text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[L==="withdraw"&&e.jsx(ai,{className:"h-4 w-4"}),e.jsx(qs,{className:"h-4 w-4"}),"سحب"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-3",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 flex items-center gap-2 whitespace-nowrap",children:[e.jsx($s,{className:"h-4 w-4 text-blue-600"}),"اختيار المحفظة"]}),e.jsxs("div",{className:"flex items-center gap-1 justify-end overflow-x-auto scrollbar-hide",children:[e.jsxs(I,{variant:"outline",size:"sm",className:"h-7 rounded-md px-2 text-[10px] font-medium bg-emerald-50 text-emerald-700 hover:bg-emerald-100 border-emerald-200 shadow-sm whitespace-nowrap",onClick:()=>b("/user/add-wallet"),title:"إضافة محفظة",children:[e.jsx(jt,{className:"h-3 w-3 mr-1"}),"إضافة محفظة"]}),e.jsxs(I,{variant:"outline",size:"sm",className:"h-7 rounded-md px-2 text-[10px] font-medium bg-orange-50 text-orange-700 hover:bg-orange-100 border-orange-200 shadow-sm whitespace-nowrap",onClick:()=>ue(!0),title:"طباعة محفظة",children:[e.jsx(wg,{className:"h-3 w-3 mr-1"}),"طباعة"]}),e.jsxs(I,{variant:"outline",size:"sm",className:"h-7 rounded-md px-2 text-[10px] font-medium bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border-indigo-200 shadow-sm whitespace-nowrap",onClick:()=>{mn(!0)},title:"المحافظ",children:[e.jsx($s,{className:"h-3 w-3 mr-1"}),"المحافظ"]})]})]}),$.length>0?e.jsxs(Rs,{value:E,onValueChange:Q0,children:[e.jsx(Ls,{"data-testid":"wallet-select",className:"w-full h-14 text-base bg-surface border border-gray-400 hover:border-gray-800 focus:border-primary rounded-xl transition-colors duration-200 flex items-center",children:e.jsx(Fs,{placeholder:"اختر محفظة للمعاملة",className:"text-gray-700"})}),e.jsxs(Bs,{className:"rounded-xl border border-gray-200 dark:border-gray-800 shadow-md z-[9999] bg-white dark:bg-gray-900",children:[e.jsx("div",{"data-fixed-header":"true",className:"sticky top-0 z-10 bg-white dark:bg-gray-900 p-2 border-b border-gray-100 dark:border-gray-800",children:e.jsx(K,{value:bc,onChange:a=>gh(a.target.value),placeholder:"ابحث برقم المحفظة",className:"h-10 text-sm border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 rounded-lg"})}),e.jsx("div",{className:"p-1",children:wc.length===0?e.jsx("div",{className:"text-sm text-gray-500 p-3 text-center",children:"لا توجد نتائج مطابقة"}):wc.map(a=>{const s=z.includes(a.id);return e.jsx(Aa,{value:a.id,className:"rounded-lg my-1 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 focus:bg-blue-50 dark:focus:bg-blue-900/20 transition-colors duration-200",children:e.jsxs("div",{className:"flex items-center gap-3 py-2 w-full",children:[e.jsx($s,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"}),e.jsxs("div",{className:"flex items-center gap-2 text-right",children:[e.jsx("span",{className:"text-base font-medium text-gray-900 dark:text-gray-100",children:a.name}),e.jsx("span",{className:"text-sm font-bold text-red-600 dark:text-red-400",children:a.phone})]}),a.isDefault&&e.jsx("span",{className:"mr-auto text-[10px] bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 px-2 py-0.5 rounded-full border border-gray-200 dark:border-gray-700",children:"افتراضي"}),e.jsx("button",{type:"button",onMouseDown:i=>{i.preventDefault(),i.stopPropagation(),ph(a.id)},className:"ml-2 mr-auto rounded-full p-1 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 cursor-pointer",title:s?"إزالة من المفضلة":"تعيين كمحفظة مفضلة",children:e.jsx(Ng,{className:`h-4 w-4 ${s?"text-yellow-500 fill-yellow-400 drop-shadow-[0_0_4px_rgba(250,204,21,0.8)]":"text-gray-400"}`})})]})},a.id)})})]})]}):e.jsx("div",{className:"rounded-xl border-2 border-dashed border-gray-200 bg-gray-50 px-3 py-3 text-xs text-gray-600",children:"لا توجد محافظ حتى الآن. اضغط “إضافة محفظة” لإضافة أول محفظة."})]}),e.jsx(he,{open:Km,onOpenChange:mc,children:e.jsxs(fe,{className:"sm:max-w-3xl w-[95vw] sm:w-auto max-h-[80vh] overflow-y-auto",children:[e.jsx(xe,{children:e.jsx(ye,{children:"عرض المحافظ"})}),e.jsx("div",{className:"mt-2",children:e.jsx(Ub,{showAddButton:!1,showUsageBars:!1,showLimitCards:!1,showEditButton:!0})})]})}),e.jsx(la,{open:Jm,onOpenChange:mn,mode:"verify",title:"الرقم السري لفتح المحافظ",description:"أدخل الرقم السري الرئيسي لعرض وإدارة المحافظ",onSuccess:()=>{mn(!1),mc(!0)},userId:t==null?void 0:t.uid}),e.jsx(Iu,{isOpen:Be,onClose:()=>ue(!1),wallets:$}),e.jsx(la,{open:Hm,onOpenChange:a=>{Li(a),a||Fi(null)},mode:"verify",title:"تأكيد تغيير المحفظة",description:"أدخل الرقم السري الرئيسي لتغيير المحفظة المختارة",onSuccess:()=>{hc&&(Pr(hc,"walletSelectionPin"),Fi(null)),Li(!1)},userId:t==null?void 0:t.uid}),E&&$.length>0&&(()=>{var T;const a=$.find(B=>B.id===E),s=ka,i=tf,l=(be==null?void 0:be.monthlyWithdrawLimit)??(a==null?void 0:a.monthlyWithdrawalLimit)??2e5,d=(be==null?void 0:be.monthlyTransferLimit)??(a==null?void 0:a.monthlyTransferLimit)??2e5,m=(be==null?void 0:be.monthlyWithdrawUsed)??s.totalWithdrawn??0,f=(be==null?void 0:be.monthlyTransferUsed)??s.totalTransferred??0,g=((T=It==null?void 0:It.subscription)==null?void 0:T.planType)===Zt.TAHWEELA,v=g?0:(be==null?void 0:be.dailyWithdrawLimit)??1e5,y=g?0:(be==null?void 0:be.dailyTransferLimit)??6e4,p=g?0:(be==null?void 0:be.dailyWithdrawUsed)??i.totalWithdrawn??0,N=g?0:(be==null?void 0:be.dailyTransferUsed)??i.totalTransferred??0,C=parseFloat(ot||"0")||0,S=m+(L==="withdraw"?C:0),A=f+(L==="transfer"?C:0),O=p+(L==="withdraw"?C:0),_=N+(L==="transfer"?C:0);return a?e.jsxs("div",{className:"mb-2 space-y-2 p-2 bg-gray-50 dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 shadow-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 dark:border-gray-800 pb-1",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800 dark:text-gray-200",children:"الحدود الشهرية"}),e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 px-2 py-0.5 rounded-full border border-gray-200 dark:border-gray-700",children:p0||(a==null?void 0:a.name)})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700",children:"سحب شهري"}),e.jsxs("span",{className:"text-gray-600 dir-ltr",children:[Math.max(l-S,0).toLocaleString("en-US",{maximumFractionDigits:0})," متبقي"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50 dark:ring-gray-700/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-red-500 to-red-600 rounded-full transition-all duration-500 ease-out shadow-sm",style:{width:`${Math.min(S/Math.max(l,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["المستخدم: ",S.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["الحد: ",l.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]}),e.jsx("div",{className:"w-[1px] bg-gray-200 self-stretch"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"تحويل شهري"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 dir-ltr",children:[Math.max(d-A,0).toLocaleString("en-US",{maximumFractionDigits:0})," متبقي"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50 dark:ring-gray-700/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-blue-500 to-blue-600 rounded-full transition-all duration-500 ease-out shadow-sm",style:{width:`${Math.min(A/Math.max(d,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["المستخدم: ",A.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["الحد: ",d.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]})]})]}),e.jsxs("div",{className:"space-y-1 pt-1.5 border-t border-gray-200 dark:border-gray-800",children:[e.jsx("div",{className:"flex items-center justify-between mb-0.5",children:e.jsx("span",{className:"text-sm font-bold text-gray-800 dark:text-gray-200",children:"الحدود اليومية"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"سحب يومي"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 dir-ltr",children:[Math.max(v-O,0).toLocaleString("en-US",{maximumFractionDigits:0})," متبقي"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50 dark:ring-gray-700/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-orange-400 to-orange-500 rounded-full transition-all duration-500 ease-out",style:{width:`${Math.min(O/Math.max(v,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["المستخدم: ",O.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["الحد: ",v.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]}),e.jsx("div",{className:"w-[1px] bg-gray-200 dark:bg-gray-800 self-stretch"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"تحويل يومي"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 dir-ltr",children:[Math.max(y-_,0).toLocaleString("en-US",{maximumFractionDigits:0})," متبقي"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50 dark:ring-gray-700/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-green-500 to-green-600 rounded-full transition-all duration-500 ease-out",style:{width:`${Math.min(_/Math.max(y,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["المستخدم: ",_.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["الحد: ",y.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]})]})]})]}):null})(),L==="transfer"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"رقم المرسل"}),e.jsxs("div",{className:"relative group",children:[e.jsx(ti,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-green-600 group-focus-within:text-green-700"}),e.jsx(K,{value:qt,onChange:a=>bs(a.target.value),onKeyDown:a=>{if(a.key==="Enter"){const s=document.getElementById("receiverPhoneInput");if(s)s.focus();else{const i=document.getElementById("amountInput");i==null||i.focus()}}},placeholder:"01030302038",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-blue-600 focus:ring-1 focus:ring-blue-600 dark:text-gray-100"})]})]}),!c&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"رقم المستقبل"}),e.jsxs("div",{className:"relative group",children:[e.jsx(ti,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-green-600 group-focus-within:text-green-700"}),e.jsx(K,{id:"receiverPhoneInput",value:xt,onChange:a=>{or(a.target.value),Xi&&Ds(!1)},onKeyDown:a=>{if(a.key==="Enter"){const s=document.getElementById("amountInput");s==null||s.focus()}},inputMode:"numeric",maxLength:11,placeholder:"أدخل رقم المستقبل",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-blue-600 focus:ring-1 focus:ring-blue-600 dark:text-gray-100"})]})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"رقم المستقبل"}),e.jsxs("div",{className:"relative",children:[e.jsx(ti,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400"}),e.jsx(K,{value:E&&(($d=$.find(a=>a.id===E))==null?void 0:$d.phone)||"",readOnly:!0,placeholder:"اختر محفظة أولاً",className:"pl-10 h-10 text-sm lg:text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl dark:text-gray-100"})]})]}),L==="transfer"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"المبلغ (جنيه)"}),e.jsxs("div",{className:"relative flex items-center gap-2 group",children:[e.jsx(Pa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-yellow-600 group-focus-within:text-yellow-700"}),e.jsx(K,{id:"amountInput",value:ot,onChange:a=>{vs(a.target.value),Xi&&Ds(!1)},onKeyDown:a=>{if(a.key==="Enter"){const s=document.getElementById("transferCommissionInput");if(s)s.focus();else{const i=document.getElementById("quickDebtButton");i==null||i.focus()}}},placeholder:"أدخل المبلغ",type:"number",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-blue-600 focus:ring-1 focus:ring-blue-600 dark:text-gray-100"})]}),ta?e.jsxs("div",{className:"mt-2 text-xs text-green-700 dark:text-green-400 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-900/30 rounded px-2 py-1 flex items-center gap-2",children:[e.jsxs("span",{children:["تم إدخال تفاصيل الأجل لـ ",ta.debtorName," بمبلغ ",ta.amount," جنيه"]}),e.jsx(I,{type:"button",variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>Ri(null),children:"إلغاء"})]}):null]}),(()=>{if(c)return null;const a=Qe();return a&&a.defaultTransferCommission!=null?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"عمولة التحويل (تلقائية)"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["سيتم تطبيق عمولة التحويل الافتراضية لكل ألف: ",a==null?void 0:a.defaultTransferCommission," جنيه لكل ألف"]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(I,{id:"quickDebtButton",type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium",onClick:()=>{const i=Qe(),l=(i==null?void 0:i.defaultTransferCommission)!=null?Number(i.defaultTransferCommission):0,d=parseFloat(ot||"0")||0,m=Math.round((l||0)*d/1e3*100)/100,f=d+m;Qa((f||0).toString()),Ne?x({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):ws(!0)},children:"أجل"}),e.jsx(I,{type:"button",variant:"outline",size:"icon",className:"hidden",title:$e?"العمولة تُضاف":"العمولة تُخصم",children:$e?e.jsx(jt,{className:"h-4 w-4 text-green-600"}):e.jsx(ri,{className:"h-4 w-4 text-red-600"})}),e.jsx("span",{className:"hidden",children:$e?"العمولة تُضاف":"العمولة تُخصم"})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"عمولة التحويل على العملية (جنيه)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(Pa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-yellow-600 group-focus-within:text-yellow-700"}),e.jsx(K,{id:"transferCommissionInput",value:yt,onChange:i=>fn(i.target.value),placeholder:"أدخل عمولة التحويل",type:"number",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-orange-500 focus:ring-1 focus:ring-orange-500 dark:text-gray-100"})]}),e.jsx(I,{type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium dark:bg-red-700 dark:hover:bg-red-800",onClick:()=>{const i=Qe(),l=parseFloat(ot||"0")||0;let d=0;if((i==null?void 0:i.defaultTransferCommission)!=null){const f=Number(i.defaultTransferCommission)||0;d=Math.round(f*l/1e3*100)/100}else{const f=yt&&yt.trim()!==""?parseFloat(yt):0;d=Math.max(0,f)}const m=l+d;Qa((m||0).toString()),Ne?x({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):ws(!0)},children:"أجل"}),e.jsx(I,{type:"button",variant:"outline",size:"icon",className:"hidden",title:$e?"العمولة تُضاف":"العمولة تُخصم",children:$e?e.jsx(jt,{className:"h-4 w-4 text-green-600"}):e.jsx(ri,{className:"h-4 w-4 text-red-600"})}),e.jsx("span",{className:"hidden",children:$e?"العمولة تُضاف":"العمولة تُخصم"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"يمكنك إدخال عمولة العملية الإجمالية (اختياري)"})]})})(),eh&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"رسوم التحويل (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-yellow-600"}),e.jsx(K,{id:"transferExtraFeeInput",value:fc,onChange:a=>Qm(a.target.value),placeholder:"أدخل رسوم التحويل",type:"number",className:"pl-10 h-10 text-sm lg:text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 hover:border-blue-400 focus:border-blue-500 dark:text-gray-100"})]}),e.jsx("div",{className:"hidden",children:"تُخصم من المحفظة وتضاف للدرج — لعمليات 010 → 011/012/015 أو 012 → 010 أو 011 → 010 أو 015 → 010"})]}),e.jsxs("div",{className:"sticky bottom-0 z-20 pt-2 pb-2 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 backdrop-blur supports-[backdrop-filter]:bg-white/90 dark:supports-[backdrop-filter]:bg-gray-900/90",children:[e.jsx(I,{id:"transferSubmitButton",onClick:Fd,className:"w-full h-12 text-base font-medium rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-none hover:shadow-md",children:Xi?"تم التحويل بنجاح":"تأكيد التحويل"}),Gm&&e.jsxs("div",{className:"flex items-start gap-2 mt-2 px-1",children:[e.jsx(tu,{className:"h-4 w-4 text-amber-500 shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-gray-500 leading-tight",children:["تم الوصول إلى 85% من الحد الشهري للمحفظة ",Bi==null?void 0:Bi.walletName]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"مبلغ السحب (جنيه)"}),e.jsxs("div",{className:"relative group",children:[e.jsx(qs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-primary"}),e.jsx(K,{id:"amountInput",value:ot,onChange:a=>{vs(a.target.value),Zi&&gr(!1)},onKeyDown:a=>{if(a.key==="Enter"){const s=document.getElementById("manualWithdrawCommissionInput");if(s)s.focus();else{const i=document.getElementById("withdrawSubmitButton");i==null||i.focus()}}},placeholder:"أدخل مبلغ السحب",type:"number",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-primary focus:ring-1 focus:ring-primary dark:text-gray-100"})]})]}),Xm&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"اسم الراسل (اختياري)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Br,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-500"}),e.jsx(K,{id:"withdrawSenderNameInput",value:lr,onChange:a=>lc(a.target.value),onKeyDown:a=>{if(a.key==="Enter"){const s=document.getElementById("manualWithdrawCommissionInput");s==null||s.focus()}},placeholder:"أدخل اسم الراسل إن وجد",className:"pl-10 h-10 text-sm lg:text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 hover:border-blue-400 focus:border-blue-500 dark:text-gray-100",type:"text"})]})]}),(()=>{const a=Qe();return a&&a.defaultWithdrawCommission!=null?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"عمولة السحب (تلقائية)"}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["سيتم تطبيق عمولة السحب الافتراضية لكل ألف: ",a==null?void 0:a.defaultWithdrawCommission," جنيه لكل ألف"]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(I,{type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium",onClick:()=>{const i=Qe(),l=parseFloat(ot||"0")||0,d=(i==null?void 0:i.defaultWithdrawCommission)!=null&&Number(i.defaultWithdrawCommission)||0,m=Math.round(d*l/1e3*100)/100,f=$e?l+m:l;Qa((f||0).toString()),Ne?x({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):ws(!0)},children:"أجل"}),e.jsx(I,{type:"button",variant:sa?"default":"outline",size:"sm",className:sa?"bg-green-600 hover:bg-green-700 text-white font-medium ring-2 ring-green-400 ring-offset-2":"bg-blue-600 hover:bg-blue-700 text-white font-medium",onClick:()=>eo(!sa),children:sa?"إلغاء خصم العموله":"خصم العموله"})]}),sa&&e.jsxs("div",{className:"mt-2 text-sm font-semibold text-green-600 animate-in fade-in slide-in-from-top-1",children:["سيتم تسليم العميل: ",(()=>{const i=Qe(),l=parseFloat(ot||"0")||0,d=(i==null?void 0:i.defaultWithdrawCommission)!=null&&Number(i.defaultWithdrawCommission)||0,m=Math.round(d*l/1e3*100)/100;return Math.round((l-m)*100)/100})()," جنيه"]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"عمولة السحب على العملية (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-yellow-600"}),e.jsx(K,{id:"manualWithdrawCommissionInput",value:st,onChange:i=>hn(i.target.value),onKeyDown:i=>{if(i.key==="Enter"){const l=document.getElementById("withdrawSubmitButton");l==null||l.focus()}},placeholder:"أدخل العمولة المطلوبة",type:"number",className:"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 hover:border-blue-400 focus:border-blue-500 dark:text-gray-100"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"أدخل العمولة الإجمالية لإتمام عملية السحب"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(I,{type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium",onClick:()=>{const i=Qe(),l=parseFloat(ot||"0")||0;let d=0;if((i==null?void 0:i.defaultWithdrawCommission)!=null){const f=Number(i.defaultWithdrawCommission)||0;d=Math.round(f*l/1e3*100)/100}else{const f=st&&st.trim()!==""?parseFloat(st):Math.round(l*.01*100)/100;d=Math.max(0,f)}const m=$e?l+d:l;Qa((m||0).toString()),Ne?x({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):ws(!0)},children:"أجل"}),e.jsx(I,{type:"button",variant:sa?"default":"outline",size:"sm",className:sa?"bg-green-600 hover:bg-green-700 text-white font-medium ring-2 ring-green-400 ring-offset-2":"bg-blue-600 hover:bg-blue-700 text-white font-medium",onClick:()=>eo(!sa),children:sa?"إلغاء خصم العموله":"خصم العموله"})]}),sa&&e.jsxs("div",{className:"mt-2 text-sm font-semibold text-green-600 animate-in fade-in slide-in-from-top-1",children:["سيتم تسليم العميل: ",(()=>{const i=parseFloat(ot||"0")||0,l=st&&st.trim()!==""?parseFloat(st):Math.round(i*.01*100)/100,d=Math.max(0,l);return Math.round((i-d)*100)/100})()," جنيه"]})]})})(),(n==null?void 0:n.showWithdrawNote)&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"ملاحظة السحب (اختياري)"}),e.jsxs("div",{className:"relative group",children:[e.jsx(tl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-primary"}),e.jsx(K,{id:"withdrawNoteInput",value:Ha,onChange:a=>oc(a.target.value),onKeyDown:a=>{if(a.key==="Enter"){const s=document.getElementById("withdrawSubmitButton");s==null||s.focus()}},placeholder:"أدخل ملاحظة للسحب (اختياري)",className:"pl-10 h-10 text-base border-gray-400 dark:border-gray-600 rounded-xl focus:border-primary focus:ring-1 focus:ring-primary bg-white dark:bg-gray-900 dark:text-gray-100 dark:placeholder:text-gray-400"})]})]}),e.jsx("div",{className:"sticky bottom-0 z-20 pt-2 pb-2 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 backdrop-blur supports-[backdrop-filter]:bg-white/90 dark:supports-[backdrop-filter]:bg-gray-900/90",children:e.jsx(I,{id:"withdrawSubmitButton",onClick:Fd,disabled:ea||Zi,className:"w-full font-medium h-11 lg:h-12 text-sm lg:text-base bg-green-600 hover:bg-green-700 text-white disabled:opacity-70 disabled:cursor-not-allowed",children:ea?"جاري التنفيذ...":Zi?Ih||"تم السحب بنجاح":"تأكيد السحب"})})]}),e.jsx(he,{open:Oi,onOpenChange:ws,children:e.jsxs(fe,{children:[e.jsxs(xe,{children:[e.jsx(ye,{children:"تحويل مؤجل"}),e.jsx(Xe,{children:"أدخل بيانات صاحب الدين والمبلغ والملاحظات ثم اضغط حفظ"})]}),e.jsxs("div",{className:"space-y-3",children:[_t&&_t.length>0?e.jsxs("div",{children:[e.jsx(ee,{children:"اختيار عميل"}),e.jsxs(Rs,{value:Wi,onValueChange:a=>{zm(a);const s=_t.find(i=>i.id===a);s&&Mi(s.name)},children:[e.jsx(Ls,{className:"w-full",children:e.jsx(Fs,{placeholder:"اختر عميل"})}),e.jsx(Bs,{children:_t.map(a=>e.jsxs(Aa,{value:a.id,children:[a.name,a.mobile?` — ${a.mobile}`:""]},a.id))})]})]}):e.jsx("div",{className:"text-xs text-gray-500",children:"لا يوجد عملاء مُسجلين حالياً. يمكنك إضافة عميل من نافذة الديون."}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"quickDebtName",children:"اسم صاحب الدين"}),e.jsx(K,{id:"quickDebtName",value:Ei,onChange:a=>Mi(a.target.value),placeholder:"اكتب الاسم"})]}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"quickDebtAmount",children:"المبلغ (محسوب تلقائياً)"}),e.jsx(K,{id:"quickDebtAmount",type:"number",value:qm,readOnly:!0,placeholder:"المبلغ + عمولة التحويل"})]}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"quickDebtCommission",children:"العمولة (محسوبة تلقائياً)"}),e.jsx(K,{id:"quickDebtCommission",type:"number",value:function(){const a=Qe(),s=parseFloat((ot||"0").toString())||0;let i=0;if(L==="transfer")if((a==null?void 0:a.defaultTransferCommission)!=null){const l=Number(a.defaultTransferCommission)||0;i=Math.round(l*s/1e3*100)/100}else{const l=yt&&yt.trim()!==""?parseFloat(yt):0;i=Math.max(0,l)}else if((a==null?void 0:a.defaultWithdrawCommission)!=null){const l=Number(a.defaultWithdrawCommission)||0;i=Math.round(l*s/1e3*100)/100}else{const l=st&&st.trim()!==""?parseFloat(st):Math.round(s*.01*100)/100;i=Math.max(0,l)}return String(i||0)}(),readOnly:!0,placeholder:"قيمة العمولة",className:"dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300"})]}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"quickDebtNotes",children:"ملاحظات"}),e.jsx(K,{id:"quickDebtNotes",value:cc,onChange:a=>dc(a.target.value),placeholder:"اكتب ملاحظات (اختياري)"})]})]}),e.jsx(Pe,{children:e.jsx(I,{type:"button",variant:"default",className:"bg-green-600 text-white hover:bg-green-700",onClick:()=>{const a=Qe(),s=parseFloat((ot||"").toString())||0;let i=0;if(L==="transfer")if((a==null?void 0:a.defaultTransferCommission)!=null){const m=Number(a.defaultTransferCommission)||0;i=Math.round(m*s/1e3*100)/100}else{const m=yt&&yt.trim()!==""?parseFloat(yt):0;i=Math.max(0,m)}else if((a==null?void 0:a.defaultWithdrawCommission)!=null){const m=Number(a.defaultWithdrawCommission)||0;i=Math.round(m*s/1e3*100)/100}else{const m=st&&st.trim()!==""?parseFloat(st):Math.round(s*.01*100)/100;i=Math.max(0,m)}let l=0;if(L==="withdraw"?l=$e?s:Math.max(0,Math.round((s-i)*100)/100):l=Math.max(0,Math.round((s+i)*100)/100),!Ei||isNaN(l)||l<=0){x({title:"خطأ في بيانات الأجل",description:"يرجى إدخال الاسم والمبلغ بشكل صحيح",variant:"destructive"});return}const d=_t.find(m=>m.id===Wi);Ri({debtorName:Ei,amount:l,notes:cc,customerId:Wi||void 0,mobile:d==null?void 0:d.mobile}),uc(!1),ws(!1),x({title:"تم حفظ بيانات الأجل",description:"سيتم إضافة الدين عند تأكيد العملية",variant:"default"})},children:"حفظ"})})]})})]})]}),e.jsx(Ca,{className:"bg-gradient-to-br from-red-50 to-red-100 border-red-200 fade-in-up card-float",children:e.jsxs(Ia,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-red-600 font-medium text-[10px] mb-1",children:"⚠️ تحذير من التحويل"}),e.jsx("div",{className:"text-[10px] text-red-700",children:"لا يمكن إلغاء أي عملية بعد تأكيدها للمحافظة على الأمان"})]})})]})]}),e.jsx(Db,{isOpen:uh,onClose:()=>mh(!1),initialEditingWallet:fh,onWalletUpdate:async()=>{try{await Zo()}catch(a){console.error("Error reloading wallets after update:",a)}}}),e.jsx(kb,{isOpen:yh,onClose:()=>Nc(!1),transaction:xh,onDelete:G0}),e.jsx(la,{open:jh,onOpenChange:mr,onSuccess:sf,title:rf(),description:nf(),mode:"verify"}),e.jsx(Cu,{open:b0,onOpenChange:od,onSuccess:lf,title:"تعديل الرصيد النقدي في الدرج",description:"أدخل الرقم السري والمبلغ الجديد لتعديل الرصيد النقدي في الدرج",currentBalance:We,balanceLabel:"الرصيد النقدي",userId:t==null?void 0:t.uid}),e.jsx(Cu,{open:v0,onOpenChange:ld,onSuccess:cf,title:"تعديل رصيد المحفظة",description:"أدخل الرقم السري والمبلغ الجديد لتعديل رصيد المحفظة",currentBalance:Ft&&we[Ft]||0,balanceLabel:`رصيد ${((Ud=$.find(a=>a.id===Ft))==null?void 0:Ud.name)||"المحفظة"}`,userId:t==null?void 0:t.uid}),e.jsx(Pb,{open:w0,onOpenChange:To,onSuccess:df,title:"إضافة أو خصم مبلغ من رصيد المحفظة",description:"أدخل الرقم السري والمبلغ المراد إضافته أو خصمه من رصيد المحفظة",currentBalance:Ft&&we[Ft]||0,balanceLabel:`رصيد ${((Vd=$.find(a=>a.id===Ft))==null?void 0:Vd.name)||"المحفظة"}`,userId:t==null?void 0:t.uid}),e.jsx(Ib,{open:O0,onOpenChange:E0,userId:t==null?void 0:t.uid}),e.jsx(_b,{open:M0,onOpenChange:W0,userId:t==null?void 0:t.uid}),e.jsx(Ab,{open:R0,onOpenChange:L0}),e.jsx(he,{open:S0,onOpenChange:On,children:e.jsxs(fe,{className:"sm:max-w-md",children:[e.jsx(xe,{children:e.jsx(ye,{className:"text-right",children:"تعديل الدرج النقدية"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ee,{htmlFor:"amount",className:"text-right block",children:"المبلغ"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(K,{id:"amount",type:"number",placeholder:"أدخل المبلغ",value:Oo,onChange:a=>En(a.target.value),className:"text-right flex-1",dir:"rtl",min:"0"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(I,{type:"button",size:"sm",className:"bg-green-600 hover:bg-green-700 text-white px-3 py-2",onClick:async()=>{if(!await Qn(qo)){x({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}const a=parseFloat(Oo);if(isNaN(a)||a<=0){x({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const s=We+a;Ze(s);const i={cashBalance:s,lastUpdated:new Date().toISOString()},l=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(l,JSON.stringify(i)),t!=null&&t.uid?ae.updateUserData(t.uid,i).then(()=>{console.log("✅ تم حفظ رصيد الدرج النقدي في Firebase بنجاح"),localStorage.removeItem(l),pe(!1)}).catch(d=>{console.error("❌ خطأ في حفظ الرصيد في Firebase:",d),pe(!0)}):pe(!0),x({title:"تم بنجاح",description:`تم إضافة ${a} جنيه إلى الدرج النقدية وحفظه في السحابة`}),On(!1),En(""),Fn("")},children:[e.jsx(jt,{className:"h-1 w-1 mr-1"}),"إضافة"]}),e.jsxs(I,{type:"button",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white px-3 py-2",onClick:async()=>{if(!await Qn(qo)){x({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}const a=parseFloat(Oo);if(isNaN(a)||a<=0){x({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const s=We-a;Ze(s);const i={cashBalance:s,lastUpdated:new Date().toISOString()},l=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(l,JSON.stringify(i)),t!=null&&t.uid?ae.updateUserData(t.uid,i).then(()=>{console.log("✅ تم حفظ رصيد الدرج النقدي في Firebase بنجاح"),localStorage.removeItem(l),pe(!1)}).catch(d=>{console.error("❌ خطأ في حفظ الرصيد في Firebase:",d),pe(!0)}):pe(!0),x({title:"تم بنجاح",description:`تم خصم ${a} جنيه من الدرج النقدية وحفظه في السحابة`}),On(!1),En(""),Fn("")},children:[e.jsx(ri,{className:"h-1 w-1 mr-1"}),"خصم"]})]})]}),e.jsxs("p",{className:"text-[10px] text-gray-500 text-right",children:["الرصيد الحالي: ",We.toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ee,{htmlFor:"pin",className:"text-right block",children:"الرقم السري"}),e.jsx(K,{id:"pin",type:"password",placeholder:"أدخل الرقم السري",value:qo,onChange:a=>Fn(a.target.value),className:"text-right",dir:"rtl"})]})]}),e.jsx(Pe,{className:"flex gap-2",children:e.jsx(I,{variant:"outline",onClick:()=>{On(!1),En(""),Fn("")},children:"إلغاء"})})]})}),e.jsx(he,{open:z0,onOpenChange:Kn,children:e.jsxs(fe,{className:"sm:max-w-md",children:[e.jsx(xe,{children:e.jsx(ye,{className:"text-right text-red-600",children:"تصفير إجمالي المحفظة"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-red-800 font-medium mb-2",children:"تحذير!"}),e.jsx("p",{className:"text-red-700 text-sm",children:"سيتم تصفير جميع أرصدة المحافظ إلى صفر. هذا الإجراء لا يمكن التراجع عنه."}),e.jsxs("p",{className:"text-red-600 text-sm mt-2",children:["الرصيد الحالي: ",$.reduce((a,s)=>a+(Number(we[s.id])||0),0).toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ee,{htmlFor:"resetWalletTotalPin",className:"text-right block",children:"الرقم السري الرئيسي"}),e.jsx(K,{id:"resetWalletTotalPin",type:"password",placeholder:"أدخل الرقم السري الرئيسي",value:Ed,onChange:a=>Jn(a.target.value),className:"text-right",dir:"rtl"})]})]}),e.jsxs(Pe,{className:"flex gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{Kn(!1),Jn("")},children:"إلغاء"}),e.jsx(I,{variant:"destructive",onClick:async()=>{if(!await Bt.verifyMasterPin(Ed,t==null?void 0:t.uid)){x({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}try{const s={};Object.keys(we).forEach(m=>{s[m]=0}),ct(s),localStorage.setItem(et(),JSON.stringify(s)),Kn(!1),Jn("");const i=new Date().toISOString(),l={walletBalances:s,lastUpdated:i},d=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(d,JSON.stringify(l)),t!=null&&t.uid?ae.updateUserData(t.uid,l).then(()=>{localStorage.removeItem(d),pe(!1)}).catch(m=>{console.error("خطأ في حفظ أرصدة المحافظ في Firebase:",m),pe(!0),x({title:"تنبيه",description:"تم التصفير محلياً، سيتم المزامنة مع الخادم قريباً",variant:"default"})}):pe(!0),setTimeout(()=>{ct({...s})},100)}catch(s){console.error("خطأ في تصفير أرصدة المحافظ:",s),x({title:"خطأ",description:"حدث خطأ أثناء تصفير المحافظ",variant:"destructive"})}},children:"تصفير المحفظة"})]})]})}),e.jsx(he,{open:N0,onOpenChange:Pn,children:e.jsxs(fe,{className:"sm:max-w-md",children:[e.jsx(xe,{children:e.jsx(ye,{className:"text-right text-red-600",children:"تصفير رصيد المحفظة المختارة"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-red-800 font-medium mb-2",children:"تحذير!"}),e.jsx("p",{className:"text-red-700 text-sm",children:"سيتم تصفير رصيد المحفظة المحددة إلى صفر. هذا الإجراء لا يمكن التراجع عنه."}),e.jsxs("p",{className:"text-red-600 text-sm mt-2",children:["المحفظة: ",((qd=$.find(a=>a.id===E))==null?void 0:qd.name)||E]}),e.jsxs("p",{className:"text-red-600 text-sm",children:["الرصيد الحالي: ",(E&&we[E]?we[E]:0).toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ee,{htmlFor:"resetSelectedWalletPin",className:"text-right block",children:"الرقم السري الرئيسي"}),e.jsx(K,{id:"resetSelectedWalletPin",type:"password",autoComplete:"off",placeholder:"أدخل الرقم السري الرئيسي",value:cd,onChange:a=>Po(a.target.value),className:"text-right",dir:"rtl"})]})]}),e.jsxs(Pe,{className:"flex gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{Pn(!1),Po("")},children:"إلغاء"}),e.jsx(I,{variant:"destructive",onClick:async()=>{var s;if(!E){x({title:"اختر محفظة",description:"يرجى اختيار محفظة أولاً",variant:"destructive"});return}if(!await Bt.verifyMasterPin(cd,t==null?void 0:t.uid)){x({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}try{const i={...we};i[E]=0,ct(i),localStorage.setItem(et(),JSON.stringify(i)),Pn(!1),Po("");const l=new Date().toISOString(),d={walletBalances:i,lastUpdated:l},m=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(m,JSON.stringify(d)),t!=null&&t.uid?ae.updateUserData(t.uid,d).then(()=>{localStorage.removeItem(m),pe(!1)}).catch(f=>{console.error("خطأ في حفظ أرصدة المحافظ في Firebase:",f),pe(!0),x({title:"تنبيه",description:"تم التصفير محلياً، سيتم المزامنة مع الخادم قريباً",variant:"default"})}):pe(!0),x({title:"تم التصفير بنجاح",description:`تم تصفير رصيد المحفظة ${((s=$.find(f=>f.id===E))==null?void 0:s.name)||E}`})}catch(i){console.error("خطأ في تصفير رصيد المحفظة المختارة:",i),x({title:"خطأ",description:"حدث خطأ أثناء تصفير رصيد المحفظة المختارة",variant:"destructive"})}},children:"تصفير المحفظة"})]})]})}),e.jsx(Iu,{isOpen:Be,onClose:()=>ue(!1),wallets:$}),e.jsx(he,{open:$0,onOpenChange:qn,children:e.jsxs(fe,{className:"sm:max-w-md",children:[e.jsx(xe,{children:e.jsxs(ye,{className:"text-right text-green-600 flex items-center gap-2 justify-end",children:[e.jsx(jt,{className:"h-4 w-4"}),"إضافة أموال لإجمالي المحفظة"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-green-800 font-medium mb-2",children:"إضافة أموال"}),e.jsx("p",{className:"text-green-700 text-sm",children:"سيتم إضافة المبلغ المحدد إلى إجمالي المحفظة بشكل متناسب على جميع المحافظ."}),e.jsxs("p",{className:"text-green-600 text-sm mt-2",children:["الرصيد الحالي: ",$.reduce((a,s)=>a+(Number(we[s.id])||0),0).toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"addWalletTotalAmount",className:"text-right block",children:"المبلغ المراد إضافته"}),e.jsx(K,{id:"addWalletTotalAmount",type:"number",placeholder:"أدخل المبلغ",value:Sd,onChange:a=>Yo(a.target.value),className:"text-right",dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"addWalletTotalPin",className:"text-right block",children:"الرقم السري للتأكيد"}),e.jsx(K,{id:"addWalletTotalPin",type:"password",autoComplete:"off",placeholder:"أدخل الرقم السري",value:Dd,onChange:a=>Ko(a.target.value),className:"text-right",dir:"rtl"})]})]})]}),e.jsxs(Pe,{className:"flex gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{qn(!1),Yo(""),Ko("")},children:"إلغاء"}),e.jsx(I,{variant:"default",className:"bg-green-600 hover:bg-green-700",disabled:kd,onClick:async()=>{const a=parseFloat(Sd);if(!a||a<=0){x({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}if(!await H0(Dd)){x({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}Cd(!0);try{const s=$.reduce((l,d)=>l+(Number(we[d.id])||0),0),i={...we};if(s===0){if($.length>0){const l=a/$.length;$.forEach(d=>{i[d.id]=(Number(i[d.id])||0)+l})}}else $.forEach(l=>{const d=Number(we[l.id])||0,m=d/s,f=a*m;i[l.id]=d+f});ct(i),localStorage.setItem(et(),JSON.stringify(i)),t!=null&&t.uid?await ae.updateUserData(t.uid,{walletBalances:i,lastUpdated:new Date().toISOString()}):pe(!0),setTimeout(()=>{ct(l=>({...l}))},100),qn(!1),Yo(""),Ko("")}catch(s){console.error("خطأ في حفظ أرصدة المحافظ في Firebase:",s),x({title:"خطأ",description:"حدث خطأ أثناء حفظ البيانات",variant:"destructive"})}finally{Cd(!1)}},children:kd?"جاري الإضافة...":"إضافة الأموال"})]})]})}),e.jsx(he,{open:Y0,onOpenChange:Hn,children:e.jsxs(fe,{className:"sm:max-w-[425px]",children:[e.jsx(xe,{children:e.jsxs(ye,{className:"text-red-600 flex items-center gap-2",children:[e.jsx(oa,{className:"h-1 w-1"}),"تصفير الرصيد النقدي"]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-700",children:"⚠️ تحذير: سيتم تصفير الرصيد النقدي في الدرج إلى صفر. هذا الإجراء لا يمكن التراجع عنه."})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ee,{htmlFor:"resetCashPin",children:"الرقم السري الرئيسي"}),e.jsx(K,{id:"resetCashPin",type:"password",autoComplete:"off",placeholder:"أدخل الرقم السري الرئيسي",value:Jo,onChange:a=>Ho(a.target.value)})]})]}),e.jsxs(Pe,{children:[e.jsx(I,{variant:"outline",onClick:()=>{Hn(!1),Ho("")},children:"إلغاء"}),e.jsx(I,{variant:"destructive",onClick:async()=>{if(!Jo){x({title:"خطأ",description:"يرجى إدخال الرقم السري",variant:"destructive"});return}if(!await Bt.verifyMasterPin(Jo,t==null?void 0:t.uid)){x({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}try{Ze(0),Hn(!1),Ho("");const s={cashBalance:0,lastUpdated:new Date().toISOString()};localStorage.setItem(Ve(),"0"),localStorage.setItem(Ve()+"_lastUpdated",s.lastUpdated);const i=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(i,JSON.stringify(s)),t!=null&&t.uid?ae.updateUserData(t.uid,s).then(()=>{localStorage.removeItem(i),pe(!1)}).catch(l=>{console.error("خطأ في حفظ الرصيد في Firebase:",l),pe(!0),x({title:"تنبيه",description:"تم التصفير محلياً، سيتم المزامنة مع الخادم قريباً",variant:"default"})}):pe(!0)}catch(s){console.error("خطأ في تصفير الرصيد النقدي:",s),x({title:"خطأ",description:"حدث خطأ أثناء تصفير الرصيد النقدي",variant:"destructive"})}},children:"تصفير الرصيد"})]})]})}),e.jsx(Mb,{open:B0,onOpenChange:jd,userId:t==null?void 0:t.uid,cashBalance:We,walletBalances:we,transactions:oe}),e.jsx(he,{open:F0,onOpenChange:Ir,children:e.jsxs(fe,{className:"sm:max-w-[425px]",children:[e.jsx(xe,{children:e.jsxs(ye,{className:"text-green-600 flex items-center gap-2",children:[e.jsx(jt,{className:"h-4 w-4"}),"إضافة أموال للدرج"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-green-700",children:"💰 سيتم إضافة المبلغ المحدد إلى الرصيد النقدي في الدرج"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"addCashAmount",children:"المبلغ المراد إضافته"}),e.jsx(K,{id:"addCashAmount",type:"number",placeholder:"أدخل المبلغ",value:as,onChange:a=>Bn(a.target.value),min:"0",step:"0.01"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{className:"text-right",children:"هل تريد إضافة ملاحظة؟"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{type:"button",variant:Ar==="yes"?"default":"outline",onClick:()=>Tr("yes"),className:"flex-1",children:"نعم"}),e.jsx(I,{type:"button",variant:Ar==="no"?"default":"outline",onClick:async()=>{if(Tr("no"),!as||parseFloat(as)<=0){x({title:"خطأ",description:"يرجى إدخال مبلغ صحيح أكبر من صفر",variant:"destructive"});return}if(!_r){x({title:"خطأ",description:"يرجى إدخال الرقم السري",variant:"destructive"});return}if(!await Qn(_r)){x({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}Un(!0);try{const a=parseFloat(as),s=We+a;Ze(s);const i=new Date().toISOString();localStorage.setItem(Ve(),s.toString()),localStorage.setItem(Ve()+"_lastUpdated",i);const l={cashBalance:s,lastUpdated:i},d=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(d,JSON.stringify(l));const m=`CASHADD-${(t==null?void 0:t.uid)||"anon"}-${Date.now()}`;Ir(!1),Bn(""),$n(""),Tr(null),Vn("");const f=[];if(t!=null&&t.uid){f.push(ae.updateUserData(t.uid,l).then(()=>{localStorage.removeItem(d),pe(!1)}).catch(()=>{pe(!0)}));const g={txnType:"cash_addition",type:"cash_addition",amount:a,status:"confirmed",senderMsisdn:"إضافة نقدية",receiverMsisdn:"",reference:m,title:"إيصال إضافة نقدية",merchantUserId:t.uid,createdBy:t.uid,shopId:(n==null?void 0:n.shopId)||void 0};f.push(ae.saveUserTransaction(t.uid,g));const v=n==null?void 0:n.shopId;if(v){const y=Te(V,"dashboardData",v);f.push(Xt(y,{cashBalance:s}))}}Promise.allSettled(f).then(()=>{}).catch(()=>{})}catch{Ze(We),localStorage.setItem("cashBalance",We.toString()),x({title:"خطأ",description:"حدث خطأ أثناء حفظ البيانات، يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{Un(!1)}},className:"flex-1",children:"لا"})]})]}),Ar==="yes"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"addCashNote",children:"الملاحظة"}),e.jsx(K,{id:"addCashNote",type:"text",placeholder:"اكتب الملاحظة",value:zo,onChange:a=>Vn(a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"addCashPin",children:"الرقم السري لدرج النقدية"}),e.jsx(K,{id:"addCashPin",type:"password",placeholder:"أدخل الرقم السري",value:_r,onChange:a=>$n(a.target.value)})]})]}),e.jsxs(Pe,{children:[e.jsx(I,{variant:"outline",onClick:()=>{Ir(!1),Bn(""),$n(""),Tr(null),Vn("")},children:"إلغاء"}),e.jsx(I,{variant:"default",className:"bg-green-600 hover:bg-green-700",disabled:Nd,onClick:async()=>{if(!as||parseFloat(as)<=0){x({title:"خطأ",description:"يرجى إدخال مبلغ صحيح أكبر من صفر",variant:"destructive"});return}if(!_r){x({title:"خطأ",description:"يرجى إدخال الرقم السري",variant:"destructive"});return}if(!await Qn(_r)){x({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}if(Ar==="yes"&&zo.trim().length===0){x({title:"تنبيه",description:"أدخل الملاحظة أو اختر لا",variant:"destructive"});return}Un(!0);try{const a=parseFloat(as),s=We+a;Ze(s);const i=new Date().toISOString();localStorage.setItem(Ve(),s.toString()),localStorage.setItem(Ve()+"_lastUpdated",i);const l={cashBalance:s,lastUpdated:i},d=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(d,JSON.stringify(l));const m=`CASHADD-${(t==null?void 0:t.uid)||"anon"}-${Date.now()}`;Ir(!1),Bn(""),$n(""),Tr(null),Vn("");const f=[];if(t!=null&&t.uid){f.push(ae.updateUserData(t.uid,l).then(()=>{localStorage.removeItem(d),pe(!1)}).catch(()=>{pe(!0)}));const g={txnType:"cash_addition",type:"cash_addition",amount:a,status:"confirmed",senderMsisdn:"إضافة نقدية",receiverMsisdn:"",reference:m,note:Ar==="yes"?zo.trim():void 0,title:"إيصال إضافة نقدية",merchantUserId:t.uid,createdBy:t.uid,shopId:(n==null?void 0:n.shopId)||void 0};f.push(ae.saveUserTransaction(t.uid,g));const v=n==null?void 0:n.shopId;if(v){const y=Te(V,"dashboardData",v);f.push(Xt(y,{cashBalance:s}))}}Promise.allSettled(f).then(()=>{}).catch(()=>{})}catch{Ze(We),localStorage.setItem("cashBalance",We.toString()),x({title:"خطأ",description:"حدث خطأ أثناء حفظ البيانات، يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{Un(!1)}},children:Nd?"جاري الإضافة...":"إضافة الأموال"})]})]})}),e.jsx(he,{open:y0,onOpenChange:Ao,children:e.jsxs(fe,{className:"sm:max-w-md",children:[e.jsx(xe,{children:e.jsx(ye,{className:"text-right",children:"اختيار التاريخ والوقت للبحث"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ee,{htmlFor:"search-date",className:"text-right block",children:"التاريخ"}),e.jsx(K,{id:"search-date",type:"date",value:vn,onChange:a=>Cc(a.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ee,{htmlFor:"search-time",className:"text-right block",children:"الوقت (اختياري)"}),e.jsx(K,{id:"search-time",type:"time",value:wn,onChange:a=>Ic(a.target.value),className:"text-right",placeholder:"اختر الوقت للبحث في ساعة محددة"}),e.jsx("p",{className:"text-[10px] text-gray-500 text-right",children:"إذا لم تختر وقتاً محدداً، سيتم البحث في كامل اليوم"})]})]}),e.jsxs(Pe,{className:"flex justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>{Cc(""),Ic(""),Ao(!1)},children:"مسح"}),e.jsx(I,{onClick:()=>Ao(!1),children:"تطبيق"})]})]})}),e.jsx(Ob,{isOpen:Oh,onClose:()=>ro(!1)}),e.jsx(lu,{isOpen:Ie,onClose:()=>ze(!1),userId:(t==null?void 0:t.uid)||"",userEmail:(t==null?void 0:t.email)||""}),e.jsx(Eb,{isOpen:Ji,onClose:()=>Ss(!1),initialBarcode:ch}),e.jsx(Wb,{isOpen:Lh,onClose:()=>xr(!1)}),e.jsx(Bb,{open:Fh,onOpenChange:yr}),e.jsx($b,{open:Bh,onOpenChange:a=>{if(a&&!Jt){x({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"});return}br(a)}}),e.jsx(qb,{open:kt,onOpenChange:a=>{if(a&&!Jt){x({title:"غير متاح",description:"هذه الميزة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة. يرجى تفعيل اشتراكك.",variant:"destructive"});return}Q(a)}}),e.jsx(zb,{open:ve,onOpenChange:a=>{if(a&&!Jt){x({title:"غير متاح",description:"هذه الميزة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة. يرجى تفعيل اشتراكك.",variant:"destructive"});return}ge(a)}}),e.jsx(la,{open:k0,onOpenChange:gd,onSuccess:()=>Wo(!0),title:"تقاريرك",description:"أدخل الرقم السري الرئيسي للوصول إلى تقاريرك",mode:"verify"}),e.jsx(he,{open:Mo,onOpenChange:Wo,children:e.jsxs(fe,{className:"sm:max-w-xl",children:[e.jsxs(xe,{children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(il,{className:"h-4 w-4 text-blue-600"}),"تقارير اليوم"]}),e.jsx(Xe,{children:"ملخص معاملات اليوم محفوظ لآخر 30 يومًا مع أرشفة في السحابة"})]}),e.jsxs("div",{className:"space-y-4",children:[(()=>{const a=new Date().toDateString(),s=oe.filter(g=>{const v=new Date(g.createdAt).toDateString(),y=String(g.status||"completed").toLowerCase();return v===a&&(y==="completed"||y==="confirmed")}),i=s.length,l=s.reduce((g,v)=>g+Number(v.amount||0),0),d=s.filter(g=>g.type==="withdraw").reduce((g,v)=>g+Number(v.amount||0),0),m=s.filter(g=>g.type==="send").reduce((g,v)=>g+Number(v.amount||0),0),f=s.reduce((g,v)=>g+Number(St.calculateTransactionProfit(v)||0),0);return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-blue-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-blue-700",children:"عدد المعاملات"}),e.jsx("div",{className:"text-lg font-bold text-blue-800",children:i})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-indigo-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-indigo-700",children:"إجمالي المبالغ"}),e.jsx("div",{className:"text-lg font-bold text-indigo-800",children:Number(l).toFixed(2)})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-red-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-red-700",children:"المبالغ المسحوبة"}),e.jsx("div",{className:"text-lg font-bold text-red-800",children:Number(d).toFixed(2)})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-green-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-green-700",children:"المبالغ المرسلة"}),e.jsx("div",{className:"text-lg font-bold text-green-800",children:Number(m).toFixed(2)})]}),e.jsxs("div",{className:"col-span-2 rounded-lg p-3 bg-gradient-to-r from-amber-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-amber-700",children:"الأرباح"}),e.jsx("div",{className:"text-lg font-bold text-amber-800",children:Number(f).toFixed(2)})]})]})})(),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(I,{variant:"default",onClick:async()=>{try{if(!(t!=null&&t.uid))return;const a=new Date,s=a.getFullYear(),i=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0"),d=`${s}-${i}-${l}`,m=a.toDateString(),f=oe.filter(C=>{const S=new Date(C.createdAt).toDateString(),A=String(C.status||"completed").toLowerCase();return S===m&&(A==="completed"||A==="confirmed")}),g=f.length,v=f.reduce((C,S)=>C+Number(S.amount||0),0),y=f.filter(C=>C.type==="withdraw").reduce((C,S)=>C+Number(S.amount||0),0),p=f.filter(C=>C.type==="send").reduce((C,S)=>C+Number(S.amount||0),0),N=f.reduce((C,S)=>C+Number(St.calculateTransactionProfit(S)||0),0);await Wr.add({userId:t.uid,reportDate:d,totalTransactions:g,totalAmount:Number(v.toFixed(2)),totalWithdrawn:Number(y.toFixed(2)),totalSent:Number(p.toFixed(2)),profit:Number(N.toFixed(2)),walletId:null});try{await Wr.trimToMaxCount(t.uid,30)}catch{}x({title:"تم الأرشفة",description:`تم حفظ تقرير ${d}`})}catch{x({title:"فشل الأرشفة",description:"تعذر حفظ التقرير",variant:"destructive"})}},children:"أرشفة اليوم"}),e.jsx(I,{variant:"outline",onClick:()=>Wo(!1),children:"إغلاق"})]}),e.jsx("div",{className:"mt-2 border-t pt-2",children:e.jsx("div",{className:"space-y-2 max-h-[40vh] overflow-auto",children:pd.length===0?e.jsx("div",{className:"text-xs text-muted-foreground",children:"لا توجد تقارير محفوظة"}):pd.map(a=>e.jsxs("div",{className:"border rounded-md p-2 bg-gradient-to-r from-white/80 to-blue-50/70",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-bold text-blue-800",children:a.reportDate}),e.jsxs("div",{className:"text-xs text-blue-700",children:["عدد المعاملات: ",a.totalTransactions]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[e.jsxs("div",{className:"text-xs text-blue-800",children:["إجمالي المبالغ: ",e.jsx("span",{className:"font-semibold",children:Number(a.totalAmount).toFixed(2)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["المسحوب: ",e.jsx("span",{className:"font-semibold",children:Number(a.totalWithdrawn).toFixed(2)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["المرسل: ",e.jsx("span",{className:"font-semibold",children:Number(a.totalSent).toFixed(2)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["الربح: ",e.jsx("span",{className:"font-semibold",children:Number(a.profit??0).toFixed(2)})]})]})]},a.id||`${a.userId}-${a.reportDate}`))})})]})]})}),e.jsx(he,{open:D0,onOpenChange:a=>{if(a){x({title:"قيد التطوير",description:"هذه الميزة غير متاحة حالياً."});return}Eo(!1)},children:e.jsxs(fe,{dir:"rtl",className:"sm:max-w-md w-[95vw] sm:w-auto rounded-2xl border border-emerald-200 shadow-xl bg-gradient-to-br from-white via-green-50 to-emerald-50 backdrop-blur-md data-[state=open]:animate-in data-[state=open]:fade-in-0 data-[state=open]:zoom-in-90 data-[state=open]:slide-in-from-bottom-8 duration-300",children:[e.jsxs(xe,{children:[e.jsx(ye,{className:"text-right text-green-700",children:"شحن رصيد الموبايل"}),e.jsx(Xe,{className:"text-right text-gray-600",children:"أدخل البيانات ثم اضغط تأكيد"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"topupPhone",className:"text-right block",children:"رقم الموبايل"}),e.jsx(K,{id:"topupPhone",value:Mn,onChange:a=>dd(a.target.value),placeholder:"010xxxxxxx",className:"text-right"})]}),e.jsxs("div",{children:[e.jsx(ee,{className:"text-right block",children:"شركة التشغيل"}),e.jsxs(Rs,{value:Wn,onValueChange:ud,children:[e.jsx(Ls,{className:"text-right",children:e.jsx(Fs,{placeholder:"اختر الشركة"})}),e.jsxs(Bs,{children:[e.jsx(Aa,{value:"vodafone",children:"فودافون"}),e.jsx(Aa,{value:"orange",children:"أورنج"}),e.jsx(Aa,{value:"etisalat",children:"اتصالات"}),e.jsx(Aa,{value:"we",children:"WE"})]})]})]}),e.jsxs("div",{children:[e.jsx(ee,{htmlFor:"topupAmount",className:"text-right block",children:"المبلغ بالجنيه"}),e.jsx(K,{id:"topupAmount",type:"number",value:Rn,onChange:a=>md(a.target.value?Number(a.target.value):""),placeholder:"50",className:"text-right"})]})]}),e.jsxs(Pe,{className:"flex gap-2 justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>Eo(!1),className:"border-gray-300",children:"إلغاء"}),e.jsx(I,{onClick:Mt,disabled:hd||!Mn||!Wn||!Rn,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:hd?"جارٍ التنفيذ...":"تأكيد الشحن"})]})]})}),e.jsx(la,{open:Gh,onOpenChange:lo,mode:"verify",title:"الرقم السري الرئيسي لفتح الديون",description:"أدخل الرقم السري الرئيسي لفتح صفحة الديون",className:"!bg-[#0f172a] !text-slate-100 border border-slate-800 shadow-2xl",overlayClassName:"backdrop-blur-[5px] bg-black/10 !dark:bg-black",onSuccess:()=>{lo(!1),ks(!0)}}),e.jsx(la,{open:Zh,onOpenChange:Fc,mode:"verify",title:"تأكيد تغيير طلب الرقم السري للديون",description:"أدخل الرقم السري الرئيسي لتفعيل أو إلغاء طلب الرقم السري عند فتح الديون",onSuccess:async()=>{if(Bc!==null){const a=Bc;Lc(a);try{const s=t==null?void 0:t.uid,i=s?`debtsPinRequired_${s}`:"debtsPinRequired";localStorage.setItem(i,String(a)),s&&await ae.updateUserData(s,{debtsPinRequired:a})}catch{}x({title:a?"تم تفعيل طلب الرقم السري للديون":"تم إلغاء طلب الرقم السري للديون",description:a?"سيُطلب الرقم السري الرئيسي عند فتح نافذة الديون.":"يمكن فتح نافذة الديون بدون طلب الرقم السري."})}e0(null),Fc(!1)}}),e.jsx(Tb,{open:j0,onOpenChange:kr,title:"تأكيد كلمة المرور لإخفاء المعاملات السابقة من العرض",description:"سيتم إخفاء كل المعاملات السابقة من شاشة المعاملات والتقارير فقط، ولن تُحذف نهائيًا من حسابك أو من Firebase.",onSuccess:async()=>{try{if(!(t!=null&&t.uid)){kr(!1);return}const a=new Date,s=l=>l instanceof Date?l:typeof(l==null?void 0:l.toDate)=="function"?l.toDate():new Date(String(l)),i=oe.filter(l=>s(l.createdAt)<a);await ae.updateUserData(t.uid,{recentReset:{keepLastCount:_d.keepLastCount??30,intervalDays:_d.intervalDays??7,lastResetAt:a}}),zn(l=>({...l,lastResetAt:a})),x({title:"تم إخفاء المعاملات السابقة",description:"تم إخفاء كل الإيصالات الأقدم من وقت التصفير من العرض بدون التأثير على تقارير اليوم/الشهر أو الحدود."})}catch(a){console.error("فشل تنفيذ التصفير النهائي:",a),x({title:"فشل التصفير",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}finally{kr(!1)}}}),e.jsx(la,{open:Rm,onOpenChange:gs,mode:"verify",title:"الرقم السري لفتح مصروفات المحل",description:"أدخل الرقم السري الرئيسي لفتح نافذة مصروفات المحل",onSuccess:()=>{gs(!1),Ja(!0)}}),e.jsx(he,{open:at,onOpenChange:Ye,children:e.jsx(fe,{className:"w-full h-full max-w-full max-h-full p-0 m-0 rounded-none border-none",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx(I,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-50 bg-white/50 dark:bg-black/50 hover:bg-white dark:hover:bg-black/80 rounded-full",onClick:()=>Ye(!1),children:e.jsx(si,{className:"h-6 w-6"})}),e.jsx("iframe",{src:"https://naweshop.com/login",className:"w-full h-full border-none",title:"NaweShop Login"})]})})}),e.jsx(he,{open:Qh,onOpenChange:ks,children:e.jsxs(fe,{className:"sm:max-w-[425px] border border-slate-800 shadow-2xl",overlayClassName:"backdrop-blur-[5px] bg-black/10 !dark:bg-black",children:[e.jsxs(xe,{className:"flex items-center justify-between",children:[e.jsx(ye,{className:"text-right",children:"إدارة الديون"}),e.jsxs("div",{className:"flex items-center gap-1 text-orange-700",children:[e.jsx(nl,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-xs font-bold",children:[af," جنيه"]})]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(I,{variant:ga==="debtor"?"default":"outline",onClick:()=>qc("debtor"),children:"مدين"}),e.jsx(I,{variant:ga==="creditor"?"default":"outline",onClick:()=>qc("creditor"),children:"دائن"})]}),(ga==="creditor"||ga==="debtor")&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ee,{htmlFor:"debtorName",className:"text-right col-span-1",children:ga==="creditor"?"اسم المديون":"اسم الدائن"}),e.jsx(K,{id:"debtorName",value:co,onChange:a=>$c(a.target.value),className:"col-span-3 text-right",placeholder:ga==="creditor"?"أدخل اسم المديون":"أدخل اسم الدائن"})]}),ga&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ee,{htmlFor:"debtAmount",className:"text-right col-span-1",children:"المبلغ"}),e.jsx(K,{id:"debtAmount",type:"text",inputMode:"decimal",value:uo,onChange:a=>Uc(cr(a.target.value)),className:"col-span-3 text-right",placeholder:"أدخل المبلغ"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ee,{htmlFor:"debtReason",className:"text-right col-span-1",children:"سبب الدين"}),e.jsx(K,{id:"debtReason",value:mo,onChange:a=>Vc(a.target.value),className:"col-span-3 text-right",placeholder:"أدخل سبب الدين"})]})]})]}),e.jsx(Pe,{children:e.jsx(I,{onClick:()=>{if(!(ga==="debtor")&&!(ga==="creditor")){x({title:"اختر نوع الدين",description:"يرجى اختيار مدين أو دائن أولاً",variant:"destructive"});return}if(!uo||!mo||!co){x({title:"بيانات غير مكتملة",description:"يرجى إدخال الاسم والمبلغ والسبب",variant:"destructive"});return}const i={id:Date.now().toString(),debtorName:co,amount:parseFloat(uo),reason:mo,status:"pending",createdAt:new Date,paidAmount:0,partialPayments:[],type:ga||"creditor"};jr(i),Is(!0)},className:"bg-orange-500 hover:bg-orange-600",children:"حفظ"})}),e.jsx("div",{className:"mt-2",children:e.jsx(I,{variant:"outline",className:"w-full",onClick:()=>Xa(!0),children:"إيصالات الديون"})}),e.jsx("div",{className:"mt-2",children:e.jsx(I,{variant:"outline",className:"w-full",onClick:()=>po(!0),children:"إضافة عميل"})})]})}),e.jsx(he,{open:ho,onOpenChange:Xa,children:e.jsxs(fe,{className:"w-[95vw] sm:w-auto sm:max-w-[520px] rounded-2xl border border-slate-800 shadow-2xl",overlayClassName:"backdrop-blur-[5px] bg-black/10 !dark:bg-black",children:[e.jsxs(xe,{children:[e.jsx(ye,{className:"text-right",children:"إيصالات الديون"}),e.jsx(Xe,{className:"text-right",children:"اختر دينًا لعرض إيصاله بالتفصيل"})]}),_e.length>0?e.jsxs("div",{className:"max-h-[70vh] overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 space-y-2 px-1 -mx-1 sm:mx-0 sm:px-0",style:{contain:"layout paint"},onScroll:a=>{const s=a.currentTarget;go.length<_e.length&&s.scrollTop+s.clientHeight>=s.scrollHeight-50&&fo(i=>i+1)},children:[go.map(a=>e.jsx("div",{onClick:()=>{wr(a),Fa(!0),Xa(!1),ks(!1)},className:`p-4 sm:p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors min-h-[64px] ${a.type==="debtor"?"border-r-4 border-r-red-500 bg-red-50/10":"border-r-4 border-r-emerald-500"}`,children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center",children:[e.jsxs("div",{className:"text-right space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-[14px] sm:text-sm",children:a.debtorName}),a.type==="debtor"&&e.jsx(_a,{variant:"destructive",className:"h-5 text-[10px] px-1",children:"علينا"}),(!a.type||a.type==="creditor")&&e.jsx(_a,{variant:"outline",className:"h-5 text-[10px] px-1 text-emerald-700 border-emerald-200 bg-emerald-50",children:"لنا"})]}),e.jsx("p",{className:"text-[13px] sm:text-sm text-gray-600",children:a.reason}),e.jsx("p",{className:"text-[12px] sm:text-sm text-gray-500",children:Mr.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-bold text-xl sm:text-lg",children:[a.amount," جنيه"]}),e.jsx(_a,{variant:a.status==="paid"?"default":"secondary",className:`${a.status==="paid"?"bg-green-500":"bg-yellow-500"} text-[12px] sm:text-xs`,children:a.status==="paid"?"مدفوع":"قيد المراجعة"})]})]})},a.id)),go.length<_e.length&&e.jsx("div",{className:"flex justify-center pt-1",children:e.jsx(I,{variant:"outline",size:"sm",onClick:()=>fo(a=>a+1),children:"تحميل المزيد"})})]}):e.jsx("div",{className:"text-center text-sm text-gray-500",children:"لا توجد ديون مسجلة"}),e.jsxs(Pe,{className:"flex justify-between mt-3",children:[e.jsx(I,{variant:"destructive",onClick:async()=>{try{if(!_e||_e.length===0){x({title:"لا توجد ديون",description:"القائمة فارغة بالفعل."});return}if(!window.confirm("هل تريد حذف كل إيصالات الديون؟ هذا الإجراء لا يمكن التراجع عنه."))return;const s=[];if(Lt(s),wr(null),await Da(s),t!=null&&t.uid)try{await ae.updateUserData(t.uid,{debts:[],debtsDeletedAt:ft()});try{localStorage.removeItem(`debts_unsynced_${t.uid}`)}catch{}}catch(i){console.error("تعذر حذف الديون من Firebase:",i),x({title:"فشل الحذف من السحابة",description:"تعذر حذف الإيصالات من Firebase، حاول مرة أخرى.",variant:"destructive"});return}x({title:"تم حذف كل إيصالات الديون",description:"تم تفريغ القائمة بالكامل."}),Xa(!1)}catch(a){console.error("تعذر حذف كل إيصالات الديون:",a),x({title:"فشل الحذف",description:"حدث خطأ أثناء الحذف، حاول مرة أخرى.",variant:"destructive"})}},children:"حذف كل الإيصالات"}),e.jsx(I,{variant:"outline",onClick:()=>Xa(!1),children:"إغلاق"})]})]})}),e.jsx(he,{open:qi,onOpenChange:th,children:e.jsxs(fe,{className:"max-w-2xl h-[80vh] flex flex-col p-0",overlayClassName:"backdrop-blur-[5px] bg-black/10 !dark:bg-black",children:[e.jsxs(xe,{className:"p-4 border-b",children:[e.jsx(ye,{children:"سجل سداد الديون"}),e.jsx(Xe,{children:"عرض عمليات السداد حسب التاريخ"})]}),e.jsxs("div",{className:"p-4 border-b bg-gray-50 dark:bg-gray-900 flex flex-col sm:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(ee,{children:"نوع البحث"}),e.jsxs("div",{className:"flex bg-white dark:bg-gray-800 rounded-md border p-1",children:[e.jsx("button",{onClick:()=>xc("day"),className:`flex-1 px-3 py-1.5 text-sm rounded-sm transition-colors ${Ga==="day"?"bg-purple-100 text-purple-700 font-medium":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"يومي"}),e.jsx("button",{onClick:()=>xc("month"),className:`flex-1 px-3 py-1.5 text-sm rounded-sm transition-colors ${Ga==="month"?"bg-purple-100 text-purple-700 font-medium":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"شهري"})]})]}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(ee,{children:Ga==="day"?"اختر اليوم":"اختر الشهر"}),e.jsx(K,{type:Ga==="day"?"date":"month",value:Ga==="day"?Ns:Ns.substring(0,7),onChange:a=>sh(a.target.value),className:"bg-white dark:bg-gray-800"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-500 mb-1",children:"إجمالي الفترة"}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:Ot(zi.reduce((a,s)=>a+(s.amount||0),0))})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-0",children:zi.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-500",children:[e.jsx(nl,{className:"h-12 w-12 mb-2 opacity-20"}),e.jsx("p",{children:"لا توجد عمليات سداد في هذه الفترة"})]}):e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"grid grid-cols-3 bg-gray-50 dark:bg-gray-900 p-3 text-sm font-medium text-gray-500 border-b",children:[e.jsx("div",{className:"text-right",children:"التاريخ"}),e.jsx("div",{className:"text-right",children:"اسم المديون"}),e.jsx("div",{className:"text-right",children:"المبلغ"})]}),e.jsx("div",{className:"divide-y dark:divide-gray-800",children:zi.map(a=>{var s;return e.jsxs("div",{className:"grid grid-cols-3 p-3 items-center hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx("div",{className:"text-sm text-gray-500 font-mono",children:(s=a.createdAt)!=null&&s.seconds?new Date(a.createdAt.seconds*1e3).toLocaleString("ar-EG"):"الآن"}),e.jsx("div",{className:"font-medium",children:a.debtorName}),e.jsx("div",{className:"font-bold text-green-600",children:Ot(a.amount)})]},a.id)})})]})})]})}),e.jsx(he,{open:i0,onOpenChange:po,children:e.jsxs(fe,{className:"sm:max-w-[500px] w-full max-h-[90vh] overflow-hidden flex flex-col p-0 gap-0 !bg-[#0f172a] !text-slate-100 border border-slate-800 shadow-2xl",overlayClassName:"backdrop-blur-[5px] bg-black/10 !dark:bg-black",children:[e.jsxs("div",{className:"p-4 border-b border-slate-800 bg-[#0f172a]",children:[e.jsxs(xe,{children:[e.jsxs(ye,{className:"text-right flex items-center justify-end gap-2",children:[e.jsx(Br,{className:"w-5 h-5 text-primary"}),"إدارة العملاء والديون"]}),e.jsx(Xe,{className:"text-right",children:"سجل بيانات العملاء والديون بسهولة"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4",dir:"rtl",children:[e.jsx(I,{variant:Cs==="customers_list"?"default":"outline",onClick:()=>xo("customers_list"),size:"sm",className:"flex-1 text-xs h-8",children:"العملاء المسجلين"}),e.jsx(I,{variant:Cs==="add_debt"?"default":"outline",onClick:()=>xo("add_debt"),size:"sm",className:"flex-1 text-xs h-8",children:"تسجيل دين"}),e.jsx(I,{variant:Cs==="add_customer"?"default":"outline",onClick:()=>xo("add_customer"),size:"sm",className:"flex-1 text-xs h-8",children:"إضافة عميل"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[Cs==="add_customer"&&e.jsxs(Ca,{className:"border shadow-sm bg-white dark:bg-card dark:border-gray-800",children:[e.jsx(is,{className:"pb-2 pt-4 px-4",children:e.jsxs(os,{className:"text-sm font-medium text-right text-gray-700 dark:text-gray-200 flex items-center justify-end gap-2",children:[e.jsx(jt,{className:"w-4 h-4"}),"إضافة عميل جديد"]})}),e.jsxs(Ia,{className:"p-4 pt-2 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ee,{className:"text-right block text-xs text-gray-500 dark:text-gray-400",children:"اسم العميل"}),e.jsx(K,{value:bo,onChange:a=>Gc(a.target.value),className:"text-right h-9 dark:bg-gray-900 dark:border-gray-700",placeholder:"اكتب اسم العميل"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ee,{className:"text-right block text-xs text-gray-500 dark:text-gray-400",children:"رقم الموبايل"}),e.jsx(K,{value:vo,onChange:a=>Xc(a.target.value),className:"text-right h-9 dark:bg-gray-900 dark:border-gray-700",placeholder:"اكتب رقم الموبايل"})]}),e.jsxs(I,{className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white h-9 mt-2",onClick:async()=>{if(!bo||!vo){x({title:"بيانات غير مكتملة",description:"يرجى إدخال اسم العميل ورقم الموبايل",variant:"destructive"});return}const a={id:Date.now().toString(),name:bo.trim(),mobile:vo.trim(),createdAt:new Date},s=[a,..._t];await $o(s),Gc(""),Xc(""),x({title:"تمت إضافة العميل",description:`تم إضافة ${a.name}`})},children:[e.jsx(jt,{className:"w-4 h-4 mr-2"}),"إضافة العميل"]})]})]}),Cs==="add_debt"&&e.jsxs(Ca,{className:"border shadow-sm bg-white dark:bg-card dark:border-gray-800",children:[e.jsx(is,{className:"pb-2 pt-4 px-4",children:e.jsxs(os,{className:"text-sm font-medium text-right text-gray-700 dark:text-gray-200 flex items-center justify-end gap-2",children:[e.jsx(Pa,{className:"w-4 h-4 text-orange-600"}),"تسجيل مبلغ دين"]})}),e.jsx(Ia,{className:"p-4 pt-2 space-y-3",children:_t.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ee,{className:"text-right block text-xs text-gray-500 dark:text-gray-400",children:"اختر العميل"}),e.jsxs(Rs,{value:Za,onValueChange:Zc,children:[e.jsx(Ls,{className:"w-full h-9 text-right dark:bg-gray-900 dark:border-gray-700",dir:"rtl",children:e.jsx(Fs,{placeholder:"اختر عميل"})}),e.jsx(Bs,{className:"dark:bg-gray-900 dark:border-gray-800",children:_t.map(a=>e.jsxs(Aa,{value:a.id,className:"text-right justify-end",children:[a.name," — ",a.mobile]},a.id))})]}),Za&&(()=>{const a=_e.filter(s=>s.customerId===Za&&s.status==="pending").reduce((s,i)=>s+(i.amount-(i.paidAmount||0)),0);return e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(I,{variant:"ghost",size:"sm",className:"h-6 text-xs text-blue-600 hover:text-blue-700 hover:bg-blue-50 px-2",onClick:()=>{h0(Za),Do(!0)},children:"إيصالات ديونه"}),a>0&&e.jsxs("div",{className:"text-xs text-red-600 font-semibold text-right",children:["إجمالي الديون الحالية: ",a.toFixed(2)," جنيه"]})]})})()]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ee,{className:"text-right block text-xs text-gray-500",children:"المبلغ"}),e.jsx(K,{type:"number",value:ed,onChange:a=>o0(a.target.value),className:"text-right h-9",placeholder:"0.00"})]}),e.jsx(I,{className:"w-full bg-orange-600 hover:bg-orange-700 text-white h-9 mt-2",onClick:async()=>{const a=parseFloat(ed);if(!Za){x({title:"اختر عميل",description:"يرجى اختيار عميل أولاً",variant:"destructive"});return}if(isNaN(a)||a<=0){x({title:"قيمة غير صحيحة",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const s=_t.find(l=>l.id===Za);if(!s)return;const i={id:Date.now().toString(),debtorName:s.name,customerId:s.id,mobile:s.mobile,amount:Number(a.toFixed(2)),reason:"دين عميل",status:"pending",createdAt:new Date,paidAmount:0,partialPayments:[]};jr(i),Is(!0)},children:"متابعة وإضافة المبلغ"})]}):e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm bg-gray-50 rounded border border-dashed",children:"لا يوجد عملاء مسجلين. أضف عميلاً أولاً."})})]}),Cs==="customers_list"&&e.jsxs(Ca,{className:"border shadow-sm bg-white dark:bg-card dark:border-gray-800",children:[e.jsx(is,{className:"pb-2 pt-4 px-4",children:e.jsxs(os,{className:"text-sm font-medium text-right text-gray-700 dark:text-gray-200 flex items-center justify-end gap-2",children:[e.jsx(hu,{className:"w-4 h-4"}),"العملاء المسجلين (",_t.length,")"]})}),e.jsx(Ia,{className:"p-4 pt-2",children:_t.length>0?e.jsx("div",{className:"space-y-2",children:_t.map(a=>e.jsxs("div",{className:"p-3 border rounded-lg flex items-center justify-between bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors dark:border-gray-700",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>{td(a.id),wo(a.name||""),No(a.mobile||""),_n(!0)},children:e.jsx(uu,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>{jo(a.id),So(a.name||""),An(!0)},children:e.jsx(oa,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:a.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono",children:a.mobile})]})]},a.id))}):e.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"لا توجد بيانات لعرضها"})})]})]}),e.jsx(Pe,{className:"p-4 border-t bg-white dark:bg-card dark:border-gray-800",children:e.jsx(I,{variant:"outline",className:"w-full sm:w-auto dark:bg-gray-800 dark:text-white dark:border-gray-700 dark:hover:bg-gray-700",onClick:()=>po(!1),children:"إغلاق"})})]})}),e.jsx(he,{open:m0,onOpenChange:Do,children:e.jsxs(fe,{className:"sm:max-w-[500px] max-h-[80vh] overflow-hidden flex flex-col p-0 gap-0",children:[e.jsx("div",{className:"p-4 border-b bg-white dark:bg-card dark:border-gray-800",children:e.jsxs(xe,{children:[e.jsxs(ye,{className:"text-right flex items-center justify-end gap-2 dark:text-gray-100",children:[e.jsx(ei,{className:"w-5 h-5 text-blue-600"}),"إيصالات العميل"]}),e.jsx(Xe,{className:"text-right dark:text-gray-400",children:(zd=_t.find(a=>a.id===ko))==null?void 0:zd.name})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50/50 dark:bg-black/50",children:[_e.filter(a=>a.customerId===ko).sort((a,s)=>new Date(s.createdAt).getTime()-new Date(a.createdAt).getTime()).map(a=>e.jsxs("div",{className:"p-3 border rounded-lg bg-white dark:bg-card dark:border-gray-700 shadow-sm flex justify-between items-center",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold text-sm dark:text-gray-100",children:[a.amount," جنيه"]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:a.reason}),e.jsx(_a,{variant:a.status==="paid"?"default":"secondary",className:`mt-1 h-5 text-[10px] ${a.status==="paid"?"bg-green-500":"bg-yellow-500 text-yellow-950"}`,children:a.status==="paid"?"مدفوع":"قيد المراجعة"})]}),e.jsxs("div",{className:"text-left text-xs text-gray-400 flex flex-col items-end gap-1",children:[e.jsx("div",{className:"font-mono",children:Mr.format(new Date(a.createdAt))}),e.jsx("div",{className:"font-mono",children:new Date(a.createdAt).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})})]})]},a.id)),_e.filter(a=>a.customerId===ko).length===0&&e.jsxs("div",{className:"text-center text-gray-500 py-8 flex flex-col items-center gap-2",children:[e.jsx(ei,{className:"w-8 h-8 text-gray-300"}),e.jsx("span",{children:"لا توجد إيصالات لهذا العميل"})]})]}),e.jsx(Pe,{className:"p-4 border-t bg-white dark:bg-card dark:border-gray-800",children:e.jsx(I,{variant:"outline",className:"w-full dark:bg-gray-800 dark:text-white dark:border-gray-700 dark:hover:bg-gray-700",onClick:()=>Do(!1),children:"إغلاق"})})]})}),e.jsx(he,{open:d0,onOpenChange:An,children:e.jsxs(fe,{hideClose:!0,className:"sm:max-w-[420px] rounded-2xl bg-gradient-to-br from-white via-rose-50 to-red-50 dark:from-gray-900 dark:via-red-950/30 dark:to-red-900/10 shadow-2xl border border-red-100 dark:border-red-900/50 text-center",children:[e.jsxs(xe,{children:[e.jsx(ye,{className:"text-center text-xl font-bold text-red-700 dark:text-red-400",children:"تأكيد حذف العميل"}),e.jsxs(Xe,{className:"text-center text-gray-600 dark:text-gray-300",children:["سيتم حذف العميل نهائيًا: ",rd]})]}),e.jsx("div",{className:"py-2 text-sm text-gray-700 dark:text-gray-400",children:"لا يمكن التراجع عن هذا الإجراء."}),e.jsxs(Pe,{className:"flex justify-center gap-3",children:[e.jsx(I,{variant:"outline",onClick:()=>{An(!1),jo(""),So("")},children:"إلغاء"}),e.jsx(I,{variant:"destructive",className:"bg-red-600 hover:bg-red-700",onClick:async()=>{const a=u0,s=_t.filter(i=>i.id!==a);await $o(s),Za===a&&Zc(""),An(!1),jo(""),So(""),x({title:"تم حذف العميل",description:rd})},children:"حذف نهائي"})]})]})}),e.jsx(he,{open:l0,onOpenChange:_n,children:e.jsxs(fe,{className:"sm:max-w-[420px]",children:[e.jsx(xe,{children:e.jsx(ye,{className:"text-right",children:"تعديل بيانات العميل"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ee,{htmlFor:"editCustomerName",className:"text-right col-span-1",children:"الاسم"}),e.jsx(K,{id:"editCustomerName",value:ad,onChange:a=>wo(a.target.value),className:"col-span-3 text-right"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ee,{htmlFor:"editCustomerMobile",className:"text-right col-span-1",children:"الموبايل"}),e.jsx(K,{id:"editCustomerMobile",value:sd,onChange:a=>No(a.target.value),className:"col-span-3 text-right"})]})]}),e.jsxs(Pe,{className:"flex justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>_n(!1),children:"إلغاء"}),e.jsx(I,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{const a=c0,s=ad.trim(),i=sd.trim();if(!a||!s||!i){x({title:"بيانات غير مكتملة",description:"أدخل الاسم ورقم الموبايل",variant:"destructive"});return}const l=_t.map(m=>m.id===a?{...m,name:s,mobile:i}:m);await $o(l);const d=_e.map(m=>m.customerId===a?{...m,debtorName:s,mobile:i}:m);d!==_e&&(Lt(d),await Da(d)),_n(!1),td(""),wo(""),No(""),x({title:"تم تحديث العميل",description:s})},children:"حفظ"})]})]})}),e.jsx(he,{open:Wm,onOpenChange:Ja,children:e.jsxs(fe,{className:"sm:max-w-[520px]",children:[e.jsxs(xe,{children:[e.jsx(ye,{className:"text-right",children:"مصروفات المحل"}),e.jsx(Xe,{className:"text-right",children:"أدخل تفاصيل المصروف ثم اختر مصدر الخصم."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ee,{htmlFor:"expenseName",className:"text-right col-span-1",children:"اسم المصروف"}),e.jsx(K,{id:"expenseName",value:nn,onChange:a=>Hl(a.target.value),className:"col-span-3 text-right",placeholder:"مثال: كهرباء، صيانة، مشتريات"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ee,{htmlFor:"expenseAmount",className:"text-right col-span-1",children:"تمن المصروف"}),e.jsx(K,{id:"expenseAmount",type:"number",value:Di,onChange:a=>Ql(a.target.value),className:"col-span-3 text-right",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ee,{htmlFor:"expenseNotes",className:"text-right col-span-1",children:"ملاحظات"}),e.jsx(K,{id:"expenseNotes",value:ki,onChange:a=>Gl(a.target.value),className:"col-span-3 text-right",placeholder:"معلومات إضافية إن وجدت"})]})]}),e.jsxs(Pe,{className:"flex justify-between",children:[e.jsx(I,{className:"bg-orange-600 hover:bg-orange-700",onClick:()=>{if(!nn||!Di){x({title:"بيانات غير مكتملة",description:"يرجى إدخال اسم المصروف وقيمته",variant:"destructive"});return}ln(!0)},children:"إضافة مصروف"}),e.jsx(I,{variant:"outline",onClick:()=>_i(!0),children:"إيصالات المصاريف"})]})]})}),e.jsx(he,{open:Fm,onOpenChange:_i,children:e.jsxs(fe,{className:"sm:max-w-[420px]",dir:"rtl",children:[e.jsxs(xe,{children:[e.jsx(ye,{className:"text-right",children:"إيصالات المصاريف"}),e.jsx(Xe,{className:"text-right",children:"آخر المصاريف المسجلة"})]}),on.length>0?e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:on.map(a=>e.jsx("div",{className:"p-2 border rounded-lg bg-white dark:bg-card dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-sm dark:text-gray-200",children:a.name}),e.jsx("p",{className:"text-[11px] text-gray-600 dark:text-gray-400",children:a.notes||"بدون ملاحظات"}),e.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-500",children:new Date(a.createdAt).toLocaleString("ar-EG")})]}),e.jsxs("div",{className:"text-left flex items-start gap-2",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-bold text-sm dark:text-gray-200",children:[a.amount," جنيه"]}),e.jsx(_a,{variant:"secondary",className:a.source==="cash"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300",children:a.source==="cash"?"من النقدية":`من المحفظة${a.walletId?` (${a.walletId})`:""}`})]}),e.jsxs(I,{variant:"destructive",size:"sm",className:"shrink-0",onClick:()=>_0(a.id),title:"حذف نهائي",children:[e.jsx(oa,{className:"w-4 h-4 ml-1"}),"حذف"]})]})]})},a.id))}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"لا توجد مصاريف مسجلة بعد"})]})}),e.jsx(he,{open:Lm,onOpenChange:ln,children:e.jsxs(fe,{className:"sm:max-w-[480px]",children:[e.jsx(xe,{children:e.jsx(ye,{className:"text-right",children:"اختيار مصدر خصم المصروف"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-right",children:"اختر هل تريد خصم مبلغ المصروف من الرصيد النقدي في الدرج أم من إحدى المحافظ."}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(I,{variant:gt==="cash"?"default":"outline",className:gt==="cash"?"bg-blue-600 hover:bg-blue-700 text-white":"",onClick:()=>ar("cash"),children:"الفلوس النقدية"}),e.jsx(I,{variant:gt==="wallet"?"default":"outline",className:gt==="wallet"?"bg-purple-600 hover:bg-purple-700 text-white":"",onClick:()=>ar("wallet"),children:"أرصدة المحافظ"}),e.jsx(I,{variant:gt==="fawry"?"default":"outline",className:gt==="fawry"?"bg-amber-600 hover:bg-amber-700 text-white":"",onClick:()=>ar("fawry"),children:"فوري"})]}),gt==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{className:"text-right block",children:"اختر المحفظة للخصم"}),e.jsxs(Rs,{value:ps,onValueChange:Ii,children:[e.jsx(Ls,{className:"w-full",children:e.jsx(Fs,{placeholder:"اختر محفظة"})}),e.jsx(Bs,{children:$.map(a=>e.jsx(Aa,{value:a.id,children:a.phone||a.name||a.id},a.id))})]})]})]}),e.jsxs(Pe,{className:"flex justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>{ln(!1),ar(null),Ii("")},children:"إلغاء"}),e.jsx(I,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{const a=Number(Di);if(isNaN(a)||a<=0){x({title:"قيمة غير صحيحة",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}if(!gt){x({title:"اختر مصدر الخصم",description:"يرجى اختيار النقدية أو المحفظة",variant:"destructive"});return}try{if(gt==="cash"){const d=Number((We-a).toFixed(2));Ze(d),localStorage.setItem(Ve(),d.toString());const m={cashBalance:d,lastUpdated:new Date().toISOString()},f=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(f,JSON.stringify(m)),t!=null&&t.uid?(await ae.updateUserData(t.uid,m),localStorage.removeItem(f),pe(!1)):pe(!0)}else if(gt==="wallet"){if(!ps){x({title:"اختر محفظة",description:"يرجى اختيار محفظة للخصم",variant:"destructive"});return}const d=we[ps]||0,m=Number((d-a).toFixed(2)),f={...we,[ps]:m};ct(f);const g=new Date().toISOString(),v={walletBalances:f,lastUpdated:g},y=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(y,JSON.stringify(v)),localStorage.setItem(et(),JSON.stringify(f)),localStorage.setItem(`walletBalances_backup_${g}`,JSON.stringify(f)),t!=null&&t.uid&&ae.updateUserData(t.uid,v).catch(()=>{})}}catch(d){console.error("خطأ أثناء تحديث الأرصدة عند حفظ المصروف:",d)}let s=Date.now().toString();try{if(t!=null&&t.uid){const{addDoc:d,collection:m,serverTimestamp:f}=await Z(async()=>{const{addDoc:y,collection:p,serverTimestamp:N}=await import("./index-CzMrJEuC.js").then(C=>C.cC);return{addDoc:y,collection:p,serverTimestamp:N}},__vite__mapDeps([0,1]),import.meta.url),{db:g}=await Z(async()=>{const{db:y}=await import("./index-CzMrJEuC.js").then(p=>p.cD);return{db:y}},__vite__mapDeps([0,1]),import.meta.url);s=(await d(m(g,"shop_expenses"),{userId:t.uid,shopId:j||(n==null?void 0:n.shopId)||t.uid||"default-shop",name:nn,amount:a,notes:ki||"",source:gt,walletId:gt==="wallet"?ps:null,createdAt:f()})).id}}catch(d){console.error("خطأ أثناء حفظ المصروف في Firestore:",d)}const i={id:s,name:nn,amount:a,notes:ki,source:gt,walletId:gt==="wallet"?ps:void 0,createdAt:new Date},l=[...on,i];await yd(l),Hl(""),Ql(""),Gl(""),ar(null),Ii(""),ln(!1),Ja(!0),_i(!0),x({title:"تم إضافة المصروف",description:gt==="cash"?"تم الخصم من النقدية":gt==="wallet"?"تم الخصم من أرصدة المحافظ":"تم تسجيل الدفع عبر فوري"})},children:"تأكيد الخصم"})]})]})}),e.jsx(he,{open:$m,onOpenChange:sr,children:e.jsxs(fe,{className:"sm:max-w-[520px]",children:[e.jsxs(xe,{children:[e.jsx(ye,{className:"text-right",children:"النواقص"}),e.jsx(Xe,{className:"text-right",children:"سجل العناصر الناقصة التي تحتاج شراء وتابع حالتها."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ee,{htmlFor:"deficiencyName",className:"text-right col-span-1",children:"اسم العنصر"}),e.jsx(K,{id:"deficiencyName",value:rr,onChange:a=>Ai(a.target.value),className:"col-span-3 text-right",placeholder:"مثال: سكر، زيت، مناديل"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ee,{htmlFor:"deficiencyQuantity",className:"text-right col-span-1",children:"الكمية"}),e.jsx(K,{id:"deficiencyQuantity",type:"number",value:Xl,onChange:a=>Ti(a.target.value),className:"col-span-3 text-right",placeholder:"1"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(I,{className:"bg-rose-600 hover:bg-rose-700",onClick:()=>{if(Ne){x({title:"غير متاح",description:"النواقص غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"});return}const a=parseInt(Xl||"1",10);if(!rr){x({title:"بيانات غير مكتملة",description:"يرجى إدخال اسم العنصر",variant:"destructive"});return}if(isNaN(a)||a<=0){x({title:"كمية غير صحيحة",description:"يرجى إدخال كمية صحيحة",variant:"destructive"});return}(async()=>{if(t!=null&&t.uid)try{const{collection:i,addDoc:l,serverTimestamp:d}=await Z(async()=>{const{collection:g,addDoc:v,serverTimestamp:y}=await import("./index-CzMrJEuC.js").then(p=>p.cC);return{collection:g,addDoc:v,serverTimestamp:y}},__vite__mapDeps([0,1]),import.meta.url),{db:m}=await Z(async()=>{const{db:g}=await import("./index-CzMrJEuC.js").then(v=>v.cD);return{db:g}},__vite__mapDeps([0,1]),import.meta.url),f=await l(i(m,"deficiencies"),{userId:t.uid,shopId:j||(n==null?void 0:n.shopId)||t.uid||"default-shop",name:rr,quantity:a,status:"pending",createdAt:d()});try{const g=Ln(),v=localStorage.getItem(g),y=v?JSON.parse(v):[],p=Array.isArray(y)?y:[],N=p.some(A=>String((A==null?void 0:A.id)||"")===f.id),C={id:f.id,name:rr,quantity:a,status:"pending",createdAt:new Date().toISOString()},S=N?p:[...p,C];localStorage.setItem(g,JSON.stringify(S))}catch{}Ai(""),Ti(""),x({title:"تمت الإضافة",description:"تمت إضافة العنصر إلى قائمة النواقص"});return}catch(i){console.warn("فشل حفظ النواقص إلى Firestore، سيُستخدم التخزين المحلي:",i)}const s={id:Date.now().toString(),name:rr,quantity:a,status:"pending",createdAt:new Date};xs(i=>{const l=[...i,s];return Bo(l),l}),Ai(""),Ti(""),x({title:"تمت الإضافة",description:"تمت إضافة العنصر إلى قائمة النواقص"})})()},children:"إضافة للنواقص"})}),Zl.length>0?e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Zl.map(a=>e.jsx("div",{className:"p-2 border rounded-lg bg-white dark:bg-card dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-sm dark:text-gray-200",children:a.name}),e.jsxs("p",{className:"text-[11px] text-gray-600 dark:text-gray-400",children:["الكمية: ",a.quantity]}),e.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-500",children:new Date(a.createdAt).toLocaleString("ar-EG")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_a,{variant:"secondary",className:a.status==="pending"?"bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-300":"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",children:a.status==="pending"?"قيد الشراء":"تم الشراء"}),e.jsx(I,{variant:"outline",className:a.status==="pending"?"text-green-700 border-green-300 hover:bg-green-50":"text-rose-700 border-rose-300 hover:bg-rose-50",onClick:()=>{(async()=>{const s=a.status==="pending"?"purchased":"pending";if(t!=null&&t.uid)try{const{doc:i,updateDoc:l,serverTimestamp:d}=await Z(async()=>{const{doc:f,updateDoc:g,serverTimestamp:v}=await import("./index-CzMrJEuC.js").then(y=>y.cC);return{doc:f,updateDoc:g,serverTimestamp:v}},__vite__mapDeps([0,1]),import.meta.url),{db:m}=await Z(async()=>{const{db:f}=await import("./index-CzMrJEuC.js").then(g=>g.cD);return{db:f}},__vite__mapDeps([0,1]),import.meta.url);await l(i(m,"deficiencies",a.id),{status:s,updatedAt:d()});return}catch(i){console.warn("فشل تحديث حالة النواقص على Firestore، استخدام التخزين المحلي:",i)}xs(i=>{const l=i.map(d=>d.id===a.id?{...d,status:s}:d);return Bo(l),l})})()},title:a.status==="pending"?"تم الشراء":"إلغاء الشراء",children:a.status==="pending"?"تم الشراء":"إلغاء الشراء"}),e.jsx(I,{variant:"outline",className:"text-red-700 border-red-300 hover:bg-red-50",onClick:()=>{(async()=>{if(t!=null&&t.uid)try{const{doc:s,deleteDoc:i}=await Z(async()=>{const{doc:d,deleteDoc:m}=await import("./index-CzMrJEuC.js").then(f=>f.cC);return{doc:d,deleteDoc:m}},__vite__mapDeps([0,1]),import.meta.url),{db:l}=await Z(async()=>{const{db:d}=await import("./index-CzMrJEuC.js").then(m=>m.cD);return{db:d}},__vite__mapDeps([0,1]),import.meta.url);await i(s(l,"deficiencies",a.id));return}catch(s){console.warn("فشل حذف عنصر النواقص من Firestore، استخدام التخزين المحلي:",s)}xs(s=>{const i=s.filter(l=>l.id!==a.id);return Bo(i),i})})()},title:"حذف",children:"حذف"})]})]})},a.id))}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"لا توجد عناصر مسجلة في النواقص"})]}),e.jsx(Pe,{className:"flex justify-end",children:e.jsx(I,{variant:"outline",onClick:()=>sr(!1),children:"إغلاق"})})]})}),e.jsx(he,{open:Um,onOpenChange:a=>{cn(a),a||(un(null),nr(""),ir(""))},children:e.jsxs(fe,{className:"sm:max-w-[520px]",children:[e.jsxs(xe,{children:[e.jsx(ye,{className:"text-right",children:"أرقامي مع عملائي"}),e.jsx(Xe,{className:"text-right",children:"استعرض أرقام المحافظ واضغط على علامة الزائد لتسليم رقم لعميل. هذه القائمة مخصصة للأرقام التي تعطيها لعملاء خارج المحل ليحوّلوا عليها، حتى تكون عارف أن الخطوط دي مخصصة لعملاء هيحولو عليها من برا المحل علشان متستلمش عليها وتوقف ليميتك"})]}),e.jsx("div",{className:"grid gap-3 py-2",children:$.length===0?e.jsx("div",{className:"text-center text-sm text-gray-500",children:"لا توجد محافظ مضافة حتى الآن."}):$.map(a=>{const s=Pi[a.id],i=!!s;return e.jsxs("div",{className:`p-3 rounded-lg border flex flex-col gap-2 ${i?"border-red-500 bg-red-50 text-red-700":"border-emerald-500 bg-emerald-50 text-emerald-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"font-semibold text-base",children:a.phone||"بدون رقم"}),a.name?e.jsx("span",{className:"text-xs text-gray-600",children:a.name}):null,i&&e.jsxs("span",{className:"text-xs mt-1",children:["لعميل: ",s.name,s.amount&&s.amount.trim()!==""?` - مبلغ: ${s.amount}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{type:"button",size:"icon",className:"h-9 w-9 rounded-full bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>{un(a.id),nr((s==null?void 0:s.name)||""),ir((s==null?void 0:s.amount)||"")},children:e.jsx(jt,{className:"h-4 w-4"})}),i&&e.jsx(I,{type:"button",size:"icon",variant:"outline",className:"h-9 w-9 rounded-full border-red-300 text-red-600 hover:bg-red-50",onClick:()=>{const l=`clientNumberAssignments_${(t==null?void 0:t.uid)||"default"}`,d={...Pi};delete d[a.id],ys(d);try{localStorage.setItem(l,JSON.stringify(d))}catch{}dn===a.id&&(un(null),nr(""),ir(""))},children:e.jsx(oa,{className:"h-4 w-4"})})]})]}),dn===a.id&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-stretch",children:[e.jsx(K,{placeholder:"اسم مستلم الرقم",className:"text-right",value:ec,onChange:l=>nr(l.target.value)}),e.jsx(K,{placeholder:"المبلغ المتوقع تحويله",className:"text-right sm:max-w-[160px]",value:tc,onChange:l=>ir(l.target.value),inputMode:"decimal"}),e.jsx(I,{className:"bg-red-600 hover:bg-red-700 text-white px-4",onClick:()=>{const l=ec.trim();if(!l){x({title:"اسم غير صحيح",description:"يرجى إدخال اسم مستلم الرقم",variant:"destructive"});return}if(!dn)return;const d=tc.trim(),m=`clientNumberAssignments_${(t==null?void 0:t.uid)||"default"}`,f={...Pi,[dn]:{name:l,amount:d}};ys(f);try{localStorage.setItem(m,JSON.stringify(f))}catch{}un(null),nr(""),ir("")},children:"تسليم"})]})]},a.id)})})]})}),e.jsx(he,{open:f0,onOpenChange:Is,children:e.jsxs(fe,{className:"sm:max-w-[480px]",children:[e.jsx(xe,{children:e.jsx(ye,{className:"text-right",children:(Ge==null?void 0:Ge.type)==="decrease"?"اختيار مكان إضافة مبلغ السداد":"اختيار مصدر خصم الدين"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 text-right",children:(Ge==null?void 0:Ge.type)==="decrease"?"اختر هل تريد إضافة مبلغ السداد إلى الرصيد النقدي أم إلى إحدى المحافظ أو تسجيله بدون خصم.":"اختر هل تريد خصم مبلغ الدين من الرصيد النقدي في الدرج أم من إحدى المحافظ أو تسجيله بدون خصم."}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(I,{variant:At==="cash"?"default":"outline",className:At==="cash"?"bg-blue-600 hover:bg-blue-700 text-white":"",onClick:()=>Sr("cash"),children:"الفلوس النقدية"}),e.jsx(I,{variant:At==="wallet"?"default":"outline",className:At==="wallet"?"bg-purple-600 hover:bg-purple-700 text-white":"",onClick:()=>Sr("wallet"),children:"أرصدة المحافظ"}),e.jsx(I,{variant:At==="none"?"default":"outline",className:At==="none"?"bg-gray-600 hover:bg-gray-700 text-white":"",onClick:()=>Sr("none"),children:(Ge==null?void 0:Ge.type)==="decrease"?"بدون إضافة":"بدون خصم"})]}),At==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{className:"text-right block",children:(Ge==null?void 0:Ge.type)==="decrease"?"اختر المحفظة للإضافة":"اختر المحفظة للخصم"}),e.jsxs(Rs,{value:Dr,onValueChange:Co,children:[e.jsx(Ls,{className:"w-full",children:e.jsx(Fs,{placeholder:"اختر محفظة"})}),e.jsx(Bs,{children:$.map(a=>e.jsx(Aa,{value:a.id,children:a.phone||a.name||a.id},a.id))})]})]})]}),e.jsxs(Pe,{className:"flex justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>{Is(!1),jr(null),Sr(null),Co("")},children:"إلغاء"}),e.jsx(I,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{const a=!!Ge,s=a&&(Ge==null?void 0:Ge.type)==="decrease",i=Number(a?Ge.delta:(es==null?void 0:es.amount)||0);if(!At){x({title:s?"اختر مكان الإضافة":"اختر مصدر الخصم",description:"يرجى اختيار النقدية أو المحفظة",variant:"destructive"});return}const l=new Date().toISOString();let d=We,m=we,f=!1,g=!1;try{if(At==="cash")d=Number(s?(We+i).toFixed(2):(We-i).toFixed(2)),f=!0;else if(At==="wallet"){if(!Dr){x({title:"اختر محفظة",description:s?"يرجى اختيار محفظة للإضافة":"يرجى اختيار محفظة للخصم",variant:"destructive"});return}const S=we[Dr]||0,A=Number(s?(S+i).toFixed(2):(S-i).toFixed(2));m={...we,[Dr]:A},g=!0}}catch(S){console.error("Error calculating balances:",S);return}let v=[..._e],y=R,p=!1;if(a){if(!R)return;const S=Number(R.amount||0),A=Number(R.paidAmount||0),O=Number(Ge.delta||0);if(Ge.type==="decrease"){const _=Number((S-O).toFixed(2)),T=A>=_,B={...R,amount:_,status:T?"paid":"pending"};if(v=_e.map(J=>J.id===R.id?B:J),y=B,p=!0,T&&(t!=null&&t.uid)&&(async()=>{try{const[J,ne,tt]=[Oe(me(V,"userTransactions"),X("userId","==",t.uid),X("linkedDebtId","==",R.id),X("status","==","pending")),Oe(me(V,"transactions"),X("userId","==",t.uid),X("linkedDebtId","==",R.id),X("status","==","pending")),Oe(me(V,"transactions"),X("merchantUserId","==",t.uid),X("linkedDebtId","==",R.id),X("status","==","pending"))],[bt,dt,Se]=await Promise.all([ke(J),ke(ne),ke(tt)]),ce=Hf(V);let nt=0;const ut=mt=>{mt.docs.forEach(vt=>{ce.update(vt.ref,{status:"completed",confirmedAt:new Date}),nt++})};ut(bt),ut(dt),ut(Se),nt>0&&await ce.commit(),t!=null&&t.uid&&[...bt.docs.map(vt=>{var ia;return String(((ia=vt.data())==null?void 0:ia.transactionId)||"")}),...dt.docs.map(vt=>{var ia;return String(vt.id||((ia=vt.data())==null?void 0:ia.transactionId)||"")}),...Se.docs.map(vt=>{var ia;return String(vt.id||((ia=vt.data())==null?void 0:ia.transactionId)||"")})].filter(Boolean).forEach(vt=>ae.removeLocalReceiptById(t.uid,vt))}catch(J){console.error("Batch update failed for linked transactions:",J)}})().catch(J=>{console.error("Transaction update error:",J)}),t!=null&&t.uid&&At!=="none")try{await ni(me(V,"debtReceipts"),{debtId:R.id,debtorName:R.debtorName,amount:O,userId:t.uid,createdAt:ft(),type:"payment"});const ne={transactionId:Te(me(V,"dummy_collection")).id,amount:O,transactionType:"cash_addition",type:"cash_addition",status:"completed",createdAt:new Date,senderName:R.debtorName,receiverName:"المحل",description:`سداد دين من العميل ${R.debtorName}`,paymentMethod:At,walletId:At==="wallet"?Dr:null,linkedDebtId:R.id,isDebtRepayment:!0};await ae.saveUserTransaction(t.uid,ne);try{M.invalidateQueries({queryKey:["recentTransactions",t==null?void 0:t.uid]})}catch{}}catch(J){console.error("Failed to create repayment receipt:",J)}x({title:"تم إنقاص المبلغ",description:`المبلغ الجديد: ${_} جنيه`})}else{const _=S+O,T=A>=_,B={amount:O,note:Kc||void 0,addedAt:new Date},J={...R,amount:Number(_.toFixed(2)),status:T?"paid":"pending",additionReceipts:[...R.additionReceipts||[],B]};v=_e.map(ne=>ne.id===R.id?J:ne),y=J,p=!0,x({title:"تم زيادة المبلغ",description:`المبلغ الجديد: ${_} جنيه`})}}else if(es){v=[{...es,userId:t==null?void 0:t.uid,shopId:j||(n==null?void 0:n.shopId)||null},..._e],p=!0;try{t!=null&&t.uid&&ns.send(t.uid,`تم إضافة دين على ${es.debtorName} بمبلغ ${es.amount} جنيه`).catch(()=>{})}catch{}}f&&Ze(d),g&&ct(m),p&&(Lt(v),a&&wr(y)),$c(""),Uc(""),Vc(""),ks(!1),Is(!1),!a&&p&&Xa(!0),jr(null),Jc(null),Sr(null),Co(""),kn(""),x({title:a?"تم تعديل الدين":"تم حفظ الدين",description:At==="none"?"لم يتم تعديل الأرصدة":At==="cash"?s?`تمت إضافة ${i} إلى الرصيد النقدي`:`تم خصم ${i} من الرصيد النقدي`:s?`تمت إضافة ${i} إلى رصيد المحفظة`:`تم خصم ${i} من رصيد المحفظة`});const N={lastUpdated:l};if(f&&(N.cashBalance=d),g&&(N.walletBalances=m),p&&(N.debts=v,N.debtsDeletedAt=null),f&&(localStorage.setItem(Ve(),d.toString()),localStorage.setItem(Ve()+"_lastUpdated",l)),g&&(localStorage.setItem(et(),JSON.stringify(m)),localStorage.setItem(et()+"_lastUpdated",l)),p){localStorage.setItem(Cr(),JSON.stringify(v));try{localStorage.setItem(Ro(),JSON.stringify(v))}catch{}try{localStorage.setItem(Lo(),Date.now().toString())}catch{}}const C=`userData_${t==null?void 0:t.uid}`;if(localStorage.setItem(C,JSON.stringify(N)),t!=null&&t.uid){if(p)try{localStorage.setItem(`debts_unsynced_${t.uid}`,"true")}catch{}const S=[];S.push(ae.updateUserData(t.uid,N).then(()=>{(f||g)&&(localStorage.removeItem(C),pe(!1))}));const A=j||(n==null?void 0:n.shopId);if(A&&(f||g)){const O={lastUpdated:l};f&&(O.cashBalance=d),g&&(O.walletBalances=m),S.push(Qt(Te(V,"dashboardData",A),O,{merge:!0}).catch(_=>console.error("Failed to sync to dashboardData",_)))}Promise.all(S).then(()=>{if(p)try{localStorage.removeItem(`debts_unsynced_${t.uid}`)}catch{}}).catch(O=>{console.error("Sync error:",O),pe(!0)})}},children:(Ge==null?void 0:Ge.type)==="decrease"?"تأكيد الإضافة":"تأكيد الخصم"})]})]})}),e.jsx(he,{open:t0,onOpenChange:Fa,children:e.jsxs(fe,{className:"w-[95vw] sm:w-auto sm:max-w-[425px] max-h-[90vh] overflow-y-auto rounded-2xl",hideClose:!0,children:[e.jsx("div",{className:"absolute left-4 top-4 z-50",children:e.jsxs(I,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full opacity-70 hover:opacity-100",onClick:()=>Fa(!1),children:[e.jsx(si,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"إغلاق"})]})}),e.jsx(xe,{children:e.jsx(ye,{className:"text-right",children:"إيصال الدين"})}),R&&e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"text-center border-b pb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"إيصال دين"}),e.jsx("p",{className:"text-sm text-gray-500",children:Mr.format(R.createdAt instanceof Date?R.createdAt:new Date(R.createdAt))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"اسم المديون:"}),e.jsx("span",{children:R.debtorName})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center",children:[e.jsx("span",{className:"font-medium",children:"المبلغ:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{variant:"outline",className:"h-10 w-10 sm:h-8 sm:w-8 p-0","aria-label":"دفع جزء من الدين",onClick:()=>{Nr(""),Cn(!0)},children:"−"}),e.jsxs("span",{className:"font-bold text-xl sm:text-lg",children:[R.amount," جنيه"]}),e.jsx(I,{variant:"outline",className:"h-10 w-10 sm:h-8 sm:w-8 p-0","aria-label":"زيادة الدين",onClick:()=>{s0("increase"),Yc(""),kn(""),Fa(!1),Dn(!0)},children:"+"})]})]}),(()=>{try{const a=(oe||[]).filter(s=>String((s==null?void 0:s.linkedDebtId)||"")===String(R.id)).reduce((s,i)=>s+Math.max(0,Number((i==null?void 0:i.commission)||0)),0);return a>0?e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"الربح:"}),e.jsxs("span",{className:"text-green-700 font-semibold",children:[a," جنيه"]})]}):null}catch{return null}})(),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"سبب الدين:"}),e.jsx("span",{children:R.reason})]}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"الحالة:"}),e.jsx(_a,{variant:R.status==="paid"?"default":"secondary",className:`${R.status==="paid"?"bg-green-500":"bg-yellow-500"} w-fit text-[12px] sm:text-xs`,children:R.status==="paid"?"مدفوع":"مؤجل"})]}),(()=>{const a=Number(R.amount||0),s=Number(R.paidAmount||0),i=Math.max(0,a-s);return e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"المبلغ المتبقي:"}),e.jsxs("span",{className:"font-bold text-xl sm:text-lg",children:[i," جنيه"]})]})})(),R.paidAmount?e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"إجمالي المدفوع:"}),e.jsxs("span",{className:"text-green-700",children:[R.paidAmount," جنيه"]})]}):null,R.partialPayments&&R.partialPayments.length>0&&e.jsxs("div",{className:"mt-3 text-[12px] sm:text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium mb-1",children:"سجل الدفعات الجزئية:"}),e.jsx("div",{className:"space-y-1 max-h-[30vh] sm:max-h-24 overflow-y-auto",children:R.partialPayments.map((a,s)=>e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsxs("span",{children:["دفع: ",a.amount," جنيه"]}),e.jsx("span",{children:new Date(a.paidAt).toLocaleString("ar-EG")})]},s))})]}),R.additionReceipts&&R.additionReceipts.length>0&&e.jsxs("div",{className:"mt-3 text-[12px] sm:text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium mb-1",children:"إيصالات الإضافة الجزئية:"}),e.jsx("div",{className:"space-y-1 max-h-[20vh] sm:max-h-32 overflow-y-auto",children:R.additionReceipts.map((a,s)=>e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsxs("span",{children:["إضافة: ",a.amount," جنيه"]}),e.jsx("span",{children:new Date(a.addedAt).toLocaleString("ar-EG")}),a.note&&e.jsxs("span",{className:"sm:col-span-2 text-right text-[11px] text-gray-500",children:["ملاحظة: ",a.note]})]},s))})]})]})]}),e.jsxs(Pe,{className:"flex gap-2 justify-center",children:[e.jsx(I,{onClick:async()=>{if(R){const a=_e.map(s=>s.id===R.id?{...s,status:"pending"}:s);Lt(a),await Da(a);try{if(t!=null&&t.uid){const s=computedRemaining;await ns.send(t.uid,`تم سداد الدين بالكامل للعميل ${R.debtorName}: المدفوع ${s} جنيه`)}}catch{}Fa(!1),x({title:"تم تحديث حالة الدين",description:"تم تعيين الدين كمؤجل"})}},variant:"outline",className:"bg-yellow-500 hover:bg-yellow-600 text-white",children:"مؤجل"}),e.jsx(I,{onClick:async()=>{if(R){const a=Number(R.amount||0),s=Number(R.paidAmount||0);let i=Math.max(0,a-s);try{const m=(oe||[]).filter(p=>String((p==null?void 0:p.linkedDebtId)||"")===String(R.id)),f=m.reduce((p,N)=>p+Math.max(0,Number((N==null?void 0:N.commission)||0)),0),g=m.reduce((p,N)=>p+Math.max(0,Number(((N==null?void 0:N.sentAmount)??(N==null?void 0:N.transferredAmount)??(N==null?void 0:N.withdrawnAmount)??(N==null?void 0:N.amount))||0)),0),y=a<g+f?a+f:a;i=Math.max(0,Number(y)-s)}catch{}const l=i,d=_e.map(m=>{if(m.id!==R.id)return m;const f=Number(m.amount||0),g=Number(m.paidAmount||0),v=Number((g+l).toFixed(2)),y=v>=f;return{...m,amount:f,paidAmount:y?f:v,status:"paid",partialPayments:[...m.partialPayments||[],...l>0?[{amount:l,paidAt:new Date}]:[]]}});Lt(d);try{wr(d.find(m=>m.id===R.id)||null)}catch{}Tn(l),Ba("none"),_s(!0),await Da(d);try{const m=d.find(f=>f.id===R.id);if(t!=null&&t.uid&&(m!=null&&m.id)){const f=Te(V,"debts",m.id),g={...m,userId:t.uid,shopId:j||(n==null?void 0:n.shopId)||null,lastUpdated:new Date().toISOString()};Object.keys(g).forEach(v=>g[v]===void 0&&delete g[v]),await Qt(f,g,{merge:!0})}}catch(m){console.error("Failed to sync debt payment to collection:",m)}try{t!=null&&t.uid&&(R!=null&&R.id)&&(async()=>{const m=Oe(me(V,"userTransactions"),X("userId","==",t.uid),X("linkedDebtId","==",R.id),X("status","==","pending")),f=await ke(m);await Promise.allSettled(f.docs.map(N=>Xt(N.ref,{status:"completed",confirmedAt:new Date})));try{const N=f.docs.map(C=>{var S;return String(((S=C.data())==null?void 0:S.transactionId)||"")});t!=null&&t.uid&&N.forEach(C=>C&&ae.removeLocalReceiptById(t.uid,C))}catch{}const g=Oe(me(V,"transactions"),X("userId","==",t.uid),X("linkedDebtId","==",R.id),X("status","==","pending")),v=await ke(g);await Promise.allSettled(v.docs.map(N=>Xt(N.ref,{status:"completed",confirmedAt:new Date})));try{const N=v.docs.map(C=>{var S;return String(C.id||((S=C.data())==null?void 0:S.transactionId)||"")});t!=null&&t.uid&&N.forEach(C=>C&&ae.removeLocalReceiptById(t.uid,C))}catch{}const y=Oe(me(V,"transactions"),X("merchantUserId","==",t.uid),X("linkedDebtId","==",R.id),X("status","==","pending")),p=await ke(y);await Promise.allSettled(p.docs.map(N=>Xt(N.ref,{status:"completed",confirmedAt:new Date})));try{const N=p.docs.map(C=>{var S;return String(C.id||((S=C.data())==null?void 0:S.transactionId)||"")});t!=null&&t.uid&&N.forEach(C=>C&&ae.removeLocalReceiptById(t.uid,C))}catch{}})().catch(m=>{console.error("تعذر تحديث حالة المعاملات المرتبطة بالدين:",m),x({title:"فشل تحديث حالة المعاملة",description:"تعذر تحديث حالة المعاملات المرتبطة بالدين",variant:"destructive"})})}catch(m){console.error("تعذر تجهيز تحديث حالة المعاملات المرتبطة:",m)}try{const m=Uo(),f=localStorage.getItem(m);if(f){const v=(JSON.parse(f)||[]).map(y=>(y==null?void 0:y.linkedDebtId)===R.id&&(y==null?void 0:y.status)==="pending"?{...y,status:"completed",confirmedAt:new Date}:y);localStorage.setItem(m,JSON.stringify(v)),zt(y=>y.map(p=>(p==null?void 0:p.linkedDebtId)===R.id&&(p==null?void 0:p.status)==="pending"?{...p,status:"completed",confirmedAt:new Date}:p))}}catch(m){console.warn("فشل تحديث حالة المعاملات المرتبطة محلياً بعد سداد الدين:",m)}Fa(!1),x({title:"تم تحديث حالة الدين",description:"تم تعيين الدين كمدفوع"})}},className:"bg-green-500 hover:bg-green-600",children:"مدفوع"}),e.jsx(I,{onClick:async()=>{if(R){const a=_e.filter(s=>s.id!==R.id);Lt(a),await Da(a),Fa(!1),x({title:"تم حذف الدين",description:"تم حذف الدين بنجاح"})}},variant:"destructive",children:"حذف"})]})]})}),e.jsx(he,{open:r0,onOpenChange:a=>{Cn(a),a||Nr("")},children:e.jsxs(fe,{className:"w-[95vw] sm:max-w-[425px] rounded-2xl",children:[e.jsxs(xe,{children:[e.jsx(ye,{className:"text-right",children:"دفع جزء من الدين"}),e.jsx(Xe,{className:"text-right",children:"أدخل المبلغ الذي تريد دفعه من هذا الدين ثم اضغط دفع."})]}),R&&e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"اسم المديون:"}),e.jsx("span",{children:R.debtorName})]}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"المبلغ الكلي:"}),e.jsxs("span",{children:[R.amount," جنيه"]})]}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"إجمالي المدفوع:"}),e.jsxs("span",{className:"text-green-700",children:[Number(R.paidAmount||0)," جنيه"]})]}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"المبلغ المتبقي:"}),e.jsxs("span",{className:"font-semibold",children:[Math.max(0,Number(R.amount||0)-Number(R.paidAmount||0))," ","جنيه"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"partialAmountDialog",className:"text-right block",children:"المبلغ المراد دفعه"}),e.jsx(K,{id:"partialAmountDialog",type:"number",value:Hc,onChange:a=>Nr(a.target.value),className:"text-right",placeholder:"أدخل المبلغ"})]})]}),e.jsxs(Pe,{className:"flex gap-2 justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>{Cn(!1),Nr("")},children:"إلغاء"}),e.jsx(I,{className:"bg-blue-600 hover:bg-blue-700",onClick:async()=>{const a=parseFloat(Hc);if(!R||isNaN(a)||a<=0){x({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const s=Math.max(0,Number(R.amount||0)-Number(R.paidAmount||0));if(a>s){x({title:"مبلغ زائد",description:"المبلغ المدفوع أكبر من المتبقي",variant:"destructive"});return}const i=Number(((R.paidAmount||0)+a).toFixed(2)),d=Number(R.amount||0)-i<.01,m={...R,amount:Number(R.amount||0),paidAmount:i,status:d?"paid":"pending",partialPayments:[...R.partialPayments||[],{amount:a,paidAt:new Date}]},f=_e.map(g=>g.id===R.id?m:g);Lt(f),wr(m),await Da(f);try{if(t!=null&&t.uid){const g=Math.max(0,Number(m.amount||0)-Number(m.paidAmount||0));await ns.send(t.uid,`تم سداد جزء من دين ${m.debtorName}: المدفوع ${a} جنيه، المتبقي ${g} جنيه`)}}catch{}try{m.status==="paid"&&(t!=null&&t.uid)&&(async()=>{const g=Oe(me(V,"userTransactions"),X("userId","==",t.uid),X("linkedDebtId","==",R.id),X("status","==","pending")),v=await ke(g);await Promise.allSettled(v.docs.map(S=>Xt(S.ref,{status:"completed",confirmedAt:new Date})));try{const S=v.docs.map(A=>{var O;return String(((O=A.data())==null?void 0:O.transactionId)||"")});t!=null&&t.uid&&S.forEach(A=>A&&ae.removeLocalReceiptById(t.uid,A))}catch{}const y=Oe(me(V,"transactions"),X("userId","==",t.uid),X("linkedDebtId","==",R.id),X("status","==","pending")),p=await ke(y);await Promise.allSettled(p.docs.map(S=>Xt(S.ref,{status:"completed",confirmedAt:new Date})));try{const S=p.docs.map(A=>{var O;return String(A.id||((O=A.data())==null?void 0:O.transactionId)||"")});t!=null&&t.uid&&S.forEach(A=>A&&ae.removeLocalReceiptById(t.uid,A))}catch{}const N=Oe(me(V,"transactions"),X("merchantUserId","==",t.uid),X("linkedDebtId","==",R.id),X("status","==","pending")),C=await ke(N);await Promise.allSettled(C.docs.map(S=>Xt(S.ref,{status:"completed",confirmedAt:new Date})));try{const S=C.docs.map(A=>{var O;return String(A.id||((O=A.data())==null?void 0:O.transactionId)||"")});t!=null&&t.uid&&S.forEach(A=>A&&ae.removeLocalReceiptById(t.uid,A))}catch{}})().catch(g=>{console.error("تعذر تحديث حالة المعاملات المرتبطة بالدين:",g),x({title:"فشل تحديث حالة المعاملة",description:"تعذر تحديث حالة المعاملات المرتبطة بالدين",variant:"destructive"})})}catch(g){console.error("تعذر تجهيز تحديث حالة المعاملات المرتبطة:",g)}try{const g=Uo(),v=localStorage.getItem(g);if(v){const p=(JSON.parse(v)||[]).map(N=>(N==null?void 0:N.linkedDebtId)===R.id&&(N==null?void 0:N.status)==="pending"?{...N,status:"completed",confirmedAt:new Date}:N);localStorage.setItem(g,JSON.stringify(p)),zt(N=>N.map(C=>(C==null?void 0:C.linkedDebtId)===R.id&&(C==null?void 0:C.status)==="pending"?{...C,status:"completed",confirmedAt:new Date}:C))}}catch(g){console.warn("فشل تحديث حالة المعاملات المرتبطة محلياً بعد سداد الدين:",g)}Tn(a),Ba("none"),_s(!0),Cn(!1),Nr(""),x({title:"تم تسجيل دفع جزء",description:`تم دفع ${a} جنيه بتاريخ ${new Date().toLocaleString("ar-EG")}`})},children:"دفع"})]})]})}),e.jsx(he,{open:a0,onOpenChange:Dn,children:e.jsxs(fe,{className:"sm:max-w-md rounded-2xl shadow-elegant border border-gray-200",children:[e.jsxs(xe,{children:[e.jsx(ye,{className:`text-right ${pa==="decrease"?"text-red-600":"text-green-600"}`,children:pa==="increase"?"كتابة بيانات الاضافة":pa==="decrease"?"إنقاص مبلغ الدين":"تعديل مبلغ الدين"}),e.jsx(Xe,{className:"text-right",children:pa==="increase"?"أدخل مبلغ الإضافة وملاحظات الاضافة ثم اضغط تأكيد.":`أدخل المبلغ ثم اضغط تأكيد لإتمام ${pa==="decrease"?"الإنقاص":"التعديل"}.`})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsx(ee,{htmlFor:"debtAdjustAmount",className:"text-right",children:pa==="increase"?"مبلغ الإضافة (جنيه)":"المبلغ (جنيه)"}),e.jsx(K,{id:"debtAdjustAmount",type:"number",placeholder:"0.00",value:zc,onChange:a=>Yc(a.target.value)}),pa==="increase"&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{htmlFor:"debtAdditionNote",className:"text-right",children:"ملاحظات الإضافة (اختياري)"}),e.jsx(K,{id:"debtAdditionNote",placeholder:"اكتب ملاحظات عن سبب الإضافة",value:Kc,onChange:a=>kn(a.target.value)})]}),R&&e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:["المبلغ الحالي: ",e.jsx("span",{className:"font-semibold",children:Number(R.amount||0).toFixed(2)})," جنيه"]})]}),e.jsxs(Pe,{className:"flex gap-2",children:[e.jsx(I,{variant:"secondary",onClick:()=>{Dn(!1),Fa(!0),kn("")},children:"إلغاء"}),e.jsx(I,{className:pa==="decrease"?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700",onClick:async()=>{try{if(!R||!pa)return;const a=Number(parseFloat(zc||"0").toFixed(2));if(!a||isNaN(a)||a<=0){x({title:"قيمة غير صالحة",description:"يرجى إدخال مبلغ أكبر من صفر",variant:"destructive"});return}jr(null),Jc({debtId:R.id,delta:a,type:pa}),Dn(!1),Is(!0)}catch(a){console.error("فشل تجهيز تعديل مبلغ الدين:",a),x({title:"خطأ",description:"تعذّر تجهيز تعديل مبلغ الدين",variant:"destructive"})}},children:"تأكيد"})]})]})}),e.jsx(he,{open:g0,onOpenChange:_s,children:e.jsxs(fe,{className:"sm:max-w-[480px]",children:[e.jsxs(xe,{children:[e.jsx(ye,{className:"text-right",children:"اختيار مكان إضافة مبلغ السداد"}),e.jsx(Xe,{className:"text-right",children:"هل تريد إضافة مبلغ السداد إلى الفلوس النقدية أم إلى إحدى المحافظ؟"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsx(I,{variant:Kt==="cash"?"default":"outline",className:Kt==="cash"?"bg-blue-600 text-white":"",size:"sm",onClick:()=>Ba("cash"),children:"الفلوس النقدية"}),e.jsx(I,{variant:Kt==="wallet"?"default":"outline",className:Kt==="wallet"?"bg-blue-600 text-white":"",size:"sm",onClick:()=>Ba("wallet"),children:"أرصدة المحافظ"}),e.jsx(I,{variant:Kt==="fawry"?"default":"outline",className:Kt==="fawry"?"bg-amber-600 text-white":"",size:"sm",onClick:()=>Ba("fawry"),children:"فوري"}),e.jsx(I,{variant:Kt==="none"?"default":"outline",className:Kt==="none"?"bg-gray-600 text-white":"",size:"sm",onClick:()=>Ba("none"),children:"بدون إضافة"})]}),Kt==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-right",children:"اختر المحفظة للإضافة"}),e.jsxs("select",{className:"w-full border rounded p-2 text-right",value:$a,onChange:a=>Io(a.target.value),children:[e.jsx("option",{value:"",children:"— اختر محفظة —"}),$&&$.length>0?$.map(a=>e.jsx("option",{value:a.id,children:a.phone||a.name||a.id},a.id)):Object.keys(we||{}).map(a=>{var s,i,l,d;return e.jsx("option",{value:a,children:((s=$.find(m=>m.id===a))==null?void 0:s.phone)||((i=Ps==null?void 0:Ps.find(m=>m.id===a))==null?void 0:i.phone)||((l=Ps==null?void 0:Ps.find(m=>m.id===a))==null?void 0:l.name)||((d=$.find(m=>m.id===a))==null?void 0:d.name)||a},a)})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:["المبلغ المراد إضافته: ",e.jsxs("span",{className:"font-bold",children:[nd," جنيه"]})]})]}),e.jsxs(Pe,{className:"flex flex-wrap justify-between gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{_s(!1),Tn(0),Ba(null),Io("")},children:"إلغاء"}),e.jsx(I,{onClick:async()=>{var a,s;try{const i=nd;if(!i||i<=0){_s(!1);return}const l=async(d,m)=>{if(t!=null&&t.uid&&R)try{const g={transactionId:Te(me(V,"dummy_collection")).id,amount:i,transactionType:"cash_addition",type:"cash_addition",status:"completed",createdAt:new Date,senderName:R.debtorName,receiverName:"المحل",description:`سداد دين من العميل ${R.debtorName}`,paymentMethod:d,walletId:m||null,linkedDebtId:R.id,isDebtRepayment:!0};await ae.saveUserTransaction(t.uid,g);try{M.invalidateQueries({queryKey:["recentTransactions",t==null?void 0:t.uid]})}catch{}}catch(f){console.error("Failed to create repayment receipt:",f)}};if(Kt==="cash"){const d=We+i;Ze(d),localStorage.setItem(Ve(),d.toString());const m={cashBalance:d,lastUpdated:new Date().toISOString()},f=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(f,JSON.stringify(m)),t!=null&&t.uid?(ae.updateUserData(t.uid,m).catch(()=>pe(!0)),localStorage.removeItem(f),pe(!1)):pe(!0),x({title:"تم إضافة مبلغ السداد",description:`تم إضافة ${i} جنيه إلى الفلوس النقدية`}),await l("cash")}else if(Kt==="wallet"){if(!$a){x({title:"اختر محفظة أولاً",description:"يرجى اختيار المحفظة لإضافة مبلغ السداد إليها",variant:"destructive"});return}const d={...we,[$a]:(we[$a]||0)+i};ct(d);const m=new Date().toISOString(),f={walletBalances:d,lastUpdated:m},g=`userData_${t==null?void 0:t.uid}`;if(localStorage.setItem(g,JSON.stringify(f)),localStorage.setItem(et(),JSON.stringify(d)),localStorage.setItem(`walletBalances_backup_${m}`,JSON.stringify(d)),t!=null&&t.uid){ae.updateUserData(t.uid,f).catch(()=>pe(!0));try{localStorage.removeItem(g)}catch{}pe(!1)}else pe(!0);x({title:"تم إضافة مبلغ السداد",description:`تم إضافة ${i} جنيه إلى المحفظة ${((a=$.find(v=>v.id===$a))==null?void 0:a.phone)||((s=$.find(v=>v.id===$a))==null?void 0:s.name)||$a}`}),await l("wallet",$a)}else if(Kt==="none")x({title:"تم تسجيل السداد",description:`تم تسجيل ${i} جنيه بدون تعديل الأرصدة`});else if(Kt==="fawry")x({title:"تم تسجيل سداد عبر فوري",description:`تم تسجيل ${i} جنيه كسداد عبر فوري بدون تعديل الأرصدة`}),await l("fawry");else{x({title:"اختر مصدر الإضافة",description:"يرجى اختيار إضافة المبلغ إلى النقدية أو المحفظة",variant:"destructive"});return}try{if(t!=null&&t.uid&&R){const d=Number(R.amount||0),m=Number(R.paidAmount||0),f=R.status==="paid"||m>=d,g=i>0?i:m||d,v=f?`تم سداد الدين بالكامل للعميل ${R.debtorName}: المدفوع ${m||g} جنيه`:`تم تسجيل سداد ${g} جنيه من دين العميل ${R.debtorName}`;await ns.send(t.uid,v)}}catch{}}catch(i){console.error("خطأ أثناء إضافة مبلغ السداد:",i),x({title:"حدث خطأ",description:"تعذر إضافة مبلغ السداد، حاول مرة أخرى",variant:"destructive"})}finally{_s(!1),Tn(0),Ba(null),Io("");try{Xa(!0)}catch{}}},className:"bg-green-600 hover:bg-green-700",children:"تأكيد الإضافة"})]})]})}),e.jsx(he,{open:_h,onOpenChange:ra,children:e.jsxs(fe,{hideClose:!0,className:"post-confirm-card sm:max-w-[420px] w-[90vw] rounded-2xl bg-gradient-to-br from-white via-indigo-50 to-blue-50 shadow-2xl border border-indigo-100",children:[e.jsxs(xe,{children:[e.jsx(ye,{className:"text-right text-2xl font-bold",children:(Ue==null?void 0:Ue.type)==="transfer"?"مبلغ يجب استلامه":"مبلغ يجب تسليمه"}),e.jsx(Xe,{className:"text-right text-gray-600",children:(Ue==null?void 0:Ue.type)==="transfer"?"هذا هو المبلغ الواجب استلامه من العميل بعد التأكيد.":"هذا هو المبلغ الواجب تسليمه للعميل بعد التأكيد."})]}),e.jsxs("div",{className:"py-3 flex flex-col items-center gap-1.5",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-blue-700 tracking-wide",children:[Ot((Ue==null?void 0:Ue.amount)||0)," جنيه"]}),e.jsx("div",{className:"text-sm text-gray-500 text-right w-full",children:(Ue==null?void 0:Ue.type)==="transfer"?"المبلغ المعروض شامل عمولة التحويل.":Ue!=null&&Ue.isDeduct||!$e?"العمولة مخصومة من المبلغ المسلّم للعميل.":"العمولة مضافة ولا تؤثر على قيمة التسليم."})]}),e.jsxs(Pe,{className:"flex justify-end gap-2",children:[(Ue==null?void 0:Ue.type)==="transfer"&&e.jsx(I,{variant:"default",id:"sendCodeBtn",onClick:Em,disabled:Ac,className:"btn-transfer-confirm bg-blue-600 hover:bg-blue-700 text-white border-0",children:Ac?"جارٍ الإرسال...":"إرسال كود التحويل"}),e.jsx(I,{onClick:()=>{ra(!1),to(null)},className:"bg-green-600 hover:bg-green-700 text-white",children:(Ue==null?void 0:Ue.type)==="transfer"?"تم الاستلام":"تم التسليم"})]}),(Ue==null?void 0:Ue.type)==="transfer"&&e.jsx("div",{className:"mt-4 border-t pt-4 w-full",children:e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(I,{variant:Rt===0?"default":"outline",size:"sm",onClick:()=>ji(0),className:`flex-1 h-10 ${Rt===0?"bg-blue-600 hover:bg-blue-700 text-white":"border-blue-200 text-blue-700 hover:bg-blue-50"}`,children:"SIM 1"}),e.jsx(I,{variant:Rt===1?"default":"outline",size:"sm",onClick:()=>ji(1),className:`flex-1 h-10 ${Rt===1?"bg-blue-600 hover:bg-blue-700 text-white":"border-blue-200 text-blue-700 hover:bg-blue-50"}`,children:"SIM 2"})]})})]})}),e.jsx(tg,{open:Th,onClose:()=>Sa(!1),onSubmit:Mm,deviceId:ao||Ya||"",recipientMsisdn:String(L==="transfer"?(rt==null?void 0:rt.receiver)||xt||"":((Yd=$.find(a=>a.id===E))==null?void 0:Yd.phone)||"").replace(/\D/g,"")}),e.jsx(jb,{isOpen:Ph,onClose:()=>Tc(!1),senderPhone:((Kd=$.find(a=>a.id===E))==null?void 0:Kd.phone)||"",receiverPhone:(rt==null?void 0:rt.receiver)||"",amount:Number((rt==null?void 0:rt.amount)||0),deviceId:ao||Ya||"",api:window.electronAPI}),e.jsx(Vb,{isOpen:hh,onClose:()=>Hi(!1),wallets:$,walletBalances:we,onSelectWallet:a=>{Zs(a);const s=$.find(i=>i.id===a);if(s){bs(s.phone);try{localStorage.setItem(ts(),a)}catch{}}Hi(!1)},selectedWalletId:E||void 0}),e.jsx(Yb,{open:Ke,onOpenChange:lt}),e.jsx(Sb,{open:Gs,onOpenChange:Vt}),!1,F&&e.jsx("div",{className:"fixed inset-0 z-[100] bg-white dark:bg-slate-950 overflow-y-auto",children:e.jsx(ag,{onBack:()=>H(!1)})}),e.jsx(he,{open:Yi,onOpenChange:Ki,children:e.jsxs(fe,{className:"sm:max-w-md",dir:"rtl",children:[e.jsxs(xe,{children:[e.jsx(ye,{children:"تقاريرك"}),e.jsx(Xe,{children:"اختر نوع التقرير ثم حدّد الشهر أو اليوم"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(ng,{value:pn,onValueChange:a=>nh(a),children:[e.jsxs(ig,{className:"grid grid-cols-2 w-full",children:[e.jsx(iu,{value:"monthly",children:"تقارير شهر"}),e.jsx(iu,{value:"daily",children:"تقارير يوم"})]}),e.jsx(ou,{value:"monthly",className:"mt-3",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(ee,{className:"text-right",children:"الشهر"}),e.jsxs(fu,{children:[e.jsx(gu,{asChild:!0,children:e.jsxs(I,{variant:"outline",className:Ys("w-full justify-start text-left font-normal",!La&&"text-muted-foreground"),children:[e.jsx(li,{className:"mr-2 h-4 w-4"}),La?da(new Date(`${La}-01`),"LLLL yyyy",{locale:wu}):e.jsx("span",{children:"اختر شهر"})]})}),e.jsx(fl,{className:"w-auto p-0",align:"start",children:e.jsx(xl,{mode:"single",selected:La?new Date(`${La}-01`):void 0,onSelect:a=>ih(a?da(a,"yyyy-MM"):""),initialFocus:!0})})]})]})}),e.jsx(ou,{value:"daily",className:"mt-3",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(ee,{className:"text-right",children:"التاريخ"}),e.jsxs(fu,{children:[e.jsx(gu,{asChild:!0,children:e.jsxs(I,{variant:"outline",className:Ys("w-full justify-start text-left font-normal",!Ra&&"text-muted-foreground"),children:[e.jsx(li,{className:"mr-2 h-4 w-4"}),Ra?da(new Date(Ra),"PPP",{locale:wu}):e.jsx("span",{children:"اختر تاريخ"})]})}),e.jsx(fl,{className:"w-auto p-0",align:"start",children:e.jsx(xl,{mode:"single",selected:Ra?new Date(Ra):void 0,onSelect:a=>rh(a?da(a,"yyyy-MM-dd"):""),initialFocus:!0})})]})]})})]}),js&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-3 rounded-lg border border-blue-100 dark:border-blue-900/30",children:[e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"عدد المعاملات"}),e.jsx("div",{className:"text-lg font-bold text-blue-800 dark:text-blue-200",children:js.count})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"إجمالي المبالغ"}),e.jsx("div",{className:"text-lg font-bold text-gray-800 dark:text-gray-200",children:js.totalAmount.toFixed(2)})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-950/20 p-3 rounded-lg border border-red-100 dark:border-red-900/30",children:[e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 mb-1",children:"المسحوب"}),e.jsx("div",{className:"text-lg font-bold text-red-800 dark:text-red-200",children:js.totalWithdrawn.toFixed(2)})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-950/20 p-3 rounded-lg border border-green-100 dark:border-green-900/30",children:[e.jsx("div",{className:"text-xs text-green-600 dark:text-green-400 mb-1",children:"المرسل"}),e.jsx("div",{className:"text-lg font-bold text-green-800 dark:text-green-200",children:js.totalSent.toFixed(2)})]}),e.jsx("div",{className:"col-span-2 bg-yellow-50 dark:bg-yellow-950/20 p-3 rounded-lg border border-yellow-100 dark:border-yellow-900/30",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:"الأرباح"}),e.jsx("div",{className:"text-lg font-bold text-yellow-800 dark:text-yellow-200",children:js.totalProfit.toFixed(2)})]})})]})]})]})}),e.jsx(he,{open:se,onOpenChange:je,children:e.jsxs(fe,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(xe,{children:e.jsxs(ye,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(ru,{className:"h-5 w-5"}),"تم رفض الوصول"]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-4 space-y-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx(ru,{className:"h-6 w-6 text-red-600"})}),e.jsxs("p",{className:"text-center text-gray-600",children:["عفواً، لا تملك صلاحية للوصول إلى هذا القسم.",e.jsx("br",{}),"تم تعطيل هذه الصلاحية من قبل مالك الحساب."]})]}),e.jsx(Pe,{className:"sm:justify-center",children:e.jsx(I,{variant:"outline",onClick:()=>je(!1),className:"w-full sm:w-auto",children:"حسناً"})})]})})]}))},Vv=Object.freeze(Object.defineProperty({__proto__:null,default:Jb},Symbol.toStringTag,{value:"Module"}));export{xl as C,Lu as P,Vv as U,ya as a,Ks as b,ba as c,Zu as d,fu as e,gu as f,da as g,fl as h};
//# sourceMappingURL=UserDashboardPage-njIiAjYE.js.map
