{"version":3,"file":"AdminTopupsPage-2d09w3qZ-BVhMex6M.js","sources":["../../assets/AdminTopupsPage-2d09w3qZ.js"],"sourcesContent":["import{c as v,r,j as e,B as g,q as S,h as w,i as T,o as b,l as B,k,f as u}from\"./index-tnWDkOuX.js\";import{S as C,a as _,b as A,c as D,d}from\"./select-QKdc2TYn.js\";const L=()=>{const{toast:n}=v(),[p,m]=r.useState([]),[j,h]=r.useState(!1),[o,y]=r.useState(\"all\"),[l,f]=r.useState(null);r.useEffect(()=>{(async()=>{h(!0);try{const a=S(w(T,\"topups\"),b(\"created_at\",\"desc\"),B(100)),i=(await k(a)).docs.map(t=>({id:t.id,...t.data()}));m(i)}catch(a){console.error(\"Failed to fetch topups:\",a),n({title:\"خطأ\",description:\"تعذر تحميل العمليات\",variant:\"destructive\"})}finally{h(!1)}})()},[n]),r.useEffect(()=>{(async()=>{var a;try{const c=await((a=u.currentUser)==null?void 0:a.getIdToken()),t=await(await fetch(\"/api/reloadly/balance\",{headers:c?{Authorization:`Bearer ${c}`}:{}})).json().catch(()=>null);f((t==null?void 0:t.raw)??t)}catch{}})()},[]);const x=r.useMemo(()=>o===\"all\"?p:p.filter(s=>String(s.status).toLowerCase()===o),[p,o]),N=async s=>{var a;try{const c=await((a=u.currentUser)==null?void 0:a.getIdToken()),i=await fetch(\"/api/topup/retry\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",...c?{Authorization:`Bearer ${c}`}:{}},body:JSON.stringify({id:s.id})}),t=await i.json().catch(()=>({success:!1,message:\"فشل قراءة استجابة الخادم\"}));i.ok&&(t!=null&&t.success)?n({title:\"أُعيدت المحاولة\",description:\"تم إعادة محاولة العملية بنجاح\"}):n({title:\"فشل إعادة المحاولة\",description:(t==null?void 0:t.message)||\"حدث خطأ أثناء إعادة المحاولة\",variant:\"destructive\"})}catch(c){console.error(\"Retry error:\",c),n({title:\"خطأ في الاتصال\",description:\"تعذر الاتصال بالخادم. حاول لاحقاً.\",variant:\"destructive\"})}};return e.jsxs(\"div\",{className:\"p-4\",children:[e.jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[e.jsx(\"h1\",{className:\"text-xl font-semibold\",children:\"لوحة تقارير الشحن\"}),e.jsxs(\"div\",{className:\"text-sm text-gray-600\",children:[\"رصيد Reloadly: \",(l==null?void 0:l.balance)??(l==null?void 0:l.availableBalance)??\"غير متاح\"]})]}),e.jsxs(\"div\",{className:\"flex items-center gap-2 mb-4\",children:[e.jsx(\"span\",{children:\"الحالة:\"}),e.jsxs(C,{value:o,onValueChange:s=>y(s),children:[e.jsx(_,{className:\"w-40\",children:e.jsx(A,{placeholder:\"اختر الحالة\"})}),e.jsxs(D,{children:[e.jsx(d,{value:\"all\",children:\"الكل\"}),e.jsx(d,{value:\"pending\",children:\"في الانتظار\"}),e.jsx(d,{value:\"success\",children:\"ناجحة\"}),e.jsx(d,{value:\"failed\",children:\"فاشلة\"})]})]})]}),e.jsx(\"div\",{className:\"overflow-x-auto\",children:e.jsxs(\"table\",{className:\"min-w-full text-sm\",children:[e.jsx(\"thead\",{children:e.jsxs(\"tr\",{className:\"text-right\",children:[e.jsx(\"th\",{className:\"px-2 py-1\",children:\"ID\"}),e.jsx(\"th\",{className:\"px-2 py-1\",children:\"User\"}),e.jsx(\"th\",{className:\"px-2 py-1\",children:\"Phone\"}),e.jsx(\"th\",{className:\"px-2 py-1\",children:\"Operator\"}),e.jsx(\"th\",{className:\"px-2 py-1\",children:\"Amount\"}),e.jsx(\"th\",{className:\"px-2 py-1\",children:\"Status\"}),e.jsx(\"th\",{className:\"px-2 py-1\",children:\"ProviderTxn\"}),e.jsx(\"th\",{className:\"px-2 py-1\",children:\"Created\"}),e.jsx(\"th\",{className:\"px-2 py-1\",children:\"Actions\"})]})}),e.jsx(\"tbody\",{children:j?e.jsx(\"tr\",{children:e.jsx(\"td\",{className:\"p-4\",colSpan:9,children:\"جارٍ التحميل...\"})}):x.length===0?e.jsx(\"tr\",{children:e.jsx(\"td\",{className:\"p-4\",colSpan:9,children:\"لا يوجد بيانات\"})}):x.map(s=>{var a;return e.jsxs(\"tr\",{className:\"border-t\",children:[e.jsx(\"td\",{className:\"px-2 py-1 font-mono\",children:s.id}),e.jsx(\"td\",{className:\"px-2 py-1\",children:s.user_id||\"-\"}),e.jsx(\"td\",{className:\"px-2 py-1\",children:s.phone}),e.jsx(\"td\",{className:\"px-2 py-1\",children:s.operator}),e.jsx(\"td\",{className:\"px-2 py-1\",children:s.amount_local}),e.jsx(\"td\",{className:\"px-2 py-1\",children:s.status}),e.jsx(\"td\",{className:\"px-2 py-1\",children:s.provider_txn_id||\"-\"}),e.jsx(\"td\",{className:\"px-2 py-1\",children:(a=s.created_at)!=null&&a.toDate?s.created_at.toDate().toLocaleString():\"-\"}),e.jsx(\"td\",{className:\"px-2 py-1\",children:String(s.status).toLowerCase()===\"failed\"&&e.jsx(g,{variant:\"outline\",onClick:()=>N(s),children:\"Retry\"})})]},s.id)})})]})})]})};export{L as default};\r\n//# sourceMappingURL=AdminTopupsPage-2d09w3qZ.js.map\r\n"],"names":["L","n","v","p","m","r","o","l","f","S","w","T","b","B","i","k","t","c","u","s","N","a","e","C","_","A","D","d","g"],"mappings":"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"}