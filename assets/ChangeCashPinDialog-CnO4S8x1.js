import{r as t,m as T,av as o,j as e,af as A,ag as J,ah as K,ai as R,a4 as M,y as u,H as f,I as g,J as j,K as N,B as L}from"./index-CHyvkdwe.js";import{D as q}from"./dollar-sign-_wKHiNUd.js";function U({open:w,onOpenChange:F,userId:i}){const[c,y]=t.useState(""),[r,v]=t.useState(""),[b,P]=t.useState(""),[h,C]=t.useState(!1),[x,S]=t.useState(!1),[m,k]=t.useState(!1),[D,a]=t.useState(""),[E,l]=t.useState(!1),[n,H]=t.useState(!1),{toast:B}=T();t.useEffect(()=>{let s=!0;return(async()=>{const p=await o.hasMasterPin(i);s&&H(p)})(),()=>{s=!1}},[i,w]);const O=async s=>{s.preventDefault(),a(""),l(!0);try{if(!r||r.length<4){a("يجب أن يكون الرقم السري 4 أرقام على الأقل"),l(!1);return}if(r!==b){a("الرقم السري الجديد وتأكيده غير متطابقين"),l(!1);return}if(n){if(!c){a("يرجى إدخال الرقم السري الرئيسي الحالي"),l(!1);return}if(!await o.verifyMasterPin(c,i)){a("الرقم السري الرئيسي الحالي غير صحيح"),l(!1);return}}if(!(n?await o.changeMasterPin(c,r,i):await o.createMasterPin(r,i))){a("تعذر حفظ الرقم السري الرئيسي"),l(!1);return}B({title:n?"تم تغيير الرقم السري الرئيسي":"تم تعيين الرقم السري الرئيسي",description:n?"تم تغيير الرقم السري الرئيسي بنجاح (سيتم تطبيقه على جميع النوافذ)":"تم تعيين الرقم السري الرئيسي بنجاح (سيتم تطبيقه على جميع النوافذ)"}),d()}catch{a("حدث خطأ أثناء حفظ الرقم السري الرئيسي")}finally{l(!1)}},d=()=>{y(""),v(""),P(""),a(""),C(!1),S(!1),k(!1),F(!1)};return e.jsx(A,{open:w,onOpenChange:d,children:e.jsxs(J,{className:"sm:max-w-[425px]",children:[e.jsx(K,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-purple-600"}),n?"تغيير الرقم السري الرئيسي":"تعيين الرقم السري الرئيسي"]})}),e.jsxs("form",{onSubmit:O,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-md text-sm text-blue-700 mb-4 flex items-start gap-2",children:[e.jsx(M,{className:"h-4 w-4 mt-0.5 shrink-0"}),e.jsx("p",{children:"هذا الرقم السري موحد لجميع العمليات الحساسة في التطبيق (الديون، التقسيط، درج النقدية، إلخ)."})]}),D&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded-md text-sm flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),D]}),n&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"current-pin",children:"الرقم السري الحالي"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(g,{id:"current-pin",type:h?"text":"password",value:c,onChange:s=>y(s.target.value),className:"pr-10 pl-10 text-left",dir:"ltr",placeholder:"****"}),e.jsx("button",{type:"button",onClick:()=>C(!h),className:"absolute left-3 top-2.5 text-gray-500 hover:text-gray-700",children:h?e.jsx(j,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"new-pin",children:"الرقم السري الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(g,{id:"new-pin",type:x?"text":"password",value:r,onChange:s=>v(s.target.value),className:"pr-10 pl-10 text-left",dir:"ltr",placeholder:"****"}),e.jsx("button",{type:"button",onClick:()=>S(!x),className:"absolute left-3 top-2.5 text-gray-500 hover:text-gray-700",children:x?e.jsx(j,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"confirm-pin",children:"تأكيد الرقم السري الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(g,{id:"confirm-pin",type:m?"text":"password",value:b,onChange:s=>P(s.target.value),className:"pr-10 pl-10 text-left",dir:"ltr",placeholder:"****"}),e.jsx("button",{type:"button",onClick:()=>k(!m),className:"absolute left-3 top-2.5 text-gray-500 hover:text-gray-700",children:m?e.jsx(j,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(L,{type:"button",variant:"outline",onClick:d,children:"إلغاء"}),e.jsx(L,{type:"submit",disabled:E,className:"bg-purple-600 hover:bg-purple-700",children:E?"جاري الحفظ...":n?"تغيير الرقم السري":"تعيين الرقم السري"})]})]})]})})}export{U as ChangeCashPinDialog};
//# sourceMappingURL=ChangeCashPinDialog-CnO4S8x1.js.map
