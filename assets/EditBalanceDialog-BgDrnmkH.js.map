{"version":3,"file":"EditBalanceDialog-BgDrnmkH.js","sources":["../../src/components/EditBalanceDialog.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Lock, Eye, EyeOff, AlertCircle, DollarSign } from 'lucide-react';\nimport { MasterPinService } from '@/utils/masterPinService';\n\ninterface EditBalanceDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSuccess: (newAmount: number) => void;\n  title: string;\n  description: string;\n  currentBalance: number;\n  balanceLabel: string;\n  userId?: string;\n}\n\nexport function EditBalanceDialog({ \n  open, \n  onOpenChange, \n  onSuccess, \n  title, \n  description,\n  currentBalance,\n  balanceLabel,\n  userId\n}: EditBalanceDialogProps) {\n  const [pin, setPin] = useState('');\n  const [newAmount, setNewAmount] = useState(currentBalance.toString());\n  const [showPin, setShowPin] = useState(false);\n  const [error, setError] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n\n  // سيتم التحقق من وجود الرقم السري بشكل غير متزامن داخل الإرسال\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setIsLoading(true);\n\n    try {\n      // التحقق من صحة المبلغ\n      const amount = Math.round(parseFloat(newAmount)); // منع الكسور (القروش)\n      if (isNaN(amount) || amount < 0) {\n        setError('يرجى إدخال مبلغ صحيح');\n        setIsLoading(false);\n        return;\n      }\n\n      const hasSecretPin = await MasterPinService.hasMasterPin(userId);\n      if (hasSecretPin) {\n        // التحقق من الرقم السري الموجود\n        const isValid = await MasterPinService.verifyMasterPin(pin, userId);\n        if (isValid) {\n          onSuccess(amount);\n          onOpenChange(false);\n          setPin('');\n          setNewAmount('');\n        } else {\n          setError('الرقم السري غير صحيح');\n        }\n      } else {\n        setError('لم يتم تعيين رقم سري رئيسي. يرجى تعيين رقم سري رئيسي أولاً من إعدادات التطبيق');\n      }\n    } catch (error) {\n      setError('حدث خطأ أثناء التحقق من الرقم السري');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleClose = () => {\n    setPin('');\n    setNewAmount(currentBalance.toString());\n    setError('');\n    onOpenChange(false);\n  };\n\n  // تحديث المبلغ عند تغيير الرصيد الحالي\n  React.useEffect(() => {\n    if (open) {\n      setNewAmount(currentBalance.toString());\n    }\n  }, [currentBalance, open]);\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\n            <DollarSign className=\"h-5 w-5\" />\n            {title}\n          </DialogTitle>\n        </DialogHeader>\n        \n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"text-sm text-muted-foreground text-right\">\n            {description}\n          </div>\n\n          {/* عرض الرصيد الحالي */}\n          <div className=\"bg-gray-50 p-3 rounded-lg\">\n            <Label className=\"text-sm font-medium text-gray-700\">\n              {balanceLabel} الحالي\n            </Label>\n            <div className=\"text-lg font-bold text-gray-900 mt-1\">\n              {currentBalance.toLocaleString()} جنيه\n            </div>\n          </div>\n\n          {/* إدخال المبلغ الجديد */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"newAmount\" className=\"text-right\">\n              المبلغ الجديد\n            </Label>\n            <Input\n              id=\"newAmount\"\n              type=\"number\"\n              step=\"0.01\"\n              min=\"0\"\n              value={newAmount}\n              onChange={(e) => setNewAmount(e.target.value)}\n              placeholder=\"أدخل المبلغ الجديد\"\n              className=\"text-right\"\n              required\n            />\n          </div>\n\n          {/* إدخال الرقم السري */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"pin\" className=\"text-right\">\n              الرقم السري\n            </Label>\n            <div className=\"relative\">\n              <Input\n                id=\"pin\"\n                type={showPin ? 'text' : 'password'}\n                value={pin}\n                onChange={(e) => setPin(e.target.value)}\n                placeholder=\"أدخل الرقم السري\"\n                className=\"text-right pr-10\"\n                required\n              />\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                onClick={() => setShowPin(!showPin)}\n              >\n                {showPin ? (\n                  <EyeOff className=\"h-4 w-4\" />\n                ) : (\n                  <Eye className=\"h-4 w-4\" />\n                )}\n              </Button>\n            </div>\n          </div>\n\n          {error && (\n            <div className=\"flex items-center gap-2 text-sm text-red-600 bg-red-50 p-2 rounded\">\n              <AlertCircle className=\"h-4 w-4\" />\n              {error}\n            </div>\n          )}\n\n          <div className=\"flex gap-2 pt-4\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={handleClose}\n              className=\"flex-1\"\n            >\n              إلغاء\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={isLoading || !pin || !newAmount}\n              className=\"flex-1\"\n            >\n              {isLoading ? (\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                  جاري التحديث...\n                </div>\n              ) : (\n                <>\n                  <Lock className=\"h-4 w-4 mr-2\" />\n                  تحديث الرصيد\n                </>\n              )}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}"],"names":["EditBalanceDialog","open","onOpenChange","onSuccess","title","description","currentBalance","balanceLabel","userId","pin","setPin","useState","newAmount","setNewAmount","showPin","setShowPin","error","setError","isLoading","setIsLoading","handleSubmit","e","amount","MasterPinService","handleClose","React","jsx","Dialog","DialogContent","DialogHeader","jsxs","DialogTitle","DollarSign","Label","Input","Button","EyeOff","Eye","AlertCircle","Fragment","Lock"],"mappings":"oLAmBO,SAASA,EAAkB,CAChC,KAAAC,EACA,aAAAC,EACA,UAAAC,EACA,MAAAC,EACA,YAAAC,EACA,eAAAC,EACA,aAAAC,EACA,OAAAC,CACF,EAA2B,CACzB,KAAM,CAACC,EAAKC,CAAM,EAAIC,EAAAA,SAAS,EAAE,EAC3B,CAACC,EAAWC,CAAY,EAAIF,EAAAA,SAASL,EAAe,UAAU,EAC9D,CAACQ,EAASC,CAAU,EAAIJ,EAAAA,SAAS,EAAK,EACtC,CAACK,EAAOC,CAAQ,EAAIN,EAAAA,SAAS,EAAE,EAC/B,CAACO,EAAWC,CAAY,EAAIR,EAAAA,SAAS,EAAK,EAI1CS,EAAe,MAAOC,GAAuB,CACjDA,EAAE,eAAA,EACFJ,EAAS,EAAE,EACXE,EAAa,EAAI,EAEjB,GAAI,CAEF,MAAMG,EAAS,KAAK,MAAM,WAAWV,CAAS,CAAC,EAC/C,GAAI,MAAMU,CAAM,GAAKA,EAAS,EAAG,CAC/BL,EAAS,sBAAsB,EAC/BE,EAAa,EAAK,EAClB,MACF,CAEqB,MAAMI,EAAiB,aAAaf,CAAM,EAG7C,MAAMe,EAAiB,gBAAgBd,EAAKD,CAAM,GAEhEL,EAAUmB,CAAM,EAChBpB,EAAa,EAAK,EAClBQ,EAAO,EAAE,EACTG,EAAa,EAAE,GAEfI,EAAS,sBAAsB,EAGjCA,EAAS,+EAA+E,CAE5F,MAAgB,CACdA,EAAS,qCAAqC,CAChD,QAAA,CACEE,EAAa,EAAK,CACpB,CACF,EAEMK,EAAc,IAAM,CACxBd,EAAO,EAAE,EACTG,EAAaP,EAAe,UAAU,EACtCW,EAAS,EAAE,EACXf,EAAa,EAAK,CACpB,EAGA,OAAAuB,EAAM,UAAU,IAAM,CAChBxB,GACFY,EAAaP,EAAe,UAAU,CAE1C,EAAG,CAACA,EAAgBL,CAAI,CAAC,EAGvByB,EAAAA,IAACC,EAAA,CAAO,KAAA1B,EAAY,aAAcuB,EAChC,gBAACI,EAAA,CAAc,UAAU,cAAc,IAAI,MACzC,SAAA,CAAAF,MAACG,EAAA,CACC,SAAAC,EAAAA,KAACC,EAAA,CAAY,UAAU,qCACrB,SAAA,CAAAL,EAAAA,IAACM,EAAA,CAAW,UAAU,SAAA,CAAU,EAC/B5B,CAAA,CAAA,CACH,CAAA,CACF,EAEA0B,EAAAA,KAAC,OAAA,CAAK,SAAUV,EAAc,UAAU,YACtC,SAAA,CAAAM,EAAAA,IAAC,MAAA,CAAI,UAAU,2CACZ,SAAArB,EACH,EAGAyB,EAAAA,KAAC,MAAA,CAAI,UAAU,4BACb,SAAA,CAAAA,EAAAA,KAACG,EAAA,CAAM,UAAU,oCACd,SAAA,CAAA1B,EAAa,SAAA,EAChB,EACAuB,EAAAA,KAAC,MAAA,CAAI,UAAU,uCACZ,SAAA,CAAAxB,EAAe,eAAA,EAAiB,OAAA,CAAA,CACnC,CAAA,EACF,EAGAwB,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAJ,MAACO,EAAA,CAAM,QAAQ,YAAY,UAAU,aAAa,SAAA,gBAElD,EACAP,EAAAA,IAACQ,EAAA,CACC,GAAG,YACH,KAAK,SACL,KAAK,OACL,IAAI,IACJ,MAAOtB,EACP,SAAWS,GAAMR,EAAaQ,EAAE,OAAO,KAAK,EAC5C,YAAY,qBACZ,UAAU,aACV,SAAQ,EAAA,CAAA,CACV,EACF,EAGAS,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAJ,MAACO,EAAA,CAAM,QAAQ,MAAM,UAAU,aAAa,SAAA,cAE5C,EACAH,EAAAA,KAAC,MAAA,CAAI,UAAU,WACb,SAAA,CAAAJ,EAAAA,IAACQ,EAAA,CACC,GAAG,MACH,KAAMpB,EAAU,OAAS,WACzB,MAAOL,EACP,SAAWY,GAAMX,EAAOW,EAAE,OAAO,KAAK,EACtC,YAAY,mBACZ,UAAU,mBACV,SAAQ,EAAA,CAAA,EAEVK,EAAAA,IAACS,EAAA,CACC,KAAK,SACL,QAAQ,QACR,KAAK,KACL,UAAU,8DACV,QAAS,IAAMpB,EAAW,CAACD,CAAO,EAEjC,SAAAA,QACEsB,EAAA,CAAO,UAAU,UAAU,EAE5BV,EAAAA,IAACW,EAAA,CAAI,UAAU,SAAA,CAAU,CAAA,CAAA,CAE7B,CAAA,CACF,CAAA,EACF,EAECrB,GACCc,EAAAA,KAAC,MAAA,CAAI,UAAU,qEACb,SAAA,CAAAJ,EAAAA,IAACY,EAAA,CAAY,UAAU,SAAA,CAAU,EAChCtB,CAAA,EACH,EAGFc,EAAAA,KAAC,MAAA,CAAI,UAAU,kBACb,SAAA,CAAAJ,EAAAA,IAACS,EAAA,CACC,KAAK,SACL,QAAQ,UACR,QAASX,EACT,UAAU,SACX,SAAA,OAAA,CAAA,EAGDE,EAAAA,IAACS,EAAA,CACC,KAAK,SACL,SAAUjB,GAAa,CAACT,GAAO,CAACG,EAChC,UAAU,SAET,SAAAM,EACCY,OAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAJ,EAAAA,IAAC,MAAA,CAAI,UAAU,8EAAA,CAA+E,EAAE,iBAAA,CAAA,CAElG,EAEAI,EAAAA,KAAAS,EAAAA,SAAA,CACE,SAAA,CAAAb,EAAAA,IAACc,EAAA,CAAK,UAAU,cAAA,CAAe,EAAE,cAAA,CAAA,CAEnC,CAAA,CAAA,CAEJ,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,CAEJ"}