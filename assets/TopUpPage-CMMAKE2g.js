import{a as A,m as P,r as i,j as e,c as I,d as L,e as U,g as B,I as N,B as d,p as C}from"./index-CgV0sHeM.js";import{S as D,a as z,b as F,c as G,d as J}from"./select-Cjxh7T8L.js";const W=[{label:"Vodafone",value:"Vodafone"},{label:"Orange",value:"Orange"},{label:"Etisalat",value:"Etisalat"},{label:"WE",value:"WE"}],S=u=>{const a=u.replace(/\D/g,"");return a.length===10||a.length===11},R=()=>{const u=A(),{toast:a}=P(),[l,y]=i.useState(""),[w,q]=i.useState("EG"),[h,T]=i.useState("Vodafone"),[o,E]=i.useState(""),[c,x]=i.useState(!1),[k,m]=i.useState(!1),X=async t=>{if(t.preventDefault(),!S(l)){a({title:"رقم غير صالح",description:"من فضلك أدخل رقم مصري صحيح (10 أو 11 رقم)",variant:"destructive"});return}const n=Number(o);if(!Number.isFinite(n)||n<=0){a({title:"قيمة غير صالحة",description:"من فضلك أدخل مبلغ صحيح بالجنيه المصري",variant:"destructive"});return}m(!0)},O=async()=>{var p,g,b;m(!1);const t="alkaptin678678@gmail.com",n=(g=(p=C.currentUser)==null?void 0:p.email)==null?void 0:g.toLowerCase();if(!n||n!==t){a({title:"قيد الإنشاء",description:"ميزة الشحن متاحة لهذا الحساب فقط حالياً."});return}x(!0);try{const r=new AbortController,V=setTimeout(()=>r.abort(),15e3),j=await((b=C.currentUser)==null?void 0:b.getIdToken()),v=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...j?{Authorization:`Bearer ${j}`}:{}},body:JSON.stringify({phone:l,countryCode:w,operator:h,amount:Number(o),useLocalAmount:!0}),signal:r.signal});clearTimeout(V);const f=await v.text();let s;try{s=JSON.parse(f)}catch{s={success:!1,message:f||"فشل قراءة استجابة الخادم"}}v.ok&&(s!=null&&s.success)?a({title:"تم الشحن",description:(s==null?void 0:s.message)||"تم تنفيذ عملية الشحن بنجاح"}):a({title:"فشل الشحن",description:(s==null?void 0:s.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(r){console.error("Topup request error:",r),(r==null?void 0:r.name)==="AbortError"?a({title:"انتهت المهلة",description:"الخادم لم يستجب في الوقت المحدد. تأكد أن السيرفر يعمل.",variant:"destructive"}):a({title:"خطأ في الاتصال",description:"تعذر الاتصال بالخادم. حاول لاحقاً.",variant:"destructive"})}finally{x(!1)}};return e.jsxs("div",{className:"min-h-screen p-4",children:[e.jsxs(I,{className:"max-w-md mx-auto",children:[e.jsx(L,{children:e.jsx(U,{className:"text-right",children:"شحن رصيد الموبايل"})}),e.jsx(B,{children:e.jsxs("form",{onSubmit:X,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-right mb-1",children:"رقم الموبايل"}),e.jsx(N,{value:l,onChange:t=>y(t.target.value),placeholder:"01XXXXXXXXX",dir:"ltr"}),!S(l)&&l.length>0&&e.jsx("p",{className:"text-xs text-red-600 mt-1 text-right",children:"رقم غير صالح (10 أو 11 رقم)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-right mb-1",children:"الشركة"}),e.jsxs(D,{value:h,onValueChange:T,children:[e.jsx(z,{className:"w-full",children:e.jsx(F,{placeholder:"اختر الشركة"})}),e.jsx(G,{children:W.map(t=>e.jsx(J,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-right mb-1",children:"المبلغ بالجنيه (EGP)"}),e.jsx(N,{type:"number",inputMode:"decimal",value:o,onChange:t=>E(t.target.value),placeholder:"مثال: 10",dir:"ltr"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>u(-1),children:"رجوع"}),e.jsx(d,{type:"submit",disabled:c,children:c?"جارٍ التنفيذ...":"شحن"})]})]})})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-[90%] max-w-md",children:[e.jsx("h2",{className:"text-lg font-semibold text-right mb-2",children:"تأكيد العملية"}),e.jsxs("p",{className:"text-right mb-4",children:["هتشحن رقم ",l," مبلغ ",Number(o).toLocaleString("en-US",{maximumFractionDigits:0})," جنيه — تأكيد؟"]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(d,{variant:"outline",onClick:()=>m(!1),children:"إلغاء"}),e.jsx(d,{onClick:O,disabled:c,children:c?"جارٍ التنفيذ...":"تأكيد"})]})]})})]})};export{R as default};
//# sourceMappingURL=TopUpPage-CMMAKE2g.js.map
