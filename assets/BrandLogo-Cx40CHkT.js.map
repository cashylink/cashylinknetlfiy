{"version":3,"file":"BrandLogo-Cx40CHkT.js","sources":["../../src/utils/brandingService.ts","../../src/components/BrandLogo.tsx"],"sourcesContent":["import { db, storage } from '../firebase';\r\nimport { doc, getDoc, setDoc, updateDoc } from 'firebase/firestore';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\n\r\nexport interface BrandingConfig {\r\n  logoUrl?: string;\r\n  updatedAt?: number;\r\n}\r\n\r\nconst BRANDING_DOC = doc(db, 'siteContent', 'branding');\r\n\r\nexport async function getBrandingConfig(): Promise<BrandingConfig> {\r\n  try {\r\n    const snap = await getDoc(BRANDING_DOC);\r\n    if (!snap.exists()) return {};\r\n    return (snap.data() as BrandingConfig) || {};\r\n  } catch (e: any) {\r\n    // بعض الصفحات العامة قد لا تمتلك صلاحية قراءة وثيقة العلامة التجارية حسب القواعد\r\n    // نتعامل بالرقة ونعيد قيمة افتراضية بدون كسر الواجهة\r\n    if (e && typeof e === 'object' && (e.code === 'permission-denied' || e.message?.includes('Missing or insufficient permissions'))) {\r\n      console.warn('brandingService: read branding config denied for public page');\r\n      return {};\r\n    }\r\n    console.warn('brandingService: failed to read branding config', e);\r\n    return {};\r\n  }\r\n}\r\n\r\nexport async function setBrandingConfig(config: BrandingConfig): Promise<void> {\r\n  const payload: BrandingConfig = {\r\n    ...config,\r\n    updatedAt: Date.now(),\r\n  };\r\n  await setDoc(BRANDING_DOC, payload, { merge: true });\r\n}\r\n\r\nexport async function uploadLogoAndSave(file: File): Promise<string> {\r\n  const path = `branding/logo_${Date.now()}_${file.name}`;\r\n  const storageRef = ref(storage, path);\r\n  await uploadBytes(storageRef, file);\r\n  const url = await getDownloadURL(storageRef);\r\n  await setBrandingConfig({ logoUrl: url });\r\n  return url;\r\n}\r\n\r\nexport async function getLogoUrl(): Promise<string | undefined> {\r\n  const config = await getBrandingConfig();\r\n  return config.logoUrl;\r\n}","import React from 'react';\r\nimport { Smartphone } from 'lucide-react';\r\nimport { getLogoUrl } from '../utils/brandingService';\r\n\r\ntype Props = {\r\n  size?: number;\r\n  className?: string;\r\n  rounded?: boolean;\r\n};\r\n\r\nexport default function BrandLogo({ size = 32, className = '', rounded = true }: Props) {\r\n  const [url, setUrl] = React.useState<string | undefined>();\r\n  const [loading, setLoading] = React.useState(true);\r\n\r\n  React.useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n      try {\r\n        const u = await getLogoUrl();\r\n        if (mounted) setUrl(u);\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    })();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, []);\r\n\r\n  const style = {\r\n    width: size,\r\n    height: size,\r\n  } as React.CSSProperties;\r\n\r\n  if (!url) {\r\n    return (\r\n      <div\r\n        className={`${rounded ? 'rounded-md' : ''} bg-blue-600 flex items-center justify-center ${className}`}\r\n        style={style}\r\n      >\r\n        <Smartphone className=\"text-white\" size={Math.max(16, size - 12)} />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <img\r\n      src={url}\r\n      alt=\"Brand Logo\"\r\n      className={`${rounded ? 'rounded-md' : ''} ${className}`}\r\n      style={style}\r\n    />\r\n  );\r\n}"],"names":["BRANDING_DOC","doc","db","getBrandingConfig","snap","getDoc","_a","getLogoUrl","BrandLogo","size","className","rounded","url","setUrl","React","loading","setLoading","mounted","u","style","jsx","Smartphone"],"mappings":"iHASA,MAAMA,EAAeC,EAAIC,EAAI,cAAe,UAAU,EAEtD,eAAsBC,GAA6C,OACjE,GAAI,CACF,MAAMC,EAAO,MAAMC,EAAOL,CAAY,EACtC,OAAKI,EAAK,OAAA,EACFA,EAAK,KAAA,GAA6B,CAAA,EADf,CAAA,CAE7B,OAAS,EAAQ,CAGf,OAAI,GAAK,OAAO,GAAM,WAAa,EAAE,OAAS,sBAAuBE,EAAA,EAAE,UAAF,MAAAA,EAAW,SAAS,yCACvF,QAAQ,KAAK,8DAA8D,EACpE,CAAA,IAET,QAAQ,KAAK,kDAAmD,CAAC,EAC1D,CAAA,EACT,CACF,CAmBA,eAAsBC,GAA0C,CAE9D,OADe,MAAMJ,EAAA,GACP,OAChB,CCtCA,SAAwBK,EAAU,CAAE,KAAAC,EAAO,GAAI,UAAAC,EAAY,GAAI,QAAAC,EAAU,IAAe,CACtF,KAAM,CAACC,EAAKC,CAAM,EAAIC,EAAM,SAAA,EACtB,CAACC,EAASC,CAAU,EAAIF,EAAM,SAAS,EAAI,EAEjDA,EAAM,UAAU,IAAM,CACpB,IAAIG,EAAU,GACd,OAAC,SAAY,CACX,GAAI,CACF,MAAMC,EAAI,MAAMX,EAAA,EACZU,KAAgBC,CAAC,CACvB,QAAA,CACMD,KAAoB,EAAK,CAC/B,CACF,GAAA,EACO,IAAM,CACXA,EAAU,EACZ,CACF,EAAG,CAAA,CAAE,EAEL,MAAME,EAAQ,CACZ,MAAOV,EACP,OAAQA,CAAA,EAGV,OAAKG,EAYHQ,EAAAA,IAAC,MAAA,CACC,IAAKR,EACL,IAAI,aACJ,UAAW,GAAGD,EAAU,aAAe,EAAE,IAAID,CAAS,GACtD,MAAAS,CAAA,CAAA,EAdAC,EAAAA,IAAC,MAAA,CACC,UAAW,GAAGT,EAAU,aAAe,EAAE,iDAAiDD,CAAS,GACnG,MAAAS,EAEA,SAAAC,EAAAA,IAACC,EAAA,CAAW,UAAU,aAAa,KAAM,KAAK,IAAI,GAAIZ,EAAO,EAAE,CAAA,CAAG,CAAA,CAAA,CAa1E"}