{"version":3,"mappings":"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","names":["ROOT_NAME","createAlertDialogContext","createContextScope","createDialogScope","useDialogScope","AlertDialog","props","__scopeAlertDialog","alertDialogProps","dialogScope","jsx","DialogPrimitive.Root","TRIGGER_NAME","AlertDialogTrigger","React.forwardRef","forwardedRef","triggerProps","DialogPrimitive.Trigger","PORTAL_NAME","AlertDialogPortal","portalProps","DialogPrimitive.Portal","OVERLAY_NAME","AlertDialogOverlay","overlayProps","DialogPrimitive.Overlay","CONTENT_NAME","AlertDialogContentProvider","useAlertDialogContentContext","Slottable","createSlottable","AlertDialogContent","children","contentProps","contentRef","React.useRef","composedRefs","useComposedRefs","cancelRef","DialogPrimitive.WarningProvider","TITLE_NAME","jsxs","DialogPrimitive.Content","composeEventHandlers","event","_a","DescriptionWarning","AlertDialogTitle","titleProps","DialogPrimitive.Title","DESCRIPTION_NAME","AlertDialogDescription","descriptionProps","DialogPrimitive.Description","ACTION_NAME","AlertDialogAction","actionProps","DialogPrimitive.Close","CANCEL_NAME","AlertDialogCancel","cancelProps","ref","MESSAGE","React.useEffect","Root2","Portal2","Overlay2","Content2","Action","Cancel","Title2","Description2","AlertDialogPrimitive.Root","AlertDialogPrimitive.Portal","className","AlertDialogPrimitive.Overlay","cn","AlertDialogPrimitive.Content","AlertDialogHeader","AlertDialogPrimitive.Title","AlertDialogPrimitive.Description","AlertDialogPrimitive.Action","buttonVariants","AlertDialogPrimitive.Cancel","formatNumber","formatDateTime","iso","STORAGE_KEY_OPENING","STORAGE_KEY_OPENING_SNAPSHOT","MachineDailyDialog","open","onOpenChange","toast","useToast","shiftUser","useShift","shopId","shopName","useShop","getFallbackShopId","keys","k","v","useEffect","prev","openingBase","setOpeningBase","useState","openingAir","setOpeningAir","drawerCash","setDrawerCash","savedOpeningBase","setSavedOpeningBase","savedOpeningAir","setSavedOpeningAir","savedDrawerCash","setSavedDrawerCash","openingSnapshot","setOpeningSnapshot","isOpeningOpen","setIsOpeningOpen","isDeliverySectionOpen","setIsDeliverySectionOpen","deliveryBase","setDeliveryBase","deliveryAir","setDeliveryAir","netResult","setNetResult","receipts","setReceipts","transferReceipts","setTransferReceipts","transferDialogOpen","setTransferDialogOpen","wholesalePrice","setWholesalePrice","retailPrice","setRetailPrice","deductDialogOpen","setDeductDialogOpen","pendingTransfer","setPendingTransfer","machines","setMachines","selectedMachineId","setSelectedMachineId","newMachineName","setNewMachineName","transferServerHydrated","setTransferServerHydrated","deliveriesServerHydrated","setDeliveriesServerHydrated","keyOpening","keySnap","savedOpening","obj","savedSnap","snap","sid","getDocs","__vitePreload","getDocs2","col","collection","db","list","query","d","savedId","m","err","cashierName","useMemo","totalTransferProfit","sum","t","totalWholesaleTransferred","handleClearTransferReceipts","deleteDoc","handleClearMachineReceipts","handleDeleteMachineReceipt","id","r","handleResetOpening","handleAddOpening","base","air","dc","sid0","doc","setDoc","serverTimestamp","handleStartDelivery","handleDoDelivery","dBase","dAir","openingBaseForReceipt","openingAirForReceipt","openingSum","result","receipt","sid1","addDoc","key","current","arr","next","handleTransferConfirm","w","profit","finalizeTransfer","from","stockDeductAmount","prevBase","prevAir","prevDrawer","newBase","newAir","totalDrawerAdded","newDrawer","sid2","machineRef","sidKey","resetDialogState","refreshMachineData","sorted","x","created","_b","a","b","e","ded","keyDel","cachedDel","parsed","keyTrans","cachedTrans","handleClose","nextOpen","Dialog","DialogContent","DialogHeader","DialogTitle","FawryMachineIcon","DialogDescription","Card","CardHeader","CardTitle","Button","baseRef","transSnap","delSnap","Trash2","CardContent","Select","sidSel","SelectTrigger","SelectValue","SelectContent","SelectItem","Input","name","ChevronDown","Badge","Receipt","Calendar","Fragment","Separator","DialogFooter","Clock"],"ignoreList":[0],"sources":["../../node_modules/@radix-ui/react-alert-dialog/dist/index.mjs","../../src/components/ui/alert-dialog.tsx","../../src/components/MachineDailyDialog.tsx"],"sourcesContent":["\"use client\";\n\n// src/alert-dialog.tsx\nimport * as React from \"react\";\nimport { createContextScope } from \"@radix-ui/react-context\";\nimport { useComposedRefs } from \"@radix-ui/react-compose-refs\";\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\";\nimport { createDialogScope } from \"@radix-ui/react-dialog\";\nimport { composeEventHandlers } from \"@radix-ui/primitive\";\nimport { createSlottable } from \"@radix-ui/react-slot\";\nimport { jsx, jsxs } from \"react/jsx-runtime\";\nvar ROOT_NAME = \"AlertDialog\";\nvar [createAlertDialogContext, createAlertDialogScope] = createContextScope(ROOT_NAME, [\n  createDialogScope\n]);\nvar useDialogScope = createDialogScope();\nvar AlertDialog = (props) => {\n  const { __scopeAlertDialog, ...alertDialogProps } = props;\n  const dialogScope = useDialogScope(__scopeAlertDialog);\n  return /* @__PURE__ */ jsx(DialogPrimitive.Root, { ...dialogScope, ...alertDialogProps, modal: true });\n};\nAlertDialog.displayName = ROOT_NAME;\nvar TRIGGER_NAME = \"AlertDialogTrigger\";\nvar AlertDialogTrigger = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...triggerProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Trigger, { ...dialogScope, ...triggerProps, ref: forwardedRef });\n  }\n);\nAlertDialogTrigger.displayName = TRIGGER_NAME;\nvar PORTAL_NAME = \"AlertDialogPortal\";\nvar AlertDialogPortal = (props) => {\n  const { __scopeAlertDialog, ...portalProps } = props;\n  const dialogScope = useDialogScope(__scopeAlertDialog);\n  return /* @__PURE__ */ jsx(DialogPrimitive.Portal, { ...dialogScope, ...portalProps });\n};\nAlertDialogPortal.displayName = PORTAL_NAME;\nvar OVERLAY_NAME = \"AlertDialogOverlay\";\nvar AlertDialogOverlay = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...overlayProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Overlay, { ...dialogScope, ...overlayProps, ref: forwardedRef });\n  }\n);\nAlertDialogOverlay.displayName = OVERLAY_NAME;\nvar CONTENT_NAME = \"AlertDialogContent\";\nvar [AlertDialogContentProvider, useAlertDialogContentContext] = createAlertDialogContext(CONTENT_NAME);\nvar Slottable = createSlottable(\"AlertDialogContent\");\nvar AlertDialogContent = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, children, ...contentProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    const contentRef = React.useRef(null);\n    const composedRefs = useComposedRefs(forwardedRef, contentRef);\n    const cancelRef = React.useRef(null);\n    return /* @__PURE__ */ jsx(\n      DialogPrimitive.WarningProvider,\n      {\n        contentName: CONTENT_NAME,\n        titleName: TITLE_NAME,\n        docsSlug: \"alert-dialog\",\n        children: /* @__PURE__ */ jsx(AlertDialogContentProvider, { scope: __scopeAlertDialog, cancelRef, children: /* @__PURE__ */ jsxs(\n          DialogPrimitive.Content,\n          {\n            role: \"alertdialog\",\n            ...dialogScope,\n            ...contentProps,\n            ref: composedRefs,\n            onOpenAutoFocus: composeEventHandlers(contentProps.onOpenAutoFocus, (event) => {\n              event.preventDefault();\n              cancelRef.current?.focus({ preventScroll: true });\n            }),\n            onPointerDownOutside: (event) => event.preventDefault(),\n            onInteractOutside: (event) => event.preventDefault(),\n            children: [\n              /* @__PURE__ */ jsx(Slottable, { children }),\n              /* @__PURE__ */ jsx(DescriptionWarning, { contentRef })\n            ]\n          }\n        ) })\n      }\n    );\n  }\n);\nAlertDialogContent.displayName = CONTENT_NAME;\nvar TITLE_NAME = \"AlertDialogTitle\";\nvar AlertDialogTitle = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...titleProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Title, { ...dialogScope, ...titleProps, ref: forwardedRef });\n  }\n);\nAlertDialogTitle.displayName = TITLE_NAME;\nvar DESCRIPTION_NAME = \"AlertDialogDescription\";\nvar AlertDialogDescription = React.forwardRef((props, forwardedRef) => {\n  const { __scopeAlertDialog, ...descriptionProps } = props;\n  const dialogScope = useDialogScope(__scopeAlertDialog);\n  return /* @__PURE__ */ jsx(DialogPrimitive.Description, { ...dialogScope, ...descriptionProps, ref: forwardedRef });\n});\nAlertDialogDescription.displayName = DESCRIPTION_NAME;\nvar ACTION_NAME = \"AlertDialogAction\";\nvar AlertDialogAction = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...actionProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Close, { ...dialogScope, ...actionProps, ref: forwardedRef });\n  }\n);\nAlertDialogAction.displayName = ACTION_NAME;\nvar CANCEL_NAME = \"AlertDialogCancel\";\nvar AlertDialogCancel = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...cancelProps } = props;\n    const { cancelRef } = useAlertDialogContentContext(CANCEL_NAME, __scopeAlertDialog);\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    const ref = useComposedRefs(forwardedRef, cancelRef);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Close, { ...dialogScope, ...cancelProps, ref });\n  }\n);\nAlertDialogCancel.displayName = CANCEL_NAME;\nvar DescriptionWarning = ({ contentRef }) => {\n  const MESSAGE = `\\`${CONTENT_NAME}\\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \\`${CONTENT_NAME}\\` by passing a \\`${DESCRIPTION_NAME}\\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \\`id\\` and passing the same value to the \\`aria-describedby\\` prop in \\`${CONTENT_NAME}\\`. If the description is confusing or duplicative for sighted users, you can use the \\`@radix-ui/react-visually-hidden\\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;\n  React.useEffect(() => {\n    const hasDescription = document.getElementById(\n      contentRef.current?.getAttribute(\"aria-describedby\")\n    );\n    if (!hasDescription) console.warn(MESSAGE);\n  }, [MESSAGE, contentRef]);\n  return null;\n};\nvar Root2 = AlertDialog;\nvar Trigger2 = AlertDialogTrigger;\nvar Portal2 = AlertDialogPortal;\nvar Overlay2 = AlertDialogOverlay;\nvar Content2 = AlertDialogContent;\nvar Action = AlertDialogAction;\nvar Cancel = AlertDialogCancel;\nvar Title2 = AlertDialogTitle;\nvar Description2 = AlertDialogDescription;\nexport {\n  Action,\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogOverlay,\n  AlertDialogPortal,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n  Cancel,\n  Content2 as Content,\n  Description2 as Description,\n  Overlay2 as Overlay,\n  Portal2 as Portal,\n  Root2 as Root,\n  Title2 as Title,\n  Trigger2 as Trigger,\n  createAlertDialogScope\n};\n//# sourceMappingURL=index.mjs.map\n","import * as React from \"react\"\r\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\nimport { buttonVariants } from \"@/components/ui/button\"\r\n\r\nconst AlertDialog = AlertDialogPrimitive.Root\r\n\r\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\r\n\r\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\r\n\r\nconst AlertDialogOverlay = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Overlay\r\n    className={cn(\r\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\r\n      className\r\n    )}\r\n    {...props}\r\n    ref={ref}\r\n  />\r\n))\r\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\r\n\r\nconst AlertDialogContent = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPortal>\r\n    <AlertDialogOverlay />\r\n    <AlertDialogPrimitive.Content\r\n      ref={ref}\r\n      className={cn(\r\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg rounded-2xl duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  </AlertDialogPortal>\r\n))\r\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\r\n\r\nconst AlertDialogHeader = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) => (\r\n  <div\r\n    className={cn(\r\n      \"flex flex-col space-y-2 text-center sm:text-left\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n)\r\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\r\n\r\nconst AlertDialogFooter = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) => (\r\n  <div\r\n    className={cn(\r\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n)\r\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\r\n\r\nconst AlertDialogTitle = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Title\r\n    ref={ref}\r\n    className={cn(\"text-lg font-semibold\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\r\n\r\nconst AlertDialogDescription = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Description\r\n    ref={ref}\r\n    className={cn(\"text-sm text-muted-foreground\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogDescription.displayName =\r\n  AlertDialogPrimitive.Description.displayName\r\n\r\nconst AlertDialogAction = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Action\r\n    ref={ref}\r\n    className={cn(buttonVariants(), className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\r\n\r\nconst AlertDialogCancel = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Cancel\r\n    ref={ref}\r\n    className={cn(\r\n      buttonVariants({ variant: \"outline\" }),\r\n      \"mt-2 sm:mt-0\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\r\n\r\nexport {\r\n  AlertDialog,\r\n  AlertDialogPortal,\r\n  AlertDialogOverlay,\r\n  AlertDialogTrigger,\r\n  AlertDialogContent,\r\n  AlertDialogHeader,\r\n  AlertDialogFooter,\r\n  AlertDialogTitle,\r\n  AlertDialogDescription,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n}\r\n","import React, { useEffect, useMemo, useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from '@/components/ui/dialog';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { Receipt, Calendar, Clock, ChevronDown, Trash2, RefreshCcw } from 'lucide-react';\r\nimport FawryMachineIcon from '@/components/icons/FawryMachineIcon';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useShift } from '@/contexts/ShiftContext';\r\nimport { AlertDialog, AlertDialogContent, AlertDialogHeader, AlertDialogTitle, AlertDialogDescription, AlertDialogAction, AlertDialogCancel } from '@/components/ui/alert-dialog';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { db } from '@/firebase';\r\nimport { addDoc, collection, doc, setDoc, serverTimestamp, deleteDoc, getDocs, orderBy, query } from 'firebase/firestore';\r\nimport { useShop } from '@/hooks/useShop';\r\n\r\ninterface MachineDailyDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\ninterface MachineReceipt {\r\n  id: string;\r\n  openingBase: number; // الرصيد الأساسي الافتتاحي\r\n  openingAir: number;  // رصيد الهواء الافتتاحي\r\n  deliveryBase: number; // الرصيد الأساسي عند التسليم\r\n  deliveryAir: number;  // رصيد الهواء عند التسليم\r\n  netResult: number;    // الناتج النهائي: (تسليم) - (افتتاحي)\r\n  createdAt: string;    // التاريخ والوقت\r\n  cashierName?: string; // اسم الكاشير إن وجد\r\n  requiredDrawerNoProfit?: number; // المطلوب من الدرج بدون أرباح\r\n}\r\n\r\ninterface TransferReceipt {\r\n  id: string;\r\n  wholesalePrice: number; // سعر الجملة للرصيد المحوّل\r\n  retailPrice: number;    // سعر التجزئة للرصيد المحوّل\r\n  profit: number;         // الربح الفوري: التجزئة - الجملة\r\n  createdAt: string;\r\n  cashierName?: string;\r\n  deductFrom?: 'base' | 'air'; // مصدر الخصم: الأساسي أو الهواء\r\n}\r\n\r\nconst formatNumber = (n: number) => {\r\n  try { return n.toLocaleString('en-US', { maximumFractionDigits: 2 }); } catch { return String(n); }\r\n};\r\n\r\nconst formatDateTime = (iso?: string) => {\r\n  try {\r\n    const d = iso ? new Date(iso) : new Date();\r\n    return d.toLocaleString('en-GB', {\r\n      year: 'numeric', month: '2-digit', day: '2-digit',\r\n      hour: '2-digit', minute: '2-digit', second: '2-digit',\r\n      hour12: false,\r\n    });\r\n  } catch {\r\n    return new Date().toISOString();\r\n  }\r\n};\r\n\r\n// مفاتيح التخزين المحلي للحفاظ على القيم أثناء فتح النافذة\r\nconst STORAGE_KEY_OPENING = 'machine_daily_opening_values';\r\nconst STORAGE_KEY_OPENING_SNAPSHOT = 'machine_daily_opening_snapshot';\r\n\r\nexport default function MachineDailyDialog({ open, onOpenChange }: MachineDailyDialogProps) {\r\n  const { toast } = useToast();\r\n  const { shiftUser } = useShift();\r\n  const { shopId, shopName } = useShop();\r\n  const getFallbackShopId = () => {\r\n    try {\r\n      const keys = Object.keys(localStorage || {}).filter(k => k.startsWith('selectedShopId_'));\r\n      for (const k of keys) {\r\n        const v = localStorage.getItem(k);\r\n        if (v) return v;\r\n      }\r\n      return null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // منع تمرير الصفحة عند فتح نافذة اليومية وإعادة الحالة عند الإغلاق\r\n  useEffect(() => {\r\n    try {\r\n      if (open) {\r\n        const prev = document.body.style.overflow;\r\n        document.body.setAttribute('data-prev-overflow', prev);\r\n        document.body.style.overflow = 'hidden';\r\n      } else {\r\n        const prev = document.body.getAttribute('data-prev-overflow') || '';\r\n        document.body.style.overflow = prev;\r\n        document.body.removeAttribute('data-prev-overflow');\r\n      }\r\n    } catch {}\r\n    return () => {\r\n      try {\r\n        const prev = document.body.getAttribute('data-prev-overflow') || '';\r\n        document.body.style.overflow = prev;\r\n        document.body.removeAttribute('data-prev-overflow');\r\n      } catch {}\r\n    };\r\n  }, [open]);\r\n\r\n  // إدخالات الرصيد الافتتاحي\r\n  const [openingBase, setOpeningBase] = useState<string>('');\r\n  const [openingAir, setOpeningAir] = useState<string>('');\r\n  const [drawerCash, setDrawerCash] = useState<string>('');\r\n\r\n  // القيم المسجلة للرصيد الافتتاحي\r\n  const [savedOpeningBase, setSavedOpeningBase] = useState<number | null>(null);\r\n  const [savedOpeningAir, setSavedOpeningAir] = useState<number | null>(null);\r\n  const [savedDrawerCash, setSavedDrawerCash] = useState<number | null>(null);\r\n  const [openingSnapshot, setOpeningSnapshot] = useState<{ openingBase: number; openingAir: number; drawerCash: number } | null>(null);\r\n\r\n  // طي/توسيع قسم الرصيد الافتتاحي\r\n  const [isOpeningOpen, setIsOpeningOpen] = useState(false);\r\n\r\n  // قسم التسليم اليومي\r\n  const [isDeliverySectionOpen, setIsDeliverySectionOpen] = useState(false);\r\n  const [deliveryBase, setDeliveryBase] = useState<string>('');\r\n  const [deliveryAir, setDeliveryAir] = useState<string>('');\r\n  const [netResult, setNetResult] = useState<number | null>(null);\r\n\r\n  // إيصالات داخل النافذة (بدون تخزين محلي)\r\n  const [receipts, setReceipts] = useState<MachineReceipt[]>([]);\r\n\r\n  // إيصالات تحويل الرصيد (بدون تخزين محلي)\r\n  const [transferReceipts, setTransferReceipts] = useState<TransferReceipt[]>([]);\r\n\r\n  // حالة نافذة التحويل وأسعار الجملة/التجزئة\r\n  const [transferDialogOpen, setTransferDialogOpen] = useState(false);\r\n  const [wholesalePrice, setWholesalePrice] = useState<string>('');\r\n  const [retailPrice, setRetailPrice] = useState<string>('');\r\n\r\n  // نافذة اختيار الخصم بعد إدخال الأسعار\r\n  const [deductDialogOpen, setDeductDialogOpen] = useState(false);\r\n  const [pendingTransfer, setPendingTransfer] = useState<{\r\n    wholesalePrice: number;\r\n    retailPrice: number;\r\n    profit: number;\r\n  } | null>(null);\r\n\r\n  // إدارة الماكينات (اختيار/إنشاء)\r\n  const [machines, setMachines] = useState<{ id: string; name: string }[]>([]);\r\n  const [selectedMachineId, setSelectedMachineId] = useState<string | null>(null);\r\n  const [newMachineName, setNewMachineName] = useState<string>('');\r\n  const [transferServerHydrated, setTransferServerHydrated] = useState(false);\r\n  const [deliveriesServerHydrated, setDeliveriesServerHydrated] = useState(false);\r\n\r\n  // Hydrate per-machine opening values when dialog opens or machine changes\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    try {\r\n      const keyOpening = selectedMachineId ? `${STORAGE_KEY_OPENING}_${selectedMachineId}` : STORAGE_KEY_OPENING;\r\n      const keySnap = selectedMachineId ? `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}` : STORAGE_KEY_OPENING_SNAPSHOT;\r\n      const savedOpening = localStorage.getItem(keyOpening);\r\n      if (savedOpening) {\r\n        const obj = JSON.parse(savedOpening);\r\n        if (typeof obj?.openingBase === 'number') setSavedOpeningBase(obj.openingBase);\r\n        if (typeof obj?.openingAir === 'number') setSavedOpeningAir(obj.openingAir);\r\n        if (typeof obj?.drawerCash === 'number') setSavedDrawerCash(obj.drawerCash);\r\n      } else {\r\n        setSavedOpeningBase(null);\r\n        setSavedOpeningAir(null);\r\n        setSavedDrawerCash(null);\r\n      }\r\n\r\n      const savedSnap = localStorage.getItem(keySnap);\r\n      if (savedSnap) {\r\n        const snap = JSON.parse(savedSnap);\r\n        if (typeof snap?.openingBase === 'number' && typeof snap?.openingAir === 'number') {\r\n          setOpeningSnapshot({ openingBase: snap.openingBase, openingAir: snap.openingAir, drawerCash: snap.drawerCash || 0 });\r\n        } else {\r\n          setOpeningSnapshot(null);\r\n        }\r\n      } else {\r\n        setOpeningSnapshot(null);\r\n      }\r\n    } catch {}\r\n  }, [open, selectedMachineId]);\r\n\r\n  // تحميل قائمة الماكينات عند فتح النافذة\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const sid = shopId || getFallbackShopId();\r\n        if (!open || !sid) return;\r\n        const { getDocs } = await import('firebase/firestore');\r\n        const col = collection(db, 'shops', sid, 'machines');\r\n        const snap = await getDocs(query(col));\r\n        const list = snap.docs.map(d => ({ id: d.id, name: String(d.data().name || 'ماكينة') }));\r\n        setMachines(list);\r\n        try {\r\n          const savedId = localStorage.getItem(`machineDaily_selected_${sid}`);\r\n          const exists = savedId && list.some(m => m.id === savedId);\r\n          if (exists) {\r\n            setSelectedMachineId(savedId as string);\r\n          } else if (!selectedMachineId && list.length > 0) {\r\n            setSelectedMachineId(list[0].id);\r\n            localStorage.setItem(`machineDaily_selected_${sid}`, list[0].id);\r\n          }\r\n        } catch {}\r\n      } catch (err) {\r\n        console.error('Load machines error:', err);\r\n      }\r\n    })();\r\n  }, [open, shopId]);\r\n\r\n  // تم إلغاء مزامنة الإيصالات إلى التخزين المحلي\r\n\r\n  const cashierName = useMemo(() => {\r\n    return shiftUser?.displayName || shiftUser?.name || shiftUser?.username || undefined;\r\n  }, [shiftUser]);\r\n\r\n  const totalTransferProfit = useMemo(() => transferReceipts.reduce((sum, t) => sum + (t.profit || 0), 0), [transferReceipts]);\r\n  const totalWholesaleTransferred = useMemo(() => transferReceipts.reduce((sum, t) => sum + (t.wholesalePrice || 0), 0), [transferReceipts]);\r\n\r\n  const handleClearTransferReceipts = async () => {\r\n    try {\r\n      const sid = shopId || getFallbackShopId();\r\n      if (sid && selectedMachineId) {\r\n        const col = collection(db, 'shops', sid, 'machines', selectedMachineId, 'transfers');\r\n        const snap = await getDocs(query(col));\r\n        await Promise.all(snap.docs.map(d => deleteDoc(d.ref)));\r\n        try { localStorage.setItem(`machineDaily_transfers_${sid}_${selectedMachineId}`, JSON.stringify([])); } catch {}\r\n      }\r\n    } catch {}\r\n    setTransferReceipts([]);\r\n    toast({ title: 'تم حذف الإيصالات', description: 'تم مسح كل إيصالات التحويل.' });\r\n  };\r\n\r\n  const handleClearMachineReceipts = async () => {\r\n    try {\r\n      const sid = shopId || getFallbackShopId();\r\n      if (sid && selectedMachineId) {\r\n        const col = collection(db, 'shops', sid, 'machines', selectedMachineId, 'deliveries');\r\n        const snap = await getDocs(query(col));\r\n        await Promise.all(snap.docs.map(d => deleteDoc(d.ref)));\r\n        try { localStorage.setItem(`machineDaily_deliveries_${sid}_${selectedMachineId}`, JSON.stringify([])); } catch {}\r\n      }\r\n    } catch {}\r\n    setReceipts([]);\r\n    toast({ title: 'تم حذف الإيصالات', description: 'تم مسح كل إيصالات الماكينة.' });\r\n  };\r\n\r\n  const handleDeleteMachineReceipt = (id: string) => {\r\n    setReceipts(prev => prev.filter(r => r.id !== id));\r\n    toast({ title: 'تم حذف الإيصال', description: 'تم إزالة إيصال الماكينة المحدد.' });\r\n  };\r\n\r\n  // زر تصفير الرصيد الافتتاحي لتغييره\r\n  const handleResetOpening = () => {\r\n    setSavedOpeningBase(null);\r\n    setSavedOpeningAir(null);\r\n    setSavedDrawerCash(null);\r\n    setOpeningSnapshot(null);\r\n  \r\n    setOpeningBase('');\r\n    setOpeningAir('');\r\n    setDrawerCash('');\r\n  \r\n    try {\r\n      const keyOpening = selectedMachineId ? `${STORAGE_KEY_OPENING}_${selectedMachineId}` : STORAGE_KEY_OPENING;\r\n      const keySnap = selectedMachineId ? `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}` : STORAGE_KEY_OPENING_SNAPSHOT;\r\n      localStorage.removeItem(keyOpening);\r\n      localStorage.removeItem(keySnap);\r\n    } catch {}\r\n  \r\n    toast({ title: 'تم التصفير', description: 'يمكنك الآن إدخال رصيد افتتاحي جديد.' });\r\n  };\r\n  const handleAddOpening = async () => {\r\n    const base = parseFloat(openingBase || '0');\r\n    const air = parseFloat(openingAir || '0');\r\n    const dc = parseFloat(drawerCash || '0');\r\n\r\n    if (isNaN(base) || isNaN(air) || isNaN(dc)) {\r\n      toast({ title: 'قيمة غير صالحة', description: 'يرجى إدخال أرقام صحيحة للرصيد الافتتاحي وفلوس الدرج.', variant: 'destructive' });\r\n      return;\r\n    }\r\n    if (base < 0 || air < 0 || dc < 0) {\r\n      toast({ title: 'قيمة سالبة', description: 'لا يمكن إدخال قيم سالبة.', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    setSavedOpeningBase(base);\r\n    setSavedOpeningAir(air);\r\n    setSavedDrawerCash(dc);\r\n    try {\r\n      const keyOpening = selectedMachineId ? `${STORAGE_KEY_OPENING}_${selectedMachineId}` : STORAGE_KEY_OPENING;\r\n      const keySnap = selectedMachineId ? `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}` : STORAGE_KEY_OPENING_SNAPSHOT;\r\n      localStorage.setItem(keyOpening, JSON.stringify({ openingBase: base, openingAir: air, drawerCash: dc }));\r\n      localStorage.setItem(keySnap, JSON.stringify({ openingBase: base, openingAir: air, drawerCash: dc }));\r\n      setOpeningSnapshot({ openingBase: base, openingAir: air, drawerCash: dc });\r\n      // حفظ في Firestore تحت الماكينة المحددة\r\n      const sid0 = shopId || getFallbackShopId();\r\n      if (sid0 && selectedMachineId) {\r\n        const ref = doc(db, 'shops', sid0, 'machines', selectedMachineId);\r\n        await setDoc(ref, {\r\n          name: machines.find(m => m.id === selectedMachineId)?.name || 'ماكينة',\r\n          openingBase: base,\r\n          openingAir: air,\r\n          drawerCash: dc,\r\n          cashierName,\r\n          shopName: shopName || null,\r\n          updatedAt: serverTimestamp(),\r\n        }, { merge: true });\r\n      }\r\n    } catch {}\r\n\r\n    toast({ title: 'تم تسجيل البيانات', description: `الافتتاحي الأساسي: ${formatNumber(base)}، الهواء: ${formatNumber(air)}، فلوس الدرج: ${formatNumber(dc)}` });\r\n  };\r\n\r\n  const handleStartDelivery = () => {\r\n    if (savedOpeningBase == null || savedOpeningAir == null) {\r\n      toast({ title: 'سجل الرصيد الافتتاحي أولاً', description: 'يرجى الضغط على زر \"إضافة\" بعد إدخال الافتتاحي.' });\r\n      return;\r\n    }\r\n    setIsDeliverySectionOpen(true);\r\n  };\r\n\r\n  const handleDoDelivery = () => {\r\n    const dBase = parseFloat(deliveryBase || '0');\r\n    const dAir = parseFloat(deliveryAir || '0');\r\n\r\n    if (isNaN(dBase) || isNaN(dAir)) {\r\n      toast({ title: 'قيمة غير صالحة', description: 'يرجى إدخال أرقام صحيحة لرصيد التسليم.', variant: 'destructive' });\r\n      return;\r\n    }\r\n    if (dBase < 0 || dAir < 0) {\r\n      toast({ title: 'قيمة سالبة', description: 'لا يمكن إدخال قيم سالبة.', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    const openingBaseForReceipt = openingSnapshot?.openingBase ?? (savedOpeningBase || 0);\r\n    const openingAirForReceipt = openingSnapshot?.openingAir ?? (savedOpeningAir || 0);\r\n\r\n    const openingSum = (openingBaseForReceipt) + (openingAirForReceipt);\r\n    const deliverySum = dBase + dAir;\r\n    const result = deliverySum - openingSum;\r\n\r\n    setNetResult(result);\r\n\r\n    const receipt: MachineReceipt = {\r\n      id: `${Date.now()}`,\r\n      openingBase: openingBaseForReceipt,\r\n      openingAir: openingAirForReceipt,\r\n      deliveryBase: dBase,\r\n      deliveryAir: dAir,\r\n      netResult: result,\r\n      createdAt: new Date().toISOString(),\r\n      cashierName,\r\n      requiredDrawerNoProfit: result < 0 ? Math.round(-result * 100) / 100 : 0,\r\n    };\r\n\r\n    // حفظ التسليم في Firestore تحت الماكينة المحددة\r\n    void (async () => {\r\n      try {\r\n        const sid1 = shopId || getFallbackShopId();\r\n        if (sid1 && selectedMachineId) {\r\n          await addDoc(collection(db, 'shops', sid1, 'machines', selectedMachineId, 'deliveries'), {\r\n            cashierName,\r\n            openingBase: openingBaseForReceipt,\r\n            openingAir: openingAirForReceipt,\r\n            deliveryBase: dBase,\r\n            deliveryAir: dAir,\r\n            netResult: result,\r\n            createdAt: serverTimestamp(),\r\n          });\r\n          await setDoc(doc(db, 'shops', sid1, 'machines', selectedMachineId), {\r\n            lastDeliveryAt: serverTimestamp(),\r\n            updatedAt: serverTimestamp(),\r\n          }, { merge: true });\r\n        }\r\n      } catch (err) {\r\n        console.error('Persist delivery error:', err);\r\n      }\r\n    })();\r\n\r\n    setReceipts((prev) => [receipt, ...prev]);\r\n    try {\r\n      const sid = shopId || getFallbackShopId();\r\n      const key = sid && selectedMachineId ? `machineDaily_deliveries_${sid}_${selectedMachineId}` : `machineDaily_deliveries_${selectedMachineId}`;\r\n      const current = localStorage.getItem(key);\r\n      const arr = current ? JSON.parse(current) : [];\r\n      const next = [receipt, ...(Array.isArray(arr) ? arr : [])];\r\n      localStorage.setItem(key, JSON.stringify(next));\r\n    } catch {}\r\n\r\n    toast({ title: 'تم إنشاء إيصال تسليم', description: `الناتج النهائي: ${formatNumber(result)}` });\r\n  };\r\n\r\n  const handleTransferConfirm = () => {\r\n    const w = parseFloat(wholesalePrice || '0');\r\n    const r = parseFloat(retailPrice || '0');\r\n    if (!Number.isFinite(w) || !Number.isFinite(r)) {\r\n      toast({ title: 'قيمة غير صالحة', description: 'يرجى إدخال أرقام صحيحة لسعر الجملة وسعر التجزئة.', variant: 'destructive' });\r\n      return;\r\n    }\r\n    if (w < 0 || r < 0) {\r\n      toast({ title: 'قيمة سالبة', description: 'لا يمكن إدخال قيم سالبة.', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    if (savedOpeningBase == null || savedOpeningAir == null) {\r\n      toast({ title: 'سجل الرصيد الافتتاحي أولاً', description: 'يرجى إدخال الرصيد الأساسي ورصيد الهواء ثم الضغط \"إضافة\".' });\r\n      return;\r\n    }\r\n\r\n    const profit = Math.round((r - w) * 100) / 100;\r\n    setPendingTransfer({ wholesalePrice: w, retailPrice: r, profit });\r\n    setDeductDialogOpen(true);\r\n  };\r\n\r\n  const finalizeTransfer = async (from: 'base' | 'air') => {\r\n    if (!pendingTransfer) return;\r\n    const receipt: TransferReceipt = {\r\n      id: `transfer_${Date.now()}`,\r\n      wholesalePrice: pendingTransfer.wholesalePrice,\r\n      retailPrice: pendingTransfer.retailPrice,\r\n      profit: pendingTransfer.profit,\r\n      createdAt: new Date().toISOString(),\r\n      cashierName,\r\n      deductFrom: from,\r\n    };\r\n\r\n    // تحديث أرصدة الافتتاحي وفلوس الدرج\r\n    const stockDeductAmount = pendingTransfer.wholesalePrice; // خصم من المخزون بسعر الجملة\r\n    const prevBase = savedOpeningBase ?? 0;\r\n    const prevAir = savedOpeningAir ?? 0;\r\n    const prevDrawer = savedDrawerCash ?? 0;\r\n\r\n    // تحقق من كفاية الرصيد قبل الخصم\r\n    const availableStock = from === 'base' ? prevBase : prevAir;\r\n    if (stockDeductAmount > availableStock) {\r\n      toast({ title: 'رصيد غير كافٍ', description: 'لا يوجد رصيد كافٍ للخصم بسعر الجملة.', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    const newBase = from === 'base' ? Math.round((prevBase - stockDeductAmount) * 100) / 100 : prevBase;\r\n    const newAir = from === 'air' ? Math.round((prevAir - stockDeductAmount) * 100) / 100 : prevAir;\r\n    const totalDrawerAdded = pendingTransfer.retailPrice;\r\n    const newDrawer = Math.round((prevDrawer + totalDrawerAdded) * 100) / 100;\r\n\r\n    setSavedOpeningBase(newBase);\r\n    setSavedOpeningAir(newAir);\r\n    setSavedDrawerCash(newDrawer);\r\n    try {\r\n      const keyOpening = selectedMachineId ? `${STORAGE_KEY_OPENING}_${selectedMachineId}` : STORAGE_KEY_OPENING;\r\n      const keySnap = selectedMachineId ? `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}` : STORAGE_KEY_OPENING_SNAPSHOT;\r\n      localStorage.setItem(keyOpening, JSON.stringify({ openingBase: newBase, openingAir: newAir, drawerCash: newDrawer }));\r\n      localStorage.setItem(keySnap, JSON.stringify({ openingBase: newBase, openingAir: newAir, drawerCash: newDrawer }));\r\n      // تحديث الماكينة في Firestore + إضافة إيصال تحويل\r\n      const sid2 = shopId || getFallbackShopId();\r\n      if (sid2 && selectedMachineId) {\r\n        const machineRef = doc(db, 'shops', sid2, 'machines', selectedMachineId);\r\n        await setDoc(machineRef, {\r\n          openingBase: newBase,\r\n          openingAir: newAir,\r\n          drawerCash: newDrawer,\r\n          cashierName,\r\n          updatedAt: serverTimestamp(),\r\n        }, { merge: true });\r\n        await addDoc(collection(db, 'shops', sid2, 'machines', selectedMachineId, 'transfers'), {\r\n          wholesalePrice: pendingTransfer.wholesalePrice,\r\n          retailPrice: pendingTransfer.retailPrice,\r\n          profit: pendingTransfer.profit,\r\n          deductFrom: from,\r\n          cashierName,\r\n          createdAt: serverTimestamp(),\r\n        });\r\n      }\r\n    } catch {}\r\n\r\n    setTransferReceipts(prev => [receipt, ...prev]);\r\n    try {\r\n      const sidKey = shopId || getFallbackShopId();\r\n      const key = sidKey && selectedMachineId ? `machineDaily_transfers_${sidKey}_${selectedMachineId}` : 'machineDaily_transfers';\r\n      const current = localStorage.getItem(key);\r\n      const arr = current ? JSON.parse(current) : [];\r\n      const next = [receipt, ...(Array.isArray(arr) ? arr : [])];\r\n      localStorage.setItem(key, JSON.stringify(next));\r\n    } catch {}\r\n    setTransferDialogOpen(false);\r\n    setWholesalePrice('');\r\n    setRetailPrice('');\r\n    setPendingTransfer(null);\r\n    setDeductDialogOpen(false);\r\n    toast({ title: 'تم تسجيل تحويل', description: `الربح الفوري: ${formatNumber(receipt.profit)} | خصم المخزون: -${formatNumber(stockDeductAmount)} (${from === 'base' ? 'الأساسي' : 'الهواء'}) | درج (المباع فقط): +${formatNumber(totalDrawerAdded)}` });\r\n  };\r\n\r\n  const resetDialogState = () => {\r\n    setOpeningBase('');\r\n    setOpeningAir('');\r\n    setIsDeliverySectionOpen(false);\r\n    setDeliveryBase('');\r\n    setDeliveryAir('');\r\n    setNetResult(null);\r\n  };\r\n\r\n\r\n  const refreshMachineData = async () => {\r\n    if (!open || !selectedMachineId) return;\r\n    const sid = shopId || getFallbackShopId();\r\n    if (!sid) return;\r\n\r\n    // Fetch Deliveries\r\n    try {\r\n      const col = collection(db, 'shops', sid, 'machines', selectedMachineId, 'deliveries');\r\n      const snap = await getDocs(query(col));\r\n      const list: MachineReceipt[] = snap.docs.map((d) => {\r\n        const x: any = d.data();\r\n        const created = x?.createdAt?.toDate?.() ? x.createdAt.toDate() : new Date();\r\n        return {\r\n          id: d.id,\r\n          openingBase: Number(x?.openingBase || 0),\r\n          openingAir: Number(x?.openingAir || 0),\r\n          deliveryBase: Number(x?.deliveryBase || 0),\r\n          deliveryAir: Number(x?.deliveryAir || 0),\r\n          netResult: typeof x?.netResult === 'number'\r\n            ? Number(x.netResult)\r\n            : Math.round(((Number(x?.deliveryBase || 0) + Number(x?.deliveryAir || 0)) - (Number(x?.openingBase || 0) + Number(x?.openingAir || 0))) * 100) / 100,\r\n          createdAt: created.toISOString(),\r\n          cashierName: x?.cashierName || undefined,\r\n          requiredDrawerNoProfit: typeof x?.requiredDrawerNoProfit === 'number' ? x.requiredDrawerNoProfit : undefined,\r\n        } as MachineReceipt;\r\n      });\r\n      const sorted = [...list].sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n      setReceipts(sorted);\r\n      try { localStorage.setItem(`machineDaily_deliveries_${sid}_${selectedMachineId}`, JSON.stringify(sorted)); } catch {}\r\n    } catch (e) {\r\n      console.error('Error fetching deliveries:', e);\r\n    }\r\n\r\n    // Fetch Transfers\r\n    try {\r\n      const col = collection(db, 'shops', sid, 'machines', selectedMachineId, 'transfers');\r\n      const snap = await getDocs(query(col));\r\n      const list: TransferReceipt[] = snap.docs.map((d) => {\r\n        const x: any = d.data();\r\n        const created = x?.createdAt?.toDate?.() ? x.createdAt.toDate() : new Date();\r\n        const ded: any = x?.deductFrom;\r\n        return {\r\n          id: d.id,\r\n          wholesalePrice: Number(x?.wholesalePrice || 0),\r\n          retailPrice: Number(x?.retailPrice || 0),\r\n          profit: Number(x?.profit ?? ((Number(x?.retailPrice || 0) - Number(x?.wholesalePrice || 0)) || 0)),\r\n          createdAt: created.toISOString(),\r\n          cashierName: x?.cashierName || undefined,\r\n          deductFrom: ded === 'base' || ded === 'air' ? ded : undefined,\r\n        } as TransferReceipt;\r\n      });\r\n      const sorted = [...list].sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n      setTransferReceipts(sorted);\r\n      try { localStorage.setItem(`machineDaily_transfers_${sid}_${selectedMachineId}`, JSON.stringify(sorted)); } catch {}\r\n    } catch (e) {\r\n      console.error('Error fetching transfers:', e);\r\n    }\r\n    \r\n    toast({ title: 'تم التحديث', description: 'تم جلب أحدث البيانات.' });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!open || !selectedMachineId) return;\r\n    const sid = shopId || getFallbackShopId();\r\n    // Load from cache first\r\n    try {\r\n      const keyDel = sid ? `machineDaily_deliveries_${sid}_${selectedMachineId}` : `machineDaily_deliveries_${selectedMachineId}`;\r\n      const cachedDel = localStorage.getItem(keyDel);\r\n      if (cachedDel) {\r\n        const parsed = JSON.parse(cachedDel);\r\n        if (Array.isArray(parsed)) setReceipts(parsed);\r\n      }\r\n      \r\n      const keyTrans = sid ? `machineDaily_transfers_${sid}_${selectedMachineId}` : `machineDaily_transfers_${selectedMachineId}`;\r\n      const cachedTrans = localStorage.getItem(keyTrans);\r\n      if (cachedTrans) {\r\n        const parsed = JSON.parse(cachedTrans);\r\n        if (Array.isArray(parsed)) setTransferReceipts(parsed);\r\n      }\r\n    } catch {}\r\n\r\n    // Initial Fetch\r\n    refreshMachineData();\r\n  }, [open, shopId, selectedMachineId]);\r\n\r\n\r\n  const handleClose = (nextOpen: boolean) => {\r\n    if (!nextOpen) {\r\n      // عند الغلق، لا نمسح القيم المسجلة حتى لا يفقد المستخدم الافتتاحي\r\n      resetDialogState();\r\n    }\r\n    onOpenChange(nextOpen);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"w-screen h-[100vh] overflow-hidden rounded-none p-0 flex flex-col dark:bg-[#121212]\">\r\n        <DialogHeader className=\"sticky top-0 bg-white dark:bg-[#0F0F0F] z-20 border-b border-gray-200 dark:border-[#333] px-4 py-3\">\r\n          <DialogTitle className=\"flex items-center justify-between text-right\">\r\n            <span className=\"flex items-center gap-2\">\r\n              <FawryMachineIcon className=\"h-5 w-5 text-yellow-500\" />\r\n              يومية المكنة\r\n            </span>\r\n          </DialogTitle>\r\n          <DialogDescription className=\"text-right\">\r\n            أدخل الرصيد الافتتاحي، ثم في نهاية اليوم قم بإدخال رصيد التسليم لإنشاء إيصال منظم باسم \"إيصالات ماكينة\".\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"px-4 py-3 overflow-y-auto flex-1 grid grid-cols-1 gap-6\">\r\n          {/* اختيار/إنشاء ماكينة */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n          <CardTitle className=\"flex items-center justify-between\">\r\n            <span className=\"text-right\">اختيار ماكينة</span>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                variant=\"destructive\"\r\n                onClick={async () => {\r\n                  try {\r\n                    if (!shopId || !selectedMachineId) return;\r\n                    const baseRef = doc(db, 'shops', shopId, 'machines', selectedMachineId);\r\n                    try {\r\n                      const transSnap = await getDocs(collection(db, 'shops', shopId, 'machines', selectedMachineId, 'transfers'));\r\n                      await Promise.all(transSnap.docs.map(d => deleteDoc(d.ref)));\r\n                    } catch {}\r\n                    try {\r\n                      const delSnap = await getDocs(collection(db, 'shops', shopId, 'machines', selectedMachineId, 'deliveries'));\r\n                      await Promise.all(delSnap.docs.map(d => deleteDoc(d.ref)));\r\n                    } catch {}\r\n                    await deleteDoc(baseRef);\r\n                    setMachines(prev => prev.filter(m => m.id !== selectedMachineId));\r\n                    const next = machines.find(m => m.id !== selectedMachineId);\r\n                    setSelectedMachineId(next ? next.id : null);\r\n                    try {\r\n                      const keyOpening = `${STORAGE_KEY_OPENING}_${selectedMachineId}`;\r\n                      const keySnap = `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}`;\r\n                      localStorage.removeItem(keyOpening);\r\n                      localStorage.removeItem(keySnap);\r\n                    } catch {}\r\n                    toast({ title: 'تم حذف الماكينة', description: 'تمت الإزالة نهائيًا.' });\r\n                  } catch (err) {\r\n                    toast({ title: 'فشل الحذف', description: 'تعذر حذف الماكينة.' , variant: 'destructive' });\r\n                  }\r\n                }}\r\n                disabled={!selectedMachineId}\r\n                title=\"حذف الماكينة\"\r\n              >\r\n                <Trash2 className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n          </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 items-end\">\r\n                <div>\r\n                  <label className=\"text-sm font-medium block text-right\">الماكينة الحالية</label>\r\n                  <Select value={selectedMachineId ?? ''} onValueChange={(v) => { setSelectedMachineId(v); try { const sidSel = shopId || getFallbackShopId(); if (sidSel) localStorage.setItem(`machineDaily_selected_${sidSel}`, v); } catch {} }}>\r\n                    <SelectTrigger className=\"text-right\">\r\n                      <SelectValue placeholder=\"اختر ماكينة\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {machines.map(m => (\r\n                        <SelectItem key={m.id} value={m.id}>{m.name}</SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-2\">\r\n                  <div className=\"md:col-span-2\">\r\n                    <label className=\"text-sm font-medium block text-right\">إنشاء ماكينة جديدة</label>\r\n                    <Input value={newMachineName} onChange={(e) => setNewMachineName(e.target.value)} placeholder=\"اسم الماكينة\" className=\"text-right\" />\r\n                  </div>\r\n                  <div className=\"flex justify-end md:justify-start\">\r\n                    <Button\r\n                      onClick={async () => {\r\n                        try {\r\n                          if (!shopId) {\r\n                            toast({ title: 'لا يوجد محل', description: 'يرجى التأكد من تحميل بيانات المحل.', variant: 'destructive' });\r\n                            return;\r\n                          }\r\n                          const name = (newMachineName || '').trim();\r\n                          if (!name) {\r\n                            toast({ title: 'اسم الماكينة مطلوب', description: 'أدخل اسم للماكينة الجديدة.', variant: 'destructive' });\r\n                            return;\r\n                          }\r\n                          const ref = await addDoc(collection(db, 'shops', shopId, 'machines'), {\r\n                            name,\r\n                            shopId,\r\n                            createdAt: serverTimestamp(),\r\n                            updatedAt: serverTimestamp(),\r\n                            isActive: true,\r\n                          });\r\n                          const created = { id: ref.id, name };\r\n                          setMachines(prev => [created, ...prev]);\r\n                          setSelectedMachineId(ref.id);\r\n                          setNewMachineName('');\r\n                          toast({ title: 'تم إنشاء ماكينة', description: `تمت إضافة ${name}` });\r\n                        } catch (err) {\r\n                          console.error('Create machine error:', err);\r\n                          toast({ title: 'خطأ في الإنشاء', description: 'تعذر إنشاء الماكينة.', variant: 'destructive' });\r\n                        }\r\n                      }}\r\n                      className=\"bg-violet-600 hover:bg-violet-700\"\r\n                    >\r\n                      إضافة\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n          {/* الرصيد الافتتاحي */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n              <CardTitle className=\"flex items-center justify-between\">\r\n                <span className=\"text-right\">الرصيد الافتتاحي</span>\r\n                <Button variant=\"ghost\" size=\"sm\" onClick={() => setIsOpeningOpen((v) => !v)} className=\"flex items-center gap-1\">\r\n                  <ChevronDown className={`h-4 w-4 transition-transform ${isOpeningOpen ? 'rotate-180' : ''}`} />\r\n                </Button>\r\n              </CardTitle>\r\n            </CardHeader>\r\n            {/* صف خارج الطي لزر تحويل وشارة التسجيل */}\r\n            <div className=\"flex items-center justify-between px-6\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <Button variant=\"outline\" onClick={() => setTransferDialogOpen(true)} disabled={savedOpeningBase == null || savedOpeningAir == null} className=\"border-violet-300 text-violet-700\">\r\n                  تحويل\r\n                </Button>\r\n              </div>\r\n              {savedOpeningBase != null && savedOpeningAir != null && (\r\n                <Badge className=\"bg-violet-100 text-violet-700 border border-violet-200\">\r\n                  تم التسجيل: أساسي {formatNumber(savedOpeningBase)} | هواء {formatNumber(savedOpeningAir)} | درج {formatNumber(savedDrawerCash ?? 0)}\r\n                </Badge>\r\n              )}\r\n            </div>\r\n            <CardContent className={`space-y-4 ${isOpeningOpen ? '' : 'hidden'}`}>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div className=\"space-y-1\">\r\n                  <label className=\"text-sm font-medium block text-right\">الرصيد الأساسي</label>\r\n                  <Input\r\n                    inputMode=\"decimal\"\r\n                    type=\"number\"\r\n                    min={0}\r\n                    step=\"0.01\"\r\n                    value={openingBase}\r\n                    onChange={(e) => setOpeningBase(e.target.value)}\r\n                    placeholder=\"0.00\"\r\n                    className=\"text-right\"\r\n                  />\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                  <label className=\"text-sm font-medium block text-right\">رصيد الهواء</label>\r\n                  <Input\r\n                    inputMode=\"decimal\"\r\n                    type=\"number\"\r\n                    min={0}\r\n                    step=\"0.01\"\r\n                    value={openingAir}\r\n                    onChange={(e) => setOpeningAir(e.target.value)}\r\n                    placeholder=\"0.00\"\r\n                    className=\"text-right\"\r\n                  />\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                  <label className=\"text-sm font-medium block text-right\">فلوس الدرج</label>\r\n                  <Input\r\n                    inputMode=\"decimal\"\r\n                    type=\"number\"\r\n                    min={0}\r\n                    step=\"0.01\"\r\n                    value={drawerCash}\r\n                    onChange={(e) => setDrawerCash(e.target.value)}\r\n                    placeholder=\"0.00\"\r\n                    className=\"text-right\"\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"flex items-center justify-end\">\r\n                <Button variant=\"outline\" className=\"mr-2\" onClick={handleResetOpening}>\r\n                  تصفير\r\n                </Button>\r\n                <Button onClick={handleAddOpening} className=\"bg-violet-600 hover:bg-violet-700\">\r\n                  إضافة\r\n                </Button>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* إيصالات تحويل */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n              <CardTitle className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <span className=\"text-right\">إيصالات تحويل</span>\r\n                  <Badge className=\"bg-green-100 text-green-700 border border-green-200\">ربح: {formatNumber(totalTransferProfit)}</Badge>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Button variant=\"outline\" size=\"sm\" onClick={handleClearTransferReceipts} className=\"border-red-300 text-red-700 hover:bg-red-50\">حذف الإيصالات</Button>\r\n                  <Receipt className=\"h-4 w-4 text-gray-500\" />\r\n                </div>\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              {transferReceipts.length === 0 ? (\r\n                <p className=\"text-sm text-gray-500 text-right\">لا توجد تحويلات مسجلة.</p>\r\n              ) : (\r\n                <div className=\"space-y-3 max-h-52 overflow-y-auto pr-1\">\r\n                  {transferReceipts.map((t) => (\r\n                    <div key={t.id} className=\"rounded-lg border p-3 grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\">سعر الجملة</p>\r\n                        <p className=\"text-sm\">{formatNumber(t.wholesalePrice)}</p>\r\n                      </div>\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\">سعر التجزئة</p>\r\n                        <p className=\"text-sm\">{formatNumber(t.retailPrice)}</p>\r\n                      </div>\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\">الربح الفوري</p>\r\n                        <p className=\"text-sm text-green-700\">{formatNumber(t.profit)}</p>\r\n                        {t.deductFrom && (\r\n                          <div className=\"mt-1\">\r\n                            <span className=\"text-[11px] bg-violet-100 text-violet-700 border border-violet-200 rounded px-2 py-0.5\">الخصم من: {t.deductFrom === 'base' ? 'الأساسي' : 'الهواء'}</span>\r\n                          </div>\r\n                        )}\r\n                        <div className=\"flex items-center justify-end gap-2 text-xs text-gray-500\">\r\n                          <Calendar className=\"h-3 w-3\" />\r\n                          <span>{formatDateTime(t.createdAt)}</span>\r\n                          {t.cashierName && (\r\n                            <>\r\n                              <Separator orientation=\"vertical\" className=\"h-3\" />\r\n                              <span>الكاشير: {t.cashierName}</span>\r\n                            </>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* نهاية اليوم - طلب التسليم */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n              <CardTitle className=\"text-right\">نهاية اليوم</CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              {!isDeliverySectionOpen ? (\r\n                <div className=\"flex justify-end\">\r\n                  <Button variant=\"outline\" onClick={handleStartDelivery} className=\"border-violet-300 text-violet-700\">\r\n                    تسليم يومية\r\n                  </Button>\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div className=\"space-y-1\">\r\n                      <label className=\"text-sm font-medium block text-right\">الرصيد الأساسي الحالي</label>\r\n                      <Input\r\n                        inputMode=\"decimal\"\r\n                        type=\"number\"\r\n                        min={0}\r\n                        step=\"0.01\"\r\n                        value={deliveryBase}\r\n                        onChange={(e) => setDeliveryBase(e.target.value)}\r\n                        placeholder=\"0.00\"\r\n                        className=\"text-right\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-1\">\r\n                      <label className=\"text-sm font-medium block text-right\">رصيد الهواء الحالي</label>\r\n                      <Input\r\n                        inputMode=\"decimal\"\r\n                        type=\"number\"\r\n                        min={0}\r\n                        step=\"0.01\"\r\n                        value={deliveryAir}\r\n                        onChange={(e) => setDeliveryAir(e.target.value)}\r\n                        placeholder=\"0.00\"\r\n                        className=\"text-right\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-center justify-end gap-2\">\r\n                    <Button variant=\"secondary\" onClick={() => setIsDeliverySectionOpen(false)}>إلغاء</Button>\r\n                    <Button onClick={handleDoDelivery} className=\"bg-green-600 hover:bg-green-700\">تسليم</Button>\r\n                  </div>\r\n\r\n                  {netResult != null && (\r\n                    <div className=\"mt-3\">\r\n                      <div className=\"text-right\">\r\n                        <Badge className={netResult >= 0 ? 'bg-green-100 text-green-700 border border-green-200' : 'bg-red-100 text-red-700 border border-red-200'}>\r\n                          الناتج النهائي: {formatNumber(netResult)}\r\n                        </Badge>\r\n                      </div>\r\n                      <div className=\"mt-2 flex items-center justify-end gap-2\">\r\n                        <Badge className=\"bg-blue-100 text-blue-700 border border-blue-200\">\r\n                          المجموع النهائي: {formatNumber(parseFloat(deliveryBase || '0') + parseFloat(deliveryAir || '0'))}\r\n                        </Badge>\r\n                        <Badge className=\"bg-amber-100 text-amber-700 border border-amber-200\">\r\n                          مطلوب من الدرج (بدون أرباح): {formatNumber(totalWholesaleTransferred)}\r\n                        </Badge>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* إيصالات ماكينة */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n              <CardTitle className=\"flex items-center justify-between\">\r\n                <span className=\"text-right\">إيصالات ماكينة</span>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Button variant=\"outline\" size=\"sm\" onClick={handleClearMachineReceipts} className=\"border-red-300 text-red-700 hover:bg-red-50\">حذف الإيصالات</Button>\r\n                  <Receipt className=\"h-4 w-4 text-gray-500\" />\r\n                </div>\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              {receipts.length === 0 ? (\r\n                <p className=\"text-sm text-gray-500 text-right\">لا توجد إيصالات حتى الآن.</p>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {receipts.map((r) => (\r\n                    <div key={r.id} className=\"rounded-lg border p-3 grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\">الافتتاحي</p>\r\n                        <p className=\"text-sm\">أساسي: {formatNumber(r.openingBase)}</p>\r\n                        <p className=\"text-sm\">هواء: {formatNumber(r.openingAir)}</p>\r\n                      </div>\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\">التسليم</p>\r\n                        <p className=\"text-sm\">أساسي: {formatNumber(r.deliveryBase)}</p>\r\n                        <p className=\"text-sm\">هواء: {formatNumber(r.deliveryAir)}</p>\r\n                      </div>\r\n                      <div className=\"text-right space-y-1\">\r\n                        <div className=\"flex items-center justify-end\">\r\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => handleDeleteMachineReceipt(r.id)} className=\"border-red-300 text-red-700 hover:bg-red-50\">\r\n                            <Trash2 className=\"h-3 w-3 mr-1\" /> حذف\r\n                          </Button>\r\n                        </div>\r\n                        <p className=\"text-xs text-gray-500\">النتيجة</p>\r\n                        <p className={`text-sm ${r.netResult >= 0 ? 'text-green-700' : 'text-red-700'}`}>{formatNumber(r.netResult)}</p>\r\n                        <div className=\"mt-1 flex items-center justify-end gap-2\">\r\n                          <span className=\"text-[11px] bg-blue-100 text-blue-700 border border-blue-200 rounded px-2 py-0.5\">\r\n                            المجموع النهائي: {formatNumber(r.deliveryBase + r.deliveryAir)}\r\n                          </span>\r\n                          {typeof r.requiredDrawerNoProfit === 'number' && (\r\n                            <span className=\"text-[11px] bg-amber-100 text-amber-700 border border-amber-200 rounded px-2 py-0.5\">\r\n                              مطلوب من الدرج (بدون أرباح): {formatNumber(r.requiredDrawerNoProfit || 0)}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"flex items-center justify-end gap-2 text-xs text-gray-500\">\r\n                          <Calendar className=\"h-3 w-3\" />\r\n                          <span>{formatDateTime(r.createdAt)}</span>\r\n                          {r.cashierName && (\r\n                            <>\r\n                              <Separator orientation=\"vertical\" className=\"h-3\" />\r\n                              <span>الكاشير: {r.cashierName}</span>\r\n                            </>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        <DialogFooter className=\"sticky bottom-0 bg-white dark:bg-[#0F0F0F] z-20 border-t border-gray-200 dark:border-[#333] px-4 py-3 flex items-center justify-between\">\r\n          <Button variant=\"outline\" onClick={() => handleClose(false)}>إغلاق</Button>\r\n          <div className=\"text-xs text-gray-500 flex items-center gap-1\">\r\n            <Clock className=\"h-3 w-3\" />\r\n            <span>يسجل التاريخ والوقت تلقائياً لكل إيصال</span>\r\n          </div>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n\r\n      {/* نافذة تحويل الرصيد */}\r\n      <Dialog open={transferDialogOpen} onOpenChange={setTransferDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-sm\">\r\n          <DialogHeader>\r\n            <DialogTitle>تحويل رصيد</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-3\">\r\n            <div>\r\n              <label className=\"text-sm font-medium block text-right\">سعر الجملة</label>\r\n              <Input\r\n                inputMode=\"decimal\"\r\n                type=\"number\"\r\n                min={0}\r\n                step=\"0.01\"\r\n                value={wholesalePrice}\r\n                onChange={(e) => setWholesalePrice(e.target.value)}\r\n                placeholder=\"0.00\"\r\n                className=\"text-right\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"text-sm font-medium block text-right\">سعر التجزئة</label>\r\n              <Input\r\n                inputMode=\"decimal\"\r\n                type=\"number\"\r\n                min={0}\r\n                step=\"0.01\"\r\n                value={retailPrice}\r\n                onChange={(e) => setRetailPrice(e.target.value)}\r\n                placeholder=\"0.00\"\r\n                className=\"text-right\"\r\n              />\r\n            </div>\r\n            <div className=\"text-right\">\r\n              <Badge className=\"bg-green-100 text-green-700 border border-green-200\">\r\n                الربح الفوري: {formatNumber((parseFloat(retailPrice || '0') - parseFloat(wholesalePrice || '0')) || 0)}\r\n              </Badge>\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex items-center justify-end gap-2\">\r\n            <Button variant=\"secondary\" onClick={() => setTransferDialogOpen(false)}>إلغاء</Button>\r\n            <Button onClick={handleTransferConfirm} className=\"bg-violet-600 hover:bg-violet-700\">تحويل</Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n      {/* نافذة اختيار مصدر الخصم */}\r\n      <AlertDialog open={deductDialogOpen} onOpenChange={setDeductDialogOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>اختيار مصدر الخصم</AlertDialogTitle>\r\n            <AlertDialogDescription>هل يتم الخصم من الرصيد الأساسي أم من رصيد الهواء؟</AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <div className=\"flex items-center justify-end gap-2 mt-4\">\r\n            <AlertDialogCancel onClick={() => setDeductDialogOpen(false)}>رجوع</AlertDialogCancel>\r\n            <AlertDialogAction className=\"bg-emerald-600 hover:bg-emerald-700 text-white\" onClick={() => finalizeTransfer('base')}>خصم من الأساسي</AlertDialogAction>\r\n            <AlertDialogAction className=\"bg-blue-600 hover:bg-blue-700 text-white\" onClick={() => finalizeTransfer('air')}>خصم من الهواء</AlertDialogAction>\r\n          </div>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"file":"assets/MachineDailyDialog-CMRrSK5A.js"}