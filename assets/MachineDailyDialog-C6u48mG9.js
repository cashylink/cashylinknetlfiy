const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DhbnydJl.js","./index-DLaPizfT.css"])))=>i.map(i=>d[i]);
import{m as ss,aM as as,u as rs,a9 as is,r as l,R as ze,aN as xe,s as $,t as y,q as oe,j as e,aa as pt,ab as xt,ac as gt,ad as ft,aO as ns,B as f,aP as cs,aI as ls,c as q,d as V,e as L,ap as we,W as M,x as te,aK as se,g as H,I as A,D as je,E,a3 as G,aQ as os,aR as vt,C as ds,$ as Se,a8 as I,v as ms}from"./index-DhbnydJl.js";import{S as Je}from"./separator-Cn84CDdZ.js";import{A as hs,a as us,b as ps,c as xs,d as gs}from"./alert-dialog-BwXlZ7hY.js";import{S as bt,a as yt,b as Nt,c as wt,d as jt}from"./select-Bn8RCTk-.js";import{C as fs,V as vs}from"./VideoModal-w5Ot-7KI.js";import{C as bs}from"./calendar-4dCWv1Gk.js";const u=j=>{try{return Math.round(Number(j||0)).toLocaleString("en-US",{maximumFractionDigits:0})}catch{return String(j)}},qe=j=>{try{return(j?new Date(j):new Date).toLocaleString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return new Date().toISOString()}},T="machine_daily_opening_values",W="machine_daily_opening_snapshot";function Is({open:j,onOpenChange:Ve}){var dt,mt;const{toast:p}=ss(),{shiftUser:de}=as(),{user:o,profile:ge}=rs(),{shopId:g,shopName:St}=is(),C=()=>{try{if(o!=null&&o.uid){const a=`selectedShopId_${o.uid}`,i=localStorage.getItem(a);if(i)return i}const t=Object.keys(localStorage||{}).filter(a=>a.startsWith("selectedShopId_"));for(const a of t){const i=localStorage.getItem(a);if(i)return i}return null}catch{return null}};l.useEffect(()=>{try{if(j){const t=document.body.style.overflow;document.body.setAttribute("data-prev-overflow",t),document.body.style.overflow="hidden"}else{const t=document.body.getAttribute("data-prev-overflow")||"";document.body.style.overflow=t,document.body.removeAttribute("data-prev-overflow")}}catch{}return()=>{try{const t=document.body.getAttribute("data-prev-overflow")||"";document.body.style.overflow=t,document.body.removeAttribute("data-prev-overflow")}catch{}}},[j]);const[Le,fe]=l.useState(""),[He,ve]=l.useState(""),[Ge,De]=l.useState(""),[K,ae]=l.useState(null),[Y,re]=l.useState(null),[Ae,ie]=l.useState(null),[Q,ne]=l.useState(null),[N,z]=l.useState("opening"),[Ce,Ke]=l.useState(""),[_e,Ye]=l.useState(""),[ke,Qe]=l.useState(null),[Xe,me]=l.useState([]),[$e,Dt]=l.useState([]),[X,ce]=l.useState([]),[At,Ie]=l.useState(!1),[Ct,Ze]=l.useState(!1),[he,Pe]=l.useState(""),[ue,Oe]=l.useState(""),[_t,be]=l.useState(!1),[et,tt]=l.useState(null),[B,Be]=l.useState([]),[r,le]=l.useState(null),[st,at]=l.useState(""),[ys,Ns]=l.useState(!1),[ws,js]=l.useState(!1),[Re,rt]=l.useState(""),[R,it]=l.useState("rate"),[Fe,kt]=l.useState("2"),[Me,$t]=l.useState(""),[It,Pt]=l.useState(0),[Ot,Bt]=l.useState(0),[Rt,Ft]=l.useState(0),[Mt,Et]=l.useState(0),[ye,Tt]=l.useState(!1),[Z,pe]=l.useState(!1),ee=ze.useRef(!1),Wt=ze.useRef(null),Ne=ze.useRef(null);l.useEffect(()=>{j&&(ee.current=!1,pe(!1))},[j]),l.useEffect(()=>{if(j)try{const t=r?`${T}_${r}`:T,a=r?`${W}_${r}`:W,i=localStorage.getItem(t);if(i){const n=JSON.parse(i);typeof(n==null?void 0:n.openingBase)=="number"&&ae(n.openingBase),typeof(n==null?void 0:n.openingAir)=="number"&&re(n.openingAir),typeof(n==null?void 0:n.drawerCash)=="number"&&ie(n.drawerCash)}else ae(null),re(null),ie(null);const d=localStorage.getItem(a);if(d){const n=JSON.parse(d);typeof(n==null?void 0:n.openingBase)=="number"&&typeof(n==null?void 0:n.openingAir)=="number"?ne({openingBase:n.openingBase,openingAir:n.openingAir,drawerCash:n.drawerCash||0}):ne(null)}else ne(null);fe(""),ve(""),De("")}catch{}},[j,r]),l.useEffect(()=>{(async()=>{try{const t=g||C();if(!j||!t)return;const{getDocs:a}=await xe(async()=>{const{getDocs:c}=await import("./index-DhbnydJl.js").then(s=>s.cP);return{getDocs:c}},__vite__mapDeps([0,1]),import.meta.url),i=$(y,"shops",t,"machines"),n=(await a(oe(i))).docs.map(c=>({id:c.id,name:String(c.data().name||"ماكينة"),monthlyLimit:Number(c.data().monthlyLimit||5e4)}));Be(n);try{const c=localStorage.getItem(`machineDaily_selected_${t}`);c&&n.some(h=>h.id===c)?le(c):!r&&n.length>0&&(le(n[0].id),localStorage.setItem(`machineDaily_selected_${t}`,n[0].id))}catch{}}catch(t){console.error("Load machines error:",t)}})()},[j,g]);const _=l.useMemo(()=>de?de.displayName||de.name||de.username||"كاشير":(ge==null?void 0:ge.fullName)||(o==null?void 0:o.displayName)||"الحساب الرئيسي",[de,ge,o]),Ut=l.useMemo(()=>X.reduce((t,a)=>t+(a.profit||0),0),[X]),zt=l.useMemo(()=>X.reduce((t,a)=>t+(a.wholesalePrice||0),0),[X]),Jt=async()=>{try{const t=g||C();if(t&&r){const a=$(y,"shops",t,"machines",r,"transfers"),i=await te(oe(a));await Promise.all(i.docs.map(d=>se(d.ref)));try{localStorage.setItem(`machineDaily_transfers_${t}_${r}`,JSON.stringify([]))}catch{}}}catch{}ce([]),p({title:"تم حذف الإيصالات",description:"تم مسح كل إيصالات التحويل."})},qt=async()=>{try{const t=g||C();if(t&&r){const a=$(y,"shops",t,"machines",r,"deliveries"),i=await te(oe(a));await Promise.all(i.docs.map(d=>se(d.ref)));try{localStorage.setItem(`machineDaily_deliveries_${t}_${r}`,JSON.stringify([]))}catch{}}}catch{}me([]),p({title:"تم حذف الإيصالات",description:"تم مسح كل إيصالات الماكينة."})},Vt=async t=>{var d;if(!r)return;const a=g||C();if(!a)return;const i=[...X];ce(n=>n.filter(c=>c.id!==t.id));try{const n=K||0,c=Y||0,s=Ae||0;let h=n,m=c,x=s;t.deductFrom==="base"?h=Math.round((n+t.wholesalePrice)*100)/100:t.deductFrom==="air"&&(m=Math.round((c+t.wholesalePrice)*100)/100),x=Math.round((s-t.retailPrice)*100)/100,ae(h),re(m),ie(x),Q&&ne({openingBase:h,openingAir:m,drawerCash:x});const b=`${T}_${r}`,v=`${W}_${r}`;localStorage.setItem(b,JSON.stringify({openingBase:h,openingAir:m,drawerCash:x})),localStorage.setItem(v,JSON.stringify({openingBase:h,openingAir:m,drawerCash:x}));const w=`machineDaily_transfers_${a}_${r}`,S=i.filter(D=>D.id!==t.id);localStorage.setItem(w,JSON.stringify(S));const P=M(y,"shops",a,"machines",r,"transfers",t.id);await se(P);const F=M(y,"shops",a,"machines",r);if(await Se(F,{openingBase:h,openingAir:m,drawerCash:x,updatedAt:E()},{merge:!0}),o!=null&&o.uid){const D=((d=B.find(O=>O.id===r))==null?void 0:d.name)||"ماكينة";await I.saveUserTransaction(o.uid,{type:"expense",amount:t.retailPrice,senderName:D,title:"حذف إيصال تحويل",description:`إلغاء تحويل من ${D}`,shopId:a,status:"completed",createdAt:new Date,transactionId:`del_mtr_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,cashierName:_});const k=await I.getUserData(o.uid),U=Number((k==null?void 0:k.cashBalance)||0)-t.retailPrice;await I.updateUserData(o.uid,{cashBalance:U})}p({title:"تم الحذف",description:"تم حذف الإيصال واسترجاع الأرصدة."})}catch(n){console.error("Error deleting transfer receipt:",n),ce(i),p({title:"خطأ",description:"فشل حذف الإيصال.",variant:"destructive"})}},Lt=t=>{me(a=>a.filter(i=>i.id!==t)),p({title:"تم حذف الإيصال",description:"تم إزالة إيصال الماكينة المحدد."})},Ht=()=>{ae(null),re(null),ie(null),ne(null),fe(""),ve(""),De("");try{const t=r?`${T}_${r}`:T,a=r?`${W}_${r}`:W;localStorage.removeItem(t),localStorage.removeItem(a)}catch{}p({title:"تم التصفير",description:"يمكنك الآن إدخال رصيد افتتاحي جديد."})},Gt=async()=>{var d;const t=parseFloat(Le||"0"),a=parseFloat(He||"0"),i=parseFloat(Ge||"0");if(isNaN(t)||isNaN(a)||isNaN(i)){p({title:"قيمة غير صالحة",description:"يرجى إدخال أرقام صحيحة للرصيد الافتتاحي وفلوس الدرج.",variant:"destructive"});return}if(t<0||a<0||i<0){p({title:"قيمة سالبة",description:"لا يمكن إدخال قيم سالبة.",variant:"destructive"});return}ae(t),re(a),ie(i);try{const n=r?`${T}_${r}`:T,c=r?`${W}_${r}`:W;localStorage.setItem(n,JSON.stringify({openingBase:t,openingAir:a,drawerCash:i})),localStorage.setItem(c,JSON.stringify({openingBase:t,openingAir:a,drawerCash:i})),ne({openingBase:t,openingAir:a,drawerCash:i});const s=g||C();if(s&&r){const h=M(y,"shops",s,"machines",r);await Se(h,{name:((d=B.find(m=>m.id===r))==null?void 0:d.name)||"ماكينة",openingBase:t,openingAir:a,drawerCash:i,cashierName:_,shopName:St||null,updatedAt:E()},{merge:!0})}}catch{}p({title:"تم تسجيل البيانات",description:`الافتتاحي الأساسي: ${u(t)}، الهواء: ${u(a)}، فلوس الدرج: ${u(i)}`})},Kt=()=>{const t=parseFloat(Ce||"0"),a=parseFloat(_e||"0");if(isNaN(t)||isNaN(a)){p({title:"قيمة غير صالحة",description:"يرجى إدخال أرقام صحيحة لرصيد التسليم.",variant:"destructive"});return}if(t<0||a<0){p({title:"قيمة سالبة",description:"لا يمكن إدخال قيم سالبة.",variant:"destructive"});return}const i=(Q==null?void 0:Q.openingBase)??(K||0),d=(Q==null?void 0:Q.openingAir)??(Y||0),n=i+d,s=t+a-n;Qe(s);const h={id:`${Date.now()}`,openingBase:i,openingAir:d,deliveryBase:t,deliveryAir:a,netResult:s,createdAt:new Date().toISOString(),cashierName:_,requiredDrawerNoProfit:s<0?Math.round(-s*100)/100:0};Ne.current=h.id,(async()=>{var m;try{const x=g||C();if(x&&r){if(await je($(y,"shops",x,"machines",r,"deliveries"),{cashierName:_||"Unknown",userId:o==null?void 0:o.uid,openingBase:i,openingAir:d,deliveryBase:t,deliveryAir:a,netResult:s,createdAt:E()}),await Se(M(y,"shops",x,"machines",r),{lastDeliveryAt:E(),updatedAt:E()},{merge:!0}),o!=null&&o.uid){const b=((m=B.find(v=>v.id===r))==null?void 0:m.name)||"ماكينة";await I.saveUserTransaction(o.uid,{type:"machine_delivery",amount:s,senderName:b,title:"تسليم وردية مكنه",description:`تسليم وردية مكنه: ${b}`,shopId:x,status:"completed",createdAt:new Date,transactionId:`mdel_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,reference:`MDL-${Date.now()}`,cashierName:_||"Unknown",details:{openingBase:i,openingAir:d,deliveryBase:t,deliveryAir:a}})}me(b=>[h,...b]);try{const b=g||C(),v=b&&r?`machineDaily_deliveries_${b}_${r}`:`machineDaily_deliveries_${r}`,w=localStorage.getItem(v),S=w?JSON.parse(w):[],P=[h,...Array.isArray(S)?S:[]];localStorage.setItem(v,JSON.stringify(P))}catch{}p({title:"تم إنشاء إيصال تسليم",description:`الناتج النهائي: ${u(s)}`})}}catch(x){console.error("Persist delivery error:",x),p({title:"خطأ",description:"حدث خطأ أثناء حفظ التسليم. تأكد من الصلاحيات.",variant:"destructive"})}})()},nt=()=>{const t=parseFloat(he||"0"),a=parseFloat(ue||"0");if(!Number.isFinite(t)||!Number.isFinite(a)){p({title:"قيمة غير صالحة",description:"يرجى إدخال أرقام صحيحة لسعر الجملة وسعر التجزئة.",variant:"destructive"});return}if(t<0||a<0){p({title:"قيمة سالبة",description:"لا يمكن إدخال قيم سالبة.",variant:"destructive"});return}if(K==null||Y==null){p({title:"سجل الرصيد الافتتاحي أولاً",description:'يرجى إدخال الرصيد الأساسي ورصيد الهواء ثم الضغط "إضافة".'});return}const i=Math.round((a-t)*100)/100;tt({wholesalePrice:t,retailPrice:a,profit:i}),be(!0)},ct=t=>{if(ee.current||!et)return;const a=et,i=Date.now(),d=`temp_mtr_${i}`,n=`MTR-${i}`,c={id:`transfer_${Date.now()}`,wholesalePrice:a.wholesalePrice,retailPrice:a.retailPrice,profit:a.profit,createdAt:new Date().toISOString(),cashierName:_,deductFrom:t};Wt.current=c.id;const s=a.wholesalePrice,h=K??0,m=Y??0,x=Ae??0;if(s>(t==="base"?h:m)){p({title:"رصيد غير كافٍ",description:"لا يوجد رصيد كافٍ للخصم بسعر الجملة.",variant:"destructive"});return}const v=t==="base"?Math.round((h-s)*100)/100:h,w=t==="air"?Math.round((m-s)*100)/100:m,S=a.retailPrice,P=Math.round((x+S)*100)/100;ee.current=!0,pe(!0),ae(v),re(w),ie(P);try{const D=r?`${T}_${r}`:T,k=r?`${W}_${r}`:W;localStorage.setItem(D,JSON.stringify({openingBase:v,openingAir:w,drawerCash:P})),localStorage.setItem(k,JSON.stringify({openingBase:v,openingAir:w,drawerCash:P}))}catch{}ce(D=>[c,...D]);try{const D=g||C(),k=D&&r?`machineDaily_transfers_${D}_${r}`:"machineDaily_transfers",J=localStorage.getItem(k),U=J?JSON.parse(J):[],O=[c,...Array.isArray(U)?U:[]];localStorage.setItem(k,JSON.stringify(O))}catch{}Ie(!1),Pe(""),Oe(""),tt(null),be(!1),p({title:"تم تسجيل تحويل",description:`الربح الفوري: ${u(c.profit)} | خصم المخزون: -${u(s)} (${t==="base"?"الأساسي":"الهواء"}) | درج (المباع فقط): +${u(S)}`});const F=g||C();(async()=>{var D;try{if(F&&r){const k=M(y,"shops",F,"machines",r);if(await Se(k,{openingBase:v,openingAir:w,drawerCash:P,cashierName:_,updatedAt:E()},{merge:!0}),await je($(y,"shops",F,"machines",r,"transfers"),{wholesalePrice:a.wholesalePrice,retailPrice:a.retailPrice,profit:a.profit,deductFrom:t,cashierName:_,userId:o==null?void 0:o.uid,createdAt:E()}),o!=null&&o.uid){const J=((D=B.find(O=>O.id===r))==null?void 0:D.name)||"ماكينة",U=a.retailPrice;await I.saveUserTransaction(o.uid,{type:"transfer",amount:U,senderName:J,title:"إيصال تحويل مكينه",description:`تحويل مكنه من ${J}`,shopId:F,status:"completed",createdAt:new Date,transactionId:`mtr_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,reference:n,cashierName:_});try{const O=await I.getUserData(o.uid),Te=Number((O==null?void 0:O.cashBalance)||0)+U;await I.updateUserData(o.uid,{cashBalance:Te});try{if(F){const{getDoc:We,updateDoc:Zt}=await xe(async()=>{const{getDoc:Ue,updateDoc:es}=await import("./index-DhbnydJl.js").then(ts=>ts.cP);return{getDoc:Ue,updateDoc:es}},__vite__mapDeps([0,1]),import.meta.url),ht=M(y,"dashboardData",F),ut=await We(ht);if(ut.exists()){const Ue=Number(ut.data().cashBalance||0);await Zt(ht,{cashBalance:Ue+U,lastUpdated:new Date().toISOString()})}}}catch{}try{localStorage.setItem(`cashBalance_${o.uid}`,String(Te)),window.dispatchEvent(new CustomEvent("cashBalanceChanged",{detail:{value:Te}}))}catch{}try{const We={id:d,type:"transfer",amount:U,status:"completed",createdAt:new Date,title:"إيصال تحويل مكينه",description:`تحويل مكنه من ${J}`,reference:n,senderName:J,shopId:F,cashierName:_};window.dispatchEvent(new CustomEvent("dashboard:external-update",{detail:{newTransaction:We}})),window.dispatchEvent(new CustomEvent("transaction-created"))}catch{}}catch(O){console.error("Error updating cash balance for machine transfer:",O)}}}else console.error("Missing shopId or selectedMachineId",{sid2:F,selectedMachineId:r}),p({title:"تنبيه",description:"قد لا يتم حفظ البيانات في السيرفر لعدم توفر معرف المحل أو الماكينة",variant:"destructive"})}catch(k){console.error("Error finalizing transfer:",k),p({title:"خطأ",description:"حدث خطأ أثناء حفظ التحويل في قاعدة البيانات",variant:"destructive"})}finally{ee.current=!1,pe(!1)}})()},Yt=()=>{fe(""),ve(""),Ke(""),Ye(""),Qe(null)},lt=async()=>{if(!j||!r)return;const t=g||C();if(t){try{const a=$(y,"shops",t,"machines",r,"deliveries");console.log(`Fetching deliveries from: shops/${t}/machines/${r}/deliveries`);const i=await te(oe(a));console.log(`Found ${i.docs.length} delivery documents`);const n=[...i.docs.map(c=>{var m,x;const s=c.data(),h=(x=(m=s==null?void 0:s.createdAt)==null?void 0:m.toDate)!=null&&x.call(m)?s.createdAt.toDate():new Date;return{id:c.id,openingBase:Number((s==null?void 0:s.openingBase)||0),openingAir:Number((s==null?void 0:s.openingAir)||0),deliveryBase:Number((s==null?void 0:s.deliveryBase)||0),deliveryAir:Number((s==null?void 0:s.deliveryAir)||0),netResult:typeof(s==null?void 0:s.netResult)=="number"?Number(s.netResult):Math.round((Number((s==null?void 0:s.deliveryBase)||0)+Number((s==null?void 0:s.deliveryAir)||0)-(Number((s==null?void 0:s.openingBase)||0)+Number((s==null?void 0:s.openingAir)||0)))*100)/100,createdAt:h.toISOString(),cashierName:(s==null?void 0:s.cashierName)||void 0,requiredDrawerNoProfit:typeof(s==null?void 0:s.requiredDrawerNoProfit)=="number"?s.requiredDrawerNoProfit:void 0}})].sort((c,s)=>new Date(s.createdAt).getTime()-new Date(c.createdAt).getTime());me(c=>{if(Ne.current&&!n.find(h=>h.id===Ne.current)){const h=c.find(m=>m.id===Ne.current);if(h)return[h,...n].sort((b,v)=>new Date(v.createdAt).getTime()-new Date(b.createdAt).getTime()).filter((b,v,w)=>v===w.findIndex(S=>S.id===b.id))}return n});try{localStorage.setItem(`machineDaily_deliveries_${t}_${r}`,JSON.stringify(n))}catch{}}catch(a){console.error("Error fetching deliveries:",a)}try{const a=$(y,"shops",t,"machines",r,"transfers");console.log(`Fetching transfers from: shops/${t}/machines/${r}/transfers`);const i=await te(oe(a));console.log(`Found ${i.docs.length} transfer documents`);const n=[...i.docs.map(c=>{var x,b;const s=c.data(),h=(b=(x=s==null?void 0:s.createdAt)==null?void 0:x.toDate)!=null&&b.call(x)?s.createdAt.toDate():new Date,m=s==null?void 0:s.deductFrom;return{id:c.id,wholesalePrice:Number((s==null?void 0:s.wholesalePrice)||0),retailPrice:Number((s==null?void 0:s.retailPrice)||0),profit:Number((s==null?void 0:s.profit)??(Number((s==null?void 0:s.retailPrice)||0)-Number((s==null?void 0:s.wholesalePrice)||0)||0)),createdAt:h.toISOString(),cashierName:(s==null?void 0:s.cashierName)||void 0,deductFrom:m==="base"||m==="air"?m:void 0}})].sort((c,s)=>new Date(s.createdAt).getTime()-new Date(c.createdAt).getTime());ce(n);try{localStorage.setItem(`machineDaily_transfers_${t}_${r}`,JSON.stringify(n))}catch{}}catch(a){console.error("Error fetching transfers:",a),p({title:"خطأ",description:"فشل في جلب التحويلات من السيرفر",variant:"destructive"})}p({title:"تم التحديث",description:"تم جلب أحدث البيانات."})}};l.useEffect(()=>{if(!j||!r)return;const t=g||C();try{const a=t?`machineDaily_deliveries_${t}_${r}`:`machineDaily_deliveries_${r}`,i=localStorage.getItem(a);if(i){const c=JSON.parse(i);Array.isArray(c)&&me(c)}const d=t?`machineDaily_transfers_${t}_${r}`:`machineDaily_transfers_${r}`,n=localStorage.getItem(d);if(n){const c=JSON.parse(n);Array.isArray(c)&&ce(c)}}catch{}lt()},[j,g,r]);const Ee=async()=>{if(!(!r||!g))try{const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth(),t.getDate()),d=$(y,"shops",g,"machines",r,"withdrawals"),n=oe(d,ms("createdAt","desc")),s=(await te(n)).docs.map(v=>{var S;const w=v.data();return{id:v.id,...w,createdAt:(S=w.createdAt)!=null&&S.toDate?w.createdAt.toDate():new Date(w.createdAt)}});Dt(s);let h=0,m=0,x=0,b=0;s.forEach(v=>{const w=v.createdAt,S=Number(v.amount)||0,P=Number(v.commission)||0;w>=a&&(h+=S,x+=P),w>=i&&(m+=S,b+=P)}),Pt(h),Bt(m),Ft(x),Et(b)}catch(t){console.error("Error fetching monthly withdrawals:",t)}};l.useEffect(()=>{(N==="cashWithdrawal"||N==="withdrawalReceipts")&&r&&Ee()},[N,r,g]);const Qt=async t=>{if(!(!r||!g))try{const a=M(y,"shops",g,"machines",r,"withdrawals",t),{getDoc:i}=await xe(async()=>{const{getDoc:n}=await import("./index-DhbnydJl.js").then(c=>c.cP);return{getDoc:n}},__vite__mapDeps([0,1]),import.meta.url),d=await i(a);if(d.exists()){const n=d.data();if(n.deductedFromDrawer&&n.userId&&n.amount){const c=await I.getUserData(n.userId),h=Number((c==null?void 0:c.cashBalance)||0)+Number(n.amount);await I.updateUserData(n.userId,{cashBalance:h});try{const{updateDoc:m}=await xe(async()=>{const{updateDoc:b}=await import("./index-DhbnydJl.js").then(v=>v.cP);return{updateDoc:b}},__vite__mapDeps([0,1]),import.meta.url),x=M(y,"dashboardData",g);await m(x,{cashBalance:h})}catch(m){console.error("Error updating shop cash balance:",m)}}}await se(a),p({title:"تم الحذف",description:"تم حذف إيصال السحب"}),Ee()}catch(a){console.error("Delete withdrawal error:",a),p({title:"خطأ",description:"فشل الحذف",variant:"destructive"})}},Xt=async()=>{var t;if(!ee.current){ee.current=!0,pe(!0);try{const a=parseFloat(Re);if(isNaN(a)||a<=0){p({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}let i=0,d=0;if(R==="rate"){const c=parseFloat(Fe);if(isNaN(c)||c<0){p({title:"خطأ",description:"يرجى إدخال عمولة صحيحة",variant:"destructive"});return}i=a/1e3*c,d=c}else{const c=parseFloat(Me);if(isNaN(c)||c<0){p({title:"خطأ",description:"يرجى إدخال مبلغ عمولة صحيح",variant:"destructive"});return}i=c}if(!r||!g){p({title:"خطأ",description:"بيانات المحل أو الماكينة غير متوفرة",variant:"destructive"});return}let n=null;try{if(ye&&(o!=null&&o.uid)){const c=await I.getUserData(o.uid),h=Number((c==null?void 0:c.cashBalance)||0)-a;n=h,await I.updateUserData(o.uid,{cashBalance:h});try{const{updateDoc:m}=await xe(async()=>{const{updateDoc:b}=await import("./index-DhbnydJl.js").then(v=>v.cP);return{updateDoc:b}},__vite__mapDeps([0,1]),import.meta.url),x=M(y,"dashboardData",g);await m(x,{cashBalance:h})}catch(m){console.error("Error updating shop cash balance:",m)}}if(await je($(y,"shops",g,"machines",r,"withdrawals"),{amount:a,commissionMode:R,commissionRate:R==="rate"?d:0,fixedCommission:R==="fixed"?i:0,commission:i,createdAt:E(),userId:o==null?void 0:o.uid,cashierName:_,deductedFromDrawer:ye}),o!=null&&o.uid)try{const c=((t=B.find(x=>x.id===r))==null?void 0:t.name)||"ماكينة",s={type:"machine_withdrawal",amount:a,commission:i,senderName:c,title:"إيصال سحب فوري",description:`سحب كاش بقيمة ${u(a)} وعمولة ${u(i)}${ye?" (تم الخصم من الدرج)":""}`,shopId:g,status:"completed",createdAt:new Date,transactionId:`mwd_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,reference:`MWD-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,cashierName:_},h=await I.saveUserTransaction(o.uid,s),m={...s,id:h};try{window.dispatchEvent(new CustomEvent("dashboard:external-update",{detail:{newTransaction:m}})),window.dispatchEvent(new CustomEvent("transaction-created")),n!==null&&window.dispatchEvent(new CustomEvent("cashBalanceChanged",{detail:{value:n}}))}catch(x){console.error("Error dispatching events:",x)}}catch(c){console.error("Failed to save user transaction log:",c)}p({title:"تم السحب",description:`تم سحب ${u(a)} وعمولة ${u(i)}`}),rt(""),Ee()}catch(c){console.error("Withdrawal error:",c),p({title:"خطأ",description:"فشل في تنفيذ السحب",variant:"destructive"})}}finally{ee.current=!1,pe(!1)}}},ot=t=>{t||Yt(),Ve(t)};return e.jsxs(pt,{open:j,onOpenChange:ot,children:[e.jsxs(xt,{className:"w-screen h-[100vh] overflow-hidden rounded-none p-0 flex flex-col dark:bg-[#121212]",children:[e.jsxs(gt,{className:"sticky top-0 bg-white dark:bg-[#0F0F0F] z-20 border-b border-gray-200 dark:border-[#333] px-4 py-3",children:[e.jsxs(ft,{className:"flex items-center justify-between text-right",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"h-5 w-5 text-yellow-500"}),"يومية المكنة ",r&&((dt=B.find(t=>t.id===r))!=null&&dt.name)?`- ${(mt=B.find(t=>t.id===r))==null?void 0:mt.name}`:""]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(f,{variant:"ghost",onClick:()=>Ze(!0),title:"شرح فيديو",className:"gap-1 px-2 text-rose-600 hover:text-rose-700 hover:bg-rose-50",children:[e.jsx(fs,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"شرح قسم المكن فديو"})]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:lt,title:"تحديث البيانات",children:e.jsx(cs,{className:"h-4 w-4"})})]})]}),e.jsx(ls,{className:"text-right",children:'أدخل الرصيد الافتتاحي، ثم في نهاية اليوم قم بإدخال رصيد التسليم لإنشاء إيصال منظم باسم "إيصالات ماكينة".'}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 sm:flex sm:flex-wrap sm:justify-end gap-2",children:[e.jsx(f,{size:"sm",variant:"outline",className:`w-full sm:w-auto ${N==="machines"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>z("machines"),children:"الماكينات"}),e.jsx(f,{size:"sm",variant:"outline",className:`w-full sm:w-auto ${N==="cashWithdrawal"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>z("cashWithdrawal"),children:"سحب كاش"}),e.jsx(f,{size:"sm",variant:"outline",className:`w-full sm:w-auto ${N==="withdrawalReceipts"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>z("withdrawalReceipts"),children:"إيصالات سحب مكنة"}),e.jsx(f,{size:"sm",variant:"outline",className:`w-full sm:w-auto ${N==="opening"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>z("opening"),children:"الرصيد الافتتاحي"}),e.jsx(f,{size:"sm",variant:"outline",className:`w-full sm:w-auto ${N==="transfer"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>z("transfer"),children:"التحويل"}),e.jsx(f,{size:"sm",variant:"outline",className:`w-full sm:w-auto ${N==="transferReceipts"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>z("transferReceipts"),children:"إيصالات التحويل"}),e.jsx(f,{size:"sm",variant:"outline",className:`w-full sm:w-auto ${N==="delivery"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>z("delivery"),children:"تسليم الوردية"}),e.jsx(f,{size:"sm",variant:"outline",className:`w-full sm:w-auto col-span-2 sm:col-auto ${N==="deliveryReceipts"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>z("deliveryReceipts"),children:"إيصالات التسليم"})]})]}),e.jsxs("div",{className:"px-4 py-3 overflow-y-auto flex-1 grid grid-cols-1 gap-6",children:[N==="machines"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsxs(L,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-right",children:"إدارة الماكينات"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(f,{variant:"destructive",onClick:async()=>{try{if(!g||!r)return;const t=M(y,"shops",g,"machines",r);try{const i=await te($(y,"shops",g,"machines",r,"transfers"));await Promise.all(i.docs.map(d=>se(d.ref)))}catch{}try{const i=await te($(y,"shops",g,"machines",r,"deliveries"));await Promise.all(i.docs.map(d=>se(d.ref)))}catch{}await se(t),Be(i=>i.filter(d=>d.id!==r));const a=B.find(i=>i.id!==r);le(a?a.id:null);try{const i=`${T}_${r}`,d=`${W}_${r}`;localStorage.removeItem(i),localStorage.removeItem(d)}catch{}p({title:"تم حذف الماكينة",description:"تمت الإزالة نهائيًا."})}catch{p({title:"فشل الحذف",description:"تعذر حذف الماكينة.",variant:"destructive"})}},disabled:!r,title:"حذف الماكينة",children:e.jsx(we,{className:"h-4 w-4"})})})]})}),e.jsx(H,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"الماكينة الحالية"}),e.jsxs(bt,{value:r??"",onValueChange:t=>{le(t);try{const a=g||C();a&&localStorage.setItem(`machineDaily_selected_${a}`,t)}catch{}},children:[e.jsx(yt,{className:"text-right",children:e.jsx(Nt,{placeholder:"اختر ماكينة"})}),e.jsx(wt,{children:B.map(t=>e.jsx(jt,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"إنشاء ماكينة جديدة"}),e.jsx(A,{value:st,onChange:t=>at(t.target.value),placeholder:"اسم الماكينة",className:"text-right"})]}),e.jsx("div",{className:"flex justify-end md:justify-start",children:e.jsx(f,{onClick:async()=>{try{if(!g){p({title:"لا يوجد محل",description:"يرجى التأكد من تحميل بيانات المحل.",variant:"destructive"});return}const t=(st||"").trim();if(!t){p({title:"اسم الماكينة مطلوب",description:"أدخل اسم للماكينة الجديدة.",variant:"destructive"});return}const a=await je($(y,"shops",g,"machines"),{name:t,shopId:g,createdAt:E(),updatedAt:E(),isActive:!0}),i={id:a.id,name:t};Be(d=>[i,...d]),le(a.id),at(""),p({title:"تم إنشاء ماكينة",description:`تمت إضافة ${t}`})}catch(t){console.error("Create machine error:",t),p({title:"خطأ في الإنشاء",description:"تعذر إنشاء الماكينة.",variant:"destructive"})}},className:"bg-violet-600 hover:bg-violet-700",children:"إضافة"})})]})]})})]}),N==="opening"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsx(L,{className:"flex items-center justify-between",children:e.jsx("span",{className:"text-right",children:"الرصيد الافتتاحي"})})}),e.jsx("div",{className:"flex items-center justify-between px-6",children:K!=null&&Y!=null&&e.jsxs(G,{className:"bg-violet-100 text-violet-700 border border-violet-200",children:["تم التسجيل: أساسي ",u(K)," | هواء ",u(Y)," | درج ",u(Ae??0)]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"اختيار الماكينة"}),e.jsxs(bt,{value:r||"",onValueChange:le,children:[e.jsx(yt,{className:"w-full text-right flex-row-reverse",dir:"rtl",children:e.jsx(Nt,{placeholder:"اختر الماكينة"})}),e.jsx(wt,{dir:"rtl",children:B.map(t=>e.jsx(jt,{value:t.id,className:"text-right cursor-pointer justify-end",children:t.name},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"الرصيد الأساسي"}),e.jsx(A,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:Le,onChange:t=>fe(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"رصيد الهواء"}),e.jsx(A,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:He,onChange:t=>ve(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"فلوس الدرج"}),e.jsx(A,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:Ge,onChange:t=>De(t.target.value),placeholder:"0.00",className:"text-right"})]})]}),e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx(f,{variant:"outline",className:"mr-2",onClick:Ht,children:"تصفير"}),e.jsx(f,{onClick:Gt,className:"bg-violet-600 hover:bg-violet-700",children:"إضافة"})]})]})]}),N==="transfer"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsx(L,{className:"flex items-center justify-between",children:e.jsx("span",{className:"text-right",children:"التحويل"})})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"سعر الجملة"}),e.jsx(A,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:he,onChange:t=>Pe(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"سعر التجزئة"}),e.jsx(A,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:ue,onChange:t=>Oe(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(G,{className:"bg-green-100 text-green-700 border border-green-200",children:["الربح الفوري: ",u(parseFloat(ue||"0")-parseFloat(he||"0")||0)]}),e.jsx(f,{onClick:nt,disabled:K==null||Y==null,className:"bg-violet-600 hover:bg-violet-700",children:"تحويل"})]})]})]}),N==="transferReceipts"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsxs(L,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-right",children:"إيصالات التحويل"}),e.jsxs(G,{className:"bg-green-100 text-green-700 border border-green-200",children:["ربح: ",u(Ut)]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(f,{variant:"outline",size:"sm",onClick:Jt,className:"border-red-300 text-red-700 hover:bg-red-50",children:"حذف الإيصالات"})})]})}),e.jsx(H,{className:"space-y-3",children:X.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-right",children:"لا توجد تحويلات مسجلة."}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1",children:X.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-100 bg-white dark:bg-gray-800 dark:border-gray-700 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-4 sm:gap-6",children:[e.jsxs("div",{className:"text-center min-w-[3rem]",children:[e.jsx("span",{className:"block text-[10px] text-gray-500 mb-0.5",children:"جملة"}),e.jsx("span",{className:"block text-sm font-bold text-gray-900 dark:text-gray-100",children:u(t.wholesalePrice)})]}),e.jsx("div",{className:"h-8 w-px bg-gray-100 dark:bg-gray-700"}),e.jsxs("div",{className:"text-center min-w-[3rem]",children:[e.jsx("span",{className:"block text-[10px] text-gray-500 mb-0.5",children:"تجزئة"}),e.jsx("span",{className:"block text-sm font-bold text-gray-900 dark:text-gray-100",children:u(t.retailPrice)})]}),e.jsx("div",{className:"h-8 w-px bg-gray-100 dark:bg-gray-700"}),e.jsxs("div",{className:"text-center min-w-[3rem]",children:[e.jsx("span",{className:"block text-[10px] text-gray-500 mb-0.5",children:"ربح"}),e.jsx("span",{className:"block text-sm font-bold text-green-600",children:u(t.profit)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"h-7 w-7 text-red-400 hover:text-red-600 hover:bg-red-50",onClick:()=>Vt(t),title:"حذف واسترجاع الرصيد",children:e.jsx(we,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex flex-col items-end gap-1.5",children:[t.deductFrom&&e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full border ${t.deductFrom==="base"?"bg-blue-50 text-blue-700 border-blue-100":"bg-amber-50 text-amber-700 border-amber-100"}`,children:t.deductFrom==="base"?"من الأساسي":"من الهواء"}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-gray-400",children:[e.jsx("span",{children:qe(t.createdAt)}),t.cashierName&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{orientation:"vertical",className:"h-3"}),e.jsx("span",{title:t.cashierName,children:t.cashierName.split(" ")[0]})]})]})]})]})]},t.id))})})]}),N==="cashWithdrawal"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsx(L,{className:"text-right",children:"سحب كاش"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded border border-blue-100 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-blue-600 block",children:"سحب اليوم (يصفر 12 ليلاً)"}),e.jsx("span",{className:"text-lg font-bold text-blue-800",children:u(Ot)})]}),e.jsxs("div",{className:"pt-2 mt-2 border-t border-blue-200 flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] text-blue-500 font-medium",children:"الربح اليومي"}),e.jsx("span",{className:"text-sm font-bold text-blue-700",children:u(Mt)})]})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded border border-green-100 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-green-600 block",children:"سحب الشهر (يصفر أول الشهر)"}),e.jsx("span",{className:"text-lg font-bold text-green-800",children:u(It)})]}),e.jsxs("div",{className:"pt-2 mt-2 border-t border-green-200 flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] text-green-500 font-medium",children:"الربح الشهري"}),e.jsx("span",{className:"text-sm font-bold text-green-700",children:u(Rt)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"مبلغ السحب"}),e.jsx(A,{type:"number",min:0,value:Re,onChange:t=>rt(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"space-y-2 border p-3 rounded bg-gray-50",children:[e.jsx("label",{className:"text-sm font-medium block text-right mb-2",children:"طريقة حساب العمولة"}),e.jsxs("div",{className:"flex justify-end gap-2 mb-3",children:[e.jsx(f,{variant:R==="fixed"?"default":"outline",size:"sm",onClick:()=>it("fixed"),className:R==="fixed"?"bg-violet-600":"",children:"مبلغ ثابت"}),e.jsx(f,{variant:R==="rate"?"default":"outline",size:"sm",onClick:()=>it("rate"),className:R==="rate"?"bg-violet-600":"",children:"نسبة لكل ألف"})]}),R==="rate"?e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"العمولة (لكل ألف)"}),e.jsx(A,{type:"number",min:0,value:Fe,onChange:t=>kt(t.target.value),placeholder:"2",className:"text-right"})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"مبلغ العمولة الكلي"}),e.jsx(A,{type:"number",min:0,value:Me,onChange:t=>$t(t.target.value),placeholder:"0.00",className:"text-right"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse mt-2 justify-end",children:[e.jsx("label",{htmlFor:"deductDrawer",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:"خصم من درج النقدية"}),e.jsx(os,{id:"deductDrawer",checked:ye,onCheckedChange:t=>Tt(!!t)})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["سيتم تسجيل عمولة: ",e.jsx("span",{className:"font-bold text-green-600",children:u(R==="rate"?parseFloat(Re||"0")/1e3*parseFloat(Fe||"0"):parseFloat(Me||"0"))})]}),e.jsx(f,{onClick:Xt,disabled:Z,className:"bg-violet-600 hover:bg-violet-700 disabled:opacity-70",children:Z?"جاري السحب...":"سحب"})]})]})]}),N==="withdrawalReceipts"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsxs(L,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-right",children:"إيصالات سحب مكنة"}),e.jsxs(G,{variant:"outline",className:"text-violet-700 border-violet-200 bg-violet-50",children:["عدد الإيصالات: ",$e.length]})]})}),e.jsx(H,{className:"space-y-3",children:$e.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-right",children:"لا توجد سحوبات مسجلة لهذا الشهر."}):e.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto pr-1",children:$e.map(t=>{var a;return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-100 bg-white dark:bg-gray-800 dark:border-gray-700 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right min-w-[4rem]",children:[e.jsx("span",{className:"block text-[10px] text-gray-500 mb-0.5",children:"المبلغ"}),e.jsx("span",{className:"block text-sm font-bold text-gray-900 dark:text-gray-100",children:u(t.amount)})]}),e.jsx("div",{className:"h-8 w-px bg-gray-100 dark:bg-gray-700"}),e.jsxs("div",{className:"text-right min-w-[3rem]",children:[e.jsx("span",{className:"block text-[10px] text-gray-500 mb-0.5",children:"العمولة"}),e.jsx("span",{className:"block text-sm font-bold text-green-600",children:u(t.commission)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"h-7 w-7 text-red-400 hover:text-red-600 hover:bg-red-50",onClick:()=>Qt(t.id),title:"حذف الإيصال",children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex flex-col items-end gap-1.5",children:e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-gray-400",children:[e.jsx("span",{children:qe((a=t.createdAt)!=null&&a.toISOString?t.createdAt.toISOString():t.createdAt)}),t.cashierName&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{orientation:"vertical",className:"h-3"}),e.jsx("span",{title:t.cashierName,children:t.cashierName.split(" ")[0]})]})]})})]})]},t.id)})})})]}),N==="delivery"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsx(L,{className:"text-right",children:"تسليم الوردية"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"الرصيد الأساسي الحالي"}),e.jsx(A,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:Ce,onChange:t=>Ke(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"رصيد الهواء الحالي"}),e.jsx(A,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:_e,onChange:t=>Ye(t.target.value),placeholder:"0.00",className:"text-right"})]})]}),e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsx(f,{onClick:Kt,className:"bg-violet-600 hover:bg-violet-700",children:"تسليم"})}),ke!=null&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-right",children:e.jsxs(G,{className:ke>=0?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200",children:["الناتج النهائي: ",u(ke)]})}),e.jsxs("div",{className:"mt-2 flex items-center justify-end gap-2",children:[e.jsxs(G,{className:"bg-blue-100 text-blue-700 border border-blue-200",children:["المجموع النهائي: ",u(parseFloat(Ce||"0")+parseFloat(_e||"0"))]}),e.jsxs(G,{className:"bg-amber-100 text-amber-700 border border-amber-200",children:["مطلوب من الدرج (بدون أرباح): ",u(zt)]})]})]})]})]}),N==="deliveryReceipts"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsxs(L,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-right",children:"إيصالات التسليم"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(f,{variant:"outline",size:"sm",onClick:qt,className:"border-red-300 text-red-700 hover:bg-red-50",children:"حذف الإيصالات"})})]})}),e.jsx(H,{className:"space-y-3",children:Xe.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-right",children:"لا توجد إيصالات حتى الآن."}):e.jsx("div",{className:"space-y-3",children:Xe.map(t=>e.jsxs("div",{className:"rounded-lg border p-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"الافتتاحي"}),e.jsxs("p",{className:"text-sm",children:["أساسي: ",u(t.openingBase)]}),e.jsxs("p",{className:"text-sm",children:["هواء: ",u(t.openingAir)]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"التسليم"}),e.jsxs("p",{className:"text-sm",children:["أساسي: ",u(t.deliveryBase)]}),e.jsxs("p",{className:"text-sm",children:["هواء: ",u(t.deliveryAir)]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>Lt(t.id),className:"border-red-300 text-red-700 hover:bg-red-50",children:[e.jsx(we,{className:"h-3 w-3 mr-1"})," حذف"]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"النتيجة"}),e.jsx("p",{className:`text-sm ${t.netResult>=0?"text-green-700":"text-red-700"}`,children:u(t.netResult)}),e.jsxs("div",{className:"mt-1 flex items-center justify-end gap-2",children:[e.jsxs("span",{className:"text-[11px] bg-blue-100 text-blue-700 border border-blue-200 rounded px-2 py-0.5",children:["المجموع النهائي: ",u(t.deliveryBase+t.deliveryAir)]}),typeof t.requiredDrawerNoProfit=="number"&&e.jsxs("span",{className:"text-[11px] bg-amber-100 text-amber-700 border border-amber-200 rounded px-2 py-0.5",children:["مطلوب من الدرج (بدون أرباح): ",u(t.requiredDrawerNoProfit||0)]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 text-xs text-gray-500",children:[e.jsx(bs,{className:"h-3 w-3"}),e.jsx("span",{children:qe(t.createdAt)}),t.cashierName&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{orientation:"vertical",className:"h-3"}),e.jsxs("span",{children:["الكاشير: ",t.cashierName]})]})]})]})]},t.id))})})]})]}),e.jsxs(vt,{className:"sticky bottom-0 bg-white dark:bg-[#0F0F0F] z-20 border-t border-gray-200 dark:border-[#333] px-4 py-3 flex items-center justify-between",children:[e.jsx(f,{variant:"outline",onClick:()=>ot(!1),children:"إغلاق"}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(ds,{className:"h-3 w-3"}),e.jsx("span",{children:"يسجل التاريخ والوقت تلقائياً لكل إيصال"})]})]})]}),e.jsx(pt,{open:At,onOpenChange:Ie,children:e.jsxs(xt,{className:"sm:max-w-sm",children:[e.jsx(gt,{children:e.jsx(ft,{children:"تحويل رصيد"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"سعر الجملة"}),e.jsx(A,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:he,onChange:t=>Pe(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"سعر التجزئة"}),e.jsx(A,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:ue,onChange:t=>Oe(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsx("div",{className:"text-right",children:e.jsxs(G,{className:"bg-green-100 text-green-700 border border-green-200",children:["الربح الفوري: ",u(parseFloat(ue||"0")-parseFloat(he||"0")||0)]})})]}),e.jsxs(vt,{className:"flex items-center justify-end gap-2",children:[e.jsx(f,{variant:"secondary",onClick:()=>Ie(!1),children:"إلغاء"}),e.jsx(f,{onClick:nt,className:"bg-violet-600 hover:bg-violet-700",children:"تحويل"})]})]})}),e.jsx(hs,{open:_t,onOpenChange:be,children:e.jsxs(us,{children:[e.jsxs(ps,{children:[e.jsx(xs,{children:"اختيار مصدر الخصم"}),e.jsx(gs,{children:"هل يتم الخصم من الرصيد الأساسي أم من رصيد الهواء؟"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-4",children:[e.jsx(f,{variant:"ghost",onClick:()=>be(!1),disabled:Z,children:"رجوع"}),e.jsx(f,{className:"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>ct("base"),disabled:Z,children:Z?"جاري التحويل...":"خصم من الأساسي"}),e.jsx(f,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>ct("air"),disabled:Z,children:Z?"جاري التحويل...":"خصم من الهواء"})]})]})}),e.jsx(vs,{isOpen:Ct,onClose:()=>Ze(!1),videoUrl:"https://www.youtube.com/watch?v=sHWKmqAmxic",title:"شرح قسم مكن الشحن وتسجيل اليومية"})]})}export{Is as default};
//# sourceMappingURL=MachineDailyDialog-C6u48mG9.js.map
