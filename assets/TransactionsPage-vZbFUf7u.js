const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dailyOperationCountService-CUlR8gDE.js","./index-mBSeGJ8K.js","./index-BsQ0vdi0.css","./profitService-B3iovAHD.js"])))=>i.map(i=>d[i]);
import{Z as os,j as t,r as m,u as Ot,ab as Tt,B as A,H as At,ae as De,af as Ce,ag as Se,ah as ke,a7 as de,aD as Ge,a3 as W,a4 as ze,b3 as v,a as ls,R as oe,ad as cs,aF as ds,q as be,p as ve,s as I,aE as Q,w as je,ac as E,b4 as le,aa as ms,aP as Fe,Q as H,_ as $,C as ps,c as us,d as hs,I as Ue,b5 as xs,aO as fs,b0 as gs,a1 as ys,as as Dt,f as bs,aN as Ct,at as St,b6 as vs,o as $e,aJ as js,aG as X,aq as Ne}from"./index-mBSeGJ8K.js";import{S as Ns,a as ws,b as Ts,c as As,d as we}from"./select-DGk4nkpB.js";import{B as Ds}from"./badge-D4Cxv57Q.js";import{S as Cs,T as Ss,a as ks,b as Te,c as Ae}from"./tabs-B85OgytT.js";import Os from"./ReceiptModal-BFQZdr4L.js";import Rs from"./InstallmentModal-D08gq3I4.js";import Ps from"./CreditCardsDialog-DEPojYwD.js";import Es from"./MaintenanceDialog-D00XSB7E.js";import{ProfitService as ce}from"./profitService-B3iovAHD.js";import{D as Ls}from"./dollar-sign-tQQ_yre_.js";import{A as Ve}from"./arrow-down-left-BTRRls4w.js";import{A as kt,u as Is,C as _s,a as Ws,f as B,b as Ms}from"./formatters-CO_Y-NDe.js";import{C as Rt}from"./calendar-DWuCbuTk.js";import{A as Bs}from"./arrow-left-CoPISNIk.js";import{B as zs}from"./battery-charging-Odp8Tilx.js";import{C as Fs}from"./circle-x-bWAeF-qD.js";import{C as Us}from"./circle-check-big-C-Uwjs2Z.js";import"./index-B0RoPUtu.js";import"./separator-xJo-nMhI.js";import"./html2canvas.esm-BfYXEYrK.js";import"./printer-C-vYmUsl.js";import"./download-C_W4yx38.js";import"./pen-line-BxM__rGx.js";import"./refresh-cw-VJ-sBqT-.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Gs=os("circle-play",$s),Vs=({userId:D,transactions:a=[]})=>{const[j,f]=m.useState(!1),[q,J]=m.useState(!1),[te,He]=m.useState(!1),[z,R]=m.useState({dailyWithdraw:0,dailyTransfer:0,monthlyWithdraw:0,monthlyTransfer:0,lastUpdated:new Date}),{userSubscription:k}=Ot();m.useEffect(()=>{D&&j&&te&&Oe()},[D,j,te]);const M=N=>`${N.toFixed(2)} ج.م`,Y=async()=>{try{const N=(k==null?void 0:k.subscription)||null,c=(N==null?void 0:N.planType)??(N==null?void 0:N.plan)??null,T=typeof c=="string"?c.toLowerCase():null;if(c===W.ZERO||T==="zero"||T==="0"||c===0)return!0}catch{}try{if(D){const N=await ze(D),c=(N==null?void 0:N.planType)??(N==null?void 0:N.plan)??null,T=typeof c=="string"?c.toLowerCase():null;if(c===W.ZERO||T==="zero"||T==="0"||c===0)return!0}}catch{}return!1},Xe=async()=>{try{const N=await(async()=>{try{const c=(k==null?void 0:k.subscription)||null,T=(c==null?void 0:c.planType)??(c==null?void 0:c.plan)??null,_=typeof T=="string"?T.toLowerCase():null;if(T===W.TAHWEELA||_==="tahweela")return!0}catch{}try{if(D){const c=await ze(D),T=(c==null?void 0:c.planType)??(c==null?void 0:c.plan)??null,_=typeof T=="string"?T.toLowerCase():null;if(T===W.TAHWEELA||_==="tahweela")return!0}}catch{}return!1})();if(await Y()||N){v({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"});return}}catch{}J(!0)},ee=async()=>{try{const N=await(async()=>{try{const c=(k==null?void 0:k.subscription)||null,T=(c==null?void 0:c.planType)??(c==null?void 0:c.plan)??null,_=typeof T=="string"?T.toLowerCase():null;if(T===W.TAHWEELA||_==="tahweela")return!0}catch{}try{if(D){const c=await ze(D),T=(c==null?void 0:c.planType)??(c==null?void 0:c.plan)??null,_=typeof T=="string"?T.toLowerCase():null;if(T===W.TAHWEELA||_==="tahweela")return!0}}catch{}return!1})();if(await Y()||N){v({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"}),J(!1);return}}catch{}He(!0),f(!0),J(!1)},Oe=async()=>{if(D)try{if(Array.isArray(a)&&a.length>0){const c=new Date,T=c.getMonth(),_=c.getFullYear(),Re=Tt.filterVisibleTransactions(a,"daily",D),Z=Tt.filterVisibleTransactions(a,"monthly",D);let se=0,G=0,me=0,V=0;Re.forEach(P=>{const ae=new Date(P.createdAt),F=String(P.status||"confirmed").toLowerCase();if(ae.toDateString()!==c.toDateString()||F!=="completed"&&F!=="confirmed"&&F!=="pending")return;const K=(P.type||P.txnType||"").toLowerCase(),C={type:K==="withdrawal"?"withdraw":K,amount:Number(P.amount||0),commission:P.commission};C.type==="withdraw"?se+=ce.calculateProfitFromTransaction(C):(C.type==="send"||C.type==="receive"||C.type==="transfer")&&(G+=ce.calculateProfitFromTransaction(C))}),Z.forEach(P=>{const ae=new Date(P.createdAt),F=String(P.status||"confirmed").toLowerCase();if(ae.getMonth()!==T||ae.getFullYear()!==_||F!=="completed"&&F!=="confirmed"&&F!=="pending")return;const K=(P.type||P.txnType||"").toLowerCase(),C={type:K==="withdrawal"?"withdraw":K,amount:Number(P.amount||0),commission:P.commission};C.type==="withdraw"?me+=ce.calculateProfitFromTransaction(C):(C.type==="send"||C.type==="receive"||C.type==="transfer")&&(V+=ce.calculateProfitFromTransaction(C))}),R({dailyWithdraw:Math.round(se*100)/100,dailyTransfer:Math.round(G*100)/100,monthlyWithdraw:Math.round(me*100)/100,monthlyTransfer:Math.round(V*100)/100,lastUpdated:new Date});return}const N=ce.getWithdrawTransferProfits(D);R({dailyWithdraw:N.dailyWithdrawProfit||0,dailyTransfer:N.dailyTransferProfit||0,monthlyWithdraw:N.monthlyWithdrawProfit||0,monthlyTransfer:N.monthlyTransferProfit||0,lastUpdated:new Date})}catch(N){console.error("Error loading total profits:",N)}};return t.jsxs(t.Fragment,{children:[t.jsx(A,{size:"sm",variant:"ghost",onClick:Xe,className:"h-2 w-2 p-0 bg-gradient-to-r from-blue-100 to-purple-200 text-purple-700 hover:from-blue-200 hover:to-purple-300 hover:text-purple-800 rounded transition-all duration-300 hover:scale-110 shadow-sm hover:shadow-md",title:"عرض إجمالي الأرباح",children:t.jsx(At,{className:"h-1.5 w-1.5"})}),t.jsx(De,{open:j,onOpenChange:f,children:t.jsxs(Ce,{className:"max-w-[240px] mx-auto bg-white dark:bg-[#0f172a] border border-gray-200 dark:border-slate-800 shadow-md rounded sm:max-w-[220px] sm:bg-gradient-to-br sm:from-purple-50 sm:to-white sm:dark:from-slate-900 sm:dark:to-slate-800 sm:border-2 sm:border-purple-200 sm:dark:border-slate-700 sm:shadow-2xl sm:rounded-2xl",children:[t.jsx(Se,{className:"text-center pb-0 border-b-0 sm:pb-2 sm:border-b sm:border-purple-200 dark:border-slate-700",children:t.jsxs(ke,{className:"text-xs font-bold text-purple-800 dark:text-purple-300 flex items-center justify-center gap-1 mb-0 leading-tight tracking-tight sm:text-xs sm:gap-1 sm:mb-0 sm:leading-normal sm:tracking-normal",children:[t.jsx(Ls,{className:"h-2 w-2 text-purple-600 dark:text-purple-400 sm:h-3 sm:w-3"}),"إجمالي الأرباح (فوري)"]})}),t.jsxs("div",{className:"space-y-1 py-1 sm:space-y-2 sm:py-2",children:[t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-1 rounded border border-blue-200 dark:border-blue-900/30 sm:bg-gradient-to-r sm:from-blue-50 sm:to-blue-100 sm:dark:from-blue-900/20 sm:dark:to-blue-900/10 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(de,{className:"h-2 w-2 text-blue-600 dark:text-blue-400"}),t.jsx("span",{className:"text-[10px] font-semibold text-blue-800 dark:text-blue-300",children:"يومي"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-900 dark:text-blue-100",children:M((z.dailyWithdraw??0)+(z.dailyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 dark:bg-red-900/20 p-0.5 rounded border border-red-200 dark:border-red-900/30",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ve,{className:"h-2 w-2 text-red-600 dark:text-red-400"}),t.jsx("span",{className:"text-[10px] text-red-800 dark:text-red-300",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700 dark:text-red-200",children:M(z.dailyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-green-50 dark:bg-green-900/20 p-0.5 rounded border border-green-200 dark:border-green-900/30",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(kt,{className:"h-2 w-2 text-green-600 dark:text-green-400"}),t.jsx("span",{className:"text-[10px] text-green-800 dark:text-green-300",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-green-700 dark:text-green-200",children:M(z.dailyTransfer)})]})]})]}),t.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-1 rounded border border-purple-200 dark:border-purple-900/30 sm:bg-gradient-to-r sm:from-purple-50 sm:to-purple-100 sm:dark:from-purple-900/20 sm:dark:to-purple-900/10 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Rt,{className:"h-2 w-2 text-purple-600 dark:text-purple-400"}),t.jsx("span",{className:"text-[10px] font-semibold text-purple-800 dark:text-purple-300",children:"شهري"})]}),t.jsx("span",{className:"text-[10px] font-bold text-purple-900 dark:text-purple-100",children:M((z.monthlyWithdraw??0)+(z.monthlyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 dark:bg-red-900/20 p-0.5 rounded border border-red-200 dark:border-red-900/30",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ve,{className:"h-2 w-2 text-red-600 dark:text-red-400"}),t.jsx("span",{className:"text-[10px] text-red-800 dark:text-red-300",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700 dark:text-red-200",children:M(z.monthlyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-blue-50 dark:bg-blue-900/20 p-0.5 rounded border border-blue-200 dark:border-blue-900/30",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(kt,{className:"h-2 w-2 text-blue-600 dark:text-blue-400"}),t.jsx("span",{className:"text-[10px] text-blue-800 dark:text-blue-300",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-700 dark:text-blue-200",children:M(z.monthlyTransfer)})]})]})]})]}),!te&&t.jsx("div",{className:"absolute inset-0 bg-yellow-200/70 backdrop-blur-sm flex items-center justify-center rounded sm:rounded-2xl border border-yellow-300 pointer-events-auto",children:t.jsx(A,{size:"sm",variant:"ghost",onClick:()=>J(!0),className:"p-2 bg-yellow-300/80 text-yellow-900 hover:bg-yellow-400/90 rounded-full shadow-sm hover:shadow-md transition-all duration-300",title:"إدخال الرقم السري الرئيسي",children:t.jsx(At,{className:"h-4 w-4"})})}),t.jsx("div",{className:"flex justify-center pt-1 border-t-0 sm:pt-2 sm:border-t sm:border-purple-200",children:t.jsx(A,{onClick:()=>f(!1),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-1 rounded-xl text-xs sm:bg-gradient-to-r sm:from-purple-600 sm:to-purple-700 sm:hover:from-purple-700 sm:hover:to-purple-800 sm:px-4 sm:py-1 sm:rounded-xl sm:shadow-lg sm:hover:shadow-xl sm:transition-all sm:duration-300",children:"إغلاق"})})]})}),t.jsx(Ge,{open:q,onOpenChange:J,onSuccess:ee,description:"لا يمكن الاطلاع على إجمالي الأرباح إلا بإدخال الرقم السري الرئيسي"})]})},Hs=D=>t.jsx(Vs,{...D}),Ta=()=>{var xt,ft,gt,yt,bt,vt,jt,Nt,wt;const D=ls(),{user:a,profile:j,userSubscription:f}=Ot(),q=oe.useMemo(()=>{var n,l,r,s;const e=((n=f==null?void 0:f.subscription)==null?void 0:n.planType)??((l=f==null?void 0:f.subscription)==null?void 0:l.plan)??((r=j==null?void 0:j.subscription)==null?void 0:r.planType)??((s=j==null?void 0:j.subscription)==null?void 0:s.plan)??null;return e===W.ZERO||String(e).toLowerCase()==="zero"},[(xt=f==null?void 0:f.subscription)==null?void 0:xt.planType,(ft=f==null?void 0:f.subscription)==null?void 0:ft.plan,(gt=j==null?void 0:j.subscription)==null?void 0:gt.planType,(yt=j==null?void 0:j.subscription)==null?void 0:yt.plan]),J=oe.useMemo(()=>{var n,l,r,s;const e=((n=f==null?void 0:f.subscription)==null?void 0:n.planType)??((l=f==null?void 0:f.subscription)==null?void 0:l.plan)??((r=j==null?void 0:j.subscription)==null?void 0:r.planType)??((s=j==null?void 0:j.subscription)==null?void 0:s.plan)??null;return e===W.TAHWEELA||String(e).toLowerCase()==="tahweela"},[(bt=f==null?void 0:f.subscription)==null?void 0:bt.planType,(vt=f==null?void 0:f.subscription)==null?void 0:vt.plan,(jt=j==null?void 0:j.subscription)==null?void 0:jt.planType,(Nt=j==null?void 0:j.subscription)==null?void 0:Nt.plan]),{shopName:te}=cs(),{isShiftActive:He,shiftUser:z}=ds(),[R,k]=m.useState([]),[M,Y]=m.useState([]),[Xe,ee]=m.useState(new Set),[Oe,N]=m.useState(!1),[c,T]=m.useState(null),[_,Re]=m.useState("all"),[Z,se]=m.useState(""),[G,me]=m.useState(""),[V,P]=m.useState(""),[ae,F]=m.useState(!1),[K,C]=m.useState(!1),[Pt,qe]=m.useState(!1),[Et,Je]=m.useState(!1),[Ye,Ze]=m.useState(""),[Lt,Ke]=m.useState("شرح التطبيق"),[Xs,Qe]=m.useState(null),[re,It]=m.useState(null),[_t,pe]=m.useState(!1);oe.useEffect(()=>{var n;((n=f==null?void 0:f.subscription)==null?void 0:n.planType)===W.TAHWEELA&&(v({title:"غير متاح لاشتراكك",description:"صفحة المعاملات غير متاحة في باقة تحويله. استخدم لوحة المستخدم للتحويل/السحب فقط.",variant:"destructive"}),D("/user/dashboard"))},[(wt=f==null?void 0:f.subscription)==null?void 0:wt.planType]);const[qs,Wt]=m.useState(!1),[Js,Mt]=m.useState(!1),[Ys,Zs]=m.useState(!1),[Bt,Pe]=m.useState(!1),[zt,et]=m.useState(!1),[Ft,tt]=m.useState(!1),[Ut,Ee]=m.useState(!1),[$t,Gt]=m.useState(null),[Vt,ue]=m.useState(!1),[st,he]=m.useState({keepLastCount:30,intervalDays:7,lastResetAt:null});m.useEffect(()=>{(async()=>{if(a!=null&&a.uid)try{const n=await E.getUserData(a.uid),l=(n==null?void 0:n.recentReset)||{},r=Number(l==null?void 0:l.keepLastCount)>0?Number(l.keepLastCount):30,s=Number(l==null?void 0:l.intervalDays)>0?Number(l.intervalDays):7,i=u=>u instanceof Date?u:typeof(u==null?void 0:u.toDate)=="function"?u.toDate():u?new Date(String(u)):null,p=l!=null&&l.lastResetAt?i(l.lastResetAt):null,d=new Date;!p||d.getTime()-p.getTime()>=s*24*60*60*1e3?(await E.updateUserData(a.uid,{recentReset:{keepLastCount:r,intervalDays:s,lastResetAt:d}}),he({keepLastCount:r,intervalDays:s,lastResetAt:d})):he({keepLastCount:r,intervalDays:s,lastResetAt:p})}catch{he({keepLastCount:30,intervalDays:7,lastResetAt:null})}})()},[a==null?void 0:a.uid]),m.useEffect(()=>{if(!(a!=null&&a.uid))return;(async()=>{try{const n=H(I,"users",a.uid),l=await $(n),r=l.exists()?l.data():{},s=r==null?void 0:r.tutorialSeenAt,i=s!=null&&s.toDate?s.toDate():s?new Date(s):null;It(i)}catch{}})()},[a==null?void 0:a.uid]),m.useEffect(()=>{(async()=>{try{const n=await $(H(I,"app_guides","latest")),l=n.exists()?n.data():null;if(!l){Ze(""),Ke(""),Qe(null),pe(!1);return}const r=String(l.url||""),s=String(l.title||"شرح التطبيق"),i=l.publishedAt,p=i!=null&&i.toDate?i.toDate():i?new Date(i):new Date;Ze(r),Ke(s),Qe(p),pe(p?!re||p.getTime()>((re==null?void 0:re.getTime())||0):!1)}catch{pe(!1)}})()},[re]);const Ht=e=>{try{const n=new URL(e);let l="";return n.hostname.includes("youtube.com")?n.pathname==="/watch"?l=n.searchParams.get("v")||"":(n.pathname.startsWith("/embed/")||n.pathname.startsWith("/shorts/"))&&(l=n.pathname.split("/").pop()||""):n.hostname==="youtu.be"&&(l=n.pathname.replace(/^\//,"")),l?`https://www.youtube.com/embed/${l}?autoplay=1&rel=0`:e}catch{return e}},Xt=async()=>{Je(!0);try{a!=null&&a.uid&&await E.updateUserData(a.uid,{tutorialSeenAt:new Date}),pe(!1)}catch{}},[qt,xe]=m.useState(!1),[fe,at]=m.useState(""),[ne,rt]=m.useState(""),[ge,nt]=m.useState(""),[it,ot]=m.useState(!1),[lt,Le]=m.useState(0);m.useEffect(()=>{if(!(a!=null&&a.uid)){Le(0);return}(async()=>{try{const n=H(I,"users",a.uid),l=await $(n),r=l.exists()?l.data():{},p=(Array.isArray(r==null?void 0:r.debts)?r.debts:[]).filter(d=>(d==null?void 0:d.status)==="pending"&&(Number(d==null?void 0:d.amount)||0)>0).length;Le(p)}catch{Le(0)}})()},[a==null?void 0:a.uid]),m.useEffect(()=>{Jt(),Yt()},[a]),m.useEffect(()=>{if(!(a!=null&&a.uid))return;(async()=>{try{const n=be(ve(I,"deletedTransactions"),Q("userId","==",a.uid)),l=await je(n),r=[];l.docs.forEach(s=>{const i=s.data(),p=[i.originalTransactionId,i.transactionId,i.reference,s.id].filter(Boolean).map(d=>String(d));r.push(...p)}),r.length>0&&(ee(s=>{const i=new Set(s);return r.forEach(p=>i.add(p)),i}),k(s=>s.filter(i=>{const p=String(i.id||""),d=String(i.transactionId||""),x=String(i.reference||"");return!(r.includes(p)||r.includes(d)||r.includes(x))})));try{E.subscribeDeletedTransactionsLocalSync(a.uid)}catch{}}catch(n){console.warn("deletedTransactions fetch failed:",n)}})()},[a==null?void 0:a.uid]),m.useEffect(()=>{(async()=>{try{if(!(a!=null&&a.uid)){ee(new Set);return}const e=be(ve(I,"deletedTransactions"),Q("userId","==",a.uid),Q("permanent","==",!0)),l=(await je(e)).docs.flatMap(r=>{const s=r.data();return[s.originalTransactionId,s.transactionId,s.reference,r.id].filter(Boolean).map(String)});ee(new Set(l))}catch{ee(new Set)}})()},[a==null?void 0:a.uid]);const{data:Ie,refetch:Ks,isFetching:Qs}=Is({queryKey:["userTransactions",a==null?void 0:a.uid],queryFn:async()=>{if(!(a!=null&&a.uid))return[];try{const e=be(ve(I,"deletedTransactions"),Q("userId","==",a.uid),Q("permanent","==",!0)),[n,l,r]=await Promise.all([E.getUserTransactions(a.uid).catch(()=>[]),E.getByUserId(a.uid).catch(()=>[]),je(e).then(o=>o.docs.flatMap(y=>{const h=y.data();return[h.originalTransactionId,h.transactionId,h.reference,y.id].filter(Boolean).map(String)})).catch(()=>[])]),s=Array.isArray(n)&&n.length>0?n:Array.isArray(l)?l:[],i=new Set(r),d=(s||[]).map(o=>({...o,createdAt:o.createdAt instanceof Date?o.createdAt:new Date(o.createdAt)})).filter(o=>!((o==null?void 0:o.type)==="report"||((o==null?void 0:o.title)||"").includes("إيصال تسليم وردية"))).filter(o=>{const y=String(o.id||""),h=String(o.transactionId||""),g=String(o.reference||o.transactionReference||"");return!i.has(y)&&(!h||!i.has(h))&&(!g||!i.has(g))}),x=a!=null&&a.uid?E.getLocalReceipts(a.uid):[],u=[...d,...Array.isArray(x)?x:[]],b=o=>{var y;return String((o==null?void 0:o.transactionId)||(o==null?void 0:o.id)||(o==null?void 0:o.reference)||(o==null?void 0:o.transactionReference)||((y=o==null?void 0:o.receipt)==null?void 0:y.reference)||`${new Date((o==null?void 0:o.createdAt)||Date.now()).getTime()}`)},S=new Set;return u.filter(o=>{const y=b(o);return S.has(y)?!1:(S.add(y),!0)}).map(We)}catch(e){return console.error("Error fetching transactions:",e),[]}},enabled:!!(a!=null&&a.uid),staleTime:5*60*1e3});m.useEffect(()=>{Ie&&k(Ie)},[Ie]);const Jt=async()=>{try{if(!a)return;const e=be(ve(I,"deletedTransactions"),Q("userId","==",a.uid),Q("permanent","==",!0)),[n,l,r]=await Promise.all([E.getUserTransactions(a.uid).catch(()=>[]),E.getByUserId(a.uid).catch(()=>[]),je(e).then(o=>o.docs.flatMap(y=>{const h=y.data();return[h.originalTransactionId,h.transactionId,h.reference,y.id].filter(Boolean).map(String)})).catch(()=>[])]),s=Array.isArray(n)&&n.length>0?n:Array.isArray(l)?l:[],i=new Set(r),d=(s||[]).map(o=>({...o,createdAt:o.createdAt instanceof Date?o.createdAt:new Date(o.createdAt)})).filter(o=>!((o==null?void 0:o.type)==="report"||((o==null?void 0:o.title)||"").includes("إيصال تسليم وردية"))).filter(o=>{const y=String(o.id||""),h=String(o.transactionId||""),g=String(o.reference||o.transactionReference||"");return!i.has(y)&&(!h||!i.has(h))&&(!g||!i.has(g))}),x=a!=null&&a.uid?E.getLocalReceipts(a.uid):[],u=[...d,...Array.isArray(x)?x:[]],b=o=>{var y;return String((o==null?void 0:o.transactionId)||(o==null?void 0:o.id)||(o==null?void 0:o.reference)||(o==null?void 0:o.transactionReference)||((y=o==null?void 0:o.receipt)==null?void 0:y.reference)||`${new Date((o==null?void 0:o.createdAt)||Date.now()).getTime()}`)},S=new Set,w=u.filter(o=>{const y=b(o);return S.has(y)?!1:(S.add(y),!0)});k(w.map(We))}catch(e){console.error("خطأ في تحميل معاملات المستخدم من Firestore:",e),v({title:"فشل جلب معاملات المستخدم",description:"قد تكون المشكلة صلاحيات Firestore أو اتصال الشبكة. سيتم عرض المتاح محليًا إن وُجد. جرّب تسجيل الدخول مجددًا أو افتح صفحة اختبار المصادقة.",variant:"destructive"})}},Yt=async()=>{try{if(!a)return;const n=(await le.getDeletedTransactionsByUser(a.uid)).map(l=>({...l,createdAt:l.createdAt instanceof Date?l.createdAt:new Date(l.createdAt)}));Y(n.map(We))}catch(e){console.error("خطأ في تحميل المعاملات المحذوفة من Firestore:",e),v({title:"فشل جلب المعاملات المحذوفة",description:"تحقق من الصلاحيات والاتصال. يمكن مراجعة صفحة اختبار المصادقة للتشخيص.",variant:"destructive"})}},ie=oe.useMemo(()=>{const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1),l=new Date(e.getFullYear(),e.getMonth()+1,1);return[...R].sort((s,i)=>{const p=s.createdAt instanceof Date?s.createdAt.getTime():0;return(i.createdAt instanceof Date?i.createdAt.getTime():0)-p}).filter(s=>s.createdAt>=n&&s.createdAt<l)},[R]),Zt=oe.useMemo(()=>{const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1),l=new Date(e.getFullYear(),e.getMonth()+1,1);return Math.max(0,((R==null?void 0:R.length)||0)-(R||[]).filter(r=>r.createdAt>=n&&r.createdAt<l).length)},[R==null?void 0:R.length]),ct=ie.filter(e=>{const n=!Z||e.senderPhone.includes(Z)||e.receiverPhone.includes(Z),l=!G||e.createdAt.toDateString()===new Date(G).toDateString(),r=!V||e.createdAt.toTimeString().startsWith(V);return n&&l&&r}),dt=(e,n)=>{switch(e){case"completed":return t.jsx(Us,{className:`h-4 w-4 ${n==="withdraw"?"text-red-500":"text-green-500"}`});case"pending":return t.jsx(de,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return t.jsx(Fs,{className:"h-4 w-4 text-red-500"});default:return t.jsx(de,{className:"h-4 w-4 text-gray-500"})}},_e=e=>{switch(e){case"completed":return"مكتمل";case"pending":return"قيد المراجعة";case"cancelled":return"ملغي";default:return"غير معروف"}},We=e=>{const n=((e==null?void 0:e.status)??"").toString().toLowerCase(),l=n==="confirmed"||n==="success"||n==="completed"?"completed":n==="failed"||n==="error"||n==="cancelled"||n==="canceled"?"cancelled":"pending",r=((e==null?void 0:e.type)??(e==null?void 0:e.txnType)??"").toString().toLowerCase();let s="send";r==="withdraw"?s="withdraw":r==="cash_addition"||r==="add"?s="cash_addition":s="send";const i=(e==null?void 0:e.senderPhone)??(e==null?void 0:e.senderMsisdn)??(e==null?void 0:e.sender_msisdn)??(e==null?void 0:e.sender)??(e==null?void 0:e.from)??"",p=(e==null?void 0:e.receiverPhone)??(e==null?void 0:e.receiverMsisdn)??(e==null?void 0:e.receiver_msisdn)??(e==null?void 0:e.receiver)??(e==null?void 0:e.to)??"",d=e==null?void 0:e.createdAt,x=d instanceof Date?d:d!=null&&d.toDate?d.toDate():new Date(d);return{id:e==null?void 0:e.id,senderPhone:i||"غير معروف",receiverPhone:p||"غير معروف",amount:Number((e==null?void 0:e.amount)??0),status:l,type:s,createdAt:x,provider:(e==null?void 0:e.provider)??void 0,commission:(e==null?void 0:e.commission)??void 0,withdrawnAmount:(e==null?void 0:e.withdrawnAmount)??void 0,sentAmount:(e==null?void 0:e.sentAmount)??void 0,fromWallet:(e==null?void 0:e.fromWallet)??(e==null?void 0:e.walletId)??void 0,cashierName:(e==null?void 0:e.cashierName)??(e==null?void 0:e.createdByName)??(e==null?void 0:e.cashier)??void 0,commissionMode:(e==null?void 0:e.commissionMode)??(e==null?void 0:e.commission_mode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,walletEffectAppliedOnCreation:(e==null?void 0:e.walletEffectAppliedOnCreation)??(e==null?void 0:e.effectsAppliedOnCreation)??(e==null?void 0:e.effectAppliedOnCreation)??!1,cashEffectAppliedOnCreation:(e==null?void 0:e.cashEffectAppliedOnCreation)??!1,fee:(e==null?void 0:e.fee)??void 0,senderName:(e==null?void 0:e.senderName)??(e==null?void 0:e.customerName)??void 0,title:(e==null?void 0:e.title)??void 0,description:(e==null?void 0:e.description)??void 0}},Kt=e=>{const n=String((e==null?void 0:e.provider)||"").toLowerCase(),l=n.includes("vodafone")?"vf-cash":n.includes("instapay")?"instapay":"",r=String(e.description||""),s=String(e.title||""),i=r.includes("تحويل مكنه")||r.includes("تحويل مكينه")||r.includes("machine transfer")||s.includes("تحويل مكنه")||s.includes("تحويل مكينه"),p=e.type==="send"?"تحويل":"سحب";let d=e.type==="withdraw"&&l?`${p} ${l}`:p;return i?d="تحويل مكينه":e.title&&(d=e.title),{id:e.id,type:i||e.type==="send"?"transfer":"withdraw",sender_msisdn:e.senderPhone,receiver_msisdn:e.receiverPhone,amount:e.amount,commission:e.commission||0,status:e.status==="cancelled"?"failed":e.status,createdAt:e.createdAt.toISOString(),updatedAt:e.createdAt.toISOString(),shopName:te??(j==null?void 0:j.shopName)??(a==null?void 0:a.displayName)??"المحل",cashierName:(e==null?void 0:e.cashierName)??null,commissionMode:(e==null?void 0:e.commissionMode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,fee:(e==null?void 0:e.fee)??void 0,note:(e==null?void 0:e.note)??(e==null?void 0:e.notes)??void 0,senderName:(e==null?void 0:e.senderName)??void 0,provider:(e==null?void 0:e.provider)??void 0,title:d,description:e.description}},Me=e=>{const n=Kt(e);Gt(n),Ee(!0)},Qt=e=>{T(e),N(!0)},es=async()=>{c&&(await ts(c.id),N(!1),T(null))},ts=async e=>{try{const n=M.find(s=>s.id===e);if(!n||!a)return;const l=await E.saveUserTransaction(a.uid,{...n,userId:a.uid,status:"completed",cashierName:n.cashierName??"الحساب الرئيسي"});await le.permanentlyDeleteTransaction(e,a.uid);const r={...n,id:l};k(s=>[...s,r]),Y(s=>s.filter(i=>i.id!==e)),v({title:"تم الاسترجاع",description:"تم استرجاع الإيصال إلى حسابك."})}catch(n){console.error("خطأ في استرجاع المعاملة من Firestore:",n),v({title:"فشل الاسترجاع",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},ss=async e=>{try{if(!a)return;Y(n=>n.filter(l=>l.id!==e)),await le.permanentlyDeleteTransaction(e,a.uid),await E.removeUserTransaction(a.uid,e),v({title:"تم الحذف نهائيًا",description:"الإيصال لن يعود بعد التحديث."})}catch(n){console.error("فشل الحذف النهائي للمعاملة:",n),v({title:"خطأ في الحذف النهائي",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},mt=async e=>{var n,l,r;try{const s=R.find(h=>h.id===e);if(!s||!a)return;try{const h=(n=f==null?void 0:f.subscription)==null?void 0:n.planType;if(h===W.ZERO){const{dailyOperationCountService:g}=await X(async()=>{const{dailyOperationCountService:U}=await import("./dailyOperationCountService-CUlR8gDE.js");return{dailyOperationCountService:U}},__vite__mapDeps([0,1,2]),import.meta.url),O=s.type==="send"?"transfer":"withdraw";if(!(await g.checkAndIncrement(a.uid,O,5)).allowed){v({title:"تم بلوغ حد باقة الزيرو",description:"مسموح بحد أقصى 5 تأكيدات يوميًا للتحويل/السحب. جرّب غدًا أو قم بالترقية.",variant:"destructive"});return}}else if(h===W.TAHWEELA){const{dailyOperationCountService:g}=await X(async()=>{const{dailyOperationCountService:U}=await import("./dailyOperationCountService-CUlR8gDE.js");return{dailyOperationCountService:U}},__vite__mapDeps([0,1,2]),import.meta.url),O=s.type==="send"?"transfer":"withdraw";if(!(await g.checkAndIncrementCombined(a.uid,O,40)).allowed){v({title:"تم بلوغ حد باقة تحويله",description:"هذه الباقة تسمح بحد أقصى 40 عملية تحويل/سحب يومياً.",variant:"destructive"});return}}}catch(h){console.warn("تعذر التحقق من حد التأكيد اليومي:",h)}const i=await Fe.getById(a.uid);if(!(i!=null&&i.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const p=H(I,"dashboardData",i.shopId),d=await $(p);let x=d.exists()?Number(((l=d.data())==null?void 0:l.cashBalance)||0):0;const u=d.exists()?((r=d.data())==null?void 0:r.walletBalances)||{}:{},b=s.fromWallet||Object.keys(u)[0],S=!!(s!=null&&s.limitsReservedOnCreation),w=Number(s.withdrawnAmount??s.sentAmount??s.amount??0),o=s.type==="send"?"transfer":"withdraw";try{const{walletDailyLimitsService:h}=await X(async()=>{const{walletDailyLimitsService:O}=await import("./index-mBSeGJ8K.js").then(L=>L.cJ);return{walletDailyLimitsService:O}},__vite__mapDeps([1,2]),import.meta.url),g=await h.canPerformOperation(b,w,o);if(!S&&!g.canPerform){v({title:"تجاوز الحدود",description:String(g.message||"لا يمكن الإكمال لتجاوز الحد اليومي/الشهري"),variant:"destructive"});return}}catch{v({title:"فشل التحقق من الحدود",description:"حاول مجددًا بعد قليل",variant:"destructive"});return}let y=!1;if(s.type==="withdraw"){const h=s.fromWallet||Object.keys(u)[0],g=Number(s.withdrawnAmount??s.amount??0),O=Number(s.commission??0),L=!!(s!=null&&s.walletEffectAppliedOnCreation),U=!!(s!=null&&s.cashEffectAppliedOnCreation);if(!L&&h&&g>0){const Be=u[h]||0;u[h]=Be+g}U?x=x+g:x=x-g,y=!0,await Ne(p,{cashBalance:x,walletBalances:u})}else if(s.type==="send"){const h=Number(s.commission??0),g=Number((s==null?void 0:s.fee)??0),O=Number((s==null?void 0:s.sentAmount)??(s==null?void 0:s.transferredAmount)??s.amount??0),L=Math.max(0,O)+Math.max(0,g);L>0&&(x=x+L,await Ne(p,{cashBalance:x}),y=!0)}await Ne(H(I,"userTransactions",e),{status:"completed",confirmedAt:new Date});try{const h=s.fromWallet||Object.keys(u)[0],g=Number(s.withdrawnAmount??s.sentAmount??s.amount??0);if(h&&g>0&&!S){const{walletDailyLimitsService:O}=await X(async()=>{const{walletDailyLimitsService:L}=await import("./index-mBSeGJ8K.js").then(U=>U.cJ);return{walletDailyLimitsService:L}},__vite__mapDeps([1,2]),import.meta.url);await O.updateUsage(h,g,s.type==="send"?"transfer":"withdraw")}}catch{v({title:"فشل تحديث الحدود",description:"تجاوز حد اليوم/الشهر يمنع الإكمال",variant:"destructive"});return}try{const{ProfitService:h}=await X(async()=>{const{ProfitService:L}=await import("./profitService-B3iovAHD.js");return{ProfitService:L}},__vite__mapDeps([3,1,2]),import.meta.url),g=h.calculateProfitFromTransaction({type:s.type==="send"?"transfer":"withdraw",amount:Number(s.amount||0),commission:Number(s.commission||0),fee:Number((s==null?void 0:s.fee)||0)});!!!(s!=null&&s.profitAddedOnCreation)&&g>0&&h.addProfit(g,a==null?void 0:a.uid)}catch{}k(h=>h.map(g=>g.id===e?{...g,status:"completed"}:g)),v({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),Ee(!1)}catch(s){console.error("خطأ في إكمال المعاملة:",s),v({title:"فشل الإكمال",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},pt=async e=>{var n,l;try{const r=R.find(i=>i.id===e);if(!r||!a)return;k(i=>i.filter(p=>p.id!==e)),Y(i=>[{...r},...i]);let s=r.status;try{let i={};try{const u=await $(H(I,"userTransactions",e));if(i=u.exists()?u.data():{},i!=null&&i.status){const b=String(i.status).toLowerCase();b==="completed"||b==="confirmed"||b==="success"?s="completed":b==="pending"?s="pending":(b==="cancelled"||b==="failed")&&(s="cancelled")}}catch{}const p=e,d=String((i==null?void 0:i.transactionId)||(r==null?void 0:r.transactionId)||p),x=String((i==null?void 0:i.reference)||(i==null?void 0:i.transactionReference)||(r==null?void 0:r.reference)||(r==null?void 0:r.transactionReference)||"");await E.removeUserTransaction(a.uid,e),await le.saveDeletedTransaction({...r,userId:a.uid,originalTransactionId:e,transactionId:d,reference:x||void 0,permanent:!0});try{await le.permanentlyDeleteTransaction(e,a.uid)}catch{}}catch(i){console.warn("تعذر الحذف النهائي من قواعد البيانات في هذه الخطوة، سيتم الحذف من لائحة المحذوفات عند التنفيذ اليدوي للحذف النهائي:",i)}try{const i=await Fe.getById(a.uid);if(!(i!=null&&i.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const p=H(I,"dashboardData",i.shopId),d=await $(p);let x=d.exists()?Number(((n=d.data())==null?void 0:n.cashBalance)||0):0;const u=d.exists()?((l=d.data())==null?void 0:l.walletBalances)||{}:{},b=Number(r.withdrawnAmount??r.amount??0),S=Number(r.commission??0),w=r.fromWallet||Object.keys(u)[0],o=!!(r!=null&&r.walletEffectAppliedOnCreation);if(r.type==="send"){const y=Number(r.fee??0),h=Number((r==null?void 0:r.sentAmount)??(r==null?void 0:r.transferredAmount)??r.amount??0);if(s==="completed"&&(x=x-(h+y)),w&&h>0){const g=u[w]||0;u[w]=g+h}}else if(r.type==="withdraw"){if(s==="completed"){if(x=x+b,w&&b>0){const y=u[w]||0;u[w]=y-b}}else if(w&&o&&b>0){const y=u[w]||0;u[w]=y-b}}await Ne(p,{cashBalance:x,walletBalances:u})}catch(i){console.warn("فشل عكس تأثير الأرصدة محليًا:",i)}try{const i=r.fromWallet;if(i){const{walletDailyLimitsService:p}=await X(async()=>{const{walletDailyLimitsService:u}=await import("./index-mBSeGJ8K.js").then(b=>b.cJ);return{walletDailyLimitsService:u}},__vite__mapDeps([1,2]),import.meta.url),d=Number(r.withdrawnAmount??r.sentAmount??r.amount??0),x=r.type==="send"?"transfer":"withdraw";await p.rollbackUsage(i,d,x,r.createdAt)}}catch(i){console.warn("فشل استرجاع حدود المحفظة:",i)}try{const{ProfitService:i}=await X(async()=>{const{ProfitService:b}=await import("./profitService-B3iovAHD.js");return{ProfitService:b}},__vite__mapDeps([3,1,2]),import.meta.url),{ReportsService:p}=await X(async()=>{const{ReportsService:b}=await import("./index-mBSeGJ8K.js").then(S=>S.cI);return{ReportsService:b}},__vite__mapDeps([1,2]),import.meta.url),x={txnType:r.type==="send"?"send":"receive",amount:r.amount,commission:r.commission||0,createdAt:r.createdAt,status:"confirmed"},u=i.calculateProfitFromTransaction(x);u>0&&i.addProfit(-u,a.uid);try{p.removeTransactionEffects(r,a.uid)}catch{}}catch(i){console.warn("فشل تحديث التقارير/الأرباح بعد الحذف:",i)}}catch(r){console.error("خطأ أثناء حذف الإيصال:",r)}},ut=m.useRef(!1),ht=ms();m.useEffect(()=>{!(new URLSearchParams(ht.search).get("autoTestBalances")==="1")||ut.current||(ut.current=!0,(async()=>{var l,r,s,i,p,d;try{if(!a)return;const x=await Fe.getById(a.uid);if(!(x!=null&&x.shopId)){console.warn("autoTest: لا يوجد shopId للمستخدم، سيتم إيقاف الاختبار.");return}const u=H(I,"dashboardData",x.shopId),b=await $(u),S=b.exists()?Number(((l=b.data())==null?void 0:l.cashBalance)||0):0,w=b.exists()?((r=b.data())==null?void 0:r.walletBalances)||{}:{},o=Object.keys(w)[0]||void 0,y=100,h=5,g=await E.saveUserTransaction(a.uid,{senderPhone:"auto-test-sender",receiverPhone:"auto-test-receiver",amount:y,status:"pending",type:"withdraw",createdAt:new Date,reference:`AUTO-${Date.now()}`,commission:h,withdrawnAmount:y,fromWallet:o,cashierName:"AutoTest",commissionMode:"add",totalCharged:y+h,walletEffectAppliedOnCreation:!1});console.log("autoTest: تم إنشاء إيصال سحب تجريبي:",g),await mt(g);const O=await $(u),L=O.exists()?Number(((s=O.data())==null?void 0:s.cashBalance)||0):0,U=O.exists()?((i=O.data())==null?void 0:i.walletBalances)||{}:{},Be=S-y+h,rs=o?Number(w[o]||0)+y:void 0;console.log("autoTest: توقع الدرج بعد الإكمال:",Be,"فعلي:",L),o&&console.log("autoTest: توقع المحفظة بعد الإكمال:",rs,"فعلي:",U[o]),await pt(g);const ye=await $(u),ns=ye.exists()?Number(((p=ye.data())==null?void 0:p.cashBalance)||0):0,is=ye.exists()?((d=ye.data())==null?void 0:d.walletBalances)||{}:{};console.log("autoTest: تحقق نهائي — الدرج قبل/بعد الحذف:",S,ns),o&&console.log("autoTest: تحقق نهائي — المحفظة قبل/بعد الحذف:",w[o]||0,is[o]||0),v({title:"اختبار الأرصدة (Firestore فقط)",description:"تم إنشاء/إكمال/حذف إيصال تجريبي والتحقق من الأرصدة.",variant:"default"})}catch(x){console.error("autoTest: فشل اختبار الأرصدة:",x),v({title:"فشل اختبار الأرصدة",description:"تحقق من الاتصال ووجود shopId والمحافظ في Firestore.",variant:"destructive"})}})())},[ht.search,a]);const as=async()=>{var l,r,s;const e="alkaptin678678@gmail.com",n=(r=(l=$e.currentUser)==null?void 0:l.email)==null?void 0:r.toLowerCase();if(!n||n!==e){v({title:"قيد الإنشاء",description:"ميزة الشحن متاحة لهذا الحساب فقط حالياً."});return}if(!fe||!ne||!ge){v({title:"بيانات ناقصة",description:"يرجى إدخال رقم وشركة والمبلغ",variant:"destructive"});return}ot(!0);try{const p={vodafone_eg:"Vodafone",orange_eg:"Orange",etisalat_eg:"Etisalat",we_eg:"WE"}[ne]??ne,d=new AbortController,x=setTimeout(()=>d.abort(),15e3),u=await((s=$e.currentUser)==null?void 0:s.getIdToken()),b=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...u?{Authorization:`Bearer ${u}`}:{}},body:JSON.stringify({phone:fe,countryCode:"EG",operator:p,amount:Number(ge),useLocalAmount:!0}),signal:d.signal});clearTimeout(x);const S=await b.text();let w;try{w=JSON.parse(S)}catch{w={success:!1,message:S||"فشل قراءة استجابة الخادم"}}b.ok&&(w!=null&&w.success)?(v({title:"تم الشحن",description:(w==null?void 0:w.message)||"تم تنفيذ عملية الشحن بنجاح"}),xe(!1),at(""),rt(""),nt("")):v({title:"فشل الشحن",description:(w==null?void 0:w.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(i){console.error("Topup request error:",i),(i==null?void 0:i.name)==="AbortError"?v({title:"انتهت المهلة",description:"الخادم لم يستجب في الوقت المحدد. تأكد أن السيرفر يعمل.",variant:"destructive"}):v({title:"خطأ في الاتصال",description:"تعذر الاتصال بالخادم. حاول لاحقاً.",variant:"destructive"})}finally{ot(!1)}};return t.jsxs("div",{className:"fixed inset-0 overscroll-y-none overflow-y-auto bg-background p-4",children:[t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs(A,{variant:"ghost",size:"sm",onClick:()=>D("/user/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800",children:[t.jsx(Bs,{className:"h-4 w-4"}),"العودة"]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"المعاملات"})]}),t.jsxs(ps,{className:"card-modern fade-in-up",children:[t.jsxs(us,{className:"pb-2 px-3 pt-3",children:[t.jsx(hs,{className:"text-sm font-bold",children:"المعاملات الأخيرة"}),t.jsxs("div",{className:"flex items-center gap-0.5 mt-1 relative",children:[t.jsxs("div",{className:"flex items-center gap-0.5 flex-1 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[t.jsx(Cs,{className:"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors"}),t.jsx(Ue,{placeholder:"بحث...",value:Z,onChange:e=>se(e.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400"})]}),t.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:Xt,title:"شرح التطبيق",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(Gs,{className:"h-2.5 w-2.5"}),_t&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-600 rounded-full"})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شرح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 hover:border-purple-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(q||J){v({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"});return}C(!0)},title:"إدارة التقسيط",children:t.jsx(xs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تقسيط"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Hs,{userId:a==null?void 0:a.uid,transactions:R}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"أرباح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:scale-105",onClick:()=>F(!0),title:"آلة حاسبة",children:t.jsx(_s,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"حاسبة"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 hover:border-green-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(q){v({title:"الخطة الحالية لا تسمح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية."});return}Wt(!0)},title:"بيانات المبيعات",children:t.jsx(Ws,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مبيعات"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(A,{variant:"ghost",size:"sm",className:`h-5 w-5 p-0 rounded border transition-all duration-200 hover:scale-105 ${G||V?"bg-purple-100 text-purple-600 border-purple-300":"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200 hover:border-purple-300"}`,onClick:()=>Mt(!0),title:"اختيار التاريخ",children:[t.jsx(Rt,{className:"h-2.5 w-2.5"}),(G||V)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-purple-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تاريخ"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 hover:border-orange-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(q){v({title:"الخطة الحالية لا تسمح",description:"إدارة الديون غير متاحة في خطة زيرو. قم بالترقية."});return}Pe(!0)},title:"إدارة الديون",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(fs,{className:"h-2.5 w-2.5"}),lt>0&&t.jsx("div",{className:"absolute -top-1 -right-1 z-10 min-w-[12px] h-[12px] px-[2px] bg-red-600 text-white rounded-full text-[8px] leading-[12px] flex items-center justify-center pointer-events-none ring-1 ring-white",children:lt})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"ديون"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(q){v({title:"الخطة الحالية لا تسمح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية."});return}tt(!0)},title:"الصيانة",children:t.jsx(gs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"صيانه"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-violet-50 text-violet-600 hover:bg-violet-100 border border-violet-200 hover:border-violet-300 transition-all duration-200 hover:scale-105",onClick:()=>{D("/user/dashboard",{state:{openCashierShiftModal:!0}})},title:"يومية المكنة",children:t.jsx(zs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"المكنة"})]}),t.jsxs("div",{className:"hidden sm:flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(q){v({title:"الخطة الحالية لا تسمح",description:"الفيز الائتمانية غير متاحة في خطة زيرو. قم بالترقية."});return}et(!0)},title:"الفيز الائتمانية",children:t.jsx(ys,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"فيز"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105 relative",onClick:()=>{ue(!0)},title:"تصفير المعاملات الأخيرة",children:[t.jsx(Dt,{className:"h-2.5 w-2.5"}),Zt>0&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تصفير"})]}),(Z||G||V)&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:()=>{se(""),me(""),P("")},title:"مسح",children:t.jsx("span",{className:"text-[10px] font-bold",children:"×"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مسح"})]})]})]})]}),t.jsx(bs,{className:"px-3 pb-3",children:t.jsxs(Ss,{value:_,onValueChange:Re,className:"w-full",children:[t.jsxs(ks,{className:"hidden sm:grid w-full grid-cols-4 h-10 text-sm bg-gradient-to-r from-gray-50 via-blue-50/30 to-purple-50/30 border border-gray-200/60 rounded-md p-1 shadow-sm relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 opacity-0 hover:opacity-100 transition-all duration-200"}),t.jsxs(Te,{value:"all",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-blue-200/50 hover:bg-blue-50/80 hover:text-blue-700 group",children:[t.jsx("span",{className:"relative z-10",children:"الكل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(Te,{value:"send",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-green-200/50 hover:bg-green-50/80 hover:text-green-700 group",children:[t.jsx("span",{className:"relative z-10",children:"مرسل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(Te,{value:"withdraw",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-orange-200/50 hover:bg-orange-50/80 hover:text-orange-700 group",children:[t.jsx("span",{className:"relative z-10",children:"سحب"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-orange-500/10 to-amber-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(Te,{value:"deleted",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-rose-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-red-200/50 hover:bg-red-50/80 hover:text-red-700 group",children:[t.jsx("span",{className:"relative z-10",children:"محذوف"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-500/10 to-rose-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]})]}),t.jsx(Ae,{value:"all",className:"mt-2 receipts-list",children:ct.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ct.map((e,n)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>Me(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[dt(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:`font-medium text-sm ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[B(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-red-600",children:["عمولة: ",B(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:`text-[10px] ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:`text-sm ${e.type==="withdraw"?"text-red-500":"text-green-600"}`,children:e.createdAt.toLocaleString("en-GB")})]})]}),t.jsxs("div",{className:"text-right",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-green-700",children:[B(e.amount)," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",B(e.withdrawnAmount)," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",B(e.sentAmount)," جنيه"]}),t.jsx(Ds,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?e.type==="withdraw"?"bg-red-100 text-red-800 border-red-300":e.type==="send"?"bg-green-100 text-green-800 border-green-300":"":e.type==="withdraw"?"bg-red-100 text-red-800":""}`,children:e.type==="withdraw"?"سحب":_e(e.status)})]})]},e.id))})}),t.jsx(Ae,{value:"send",className:"mt-2 receipts-list",children:ie.filter(e=>e.type==="send").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات إرسال محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ie.filter(e=>e.type==="send").map((e,n)=>t.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-card border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>Me(e),children:[t.jsx("div",{className:"h-12 w-12 rounded-full flex items-center justify-center shrink-0 bg-green-50",children:t.jsx(Ms,{className:"h-6 w-6 text-green-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h4",{className:"text-base font-bold text-foreground truncate",children:e.receiverPhone}),t.jsxs("span",{className:"text-base font-bold text-green-600 whitespace-nowrap",children:["- ",B(e.amount)," ج.م"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["إلى: ",e.receiverPhone]}),t.jsx("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:e.createdAt.toLocaleString("ar-EG",{day:"numeric",month:"short",hour:"numeric",minute:"numeric",hour12:!0})})]}),t.jsxs("div",{className:`px-2.5 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${e.status==="completed"?"bg-green-50 text-green-700":e.status==="pending"?"bg-yellow-50 text-yellow-700":"bg-red-50 text-red-700"}`,children:[e.status==="completed"&&t.jsx(Ct,{className:"h-3 w-3"}),e.status==="pending"&&t.jsx(de,{className:"h-3 w-3"}),e.status==="failed"&&t.jsx(St,{className:"h-3 w-3"}),t.jsx("span",{children:_e(e.status)})]})]})]})]},e.id))})}),t.jsx(Ae,{value:"withdraw",className:"mt-2 receipts-list",children:ie.filter(e=>e.type==="withdraw").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات سحب محفوظة بعد"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ie.filter(e=>e.type==="withdraw").map((e,n)=>t.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-card border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>Me(e),children:[t.jsx("div",{className:"h-12 w-12 rounded-full flex items-center justify-center shrink-0 bg-red-50",children:t.jsx(Ve,{className:"h-6 w-6 text-red-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h4",{className:"text-base font-bold text-foreground truncate",children:e.receiverPhone}),t.jsxs("span",{className:"text-base font-bold text-red-600 whitespace-nowrap",children:["+ ",B(e.amount)," ج.م"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["من: ",e.senderPhone]}),t.jsx("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:e.createdAt.toLocaleString("ar-EG",{day:"numeric",month:"short",hour:"numeric",minute:"numeric",hour12:!0})})]}),t.jsxs("div",{className:`px-2.5 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${e.status==="completed"?"bg-red-50 text-red-700":e.status==="pending"?"bg-yellow-50 text-yellow-700":"bg-red-50 text-red-700"}`,children:[e.status==="completed"&&t.jsx(Ct,{className:"h-3 w-3"}),e.status==="pending"&&t.jsx(de,{className:"h-3 w-3"}),e.status==="failed"&&t.jsx(St,{className:"h-3 w-3"}),t.jsx("span",{children:_e(e.status)})]})]})]})]},e.id))})}),t.jsx(Ae,{value:"deleted",className:"mt-2",children:M.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محذوفة"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:M.map((e,n)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[dt(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[B(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-500",children:["عمولة: ",B(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"text-right mr-2",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[B(e.amount)," جنيه"]}),t.jsx(StatusChip,{variant:"error",text:"محذوف"})]}),t.jsx(A,{variant:"ghost",size:"sm",className:"text-green-600 hover:bg-green-100 h-10 sm:h-12 px-4 sm:px-5 min-w-[44px] touch-manipulation",onClick:()=>Qt(e),children:t.jsx("span",{className:"text-xs sm:text-sm",children:"استرجاع"})}),t.jsx(A,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 h-10 sm:h-12 px-3 sm:px-4 min-w-[44px] touch-manipulation",onClick:()=>ss(e.id),children:t.jsx(Dt,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})]},e.id))})})]})})]}),t.jsx(De,{open:Et,onOpenChange:Je,children:t.jsxs(Ce,{className:"dialog-modern max-w-3xl w-full p-0 overflow-hidden border-0 shadow-2xl",children:[t.jsx(Se,{className:"px-4 pt-4",children:t.jsx(ke,{className:"text-lg font-bold",children:Lt||"شرح التطبيق"})}),t.jsx("div",{className:"aspect-video w-full bg-black",children:Ye?t.jsx("iframe",{src:Ht(Ye),title:"Application Guide",className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0}):t.jsx("div",{className:"flex items-center justify-center h-full text-white/80",children:"لا يوجد فيديو متاح حالياً"})})]})}),t.jsx(Es,{open:Ft,onOpenChange:tt})]}),t.jsx(Ps,{isOpen:zt,onClose:()=>et(!1)}),t.jsx(Ge,{open:Bt,onOpenChange:Pe,mode:"verify",title:"الرقم السري الرئيسي لفتح الديون",description:"أدخل الرقم السري الرئيسي لفتح صفحة الديون",onSuccess:()=>{Pe(!1),D("/user",{state:{openDebtDialog:!0}})}}),t.jsx(vs,{open:Vt,onOpenChange:ue,title:"تأكيد كلمة المرور لإخفاء المعاملات السابقة من العرض",description:"سيتم إخفاء كل المعاملات السابقة من شاشة المعاملات والتقارير فقط، ولن تُحذف نهائيًا من حسابك أو من Firebase.",onSuccess:async()=>{try{if(!(a!=null&&a.uid)){ue(!1);return}const e=new Date,n=l=>l instanceof Date?l:typeof(l==null?void 0:l.toDate)=="function"?l.toDate():new Date(String(l));await E.updateUserData(a.uid,{recentReset:{keepLastCount:st.keepLastCount??30,intervalDays:st.intervalDays??7,lastResetAt:e}}),he(l=>({...l,lastResetAt:e})),v({title:"تم إخفاء المعاملات السابقة",description:"تم إخفاء كل الإيصالات الأقدم من وقت التصفير من العرض بدون التأثير على التقارير اليومية/الشهرية أو الحدود."})}catch(e){console.error("فشل تنفيذ التصفير النهائي:",e),v({title:"فشل التصفير",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}finally{ue(!1)}}}),t.jsx(De,{open:qt,onOpenChange:e=>{var n,l;if(e){const r="alkaptin678678@gmail.com",s=(l=(n=$e.currentUser)==null?void 0:n.email)==null?void 0:l.toLowerCase();if(!s||s!==r){v({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."});return}xe(!0)}else xe(!1)},children:t.jsxs(Ce,{dir:"rtl",className:"sm:max-w-md",children:[t.jsx(Se,{children:t.jsx(ke,{children:"شحن رصيد الموبايل"})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"رقم الموبايل"}),t.jsx(Ue,{value:fe,onChange:e=>at(e.target.value),placeholder:"01XXXXXXXXX",dir:"ltr"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"الشركة"}),t.jsxs(Ns,{value:ne,onValueChange:rt,children:[t.jsx(ws,{className:"w-full",children:t.jsx(Ts,{placeholder:"اختر الشركة"})}),t.jsxs(As,{children:[t.jsx(we,{value:"vodafone_eg",children:"فودافون"}),t.jsx(we,{value:"orange_eg",children:"أورنج"}),t.jsx(we,{value:"etisalat_eg",children:"اتصالات"}),t.jsx(we,{value:"we_eg",children:"WE"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"المبلغ بالجنيه"}),t.jsx(Ue,{type:"number",min:1,value:ge,onChange:e=>nt(e.target.value?Number(e.target.value):""),placeholder:"50"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-2",children:[t.jsx(A,{variant:"outline",onClick:()=>xe(!1),children:"إلغاء"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(A,{variant:"secondary",onClick:()=>D("/topup"),children:"صفحة الشحن الكاملة"}),t.jsx(A,{onClick:as,disabled:it||!fe||!ne||!ge,children:it?"جارٍ التنفيذ...":"تأكيد الشحن"})]})]})]})]})}),t.jsx(De,{open:Oe,onOpenChange:N,children:t.jsxs(Ce,{className:"sm:max-w-[460px]",children:[t.jsxs(Se,{children:[t.jsx(ke,{children:"تأكيد استرجاع الإيصال"}),t.jsx(js,{children:"سيتم إعادة الإيصال إلى قائمة المعاملات الحالية."})]}),c&&t.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"المبلغ"}),t.jsxs("span",{className:"font-bold",children:[c.amount," جنيه"]})]}),c.type==="withdraw"?t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"العميل"}),t.jsx("span",{className:"font-medium",children:c.receiverPhone})]}):t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"من → إلى"}),t.jsxs("span",{className:"font-medium",children:[c.senderPhone," → ",c.receiverPhone]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"الكاشير"}),t.jsx("span",{className:"font-medium",children:c.cashierName??"الحساب الرئيسي"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"التاريخ"}),t.jsx("span",{className:"font-medium",children:c.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3",children:[t.jsx(A,{variant:"outline",onClick:()=>{N(!1),T(null)},children:"إلغاء"}),t.jsx(A,{onClick:es,children:"تأكيد الاسترجاع"})]})]})}),t.jsx(Os,{isOpen:Ut,onClose:()=>Ee(!1),transaction:$t,onPrint:()=>window.print(),onDelete:pt,onComplete:mt}),t.jsx(Ge,{open:K,onOpenChange:C,mode:"verify",title:"فتح إدارة التقسيط",description:"أدخل الرقم السري الرئيسي للوصول إلى إدارة التقسيط",onSuccess:()=>{C(!1),qe(!0)}}),t.jsx(Rs,{open:Pt,onOpenChange:qe})]})};export{Ta as default};
//# sourceMappingURL=TransactionsPage-vZbFUf7u.js.map
