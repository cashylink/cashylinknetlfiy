const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-CHyvkdwe.js","./index-CF_cwj-9.css","./freeTrialService-CSbqfZaj.js"])))=>i.map(i=>d[i]);
import{$ as we,V as $,t as D,ar as z,E as Ye,q as se,aI as Ee,s as X,x as xe,D as kr,b as Ar,m as Ta,r,j as e,c as Xe,d as os,e as ds,M as _s,g as Je,f as Er,a4 as Cr,y as Us,P as _a,I as gs,B as H,J as Dr,K as Tr,i as Ua,ax as La,a5 as y,au as Le,U as ct,C as ve,bN as xs,R as Ls,aW as _r,G as Ur,bZ as Be,S as cs,H as ot,aZ as ua,aF as Lr,c7 as Ir,v as Rr,T as ga,at as pa,af as Es,ag as Cs,ah as Ds,ai as Ts,aS as at,aL as Ae,w as Fr,c8 as Pr,aO as B,c5 as Mr,c9 as Or,ca as Ia,X as Vr,aU as $r,aY as Br,a2 as rt,o as Qe,cb as lt,aQ as Ra,z as Yr,A as Hr,_ as zr,cc as Fa,cd as Gr,a0 as dt,a as Wr,u as qr,b0 as Qr,p as Zr}from"./index-CHyvkdwe.js";import{I as Kr,u as Xr,g as ba,s as Jr,l as el}from"./contentService-eGqn7LRB.js";import{P as sl}from"./ProfileIcon-DR9RBlJs.js";import{T as tl}from"./textarea-ymmQWf49.js";import{S as al}from"./switch-Ng20LGJl.js";import{A as rl,a as ll}from"./alert-DmwNL_E4.js";import{B as ke}from"./badge-C_UcFznF.js";import{S as nl}from"./separator-DRRInuxb.js";import{R as ms}from"./refresh-cw-Do-H4KwK.js";import{S as Ze}from"./save-C1HQozbU.js";import{C as Pa,G as Ue}from"./gift-DHr_lcMf.js";import{E as il,p as cl}from"./broadcastService-CIt5XDVt.js";import{B as Ke}from"./bell-BuLjh4AU.js";import{C as pe}from"./calendar-CvcoBvx3.js";import{S as xt,a as mt,b as ht,c as ut,d as ge}from"./select-VBB5jzA0.js";import{Z as ps}from"./zap-CQDfOuq_.js";import{C as hs}from"./crown-DiWo4O6v.js";import{S as ol}from"./star-qDE6mYRi.js";import{C as us}from"./circle-check-big-uv2lkbPR.js";import{T as fa,a as ja,b as Ve,c as de,d as ya,e as ee}from"./table-SHLQOguK.js";import{T as dl,a as xl,b as Na,c as va,S as $e}from"./tabs-B0OQD0l8.js";import{S as ml}from"./square-pen-Cud2vy-2.js";import{U as is,C as hl}from"./users-Qcw8yGaM.js";import{A as wa}from"./activity-CFRzuke8.js";import{D as nt}from"./download-CSyWgRqg.js";import{M as Sa}from"./monitor-C_mK4him.js";import{P as ul}from"./pen-line-ChKy8rIm.js";import"./dropdown-menu-CZzBeEST.js";import"./index-BZ_s4N2Q.js";import"./freeTrialService-CSbqfZaj.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gl=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],pl=we("funnel",gl);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bl=[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]],ka=we("git-branch",bl);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fl=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],Aa=we("hard-drive",fl);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jl=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],yl=we("menu",jl);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nl=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Ea=we("shield-check",Nl);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vl=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],it=we("upload",vl);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wl=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],gt=we("user-check",wl);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sl=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],kl=we("user-x",Sl);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Al=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],El=we("volume-2",Al);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cl=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],Dl=we("volume-x",Cl),Ca={generateCode:async i=>{const l="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let u="";for(let S=0;S<8;S++)u+=l.charAt(Math.floor(Math.random()*l.length));const f=`${u.substring(0,4)}-${u.substring(4)}`;return await kr(X(D,"branchActivationCodes"),{code:f,isUsed:!1,createdAt:Ye(),createdBy:i}),f},getAllCodes:async()=>{const i=se(X(D,"branchActivationCodes"));return(await xe(i)).docs.map(u=>({id:u.id,...u.data()})).sort((u,f)=>{var m,_;const S=(m=u.createdAt)!=null&&m.toMillis?u.createdAt.toMillis():0;return((_=f.createdAt)!=null&&_.toMillis?f.createdAt.toMillis():0)-S})},validateCode:async i=>{const l=se(X(D,"branchActivationCodes"),Ee("code","==",i)),u=await xe(l);if(u.empty)throw new Error("كود التفعيل غير صحيح");const f=u.docs[0].data(),S=u.docs[0].id;if(f.isUsed)throw new Error("تم استخدام هذا الكود مسبقاً");return{...f,docId:S}},markCodeAsUsed:async(i,l,u)=>{const f=$(D,"branchActivationCodes",i);await z(f,{isUsed:!0,usedAt:Ye(),usedBy:l,createdShopId:u})}},Tl=()=>{const{settings:i,loading:l,error:u,updateSettings:f,refreshSettings:S}=Ar(),{toast:b}=Ta(),[m,_]=r.useState({phoneNumber:"",defaultMessage:"",isEnabled:!0}),[N,R]=r.useState(!1),[T,o]=r.useState(!1),[A,g]=r.useState(""),[h,c]=r.useState({});r.useEffect(()=>{i&&_({phoneNumber:i.phoneNumber,defaultMessage:i.defaultMessage,isEnabled:i.isEnabled})},[i]);const C=()=>{var O,Z;const E={};return(O=m.phoneNumber)!=null&&O.trim()?La(m.phoneNumber)||(E.phoneNumber="رقم الواتساب غير صحيح (يجب أن يحتوي على 10-15 رقم)"):E.phoneNumber="رقم الواتساب مطلوب",(Z=m.defaultMessage)!=null&&Z.trim()?m.defaultMessage.length<10&&(E.defaultMessage="الرسالة يجب أن تحتوي على 10 أحرف على الأقل"):E.defaultMessage="الرسالة الافتراضية مطلوبة",c(E),Object.keys(E).length===0},v=async()=>{if(!C()){b({title:"خطأ في البيانات",description:"يرجى تصحيح الأخطاء قبل الحفظ",variant:"destructive"});return}R(!0);try{if(await f(m))b({title:"تم الحفظ بنجاح",description:"تم تحديث إعدادات الواتساب بنجاح",variant:"default"});else throw new Error("فشل في الحفظ")}catch{b({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ الإعدادات",variant:"destructive"})}finally{R(!1)}},j=()=>{if(m.phoneNumber&&m.defaultMessage)try{const E=Ua(m.phoneNumber,m.defaultMessage);g(E),o(!0)}catch{b({title:"خطأ في المعاينة",description:"تأكد من صحة رقم الواتساب",variant:"destructive"})}},k=async()=>{try{await navigator.clipboard.writeText(A),b({title:"تم النسخ",description:"تم نسخ الرابط إلى الحافظة",variant:"default"})}catch{b({title:"خطأ في النسخ",description:"فشل في نسخ الرابط",variant:"destructive"})}},U=E=>{const O=E.replace(/[^\d+]/g,"");_(Z=>({...Z,phoneNumber:O})),h.phoneNumber&&c(Z=>({...Z,phoneNumber:""}))};return l?e.jsxs(Xe,{children:[e.jsx(os,{children:e.jsxs(ds,{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"h-5 w-5"}),"إدارة الواتساب"]})}),e.jsx(Je,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ms,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"mr-2",children:"جاري التحميل..."})]})})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(Xe,{children:[e.jsxs(os,{children:[e.jsxs(ds,{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"h-5 w-5"}),"إدارة الواتساب"]}),e.jsx(Er,{children:"إدارة رقم الواتساب والرسائل الافتراضية المعروضة في جميع أنحاء الموقع"})]}),e.jsxs(Je,{className:"space-y-6",children:[u&&e.jsxs(rl,{variant:"destructive",children:[e.jsx(Cr,{className:"h-4 w-4"}),e.jsx(ll,{children:u})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${m.isEnabled?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"حالة خدمة الواتساب"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.isEnabled?"مفعلة":"معطلة"})]})]}),e.jsx(al,{checked:m.isEnabled,onCheckedChange:E=>_(O=>({...O,isEnabled:E}))})]}),e.jsx(nl,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Us,{htmlFor:"phoneNumber",className:"flex items-center gap-2",children:[e.jsx(_a,{className:"h-4 w-4"}),"رقم الواتساب"]}),e.jsx(gs,{id:"phoneNumber",type:"tel",placeholder:"مثال: 201000392539",value:m.phoneNumber,onChange:E=>U(E.target.value),className:h.phoneNumber?"border-red-500":"",dir:"ltr"}),h.phoneNumber&&e.jsx("p",{className:"text-sm text-red-500",children:h.phoneNumber}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"أدخل رقم الواتساب مع رمز الدولة (مثال: 201000392539 لمصر)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Us,{htmlFor:"defaultMessage",children:"الرسالة الافتراضية"}),e.jsx(tl,{id:"defaultMessage",placeholder:"مرحباً، أريد الاستفسار عن خدماتكم",value:m.defaultMessage,onChange:E=>{_(O=>({...O,defaultMessage:E.target.value})),h.defaultMessage&&c(O=>({...O,defaultMessage:""}))},className:h.defaultMessage?"border-red-500":"",rows:4}),h.defaultMessage&&e.jsx("p",{className:"text-sm text-red-500",children:h.defaultMessage}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"هذه الرسالة ستظهر افتراضياً عند النقر على أزرار الواتساب"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(H,{onClick:v,disabled:N,className:"flex items-center gap-2",children:[N?e.jsx(ms,{className:"h-4 w-4 animate-spin"}):e.jsx(Ze,{className:"h-4 w-4"}),N?"جاري الحفظ...":"حفظ التغييرات"]}),e.jsxs(H,{variant:"outline",onClick:j,disabled:!m.phoneNumber||!m.defaultMessage,className:"flex items-center gap-2",children:[T?e.jsx(Dr,{className:"h-4 w-4"}):e.jsx(Tr,{className:"h-4 w-4"}),"معاينة الرابط"]}),e.jsxs(H,{variant:"outline",onClick:S,className:"flex items-center gap-2",children:[e.jsx(ms,{className:"h-4 w-4"}),"تحديث"]})]}),T&&A&&e.jsxs(Xe,{className:"bg-muted/50",children:[e.jsx(os,{children:e.jsx(ds,{className:"text-lg",children:"معاينة رابط الواتساب"})}),e.jsxs(Je,{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-background rounded border font-mono text-sm break-all",children:A}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(H,{variant:"outline",size:"sm",onClick:k,className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"h-4 w-4"}),"نسخ الرابط"]}),e.jsxs(H,{variant:"outline",size:"sm",onClick:()=>window.open(A,"_blank"),className:"flex items-center gap-2",children:[e.jsx(il,{className:"h-4 w-4"}),"فتح في الواتساب"]})]})]})]}),i&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"معلومات الإعدادات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"آخر تحديث:"}),e.jsxs(ke,{variant:"outline",className:"mr-2",children:[i.lastUpdated.toLocaleDateString("ar-EG")," - ",i.lastUpdated.toLocaleTimeString("ar-EG")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),e.jsx(ke,{variant:i.isEnabled?"default":"secondary",className:"mr-2",children:i.isEnabled?"مفعل":"معطل"})]})]})]})]})]})})},Is={enableVisualAlerts:!0,enableAudioAlerts:!0,criticalDays:1,warningDays:3,infoDays:7},_l=i=>{const l=new Date,f=new Date(i).getTime()-l.getTime();return Math.ceil(f/(1e3*60*60*24))},Ul=(i,l=Is)=>i<0?"expired":i<=l.criticalDays?"critical":i<=l.warningDays?"warning":(i<=l.infoDays,"info"),Ll=(i,l,u)=>{const f=Il(u);return l<0?`انتهت صلاحية اشتراك ${f} للمستخدم ${i}`:l===0?`ينتهي اشتراك ${f} للمستخدم ${i} اليوم!`:l===1?`ينتهي اشتراك ${f} للمستخدم ${i} غداً`:`ينتهي اشتراك ${f} للمستخدم ${i} خلال ${l} أيام`},Il=i=>{switch(i){case y.MONTHLY:return"الشهري";case y.YEARLY:return"السنوي";case y.LIFETIME:return"مدى الحياة";default:return"غير محدد"}},Rl=async()=>{try{const i=X(D,"users"),l=se(i,Ee("subscription","!=",null)),u=await xe(l),f=[];return u.forEach(S=>{var m,_,N,R;const b=S.data();b.subscription&&(b.subscription.planType||b.subscription.plan)&&f.push({id:S.id,...b,subscription:{...b.subscription,startDate:((_=(m=b.subscription.startDate)==null?void 0:m.toDate)==null?void 0:_.call(m))||new Date(b.subscription.startDate),endDate:((R=(N=b.subscription.endDate)==null?void 0:N.toDate)==null?void 0:R.call(N))||new Date(b.subscription.endDate),planType:b.subscription.planType||b.subscription.plan}})}),f}catch(i){return console.error("خطأ في جلب الاشتراكات النشطة:",i),[]}},Fl=async(i=Is)=>{try{const l=await Rl(),u=[];return l.forEach(f=>{if(!f.subscription||!f.subscription.endDate)return;const S=_l(f.subscription.endDate),b=Ul(S,i);if(S<=i.infoDays||S<0){const m={id:`${f.id}_${Date.now()}`,userId:f.id,userName:f.displayName||f.email||"مستخدم غير معروف",userEmail:f.email||"",subscriptionPlan:f.subscription.planType,expiryDate:f.subscription.endDate,daysRemaining:S,type:b,message:Ll(f.displayName||f.email||"مستخدم غير معروف",S,f.subscription.planType),isRead:!1,createdAt:new Date};u.push(m)}}),u.sort((f,S)=>{const b={expired:0,critical:1,warning:2,info:3};return b[f.type]!==b[S.type]?b[f.type]-b[S.type]:f.daysRemaining-S.daysRemaining}),u}catch(l){return console.error("خطأ في إنشاء إشعارات الاشتراك:",l),[]}},Pl=(i,l)=>l?i.filter(u=>u.type===l):i,Ml=i=>{localStorage.setItem("notificationSettings",JSON.stringify(i))},Ol=()=>{try{const i=localStorage.getItem("notificationSettings");if(i)return{...Is,...JSON.parse(i)}}catch(i){console.error("خطأ في تحميل إعدادات الإشعارات:",i)}return Is},Vl=({isOpen:i,onClose:l})=>{const[u,f]=r.useState([]),[S,b]=r.useState([]),[m,_]=r.useState("all"),[N,R]=r.useState(!0),[T,o]=r.useState(Ol());r.useEffect(()=>{i&&A()},[i]),r.useEffect(()=>{b(m==="all"?u:Pl(u,m))},[u,m]);const A=async()=>{R(!0);try{const j=await Fl(T);f(j)}catch(j){console.error("خطأ في تحميل الإشعارات:",j)}finally{R(!1)}},g=j=>{switch(j){case"urgent":return e.jsx(xs,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(ve,{className:"w-5 h-5 text-yellow-500"});case"info":return e.jsx(Ke,{className:"w-5 h-5 text-blue-500"});default:return e.jsx(Ke,{className:"w-5 h-5 text-gray-500"})}},h=j=>{switch(j){case"urgent":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}},c=j=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(j),C=j=>{switch(j){case"all":return"جميع الإشعارات";case"urgent":return"عاجل (يوم واحد)";case"warning":return"تحذير (3 أيام)";case"info":return"معلومات (7 أيام)";default:return"غير محدد"}},v=j=>{const k={...T,[j]:!T[j]};o(k),Ml(k)};return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ke,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-xl font-bold",children:"مركز الإشعارات"}),u.length>0&&e.jsx("span",{className:"bg-white text-blue-600 px-2 py-1 rounded-full text-sm font-medium",children:u.length})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(Le,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pl,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"تصفية حسب:"})]}),["all","urgent","warning","info"].map(j=>e.jsx("button",{onClick:()=>_(j),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${m===j?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:C(j)},j))]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"الإعدادات:"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T.visualAlerts,onChange:()=>v("visualAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات المرئية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T.soundAlerts,onChange:()=>v("soundAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات الصوتية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T.autoRefresh,onChange:()=>v("autoRefresh"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التحديث التلقائي"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-96",children:N?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"جاري تحميل الإشعارات..."})]}):S.length===0?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(Ke,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"لا توجد إشعارات"}),e.jsx("p",{className:"text-gray-500",children:m==="all"?"لا توجد إشعارات حاليًا":`لا توجد إشعارات من نوع "${C(m)}"`})]}):e.jsx("div",{className:"p-4 space-y-3",children:S.map(j=>e.jsx("div",{className:`p-4 rounded-lg border-r-4 ${h(j.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[g(j.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:j.message}),e.jsx("span",{className:"text-xs text-gray-500",children:c(j.createdAt)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"المستخدم:"})," ",j.userName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"تاريخ الانتهاء:"})," ",c(j.expiryDate)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",j.daysRemaining]})]})]})]})]})},j.id))})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["آخر تحديث: ",c(new Date)]}),e.jsx("button",{onClick:A,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"تحديث الإشعارات"})]})})]})}):null},$l=({notification:i,onClose:l,soundEnabled:u,onToggleSound:f})=>{const[S,b]=r.useState(!1),[m,_]=r.useState(null);r.useEffect(()=>{if(i&&(b(!0),u&&N(i.type),i.type!=="urgent")){const g=setTimeout(()=>{R()},1e4);return()=>clearTimeout(g)}},[i,u]),r.useEffect(()=>{typeof window<"u"&&window.AudioContext&&_(new AudioContext)},[]);const N=g=>{if(!(!m||!u))try{const h=m.createOscillator(),c=m.createGain();switch(h.connect(c),c.connect(m.destination),g){case"urgent":h.frequency.setValueAtTime(800,m.currentTime),h.frequency.setValueAtTime(1e3,m.currentTime+.1),h.frequency.setValueAtTime(800,m.currentTime+.2),c.gain.setValueAtTime(.3,m.currentTime),c.gain.exponentialRampToValueAtTime(.01,m.currentTime+.5),h.start(m.currentTime),h.stop(m.currentTime+.5);break;case"warning":h.frequency.setValueAtTime(600,m.currentTime),h.frequency.setValueAtTime(700,m.currentTime+.15),c.gain.setValueAtTime(.2,m.currentTime),c.gain.exponentialRampToValueAtTime(.01,m.currentTime+.3),h.start(m.currentTime),h.stop(m.currentTime+.3);break;case"info":h.frequency.setValueAtTime(400,m.currentTime),c.gain.setValueAtTime(.1,m.currentTime),c.gain.exponentialRampToValueAtTime(.01,m.currentTime+.2),h.start(m.currentTime),h.stop(m.currentTime+.2);break}}catch(h){console.error("خطأ في تشغيل الصوت:",h)}},R=()=>{b(!1),setTimeout(()=>{l()},300)},T=g=>{switch(g){case"urgent":return{bg:"bg-red-500",border:"border-red-600",text:"text-white",icon:e.jsx(xs,{className:"w-6 h-6"}),pulse:"animate-pulse"};case"warning":return{bg:"bg-yellow-500",border:"border-yellow-600",text:"text-white",icon:e.jsx(ve,{className:"w-6 h-6"}),pulse:""};case"info":return{bg:"bg-blue-500",border:"border-blue-600",text:"text-white",icon:e.jsx(Ke,{className:"w-6 h-6"}),pulse:""};default:return{bg:"bg-gray-500",border:"border-gray-600",text:"text-white",icon:e.jsx(Ke,{className:"w-6 h-6"}),pulse:""}}},o=g=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric"}).format(g);if(!i)return null;const A=T(i.type);return e.jsxs("div",{className:"fixed top-4 right-4 z-[9999]",children:[e.jsxs("div",{className:`
          transform transition-all duration-300 ease-in-out
          ${S?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
          ${A.bg} ${A.border} ${A.text} ${A.pulse}
          border-2 rounded-lg shadow-2xl max-w-md min-w-80
          backdrop-blur-sm
        `,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white border-opacity-20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[A.icon,e.jsxs("h3",{className:"font-bold text-lg",children:[i.type==="urgent"&&"تنبيه عاجل!",i.type==="warning"&&"تحذير",i.type==="info"&&"إشعار"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:f,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",title:u?"إيقاف الصوت":"تشغيل الصوت",children:u?e.jsx(El,{className:"w-4 h-4"}):e.jsx(Dl,{className:"w-4 h-4"})}),e.jsx("button",{onClick:R,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",children:e.jsx(Le,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-lg font-medium mb-3",children:i.message}),e.jsxs("div",{className:"space-y-2 text-sm opacity-90",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"المستخدم:"})," ",i.userName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"تاريخ انتهاء الاشتراك:"})," ",o(i.expiryDate)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",i.daysRemaining," يوم"]})]})]}),i.type==="urgent"&&e.jsx("div",{className:"h-1 bg-white bg-opacity-20",children:e.jsx("div",{className:"h-full bg-white animate-pulse",style:{animation:"progress 10s linear forwards"}})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes progress {
          from { width: 100%; }
          to { width: 0%; }
        }
      `})]})},Bl=({user:i,onActivateSubscription:l,onRequestActivation:u,onDeactivateSubscription:f,onDeleteUser:S,onUpdateSessionLimit:b})=>{var ae;const[m,_]=r.useState(y.MONTHLY),[N,R]=r.useState(!1),[T,o]=r.useState(""),[A,g]=r.useState(""),h=_r(),c=i.sessionLimit,C=i.sessionLimitDisabled===!0,[v,j]=r.useState(()=>C?"2":typeof c=="number"&&c>0?String(c):"2"),[k,U]=r.useState(C);r.useEffect(()=>{const w=i.sessionLimit,I=i.sessionLimitDisabled===!0;U(I),I?j("2"):typeof w=="number"&&w>0?j(String(w)):j("2")},[i]);const E=w=>{const I=w==null?void 0:w.displayName;if(typeof I=="string"&&I.trim())return I.trim();if(I&&typeof I=="object"){const te=I.full_name||I.name||I.ar||I.en;if(typeof te=="string"&&te.trim())return te.trim()}return typeof(w==null?void 0:w.email)=="string"&&w.email.includes("@")?w.email.split("@")[0]:"غير محدد"},O=w=>{switch(w){case y.LIFETIME:return e.jsx(hs,{className:"w-4 h-4 text-yellow-500"});case y.YEARLY:return e.jsx(Ue,{className:"w-4 h-4 text-blue-500"});case y.QUARTERLY:return e.jsx(pe,{className:"w-4 h-4 text-purple-500"});case y.MONTHLY:return e.jsx(ps,{className:"w-4 h-4 text-green-500"});case y.FIVE_MINUTES:return e.jsx(ve,{className:"w-4 h-4 text-orange-500"});case y.ZERO:return e.jsx(ot,{className:"w-4 h-4 text-gray-500"});case y.TAHWEELA:return e.jsx(ua,{className:"w-4 h-4 text-blue-600"});case y.BRANCH:return e.jsx(ct,{className:"w-4 h-4 text-indigo-500"});default:return null}},Z=w=>{if(!w)return"غير محدد";const I=Ir(w);return I?I.toLocaleDateString("ar-EG"):"تاريخ غير صالح"};return e.jsx(Xe,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(Je,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ct,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:E(i)}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(Ur,{className:"w-3 h-3 ml-1"}),i.email]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[e.jsx(_a,{className:"w-3 h-3 ml-1"}),i.phone||"غير محدد"]})]})]}),e.jsx("div",{className:`px-2 py-0.5 rounded-[8px] text-xs font-medium border ${i.isActive?"bg-green-50 text-green-700 border-green-200":"bg-secondary/10 text-secondary border-secondary/20"}`,children:i.isActive?"نشط":"غير نشط"})]}),i.subscription&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[O(i.subscription.planType),e.jsx("span",{className:"text-sm font-medium",children:Be(i.subscription.planType)})]}),e.jsx(ke,{variant:i.subscription.isActive?"default":"destructive",children:i.subscription.isActive?"مفعل":"منتهي"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(pe,{className:"w-3 h-3 ml-1"}),"البداية: ",Z(i.subscription.startDate)]}),i.subscription.endDate&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(pe,{className:"w-3 h-3 ml-1"}),"النهاية: ",Z(i.subscription.endDate)]})]})]}),e.jsxs("div",{className:"space-y-3",children:[b&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border border-dashed border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-800",children:"حد عدد الأجهزة"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:w=>U(w.target.checked)}),e.jsx("span",{children:"سماح بعدد غير محدود من الأجهزة"})]}),!k&&e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx("input",{type:"number",min:1,value:v,onChange:w=>j(w.target.value),className:"w-20 rounded-md border border-gray-300 px-2 py-1 text-xs text-center"}),e.jsx("span",{className:"text-xs text-gray-600",children:"أجهزة كحد أقصى"})]}),e.jsx(H,{size:"sm",className:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{const w=parseInt(v,10),I=isNaN(w)||w<1?1:w,te=k?null:I;b(i.id,{sessionLimit:te,sessionLimitDisabled:k})},children:"حفظ"})]})]}),l&&N&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"اختر نوع الباقة:"}),h?e.jsxs("select",{className:"w-full h-10 border border-input bg-background rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring",value:m,onChange:w=>_(w.target.value),children:[e.jsx("option",{value:y.MONTHLY,children:"شهرية"}),e.jsx("option",{value:y.QUARTERLY,children:"ربع سنوية"}),e.jsx("option",{value:y.HALF_YEARLY,children:"نصف سنوية"}),e.jsx("option",{value:y.YEARLY,children:"سنوية"}),e.jsx("option",{value:y.LIFETIME,children:"مدى الحياة"}),e.jsx("option",{value:y.FIVE_MINUTES,children:"5 دقايق"}),e.jsx("option",{value:y.ZERO,children:"زيرو"}),e.jsx("option",{value:y.TAHWEELA,children:"تحويله"})]}):e.jsxs(xt,{value:m,onValueChange:w=>_(w),children:[e.jsx(mt,{className:"w-full",children:e.jsx(ht,{placeholder:"اختر نوع الباقة"})}),e.jsxs(ut,{children:[e.jsx(ge,{value:y.MONTHLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{children:"شهرية"})]})}),e.jsx(ge,{value:y.QUARTERLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{children:"ربع سنوية"})]})}),e.jsx(ge,{value:y.YEARLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{children:"سنوية"})]})}),e.jsx(ge,{value:y.LIFETIME,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Kr,{className:"w-4 h-4"}),e.jsx("span",{children:"مدى الحياة"})]})}),e.jsx(ge,{value:y.FIVE_MINUTES,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{children:"5 دقايق"})]})}),e.jsx(ge,{value:y.ZERO,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ot,{className:"w-4 h-4"}),e.jsx("span",{children:"زيرو"})]})}),e.jsx(ge,{value:y.TAHWEELA,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ua,{className:"w-4 h-4"}),e.jsx("span",{children:"تحويله"})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[e.jsxs("div",{children:[e.jsx(Us,{className:"text-xs mb-1 block",children:"تاريخ البدء (اختياري)"}),e.jsx(gs,{type:"date",value:T,onChange:w=>o(w.target.value),className:"h-8 text-sm bg-white"})]}),e.jsxs("div",{children:[e.jsx(Us,{className:"text-xs mb-1 block",children:"تاريخ الانتهاء (اختياري)"}),e.jsx(gs,{type:"date",value:A,onChange:w=>g(w.target.value),className:"h-8 text-sm bg-white"})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx(H,{size:"sm",onClick:()=>{const w=T?new Date(T):void 0,I=A?new Date(A):void 0;l(i.id,m,w,I),R(!1),o(""),g("")},className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:"تأكيد التفعيل"}),e.jsx(H,{size:"sm",variant:"outline",onClick:()=>R(!1),className:"flex-1",children:"إلغاء"})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[(l||u)&&!N&&e.jsx(H,{size:"sm",variant:"outline",onClick:()=>u?u(i):R(!0),className:"flex-1",children:(ae=i.subscription)!=null&&ae.isActive?"تعديل الاشتراك":"تفعيل الاشتراك"}),f&&e.jsx(H,{size:"sm",variant:"outline",onClick:()=>f(i.id),className:"flex-1",children:"إلغاء الاشتراك"}),S&&e.jsx(H,{size:"sm",variant:"destructive",onClick:()=>S(i.id),children:e.jsx(Lr,{className:"w-4 h-4"})})]})]})]})})},Yl=Ls.memo(Bl),Hl=[{id:y.MONTHLY,name:"شهرية",icon:ps,color:"text-green-600",bg:"bg-green-50",border:"border-green-200"},{id:y.QUARTERLY,name:"ربع سنوية",icon:pe,color:"text-purple-600",bg:"bg-purple-50",border:"border-purple-200"},{id:y.HALF_YEARLY,name:"نصف سنوية",icon:ol,color:"text-rose-600",bg:"bg-rose-50",border:"border-rose-200"},{id:y.YEARLY,name:"سنوية",icon:Ue,color:"text-blue-600",bg:"bg-blue-50",border:"border-blue-200"},{id:y.LIFETIME,name:"مدى الحياة",icon:hs,color:"text-yellow-600",bg:"bg-yellow-50",border:"border-yellow-200"},{id:y.FIVE_MINUTES,name:"5 دقايق",icon:ve,color:"text-orange-600",bg:"bg-orange-50",border:"border-orange-200"},{id:y.ZERO,name:"زيرو",icon:ot,color:"text-gray-600",bg:"bg-gray-50",border:"border-gray-200"},{id:y.TAHWEELA,name:"تحويله",icon:ms,color:"text-indigo-600",bg:"bg-indigo-50",border:"border-indigo-200"}],zl={[y.MONTHLY]:{from:"from-blue-50",to:"to-indigo-50",ring:"ring-blue-300"},[y.QUARTERLY]:{from:"from-purple-50",to:"to-pink-50",ring:"ring-purple-300"},[y.HALF_YEARLY]:{from:"from-rose-50",to:"to-pink-50",ring:"ring-rose-300"},[y.YEARLY]:{from:"from-sky-50",to:"to-blue-50",ring:"ring-blue-300"},[y.LIFETIME]:{from:"from-yellow-50",to:"to-amber-50",ring:"ring-amber-300"},[y.FIVE_MINUTES]:{from:"from-orange-50",to:"to-red-50",ring:"ring-orange-300"},[y.ZERO]:{from:"from-gray-50",to:"to-slate-100",ring:"ring-gray-300"},[y.TAHWEELA]:{from:"from-indigo-50",to:"to-violet-50",ring:"ring-indigo-300"}},Gl=i=>{const l=i==null?void 0:i.displayName;if(typeof l=="string"&&l.trim())return l.trim();if(l&&typeof l=="object"){const u=l.full_name||l.name||l.ar||l.en;if(typeof u=="string"&&u.trim())return u.trim()}return typeof(i==null?void 0:i.email)=="string"&&i.email.includes("@")?i.email.split("@")[0]:"مستخدم"},Wl=({isOpen:i,onClose:l,user:u,onActivate:f})=>{var g,h;const[S,b]=r.useState(y.MONTHLY),[m,_]=r.useState(""),[N,R]=r.useState(""),[T,o]=r.useState(!1);Ls.useEffect(()=>{i&&(b(y.MONTHLY),_(""),R(""),o(!1))},[i,u]);const A=async()=>{if(!T){o(!0);try{const c=m?new Date(m):void 0,C=N?new Date(N):void 0;await f(u.id,S,c,C)}catch(c){console.error("Activation failed",c),o(!1)}}};return!i||!u?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 transition-opacity duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-xl shadow-xl transform transition-all flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(ps,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800",children:(g=u==null?void 0:u.subscription)!=null&&g.isActive?"تعديل اشتراك المستخدم":"تفعيل اشتراك جديد"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["للمستخدم: ",Gl(u)]})]})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-100 p-1",children:e.jsx(Le,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Hl.map(c=>{const C=zl[c.id],v=S===c.id;return e.jsxs("div",{onClick:()=>b(c.id),className:`rounded-xl p-4 border shadow-sm bg-gradient-to-br ${C.from} ${C.to} cursor-pointer transition-all ${v?`ring-2 ${C.ring}`:"hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/70 flex items-center justify-center",children:e.jsx(c.icon,{className:`w-5 h-5 ${c.color}`})}),v&&e.jsx(us,{className:`w-5 h-5 ${c.color}`})]}),e.jsx("div",{className:"font-bold text-gray-800",children:c.name}),v&&e.jsx("div",{className:`text-xs font-medium ${c.color}`,children:"تم الاختيار"})]},c.id)})}),e.jsxs("div",{className:"mt-6 border-t border-gray-100 pt-4",children:[e.jsxs("h5",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-500"}),"تخصيص مدة الاشتراك (اختياري)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1.5",children:"تاريخ البدء"}),e.jsx("input",{type:"date",value:m,onChange:c=>_(c.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 text-sm focus:ring-2 focus:ring-blue-100 focus:border-blue-400 outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1.5",children:"تاريخ الانتهاء"}),e.jsx("input",{type:"date",value:N,onChange:c=>R(c.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 text-sm focus:ring-2 focus:ring-blue-100 focus:border-blue-400 outline-none transition-all"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 bg-gray-50 rounded-b-xl border-t border-gray-100 flex-shrink-0",children:[e.jsx("button",{onClick:l,disabled:T,className:"px-5 py-2.5 rounded-lg border border-gray-300 bg-white text-gray-700 font-medium hover:bg-gray-50 focus:ring-2 focus:ring-gray-200 transition-all disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{onClick:A,disabled:T,className:"px-5 py-2.5 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 shadow-lg shadow-blue-600/20 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[T?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(us,{className:"w-5 h-5"}),T?"جاري الحفظ...":(h=u==null?void 0:u.subscription)!=null&&h.isActive?"حفظ التعديلات":"تفعيل الاشتراك"]})]})]})})},Da=[{value:y.MONTHLY,label:"باقة شهرية"},{value:y.QUARTERLY,label:"باقة ربع سنوية"},{value:y.HALF_YEARLY,label:"باقة نصف سنوية"},{value:y.YEARLY,label:"باقة سنوية"},{value:y.LIFETIME,label:"باقة مدى الحياة"}],ql=()=>{const[i,l]=r.useState([]),[u,f]=r.useState(!0),[S,b]=r.useState(""),[m,_]=r.useState(null),[N,R]=r.useState(!1),[T,o]=r.useState({status:"",packageName:""}),[A,g]=r.useState(!1),[h,c]=r.useState(null),[C,v]=r.useState(!1),[j,k]=r.useState(null),[U,E]=r.useState("requests"),[O,Z]=r.useState([]),[ae,w]=r.useState(!1),[I,te]=r.useState(""),[be,fe]=r.useState(!1),{toast:F}=Ta();r.useEffect(()=>{const p=se(X(D,"reseller_requests"),Rr("createdAt","desc")),V=ga(p,Se=>{const bs=Se.docs.map(Re=>({id:Re.id,...Re.data()}));l(bs),f(!1)},Se=>{console.error("Error fetching reseller requests:",Se),f(!1)}),he=se(X(D,"users"),Ee("isResellerEnabled","==",!0)),ce=ga(he,Se=>{const bs=Se.docs.map(Re=>({id:Re.id,...Re.data()}));Z(bs)});return()=>{V(),ce()}},[]);const Ce=async()=>{if(!I.trim()){F({title:"خطأ",description:"يرجى إدخال البريد الإلكتروني",variant:"destructive"});return}fe(!0);try{const p=X(D,"users"),V=se(p,Ee("email","==",I.trim()),Fr(1)),he=await xe(V);if(he.empty){F({title:"خطأ",description:"لم يتم العثور على مستخدم بهذا البريد الإلكتروني",variant:"destructive"}),fe(!1);return}const ce=he.docs[0];await z($(D,"users",ce.id),{isResellerEnabled:!0}),F({title:"تم التفعيل",description:"تم تفعيل نظام الريسيلر لهذا الحساب بنجاح"}),w(!1),te("")}catch(p){console.error("Error activating reseller:",p),F({title:"خطأ",description:"حدث خطأ أثناء التفعيل",variant:"destructive"})}finally{fe(!1)}},M=async p=>{if(window.confirm("هل أنت متأكد من تعطيل نظام الريسيلر لهذا الحساب؟"))try{await z($(D,"users",p),{isResellerEnabled:!1}),F({title:"تم التعطيل",description:"تم تعطيل نظام الريسيلر للحساب"})}catch(V){console.error("Error deactivating reseller:",V),F({title:"خطأ",description:"حدث خطأ أثناء التعطيل",variant:"destructive"})}},G=p=>{_(p),o({status:p.status,packageName:p.packageName||""}),R(!0)},je=async()=>{if(m)try{const p={status:T.status,packageName:T.packageName};let V=null,he=!1;if(T.status==="active"&&T.packageName){const ce=new Date,Se=Pr(T.packageName,ce);p.startDate=ce,p.endDate=Se,he=!0,V={planType:T.packageName,startDate:ce,endDate:Se,isActive:!0,activatedAt:ce}}else T.status!=="active"&&(he=!1,V={isActive:!1});if(await z($(D,"reseller_requests",m.id),p),m.uid){const ce={isActive:he,updatedAt:new Date};V&&(ce.subscription=V),await z($(D,"users",m.uid),ce)}F({title:"تم التحديث",description:"تم تحديث حالة الحساب وتفعيل الباقة بنجاح"}),R(!1)}catch(p){console.error("Error updating request:",p),F({title:"خطأ",description:"حدث خطأ أثناء التحديث",variant:"destructive"})}},re=async p=>{if(window.confirm("هل أنت متأكد من حذف هذا الطلب؟"))try{await Ae($(D,"reseller_requests",p)),F({title:"تم الحذف",description:"تم حذف الطلب بنجاح"})}catch{F({title:"خطأ",description:"حدث خطأ أثناء الحذف",variant:"destructive"})}},Ie=p=>{c(p),g(!0)},ie=async()=>{if(h)try{await Ae($(D,"reseller_requests",h.id)),h.uid&&await z($(D,"users",h.uid),{isActive:!1,role:"user"}),F({title:"تم القبول",description:"تم قبول طلب الحذف وإزالة الحساب من القائمة"}),g(!1)}catch(p){console.error("Error accepting delete:",p),F({title:"خطأ",description:"حدث خطأ أثناء تنفيذ الحذف",variant:"destructive"})}},le=async()=>{if(h)try{await z($(D,"reseller_requests",h.id),{deletionRequested:!1,deletionStatus:"rejected"}),F({title:"تم الرفض",description:"تم رفض طلب الحذف وإشعار المستخدم"}),g(!1)}catch(p){console.error("Error rejecting delete:",p),F({title:"خطأ",description:"حدث خطأ أثناء رفض الطلب",variant:"destructive"})}},q=p=>{k(p),v(!0)},ye=async()=>{if(j)try{await z($(D,"reseller_requests",j.id),{status:"inactive",packageName:null,startDate:null,endDate:null,cancelRequested:!1,cancelStatus:null}),j.uid&&await z($(D,"users",j.uid),{isActive:!1,"subscription.isActive":!1,"subscription.planId":null,"subscription.endDate":null}),F({title:"تم القبول",description:"تم قبول طلب إلغاء الباقة وإلغاء تفعيل الحساب"}),v(!1)}catch(p){console.error("Error accepting cancel:",p),F({title:"خطأ",description:"حدث خطأ أثناء تنفيذ الإلغاء",variant:"destructive"})}},me=async()=>{if(j)try{await z($(D,"reseller_requests",j.id),{cancelRequested:!1,cancelStatus:"rejected"}),F({title:"تم الرفض",description:"تم رفض طلب إلغاء الباقة وإشعار المستخدم"}),v(!1)}catch(p){console.error("Error rejecting cancel:",p),F({title:"خطأ",description:"حدث خطأ أثناء رفض الطلب",variant:"destructive"})}},Rs=p=>{var V;return((V=Da.find(he=>he.value===p))==null?void 0:V.label)||p||"-"},es=i.filter(p=>{var V;return p.email.toLowerCase().includes(S.toLowerCase())||((V=p.packageName)==null?void 0:V.toLowerCase().includes(S.toLowerCase()))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(dl,{defaultValue:"requests",value:U,onValueChange:E,className:"w-full",children:[e.jsxs(xl,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsx(Na,{value:"requests",children:"طلبات الحسابات الفرعية"}),e.jsx(Na,{value:"main_resellers",children:"حسابات الريسيلر الرئيسية (المفعلة)"})]}),e.jsx(va,{value:"requests",children:e.jsxs(Xe,{children:[e.jsxs(os,{className:"flex flex-row items-center justify-between",children:[e.jsx(ds,{children:"إدارة حسابات الريسيلر الفرعية"}),e.jsxs("div",{className:"relative w-64",children:[e.jsx($e,{className:"absolute right-2 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(gs,{placeholder:"بحث بالبريد الإلكتروني...",className:"pr-8",value:S,onChange:p=>b(p.target.value)})]})]}),e.jsx(Je,{children:e.jsxs(fa,{children:[e.jsx(ja,{children:e.jsxs(Ve,{children:[e.jsx(de,{className:"text-right",children:"البريد الإلكتروني"}),e.jsx(de,{className:"text-right",children:"كلمة المرور"}),e.jsx(de,{className:"text-right",children:"رقم الهاتف"}),e.jsx(de,{className:"text-right",children:"الحالة"}),e.jsx(de,{className:"text-right",children:"الباقة"}),e.jsx(de,{className:"text-right",children:"الصلاحية"}),e.jsx(de,{className:"text-right",children:"إجراءات"})]})}),e.jsx(ya,{children:u?e.jsx(Ve,{children:e.jsx(ee,{colSpan:7,className:"text-center",children:"جاري التحميل..."})}):es.length===0?e.jsx(Ve,{children:e.jsx(ee,{colSpan:7,className:"text-center",children:"لا توجد طلبات"})}):es.map(p=>{var V;return e.jsxs(Ve,{children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[p.email,p.deletionRequested&&e.jsx(ke,{variant:"destructive",className:"cursor-pointer hover:bg-red-700 animate-pulse",onClick:()=>Ie(p),children:"طلب حذف"}),p.cancelRequested&&e.jsx(ke,{className:"bg-orange-500 hover:bg-orange-600 cursor-pointer animate-pulse",onClick:()=>q(p),children:"طلب إلغاء باقة"})]})}),e.jsx(ee,{className:"font-mono text-xs",children:p.password}),e.jsx(ee,{children:p.phone||"-"}),e.jsx(ee,{children:p.status==="active"?e.jsx(ke,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"نشط"}):p.status==="pending"?e.jsx(ke,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"قيد الانتظار"}):e.jsx(ke,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"غير نشط"})}),e.jsx(ee,{children:Rs(p.packageName)}),e.jsx(ee,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["الطلب: ",(V=p.createdAt)!=null&&V.seconds?new Date(p.createdAt.seconds*1e3).toLocaleDateString("ar-SA"):"-"]}),p.status==="active"&&p.endDate&&e.jsxs("span",{className:"text-xs text-green-600 font-medium",children:["ينتهي: ",p.endDate.seconds?new Date(p.endDate.seconds*1e3).toLocaleDateString("ar-SA"):"-"]})]})}),e.jsx(ee,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:"outline",size:"sm",onClick:()=>G(p),children:e.jsx(ml,{className:"h-4 w-4"})}),e.jsx(H,{variant:"ghost",size:"sm",className:"text-red-600",onClick:()=>re(p.id),children:e.jsx(pa,{className:"h-4 w-4"})})]})})]},p.id)})})]})})]})}),e.jsx(va,{value:"main_resellers",children:e.jsxs(Xe,{children:[e.jsxs(os,{className:"flex flex-row items-center justify-between",children:[e.jsxs(ds,{className:"flex items-center gap-2",children:[e.jsx(Ea,{className:"h-5 w-5 text-blue-600"}),"حسابات الريسيلر الرئيسية المفعلة"]}),e.jsxs(Es,{open:ae,onOpenChange:w,children:[e.jsxs(Cs,{children:[e.jsx(Ds,{children:e.jsx(Ts,{children:"تفعيل نظام الريسيلر لمستخدم"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"البريد الإلكتروني للمستخدم الرئيسي"}),e.jsx(gs,{placeholder:"email@example.com",value:I,onChange:p=>te(p.target.value)})]}),e.jsx(H,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:Ce,disabled:be,children:be?"جاري التفعيل...":"تفعيل النظام"})]})]}),e.jsxs(H,{onClick:()=>w(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(gt,{className:"mr-2 h-4 w-4"}),"تفعيل حساب جديد"]})]})]}),e.jsx(Je,{children:e.jsxs(fa,{children:[e.jsx(ja,{children:e.jsxs(Ve,{children:[e.jsx(de,{className:"text-right",children:"البريد الإلكتروني"}),e.jsx(de,{className:"text-right",children:"الاسم"}),e.jsx(de,{className:"text-right",children:"تاريخ الانضمام"}),e.jsx(de,{className:"text-right",children:"الحالة"}),e.jsx(de,{className:"text-right",children:"إجراءات"})]})}),e.jsx(ya,{children:O.length===0?e.jsx(Ve,{children:e.jsx(ee,{colSpan:5,className:"text-center py-8 text-gray-500",children:"لا توجد حسابات رئيسية مفعلة حالياً"})}):O.map(p=>{var V;return e.jsxs(Ve,{children:[e.jsx(ee,{className:"font-medium",children:p.email}),e.jsx(ee,{children:p.displayName||"-"}),e.jsx(ee,{children:(V=p.createdAt)!=null&&V.seconds?new Date(p.createdAt.seconds*1e3).toLocaleDateString("ar-SA"):"-"}),e.jsx(ee,{children:e.jsxs(ke,{className:"bg-blue-100 text-blue-800 hover:bg-blue-100 flex w-fit items-center gap-1",children:[e.jsx(Ea,{className:"h-3 w-3"}),"مفعل كريسيلر"]})}),e.jsx(ee,{children:e.jsxs(H,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>M(p.id),children:[e.jsx(pa,{className:"h-4 w-4 mr-1"}),"تعطيل"]})})]},p.id)})})]})})]})})]}),e.jsx(Es,{open:N,onOpenChange:R,children:e.jsxs(Cs,{children:[e.jsx(Ds,{children:e.jsx(Ts,{children:"تعديل حالة الحساب"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"الحالة"}),e.jsxs(xt,{value:T.status,onValueChange:p=>o(V=>({...V,status:p})),children:[e.jsx(mt,{children:e.jsx(ht,{placeholder:"اختر الحالة"})}),e.jsxs(ut,{children:[e.jsx(ge,{value:"pending",children:"قيد الانتظار"}),e.jsx(ge,{value:"active",children:"نشط"}),e.jsx(ge,{value:"inactive",children:"غير نشط"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"اسم الباقة"}),e.jsxs(xt,{value:T.packageName,onValueChange:p=>o(V=>({...V,packageName:p})),children:[e.jsx(mt,{children:e.jsx(ht,{placeholder:"اختر الباقة"})}),e.jsx(ut,{children:Da.map(p=>e.jsx(ge,{value:p.value,children:p.label},p.value))})]})]})]}),e.jsxs(at,{children:[e.jsx(H,{variant:"outline",onClick:()=>R(!1),children:"إلغاء"}),e.jsx(H,{onClick:je,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"حفظ التغييرات"})]})]})}),e.jsx(Es,{open:A,onOpenChange:g,children:e.jsxs(Cs,{children:[e.jsx(Ds,{children:e.jsx(Ts,{className:"text-red-600",children:"مراجعة طلب حذف حساب"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-100",children:[e.jsx("h4",{className:"font-semibold text-red-800 mb-2",children:"سبب الحذف المقدم من المستخدم:"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:(h==null?void 0:h.deletionReason)||"لا يوجد سبب محدد"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("p",{children:["البريد الإلكتروني: ",h==null?void 0:h.email]}),e.jsxs("p",{children:["تاريخ الطلب: ",new Date().toLocaleDateString("ar-SA")]})]}),e.jsx("div",{className:"bg-yellow-50 p-3 rounded text-sm text-yellow-800 border border-yellow-200",children:"تنبيه: قبول الطلب سيؤدي إلى حذف هذا السجل من قائمة الريسيلر وتعطيل حساب المستخدم المرتبط به."})]}),e.jsxs(at,{className:"gap-2 sm:gap-0",children:[e.jsx(H,{variant:"outline",onClick:le,className:"text-red-600 border-red-200 hover:bg-red-50",children:"رفض الطلب"}),e.jsx(H,{onClick:ie,className:"bg-red-600 hover:bg-red-700 text-white",children:"قبول الحذف"})]})]})}),e.jsx(Es,{open:C,onOpenChange:v,children:e.jsxs(Cs,{children:[e.jsx(Ds,{children:e.jsx(Ts,{className:"text-orange-600",children:"مراجعة طلب إلغاء باقة"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-100",children:[e.jsx("h4",{className:"font-semibold text-orange-800 mb-2",children:"سبب الإلغاء المقدم من المستخدم:"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:(j==null?void 0:j.cancelReason)||"لا يوجد سبب محدد"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("p",{children:["البريد الإلكتروني: ",j==null?void 0:j.email]}),e.jsxs("p",{children:["تاريخ الطلب: ",new Date().toLocaleDateString("ar-SA")]})]}),e.jsx("div",{className:"bg-yellow-50 p-3 rounded text-sm text-yellow-800 border border-yellow-200",children:"تنبيه: قبول الطلب سيؤدي إلى إيقاف تفعيل الباقة والحساب فوراً."})]}),e.jsxs(at,{className:"gap-2 sm:gap-0",children:[e.jsx(H,{variant:"outline",onClick:me,className:"text-red-600 border-red-200 hover:bg-red-50",children:"رفض الطلب"}),e.jsx(H,{onClick:ye,className:"bg-orange-600 hover:bg-orange-700 text-white",children:"قبول الإلغاء"})]})]})})]})},Ql={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_VERSION:"0.0.0",VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"false",VITE_FIREBASE_API_KEY:["AI","za","SyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s"].join(""),VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_AUTH_EMULATOR_URL:"http://localhost:9099",VITE_FIREBASE_FIRESTORE_EMULATOR_HOST:"localhost:8080",VITE_FIREBASE_FUNCTIONS_EMULATOR_HOST:"localhost:5001",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.appspot.com",VITE_FORCE_HASH_ROUTER:"true",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"محل كاشي لينك التجريبي",VITE_SHOW_ENV_BANNER:"true",VITE_USE_EMULATORS:"false",VITE_USE_FIREBASE_EMULATOR:"false"},Zl=({userId:i,adminId:l})=>{const[u,f]=r.useState([]),[S,b]=r.useState(!0),[m,_]=r.useState(null),[N,R]=r.useState(null),T=async()=>{try{b(!0);let g=[],h=[];try{const k=se(X(D,"users",i,"branches"));g=(await xe(k)).docs.map(E=>({id:E.id,...E.data(),source:"sub"}))}catch(k){console.warn("Subcollection fetch warning:",k)}try{const k=se(X(D,"branches"),Ee("ownerId","==",i));h=(await xe(k)).docs.map(E=>({id:E.id,...E.data(),source:"root"}))}catch(k){console.warn("Root collection fetch warning:",k)}const c=[...g,...h],C=new Map;(await Promise.all(c.map(async k=>{const U=k.branchUserId||k.id;if(U)try{const E=await dt($(D,"users",U));if(E.exists())return{...k,userData:E.data(),realUserId:U}}catch{}return{...k,realUserId:U}}))).forEach(k=>{const U=k.realUserId||k.id;if(!C.has(U))C.set(U,k);else{const E=C.get(U);(k.source==="sub"||!E.loginUsername&&k.loginUsername)&&C.set(U,k)}});const j=Array.from(C.values());f(j)}catch(g){console.error("Error fetching branches:",g)}finally{b(!1)}};r.useEffect(()=>{i&&T()},[i]);const o=async(g,h)=>{if(g.realUserId){R(g.realUserId);try{await Ia(g.realUserId,h,l),await T(),alert(`تم تفعيل اشتراك ${Be(h)} للفرع بنجاح`)}catch(c){console.error(c),alert("حدث خطأ أثناء تفعيل اشتراك الفرع")}finally{R(null),_(null)}}},A=async g=>{if(g.realUserId&&window.confirm("هل أنت متأكد من إلغاء اشتراك هذا الفرع؟ سيتم تعطيل الدخول.")){R(g.realUserId);try{await Fa(g.realUserId),await T(),alert("تم إلغاء اشتراك الفرع بنجاح")}catch(h){console.error(h),alert("حدث خطأ أثناء إلغاء الاشتراك")}finally{R(null)}}};return S?e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"جاري تحميل الفروع..."}):u.length===0?e.jsx("div",{className:"mt-2 text-xs text-red-400 bg-red-50 p-2 rounded",children:"لا توجد فروع مضافة لهذا الحساب"}):e.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-100",children:[e.jsxs("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:["حسابات الفروع (",u.length,"):"]}),e.jsx("div",{className:"space-y-2",children:u.map((g,h)=>{var v,j,k,U;const c=((j=(v=g.userData)==null?void 0:v.subscription)==null?void 0:j.isActive)||!1,C=(U=(k=g.userData)==null?void 0:k.subscription)==null?void 0:U.planType;return e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-xs flex justify-between items-center flex-wrap gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-800 block",children:g.branchName||"بدون اسم"}),e.jsx("span",{className:"text-gray-500 font-mono select-all block",children:g.loginUsername||g.email||"لا يوجد بريد"}),c&&e.jsxs("span",{className:"text-green-600 text-[10px] font-bold",children:["مشترك: ",Be(C)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g.managerName&&e.jsx("span",{className:"text-gray-400 hidden sm:inline",children:g.managerName}),N===g.realUserId?e.jsx("span",{className:"text-gray-400 text-[10px]",children:"جاري التنفيذ..."}):e.jsx(e.Fragment,{children:c?e.jsx("button",{onClick:()=>A(g),className:"bg-red-100 text-red-600 px-2 py-1 rounded hover:bg-red-200 transition-colors",children:"إلغاء"}):e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>_(m===g.realUserId?null:g.realUserId),className:"bg-green-100 text-green-600 px-2 py-1 rounded hover:bg-green-200 transition-colors",children:"تفعيل"}),m===g.realUserId&&e.jsx("div",{className:"absolute left-0 mt-1 w-40 bg-white border rounded shadow-lg z-10 p-1 flex flex-col gap-1",children:[y.MONTHLY,y.QUARTERLY,y.HALF_YEARLY,y.YEARLY].map(E=>e.jsx("button",{onClick:()=>o(g,E),className:"text-right px-2 py-1 hover:bg-gray-100 rounded text-gray-700 w-full",children:Be(E)},E))})]})})]})]},h)})})]})},Kl=({adminId:i})=>{const[l,u]=r.useState([]),[f,S]=r.useState(!0),[b,m]=r.useState("pending"),_=async()=>{S(!0);try{const o=b==="pending"?"pending":"approved",A=se(X(D,"cashierRequests"),Ee("status","==",o)),h=(await xe(A)).docs.map(c=>({id:c.id,...c.data()}));h.sort((c,C)=>{var k,U;const v=((k=c.createdAt)==null?void 0:k.seconds)||0;return(((U=C.createdAt)==null?void 0:U.seconds)||0)-v}),u(h)}catch(o){console.error(o)}finally{S(!1)}};r.useEffect(()=>{_()},[b]);const N=async o=>{var A,g,h,c,C;if(window.confirm(`هل أنت متأكد من الموافقة على طلب ${o.userName} لإضافة ${o.requestedCount} كاشير؟`))try{const v=$(D,"users",o.userId),j=await dt(v),k=j.exists()?j.data():null,U=new Date,E=((h=(g=(A=k==null?void 0:k.subscription)==null?void 0:A.extraCashiersEndsAt)==null?void 0:g.toDate)==null?void 0:h.call(g))||((c=k==null?void 0:k.subscription)!=null&&c.extraCashiersEndsAt?new Date(k.subscription.extraCashiersEndsAt):null),O=E&&E>U,ae=(O&&((C=k==null?void 0:k.subscription)==null?void 0:C.extraCashiers)||0)+(Number(o.requestedCount)||0);let w=new Date;o.planType==="monthly"?w.setMonth(U.getMonth()+1):o.planType==="quarterly"?w.setMonth(U.getMonth()+3):o.planType==="half_yearly"?w.setMonth(U.getMonth()+6):o.planType==="yearly"?w.setFullYear(U.getFullYear()+1):o.planType==="lifetime"&&w.setFullYear(U.getFullYear()+100);const I=O&&E>w?E:w;await z(v,{"subscription.extraCashiers":ae,"subscription.extraCashiersStartsAt":U,"subscription.extraCashiersEndsAt":I,"subscription.extraCashiersPlan":o.planType}),await z($(D,"cashierRequests",o.id),{status:"approved",approvedBy:i,approvedAt:Ye(),startsAt:U,endsAt:I}),alert("تم الموافقة على الطلب وتفعيل الكاشير الإضافي"),_()}catch(v){console.error(v),alert("حدث خطأ أثناء الموافقة")}},R=async o=>{var A;if(window.confirm("هل أنت متأكد من حذف هذا الطلب؟ سيتم إزالته نهائياً"+(o.status==="approved"?" وسيتم خصم عدد الكاشير من المستخدم.":".")))try{if(o.status==="approved"){const g=$(D,"users",o.userId),h=await dt(g);if(h.exists()){const c=h.data(),C=((A=c==null?void 0:c.subscription)==null?void 0:A.extraCashiers)||0,v=Number(o.requestedCount)||0,j=Math.max(0,C-v);await z(g,{"subscription.extraCashiers":j})}}await Ae($(D,"cashierRequests",o.id)),alert("تم حذف الطلب بنجاح"),_()}catch(g){console.error(g),alert("حدث خطأ أثناء الحذف")}},T=async o=>{if(window.confirm("هل أنت متأكد من رفض الطلب؟"))try{await z($(D,"cashierRequests",o.id),{status:"rejected",rejectedBy:i,rejectedAt:Ye()}),_()}catch(A){console.error(A),alert("حدث خطأ أثناء الرفض")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-4 border-b border-gray-200 pb-2",children:[e.jsx("button",{onClick:()=>m("pending"),className:`px-4 py-2 font-medium text-sm rounded-lg transition-colors ${b==="pending"?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"}`,children:"الحسابات غير المفعله"}),e.jsx("button",{onClick:()=>m("approved"),className:`px-4 py-2 font-medium text-sm rounded-lg transition-colors ${b==="approved"?"bg-green-100 text-green-700":"text-gray-500 hover:bg-gray-100"}`,children:"الحسابات المفعله"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:b==="pending"?"طلبات بانتظار الموافقة":"الطلبات المفعله"}),e.jsx("button",{onClick:_,className:"p-1.5 text-gray-500 hover:bg-gray-100 rounded-full",children:e.jsx(Ra,{className:`w-4 h-4 ${f?"animate-spin":""}`})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"المستخدم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"العدد المطلوب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الباقة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ البدء"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ الطلب"}),b==="pending"&&e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الإجراء"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[l.map(o=>{var h,c,C;const A=(h=o.startsAt)!=null&&h.toDate?o.startsAt.toDate():new Date,g=(c=o.endsAt)!=null&&c.toDate?o.endsAt.toDate():(()=>{const v=new Date;return o.planType==="monthly"?v.setMonth(v.getMonth()+1):o.planType==="quarterly"?v.setMonth(v.getMonth()+3):o.planType==="half_yearly"?v.setMonth(v.getMonth()+6):o.planType==="yearly"?v.setFullYear(v.getFullYear()+1):o.planType==="lifetime"&&v.setFullYear(v.getFullYear()+100),v})();return e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:o.userName}),e.jsx("div",{className:"text-xs text-gray-500",children:o.userEmail})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:o.requestedCount}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:Be(o.planType)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:A.toLocaleDateString("ar-EG")}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:g.toLocaleDateString("ar-EG")}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:(C=o.createdAt)!=null&&C.toDate?o.createdAt.toDate().toLocaleString("ar-EG"):"الآن"}),e.jsxs("td",{className:"px-4 py-3 flex gap-2",children:[b==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>N(o),className:"bg-green-100 text-green-700 px-3 py-1 rounded text-xs font-medium hover:bg-green-200",children:"موافقة"}),e.jsx("button",{onClick:()=>T(o),className:"bg-red-100 text-red-700 px-3 py-1 rounded text-xs font-medium hover:bg-red-200",children:"رفض"})]}),e.jsx("button",{onClick:()=>R(o),className:"bg-gray-100 text-gray-700 px-3 py-1 rounded text-xs font-medium hover:bg-gray-200",children:"حذف"})]})]},o.id)}),l.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-4 py-8 text-center text-gray-500",children:["لا توجد طلبات ",b==="pending"?"معلقة":"مفعلة"]})})]})]})})]})]})},Xl=({adminId:i})=>{const[l,u]=r.useState([]),[f,S]=r.useState(!0),[b,m]=r.useState("pending"),_=async()=>{S(!0);try{const o=b==="pending"?"pending":"approved",A=se(X(D,"simCardRequests"),Ee("status","==",o)),h=(await xe(A)).docs.map(c=>({id:c.id,...c.data()}));h.sort((c,C)=>{var k,U;const v=((k=c.createdAt)==null?void 0:k.seconds)||0;return(((U=C.createdAt)==null?void 0:U.seconds)||0)-v}),u(h)}catch(o){console.error(o)}finally{S(!1)}};r.useEffect(()=>{_()},[b]);const N=async o=>{if(window.confirm(`هل أنت متأكد من الموافقة على طلب ${o.email} لباقة ${o.plan}؟`))try{const A=$(D,"users",o.userId),g=new Date;let h=new Date;o.plan==="monthly"?h.setMonth(g.getMonth()+1):o.plan==="quarterly"?h.setMonth(g.getMonth()+3):o.plan==="yearly"?h.setFullYear(g.getFullYear()+1):o.plan==="lifetime"&&h.setFullYear(g.getFullYear()+100),await z(A,{simSubscription:{active:!0,plan:o.plan,startsAt:g,endsAt:h}}),await z($(D,"simCardRequests",o.id),{status:"approved",approvedBy:i,approvedAt:Ye(),startsAt:g,endsAt:h}),alert("تم الموافقة على الطلب وتفعيل اشتراك الخطوط"),_()}catch(A){console.error(A),alert("حدث خطأ أثناء الموافقة")}},R=async o=>{if(window.confirm("هل أنت متأكد من حذف هذا الطلب؟ "+(o.status==="approved"?"سيتم إلغاء تفعيل الباقة للمستخدم.":"")))try{if(o.status==="approved"){const A=$(D,"users",o.userId);await z(A,{"simSubscription.active":!1})}await Ae($(D,"simCardRequests",o.id)),alert("تم حذف الطلب وإلغاء التفعيل إن وجد"),_()}catch(A){console.error(A),alert("حدث خطأ أثناء الحذف")}},T=async o=>{if(window.confirm("هل أنت متأكد من رفض الطلب؟"))try{await z($(D,"simCardRequests",o.id),{status:"rejected",rejectedBy:i,rejectedAt:Ye()}),_()}catch(A){console.error(A),alert("حدث خطأ أثناء الرفض")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-4 border-b border-gray-200 pb-2",children:[e.jsx("button",{onClick:()=>m("pending"),className:`px-4 py-2 font-medium text-sm rounded-lg transition-colors ${b==="pending"?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"}`,children:"الحسابات غير المفعله"}),e.jsx("button",{onClick:()=>m("approved"),className:`px-4 py-2 font-medium text-sm rounded-lg transition-colors ${b==="approved"?"bg-green-100 text-green-700":"text-gray-500 hover:bg-gray-100"}`,children:"الحسابات المفعله"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:b==="pending"?"طلبات خطوط بانتظار الموافقة":"طلبات الخطوط المفعله"}),e.jsx("button",{onClick:_,className:"p-1.5 text-gray-500 hover:bg-gray-100 rounded-full",children:e.jsx(Ra,{className:`w-4 h-4 ${f?"animate-spin":""}`})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"المستخدم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الباقة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ البدء"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ الطلب"}),b==="pending"&&e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الإجراء"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[l.map(o=>{var h,c,C;const A=(h=o.startsAt)!=null&&h.toDate?o.startsAt.toDate():new Date,g=(c=o.endsAt)!=null&&c.toDate?o.endsAt.toDate():(()=>{const v=new Date;return o.plan==="monthly"?v.setMonth(v.getMonth()+1):o.plan==="quarterly"?v.setMonth(v.getMonth()+3):o.plan==="yearly"?v.setFullYear(v.getFullYear()+1):o.plan==="lifetime"&&v.setFullYear(v.getFullYear()+100),v})();return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"text-xs text-gray-500",children:o.email})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:Be(o.plan)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:A.toLocaleDateString("ar-EG")}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:g.toLocaleDateString("ar-EG")}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:(C=o.createdAt)!=null&&C.toDate?o.createdAt.toDate().toLocaleString("ar-EG"):"الآن"}),e.jsxs("td",{className:"px-4 py-3 flex gap-2",children:[b==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>N(o),className:"bg-green-100 text-green-700 px-3 py-1 rounded text-xs font-medium hover:bg-green-200",children:"موافقة"}),e.jsx("button",{onClick:()=>T(o),className:"bg-red-100 text-red-700 px-3 py-1 rounded text-xs font-medium hover:bg-red-200",children:"رفض"})]}),e.jsx("button",{onClick:()=>R(o),className:"bg-gray-100 text-gray-700 px-3 py-1 rounded text-xs font-medium hover:bg-gray-200",children:"إلغاء/حذف"})]})]},o.id)}),l.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500",children:["لا توجد طلبات ",b==="pending"?"معلقة":"مفعلة"]})})]})]})})]})]})},Jl=({navigate:i,auth:l,devMode:u,setDevMode:f,error:S,setError:b,authLoading:m,setAuthLoading:_,activeTab:N,setActiveTab:R,setNotificationCenterOpen:T,setNotificationSettings:o,setNotifications:A,notificationCount:g,setNotificationCount:h,users:c,setUsers:C,loading:v,setLoading:j,setEditingPlan:k,isSavingContent:U,setIsSavingContent:E,lastUpdateInfo:O,loadContentFromFirebase:Z,saveContentToFirebase:ae,refreshData:w})=>{var xa,ma,ha;const[I,te]=r.useState(!0),[be,fe]=r.useState(c||[]),[F,Ce]=r.useState(""),[M,G]=r.useState(null),[je,re]=r.useState({}),[Ie,ie]=r.useState(!1),[le,q]=r.useState(null),[ye,me]=r.useState({name:"",price:"",period:"",description:"",features:[]}),[Rs,es]=r.useState(!1),[p,V]=r.useState(!1),[he,ce]=r.useState(null),[Se,bs]=r.useState(!1),[Re,Ma]=r.useState({sound:!0}),[Oa,en]=r.useState(!1),[Va,$a]=r.useState(null),[fs,Ba]=r.useState([]),[js,pt]=r.useState(!1),[sn,tn]=r.useState(void 0),[an,rn]=r.useState(""),[ln,nn]=r.useState(null),[cn,on]=r.useState(!1),bt=fs.filter(s=>!((s==null?void 0:s.contacted)===!0||(s==null?void 0:s.status)==="contacted")),ys=fs.filter(s=>(s==null?void 0:s.contacted)===!0||(s==null?void 0:s.status)==="contacted"),[dn,xn]=r.useState(""),[mn,hn]=r.useState(""),[un,gn]=r.useState(""),[pn,bn]=r.useState(""),[fn,jn]=r.useState(!1),[yn,Nn]=r.useState(!1),Ya=async s=>{try{await z($(D,"waiting_list",s),{contacted:!0,status:"contacted",contactedAt:Ye()})}catch(t){console.error("Failed to mark waiting item as contacted",t),alert("حدث خطأ أثناء تحديث الحالة إلى تم التواصل.")}},[P,De]=r.useState({}),[Fs,Ha]=r.useState(null),[Ps,za]=r.useState(null),[Ms,Ga]=r.useState(null),[ft,jt]=r.useState(!1),[yt,Nt]=r.useState(!1),[vt,wt]=r.useState(!1),[Te,St]=r.useState(""),[ss,Wa]=r.useState(""),[ts,qa]=r.useState(""),[Qa,Os]=r.useState(0),[Za,Vs]=r.useState(0),[Ka,$s]=r.useState(0),[as,Bs]=r.useState(""),[Ys,kt]=r.useState(""),[Hs,At]=r.useState(""),[Et,Ct]=r.useState(""),[Dt,Tt]=r.useState(""),[_t,Ut]=r.useState(""),[Ns,Lt]=r.useState(""),[It,Rt]=r.useState(""),[Ft,Pt]=r.useState(!1);r.useEffect(()=>{(async()=>{try{const{systemSettingsService:s}=await B(async()=>{const{systemSettingsService:a}=await import("./index-CHyvkdwe.js").then(n=>n.cH);return{systemSettingsService:a}},__vite__mapDeps([0,1]),import.meta.url),t=await s.getTelegramWorkerUrl();t&&Rt(t)}catch{}})()},[]);const[Mt,Xa]=r.useState(!1),[vs,Fe]=r.useState("idle"),[Ot,He]=r.useState(""),[zs,Vt]=r.useState(""),[Gs,$t]=r.useState(!1),[Ws,ze]=r.useState("idle"),[Ja,rs]=r.useState(""),[vn,wn]=r.useState(!1),[Sn,kn]=r.useState(null),[An,En]=r.useState("monthly"),[er,qs]=r.useState(!1),[sr,tr]=r.useState(null),[Cn,ar]=r.useState(y.MONTHLY),[rr,ws]=r.useState(!1),[Ss,lr]=r.useState(null),[Qs,nr]=r.useState(""),[Bt,ir]=r.useState([]),[Yt,Ht]=r.useState(!1);r.useEffect(()=>{const s=Mr(t=>{Ct(String((t==null?void 0:t.version)||"")),Tt(String((t==null?void 0:t.downloadURL_64)||"")),Ut(String((t==null?void 0:t.downloadURL_32)||"")),Lt(String((t==null?void 0:t.notes)||""))});return()=>{try{s()}catch{}}},[]),r.useEffect(()=>{const s=Or(t=>{St(String((t==null?void 0:t.version)||"")),Bs(String((t==null?void 0:t.url)||"")),Vt(String((t==null?void 0:t.notes)||"")),$t(!!(t!=null&&t.force))});return()=>{try{s()}catch{}}},[]),r.useEffect(()=>{B(async()=>{const{getAppDownloads:s}=await import("./index-CHyvkdwe.js").then(t=>t.cM);return{getAppDownloads:s}},__vite__mapDeps([0,1]),import.meta.url).then(({getAppDownloads:s})=>{s().then(De)})},[]);const cr=async()=>{var n;if(He(""),!(l!=null&&l.currentUser)){Fe("error"),He("يرجى تسجيل الدخول كأدمن قبل النشر");try{alert("يرجى تسجيل الدخول كأدمن قبل النشر")}catch{}return}const s=Et.trim(),t=Dt.trim(),a=_t.trim();if(!s){Fe("error"),He("رقم الإصدار مطلوب");return}try{new URL(t)}catch{Fe("error"),He("رابط 64-بت غير صالح (يجب أن يكون https://)");return}try{new URL(a)}catch{Fe("error"),He("رابط 32-بت غير صالح (يجب أن يكون https://)");return}try{Fe("publishing");const d=typeof window<"u"&&(window.electronAPI||typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("electron"));let x="";if(await Gr({version:s,downloadURL_64:t,downloadURL_32:a,notes:Ns.trim()},l.currentUser.uid),d&&((n=window.electronAPI)!=null&&n.publishDesktopVersion)){const L=await l.currentUser.getIdToken(),W={version:s,updateUrl64:t,updateUrli32:a,notes:Ns.trim(),force:!!Mt};x=await window.electronAPI.publishDesktopVersion(L,W)}else x="";Fe("done");try{localStorage.setItem("desktop_update_cache",JSON.stringify({version:s,downloadURL_64:t,downloadURL_32:a,notes:Ns.trim()}))}catch{}}catch(d){Fe("error");const x=(d==null?void 0:d.message)||"فشل النشر: تأكد من الصلاحيات وحالة الاتصال";He(x);try{alert(x)}catch{}}},ls=s=>{const t=s==null?void 0:s.displayName;let a="";typeof t=="string"?a=t:t&&typeof t=="object"&&(a=(t.ar||t.en||"").toString()),!a&&typeof(s==null?void 0:s.email)=="string"&&(a=s.email);const n=String(a).trim().charAt(0);return n?n.toUpperCase():"؟"},ue=s=>{const t=s==null?void 0:s.displayName;if(typeof t=="string"&&t.trim())return t.trim();if(t&&typeof t=="object"){const a=t.full_name||t.name||t.ar||t.en;if(typeof a=="string"&&a.trim())return a.trim()}return typeof(s==null?void 0:s.email)=="string"&&s.email.includes("@")?s.email.split("@")[0]:"غير محدد"},[Zs,zt]=r.useState(""),[Ks,Gt]=r.useState(""),[Wt,qt]=r.useState(""),[Qt,Zt]=r.useState(""),[Xs,Kt]=r.useState(""),[Xt,Jt]=r.useState(!1),[Ge,Js]=r.useState(""),[oe,ea]=r.useState(24),[sa,ta]=r.useState("24"),[aa,ra]=r.useState(!1),[Dn,la]=r.useState(!1),[We,et]=r.useState("active");r.useEffect(()=>{if(F){const s=F.toLowerCase(),t=c.filter(a=>(a.displayName||"").toLowerCase().includes(s)||(a.email||"").toLowerCase().includes(s)||(a.phone||"").includes(s));fe(t)}else fe(c)},[c,F]),r.useEffect(()=>{N==="trials"&&(async()=>{try{la(!0);const{FreeTrialService:s}=await B(async()=>{const{FreeTrialService:a}=await import("./freeTrialService-CSbqfZaj.js");return{FreeTrialService:a}},__vite__mapDeps([2,0,1]),import.meta.url),t=await s.getTrialDurationHours();ea(t),ta(String(t))}catch(s){console.error("Failed to load trial duration",s)}finally{la(!1)}})()},[N]),r.useEffect(()=>{N==="application"&&(async()=>{try{const{getAppDownloads:s}=await B(async()=>{const{getAppDownloads:a}=await import("./index-CHyvkdwe.js").then(n=>n.cM);return{getAppDownloads:a}},__vite__mapDeps([0,1]),import.meta.url),t=await s();De(t||{}),Bs((t==null?void 0:t.androidUrl)||""),kt((t==null?void 0:t.pcUrl)||""),At((t==null?void 0:t.pc32Url)||"")}catch(s){console.error("Failed to load app downloads",s)}})()},[N]);const na=async()=>{pt(!0);try{const s=se(X(D,"waiting_list")),a=(await xe(s)).docs.map(n=>({id:n.id,...n.data()})).sort((n,d)=>{var W,Q,K,Y,ne,Ne;const x=((Q=(W=n==null?void 0:n.createdAt)==null?void 0:W.toMillis)==null?void 0:Q.call(W))??((K=n==null?void 0:n.createdAt)==null?void 0:K.seconds)*1e3??0;return(((ne=(Y=d==null?void 0:d.createdAt)==null?void 0:Y.toMillis)==null?void 0:ne.call(Y))??((Ne=d==null?void 0:d.createdAt)==null?void 0:Ne.seconds)*1e3??0)-x});Ba(a)}catch(s){console.error("Failed to fetch waiting_list:",s)}finally{pt(!1)}};r.useEffect(()=>{N==="waitingList"&&na(),N==="branches"&&ia()},[N]);const ia=async()=>{try{const s=await Ca.getAllCodes();ir(s)}catch(s){console.error("Error loading branch codes:",s)}},or=async()=>{if(l.currentUser){Ht(!0);try{await Ca.generateCode(l.currentUser.uid),await ia(),alert("تم توليد كود تفعيل الفرع بنجاح")}catch(s){console.error("Error generating code:",s),alert("حدث خطأ أثناء توليد الكود")}finally{Ht(!1)}}};r.useEffect(()=>{},[N]);const dr=async()=>{var s;if(!Zs.trim()||!Ks.trim()){alert("يرجى كتابة عنوان ورسالة الإشعار");return}try{Jt(!0);const t=Xs.trim()?`user:${Xs.trim()}`:"global";await cl({title:Zs.trim(),message:Ks.trim(),audienceKey:t,createdBy:(s=l==null?void 0:l.currentUser)==null?void 0:s.uid,linkUrl:Wt.trim()||void 0,actionText:Qt.trim()||void 0}),zt(""),Gt(""),qt(""),Zt(""),Kt(""),alert("تم إرسال الإشعار بنجاح!")}catch(t){console.error("خطأ في إرسال الإشعار:",t),alert("حدث خطأ أثناء إرسال الإشعار")}finally{Jt(!1)}},xr=()=>{l!=null&&l.signOut&&l.signOut(),i("/admin/login")},mr=Ls.useCallback(s=>{tr(s),ar(y.MONTHLY),qs(!0)},[]),ca=Ls.useCallback(async(s,t,a=null,n=null,d=null)=>{var x;try{console.log("Activating subscription for user:",s,"with plan:",t,"variant:",a,"dates:",{customStartDate:n,customEndDate:d});const L=((x=l==null?void 0:l.currentUser)==null?void 0:x.uid)||"admin-user-id";await Ia(s,t,L,a,n,d),console.log("✅ تم تفعيل الاشتراك بنجاح"),w&&w(!0)}catch(L){console.error("❌ خطأ في تفعيل الاشتراك:",L),alert("حدث خطأ في تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},[l]),oa=async s=>{try{console.log("Deactivating subscription for user:",s),await Fa(s),console.log("✅ تم إلغاء تفعيل الاشتراك بنجاح"),w&&w(!0)}catch(t){console.error("❌ خطأ في إلغاء تفعيل الاشتراك:",t),alert("حدث خطأ في إلغاء تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},hr=async s=>{var t;try{if(!window.confirm(`هل أنت متأكد من حذف هذا المستخدم نهائياً؟

سيتم حذف:
- حساب المستخدم
- جميع بياناته
- اشتراكه
- معاملاته
- محادثاته

هذا الإجراء لا يمكن التراجع عنه!`))return;console.log("بدء حذف المستخدم:",s);const n=((t=l==null?void 0:l.currentUser)==null?void 0:t.uid)||"unknown-admin";try{const x=await Yr(Hr,"deleteUserPermanently")({userId:s});console.log("استجابة دالة الحذف النهائي:",x),C(L=>L.filter(W=>W.id!==s)),fe(L=>L.filter(W=>W.id!==s)),alert("تم حذف المستخدم نهائياً مع جميع بياناته وحساب المصادقة.");return}catch(d){console.warn("تعذر تنفيذ الحذف النهائي عبر Cloud Functions، سيتم استخدام الحذف المحلي المؤقت:",(d==null?void 0:d.message)||d)}{const d=[];try{await Ae($(D,"profiles",s)),console.log("تم حذف الملف الشخصي")}catch(x){console.error("خطأ في حذف الملف الشخصي:",x),d.push(`الملف الشخصي: ${(x==null?void 0:x.message)||x}`)}try{await Ae($(D,"users",s)),console.log("تم حذف وثيقة المستخدم من مجموعة users")}catch(x){console.error("خطأ في حذف وثيقة المستخدم من مجموعة users:",x),d.push(`users: ${(x==null?void 0:x.message)||x}`)}try{const x=se(X(D,"transactions"),Ee("userId","==",s)),L=await xe(x),W=L.docs.map(Y=>Ae(Y.ref)),Q=await Promise.allSettled(W),K=Q.filter(Y=>Y.status==="rejected");K.length?(console.warn("فشل حذف بعض المعاملات:",K.length),d.push(`المعاملات: فشل حذف ${K.length} من أصل ${Q.length}`)):console.log(`تم حذف ${L.size} معاملة`)}catch(x){console.error("خطأ في جلب/حذف المعاملات:",x),d.push(`المعاملات: ${(x==null?void 0:x.message)||x}`)}try{const x=se(X(D,"chatRooms"),Ee("participants","array-contains",s)),L=await xe(x),W=L.docs.map(async Q=>{try{const Y=(await xe(X(Q.ref,"messages"))).docs.map(ne=>Ae(ne.ref));await Promise.allSettled(Y),await Ae(Q.ref)}catch(K){console.error("فشل حذف محادثة/رسائل:",K),d.push(`المحادثات: ${Q.id}`)}});await Promise.all(W),console.log(`تم إنهاء معالجة ${L.size} محادثة`)}catch(x){console.error("خطأ في جلب/حذف المحادثات:",x),d.push(`المحادثات: ${(x==null?void 0:x.message)||x}`)}try{await zr($(D,"deletedUsers",s),{deletedAt:new Date,deletedBy:n,reason:"حذف نهائي من لوحة الإدارة"})}catch(x){console.error("خطأ في تسجيل المستخدم كمحذوف:",x),d.push(`deletedUsers: ${(x==null?void 0:x.message)||x}`)}C(x=>x.filter(L=>L.id!==s)),fe(x=>x.filter(L=>L.id!==s)),d.length===0?alert("تم حذف بيانات المستخدم محلياً بنجاح. ملاحظة: حساب المصادقة لم يُحذف."):alert(`تم حذف المستخدم مع ملاحظات:
- ${d.join(`
- `)}

بعض الموارد قد لم تُحذف بالكامل. يمكنك إعادة المحاولة لاحقًا.`)}}catch(a){console.error("❌ خطأ في حذف المستخدم:",a),alert(`حدث خطأ في حذف المستخدم: ${a.message||"خطأ غير معروف"}`)}};r.useEffect(()=>{(async()=>{try{if(typeof Z=="function"){const t=await Z();t&&(t.monthly||t.yearly||t.lifetime)&&re(t)}}catch(t){console.warn("Failed to load content data:",t)}})()},[]);const ur=async()=>{var s;try{if(typeof ae!="function")return;E(!0);const t=((s=l==null?void 0:l.currentUser)==null?void 0:s.uid)||"admin-user-id";await ae(je,t),alert("تم حفظ جميع التغييرات بنجاح")}catch(t){console.error("❌ خطأ في حفظ المحتوى:",t),alert(`فشل في حفظ المحتوى: ${(t==null?void 0:t.message)||"خطأ غير معروف"}`)}finally{E(!1)}},ks=(s,t,a)=>{re(n=>({...n,[s]:{...(n==null?void 0:n[s])||{},[t]:a}}))},gr=s=>{re(t=>{var a;return{...t,[s]:{...(t==null?void 0:t[s])||{},features:[...((a=t==null?void 0:t[s])==null?void 0:a.features)||[],""]}}})},pr=(s,t,a)=>{re(n=>{var x;const d=[...((x=n==null?void 0:n[s])==null?void 0:x.features)||[]];return d[t]=a,{...n,[s]:{...(n==null?void 0:n[s])||{},features:d}}})},br=(s,t)=>{re(a=>{var d;const n=[...((d=a==null?void 0:a[s])==null?void 0:d.features)||[]];return n.splice(t,1),{...a,[s]:{...(a==null?void 0:a[s])||{},features:n}}})},fr=()=>{Ma(s=>({...s,sound:!s.sound}))},jr=()=>{$a(null)},yr=async()=>{try{const s=Number(sa);if(isNaN(s)||s<1){alert("يرجى إدخال مدة صحيحة بالساعات");return}ra(!0);const{FreeTrialService:t}=await B(async()=>{const{FreeTrialService:n}=await import("./freeTrialService-CSbqfZaj.js");return{FreeTrialService:n}},__vite__mapDeps([2,0,1]),import.meta.url),a=await t.updateTrialDurationHours(s);a.success?(ea(s),alert(a.message)):alert(a.message||"فشل تحديث مدة التجربة")}catch(s){console.error("Error updating trial duration:",s),alert("حدث خطأ أثناء تحديث مدة التجربة")}finally{ra(!1)}},da=async s=>{try{const{FreeTrialService:t}=await B(async()=>{const{FreeTrialService:n}=await import("./freeTrialService-CSbqfZaj.js");return{FreeTrialService:n}},__vite__mapDeps([2,0,1]),import.meta.url),a=await t.startFreeTrialFromAdmin(s);alert(a.message||`تم تفعيل التجربة المجانية لمدة ${oe} ${oe>=3&&oe<=10?"ساعات":oe===2?"ساعتين":"ساعة"}`),w&&w()}catch(t){console.error("Error activating free trial:",t),alert("حدث خطأ أثناء تفعيل التجربة المجانية. يرجى المحاولة مرة أخرى.")}},Nr=async s=>{try{const{FreeTrialService:t}=await B(async()=>{const{FreeTrialService:n}=await import("./freeTrialService-CSbqfZaj.js");return{FreeTrialService:n}},__vite__mapDeps([2,0,1]),import.meta.url),a=await t.cancelActiveFreeTrial(s);w&&w(!0)}catch(t){console.error("Error cancelling free trial:",t)}},vr=async s=>{try{const{FreeTrialService:t}=await B(async()=>{const{FreeTrialService:n}=await import("./freeTrialService-CSbqfZaj.js");return{FreeTrialService:n}},__vite__mapDeps([2,0,1]),import.meta.url),a=await t.resetActiveTrialToCurrentDuration(s);alert(a.message)}catch(t){console.error("Error resetting user trial end:",t),alert("حدث خطأ أثناء تحديث نهاية التجربة.")}},wr=(s,t)=>{console.log("Toggling user status:",s,t)},st=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleDateString("ar-EG",{year:"numeric",month:"2-digit",day:"2-digit"}):"غير محدد",Sr=[{id:"users",label:"المستخدمين",icon:is},{id:"reseller",label:"الريسيلر",icon:is},{id:"subscriptions",label:"مواعيد الاشتراكات",icon:pe},{id:"trials",label:"إدارة التجارب المجانية",icon:Ue},{id:"content",label:"إدارة المحتوى",icon:$r},{id:"application",label:"التطبيق",icon:cs},{id:"whatsapp",label:"إدارة الواتساب",icon:_s},{id:"branches",label:"باقات الفروع",icon:ka},{id:"cashierRequests",label:"طلبات الكاشير",icon:is},{id:"simCardRequests",label:"طلبات الخطوط",icon:cs},{id:"analytics",label:"الإحصائيات",icon:wa}];return m?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري التحقق من المصادقة..."}),!1]})}):S?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"حدث خطأ في لوحة التحكم"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700 text-sm font-medium",children:S})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{b(null),i("/admin/login")},className:"w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"🔑 العودة لتسجيل الدخول"}),!1,e.jsx("button",{onClick:()=>{console.log("🔍 Current error details:",S),console.log("🔍 Auth state:",l.currentUser),console.log("🔍 Dev mode:",u),console.log("🔍 Environment:",Ql)},className:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:"🐛 طباعة تفاصيل الخطأ في وحدة التحكم"})]})]})}):!u&&!l.currentUser?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"لوحة تحكم المدير"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"يجب تسجيل الدخول للوصول إلى لوحة التحكم"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>i("/admin/login"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"🔑 تسجيل الدخول"}),!1]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col md:flex-row overflow-x-hidden",children:[e.jsxs("div",{className:`bg-white shadow-lg transition-all duration-300 flex flex-col z-40 ${I?"translate-x-0 w-64 md:w-64":"translate-x-full w-64 md:w-16 md:translate-x-0"} fixed inset-y-0 right-0 md:static md:inset-auto`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[I&&e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Vr,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"لوحة الإدارة"}),e.jsx("p",{className:"text-sm text-gray-500",children:"نظام التحكم"})]})]}),e.jsx("button",{onClick:()=>te(!I),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:I?e.jsx(Le,{className:"w-5 h-5"}):e.jsx(yl,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4",children:e.jsx("ul",{className:"space-y-2",children:Sr.map(s=>{const t=s.icon;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>{if(s.id==="externalNotifications"){i("/admin/notifications");return}R(s.id)},className:`w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg transition-colors ${N===s.id?"bg-gradient-to-r from-purple-600 to-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(t,{className:"w-5 h-5"}),I&&e.jsx("span",{className:"font-medium",children:s.label})]})},s.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:xr,className:"w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(Br,{className:"w-5 h-5"}),I&&e.jsx("span",{className:"font-medium",children:"تسجيل الخروج"})]})})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black/30 md:hidden",onClick:()=>te(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[!I&&e.jsx("button",{className:"md:hidden p-2 rounded-lg hover:bg-gray-100",onClick:()=>te(!0),"aria-label":"فتح القائمة",children:e.jsx(rt,{className:"w-5 h-5"})}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[N==="users"&&"إدارة المستخدمين",N==="reseller"&&"إدارة الريسيلر",N==="waitingList"&&"قائمة الانتظار",N==="subscriptions"&&"مواعيد الاشتراكات",N==="trials"&&"إدارة التجارب المجانية",N==="application"&&"إدارة التطبيق",N==="analytics"&&"الإحصائيات",N==="branches"&&"باقات الفروع",N==="cashierRequests"&&"طلبات الكاشير"]}),u&&e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full",children:"🔧 وضع التطوير"})]}),e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["مرحباً، ",u?"المطور":"المدير"]}),e.jsx(sl,{})]})]})}),e.jsxs("main",{className:"flex-1 p-3 sm:p-4 md:p-6 max-w-full overflow-x-hidden",children:[N==="reseller"&&e.jsx(ql,{}),N==="cashierRequests"&&e.jsx(Kl,{adminId:((xa=l==null?void 0:l.currentUser)==null?void 0:xa.uid)||"admin"}),N==="simCardRequests"&&e.jsx(Xl,{adminId:((ma=l==null?void 0:l.currentUser)==null?void 0:ma.uid)||"admin"}),N==="waitingList"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"طلبات قائمة الانتظار"}),e.jsx("button",{onClick:na,className:"p-1.5 text-gray-500 hover:bg-gray-100 rounded-full transition-colors",title:"تحديث القائمة",disabled:js,children:e.jsx(ms,{className:`w-4 h-4 ${js?"animate-spin":""}`})})]}),e.jsx("div",{className:"text-sm text-gray-500 flex items-center gap-3",children:js?"جاري التحميل...":e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["إجمالي: ",fs.length]}),e.jsxs("span",{className:"text-red-600",children:["قيد الانتظار: ",bt.length]}),e.jsxs("span",{className:"text-green-600",children:["تم التواصل: ",ys.length]})]})})]}),e.jsx("div",{className:"overflow-x-auto",children:js?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل الطلبات..."})]}):fs.length===0?e.jsx("div",{className:"p-8 text-center text-gray-600",children:"لا توجد طلبات في قائمة الانتظار حالياً"}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الاسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"المعرف"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"سبب الطلب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"رقم الواتساب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الإجراء"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ الإنشاء"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:bt.map(s=>{var L;const t=(s.phone||"").toString(),a=t.replace(/\D/g,"");let n=null;const d="مرحباً، طلبت التحدث معنا. كيف نساعدك؟";try{La(t)&&(n=Ua(t,d))}catch{n=null}const x=(L=s.createdAt)!=null&&L.toDate?s.createdAt.toDate():s.createdAt?new Date(s.createdAt):null;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800",children:s.name||"غير محدد"}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500",children:s.userId||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:s.reason||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:a||"—"}),e.jsxs("td",{className:"px-4 py-3 flex items-center gap-2",children:[n?e.jsx("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:e.jsx("button",{className:"px-3 py-1.5 rounded-md bg-green-600 text-white text-sm hover:bg-green-700",children:"واتساب"})}):e.jsx("span",{className:"text-xs text-gray-400",children:"لا يوجد رقم"}),e.jsx("button",{className:"px-3 py-1.5 rounded-md bg-indigo-600 text-white text-sm hover:bg-indigo-700",onClick:()=>Ya(s.id),title:"تمييز كتم التواصل",children:"تم التواصل"})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:x?x.toLocaleString("ar-EG"):"غير محدد"})]},s.id)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"تم التواصل"}),e.jsx("div",{className:"text-sm text-gray-500",children:ys.length})]}),e.jsx("div",{className:"overflow-x-auto",children:ys.length===0?e.jsx("div",{className:"p-8 text-center text-gray-600",children:"لا يوجد عناصر في قسم تم التواصل"}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الاسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"المعرف"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"سبب الطلب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"رقم الواتساب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الحالة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ التواصل"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ys.map(s=>{var d;const a=(s.phone||"").toString().replace(/\D/g,""),n=(d=s.contactedAt)!=null&&d.toDate?s.contactedAt.toDate():s.contactedAt?new Date(s.contactedAt):null;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800",children:s.name||"غير محدد"}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500",children:s.userId||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:s.reason||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:a||"—"}),e.jsx("td",{className:"px-4 py-3 text-xs",children:e.jsx("span",{className:"px-2 py-1 rounded-full bg-green-100 text-green-700",children:"تم التواصل"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:n?n.toLocaleString("ar-EG"):"غير محدد"})]},s.id)})})]})})]})]}),N==="users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي المستخدمين"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:c.length})]}),e.jsx(is,{className:"w-8 h-8 text-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"معرف المستخدم (اختياري)"}),e.jsx("input",{type:"text",value:Xs,onChange:s=>Kt(s.target.value),placeholder:"ضع uid الخاص بالمستخدم لاستهداف إشعار شخصي",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اتركه فارغًا للإرسال العام؛ إن وضعته سيتم إرسال الإشعار لهذا المستخدم فقط."})]})]}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.filter(s=>s.isActive).length})]}),e.jsx(gt,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المعطلين"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:c.filter(s=>!s.isActive).length})]}),e.jsx(kl,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قائمة المستخدمين"}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن مستخدم...",value:F,onChange:s=>Ce(s.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),F&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",be.length," من أصل ",c.length," مستخدم",F&&e.jsx("button",{onClick:()=>Ce(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:v?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):be.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:F?"لا توجد نتائج للبحث":"لا توجد بيانات مستخدمين"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:be.map(s=>e.jsx(Yl,{user:s,onActivateSubscription:(t,a,n,d)=>ca(t,a,null,n,d),onRequestActivation:mr,onToggleUserStatus:wr,onDeactivateSubscription:oa,onDeleteUser:hr,onUpdateSessionLimit:async(t,a)=>{try{const n=$(D,"users",t),d={sessionLimitDisabled:a.sessionLimitDisabled,updatedAt:new Date};a.sessionLimit===null?d.sessionLimit=null:d.sessionLimit=a.sessionLimit,await z(n,d),C(x=>x.map(L=>L.id===t?{...L,...d}:L)),alert("تم تحديث حد الأجهزة للمستخدم")}catch(n){console.error("update session limit error:",n),alert("حدث خطأ أثناء تحديث حد الأجهزة")}}},s.id))})})]})]}),N==="application"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5 text-green-600"})," إدارة تطبيق الأندرويد"]}),(P==null?void 0:P.androidUrl)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["الرابط الحالي: ",e.jsx("a",{href:Qe(P.androidUrl),className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:"تنزيل"}),P.androidVersion?` | الإصدار: ${P.androidVersion}`:""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملف APK"}),e.jsx("input",{type:"file",accept:".apk",onChange:s=>{var t;return Ha(((t=s.target.files)==null?void 0:t[0])||null)},className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:Te,onChange:s=>St(s.target.value),placeholder:"مثال: 1.0.3",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:async()=>{var s,t;if(Fs)try{jt(!0),Os(0);const{uploadAppBinaryResumable:a}=await B(async()=>{const{uploadAppBinaryResumable:d}=await import("./index-CHyvkdwe.js").then(x=>x.cM);return{uploadAppBinaryResumable:d}},__vite__mapDeps([0,1]),import.meta.url),n=await a(Fs,"android",((s=l==null?void 0:l.currentUser)==null?void 0:s.uid)||"admin",Te||void 0,d=>Os(d),3e5);De(d=>({...d,androidUrl:n,androidVersion:Te||d.androidVersion})),await lt({url:n,version:Te||void 0},((t=l==null?void 0:l.currentUser)==null?void 0:t.uid)||"admin")}catch(a){console.error("Android upload failed",a),alert(a!=null&&a.message?`فشل رفع تطبيق الأندرويد: ${a.message}`:"فشل رفع تطبيق الأندرويد")}finally{jt(!1),Os(0)}},disabled:ft||!Fs,className:"w-full sm:w-auto flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50",children:[e.jsx(it,{className:"w-4 h-4"}),ft?`جاري الرفع... ${Qa}%`:"رفع تطبيق الأندرويد"]}),(P==null?void 0:P.androidUrl)&&e.jsxs("a",{href:Qe(P.androidUrl),className:"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(nt,{className:"w-4 h-4"})," تنزيل الحالي"]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط مباشر لتطبيق الأندرويد (APK)"}),e.jsx("input",{type:"url",value:as,onChange:s=>Bs(s.target.value),placeholder:"https://example.com/app-release.apk",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:e.jsxs("button",{onClick:async()=>{var s,t;try{const{setAppDownloadLinks:a}=await B(async()=>{const{setAppDownloadLinks:n}=await import("./index-CHyvkdwe.js").then(d=>d.cM);return{setAppDownloadLinks:n}},__vite__mapDeps([0,1]),import.meta.url);await a({androidUrl:as||void 0,androidVersion:Te||void 0},((s=l==null?void 0:l.currentUser)==null?void 0:s.uid)||"admin"),await lt({url:as||void 0,version:Te||void 0},((t=l==null?void 0:l.currentUser)==null?void 0:t.uid)||"admin"),De(n=>({...n,androidUrl:as||void 0,androidVersion:Te||(n==null?void 0:n.androidVersion)})),alert("تم حفظ رابط الأندرويد بنجاح")}catch(a){console.error("Failed to save android link",a),alert(a!=null&&a.message?`فشل حفظ الرابط: ${a.message}`:"فشل حفظ الرابط")}},className:"w-full sm:w-auto flex items-center gap-2 bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700",children:[e.jsx(Ze,{className:"w-4 h-4"})," حفظ الرابط"]})})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملاحظات الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:zs,onChange:s=>Vt(s.target.value),placeholder:"مثال: إصلاحات وتحسينات",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:Gs,onChange:s=>$t(s.target.checked)}),"تحديث إجباري"]})})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("button",{onClick:async()=>{if(rs(""),!(l!=null&&l.currentUser)){ze("error"),rs("يرجى تسجيل الدخول كأدمن قبل النشر");try{alert("يرجى تسجيل الدخول كأدمن قبل النشر")}catch{}return}const s=Te.trim(),t=as.trim();if(!s){ze("error"),rs("رقم الإصدار مطلوب");return}try{new URL(t)}catch{ze("error"),rs("رابط APK غير صالح (يجب أن يكون https://)");return}try{ze("publishing"),await lt({version:s,url:t,notes:zs.trim(),force:!!Gs},l.currentUser.uid),ze("done");try{localStorage.setItem("android_update_cache",JSON.stringify({version:s,url:t,notes:zs.trim(),force:!!Gs}))}catch{}alert("تم حفظ تحديث الأندرويد في قاعدة البيانات")}catch(a){ze("error");const n=(a==null?void 0:a.message)||"فشل النشر: تأكد من الصلاحيات وحالة الاتصال";rs(n);try{alert(n)}catch{}}},className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"نشر تحديث الأندرويد"}),Ws==="publishing"&&e.jsx("span",{className:"text-sm text-gray-600",children:"جاري النشر..."}),Ws==="error"&&e.jsx("span",{className:"text-sm text-red-600",children:Ja}),Ws==="done"&&e.jsx("span",{className:"text-sm text-green-600",children:"تم النشر"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Sa,{className:"w-5 h-5 text-indigo-600"})," إدارة تطبيق الكمبيوتر (Windows) — 64 بت"]}),(P==null?void 0:P.pcUrl)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["الرابط الحالي: ",e.jsx("a",{href:Qe(P.pcUrl),className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:"تنزيل"}),P.pcVersion?` | الإصدار: ${P.pcVersion}`:""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملف التطبيق (EXE/ZIP)"}),e.jsx("input",{type:"file",accept:".exe,.zip",onChange:s=>{var t;return za(((t=s.target.files)==null?void 0:t[0])||null)},className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:ss,onChange:s=>Wa(s.target.value),placeholder:"مثال: 2.1.0",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:async()=>{var s;if(Ps)try{Nt(!0),Vs(0);const{uploadAppBinaryResumable:t}=await B(async()=>{const{uploadAppBinaryResumable:n}=await import("./index-CHyvkdwe.js").then(d=>d.cM);return{uploadAppBinaryResumable:n}},__vite__mapDeps([0,1]),import.meta.url),a=await t(Ps,"pc",((s=l==null?void 0:l.currentUser)==null?void 0:s.uid)||"admin",ss||void 0,n=>Vs(n),3e5);De(n=>({...n,pcUrl:a,pcVersion:ss||n.pcVersion}))}catch(t){console.error("PC upload failed",t),alert(t!=null&&t.message?`فشل رفع تطبيق الكمبيوتر: ${t.message}`:"فشل رفع تطبيق الكمبيوتر")}finally{Nt(!1),Vs(0)}},disabled:yt||!Ps,className:"w-full sm:w-auto flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:[e.jsx(it,{className:"w-4 h-4"}),yt?`جاري الرفع... ${Za}%`:"رفع تطبيق الكمبيوتر"]}),(P==null?void 0:P.pcUrl)&&e.jsxs("a",{href:Qe(P.pcUrl),className:"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(nt,{className:"w-4 h-4"})," تنزيل نسخة 64 بت"]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط مباشر لتطبيق الكمبيوتر (EXE/ZIP)"}),e.jsx("input",{type:"url",value:Ys,onChange:s=>kt(s.target.value),placeholder:"https://example.com/cashy-setup.exe",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:async()=>{var s;try{const{setAppDownloadLinks:t}=await B(async()=>{const{setAppDownloadLinks:a}=await import("./index-CHyvkdwe.js").then(n=>n.cM);return{setAppDownloadLinks:a}},__vite__mapDeps([0,1]),import.meta.url);await t({pcUrl:Ys||void 0,pcVersion:ss||void 0},((s=l==null?void 0:l.currentUser)==null?void 0:s.uid)||"admin"),De(a=>({...a,pcUrl:Ys||void 0,pcVersion:ss||(a==null?void 0:a.pcVersion)})),alert("تم حفظ رابط الكمبيوتر بنجاح")}catch(t){console.error("Failed to save pc link",t),alert(t!=null&&t.message?`فشل حفظ الرابط: ${t.message}`:"فشل حفظ الرابط")}},className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700",children:[e.jsx(Ze,{className:"w-4 h-4"})," حفظ الرابط"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Sa,{className:"w-5 h-5 text-sky-600"})," إدارة تطبيق الكمبيوتر (Windows) — 32 بت"]}),(P==null?void 0:P.pc32Url)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["الرابط الحالي: ",e.jsx("a",{href:Qe(P.pc32Url),className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:"تنزيل"}),P.pc32Version?` | الإصدار: ${P.pc32Version}`:""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملف التطبيق (EXE/ZIP)"}),e.jsx("input",{type:"file",accept:".exe,.zip",onChange:s=>{var t;return Ga(((t=s.target.files)==null?void 0:t[0])||null)},className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:ts,onChange:s=>qa(s.target.value),placeholder:"مثال: 2.1.0",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:async()=>{var s;if(Ms)try{wt(!0),$s(0);const{uploadAppBinaryResumable:t}=await B(async()=>{const{uploadAppBinaryResumable:n}=await import("./index-CHyvkdwe.js").then(d=>d.cM);return{uploadAppBinaryResumable:n}},__vite__mapDeps([0,1]),import.meta.url),a=await t(Ms,"pc32",((s=l==null?void 0:l.currentUser)==null?void 0:s.uid)||"admin",ts||void 0,n=>$s(n),3e5);De(n=>({...n,pc32Url:a,pc32Version:ts||n.pc32Version}))}catch(t){console.error("PC32 upload failed",t),alert(t!=null&&t.message?`فشل رفع تطبيق 32 بت: ${t.message}`:"فشل رفع تطبيق 32 بت")}finally{wt(!1),$s(0)}},disabled:vt||!Ms,className:"w-full sm:w-auto flex items-center gap-2 bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700 disabled:opacity-50",children:[e.jsx(it,{className:"w-4 h-4"}),vt?`جاري الرفع... ${Ka}%`:"رفع تطبيق 32 بت"]}),(P==null?void 0:P.pc32Url)&&e.jsxs("a",{href:Qe(P.pc32Url),className:"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(nt,{className:"w-4 h-4"})," تنزيل نسخة 32 بت"]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط مباشر لتطبيق الكمبيوتر نسخة 32 بت (EXE/ZIP)"}),e.jsx("input",{type:"url",value:Hs,onChange:s=>At(s.target.value),placeholder:"https://example.com/cashy-setup-ia32.exe",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:async()=>{var s;try{const{setAppDownloadLinks:t}=await B(async()=>{const{setAppDownloadLinks:a}=await import("./index-CHyvkdwe.js").then(n=>n.cM);return{setAppDownloadLinks:a}},__vite__mapDeps([0,1]),import.meta.url);await t({pc32Url:Hs||void 0,pc32Version:ts||void 0},((s=l==null?void 0:l.currentUser)==null?void 0:s.uid)||"admin"),De(a=>({...a,pc32Url:Hs||void 0,pc32Version:ts||(a==null?void 0:a.pc32Version)})),alert("تم حفظ رابط 32 بت بنجاح")}catch(t){console.error("Failed to save pc32 link",t),alert(t!=null&&t.message?`فشل حفظ الرابط: ${t.message}`:"فشل حفظ الرابط")}},className:"flex items-center gap-2 bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700",children:[e.jsx(Ze,{className:"w-4 h-4"})," حفظ الرابط"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Aa,{className:"w-5 h-5 text-indigo-600"})," إدارة تحديثات برنامج الكمبيوتر"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"إصدار موحّد مع روابط 64-بت و32-بت، وملاحظات وخيار التحديث الإجباري."})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار"}),e.jsx("input",{type:"text",value:Et,onChange:s=>Ct(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"مثال: 1.4.0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط نسخة 64-بت"}),e.jsx("input",{type:"text",value:Dt,onChange:s=>Tt(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"رابط المثبّت x64"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط نسخة 32-بت"}),e.jsx("input",{type:"text",value:_t,onChange:s=>Ut(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"رابط المثبّت ia32"})]}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملاحظات التحديث"}),e.jsx("textarea",{value:Ns,onChange:s=>Lt(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",rows:4,placeholder:"نص الملاحظات"})]}),e.jsx("div",{children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:Mt,onChange:s=>Xa(s.target.checked)}),"تحديث إجباري (لن يفتح التطبيق إلا بعد التحديث)"]})})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("button",{onClick:cr,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-60",disabled:vs==="publishing",children:"نشر التحديث"}),vs==="publishing"&&e.jsx("span",{className:"text-sm text-gray-600",children:"جاري النشر..."}),vs==="done"&&e.jsx("span",{className:"text-sm text-green-600",children:"تم النشر بنجاح"}),vs==="error"&&e.jsx("span",{className:"text-sm text-red-600",children:"فشل النشر"}),Ot&&e.jsx("span",{className:"text-sm text-red-600",children:Ot})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5 text-emerald-600"})," إعداد إشعار تحديث تطبيق الأندرويد (Firestore)"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"يقرأه تطبيق الأندرويد عند الفتح ويعرض نافذة داخلية للتنزيل."})]})}),e.jsx("div",{className:"text-sm text-gray-600",children:"تم إلغاء إدارة تحديث تطبيق الموبايل من لوحة الأدمن."})]})]}),N==="branches"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"أكواد تفعيل الفروع"}),e.jsx("p",{className:"text-sm text-gray-500",children:"توليد أكواد تستخدم لمرة واحدة لإضافة فروع جديدة"})]}),e.jsxs("button",{onClick:or,disabled:Yt,className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(rt,{className:"w-4 h-4"}),Yt?"جاري التوليد...":"توليد كود جديد"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الكود"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ التوليد"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ الاستخدام"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[Bt.map(s=>{var t,a;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 font-mono",children:s.code}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${s.isUsed?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:s.isUsed?"مستخدم":"نشط"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.isUsed&&s.usedBy?(()=>{const n=c.find(d=>d.id===s.usedBy);return n?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:ue(n)}),e.jsx("span",{className:"text-xs text-gray-500",children:n.email})]}):e.jsx("span",{className:"text-xs font-mono",children:s.usedBy})})():"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(t=s.createdAt)!=null&&t.toDate?s.createdAt.toDate().toLocaleString("ar-EG"):"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(a=s.usedAt)!=null&&a.toDate?s.usedAt.toDate().toLocaleString("ar-EG"):"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(s.code),alert("تم نسخ الكود")},className:"text-gray-400 hover:text-gray-600",title:"نسخ الكود",children:e.jsx(Pa,{className:"w-4 h-4"})})})]},s.id||s.code)}),Bt.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-sm text-gray-500",children:"لا توجد أكواد مولدة حالياً"})})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"طلبات باقات الفروع (بانتظار التفعيل)"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:c.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.status)==="pending"||((a=s.branchPackage)==null?void 0:a.requested)}).length})]}),e.jsx(ka,{className:"w-8 h-8 text-purple-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"باقات الفروع المفعّلة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.filter(s=>{var t;return((t=s.branchPackage)==null?void 0:t.status)==="active"}).length})]}),e.jsx(us,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي حسابات باقات الفروع"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).length})]}),e.jsx(is,{className:"w-8 h-8 text-blue-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قسم باقات الفروع"}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن حساب باقات الفروع...",value:F,onChange:s=>Ce(s.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),F&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",be.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).length," من أصل ",c.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).length," حساب",F&&e.jsx("button",{onClick:()=>Ce(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:v?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4",children:(F?be:c).filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).map(s=>{var a,n,d,x,L,W;const t=((a=s.branchPackage)==null?void 0:a.status)||((n=s.branchPackage)!=null&&n.requested?"pending":"none");return e.jsxs("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-purple-600 font-semibold",children:ls(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:ue(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),((d=s.branchPackage)==null?void 0:d.requestedAt)&&e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ الطلب: ",st(s.branchPackage.requestedAt)]}),((x=s.branchPackage)==null?void 0:x.limit)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["العدد المطلوب: ",e.jsx("span",{className:"font-bold",children:s.branchPackage.limit})]}),((L=s.branchPackage)==null?void 0:L.packageType)&&e.jsxs("p",{className:"text-sm text-gray-600",children:["نوع الباقة: ",e.jsx("span",{className:"font-bold",children:s.branchPackage.packageType==="basic"?"باقة أساسية":s.branchPackage.packageType==="quarterly"?"باقة ربع سنوية":s.branchPackage.packageType==="pro"?"باقة متقدمة":s.branchPackage.packageType==="enterprise"?"باقة شركات":s.branchPackage.packageType})]})]})]}),e.jsx(Zl,{userId:s.id,adminId:((W=l==null?void 0:l.currentUser)==null?void 0:W.uid)||"admin"}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${t==="active"?"bg-green-100 text-green-700":t==="pending"?"bg-yellow-100 text-yellow-700":t==="rejected"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600"}`,children:t==="active"?"مفعّل":t==="pending"?"بانتظار التفعيل":t==="rejected"?"مرفوض":"غير محدد"}),t==="active"&&e.jsx("button",{title:"إلغاء باقة الفروع",onClick:async()=>{var K;if(window.confirm("هل تريد إلغاء تفعيل باقة الفروع لهذا الحساب؟ سيتم إيقاف جميع الفروع المرتبطة."))try{const{doc:Y,updateDoc:ne,collection:Ne,getDocs:qe}=await B(async()=>{const{doc:J,updateDoc:_e,collection:Pe,getDocs:Me}=await import("./index-CHyvkdwe.js").then(Oe=>Oe.cF);return{doc:J,updateDoc:_e,collection:Pe,getDocs:Me}},__vite__mapDeps([0,1]),import.meta.url),{db:ns}=await B(async()=>{const{db:J}=await import("./index-CHyvkdwe.js").then(_e=>_e.cG);return{db:J}},__vite__mapDeps([0,1]),import.meta.url),As=((K=l==null?void 0:l.currentUser)==null?void 0:K.uid)||"admin-user-id";await ne(Y(ns,"users",s.id),{"branchPackage.status":"canceled","branchPackage.canceledAt":new Date,"branchPackage.canceledBy":As,updatedAt:new Date});try{const J=Ne(ns,"users",s.id,"branches"),Pe=(await qe(J)).docs.map(async Me=>{const Oe=Me.data();if(Oe.branchUserId)try{await ne(Y(ns,"users",Oe.branchUserId),{isActive:!1,"branchPackage.status":"canceled",updatedAt:new Date})}catch(tt){console.warn(`Failed to deactivate branch user ${Oe.branchUserId}`,tt)}});await Promise.all(Pe)}catch(J){console.error("Error fetching/deactivating branches:",J)}alert("تم إلغاء باقة الفروع وتعطيل الفروع المرتبطة بنجاح")}catch(Y){console.error("فشل في إلغاء باقة الفروع:",Y),alert("حدث خطأ أثناء الإلغاء، حاول مرة أخرى")}},className:"p-1 rounded-md text-red-600 hover:bg-red-50",children:e.jsx(hl,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[t==="pending"&&e.jsx("button",{onClick:async()=>{if(window.confirm("هل أنت متأكد من رفض هذا الطلب؟"))try{const{doc:Q,updateDoc:K}=await B(async()=>{const{doc:ne,updateDoc:Ne}=await import("./index-CHyvkdwe.js").then(qe=>qe.cF);return{doc:ne,updateDoc:Ne}},__vite__mapDeps([0,1]),import.meta.url),{db:Y}=await B(async()=>{const{db:ne}=await import("./index-CHyvkdwe.js").then(Ne=>Ne.cG);return{db:ne}},__vite__mapDeps([0,1]),import.meta.url);await K(Q(Y,"users",s.id),{"branchPackage.status":"rejected",updatedAt:new Date}),alert("تم رفض الطلب")}catch{alert("حدث خطأ")}},className:"px-3 py-1 text-sm rounded-md bg-red-100 text-red-600 hover:bg-red-200",children:"رفض"}),t!=="active"&&e.jsx("button",{onClick:async()=>{var Q,K;try{const{doc:Y,updateDoc:ne,setDoc:Ne}=await B(async()=>{const{doc:Pe,updateDoc:Me,setDoc:Oe}=await import("./index-CHyvkdwe.js").then(tt=>tt.cF);return{doc:Pe,updateDoc:Me,setDoc:Oe}},__vite__mapDeps([0,1]),import.meta.url),{db:qe}=await B(async()=>{const{db:Pe}=await import("./index-CHyvkdwe.js").then(Me=>Me.cG);return{db:Pe}},__vite__mapDeps([0,1]),import.meta.url),ns=((Q=l==null?void 0:l.currentUser)==null?void 0:Q.uid)||"admin-user-id",As=new Date;let J=new Date(As);const _e=((K=s.branchPackage)==null?void 0:K.packageType)||"basic";_e==="quarterly"?J.setMonth(J.getMonth()+3):_e==="pro"?J.setFullYear(J.getFullYear()+1):_e==="enterprise"?J=null:J.setMonth(J.getMonth()+1),await ne(Y(qe,"users",s.id),{"branchPackage.status":"active","branchPackage.activatedAt":As,"branchPackage.endDate":J,"branchPackage.activatedBy":ns,isActive:!0,approved:!0,role:"merchant",updatedAt:new Date}),await Ne(Y(qe,"profiles",s.id),{role:"merchant",approved:!0,updatedAt:new Date},{merge:!0}),alert("تم تفعيل باقة الفروع لهذا الحساب")}catch(Y){console.error("فشل في تفعيل باقة الفروع:",Y),alert("حدث خطأ أثناء التفعيل، حاول مرة أخرى")}},className:"px-3 py-1 text-sm rounded-md bg-purple-600 text-white hover:bg-purple-700",children:t==="rejected"?"إعادة تفعيل":"تفعيل الطلب"})]})]})]},s.id)})})})]})]}),N==="subscriptions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي الاشتراكات النشطة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.filter(s=>{var t;return(t=s.subscription)==null?void 0:t.isActive}).length})]}),e.jsx(us,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"تنتهي خلال 7 أيام"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:c.filter(s=>{var x,L;if(!((x=s.subscription)!=null&&x.endDate)||!((L=s.subscription)!=null&&L.isActive))return!1;const t=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),a=new Date,n=t.getTime()-a.getTime(),d=Math.ceil(n/(1e3*60*60*24));return d<=7&&d>0}).length})]}),e.jsx(xs,{className:"w-8 h-8 text-orange-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"منتهية الصلاحية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:c.filter(s=>{var a;return(a=s.subscription)!=null&&a.endDate?(s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate))<new Date:!1}).length})]}),e.jsx(ve,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"اشتراكات مدى الحياة"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:c.filter(s=>{var t;return((t=s.subscription)==null?void 0:t.planType)===y.LIFETIME}).length})]}),e.jsx(hs,{className:"w-8 h-8 text-yellow-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"جدول مواعيد الاشتراكات"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"عرض جميع الاشتراكات النشطة مع تواريخ البداية والانتهاء"})]}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx($e,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"بحث في الاشتراكات...",value:Qs,onChange:s=>nr(s.target.value),className:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:v?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"نوع الاشتراك"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ البداية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الأيام المتبقية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"إجراء"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.filter(s=>{var a,n;if(!((a=s.subscription)!=null&&a.planType))return!1;const t=((n=s.subscription)==null?void 0:n.isActive)===!1||(s==null?void 0:s.isActive)===!1;if(Qs){const d=Qs.trim().toLowerCase();if(d){const x=ue(s).toLowerCase(),L=(s.email||"").toLowerCase();if(!x.includes(d)&&!L.includes(d))return!1}}return!t}).sort((s,t)=>{var d,x;if(!((d=s.subscription)!=null&&d.endDate)||!((x=t.subscription)!=null&&x.endDate))return 0;const a=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),n=t.subscription.endDate.toDate?t.subscription.endDate.toDate():new Date(t.subscription.endDate);return a.getTime()-n.getTime()}).map(s=>{const t=s.subscription;if(!t)return null;const a=t.startDate?t.startDate.toDate?t.startDate.toDate():new Date(t.startDate):null,n=t.endDate?t.endDate.toDate?t.endDate.toDate():new Date(t.endDate):null;let d=null,x="غير محدد";const L=(t==null?void 0:t.isActive)===!1||(s==null?void 0:s.isActive)===!1;if(L)x="ملغي";else if(t.planType===y.LIFETIME)x="مدى الحياة";else if(n){const W=new Date,Q=n.getTime()-W.getTime();d=Math.ceil(Q/(1e3*60*60*24)),d<0?x="منتهي":d<=7?x="ينتهي قريباً":x="نشط"}return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-medium text-sm",children:ls(s)})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:ue(s)}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[t.planType===y.LIFETIME&&e.jsx(hs,{className:"w-4 h-4 text-yellow-500 ml-2"}),t.planType===y.YEARLY&&e.jsx(Ue,{className:"w-4 h-4 text-blue-500 ml-2"}),t.planType===y.QUARTERLY&&e.jsx(pe,{className:"w-4 h-4 text-purple-500 ml-2"}),t.planType===y.MONTHLY&&e.jsx(ps,{className:"w-4 h-4 text-green-500 ml-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Be(t.planType)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:a?a.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.planType===y.LIFETIME?"مدى الحياة":n?n.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${x==="نشط"?"bg-green-100 text-green-800":x==="ينتهي قريباً"?"bg-orange-100 text-orange-800":x==="منتهي"||x==="ملغي"?"bg-red-100 text-red-800":x==="مدى الحياة"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:x})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:L?"ملغي":t.planType===y.LIFETIME?"∞":d!==null?d<0?"منتهي":`${d} يوم`:"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>{lr(s),ws(!0)},className:"px-3 py-1 text-sm rounded-md bg-red-600 text-white hover:bg-red-700",children:"الغاء"})})]},s.id)}).filter(Boolean)})]})})]})]}),N==="content"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة محتوى خطط الاشتراك"}),O&&O.lastUpdated&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["آخر تحديث: ",new Date(O.lastUpdated).toLocaleString("ar-SA"),O.updatedBy&&` بواسطة: ${O.updatedBy}`]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>{es(!0),me({name:"الباقة الربع سنوية",price:"250 جنيه",period:"كل 3 أشهر",description:"حل وسط بين الشهرية والسنوية",features:["إدارة محافظ متعددة","تقارير ربع سنوية"]}),q("quarterly"),ie(!0)},className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:[e.jsx(rt,{className:"w-4 h-4"}),"إضافة باقة جديدة"]}),e.jsxs("button",{onClick:ur,disabled:U,className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(Ze,{className:"w-4 h-4"}),U?"جاري الحفظ...":"حفظ جميع التغييرات"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:Object.entries(je).map(([s,t])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[s==="monthly"&&e.jsx(ps,{className:"w-4 h-4 text-green-500"}),s==="quarterly"&&e.jsx(pe,{className:"w-4 h-4 text-purple-500"}),s==="yearly"&&e.jsx(Ue,{className:"w-4 h-4 text-blue-500"}),s==="lifetime"&&e.jsx(hs,{className:"w-4 h-4 text-yellow-500"}),t.name]}),e.jsx("button",{onClick:()=>{G(M===s?null:s),es(!1),q(s),me({...t,features:[...t.features||[]]}),ie(!0)},className:"text-purple-600 hover:text-purple-800",children:e.jsx(ul,{className:"w-4 h-4"})})]}),M===s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:t.name,onChange:a=>ks(s,"name",a.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:t.price,onChange:a=>ks(s,"price",a.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:t.period,onChange:a=>ks(s,"period",a.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{value:t.description,onChange:a=>ks(s,"description",a.target.value),rows:3,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>gr(s),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:t.features.map((a,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:a,onChange:d=>pr(s,n,d.target.value),className:"flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"}),e.jsx("button",{onClick:()=>br(s,n),className:"text-red-500 hover:text-red-700",children:e.jsx(Le,{className:"w-4 h-4"})})]},n))})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:t.price}),e.jsx("div",{className:"text-sm text-gray-600",children:t.period}),e.jsx("div",{className:"text-sm text-gray-700",children:t.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"المميزات:"}),t.features.map((a,n)=>e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(us,{className:"w-3 h-3 text-green-500"}),a]},n))]})]})]},s))})]}),Ie&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold",children:Rs?"إضافة باقة جديدة":`تعديل ${le==="monthly"?"الباقة الشهرية":le==="yearly"?"الباقة السنوية":le==="lifetime"?"باقة مدى الحياة":"باقة ربع سنوية"}`}),e.jsx("button",{onClick:()=>ie(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(Le,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:ye.name,onChange:s=>me(t=>({...t,name:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:ye.price,onChange:s=>me(t=>({...t,price:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:ye.period,onChange:s=>me(t=>({...t,period:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{rows:3,value:ye.description,onChange:s=>me(t=>({...t,description:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>me(s=>({...s,features:[...s.features||[],""]})),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:(ye.features||[]).map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:a=>{const n=a.target.value;me(d=>{const x=[...d.features||[]];return x[t]=n,{...d,features:x}})},className:"flex-1 p-2 border rounded-md text-sm"}),e.jsx("button",{onClick:()=>{me(a=>{const n=[...a.features||[]];return n.splice(t,1),{...a,features:n}})},className:"text-red-500 hover:text-red-700",children:e.jsx(Le,{className:"w-4 h-4"})})]},t))})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>ie(!1),className:"px-4 py-2 rounded-md bg-gray-100 hover:bg-gray-200",children:"إلغاء"}),e.jsx("button",{onClick:()=>{le&&(re(s=>({...s,[le]:{...ye}})),ie(!1))},className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700",children:"حفظ داخل الصفحة"}),e.jsx("button",{onClick:async()=>{var s;if(le)try{const t=((s=l==null?void 0:l.currentUser)==null?void 0:s.uid)||"admin";await Xr(le,ye,t),re(a=>({...a,[le]:{...ye}})),ie(!1)}catch(t){console.error("Immediate save failed",t),alert("حدث خطأ أثناء الحفظ الفوري. حاول لاحقًا أو استخدم حفظ جميع التغييرات.")}},className:"px-4 py-2 rounded-md bg-purple-600 text-white hover:bg-purple-700",children:"حفظ فوري"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إرسال إشعار للمستخدمين"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"سيظهر الإشعار كمودال صغير في منتصف الشاشة مع ضباب خفيف."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"عنوان الإشعار"}),e.jsx("input",{type:"text",value:Zs,onChange:s=>zt(s.target.value),placeholder:"أدخل عنوانًا قصيرًا وجذابًا",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"نص الإشعار"}),e.jsx("textarea",{value:Ks,onChange:s=>Gt(s.target.value),placeholder:"اكتب محتوى الإشعار الذي سيظهر للمستخدمين",rows:4,className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رابط اختياري"}),e.jsx("input",{type:"text",value:Wt,onChange:s=>qt(s.target.value),placeholder:"مثال: /user/dashboard أو https://example.com",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"إذا كان الرابط خارجيًا سيفتح في نافذة جديدة، وإذا كان داخليًا سيتم التوجيه داخل الموقع."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"نص زر الإجراء (اختياري)"}),e.jsx("input",{type:"text",value:Qt,onChange:s=>Zt(s.target.value),placeholder:"افتراضي: فتح الرابط",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsx("div",{className:"flex items-center justify-end gap-3",children:e.jsx("button",{onClick:dr,disabled:Xt,className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:Xt?"جاري الإرسال...":"إرسال إشعار"})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Aa,{className:"w-5 h-5 text-slate-600"})," إعدادات النظام — Telegram/Cloudflare Worker"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"أدخل رابط الـ Worker المركزي. التوكن يبقى سر داخل Cloudflare Secrets."})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط Cloudflare Worker"}),e.jsx("input",{type:"url",value:It,onChange:s=>Rt(s.target.value),placeholder:"https://summer-cake-5149.alkaptin2030.workers.dev",className:"w-full p-2 border border-gray-300 rounded-md"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:'تأكد أن المسار يدعم POST عند "/notify" أو الجذر حسب إعدادك.'})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:async()=>{try{Pt(!0);const{systemSettingsService:s}=await B(async()=>{const{systemSettingsService:a}=await import("./index-CHyvkdwe.js").then(n=>n.cH);return{systemSettingsService:a}},__vite__mapDeps([0,1]),import.meta.url),t=(It||"").trim();if(!t){alert("أدخل رابط صحيح");return}await s.setTelegramWorkerUrl(t),alert("تم حفظ رابط Cloudflare Worker بنجاح")}catch(s){console.error("Failed to save worker url",s),alert(s!=null&&s.message?`فشل حفظ الرابط: ${s.message}`:"فشل حفظ الرابط")}finally{Pt(!1)}},className:"flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded-lg hover:bg-slate-700 disabled:opacity-50",disabled:Ft,children:[e.jsx(Ze,{className:"w-4 h-4"})," ",Ft?"جاري الحفظ...":"حفظ الرابط"]})})]})]})]})]})]}),N==="trials"&&e.jsxs("div",{className:"space-y-6",children:[console.log("🔍 Trials tab rendering - users data:",c),console.log("🔍 Users count:",(c==null?void 0:c.length)||0),console.log("🔍 Users on trial:",((ha=c==null?void 0:c.filter(s=>s.isOnFreeTrial))==null?void 0:ha.length)||0),v&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري تحميل بيانات المستخدمين..."})]})}),S&&!v&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(xs,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"خطأ في تحميل البيانات"}),e.jsx("p",{className:"text-red-600 mb-4",children:S}),e.jsx("p",{className:"text-sm text-red-500",children:"تأكد من اتصال الإنترنت وإعدادات Firebase"})]}),!v&&!S&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين في التجربة"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.filter(s=>s.isOnFreeTrial).length})]}),e.jsx(Ue,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"التجارب المنتهية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:c.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).length})]}),e.jsx(ve,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المؤهلين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length})]}),e.jsx(gt,{className:"w-8 h-8 text-green-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إعداد مدة التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"يتم تطبيق التغيير فورياً على أي تفعيل جديد."})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"المدة بالساعات"}),e.jsx("input",{type:"number",min:1,max:336,value:sa,onChange:s=>ta(s.target.value),className:"w-full px-4 py-2 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm",placeholder:"اكتب عدد الساعات"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["المدة الحالية: ",oe," ",oe>=3&&oe<=10?"ساعات":oe===2?"ساعتين":"ساعة"]})]}),e.jsx("div",{className:"flex items-center md:justify-end",children:e.jsx("button",{onClick:yr,disabled:aa,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium disabled:opacity-50",children:aa?"جاري التحديث...":"تحديث المدة"})})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-4 border-b border-gray-200 mb-6",children:[e.jsxs("button",{onClick:()=>et("eligible"),className:`pb-2 px-4 text-sm font-medium transition-colors relative whitespace-nowrap ${We==="eligible"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:["المؤهلين للتجربة",e.jsx("span",{className:"mr-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs",children:c.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length})]}),e.jsxs("button",{onClick:()=>et("active"),className:`pb-2 px-4 text-sm font-medium transition-colors relative whitespace-nowrap ${We==="active"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:["التجارب النشطة",e.jsx("span",{className:"mr-2 bg-blue-100 text-blue-600 py-0.5 px-2 rounded-full text-xs",children:c.filter(s=>s.isOnFreeTrial).length})]}),e.jsxs("button",{onClick:()=>et("expired"),className:`pb-2 px-4 text-sm font-medium transition-colors relative whitespace-nowrap ${We==="expired"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:["التجارب المنتهية",e.jsx("span",{className:"mr-2 bg-red-100 text-red-600 py-0.5 px-2 rounded-full text-xs",children:c.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).length})]})]}),We==="eligible"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين المؤهلين للتجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين لم يستخدموا التجربة المجانية من قبل"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Ge,onChange:s=>Js(s.target.value),placeholder:"ابحث بالاسم أو البريد في المؤهلين للتجربة",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx($e,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[c.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).filter(s=>{const t=Ge.trim().toLowerCase();if(!t)return!0;const a=ue(s).toLowerCase(),n=(s.email||"").toLowerCase();return a.includes(t)||n.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:ls(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:ue(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ التسجيل: ",st(s.createdAt)]})]})]}),e.jsx("div",{className:"flex items-center space-x-3 space-x-reverse",children:e.jsx("button",{onClick:()=>da(s.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:`تفعيل التجربة ${oe} ${oe>=3&&oe<=10?"ساعات":oe===2?"ساعتين":"ساعة"}`})})]},s.id)),c.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ue,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد مستخدمين مؤهلين للتجربة المجانية حالياً"})]})]})})]}),We==="active"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين في التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين يستخدمون التجربة المجانية حالياً"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Ge,onChange:s=>Js(s.target.value),placeholder:"ابحث بالاسم أو البريد في التجارب المجانية",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx($e,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[c.filter(s=>s.isOnFreeTrial).filter(s=>{const t=Ge.trim().toLowerCase();if(!t)return!0;const a=ue(s).toLowerCase(),n=(s.email||"").toLowerCase();return a.includes(t)||n.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:ls(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:ue(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-blue-600",children:["تنتهي في: ",s.freeTrialEndDate?st(s.freeTrialEndDate):"غير محدد"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:"نشط"}),e.jsx("button",{onClick:()=>vr(s.id),className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-xs",children:"ضبط نهاية التجربة"}),e.jsx("button",{onClick:()=>Nr(s.id),className:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 text-xs",children:"إلغاء التجربة"})]})]},s.id)),c.filter(s=>s.isOnFreeTrial).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ue,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد تجارب نشطة حالياً"})]})]})})]}),We==="expired"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين المنتهين من التجربة"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين انتهت تجربتهم المجانية"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Ge,onChange:s=>Js(s.target.value),placeholder:"ابحث بالاسم أو البريد في التجارب المنتهية",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx($e,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[c.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).filter(s=>{const t=Ge.trim().toLowerCase();if(!t)return!0;const a=ue(s).toLowerCase(),n=(s.email||"").toLowerCase();return a.includes(t)||n.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-gray-600 font-semibold",children:ls(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:ue(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsx("p",{className:"text-xs text-red-500",children:"انتهت التجربة"})]})]}),e.jsx("div",{className:"flex items-center space-x-3 space-x-reverse",children:e.jsx("button",{onClick:()=>da(s.id),className:"px-3 py-1 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-xs",children:"تفعيل مرة أخرى"})})]},s.id)),c.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد تجارب منتهية حالياً"})]})]})})]})]})]}),N==="whatsapp"&&e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(_s,{className:"w-6 h-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة الواتساب"})]}),e.jsx(Tl,{})]}),N==="analytics"&&e.jsxs("div",{className:"bg-white rounded-lg p-8 shadow-sm border border-gray-200 text-center",children:[e.jsx(wa,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"الإحصائيات"}),e.jsx("p",{className:"text-gray-500",children:"سيتم إضافة الإحصائيات قريباً"})]})]})]}),rr&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-xl shadow-lg p-6 animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"تأكيد إلغاء الاشتراك"}),e.jsx("button",{onClick:()=>ws(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(Le,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-gray-600",children:["هل أنت متأكد من رغبتك في إلغاء اشتراك المستخدم",e.jsx("span",{className:"font-semibold text-gray-800 mx-1",children:Ss?ue(Ss):""}),"؟"]}),e.jsxs("p",{className:"text-red-500 text-sm mt-2 font-medium bg-red-50 p-2 rounded border border-red-100",children:[e.jsx(xs,{className:"w-4 h-4 inline-block ml-1"}),"سيتم إيقاف صلاحيات الاشتراك فوراً."]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>ws(!1),className:"px-4 py-2 rounded-md bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium",children:"تراجع"}),e.jsx("button",{onClick:async()=>{Ss&&(await oa(Ss.id),ws(!1))},className:"px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700 font-medium shadow-sm",children:"نعم، إلغاء الاشتراك"})]})]})}),e.jsx(Wl,{isOpen:er,onClose:()=>qs(!1),user:sr,onActivate:async(s,t,a,n)=>{try{await ca(s,t,null,a,n),alert("تم تفعيل الاشتراك بنجاح"),qs(!1)}catch(d){console.error("فشل في تفعيل الاشتراك:",d),alert("حدث خطأ أثناء تفعيل الاشتراك")}}}),e.jsx(Vl,{isOpen:Oa,onClose:()=>T(!1)}),e.jsx($l,{notification:Va,onClose:jr,soundEnabled:Re.soundAlerts,onToggleSound:fr})]})},ni=()=>{const i=Wr(),{user:l,loading:u}=qr(),[f,S]=r.useState(!1),[b,m]=r.useState(null),[_,N]=r.useState(!0),[R,T]=r.useState("users"),[o,A]=r.useState(0),[g,h]=r.useState([]),[c,C]=r.useState({}),[v,j]=r.useState([]),[k,U]=r.useState([]),[E,O]=r.useState(!1),[Z,ae]=r.useState(null);r.useEffect(()=>{const M=localStorage.getItem("admin_dev_mode")==="true";S(M)},[]);const w=async(M=!1)=>{if(!(!f&&!l)){M||N(!0),m(null);try{const G=se(X(D,"users")),re=(await B(()=>import("./index-CHyvkdwe.js").then(q=>q.cF),__vite__mapDeps([0,1]),import.meta.url).then(q=>q.getDocs(G))).docs.map(q=>({id:q.id,...q.data()}));h(re);const Ie=se(X(D,"profiles")),ie=await B(()=>import("./index-CHyvkdwe.js").then(q=>q.cF),__vite__mapDeps([0,1]),import.meta.url).then(q=>q.getDocs(Ie)),le={};ie.forEach(q=>{le[q.id]=q.data()}),C(le),M||N(!1)}catch(G){console.error("Error refreshing data:",G),!f&&g.length===0&&m("فشل في تحميل البيانات"),M||N(!1)}}};r.useEffect(()=>{w()},[l,f]),r.useEffect(()=>{const M=g.map(G=>{const je=c[G.id]||{},re=typeof je.fullName=="string"?je.fullName:void 0,Ie=typeof je.phone=="string"?je.phone:void 0,ie=typeof G.displayName=="string"&&G.displayName.trim()?G.displayName:re||G.displayName||void 0;return{...G,displayName:ie,phone:G.phone??Ie??null}});j(M)},[g,c]);const I=M=>{console.log("Notification center:",M)},te=M=>{console.log("Notification settings:",M)},be=M=>{console.log("Notifications:",M)},fe=M=>{console.log("Editing plan:",M)};r.useEffect(()=>{l&&(async()=>{try{const M=await ba();ae(M)}catch(M){console.warn("Failed to load last update info:",M),ae(null)}})()},[l]);const F=async()=>{try{return await el()}catch(M){return console.error("Error loading content:",M),{}}},Ce=async M=>{try{O(!0),await Jr(M,(l==null?void 0:l.uid)||"admin");const G=await ba();return ae(G),!0}catch(G){return console.error("Error saving content:",G),!1}finally{O(!1)}};return u?e.jsx(Qr,{}):e.jsx(Jl,{navigate:i,auth:Zr,devMode:f,setDevMode:S,error:b,setError:m,authLoading:u,setAuthLoading:()=>{},activeTab:R,setActiveTab:T,setNotificationCenterOpen:I,setNotificationSettings:te,setNotifications:be,notificationCount:o,setNotificationCount:A,users:v,setUsers:j,loading:_,setLoading:N,setEditingPlan:fe,isSavingContent:E,setIsSavingContent:O,lastUpdateInfo:Z,loadContentFromFirebase:F,saveContentToFirebase:Ce,refreshData:w})};export{ni as default};
//# sourceMappingURL=ProtectedAdminDashboard-D2t819JW.js.map
