{"version":3,"mappings":"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","names":["BatteryCharging","createLucideIcon","CirclePlay","TABS_NAME","createTabsContext","createContextScope","createRovingFocusGroupScope","useRovingFocusGroupScope","TabsProvider","useTabsContext","Tabs","React.forwardRef","props","forwardedRef","__scopeTabs","valueProp","onValueChange","defaultValue","orientation","dir","activationMode","tabsProps","direction","useDirection","value","setValue","useControllableState","jsx","useId","Primitive","TAB_LIST_NAME","TabsList","loop","listProps","context","rovingFocusGroupScope","RovingFocusGroup.Root","TRIGGER_NAME","TabsTrigger","disabled","triggerProps","triggerId","makeTriggerId","contentId","makeContentId","isSelected","RovingFocusGroup.Item","composeEventHandlers","event","isAutomaticActivation","CONTENT_NAME","TabsContent","forceMount","children","contentProps","isMountAnimationPreventedRef","React.useRef","React.useEffect","rAF","Presence","present","baseId","Root2","List","Trigger","Content","TabsPrimitive.Root","className","ref","TabsPrimitive.List","cn","TabsPrimitive.Trigger","TabsPrimitive.Content","TotalProfitDisplayDialog","userId","transactions","isOpen","setIsOpen","useState","isMasterPinDialogOpen","setIsMasterPinDialogOpen","isAuthenticated","setIsAuthenticated","totals","setTotals","userSubscription","useFirebaseAuth","useEffect","loadTotals","formatCurrency","amount","isZeroPlan","localSub","rawLocal","planLocalStr","SubscriptionPlan","remoteSub","getUserSubscription","rawRemote","planRemoteStr","handleEyeClick","isTahweela","toast","handlePinSuccess","today","currentMonth","currentYear","visibleDaily","reportsService","visibleMonthly","dailyWithdrawProfit","dailyTransferProfit","monthlyWithdrawProfit","monthlyTransferProfit","tx","txDate","status","t","txForCalc","ProfitService","profits","e","jsxs","Fragment","Button","Eye","Dialog","DialogContent","DialogHeader","DialogTitle","DollarSign","Clock","ArrowDownLeft","ArrowRightLeft","Calendar","MasterPinDialog","TotalProfitEyeButton","TransactionsPage","navigate","useNavigate","user","profile","React","planRaw","_a","_b","_c","_d","isTahweelaPlan","_e","_f","_g","_h","shopName","useShop","isShiftActive","shiftUser","useShift","setTransactions","deletedTransactions","setDeletedTransactions","permDeletedSet","setPermDeletedSet","isRestoreConfirmOpen","setIsRestoreConfirmOpen","pendingRestoreTx","setPendingRestoreTx","activeTab","setActiveTab","searchPhone","setSearchPhone","selectedDate","setSelectedDate","selectedTime","setSelectedTime","isCalculatorOpen","setIsCalculatorOpen","isInstallmentPinOpen","setIsInstallmentPinOpen","isInstallmentModalOpen","setIsInstallmentModalOpen","isGuideOpen","setIsGuideOpen","guideUrl","setGuideUrl","guideTitle","setGuideTitle","guidePublishedAt","setGuidePublishedAt","lastTutorialSeenAt","setLastTutorialSeenAt","hasNewGuide","setHasNewGuide","_i","isSalesDataOpen","setIsSalesDataOpen","isDatePickerOpen","setIsDatePickerOpen","isDebtsDialogOpen","setIsDebtsDialogOpen","isDebtsPasswordDialogOpen","setIsDebtsPasswordDialogOpen","isCreditCardsOpen","setIsCreditCardsOpen","isMaintenanceOpen","setIsMaintenanceOpen","isReceiptOpen","setIsReceiptOpen","receiptTransaction","setReceiptTransaction","isResetRecentDialogOpen","setIsResetRecentDialogOpen","recentResetConfig","setRecentResetConfig","data","userDataService","raw","keep","interval","toJsDate","v","last","now","userRef","doc","db","unsub","onSnapshot","snap","dt","url","title","rawPub","pub","err","toYouTubeEmbed","u","id","openGuide","isTopUpOpen","setIsTopUpOpen","topupPhone","setTopupPhone","topupOperator","setTopupOperator","topupAmount","setTopupAmount","topupLoading","setTopupLoading","pendingDebtsCount","setPendingDebtsCount","count","loadTransactions","loadDeletedTransactions","unsubCloud","unsubLocal","q","fsQuery","collection","where","keys","chg","arr","prev","next","k","tid","getDocs","d","unsubscribe","fallbackActive","mapAndFilter","docs","filtered","createdAt","a","b","ta","locals","merged","getKey","seen","distinct","normalizeTransaction","subscribeFallback","qFb","snapshot","error","qCache","snapCache","getDocsFromCache","orderBy","qSimple","primary","alt","permKeysRes","txns","permSet","deletedWithDates","auditLogService","effectiveTransactions","monthStart","nextMonthStart","hiddenCount","filteredTransactions","transaction","phoneMatch","dateMatch","timeMatch","getStatusIcon","type","CheckCircle","XCircle","getStatusText","statusRaw","normalizedStatus","normalizedType","sender","receiver","createdAtVal","mapToReceiptTransaction","handleTransactionClick","receiptData","handleOpenRestoreDialog","handleConfirmRestore","restoreTransaction","transactionId","transactionToRestore","newId","restored","permanentlyDeleteTransaction","handleCompleteReceipt","plan","dailyOperationCountService","__vitePreload","opType","limitErr","userProfile","profileService","dataRef","dataSnap","getDoc","cashBalance","walletBalances","fromWalletIdForLimits","alreadyReservedLimits","checkAmt","checkType","walletDailyLimitsService","n","can","didAddCashNow","fromWalletId","commission","alreadyAppliedOnCreationWallet","alreadyAppliedOnCreationCash","current","updateDoc","fee","amountToAdd","toAdd","amt","profit","handleDeleteReceipt","rawTx","originalId","linkedTxnId","linkedRef","wasAppliedOnCreation","sentAmount","limits","isTransfer","update","serverTimestamp","setDoc","doc2","db2","ReportsService","transactionData","autoTestRanRef","useRef","location","useLocation","snapBefore","beforeCash","beforeWallets","snapAfterComplete","afterCashComplete","afterWalletsComplete","expectedCashAfter","expectedWalletAfter","snapAfterDelete","afterCashDelete","afterWalletsDelete","submitTopUp","allowedEmail","userEmail","auth","operatorToSend","controller","timeout","idToken","resp","rawText","ArrowLeft","Card","CardHeader","CardTitle","Search","Input","PlayCircle","BadgePercent","CreditCard","Calculator","BarChart","FileText","Wrench","Trash2","CardContent","index","formatNumberEnglish","Badge","MaintenanceDialog","CreditCardsDialog","PasswordConfirmDialog","resetAt","cfg","open","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","DialogDescription","ReceiptModal","InstallmentModal"],"ignoreList":[0,1,2],"sources":["../../node_modules/lucide-react/dist/esm/icons/battery-charging.js","../../node_modules/lucide-react/dist/esm/icons/circle-play.js","../../node_modules/@radix-ui/react-tabs/dist/index.mjs","../../src/components/ui/tabs.tsx","../../src/components/TotalProfitDisplayDialog.tsx","../../src/pages/TransactionsPage.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst BatteryCharging = createLucideIcon(\"BatteryCharging\", [\n  [\"path\", { d: \"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2\", key: \"1sdynx\" }],\n  [\"path\", { d: \"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1\", key: \"1gkd3k\" }],\n  [\"path\", { d: \"m11 7-3 5h4l-3 5\", key: \"b4a64w\" }],\n  [\"line\", { x1: \"22\", x2: \"22\", y1: \"11\", y2: \"13\", key: \"4dh1rd\" }]\n]);\n\nexport { BatteryCharging as default };\n//# sourceMappingURL=battery-charging.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst CirclePlay = createLucideIcon(\"CirclePlay\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"polygon\", { points: \"10 8 16 12 10 16 10 8\", key: \"1cimsy\" }]\n]);\n\nexport { CirclePlay as default };\n//# sourceMappingURL=circle-play.js.map\n","\"use client\";\n\n// src/tabs.tsx\nimport * as React from \"react\";\nimport { composeEventHandlers } from \"@radix-ui/primitive\";\nimport { createContextScope } from \"@radix-ui/react-context\";\nimport { createRovingFocusGroupScope } from \"@radix-ui/react-roving-focus\";\nimport { Presence } from \"@radix-ui/react-presence\";\nimport { Primitive } from \"@radix-ui/react-primitive\";\nimport * as RovingFocusGroup from \"@radix-ui/react-roving-focus\";\nimport { useDirection } from \"@radix-ui/react-direction\";\nimport { useControllableState } from \"@radix-ui/react-use-controllable-state\";\nimport { useId } from \"@radix-ui/react-id\";\nimport { jsx } from \"react/jsx-runtime\";\nvar TABS_NAME = \"Tabs\";\nvar [createTabsContext, createTabsScope] = createContextScope(TABS_NAME, [\n  createRovingFocusGroupScope\n]);\nvar useRovingFocusGroupScope = createRovingFocusGroupScope();\nvar [TabsProvider, useTabsContext] = createTabsContext(TABS_NAME);\nvar Tabs = React.forwardRef(\n  (props, forwardedRef) => {\n    const {\n      __scopeTabs,\n      value: valueProp,\n      onValueChange,\n      defaultValue,\n      orientation = \"horizontal\",\n      dir,\n      activationMode = \"automatic\",\n      ...tabsProps\n    } = props;\n    const direction = useDirection(dir);\n    const [value, setValue] = useControllableState({\n      prop: valueProp,\n      onChange: onValueChange,\n      defaultProp: defaultValue ?? \"\",\n      caller: TABS_NAME\n    });\n    return /* @__PURE__ */ jsx(\n      TabsProvider,\n      {\n        scope: __scopeTabs,\n        baseId: useId(),\n        value,\n        onValueChange: setValue,\n        orientation,\n        dir: direction,\n        activationMode,\n        children: /* @__PURE__ */ jsx(\n          Primitive.div,\n          {\n            dir: direction,\n            \"data-orientation\": orientation,\n            ...tabsProps,\n            ref: forwardedRef\n          }\n        )\n      }\n    );\n  }\n);\nTabs.displayName = TABS_NAME;\nvar TAB_LIST_NAME = \"TabsList\";\nvar TabsList = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeTabs, loop = true, ...listProps } = props;\n    const context = useTabsContext(TAB_LIST_NAME, __scopeTabs);\n    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeTabs);\n    return /* @__PURE__ */ jsx(\n      RovingFocusGroup.Root,\n      {\n        asChild: true,\n        ...rovingFocusGroupScope,\n        orientation: context.orientation,\n        dir: context.dir,\n        loop,\n        children: /* @__PURE__ */ jsx(\n          Primitive.div,\n          {\n            role: \"tablist\",\n            \"aria-orientation\": context.orientation,\n            ...listProps,\n            ref: forwardedRef\n          }\n        )\n      }\n    );\n  }\n);\nTabsList.displayName = TAB_LIST_NAME;\nvar TRIGGER_NAME = \"TabsTrigger\";\nvar TabsTrigger = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeTabs, value, disabled = false, ...triggerProps } = props;\n    const context = useTabsContext(TRIGGER_NAME, __scopeTabs);\n    const rovingFocusGroupScope = useRovingFocusGroupScope(__scopeTabs);\n    const triggerId = makeTriggerId(context.baseId, value);\n    const contentId = makeContentId(context.baseId, value);\n    const isSelected = value === context.value;\n    return /* @__PURE__ */ jsx(\n      RovingFocusGroup.Item,\n      {\n        asChild: true,\n        ...rovingFocusGroupScope,\n        focusable: !disabled,\n        active: isSelected,\n        children: /* @__PURE__ */ jsx(\n          Primitive.button,\n          {\n            type: \"button\",\n            role: \"tab\",\n            \"aria-selected\": isSelected,\n            \"aria-controls\": contentId,\n            \"data-state\": isSelected ? \"active\" : \"inactive\",\n            \"data-disabled\": disabled ? \"\" : void 0,\n            disabled,\n            id: triggerId,\n            ...triggerProps,\n            ref: forwardedRef,\n            onMouseDown: composeEventHandlers(props.onMouseDown, (event) => {\n              if (!disabled && event.button === 0 && event.ctrlKey === false) {\n                context.onValueChange(value);\n              } else {\n                event.preventDefault();\n              }\n            }),\n            onKeyDown: composeEventHandlers(props.onKeyDown, (event) => {\n              if ([\" \", \"Enter\"].includes(event.key)) context.onValueChange(value);\n            }),\n            onFocus: composeEventHandlers(props.onFocus, () => {\n              const isAutomaticActivation = context.activationMode !== \"manual\";\n              if (!isSelected && !disabled && isAutomaticActivation) {\n                context.onValueChange(value);\n              }\n            })\n          }\n        )\n      }\n    );\n  }\n);\nTabsTrigger.displayName = TRIGGER_NAME;\nvar CONTENT_NAME = \"TabsContent\";\nvar TabsContent = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeTabs, value, forceMount, children, ...contentProps } = props;\n    const context = useTabsContext(CONTENT_NAME, __scopeTabs);\n    const triggerId = makeTriggerId(context.baseId, value);\n    const contentId = makeContentId(context.baseId, value);\n    const isSelected = value === context.value;\n    const isMountAnimationPreventedRef = React.useRef(isSelected);\n    React.useEffect(() => {\n      const rAF = requestAnimationFrame(() => isMountAnimationPreventedRef.current = false);\n      return () => cancelAnimationFrame(rAF);\n    }, []);\n    return /* @__PURE__ */ jsx(Presence, { present: forceMount || isSelected, children: ({ present }) => /* @__PURE__ */ jsx(\n      Primitive.div,\n      {\n        \"data-state\": isSelected ? \"active\" : \"inactive\",\n        \"data-orientation\": context.orientation,\n        role: \"tabpanel\",\n        \"aria-labelledby\": triggerId,\n        hidden: !present,\n        id: contentId,\n        tabIndex: 0,\n        ...contentProps,\n        ref: forwardedRef,\n        style: {\n          ...props.style,\n          animationDuration: isMountAnimationPreventedRef.current ? \"0s\" : void 0\n        },\n        children: present && children\n      }\n    ) });\n  }\n);\nTabsContent.displayName = CONTENT_NAME;\nfunction makeTriggerId(baseId, value) {\n  return `${baseId}-trigger-${value}`;\n}\nfunction makeContentId(baseId, value) {\n  return `${baseId}-content-${value}`;\n}\nvar Root2 = Tabs;\nvar List = TabsList;\nvar Trigger = TabsTrigger;\nvar Content = TabsContent;\nexport {\n  Content,\n  List,\n  Root2 as Root,\n  Tabs,\n  TabsContent,\n  TabsList,\n  TabsTrigger,\n  Trigger,\n  createTabsScope\n};\n//# sourceMappingURL=index.mjs.map\n","import * as React from \"react\"\r\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Tabs = TabsPrimitive.Root\r\n\r\nconst TabsList = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.List\r\n    ref={ref}\r\n    className={cn(\r\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsList.displayName = TabsPrimitive.List.displayName\r\n\r\nconst TabsTrigger = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.Trigger\r\n    ref={ref}\r\n    className={cn(\r\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\r\n\r\nconst TabsContent = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.Content\r\n    ref={ref}\r\n    className={cn(\r\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsContent.displayName = TabsPrimitive.Content.displayName\r\n\r\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Eye, DollarSign, ArrowDownLeft, ArrowRightLeft, Calendar, Clock } from 'lucide-react';\r\nimport { ProfitService } from '@/utils/profitService';\r\nimport { reportsService } from '@/utils/reportsService';\r\nimport { MasterPinDialog } from './MasterPinDialog';\r\nimport { toast } from '@/hooks/use-toast';\r\nimport { getUserSubscription, SubscriptionPlan } from '@/utils/subscriptionService';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\n\r\ninterface TotalProfitDisplayDialogProps {\r\n  userId?: string;\r\n  transactions?: any[];\r\n}\r\n\r\ninterface TotalsData {\r\n  dailyWithdraw: number;\r\n  dailyTransfer: number;\r\n  monthlyWithdraw: number;\r\n  monthlyTransfer: number;\r\n  lastUpdated: Date;\r\n}\r\n\r\nconst TotalProfitDisplayDialog: React.FC<TotalProfitDisplayDialogProps> = ({ userId, transactions = [] }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isMasterPinDialogOpen, setIsMasterPinDialogOpen] = useState(false);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [totals, setTotals] = useState<TotalsData>({\r\n    dailyWithdraw: 0,\r\n    dailyTransfer: 0,\r\n    monthlyWithdraw: 0,\r\n    monthlyTransfer: 0,\r\n    lastUpdated: new Date(),\r\n  });\r\n  const { userSubscription } = useFirebaseAuth();\r\n\r\n  useEffect(() => {\r\n    if (userId && isOpen && isAuthenticated) {\r\n      loadTotals();\r\n    }\r\n  }, [userId, isOpen, isAuthenticated]);\r\n\r\n  const formatCurrency = (amount: number) => `${amount.toFixed(2)} .`;\r\n\r\n  const isZeroPlan = async (): Promise<boolean> => {\r\n    try {\r\n      const localSub: any = (userSubscription as any)?.subscription || null;\r\n      const rawLocal: any = localSub?.planType ?? localSub?.plan ?? null;\r\n      const planLocalStr = typeof rawLocal === 'string' ? rawLocal.toLowerCase() : null;\r\n      if (rawLocal === SubscriptionPlan.ZERO || planLocalStr === 'zero' || planLocalStr === '0' || rawLocal === 0) {\r\n        return true;\r\n      }\r\n    } catch {}\r\n\r\n    try {\r\n      if (userId) {\r\n        const remoteSub: any = await getUserSubscription(userId);\r\n        const rawRemote: any = remoteSub?.planType ?? remoteSub?.plan ?? null;\r\n        const planRemoteStr = typeof rawRemote === 'string' ? rawRemote.toLowerCase() : null;\r\n        if (rawRemote === SubscriptionPlan.ZERO || planRemoteStr === 'zero' || planRemoteStr === '0' || rawRemote === 0) {\r\n          return true;\r\n        }\r\n      }\r\n    } catch {}\r\n\r\n    return false;\r\n  };\r\n\r\n  const handleEyeClick = async () => {\r\n    try {\r\n      const isTahweela = await (async () => {\r\n        try {\r\n          const localSub: any = (userSubscription as any)?.subscription || null;\r\n          const rawLocal: any = localSub?.planType ?? localSub?.plan ?? null;\r\n          const planLocalStr = typeof rawLocal === 'string' ? rawLocal.toLowerCase() : null;\r\n          if (rawLocal === SubscriptionPlan.TAHWEELA || planLocalStr === 'tahweela') return true;\r\n        } catch {}\r\n        try {\r\n          if (userId) {\r\n            const remoteSub: any = await getUserSubscription(userId);\r\n            const rawRemote: any = remoteSub?.planType ?? remoteSub?.plan ?? null;\r\n            const planRemoteStr = typeof rawRemote === 'string' ? rawRemote.toLowerCase() : null;\r\n            if (rawRemote === SubscriptionPlan.TAHWEELA || planRemoteStr === 'tahweela') return true;\r\n          }\r\n        } catch {}\r\n        return false;\r\n      })();\r\n      if (await isZeroPlan() || isTahweela) {\r\n        toast({\r\n          title: '  ',\r\n          description: '       .',\r\n          variant: 'destructive',\r\n        });\r\n        return;\r\n      }\r\n    } catch {}\r\n    setIsMasterPinDialogOpen(true);\r\n  };\r\n\r\n  const handlePinSuccess = async () => {\r\n    try {\r\n      const isTahweela = await (async () => {\r\n        try {\r\n          const localSub: any = (userSubscription as any)?.subscription || null;\r\n          const rawLocal: any = localSub?.planType ?? localSub?.plan ?? null;\r\n          const planLocalStr = typeof rawLocal === 'string' ? rawLocal.toLowerCase() : null;\r\n          if (rawLocal === SubscriptionPlan.TAHWEELA || planLocalStr === 'tahweela') return true;\r\n        } catch {}\r\n        try {\r\n          if (userId) {\r\n            const remoteSub: any = await getUserSubscription(userId);\r\n            const rawRemote: any = remoteSub?.planType ?? remoteSub?.plan ?? null;\r\n            const planRemoteStr = typeof rawRemote === 'string' ? rawRemote.toLowerCase() : null;\r\n            if (rawRemote === SubscriptionPlan.TAHWEELA || planRemoteStr === 'tahweela') return true;\r\n          }\r\n        } catch {}\r\n        return false;\r\n      })();\r\n      if (await isZeroPlan() || isTahweela) {\r\n        toast({\r\n          title: '  ',\r\n          description: '       .',\r\n          variant: 'destructive',\r\n        });\r\n        setIsMasterPinDialogOpen(false);\r\n        return;\r\n      }\r\n    } catch {}\r\n\r\n    setIsAuthenticated(true);\r\n    setIsOpen(true);\r\n    setIsMasterPinDialogOpen(false);\r\n  };\r\n\r\n  const loadTotals = async () => {\r\n    if (!userId) return;\r\n\r\n    try {\r\n      if (Array.isArray(transactions) && transactions.length > 0) {\r\n        const today = new Date();\r\n        const currentMonth = today.getMonth();\r\n        const currentYear = today.getFullYear();\r\n\r\n        const visibleDaily = reportsService.filterVisibleTransactions(transactions as any[], 'daily', userId);\r\n        const visibleMonthly = reportsService.filterVisibleTransactions(transactions as any[], 'monthly', userId);\r\n\r\n        let dailyWithdrawProfit = 0;\r\n        let dailyTransferProfit = 0;\r\n        let monthlyWithdrawProfit = 0;\r\n        let monthlyTransferProfit = 0;\r\n\r\n        visibleDaily.forEach((tx: any) => {\r\n          const txDate = new Date(tx.createdAt);\r\n          const status = String(tx.status || 'confirmed').toLowerCase();\r\n          if (txDate.toDateString() !== today.toDateString()) return;\r\n          if (status !== 'completed' && status !== 'confirmed' && status !== 'pending') return;\r\n\r\n          const t = (tx.type || tx.txnType || '').toLowerCase();\r\n          const txForCalc = {\r\n            type: t === 'withdrawal' ? 'withdraw' : t,\r\n            amount: Number(tx.amount || 0),\r\n            commission: tx.commission,\r\n          };\r\n\r\n          if (txForCalc.type === 'withdraw') {\r\n            dailyWithdrawProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          } else if (txForCalc.type === 'send' || txForCalc.type === 'receive' || txForCalc.type === 'transfer') {\r\n            dailyTransferProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          }\r\n        });\r\n\r\n        visibleMonthly.forEach((tx: any) => {\r\n          const txDate = new Date(tx.createdAt);\r\n          const status = String(tx.status || 'confirmed').toLowerCase();\r\n          if (txDate.getMonth() !== currentMonth || txDate.getFullYear() !== currentYear) return;\r\n          if (status !== 'completed' && status !== 'confirmed' && status !== 'pending') return;\r\n\r\n          const t = (tx.type || tx.txnType || '').toLowerCase();\r\n          const txForCalc = {\r\n            type: t === 'withdrawal' ? 'withdraw' : t,\r\n            amount: Number(tx.amount || 0),\r\n            commission: tx.commission,\r\n          };\r\n\r\n          if (txForCalc.type === 'withdraw') {\r\n            monthlyWithdrawProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          } else if (txForCalc.type === 'send' || txForCalc.type === 'receive' || txForCalc.type === 'transfer') {\r\n            monthlyTransferProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          }\r\n        });\r\n\r\n        setTotals({\r\n          dailyWithdraw: Math.round(dailyWithdrawProfit * 100) / 100,\r\n          dailyTransfer: Math.round(dailyTransferProfit * 100) / 100,\r\n          monthlyWithdraw: Math.round(monthlyWithdrawProfit * 100) / 100,\r\n          monthlyTransfer: Math.round(monthlyTransferProfit * 100) / 100,\r\n          lastUpdated: new Date(),\r\n        });\r\n        return;\r\n      }\r\n\r\n      const profits = ProfitService.getWithdrawTransferProfits(userId);\r\n      setTotals({\r\n        dailyWithdraw: profits.dailyWithdrawProfit || 0,\r\n        dailyTransfer: profits.dailyTransferProfit || 0,\r\n        monthlyWithdraw: profits.monthlyWithdrawProfit || 0,\r\n        monthlyTransfer: profits.monthlyTransferProfit || 0,\r\n        lastUpdated: new Date(),\r\n      });\r\n    } catch (e) {\r\n      console.error('Error loading total profits:', e);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        size=\"sm\"\r\n        variant=\"ghost\"\r\n        onClick={handleEyeClick}\r\n        className=\"h-2 w-2 p-0 bg-gradient-to-r from-blue-100 to-purple-200 text-purple-700 hover:from-blue-200 hover:to-purple-300 hover:text-purple-800 rounded transition-all duration-300 hover:scale-110 shadow-sm hover:shadow-md\"\r\n        title=\"  \"\r\n      >\r\n        <Eye className=\"h-1.5 w-1.5\" />\r\n      </Button>\r\n\r\n      <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n        <DialogContent className=\"max-w-[240px] mx-auto bg-white border border-gray-200 shadow-md rounded sm:max-w-[220px] sm:bg-gradient-to-br sm:from-purple-50 sm:to-white sm:border-2 sm:border-purple-200 sm:shadow-2xl sm:rounded-2xl\">\r\n          <DialogHeader className=\"text-center pb-0 border-b-0 sm:pb-2 sm:border-b sm:border-purple-200\">\r\n            <DialogTitle className=\"text-xs font-bold text-purple-800 flex items-center justify-center gap-1 mb-0 leading-tight tracking-tight sm:text-xs sm:gap-1 sm:mb-0 sm:leading-normal sm:tracking-normal\">\r\n              <DollarSign className=\"h-2 w-2 text-purple-600 sm:h-3 sm:w-3\" />\r\n                ()\r\n            </DialogTitle>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-1 py-1 sm:space-y-2 sm:py-2\">\r\n            {/*   */}\r\n            <div className=\"bg-blue-50 p-1 rounded border border-blue-200 sm:bg-gradient-to-r sm:from-blue-50 sm:to-blue-100 sm:p-2 sm:rounded-xl sm:shadow-sm\">\r\n              <div className=\"flex items-center justify-between mb-1\">\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Clock className=\"h-2 w-2 text-blue-600\" />\r\n                  <span className=\"text-[10px] font-semibold text-blue-800\"></span>\r\n                </div>\r\n                <span className=\"text-[10px] font-bold text-blue-900\">\r\n                  {formatCurrency((totals.dailyWithdraw ?? 0) + (totals.dailyTransfer ?? 0))}\r\n                </span>\r\n              </div>\r\n              <div className=\"grid grid-cols-2 gap-1\">\r\n                <div className=\"flex items-center justify-between bg-red-50 p-0.5 rounded border border-red-200\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <ArrowDownLeft className=\"h-2 w-2 text-red-600\" />\r\n                    <span className=\"text-[10px] text-red-800\"></span>\r\n                  </div>\r\n                  <span className=\"text-[10px] font-bold text-red-700\">{formatCurrency(totals.dailyWithdraw)}</span>\r\n                </div>\r\n                <div className=\"flex items-center justify-between bg-green-50 p-0.5 rounded border border-green-200\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <ArrowRightLeft className=\"h-2 w-2 text-green-600\" />\r\n                    <span className=\"text-[10px] text-green-800\"></span>\r\n                  </div>\r\n                  <span className=\"text-[10px] font-bold text-green-700\">{formatCurrency(totals.dailyTransfer)}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/*   */}\r\n            <div className=\"bg-purple-50 p-1 rounded border border-purple-200 sm:bg-gradient-to-r sm:from-purple-50 sm:to-purple-100 sm:p-2 sm:rounded-xl sm:shadow-sm\">\r\n              <div className=\"flex items-center justify-between mb-1\">\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Calendar className=\"h-2 w-2 text-purple-600\" />\r\n                  <span className=\"text-[10px] font-semibold text-purple-800\"></span>\r\n                </div>\r\n                <span className=\"text-[10px] font-bold text-purple-900\">\r\n                  {formatCurrency((totals.monthlyWithdraw ?? 0) + (totals.monthlyTransfer ?? 0))}\r\n                </span>\r\n              </div>\r\n              <div className=\"grid grid-cols-2 gap-1\">\r\n                <div className=\"flex items-center justify-between bg-red-50 p-0.5 rounded border border-red-200\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <ArrowDownLeft className=\"h-2 w-2 text-red-600\" />\r\n                    <span className=\"text-[10px] text-red-800\"></span>\r\n                  </div>\r\n                  <span className=\"text-[10px] font-bold text-red-700\">{formatCurrency(totals.monthlyWithdraw)}</span>\r\n                </div>\r\n                <div className=\"flex items-center justify-between bg-blue-50 p-0.5 rounded border border-blue-200\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <ArrowRightLeft className=\"h-2 w-2 text-blue-600\" />\r\n                    <span className=\"text-[10px] text-blue-800\"></span>\r\n                  </div>\r\n                  <span className=\"text-[10px] font-bold text-blue-700\">{formatCurrency(totals.monthlyTransfer)}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {!isAuthenticated && (\r\n            <div className=\"absolute inset-0 bg-yellow-200/70 backdrop-blur-sm flex items-center justify-center rounded sm:rounded-2xl border border-yellow-300 pointer-events-auto\">\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                onClick={() => setIsMasterPinDialogOpen(true)}\r\n                className=\"p-2 bg-yellow-300/80 text-yellow-900 hover:bg-yellow-400/90 rounded-full shadow-sm hover:shadow-md transition-all duration-300\"\r\n                title=\"   \"\r\n              >\r\n                <Eye className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex justify-center pt-1 border-t-0 sm:pt-2 sm:border-t sm:border-purple-200\">\r\n            <Button\r\n              onClick={() => setIsOpen(false)}\r\n              className=\"bg-purple-600 hover:bg-purple-700 text-white px-4 py-1 rounded-xl text-xs sm:bg-gradient-to-r sm:from-purple-600 sm:to-purple-700 sm:hover:from-purple-700 sm:hover:to-purple-800 sm:px-4 sm:py-1 sm:rounded-xl sm:shadow-lg sm:hover:shadow-xl sm:transition-all sm:duration-300\"\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <MasterPinDialog\r\n        open={isMasterPinDialogOpen}\r\n        onOpenChange={setIsMasterPinDialogOpen}\r\n        onSuccess={handlePinSuccess}\r\n        description=\"          \"\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport const TotalProfitEyeButton: React.FC<TotalProfitDisplayDialogProps> = (props) => {\r\n  return <TotalProfitDisplayDialog {...props} />;\r\n};\r\n\r\nexport default TotalProfitDisplayDialog;\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport ReceiptModal from '@/components/ReceiptModal';\r\nimport InstallmentModal from '@/components/InstallmentModal';\r\nimport CreditCardsDialog from '@/components/CreditCardsDialog';\r\nimport MaintenanceDialog from '@/components/MaintenanceDialog';\r\nimport PasswordConfirmDialog from '@/components/PasswordConfirmDialog';\r\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\r\nimport { \r\n  ArrowLeft, \r\n  Search, \r\n  Calculator, \r\n  BarChart, \r\n  Calendar, \r\n  FileText, \r\n  Trash2,\r\n  CheckCircle,\r\n  Clock,\r\n  XCircle,\r\n  Send,\r\n  ArrowDownLeft,\r\n  CreditCard,\r\n  Wrench,\r\n  BatteryCharging,\r\n  BadgePercent,\r\n  PlayCircle\r\n} from 'lucide-react';\r\nimport { TotalProfitEyeButton } from '@/components/TotalProfitDisplayDialog';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { SubscriptionPlan } from '@/utils/subscriptionService';\r\nimport { useShift } from '@/contexts/ShiftContext';\r\nimport { useShop } from '@/hooks/useShop';\r\nimport { toast } from '@/hooks/use-toast';\r\nimport { userDataService, auditLogService } from '@/integrations/firebase/services';\r\nimport { db, auth } from '@/firebase';\r\nimport { collection, query as fsQuery, where, orderBy, onSnapshot, doc, updateDoc, getDocs, deleteDoc, getDoc, getDocsFromCache } from 'firebase/firestore';\r\nimport { formatAmount, formatNumberEnglish } from '@/utils/formatters';\r\nimport { profileService } from '@/integrations/firebase/services';\r\n\r\ninterface Transaction {\r\n  id: string;\r\n  senderPhone: string;\r\n  receiverPhone: string;\r\n  amount: number;\r\n  status: 'pending' | 'completed' | 'cancelled';\r\n  type: 'send' | 'withdraw';\r\n  createdAt: Date;\r\n  reference?: string;\r\n  commission?: number;\r\n  fee?: number;\r\n  withdrawnAmount?: number;\r\n  sentAmount?: number;\r\n  fromWallet?: string;\r\n  cashierName?: string;\r\n  commissionMode?: 'add' | 'deduct';\r\n  totalCharged?: number;\r\n  walletEffectAppliedOnCreation?: boolean;\r\n  cashEffectAppliedOnCreation?: boolean;\r\n  limitsReservedOnCreation?: boolean;\r\n  limitReservedType?: 'transfer' | 'withdraw';\r\n  senderName?: string;\r\n}\r\n\r\nconst TransactionsPage: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const { user, profile, userSubscription } = useFirebaseAuth();\r\n\r\n  const isZeroPlan = React.useMemo(() => {\r\n    const planRaw = userSubscription?.subscription?.planType \r\n      ?? userSubscription?.subscription?.plan \r\n      ?? (profile as any)?.subscription?.planType \r\n      ?? (profile as any)?.subscription?.plan \r\n      ?? null;\r\n    return planRaw === SubscriptionPlan.ZERO || String(planRaw).toLowerCase() === 'zero';\r\n  }, [\r\n    userSubscription?.subscription?.planType,\r\n    userSubscription?.subscription?.plan,\r\n    (profile as any)?.subscription?.planType,\r\n    (profile as any)?.subscription?.plan\r\n  ]);\r\n  const isTahweelaPlan = React.useMemo(() => {\r\n    const planRaw = userSubscription?.subscription?.planType \r\n      ?? userSubscription?.subscription?.plan \r\n      ?? (profile as any)?.subscription?.planType \r\n      ?? (profile as any)?.subscription?.plan \r\n      ?? null;\r\n    return planRaw === SubscriptionPlan.TAHWEELA || String(planRaw).toLowerCase() === 'tahweela';\r\n  }, [\r\n    userSubscription?.subscription?.planType,\r\n    userSubscription?.subscription?.plan,\r\n    (profile as any)?.subscription?.planType,\r\n    (profile as any)?.subscription?.plan\r\n  ]);\r\n  const { shopName } = useShop();\r\n  const { isShiftActive, shiftUser } = useShift();\r\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n  const [deletedTransactions, setDeletedTransactions] = useState<Transaction[]>([]);\r\n  const [permDeletedSet, setPermDeletedSet] = useState<Set<string>>(new Set());\r\n  const [isRestoreConfirmOpen, setIsRestoreConfirmOpen] = useState(false);\r\n  const [pendingRestoreTx, setPendingRestoreTx] = useState<Transaction | null>(null);\r\n  const [activeTab, setActiveTab] = useState('all');\r\n  const [searchPhone, setSearchPhone] = useState('');\r\n  const [selectedDate, setSelectedDate] = useState('');\r\n  const [selectedTime, setSelectedTime] = useState('');\r\n  const [isCalculatorOpen, setIsCalculatorOpen] = useState(false);\r\n  const [isInstallmentPinOpen, setIsInstallmentPinOpen] = useState(false);\r\n  const [isInstallmentModalOpen, setIsInstallmentModalOpen] = useState(false);\r\n  const [isGuideOpen, setIsGuideOpen] = useState(false);\r\n  const [guideUrl, setGuideUrl] = useState<string>('');\r\n  const [guideTitle, setGuideTitle] = useState<string>(' ');\r\n  const [guidePublishedAt, setGuidePublishedAt] = useState<Date | null>(null);\r\n  const [lastTutorialSeenAt, setLastTutorialSeenAt] = useState<Date | null>(null);\r\n  const [hasNewGuide, setHasNewGuide] = useState<boolean>(false);\r\n\r\n  React.useEffect(() => {\r\n    const plan = userSubscription?.subscription?.planType;\r\n    if (plan === SubscriptionPlan.TAHWEELA) {\r\n      toast({ title: '  ', description: '      .    / .' , variant: 'destructive' });\r\n      navigate('/user/dashboard');\r\n    }\r\n  }, [userSubscription?.subscription?.planType]);\r\n  const [isSalesDataOpen, setIsSalesDataOpen] = useState(false);\r\n  const [isDatePickerOpen, setIsDatePickerOpen] = useState(false);\r\n  const [isDebtsDialogOpen, setIsDebtsDialogOpen] = useState(false);\r\nconst [isDebtsPasswordDialogOpen, setIsDebtsPasswordDialogOpen] = useState(false);\r\n  const [isCreditCardsOpen, setIsCreditCardsOpen] = useState(false);\r\n  const [isMaintenanceOpen, setIsMaintenanceOpen] = useState(false);\r\n  const [isReceiptOpen, setIsReceiptOpen] = useState(false);\r\n  const [receiptTransaction, setReceiptTransaction] = useState<any | null>(null);\r\n  const [isResetRecentDialogOpen, setIsResetRecentDialogOpen] = useState(false);\r\n\r\n  //   :   Firestore   N  \r\n  const [recentResetConfig, setRecentResetConfig] = useState<{ keepLastCount: number; intervalDays: number; lastResetAt: Date | null }>({ keepLastCount: 30, intervalDays: 7, lastResetAt: null });\r\n  useEffect(() => {\r\n    const initWeeklyReset = async () => {\r\n      if (!user?.uid) return;\r\n      try {\r\n        const data = await userDataService.getUserData(user.uid);\r\n        const raw = (data?.recentReset || {}) as any;\r\n        const keep = Number(raw?.keepLastCount) > 0 ? Number(raw.keepLastCount) : 30;\r\n        const interval = Number(raw?.intervalDays) > 0 ? Number(raw.intervalDays) : 7;\r\n        const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : (v ? new Date(String(v)) : null);\r\n        const last: Date | null = raw?.lastResetAt ? toJsDate(raw.lastResetAt) : null;\r\n        const now = new Date();\r\n        const needReset = !last || (now.getTime() - last.getTime()) >= interval * 24 * 60 * 60 * 1000;\r\n        if (needReset) {\r\n          await userDataService.updateUserData(user.uid, { recentReset: { keepLastCount: keep, intervalDays: interval, lastResetAt: now } });\r\n          setRecentResetConfig({ keepLastCount: keep, intervalDays: interval, lastResetAt: now });\r\n        } else {\r\n          setRecentResetConfig({ keepLastCount: keep, intervalDays: interval, lastResetAt: last });\r\n        }\r\n      } catch {\r\n        //         \r\n        setRecentResetConfig({ keepLastCount: 30, intervalDays: 7, lastResetAt: null });\r\n      }\r\n    };\r\n    initWeeklyReset();\r\n  }, [user?.uid]);\r\n\r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n    const userRef = doc(db, 'users', user.uid);\r\n    const unsub = onSnapshot(userRef, (snap) => {\r\n      try {\r\n        const data: any = snap.exists() ? snap.data() : {};\r\n        const raw = data?.tutorialSeenAt;\r\n        const dt = raw?.toDate ? raw.toDate() : (raw ? new Date(raw) : null);\r\n        setLastTutorialSeenAt(dt);\r\n      } catch {}\r\n    });\r\n    return () => unsub();\r\n  }, [user?.uid]);\r\n\r\n  useEffect(() => {\r\n    const unsub = onSnapshot(doc(db, 'app_guides', 'latest'), (snap) => {\r\n      try {\r\n        const data: any = snap.exists() ? snap.data() : null;\r\n        if (!data) { setGuideUrl(''); setGuideTitle(''); setGuidePublishedAt(null); setHasNewGuide(false); return; }\r\n        const url: string = String(data.url || '');\r\n        const title: string = String(data.title || ' ');\r\n        const rawPub = data.publishedAt;\r\n        const pub: Date | null = rawPub?.toDate ? rawPub.toDate() : (rawPub ? new Date(rawPub) : new Date());\r\n        setGuideUrl(url);\r\n        setGuideTitle(title);\r\n        setGuidePublishedAt(pub);\r\n        setHasNewGuide(pub ? (!lastTutorialSeenAt || (pub.getTime() > (lastTutorialSeenAt?.getTime() || 0))) : false);\r\n      } catch (e) {\r\n        setHasNewGuide(false);\r\n      }\r\n    }, (err) => {\r\n      console.warn('    :', err);\r\n    });\r\n    return () => unsub();\r\n  }, [lastTutorialSeenAt]);\r\n\r\n  const toYouTubeEmbed = (url: string): string => {\r\n    try {\r\n      const u = new URL(url);\r\n      let id = '';\r\n      if (u.hostname.includes('youtube.com')) {\r\n        if (u.pathname === '/watch') id = u.searchParams.get('v') || '';\r\n        else if (u.pathname.startsWith('/embed/')) id = u.pathname.split('/').pop() || '';\r\n        else if (u.pathname.startsWith('/shorts/')) id = u.pathname.split('/').pop() || '';\r\n      } else if (u.hostname === 'youtu.be') {\r\n        id = u.pathname.replace(/^\\//, '');\r\n      }\r\n      if (!id) return url;\r\n      return `https://www.youtube.com/embed/${id}?autoplay=1&rel=0`;\r\n    } catch { return url; }\r\n  };\r\n\r\n  const openGuide = async () => {\r\n    setIsGuideOpen(true);\r\n    try {\r\n      if (user?.uid) {\r\n        await userDataService.updateUserData(user.uid, { tutorialSeenAt: new Date() });\r\n      }\r\n      setHasNewGuide(false);\r\n    } catch {}\r\n  };\r\n\r\n  // Top-up modal state\r\n  const [isTopUpOpen, setIsTopUpOpen] = useState(false);\r\n  const [topupPhone, setTopupPhone] = useState('');\r\n  const [topupOperator, setTopupOperator] = useState('');\r\n  const [topupAmount, setTopupAmount] = useState<number | ''>('');\r\n  const [topupLoading, setTopupLoading] = useState(false);\r\n\r\n  const [pendingDebtsCount, setPendingDebtsCount] = useState(0);\r\n  //         Firestore\r\n  useEffect(() => {\r\n    if (!user?.uid) { setPendingDebtsCount(0); return; }\r\n    const userRef = doc(db, 'users', user.uid);\r\n    const unsub = onSnapshot(userRef, (snap) => {\r\n      try {\r\n        const data: any = snap.exists() ? snap.data() : {};\r\n        const debts = Array.isArray(data?.debts) ? data.debts : [];\r\n        const count = debts.filter((d: any) => d?.status === 'pending' && ((Number(d?.amount) || 0) > 0)).length;\r\n        setPendingDebtsCount(count);\r\n      } catch {\r\n        setPendingDebtsCount(0);\r\n      }\r\n    }, (err) => {\r\n      console.warn('      Firestore:', err);\r\n      setPendingDebtsCount(0);\r\n    });\r\n    return () => unsub();\r\n  }, [user?.uid]);\r\n\r\n  useEffect(() => {\r\n    loadTransactions();\r\n    loadDeletedTransactions();\r\n  }, [user]);\r\n\r\n  //    deletedTransactions     \r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n    let unsubCloud: (() => void) | null = null;\r\n    let unsubLocal: (() => void) | null = null;\r\n    try {\r\n      const q = fsQuery(collection(db, 'deletedTransactions'), where('userId', '==', user.uid));\r\n      unsubCloud = onSnapshot(\r\n        q,\r\n        (snap) => {\r\n          try {\r\n            const keys: string[] = [];\r\n            snap.docChanges().forEach((chg) => {\r\n              const d: any = chg.doc.data();\r\n              const arr = [d.originalTransactionId, d.transactionId, d.reference, chg.doc.id]\r\n                .filter(Boolean)\r\n                .map((v) => String(v));\r\n              keys.push(...arr);\r\n            });\r\n            if (keys.length > 0) {\r\n              setPermDeletedSet((prev) => {\r\n                const next = new Set(prev);\r\n                keys.forEach((k) => next.add(k));\r\n                return next;\r\n              });\r\n              setTransactions((prev) => prev.filter((t) => {\r\n                const id = String(t.id || '');\r\n                const tid = String((t as any).transactionId || '');\r\n                const ref = String((t as any).reference || '');\r\n                return !(keys.includes(id) || keys.includes(tid) || keys.includes(ref));\r\n              }));\r\n            }\r\n          } catch (e) {\r\n            console.warn('deletedTransactions snapshot handling failed:', e);\r\n          }\r\n        },\r\n        (err) => {\r\n          console.warn('deletedTransactions subscription error:', err);\r\n        }\r\n      );\r\n      //      \r\n      try { unsubLocal = userDataService.subscribeDeletedTransactionsLocalSync(user.uid); } catch {}\r\n    } catch (e) {}\r\n    return () => {\r\n      try { unsubCloud && unsubCloud(); } catch {}\r\n      try { unsubLocal && unsubLocal(); } catch {}\r\n    };\r\n  }, [user?.uid]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        if (!user?.uid) { setPermDeletedSet(new Set()); return; }\r\n        const q = fsQuery(\r\n          collection(db, 'deletedTransactions'),\r\n          where('userId', '==', user.uid),\r\n          where('permanent', '==', true)\r\n        );\r\n        const snap = await getDocs(q);\r\n        const keys: string[] = snap.docs.flatMap(d => {\r\n          const data: any = d.data();\r\n          const arr = [data.originalTransactionId, data.transactionId, data.reference, d.id].filter(Boolean).map(String);\r\n          return arr;\r\n        });\r\n        setPermDeletedSet(new Set(keys));\r\n      } catch {\r\n        setPermDeletedSet(new Set());\r\n      }\r\n    })();\r\n  }, [user?.uid]);\r\n\r\n\r\n  //         \r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n    let unsubscribe: (() => void) | null = null;\r\n    let fallbackActive = false;\r\n\r\n    const mapAndFilter = (docs: any[]) => {\r\n      const txns = docs\r\n        .map((doc: any) => {\r\n          const data: any = doc.data();\r\n          const raw = data?.createdAt;\r\n          const createdAt = raw?.toDate ? raw.toDate() : (raw instanceof Date ? raw : new Date(raw));\r\n          return {\r\n            id: doc.id,\r\n            ...data,\r\n            createdAt\r\n          } as any;\r\n        })\r\n        .filter((t: any) => t?.status !== 'cancelled' && !t?.isDeleted)\r\n        //      \r\n        .filter((t: any) => !(t?.type === 'report' || ((t?.title || '').includes('  '))))\r\n        //           orderBy\r\n        .sort((a: any, b: any) => {\r\n          const ta = a.createdAt ? new Date(a.createdAt).getTime() : 0;\r\n          const tb = b.createdAt ? new Date(b.createdAt).getTime() : 0;\r\n          return tb - ta;\r\n        });\r\n      const filtered = txns.filter((t: any) => {\r\n        const id = String(t.id || '');\r\n        const tid = String(t.transactionId || '');\r\n        const ref = String(t.reference || t.transactionReference || '');\r\n        return !permDeletedSet.has(id) && (!tid || !permDeletedSet.has(tid)) && (!ref || !permDeletedSet.has(ref));\r\n      });\r\n      const locals = user?.uid ? userDataService.getLocalReceipts(user.uid) : [];\r\n      const merged = [...filtered, ...(Array.isArray(locals) ? locals : [])];\r\n      const getKey = (t: any) => String(\r\n        t?.transactionId || t?.id || t?.reference || t?.transactionReference || (t?.receipt?.reference) || `${new Date(t?.createdAt || Date.now()).getTime()}`\r\n      );\r\n      const seen = new Set<string>();\r\n      const distinct = merged.filter((t: any) => {\r\n        const k = getKey(t);\r\n        if (seen.has(k)) return false;\r\n        seen.add(k);\r\n        return true;\r\n      });\r\n      setTransactions(distinct.map(normalizeTransaction) as Transaction[]);\r\n    };\r\n\r\n    const subscribeFallback = () => {\r\n      const qFb = fsQuery(\r\n        collection(db, 'userTransactions'),\r\n        where('userId', '==', user.uid)\r\n      );\r\n      unsubscribe = onSnapshot(\r\n        qFb,\r\n        (snapshot) => {\r\n          try {\r\n            mapAndFilter(snapshot.docs);\r\n          } catch (e) {\r\n            console.error('     :', e);\r\n          }\r\n        },\r\n        (error) => {\r\n          console.error('     :', error);\r\n        }\r\n      );\r\n    };\r\n\r\n    (async () => {\r\n      try {\r\n        const qCache = fsQuery(\r\n          collection(db, 'userTransactions'),\r\n          where('userId', '==', user.uid)\r\n        );\r\n        const snapCache = await getDocsFromCache(qCache);\r\n        if (snapCache && snapCache.docs && snapCache.docs.length > 0) {\r\n          try { mapAndFilter(snapCache.docs); } catch {}\r\n        }\r\n      } catch {}\r\n    })();\r\n\r\n    try {\r\n      const q = fsQuery(\r\n        collection(db, 'userTransactions'),\r\n        where('userId', '==', user.uid),\r\n        orderBy('createdAt', 'desc'),\r\n        limit(200)\r\n      );\r\n      try {\r\n        unsubscribe = onSnapshot(\r\n          q,\r\n          { includeMetadataChanges: true },\r\n          (snapshot) => {\r\n            try {\r\n              mapAndFilter(snapshot.docs);\r\n            } catch (e) {\r\n              console.error('    :', e);\r\n            }\r\n          },\r\n          (error) => {\r\n            console.error('    :', error);\r\n            if (!fallbackActive) {\r\n              fallbackActive = true;\r\n              try { unsubscribe && unsubscribe(); } catch {}\r\n              subscribeFallback();\r\n            }\r\n          }\r\n        );\r\n      } catch (e) {\r\n        //       /   \r\n        const qSimple = fsQuery(\r\n          collection(db, 'userTransactions'),\r\n          where('userId', '==', user.uid)\r\n        );\r\n        unsubscribe = onSnapshot(\r\n          qSimple,\r\n          (snapshot) => {\r\n            try { mapAndFilter(snapshot.docs); } catch {}\r\n          },\r\n          (error) => {\r\n            console.error('     :', error);\r\n            if (!fallbackActive) { fallbackActive = true; subscribeFallback(); }\r\n          }\r\n        );\r\n      }\r\n    } catch (e) {\r\n      console.error('        :', e);\r\n      subscribeFallback();\r\n    }\r\n\r\n    return () => { try { unsubscribe && unsubscribe(); } catch {} };\r\n  }, [user?.uid]);\r\n\r\n  const loadTransactions = async () => {\r\n    try {\r\n      if (!user) return;\r\n      const q = fsQuery(\r\n        collection(db, 'deletedTransactions'),\r\n        where('userId', '==', user.uid),\r\n        where('permanent', '==', true)\r\n      );\r\n      const [primary, alt, permKeysRes] = await Promise.all([\r\n        userDataService.getUserTransactions(user.uid).catch(() => []),\r\n        (userDataService as any).getByUserId(user.uid).catch(() => []),\r\n        getDocs(q)\r\n          .then((snap) => snap.docs.flatMap(d => {\r\n            const data: any = d.data();\r\n            const arr = [data.originalTransactionId, data.transactionId, data.reference, d.id].filter(Boolean).map(String);\r\n            return arr;\r\n          }))\r\n          .catch(() => [])\r\n      ]);\r\n      const txns = (Array.isArray(primary) && primary.length > 0) ? primary : (Array.isArray(alt) ? alt : []);\r\n      const permSet = new Set(permKeysRes as string[]);\r\n      const transactionsWithDates = (txns || [])\r\n        .map((t: any) => ({\r\n          ...t,\r\n          createdAt: t.createdAt instanceof Date ? t.createdAt : new Date(t.createdAt)\r\n        }))\r\n        //      \r\n        .filter((t: any) => !(t?.type === 'report' || ((t?.title || '').includes('  '))));\r\n      const filtered = transactionsWithDates.filter((t: any) => {\r\n        const id = String(t.id || '');\r\n        const tid = String(t.transactionId || '');\r\n        const ref = String(t.reference || t.transactionReference || '');\r\n        return !permSet.has(id) && (!tid || !permSet.has(tid)) && (!ref || !permSet.has(ref));\r\n      });\r\n      const locals = user?.uid ? userDataService.getLocalReceipts(user.uid) : [];\r\n      const merged = [...filtered, ...(Array.isArray(locals) ? locals : [])];\r\n      const getKey = (t: any) => String(\r\n        t?.transactionId || t?.id || t?.reference || t?.transactionReference || (t?.receipt?.reference) || `${new Date(t?.createdAt || Date.now()).getTime()}`\r\n      );\r\n      const seen = new Set<string>();\r\n      const distinct = merged.filter((t: any) => {\r\n        const k = getKey(t);\r\n        if (seen.has(k)) return false;\r\n        seen.add(k);\r\n        return true;\r\n      });\r\n      setTransactions(distinct.map(normalizeTransaction) as Transaction[]);\r\n    } catch (error) {\r\n      console.error('      Firestore:', error);\r\n      toast({\r\n        title: '   ',\r\n        description: '    Firestore   .      .         .',\r\n        variant: 'destructive'\r\n      });\r\n    }\r\n  };\r\n\r\n  const loadDeletedTransactions = async () => {\r\n    try {\r\n      if (!user) return;\r\n      const deleted = await auditLogService.getDeletedTransactionsByUser(user.uid);\r\n      const deletedWithDates = deleted.map((t: any) => ({\r\n        ...t,\r\n        createdAt: t.createdAt instanceof Date ? t.createdAt : new Date(t.createdAt)\r\n      }));\r\n      setDeletedTransactions(deletedWithDates.map(normalizeTransaction) as Transaction[]);\r\n    } catch (error) {\r\n      console.error('      Firestore:', error);\r\n      toast({\r\n        title: '   ',\r\n        description: '   .      .',\r\n        variant: 'destructive'\r\n      });\r\n    }\r\n  };\r\n\r\n  const effectiveTransactions = React.useMemo(() => {\r\n    const now = new Date();\r\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\r\n    const nextMonthStart = new Date(now.getFullYear(), now.getMonth() + 1, 1);\r\n    const sorted = [...transactions].sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\r\n    return sorted.filter(t => t.createdAt >= monthStart && t.createdAt < nextMonthStart);\r\n  }, [transactions]);\r\n  const hiddenCount = React.useMemo(() => {\r\n    const now = new Date();\r\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\r\n    const nextMonthStart = new Date(now.getFullYear(), now.getMonth() + 1, 1);\r\n    return Math.max(0, (transactions?.length || 0) - (transactions || []).filter(t => t.createdAt >= monthStart && t.createdAt < nextMonthStart).length);\r\n  }, [transactions?.length]);\r\n\r\n  const filteredTransactions = effectiveTransactions.filter(transaction => {\r\n    const phoneMatch = !searchPhone || \r\n      transaction.senderPhone.includes(searchPhone) || \r\n      transaction.receiverPhone.includes(searchPhone);\r\n    \r\n    const dateMatch = !selectedDate || \r\n      transaction.createdAt.toDateString() === new Date(selectedDate).toDateString();\r\n    \r\n    const timeMatch = !selectedTime || \r\n      transaction.createdAt.toTimeString().startsWith(selectedTime);\r\n    \r\n    return phoneMatch && dateMatch && timeMatch;\r\n  });\r\n\r\n  const getStatusIcon = (status: string, type?: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return <CheckCircle className={`h-4 w-4 ${type === 'withdraw' ? 'text-red-500' : 'text-green-500'}`} />;\r\n      case 'pending':\r\n        return <Clock className=\"h-4 w-4 text-yellow-500\" />;\r\n      case 'cancelled':\r\n        return <XCircle className=\"h-4 w-4 text-red-500\" />;\r\n      default:\r\n        return <Clock className=\"h-4 w-4 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  const getStatusText = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return '';\r\n      case 'pending':\r\n        return ' ';\r\n      case 'cancelled':\r\n        return '';\r\n      default:\r\n        return ' ';\r\n    }\r\n  };\r\n\r\n  //           \r\n  const normalizeTransaction = (raw: any): Transaction => {\r\n    const statusRaw = (raw?.status ?? '').toString().toLowerCase();\r\n    const normalizedStatus: Transaction['status'] =\r\n      statusRaw === 'confirmed' || statusRaw === 'success' || statusRaw === 'completed'\r\n        ? 'completed'\r\n        : statusRaw === 'failed' || statusRaw === 'error' || statusRaw === 'cancelled' || statusRaw === 'canceled'\r\n        ? 'cancelled'\r\n        : 'pending';\r\n\r\n    const typeRaw = (raw?.type ?? raw?.txnType ?? '').toString().toLowerCase();\r\n    const normalizedType: Transaction['type'] = typeRaw === 'withdraw' ? 'withdraw' : 'send';\r\n\r\n    const sender =\r\n      raw?.senderPhone ?? raw?.senderMsisdn ?? raw?.sender_msisdn ?? raw?.sender ?? raw?.from ?? '';\r\n    const receiver =\r\n      raw?.receiverPhone ?? raw?.receiverMsisdn ?? raw?.receiver_msisdn ?? raw?.receiver ?? raw?.to ?? '';\r\n\r\n    const createdAtVal = raw?.createdAt;\r\n    const createdAt =\r\n      createdAtVal instanceof Date\r\n        ? createdAtVal\r\n        : createdAtVal?.toDate\r\n        ? createdAtVal.toDate()\r\n        : new Date(createdAtVal);\r\n\r\n    return {\r\n      id: raw?.id,\r\n      senderPhone: sender || ' ',\r\n      receiverPhone: receiver || ' ',\r\n      amount: Number(raw?.amount ?? 0),\r\n      status: normalizedStatus,\r\n      type: normalizedType,\r\n      createdAt,\r\n      commission: raw?.commission ?? undefined,\r\n      withdrawnAmount: raw?.withdrawnAmount ?? undefined,\r\n      sentAmount: raw?.sentAmount ?? undefined,\r\n      fromWallet: raw?.fromWallet ?? raw?.walletId ?? undefined,\r\n      cashierName: raw?.cashierName ?? raw?.createdByName ?? raw?.cashier ?? undefined,\r\n      commissionMode: raw?.commissionMode ?? raw?.commission_mode ?? undefined,\r\n      totalCharged: raw?.totalCharged ?? undefined,\r\n      walletEffectAppliedOnCreation: raw?.walletEffectAppliedOnCreation ?? raw?.effectsAppliedOnCreation ?? raw?.effectAppliedOnCreation ?? false,\r\n      cashEffectAppliedOnCreation: raw?.cashEffectAppliedOnCreation ?? false,\r\n      fee: raw?.fee ?? undefined,\r\n      senderName: raw?.senderName ?? raw?.customerName ?? undefined,\r\n    };\r\n  };\r\n\r\n  const mapToReceiptTransaction = (t: Transaction) => {\r\n    return {\r\n      id: t.id,\r\n      type: t.type === 'send' ? 'transfer' : 'withdraw',\r\n      sender_msisdn: t.senderPhone,\r\n      receiver_msisdn: t.receiverPhone,\r\n      amount: t.amount,\r\n      commission: t.commission || 0,\r\n      status: t.status === 'cancelled' ? 'failed' : t.status,\r\n      createdAt: t.createdAt.toISOString(),\r\n      updatedAt: t.createdAt.toISOString(),\r\n      shopName: shopName ?? profile?.shopName ?? user?.displayName ?? '',\r\n      //          \r\n      cashierName: (t as any)?.cashierName ?? null,\r\n      commissionMode: (t as any)?.commissionMode ?? undefined,\r\n      totalCharged: (t as any)?.totalCharged ?? undefined,\r\n      fee: (t as any)?.fee ?? undefined,\r\n      note: (t as any)?.note ?? (t as any)?.notes ?? undefined,\r\n      senderName: (t as any)?.senderName ?? undefined,\r\n    };\r\n  };\r\n\r\n  const handleTransactionClick = (transaction: Transaction) => {\r\n    const receiptData = mapToReceiptTransaction(transaction);\r\n    setReceiptTransaction(receiptData);\r\n    setIsReceiptOpen(true);\r\n  };\r\n\r\n  const handleOpenRestoreDialog = (tx: Transaction) => {\r\n    setPendingRestoreTx(tx);\r\n    setIsRestoreConfirmOpen(true);\r\n  };\r\n\r\n  const handleConfirmRestore = async () => {\r\n    if (!pendingRestoreTx) return;\r\n    await restoreTransaction(pendingRestoreTx.id);\r\n    setIsRestoreConfirmOpen(false);\r\n    setPendingRestoreTx(null);\r\n  };\r\n\r\n  const restoreTransaction = async (transactionId: string) => {\r\n    try {\r\n      const transactionToRestore = deletedTransactions.find(t => t.id === transactionId);\r\n      if (!transactionToRestore || !user) return;\r\n\r\n      //      Firestore  userTransactions\r\n      const newId = await userDataService.saveUserTransaction(user.uid, {\r\n        ...transactionToRestore,\r\n        userId: user.uid,\r\n        status: 'completed',\r\n        cashierName: transactionToRestore.cashierName ?? ' '\r\n      });\r\n\r\n      //      Firestore\r\n      await auditLogService.permanentlyDeleteTransaction(transactionId, user.uid);\r\n\r\n      //  \r\n      const restored = { ...transactionToRestore, id: newId } as Transaction;\r\n      setTransactions(prev => [...prev, restored]);\r\n      setDeletedTransactions(prev => prev.filter(t => t.id !== transactionId));\r\n      toast({ title: ' ', description: '    .' });\r\n    } catch (error) {\r\n      console.error('     Firestore:', error);\r\n      toast({ title: ' ', description: '     .', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  const permanentlyDeleteTransaction = async (transactionId: string) => {\r\n    try {\r\n      if (!user) return;\r\n      //      \r\n      setDeletedTransactions(prev => prev.filter(t => t.id !== transactionId));\r\n\r\n      //    Firebase (deletedTransactions + userTransactions + transactions)\r\n      await auditLogService.permanentlyDeleteTransaction(transactionId, user.uid);\r\n      await userDataService.removeUserTransaction(user.uid, transactionId);\r\n\r\n      toast({ title: '  ', description: '    .' });\r\n    } catch (error) {\r\n      console.error('   :', error);\r\n      toast({ title: '   ', description: '     .', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  //  :     \r\n  const handleCompleteReceipt = async (transactionId: string) => {\r\n    try {\r\n      const tx = transactions.find(t => t.id === transactionId);\r\n      if (!tx || !user) return;\r\n\r\n      //   : 5   /\r\n      try {\r\n        const plan = userSubscription?.subscription?.planType;\r\n        if (plan === SubscriptionPlan.ZERO) {\r\n          const { dailyOperationCountService } = await import('@/utils/dailyOperationCountService');\r\n          const opType = tx.type === 'send' ? 'transfer' : 'withdraw';\r\n          const res = await dailyOperationCountService.checkAndIncrement(user.uid, opType, 5);\r\n          if (!res.allowed) {\r\n            toast({\r\n              title: '    ',\r\n              description: '   5   /.     .',\r\n              variant: 'destructive',\r\n            });\r\n            return;\r\n          }\r\n        } else if (plan === SubscriptionPlan.TAHWEELA) {\r\n          const { dailyOperationCountService } = await import('@/utils/dailyOperationCountService');\r\n          const opType = tx.type === 'send' ? 'transfer' : 'withdraw';\r\n          const res = await dailyOperationCountService.checkAndIncrementCombined(user.uid, opType, 40);\r\n          if (!res.allowed) {\r\n            toast({\r\n              title: '    ',\r\n              description: '     40  / .',\r\n              variant: 'destructive',\r\n            });\r\n            return;\r\n          }\r\n        }\r\n      } catch (limitErr) {\r\n        console.warn('     :', limitErr);\r\n      }\r\n\r\n      //      Firebase    \r\n      const userProfile = await profileService.getById(user.uid);\r\n      if (!userProfile?.shopId) {\r\n        throw new Error('     (shopId) ');\r\n      }\r\n      const dataRef = doc(db, 'dashboardData', userProfile.shopId);\r\n      const dataSnap = await getDoc(dataRef);\r\n      let cashBalance = dataSnap.exists() ? Number((dataSnap.data() as any)?.cashBalance || 0) : 0;\r\n      const walletBalances: Record<string, number> = dataSnap.exists() ? ((dataSnap.data() as any)?.walletBalances || {}) : {};\r\n\r\n      const fromWalletIdForLimits = tx.fromWallet || Object.keys(walletBalances)[0];\r\n      const alreadyReservedLimits = Boolean((tx as any)?.limitsReservedOnCreation);\r\n      const checkAmt = Number(tx.withdrawnAmount ?? tx.sentAmount ?? tx.amount ?? 0);\r\n      const checkType = tx.type === 'send' ? 'transfer' : 'withdraw';\r\n      try {\r\n        const { walletDailyLimitsService } = await import('@/utils/walletDailyLimitsService');\r\n        const can = await walletDailyLimitsService.canPerformOperation(fromWalletIdForLimits, checkAmt, checkType);\r\n        if (!alreadyReservedLimits && !can.canPerform) {\r\n          toast({ title: ' ', description: String(can.message || '     /'), variant: 'destructive' });\r\n          return;\r\n        }\r\n      } catch {\r\n        toast({ title: '   ', description: '   ', variant: 'destructive' });\r\n        return;\r\n      }\r\n\r\n      //      \r\n      let didAddCashNow = false;\r\n      if (tx.type === 'withdraw') {\r\n        const fromWalletId = tx.fromWallet || Object.keys(walletBalances)[0];\r\n        const amount = Number(tx.withdrawnAmount ?? tx.amount ?? 0);\r\n        const commission = Number(tx.commission ?? 0);\r\n\r\n        //         \r\n        const alreadyAppliedOnCreationWallet = Boolean((tx as any)?.walletEffectAppliedOnCreation);\r\n        const alreadyAppliedOnCreationCash = Boolean((tx as any)?.cashEffectAppliedOnCreation);\r\n\r\n        if (!alreadyAppliedOnCreationWallet && fromWalletId && amount > 0) {\r\n          const current = walletBalances[fromWalletId] || 0;\r\n          walletBalances[fromWalletId] = current + amount; //        \r\n        }\r\n\r\n        if (alreadyAppliedOnCreationCash) {\r\n          cashBalance = cashBalance + amount; //    ()  \r\n        } else {\r\n          cashBalance = cashBalance - amount; //    ()  \r\n        }\r\n        didAddCashNow = true;\r\n\r\n        //      Firebase\r\n        await updateDoc(dataRef, { cashBalance, walletBalances });\r\n      } else if (tx.type === 'send') {\r\n        const commission = Number(tx.commission ?? 0);\r\n        const fee = Number((tx as any)?.fee ?? 0);\r\n        const amountToAdd = Number((tx as any)?.sentAmount ?? (tx as any)?.transferredAmount ?? tx.amount ?? 0);\r\n        const toAdd = Math.max(0, amountToAdd) + Math.max(0, fee); //   ()  \r\n        if (toAdd > 0) {\r\n          cashBalance = cashBalance + toAdd;\r\n          await updateDoc(dataRef, { cashBalance });\r\n          didAddCashNow = true;\r\n        }\r\n      }\r\n\r\n      await updateDoc(doc(db, 'userTransactions', transactionId), {\r\n        status: 'completed',\r\n        confirmedAt: new Date()\r\n      });\r\n\r\n      try {\r\n        const fromWalletId = tx.fromWallet || Object.keys(walletBalances)[0];\r\n        const amt = Number(tx.withdrawnAmount ?? tx.sentAmount ?? tx.amount ?? 0);\r\n        if (fromWalletId && amt > 0 && !alreadyReservedLimits) {\r\n          const { walletDailyLimitsService } = await import('@/utils/walletDailyLimitsService');\r\n          await walletDailyLimitsService.updateUsage(fromWalletId, amt, tx.type === 'send' ? 'transfer' : 'withdraw');\r\n        }\r\n      } catch {\r\n        toast({ title: '  ', description: '  /  ', variant: 'destructive' });\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const { ProfitService } = await import('@/utils/profitService');\r\n        const profit = ProfitService.calculateProfitFromTransaction({\r\n          type: tx.type === 'send' ? 'transfer' : 'withdraw',\r\n          amount: Number(tx.amount || 0),\r\n          commission: Number(tx.commission || 0),\r\n          fee: Number((tx as any)?.fee || 0)\r\n        });\r\n        const alreadyAdded = Boolean((tx as any)?.profitAddedOnCreation);\r\n        if (!alreadyAdded && profit > 0) {\r\n          ProfitService.addProfit(profit, user?.uid);\r\n        }\r\n      } catch {}\r\n\r\n      setTransactions(prev => prev.map(t => t.id === transactionId ? { ...t, status: 'completed' } : t));\r\n      toast({ title: ' ', description: '   .' });\r\n      setIsReceiptOpen(false);\r\n    } catch (error) {\r\n      console.error('   :', error);\r\n      toast({ title: ' ', description: '     .', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  //         \r\n  const handleDeleteReceipt = async (transactionId: string) => {\r\n    try {\r\n      const tx = transactions.find(t => t.id === transactionId);\r\n      if (!tx || !user) return;\r\n\r\n      //        \r\n      setTransactions(prev => prev.filter(t => t.id !== transactionId));\r\n      setDeletedTransactions(prev => [{ ...tx }, ...prev]);\r\n\r\n      //          +   \r\n      try {\r\n        //       transactionId/reference    \r\n        let rawTx: any = {};\r\n        try {\r\n          const snap = await getDoc(doc(db, 'userTransactions', transactionId));\r\n          rawTx = snap.exists() ? (snap.data() as any) : {};\r\n        } catch {}\r\n        const originalId = transactionId;\r\n        const linkedTxnId = String(rawTx?.transactionId || (tx as any)?.transactionId || originalId);\r\n        const linkedRef = String(\r\n          rawTx?.reference || rawTx?.transactionReference ||\r\n          (tx as any)?.reference || (tx as any)?.transactionReference || ''\r\n        );\r\n\r\n        await userDataService.removeUserTransaction(user.uid, transactionId);\r\n        await auditLogService.saveDeletedTransaction({\r\n          ...tx,\r\n          userId: user.uid,\r\n          originalTransactionId: transactionId,\r\n          transactionId: linkedTxnId,\r\n          reference: linkedRef || undefined,\r\n          permanent: true\r\n        });\r\n        try {\r\n          await auditLogService.permanentlyDeleteTransaction(transactionId, user.uid);\r\n        } catch {}\r\n      } catch (e) {\r\n        console.warn('                  :', e);\r\n      }\r\n\r\n      //       Firebase    \r\n      try {\r\n        const userProfile = await profileService.getById(user.uid);\r\n        if (!userProfile?.shopId) {\r\n          throw new Error('     (shopId) ');\r\n        }\r\n        const dataRef = doc(db, 'dashboardData', userProfile.shopId);\r\n        const dataSnap = await getDoc(dataRef);\r\n        let cashBalance: number = dataSnap.exists() ? Number((dataSnap.data() as any)?.cashBalance || 0) : 0;\r\n        const walletBalances: Record<string, number> = dataSnap.exists() ? ((dataSnap.data() as any)?.walletBalances || {}) : {};\r\n\r\n        const amount = Number(tx.withdrawnAmount ?? tx.amount ?? 0);\r\n        const commission = Number(tx.commission ?? 0);\r\n        const fromWalletId = tx.fromWallet || Object.keys(walletBalances)[0];\r\n\r\n        //          \r\n        const wasAppliedOnCreation = Boolean((tx as any)?.walletEffectAppliedOnCreation);\r\n\r\n        //   /\r\n        if (tx.type === 'send') {\r\n          //  :     +  +     .\r\n          //  :        .\r\n          const fee = Number(tx.fee ?? 0);\r\n          const sentAmount = Number((tx as any)?.sentAmount ?? (tx as any)?.transferredAmount ?? tx.amount ?? 0);\r\n          if (tx.status === 'completed') {\r\n            cashBalance = cashBalance - (sentAmount + commission + fee);\r\n          }\r\n          if (fromWalletId && sentAmount > 0) {\r\n            const current = walletBalances[fromWalletId] || 0;\r\n            walletBalances[fromWalletId] = current + sentAmount; //   \r\n          }\r\n        } else if (tx.type === 'withdraw') {\r\n          if (tx.status === 'completed') {\r\n            //  :           \r\n            cashBalance = cashBalance + amount - commission; //    \r\n            if (fromWalletId && amount > 0) {\r\n              const current = walletBalances[fromWalletId] || 0;\r\n              walletBalances[fromWalletId] = current - amount; //        \r\n            }\r\n          } else {\r\n            //    ( ):       \r\n            if (fromWalletId && wasAppliedOnCreation && amount > 0) {\r\n              const current = walletBalances[fromWalletId] || 0;\r\n              walletBalances[fromWalletId] = current - amount; //     \r\n            }\r\n            //          \r\n          }\r\n        }\r\n\r\n        //      Firebase\r\n        await updateDoc(dataRef, { cashBalance, walletBalances });\r\n      } catch (e) {\r\n        console.warn('    :', e);\r\n      }\r\n\r\n      //   / \r\n      try {\r\n        const fromWalletId = tx.fromWallet;\r\n        if (fromWalletId) {\r\n          const { walletDailyLimitsService } = await import('@/utils/walletDailyLimitsService');\r\n          //     \r\n          const limits = await walletDailyLimitsService.getWalletLimits(fromWalletId);\r\n          if (limits) {\r\n            const isTransfer = tx.type === 'send';\r\n            const update: any = { updatedAt: (await import('firebase/firestore')).serverTimestamp() };\r\n            if (isTransfer) {\r\n              update.dailyTransferUsed = Math.max(0, (limits.dailyTransferUsed || 0) - tx.amount);\r\n              update.monthlyTransferUsed = Math.max(0, (limits.monthlyTransferUsed || 0) - tx.amount);\r\n            } else {\r\n              update.dailyWithdrawUsed = Math.max(0, (limits.dailyWithdrawUsed || 0) - tx.amount);\r\n              update.monthlyWithdrawUsed = Math.max(0, (limits.monthlyWithdrawUsed || 0) - tx.amount);\r\n            }\r\n            const { doc, setDoc } = await import('firebase/firestore');\r\n            const { db } = await import('@/firebase');\r\n            const ref = doc(db, 'walletLimits', fromWalletId);\r\n            await setDoc(ref, update, { merge: true });\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.warn('   :', e);\r\n      }\r\n\r\n      //      \r\n      try {\r\n        const { ProfitService } = await import('@/utils/profitService');\r\n        const { ReportsService } = await import('@/utils/reportsService');\r\n        const txnType = tx.type === 'send' ? 'send' : 'receive';\r\n        const transactionData: any = {\r\n          txnType,\r\n          amount: tx.amount,\r\n          commission: tx.commission || 0,\r\n          createdAt: tx.createdAt,\r\n          status: 'confirmed'\r\n        };\r\n        //        \r\n        const profit = ProfitService.calculateProfitFromTransaction(transactionData);\r\n        if (profit > 0) {\r\n          ProfitService.addProfit(-profit, user.uid);\r\n        }\r\n        //    / (   )\r\n        try {\r\n          ReportsService.removeTransactionEffects(tx, user.uid);\r\n        } catch {}\r\n      } catch (e) {\r\n        console.warn('  /  :', e);\r\n      }\r\n    } catch (error) {\r\n      console.error('   :', error);\r\n    }\r\n  };\r\n\r\n  //   :            Firestore \r\n  const autoTestRanRef = useRef(false);\r\n  const location = useLocation();\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(location.search);\r\n    const shouldRun = params.get('autoTestBalances') === '1';\r\n    if (!shouldRun || autoTestRanRef.current) return;\r\n    autoTestRanRef.current = true;\r\n\r\n    (async () => {\r\n      try {\r\n        if (!user) return;\r\n        const profile = await profileService.getById(user.uid);\r\n        if (!profile?.shopId) {\r\n          console.warn('autoTest:   shopId    .');\r\n          return;\r\n        }\r\n\r\n        //        \r\n        const dataRef = doc(db, 'dashboardData', profile.shopId);\r\n        const snapBefore = await getDoc(dataRef);\r\n        const beforeCash = snapBefore.exists() ? Number((snapBefore.data() as any)?.cashBalance || 0) : 0;\r\n        const beforeWallets: Record<string, number> = snapBefore.exists() ? ((snapBefore.data() as any)?.walletBalances || {}) : {};\r\n        const fromWalletId = Object.keys(beforeWallets)[0] || undefined;\r\n\r\n        //            \r\n        const amount = 100;\r\n        const commission = 5;\r\n\r\n        //      pending\r\n        const newId = await userDataService.saveUserTransaction(user.uid, {\r\n          senderPhone: 'auto-test-sender',\r\n          receiverPhone: 'auto-test-receiver',\r\n          amount,\r\n          status: 'pending',\r\n          type: 'withdraw',\r\n          createdAt: new Date(),\r\n          reference: `AUTO-${Date.now()}`,\r\n          commission,\r\n          withdrawnAmount: amount,\r\n          fromWallet: fromWalletId,\r\n          cashierName: 'AutoTest',\r\n          commissionMode: 'add',\r\n          totalCharged: amount + commission,\r\n          walletEffectAppliedOnCreation: false\r\n        });\r\n\r\n        console.log('autoTest:     :', newId);\r\n\r\n        //       Firestore\r\n        await handleCompleteReceipt(newId);\r\n\r\n        const snapAfterComplete = await getDoc(dataRef);\r\n        const afterCashComplete = snapAfterComplete.exists() ? Number((snapAfterComplete.data() as any)?.cashBalance || 0) : 0;\r\n        const afterWalletsComplete: Record<string, number> = snapAfterComplete.exists() ? ((snapAfterComplete.data() as any)?.walletBalances || {}) : {};\r\n\r\n        //    \r\n        const expectedCashAfter = beforeCash - amount + commission;\r\n        const expectedWalletAfter = fromWalletId ? (Number(beforeWallets[fromWalletId] || 0) + amount) : undefined;\r\n        console.log('autoTest:    :', expectedCashAfter, ':', afterCashComplete);\r\n        if (fromWalletId) {\r\n          console.log('autoTest:    :', expectedWalletAfter, ':', afterWalletsComplete[fromWalletId]);\r\n        }\r\n\r\n        //    \r\n        await handleDeleteReceipt(newId);\r\n\r\n        const snapAfterDelete = await getDoc(dataRef);\r\n        const afterCashDelete = snapAfterDelete.exists() ? Number((snapAfterDelete.data() as any)?.cashBalance || 0) : 0;\r\n        const afterWalletsDelete: Record<string, number> = snapAfterDelete.exists() ? ((snapAfterDelete.data() as any)?.walletBalances || {}) : {};\r\n\r\n        console.log('autoTest:     / :', beforeCash, afterCashDelete);\r\n        if (fromWalletId) {\r\n          console.log('autoTest:     / :', beforeWallets[fromWalletId] || 0, afterWalletsDelete[fromWalletId] || 0);\r\n        }\r\n\r\n        toast({ title: '  (Firestore )', description: ' //     .', variant: 'default' });\r\n      } catch (err) {\r\n        console.error('autoTest:   :', err);\r\n        toast({ title: '  ', description: '    shopId   Firestore.', variant: 'destructive' });\r\n      }\r\n    })();\r\n  }, [location.search, user]);\r\n\r\n  //     API\r\n  const submitTopUp = async () => {\r\n    //        \r\n    const allowedEmail = 'alkaptin678678@gmail.com';\r\n    const userEmail = auth.currentUser?.email?.toLowerCase();\r\n    if (!userEmail || userEmail !== allowedEmail) {\r\n      toast({ title: ' ', description: '      .' });\r\n      return;\r\n    }\r\n    if (!topupPhone || !topupOperator || !topupAmount) {\r\n      toast({ title: ' ', description: '    ', variant: 'destructive' });\r\n      return;\r\n    }\r\n    setTopupLoading(true);\r\n    try {\r\n      //       \r\n      const serverOperatorNameMap: Record<string, string> = {\r\n        vodafone_eg: 'Vodafone',\r\n        orange_eg: 'Orange',\r\n        etisalat_eg: 'Etisalat',\r\n        we_eg: 'WE',\r\n      };\r\n      const operatorToSend = serverOperatorNameMap[topupOperator] ?? topupOperator;\r\n\r\n      //      \r\n      const controller = new AbortController();\r\n      const timeout = setTimeout(() => controller.abort(), 15000);\r\n\r\n      const idToken = await auth.currentUser?.getIdToken();\r\n      const resp = await fetch('/api/topup', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          ...(idToken ? { Authorization: `Bearer ${idToken}` } : {}),\r\n        },\r\n        body: JSON.stringify({\r\n          phone: topupPhone,\r\n          countryCode: 'EG',\r\n          operator: operatorToSend,\r\n          amount: Number(topupAmount),\r\n          useLocalAmount: true,\r\n        }),\r\n        signal: controller.signal,\r\n      });\r\n      clearTimeout(timeout);\r\n\r\n      //        JSON  \r\n      const rawText = await resp.text();\r\n      let data: any;\r\n      try {\r\n        data = JSON.parse(rawText);\r\n      } catch {\r\n        data = { success: false, message: rawText || '   ' };\r\n      }\r\n      if (resp.ok && data?.success) {\r\n        toast({ title: ' ', description: data?.message || '    ' });\r\n        setIsTopUpOpen(false);\r\n        setTopupPhone('');\r\n        setTopupOperator('');\r\n        setTopupAmount('');\r\n      } else {\r\n        toast({ title: ' ', description: data?.message || '    ', variant: 'destructive' });\r\n      }\r\n    } catch (err: any) {\r\n      console.error('Topup request error:', err);\r\n      if (err?.name === 'AbortError') {\r\n        toast({ title: ' ', description: '     .    .', variant: 'destructive' });\r\n      } else {\r\n        toast({ title: '  ', description: '  .  .', variant: 'destructive' });\r\n      }\r\n    } finally {\r\n      setTopupLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 overscroll-y-none overflow-y-auto bg-background p-4\">\r\n      <div className=\"max-w-4xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center gap-4 mb-6\">\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"sm\"\r\n            onClick={() => navigate('/user/dashboard')}\r\n            className=\"flex items-center gap-2 text-gray-600 hover:text-gray-800\"\r\n          >\r\n            <ArrowLeft className=\"h-4 w-4\" />\r\n            \r\n          </Button>\r\n          <h1 className=\"text-2xl font-bold text-gray-800\"></h1>\r\n        </div>\r\n\r\n        {/* Transactions List */}\r\n        <Card className=\"card-modern fade-in-up\">\r\n          <CardHeader className=\"pb-2 px-3 pt-3\">\r\n            <CardTitle className=\"text-sm font-bold\"> </CardTitle>\r\n            \r\n            {/*     */}\r\n            <div className=\"flex items-center gap-0.5 mt-1 relative\">\r\n              {/*    */}\r\n              <div className=\"flex items-center gap-0.5 flex-1 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]\">\r\n                <Search className=\"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors\" />\r\n                <Input\r\n                  placeholder=\"...\"\r\n                  value={searchPhone}\r\n                  onChange={(e) => setSearchPhone(e.target.value)}\r\n                  className=\"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400\"\r\n                />\r\n              </div>\r\n              \r\n              \r\n              {/*         */}\r\n              <div className=\"hidden md:flex items-center gap-1\">\r\n                {/*       */}\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"relative h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105\"\r\n                    onClick={openGuide}\r\n                    title=\" \"\r\n                  >\r\n                    <div className=\"relative inline-flex items-center justify-center h-full w-full\">\r\n                      <PlayCircle className=\"h-2.5 w-2.5\" />\r\n                      {hasNewGuide && (\r\n                        <div className=\"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-600 rounded-full\"></div>\r\n                      )}\r\n                    </div>\r\n                  </Button>\r\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\r\n                </div>\r\n                {/*      */}\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"h-5 w-5 p-0 rounded bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 hover:border-purple-300 transition-all duration-200 hover:scale-105\"\r\n                    onClick={() => {\r\n                      if (isZeroPlan || isTahweelaPlan) {\r\n                        toast({ title: ' ', description: '      .', variant: 'destructive' });\r\n                        return;\r\n                      }\r\n                      setIsInstallmentPinOpen(true);\r\n                    }}\r\n                    title=\" \"\r\n                  >\r\n                    <BadgePercent className=\"h-2.5 w-2.5\" />\r\n                  </Button>\r\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\r\n                </div>\r\n                \r\n                {/*   ( + ) */}\r\n                <div className=\"flex items-center gap-1\">\r\n                  <TotalProfitEyeButton userId={user?.uid} transactions={transactions as any[]} />\r\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\r\n                </div>\r\n                {/*     */}\r\n                 <div className=\"flex items-center gap-1\">\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"h-5 w-5 p-0 rounded bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border border-emerald-200 hover:border-emerald-300 transition-all duration-200 hover:scale-105\"\r\n                    onClick={() => { toast({ title: ' ', description: '    .' }); }}\r\n                    title=\"  \"\r\n                  >\r\n                    <CreditCard className=\"h-2.5 w-2.5\" />\r\n                  </Button>\r\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\r\n                </div>\r\n\r\n                {/*   */}\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"h-5 w-5 p-0 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:scale-105\"\r\n                    onClick={() => setIsCalculatorOpen(true)}\r\n                    title=\" \"\r\n                  >\r\n                    <Calculator className=\"h-2.5 w-2.5\" />\r\n                  </Button>\r\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\r\n                </div>\r\n                \r\n                {/*   */}\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"h-5 w-5 p-0 rounded bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 hover:border-green-300 transition-all duration-200 hover:scale-105\"\r\n                    onClick={() => {\r\n                      if (isZeroPlan) {\r\n                        toast({ title: '   ', description: '      .  .' });\r\n                        return;\r\n                      }\r\n                      setIsSalesDataOpen(true);\r\n                    }}\r\n                    title=\" \"\r\n                  >\r\n                    <BarChart className=\"h-2.5 w-2.5\" />\r\n                  </Button>\r\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\r\n                </div>\r\n                \r\n                {/*   */}\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className={`h-5 w-5 p-0 rounded border transition-all duration-200 hover:scale-105 ${\r\n                      selectedDate || selectedTime \r\n                        ? 'bg-purple-100 text-purple-600 border-purple-300' \r\n                        : 'bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200 hover:border-purple-300'\r\n                    }`}\r\n                    onClick={() => setIsDatePickerOpen(true)}\r\n                    title=\" \"\r\n                  >\r\n                    <Calendar className=\"h-2.5 w-2.5\" />\r\n                    {(selectedDate || selectedTime) && (\r\n                      <div className=\"absolute -top-0.5 -right-0.5 h-1 w-1 bg-purple-500 rounded-full\"></div>\r\n                    )}\r\n                  </Button>\r\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\r\n                </div>\r\n                \r\n                {/*  */}\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"relative h-5 w-5 p-0 rounded bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 hover:border-orange-300 transition-all duration-200 hover:scale-105\"\r\n                    onClick={() => {\r\n                      if (isZeroPlan) {\r\n                        toast({ title: '   ', description: '      .  .' });\r\n                        return;\r\n                      }\r\n                      setIsDebtsPasswordDialogOpen(true);\r\n                    }}\r\n                    title=\" \"\r\n                  >\r\n                    <div className=\"relative inline-flex items-center justify-center h-full w-full\">\r\n                      <FileText className=\"h-2.5 w-2.5\" />\r\n                      {pendingDebtsCount > 0 && (\r\n                        <div className=\"absolute -top-1 -right-1 z-10 min-w-[12px] h-[12px] px-[2px] bg-red-600 text-white rounded-full text-[8px] leading-[12px] flex items-center justify-center pointer-events-none ring-1 ring-white\">\r\n                          {pendingDebtsCount}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </Button\r\n                  >\r\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\r\n                </div>\r\n\r\n                {/*  */}\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"h-5 w-5 p-0 rounded bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:scale-105\"\r\n                    onClick={() => {\r\n                      if (isZeroPlan) {\r\n                        toast({ title: '   ', description: '     .  .' });\r\n                        return;\r\n                      }\r\n                      setIsMaintenanceOpen(true);\r\n                    }}\r\n                    title=\"\"\r\n                  >\r\n                    <Wrench className=\"h-2.5 w-2.5\" />\r\n                  </Button>\r\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\r\n                </div>\r\n                \r\n                {/*     */}\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"h-5 w-5 p-0 rounded bg-violet-50 text-violet-600 hover:bg-violet-100 border border-violet-200 hover:border-violet-300 transition-all duration-200 hover:scale-105\"\r\n                    onClick={() => {\r\n                      navigate('/user/dashboard', { state: { openCashierShiftModal: true } });\r\n                    }}\r\n                    title=\" \"\r\n                  >\r\n                    <BatteryCharging className=\"h-2.5 w-2.5\" />\r\n                  </Button>\r\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\r\n                </div>\r\n                \r\n                {/*   -      */}\r\n                <div className=\"hidden sm:flex items-center gap-1\">\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"h-5 w-5 p-0 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 transition-all duration-200 hover:scale-105\"\r\n                    onClick={() => {\r\n                      if (isZeroPlan) {\r\n                        toast({ title: '   ', description: '      .  .' });\r\n                        return;\r\n                      }\r\n                      setIsCreditCardsOpen(true);\r\n                    }}\r\n                    title=\" \"\r\n                  >\r\n                    <CreditCard className=\"h-2.5 w-2.5\" />\r\n                  </Button>\r\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\r\n                </div>\r\n\r\n                {/*    */}\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className={`h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105 relative`}\r\n                    onClick={() => {\r\n                      setIsResetRecentDialogOpen(true);\r\n                    }}\r\n                    title=\"  \"\r\n                  >\r\n                    <Trash2 className=\"h-2.5 w-2.5\" />\r\n                    {hiddenCount > 0 && (\r\n                      <div className=\"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-500 rounded-full\"></div>\r\n                    )}\r\n                  </Button>\r\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\r\n                </div>\r\n                \r\n                {/*    */}\r\n                {(searchPhone || selectedDate || selectedTime) && (\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <Button\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      className=\"h-5 w-5 p-0 rounded bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105\"\r\n                      onClick={() => {\r\n                        setSearchPhone('');\r\n                        setSelectedDate('');\r\n                        setSelectedTime('');\r\n                      }}\r\n                      title=\"\"\r\n                    >\r\n                      <span className=\"text-[10px] font-bold\"></span>\r\n                    </Button>\r\n                    <span className=\"text-[10px] font-bold text-gray-700\"></span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent className=\"px-3 pb-3\">\r\n            <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n              <TabsList className=\"hidden sm:grid w-full grid-cols-4 h-10 text-sm bg-gradient-to-r from-gray-50 via-blue-50/30 to-purple-50/30 border border-gray-200/60 rounded-md p-1 shadow-sm relative overflow-hidden\">\r\n                {/*    */}\r\n                <div className=\"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 opacity-0 hover:opacity-100 transition-all duration-200\"></div>\r\n                \r\n                <TabsTrigger \r\n                  value=\"all\" \r\n                  className=\"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-blue-200/50 hover:bg-blue-50/80 hover:text-blue-700 group\"\r\n                >\r\n                  <span className=\"relative z-10\"></span>\r\n                  <div className=\"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded\"></div>\r\n                </TabsTrigger>\r\n                \r\n                <TabsTrigger \r\n                  value=\"send\" \r\n                  className=\"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-green-200/50 hover:bg-green-50/80 hover:text-green-700 group\"\r\n                >\r\n                  <span className=\"relative z-10\"></span>\r\n                  <div className=\"absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded\"></div>\r\n                </TabsTrigger>\r\n                \r\n                <TabsTrigger \r\n                  value=\"withdraw\" \r\n                  className=\"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-orange-200/50 hover:bg-orange-50/80 hover:text-orange-700 group\"\r\n                >\r\n                  <span className=\"relative z-10\"></span>\r\n                  <div className=\"absolute inset-0 bg-gradient-to-r from-orange-500/10 to-amber-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded\"></div>\r\n                </TabsTrigger>\r\n                \r\n                <TabsTrigger \r\n                  value=\"deleted\" \r\n                  className=\"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-rose-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-red-200/50 hover:bg-red-50/80 hover:text-red-700 group\"\r\n                >\r\n                  <span className=\"relative z-10\"></span>\r\n                  <div className=\"absolute inset-0 bg-gradient-to-r from-red-500/10 to-rose-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded\"></div>\r\n                </TabsTrigger>\r\n              </TabsList>\r\n              \r\n              <TabsContent value=\"all\" className=\"mt-2 receipts-list\">\r\n                {filteredTransactions.length === 0 ? (\r\n                  <div className=\"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]\">\r\n                        \r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400\">\r\n                    {filteredTransactions.map((transaction, index) => (\r\n                      <div \r\n                        key={transaction.id} \r\n                        className=\"receipts-row flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200\"\r\n                        onClick={() => handleTransactionClick(transaction)}\r\n                      >\r\n                        <div className=\"flex items-center gap-1\">\r\n                          {getStatusIcon(transaction.status, transaction.type)}\r\n                          <div>\r\n                            <p className={`font-medium text-sm ${transaction.type === 'withdraw' ? 'text-red-700' : 'text-green-700'}`}>\r\n                              {transaction.type === 'withdraw' \r\n                                ? transaction.receiverPhone\r\n                                : `${transaction.senderPhone}  ${transaction.receiverPhone}`\r\n                              }\r\n                            </p>\r\n                            {transaction.type === 'withdraw' && (\r\n                              <>\r\n                                <p className=\"text-sm font-semibold text-red-600\">\r\n                                  {formatNumberEnglish(transaction.amount)} \r\n                                </p>\r\n                                <p className=\"text-xs text-red-600\">\r\n                                  : {formatNumberEnglish(transaction.commission || 0)} \r\n                                </p>\r\n                              </>\r\n                            )}\r\n                            <p className={`text-[10px] ${transaction.type === 'withdraw' ? 'text-red-700' : 'text-green-700'}`}>\r\n                               : {transaction.cashierName ?? ' '}\r\n                            </p>\r\n                            <p className={`text-sm ${transaction.type === 'withdraw' ? 'text-red-500' : 'text-green-600'}`}>\r\n                              {transaction.createdAt.toLocaleString('en-GB')}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                          {transaction.type !== 'withdraw' && (\r\n                            <p className=\"font-bold text-sm text-green-700\">\r\n                              {formatNumberEnglish(transaction.amount)} \r\n                            </p>\r\n                          )}\r\n                          {transaction.withdrawnAmount && (\r\n                            <p className=\"text-sm text-red-600\">\r\n                              : {formatNumberEnglish(transaction.withdrawnAmount)} \r\n                            </p>\r\n                          )}\r\n                          {transaction.sentAmount && (\r\n                            <p className=\"text-sm text-green-600\">\r\n                              : {formatNumberEnglish(transaction.sentAmount)} \r\n                            </p>\r\n                          )}\r\n                          <Badge \r\n                            variant={transaction.status === 'completed' ? 'default' : 'secondary'} \r\n                            className={`text-sm ${transaction.status === 'completed' ? (transaction.type === 'withdraw' ? 'bg-red-100 text-red-800 border-red-300' : (transaction.type === 'send' ? 'bg-green-100 text-green-800 border-green-300' : '')) : (transaction.type === 'withdraw' ? 'bg-red-100 text-red-800' : '')}`}\r\n                          >\r\n                            {transaction.type === 'withdraw' ? '' : getStatusText(transaction.status)}\r\n                          </Badge>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </TabsContent>\r\n\r\n              <TabsContent value=\"send\" className=\"mt-2 receipts-list\">\r\n                {effectiveTransactions.filter(t => t.type === 'send').length === 0 ? (\r\n                  <div className=\"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]\">\r\n                         \r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400\">\r\n                    {effectiveTransactions.filter(t => t.type === 'send').map((transaction, index) => (\r\n                      <div \r\n                        key={transaction.id} \r\n                        className=\"receipts-row flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-all duration-200\"\r\n                        onClick={() => handleTransactionClick(transaction)}\r\n                      >\r\n                        <div className=\"flex items-center gap-1\">\r\n                          {getStatusIcon(transaction.status, transaction.type)}\r\n                          <div>\r\n                            <p className=\"font-medium text-sm text-green-700\">\r\n                              {transaction.senderPhone}  {transaction.receiverPhone}\r\n                            </p>\r\n                            <p className=\"text-[10px] text-green-700\"> : {transaction.cashierName ?? ' '}</p>\r\n                            <p className=\"text-sm text-green-600\">{transaction.createdAt.toLocaleString('ar-EG')}</p>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                          <p className=\"font-bold text-sm text-green-700\">{formatNumberEnglish(transaction.amount)} </p>\r\n                          {transaction.sentAmount && (\r\n                            <p className=\"text-sm text-green-600\">\r\n                              : {formatNumberEnglish(transaction.sentAmount)} \r\n                            </p>\r\n                          )}\r\n                          <Badge \r\n                            variant={transaction.status === 'completed' ? 'default' : 'secondary'} \r\n                            className={`text-sm ${transaction.status === 'completed' ? 'bg-green-100 text-green-800 border-green-300' : ''}`}\r\n                          >\r\n                            {getStatusText(transaction.status)}\r\n                          </Badge>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </TabsContent>\r\n\r\n              <TabsContent value=\"withdraw\" className=\"mt-2 receipts-list\">\r\n                {effectiveTransactions.filter(t => t.type === 'withdraw').length === 0 ? (\r\n                  <div className=\"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]\">\r\n                         \r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400\">\r\n                    {effectiveTransactions.filter(t => t.type === 'withdraw').map((transaction, index) => (\r\n                      <div \r\n                        key={transaction.id} \r\n                        className=\"receipts-row flex items-center justify-between p-3 rounded-lg border cursor-pointer\"\r\n                        onClick={() => handleTransactionClick(transaction)}\r\n                      >\r\n                        <div className=\"flex items-center gap-1\">\r\n                          {getStatusIcon(transaction.status, transaction.type)}\r\n                          <div>\r\n                            <p className=\"font-medium text-sm text-red-700\">{transaction.receiverPhone}</p>\r\n                            <p className=\"text-[10px] text-red-700\"> : {transaction.cashierName ?? ' '}</p>\r\n                            <p className=\"text-sm text-red-500\">{transaction.createdAt.toLocaleString('ar-EG')}</p>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                          <p className=\"font-bold text-sm text-red-700\">{formatNumberEnglish(transaction.amount)} </p>\r\n                          {transaction.withdrawnAmount && (\r\n                            <p className=\"text-sm text-red-600\">: {formatNumberEnglish(transaction.withdrawnAmount)} </p>\r\n                          )}\r\n                          <Badge \r\n                            variant={transaction.status === 'completed' ? 'default' : 'secondary'} \r\n                            className={`text-sm ${transaction.status === 'completed' ? 'bg-red-100 text-red-800 border-red-300' : 'bg-red-100 text-red-800'}`}\r\n                          >\r\n                            {getStatusText(transaction.status)}\r\n                          </Badge>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </TabsContent>\r\n              <TabsContent value=\"deleted\" className=\"mt-2\">\r\n                {deletedTransactions.length === 0 ? (\r\n                  <div className=\"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]\">\r\n                       \r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400\">\r\n                    {deletedTransactions.map((transaction, index) => (\r\n                      <div \r\n                        key={transaction.id} \r\n                        className=\"receipts-row flex items-center justify-between p-3 rounded-lg border\"\r\n                      >\r\n                        <div className=\"flex items-center gap-1\">\r\n                          {getStatusIcon(transaction.status, transaction.type)}\r\n                          <div>\r\n                            <p className=\"font-medium text-sm text-red-700\">\r\n                              {transaction.type === 'withdraw' \r\n                                ? transaction.receiverPhone\r\n                                : `${transaction.senderPhone}  ${transaction.receiverPhone}`\r\n                              }\r\n                            </p>\r\n                            {transaction.type === 'withdraw' && (\r\n                              <>\r\n                                <p className=\"text-sm font-semibold text-red-600\">\r\n                                  {formatNumberEnglish(transaction.amount)} \r\n                                </p>\r\n                                <p className=\"text-xs text-orange-500\">\r\n                                  : {formatNumberEnglish(transaction.commission || 0)} \r\n                                </p>\r\n                              </>\r\n                            )}\r\n                            <p className=\"text-[10px] text-red-700\">\r\n                               : {transaction.cashierName ?? ' '}\r\n                            </p>\r\n                            <p className=\"text-sm text-red-500\">\r\n                              {transaction.createdAt.toLocaleString('ar-EG')}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"text-right mr-2\">\r\n                            {transaction.type !== 'withdraw' && (\r\n                              <p className=\"font-bold text-sm text-red-700\">\r\n                                {formatNumberEnglish(transaction.amount)} \r\n                              </p>\r\n                            )}\r\n                            <Badge variant=\"secondary\" className=\"text-[10px] bg-red-100 text-red-800\">\r\n                              \r\n                            </Badge>\r\n                          </div>\r\n                          <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            className=\"text-green-600 hover:bg-green-100 h-10 sm:h-12 px-4 sm:px-5 min-w-[44px] touch-manipulation\"\r\n                            onClick={() => handleOpenRestoreDialog(transaction)}\r\n                          >\r\n                            <span className=\"text-xs sm:text-sm\"></span>\r\n                          </Button>\r\n                          <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            className=\"text-red-600 hover:bg-red-100 h-10 sm:h-12 px-3 sm:px-4 min-w-[44px] touch-manipulation\"\r\n                            onClick={() => permanentlyDeleteTransaction(transaction.id)}\r\n                          >\r\n                            <Trash2 className=\"h-4 w-4 sm:h-5 sm:w-5\" />\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </TabsContent>\r\n            </Tabs>\r\n        </CardContent>\r\n       </Card>\r\n\r\n        {/*    */}\r\n        <Dialog open={isGuideOpen} onOpenChange={setIsGuideOpen}>\r\n          <DialogContent className=\"dialog-modern max-w-3xl w-full p-0 overflow-hidden border-0 shadow-2xl\">\r\n            <DialogHeader className=\"px-4 pt-4\">\r\n              <DialogTitle className=\"text-lg font-bold\">{guideTitle || ' '}</DialogTitle>\r\n            </DialogHeader>\r\n            <div className=\"aspect-video w-full bg-black\">\r\n              {guideUrl ? (\r\n                <iframe\r\n                  src={toYouTubeEmbed(guideUrl)}\r\n                  title=\"Application Guide\"\r\n                  className=\"w-full h-full\"\r\n                  allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\"\r\n                  allowFullScreen\r\n                />\r\n              ) : (\r\n                <div className=\"flex items-center justify-center h-full text-white/80\">    </div>\r\n              )}\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n\r\n        {/*   */}\r\n        <MaintenanceDialog open={isMaintenanceOpen} onOpenChange={setIsMaintenanceOpen} />\r\n      </div>\r\n      \r\n      {/* Credit Cards Dialog */}\r\n      <CreditCardsDialog\r\n        isOpen={isCreditCardsOpen}\r\n        onClose={() => setIsCreditCardsOpen(false)}\r\n      />\r\n      <MasterPinDialog\r\n        open={isDebtsPasswordDialogOpen}\r\n        onOpenChange={setIsDebtsPasswordDialogOpen}\r\n        mode=\"verify\"\r\n        title=\"    \"\r\n        description=\"      \"\r\n        onSuccess={() => {\r\n          setIsDebtsPasswordDialogOpen(false);\r\n          //       \r\n          navigate('/user', { state: { openDebtDialog: true } });\r\n        }}\r\n      />\r\n      <PasswordConfirmDialog\r\n        open={isResetRecentDialogOpen}\r\n        onOpenChange={setIsResetRecentDialogOpen}\r\n        title=\"     \"\r\n        description=\"        Firebase.\"\r\n        onSuccess={async () => {\r\n          try {\r\n            if (!user?.uid) {\r\n              setIsResetRecentDialogOpen(false);\r\n              return;\r\n            }\r\n            const resetAt = new Date();\r\n            const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : new Date(String(v));\r\n            //           .\r\n            //          .\r\n\r\n            //      Firestore    \r\n            await userDataService.updateUserData(user.uid, {\r\n              recentReset: {\r\n                keepLastCount: recentResetConfig.keepLastCount ?? 30,\r\n                intervalDays: recentResetConfig.intervalDays ?? 7,\r\n                lastResetAt: resetAt\r\n              }\r\n            });\r\n            setRecentResetConfig(cfg => ({ ...cfg, lastResetAt: resetAt }));\r\n\r\n            toast({ title: '   ', description: '              /  .' });\r\n          } catch (e) {\r\n            console.error('   :', e);\r\n            toast({ title: ' ', description: '     .', variant: 'destructive' });\r\n          } finally {\r\n            setIsResetRecentDialogOpen(false);\r\n          }\r\n        }}\r\n      />\r\n\r\n      {/*    */}\r\n      <Dialog open={isTopUpOpen} onOpenChange={(open) => {\r\n        if (open) {\r\n          const allowedEmail = 'alkaptin678678@gmail.com';\r\n          const userEmail = auth.currentUser?.email?.toLowerCase();\r\n          if (!userEmail || userEmail !== allowedEmail) {\r\n            toast({ title: ' ', description: '    .' });\r\n            return; //   \r\n          }\r\n          setIsTopUpOpen(true);\r\n        } else {\r\n          setIsTopUpOpen(false);\r\n        }\r\n      }}>\r\n        <DialogContent dir=\"rtl\" className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>  </DialogTitle>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-3\">\r\n            <div>\r\n              <label className=\"block text-right mb-1\"> </label>\r\n              <Input\r\n                value={topupPhone}\r\n                onChange={(e) => setTopupPhone(e.target.value)}\r\n                placeholder=\"01XXXXXXXXX\"\r\n                dir=\"ltr\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-right mb-1\"></label>\r\n              <Select value={topupOperator} onValueChange={setTopupOperator}>\r\n                <SelectTrigger className=\"w-full\">\r\n                  <SelectValue placeholder=\" \" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"vodafone_eg\"></SelectItem>\r\n                  <SelectItem value=\"orange_eg\"></SelectItem>\r\n                  <SelectItem value=\"etisalat_eg\"></SelectItem>\r\n                  <SelectItem value=\"we_eg\">WE</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-right mb-1\"> </label>\r\n              <Input\r\n                type=\"number\"\r\n                min={1}\r\n                value={topupAmount as number | ''}\r\n                onChange={(e) => setTopupAmount(e.target.value ? Number(e.target.value) : '')}\r\n                placeholder=\"50\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"flex items-center justify-between gap-2 pt-2\">\r\n              <Button variant=\"outline\" onClick={() => setIsTopUpOpen(false)}></Button>\r\n              <div className=\"flex items-center gap-2\">\r\n                <Button variant=\"secondary\" onClick={() => navigate('/topup')}>  </Button>\r\n                <Button onClick={submitTopUp} disabled={topupLoading || !topupPhone || !topupOperator || !topupAmount}>\r\n                  {topupLoading ? ' ...' : ' '}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*    */}\r\n      <Dialog open={isRestoreConfirmOpen} onOpenChange={setIsRestoreConfirmOpen}>\r\n        <DialogContent className=\"sm:max-w-[460px]\">\r\n          <DialogHeader>\r\n            <DialogTitle>  </DialogTitle>\r\n            <DialogDescription>\r\n                    .\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          {pendingRestoreTx && (\r\n            <div className=\"mt-2 space-y-2 text-sm\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-gray-600\"></span>\r\n                <span className=\"font-bold\">{pendingRestoreTx.amount} </span>\r\n              </div>\r\n              {pendingRestoreTx.type === 'withdraw' ? (\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-gray-600\"></span>\r\n                  <span className=\"font-medium\">{pendingRestoreTx.receiverPhone}</span>\r\n                </div>\r\n              ) : (\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-gray-600\">  </span>\r\n                  <span className=\"font-medium\">{pendingRestoreTx.senderPhone}  {pendingRestoreTx.receiverPhone}</span>\r\n                </div>\r\n              )}\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-gray-600\"></span>\r\n                <span className=\"font-medium\">{pendingRestoreTx.cashierName ?? ' '}</span>\r\n              </div>\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-gray-600\"></span>\r\n                <span className=\"font-medium\">{pendingRestoreTx.createdAt.toLocaleString('ar-EG')}</span>\r\n              </div>\r\n            </div>\r\n          )}\r\n          <div className=\"flex items-center justify-between gap-2 pt-3\">\r\n            <Button variant=\"outline\" onClick={() => { setIsRestoreConfirmOpen(false); setPendingRestoreTx(null); }}></Button>\r\n            <Button onClick={handleConfirmRestore}> </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <ReceiptModal\r\n        isOpen={isReceiptOpen}\r\n        onClose={() => setIsReceiptOpen(false)}\r\n        transaction={receiptTransaction}\r\n        onPrint={() => window.print()}\r\n        onDelete={handleDeleteReceipt}\r\n        onComplete={handleCompleteReceipt}\r\n      />\r\n\r\n      <MasterPinDialog\r\n        open={isInstallmentPinOpen}\r\n        onOpenChange={setIsInstallmentPinOpen}\r\n        mode=\"verify\"\r\n        title=\"  \"\r\n        description=\"       \"\r\n        onSuccess={() => {\r\n          setIsInstallmentPinOpen(false);\r\n          setIsInstallmentModalOpen(true);\r\n        }}\r\n      />\r\n\r\n      <InstallmentModal\r\n        open={isInstallmentModalOpen}\r\n        onOpenChange={setIsInstallmentModalOpen}\r\n      />\r\n    </div>\r\n  );\r\n  };\r\n\r\nexport default TransactionsPage;\r\n"],"file":"assets/TransactionsPage-B8JCFYlT.js"}