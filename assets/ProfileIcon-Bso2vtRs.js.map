{"version":3,"file":"ProfileIcon-Bso2vtRs.js","sources":["../../node_modules/lucide-react/dist/esm/icons/cloud-download.js","../../node_modules/@radix-ui/react-avatar/node_modules/@radix-ui/react-context/dist/index.mjs","../../node_modules/@radix-ui/react-avatar/node_modules/@radix-ui/react-primitive/dist/index.mjs","../../node_modules/use-sync-external-store/cjs/use-sync-external-store-shim.production.js","../../node_modules/use-sync-external-store/shim/index.js","../../node_modules/@radix-ui/react-use-is-hydrated/dist/index.mjs","../../node_modules/@radix-ui/react-avatar/dist/index.mjs","../../src/components/ui/avatar.tsx","../../src/components/ChangePasswordDialog.tsx","../../src/utils/googleDriveBackup.ts","../../src/components/ProfileIcon.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 13v8l-4-4\", key: \"1f5nwf\" }],\n  [\"path\", { d: \"m12 21 4-4\", key: \"1lfcce\" }],\n  [\"path\", { d: \"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284\", key: \"ui1hmy\" }]\n];\nconst CloudDownload = createLucideIcon(\"cloud-download\", __iconNode);\n\nexport { __iconNode, CloudDownload as default };\n//# sourceMappingURL=cloud-download.js.map\n","// src/create-context.tsx\nimport * as React from \"react\";\nimport { jsx } from \"react/jsx-runtime\";\nfunction createContext2(rootComponentName, defaultContext) {\n  const Context = React.createContext(defaultContext);\n  Context.displayName = rootComponentName + \"Context\";\n  const Provider = (props) => {\n    const { children, ...context } = props;\n    const value = React.useMemo(() => context, Object.values(context));\n    return /* @__PURE__ */ jsx(Context.Provider, { value, children });\n  };\n  Provider.displayName = rootComponentName + \"Provider\";\n  function useContext2(consumerName) {\n    const context = React.useContext(Context);\n    if (context) return context;\n    if (defaultContext !== void 0) return defaultContext;\n    throw new Error(`\\`${consumerName}\\` must be used within \\`${rootComponentName}\\``);\n  }\n  return [Provider, useContext2];\n}\nfunction createContextScope(scopeName, createContextScopeDeps = []) {\n  let defaultContexts = [];\n  function createContext3(rootComponentName, defaultContext) {\n    const BaseContext = React.createContext(defaultContext);\n    BaseContext.displayName = rootComponentName + \"Context\";\n    const index = defaultContexts.length;\n    defaultContexts = [...defaultContexts, defaultContext];\n    const Provider = (props) => {\n      const { scope, children, ...context } = props;\n      const Context = scope?.[scopeName]?.[index] || BaseContext;\n      const value = React.useMemo(() => context, Object.values(context));\n      return /* @__PURE__ */ jsx(Context.Provider, { value, children });\n    };\n    Provider.displayName = rootComponentName + \"Provider\";\n    function useContext2(consumerName, scope) {\n      const Context = scope?.[scopeName]?.[index] || BaseContext;\n      const context = React.useContext(Context);\n      if (context) return context;\n      if (defaultContext !== void 0) return defaultContext;\n      throw new Error(`\\`${consumerName}\\` must be used within \\`${rootComponentName}\\``);\n    }\n    return [Provider, useContext2];\n  }\n  const createScope = () => {\n    const scopeContexts = defaultContexts.map((defaultContext) => {\n      return React.createContext(defaultContext);\n    });\n    return function useScope(scope) {\n      const contexts = scope?.[scopeName] || scopeContexts;\n      return React.useMemo(\n        () => ({ [`__scope${scopeName}`]: { ...scope, [scopeName]: contexts } }),\n        [scope, contexts]\n      );\n    };\n  };\n  createScope.scopeName = scopeName;\n  return [createContext3, composeContextScopes(createScope, ...createContextScopeDeps)];\n}\nfunction composeContextScopes(...scopes) {\n  const baseScope = scopes[0];\n  if (scopes.length === 1) return baseScope;\n  const createScope = () => {\n    const scopeHooks = scopes.map((createScope2) => ({\n      useScope: createScope2(),\n      scopeName: createScope2.scopeName\n    }));\n    return function useComposedScopes(overrideScopes) {\n      const nextScopes = scopeHooks.reduce((nextScopes2, { useScope, scopeName }) => {\n        const scopeProps = useScope(overrideScopes);\n        const currentScope = scopeProps[`__scope${scopeName}`];\n        return { ...nextScopes2, ...currentScope };\n      }, {});\n      return React.useMemo(() => ({ [`__scope${baseScope.scopeName}`]: nextScopes }), [nextScopes]);\n    };\n  };\n  createScope.scopeName = baseScope.scopeName;\n  return createScope;\n}\nexport {\n  createContext2 as createContext,\n  createContextScope\n};\n//# sourceMappingURL=index.mjs.map\n","// src/primitive.tsx\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { createSlot } from \"@radix-ui/react-slot\";\nimport { jsx } from \"react/jsx-runtime\";\nvar NODES = [\n  \"a\",\n  \"button\",\n  \"div\",\n  \"form\",\n  \"h2\",\n  \"h3\",\n  \"img\",\n  \"input\",\n  \"label\",\n  \"li\",\n  \"nav\",\n  \"ol\",\n  \"p\",\n  \"select\",\n  \"span\",\n  \"svg\",\n  \"ul\"\n];\nvar Primitive = NODES.reduce((primitive, node) => {\n  const Slot = createSlot(`Primitive.${node}`);\n  const Node = React.forwardRef((props, forwardedRef) => {\n    const { asChild, ...primitiveProps } = props;\n    const Comp = asChild ? Slot : node;\n    if (typeof window !== \"undefined\") {\n      window[Symbol.for(\"radix-ui\")] = true;\n    }\n    return /* @__PURE__ */ jsx(Comp, { ...primitiveProps, ref: forwardedRef });\n  });\n  Node.displayName = `Primitive.${node}`;\n  return { ...primitive, [node]: Node };\n}, {});\nfunction dispatchDiscreteCustomEvent(target, event) {\n  if (target) ReactDOM.flushSync(() => target.dispatchEvent(event));\n}\nvar Root = Primitive;\nexport {\n  Primitive,\n  Root,\n  dispatchDiscreteCustomEvent\n};\n//# sourceMappingURL=index.mjs.map\n","/**\n * @license React\n * use-sync-external-store-shim.production.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\nvar React = require(\"react\");\nfunction is(x, y) {\n  return (x === y && (0 !== x || 1 / x === 1 / y)) || (x !== x && y !== y);\n}\nvar objectIs = \"function\" === typeof Object.is ? Object.is : is,\n  useState = React.useState,\n  useEffect = React.useEffect,\n  useLayoutEffect = React.useLayoutEffect,\n  useDebugValue = React.useDebugValue;\nfunction useSyncExternalStore$2(subscribe, getSnapshot) {\n  var value = getSnapshot(),\n    _useState = useState({ inst: { value: value, getSnapshot: getSnapshot } }),\n    inst = _useState[0].inst,\n    forceUpdate = _useState[1];\n  useLayoutEffect(\n    function () {\n      inst.value = value;\n      inst.getSnapshot = getSnapshot;\n      checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n    },\n    [subscribe, value, getSnapshot]\n  );\n  useEffect(\n    function () {\n      checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n      return subscribe(function () {\n        checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n      });\n    },\n    [subscribe]\n  );\n  useDebugValue(value);\n  return value;\n}\nfunction checkIfSnapshotChanged(inst) {\n  var latestGetSnapshot = inst.getSnapshot;\n  inst = inst.value;\n  try {\n    var nextValue = latestGetSnapshot();\n    return !objectIs(inst, nextValue);\n  } catch (error) {\n    return !0;\n  }\n}\nfunction useSyncExternalStore$1(subscribe, getSnapshot) {\n  return getSnapshot();\n}\nvar shim =\n  \"undefined\" === typeof window ||\n  \"undefined\" === typeof window.document ||\n  \"undefined\" === typeof window.document.createElement\n    ? useSyncExternalStore$1\n    : useSyncExternalStore$2;\nexports.useSyncExternalStore =\n  void 0 !== React.useSyncExternalStore ? React.useSyncExternalStore : shim;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('../cjs/use-sync-external-store-shim.production.js');\n} else {\n  module.exports = require('../cjs/use-sync-external-store-shim.development.js');\n}\n","// src/use-is-hydrated.tsx\nimport { useSyncExternalStore } from \"use-sync-external-store/shim\";\nfunction useIsHydrated() {\n  return useSyncExternalStore(\n    subscribe,\n    () => true,\n    () => false\n  );\n}\nfunction subscribe() {\n  return () => {\n  };\n}\nexport {\n  useIsHydrated\n};\n//# sourceMappingURL=index.mjs.map\n","\"use client\";\n\n// src/avatar.tsx\nimport * as React from \"react\";\nimport { createContextScope } from \"@radix-ui/react-context\";\nimport { useCallbackRef } from \"@radix-ui/react-use-callback-ref\";\nimport { useLayoutEffect } from \"@radix-ui/react-use-layout-effect\";\nimport { Primitive } from \"@radix-ui/react-primitive\";\nimport { useIsHydrated } from \"@radix-ui/react-use-is-hydrated\";\nimport { jsx } from \"react/jsx-runtime\";\nvar AVATAR_NAME = \"Avatar\";\nvar [createAvatarContext, createAvatarScope] = createContextScope(AVATAR_NAME);\nvar [AvatarProvider, useAvatarContext] = createAvatarContext(AVATAR_NAME);\nvar Avatar = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAvatar, ...avatarProps } = props;\n    const [imageLoadingStatus, setImageLoadingStatus] = React.useState(\"idle\");\n    return /* @__PURE__ */ jsx(\n      AvatarProvider,\n      {\n        scope: __scopeAvatar,\n        imageLoadingStatus,\n        onImageLoadingStatusChange: setImageLoadingStatus,\n        children: /* @__PURE__ */ jsx(Primitive.span, { ...avatarProps, ref: forwardedRef })\n      }\n    );\n  }\n);\nAvatar.displayName = AVATAR_NAME;\nvar IMAGE_NAME = \"AvatarImage\";\nvar AvatarImage = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAvatar, src, onLoadingStatusChange = () => {\n    }, ...imageProps } = props;\n    const context = useAvatarContext(IMAGE_NAME, __scopeAvatar);\n    const imageLoadingStatus = useImageLoadingStatus(src, imageProps);\n    const handleLoadingStatusChange = useCallbackRef((status) => {\n      onLoadingStatusChange(status);\n      context.onImageLoadingStatusChange(status);\n    });\n    useLayoutEffect(() => {\n      if (imageLoadingStatus !== \"idle\") {\n        handleLoadingStatusChange(imageLoadingStatus);\n      }\n    }, [imageLoadingStatus, handleLoadingStatusChange]);\n    return imageLoadingStatus === \"loaded\" ? /* @__PURE__ */ jsx(Primitive.img, { ...imageProps, ref: forwardedRef, src }) : null;\n  }\n);\nAvatarImage.displayName = IMAGE_NAME;\nvar FALLBACK_NAME = \"AvatarFallback\";\nvar AvatarFallback = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAvatar, delayMs, ...fallbackProps } = props;\n    const context = useAvatarContext(FALLBACK_NAME, __scopeAvatar);\n    const [canRender, setCanRender] = React.useState(delayMs === void 0);\n    React.useEffect(() => {\n      if (delayMs !== void 0) {\n        const timerId = window.setTimeout(() => setCanRender(true), delayMs);\n        return () => window.clearTimeout(timerId);\n      }\n    }, [delayMs]);\n    return canRender && context.imageLoadingStatus !== \"loaded\" ? /* @__PURE__ */ jsx(Primitive.span, { ...fallbackProps, ref: forwardedRef }) : null;\n  }\n);\nAvatarFallback.displayName = FALLBACK_NAME;\nfunction resolveLoadingStatus(image, src) {\n  if (!image) {\n    return \"idle\";\n  }\n  if (!src) {\n    return \"error\";\n  }\n  if (image.src !== src) {\n    image.src = src;\n  }\n  return image.complete && image.naturalWidth > 0 ? \"loaded\" : \"loading\";\n}\nfunction useImageLoadingStatus(src, { referrerPolicy, crossOrigin }) {\n  const isHydrated = useIsHydrated();\n  const imageRef = React.useRef(null);\n  const image = (() => {\n    if (!isHydrated) return null;\n    if (!imageRef.current) {\n      imageRef.current = new window.Image();\n    }\n    return imageRef.current;\n  })();\n  const [loadingStatus, setLoadingStatus] = React.useState(\n    () => resolveLoadingStatus(image, src)\n  );\n  useLayoutEffect(() => {\n    setLoadingStatus(resolveLoadingStatus(image, src));\n  }, [image, src]);\n  useLayoutEffect(() => {\n    const updateStatus = (status) => () => {\n      setLoadingStatus(status);\n    };\n    if (!image) return;\n    const handleLoad = updateStatus(\"loaded\");\n    const handleError = updateStatus(\"error\");\n    image.addEventListener(\"load\", handleLoad);\n    image.addEventListener(\"error\", handleError);\n    if (referrerPolicy) {\n      image.referrerPolicy = referrerPolicy;\n    }\n    if (typeof crossOrigin === \"string\") {\n      image.crossOrigin = crossOrigin;\n    }\n    return () => {\n      image.removeEventListener(\"load\", handleLoad);\n      image.removeEventListener(\"error\", handleError);\n    };\n  }, [image, crossOrigin, referrerPolicy]);\n  return loadingStatus;\n}\nvar Root = Avatar;\nvar Image = AvatarImage;\nvar Fallback = AvatarFallback;\nexport {\n  Avatar,\n  AvatarFallback,\n  AvatarImage,\n  Fallback,\n  Image,\n  Root,\n  createAvatarScope\n};\n//# sourceMappingURL=index.mjs.map\n","import * as React from \"react\"\r\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst Avatar = React.forwardRef<\r\n  React.ElementRef<typeof AvatarPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\r\n>(({ className, ...props }, ref) => (\r\n  <AvatarPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nAvatar.displayName = AvatarPrimitive.Root.displayName\r\n\r\nconst AvatarImage = React.forwardRef<\r\n  React.ElementRef<typeof AvatarPrimitive.Image>,\r\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\r\n>(({ className, ...props }, ref) => (\r\n  <AvatarPrimitive.Image\r\n    ref={ref}\r\n    className={cn(\"aspect-square h-full w-full\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\r\n\r\nconst AvatarFallback = React.forwardRef<\r\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\r\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\r\n>(({ className, ...props }, ref) => (\r\n  <AvatarPrimitive.Fallback\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\r\n\r\nexport { Avatar, AvatarImage, AvatarFallback }\r\n","import React, { useState } from \"react\";\r\nimport { Eye, EyeOff, Loader2 } from \"lucide-react\";\r\nimport { updatePassword, reauthenticateWithCredential, EmailAuthProvider } from \"firebase/auth\";\r\nimport { useFirebaseAuth } from \"@/contexts/FirebaseAuthContext\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { MasterPinDialog } from \"@/components/MasterPinDialog\";\r\n\r\ninterface ChangePasswordDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nexport function ChangePasswordDialog({ open, onOpenChange }: ChangePasswordDialogProps) {\r\n  const { user, profile } = useFirebaseAuth();\r\n  const { toast } = useToast();\r\n  const [loading, setLoading] = useState(false);\r\n  const [showCurrentPassword, setShowCurrentPassword] = useState(false);\r\n  const [showNewPassword, setShowNewPassword] = useState(false);\r\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\r\n  const [isMasterPinDialogOpen, setIsMasterPinDialogOpen] = useState(false);\r\n  const [isReauthenticated, setIsReauthenticated] = useState(false);\r\n  \r\n  const [formData, setFormData] = useState({\r\n    currentPassword: \"\",\r\n    newPassword: \"\",\r\n    confirmPassword: \"\",\r\n  });\r\n\r\n  const [errors, setErrors] = useState({\r\n    currentPassword: \"\",\r\n    newPassword: \"\",\r\n    confirmPassword: \"\",\r\n  });\r\n\r\n  const validateForm = () => {\r\n    const newErrors = {\r\n      currentPassword: \"\",\r\n      newPassword: \"\",\r\n      confirmPassword: \"\",\r\n    };\r\n\r\n    if (!formData.currentPassword) {\r\n      newErrors.currentPassword = \"كلمة المرور الحالية مطلوبة\";\r\n    }\r\n\r\n    if (!formData.newPassword) {\r\n      newErrors.newPassword = \"كلمة المرور الجديدة مطلوبة\";\r\n    } else if (formData.newPassword.length < 6) {\r\n      newErrors.newPassword = \"كلمة المرور يجب أن تكون 6 أحرف على الأقل\";\r\n    }\r\n\r\n    if (!formData.confirmPassword) {\r\n      newErrors.confirmPassword = \"تأكيد كلمة المرور مطلوب\";\r\n    } else if (formData.newPassword !== formData.confirmPassword) {\r\n      newErrors.confirmPassword = \"كلمات المرور غير متطابقة\";\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return !Object.values(newErrors).some(error => error !== \"\");\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm() || !user || !user.email) {\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      // إعادة المصادقة أولاً\r\n      const credential = EmailAuthProvider.credential(user.email, formData.currentPassword);\r\n      await reauthenticateWithCredential(user, credential);\r\n\r\n      // افتح حوار الرقم السري الرئيسي للتحقق قبل التنفيذ الفعلي\r\n      setIsReauthenticated(true);\r\n      setIsMasterPinDialogOpen(true);\r\n      toast({\r\n        title: \"تأكيد الهوية\",\r\n        description: \"أدخل الرقم السري الرئيسي لتأكيد تغيير كلمة المرور\",\r\n      });\r\n\r\n    } catch (error: any) {\r\n      console.error(\"خطأ في تغيير كلمة المرور:\", error);\r\n      \r\n      let errorMessage = \"حدث خطأ أثناء تغيير كلمة المرور\";\r\n      \r\n      if (error.code === \"auth/wrong-password\") {\r\n        setErrors(prev => ({ ...prev, currentPassword: \"كلمة المرور الحالية غير صحيحة\" }));\r\n        return;\r\n      } else if (error.code === \"auth/weak-password\") {\r\n        setErrors(prev => ({ ...prev, newPassword: \"كلمة المرور ضعيفة جداً\" }));\r\n        return;\r\n      } else if (error.code === \"auth/requires-recent-login\") {\r\n        errorMessage = \"يجب تسجيل الدخول مرة أخرى لتغيير كلمة المرور\";\r\n      }\r\n\r\n      toast({\r\n        title: \"خطأ في تغيير كلمة المرور\",\r\n        description: errorMessage,\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const performPasswordUpdate = async () => {\r\n    if (!user) return;\r\n    setLoading(true);\r\n    try {\r\n      await updatePassword(user, formData.newPassword);\r\n\r\n      toast({\r\n        title: \"تم تغيير كلمة المرور بنجاح\",\r\n        description: \"تم تحديث كلمة المرور الخاصة بك بنجاح\",\r\n      });\r\n\r\n      // إعادة تعيين النموذج وإغلاق الحوارات\r\n      setFormData({\r\n        currentPassword: \"\",\r\n        newPassword: \"\",\r\n        confirmPassword: \"\",\r\n      });\r\n      setErrors({\r\n        currentPassword: \"\",\r\n        newPassword: \"\",\r\n        confirmPassword: \"\",\r\n      });\r\n      setIsMasterPinDialogOpen(false);\r\n      setIsReauthenticated(false);\r\n      onOpenChange(false);\r\n\r\n    } catch (error: any) {\r\n      console.error(\"خطأ في تحديث كلمة المرور:\", error);\r\n      let errorMessage = \"حدث خطأ أثناء تغيير كلمة المرور\";\r\n      if (error.code === \"auth/requires-recent-login\") {\r\n        errorMessage = \"انتهت جلسة المصادقة. يرجى إعادة إدخال كلمة المرور الحالية\";\r\n      }\r\n      toast({ title: \"خطأ في تغيير كلمة المرور\", description: errorMessage, variant: \"destructive\" });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (field: keyof typeof formData) => (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setFormData(prev => ({ ...prev, [field]: e.target.value }));\r\n    // مسح الخطأ عند الكتابة\r\n    if (errors[field]) {\r\n      setErrors(prev => ({ ...prev, [field]: \"\" }));\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setFormData({\r\n      currentPassword: \"\",\r\n      newPassword: \"\",\r\n      confirmPassword: \"\",\r\n    });\r\n    setErrors({\r\n      currentPassword: \"\",\r\n      newPassword: \"\",\r\n      confirmPassword: \"\",\r\n    });\r\n    setIsMasterPinDialogOpen(false);\r\n    setIsReauthenticated(false);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={open} onOpenChange={handleClose}>\r\n        <DialogContent className=\"sm:max-w-[425px]\">\r\n          <DialogHeader>\r\n            <DialogTitle>تغيير كلمة المرور</DialogTitle>\r\n            <DialogDescription>\r\n              أدخل كلمة المرور الحالية وكلمة المرور الجديدة لتحديث حسابك\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          \r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"currentPassword\">كلمة المرور الحالية</Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"currentPassword\"\r\n                  type={showCurrentPassword ? \"text\" : \"password\"}\r\n                  value={formData.currentPassword}\r\n                  onChange={handleInputChange(\"currentPassword\")}\r\n                  className={errors.currentPassword ? \"border-red-500\" : \"\"}\r\n                  autoComplete=\"off\"\r\n                  disabled={loading}\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowCurrentPassword(!showCurrentPassword)}\r\n                  disabled={loading}\r\n                >\r\n                  {showCurrentPassword ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n              {errors.currentPassword && (\r\n                <p className=\"text-sm text-red-500\">{errors.currentPassword}</p>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"newPassword\">كلمة المرور الجديدة</Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"newPassword\"\r\n                  type={showNewPassword ? \"text\" : \"password\"}\r\n                  value={formData.newPassword}\r\n                  onChange={handleInputChange(\"newPassword\")}\r\n                  className={errors.newPassword ? \"border-red-500\" : \"\"}\r\n                  autoComplete=\"new-password\"\r\n                  disabled={loading}\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowNewPassword(!showNewPassword)}\r\n                  disabled={loading}\r\n                >\r\n                  {showNewPassword ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n              {errors.newPassword && (\r\n                <p className=\"text-sm text-red-500\">{errors.newPassword}</p>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"confirmPassword\">تأكيد كلمة المرور الجديدة</Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"confirmPassword\"\r\n                  type={showConfirmPassword ? \"text\" : \"password\"}\r\n                  value={formData.confirmPassword}\r\n                  onChange={handleInputChange(\"confirmPassword\")}\r\n                  className={errors.confirmPassword ? \"border-red-500\" : \"\"}\r\n                  autoComplete=\"new-password\"\r\n                  disabled={loading}\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowConfirmPassword(!showConfirmPassword)}\r\n                  disabled={loading}\r\n                >\r\n                  {showConfirmPassword ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n              {errors.confirmPassword && (\r\n                <p className=\"text-sm text-red-500\">{errors.confirmPassword}</p>\r\n              )}\r\n            </div>\r\n\r\n            <DialogFooter>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"outline\"\r\n                onClick={handleClose}\r\n                disabled={loading}\r\n              >\r\n                إلغاء\r\n              </Button>\r\n              <Button type=\"submit\" disabled={loading}>\r\n                {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                تغيير كلمة المرور\r\n              </Button>\r\n            </DialogFooter>\r\n          </form>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* حوار التحقق من الرقم السري الرئيسي */}\r\n      <MasterPinDialog\r\n        open={isMasterPinDialogOpen && isReauthenticated}\r\n        onOpenChange={(open) => {\r\n          setIsMasterPinDialogOpen(open);\r\n          if (!open) setIsReauthenticated(false);\r\n        }}\r\n        mode=\"verify\"\r\n        title=\"التحقق من الرقم السري الرئيسي\"\r\n        description=\"لا يمكن تغيير كلمة المرور إلا بعد التحقق من الرقم السري الرئيسي\"\r\n        userId={user?.uid}\r\n        userRole={profile?.role}\r\n        onSuccess={performPasswordUpdate}\r\n        onCancel={() => {\r\n          setIsMasterPinDialogOpen(false);\r\n          setIsReauthenticated(false);\r\n        }}\r\n      />\r\n    </>\r\n  );\r\n}","import { Capacitor } from '@capacitor/core';\r\nimport { userDataService, merchantWalletService, dailyReportsArchiveService } from '@/integrations/firebase/services';\r\nimport { GoogleAuthProvider, OAuthCredential, signInWithPopup, type Auth } from 'firebase/auth';\r\n\r\nexport interface BackupResult {\r\n  ok: boolean;\r\n  error?: string;\r\n}\r\n\r\n// ====== تخزين واسترجاع توكن جوجل على الواجهة ======\r\nconst GOOGLE_TOKEN_KEY = 'cashy.google.accessToken';\r\nconst GOOGLE_EMAIL_KEY = 'cashy.google.email';\r\nconst GOOGLE_EXPIRES_KEY = 'cashy.google.expiresAt';\r\n\r\nfunction setGoogleAccessToken(token: string, email?: string, expiresAtSeconds?: number) {\r\n  try {\r\n    localStorage.setItem(GOOGLE_TOKEN_KEY, token);\r\n    if (email) localStorage.setItem(GOOGLE_EMAIL_KEY, email);\r\n    const exp = expiresAtSeconds ?? Math.floor(Date.now() / 1000) + 3500; // ~58min\r\n    localStorage.setItem(GOOGLE_EXPIRES_KEY, String(exp));\r\n  } catch {}\r\n}\r\n\r\nexport function getGoogleAccessTokenInfo(): { token: string | null; email: string | null; expiresAt: number | null } {\r\n  try {\r\n    const token = localStorage.getItem(GOOGLE_TOKEN_KEY);\r\n    const email = localStorage.getItem(GOOGLE_EMAIL_KEY);\r\n    const expiresAtStr = localStorage.getItem(GOOGLE_EXPIRES_KEY);\r\n    const expiresAt = expiresAtStr ? Number(expiresAtStr) : null;\r\n    return { token, email, expiresAt };\r\n  } catch {\r\n    return { token: null, email: null, expiresAt: null };\r\n  }\r\n}\r\n\r\nfunction isGoogleTokenValid(): boolean {\r\n  const { token, expiresAt } = getGoogleAccessTokenInfo();\r\n  if (!token) return false;\r\n  if (!expiresAt) return true;\r\n  return Math.floor(Date.now() / 1000) < expiresAt - 30; // 30s margin\r\n}\r\n\r\nexport async function signInWithGoogleForBackup(auth: Auth): Promise<{ ok: boolean; email?: string; error?: string }> {\r\n  try {\r\n    const provider = new GoogleAuthProvider();\r\n    provider.addScope('https://www.googleapis.com/auth/drive.file');\r\n    provider.addScope('https://www.googleapis.com/auth/userinfo.email');\r\n    provider.setCustomParameters({ prompt: 'consent', access_type: 'offline', include_granted_scopes: 'true' });\r\n\r\n    const result = await signInWithPopup(auth, provider);\r\n    const credential = GoogleAuthProvider.credentialFromResult(result) as OAuthCredential | null;\r\n    const accessToken = credential?.accessToken || null;\r\n    const email = result.user?.email || undefined;\r\n    if (!accessToken) {\r\n      return { ok: false, error: 'تعذر الحصول على توكن الوصول من جوجل' };\r\n    }\r\n    setGoogleAccessToken(accessToken, email);\r\n    return { ok: true, email };\r\n  } catch (e: any) {\r\n    const message = e?.message || 'فشل تسجيل الدخول بجوجل';\r\n    return { ok: false, error: message };\r\n  }\r\n}\r\n\r\n// ====== Google Identity Services (GIS) للحصول على access token باستخدام Client ID مخصص ======\r\nfunction loadGisScript(): Promise<void> {\r\n  return new Promise((resolve, reject) => {\r\n    if ((window as any).google?.accounts?.oauth2) {\r\n      resolve();\r\n      return;\r\n    }\r\n    const s = document.createElement('script');\r\n    s.src = 'https://accounts.google.com/gsi/client';\r\n    s.async = true;\r\n    s.onload = () => resolve();\r\n    s.onerror = () => reject(new Error('فشل تحميل مكتبة Google Identity Services'));\r\n    document.head.appendChild(s);\r\n  });\r\n}\r\n\r\nexport async function signInWithGoogleForBackupGis(clientId: string): Promise<{ ok: boolean; email?: string; error?: string }> {\r\n  try {\r\n    await loadGisScript();\r\n    const googleAny = (window as any).google;\r\n    if (!googleAny?.accounts?.oauth2) return { ok: false, error: 'مكتبة Google غير متاحة' };\r\n\r\n    const scopes = 'https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.email';\r\n    const tokenPromise = new Promise<string>((resolve, reject) => {\r\n      const client = googleAny.accounts.oauth2.initTokenClient({\r\n        client_id: clientId,\r\n        scope: scopes,\r\n        callback: (resp: any) => {\r\n          if (resp?.access_token) resolve(String(resp.access_token));\r\n          else reject(new Error('تعذر الحصول على access token'));\r\n        },\r\n        prompt: 'consent',\r\n      });\r\n      // أطلق الطلب وحضّر مهلة زمنية لضمان عدم التعليق في حال ظهور صفحة خطأ من جوجل\r\n      try { client.requestAccessToken({ prompt: 'consent' }); } catch (e) { reject(e); }\r\n\r\n      const timeoutMs = 12000; // 12 ثوانٍ مهلة كافية لالتقاط الأخطاء\r\n      const timer = setTimeout(() => {\r\n        reject(new Error('انتهت المهلة أثناء طلب رمز الوصول من جوجل'));\r\n      }, timeoutMs);\r\n\r\n      // نظّف المؤقت عند الحسم\r\n      const clear = (fn: Function) => (value: any) => { clearTimeout(timer); fn(value); };\r\n      // التفاف resolve/reject لضمان تنظيف المؤقت\r\n      (resolve as any) = clear(resolve);\r\n      (reject as any) = clear(reject);\r\n    });\r\n\r\n    const accessToken = await tokenPromise;\r\n    // جلب البريد من userinfo.email\r\n    let email: string | undefined = undefined;\r\n    try {\r\n      const resp = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {\r\n        headers: { Authorization: `Bearer ${accessToken}` },\r\n      });\r\n      const data = await resp.json().catch(() => ({}));\r\n      if (data?.email) email = String(data.email);\r\n    } catch {}\r\n\r\n    setGoogleAccessToken(accessToken, email);\r\n    return { ok: true, email };\r\n  } catch (e: any) {\r\n    const msg = e?.message || 'فشل تسجيل الدخول بجوجل';\r\n    return { ok: false, error: msg };\r\n  }\r\n}\r\n\r\n// بدء تدفق OAuth عبر خادم التطبيق\r\nexport async function startServerGoogleOauth(baseUrl?: string): Promise<boolean> {\r\n  try {\r\n    // لضمان تطابق redirect_uri تمامًا مع إعداد Google Cloud\r\n    // نستخدم دومين الإنتاج مباشرة: https://cashy.link/api/google/oauth2/start\r\n    const target = 'https://cashy.link/api/google/oauth2/start';\r\n    const w = window.open(target, 'cashy_google_oauth', 'width=600,height=650,menubar=no,toolbar=no');\r\n    return !!w;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// انتظار توفر توكن السيرفر بعد إتمام الموافقة\r\nexport async function pollForServerGoogleToken(userId?: string, timeoutMs = 20000, intervalMs = 1500): Promise<boolean> {\r\n  const start = Date.now();\r\n  while (Date.now() - start < timeoutMs) {\r\n    const t = await fetchStoredRefreshToken(userId);\r\n    if (t && t.refresh_token) return true;\r\n    await new Promise(r => setTimeout(r, intervalMs));\r\n  }\r\n  return false;\r\n}\r\n\r\nexport async function fetchStoredRefreshToken(userId?: string): Promise<{ refresh_token: string; email: string } | null> {\r\n  // نحاول أولاً نقطة نهاية الإنتاج لضمان التطابق مع redirect_uri\r\n  try {\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), 6000); // 6s مهلة سريعة لتجنب التعليق\r\n    const resp = await fetch('https://cashy.link/api/google/oauth2/token', {\r\n      method: 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        ...(userId ? { 'X-USER-ID': userId } : {}),\r\n      },\r\n      credentials: 'include',\r\n      signal: controller.signal,\r\n    }).finally(() => clearTimeout(timeoutId));\r\n    const data = await resp.json().catch(() => ({}));\r\n    if (resp.ok && data?.ok && data?.refresh_token && data?.email) {\r\n      return { refresh_token: String(data.refresh_token), email: String(data.email) };\r\n    }\r\n  } catch {}\r\n\r\n  // مسارات محلية احتياطية إن كانت متاحة\r\n  for (const url of ['/api/google/oauth2/token', '/user/google-backup-token']) {\r\n    try {\r\n      const controller = new AbortController();\r\n      const timeoutId = setTimeout(() => controller.abort(), 5000);\r\n      const resp = await fetch(url, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          ...(userId ? { 'X-USER-ID': userId } : {}),\r\n        },\r\n        signal: controller.signal,\r\n      }).finally(() => clearTimeout(timeoutId));\r\n      const data = await resp.json().catch(() => ({}));\r\n      if (resp.ok && data?.ok && data?.refresh_token && data?.email) {\r\n        return { refresh_token: String(data.refresh_token), email: String(data.email) };\r\n      }\r\n    } catch {}\r\n  }\r\n  return null;\r\n}\r\n\r\nasync function exchangeRefreshToken(refreshToken: string): Promise<string | null> {\r\n  try {\r\n    const clientId = String((import.meta as any)?.env?.VITE_GOOGLE_OAUTH_CLIENT_ID || '').trim();\r\n    const clientSecret = String((import.meta as any)?.env?.VITE_GOOGLE_OAUTH_CLIENT_SECRET || '').trim();\r\n    const body = new URLSearchParams({\r\n      grant_type: 'refresh_token',\r\n      refresh_token: refreshToken,\r\n      client_id: clientId,\r\n    });\r\n    if (clientSecret) body.set('client_secret', clientSecret);\r\n    const resp = await fetch('https://oauth2.googleapis.com/token', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n      body: body.toString(),\r\n    });\r\n    const json = await resp.json().catch(() => ({}));\r\n    return json?.access_token ? String(json.access_token) : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function ensureAppFolder(accessToken: string): Promise<string | null> {\r\n  const headers = { Authorization: `Bearer ${accessToken}` };\r\n  const q = encodeURIComponent(\"name='Cashy Backup' and mimeType='application/vnd.google-apps.folder' and trashed=false\");\r\n  const listUrl = `https://www.googleapis.com/drive/v3/files?q=${q}&fields=files(id,name)`;\r\n  const resp = await fetch(listUrl, { headers });\r\n  const data = await resp.json().catch(() => ({}));\r\n  const existing = Array.isArray(data?.files) ? data.files[0] : null;\r\n  if (existing?.id) return String(existing.id);\r\n  const createResp = await fetch('https://www.googleapis.com/drive/v3/files', {\r\n    method: 'POST',\r\n    headers: { ...headers, 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ name: 'Cashy Backup', mimeType: 'application/vnd.google-apps.folder' }),\r\n  });\r\n  const created = await createResp.json().catch(() => ({}));\r\n  return created?.id ? String(created.id) : null;\r\n}\r\n\r\nasync function findLatestFileInFolder(accessToken: string, parentFolderId: string): Promise<{ id: string; name: string } | null> {\r\n  const headers = { Authorization: `Bearer ${accessToken}` };\r\n  const q = encodeURIComponent(`'${parentFolderId}' in parents and trashed=false`);\r\n  const url = `https://www.googleapis.com/drive/v3/files?q=${q}&orderBy=modifiedTime desc&fields=files(id,name,modifiedTime,createdTime)`;\r\n  const resp = await fetch(url, { headers });\r\n  const data = await resp.json().catch(() => ({}));\r\n  const f = Array.isArray(data?.files) ? data.files[0] : null;\r\n  if (f?.id) return { id: String(f.id), name: String(f.name) };\r\n  return null;\r\n}\r\n\r\nasync function uploadJsonFile(accessToken: string, parentFolderId: string, filename: string, content: any): Promise<boolean> {\r\n  const metadata = { name: filename, parents: [parentFolderId] };\r\n  const boundary = 'foo_bar_baz_' + Math.random().toString(16).slice(2);\r\n  const delimiter = `\\r\\n--${boundary}\\r\\n`;\r\n  const closeDelim = `\\r\\n--${boundary}--`;\r\n  const body =\r\n    delimiter +\r\n    'Content-Type: application/json; charset=UTF-8\\r\\n\\r\\n' +\r\n    JSON.stringify(metadata) +\r\n    delimiter +\r\n    'Content-Type: application/json\\r\\n\\r\\n' +\r\n    JSON.stringify(content) +\r\n    closeDelim;\r\n  const resp = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {\r\n    method: 'POST',\r\n    headers: {\r\n      Authorization: `Bearer ${accessToken}`,\r\n      'Content-Type': `multipart/related; boundary=${boundary}`,\r\n    },\r\n    body,\r\n  });\r\n  return resp.ok;\r\n}\r\n\r\nasync function findFile(accessToken: string, parentFolderId: string, name: string): Promise<string | null> {\r\n  const headers = { Authorization: `Bearer ${accessToken}` };\r\n  const q = encodeURIComponent(`name='${name}' and '${parentFolderId}' in parents and trashed=false`);\r\n  const url = `https://www.googleapis.com/drive/v3/files?q=${q}&fields=files(id,name)`;\r\n  const resp = await fetch(url, { headers });\r\n  const data = await resp.json().catch(() => ({}));\r\n  const f = Array.isArray(data?.files) ? data.files[0] : null;\r\n  return f?.id ? String(f.id) : null;\r\n}\r\n\r\nasync function downloadFileJson(accessToken: string, fileId: string): Promise<any | null> {\r\n  const url = `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`;\r\n  const resp = await fetch(url, { headers: { Authorization: `Bearer ${accessToken}` } });\r\n  if (!resp.ok) return null;\r\n  const text = await resp.text();\r\n  try { return JSON.parse(text); } catch { return null; }\r\n}\r\n\r\nfunction collectLocalBackupData(): any {\r\n  const data: Record<string, any> = {};\r\n  try {\r\n    for (let i = 0; i < localStorage.length; i++) {\r\n      const key = localStorage.key(i);\r\n      if (!key) continue;\r\n      const val = localStorage.getItem(key);\r\n      data[key] = val;\r\n    }\r\n  } catch {}\r\n  return { platform: Capacitor.getPlatform(), ts: new Date().toISOString(), localStorage: data };\r\n}\r\n\r\nfunction restoreLocalBackupData(content: any): boolean {\r\n  try {\r\n    const obj = content?.localStorage;\r\n    if (obj && typeof obj === 'object') {\r\n      for (const [k, v] of Object.entries(obj)) {\r\n        localStorage.setItem(String(k), String(v ?? ''));\r\n      }\r\n      return true;\r\n    }\r\n  } catch {}\r\n  return false;\r\n}\r\n\r\nexport async function backupToGoogleDrive(userId?: string): Promise<BackupResult> {\r\n  // أولاً جرّب التوكن المخزّن في الواجهة (تسجيل الدخول بجوجل عبر Firebase)\r\n  let accessToken: string | null = null;\r\n  if (isGoogleTokenValid()) {\r\n    accessToken = getGoogleAccessTokenInfo().token;\r\n  }\r\n  // إن لم يكن متاحاً، نعود للتوكن المخزن بالخادم (في حال تم ربط سابقاً)\r\n  if (!accessToken) {\r\n    const stored = await fetchStoredRefreshToken(userId);\r\n    if (!stored) return { ok: false, error: 'لا يوجد ربط بحساب جوجل. يرجى تسجيل الدخول بجوجل أولاً.' };\r\n    accessToken = await exchangeRefreshToken(stored.refresh_token);\r\n  }\r\n  if (!accessToken) return { ok: false, error: 'فشل إنشاء access token' };\r\n  const folderId = await ensureAppFolder(accessToken);\r\n  if (!folderId) return { ok: false, error: 'فشل إنشاء/إيجاد مجلد التطبيق' };\r\n  const content = await collectFullBackupData(userId);\r\n  const tsName = `cashy-backup-${new Date().toISOString().replace(/[.:]/g, '-')}.json`;\r\n  const ok = await uploadJsonFile(accessToken, folderId, tsName, content);\r\n  return ok ? { ok: true } : { ok: false, error: 'فشل رفع الملف' };\r\n}\r\n\r\nexport async function restoreFromGoogleDrive(userId?: string): Promise<BackupResult> {\r\n  // أولاً جرّب التوكن المخزّن في الواجهة\r\n  let accessToken: string | null = null;\r\n  if (isGoogleTokenValid()) {\r\n    accessToken = getGoogleAccessTokenInfo().token;\r\n  }\r\n  // إن لم يكن متاحاً، نعود للتوكن المخزن بالخادم\r\n  if (!accessToken) {\r\n    const stored = await fetchStoredRefreshToken(userId);\r\n    if (!stored) return { ok: false, error: 'لا يوجد ربط بحساب جوجل. يرجى تسجيل الدخول بجوجل أولاً.' };\r\n    accessToken = await exchangeRefreshToken(stored.refresh_token);\r\n  }\r\n  if (!accessToken) return { ok: false, error: 'فشل إنشاء access token' };\r\n  const folderId = await ensureAppFolder(accessToken);\r\n  if (!folderId) return { ok: false, error: 'فشل إيجاد مجلد التطبيق' };\r\n  const latest = await findLatestFileInFolder(accessToken, folderId);\r\n  if (!latest?.id) return { ok: false, error: 'لا توجد نسخة احتياطية' };\r\n  const json = await downloadFileJson(accessToken, latest.id);\r\n  if (!json) return { ok: false, error: 'فشل تنزيل النسخة' };\r\n  const okLocal = restoreLocalBackupData(json);\r\n  const okFirestore = await restoreFullBackupData(userId, json);\r\n  return okLocal && okFirestore ? { ok: true } : { ok: false, error: 'فشل الاسترجاع' };\r\n}\r\n\r\n// إصدارات صريحة تعتمد فقط على التوكن المخزن في الواجهة\r\nexport async function backupToGoogleDriveWithUiToken(userId?: string): Promise<BackupResult> {\r\n  if (!isGoogleTokenValid()) return { ok: false, error: 'يرجى تسجيل الدخول بجوجل أولاً' };\r\n  const token = getGoogleAccessTokenInfo().token!;\r\n  const folderId = await ensureAppFolder(token);\r\n  if (!folderId) return { ok: false, error: 'فشل إنشاء/إيجاد مجلد التطبيق' };\r\n  const content = await collectFullBackupData(userId);\r\n  const tsName = `cashy-backup-${new Date().toISOString().replace(/[.:]/g, '-')}.json`;\r\n  const ok = await uploadJsonFile(token, folderId, tsName, content);\r\n  return ok ? { ok: true } : { ok: false, error: 'فشل رفع الملف' };\r\n}\r\n\r\nexport async function restoreFromGoogleDriveWithUiToken(userId?: string): Promise<BackupResult> {\r\n  if (!isGoogleTokenValid()) return { ok: false, error: 'يرجى تسجيل الدخول بجوجل أولاً' };\r\n  const token = getGoogleAccessTokenInfo().token!;\r\n  const folderId = await ensureAppFolder(token);\r\n  if (!folderId) return { ok: false, error: 'فشل إيجاد مجلد التطبيق' };\r\n  const latest = await findLatestFileInFolder(token, folderId);\r\n  if (!latest?.id) return { ok: false, error: 'لا توجد نسخة احتياطية' };\r\n  const json = await downloadFileJson(token, latest.id);\r\n  if (!json) return { ok: false, error: 'فشل تنزيل النسخة' };\r\n  const okLocal = restoreLocalBackupData(json);\r\n  const okFirestore = await restoreFullBackupData(userId, json);\r\n  return okLocal && okFirestore ? { ok: true } : { ok: false, error: 'فشل الاسترجاع' };\r\n}\r\n\r\nexport async function saveGoogleBackupToken(userId: string, email: string, refreshToken: string): Promise<boolean> {\r\n  try {\r\n    const resp = await fetch('/user/google-backup-token', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json', 'X-USER-ID': userId },\r\n      body: JSON.stringify({ email, refresh_token: refreshToken }),\r\n    });\r\n    const data = await resp.json().catch(() => ({}));\r\n    return !!(resp.ok && data?.ok);\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ====== دعم النسخ الاحتياطي/الاسترجاع لبيانات Firestore (المحافظ – المعاملات – الديون – العملاء – التقارير) ======\r\n\r\nfunction serializeDate(val: any): any {\r\n  if (val instanceof Date) return val.toISOString();\r\n  return val;\r\n}\r\n\r\nfunction deepSerializeDates(obj: any): any {\r\n  if (obj === null || obj === undefined) return obj;\r\n  if (Array.isArray(obj)) return obj.map(deepSerializeDates);\r\n  if (typeof obj === 'object') {\r\n    const out: Record<string, any> = {};\r\n    for (const [k, v] of Object.entries(obj)) {\r\n      if (v instanceof Date) out[k] = serializeDate(v);\r\n      else out[k] = deepSerializeDates(v);\r\n    }\r\n    return out;\r\n  }\r\n  return obj;\r\n}\r\n\r\nasync function collectFullBackupData(userId?: string): Promise<any> {\r\n  // في حال عدم توفر userId، نوفر نسخة احتياطية محلية فقط\r\n  if (!userId) {\r\n    return {\r\n      version: 2,\r\n      ts: new Date().toISOString(),\r\n      userId: null,\r\n      local: collectLocalBackupData(),\r\n    };\r\n  }\r\n\r\n  try {\r\n    const [userData, wallets, transactions, reports] = await Promise.all([\r\n      userDataService.getUserData(userId),\r\n      merchantWalletService.getByMerchantId(userId),\r\n      userDataService.getUserTransactions(userId),\r\n      dailyReportsArchiveService.getByUser(userId, 500),\r\n    ]);\r\n\r\n    return {\r\n      version: 2,\r\n      ts: new Date().toISOString(),\r\n      userId,\r\n      local: collectLocalBackupData(),\r\n      firestore: {\r\n        userData: deepSerializeDates(userData),\r\n        wallets: deepSerializeDates(wallets),\r\n        userTransactions: deepSerializeDates(transactions),\r\n        dailyReportsArchive: deepSerializeDates(reports),\r\n      },\r\n    };\r\n  } catch (e) {\r\n    // في حال فشل جمع Firestore، لا نفشل النسخ الاحتياطي بالكامل — نعود للنسخة المحلية\r\n    return {\r\n      version: 2,\r\n      ts: new Date().toISOString(),\r\n      userId,\r\n      local: collectLocalBackupData(),\r\n      firestore: null,\r\n      error: 'تعذر جمع بعض بيانات Firestore',\r\n    };\r\n  }\r\n}\r\n\r\nfunction parseDateMaybe(val: any): any {\r\n  if (typeof val === 'string') {\r\n    const d = new Date(val);\r\n    if (!isNaN(d.getTime())) return d;\r\n  }\r\n  return val;\r\n}\r\n\r\nfunction deepParseDates(obj: any): any {\r\n  if (obj === null || obj === undefined) return obj;\r\n  if (Array.isArray(obj)) return obj.map(deepParseDates);\r\n  if (typeof obj === 'object') {\r\n    const out: Record<string, any> = {};\r\n    for (const [k, v] of Object.entries(obj)) {\r\n      out[k] = v instanceof Date ? v : parseDateMaybe(deepParseDates(v));\r\n    }\r\n    return out;\r\n  }\r\n  return obj;\r\n}\r\n\r\nasync function restoreFullBackupData(userId: string | undefined, content: any): Promise<boolean> {\r\n  try {\r\n    if (!userId) return false;\r\n    const firestore = content?.firestore;\r\n    const hasFs = firestore && typeof firestore === 'object';\r\n    if (!hasFs) return true; // اكتفِ بالنسخة المحلية\r\n\r\n    // 1) استرجاع بيانات المستخدم (تشمل الديون والعملاء والأرصدة والتقارير الملخصة)\r\n    if (firestore.userData) {\r\n      const parsedUserData = deepParseDates(firestore.userData);\r\n      try {\r\n        await userDataService.saveUserData(userId, parsedUserData);\r\n      } catch {}\r\n    }\r\n\r\n    // 2) استرجاع المحافظ\r\n    if (Array.isArray(firestore.wallets)) {\r\n      try {\r\n        const existing = await merchantWalletService.getByMerchantId(userId);\r\n        const existingKey = new Set(\r\n          existing.map(w => `${w.provider}|${w.msisdn}`)\r\n        );\r\n        for (const wRaw of firestore.wallets) {\r\n          const w = deepParseDates(wRaw);\r\n          const key = `${w.provider}|${w.msisdn}`;\r\n          if (!existingKey.has(key)) {\r\n            // أنشئ محفظة جديدة للمستخدم الحالي\r\n            await merchantWalletService.create({\r\n              merchantUserId: userId,\r\n              provider: w.provider,\r\n              msisdn: w.msisdn,\r\n              label: w.label ?? undefined,\r\n              isActive: w.isActive ?? true,\r\n              dailyLimit: Number(w.dailyLimit ?? 0),\r\n              monthlyLimit: Number(w.monthlyLimit ?? 0),\r\n              transferLimit: Number(w.transferLimit ?? 200000),\r\n              withdrawLimit: Number(w.withdrawLimit ?? 200000),\r\n              transferUsage: Number(w.transferUsage ?? 0),\r\n              withdrawUsage: Number(w.withdrawUsage ?? 0),\r\n              dailyTransferLimit: w.dailyTransferLimit ?? undefined,\r\n              dailyWithdrawLimit: w.dailyWithdrawLimit ?? undefined,\r\n              defaultTransferCommission: w.defaultTransferCommission ?? null,\r\n              defaultWithdrawCommission: w.defaultWithdrawCommission ?? null,\r\n            } as any);\r\n          }\r\n        }\r\n      } catch {}\r\n    }\r\n\r\n    // 3) استرجاع المعاملات (userTransactions) مع منع التكرار عبر الخدمة\r\n    if (Array.isArray(firestore.userTransactions)) {\r\n      try {\r\n        for (const tRaw of firestore.userTransactions) {\r\n          const t = deepParseDates(tRaw);\r\n          await userDataService.saveUserTransaction(userId, t);\r\n        }\r\n      } catch {}\r\n    }\r\n\r\n    // 4) استرجاع أرشيف التقارير اليومية مع تخطي الموجود\r\n    if (Array.isArray(firestore.dailyReportsArchive)) {\r\n      try {\r\n        const existingReports = await dailyReportsArchiveService.getByUser(userId, 1000);\r\n        const existKey = new Set(\r\n          existingReports.map(r => `${r.reportDate}|${r.walletId ?? 'null'}`)\r\n        );\r\n        for (const rRaw of firestore.dailyReportsArchive) {\r\n          const r = deepParseDates(rRaw);\r\n          const key = `${r.reportDate}|${r.walletId ?? 'null'}`;\r\n          if (!existKey.has(key)) {\r\n            await dailyReportsArchiveService.add({\r\n              userId,\r\n              reportDate: String(r.reportDate),\r\n              totalTransactions: Number(r.totalTransactions || 0),\r\n              totalAmount: Number(r.totalAmount || 0),\r\n              totalWithdrawn: Number(r.totalWithdrawn || 0),\r\n              totalSent: Number(r.totalSent || 0),\r\n              profit: r.profit !== undefined ? Number(r.profit) : undefined,\r\n              walletId: r.walletId ?? null,\r\n            });\r\n          }\r\n        }\r\n      } catch {}\r\n    }\r\n\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}","import React, { useState, useEffect } from \"react\";\r\nimport { User, Settings, LogOut, Shield, CloudUpload, RefreshCw, LogIn, Cloud, DownloadCloud } from \"lucide-react\";\r\nimport { useFirebaseAuth } from \"@/contexts/FirebaseAuthContext\";\r\nimport { useShift } from \"@/contexts/ShiftContext\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuLabel,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\r\nimport { ChangePasswordDialog } from \"./ChangePasswordDialog\";\r\nimport { getAvatarById } from \"@/utils/avatars\";\r\nimport { backupToGoogleDriveWithUiToken, restoreFromGoogleDriveWithUiToken, signInWithGoogleForBackupGis, signInWithGoogleForBackup, getGoogleAccessTokenInfo, startServerGoogleOauth, pollForServerGoogleToken, fetchStoredRefreshToken, saveGoogleBackupToken } from \"@/utils/googleDriveBackup\";\r\nimport { auth } from \"@/firebase\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { FreeTrialService } from \"@/utils/freeTrialService\";\r\nimport { listenDesktopUpdates, selectDesktopUrl } from \"@/utils/appDownloadService\";\r\n\r\ninterface ProfileIconProps {\r\n  className?: string;\r\n}\r\n\r\nexport function ProfileIcon({ className }: ProfileIconProps) {\r\n  const { user, profile, signOut, updateUserProfile } = useFirebaseAuth();\r\n  const navigate = useNavigate();\r\n  const [showChangePassword, setShowChangePassword] = useState(false);\r\n  const { isShiftActive } = useShift();\r\n  const { toast } = useToast();\r\n  const [isBackingUp, setIsBackingUp] = useState(false);\r\n  const [isRestoring, setIsRestoring] = useState(false);\r\n  const [isGoogleSigning, setIsGoogleSigning] = useState(false);\r\n  const [{ token: googleToken }, setGoogleTokenInfo] = useState(() => getGoogleAccessTokenInfo());\r\n\r\n  type ElectronAPI = {\r\n    onUpdateAvailable: (cb: (payload: unknown) => void) => void;\r\n    onUpdateDownloaded: (cb: (payload: unknown) => void) => void;\r\n    onUpdateError: (cb: (payload: any) => void) => void;\r\n    onUpdateProgress?: (cb: (payload: { percent?: number|null; downloaded?: number; total?: number }) => void) => void;\r\n    checkUpdate: () => Promise<unknown>;\r\n    downloadUpdate: () => Promise<unknown>;\r\n    applyUpdate: () => Promise<unknown>;\r\n    openUpdateFolder?: () => Promise<unknown>;\r\n    appVersion?: () => Promise<string>;\r\n  };\r\n  const electronAPI = (typeof window !== 'undefined' ? (window as unknown as { electronAPI?: ElectronAPI }).electronAPI : undefined);\r\n  const isElectron = !!electronAPI;\r\n  const [updateAvailable, setUpdateAvailable] = useState<boolean>(false);\r\n  const [updateDialogOpen, setUpdateDialogOpen] = useState<boolean>(false);\r\n  const [updateVersion, setUpdateVersion] = useState<string>('');\r\n  const [updateNotes, setUpdateNotes] = useState<string>('');\r\n  const [updateForce, setUpdateForce] = useState<boolean>(false);\r\n  const [updateProgress, setUpdateProgress] = useState<number>(0);\r\n  const [isDownloadingUpdate, setIsDownloadingUpdate] = useState<boolean>(false);\r\n  const [updateDownloadUrl, setUpdateDownloadUrl] = useState<string>(\"\");\r\n  const [currentVersion, setCurrentVersion] = useState<string>(\"\");\r\n  const [autoApplied, setAutoApplied] = useState<boolean>(false);\r\n  \r\n  const [freeTrialHoursRemaining, setFreeTrialHoursRemaining] = useState(0);\r\n  const [isOnFreeTrial, setIsOnFreeTrial] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const checkTrial = async () => {\r\n      if (!user?.uid) return;\r\n      const trialValidity = await FreeTrialService.checkTrialValidity(user.uid);\r\n      setIsOnFreeTrial(trialValidity.isValid && !trialValidity.isExpired);\r\n      setFreeTrialHoursRemaining(trialValidity.hoursRemaining);\r\n    };\r\n    checkTrial();\r\n  }, [user?.uid]);\r\n\r\n  const compareVersions = (a?: string, b?: string): number => {\r\n    const pa = String(a || '').split('.').map((x) => parseInt(x, 10) || 0);\r\n    const pb = String(b || '').split('.').map((x) => parseInt(x, 10) || 0);\r\n    for (let i = 0; i < Math.max(pa.length, pb.length); i++) {\r\n      const da = pa[i] || 0; const db = pb[i] || 0;\r\n      if (da > db) return 1; if (da < db) return -1;\r\n    }\r\n    return 0;\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!isElectron || !electronAPI) return;\r\n    try {\r\n      electronAPI.onUpdateAvailable((payload: { source?: string; info?: { version?: string; updateUrl?: string; notes?: string; force?: boolean } }) => {\r\n        const v = String(payload?.info?.version || '');\r\n        setUpdateVersion(v);\r\n        setUpdateNotes(String(payload?.info?.notes || ''));\r\n        setUpdateForce(!!payload?.info?.force);\r\n        if (compareVersions(v, currentVersion) > 0) {\r\n          setUpdateAvailable(true);\r\n        } else {\r\n          setUpdateAvailable(false);\r\n        }\r\n      });\r\n      electronAPI.onUpdateDownloaded((payload: { source?: string; info?: { version?: string; updateUrl?: string; notes?: string } }) => {\r\n        const v = String(payload?.info?.version || '');\r\n        setUpdateVersion(v);\r\n        setUpdateNotes(String(payload?.info?.notes || ''));\r\n        setIsDownloadingUpdate(false);\r\n        setUpdateProgress(100);\r\n        if (compareVersions(v, currentVersion) > 0) {\r\n          setUpdateAvailable(true);\r\n        } else {\r\n          setUpdateAvailable(false);\r\n        }\r\n        try { if (isElectron && user?.uid && v) { (updateUserProfile as any)?.({ lastAckDesktopVersion: v }); } } catch {}\r\n      });\r\n      electronAPI.onUpdateError((payload: any) => {\r\n        try { toast({ title: 'فشل التحديث', description: String(payload?.message || payload?.code || 'تعذر التحميل'), variant: 'destructive' }); } catch {}\r\n      });\r\n      if (typeof electronAPI.onUpdateProgress === 'function') {\r\n        electronAPI.onUpdateProgress((payload) => {\r\n          const p = (payload?.percent == null ? 0 : Number(payload.percent));\r\n          setIsDownloadingUpdate(true);\r\n          setUpdateProgress(Math.max(0, Math.min(100, isNaN(p) ? 0 : p)));\r\n        });\r\n      }\r\n      if (typeof electronAPI.appVersion === 'function') {\r\n        electronAPI.appVersion().then((ver) => {\r\n          if (typeof ver === 'string') setCurrentVersion(ver);\r\n          try { if (isElectron && user?.uid && typeof ver === 'string' && ver) { (updateUserProfile as any)?.({ desktopInstalledVersion: ver }); } } catch {}\r\n        }).catch(() => {});\r\n      }\r\n    } catch (e) { void e; }\r\n  }, [isElectron, electronAPI]);\r\n\r\n  useEffect(() => {\r\n    if (!isElectron) return;\r\n    if (updateProgress >= 100) {\r\n      setUpdateDialogOpen(true);\r\n    }\r\n  }, [isElectron, updateProgress]);\r\n\r\n  useEffect(() => {\r\n    const unsub = listenDesktopUpdates((data) => {\r\n      const v = String(data?.version || \"\");\r\n      const uidVal = String(user?.uid || 'anon');\r\n      const seenKey = `desktop_update_seen_${uidVal}`;\r\n      let seen = '';\r\n      try { seen = localStorage.getItem(seenKey) || ''; } catch {}\r\n      if (v && v !== updateVersion) {\r\n        if (compareVersions(v, currentVersion) > 0) {\r\n          setUpdateAvailable(true);\r\n          if (seen === v && !data?.force) {\r\n            setUpdateDialogOpen(false);\r\n          } else {\r\n            setUpdateDialogOpen(true);\r\n            // Removed auto-seen marking to prevent auto-close on re-render\r\n          }\r\n        } else {\r\n          setUpdateAvailable(false);\r\n        }\r\n        setUpdateVersion(v);\r\n        setUpdateNotes(String(data?.notes || \"\"));\r\n        setUpdateForce(data?.force || false);\r\n        const preferred = selectDesktopUrl({ downloadURL_64: data?.downloadURL_64, downloadURL_32: data?.downloadURL_32 }) || \"\";\r\n        setUpdateDownloadUrl(preferred);\r\n      }\r\n    });\r\n    return () => { try { unsub(); } catch {} };\r\n  }, [updateVersion, currentVersion, user?.uid]);\r\n\r\n  const handleConfirmUpdate = async () => {\r\n    try {\r\n      if (electronAPI) {\r\n        try { await electronAPI.checkUpdate(); } catch {}\r\n        setUpdateDialogOpen(true);\r\n        setIsDownloadingUpdate(true);\r\n        setUpdateProgress(0);\r\n        const res = await (electronAPI as any).downloadUpdate?.(updateDownloadUrl) ?? await electronAPI.downloadUpdate();\r\n        if (typeof res === 'string' && res.startsWith('err:')) {\r\n          try { toast({ title: 'فشل التحديث', description: res.slice(4), variant: 'destructive' }); } catch {}\r\n          setIsDownloadingUpdate(false);\r\n        } else if (res === 'noop') {\r\n          try { toast({ title: 'لا يوجد تحديث', description: 'لا تتوفر نسخة أحدث حالياً.' }); } catch {}\r\n        } else if (res === 'manual') {\r\n          try { toast({ title: 'جارٍ تنزيل التحديث', description: 'سيتم تطبيق التحديث تلقائيًا بعد اكتمال التنزيل.' }); } catch {}\r\n        } else if (res === 'autoUpdater') {\r\n          try { toast({ title: 'تنزيل تلقائي', description: 'سيتم تطبيق التحديث تلقائياً بواسطة النظام.' }); } catch {}\r\n        }\r\n      }\r\n    } catch (e) {\r\n      try { toast({ title: 'فشل التحديث', description: (e as any)?.message || 'حدث خطأ أثناء التنزيل', variant: 'destructive' }); } catch {}\r\n    }\r\n  };\r\n\r\n  const handleApplyUpdate = async () => {\r\n    try {\r\n      if (electronAPI) {\r\n        const res = await electronAPI.applyUpdate();\r\n        if (typeof res === 'string' && res.startsWith('err:')) {\r\n          try { toast({ title: 'فشل تطبيق التحديث', description: res.slice(4), variant: 'destructive' }); } catch {}\r\n        }\r\n      }\r\n    } catch (e) {\r\n      try { toast({ title: 'فشل تطبيق التحديث', description: (e as any)?.message || 'حدث خطأ أثناء تطبيق التحديث', variant: 'destructive' }); } catch {}\r\n    }\r\n  };\r\n\r\n\r\n  // استخراج الأحرف الأولى من الاسم أو البريد الإلكتروني\r\n  const getInitials = () => {\r\n    if (profile?.fullName) {\r\n      return profile?.fullName\r\n        .split(\" \")\r\n        .map((name) => name.charAt(0))\r\n        .join(\"\")\r\n        .toUpperCase()\r\n        .slice(0, 2);\r\n    }\r\n    if (user.email) {\r\n      return user.email.charAt(0).toUpperCase();\r\n    }\r\n    return \"U\";\r\n  };\r\n\r\n  // الحصول على صورة البروفيل الكرتونية\r\n  const selectedAvatar = profile?.avatarId ? getAvatarById(profile.avatarId) : null;\r\n\r\n  // مراقبة تغييرات البروفيل لإعادة التحديث\r\n  useEffect(() => {\r\n    console.log('Profile updated in ProfileIcon:', profile?.avatarId);\r\n  }, [profile?.avatarId]);\r\n\r\n  // التقط التوكن من نافذة الموافقة (cashy.link) عبر postMessage إن كانت مُهيأة على الخادم\r\n  useEffect(() => {\r\n    const handler = async (evt: MessageEvent) => {\r\n      try {\r\n        if (!evt?.data || typeof evt.data !== 'object') return;\r\n        if (evt.origin !== 'https://cashy.link') return;\r\n        const { type, email, refresh_token } = evt.data || {};\r\n        if (type === 'cashy_oauth_token' && user?.uid && email && refresh_token) {\r\n          const ok = await saveGoogleBackupToken(user.uid, String(email), String(refresh_token));\r\n          if (ok) {\r\n            toast({ title: 'تم ربط جوجل', description: 'تم حفظ توكن النسخ الاحتياطي عبر الخادم.' });\r\n          }\r\n        }\r\n      } catch (e) { void e; }\r\n    };\r\n    window.addEventListener('message', handler);\r\n    return () => window.removeEventListener('message', handler);\r\n  }, [user?.uid]);\r\n\r\n  if (!user) {\r\n    return null;\r\n  }\r\n\r\n  const handleSignOut = async () => {\r\n    try {\r\n      await signOut();\r\n    } catch (error) {\r\n      console.error(\"خطأ في تسجيل الخروج:\", error);\r\n    }\r\n  };\r\n\r\n  const handleBackup = async () => {\r\n    if (!user?.uid) return;\r\n    try {\r\n      setIsBackingUp(true);\r\n      // إذا لا يوجد توكن، نفّذ تسجيل الدخول أولاً ثم أكمل النسخ\r\n      if (!googleToken) {\r\n        // جرّب أولاً تدفق الخادم لربط حساب جوجل وحفظ refresh_token\r\n        const opened = await startServerGoogleOauth();\r\n        if (opened) {\r\n          const linked = await pollForServerGoogleToken(user.uid, 20000, 1500);\r\n          if (!linked) {\r\n            // لم يتم العثور على التوكن من الخادم خلال المهلة — جرّب GIS ثم Firebase\r\n            const signRes = await signInWithGoogleForBackupGis('483702062341-bhdprmoot8rto79jmjvkijdl7pbz28b.apps.googleusercontent.com');\r\n            if (!signRes.ok) {\r\n              const fbRes = await signInWithGoogleForBackup(auth);\r\n              if (!fbRes.ok) {\r\n                toast({ title: 'فشل تسجيل الدخول', description: fbRes.error || signRes.error || 'يرجى التسجيل بجوجل أولاً.', variant: 'destructive' });\r\n                return;\r\n              }\r\n            }\r\n            setGoogleTokenInfo(getGoogleAccessTokenInfo());\r\n          }\r\n        } else {\r\n          // تعذّر فتح نافذة الموافقة — جرّب GIS ثم Firebase مباشرة\r\n          const signRes = await signInWithGoogleForBackupGis('483702062341-bhdprmoot8rto79jmjvkijdl7pbz28b.apps.googleusercontent.com');\r\n          if (!signRes.ok) {\r\n            const fbRes = await signInWithGoogleForBackup(auth);\r\n            if (!fbRes.ok) {\r\n              toast({ title: 'فشل تسجيل الدخول', description: fbRes.error || signRes.error || 'يرجى التسجيل بجوجل أولاً.', variant: 'destructive' });\r\n              return;\r\n            }\r\n          }\r\n          setGoogleTokenInfo(getGoogleAccessTokenInfo());\r\n        }\r\n      }\r\n      const res = await backupToGoogleDriveWithUiToken(user.uid);\r\n      if (res.ok) {\r\n        toast({ title: 'تم النسخ الاحتياطي', description: 'تم حفظ بياناتك إلى Google Drive بنجاح.' });\r\n      } else {\r\n        toast({ title: 'فشل النسخ الاحتياطي', description: res.error || 'حدث خطأ أثناء النسخ الاحتياطي.', variant: 'destructive' });\r\n      }\r\n    } catch (e) {\r\n      toast({ title: 'خطأ غير متوقع', description: 'تعذر إكمال النسخ الاحتياطي.', variant: 'destructive' });\r\n    } finally {\r\n      setIsBackingUp(false);\r\n    }\r\n  };\r\n\r\n  const handleRestore = async () => {\r\n    if (!user?.uid) return;\r\n    try {\r\n      setIsRestoring(true);\r\n      // إذا لا يوجد توكن، نفّذ تسجيل الدخول أولاً ثم أكمل الاسترجاع\r\n      if (!googleToken) {\r\n        const opened = await startServerGoogleOauth();\r\n        if (opened) {\r\n          const linked = await pollForServerGoogleToken(user.uid, 20000, 1500);\r\n          if (!linked) {\r\n            const signRes = await signInWithGoogleForBackupGis('483702062341-bhdprmoot8rto79jmjvkijdl7pbz28b.apps.googleusercontent.com');\r\n            if (!signRes.ok) {\r\n              const fbRes = await signInWithGoogleForBackup(auth);\r\n              if (!fbRes.ok) {\r\n                toast({ title: 'فشل تسجيل الدخول', description: fbRes.error || signRes.error || 'يرجى التسجيل بجوجل أولاً.', variant: 'destructive' });\r\n                return;\r\n              }\r\n            }\r\n            setGoogleTokenInfo(getGoogleAccessTokenInfo());\r\n          }\r\n        } else {\r\n          const signRes = await signInWithGoogleForBackupGis('483702062341-bhdprmoot8rto79jmjvkijdl7pbz28b.apps.googleusercontent.com');\r\n          if (!signRes.ok) {\r\n            const fbRes = await signInWithGoogleForBackup(auth);\r\n            if (!fbRes.ok) {\r\n              toast({ title: 'فشل تسجيل الدخول', description: fbRes.error || signRes.error || 'يرجى التسجيل بجوجل أولاً.', variant: 'destructive' });\r\n              return;\r\n            }\r\n          }\r\n          setGoogleTokenInfo(getGoogleAccessTokenInfo());\r\n        }\r\n      }\r\n      const res = await restoreFromGoogleDriveWithUiToken(user.uid);\r\n      if (res.ok) {\r\n        toast({ title: 'تم الاسترجاع', description: 'تم استرجاع بياناتك بنجاح من Google Drive.' });\r\n      } else {\r\n        toast({ title: 'فشل الاسترجاع', description: res.error || 'حدث خطأ أثناء الاسترجاع.', variant: 'destructive' });\r\n      }\r\n    } catch (e) {\r\n      toast({ title: 'خطأ غير متوقع', description: 'تعذر إكمال الاسترجاع.', variant: 'destructive' });\r\n    } finally {\r\n      setIsRestoring(false);\r\n    }\r\n  };\r\n\r\n  const handleGoogleSignIn = async () => {\r\n    try {\r\n      setIsGoogleSigning(true);\r\n      // ابدأ أولاً تدفق الخادم وفق إعداداتك (start → callback)\r\n      const opened = await startServerGoogleOauth();\r\n      let linked = false;\r\n      if (opened && user?.uid) {\r\n        linked = await pollForServerGoogleToken(user.uid, 20000, 1500);\r\n      }\r\n      if (linked) {\r\n        toast({ title: 'تم ربط جوجل', description: `تم تفعيل النسخ الاحتياطي عبر الخادم` });\r\n        return;\r\n      }\r\n\r\n      // إن لم يكتمل ربط السيرفر، جرّب GIS ثم Firebase\r\n      const res = await signInWithGoogleForBackupGis('483702062341-bhdprmoot8rto79jmjvkijdl7pbz28b.apps.googleusercontent.com');\r\n      if (res.ok) {\r\n        const info = getGoogleAccessTokenInfo();\r\n        setGoogleTokenInfo(info);\r\n        toast({ title: 'تم ربط جوجل', description: `تم تفعيل النسخ الاحتياطي على Google Drive` });\r\n      } else {\r\n        const fb = await signInWithGoogleForBackup(auth);\r\n        if (fb.ok) {\r\n          const info = getGoogleAccessTokenInfo();\r\n          setGoogleTokenInfo(info);\r\n          toast({ title: 'تم ربط جوجل', description: `تم تفعيل النسخ الاحتياطي على Google Drive` });\r\n        } else {\r\n          toast({ title: 'فشل ربط جوجل', description: fb.error || res.error || 'حدث خطأ أثناء تسجيل الدخول بجوجل.', variant: 'destructive' });\r\n        }\r\n      }\r\n    } catch (e) {\r\n      toast({ title: 'خطأ غير متوقع', description: 'تعذر إكمال تسجيل الدخول بجوجل.', variant: 'destructive' });\r\n    } finally {\r\n      setIsGoogleSigning(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"flex items-center gap-2\">\r\n        {/* تم إخفاء أيقونة النسخ الاحتياطي على جوجل */}\r\n\r\n        {isElectron && (\r\n          <Button\r\n            type=\"button\"\r\n            onClick={() => {\r\n              setUpdateDialogOpen(true);\r\n              if (compareVersions(updateVersion, currentVersion) > 0) {\r\n                setUpdateAvailable(true);\r\n              }\r\n            }}\r\n            title=\"تحديث التطبيق\"\r\n            className=\"relative inline-flex items-center justify-center w-9 h-9 rounded-md bg-transparent text-blue-600 hover:bg-blue-500/10 focus:outline-none dark:text-blue-400 dark:hover:bg-blue-400/10\"\r\n            variant=\"ghost\"\r\n          >\r\n            <DownloadCloud className=\"w-5 h-5\" />\r\n            {updateAvailable && (\r\n              <span className=\"absolute -top-0.5 -right-0.5 inline-block w-2 h-2 rounded-full bg-red-500\"></span>\r\n            )}\r\n          </Button>\r\n        )}\r\n\r\n        <DropdownMenu>\r\n          <DropdownMenuTrigger asChild>\r\n            <Button\r\n              variant=\"ghost\"\r\n              className={`relative h-8 w-8 rounded-full p-0 hover:bg-transparent focus:ring-1 focus:ring-primary focus:ring-offset-1 transition-all duration-200 ${className}`}\r\n            >\r\n              <Avatar className=\"h-8 w-8 border border-border shadow-sm hover:shadow-md transition-all duration-200 hover:scale-105 bg-white\">\r\n                {selectedAvatar ? (\r\n                  <div className=\"w-full h-full flex items-center justify-center bg-white dark:bg-neutral-900/20 rounded-full overflow-hidden\">\r\n                    <div className=\"w-full h-full flex items-center justify-center scale-[2.5]\">\r\n                      {selectedAvatar.component}\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  <>\r\n                    <AvatarImage\r\n                      src={user.photoURL || undefined}\r\n                      alt={profile?.fullName || user.email || \"المستخدم\"}\r\n                      className=\"object-cover\"\r\n                    />\r\n                    <AvatarFallback className=\"bg-gradient-to-br from-indigo-500 via-sky-500 to-emerald-400 text-white font-semibold text-sm tracking-wide uppercase border border-white/70 shadow-md\">\r\n                      {getInitials()}\r\n                    </AvatarFallback>\r\n                  </>\r\n                )}\r\n              </Avatar>\r\n            </Button>\r\n          </DropdownMenuTrigger>\r\n          <DropdownMenuContent className=\"w-64\" align=\"end\" forceMount>\r\n          <DropdownMenuLabel className=\"font-normal\">\r\n            <div className=\"flex flex-col space-y-1\">\r\n              <p className=\"text-sm font-medium leading-none\">\r\n                {profile?.fullName || \"المستخدم\"}\r\n              </p>\r\n              <p className=\"text-xs leading-none text-muted-foreground\">\r\n                {user.email}\r\n              </p>\r\n              {profile?.role && (\r\n                <p className=\"text-xs leading-none text-muted-foreground\">\r\n                  الدور: {profile.role === \"staff\" ? \"مدير\" : profile.role === \"merchant\" ? \"تاجر\" : \"مستخدم\"}\r\n                </p>\r\n              )}\r\n              {isOnFreeTrial && (\r\n                 <div className=\"mt-2 flex items-center justify-center gap-1 bg-emerald-50 border border-emerald-200 text-emerald-800 text-xs rounded-md py-1\">\r\n                   <span className=\"font-semibold\">تجربة: {freeTrialHoursRemaining} {freeTrialHoursRemaining >= 3 && freeTrialHoursRemaining <= 10 ? 'ساعات' : freeTrialHoursRemaining === 2 ? 'ساعتين' : 'ساعة'}</span>\r\n                 </div>\r\n              )}\r\n            </div>\r\n          </DropdownMenuLabel>\r\n\r\n          <DropdownMenuSeparator />\r\n          <DropdownMenuItem \r\n          onClick={() => {\r\n            if (isShiftActive && shiftUser?.permissions?.settings === false) {\r\n              toast({\r\n                title: \"تم رفض الوصول\",\r\n                description: \"ليس لديك صلاحية للوصول إلى هذا القسم. يرجى مراجعة المسؤول.\",\r\n                variant: \"destructive\",\r\n              });\r\n              return;\r\n            }\r\n            navigate('/profile-settings');\r\n          }}\r\n          className=\"cursor-pointer\"\r\n        >\r\n            <Settings className=\"mr-2 h-4 w-4\" />\r\n            <span>إعدادات البروفيل</span>\r\n          </DropdownMenuItem>\r\n          {(profile?.role === \"admin\" || profile?.role === \"staff\") && (\r\n            <DropdownMenuItem \r\n              onClick={() => navigate('/admin')}\r\n              className=\"cursor-pointer\"\r\n            >\r\n              <Shield className=\"mr-2 h-4 w-4\" />\r\n              <span>لوحة الإدارة</span>\r\n            </DropdownMenuItem>\r\n          )}\r\n          <DropdownMenuSeparator />\r\n          <DropdownMenuItem\r\n            onClick={handleSignOut}\r\n            className=\"cursor-pointer text-red-600 focus:text-red-600\"\r\n          >\r\n            <LogOut className=\"mr-2 h-4 w-4\" />\r\n            <span>تسجيل الخروج</span>\r\n          </DropdownMenuItem>\r\n          </DropdownMenuContent>\r\n        </DropdownMenu>\r\n      </div>\r\n\r\n      {isElectron && (\r\n        <Dialog open={updateDialogOpen} onOpenChange={(open) => {\r\n          if (!open && updateForce && updateAvailable && compareVersions(updateVersion, currentVersion) > 0) {\r\n            // Prevent closing if update is forced and available\r\n            return;\r\n          }\r\n          setUpdateDialogOpen(open);\r\n          if (!open && updateProgress < 100) { // Skip reset if download is complete\r\n            const uidVal = String(user?.uid || 'anon');\r\n            const seenKey = `desktop_update_seen_${uidVal}`;\r\n            try { if (updateVersion) localStorage.setItem(seenKey, updateVersion); } catch {}\r\n            setUpdateAvailable(false);\r\n          }\r\n        }}>\r\n          <DialogContent \r\n            className=\"sm:max-w-md\"\r\n            hideClose={updateForce}\r\n            disableOutsideClose={updateForce}\r\n            disableEscClose={updateForce}\r\n          >\r\n            <DialogHeader>\r\n              <DialogTitle>\r\n                {updateForce ? 'تحديث إجباري مطلوب' : 'يوجد تحديث جديد للبرنامج'}\r\n              </DialogTitle>\r\n            </DialogHeader>\r\n            <div className=\"text-sm\">\r\n              {isDownloadingUpdate\r\n                ? 'جارٍ تنزيل التحديث...'\r\n                : (updateAvailable && compareVersions(updateVersion, currentVersion) > 0\r\n                    ? 'هل ترغب في تنزيله الآن؟'\r\n                    : 'التطبيق مُحدَّث لآخر إصدار')}\r\n            </div>\r\n            {updateVersion && (\r\n              <div className=\"mt-2 text-xs\">الإصدار الجديد: <span className=\"font-semibold\">v{updateVersion}</span></div>\r\n            )}\r\n            {currentVersion && (\r\n              <div className=\"mt-1 text-xs text-muted-foreground\">إصدار التطبيق لديك: <span className=\"font-semibold\">v{currentVersion}</span></div>\r\n            )}\r\n            {updateNotes && (\r\n              <div className=\"mt-2 text-xs text-muted-foreground whitespace-pre-line\">{updateNotes}</div>\r\n            )}\r\n            {isDownloadingUpdate && (\r\n              <div className=\"mt-3\">\r\n                <div className=\"w-full h-2 bg-gray-200 rounded\">\r\n                  <div className=\"h-2 bg-blue-600 rounded\" style={{ width: `${updateProgress}%` }} />\r\n                </div>\r\n                <div className=\"mt-1 text-xs text-muted-foreground\">{Math.round(updateProgress)}%</div>\r\n              </div>\r\n            )}\r\n            <div className=\"flex items-center justify-end gap-2 mt-3\">\r\n              {!updateForce && (\r\n                <Button variant=\"outline\" onClick={() => {\r\n                  const uidVal = String(user?.uid || 'anon');\r\n                  const seenKey = `desktop_update_seen_${uidVal}`;\r\n                  try { if (updateVersion) localStorage.setItem(seenKey, updateVersion); } catch {}\r\n                  setUpdateAvailable(false);\r\n                  setUpdateDialogOpen(false);\r\n                }}>إلغاء</Button>\r\n              )}\r\n              {!isDownloadingUpdate && updateProgress < 100 && updateAvailable && compareVersions(updateVersion, currentVersion) > 0 && (\r\n                <Button className=\"bg-blue-600 hover:bg-blue-700\" onClick={handleConfirmUpdate}>\r\n                  {updateForce ? 'تحديث الآن (إجباري)' : 'بدء التنزيل'}\r\n                </Button>\r\n              )}\r\n              {updateProgress >= 100 && (\r\n                <Button\r\n                  className=\"bg-green-600 hover:bg-green-700\"\r\n                  onClick={async () => {\r\n                    try {\r\n                      if (electronAPI?.applyUpdate) {\r\n                        toast({ title: 'جاري التحديث', description: 'سيتم إغلاق التطبيق وتثبيت التحديث فوراً...' });\r\n                        const res = await electronAPI.applyUpdate();\r\n                        if (typeof res === 'string' && res.startsWith('err:')) {\r\n                           toast({ title: 'فشل التحديث', description: res.slice(4), variant: 'destructive' });\r\n                        }\r\n                      } else if (electronAPI?.openUpdateFolder) {\r\n                        const res = await electronAPI.openUpdateFolder();\r\n                        if (typeof res === 'string' && res.startsWith('err:')) {\r\n                          toast({ title: 'تعذر فتح مجلد التحديث', description: res.slice(4), variant: 'destructive' });\r\n                        } else {\r\n                          toast({ title: 'افتح ملف التثبيت', description: 'تم فتح مجلد التحديث — اضغط على الملف لتثبيت.' });\r\n                        }\r\n                      }\r\n                    } catch (e) {\r\n                      toast({ title: 'فشل التحديث', description: (e as any)?.message || 'حدث خطأ غير متوقع', variant: 'destructive' });\r\n                    }\r\n                  }}\r\n                >تحديث الآن</Button>\r\n              )}\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n      )}\r\n\r\n      <ChangePasswordDialog\r\n        open={showChangePassword}\r\n        onOpenChange={setShowChangePassword}\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default ProfileIcon;\r\n"],"names":["__iconNode","CloudDownload","createLucideIcon","createContextScope","scopeName","createContextScopeDeps","defaultContexts","createContext3","rootComponentName","defaultContext","BaseContext","React.createContext","index","Provider","props","scope","children","context","Context","_a","value","React.useMemo","jsx","useContext2","consumerName","React.useContext","createScope","scopeContexts","contexts","composeContextScopes","scopes","baseScope","scopeHooks","createScope2","overrideScopes","nextScopes","nextScopes2","useScope","currentScope","NODES","Primitive","primitive","node","Slot","createSlot","Node","React.forwardRef","forwardedRef","asChild","primitiveProps","Comp","React","require$$0","is","x","y","objectIs","useState","useEffect","useLayoutEffect","useDebugValue","useSyncExternalStore$2","subscribe","getSnapshot","_useState","inst","forceUpdate","checkIfSnapshotChanged","latestGetSnapshot","nextValue","useSyncExternalStore$1","shim","useSyncExternalStoreShim_production","shimModule","useIsHydrated","useSyncExternalStore","AVATAR_NAME","createAvatarContext","AvatarProvider","useAvatarContext","Avatar","__scopeAvatar","avatarProps","imageLoadingStatus","setImageLoadingStatus","React.useState","IMAGE_NAME","AvatarImage","src","onLoadingStatusChange","imageProps","useImageLoadingStatus","handleLoadingStatusChange","useCallbackRef","status","FALLBACK_NAME","AvatarFallback","delayMs","fallbackProps","canRender","setCanRender","React.useEffect","timerId","resolveLoadingStatus","image","referrerPolicy","crossOrigin","isHydrated","imageRef","React.useRef","loadingStatus","setLoadingStatus","updateStatus","handleLoad","handleError","Root","Image","Fallback","className","ref","AvatarPrimitive.Root","cn","AvatarPrimitive.Image","AvatarPrimitive.Fallback","ChangePasswordDialog","open","onOpenChange","user","profile","useFirebaseAuth","toast","useToast","loading","setLoading","showCurrentPassword","setShowCurrentPassword","showNewPassword","setShowNewPassword","showConfirmPassword","setShowConfirmPassword","isMasterPinDialogOpen","setIsMasterPinDialogOpen","isReauthenticated","setIsReauthenticated","formData","setFormData","errors","setErrors","validateForm","newErrors","error","handleSubmit","e","credential","EmailAuthProvider","reauthenticateWithCredential","errorMessage","prev","performPasswordUpdate","updatePassword","handleInputChange","field","handleClose","jsxs","Fragment","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","Label","Input","Button","EyeOff","Eye","DialogFooter","Loader2","MasterPinDialog","GOOGLE_TOKEN_KEY","GOOGLE_EMAIL_KEY","GOOGLE_EXPIRES_KEY","getGoogleAccessTokenInfo","token","email","expiresAtStr","expiresAt","saveGoogleBackupToken","userId","refreshToken","resp","data","ProfileIcon","signOut","updateUserProfile","navigate","useNavigate","showChangePassword","setShowChangePassword","isShiftActive","useShift","isBackingUp","setIsBackingUp","isRestoring","setIsRestoring","isGoogleSigning","setIsGoogleSigning","googleToken","setGoogleTokenInfo","electronAPI","isElectron","updateAvailable","setUpdateAvailable","updateDialogOpen","setUpdateDialogOpen","updateVersion","setUpdateVersion","updateNotes","setUpdateNotes","updateForce","setUpdateForce","updateProgress","setUpdateProgress","isDownloadingUpdate","setIsDownloadingUpdate","updateDownloadUrl","setUpdateDownloadUrl","currentVersion","setCurrentVersion","autoApplied","setAutoApplied","freeTrialHoursRemaining","setFreeTrialHoursRemaining","isOnFreeTrial","setIsOnFreeTrial","trialValidity","FreeTrialService","compareVersions","a","b","pa","pb","i","da","db","payload","v","_b","_c","p","ver","unsub","listenDesktopUpdates","seenKey","seen","preferred","selectDesktopUrl","handleConfirmUpdate","res","getInitials","name","selectedAvatar","getAvatarById","handler","evt","type","refresh_token","handleSignOut","DownloadCloud","DropdownMenu","DropdownMenuTrigger","DropdownMenuContent","DropdownMenuLabel","DropdownMenuSeparator","DropdownMenuItem","Settings","Shield","LogOut"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6]}