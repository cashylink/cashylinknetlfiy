var M=Object.defineProperty;var E=(p,t,e)=>t in p?M(p,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[t]=e;var D=(p,t,e)=>E(p,typeof t!="symbol"?t+"":t,e);import{a2 as l,a3 as _}from"./index-TGIFU2Cb.js";class F{static getProfitPinKey(t){return t?`${this.PROFIT_PIN_KEY_BASE}_${t}`:this.PROFIT_PIN_KEY_BASE}static getMasterPinKey(t){return t?`${this.MASTER_PIN_KEY_BASE}_${t}`:this.MASTER_PIN_KEY_BASE}static setProfitPin(t,e){console.warn("setProfitPin is deprecated. Using master PIN instead.")}static hasProfitPin(t){try{const e=localStorage.getItem(this.getMasterPinKey(t));return!!e&&e.length>0}catch{return!1}}static verifyProfitPin(t,e){try{const o=localStorage.getItem(this.getMasterPinKey(e));return o?atob(o)===t:!1}catch{return!1}}static getProfitData(t){l.autoResetReportsIfNeeded(t);const e=l.getProfits(t),o=this.getWithdrawTransferProfits(t);return{dailyProfit:e.dailyProfit,monthlyProfit:e.monthlyProfit,dailyWithdrawProfit:o.dailyWithdrawProfit,monthlyWithdrawProfit:o.monthlyWithdrawProfit,dailyTransferProfit:o.dailyTransferProfit,monthlyTransferProfit:o.monthlyTransferProfit,lastUpdated:new Date}}static addProfit(t,e){l.addProfit(t,"daily",e),l.addProfit(t,"monthly",e)}static calculateProfitFromTransaction(t){return l.calculateTransactionProfit(t)}static resetProfits(t,e,o){if(!this.verifyProfitPin(e,o))return!1;const f=o?`reportsData_${o}`:"reportsData",c=l.getReportsData(o);if(t==="daily"?(c.dailyProfit=0,c.lastDailyProfitResetDate=new Date):(c.monthlyProfit=0,c.lastMonthlyProfitResetDate=new Date),localStorage.setItem(f,JSON.stringify(c)),o)try{_.updateUserData(o,{reportsData:{...c}})}catch(d){console.warn("تعذر مزامنة تصفير الأرباح مع Firebase:",d)}return!0}static clearProfitPin(t){localStorage.removeItem(this.getProfitPinKey(t))}static updateProfitsFromTransactions(t,e){const o=e?`reportsData_${e}`:"reportsData",f=l.getReportsData(e);let c=0,d=0;const P=new Date,u=P.getMonth(),g=P.getFullYear(),T=l.filterVisibleTransactions(t,"daily",e),S=l.filterVisibleTransactions(t,"monthly",e);if(T.forEach(r=>{const i=String(r.type||r.txnType||"").toLowerCase(),m=String(r.title||"");if(i==="cash_addition"||m.includes("إيصال إضافة نقدية"))return;const y=new Date(r.createdAt),s=String(r.status||"confirmed").toLowerCase();if(y.toDateString()!==P.toDateString()||s!=="completed"&&s!=="confirmed"&&s!=="pending")return;const a=String(r.type||r.txnType||"").toLowerCase(),w={type:a==="withdrawal"?"withdraw":a,amount:Number(r.amount||0),commission:r.commission};c+=this.calculateProfitFromTransaction(w)}),S.forEach(r=>{const i=String(r.type||r.txnType||"").toLowerCase(),m=String(r.title||"");if(i==="cash_addition"||m.includes("إيصال إضافة نقدية"))return;const y=new Date(r.createdAt),s=String(r.status||"confirmed").toLowerCase();if(y.getMonth()!==u||y.getFullYear()!==g||s!=="completed"&&s!=="confirmed"&&s!=="pending")return;const a=String(r.type||r.txnType||"").toLowerCase(),w={type:a==="withdrawal"?"withdraw":a,amount:Number(r.amount||0),commission:r.commission};d+=this.calculateProfitFromTransaction(w)}),f.dailyProfit=Math.round(c*100)/100,f.monthlyProfit=Math.round(d*100)/100,localStorage.setItem(o,JSON.stringify(f)),e)try{_.updateUserData(e,{reportsData:{...f}})}catch(r){console.warn("تعذر مزامنة تحديث الأرباح من المعاملات مع Firebase:",r)}}static getWithdrawTransferProfits(t){l.getReportsData(t);const e=new Date,o=e.getMonth(),f=e.getFullYear(),c=`transactions_${t||"default"}`,d=JSON.parse(localStorage.getItem(c)||"[]");let P=0,u=0,g=0,T=0;const S=l.filterVisibleTransactions(d,"daily",t),r=l.filterVisibleTransactions(d,"monthly",t);return S.forEach(i=>{const m=String(i.type||i.txnType||"").toLowerCase(),y=String(i.title||"");if(m==="cash_addition"||y.includes("إيصال إضافة نقدية"))return;const s=new Date(i.createdAt),a=String(i.status||"confirmed").toLowerCase();if(s.toDateString()!==e.toDateString()||a!=="completed"&&a!=="confirmed"&&a!=="pending")return;const h=String(i.type||i.txnType||"").toLowerCase(),n={type:h==="withdrawal"?"withdraw":h,amount:Number(i.amount||0),commission:i.commission};n.type==="withdraw"?P+=this.calculateProfitFromTransaction(n):(n.type==="receive"||n.type==="send"||n.type==="transfer")&&(g+=this.calculateProfitFromTransaction(n))}),r.forEach(i=>{const m=String(i.type||i.txnType||"").toLowerCase(),y=String(i.title||"");if(m==="cash_addition"||y.includes("إيصال إضافة نقدية"))return;const s=new Date(i.createdAt),a=String(i.status||"confirmed").toLowerCase();if(s.getMonth()!==o||s.getFullYear()!==f||a!=="completed"&&a!=="confirmed"&&a!=="pending")return;const h=String(i.type||i.txnType||"").toLowerCase(),n={type:h==="withdrawal"?"withdraw":h,amount:Number(i.amount||0),commission:i.commission};n.type==="withdraw"?u+=this.calculateProfitFromTransaction(n):(n.type==="receive"||n.type==="send"||n.type==="transfer")&&(T+=this.calculateProfitFromTransaction(n))}),{dailyWithdrawProfit:Math.round(P*100)/100,monthlyWithdrawProfit:Math.round(u*100)/100,dailyTransferProfit:Math.round(g*100)/100,monthlyTransferProfit:Math.round(T*100)/100}}}D(F,"PROFIT_PIN_KEY_BASE","profit_pin"),D(F,"MASTER_PIN_KEY_BASE","master_pin");export{F as ProfitService};
