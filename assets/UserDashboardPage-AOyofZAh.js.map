{"version":3,"mappings":"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","names":["Award","createLucideIcon","Banknote","BookOpen","Building","IdCard","Info","ListChecks","Notebook","Package","TrendingDown","QueryObserver","_a","Subscribable","client","options","__privateAdd","_QueryObserver_instances","_client","_currentQuery","_currentQueryInitialState","_currentResult","_currentResultState","_currentResultOptions","_currentThenable","_selectError","_selectFn","_selectResult","_lastQueryWithDefinedData","_staleTimeoutId","_refetchIntervalId","_currentRefetchInterval","_trackedProps","__privateSet","pendingThenable","__privateGet","shouldFetchOnMount","__privateMethod","executeFetch_fn","updateTimers_fn","shouldFetchOn","clearStaleTimeout_fn","clearRefetchInterval_fn","prevOptions","prevQuery","resolveEnabled","updateQuery_fn","shallowEqualObjects","mounted","shouldFetchOptionally","resolveStaleTime","updateStaleTimeout_fn","nextRefetchInterval","computeRefetchInterval_fn","updateRefetchInterval_fn","query","result","shouldAssignObserverCurrentProperties","onPropTracked","target","key","defaultedOptions","fetchOptions","prevResult","prevResultState","prevResultOptions","queryInitialState","state","newState","isPlaceholderData","data","fetchOnMount","fetchOptionally","fetchState","error","errorUpdatedAt","status","skipSelect","placeholderData","replaceData","selectError","isFetching","isPending","isError","isLoading","hasData","nextResult","isStale","finalizeThenableIfPossible","thenable","recreateThenable","pending","prevThenable","shouldNotifyListeners","notifyOnChangeProps","notifyOnChangePropsValue","includedProps","typedKey","notify_fn","promise","noop","staleTime","isServer","isValidTimeout","timeout","timeUntilStale","timeoutManager","nextInterval","focusManager","notifyOptions","notifyManager","listener","shouldLoadOnMount","field","value","observer","optimisticResult","IsRestoringContext","React.createContext","useIsRestoring","React.useContext","createValue","isReset","QueryErrorResetBoundaryContext","useQueryErrorResetBoundary","ensurePreventErrorBoundaryRetry","errorResetBoundary","useClearResetErrorBoundary","React.useEffect","getHasError","throwOnError","suspense","shouldThrowError","ensureSuspenseTimers","clamp","originalStaleTime","args","willFetch","isRestoring","shouldSuspend","fetchOptimistic","useBaseQuery","Observer","queryClient","useQueryClient","_b","isNewCacheEntry","React.useState","shouldSubscribe","React.useSyncExternalStore","React.useCallback","onStoreChange","unsubscribe","_d","_c","_e","useQuery","getLastTransactions","httpsCallable","functions","sendTelegramMessage","walletProviders","WalletsViewPage","isOpen","onClose","onWalletSelect","onEditWallet","onDeleteWallet","user","useFirebaseAuth","wallets","setWallets","useState","selectMode","setSelectMode","selectedIds","setSelectedIds","setIsLoading","toast","useToast","calculateWalletMonthlyUsage","walletId","transactions","currentMonth","currentYear","monthlyTransactions","t","transactionDate","isWithdrawTx","type","isSendTx","withdrawalUsage","sum","amount","transferUsage","checkAndResetMonthlyUsage","wallet","today","lastReset","lastResetDate","currentDate","useEffect","firebaseWallets","merchantWalletService","transactionService","walletsWithResetCheck","w","limits","walletDailyLimitsService","getProviderInfo","providerId","p","getUsagePercentage","used","limit","formatNumber","num","jsx","Dialog","jsxs","DialogContent","DialogHeader","DialogTitle","Wallet","Badge","Fragment","Button","ops","prev","e","providerInfo","isSelected","cardClasses","Card","id","CardHeader","CardTitle","CreditCard","Star","Edit","Trash2","CardContent","Phone","monthlyWithdrawalLimit","monthlyTransferLimit","monthlyWithdrawUsed","monthlyTransferUsed","remainingWithdraw","remainingTransfer","ArrowLeft","WalletDetailsPage","onBack","setTransactions","selectedPeriod","setSelectedPeriod","walletTransactions","a","b","formatDate","dateString","filteredTransactions","now","startDate","xn","totalWithdrawals","totalTransfers","totalDeposits","completedTransactions","operationsCount","totalProfit","calculateProfit","withdrawalPercentage","transferPercentage","getTransactionIcon","TrendingUp","DollarSign","Activity","getStatusIcon","CheckCircle","Clock","XCircle","AlertCircle","getTransactionTypeText","getStatusText","Calendar","BarChart3","Progress","Separator","transaction","WalletManagement","onWalletUpdate","initialEditingWallet","userSubscription","raw","s","SubscriptionPlan","navigate","useNavigate","isAddingWallet","setIsAddingWallet","editingWallet","setEditingWallet","walletName","setWalletName","walletPhone","setWalletPhone","walletNationalId","setWalletNationalId","walletProvider","setWalletProvider","setMonthlyWithdrawalLimit","setMonthlyTransferLimit","dailyWithdrawalLimit","setDailyWithdrawalLimit","dailyTransferLimit","setDailyTransferLimit","isDefault","setIsDefault","showProviderInfo","setShowProviderInfo","showWalletsView","setShowWalletsView","isMasterPinDialogOpen","setIsMasterPinDialogOpen","selectedWallet","setSelectedWallet","getWalletsKey","lastResetMonth","lastResetYear","calculateWalletDailyUsage","currentDay","dailyTransactions","auth","__vitePreload","n","retryCount","maxRetries","resolve","dailyWithdrawalUsage","dailyTransferUsage","resetForm","saveWallet","updatedWallets","newWalletData","newWalletId","walletToAdd","newWallets","handleEditWallet","handleDeleteWallet","walletToDelete","handleSetDefault","Eye","Plus","Select","SelectTrigger","SelectValue","SelectContent","provider","SelectItem","Input","Settings","X","MasterPinDialog","updated","err","TransactionDetailsModal","onDelete","handlePrint","hasSenderNumber","hasSenderName","senderLabel","senderValue","printContent","formatNumberEnglish","printWindow","handleDelete","Receipt","Store","SenderIcon","User","ArrowRight","Printer","EditBalanceDialog","open","onOpenChange","onSuccess","title","description","currentBalance","balanceLabel","userId","pin","setPin","newAmount","setNewAmount","showPin","setShowPin","setError","handleSubmit","MasterPinService","handleClose","React","Label","EyeOff","Lock","SecurityService","encodedPin","savedPin","__publicField","ChangePinDialog","currentPin","setCurrentPin","newPin","setNewPin","confirmPin","setConfirmPin","showCurrentPin","setShowCurrentPin","showNewPin","setShowNewPin","showConfirmPin","setShowConfirmPin","hasExistingPin","cashPinsCache","ChangeCashPinDialog","CASH_PIN_KEY","verifyCurrentPin","saveNewPin","walletTotalPinsCache","ChangeWalletTotalPinDialog","WALLET_TOTAL_PIN_KEY","AddToWalletDialog","setAmount","operationType","setOperationType","hasMasterPin","setHasMasterPin","has","amountValue","finalAmount","getNewBalance","Minus","isValidId","walletLimitsService","limitsRef","doc","db","limitsSnap","getDoc","Timestamp","newUsage","setDoc","serverTimestamp","usage","txQuery","collection","where","txSnap","getDocs","used_transfer","used_withdraw","tx","calculatedUsage","remaining","currentUsage","canPerform","newUsedTransfer","newUsedWithdraw","ref","updatedUsage","resetUsage","merchantUserId","usagePromises","useReadIdsKey","NotificationBell","className","profile","isSubscriptionActive","location","useLocation","notifications","setNotifications","readIds","setReadIds","queueOpen","setQueueOpen","queueReason","setQueueReason","queueSubmitting","setQueueSubmitting","queueMessage","setQueueMessage","queueLatestStatus","setQueueLatestStatus","flyAlert","setFlyAlert","flyVisible","setFlyVisible","useRef","flyTimerRef","triggerRef","flyStyle","setFlyStyle","ENABLE_FLY_ALERT","audienceKeys","useMemo","keys","storageKey","canShowNotifications","onPendingApprovalPage","arr","subscribeToActiveBroadcastsList","list","unreadCount","acc","markAsRead","next","markAllAsRead","ids","openLink","url","isAndroid","Capacitor","isApk","deeplink","submitQueueRequest","reason","name","phone","addDoc","unsub","q","onSnapshot","snapshot","docs","d","ta","_f","latest","contacted","DropdownMenu","DropdownMenuTrigger","Bell","DropdownMenuContent","DropdownMenuLabel","DropdownMenuSeparator","isUnread","ExternalLink","DialogTrigger","DialogDescription","Textarea","DialogFooter","CalculatorDialog","display","setDisplay","previousValue","setPreviousValue","operation","setOperation","waitingForOperand","setWaitingForOperand","inputNumber","inputOperation","nextOperation","inputValue","newValue","calculate","firstValue","secondValue","performCalculation","clearAll","clearEntry","inputDecimal","toggleSign","percentage","handleKeyPress","event","Calculator","SalesDataDialog","initialBarcode","salesData","setSalesData","newProduct","setNewProduct","isAddProductOpen","setIsAddProductOpen","editingId","setEditingId","isShiftActive","shiftUser","useShift","shopIdCtx","useShop","shopProducts","setShopProducts","sellingQtyByProduct","setSellingQtyByProduct","addQtyByProduct","setAddQtyByProduct","serialByProduct","setSerialByProduct","scannedBarcode","setScannedBarcode","isInvoiceMode","setIsInvoiceMode","invoiceSelections","setInvoiceSelections","isWholesaleVisible","setIsWholesaleVisible","isProfitLocked","setIsProfitLocked","isProfitPinDialogOpen","setIsProfitPinDialogOpen","barcodeBufferRef","lastKeyTimeRef","monthlySalesTotal","setMonthlySalesTotal","monthlyProfitTotal","setMonthlyProfitTotal","isMonthlyLocked","setIsMonthlyLocked","isMonthlyCollapsed","setIsMonthlyCollapsed","isSalesReceiptsDialogOpen","setIsSalesReceiptsDialogOpen","isProductStatsCollapsed","setIsProductStatsCollapsed","isTipsCollapsed","setIsTipsCollapsed","sellingPriceOverrideByProduct","setSellingPriceOverrideByProduct","isMasterPinActionOpen","setIsMasterPinActionOpen","masterPinActionTitle","setMasterPinActionTitle","masterPinActionDescription","setMasterPinActionDescription","protectedActionRef","requireMasterPin","action","customers","setCustomers","isDeferredFormOpen","setIsDeferredFormOpen","deferredCustomerId","setDeferredCustomerId","deferredCustomerName","setDeferredCustomerName","deferredCustomerMobile","setDeferredCustomerMobile","pendingDeferredProduct","setPendingDeferredProduct","userDataService","c","isDeleteConfirmOpen","setIsDeleteConfirmOpen","deleteTargetSale","setDeleteTargetSale","deleteActionType","setDeleteActionType","openDeleteConfirm","sale","productSearchTerm","setProductSearchTerm","filteredShopProducts","term","getUtcDateYYYYMMDD","loadSalesData","loadMonthlyStats","todayUtc","todayCairo","nextHandler","snap","remote","v","localUnsynced","byId","it","merged","saveSalesData","sidSnap","qRoot","qUser","handler","tag","code","processBarcode","loadShopProducts","shopId","products","byUserAndShop","byUserOnly","fallbackProducts","byUser","missingShopProducts","original","updateDoc","migrationError","recoverUnsyncedSalesToFirestore","getLocalDateYYYYMMDD","y","m","dd","sortSales","dt","sid","allKey","savedAll","parsed","todayLocal","localKey","savedLocal","sorted","utcKey","savedUtc","syncSalesDataFromFirestore","sortedDay","existingAllRaw","existingAll","item","mergedAll","sortedAll","saveAllSalesData","snap1","snap2","q1","q2","x","start","end","toDateStr","startStr","endStr","sidMonthly","byUserShop","byUserShopNested","sales","profit","docSnap","dateStr","sellingPrice","qty","pr","saveSaleToFirebase","performedByType","performedByName","performedByUsername","docRef","docRef2","getCashBalanceKey","updateSaleInFirebase","updatedFields","saleDoc","saleDoc2","markDeferredSalePaid","unsynced","existingSnap","existingQ","existingQ2","docId","addOutOfStockDeficiency","productName","safeList","exists","optimisticItem","updatedOptimistic","newItem","sellProduct","product","isDeferred","customer","qtyStr","serial","overrideStr","overridePrice","usedPrice","saleWithId","newQty","saleTotal","cashKey","savedCash","newCash","localDataKey","updateData","receiptRef","txToCloud","deleteSale","updatedDay","updatedAll","bgTasks","matched","deleteDoc","sellProductByBarcode","addPieces","deleteProduct","createProduct","selling","wholesale","payload","trimmedBarcode","trimmedSerial","trimmed","printSelectedInvoice","items","prod","shopName","invoiceTotal","rowsHtml","formatMoney","html","ChevronDown","ChevronUp","index","val","mobile","userData","newDebt","telegramNotifier","tgt","uid","sub","getUserSubscription","rawPlan","planStr","act","CashSummaryDialog","cashBalance","walletBalances","accessorySalesToday","setAccessorySalesToday","ackAccessoryToday","setAckAccessoryToday","maintenanceTotalToday","setMaintenanceTotalToday","ackMaintenanceToday","setAckMaintenanceToday","localCashBalance","setLocalCashBalance","isReceiptPinOpen","setIsReceiptPinOpen","pendingReceiptType","setPendingReceiptType","isDeductReasonOpen","setIsDeductReasonOpen","deductReason","setDeductReason","isDeductPinOpen","setIsDeductPinOpen","isDeductAmountOpen","setIsDeductAmountOpen","deductAmount","setDeductAmount","formatCurrency","loadAccessorySales","todayStr","total","price","loadMaintenanceTotal","totalAmount","completedAt","repair","loadDailyReceipts","r","effectiveAccessoryToday","effectiveMaintenanceToday","handleReceipt","amountToAck","startDeductionFlow","confirmDeductReason","openDeductAmount","performDeduction","amt","ArrowRightLeft","FawryMachineIcon","size","props","ROOT_NAME","createAlertDialogContext","createContextScope","createDialogScope","useDialogScope","AlertDialog","__scopeAlertDialog","alertDialogProps","dialogScope","DialogPrimitive.Root","TRIGGER_NAME","AlertDialogTrigger","React.forwardRef","forwardedRef","triggerProps","DialogPrimitive.Trigger","PORTAL_NAME","AlertDialogPortal","portalProps","DialogPrimitive.Portal","OVERLAY_NAME","AlertDialogOverlay","overlayProps","DialogPrimitive.Overlay","CONTENT_NAME","AlertDialogContentProvider","useAlertDialogContentContext","Slottable","createSlottable","AlertDialogContent","children","contentProps","contentRef","React.useRef","composedRefs","useComposedRefs","cancelRef","DialogPrimitive.WarningProvider","TITLE_NAME","DialogPrimitive.Content","composeEventHandlers","DescriptionWarning","AlertDialogTitle","titleProps","DialogPrimitive.Title","DESCRIPTION_NAME","AlertDialogDescription","descriptionProps","DialogPrimitive.Description","ACTION_NAME","AlertDialogAction","actionProps","DialogPrimitive.Close","CANCEL_NAME","AlertDialogCancel","cancelProps","MESSAGE","Root2","Portal2","Overlay2","Content2","Action","Cancel","Title2","Description2","AlertDialogPrimitive.Root","AlertDialogPrimitive.Portal","AlertDialogPrimitive.Overlay","cn","AlertDialogPrimitive.Content","AlertDialogHeader","AlertDialogPrimitive.Title","AlertDialogPrimitive.Description","AlertDialogPrimitive.Action","buttonVariants","AlertDialogPrimitive.Cancel","formatDateTime","iso","STORAGE_KEY_OPENING","STORAGE_KEY_OPENING_SNAPSHOT","MachineDailyDialog","getFallbackShopId","k","openingBase","setOpeningBase","openingAir","setOpeningAir","drawerCash","setDrawerCash","savedOpeningBase","setSavedOpeningBase","savedOpeningAir","setSavedOpeningAir","savedDrawerCash","setSavedDrawerCash","openingSnapshot","setOpeningSnapshot","isOpeningOpen","setIsOpeningOpen","isDeliverySectionOpen","setIsDeliverySectionOpen","deliveryBase","setDeliveryBase","deliveryAir","setDeliveryAir","netResult","setNetResult","receipts","setReceipts","transferReceipts","setTransferReceipts","transferDialogOpen","setTransferDialogOpen","wholesalePrice","setWholesalePrice","retailPrice","setRetailPrice","deductDialogOpen","setDeductDialogOpen","pendingTransfer","setPendingTransfer","machines","setMachines","selectedMachineId","setSelectedMachineId","newMachineName","setNewMachineName","transferServerHydrated","setTransferServerHydrated","deliveriesServerHydrated","setDeliveriesServerHydrated","keyOpening","keySnap","savedOpening","obj","savedSnap","getDocs2","col","savedId","cashierName","totalTransferProfit","totalWholesaleTransferred","handleClearTransferReceipts","handleClearMachineReceipts","handleDeleteMachineReceipt","handleResetOpening","handleAddOpening","base","air","dc","sid0","handleStartDelivery","handleDoDelivery","dBase","dAir","openingBaseForReceipt","openingAirForReceipt","openingSum","receipt","sid1","current","handleTransferConfirm","finalizeTransfer","from","stockDeductAmount","prevBase","prevAir","prevDrawer","newBase","newAir","totalDrawerAdded","newDrawer","sid2","machineRef","sidKey","resetDialogState","created","ded","cached","nextOpen","baseRef","transSnap","delSnap","sidSel","useDebouncedValue","delay","debounced","setDebounced","MonthlyProfitDisplayDialog","setIsOpen","isAuthenticated","setIsAuthenticated","profitData","setProfitData","loadProfitData","visibleMonthly","reportsService","monthlyWithdrawProfit","monthlyTransferProfit","txDate","txForCalc","ProfitService","profits","isZeroPlan","localSub","rawLocal","planLocalStr","remoteSub","rawRemote","planRemoteStr","handleEyeClick","handlePinSuccess","ArrowDownLeft","MonthlyProfitEyeButton","ProfitPinDialog","setHasExistingPin","DailyProfitDisplayDialog","isPinDialogOpen","setIsPinDialogOpen","visibleDaily","dailyWithdrawProfit","dailyTransferProfit","DailyProfitEyeButton","CashierShiftModal","shiftStartAt","setShiftUser","startShift","endShift","signIn","setName","username","setUsername","password","setPassword","handoverDialogOpen","setHandoverDialogOpen","handoverMode","setHandoverMode","mainPassword","setMainPassword","mainAuthError","setMainAuthError","isVerifyingMain","setIsVerifyingMain","handoverSelectedUser","setHandoverSelectedUser","handoverPassword","setHandoverPassword","handoverError","setHandoverError","isHandoverProcessing","setIsHandoverProcessing","reportDialogOpen","setReportDialogOpen","reportTotals","setReportTotals","deficitChoice","setDeficitChoice","deficitAmount","setDeficitAmount","receivedDrawerFunds","setReceivedDrawerFunds","receivedWalletBalancesTotal","setReceivedWalletBalancesTotal","receivedWalletBalancesMap","setReceivedWalletBalancesMap","deliveredDrawerFunds","setDeliveredDrawerFunds","deliveredWalletBalancesTotal","setDeliveredWalletBalancesTotal","deliveredWalletBalancesMap","setDeliveredWalletBalancesMap","handoverTargetLabel","setHandoverTargetLabel","initialIntakeDialogOpen","setInitialIntakeDialogOpen","normalizeDigits","map","ch","getCashierUsersKey","users","setUsers","saved","legacy","cloudUsers","localUsers","planType","maxCashiers","authDialogOpen","setAuthDialogOpen","enteredPassword","setEnteredPassword","selectedUser","setSelectedUser","deliveryReports","setDeliveryReports","deliveryReportsDialogOpen","setDeliveryReportsDialogOpen","selectedDeliveryReport","setSelectedDeliveryReport","isDeliveryReportOpen","setIsDeliveryReportOpen","addUserDialogOpen","setAddUserDialogOpen","handleDeleteUser","usernameToDelete","isCurrentShiftUser","lastHandoverToAdmin","confirmMsg","u","handleAddUser","newUser","handleEndShift","computeShiftTotals","res","startTime","parseDate","inShiftWindow","isCompletedStatus","completed","reports","ad","saveShiftReceiptToRecent","totals","deficit","deficitAmt","initialDrawerFunds","initialWalletBalancesTotal","idx","drawer","isDrawerValid","isWalletsValid","email","ShiftProfileDialog","match","o","ChangeLogDialog","Wrench","Sparkles","WalletCashService","currentCashBalance","currentWalletBalances","selectedWalletId","limitCheck","available","totalAvailable","newWalletBalances","remainingAmount","newCashBalance","message","afterBalance","totalWalletBalance","defaultWallet","balance","targetWallet","updateCashBalance","updateWalletBalances","preview","audioCtx","getAudioContext","AnyWindow","Ctx","scheduleNoiseBurst","ctx","durationMs","durationSec","bufferSize","buffer","i","source","filter","gain","scheduleToneSweep","startFreq","endFreq","osc","playVodafoneShakshan","strictValidateMsisdn","msisdn","normalized","GoogleBackupBar","loading","setLoading","setMessage","UserDashboardPage","formRef","formTranslateY","setFormTranslateY","submitTopUp","allowedEmail","userEmail","topupPhone","topupOperator","topupAmount","setTopupLoading","idToken","resp","setIsTopUpOpen","setTopupPhone","setTopupOperator","setTopupAmount","signOut","isVodafoneCashUser","params","useParams","queryClientHook","isMobile","useIsMobile","isCashierModalOpen","setIsCashierModalOpen","isShiftProfileOpen","setIsShiftProfileOpen","isChangeLogOpen","setIsChangeLogOpen","branchDialogOpen","setBranchDialogOpen","branches","setBranches","managerNameInput","setManagerNameInput","branchNameInput","setBranchNameInput","loginUsernameInput","setLoginUsernameInput","loginPasswordInput","setLoginPasswordInput","branchLoading","setBranchLoading","branchLoginOpen","setBranchLoginOpen","branchLoginTarget","setBranchLoginTarget","branchLoginUsername","setBranchLoginUsername","branchLoginPassword","setBranchLoginPassword","branchAuthLoading","setBranchAuthLoading","adbDevices","setAdbDevices","selectedAdbDeviceId","setSelectedAdbDeviceId","Preferences","isDeviceConnected","ensureDeviceReadyBeforeSend","api","sel","usb","ip","wifiCandidate","wifiIp","devices","sendTransfer","receiverPhone","sw","getSelectedWalletObj","senderPhone","sendTransferFromWalletDeepLink","setIsPostConfirmPopupOpen","setIsPinModalOpen","msg","triggerSendTransferCode","lastUSSDTransfer","receiver","setUssdLoading","getUssdCodeBySender","openUssdDeepLink","readyId","pick","decoratedId","setLastDecoratedDeviceId","e2","maybeIp","lastDecoratedDeviceId","handlePinSubmit","deviceId","rawLink","devId","receiverDigits","amountInt","pinDigits","baseUrl","isUserActive","setIsUserActive","isCheckingActivation","setIsCheckingActivation","isShopExpensesDialogOpen","setIsShopExpensesDialogOpen","isShopExpensesPinDialogOpen","setIsShopExpensesPinDialogOpen","expenseName","setExpenseName","expenseAmount","setExpenseAmount","expenseNotes","setExpenseNotes","expenses","setExpenses","isExpenseDeductionChoiceOpen","setIsExpenseDeductionChoiceOpen","expenseDeductionSource","setExpenseDeductionSource","selectedWalletForExpense","setSelectedWalletForExpense","isReceiptsOpen","setIsReceiptsOpen","isReceiptsDialogOpen","setIsReceiptsDialogOpen","showActivationModal","setShowActivationModal","isDeficienciesDialogOpen","setIsDeficienciesDialogOpen","deficiencyName","setDeficiencyName","deficiencyQuantity","setDeficiencyQuantity","deficiencies","setDeficiencies","isOnFreeTrial","setIsOnFreeTrial","freeTrialHoursRemaining","setFreeTrialHoursRemaining","hasUsedFreeTrial","setHasUsedFreeTrial","setUserSubscription","isRefreshingSubscription","setIsRefreshingSubscription","setSenderPhone","setReceiverPhone","withdrawNote","setWithdrawNote","withdrawSenderName","setWithdrawSenderName","isQuickDebtOpen","setIsQuickDebtOpen","quickDebtName","setQuickDebtName","quickDebtAmount","setQuickDebtAmount","quickDebtNotes","setQuickDebtNotes","quickDebtCustomerId","setQuickDebtCustomerId","quickDebtInfo","setQuickDebtInfo","didCreateQuickDebt","setDidCreateQuickDebt","isWalletsDialogOpen","setIsWalletsDialogOpen","isWalletsPinDialogOpen","setIsWalletsPinDialogOpen","isWalletSelectionPinDialogOpen","setIsWalletSelectionPinDialogOpen","pendingSelectedWalletId","setPendingSelectedWalletId","manualCommission","setManualCommission","transferCommission","setTransferCommission","transferExtraFee","setTransferExtraFee","isMonthlyLimitWarnOpen","setIsMonthlyLimitWarnOpen","selectedQuickIcon","setSelectedQuickIcon","monthlyLimitWarnData","setMonthlyLimitWarnData","isWithdrawSenderNameInputEnabled","setIsWithdrawSenderNameInputEnabled","withRetry","arabicIndic","easternIndic","ai","ei","isCommissionAddMode","setIsCommissionAddMode","transactionType","setTransactionType","activeTab","setActiveTab","debts","setDebts","recentTransactionsQuery","orderBy","collection2","where2","db2","filtered","rawType","deletedIds","deletedTransactions","active","getKey","seen","distinct","completedDebtIds","paid","saveDebtsToStorage","dp","userVal","globalVal","defVal","isSalesDataOpen","setIsSalesDataOpen","pendingBarcode","setPendingBarcode","isWalletManagementOpen","setIsWalletManagementOpen","editingWalletForDropdown","setEditingWalletForDropdown","baseAmount","commissionCalc","ratePerThousand","manual","debtAmount","savedWalletsStr","parsedWallets","candidateId","getSelectedWalletKey","useLayoutEffect","preferredKey","anyWalletKey","savedSelected","walletToSelect","loadExpensesFromStorage","loadDeficienciesFromStorage","walletsQuery","merchantWalletService2","savedSelectedWallet","walletSearch","setWalletSearch","filteredWallets","selectedTransaction","setSelectedTransaction","isTransactionDetailsOpen","setIsTransactionDetailsOpen","isReceiptOpen","setIsReceiptOpen","receiptTransaction","setReceiptTransaction","dailyStats","setDailyStats","monthlyStatsArray","setMonthlyStatsArray","isResetDialogOpen","setIsResetDialogOpen","resetType","setResetType","setDeletedTransactions","isRealtimeActive","setIsRealtimeActive","deletedEffectsAppliedRef","limitsRollbackAppliedRef","transactionsRef","applyLocalDeleteEffects","walletKey","getWalletBalancesKey","savedWallets","amountVal","setCashBalance","setWalletBalances","setHasLocalDataToSync","updatedLimits","handleDeleteReceipt","transactionId","idStr","refStr","alreadyApplied","updatedTransactions","auditLogService","handleCompleteReceipt","plan","dailyOperationCountService","opType","limitErr","fsQuery","change","originalId","txnId","refId","calculateDailyStats","searchPhone","setSearchPhone","debouncedSearchPhone","selectedDate","setSelectedDate","selectedTime","setSelectedTime","reportSearchPhone","setReportSearchPhone","isTransferSuccess","setIsTransferSuccess","isWithdrawSuccess","setIsWithdrawSuccess","isPostConfirmPopupOpen","postConfirmInfo","setPostConfirmInfo","setLastUSSDTransfer","ussdLoading","isPinModalOpen","isCalculatorOpen","setIsCalculatorOpen","showDesktopQuickIcons","isInstallmentPinOpen","setIsInstallmentPinOpen","isInstallmentModalOpen","setIsInstallmentModalOpen","isCreditCardsOpen","setIsCreditCardsOpen","isMaintenanceOpen","setIsMaintenanceOpen","isMachineDailyDialogOpen","setIsMachineDailyDialogOpen","areReportsCollapsed","setAreReportsCollapsed","isMonthlyPinDialogOpen","setIsMonthlyPinDialogOpen","isTelegramOpen","setIsTelegramOpen","telegramChatId","setTelegramChatId","telegramDailyEnabled","setTelegramDailyEnabled","isVipOpen","setIsVipOpen","isDailyLocked","setIsDailyLocked","isDailyPinDialogOpen","setIsDailyPinDialogOpen","isDebtsDialogOpen","setIsDebtsDialogOpen","isDebtsPasswordDialogOpen","setIsDebtsPasswordDialogOpen","isDebtsPinRequired","setIsDebtsPinRequired","isDebtsPinToggleOpen","setIsDebtsPinToggleOpen","pendingDebtsPinValue","setPendingDebtsPinValue","debtorName","setDebtorName","setDebtAmount","debtReason","setDebtReason","debtRole","setDebtRole","selectedDebt","setSelectedDebt","isDebtReceiptOpen","setIsDebtReceiptOpen","isDebtAdjustDialogOpen","setIsDebtAdjustDialogOpen","debtAdjustType","setDebtAdjustType","debtAdjustAmount","setDebtAdjustAmount","pendingDebtAdjustment","setPendingDebtAdjustment","isDebtsPinDialogOpen","setIsDebtsPinDialogOpen","isPartialPaymentOpen","setIsPartialPaymentOpen","partialPaymentAmount","setPartialPaymentAmount","isDebtReceiptsListOpen","setIsDebtReceiptsListOpen","debtsPage","setDebtsPage","DEBTS_PAGE_SIZE","visibleDebts","openDebts","hasPin","loadDebtsFromStorage","isAddCustomerDialogOpen","setIsAddCustomerDialogOpen","newCustomerName","setNewCustomerName","newCustomerMobile","setNewCustomerMobile","selectedCustomerId","setSelectedCustomerId","customerDebtAmount","setCustomerDebtAmount","isEditCustomerDialogOpen","setIsEditCustomerDialogOpen","editingCustomerId","setEditingCustomerId","editingCustomerName","setEditingCustomerName","editingCustomerMobile","setEditingCustomerMobile","isDeleteCustomerConfirmOpen","setIsDeleteCustomerConfirmOpen","customerToDeleteId","setCustomerToDeleteId","customerToDeleteName","setCustomerToDeleteName","isDebtDeductionChoiceOpen","setIsDebtDeductionChoiceOpen","pendingDebtToCreate","setPendingDebtToCreate","deductionSource","setDeductionSource","selectedWalletForDeduction","setSelectedWalletForDeduction","isPaymentCreditChoiceOpen","setIsPaymentCreditChoiceOpen","paymentAmountPending","setPaymentAmountPending","paymentCreditSource","setPaymentCreditSource","selectedWalletForPaymentCredit","setSelectedWalletForPaymentCredit","selectedWalletLimits","setSelectedWalletLimits","selectedWalletName","setSelectedWalletName","debtsToSave","serialized","getDebtsKey","getDebtsDefaultKey","getDebtsLastWriteKey","localUserKey","localDefaultKey","localLastWriteKey","localByUser","localByDefault","lastWriteStr","lastWriteMs","parseDebts","listStr","debt","localDebts","migrated","debtsUnsyncedKey","hasDebtsUnsynced","userDocSnap","fbDebts","json","msisdns","fbDebtsRaw","fetchSubscriptionData","subscriptionData","isRefreshing","setIsRefreshing","isDatePickerOpen","setIsDatePickerOpen","isEditCashDialogOpen","setIsEditCashDialogOpen","isEditWalletDialogOpen","setIsEditWalletDialogOpen","isAddToWalletDialogOpen","setIsAddToWalletDialogOpen","isResetSelectedWalletDialogOpen","setIsResetSelectedWalletDialogOpen","resetSelectedWalletPinInput","setResetSelectedWalletPinInput","isResetRecentDialogOpen","setIsResetRecentDialogOpen","isCashAmountDialogOpen","setIsCashAmountDialogOpen","cashAmountInput","setCashAmountInput","isTopUpOpen","topupLoading","isYourReportsOpen","setIsYourReportsOpen","isReportsPinOpen","setIsReportsPinOpen","reportArchives","setReportArchives","dailyReportsArchiveService","getCustomersKey","getExpensesKey","saveExpensesToStorage","permanentlyDeleteExpense","expenseId","doc2","deleteDoc2","cloudErr","onSnapshot2","finalList","getDeficienciesKey","newKey","oldKey","oldRaw","newRaw","oldList","newList","saveDeficienciesToStorage","currentShopId","saveCustomersToStorage","loadCustomersFromStorage","userDoc","firebaseCustomers","getTransactionsKey","chg","tid","typ","dataRef","snapData","cashPinInput","setCashPinInput","editingWalletId","setEditingWalletId","isShiftHandoverAllowed","valid","isSubscriptionValid","allowedPlan","isTahweelaPlan","handleOpenShiftProfile","isEditCashBalanceOpen","setIsEditCashBalanceOpen","isChangePinDialogOpen","setIsChangePinDialogOpen","isChangeCashPinDialogOpen","setIsChangeCashPinDialogOpen","isChangeWalletTotalPinDialogOpen","setIsChangeWalletTotalPinDialogOpen","isAddCashDialogOpen","setIsAddCashDialogOpen","addCashAmountInput","setAddCashAmountInput","addCashPinInput","setAddCashPinInput","isAddingCash","setIsAddingCash","addCashNoteEnabled","setAddCashNoteEnabled","addCashNoteText","setAddCashNoteText","isCashSummaryOpen","setIsCashSummaryOpen","isCashSummaryPinDialogOpen","setIsCashSummaryPinDialogOpen","isAddWalletTotalDialogOpen","setIsAddWalletTotalDialogOpen","addWalletTotalAmountInput","setAddWalletTotalAmountInput","addWalletTotalPinInput","setAddWalletTotalPinInput","isAddingWalletTotal","setIsAddingWalletTotal","syncLocalDataWithFirebase","localDataStr","localDebtsStr","localData","localDebtsRaw","toJsDate","normalize","remoteDebtsRaw","remoteDebts","byIdRemote","ld","rd","rdPaid","ldPaid","rdStatus","ldStatus","take","recentResetConfig","setRecentResetConfig","keep","interval","last","effectiveTransactions","monthStart","nextMonthStart","hiddenCount","vipTop10","monthEnd","phoneRaw","toWaNumber","sendVipWhatsApp","composeTelegramDailySummary","txToday","totalOps","totalWithdrawn","totalSent","accessoriesSales","cairoDate","totalDebts","pp","deficienciesText","getFilteredTransactions","phoneQuery","selectedDateObj","hours","minutes","filterDateTime","nextHour","isResetWalletTotalDialogOpen","setIsResetWalletTotalDialogOpen","resetWalletTotalPinInput","setResetWalletTotalPinInput","isResetCashDialogOpen","setIsResetCashDialogOpen","resetCashPinInput","setResetCashPinInput","hasLocalDataToSync","fn","retries","delayMs","lastErr","verifyWalletTotalPin","inputPin","verifyCashDrawerPin","wbKeyNew","wbKeyOld","savedWalletBalances","cbKeyNew","cbKeyOld","legacyKey","savedCashBalance","cb","wbs","getWalletLimitsCacheKey","wid","limitsObj","refreshSelectedWalletLimits","setWalletSelection","transactionSection","walletSelect","loadWalletsFromFirebase","userDocRef","docSnapshot","isActive","handleSubscriptionActivated","handleUserSubscriptionUpdated","handleGlobalShortcuts","trialValidity","FreeTrialService","isOnTrial","remoteBalances","firebaseDeletedTransactions","formattedWallets","userTransactions","transactionsWithDates","deletedTransactionIds","permanentDeletedKeys","permQ","permSet","activeTransactions","txId","txTxnId","txRef","inDeleted","blockedByPerm","loadUserData","autoMonthlyDbCleanup","autoResetLimits","autoResetReports","dayDate","baseDateStr","dayTransactions","totalTransactions","reportDateStr","resetResult","utDocs","q1fb","gDocs","q2fb","savedWallet","currentPath","handleWindowFocus","handleWalletChange","walletSelectionPinService","handleTransactionTypeChange","onKeyDown","btn","handleTransactionClick","handleDeleteTransaction","transactionToDelete","txKey","refKey","saveError","updatedDeletedTransactions","fromWalletId","isTransfer","update","setDoc2","ReportsService","transactionData","errorMessage","dateOverride","sameDay","visibleTransactions","calculateMonthlyStats","visibleMonthlyTransactions","totalTransferred","currentMonthlyStats","walletMonthlyUsageMemo","selectedWalletObj","amountNum","predictedMonthlyWithdrawUsed","predictedMonthlyTransferUsed","percent","withdrawThreshold","transferThreshold","monthKey","warnKeyBase","handleTransaction","setSuccessOptimistic","revertSuccess","yyyy","mm","dailyKey","usedCountRaw","walletUsage","merchantShopName","newTransaction","validation","commissionAmount","rate","effectiveAmount","isDeferredTransfer","isDeferredWithdraw","skipProcess","linkedDebtId","sDigits","rDigits","is010To011","extraFee","fullCommission","currentWalletBalance","totalDebit","check","effectiveSelectedWalletId","limitsSrc","pendingToday","dailyLimit","dailyUsed","pendingMonth","monthlyLimit","monthlyUsed","prevBalance","walletObj","previousBalance","updatedDebts","addToCash","updatedTransactionsList","usedCount","effectiveWalletId","remainingWalletBalance","srcPhone","dstPhone","hasFee","mark","commissionPart","feePart","shouldSend","prevMsg","prevAt","transactionDataCreate","transactionDataForUser","createdTransactionId","amountToReceive","amountToDeliver","dateFormatter","timeFormatter","totalOutstandingDebts","outstanding","handleResetSuccess","hiddenIds","getResetDialogTitle","getResetDialogDescription","handleEditWalletBalance","handleEditCashSuccess","newBalance","delta","handleEditWalletBalanceSuccess","updatedBalances","timestamp","handleAddToWalletSuccess","addedAmount","operationAmount","backupKeys","LogoLoader","ArrowUpDown","Search","BadgePercent","BarChart","FileText","AlertTriangle","InstallmentModal","isShiftReceipt","isCashAddReceipt","noteText","ReceiptModal","Crown","ProfileIcon","RefreshCw","MessageCircle","Switch","text","manager","bname","uname","pw","shopIdNew","safeEncode","list2","expectedUser","expectedPw","enc","rect","viewBottom","needed","offset","WalletsManagement","walletMonthlyUsage","walletDailyUsage","dailyWithdrawUsed","dailyTransferUsed","predictedDailyWithdrawUsed","predictedDailyTransferUsed","dest","amountEl","commissionEl","quickBtn","swInner","commissionPerThousand","debtVal","manualFixed","manualEl","submitBtn","selected","amountToSave","selectedCustomer","currentTotal","walletIds","amountPerWallet","ratio","additionalAmount","amountToAdd","CreditCardsDialog","MaintenanceDialog","todayTx","st","reportDate","nextVal","PasswordConfirmDialog","resetAt","toDelete","cfg","isDebtor","isCreditor","cleared","newCustomer","ex","newExpenseId","addDoc2","serverTimestamp2","newExpense","updatedExpenses","updateDoc2","isAdjustment","currentAmount","becamePaid","ids2","q3","snap3","ids3","stillPaid","related","principal","totalDue","remainingBefore","newPaidTotal","isFullyPaid","updatedArr","payAmount","computedRemaining","baseAmt","prevPaid","sentAmt","PinModal"],"ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,34],"sources":["../../node_modules/lucide-react/dist/esm/icons/award.js","../../node_modules/lucide-react/dist/esm/icons/banknote.js","../../node_modules/lucide-react/dist/esm/icons/book-open.js","../../node_modules/lucide-react/dist/esm/icons/building.js","../../node_modules/lucide-react/dist/esm/icons/id-card.js","../../node_modules/lucide-react/dist/esm/icons/info.js","../../node_modules/lucide-react/dist/esm/icons/list-checks.js","../../node_modules/lucide-react/dist/esm/icons/notebook.js","../../node_modules/lucide-react/dist/esm/icons/package.js","../../node_modules/lucide-react/dist/esm/icons/trending-down.js","../../node_modules/@tanstack/query-core/build/modern/queryObserver.js","../../node_modules/@tanstack/react-query/build/modern/IsRestoringProvider.js","../../node_modules/@tanstack/react-query/build/modern/QueryErrorResetBoundary.js","../../node_modules/@tanstack/react-query/build/modern/errorBoundaryUtils.js","../../node_modules/@tanstack/react-query/build/modern/suspense.js","../../node_modules/@tanstack/react-query/build/modern/useBaseQuery.js","../../node_modules/@tanstack/react-query/build/modern/useQuery.js","../../src/integrations/firebase/functions.ts","../../src/components/WalletsViewPage.tsx","../../src/components/WalletDetailsPage.tsx","../../src/components/WalletManagement.tsx","../../src/components/TransactionDetailsModal.tsx","../../src/components/EditBalanceDialog.tsx","../../src/utils/securityService.ts","../../src/components/ChangePinDialog.tsx","../../src/components/ChangeCashPinDialog.tsx","../../src/components/ChangeWalletTotalPinDialog.tsx","../../src/components/AddToWalletDialog.tsx","../../src/utils/walletLimitsService.ts","../../src/components/NotificationBell.tsx","../../src/components/CalculatorDialog.tsx","../../src/components/SalesDataDialog.tsx","../../src/components/CashSummaryDialog.tsx","../../src/components/icons/FawryMachineIcon.tsx","../../node_modules/@radix-ui/react-alert-dialog/dist/index.mjs","../../src/components/ui/alert-dialog.tsx","../../src/components/MachineDailyDialog.tsx","../../src/hooks/useDebouncedValue.ts","../../src/components/MonthlyProfitDisplayDialog.tsx","../../src/components/ProfitPinDialog.tsx","../../src/components/DailyProfitDisplayDialog.tsx","../../src/components/CashierShiftModal.tsx","../../src/components/ShiftProfileDialog.tsx","../../src/components/ChangeLogDialog.tsx","../../src/utils/walletCashService.ts","../../src/utils/sound.ts","../../src/utils/walletValidation.ts","../../src/pages/UserDashboardPage.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Award = createLucideIcon(\"Award\", [\n  [\n    \"path\",\n    {\n      d: \"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526\",\n      key: \"1yiouv\"\n    }\n  ],\n  [\"circle\", { cx: \"12\", cy: \"8\", r: \"6\", key: \"1vp47v\" }]\n]);\n\nexport { Award as default };\n//# sourceMappingURL=award.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Banknote = createLucideIcon(\"Banknote\", [\n  [\"rect\", { width: \"20\", height: \"12\", x: \"2\", y: \"6\", rx: \"2\", key: \"9lu3g6\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"2\", key: \"1c9p78\" }],\n  [\"path\", { d: \"M6 12h.01M18 12h.01\", key: \"113zkx\" }]\n]);\n\nexport { Banknote as default };\n//# sourceMappingURL=banknote.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst BookOpen = createLucideIcon(\"BookOpen\", [\n  [\"path\", { d: \"M12 7v14\", key: \"1akyts\" }],\n  [\n    \"path\",\n    {\n      d: \"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z\",\n      key: \"ruj8y\"\n    }\n  ]\n]);\n\nexport { BookOpen as default };\n//# sourceMappingURL=book-open.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Building = createLucideIcon(\"Building\", [\n  [\"rect\", { width: \"16\", height: \"20\", x: \"4\", y: \"2\", rx: \"2\", ry: \"2\", key: \"76otgf\" }],\n  [\"path\", { d: \"M9 22v-4h6v4\", key: \"r93iot\" }],\n  [\"path\", { d: \"M8 6h.01\", key: \"1dz90k\" }],\n  [\"path\", { d: \"M16 6h.01\", key: \"1x0f13\" }],\n  [\"path\", { d: \"M12 6h.01\", key: \"1vi96p\" }],\n  [\"path\", { d: \"M12 10h.01\", key: \"1nrarc\" }],\n  [\"path\", { d: \"M12 14h.01\", key: \"1etili\" }],\n  [\"path\", { d: \"M16 10h.01\", key: \"1m94wz\" }],\n  [\"path\", { d: \"M16 14h.01\", key: \"1gbofw\" }],\n  [\"path\", { d: \"M8 10h.01\", key: \"19clt8\" }],\n  [\"path\", { d: \"M8 14h.01\", key: \"6423bh\" }]\n]);\n\nexport { Building as default };\n//# sourceMappingURL=building.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst IdCard = createLucideIcon(\"IdCard\", [\n  [\"path\", { d: \"M16 10h2\", key: \"8sgtl7\" }],\n  [\"path\", { d: \"M16 14h2\", key: \"epxaof\" }],\n  [\"path\", { d: \"M6.17 15a3 3 0 0 1 5.66 0\", key: \"n6f512\" }],\n  [\"circle\", { cx: \"9\", cy: \"11\", r: \"2\", key: \"yxgjnd\" }],\n  [\"rect\", { x: \"2\", y: \"5\", width: \"20\", height: \"14\", rx: \"2\", key: \"qneu4z\" }]\n]);\n\nexport { IdCard as default };\n//# sourceMappingURL=id-card.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Info = createLucideIcon(\"Info\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"M12 16v-4\", key: \"1dtifu\" }],\n  [\"path\", { d: \"M12 8h.01\", key: \"e9boi3\" }]\n]);\n\nexport { Info as default };\n//# sourceMappingURL=info.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ListChecks = createLucideIcon(\"ListChecks\", [\n  [\"path\", { d: \"m3 17 2 2 4-4\", key: \"1jhpwq\" }],\n  [\"path\", { d: \"m3 7 2 2 4-4\", key: \"1obspn\" }],\n  [\"path\", { d: \"M13 6h8\", key: \"15sg57\" }],\n  [\"path\", { d: \"M13 12h8\", key: \"h98zly\" }],\n  [\"path\", { d: \"M13 18h8\", key: \"oe0vm4\" }]\n]);\n\nexport { ListChecks as default };\n//# sourceMappingURL=list-checks.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Notebook = createLucideIcon(\"Notebook\", [\n  [\"path\", { d: \"M2 6h4\", key: \"aawbzj\" }],\n  [\"path\", { d: \"M2 10h4\", key: \"l0bgd4\" }],\n  [\"path\", { d: \"M2 14h4\", key: \"1gsvsf\" }],\n  [\"path\", { d: \"M2 18h4\", key: \"1bu2t1\" }],\n  [\"rect\", { width: \"16\", height: \"20\", x: \"4\", y: \"2\", rx: \"2\", key: \"1nb95v\" }],\n  [\"path\", { d: \"M16 2v20\", key: \"rotuqe\" }]\n]);\n\nexport { Notebook as default };\n//# sourceMappingURL=notebook.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Package = createLucideIcon(\"Package\", [\n  [\n    \"path\",\n    {\n      d: \"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z\",\n      key: \"1a0edw\"\n    }\n  ],\n  [\"path\", { d: \"M12 22V12\", key: \"d0xqtd\" }],\n  [\"path\", { d: \"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7\", key: \"yx3hmr\" }],\n  [\"path\", { d: \"m7.5 4.27 9 5.15\", key: \"1c824w\" }]\n]);\n\nexport { Package as default };\n//# sourceMappingURL=package.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst TrendingDown = createLucideIcon(\"TrendingDown\", [\n  [\"polyline\", { points: \"22 17 13.5 8.5 8.5 13.5 2 7\", key: \"1r2t7k\" }],\n  [\"polyline\", { points: \"16 17 22 17 22 11\", key: \"11uiuu\" }]\n]);\n\nexport { TrendingDown as default };\n//# sourceMappingURL=trending-down.js.map\n","// src/queryObserver.ts\nimport { focusManager } from \"./focusManager.js\";\nimport { notifyManager } from \"./notifyManager.js\";\nimport { fetchState } from \"./query.js\";\nimport { Subscribable } from \"./subscribable.js\";\nimport { pendingThenable } from \"./thenable.js\";\nimport {\n  isServer,\n  isValidTimeout,\n  noop,\n  replaceData,\n  resolveEnabled,\n  resolveStaleTime,\n  shallowEqualObjects,\n  timeUntilStale\n} from \"./utils.js\";\nimport { timeoutManager } from \"./timeoutManager.js\";\nvar QueryObserver = class extends Subscribable {\n  constructor(client, options) {\n    super();\n    this.options = options;\n    this.#client = client;\n    this.#selectError = null;\n    this.#currentThenable = pendingThenable();\n    this.bindMethods();\n    this.setOptions(options);\n  }\n  #client;\n  #currentQuery = void 0;\n  #currentQueryInitialState = void 0;\n  #currentResult = void 0;\n  #currentResultState;\n  #currentResultOptions;\n  #currentThenable;\n  #selectError;\n  #selectFn;\n  #selectResult;\n  // This property keeps track of the last query with defined data.\n  // It will be used to pass the previous data and query to the placeholder function between renders.\n  #lastQueryWithDefinedData;\n  #staleTimeoutId;\n  #refetchIntervalId;\n  #currentRefetchInterval;\n  #trackedProps = /* @__PURE__ */ new Set();\n  bindMethods() {\n    this.refetch = this.refetch.bind(this);\n  }\n  onSubscribe() {\n    if (this.listeners.size === 1) {\n      this.#currentQuery.addObserver(this);\n      if (shouldFetchOnMount(this.#currentQuery, this.options)) {\n        this.#executeFetch();\n      } else {\n        this.updateResult();\n      }\n      this.#updateTimers();\n    }\n  }\n  onUnsubscribe() {\n    if (!this.hasListeners()) {\n      this.destroy();\n    }\n  }\n  shouldFetchOnReconnect() {\n    return shouldFetchOn(\n      this.#currentQuery,\n      this.options,\n      this.options.refetchOnReconnect\n    );\n  }\n  shouldFetchOnWindowFocus() {\n    return shouldFetchOn(\n      this.#currentQuery,\n      this.options,\n      this.options.refetchOnWindowFocus\n    );\n  }\n  destroy() {\n    this.listeners = /* @__PURE__ */ new Set();\n    this.#clearStaleTimeout();\n    this.#clearRefetchInterval();\n    this.#currentQuery.removeObserver(this);\n  }\n  setOptions(options) {\n    const prevOptions = this.options;\n    const prevQuery = this.#currentQuery;\n    this.options = this.#client.defaultQueryOptions(options);\n    if (this.options.enabled !== void 0 && typeof this.options.enabled !== \"boolean\" && typeof this.options.enabled !== \"function\" && typeof resolveEnabled(this.options.enabled, this.#currentQuery) !== \"boolean\") {\n      throw new Error(\n        \"Expected enabled to be a boolean or a callback that returns a boolean\"\n      );\n    }\n    this.#updateQuery();\n    this.#currentQuery.setOptions(this.options);\n    if (prevOptions._defaulted && !shallowEqualObjects(this.options, prevOptions)) {\n      this.#client.getQueryCache().notify({\n        type: \"observerOptionsUpdated\",\n        query: this.#currentQuery,\n        observer: this\n      });\n    }\n    const mounted = this.hasListeners();\n    if (mounted && shouldFetchOptionally(\n      this.#currentQuery,\n      prevQuery,\n      this.options,\n      prevOptions\n    )) {\n      this.#executeFetch();\n    }\n    this.updateResult();\n    if (mounted && (this.#currentQuery !== prevQuery || resolveEnabled(this.options.enabled, this.#currentQuery) !== resolveEnabled(prevOptions.enabled, this.#currentQuery) || resolveStaleTime(this.options.staleTime, this.#currentQuery) !== resolveStaleTime(prevOptions.staleTime, this.#currentQuery))) {\n      this.#updateStaleTimeout();\n    }\n    const nextRefetchInterval = this.#computeRefetchInterval();\n    if (mounted && (this.#currentQuery !== prevQuery || resolveEnabled(this.options.enabled, this.#currentQuery) !== resolveEnabled(prevOptions.enabled, this.#currentQuery) || nextRefetchInterval !== this.#currentRefetchInterval)) {\n      this.#updateRefetchInterval(nextRefetchInterval);\n    }\n  }\n  getOptimisticResult(options) {\n    const query = this.#client.getQueryCache().build(this.#client, options);\n    const result = this.createResult(query, options);\n    if (shouldAssignObserverCurrentProperties(this, result)) {\n      this.#currentResult = result;\n      this.#currentResultOptions = this.options;\n      this.#currentResultState = this.#currentQuery.state;\n    }\n    return result;\n  }\n  getCurrentResult() {\n    return this.#currentResult;\n  }\n  trackResult(result, onPropTracked) {\n    return new Proxy(result, {\n      get: (target, key) => {\n        this.trackProp(key);\n        onPropTracked?.(key);\n        if (key === \"promise\") {\n          this.trackProp(\"data\");\n          if (!this.options.experimental_prefetchInRender && this.#currentThenable.status === \"pending\") {\n            this.#currentThenable.reject(\n              new Error(\n                \"experimental_prefetchInRender feature flag is not enabled\"\n              )\n            );\n          }\n        }\n        return Reflect.get(target, key);\n      }\n    });\n  }\n  trackProp(key) {\n    this.#trackedProps.add(key);\n  }\n  getCurrentQuery() {\n    return this.#currentQuery;\n  }\n  refetch({ ...options } = {}) {\n    return this.fetch({\n      ...options\n    });\n  }\n  fetchOptimistic(options) {\n    const defaultedOptions = this.#client.defaultQueryOptions(options);\n    const query = this.#client.getQueryCache().build(this.#client, defaultedOptions);\n    return query.fetch().then(() => this.createResult(query, defaultedOptions));\n  }\n  fetch(fetchOptions) {\n    return this.#executeFetch({\n      ...fetchOptions,\n      cancelRefetch: fetchOptions.cancelRefetch ?? true\n    }).then(() => {\n      this.updateResult();\n      return this.#currentResult;\n    });\n  }\n  #executeFetch(fetchOptions) {\n    this.#updateQuery();\n    let promise = this.#currentQuery.fetch(\n      this.options,\n      fetchOptions\n    );\n    if (!fetchOptions?.throwOnError) {\n      promise = promise.catch(noop);\n    }\n    return promise;\n  }\n  #updateStaleTimeout() {\n    this.#clearStaleTimeout();\n    const staleTime = resolveStaleTime(\n      this.options.staleTime,\n      this.#currentQuery\n    );\n    if (isServer || this.#currentResult.isStale || !isValidTimeout(staleTime)) {\n      return;\n    }\n    const time = timeUntilStale(this.#currentResult.dataUpdatedAt, staleTime);\n    const timeout = time + 1;\n    this.#staleTimeoutId = timeoutManager.setTimeout(() => {\n      if (!this.#currentResult.isStale) {\n        this.updateResult();\n      }\n    }, timeout);\n  }\n  #computeRefetchInterval() {\n    return (typeof this.options.refetchInterval === \"function\" ? this.options.refetchInterval(this.#currentQuery) : this.options.refetchInterval) ?? false;\n  }\n  #updateRefetchInterval(nextInterval) {\n    this.#clearRefetchInterval();\n    this.#currentRefetchInterval = nextInterval;\n    if (isServer || resolveEnabled(this.options.enabled, this.#currentQuery) === false || !isValidTimeout(this.#currentRefetchInterval) || this.#currentRefetchInterval === 0) {\n      return;\n    }\n    this.#refetchIntervalId = timeoutManager.setInterval(() => {\n      if (this.options.refetchIntervalInBackground || focusManager.isFocused()) {\n        this.#executeFetch();\n      }\n    }, this.#currentRefetchInterval);\n  }\n  #updateTimers() {\n    this.#updateStaleTimeout();\n    this.#updateRefetchInterval(this.#computeRefetchInterval());\n  }\n  #clearStaleTimeout() {\n    if (this.#staleTimeoutId) {\n      timeoutManager.clearTimeout(this.#staleTimeoutId);\n      this.#staleTimeoutId = void 0;\n    }\n  }\n  #clearRefetchInterval() {\n    if (this.#refetchIntervalId) {\n      timeoutManager.clearInterval(this.#refetchIntervalId);\n      this.#refetchIntervalId = void 0;\n    }\n  }\n  createResult(query, options) {\n    const prevQuery = this.#currentQuery;\n    const prevOptions = this.options;\n    const prevResult = this.#currentResult;\n    const prevResultState = this.#currentResultState;\n    const prevResultOptions = this.#currentResultOptions;\n    const queryChange = query !== prevQuery;\n    const queryInitialState = queryChange ? query.state : this.#currentQueryInitialState;\n    const { state } = query;\n    let newState = { ...state };\n    let isPlaceholderData = false;\n    let data;\n    if (options._optimisticResults) {\n      const mounted = this.hasListeners();\n      const fetchOnMount = !mounted && shouldFetchOnMount(query, options);\n      const fetchOptionally = mounted && shouldFetchOptionally(query, prevQuery, options, prevOptions);\n      if (fetchOnMount || fetchOptionally) {\n        newState = {\n          ...newState,\n          ...fetchState(state.data, query.options)\n        };\n      }\n      if (options._optimisticResults === \"isRestoring\") {\n        newState.fetchStatus = \"idle\";\n      }\n    }\n    let { error, errorUpdatedAt, status } = newState;\n    data = newState.data;\n    let skipSelect = false;\n    if (options.placeholderData !== void 0 && data === void 0 && status === \"pending\") {\n      let placeholderData;\n      if (prevResult?.isPlaceholderData && options.placeholderData === prevResultOptions?.placeholderData) {\n        placeholderData = prevResult.data;\n        skipSelect = true;\n      } else {\n        placeholderData = typeof options.placeholderData === \"function\" ? options.placeholderData(\n          this.#lastQueryWithDefinedData?.state.data,\n          this.#lastQueryWithDefinedData\n        ) : options.placeholderData;\n      }\n      if (placeholderData !== void 0) {\n        status = \"success\";\n        data = replaceData(\n          prevResult?.data,\n          placeholderData,\n          options\n        );\n        isPlaceholderData = true;\n      }\n    }\n    if (options.select && data !== void 0 && !skipSelect) {\n      if (prevResult && data === prevResultState?.data && options.select === this.#selectFn) {\n        data = this.#selectResult;\n      } else {\n        try {\n          this.#selectFn = options.select;\n          data = options.select(data);\n          data = replaceData(prevResult?.data, data, options);\n          this.#selectResult = data;\n          this.#selectError = null;\n        } catch (selectError) {\n          this.#selectError = selectError;\n        }\n      }\n    }\n    if (this.#selectError) {\n      error = this.#selectError;\n      data = this.#selectResult;\n      errorUpdatedAt = Date.now();\n      status = \"error\";\n    }\n    const isFetching = newState.fetchStatus === \"fetching\";\n    const isPending = status === \"pending\";\n    const isError = status === \"error\";\n    const isLoading = isPending && isFetching;\n    const hasData = data !== void 0;\n    const result = {\n      status,\n      fetchStatus: newState.fetchStatus,\n      isPending,\n      isSuccess: status === \"success\",\n      isError,\n      isInitialLoading: isLoading,\n      isLoading,\n      data,\n      dataUpdatedAt: newState.dataUpdatedAt,\n      error,\n      errorUpdatedAt,\n      failureCount: newState.fetchFailureCount,\n      failureReason: newState.fetchFailureReason,\n      errorUpdateCount: newState.errorUpdateCount,\n      isFetched: newState.dataUpdateCount > 0 || newState.errorUpdateCount > 0,\n      isFetchedAfterMount: newState.dataUpdateCount > queryInitialState.dataUpdateCount || newState.errorUpdateCount > queryInitialState.errorUpdateCount,\n      isFetching,\n      isRefetching: isFetching && !isPending,\n      isLoadingError: isError && !hasData,\n      isPaused: newState.fetchStatus === \"paused\",\n      isPlaceholderData,\n      isRefetchError: isError && hasData,\n      isStale: isStale(query, options),\n      refetch: this.refetch,\n      promise: this.#currentThenable,\n      isEnabled: resolveEnabled(options.enabled, query) !== false\n    };\n    const nextResult = result;\n    if (this.options.experimental_prefetchInRender) {\n      const finalizeThenableIfPossible = (thenable) => {\n        if (nextResult.status === \"error\") {\n          thenable.reject(nextResult.error);\n        } else if (nextResult.data !== void 0) {\n          thenable.resolve(nextResult.data);\n        }\n      };\n      const recreateThenable = () => {\n        const pending = this.#currentThenable = nextResult.promise = pendingThenable();\n        finalizeThenableIfPossible(pending);\n      };\n      const prevThenable = this.#currentThenable;\n      switch (prevThenable.status) {\n        case \"pending\":\n          if (query.queryHash === prevQuery.queryHash) {\n            finalizeThenableIfPossible(prevThenable);\n          }\n          break;\n        case \"fulfilled\":\n          if (nextResult.status === \"error\" || nextResult.data !== prevThenable.value) {\n            recreateThenable();\n          }\n          break;\n        case \"rejected\":\n          if (nextResult.status !== \"error\" || nextResult.error !== prevThenable.reason) {\n            recreateThenable();\n          }\n          break;\n      }\n    }\n    return nextResult;\n  }\n  updateResult() {\n    const prevResult = this.#currentResult;\n    const nextResult = this.createResult(this.#currentQuery, this.options);\n    this.#currentResultState = this.#currentQuery.state;\n    this.#currentResultOptions = this.options;\n    if (this.#currentResultState.data !== void 0) {\n      this.#lastQueryWithDefinedData = this.#currentQuery;\n    }\n    if (shallowEqualObjects(nextResult, prevResult)) {\n      return;\n    }\n    this.#currentResult = nextResult;\n    const shouldNotifyListeners = () => {\n      if (!prevResult) {\n        return true;\n      }\n      const { notifyOnChangeProps } = this.options;\n      const notifyOnChangePropsValue = typeof notifyOnChangeProps === \"function\" ? notifyOnChangeProps() : notifyOnChangeProps;\n      if (notifyOnChangePropsValue === \"all\" || !notifyOnChangePropsValue && !this.#trackedProps.size) {\n        return true;\n      }\n      const includedProps = new Set(\n        notifyOnChangePropsValue ?? this.#trackedProps\n      );\n      if (this.options.throwOnError) {\n        includedProps.add(\"error\");\n      }\n      return Object.keys(this.#currentResult).some((key) => {\n        const typedKey = key;\n        const changed = this.#currentResult[typedKey] !== prevResult[typedKey];\n        return changed && includedProps.has(typedKey);\n      });\n    };\n    this.#notify({ listeners: shouldNotifyListeners() });\n  }\n  #updateQuery() {\n    const query = this.#client.getQueryCache().build(this.#client, this.options);\n    if (query === this.#currentQuery) {\n      return;\n    }\n    const prevQuery = this.#currentQuery;\n    this.#currentQuery = query;\n    this.#currentQueryInitialState = query.state;\n    if (this.hasListeners()) {\n      prevQuery?.removeObserver(this);\n      query.addObserver(this);\n    }\n  }\n  onQueryUpdate() {\n    this.updateResult();\n    if (this.hasListeners()) {\n      this.#updateTimers();\n    }\n  }\n  #notify(notifyOptions) {\n    notifyManager.batch(() => {\n      if (notifyOptions.listeners) {\n        this.listeners.forEach((listener) => {\n          listener(this.#currentResult);\n        });\n      }\n      this.#client.getQueryCache().notify({\n        query: this.#currentQuery,\n        type: \"observerResultsUpdated\"\n      });\n    });\n  }\n};\nfunction shouldLoadOnMount(query, options) {\n  return resolveEnabled(options.enabled, query) !== false && query.state.data === void 0 && !(query.state.status === \"error\" && options.retryOnMount === false);\n}\nfunction shouldFetchOnMount(query, options) {\n  return shouldLoadOnMount(query, options) || query.state.data !== void 0 && shouldFetchOn(query, options, options.refetchOnMount);\n}\nfunction shouldFetchOn(query, options, field) {\n  if (resolveEnabled(options.enabled, query) !== false && resolveStaleTime(options.staleTime, query) !== \"static\") {\n    const value = typeof field === \"function\" ? field(query) : field;\n    return value === \"always\" || value !== false && isStale(query, options);\n  }\n  return false;\n}\nfunction shouldFetchOptionally(query, prevQuery, options, prevOptions) {\n  return (query !== prevQuery || resolveEnabled(prevOptions.enabled, query) === false) && (!options.suspense || query.state.status !== \"error\") && isStale(query, options);\n}\nfunction isStale(query, options) {\n  return resolveEnabled(options.enabled, query) !== false && query.isStaleByTime(resolveStaleTime(options.staleTime, query));\n}\nfunction shouldAssignObserverCurrentProperties(observer, optimisticResult) {\n  if (!shallowEqualObjects(observer.getCurrentResult(), optimisticResult)) {\n    return true;\n  }\n  return false;\n}\nexport {\n  QueryObserver\n};\n//# sourceMappingURL=queryObserver.js.map","\"use client\";\n\n// src/IsRestoringProvider.ts\nimport * as React from \"react\";\nvar IsRestoringContext = React.createContext(false);\nvar useIsRestoring = () => React.useContext(IsRestoringContext);\nvar IsRestoringProvider = IsRestoringContext.Provider;\nexport {\n  IsRestoringProvider,\n  useIsRestoring\n};\n//# sourceMappingURL=IsRestoringProvider.js.map","\"use client\";\n\n// src/QueryErrorResetBoundary.tsx\nimport * as React from \"react\";\nimport { jsx } from \"react/jsx-runtime\";\nfunction createValue() {\n  let isReset = false;\n  return {\n    clearReset: () => {\n      isReset = false;\n    },\n    reset: () => {\n      isReset = true;\n    },\n    isReset: () => {\n      return isReset;\n    }\n  };\n}\nvar QueryErrorResetBoundaryContext = React.createContext(createValue());\nvar useQueryErrorResetBoundary = () => React.useContext(QueryErrorResetBoundaryContext);\nvar QueryErrorResetBoundary = ({\n  children\n}) => {\n  const [value] = React.useState(() => createValue());\n  return /* @__PURE__ */ jsx(QueryErrorResetBoundaryContext.Provider, { value, children: typeof children === \"function\" ? children(value) : children });\n};\nexport {\n  QueryErrorResetBoundary,\n  useQueryErrorResetBoundary\n};\n//# sourceMappingURL=QueryErrorResetBoundary.js.map","\"use client\";\n\n// src/errorBoundaryUtils.ts\nimport * as React from \"react\";\nimport { shouldThrowError } from \"@tanstack/query-core\";\nvar ensurePreventErrorBoundaryRetry = (options, errorResetBoundary) => {\n  if (options.suspense || options.throwOnError || options.experimental_prefetchInRender) {\n    if (!errorResetBoundary.isReset()) {\n      options.retryOnMount = false;\n    }\n  }\n};\nvar useClearResetErrorBoundary = (errorResetBoundary) => {\n  React.useEffect(() => {\n    errorResetBoundary.clearReset();\n  }, [errorResetBoundary]);\n};\nvar getHasError = ({\n  result,\n  errorResetBoundary,\n  throwOnError,\n  query,\n  suspense\n}) => {\n  return result.isError && !errorResetBoundary.isReset() && !result.isFetching && query && (suspense && result.data === void 0 || shouldThrowError(throwOnError, [result.error, query]));\n};\nexport {\n  ensurePreventErrorBoundaryRetry,\n  getHasError,\n  useClearResetErrorBoundary\n};\n//# sourceMappingURL=errorBoundaryUtils.js.map","// src/suspense.ts\nvar defaultThrowOnError = (_error, query) => query.state.data === void 0;\nvar ensureSuspenseTimers = (defaultedOptions) => {\n  if (defaultedOptions.suspense) {\n    const MIN_SUSPENSE_TIME_MS = 1e3;\n    const clamp = (value) => value === \"static\" ? value : Math.max(value ?? MIN_SUSPENSE_TIME_MS, MIN_SUSPENSE_TIME_MS);\n    const originalStaleTime = defaultedOptions.staleTime;\n    defaultedOptions.staleTime = typeof originalStaleTime === \"function\" ? (...args) => clamp(originalStaleTime(...args)) : clamp(originalStaleTime);\n    if (typeof defaultedOptions.gcTime === \"number\") {\n      defaultedOptions.gcTime = Math.max(\n        defaultedOptions.gcTime,\n        MIN_SUSPENSE_TIME_MS\n      );\n    }\n  }\n};\nvar willFetch = (result, isRestoring) => result.isLoading && result.isFetching && !isRestoring;\nvar shouldSuspend = (defaultedOptions, result) => defaultedOptions?.suspense && result.isPending;\nvar fetchOptimistic = (defaultedOptions, observer, errorResetBoundary) => observer.fetchOptimistic(defaultedOptions).catch(() => {\n  errorResetBoundary.clearReset();\n});\nexport {\n  defaultThrowOnError,\n  ensureSuspenseTimers,\n  fetchOptimistic,\n  shouldSuspend,\n  willFetch\n};\n//# sourceMappingURL=suspense.js.map","\"use client\";\n\n// src/useBaseQuery.ts\nimport * as React from \"react\";\nimport { isServer, noop, notifyManager } from \"@tanstack/query-core\";\nimport { useQueryClient } from \"./QueryClientProvider.js\";\nimport { useQueryErrorResetBoundary } from \"./QueryErrorResetBoundary.js\";\nimport {\n  ensurePreventErrorBoundaryRetry,\n  getHasError,\n  useClearResetErrorBoundary\n} from \"./errorBoundaryUtils.js\";\nimport { useIsRestoring } from \"./IsRestoringProvider.js\";\nimport {\n  ensureSuspenseTimers,\n  fetchOptimistic,\n  shouldSuspend,\n  willFetch\n} from \"./suspense.js\";\nfunction useBaseQuery(options, Observer, queryClient) {\n  if (process.env.NODE_ENV !== \"production\") {\n    if (typeof options !== \"object\" || Array.isArray(options)) {\n      throw new Error(\n        'Bad argument type. Starting with v5, only the \"Object\" form is allowed when calling query related functions. Please use the error stack to find the culprit call. More info here: https://tanstack.com/query/latest/docs/react/guides/migrating-to-v5#supports-a-single-signature-one-object'\n      );\n    }\n  }\n  const isRestoring = useIsRestoring();\n  const errorResetBoundary = useQueryErrorResetBoundary();\n  const client = useQueryClient(queryClient);\n  const defaultedOptions = client.defaultQueryOptions(options);\n  client.getDefaultOptions().queries?._experimental_beforeQuery?.(\n    defaultedOptions\n  );\n  if (process.env.NODE_ENV !== \"production\") {\n    if (!defaultedOptions.queryFn) {\n      console.error(\n        `[${defaultedOptions.queryHash}]: No queryFn was passed as an option, and no default queryFn was found. The queryFn parameter is only optional when using a default queryFn. More info here: https://tanstack.com/query/latest/docs/framework/react/guides/default-query-function`\n      );\n    }\n  }\n  defaultedOptions._optimisticResults = isRestoring ? \"isRestoring\" : \"optimistic\";\n  ensureSuspenseTimers(defaultedOptions);\n  ensurePreventErrorBoundaryRetry(defaultedOptions, errorResetBoundary);\n  useClearResetErrorBoundary(errorResetBoundary);\n  const isNewCacheEntry = !client.getQueryCache().get(defaultedOptions.queryHash);\n  const [observer] = React.useState(\n    () => new Observer(\n      client,\n      defaultedOptions\n    )\n  );\n  const result = observer.getOptimisticResult(defaultedOptions);\n  const shouldSubscribe = !isRestoring && options.subscribed !== false;\n  React.useSyncExternalStore(\n    React.useCallback(\n      (onStoreChange) => {\n        const unsubscribe = shouldSubscribe ? observer.subscribe(notifyManager.batchCalls(onStoreChange)) : noop;\n        observer.updateResult();\n        return unsubscribe;\n      },\n      [observer, shouldSubscribe]\n    ),\n    () => observer.getCurrentResult(),\n    () => observer.getCurrentResult()\n  );\n  React.useEffect(() => {\n    observer.setOptions(defaultedOptions);\n  }, [defaultedOptions, observer]);\n  if (shouldSuspend(defaultedOptions, result)) {\n    throw fetchOptimistic(defaultedOptions, observer, errorResetBoundary);\n  }\n  if (getHasError({\n    result,\n    errorResetBoundary,\n    throwOnError: defaultedOptions.throwOnError,\n    query: client.getQueryCache().get(defaultedOptions.queryHash),\n    suspense: defaultedOptions.suspense\n  })) {\n    throw result.error;\n  }\n  ;\n  client.getDefaultOptions().queries?._experimental_afterQuery?.(\n    defaultedOptions,\n    result\n  );\n  if (defaultedOptions.experimental_prefetchInRender && !isServer && willFetch(result, isRestoring)) {\n    const promise = isNewCacheEntry ? (\n      // Fetch immediately on render in order to ensure `.promise` is resolved even if the component is unmounted\n      fetchOptimistic(defaultedOptions, observer, errorResetBoundary)\n    ) : (\n      // subscribe to the \"cache promise\" so that we can finalize the currentThenable once data comes in\n      client.getQueryCache().get(defaultedOptions.queryHash)?.promise\n    );\n    promise?.catch(noop).finally(() => {\n      observer.updateResult();\n    });\n  }\n  return !defaultedOptions.notifyOnChangeProps ? observer.trackResult(result) : result;\n}\nexport {\n  useBaseQuery\n};\n//# sourceMappingURL=useBaseQuery.js.map","\"use client\";\n\n// src/useQuery.ts\nimport { QueryObserver } from \"@tanstack/query-core\";\nimport { useBaseQuery } from \"./useBaseQuery.js\";\nfunction useQuery(options, queryClient) {\n  return useBaseQuery(options, QueryObserver, queryClient);\n}\nexport {\n  useQuery\n};\n//# sourceMappingURL=useQuery.js.map","import { getFunctions, httpsCallable } from 'firebase/functions';\r\nimport { functions } from '../../firebase';\r\nimport { Transaction } from './types';\r\n\r\n//      \r\ninterface GetLastTransactionsData {\r\n  limit?: number;\r\n  walletId?: string;\r\n  lineId?: string;\r\n  merchantUserId?: string;\r\n}\r\n\r\n//      \r\ninterface GetLastTransactionsResult {\r\n  transactions: Transaction[];\r\n}\r\n\r\n//    \r\ninterface CancelTransactionData {\r\n  transactionId: string;\r\n  reason: string;\r\n  cancelledBy: string;\r\n}\r\n\r\ninterface UpdateTransactionStatusData {\r\n  transactionId: string;\r\n  status: 'pending' | 'completed' | 'failed' | 'cancelled';\r\n  updatedBy: string;\r\n  note?: string;\r\n}\r\n\r\n//    \r\ninterface CancelTransactionResult {\r\n  success: boolean;\r\n  message?: string;\r\n}\r\n\r\ninterface UpdateTransactionStatusResult {\r\n  success: boolean;\r\n  message?: string;\r\n}\r\n\r\n//   Functions  \r\n// const functions = getFunctions(app); //    firebase.ts\r\n\r\n//    \r\ninterface RecordTransactionData {\r\n  lineId: string;\r\n  walletId: string;\r\n  txnType: 'send' | 'receive';\r\n  amount: number;\r\n  senderMsisdn?: string;\r\n  receiverMsisdn?: string;\r\n  reference?: string;\r\n  fee?: number;\r\n}\r\n\r\n//    \r\ninterface RecordTransactionResult {\r\n  id: string;\r\n  shopId: string;\r\n  lineId: string;\r\n  walletId: string;\r\n  merchantUserId: string;\r\n  provider: string;\r\n  txnType: 'send' | 'receive';\r\n  amount: number;\r\n  commission: number;\r\n  profit: number;\r\n  sender_msisdn: string;\r\n  receiver_msisdn: string;\r\n  reference: string | null;\r\n  status: 'confirmed';\r\n  createdAt: string;\r\n  fee?: number;\r\n}\r\n\r\n/**\r\n *     Cloud Function\r\n * @param data  \r\n * @returns   \r\n */\r\nexport const recordTransaction = async (data: RecordTransactionData): Promise<RecordTransactionResult> => {\r\n  try {\r\n    //   Cloud Function\r\n    const recordTransactionFn = httpsCallable<RecordTransactionData, RecordTransactionResult>(\r\n      functions,\r\n      'recordTransaction'\r\n    );\r\n\r\n    //  \r\n    const result = await recordTransactionFn(data);\r\n    \r\n    //  \r\n    return result.data;\r\n  } catch (error: any) {\r\n    console.error('Error recording transaction:', error);\r\n    \r\n    //      \r\n    if (error.code === 'functions/unauthenticated') {\r\n      throw new Error('    ');\r\n    } else if (error.code === 'functions/invalid-argument') {\r\n      throw new Error('   : ' + error.message);\r\n    } else if (error.code === 'functions/resource-exhausted') {\r\n      throw new Error('  : ' + error.message);\r\n    } else if (error.code === 'functions/failed-precondition') {\r\n      throw new Error('   : ' + error.message);\r\n    } else {\r\n      throw new Error('    : ' + (error.message || '  '));\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n *    Cloud Function\r\n * @param data   \r\n * @returns   \r\n */\r\nexport const cancelTransaction = async (data: CancelTransactionData): Promise<CancelTransactionResult> => {\r\n  try {\r\n    //   Cloud Function\r\n    const cancelTransactionFn = httpsCallable<CancelTransactionData, CancelTransactionResult>(\r\n      functions,\r\n      'cancelTransaction'\r\n    );\r\n\r\n    //  \r\n    const result = await cancelTransactionFn(data);\r\n    \r\n    //  \r\n    return result.data;\r\n  } catch (error: any) {\r\n    console.error('Error cancelling transaction:', error);\r\n    \r\n    //      \r\n    if (error.code === 'functions/unauthenticated') {\r\n      throw new Error('    ');\r\n    } else if (error.code === 'functions/invalid-argument') {\r\n      throw new Error('   : ' + error.message);\r\n    } else if (error.code === 'functions/not-found') {\r\n      throw new Error('  : ' + error.message);\r\n    } else if (error.code === 'functions/permission-denied') {\r\n      throw new Error('     : ' + error.message);\r\n    } else {\r\n      throw new Error('    : ' + (error.message || '  '));\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n *     Cloud Function\r\n * @param data   \r\n * @returns   \r\n */\r\n/**\r\n *      Cloud Function\r\n * @param data  \r\n * @returns   \r\n */\r\nexport const getLastTransactions = async (data: GetLastTransactionsData = {}): Promise<GetLastTransactionsResult> => {\r\n  try {\r\n    //   Cloud Function\r\n    const getLastTransactionsFn = httpsCallable<GetLastTransactionsData, GetLastTransactionsResult>(\r\n      functions,\r\n      'getLastTransactions'\r\n    );\r\n\r\n    //  \r\n    const result = await getLastTransactionsFn(data);\r\n    \r\n    //  \r\n    return result.data;\r\n  } catch (error: any) {\r\n    console.error('Error getting last transactions:', error);\r\n    \r\n    //      \r\n    if (error.code === 'functions/unauthenticated') {\r\n      throw new Error('     ');\r\n    } else if (error.code === 'functions/invalid-argument') {\r\n      throw new Error('   : ' + error.message);\r\n    } else if (error.code === 'functions/permission-denied') {\r\n      throw new Error('      : ' + error.message);\r\n    } else {\r\n      throw new Error('    : ' + (error.message || '  '));\r\n    }\r\n  }\r\n};\r\n\r\nexport const updateTransactionStatus = async (data: UpdateTransactionStatusData): Promise<UpdateTransactionStatusResult> => {\r\n  try {\r\n    //   Cloud Function\r\n    const updateStatusFn = httpsCallable<UpdateTransactionStatusData, UpdateTransactionStatusResult>(\r\n      functions,\r\n      'updateTransactionStatus'\r\n    );\r\n\r\n    //  \r\n    const result = await updateStatusFn(data);\r\n    \r\n    //  \r\n    return result.data;\r\n  } catch (error: any) {\r\n    console.error('Error updating transaction status:', error);\r\n    \r\n    //      \r\n    if (error.code === 'functions/unauthenticated') {\r\n      throw new Error('     ');\r\n    } else if (error.code === 'functions/invalid-argument') {\r\n      throw new Error('   : ' + error.message);\r\n    } else if (error.code === 'functions/not-found') {\r\n      throw new Error('  : ' + error.message);\r\n    } else if (error.code === 'functions/permission-denied') {\r\n      throw new Error('      : ' + error.message);\r\n    } else {\r\n      throw new Error('     : ' + (error.message || '  '));\r\n    }\r\n  }\r\n};\r\n\r\nexport const sendTelegramMessage = async (data: { chatId: string; text: string }): Promise<{ ok: boolean }> => {\r\n  const fn = httpsCallable<typeof data, { ok: boolean }>(functions, 'sendTelegramMessage');\r\n  const res = await fn(data);\r\n  return res.data;\r\n};\r\n\r\nexport const sendTelegramDailySummary = async (data: { userId?: string; chatId: string; text: string }): Promise<{ ok: boolean }> => {\r\n  return sendTelegramMessage({ chatId: data.chatId, text: data.text });\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Wallet, Phone, DollarSign, Star, CreditCard, TrendingUp, TrendingDown, ArrowLeft, IdCard, Building, Edit, Trash2 } from 'lucide-react';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { merchantWalletService, transactionService } from '@/integrations/firebase/services';\r\nimport walletDailyLimitsService from '@/utils/walletDailyLimitsService';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\ninterface Wallet {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  nationalId?: string;\r\n  isDefault: boolean;\r\n  isActive?: boolean;\r\n  monthlyWithdrawalLimit: number;\r\n  monthlyTransferLimit: number;\r\n  monthlyWithdrawalUsage?: number;\r\n  monthlyTransferUsage?: number;\r\n  lastResetDate?: string;\r\n  walletProvider?: string;\r\n}\r\n\r\ninterface WalletsViewPageProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onWalletSelect: (wallet: Wallet) => void;\r\n  onEditWallet?: (wallet: Wallet) => void;\r\n  onDeleteWallet?: (walletId: string) => void;\r\n}\r\n\r\n//   \r\nconst walletProviders = [\r\n  {\r\n    id: 'vodafone',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29012345678901'\r\n  },\r\n  {\r\n    id: 'etisalat',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '28506789012345'\r\n  },\r\n  {\r\n    id: 'orange',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29309876543210'\r\n  },\r\n  {\r\n    id: 'we_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29112345678901'\r\n  },\r\n  {\r\n    id: 'smart_wallet',\r\n    name: ' ',\r\n    ownerName: '   ',\r\n    nationalId: '28809876543210'\r\n  },\r\n  {\r\n    id: 'access_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29456789012345'\r\n  },\r\n  {\r\n    id: 'insta_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29012345678901'\r\n  }\r\n];\r\n\r\nconst WalletsViewPage: React.FC<WalletsViewPageProps> = ({ isOpen, onClose, onWalletSelect, onEditWallet, onDeleteWallet }) => {\r\n  const { user } = useFirebaseAuth();\r\n  const [wallets, setWallets] = useState<Wallet[]>([]);\r\n  const [selectMode, setSelectMode] = useState<boolean>(false);\r\n  const [selectedIds, setSelectedIds] = useState<string[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  //     localStorage  \r\n  const getWalletsKey = () => `wallets_${user?.uid || 'default'}`;\r\n\r\n  //          \r\n  const loadWalletsFromLocalWithMigration = (): any[] | null => {\r\n    try {\r\n      const currentKey = getWalletsKey();\r\n      const current = localStorage.getItem(currentKey);\r\n      if (current) {\r\n        const parsed = JSON.parse(current);\r\n        if (Array.isArray(parsed) && parsed.length > 0) return parsed;\r\n      }\r\n      const legacyDefaultKey = 'wallets_default';\r\n      const legacyDefault = localStorage.getItem(legacyDefaultKey);\r\n      if (legacyDefault) {\r\n        const parsed = JSON.parse(legacyDefault);\r\n        if (Array.isArray(parsed) && parsed.length > 0) {\r\n          localStorage.setItem(currentKey, legacyDefault);\r\n          try { localStorage.removeItem(legacyDefaultKey); } catch {}\r\n          return parsed;\r\n        }\r\n      }\r\n      const keys = Object.keys(localStorage).filter(k => k.startsWith('wallets_') && k !== currentKey);\r\n      let best: any[] | null = null;\r\n      let bestKey: string | null = null;\r\n      for (const k of keys) {\r\n        try {\r\n          const s = localStorage.getItem(k);\r\n          if (!s) continue;\r\n          const parsed = JSON.parse(s);\r\n          if (Array.isArray(parsed) && parsed.length > 0) {\r\n            if (!best || parsed.length > (best?.length || 0)) {\r\n              best = parsed;\r\n              bestKey = k;\r\n            }\r\n          }\r\n        } catch {}\r\n      }\r\n      if (best && bestKey) {\r\n        localStorage.setItem(currentKey, JSON.stringify(best));\r\n        try { localStorage.removeItem(bestKey); } catch {}\r\n        return best;\r\n      }\r\n    } catch (e) {\r\n      console.warn('WalletsViewPage migration failed:', e);\r\n    }\r\n    return null;\r\n  };\r\n\r\n  //     \r\n  const calculateWalletMonthlyUsage = async (walletId: string, transactions: any[]) => {\r\n    const currentMonth = new Date().getMonth();\r\n    const currentYear = new Date().getFullYear();\r\n    \r\n    const monthlyTransactions = transactions.filter(t => {\r\n      const transactionDate = new Date(t.createdAt);\r\n      return (\r\n        transactionDate.getMonth() === currentMonth && \r\n        transactionDate.getFullYear() === currentYear &&\r\n        //     (   )\r\n        (t.lineId === walletId || t.fromWallet === walletId)\r\n      );\r\n    });\r\n\r\n    //           \r\n    const isWithdrawTx = (t: any) => {\r\n      const type = t.type;\r\n      const xn = (t as any).txnType;\r\n      return (\r\n        xn === 'receive' ||\r\n        type === 'withdraw' ||\r\n        type === 'withdrawal' ||\r\n        type === 'receive'\r\n      );\r\n    };\r\n\r\n    const isSendTx = (t: any) => {\r\n      const type = t.type;\r\n      const xn = (t as any).txnType;\r\n      return (\r\n        xn === 'send' ||\r\n        type === 'send' ||\r\n        type === 'transfer'\r\n      );\r\n    };\r\n\r\n    const withdrawalUsage = monthlyTransactions\r\n      .filter(isWithdrawTx)\r\n      .reduce((sum, t) => {\r\n        const amount = (t as any).withdrawnAmount !== undefined ? (t as any).withdrawnAmount : t.amount;\r\n        return sum + (amount || 0);\r\n      }, 0);\r\n\r\n    const transferUsage = monthlyTransactions\r\n      .filter(isSendTx)\r\n      .reduce((sum, t) => {\r\n        const amount = (t as any).sentAmount !== undefined ? (t as any).sentAmount : t.amount;\r\n        return sum + (amount || 0);\r\n      }, 0);\r\n\r\n    return { withdrawalUsage, transferUsage };\r\n  };\r\n\r\n  //      \r\n  const checkAndResetMonthlyUsage = (wallet: Wallet): Wallet => {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const lastReset = wallet.lastResetDate;\r\n    \r\n    if (!lastReset) {\r\n      return {\r\n        ...wallet,\r\n        monthlyWithdrawalUsage: 0,\r\n        monthlyTransferUsage: 0,\r\n        lastResetDate: today\r\n      };\r\n    }\r\n\r\n    const lastResetDate = new Date(lastReset);\r\n    const currentDate = new Date();\r\n    \r\n    //      \r\n    if (lastResetDate.getMonth() !== currentDate.getMonth() || \r\n        lastResetDate.getFullYear() !== currentDate.getFullYear()) {\r\n      return {\r\n        ...wallet,\r\n        monthlyWithdrawalUsage: 0,\r\n        monthlyTransferUsage: 0,\r\n        lastResetDate: today\r\n      };\r\n    }\r\n\r\n    return wallet;\r\n  };\r\n\r\n  //  \r\n  useEffect(() => {\r\n    if (!user?.uid || !isOpen) return;\r\n\r\n    const loadWallets = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        const firebaseWallets = await merchantWalletService.getByMerchantId(user.uid);\r\n        const transactions = await transactionService.getByUserId(user.uid);\r\n        \r\n        const formattedWallets = await Promise.all(firebaseWallets.map(async w => {\r\n          const { withdrawalUsage, transferUsage } = await calculateWalletMonthlyUsage(w.id, transactions);\r\n          const limits = await walletDailyLimitsService.getWalletLimits(w.id);\r\n          return {\r\n            id: w.id,\r\n            name: w.label || '  ',\r\n            phone: w.msisdn,\r\n            nationalId: w.nationalId || '',\r\n            isDefault: false,\r\n            isActive: (w as any).isActive === true,\r\n            monthlyWithdrawalLimit: (limits?.monthlyWithdrawLimit ?? w.withdrawLimit ?? 200000),\r\n            monthlyTransferLimit: (limits?.monthlyTransferLimit ?? w.transferLimit ?? 200000),\r\n            monthlyWithdrawalUsage: (limits?.monthlyWithdrawUsed ?? withdrawalUsage ?? 0),\r\n            monthlyTransferUsage: (limits?.monthlyTransferUsed ?? transferUsage ?? 0),\r\n            lastResetDate: new Date().toISOString().split('T')[0],\r\n            walletProvider: (w.walletProvider || '')\r\n          };\r\n        }));\r\n        \r\n        const walletsWithResetCheck = formattedWallets.map(checkAndResetMonthlyUsage);\r\n        setWallets(walletsWithResetCheck);\r\n        \r\n      } catch (error) {\r\n        console.error('Error loading wallets:', error);\r\n        //          Firestore\r\n        toast({\r\n          title: '   ',\r\n          description: '      .      .           .',\r\n          variant: 'destructive'\r\n        });\r\n        \r\n        //              \r\n     } finally {\r\n       setIsLoading(false);\r\n     }\r\n    };\r\n\r\n    loadWallets();\r\n  }, [user?.uid, isOpen]);\r\n\r\n  //      \r\n  const getProviderInfo = (providerId: string) => {\r\n    return walletProviders.find(p => p.id === providerId);\r\n  };\r\n\r\n  //     \r\n  const getUsagePercentage = (used: number, limit: number) => {\r\n    return limit > 0 ? Math.min((used / limit) * 100, 100) : 0;\r\n  };\r\n\r\n  //   \r\n  const formatNumber = (num: number) => {\r\n    return new Intl.NumberFormat('ar-EG').format(num);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader className=\"pb-4\">\r\n          <DialogTitle className=\"flex items-center gap-2 text-lg\">\r\n            <Wallet className=\"h-5 w-5\" />\r\n               \r\n            <Badge variant=\"secondary\" className=\"mr-2\">\r\n              {wallets.length} \r\n            </Badge>\r\n          </DialogTitle>\r\n          <div className=\"flex items-center gap-2 mt-2\">\r\n            {!selectMode ? (\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => setSelectMode(true)}\r\n                className=\"h-7\"\r\n              >\r\n                 \r\n              </Button>\r\n            ) : (\r\n              <>\r\n                <Button\r\n                  size=\"sm\"\r\n                  onClick={async () => {\r\n                    try {\r\n                      if (!user?.uid) return;\r\n                      const ops = wallets.map(w => merchantWalletService.update(w.id, { isActive: selectedIds.includes(w.id) }));\r\n                      await Promise.all(ops);\r\n                      setWallets(prev => prev.map(w => ({ ...w, isActive: selectedIds.includes(w.id) })));\r\n                      setSelectMode(false);\r\n                      toast({ title: '  ', description: '      ' });\r\n                      try { window.dispatchEvent(new CustomEvent('wallets:activation-updated')); } catch {}\r\n                    } catch (e) {\r\n                      console.error('Error activating wallets:', e);\r\n                      toast({ title: ' ', description: '   ', variant: 'destructive' });\r\n                    }\r\n                  }}\r\n                  className=\"h-7\"\r\n                >\r\n                   \r\n                </Button>\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={() => { setSelectMode(false); setSelectedIds([]); }}\r\n                  className=\"h-7\"\r\n                >\r\n                  \r\n                </Button>\r\n              </>\r\n            )}\r\n          </div>\r\n        </DialogHeader>\r\n\r\n        {isLoading ? (\r\n          <div className=\"flex justify-center items-center py-8\">\r\n            <div className=\"text-center\">\r\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2\"></div>\r\n              <p className=\"text-sm text-gray-600\">  ...</p>\r\n            </div>\r\n          </div>\r\n        ) : wallets.length === 0 ? (\r\n          <div className=\"text-center py-8\">\r\n            <Wallet className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n            <p className=\"text-gray-600\">     </p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n            {wallets.map((wallet) => {\r\n              const providerInfo = getProviderInfo(wallet.walletProvider || '');\r\n              const withdrawalPercentage = getUsagePercentage(\r\n                wallet.monthlyWithdrawalUsage || 0,\r\n                wallet.monthlyWithdrawalLimit\r\n              );\r\n              const transferPercentage = getUsagePercentage(\r\n                wallet.monthlyTransferUsage || 0,\r\n                wallet.monthlyTransferLimit\r\n              );\r\n\r\n              const isSelected = selectedIds.includes(wallet.id);\r\n              const cardClasses = selectMode\r\n                ? `cursor-pointer transition-shadow border-2 ${isSelected ? 'border-blue-500 shadow-lg' : 'hover:border-blue-300'}`\r\n                : 'cursor-pointer hover:shadow-lg transition-shadow border-2 hover:border-blue-300';\r\n\r\n              return (\r\n                <Card \r\n                  key={wallet.id} \r\n                  className={cardClasses}\r\n                  onClick={() => {\r\n                    if (selectMode) {\r\n                      setSelectedIds(prev => prev.includes(wallet.id) ? prev.filter(id => id !== wallet.id) : [...prev, wallet.id]);\r\n                    } else {\r\n                      onWalletSelect(wallet);\r\n                    }\r\n                  }}\r\n                >\r\n                  <CardHeader className=\"pb-3\">\r\n                    <CardTitle className=\"flex items-center justify-between text-sm\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <CreditCard className=\"h-4 w-4\" />\r\n                        <span>{wallet.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        {wallet.isActive && (\r\n                          <Badge variant=\"default\" className=\"text-xs\"></Badge>\r\n                        )}\r\n                        {wallet.isDefault && (\r\n                          <Badge variant=\"default\" className=\"text-xs\">\r\n                            <Star className=\"h-3 w-3 mr-1\" />\r\n                            \r\n                          </Badge>\r\n                        )}\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            onEditWallet?.(wallet);\r\n                          }}\r\n                          className=\"h-7 px-2\"\r\n                        >\r\n                          <Edit className=\"h-4 w-4\" />\r\n                        </Button>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            onDeleteWallet?.(wallet.id);\r\n                          }}\r\n                          className=\"h-7 px-2 text-destructive hover:text-destructive\"\r\n                        >\r\n                          <Trash2 className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </div>\r\n                    </CardTitle>\r\n                  </CardHeader>\r\n                  \r\n                  <CardContent className=\"space-y-3\">\r\n                    {/*   */}\r\n                    <div className=\"space-y-2\">\r\n                      <div className=\"flex items-center gap-2 text-sm\">\r\n                        <Phone className=\"h-3 w-3 text-gray-500\" />\r\n                        <span className=\"font-mono\">{wallet.phone}</span>\r\n                      </div>\r\n                      \r\n                      {wallet.nationalId && (\r\n                        <div className=\"flex items-center gap-2 text-sm\">\r\n                          <IdCard className=\"h-3 w-3 text-gray-500\" />\r\n                          <span className=\"font-mono\">{wallet.nationalId}</span>\r\n                        </div>\r\n                      )}\r\n                      \r\n                      {providerInfo && (\r\n                        <div className=\"flex items-center gap-2 text-sm\">\r\n                          <Building className=\"h-3 w-3 text-gray-500\" />\r\n                          <span>{providerInfo.name}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/*        */}\r\n                    {(() => {\r\n                      const monthlyWithdrawalLimit = wallet.monthlyWithdrawalLimit;\r\n                      const monthlyTransferLimit = wallet.monthlyTransferLimit;\r\n                      const monthlyWithdrawUsed = wallet.monthlyWithdrawalUsage || 0;\r\n                      const monthlyTransferUsed = wallet.monthlyTransferUsage || 0;\r\n                      const remainingWithdraw = Math.max(monthlyWithdrawalLimit - monthlyWithdrawUsed, 0);\r\n                      const remainingTransfer = Math.max(monthlyTransferLimit - monthlyTransferUsed, 0);\r\n\r\n                      return (\r\n                        <div className=\"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2\">\r\n                          <div className=\"text-xs text-gray-600 font-medium text-center\">\r\n                             : {providerInfo?.name || wallet.walletProvider} - {wallet.phone}\r\n                          </div>\r\n                          <div className=\"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex\">\r\n                            <div className=\"w-1/2 bg-red-200 relative\">\r\n                              <div\r\n                                className=\"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-200 ease-out shadow-sm\"\r\n                                style={{ width: `${Math.min(((monthlyWithdrawUsed / Math.max(monthlyWithdrawalLimit, 1)) * 100), 100)}%` }}\r\n                              ></div>\r\n                            </div>\r\n                            <div className=\"w-1/2 bg-blue-200 relative\">\r\n                              <div\r\n                                className=\"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-200 ease-out shadow-sm\"\r\n                                style={{ width: `${Math.min(((monthlyTransferUsed / Math.max(monthlyTransferLimit, 1)) * 100), 100)}%` }}\r\n                              ></div>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex justify-between items-center mt-1\">\r\n                            <div className=\"text-xs text-red-600 font-medium\">\r\n                               : {formatNumber(remainingWithdraw)} \r\n                            </div>\r\n                            <div className=\"text-xs text-blue-600 font-medium\">\r\n                               : {formatNumber(remainingTransfer)} \r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })()}\r\n\r\n                    {/*    */}\r\n                    <Button \r\n                      variant=\"outline\" \r\n                      size=\"sm\" \r\n                      className=\"w-full text-xs\"\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        onWalletSelect(wallet);\r\n                      }}\r\n                    >\r\n                        \r\n                    </Button>\r\n                  </CardContent>\r\n                </Card>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"flex justify-end pt-4 border-t\">\r\n          <Button onClick={onClose} variant=\"outline\">\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n            \r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default WalletsViewPage;","import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { \r\n  Wallet, \r\n  Phone, \r\n  DollarSign, \r\n  Star, \r\n  CreditCard, \r\n  TrendingUp, \r\n  TrendingDown, \r\n  ArrowLeft, \r\n  IdCard, \r\n  Building, \r\n  Calendar,\r\n  Activity,\r\n  BarChart3,\r\n  Clock,\r\n  CheckCircle,\r\n  XCircle,\r\n  AlertCircle\r\n} from 'lucide-react';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { transactionService } from '@/integrations/firebase/services';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { calculateProfit } from '@/utils/commissionCalculator';\r\n\r\ninterface Wallet {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  nationalId?: string;\r\n  isDefault: boolean;\r\n  monthlyWithdrawalLimit: number;\r\n  monthlyTransferLimit: number;\r\n  monthlyWithdrawalUsage?: number;\r\n  monthlyTransferUsage?: number;\r\n  lastResetDate?: string;\r\n  walletProvider?: string;\r\n}\r\n\r\ninterface Transaction {\r\n  id: string;\r\n  type: 'withdrawal' | 'transfer' | 'deposit';\r\n  amount: number;\r\n  status: 'completed' | 'pending' | 'failed';\r\n  createdAt: string;\r\n  description?: string;\r\n  walletId: string;\r\n}\r\n\r\ninterface WalletDetailsPageProps {\r\n  wallet: Wallet | null;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onBack: () => void;\r\n}\r\n\r\n//   \r\nconst walletProviders = [\r\n  {\r\n    id: 'vodafone',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29012345678901'\r\n  },\r\n  {\r\n    id: 'etisalat',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '28506789012345'\r\n  },\r\n  {\r\n    id: 'orange',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29309876543210'\r\n  },\r\n  {\r\n    id: 'we_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29112345678901'\r\n  },\r\n  {\r\n    id: 'smart_wallet',\r\n    name: ' ',\r\n    ownerName: '   ',\r\n    nationalId: '28809876543210'\r\n  },\r\n  {\r\n    id: 'access_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29456789012345'\r\n  },\r\n  {\r\n    id: 'insta_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29012345678901'\r\n  }\r\n];\r\n\r\nconst WalletDetailsPage: React.FC<WalletDetailsPageProps> = ({ wallet, isOpen, onClose, onBack }) => {\r\n  const { user } = useFirebaseAuth();\r\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [selectedPeriod, setSelectedPeriod] = useState<'week' | 'month' | 'all'>('month');\r\n  const { toast } = useToast();\r\n\r\n  //  \r\n  useEffect(() => {\r\n    if (!wallet || !user?.uid || !isOpen) return;\r\n\r\n    const loadTransactions = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        const allTransactions = await transactionService.getByUserId(user.uid);\r\n        const walletTransactions = allTransactions\r\n          .filter(t => t.walletId === wallet.id)\r\n          .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n        \r\n        setTransactions(walletTransactions);\r\n      } catch (error) {\r\n        console.error('Error loading transactions:', error);\r\n        toast({\r\n          title: '   ',\r\n          description: '     Firestore  .     .        .',\r\n          variant: 'destructive'\r\n        });\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    loadTransactions();\r\n  }, [wallet, user?.uid, isOpen]);\r\n\r\n  if (!wallet) return null;\r\n\r\n  //      \r\n  const getProviderInfo = (providerId: string) => {\r\n    return walletProviders.find(p => p.id === providerId);\r\n  };\r\n\r\n  //     \r\n  const getUsagePercentage = (used: number, limit: number) => {\r\n    return limit > 0 ? Math.min((used / limit) * 100, 100) : 0;\r\n  };\r\n\r\n  //   \r\n  const formatNumber = (num: number) => {\r\n    return new Intl.NumberFormat('ar-EG').format(num);\r\n  };\r\n\r\n  //   \r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('ar-EG', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  //     \r\n  const getFilteredTransactions = () => {\r\n    const now = new Date();\r\n    let startDate: Date;\r\n\r\n    switch (selectedPeriod) {\r\n      case 'week':\r\n        startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n        break;\r\n      case 'month':\r\n        startDate = new Date(now.getFullYear(), now.getMonth(), 1);\r\n        break;\r\n      default:\r\n        return transactions;\r\n    }\r\n\r\n    return transactions.filter(t => new Date(t.createdAt) >= startDate);\r\n  };\r\n\r\n  //  \r\n  const filteredTransactions = getFilteredTransactions();\r\n  //          \r\n  const isWithdrawTx = (t: any) => {\r\n    const type = t.type;\r\n    const xn = (t as any).txnType;\r\n    return (\r\n      type === 'withdraw' ||\r\n      type === 'withdrawal' ||\r\n      type === 'receive' ||\r\n      xn === 'receive'\r\n    );\r\n  };\r\n  const isSendTx = (t: any) => {\r\n    const type = t.type;\r\n    const xn = (t as any).txnType;\r\n    return (\r\n      type === 'send' ||\r\n      type === 'transfer' ||\r\n      xn === 'send'\r\n    );\r\n  };\r\n\r\n  const totalWithdrawals = filteredTransactions\r\n    .filter(t => isWithdrawTx(t) && t.status === 'completed')\r\n    .reduce((sum, t) => {\r\n      const amount = (t as any).withdrawnAmount !== undefined ? (t as any).withdrawnAmount : t.amount;\r\n      return sum + (amount || 0);\r\n    }, 0);\r\n  const totalTransfers = filteredTransactions\r\n    .filter(t => isSendTx(t) && t.status === 'completed')\r\n    .reduce((sum, t) => {\r\n      const amount = (t as any).sentAmount !== undefined ? (t as any).sentAmount : t.amount;\r\n      return sum + (amount || 0);\r\n    }, 0);\r\n  const totalDeposits = filteredTransactions\r\n    .filter(t => t.type === 'deposit' && t.status === 'completed')\r\n    .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n  //       \r\n  const completedTransactions = filteredTransactions.filter(t => t.status === 'completed');\r\n  const operationsCount = completedTransactions.length;\r\n  const totalProfit = completedTransactions.reduce((sum, t: any) => {\r\n    if (isWithdrawTx(t)) {\r\n      const amount = t.withdrawnAmount ?? t.receivedAmount ?? t.amount ?? 0;\r\n      return sum + calculateProfit(Number(amount) || 0, 'receive');\r\n    }\r\n    if (isSendTx(t)) {\r\n      const amount = t.sentAmount ?? t.transferredAmount ?? t.amount ?? 0;\r\n      return sum + calculateProfit(Number(amount) || 0, 'send');\r\n    }\r\n    return sum;\r\n  }, 0);\r\n\r\n  const providerInfo = getProviderInfo(wallet.walletProvider || '');\r\n  const withdrawalPercentage = getUsagePercentage(\r\n    wallet.monthlyWithdrawalUsage || 0,\r\n    wallet.monthlyWithdrawalLimit\r\n  );\r\n  const transferPercentage = getUsagePercentage(\r\n    wallet.monthlyTransferUsage || 0,\r\n    wallet.monthlyTransferLimit\r\n  );\r\n\r\n  //      \r\n  const getTransactionIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'withdrawal':\r\n        return <TrendingDown className=\"h-4 w-4 text-red-500\" />;\r\n      case 'transfer':\r\n        return <TrendingUp className=\"h-4 w-4 text-blue-500\" />;\r\n      case 'deposit':\r\n        return <DollarSign className=\"h-4 w-4 text-green-500\" />;\r\n      default:\r\n        return <Activity className=\"h-4 w-4 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  //      \r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return <CheckCircle className=\"h-4 w-4 text-green-500\" />;\r\n      case 'pending':\r\n        return <Clock className=\"h-4 w-4 text-yellow-500\" />;\r\n      case 'failed':\r\n        return <XCircle className=\"h-4 w-4 text-red-500\" />;\r\n      default:\r\n        return <AlertCircle className=\"h-4 w-4 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  //      \r\n  const getTransactionTypeText = (type: string) => {\r\n    switch (type) {\r\n      case 'withdrawal':\r\n        return '';\r\n      case 'transfer':\r\n        return '';\r\n      case 'deposit':\r\n        return '';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  //      \r\n  const getStatusText = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return '';\r\n      case 'pending':\r\n        return ' ';\r\n      case 'failed':\r\n        return '';\r\n      default:\r\n        return ' ';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader className=\"pb-4\">\r\n          <DialogTitle className=\"flex items-center gap-2 text-lg\">\r\n            <CreditCard className=\"h-5 w-5\" />\r\n             : {wallet.name}\r\n            {wallet.isDefault && (\r\n              <Badge variant=\"default\" className=\"mr-2\">\r\n                <Star className=\"h-3 w-3 mr-1\" />\r\n                \r\n              </Badge>\r\n            )}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n          {/*    */}\r\n          <div className=\"lg:col-span-1 space-y-4\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"text-sm flex items-center gap-2\">\r\n                  <IdCard className=\"h-4 w-4\" />\r\n                   \r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-3\">\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  <Phone className=\"h-4 w-4 text-gray-500\" />\r\n                  <span className=\"font-mono\">{wallet.phone}</span>\r\n                </div>\r\n                \r\n                {wallet.nationalId && (\r\n                  <div className=\"flex items-center gap-2 text-sm\">\r\n                    <IdCard className=\"h-4 w-4 text-gray-500\" />\r\n                    <span className=\"font-mono\">{wallet.nationalId}</span>\r\n                  </div>\r\n                )}\r\n                \r\n                {providerInfo && (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex items-center gap-2 text-sm\">\r\n                      <Building className=\"h-4 w-4 text-gray-500\" />\r\n                      <span>{providerInfo.name}</span>\r\n                    </div>\r\n                    <div className=\"text-xs text-gray-600 pr-6\">\r\n                      <div>: {providerInfo.ownerName}</div>\r\n                      <div className=\"font-mono\"> : {providerInfo.nationalId}</div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {wallet.lastResetDate && (\r\n                  <div className=\"flex items-center gap-2 text-sm\">\r\n                    <Calendar className=\"h-4 w-4 text-gray-500\" />\r\n                    <span>  : {new Date(wallet.lastResetDate).toLocaleDateString('ar-EG')}</span>\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/*   */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"text-sm flex items-center gap-2\">\r\n                  <BarChart3 className=\"h-4 w-4\" />\r\n                    \r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                {/*   */}\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"flex items-center justify-between text-xs\">\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <TrendingDown className=\"h-3 w-3 text-red-500\" />\r\n                       \r\n                    </span>\r\n                    <span className=\"font-mono\">\r\n                      {formatNumber(wallet.monthlyWithdrawalUsage || 0)} / {formatNumber(wallet.monthlyWithdrawalLimit)}\r\n                    </span>\r\n                  </div>\r\n                  <Progress \r\n                    value={withdrawalPercentage} \r\n                    className=\"h-2\"\r\n                  />\r\n                  <div className=\"text-xs text-gray-600\">\r\n                    : {formatNumber(wallet.monthlyWithdrawalLimit - (wallet.monthlyWithdrawalUsage || 0))} \r\n                  </div>\r\n                </div>\r\n\r\n                <Separator />\r\n\r\n                {/*   */}\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"flex items-center justify-between text-xs\">\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <TrendingUp className=\"h-3 w-3 text-green-500\" />\r\n                       \r\n                    </span>\r\n                    <span className=\"font-mono\">\r\n                      {formatNumber(wallet.monthlyTransferUsage || 0)} / {formatNumber(wallet.monthlyTransferLimit)}\r\n                    </span>\r\n                  </div>\r\n                  <Progress \r\n                    value={transferPercentage} \r\n                    className=\"h-2\"\r\n                  />\r\n                  <div className=\"text-xs text-gray-600\">\r\n                    : {formatNumber(wallet.monthlyTransferLimit - (wallet.monthlyTransferUsage || 0))} \r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/*   */}\r\n          <div className=\"lg:col-span-2 space-y-4\">\r\n            {/*   */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <TrendingDown className=\"h-5 w-5 text-red-500\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalWithdrawals)}</div>\r\n                  <div className=\"text-xs text-gray-600\"> </div>\r\n                </CardContent>\r\n              </Card>\r\n              \r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <TrendingUp className=\"h-5 w-5 text-blue-500\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalTransfers)}</div>\r\n                  <div className=\"text-xs text-gray-600\"> </div>\r\n                </CardContent>\r\n              </Card>\r\n              \r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <DollarSign className=\"h-5 w-5 text-green-500\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalDeposits)}</div>\r\n                  <div className=\"text-xs text-gray-600\"> </div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/*   */}\r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <BarChart3 className=\"h-5 w-5 text-emerald-600\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalProfit)}</div>\r\n                  <div className=\"text-xs text-gray-600\"> </div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/*   */}\r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <Activity className=\"h-5 w-5 text-purple-600\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(operationsCount)}</div>\r\n                  <div className=\"text-xs text-gray-600\"> </div>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n\r\n            {/*    */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"text-sm flex items-center justify-between\">\r\n                  <span className=\"flex items-center gap-2\">\r\n                    <Activity className=\"h-4 w-4\" />\r\n                     \r\n                  </span>\r\n                  <div className=\"flex gap-2\">\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant={selectedPeriod === 'week' ? 'default' : 'outline'}\r\n                      onClick={() => setSelectedPeriod('week')}\r\n                      className=\"text-xs\"\r\n                    >\r\n                      \r\n                    </Button>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant={selectedPeriod === 'month' ? 'default' : 'outline'}\r\n                      onClick={() => setSelectedPeriod('month')}\r\n                      className=\"text-xs\"\r\n                    >\r\n                      \r\n                    </Button>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant={selectedPeriod === 'all' ? 'default' : 'outline'}\r\n                      onClick={() => setSelectedPeriod('all')}\r\n                      className=\"text-xs\"\r\n                    >\r\n                      \r\n                    </Button>\r\n                  </div>\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                {isLoading ? (\r\n                  <div className=\"flex justify-center items-center py-8\">\r\n                    <div className=\"text-center\">\r\n                      <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2\"></div>\r\n                      <p className=\"text-sm text-gray-600\">  ...</p>\r\n                    </div>\r\n                  </div>\r\n                ) : filteredTransactions.length === 0 ? (\r\n                  <div className=\"text-center py-8\">\r\n                    <Activity className=\"h-8 w-8 text-gray-400 mx-auto mb-2\" />\r\n                    <p className=\"text-gray-600\">     </p>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-2 max-h-96 overflow-y-auto\">\r\n                    {filteredTransactions.map((transaction) => (\r\n                      <div key={transaction.id} className=\"flex items-center justify-between p-3 border rounded-lg\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          {getTransactionIcon(transaction.type)}\r\n                          <div>\r\n                            <div className=\"text-sm font-medium\">\r\n                              {getTransactionTypeText(transaction.type)} - {formatNumber(transaction.amount)} \r\n                            </div>\r\n                            <div className=\"text-xs text-gray-600\">\r\n                              {formatDate(transaction.createdAt)}\r\n                            </div>\r\n                            {transaction.description && (\r\n                              <div className=\"text-xs text-gray-500 mt-1\">\r\n                                {transaction.description}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          {getStatusIcon(transaction.status)}\r\n                          <span className=\"text-xs\">{getStatusText(transaction.status)}</span>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex justify-between pt-4 border-t\">\r\n          <Button onClick={onBack} variant=\"outline\">\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n             \r\n          </Button>\r\n          <Button onClick={onClose} variant=\"outline\">\r\n            \r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default WalletDetailsPage;","import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Wallet, Plus, Edit, Trash2, Phone, DollarSign, X, Settings, Info, Star, StarOff, CreditCard, TrendingUp, TrendingDown, Save, IdCard, Eye } from 'lucide-react';\r\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { SubscriptionPlan } from '@/utils/subscriptionService';\r\nimport { merchantWalletService, transactionService } from '@/integrations/firebase/services';\r\nimport { walletSelectionPinService } from '@/utils/walletSelectionPinService';\r\nimport { walletDailyLimitsService } from '@/utils/walletDailyLimitsService';\r\nimport WalletsViewPage from './WalletsViewPage';\r\nimport WalletDetailsPage from './WalletDetailsPage';\r\n\r\ninterface Wallet {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  nationalId?: string; //   \r\n  isDefault: boolean;\r\n  monthlyWithdrawalLimit: number;\r\n  monthlyTransferLimit: number;\r\n  monthlyWithdrawalUsage?: number; //    \r\n  monthlyTransferUsage?: number; //    \r\n  dailyWithdrawalLimit: number; //    \r\n  dailyTransferLimit: number; //    \r\n  dailyWithdrawalUsage?: number; //   \r\n  dailyTransferUsage?: number; //   \r\n  lastResetDate?: string; //     \r\n  walletProvider?: string; //  \r\n}\r\n\r\ninterface WalletManagementProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onWalletUpdate?: () => void;\r\n  initialEditingWallet?: Wallet | null;\r\n}\r\n\r\n//       \r\nconst walletProviders = [\r\n  {\r\n    id: 'vodafone',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29012345678901'\r\n  },\r\n  {\r\n    id: 'etisalat',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '28506789012345'\r\n  },\r\n  {\r\n    id: 'orange',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29309876543210'\r\n  },\r\n  {\r\n    id: 'we_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29112345678901'\r\n  },\r\n  {\r\n    id: 'smart_wallet',\r\n    name: ' ',\r\n    ownerName: '   ',\r\n    nationalId: '28809876543210'\r\n  },\r\n  {\r\n    id: 'access_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29456789012345'\r\n  },\r\n  {\r\n    id: 'insta_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29012345678901'\r\n  }\r\n];\r\n\r\nconst WalletManagement: React.FC<WalletManagementProps> = ({ isOpen, onClose, onWalletUpdate, initialEditingWallet }) => {\r\n  const { toast } = useToast();\r\n  const { user, userSubscription } = useFirebaseAuth();\r\n  const isTahweelaPlan = (() => {\r\n    const raw = (userSubscription as any)?.subscription?.planType ?? (userSubscription as any)?.subscription?.plan ?? (userSubscription as any)?.planType ?? (userSubscription as any)?.plan ?? null;\r\n    const s = typeof raw === 'string' ? String(raw).trim().toLowerCase() : null;\r\n    return raw === SubscriptionPlan.TAHWEELA || s === 'tahweela' || s === '';\r\n  })();\r\n  const navigate = useNavigate();\r\n  const [wallets, setWallets] = useState<Wallet[]>([]);\r\n  const [isAddingWallet, setIsAddingWallet] = useState(false);\r\n  const [editingWallet, setEditingWallet] = useState<Wallet | null>(null);\r\n  const [walletName, setWalletName] = useState('');\r\n  const [walletPhone, setWalletPhone] = useState('');\r\n  const [walletNationalId, setWalletNationalId] = useState('');\r\n  const [walletProvider, setWalletProvider] = useState('');\r\n  const [monthlyWithdrawalLimit, setMonthlyWithdrawalLimit] = useState('200000');\r\n  const [monthlyTransferLimit, setMonthlyTransferLimit] = useState('200000');\r\n  const [dailyWithdrawalLimit, setDailyWithdrawalLimit] = useState('100000');\r\n  const [dailyTransferLimit, setDailyTransferLimit] = useState('60000');\r\n  const [isDefault, setIsDefault] = useState(false);\r\n  const [showProviderInfo, setShowProviderInfo] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [showWalletsView, setShowWalletsView] = useState(false);\r\n  const [isMasterPinDialogOpen, setIsMasterPinDialogOpen] = useState(false);\r\n  const [selectedWallet, setSelectedWallet] = useState<Wallet | null>(null);\r\n\r\n  //     localStorage  \r\n  const getWalletsKey = () => `wallets_${user?.uid || 'default'}`;\r\n\r\n  //         \r\n  useEffect(() => {\r\n    if (initialEditingWallet) {\r\n      setEditingWallet(initialEditingWallet);\r\n      setIsAddingWallet(true);\r\n      setWalletName(initialEditingWallet.name || '');\r\n      setWalletPhone(initialEditingWallet.phone || '');\r\n      setWalletNationalId(initialEditingWallet.nationalId || '');\r\n      setWalletProvider(initialEditingWallet.walletProvider || '');\r\n      setMonthlyWithdrawalLimit((initialEditingWallet.monthlyWithdrawalLimit || 200000).toString());\r\n      setMonthlyTransferLimit((initialEditingWallet.monthlyTransferLimit || 200000).toString());\r\n      setDailyWithdrawalLimit((initialEditingWallet.dailyWithdrawalLimit || 100000).toString());\r\n      setDailyTransferLimit((initialEditingWallet.dailyTransferLimit || 60000).toString());\r\n      setIsDefault(!!initialEditingWallet.isDefault);\r\n    }\r\n  }, [initialEditingWallet]);\r\n\r\n  //      \r\n  const checkAndResetMonthlyUsage = (wallet: Wallet): Wallet => {\r\n    const currentDate = new Date();\r\n    const currentMonth = currentDate.getMonth();\r\n    const currentYear = currentDate.getFullYear();\r\n    \r\n    if (!wallet.lastResetDate) {\r\n      //           \r\n      return {\r\n        ...wallet,\r\n        monthlyWithdrawalUsage: wallet.monthlyWithdrawalUsage || 0,\r\n        monthlyTransferUsage: wallet.monthlyTransferUsage || 0,\r\n        lastResetDate: currentDate.toISOString().split('T')[0]\r\n      };\r\n    }\r\n    \r\n    const lastResetDate = new Date(wallet.lastResetDate);\r\n    const lastResetMonth = lastResetDate.getMonth();\r\n    const lastResetYear = lastResetDate.getFullYear();\r\n    \r\n    //          \r\n    if (currentMonth !== lastResetMonth || currentYear !== lastResetYear) {\r\n      return {\r\n        ...wallet,\r\n        monthlyWithdrawalUsage: 0,\r\n        monthlyTransferUsage: 0,\r\n        lastResetDate: currentDate.toISOString().split('T')[0]\r\n      };\r\n    }\r\n    \r\n    return wallet;\r\n  };\r\n\r\n  //       Firebase (   )\r\n  const calculateWalletMonthlyUsage = async (walletId: string, transactions: any[]) => {\r\n    const currentMonth = new Date().getMonth();\r\n    const currentYear = new Date().getFullYear();\r\n    \r\n    const monthlyTransactions = transactions.filter((t: any) => {\r\n      const transactionDate = new Date(t.createdAt);\r\n      return (\r\n        transactionDate.getMonth() === currentMonth && \r\n        transactionDate.getFullYear() === currentYear &&\r\n        t.lineId === walletId\r\n      );\r\n    });\r\n\r\n    // \"receive\" =     \"send\" =    \r\n    const withdrawalUsage = monthlyTransactions\r\n      .filter((t: any) => t.txnType === 'receive')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    const transferUsage = monthlyTransactions\r\n      .filter((t: any) => t.txnType === 'send')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    return { withdrawalUsage, transferUsage };\r\n  };\r\n\r\n  //      (   )\r\n  const calculateWalletDailyUsage = async (walletId: string, transactions: any[]) => {\r\n    const today = new Date();\r\n    const currentDay = today.getDate();\r\n    const currentMonth = today.getMonth();\r\n    const currentYear = today.getFullYear();\r\n    \r\n    const dailyTransactions = transactions.filter((t: any) => {\r\n      const transactionDate = new Date(t.createdAt);\r\n      return (\r\n        transactionDate.getDate() === currentDay &&\r\n        transactionDate.getMonth() === currentMonth && \r\n        transactionDate.getFullYear() === currentYear &&\r\n        t.lineId === walletId\r\n      );\r\n    });\r\n\r\n    const withdrawalUsage = dailyTransactions\r\n      .filter((t: any) => t.txnType === 'receive')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    const transferUsage = dailyTransactions\r\n      .filter((t: any) => t.txnType === 'send')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    return { withdrawalUsage, transferUsage };\r\n  };\r\n\r\n  //    \r\n  const updateWalletUsage = async (walletId: string) => {\r\n    try {\r\n      //    Firebase\r\n      const transactions = await transactionService.getByUserId(user?.uid || '');\r\n      const { withdrawalUsage, transferUsage } = await calculateWalletMonthlyUsage(walletId, transactions);\r\n      \r\n      setWallets(prevWallets => \r\n        prevWallets.map(wallet => {\r\n          if (wallet.id === walletId) {\r\n            const updatedWallet = checkAndResetMonthlyUsage(wallet);\r\n            return {\r\n              ...updatedWallet,\r\n              monthlyWithdrawalUsage: withdrawalUsage,\r\n              monthlyTransferUsage: transferUsage\r\n            };\r\n          }\r\n          return checkAndResetMonthlyUsage(wallet);\r\n        })\r\n      );\r\n    } catch (error) {\r\n      console.error('Error updating wallet usage:', error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Load wallets from Firebase for the current user\r\n    const loadWallets = async () => {\r\n      //      \r\n      if (!user?.uid) {\r\n        console.log('No user authenticated, skipping wallet loading');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      \r\n      console.log('Loading wallets for user:', user.uid);\r\n      setIsLoading(true);\r\n      \r\n      try {\r\n        //         \r\n        const { auth } = await import('@/firebase');\r\n        \r\n        //       \r\n        let retryCount = 0;\r\n        const maxRetries = 5;\r\n        \r\n        while (!auth.currentUser && retryCount < maxRetries) {\r\n          console.log(`Waiting for auth state... attempt ${retryCount + 1}`);\r\n          await new Promise(resolve => setTimeout(resolve, 1000));\r\n          retryCount++;\r\n        }\r\n        \r\n        if (!auth.currentUser) {\r\n          console.error('User not authenticated in Firebase Auth after retries');\r\n          throw new Error('not authenticated');\r\n        }\r\n        \r\n        console.log('Firebase Auth User:', auth.currentUser.uid);\r\n        console.log('Context User:', user.uid);\r\n        \r\n        console.log('Fetching wallets from Firebase...');\r\n        const firebaseWallets = await merchantWalletService.getByMerchantId(user.uid);\r\n        console.log('Fetched wallets:', firebaseWallets);\r\n        \r\n        console.log('Fetching transactions from Firebase...');\r\n        const transactions = await transactionService.getByUserId(user.uid);\r\n        console.log('Fetched transactions:', transactions);\r\n        \r\n        const formattedWallets = await Promise.all(firebaseWallets.map(async w => {\r\n          const { withdrawalUsage, transferUsage } = await calculateWalletMonthlyUsage(w.id, transactions);\r\n          const { withdrawalUsage: dailyWithdrawalUsage, transferUsage: dailyTransferUsage } = await calculateWalletDailyUsage(w.id, transactions);\r\n          \r\n          return {\r\n            id: w.id,\r\n            name: w.label || '  ',\r\n            phone: w.msisdn,\r\n            isDefault: false, //     \r\n            monthlyWithdrawalLimit: w.withdrawLimit || 200000,\r\n            monthlyTransferLimit: w.transferLimit || 200000,\r\n            dailyWithdrawalLimit: (w as any).dailyWithdrawLimit || 100000, //    \r\n            dailyTransferLimit: (w as any).dailyTransferLimit || 60000, //    \r\n            monthlyWithdrawalUsage: withdrawalUsage,\r\n            monthlyTransferUsage: transferUsage,\r\n            dailyWithdrawalUsage: dailyWithdrawalUsage,\r\n            dailyTransferUsage: dailyTransferUsage,\r\n            lastResetDate: new Date().toISOString().split('T')[0],\r\n            //         Firebase\r\n            defaultTransferCommission: (w.defaultTransferCommission != null ? Number(w.defaultTransferCommission) : null),\r\n            defaultWithdrawCommission: (w.defaultWithdrawCommission != null ? Number(w.defaultWithdrawCommission) : null)\r\n          };\r\n        }));\r\n        \r\n        //       \r\n        const walletsWithResetCheck = formattedWallets.map(checkAndResetMonthlyUsage);\r\n        setWallets(walletsWithResetCheck);\r\n        console.log('Wallets loaded successfully:', walletsWithResetCheck);\r\n        \r\n      } catch (error) {\r\n        console.error('Error loading wallets:', error);\r\n        //             \r\n        setWallets([]);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    loadWallets();\r\n  }, [user?.uid]);\r\n\r\n  const resetForm = () => {\r\n    setWalletName('');\r\n    setWalletPhone('');\r\n    setWalletNationalId('');\r\n    setWalletProvider('');\r\n    setMonthlyWithdrawalLimit('200000');\r\n    setMonthlyTransferLimit('200000');\r\n    setDailyWithdrawalLimit('100000');\r\n    setDailyTransferLimit('60000');\r\n    setIsDefault(false);\r\n    setEditingWallet(null);\r\n    setIsAddingWallet(false);\r\n  };\r\n\r\n  const startEdit = (wallet: Wallet) => {\r\n    setWalletName(wallet.name);\r\n    setWalletPhone(wallet.phone);\r\n    setMonthlyWithdrawalLimit(wallet.monthlyWithdrawalLimit.toString());\r\n    setMonthlyTransferLimit(wallet.monthlyTransferLimit.toString());\r\n    setDailyWithdrawalLimit(wallet.dailyWithdrawalLimit.toString());\r\n    setDailyTransferLimit(wallet.dailyTransferLimit.toString());\r\n    setIsDefault(wallet.isDefault);\r\n    setEditingWallet(wallet);\r\n    setIsAddingWallet(true);\r\n  };\r\n\r\n  const saveWallet = async () => {\r\n    if (!walletName.trim() || !walletPhone.trim() || !walletProvider.trim()) {\r\n      toast({\r\n        title: \"\",\r\n        description: \"    \",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!user?.uid) {\r\n      toast({\r\n        title: \"\",\r\n        description: \"   \",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      if (editingWallet) {\r\n        // Update existing wallet in Firebase\r\n        await merchantWalletService.update(editingWallet.id, {\r\n          label: walletName.trim(),\r\n          msisdn: walletPhone.trim(),\r\n          withdrawLimit: parseInt(monthlyWithdrawalLimit),\r\n          transferLimit: parseInt(monthlyTransferLimit),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit),\r\n          dailyTransferLimit: parseInt(dailyTransferLimit)\r\n        });\r\n\r\n        // Sync limits to walletLimits collection for enforcement\r\n        await walletDailyLimitsService.setLimits(editingWallet.id, {\r\n          dailyTransferLimit: parseInt(dailyTransferLimit || '0'),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit || '0'),\r\n          monthlyTransferLimit: parseInt(monthlyTransferLimit || '0'),\r\n          monthlyWithdrawLimit: parseInt(monthlyWithdrawalLimit || '0')\r\n        });\r\n\r\n        // Update existing wallet in local state\r\n        const updatedWallets = wallets.map(w => \r\n          w.id === editingWallet.id \r\n            ? { \r\n                ...w, \r\n                name: walletName.trim(), \r\n                phone: walletPhone.trim(),\r\n                nationalId: walletNationalId.trim(),\r\n                walletProvider: walletProvider,\r\n                monthlyWithdrawalLimit: parseInt(monthlyWithdrawalLimit),\r\n                monthlyTransferLimit: parseInt(monthlyTransferLimit),\r\n                dailyWithdrawalLimit: parseInt(dailyWithdrawalLimit),\r\n                dailyTransferLimit: parseInt(dailyTransferLimit)\r\n              }\r\n            : w\r\n        );\r\n        \r\n        setWallets(updatedWallets);\r\n        \r\n        // Also save to localStorage for backward compatibility\r\n        localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n        \r\n        toast({\r\n          title: \" \",\r\n          description: \"   \",\r\n        });\r\n\r\n      } else {\r\n        // Create new wallet in Firebase\r\n        const newWalletData = {\r\n          merchantUserId: user.uid,\r\n          provider: walletProvider as const,\r\n          msisdn: walletPhone.trim(),\r\n          label: walletName.trim(),\r\n          isActive: true,\r\n          dailyLimit: 200000,\r\n          monthlyLimit: 200000,\r\n          withdrawLimit: parseInt(monthlyWithdrawalLimit),\r\n          transferLimit: parseInt(monthlyTransferLimit),\r\n          dailyTransferLimit: parseInt(dailyTransferLimit),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit),\r\n          dailyUsage: 0,\r\n          monthlyUsage: 0,\r\n          transferUsage: 0,\r\n          withdrawUsage: 0\r\n        };\r\n\r\n        const newWalletId = await merchantWalletService.create(newWalletData);\r\n        \r\n        // Sync limits to walletLimits collection for enforcement\r\n        await walletDailyLimitsService.setLimits(newWalletId, {\r\n          dailyTransferLimit: parseInt(dailyTransferLimit || '0'),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit || '0'),\r\n          monthlyTransferLimit: parseInt(monthlyTransferLimit || '0'),\r\n          monthlyWithdrawLimit: parseInt(monthlyWithdrawalLimit || '0')\r\n        });\r\n        \r\n        // Add to local state with reset usage counters\r\n        const currentDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format\r\n        const walletToAdd = {\r\n          id: newWalletId,\r\n          name: walletName.trim(),\r\n          phone: walletPhone.trim(),\r\n          nationalId: walletNationalId.trim(),\r\n          walletProvider: walletProvider,\r\n          isDefault: isDefault,\r\n          monthlyWithdrawalLimit: parseInt(monthlyWithdrawalLimit),\r\n          monthlyTransferLimit: parseInt(monthlyTransferLimit),\r\n          dailyWithdrawalLimit: parseInt(dailyWithdrawalLimit),\r\n          dailyTransferLimit: parseInt(dailyTransferLimit),\r\n          monthlyWithdrawalUsage: 0, //     \r\n          monthlyTransferUsage: 0, //     \r\n          dailyWithdrawalUsage: 0, //     \r\n          dailyTransferUsage: 0, //     \r\n          lastResetDate: currentDate, //   \r\n          //  :      \r\n          defaultTransferCommission: null,\r\n          defaultWithdrawCommission: null\r\n        };\r\n        \r\n        const newWallets = [...wallets, walletToAdd];\r\n        setWallets(newWallets);\r\n        \r\n        // Also save to localStorage for backward compatibility\r\n        localStorage.setItem(getWalletsKey(), JSON.stringify(newWallets));\r\n        \r\n        toast({\r\n          title: \" \",\r\n          description: \"   \",\r\n        });\r\n      }\r\n      \r\n      if (onWalletUpdate) {\r\n        onWalletUpdate();\r\n      }\r\n\r\n      resetForm();\r\n      setIsAddingWallet(false);\r\n      setEditingWallet(null);\r\n    } catch (error) {\r\n      console.error('Error saving wallet:', error);\r\n      toast({\r\n        title: \"\",\r\n        description: \"    \",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleEditWallet = (wallet: Wallet) => {\r\n    setEditingWallet(wallet);\r\n    setWalletName(wallet.name);\r\n    setWalletPhone(wallet.phone);\r\n    setWalletNationalId(wallet.nationalId || '');\r\n    setWalletProvider(wallet.walletProvider || '');\r\n    setMonthlyWithdrawalLimit(wallet.monthlyWithdrawalLimit.toString());\r\n    setMonthlyTransferLimit(wallet.monthlyTransferLimit.toString());\r\n    setIsDefault(wallet.isDefault);\r\n    setIsAddingWallet(true);\r\n  };\r\n\r\n  const handleUpdateWallet = () => {\r\n    if (!editingWallet || !walletName || !walletPhone) {\r\n      toast({\r\n        title: \"\",\r\n        description: \"    \",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    const updatedWallets = wallets.map(w => \r\n      w.id === editingWallet.id \r\n        ? { ...w, name: walletName, phone: walletPhone, monthlyWithdrawalLimit: parseInt(monthlyWithdrawalLimit), monthlyTransferLimit: parseInt(monthlyTransferLimit) }\r\n        : w\r\n    );\r\n\r\n    setWallets(updatedWallets);\r\n    localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n    setEditingWallet(null);\r\n    resetForm();\r\n\r\n    // Call the update callback if provided\r\n    if (onWalletUpdate) {\r\n      onWalletUpdate();\r\n    }\r\n\r\n    toast({\r\n      title: \"  \",\r\n      description: \"    \",\r\n    });\r\n  };\r\n\r\n  const handleDeleteWallet = async (walletId: string) => {\r\n    const walletToDelete = wallets.find(w => w.id === walletId);\r\n    \r\n    if (walletToDelete?.isDefault) {\r\n      toast({\r\n        title: \"\",\r\n        description: \"    \",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!user?.uid) {\r\n      toast({\r\n        title: \"\",\r\n        description: \"   \",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      // Delete from Firebase\r\n      await merchantWalletService.delete(walletId);\r\n      \r\n      // Update local state\r\n      const updatedWallets = wallets.filter(w => w.id !== walletId);\r\n      setWallets(updatedWallets);\r\n      \r\n      // Also update localStorage for backward compatibility\r\n      localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n      \r\n      if (onWalletUpdate) {\r\n        onWalletUpdate();\r\n      }\r\n\r\n      toast({\r\n        title: \" \",\r\n        description: \"   \",\r\n      });\r\n    } catch (error) {\r\n      console.error('Error deleting wallet:', error);\r\n      toast({\r\n        title: \"\",\r\n        description: \"    \",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSetDefault = (walletId: string) => {\r\n    const updatedWallets = wallets.map(w => ({\r\n      ...w,\r\n      isDefault: w.id === walletId\r\n    }));\r\n\r\n    setWallets(updatedWallets);\r\n    localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n    \r\n    // Call the update callback if provided\r\n    if (onWalletUpdate) {\r\n      onWalletUpdate();\r\n    }\r\n\r\n    toast({\r\n      title: \"   \",\r\n      description: \"    \",\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\r\n        <DialogHeader className=\"pb-2\">\r\n          <DialogTitle className=\"flex items-center gap-1 text-sm\">\r\n            <Wallet className=\"h-3 w-3\" />\r\n             \r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-2\">\r\n          {/* Add New Wallet Button */}\r\n          <div className=\"flex justify-between items-center\">\r\n            <h3 className=\"text-sm font-semibold\">  ({wallets.length})</h3>\r\n            <div className=\"flex gap-2\">\r\n              <Button\r\n                onClick={() => {\r\n                  //         \r\n                  setIsMasterPinDialogOpen(true);\r\n                }}\r\n                className=\"flex items-center gap-1 h-6 px-2 text-xs\"\r\n                size=\"sm\"\r\n                variant=\"outline\"\r\n              >\r\n                <Eye className=\"h-3 w-3\" />\r\n                  \r\n              </Button>\r\n              <Button\r\n                onClick={() => {\r\n                  onClose();\r\n                  navigate('/user/add-wallet');\r\n                }}\r\n                className=\"flex items-center gap-1 h-6 px-2 text-xs\"\r\n                size=\"sm\"\r\n              >\r\n                <Plus className=\"h-3 w-3\" />\r\n                  \r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Add/Edit Wallet Form */}\r\n          {(isAddingWallet || editingWallet) && (\r\n            <Card className=\"border-2 border-blue-200 bg-blue-50\">\r\n              <CardHeader className=\"pb-1\">\r\n                <CardTitle className=\"text-sm\">\r\n                  {editingWallet ? ' ' : '  '}\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-2 pt-1\">\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                     \r\n                  </label>\r\n                  <div className=\"flex gap-1 items-center\">\r\n                    <Select value={walletProvider} onValueChange={setWalletProvider}>\r\n                      <SelectTrigger className=\"h-6 text-xs flex-1\">\r\n                        <SelectValue placeholder=\"  \" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {walletProviders.map((provider) => (\r\n                          <SelectItem key={provider.id} value={provider.id} className=\"text-xs\">\r\n                            <div className=\"flex items-center justify-between w-full\">\r\n                              <span>{provider.name}</span>\r\n                              <button\r\n                                type=\"button\"\r\n                                className=\"h-4 w-4 p-0 ml-2 flex items-center justify-center hover:bg-blue-100 rounded\"\r\n                                onClick={(e) => {\r\n                                  e.preventDefault();\r\n                                  e.stopPropagation();\r\n                                  setShowProviderInfo(provider.id);\r\n                                }}\r\n                              >\r\n                                <Info className=\"h-3 w-3 text-blue-500 hover:text-blue-700\" />\r\n                              </button>\r\n                            </div>\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                     \r\n                  </label>\r\n                  <Input\r\n                    value={walletName}\r\n                    onChange={(e) => setWalletName(e.target.value)}\r\n                    placeholder=\":  \"\r\n                    className=\"h-6 text-xs\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                     \r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <Phone className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                    <Input\r\n                      value={walletPhone}\r\n                      onChange={(e) => setWalletPhone(e.target.value)}\r\n                      placeholder=\"01030302038\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                      \r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <IdCard className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                    <Input\r\n                      value={walletNationalId}\r\n                      onChange={(e) => setWalletNationalId(e.target.value)}\r\n                      placeholder=\"29012345678901\"\r\n                      maxLength={14}\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                       ()\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <DollarSign className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={monthlyWithdrawalLimit}\r\n                      onChange={(e) => setMonthlyWithdrawalLimit(e.target.value)}\r\n                      placeholder=\"200000\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                       ()\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <DollarSign className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={monthlyTransferLimit}\r\n                      onChange={(e) => setMonthlyTransferLimit(e.target.value)}\r\n                      placeholder=\"200000\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                       ()\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <TrendingDown className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-red-400\" />\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={dailyWithdrawalLimit}\r\n                      onChange={(e) => setDailyWithdrawalLimit(e.target.value)}\r\n                      placeholder=\"100000\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                       ()\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <TrendingUp className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-blue-400\" />\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={dailyTransferLimit}\r\n                      onChange={(e) => setDailyTransferLimit(e.target.value)}\r\n                      placeholder=\"60000\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id=\"isDefault\"\r\n                    checked={isDefault}\r\n                    onChange={(e) => setIsDefault(e.target.checked)}\r\n                    className=\"rounded w-3 h-3\"\r\n                  />\r\n                  <label htmlFor=\"isDefault\" className=\"text-xs font-medium text-gray-700\">\r\n                      \r\n                  </label>\r\n                </div>\r\n\r\n                {/* Commission Settings Section */}\r\n                <div className=\"border-t pt-2 mt-2\">\r\n                  <div className=\"flex items-center gap-1 mb-2\">\r\n                    <Settings className=\"h-3 w-3 text-gray-600\" />\r\n                    <label className=\"text-xs font-medium text-gray-700\">\r\n                       \r\n                    </label>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex gap-1\">\r\n                  <Button\r\n                    onClick={saveWallet}\r\n                    className=\"flex-1 h-6 text-xs\"\r\n                    size=\"sm\"\r\n                  >\r\n                    {editingWallet ? ' ' : ' '}\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    onClick={resetForm}\r\n                    className=\"h-6 text-xs\"\r\n                    size=\"sm\"\r\n                  >\r\n                    \r\n                  </Button>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n\r\n          {/* Wallets List */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\r\n            {wallets.map((wallet) => (\r\n              <Card key={wallet.id} className={`${wallet.isDefault ? 'border-green-300 bg-green-50' : ''}`}>\r\n                <CardHeader className=\"pb-1\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <CardTitle className=\"text-sm flex items-center gap-1\">\r\n                      <Wallet className=\"h-3 w-3\" />\r\n                      {wallet.name}\r\n                    </CardTitle>\r\n                    {wallet.isDefault && (\r\n                      <Badge variant=\"default\" className=\"bg-green-600 text-xs px-1 py-0\">\r\n                        \r\n                      </Badge>\r\n                    )}\r\n                  </div>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-1 pt-0\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <Phone className=\"h-3 w-3 text-gray-500\" />\r\n                    <span className=\"text-xs\">{wallet.phone}</span>\r\n                  </div>\r\n                  {wallet.walletProvider && (\r\n                    <div className=\"text-xs text-blue-600 mt-1\">\r\n                      {walletProviders.find(p => p.id === wallet.walletProvider)?.name || wallet.walletProvider}\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/*        */}\r\n                  <div className=\"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2\">\r\n                    {/*   */}\r\n                    <div>\r\n                      <div className=\"text-xs font-medium text-gray-600 mb-1\"> </div>\r\n                      <div className=\"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex\">\r\n                        {/*   */}\r\n                        <div className=\"w-1/2 bg-red-200 relative\">\r\n                          <div \r\n                            className=\"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                            style={{ \r\n                              width: `${Math.min(((wallet.monthlyWithdrawalUsage || 0) / wallet.monthlyWithdrawalLimit) * 100, 100)}%` \r\n                            }}\r\n                          ></div>\r\n                        </div>\r\n                        {/*   */}\r\n                        <div className=\"w-1/2 bg-blue-200 relative\">\r\n                          <div \r\n                            className=\"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                            style={{ \r\n                              width: `${Math.min(((wallet.monthlyTransferUsage || 0) / wallet.monthlyTransferLimit) * 100, 100)}%` \r\n                            }}\r\n                          ></div>\r\n                        </div>\r\n                      </div>\r\n                      \r\n                      {/*     */}\r\n                      <div className=\"flex justify-between items-center mt-0.5\">\r\n                        <div className=\"text-xs text-red-600 font-medium\">\r\n                           : {Math.max(wallet.monthlyWithdrawalLimit - (wallet.monthlyWithdrawalUsage || 0), 0)} \r\n                        </div>\r\n                        <div className=\"text-xs text-blue-600 font-medium\">\r\n                           : {Math.max(wallet.monthlyTransferLimit - (wallet.monthlyTransferUsage || 0), 0)} \r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/*   */}\r\n                    {(\r\n                      <div>\r\n                        <div className=\"text-xs font-medium text-gray-600 mb-1\"> </div>\r\n                        <div className=\"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex\">\r\n                          {/*    */}\r\n                          <div className=\"w-1/2 bg-orange-200 relative\">\r\n                            <div \r\n                              className=\"bg-gradient-to-r from-orange-400 to-orange-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                              style={{ \r\n                                width: `${Math.min(((wallet.dailyWithdrawalUsage || 0) / wallet.dailyWithdrawalLimit) * 100, 100)}%` \r\n                              }}\r\n                            ></div>\r\n                          </div>\r\n                          {/*    */}\r\n                          <div className=\"w-1/2 bg-green-200 relative\">\r\n                            <div \r\n                              className=\"bg-gradient-to-r from-green-400 to-green-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                              style={{ \r\n                                width: `${Math.min(((wallet.dailyTransferUsage || 0) / wallet.dailyTransferLimit) * 100, 100)}%` \r\n                              }}\r\n                            ></div>\r\n                          </div>\r\n                        </div>\r\n                        \r\n                        {/*     */}\r\n                        <div className=\"flex justify  items-center mt-0.5\">\r\n                          <div className=\"text-xs text-orange-600 font-medium\">\r\n                              : {Math.max(wallet.dailyWithdrawalLimit - (wallet.dailyWithdrawalUsage || 0), 0)} \r\n                          </div>\r\n                          <div className=\"text-xs text-green-600 font-medium\">\r\n                              : {Math.max(wallet.dailyTransferLimit - (wallet.dailyTransferUsage || 0), 0)} \r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div className=\"flex gap-1 pt-1\">\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"outline\"\r\n                      onClick={() => handleEditWallet(wallet)}\r\n                      className=\"flex-1 h-5 text-xs px-1\"\r\n                    >\r\n                      <Edit className=\"h-2 w-2 mr-0.5\" />\r\n                      \r\n                    </Button>\r\n                    \r\n                    {!wallet.isDefault && (\r\n                      <>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"outline\"\r\n                          onClick={() => handleSetDefault(wallet.id)}\r\n                          className=\"flex-1 h-5 text-xs px-1\"\r\n                        >\r\n                           \r\n                        </Button>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"destructive\"\r\n                          onClick={() => handleDeleteWallet(wallet.id)}\r\n                          className=\"h-5 px-1\"\r\n                        >\r\n                          <Trash2 className=\"h-2 w-2\" />\r\n                        </Button>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n\r\n          {wallets.length === 0 && (\r\n            <div className=\"text-center py-4 text-gray-500 text-xs\">\r\n                 .     .\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/*     */}\r\n      {showProviderInfo && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl\">\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n              <h3 className=\"text-lg font-bold text-gray-800\">  </h3>\r\n              <button\r\n                onClick={() => setShowProviderInfo(null)}\r\n                className=\"h-8 w-8 p-0 flex items-center justify-center hover:bg-gray-100 rounded-full transition-colors\"\r\n              >\r\n                <X className=\"h-4 w-4 text-gray-500\" />\r\n              </button>\r\n            </div>\r\n            \r\n            {(() => {\r\n              const provider = walletProviders.find(p => p.id === showProviderInfo);\r\n              return provider ? (\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"text-center mb-6\">\r\n                    <div className=\"bg-blue-100 p-3 rounded-lg inline-block\">\r\n                      <h4 className=\"font-bold text-blue-700 text-lg\">{provider.name}</h4>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200\">\r\n                    <div className=\"space-y-4\">\r\n                      <div className=\"bg-white p-3 rounded-lg shadow-sm\">\r\n                        <div className=\"flex items-center mb-2\">\r\n                          <div className=\"w-2 h-2 bg-blue-500 rounded-full mr-2\"></div>\r\n                          <span className=\"font-semibold text-gray-700\">  :</span>\r\n                        </div>\r\n                        <p className=\"text-gray-900 font-medium text-lg mr-4\">{provider.ownerName}</p>\r\n                      </div>\r\n                      \r\n                      <div className=\"bg-white p-3 rounded-lg shadow-sm\">\r\n                        <div className=\"flex items-center mb-2\">\r\n                          <div className=\"w-2 h-2 bg-green-500 rounded-full mr-2\"></div>\r\n                          <span className=\"font-semibold text-gray-700\"> :</span>\r\n                        </div>\r\n                        <p className=\"text-gray-900 font-mono text-lg mr-4 tracking-wider\">{provider.nationalId}</p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"bg-yellow-50 border border-yellow-200 p-3 rounded-lg\">\r\n                    <div className=\"flex items-center\">\r\n                      <Info className=\"h-4 w-4 text-yellow-600 mr-2\" />\r\n                      <span className=\"text-sm text-yellow-800 font-medium\">\r\n                               \r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ) : null;\r\n            })()}\r\n          </div>\r\n        </div>\r\n      )}\r\n      </DialogContent>\r\n\r\n      {/*        */}\r\n      <MasterPinDialog\r\n        open={isMasterPinDialogOpen}\r\n        onOpenChange={setIsMasterPinDialogOpen}\r\n        mode=\"verify\"\r\n        title=\"   \"\r\n        description=\"         \"\r\n        onSuccess={() => {\r\n          setIsMasterPinDialogOpen(false);\r\n          setShowWalletsView(true);\r\n        }}\r\n      />\r\n\r\n      {/*    */}\r\n      <WalletsViewPage\r\n        isOpen={showWalletsView}\r\n        onClose={() => setShowWalletsView(false)}\r\n        onWalletSelect={(wallet) => {\r\n          setSelectedWallet(wallet);\r\n          setShowWalletsView(false);\r\n        }}\r\n        onEditWallet={(wallet) => {\r\n          //           \r\n          navigate(`/user/add-wallet?edit=1&id=${wallet.id}`);\r\n          setShowWalletsView(false);\r\n        }}\r\n        onDeleteWallet={async (walletId) => {\r\n          //    \r\n          try {\r\n            await merchantWalletService.delete(walletId);\r\n            //      localStorage     \r\n            setWallets(prev => {\r\n              const updated = prev.filter(w => w.id !== walletId);\r\n              try {\r\n                localStorage.setItem(getWalletsKey(), JSON.stringify(updated));\r\n              } catch (e) {\r\n                console.error('Failed to update localStorage wallets after delete:', e);\r\n              }\r\n              return updated;\r\n            });\r\n\r\n            //  /    (   )\r\n            if (onWalletUpdate) {\r\n              try {\r\n                await onWalletUpdate();\r\n              } catch (e) {\r\n                console.error('onWalletUpdate callback failed:', e);\r\n              }\r\n            }\r\n          } catch (err) {\r\n            console.error('Error deleting wallet:', err);\r\n          }\r\n        }}\r\n      />\r\n\r\n      {/*    */}\r\n      <WalletDetailsPage\r\n        wallet={selectedWallet}\r\n        isOpen={!!selectedWallet}\r\n        onClose={() => setSelectedWallet(null)}\r\n        onBack={() => {\r\n          setSelectedWallet(null);\r\n          setShowWalletsView(true);\r\n        }}\r\n      />\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default WalletManagement;\r\n","import React from 'react';\r\nimport { formatNumberEnglish } from '@/utils/formatters';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Card, CardContent, CardHeader } from '@/components/ui/card';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { CheckCircle, Clock, XCircle, Phone, DollarSign, Calendar, Trash2, Printer, ArrowDownLeft, ArrowUpDown, Receipt, Store, User, CreditCard, ArrowRight } from 'lucide-react';\r\n\r\ninterface Transaction {\r\n  id: string;\r\n  type: 'send' | 'receive' | 'withdraw';\r\n  senderPhone: string;\r\n  receiverPhone: string;\r\n  amount: number;\r\n  status: 'pending' | 'completed' | 'failed';\r\n  createdAt: Date;\r\n  withdrawnAmount?: number; //  \r\n  sentAmount?: number; //  \r\n  fromWallet?: string; //   \r\n  //    \r\n  senderNumber?: string; //  \r\n  senderName?: string; //    \r\n  shopName?: string; //  \r\n  transferredAmount?: number; //  \r\n  receiverNumber?: string; //  \r\n  withdrawnAmountDetailed?: number; //   \r\n  merchantShopName?: string; //        \r\n  transactionReference?: string; //  \r\n  commission?: number; // \r\n  fee?: number; //   \r\n  notes?: string; //  \r\n}\r\n\r\ninterface TransactionDetailsModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  transaction: Transaction | null;\r\n  onDelete: (transactionId: string) => void;\r\n}\r\n\r\nconst TransactionDetailsModal: React.FC<TransactionDetailsModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  transaction,\r\n  onDelete\r\n}) => {\r\n  if (!transaction) return null;\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return <CheckCircle className=\"h-5 w-5 text-green-500\" />;\r\n      case 'pending':\r\n        return <Clock className=\"h-5 w-5 text-yellow-500\" />;\r\n      case 'failed':\r\n        return <XCircle className=\"h-5 w-5 text-red-500\" />;\r\n      default:\r\n        return <Clock className=\"h-5 w-5 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  const getStatusText = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return '';\r\n      case 'pending':\r\n        return ' ';\r\n      case 'failed':\r\n        return '';\r\n      default:\r\n        return ' ';\r\n    }\r\n  };\r\n\r\n  const getTransactionTypeText = (type: string) => {\r\n    switch (type) {\r\n      case 'withdraw':\r\n        return '';\r\n      case 'send':\r\n        return '';\r\n      case 'receive':\r\n        return '';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  const getTransactionIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'withdraw':\r\n        return <ArrowDownLeft className=\"h-5 w-5 text-green-500\" />;\r\n      default:\r\n        return <ArrowUpDown className=\"h-5 w-5 text-blue-500\" />;\r\n    }\r\n  };\r\n\r\n  const handlePrint = () => {\r\n    const hasSenderNumber = !!transaction.senderNumber;\r\n    const hasSenderName = !!transaction.senderName;\r\n    const senderLabel = hasSenderNumber\r\n      ? ' :'\r\n      : hasSenderName\r\n      ? ' :'\r\n      : ' :';\r\n    const senderValue = hasSenderNumber\r\n      ? transaction.senderNumber\r\n      : hasSenderName\r\n      ? transaction.senderName\r\n      : transaction.senderPhone;\r\n\r\n    const printContent = `\r\n      <div style=\"font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 500px; margin: 0 auto; padding: 30px; background: #fff;\">\r\n        <!-- Header -->\r\n        <div style=\"text-align: center; margin-bottom: 30px; border-bottom: 2px solid #2563eb; padding-bottom: 20px;\">\r\n          <h1 style=\"color: #2563eb; margin-bottom: 5px; font-size: 28px;\"> </h1>\r\n          <p style=\"color: #666; font-size: 16px; margin: 0;\"> : ${transaction.transactionReference || transaction.id}</p>\r\n          <p style=\"color: #888; font-size: 14px; margin: 5px 0 0 0;\">${new Date().toLocaleString('ar-EG')}</p>\r\n        </div>\r\n        \r\n        <!-- Shop Info -->\r\n        <div style=\"background: #f8fafc; border-radius: 12px; padding: 20px; margin-bottom: 20px;\">\r\n          <h3 style=\"color: #1e293b; margin: 0 0 15px 0; font-size: 18px;\"> </h3>\r\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 8px;\">\r\n            <span style=\"font-weight: 600; color: #475569;\"> :</span>\r\n            <span style=\"color: #1e293b;\">${transaction.merchantShopName || transaction.shopName || ' '}</span>\r\n          </div>\r\n        </div>\r\n        \r\n        <!-- Transaction Details -->\r\n        <div style=\"background: #fff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; margin-bottom: 20px;\">\r\n          <h3 style=\"color: #1e293b; margin: 0 0 15px 0; font-size: 18px;\"> </h3>\r\n          \r\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n            <span style=\"font-weight: 600; color: #475569;\"> :</span>\r\n            <span style=\"color: #2563eb; font-weight: 600;\">${getTransactionTypeText(transaction.type)}</span>\r\n          </div>\r\n          \r\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n            <span style=\"font-weight: 600; color: #475569;\">:</span>\r\n            <span style=\"color: ${transaction.status === 'completed' ? '#16a34a' : transaction.status === 'pending' ? '#ca8a04' : '#dc2626'}; font-weight: 600;\">\r\n              ${getStatusText(transaction.status)}\r\n            </span>\r\n          </div>\r\n\r\n          ${(transaction as any)?.cashierName ? `\r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\">:</span>\r\n              <span style=\"color: #1e293b;\">${(transaction as any).cashierName}</span>\r\n            </div>\r\n          ` : ''}\r\n          \r\n          ${transaction.type !== 'withdraw' ? `\r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\">${senderLabel}</span>\r\n              <span style=\"color: #1e293b;\">${senderValue}</span>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\"> :</span>\r\n              <span style=\"color: #1e293b;\">${transaction.receiverNumber || transaction.receiverPhone}</span>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\"> :</span>\r\n              <span style=\"color: #2563eb; font-weight: bold; font-size: 16px;\">${formatNumberEnglish(transaction.transferredAmount || transaction.amount)} </span>\r\n            </div>\r\n          ` : `\r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\"> :</span>\r\n              <span style=\"color: #1e293b;\">${transaction.senderPhone}</span>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\"> :</span>\r\n              <span style=\"color: #dc2626; font-weight: bold; font-size: 16px;\">${formatNumberEnglish(transaction.withdrawnAmountDetailed || transaction.withdrawnAmount || transaction.amount)} </span>\r\n            </div>\r\n          `}\r\n          \r\n          ${transaction.commission ? `\r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\">:</span>\r\n              <span style=\"color: #f59e0b; font-weight: 600;\">${formatNumberEnglish(transaction.commission || 0)} </span>\r\n            </div>\r\n          ` : ''}\r\n          ${transaction.commission ? `\r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\">:</span>\r\n              <span style=\"color: #16a34a; font-weight: 600;\">${formatNumberEnglish(transaction.commission || 0)} </span>\r\n            </div>\r\n          ` : ''}\r\n          ${((transaction as any)?.fee && Number((transaction as any).fee) > 0) ? `\r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\">:</span>\r\n              <span style=\"color: #64748b; font-weight: 600;\">${formatNumberEnglish((transaction as any).fee || 0)} </span>\r\n            </div>\r\n          ` : ''}\r\n          \r\n          <div style=\"display: flex; justify-content: space-between; padding: 8px 0;\">\r\n            <span style=\"font-weight: 600; color: #475569;\"> :</span>\r\n            <span style=\"color: #1e293b;\">${transaction.createdAt.toLocaleString('ar-EG')}</span>\r\n          </div>\r\n        </div>\r\n        \r\n        <!-- Total Amount -->\r\n        <div style=\"background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); border-radius: 12px; padding: 20px; margin-bottom: 20px; text-align: center;\">\r\n          <h3 style=\"color: white; margin: 0 0 10px 0; font-size: 16px;\"> </h3>\r\n          <p style=\"color: white; font-size: 24px; font-weight: bold; margin: 0;\">\r\n            ${transaction.type === 'withdraw' ? '-' : ''}${formatNumberEnglish(transaction.amount)} \r\n          </p>\r\n        </div>\r\n        \r\n        \r\n        \r\n        \r\n        <!-- Footer -->\r\n        <div style=\"text-align: center; color: #64748b; font-size: 12px; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;\">\r\n          <p style=\"margin: 0 0 5px 0;\">  </p>\r\n          <p style=\"margin: 0;\">   : ${new Date().toLocaleString('ar-EG')}</p>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    const printWindow = window.open('', '_blank');\r\n    if (printWindow) {\r\n      printWindow.document.write(`\r\n        <html>\r\n          <head>\r\n            <title>  - ${transaction.transactionReference || transaction.id}</title>\r\n            <meta charset=\"UTF-8\">\r\n            <style>\r\n              body { \r\n                margin: 0; \r\n                padding: 20px; \r\n                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n                background: #f8fafc;\r\n              }\r\n              @media print {\r\n                body { \r\n                  margin: 0; \r\n                  background: white;\r\n                }\r\n              }\r\n            </style>\r\n          </head>\r\n          <body>\r\n            ${printContent}\r\n          </body>\r\n        </html>\r\n      `);\r\n      printWindow.document.close();\r\n      printWindow.print();\r\n    }\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    if (window.confirm('            .')) {\r\n      onDelete(transaction.id);\r\n      onClose(); //    \r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"w-[92vw] sm:w-auto sm:max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-xl\">\r\n            <Receipt className=\"h-6 w-6 text-blue-600\" />\r\n              \r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-6\">\r\n          {/* Header Section */}\r\n          <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200\">\r\n            <CardHeader className=\"text-center pb-2\">\r\n              <div className=\"flex items-center justify-center gap-2 mb-2\">\r\n                {getStatusIcon(transaction.status)}\r\n                <Badge \r\n                  variant={transaction.status === 'completed' ? 'default' : 'secondary'}\r\n                  className=\"text-sm\"\r\n                >\r\n                  {getStatusText(transaction.status)}\r\n                </Badge>\r\n              </div>\r\n              <h3 className=\"text-2xl font-bold text-blue-600\">\r\n                {transaction.type === 'withdraw' ? '-' : ''}{formatNumberEnglish(transaction.amount)} \r\n              </h3>\r\n              <p className=\"text-sm text-gray-600\">\r\n                 : {transaction.transactionReference || transaction.id}\r\n              </p>\r\n            </CardHeader>\r\n          </Card>\r\n\r\n          {/* Shop Information */}\r\n          <Card>\r\n            <CardHeader className=\"pb-3\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <Store className=\"h-5 w-5 text-green-600\" />\r\n                <h4 className=\"font-semibold text-lg\"> </h4>\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                <span className=\"font-medium text-gray-700\"> :</span>\r\n                <span className=\"text-gray-900\">{transaction.merchantShopName || transaction.shopName || ' '}</span>\r\n              </div>\r\n              {(transaction as any)?.cashierName && (\r\n                <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                  <span className=\"font-medium text-gray-700\">:</span>\r\n                  <span className=\"text-gray-900\">{(transaction as any).cashierName}</span>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Transaction Details */}\r\n          <Card>\r\n            <CardHeader className=\"pb-3\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <CreditCard className=\"h-5 w-5 text-blue-600\" />\r\n                <h4 className=\"font-semibold text-lg\"> </h4>\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              <div className=\"grid grid-cols-1 gap-3\">\r\n                <div className=\"flex items-center justify-between p-3 bg-blue-50 rounded-lg\">\r\n                  <span className=\"font-medium text-blue-700\"> :</span>\r\n                  <Badge variant=\"outline\" className=\"bg-blue-100 text-blue-800\">\r\n                    {getTransactionTypeText(transaction.type)}\r\n                  </Badge>\r\n                </div>\r\n\r\n                {transaction.type !== 'withdraw' ? (\r\n                  <>\r\n                    {(() => {\r\n                      const hasSenderNumber = !!transaction.senderNumber;\r\n                      const hasSenderName = !!transaction.senderName;\r\n                      const senderLabel = hasSenderNumber\r\n                        ? ' :'\r\n                        : hasSenderName\r\n                        ? ' :'\r\n                        : ' :';\r\n                      const senderValue = hasSenderNumber\r\n                        ? transaction.senderNumber\r\n                        : hasSenderName\r\n                        ? transaction.senderName\r\n                        : transaction.senderPhone;\r\n                      const SenderIcon = hasSenderNumber ? User : Phone;\r\n                      return (\r\n                        <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <SenderIcon className=\"h-4 w-4 text-gray-500\" />\r\n                            <span className=\"font-medium text-gray-700\">{senderLabel}</span>\r\n                          </div>\r\n                          <span className=\"text-gray-900 font-mono\">{senderValue}</span>\r\n                        </div>\r\n                      );\r\n                    })()}\r\n\r\n                    <div className=\"flex items-center justify-center p-2\">\r\n                      <ArrowRight className=\"h-6 w-6 text-blue-500\" />\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center justify-between p-3 bg-green-50 rounded-lg\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <User className=\"h-4 w-4 text-green-500\" />\r\n                        <span className=\"font-medium text-green-700\"> :</span>\r\n                      </div>\r\n                      <span className=\"text-green-900 font-mono\">{transaction.receiverNumber || transaction.receiverPhone}</span>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center justify-between p-3 bg-blue-50 rounded-lg\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <DollarSign className=\"h-4 w-4 text-blue-500\" />\r\n                        <span className=\"font-medium text-blue-700\"> :</span>\r\n                      </div>\r\n                      <span className=\"text-blue-900 font-bold text-lg\">{formatNumberEnglish(transaction.transferredAmount || transaction.amount)} </span>\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Phone className=\"h-4 w-4 text-gray-500\" />\r\n                        <span className=\"font-medium text-gray-700\"> :</span>\r\n                      </div>\r\n                      <span className=\"text-gray-900 font-mono\">{transaction.senderPhone}</span>\r\n                    </div>\r\n\r\n                    {(transaction as any)?.senderName && (\r\n                      <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <User className=\"h-4 w-4 text-gray-500\" />\r\n                          <span className=\"font-medium text-gray-700\">  :</span>\r\n                        </div>\r\n                        <span className=\"text-gray-900\">{(transaction as any).senderName}</span>\r\n                      </div>\r\n                    )}\r\n\r\n                    <div className=\"flex items-center justify-between p-3 bg-red-50 rounded-lg\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <DollarSign className=\"h-4 w-4 text-red-500\" />\r\n                        <span className=\"font-medium text-red-700\"> :</span>\r\n                      </div>\r\n                      <span className=\"text-red-900 font-bold text-lg\">{formatNumberEnglish(transaction.withdrawnAmountDetailed || transaction.withdrawnAmount || transaction.amount)} </span>\r\n                    </div>\r\n                  </>\r\n                )}\r\n\r\n                {transaction.commission && (\r\n                  <div className=\"flex items-center justify-between p-3 bg-yellow-50 rounded-lg\">\r\n                    <span className=\"font-medium text-yellow-700\">:</span>\r\n                    <span className=\"text-yellow-900 font-semibold\">{transaction.commission} </span>\r\n                  </div>\r\n                )}\r\n\r\n                {transaction.commission && (\r\n                  <div className=\"flex items-center justify-between p-3 bg-green-50 rounded-lg\">\r\n                    <span className=\"font-medium text-green-700\">:</span>\r\n                    <span className=\"text-green-900 font-semibold\">{transaction.commission} </span>\r\n                  </div>\r\n                )}\r\n\r\n                {(transaction as any)?.fee && Number((transaction as any).fee) > 0 && (\r\n                  <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                    <span className=\"font-medium text-gray-700\">:</span>\r\n                    <span className=\"text-gray-900 font-semibold\">{(transaction as any).fee} </span>\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Calendar className=\"h-4 w-4 text-gray-500\" />\r\n                    <span className=\"font-medium text-gray-700\"> :</span>\r\n                  </div>\r\n                  <span className=\"text-gray-900\">{transaction.createdAt.toLocaleString('ar-EG')}</span>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          \r\n\r\n          {/* Action Buttons */}\r\n          <div className=\"flex gap-3\">\r\n            <Button\r\n              onClick={handlePrint}\r\n              className=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white\"\r\n              size=\"lg\"\r\n            >\r\n              <Printer className=\"h-5 w-5 mr-2\" />\r\n               \r\n            </Button>\r\n            \r\n            <Button\r\n              onClick={handleDelete}\r\n              variant=\"destructive\"\r\n              className=\"flex-1\"\r\n              size=\"lg\"\r\n            >\r\n              <Trash2 className=\"h-5 w-5 mr-2\" />\r\n               \r\n            </Button>\r\n          </div>\r\n\r\n          <Button\r\n            onClick={onClose}\r\n            variant=\"outline\"\r\n            className=\"w-full\"\r\n            size=\"lg\"\r\n          >\r\n             \r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default TransactionDetailsModal;\r\n","import React, { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Lock, Eye, EyeOff, AlertCircle, DollarSign } from 'lucide-react';\r\nimport { MasterPinService } from '@/utils/masterPinService';\r\n\r\ninterface EditBalanceDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  onSuccess: (newAmount: number) => void;\r\n  title: string;\r\n  description: string;\r\n  currentBalance: number;\r\n  balanceLabel: string;\r\n  userId?: string;\r\n}\r\n\r\nexport function EditBalanceDialog({ \r\n  open, \r\n  onOpenChange, \r\n  onSuccess, \r\n  title, \r\n  description,\r\n  currentBalance,\r\n  balanceLabel,\r\n  userId\r\n}: EditBalanceDialogProps) {\r\n  const [pin, setPin] = useState('');\r\n  const [newAmount, setNewAmount] = useState(currentBalance.toString());\r\n  const [showPin, setShowPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  //           \r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      //    \r\n      const amount = parseFloat(newAmount);\r\n      if (isNaN(amount) || amount < 0) {\r\n        setError('   ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      const hasSecretPin = await MasterPinService.hasMasterPin(userId);\r\n      if (hasSecretPin) {\r\n        //     \r\n        const isValid = await MasterPinService.verifyMasterPin(pin, userId);\r\n        if (isValid) {\r\n          onSuccess(amount);\r\n          onOpenChange(false);\r\n          setPin('');\r\n          setNewAmount('');\r\n        } else {\r\n          setError('   ');\r\n        }\r\n      } else {\r\n        setError('     .         ');\r\n      }\r\n    } catch (error) {\r\n      setError('      ');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setPin('');\r\n    setNewAmount(currentBalance.toString());\r\n    setError('');\r\n    onOpenChange(false);\r\n  };\r\n\r\n  //      \r\n  React.useEffect(() => {\r\n    if (open) {\r\n      setNewAmount(currentBalance.toString());\r\n    }\r\n  }, [currentBalance, open]);\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            <DollarSign className=\"h-5 w-5\" />\r\n            {title}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-muted-foreground text-right\">\r\n            {description}\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"bg-gray-50 p-3 rounded-lg\">\r\n            <Label className=\"text-sm font-medium text-gray-700\">\r\n              {balanceLabel} \r\n            </Label>\r\n            <div className=\"text-lg font-bold text-gray-900 mt-1\">\r\n              {currentBalance.toLocaleString()} \r\n            </div>\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"newAmount\" className=\"text-right\">\r\n               \r\n            </Label>\r\n            <Input\r\n              id=\"newAmount\"\r\n              type=\"number\"\r\n              step=\"0.01\"\r\n              min=\"0\"\r\n              value={newAmount}\r\n              onChange={(e) => setNewAmount(e.target.value)}\r\n              placeholder=\"  \"\r\n              className=\"text-right\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"pin\" className=\"text-right\">\r\n               \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"pin\"\r\n                type={showPin ? 'text' : 'password'}\r\n                value={pin}\r\n                onChange={(e) => setPin(e.target.value)}\r\n                placeholder=\"  \"\r\n                className=\"text-right pr-10\"\r\n                required\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowPin(!showPin)}\r\n              >\r\n                {showPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-sm text-red-600 bg-red-50 p-2 rounded\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              className=\"flex-1\"\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading || !pin || !newAmount}\r\n              className=\"flex-1\"\r\n            >\r\n              {isLoading ? (\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n                   ...\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <Lock className=\"h-4 w-4 mr-2\" />\r\n                   \r\n                </>\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}","//      \r\nexport class SecurityService {\r\n  private static readonly SECRET_KEY_BASE = 'dashboard_secret_pin';\r\n  private static secretCache: Map<string, string> = new Map();\r\n\r\n  //    localStorage  \r\n  private static getSecretKey(userId?: string): string {\r\n    return userId ? `${this.SECRET_KEY_BASE}_${userId}` : this.SECRET_KEY_BASE;\r\n  }\r\n\r\n  //    (  )\r\n  static setSecretPin(pin: string, userId?: string): void {\r\n    const encodedPin = btoa(pin); //  \r\n    this.secretCache.set(this.getSecretKey(userId), encodedPin);\r\n  }\r\n\r\n  //      \r\n  static hasSecretPin(userId?: string): boolean {\r\n    return this.secretCache.has(this.getSecretKey(userId));\r\n  }\r\n\r\n  //     \r\n  static verifySecretPin(pin: string, userId?: string): boolean {\r\n    const savedPin = this.secretCache.get(this.getSecretKey(userId));\r\n    if (!savedPin) return false;\r\n    \r\n    try {\r\n      const decodedPin = atob(savedPin);\r\n      return decodedPin === pin;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  //    ( )\r\n  static clearSecretPin(userId?: string): void {\r\n    this.secretCache.delete(this.getSecretKey(userId));\r\n  }\r\n}","import React, { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Lock, Eye, EyeOff, AlertCircle, Settings } from 'lucide-react';\r\nimport { SecurityService } from '@/utils/securityService';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\ninterface ChangePinDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  userId?: string;\r\n}\r\n\r\nexport function ChangePinDialog({ open, onOpenChange, userId }: ChangePinDialogProps) {\r\n  const [currentPin, setCurrentPin] = useState('');\r\n  const [newPin, setNewPin] = useState('');\r\n  const [confirmPin, setConfirmPin] = useState('');\r\n  const [showCurrentPin, setShowCurrentPin] = useState(false);\r\n  const [showNewPin, setShowNewPin] = useState(false);\r\n  const [showConfirmPin, setShowConfirmPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  const hasExistingPin = SecurityService.hasSecretPin(userId);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      //     \r\n      if (!newPin || newPin.length < 4) {\r\n        setError('     4   ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (newPin !== confirmPin) {\r\n        setError('     ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      //          \r\n      if (hasExistingPin) {\r\n        if (!currentPin) {\r\n          setError('    ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        if (!SecurityService.verifySecretPin(currentPin, userId)) {\r\n          setError('    ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      //    \r\n      SecurityService.setSecretPin(newPin, userId);\r\n\r\n      //   \r\n      toast({\r\n        title: hasExistingPin ? \"   \" : \"   \",\r\n        description: hasExistingPin \r\n          ? \"    \" \r\n          : \"    \",\r\n      });\r\n\r\n      //     \r\n      handleClose();\r\n    } catch (error) {\r\n      setError('     ');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setCurrentPin('');\r\n    setNewPin('');\r\n    setConfirmPin('');\r\n    setError('');\r\n    setShowCurrentPin(false);\r\n    setShowNewPin(false);\r\n    setShowConfirmPin(false);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            <Settings className=\"h-5 w-5\" />\r\n            {hasExistingPin ? \"  \" : \"  \"}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-muted-foreground text-right\">\r\n            {hasExistingPin \r\n              ? \"       \"\r\n              : \"         \"\r\n            }\r\n          </div>\r\n\r\n          {/*    (  ) */}\r\n          {hasExistingPin && (\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"currentPin\" className=\"text-right block\">\r\n                  \r\n              </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"currentPin\"\r\n                  type={showCurrentPin ? \"text\" : \"password\"}\r\n                  autoComplete=\"off\"\r\n                  value={currentPin}\r\n                  onChange={(e) => setCurrentPin(e.target.value)}\r\n                  placeholder=\"   \"\r\n                  className=\"pr-10\"\r\n                  dir=\"ltr\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowCurrentPin(!showCurrentPin)}\r\n                >\r\n                  {showCurrentPin ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"newPin\" className=\"text-right block\">\r\n                \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"newPin\"\r\n                type={showNewPin ? \"text\" : \"password\"}\r\n                autoComplete=\"off\"\r\n                value={newPin}\r\n                onChange={(e) => setNewPin(e.target.value)}\r\n                placeholder=\"   \"\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowNewPin(!showNewPin)}\r\n              >\r\n                {showNewPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*     */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"confirmPin\" className=\"text-right block\">\r\n                 \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"confirmPin\"\r\n                type={showConfirmPin ? \"text\" : \"password\"}\r\n                autoComplete=\"off\"\r\n                value={confirmPin}\r\n                onChange={(e) => setConfirmPin(e.target.value)}\r\n                placeholder=\"    \"\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowConfirmPin(!showConfirmPin)}\r\n              >\r\n                {showConfirmPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*   */}\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-red-600 text-sm\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {/*   */}\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              className=\"flex-1\"\r\n            >\r\n              <Lock className=\"h-4 w-4 mr-2\" />\r\n              {isLoading ? \" ...\" : (hasExistingPin ? \"  \" : \"  \")}\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              disabled={isLoading}\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}","import React, { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Lock, Eye, EyeOff, AlertCircle, DollarSign } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\nconst cashPinsCache: Map<string, string> = new Map();\r\n\r\ninterface ChangeCashPinDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  userId?: string;\r\n}\r\n\r\nexport function ChangeCashPinDialog({ open, onOpenChange, userId }: ChangeCashPinDialogProps) {\r\n  const [currentPin, setCurrentPin] = useState('');\r\n  const [newPin, setNewPin] = useState('');\r\n  const [confirmPin, setConfirmPin] = useState('');\r\n  const [showCurrentPin, setShowCurrentPin] = useState(false);\r\n  const [showNewPin, setShowNewPin] = useState(false);\r\n  const [showConfirmPin, setShowConfirmPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  const CASH_PIN_KEY = userId ? `cash_drawer_pin_${userId}` : 'cash_drawer_pin';\r\n  \r\n  const hasExistingPin = () => {\r\n    return cashPinsCache.has(CASH_PIN_KEY);\r\n  };\r\n\r\n  const verifyCurrentPin = (pin: string) => {\r\n    const savedPin = cashPinsCache.get(CASH_PIN_KEY);\r\n    if (!savedPin) return false;\r\n    \r\n    try {\r\n      const decodedPin = atob(savedPin);\r\n      return decodedPin === pin;\r\n    } catch {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const saveNewPin = (pin: string) => {\r\n    const encodedPin = btoa(pin);\r\n    cashPinsCache.set(CASH_PIN_KEY, encodedPin);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      //     \r\n      if (!newPin || newPin.length < 4) {\r\n        setError('     4   ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (newPin !== confirmPin) {\r\n        setError('     ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      //          \r\n      if (hasExistingPin()) {\r\n        if (!currentPin) {\r\n          setError('      ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        if (!verifyCurrentPin(currentPin)) {\r\n          setError('      ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      //    \r\n      saveNewPin(newPin);\r\n\r\n      //   \r\n      toast({\r\n        title: hasExistingPin() ? \"    \" : \"    \",\r\n        description: hasExistingPin() \r\n          ? \"      \" \r\n          : \"      \",\r\n      });\r\n\r\n      //     \r\n      handleClose();\r\n    } catch (error) {\r\n      setError('       ');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setCurrentPin('');\r\n    setNewPin('');\r\n    setConfirmPin('');\r\n    setError('');\r\n    setShowCurrentPin(false);\r\n    setShowNewPin(false);\r\n    setShowConfirmPin(false);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            <DollarSign className=\"h-5 w-5 text-green-600\" />\r\n            {hasExistingPin() ? \"   \" : \"   \"}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-muted-foreground text-right\">\r\n            {hasExistingPin() \r\n              ? \"        \"\r\n              : \"         \"\r\n            }\r\n          </div>\r\n\r\n          {/*    (  ) */}\r\n          {hasExistingPin() && (\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"currentPin\" className=\"text-right block\">\r\n                    \r\n              </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"currentPin\"\r\n                  type={showCurrentPin ? \"text\" : \"password\"}\r\n                  autoComplete=\"off\"\r\n                  value={currentPin}\r\n                  onChange={(e) => setCurrentPin(e.target.value)}\r\n                  placeholder=\"   \"\r\n                  className=\"pr-10\"\r\n                  dir=\"ltr\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowCurrentPin(!showCurrentPin)}\r\n                >\r\n                  {showCurrentPin ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"newPin\" className=\"text-right block\">\r\n                  \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"newPin\"\r\n                type={showNewPin ? \"text\" : \"password\"}\r\n                autoComplete=\"off\"\r\n                value={newPin}\r\n                onChange={(e) => setNewPin(e.target.value)}\r\n                placeholder=\"   \"\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowNewPin(!showNewPin)}\r\n              >\r\n                {showNewPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*     */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"confirmPin\" className=\"text-right block\">\r\n                 \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"confirmPin\"\r\n                type={showConfirmPin ? \"text\" : \"password\"}\r\n                autoComplete=\"off\"\r\n                value={confirmPin}\r\n                onChange={(e) => setConfirmPin(e.target.value)}\r\n                placeholder=\"    \"\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowConfirmPin(!showConfirmPin)}\r\n              >\r\n                {showConfirmPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*   */}\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-red-600 text-sm\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {/*   */}\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              className=\"flex-1 bg-green-600 hover:bg-green-700\"\r\n            >\r\n              <Lock className=\"h-4 w-4 mr-2\" />\r\n              {isLoading ? \" ...\" : (hasExistingPin() ? \"   \" : \"   \")}\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              disabled={isLoading}\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </form>\r\n\r\n        <div className=\"text-xs text-gray-500 text-center mt-2\">\r\n                  \r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}","import React, { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Lock, Eye, EyeOff, AlertCircle, Wallet } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\nconst walletTotalPinsCache: Map<string, string> = new Map();\r\n\r\ninterface ChangeWalletTotalPinDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  userId?: string;\r\n}\r\n\r\nexport function ChangeWalletTotalPinDialog({ open, onOpenChange, userId }: ChangeWalletTotalPinDialogProps) {\r\n  const [currentPin, setCurrentPin] = useState('');\r\n  const [newPin, setNewPin] = useState('');\r\n  const [confirmPin, setConfirmPin] = useState('');\r\n  const [showCurrentPin, setShowCurrentPin] = useState(false);\r\n  const [showNewPin, setShowNewPin] = useState(false);\r\n  const [showConfirmPin, setShowConfirmPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  const WALLET_TOTAL_PIN_KEY = userId ? `wallet_total_pin_${userId}` : 'wallet_total_pin';\r\n  \r\n  const hasExistingPin = () => {\r\n    return walletTotalPinsCache.has(WALLET_TOTAL_PIN_KEY);\r\n  };\r\n\r\n  const verifyCurrentPin = (pin: string) => {\r\n    const savedPin = walletTotalPinsCache.get(WALLET_TOTAL_PIN_KEY);\r\n    if (!savedPin) return false;\r\n    \r\n    try {\r\n      const decodedPin = atob(savedPin);\r\n      return decodedPin === pin;\r\n    } catch {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const saveNewPin = (pin: string) => {\r\n    const encodedPin = btoa(pin);\r\n    walletTotalPinsCache.set(WALLET_TOTAL_PIN_KEY, encodedPin);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      //     \r\n      if (!newPin || newPin.length < 4) {\r\n        setError('     4   ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (newPin !== confirmPin) {\r\n        setError('     ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      //          \r\n      if (hasExistingPin()) {\r\n        if (!currentPin) {\r\n          setError('      ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        if (!verifyCurrentPin(currentPin)) {\r\n          setError('      ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      //    \r\n      saveNewPin(newPin);\r\n\r\n      //   \r\n      toast({\r\n        title: hasExistingPin() ? \"    \" : \"    \",\r\n        description: hasExistingPin() \r\n          ? \"      \" \r\n          : \"      \",\r\n      });\r\n\r\n      //     \r\n      handleClose();\r\n    } catch (error) {\r\n      setError('       ');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setCurrentPin('');\r\n    setNewPin('');\r\n    setConfirmPin('');\r\n    setError('');\r\n    setShowCurrentPin(false);\r\n    setShowNewPin(false);\r\n    setShowConfirmPin(false);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            <Wallet className=\"h-5 w-5 text-blue-600\" />\r\n            {hasExistingPin() ? \"   \" : \"   \"}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-muted-foreground text-right\">\r\n            {hasExistingPin() \r\n              ? \"        \"\r\n              : \"         \"\r\n            }\r\n          </div>\r\n\r\n          {/*    (  ) */}\r\n          {hasExistingPin() && (\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"currentPin\" className=\"text-right block\">\r\n                    \r\n              </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"currentPin\"\r\n                  type={showCurrentPin ? \"text\" : \"password\"}\r\n                  autoComplete=\"off\"\r\n                  value={currentPin}\r\n                  onChange={(e) => setCurrentPin(e.target.value)}\r\n                  placeholder=\"   \"\r\n                  className=\"pr-10\"\r\n                  dir=\"ltr\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowCurrentPin(!showCurrentPin)}\r\n                >\r\n                  {showCurrentPin ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"newPin\" className=\"text-right block\">\r\n                  \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"newPin\"\r\n                type={showNewPin ? \"text\" : \"password\"}\r\n                autoComplete=\"off\"\r\n                value={newPin}\r\n                onChange={(e) => setNewPin(e.target.value)}\r\n                placeholder=\"   \"\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowNewPin(!showNewPin)}\r\n              >\r\n                {showNewPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*     */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"confirmPin\" className=\"text-right block\">\r\n                 \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"confirmPin\"\r\n                type={showConfirmPin ? \"text\" : \"password\"}\r\n                autoComplete=\"off\"\r\n                value={confirmPin}\r\n                onChange={(e) => setConfirmPin(e.target.value)}\r\n                placeholder=\"    \"\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowConfirmPin(!showConfirmPin)}\r\n              >\r\n                {showConfirmPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*   */}\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-red-600 text-sm\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {/*   */}\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              className=\"flex-1 bg-blue-600 hover:bg-blue-700\"\r\n            >\r\n              <Lock className=\"h-4 w-4 mr-2\" />\r\n              {isLoading ? \" ...\" : (hasExistingPin() ? \"   \" : \"   \")}\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              disabled={isLoading}\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </form>\r\n\r\n        <div className=\"text-xs text-gray-500 text-center mt-2\">\r\n                  \r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}","import React, { useEffect, useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Lock, Eye, EyeOff, AlertCircle, Plus, Minus } from 'lucide-react';\r\nimport { MasterPinService } from '@/utils/masterPinService';\r\n\r\ninterface AddToWalletDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  onSuccess: (addedAmount: number) => void;\r\n  title: string;\r\n  description: string;\r\n  currentBalance: number;\r\n  balanceLabel: string;\r\n  userId?: string;\r\n}\r\n\r\nexport function AddToWalletDialog({ \r\n  open, \r\n  onOpenChange, \r\n  onSuccess, \r\n  title, \r\n  description,\r\n  currentBalance,\r\n  balanceLabel,\r\n  userId\r\n}: AddToWalletDialogProps) {\r\n  const [pin, setPin] = useState('');\r\n  const [amount, setAmount] = useState('');\r\n  const [operationType, setOperationType] = useState<'add' | 'subtract'>('add');\r\n  const [showPin, setShowPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  const [hasMasterPin, setHasMasterPin] = useState(false);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n      const has = await MasterPinService.hasMasterPin(userId);\r\n      if (mounted) setHasMasterPin(has);\r\n    })();\r\n    return () => { mounted = false; };\r\n  }, [userId, open]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      //    \r\n      const amountValue = parseFloat(amount);\r\n      if (isNaN(amountValue) || amountValue <= 0) {\r\n        setError('      ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      //         \r\n      if (operationType === 'subtract' && amountValue > currentBalance) {\r\n        setError('       ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (hasMasterPin) {\r\n        //     \r\n        const ok = await MasterPinService.verifyMasterPin(pin, userId);\r\n        if (ok) {\r\n          const finalAmount = operationType === 'add' ? amountValue : -amountValue;\r\n          \r\n          //   \r\n          handleClose();\r\n          \r\n          //   \r\n          onSuccess(finalAmount);\r\n        } else {\r\n          setError('   ');\r\n        }\r\n      } else {\r\n        setError('     .      ');\r\n      }\r\n    } catch (error) {\r\n      setError('      ');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setPin('');\r\n    setAmount('');\r\n    setOperationType('add');\r\n    setError('');\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const getNewBalance = () => {\r\n    const amountValue = parseFloat(amount) || 0;\r\n    if (operationType === 'add') {\r\n      return currentBalance + amountValue;\r\n    } else {\r\n      return currentBalance - amountValue;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            {operationType === 'add' ? (\r\n              <Plus className=\"h-5 w-5 text-green-600\" />\r\n            ) : (\r\n              <Minus className=\"h-5 w-5 text-red-600\" />\r\n            )}\r\n            {title}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-muted-foreground text-right\">\r\n            {description}\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"bg-gray-50 p-3 rounded-lg\">\r\n            <Label className=\"text-sm font-medium text-gray-700\">\r\n              {balanceLabel} \r\n            </Label>\r\n            <div className=\"text-lg font-bold text-gray-900 mt-1\">\r\n              {currentBalance.toLocaleString()} \r\n            </div>\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label className=\"text-right\"> </Label>\r\n            <div className=\"flex gap-2\">\r\n              <Button\r\n                type=\"button\"\r\n                variant={operationType === 'add' ? 'default' : 'outline'}\r\n                onClick={() => setOperationType('add')}\r\n                className=\"flex-1 flex items-center gap-2\"\r\n              >\r\n                <Plus className=\"h-4 w-4\" />\r\n                \r\n              </Button>\r\n              <Button\r\n                type=\"button\"\r\n                variant={operationType === 'subtract' ? 'default' : 'outline'}\r\n                onClick={() => setOperationType('subtract')}\r\n                className=\"flex-1 flex items-center gap-2\"\r\n              >\r\n                <Minus className=\"h-4 w-4\" />\r\n                \r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*   */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"amount\" className=\"text-right\">\r\n                {operationType === 'add' ? '' : ''}\r\n            </Label>\r\n            <Input\r\n              id=\"amount\"\r\n              type=\"number\"\r\n              step=\"0.01\"\r\n              min=\"0.01\"\r\n              value={amount}\r\n              onChange={(e) => setAmount(e.target.value)}\r\n              placeholder={`   ${operationType === 'add' ? '' : ''}`}\r\n              className=\"text-right\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          {/*     */}\r\n          {amount && !isNaN(parseFloat(amount)) && (\r\n            <div className={`p-3 rounded-lg ${operationType === 'add' ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}`}>\r\n              <Label className=\"text-sm font-medium text-gray-700\">\r\n                  \r\n              </Label>\r\n              <div className={`text-lg font-bold mt-1 ${operationType === 'add' ? 'text-green-700' : 'text-red-700'}`}>\r\n                {getNewBalance().toLocaleString()} \r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"pin\" className=\"text-right\">\r\n               \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"pin\"\r\n                type={showPin ? 'text' : 'password'}\r\n                autoComplete=\"off\"\r\n                value={pin}\r\n                onChange={(e) => setPin(e.target.value)}\r\n                placeholder=\"  \"\r\n                className=\"text-right pr-10\"\r\n                required\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowPin(!showPin)}\r\n              >\r\n                {showPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-sm text-red-600 bg-red-50 p-2 rounded\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              className=\"flex-1\"\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading || !pin || !amount}\r\n              className={`flex-1 ${operationType === 'add' ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'}`}\r\n            >\r\n              {isLoading ? (\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n                   ...\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <Lock className=\"h-4 w-4 mr-2\" />\r\n                  {operationType === 'add' ? ' ' : ' '}\r\n                </>\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}","import { merchantWalletService } from '@/integrations/firebase/services';\r\nimport { db, auth } from '@/firebase';\r\nimport { doc, setDoc, getDoc, collection, query, where, getDocs, serverTimestamp, Timestamp } from 'firebase/firestore';\r\n\r\n// Runtime guard to prevent invalid Firestore document paths\r\nconst isValidId = (id: any): id is string => typeof id === 'string' && id.trim().length > 0;\r\n\r\n//    \r\ninterface WalletUsage {\r\n  walletId: string;\r\n  used_transfer: number;\r\n  used_withdraw: number;\r\n  monthly_limit: number;\r\n  last_reset: Timestamp | null;\r\n  updatedAt: Timestamp;\r\n}\r\n\r\n//   \r\ninterface Transaction {\r\n  id: string;\r\n  uid: string;\r\n  type: 'transfer' | 'withdraw';\r\n  amount: number;\r\n  createdAt: Timestamp;\r\n  status: string;\r\n}\r\n\r\n//    \r\nexport const walletLimitsService = {\r\n  //     \r\n  getCurrentMonthId(): string {\r\n    const now = new Date();\r\n    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;\r\n  },\r\n\r\n  //       Firebase\r\n  async getWalletUsage(walletId: string): Promise<WalletUsage | null> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('Error getting wallet usage: invalid walletId', walletId);\r\n        return null;\r\n      }\r\n      //        walletLimits\r\n      const limitsRef = doc(db, 'walletLimits', walletId);\r\n      const limitsSnap = await getDoc(limitsRef);\r\n      \r\n      if (limitsSnap.exists()) {\r\n        const data = limitsSnap.data();\r\n        return {\r\n          walletId,\r\n          used_transfer: (data.monthlyTransferUsed ?? data.used_transfer ?? 0),\r\n          used_withdraw: (data.monthlyWithdrawUsed ?? data.used_withdraw ?? 0),\r\n          monthly_limit: (data.monthlyLimit ?? data.monthlyTransferLimit ?? data.monthlyWithdrawLimit ?? 200000),\r\n          last_reset: (data.lastMonthlyReset ?? data.last_reset ?? null),\r\n          updatedAt: data.updatedAt || Timestamp.now()\r\n        };\r\n      }\r\n      \r\n      //       \r\n      const newUsage: WalletUsage = {\r\n        walletId,\r\n        used_transfer: 0,\r\n        used_withdraw: 0,\r\n        monthly_limit: 200000,\r\n        last_reset: null,\r\n        updatedAt: Timestamp.now()\r\n      };\r\n      \r\n      //   \r\n      await setDoc(limitsRef, {\r\n        monthlyTransferUsed: 0,\r\n        monthlyWithdrawUsed: 0,\r\n        monthlyTransferLimit: 200000,\r\n        monthlyWithdrawLimit: 200000,\r\n        lastMonthlyReset: null,\r\n        updatedAt: serverTimestamp(),\r\n        ownerId: auth.currentUser?.uid\r\n      });\r\n      \r\n      return newUsage;\r\n    } catch (error) {\r\n      console.error('Error getting wallet usage:', error);\r\n      return {\r\n        walletId,\r\n        used_transfer: 0,\r\n        used_withdraw: 0,\r\n        monthly_limit: 200000,\r\n        last_reset: null,\r\n        updatedAt: Timestamp.now()\r\n      };\r\n    }\r\n  },\r\n\r\n  //        (   )\r\n  shouldResetLimits(lastReset: Timestamp | null): boolean {\r\n    const now = new Date();\r\n    const currentDay = now.getDate();\r\n    \r\n    if (!lastReset) {\r\n      return currentDay === 1;\r\n    }\r\n    \r\n    //           \r\n    if (currentDay === 1) {\r\n      const lastResetDate = lastReset.toDate();\r\n      const currentMonth = now.getMonth();\r\n      const currentYear = now.getFullYear();\r\n      \r\n      //         \r\n      return (lastResetDate.getMonth() !== currentMonth || lastResetDate.getFullYear() !== currentYear);\r\n    }\r\n    \r\n    return false;\r\n  },\r\n\r\n  //      \r\n  async autoResetLimitsIfNeeded(walletId: string): Promise<boolean> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('    : walletId  ', walletId);\r\n        return false;\r\n      }\r\n      // Debug\r\n      if (typeof import.meta !== 'undefined' && (import.meta as any).env && (import.meta as any).env.DEV) {\r\n        console.debug('autoResetLimitsIfNeeded -> walletId:', walletId);\r\n      }\r\n      const usage = await this.getWalletUsage(walletId);\r\n      if (!usage) return false;\r\n      \r\n      if (this.shouldResetLimits(usage.last_reset)) {\r\n        console.log(`     ${walletId} -    `);\r\n        return await this.resetWalletUsage(walletId);\r\n      }\r\n      \r\n      return false;\r\n    } catch (error) {\r\n      console.error('    :', error);\r\n      return false;\r\n    }\r\n  },\r\n  \r\n  //     serverTimestamp\r\n  async resetWalletUsage(walletId: string): Promise<boolean> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('    : walletId  ', walletId);\r\n        return false;\r\n      }\r\n      const limitsRef = doc(db, 'walletLimits', walletId);\r\n      \r\n      //       serverTimestamp\r\n      await setDoc(limitsRef, {\r\n        monthlyTransferUsed: 0,\r\n        monthlyWithdrawUsed: 0,\r\n        lastMonthlyReset: serverTimestamp(),\r\n        updatedAt: serverTimestamp()\r\n      }, { merge: true });\r\n      \r\n      console.log(`     ${walletId} `);\r\n      return true;\r\n    } catch (error) {\r\n      console.error('    :', error);\r\n      return false;\r\n    }\r\n  },\r\n\r\n  //        last_reset\r\n  async calculateUsageFromTransactions(walletId: string): Promise<{ used_transfer: number; used_withdraw: number }> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('     : walletId  ', walletId);\r\n        return { used_transfer: 0, used_withdraw: 0 };\r\n      }\r\n      const limitsRef = doc(db, 'walletLimits', walletId);\r\n      const now = new Date();\r\n      let lastReset: Timestamp | null = Timestamp.fromDate(new Date(now.getFullYear(), now.getMonth(), 1));\r\n      try {\r\n        const limitsSnap = await getDoc(limitsRef);\r\n        lastReset = limitsSnap.exists() ? (limitsSnap.data()?.lastMonthlyReset ?? limitsSnap.data()?.last_reset ?? lastReset) : lastReset;\r\n      } catch {}\r\n      \r\n      //   \r\n      const txQuery = query(\r\n        collection(db, 'tx'),\r\n        where('uid', '==', walletId),\r\n        ...(lastReset ? [where('createdAt', '>=', lastReset)] : [])\r\n      );\r\n      \r\n      const txSnap = await getDocs(txQuery);\r\n      let used_transfer = 0;\r\n      let used_withdraw = 0;\r\n      \r\n      txSnap.forEach((doc) => {\r\n        const tx = doc.data() as Transaction;\r\n        if (tx.status === 'completed') {\r\n          if (tx.type === 'transfer') {\r\n            used_transfer += tx.amount;\r\n          } else if (tx.type === 'withdraw') {\r\n            used_withdraw += tx.amount;\r\n          }\r\n        }\r\n      });\r\n      \r\n      return { used_transfer, used_withdraw };\r\n    } catch (error) {\r\n      console.error('     :', error);\r\n      return { used_transfer: 0, used_withdraw: 0 };\r\n    }\r\n  },\r\n\r\n  //          (Optimistic UI)\r\n  async getWalletUsageWithRefresh(walletId: string): Promise<WalletUsage | null> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('      : walletId  ', walletId);\r\n        return null;\r\n      }\r\n      // Debug\r\n      if (typeof import.meta !== 'undefined' && (import.meta as any).env && (import.meta as any).env.DEV) {\r\n        console.debug('getWalletUsageWithRefresh -> walletId:', walletId);\r\n      }\r\n      //     \r\n      const usage = await this.getWalletUsage(walletId);\r\n      if (!usage) {\r\n        const calculatedUsage = await this.calculateUsageFromTransactions(walletId);\r\n        const limitsRef = doc(db, 'walletLimits', walletId);\r\n        try {\r\n          await setDoc(limitsRef, {\r\n            monthlyTransferUsed: calculatedUsage.used_transfer,\r\n            monthlyWithdrawUsed: calculatedUsage.used_withdraw,\r\n            updatedAt: serverTimestamp(),\r\n            ownerId: auth.currentUser?.uid\r\n          }, { merge: true });\r\n        } catch {}\r\n        return {\r\n          walletId,\r\n          used_transfer: calculatedUsage.used_transfer,\r\n          used_withdraw: calculatedUsage.used_withdraw,\r\n          monthly_limit: 200000,\r\n          last_reset: null,\r\n          updatedAt: Timestamp.now()\r\n        };\r\n      }\r\n      \r\n      //        \r\n      const calculatedUsage = await this.calculateUsageFromTransactions(walletId);\r\n      \r\n      //      \r\n      if (usage.used_transfer !== calculatedUsage.used_transfer || \r\n          usage.used_withdraw !== calculatedUsage.used_withdraw) {\r\n        \r\n        const limitsRef = doc(db, 'walletLimits', walletId);\r\n        \r\n        try {\r\n          await setDoc(limitsRef, {\r\n            monthlyTransferUsed: calculatedUsage.used_transfer,\r\n            monthlyWithdrawUsed: calculatedUsage.used_withdraw,\r\n            updatedAt: serverTimestamp(),\r\n            ownerId: auth.currentUser?.uid\r\n          }, { merge: true });\r\n        } catch {}\r\n        \r\n        //    \r\n        return await this.getWalletUsage(walletId);\r\n      }\r\n      \r\n      return usage;\r\n    } catch (error) {\r\n      console.error('      :', error);\r\n      return {\r\n        walletId,\r\n        used_transfer: 0,\r\n        used_withdraw: 0,\r\n        monthly_limit: 200000,\r\n        last_reset: null,\r\n        updatedAt: Timestamp.now()\r\n      };\r\n    }\r\n  },\r\n\r\n  //  : remaining = monthly_limit - used_*\r\n  calculateRemaining(usage: WalletUsage): { remainingTransfer: number; remainingWithdraw: number } {\r\n    return {\r\n      remainingTransfer: Math.max(0, usage.monthly_limit - usage.used_transfer),\r\n      remainingWithdraw: Math.max(0, usage.monthly_limit - usage.used_withdraw)\r\n    };\r\n  },\r\n\r\n  //          \r\n  async canPerformOperation(walletId: string, amount: number, type: 'transfer' | 'withdraw'): Promise<{ canPerform: boolean; message?: string; remaining?: number }> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('Error checking operation limits: invalid walletId', walletId);\r\n        return { canPerform: false, message: 'walletId  ' };\r\n      }\r\n      //     \r\n      const usage = await this.getWalletUsageWithRefresh(walletId);\r\n      if (!usage) {\r\n        return { canPerform: false, message: '      ' };\r\n      }\r\n\r\n      const remaining = this.calculateRemaining(usage);\r\n      \r\n      if (type === 'transfer') {\r\n        if (amount > remaining.remainingTransfer) {\r\n          return { \r\n            canPerform: false, \r\n            message: `   . : ${remaining.remainingTransfer.toLocaleString()} .   ${usage.monthly_limit.toLocaleString()} .`,\r\n            remaining: remaining.remainingTransfer\r\n          };\r\n        }\r\n      }\r\n\r\n      if (type === 'withdraw') {\r\n        if (amount > remaining.remainingWithdraw) {\r\n          return { \r\n            canPerform: false, \r\n            message: `   . : ${remaining.remainingWithdraw.toLocaleString()} .   ${usage.monthly_limit.toLocaleString()} .`,\r\n            remaining: remaining.remainingWithdraw\r\n          };\r\n        }\r\n      }\r\n\r\n      return { canPerform: true };\r\n    } catch (error) {\r\n      console.error('Error checking operation limits:', error);\r\n      return { canPerform: false, message: '    ' };\r\n    }\r\n  },\r\n  \r\n  //       Optimistic UI\r\n  async updateUsage(walletId: string, amount: number, type: 'transfer' | 'withdraw'): Promise<WalletUsage> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        throw new Error('walletId  ');\r\n      }\r\n      //      \r\n      const currentUsage = await this.getWalletUsageWithRefresh(walletId);\r\n      if (!currentUsage) {\r\n        throw new Error('      ');\r\n      }\r\n\r\n      //     \r\n      const canPerform = await this.canPerformOperation(walletId, amount, type);\r\n      if (!canPerform.canPerform) {\r\n        throw new Error(canPerform.message || '   ');\r\n      }\r\n\r\n      //  \r\n      const newUsedTransfer = type === 'transfer' ? currentUsage.used_transfer + amount : currentUsage.used_transfer;\r\n      const newUsedWithdraw = type === 'withdraw' ? currentUsage.used_withdraw + amount : currentUsage.used_withdraw;\r\n\r\n      //    Firebase  await\r\n      const ref = doc(db, 'walletLimits', currentUsage.walletId);\r\n      \r\n      try {\r\n        await setDoc(ref, {\r\n          monthlyTransferUsed: newUsedTransfer,\r\n          monthlyWithdrawUsed: newUsedWithdraw,\r\n          updatedAt: serverTimestamp(),\r\n          ownerId: auth.currentUser?.uid\r\n        }, { merge: true });\r\n      } catch {}\r\n\r\n      //      \r\n      let updatedUsage = await this.getWalletUsageWithRefresh(walletId);\r\n      if (!updatedUsage) {\r\n        updatedUsage = {\r\n          walletId,\r\n          used_transfer: newUsedTransfer,\r\n          used_withdraw: newUsedWithdraw,\r\n          monthly_limit: currentUsage.monthly_limit,\r\n          last_reset: currentUsage.last_reset,\r\n          updatedAt: Timestamp.now()\r\n        } as WalletUsage;\r\n      }\r\n\r\n      return updatedUsage;\r\n    } catch (error) {\r\n      console.error('Error updating wallet usage:', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  //       Firebase\r\n  async resetWalletUsageManually(walletId: string): Promise<WalletUsage> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        throw new Error('walletId  ');\r\n      }\r\n      const ref = doc(db, 'walletLimits', walletId);\r\n      \r\n      //       \r\n      const resetUsage: WalletUsage = {\r\n        walletId,\r\n        used_transfer: 0,\r\n        used_withdraw: 0,\r\n        monthly_limit: 0,\r\n        last_reset: null,\r\n        updatedAt: new Date() as any\r\n      };\r\n\r\n      //    Firebase  \r\n      setDoc(ref, {\r\n        monthlyTransferUsed: 0,\r\n        monthlyWithdrawUsed: 0,\r\n        lastMonthlyReset: serverTimestamp(),\r\n        updatedAt: serverTimestamp()\r\n      }, { merge: true }).catch(error => {\r\n        console.error('      Firebase:', error);\r\n      });\r\n\r\n      console.log(`     ${walletId} `);\r\n      return resetUsage;\r\n    } catch (error) {\r\n      console.error('Error resetting wallet usage:', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  //      \r\n  async getAllWalletsUsage(merchantUserId: string): Promise<WalletUsage[]> {\r\n    try {\r\n      //     \r\n      const wallets = await merchantWalletService.getByMerchantId(merchantUserId);\r\n      const usagePromises = wallets.map(wallet => this.getWalletUsageWithRefresh(wallet.id));\r\n      const usageResults = await Promise.all(usagePromises);\r\n      \r\n      return usageResults.filter(usage => usage !== null) as WalletUsage[];\r\n    } catch (error) {\r\n      console.error('Error getting all wallets usage:', error);\r\n      return [];\r\n    }\r\n  },\r\n\r\n\r\n\r\n\r\n};\r\n","import React, { useEffect, useMemo, useState, useRef } from 'react';\r\nimport { Capacitor } from '@capacitor/core';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { createPortal } from 'react-dom';\r\nimport { Bell, CheckCircle, ExternalLink, Clock } from 'lucide-react';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { Broadcast, subscribeToActiveBroadcastsList } from '@/utils/broadcastService';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { addDoc, collection, serverTimestamp, onSnapshot, query, where, orderBy } from 'firebase/firestore';\r\nimport { db } from '@/firebase';\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuLabel,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from '@/components/ui/dropdown-menu';\r\n\r\ninterface NotificationBellProps {\r\n  className?: string;\r\n}\r\n\r\nfunction useReadIdsKey(userId?: string) {\r\n  return userId ? `readBroadcastIds_${userId}` : `readBroadcastIds_guest`;\r\n}\r\n\r\nexport default function NotificationBell({ className }: NotificationBellProps) {\r\n  const { user, profile, isSubscriptionActive } = useFirebaseAuth();\r\n  const location = useLocation();\r\n  const [notifications, setNotifications] = useState<Broadcast[]>([]);\r\n  const [readIds, setReadIds] = useState<Set<string>>(new Set());\r\n  //   \" \"\r\n  const [queueOpen, setQueueOpen] = useState(false);\r\n  const [queueReason, setQueueReason] = useState('');\r\n  const [queueSubmitting, setQueueSubmitting] = useState(false);\r\n  const [queueMessage, setQueueMessage] = useState<string | null>(null);\r\n  //          \r\n  const [queueLatestStatus, setQueueLatestStatus] = useState<'none' | 'pending' | 'contacted'>('none');\r\n  //        5     \r\n  const [flyAlert, setFlyAlert] = useState<Broadcast | null>(null);\r\n  const [flyVisible, setFlyVisible] = useState(false);\r\n  const prevIdsRef = useRef<Set<string>>(new Set());\r\n  const didInitRef = useRef(false);\r\n  const flyTimerRef = useRef<number | null>(null);\r\n  //        \r\n  const triggerRef = useRef<HTMLDivElement | null>(null);\r\n  const flyNodeRef = useRef<HTMLDivElement | null>(null);\r\n  const [flyStyle, setFlyStyle] = useState<React.CSSProperties>({ position: 'fixed', top: 0, left: 0, zIndex: 10000 });\r\n  \r\n  //     (fly-out)  \r\n  const ENABLE_FLY_ALERT = false;\r\n\r\n  const audienceKeys = useMemo(() => {\r\n    const keys: string[] = ['global'];\r\n    if (user?.uid) keys.push(`user:${user.uid}`);\r\n    if (profile?.shopId) keys.push(`shop:${profile.shopId}`);\r\n    return keys;\r\n  }, [user?.uid, profile?.shopId]);\r\n\r\n  const storageKey = useReadIdsKey(user?.uid);\r\n\r\n  //          \r\n  const canShowNotifications = useMemo(() => {\r\n    const onPendingApprovalPage = location?.pathname?.includes('/user/pending-approval');\r\n    //         \r\n    //        \r\n    const isSignedIn = Boolean(user?.uid);\r\n    return isSignedIn && !onPendingApprovalPage;\r\n  }, [user?.uid, location?.pathname]);\r\n\r\n  useEffect(() => {\r\n    //         \r\n    try {\r\n      const raw = localStorage.getItem(storageKey);\r\n      if (raw) {\r\n        const arr = JSON.parse(raw);\r\n        if (Array.isArray(arr)) setReadIds(new Set(arr.filter(Boolean)));\r\n      } else {\r\n        setReadIds(new Set());\r\n      }\r\n    } catch (e) {\r\n      console.warn('Failed to load read ids', e);\r\n      setReadIds(new Set());\r\n    }\r\n  }, [storageKey]);\r\n\r\n  useEffect(() => {\r\n    //         \r\n    if (!canShowNotifications) {\r\n      setNotifications([]);\r\n      return;\r\n    }\r\n    const unsubscribe = subscribeToActiveBroadcastsList(audienceKeys, (list) => {\r\n      setNotifications(list);\r\n    });\r\n    return () => unsubscribe();\r\n  }, [audienceKeys, canShowNotifications]);\r\n\r\n  //            5 \r\n  useEffect(() => {\r\n    if (!ENABLE_FLY_ALERT) return; //    \r\n    const ids = new Set((notifications.map((n) => n.id).filter(Boolean) as string[]));\r\n    if (!didInitRef.current) {\r\n      prevIdsRef.current = ids;\r\n      didInitRef.current = true;\r\n      return;\r\n    }\r\n    const newItems = notifications.filter((n) => n.id && !prevIdsRef.current.has(n.id!));\r\n    if (newItems.length > 0) {\r\n      setFlyAlert(newItems[0]);\r\n      setFlyVisible(true);\r\n      if (flyTimerRef.current) {\r\n        clearTimeout(flyTimerRef.current as any);\r\n      }\r\n      flyTimerRef.current = window.setTimeout(() => {\r\n        setFlyVisible(false);\r\n        setFlyAlert(null);\r\n      }, 5000);\r\n    }\r\n    prevIdsRef.current = ids;\r\n  }, [notifications]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (flyTimerRef.current) {\r\n        clearTimeout(flyTimerRef.current as any);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const unreadCount = notifications.reduce((acc, n) => acc + (n.id && !readIds.has(n.id) ? 1 : 0), 0);\r\n  //        \r\n\r\n  const markAsRead = (id?: string) => {\r\n    if (!id) return;\r\n    if (readIds.has(id)) return;\r\n    const next = new Set(readIds);\r\n    next.add(id);\r\n    setReadIds(next);\r\n    try {\r\n      localStorage.setItem(storageKey, JSON.stringify(Array.from(next)));\r\n    } catch {}\r\n  };\r\n\r\n  const markAllAsRead = () => {\r\n    const ids = notifications.map((n) => n.id).filter(Boolean) as string[];\r\n    const next = new Set(readIds);\r\n    ids.forEach((id) => next.add(id));\r\n    setReadIds(next);\r\n    try {\r\n      localStorage.setItem(storageKey, JSON.stringify(Array.from(next)));\r\n    } catch {}\r\n  };\r\n\r\n  const openLink = (url?: string, id?: string) => {\r\n    if (url) {\r\n      try {\r\n        const isAndroid = Capacitor?.isNativePlatform && Capacitor.getPlatform() === 'android';\r\n        const isApk = /\\.apk(\\?|$)/i.test(url);\r\n        if (isAndroid && isApk) {\r\n          const deeplink = `cashy://update?url=${encodeURIComponent(url)}`;\r\n          window.location.href = deeplink;\r\n        } else {\r\n          window.open(url, '_blank');\r\n        }\r\n      } catch {\r\n        try { window.open(url, '_blank'); } catch {}\r\n      }\r\n    }\r\n    if (id) markAsRead(id);\r\n  };\r\n\r\n  //      (  )\r\n  const updateFlyPosition = () => {\r\n    if (!triggerRef.current || !flyNodeRef.current) return;\r\n    const rect = triggerRef.current.getBoundingClientRect();\r\n    const margin = 8;\r\n    const width = flyNodeRef.current.offsetWidth || 320;\r\n    const top = rect.bottom + margin;\r\n    let left = rect.right - width; //    \r\n    const viewportWidth = window.innerWidth;\r\n    left = Math.min(Math.max(left, margin), viewportWidth - width - margin);\r\n    setFlyStyle((prev) => ({ ...prev, top, left }));\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!ENABLE_FLY_ALERT) return; //       \r\n    if (!flyVisible) return;\r\n    updateFlyPosition();\r\n    const handler = () => updateFlyPosition();\r\n    window.addEventListener('resize', handler);\r\n    window.addEventListener('scroll', handler, true);\r\n    return () => {\r\n      window.removeEventListener('resize', handler);\r\n      window.removeEventListener('scroll', handler, true);\r\n    };\r\n  }, [flyVisible]);\r\n\r\n  const submitQueueRequest = async () => {\r\n    if (!user?.uid) {\r\n      alert('    .');\r\n      return;\r\n    }\r\n    const reason = queueReason.trim();\r\n    if (!reason) {\r\n      alert('    .');\r\n      return;\r\n    }\r\n    try {\r\n      setQueueSubmitting(true);\r\n      setQueueMessage(null);\r\n      const name = (profile?.fullName && profile.fullName.trim())\r\n        ? profile.fullName.trim()\r\n        : (user.email ? user.email.split('@')[0] : '');\r\n      const phone = profile?.phone || null;\r\n      await addDoc(collection(db, 'waiting_list'), {\r\n        userId: user.uid,\r\n        name,\r\n        phone,\r\n        reason,\r\n        status: 'pending',\r\n        createdAt: serverTimestamp(),\r\n      });\r\n      setQueueMessage('       ');\r\n      setQueueReason('');\r\n      //      \r\n      setTimeout(() => setQueueOpen(false), 900);\r\n    } catch (e) {\r\n      console.error('    :', e);\r\n      alert('    .   .');\r\n    } finally {\r\n      setQueueSubmitting(false);\r\n    }\r\n  };\r\n\r\n  //          \r\n  useEffect(() => {\r\n    if (!user?.uid) {\r\n      setQueueLatestStatus('none');\r\n      return;\r\n    }\r\n    let unsub: (() => void) | null = null;\r\n    try {\r\n      //  orderBy        \r\n      const q = query(\r\n        collection(db, 'waiting_list'),\r\n        where('userId', '==', user.uid)\r\n      );\r\n      unsub = onSnapshot(q, (snapshot) => {\r\n        //    createdAt    \r\n        const docs = snapshot.docs\r\n          .map((d) => ({ id: d.id, ...d.data() }))\r\n          .sort((a: any, b: any) => {\r\n            const ta = a?.createdAt?.toMillis?.() ?? a?.createdAt?.seconds * 1000 ?? 0;\r\n            const tb = b?.createdAt?.toMillis?.() ?? b?.createdAt?.seconds * 1000 ?? 0;\r\n            return tb - ta; // \r\n          });\r\n        if (docs.length === 0) {\r\n          setQueueLatestStatus('none');\r\n          return;\r\n        }\r\n        //       \r\n        const latest = docs[0] as any;\r\n        const contacted = latest?.contacted === true || latest?.status === 'contacted';\r\n        setQueueLatestStatus(contacted ? 'contacted' : 'pending');\r\n      });\r\n    } catch (e) {\r\n      console.warn('    waiting_list :', e);\r\n      setQueueLatestStatus('none');\r\n    }\r\n    return () => { if (unsub) unsub(); };\r\n  }, [user?.uid]);\r\n\r\n  if (!canShowNotifications) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className={`relative inline-flex items-center gap-2 ${className || ''}`} ref={triggerRef}>\r\n      {/*     */}\r\n      <DropdownMenu onOpenChange={(open) => { if (open && unreadCount > 0) markAllAsRead(); }}>\r\n        <DropdownMenuTrigger asChild>\r\n          <Button\r\n            variant=\"ghost\"\r\n            className=\"relative h-8 w-8 rounded-full p-0 hover:bg-transparent focus:ring-1 focus:ring-primary focus:ring-offset-1 transition-all\"\r\n            title=\"\"\r\n          >\r\n            <div className=\"relative h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center border border-border shadow-sm hover:shadow-md\">\r\n              <Bell className=\"h-4 w-4 text-primary\" />\r\n              {unreadCount > 0 && (\r\n                <span className=\"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-red-500 text-white text-[10px] font-bold flex items-center justify-center shadow\">\r\n                  {unreadCount}\r\n                </span>\r\n              )}\r\n            </div>\r\n          </Button>\r\n        </DropdownMenuTrigger>\r\n        <DropdownMenuContent className=\"w-80\" align=\"end\" forceMount>\r\n          <DropdownMenuLabel className=\"flex items-center justify-between\">\r\n            <span></span>\r\n            {notifications.length > 0 && (\r\n              <Button variant=\"outline\" size=\"sm\" className=\"h-7 text-xs\" onClick={markAllAsRead}>\r\n                <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n                  \r\n              </Button>\r\n            )}\r\n          </DropdownMenuLabel>\r\n          <DropdownMenuSeparator />\r\n\r\n          {notifications.length === 0 ? (\r\n            <div className=\"p-3 text-sm text-muted-foreground\">   </div>\r\n          ) : (\r\n            <div className=\"max-h-64 overflow-y-auto pr-1\">\r\n              {notifications.map((n) => {\r\n                const isUnread = n.id ? !readIds.has(n.id) : false;\r\n                return (\r\n                  <div key={n.id} className={`px-2 py-2 rounded-md ${isUnread ? 'bg-primary/5' : ''}`}>\r\n                    <div className=\"flex items-start gap-2\">\r\n                      <Bell className={`h-4 w-4 ${isUnread ? 'text-primary' : 'text-muted-foreground'}`} />\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"text-sm font-medium\">{n.title || ''}</div>\r\n                        <div className=\"text-xs text-muted-foreground whitespace-pre-line\">{n.message}</div>\r\n                        {n.linkUrl && (\r\n                          <Button variant=\"link\" className=\"px-0 h-6 text-xs\" onClick={() => openLink(n.linkUrl, n.id)}>\r\n                              <ExternalLink className=\"h-3 w-3 ml-1\" />\r\n                          </Button>\r\n                        )}\r\n                      </div>\r\n                      {isUnread ? (\r\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => markAsRead(n.id)} title=\" \">\r\n                          <CheckCircle className=\"h-4 w-4 text-primary\" />\r\n                        </Button>\r\n                      ) : (\r\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" disabled title=\"\">\r\n                          <CheckCircle className=\"h-4 w-4 text-muted-foreground\" />\r\n                        </Button>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n        </DropdownMenuContent>\r\n      </DropdownMenu>\r\n\r\n      {/*      */}\r\n      <Dialog open={queueOpen} onOpenChange={setQueueOpen}>\r\n        <DialogTrigger asChild>\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"icon\"\r\n            className=\"h-8 w-8 rounded-full hover:bg-transparent focus:ring-1 focus:ring-primary/60 focus:ring-offset-1\"\r\n            title=\" \"\r\n          >\r\n            <Clock className={`h-4 w-4 ${queueLatestStatus === 'pending' ? 'text-red-600' : queueLatestStatus === 'contacted' ? 'text-green-600' : 'text-muted-foreground'}`} />\r\n          </Button>\r\n        </DialogTrigger>\r\n        <DialogContent className=\"max-w-md border border-purple-200/50 shadow-xl bg-gradient-to-br from-purple-50 to-blue-50\">\r\n          <DialogHeader>\r\n            <DialogTitle> </DialogTitle>\r\n            <DialogDescription>\r\n                        .\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"grid gap-3\">\r\n            <label className=\"text-sm font-medium text-gray-700\"> </label>\r\n            <Textarea\r\n              value={queueReason}\r\n              onChange={(e) => setQueueReason(e.target.value)}\r\n              placeholder=\"    ...\"\r\n              className=\"min-h-[120px] text-right\"\r\n            />\r\n            {queueMessage && (\r\n              <div className=\"text-sm text-green-700 bg-green-50 border border-green-200 rounded-md p-2\">\r\n                {queueMessage}\r\n              </div>\r\n            )}\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setQueueOpen(false)} disabled={queueSubmitting}>\r\n              \r\n            </Button>\r\n            <Button onClick={submitQueueRequest} disabled={queueSubmitting} className=\"bg-gradient-to-r from-green-600 to-emerald-600 text-white\">\r\n              {queueSubmitting ? ' ...' : ''}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n      {/*          */}\r\n      {ENABLE_FLY_ALERT && flyAlert && createPortal(\r\n        <div ref={flyNodeRef} style={flyStyle} className={`pointer-events-auto transition-all duration-300 ${flyVisible ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-3'}`}>\r\n          <div className=\"bg-white rounded-xl shadow-2xl border border-gray-200 p-4 w-80 max-w-[calc(100vw-16px)] flex items-start gap-3\">\r\n            <div className=\"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center\">\r\n              <Bell className=\"w-4 h-4 text-primary\" />\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <div className=\"text-sm font-semibold\">{flyAlert.title || ' '}</div>\r\n              <div className=\"text-xs text-muted-foreground whitespace-pre-line\">{flyAlert.message}</div>\r\n              {flyAlert.linkUrl && (\r\n                <Button variant=\"link\" className=\"px-0 h-6 text-xs\" onClick={() => openLink(flyAlert.linkUrl, flyAlert.id)}>\r\n                   \r\n                </Button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>,\r\n        document.body\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Calculator, X } from 'lucide-react';\r\n\r\ninterface CalculatorDialogProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport function CalculatorDialog({ isOpen, onClose }: CalculatorDialogProps) {\r\n  const [display, setDisplay] = useState('0');\r\n  const [previousValue, setPreviousValue] = useState<number | null>(null);\r\n  const [operation, setOperation] = useState<string | null>(null);\r\n  const [waitingForOperand, setWaitingForOperand] = useState(false);\r\n\r\n  const inputNumber = (num: string) => {\r\n    if (waitingForOperand) {\r\n      setDisplay(num);\r\n      setWaitingForOperand(false);\r\n    } else {\r\n      setDisplay(display === '0' ? num : display + num);\r\n    }\r\n  };\r\n\r\n  const inputOperation = (nextOperation: string) => {\r\n    const inputValue = parseFloat(display);\r\n\r\n    if (previousValue === null) {\r\n      setPreviousValue(inputValue);\r\n    } else if (operation) {\r\n      const currentValue = previousValue || 0;\r\n      const newValue = calculate(currentValue, inputValue, operation);\r\n\r\n      setDisplay(String(newValue));\r\n      setPreviousValue(newValue);\r\n    }\r\n\r\n    setWaitingForOperand(true);\r\n    setOperation(nextOperation);\r\n  };\r\n\r\n  const calculate = (firstValue: number, secondValue: number, operation: string): number => {\r\n    switch (operation) {\r\n      case '+':\r\n        return firstValue + secondValue;\r\n      case '-':\r\n        return firstValue - secondValue;\r\n      case '':\r\n        return firstValue * secondValue;\r\n      case '':\r\n        if (secondValue === 0) {\r\n          return 0; //    Infinity    \r\n        }\r\n        return firstValue / secondValue;\r\n      case '=':\r\n        return secondValue;\r\n      default:\r\n        return secondValue;\r\n    }\r\n  };\r\n\r\n  const performCalculation = () => {\r\n    const inputValue = parseFloat(display);\r\n\r\n    if (previousValue !== null && operation) {\r\n      const newValue = calculate(previousValue, inputValue, operation);\r\n      setDisplay(String(newValue));\r\n      setPreviousValue(null);\r\n      setOperation(null);\r\n      setWaitingForOperand(true);\r\n    }\r\n  };\r\n\r\n  const clearAll = () => {\r\n    setDisplay('0');\r\n    setPreviousValue(null);\r\n    setOperation(null);\r\n    setWaitingForOperand(false);\r\n  };\r\n\r\n  const clearEntry = () => {\r\n    setDisplay('0');\r\n  };\r\n\r\n  const inputDecimal = () => {\r\n    if (waitingForOperand) {\r\n      setDisplay('0.');\r\n      setWaitingForOperand(false);\r\n    } else if (display.indexOf('.') === -1) {\r\n      setDisplay(display + '.');\r\n    }\r\n  };\r\n\r\n  const toggleSign = () => {\r\n    if (display !== '0') {\r\n      setDisplay(display.charAt(0) === '-' ? display.slice(1) : '-' + display);\r\n    }\r\n  };\r\n\r\n  const percentage = () => {\r\n    const value = parseFloat(display);\r\n    setDisplay(String(value / 100));\r\n  };\r\n\r\n  //   \r\n  const handleKeyPress = (event: KeyboardEvent) => {\r\n    const key = event.key;\r\n    \r\n    //    \r\n    event.preventDefault();\r\n    \r\n    //  0-9\r\n    if (key >= '0' && key <= '9') {\r\n      inputNumber(key);\r\n    }\r\n    //  \r\n    else if (key === '+') {\r\n      inputOperation('+');\r\n    }\r\n    else if (key === '-') {\r\n      inputOperation('-');\r\n    }\r\n    else if (key === '*') {\r\n      inputOperation('');\r\n    }\r\n    else if (key === '/') {\r\n      inputOperation('');\r\n    }\r\n    //  \r\n    else if (key === 'Enter' || key === '=') {\r\n      performCalculation();\r\n    }\r\n    else if (key === 'Escape' || key === 'c' || key === 'C') {\r\n      clearAll();\r\n    }\r\n    else if (key === 'Backspace') {\r\n      clearEntry();\r\n    }\r\n    else if (key === '.') {\r\n      inputDecimal();\r\n    }\r\n    else if (key === '%') {\r\n      percentage();\r\n    }\r\n  };\r\n\r\n  //   event listener  /  \r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      document.addEventListener('keydown', handleKeyPress);\r\n    } else {\r\n      document.removeEventListener('keydown', handleKeyPress);\r\n    }\r\n\r\n    //    \r\n    return () => {\r\n      document.removeEventListener('keydown', handleKeyPress);\r\n    };\r\n  }, [isOpen, display, previousValue, operation, waitingForOperand]);\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={(open) => !open && onClose()}>\r\n      <DialogContent className=\"sm:max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            <Calculator className=\"h-5 w-5\" />\r\n             \r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <div className=\"space-y-4\">\r\n          {/*   */}\r\n          <div className=\"bg-gray-900 text-white p-4 rounded-lg text-right\">\r\n            <div className=\"text-3xl font-mono font-bold min-h-[3rem] flex items-center justify-end overflow-hidden\">\r\n              {display}\r\n            </div>\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"grid grid-cols-4 gap-2\">\r\n            {/*   */}\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-gray-100 hover:bg-gray-200\"\r\n              onClick={clearAll}\r\n            >\r\n              AC\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-gray-100 hover:bg-gray-200\"\r\n              onClick={clearEntry}\r\n            >\r\n              CE\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-gray-100 hover:bg-gray-200\"\r\n              onClick={percentage}\r\n            >\r\n              %\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600\"\r\n              onClick={() => inputOperation('')}\r\n            >\r\n              \r\n            </Button>\r\n\r\n            {/*   */}\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('7')}\r\n            >\r\n              7\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('8')}\r\n            >\r\n              8\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('9')}\r\n            >\r\n              9\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600\"\r\n              onClick={() => inputOperation('')}\r\n            >\r\n              \r\n            </Button>\r\n\r\n            {/*   */}\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('4')}\r\n            >\r\n              4\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('5')}\r\n            >\r\n              5\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('6')}\r\n            >\r\n              6\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600\"\r\n              onClick={() => inputOperation('-')}\r\n            >\r\n              -\r\n            </Button>\r\n\r\n            {/*   */}\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('1')}\r\n            >\r\n              1\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('2')}\r\n            >\r\n              2\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('3')}\r\n            >\r\n              3\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600\"\r\n              onClick={() => inputOperation('+')}\r\n            >\r\n              +\r\n            </Button>\r\n\r\n            {/*   */}\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50 col-span-2\"\r\n              onClick={() => inputNumber('0')}\r\n            >\r\n              0\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={inputDecimal}\r\n            >\r\n              .\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600\"\r\n              onClick={performCalculation}\r\n            >\r\n              =\r\n            </Button>\r\n          </div>\r\n\r\n          {/*     */}\r\n          <Button\r\n            variant=\"outline\"\r\n            className=\"w-full h-10 text-sm font-semibold bg-gray-100 hover:bg-gray-200\"\r\n            onClick={toggleSign}\r\n          >\r\n            +/-\r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\nexport default CalculatorDialog;","import React, { useState, useEffect, useMemo } from 'react';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { db } from '@/firebase';\r\nimport { collection, addDoc, serverTimestamp, query, where, limit, getDocs, updateDoc, deleteDoc, doc, onSnapshot, setDoc } from 'firebase/firestore';\r\nimport { X, Plus, Edit, Edit3, Trash2, Save, XCircle, DollarSign, Package, TrendingUp, Calculator, BookOpen, ChevronDown, ChevronUp, Calendar, Clock, BarChart3, Target, Award, TrendingDown, AlertCircle, Info, ChevronLeft, ChevronRight, Eye, EyeOff, Receipt } from 'lucide-react';\r\nimport { getUserSubscription, SubscriptionPlan } from '@/utils/subscriptionService';\r\nimport { useShift } from '@/contexts/ShiftContext';\r\nimport { userDataService, telegramNotifier } from '@/integrations/firebase/services';\r\nimport { useShop } from '@/hooks/useShop';\r\n\r\ninterface SalesDataDialogProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  initialBarcode?: string | null;\r\n}\r\n\r\ninterface SaleItem {\r\n  id: string;\r\n  productName: string;\r\n  price: number;\r\n  wholesalePrice?: number;\r\n  quantity: number;\r\n  date: string;\r\n  time: string;\r\n  performedByType?: 'cashier' | 'admin';\r\n  performedByName?: string;\r\n  performedByUsername?: string | null;\r\n  serialNumber?: string;\r\n  barcode?: string;\r\n  firestoreId?: string;\r\n  isDeferred?: boolean;\r\n  customerName?: string;\r\n  customerMobile?: string;\r\n  customerId?: string;\r\n  createdAtMs?: number;\r\n}\r\n\r\ninterface NewProduct {\r\n  productName: string;\r\n  price: string;\r\n  wholesalePrice?: string;\r\n  quantity: string;\r\n  barcode?: string;\r\n  serialNumber?: string;\r\n}\r\n\r\ninterface ShopProduct {\r\n  id: string;\r\n  name: string;\r\n  sellingPrice: number;\r\n  wholesalePrice: number;\r\n  quantity: number;\r\n  barcode?: string;\r\n  serialNumber?: string;\r\n}\r\n\r\nexport function SalesDataDialog({ isOpen, onClose, initialBarcode }: SalesDataDialogProps) {\r\n  const [salesData, setSalesData] = useState<SaleItem[]>([]);\r\n  const [newProduct, setNewProduct] = useState<NewProduct>({ productName: '', price: '', wholesalePrice: '', quantity: '', barcode: '', serialNumber: '' });\r\n  const [isAddProductOpen, setIsAddProductOpen] = useState<boolean>(false);\r\n  const [editingId, setEditingId] = useState<string | null>(null);\r\n  //  :    /  \r\n  const { toast } = useToast();\r\n  const { user, profile } = useFirebaseAuth();\r\n  const { isShiftActive, shiftUser } = useShift();\r\n  const { shopId: shopIdCtx } = useShop();\r\n  const [shopProducts, setShopProducts] = useState<ShopProduct[]>([]);\r\nconst [sellingQtyByProduct, setSellingQtyByProduct] = useState<Record<string, string>>({});\r\nconst [addQtyByProduct, setAddQtyByProduct] = useState<Record<string, string>>({});\r\nconst [serialByProduct, setSerialByProduct] = useState<Record<string, string>>({});\r\nconst [scannedBarcode, setScannedBarcode] = useState<string>('');\r\nconst [isInvoiceMode, setIsInvoiceMode] = useState<boolean>(false);\r\nconst [invoiceSelections, setInvoiceSelections] = useState<Record<string, number>>({});\r\n// /     \r\nconst [isWholesaleVisible, setIsWholesaleVisible] = useState<boolean>(false);\r\n//      \r\n  const [isProfitLocked, setIsProfitLocked] = useState<boolean>(true);\r\n  const [isProfitPinDialogOpen, setIsProfitPinDialogOpen] = useState<boolean>(false);\r\nconst barcodeBufferRef = React.useRef<string>('');\r\nconst lastKeyTimeRef = React.useRef<number>(0);\r\n  const [monthlySalesTotal, setMonthlySalesTotal] = useState<number>(0);\r\n  const [monthlyProfitTotal, setMonthlyProfitTotal] = useState<number>(0);\r\n  const [isMasterPinDialogOpen, setIsMasterPinDialogOpen] = useState<boolean>(false);\r\n  const [isMonthlyLocked, setIsMonthlyLocked] = useState<boolean>(true);\r\nconst [isMonthlyCollapsed, setIsMonthlyCollapsed] = useState<boolean>(false);\r\nconst [isSalesReceiptsDialogOpen, setIsSalesReceiptsDialogOpen] = useState<boolean>(false);\r\n//  :        \r\nconst [isProductStatsCollapsed, setIsProductStatsCollapsed] = useState<boolean>(true);\r\nconst [isTipsCollapsed, setIsTipsCollapsed] = useState<boolean>(true);\r\n  //        \r\n  const [sellingPriceOverrideByProduct, setSellingPriceOverrideByProduct] = useState<Record<string, string>>({});\r\n  //        (/)\r\n  const [isMasterPinActionOpen, setIsMasterPinActionOpen] = useState<boolean>(false);\r\n  const [masterPinActionTitle, setMasterPinActionTitle] = useState<string>('  ');\r\n  const [masterPinActionDescription, setMasterPinActionDescription] = useState<string>('    ');\r\n  const protectedActionRef = React.useRef<(() => void) | null>(null);\r\n  const requireMasterPin = (title: string, description: string, action: () => Promise<void> | void) => {\r\n    setMasterPinActionTitle(title);\r\n    setMasterPinActionDescription(description);\r\n    protectedActionRef.current = action;\r\n    setIsMasterPinActionOpen(true);\r\n  };\r\n  const [customers, setCustomers] = useState<{ id: string; name: string; mobile?: string }[]>([]);\r\n  const [isDeferredFormOpen, setIsDeferredFormOpen] = useState<boolean>(false);\r\n  const [deferredCustomerId, setDeferredCustomerId] = useState<string>('');\r\n  const [deferredCustomerName, setDeferredCustomerName] = useState<string>('');\r\n  const [deferredCustomerMobile, setDeferredCustomerMobile] = useState<string>('');\r\n  const [pendingDeferredProduct, setPendingDeferredProduct] = useState<ShopProduct | null>(null);\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        if (!isOpen || !user?.uid) return;\r\n        const data = await userDataService.getUserData(user.uid);\r\n        const list = Array.isArray(data?.customers) ? data.customers.map((c: any) => ({ id: String(c.id || ''), name: String(c.name || ''), mobile: c.mobile || undefined })) : [];\r\n        setCustomers(list);\r\n      } catch {}\r\n    })();\r\n  }, [isOpen, user?.uid]);\r\n  //    /\r\n  const [isDeleteConfirmOpen, setIsDeleteConfirmOpen] = useState<boolean>(false);\r\n  const [deleteTargetSale, setDeleteTargetSale] = useState<SaleItem | null>(null);\r\n  const [deleteActionType, setDeleteActionType] = useState<'return' | 'delete' | null>(null);\r\n  const openDeleteConfirm = (sale: SaleItem, type: 'return' | 'delete') => {\r\n    setDeleteTargetSale(sale);\r\n    setDeleteActionType(type);\r\n    setIsDeleteConfirmOpen(true);\r\n  };\r\n  //    \r\n  const [productSearchTerm, setProductSearchTerm] = useState<string>('');\r\n  const filteredShopProducts = useMemo(() => {\r\n    const term = productSearchTerm.trim().toLowerCase();\r\n    if (!term) return shopProducts;\r\n    return shopProducts.filter(p => p.name.toLowerCase().includes(term));\r\n  }, [shopProducts, productSearchTerm]);\r\n\r\n  const getUtcDateYYYYMMDD = () => new Date().toISOString().split('T')[0];\r\n\r\n  //        \r\n  useEffect(() => {\r\n    if (isOpen && user?.uid) {\r\n      loadSalesData();\r\n      //          PIN \r\n      if (!isMonthlyLocked) {\r\n        loadMonthlyStats();\r\n      }\r\n    }\r\n  }, [isOpen, user?.uid, isMonthlyLocked]);\r\n\r\n  useEffect(() => {\r\n    if (!isOpen || !user?.uid) return;\r\n    try {\r\n      const todayUtc = getUtcDateYYYYMMDD();\r\n      const todayCairo = new Intl.DateTimeFormat('en-CA', { timeZone: 'Africa/Cairo' }).format(new Date());\r\n      const nextHandler = (snap: any) => {\r\n        try {\r\n          const remote: SaleItem[] = snap.docs.map((d: any) => {\r\n            const v: any = d.data();\r\n            return {\r\n              id: String(v.clientId || d.id),\r\n              productName: String(v.productName || ''),\r\n              price: Number(v.sellingPrice || 0),\r\n              wholesalePrice: typeof v.wholesalePrice === 'number' ? v.wholesalePrice : Number(v.wholesalePrice || 0),\r\n              quantity: Number(v.quantity || 0),\r\n              date: String(v.date || todayUtc),\r\n              time: String(v.time || ''),\r\n              performedByType: (v.performedByType || undefined),\r\n              performedByName: (v.performedByName || undefined),\r\n              performedByUsername: (v.performedByUsername || null),\r\n              serialNumber: (v.serialNumber || undefined),\r\n              barcode: (v.barcode || undefined),\r\n              firestoreId: d.id,\r\n            };\r\n          });\r\n          const localUnsynced = (salesData || []).filter(s => !s.firestoreId);\r\n          const byId: Record<string, SaleItem> = {} as any;\r\n          [...remote, ...localUnsynced].forEach(it => { byId[it.id] = it; });\r\n          const merged = Object.values(byId);\r\n          saveSalesData(merged);\r\n        } catch {}\r\n      };\r\n      let unsub: any;\r\n      try {\r\n        const sidSnap = shopIdCtx || (profile as any)?.shopId || null;\r\n        const qRoot = query(\r\n          collection(db, 'dailySales'),\r\n          where('userId', '==', user.uid),\r\n          ...(sidSnap ? [where('shopId', '==', sidSnap)] : [])\r\n        );\r\n        unsub = onSnapshot(qRoot, nextHandler, () => {\r\n          try { unsub && unsub(); } catch {}\r\n          const qUser = query(\r\n            collection(db, 'users', user.uid, 'dailySales'),\r\n            ...(sidSnap ? [where('shopId', '==', sidSnap)] : [])\r\n          );\r\n          unsub = onSnapshot(qUser, nextHandler);\r\n        });\r\n      } catch {\r\n        const sidSnap = shopIdCtx || (profile as any)?.shopId || null;\r\n        const qUser = query(\r\n          collection(db, 'users', user.uid, 'dailySales'),\r\n          ...(sidSnap ? [where('shopId', '==', sidSnap)] : [])\r\n        );\r\n        unsub = onSnapshot(qUser, nextHandler);\r\n      }\r\n      return () => { try { unsub && unsub(); } catch {} };\r\n    } catch {}\r\n  }, [isOpen, user?.uid]);\r\n\r\n  //       (   )\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    const handler = (e: KeyboardEvent) => {\r\n      //        input/textarea    \r\n      const target = e.target as HTMLElement | null;\r\n      const tag = target?.tagName?.toLowerCase();\r\n      const isTyping = tag === 'input' || tag === 'textarea' || !!(target && (target as any).isContentEditable);\r\n      if (isTyping) return;\r\n      //    PIN        \r\n      if (isMasterPinActionOpen || isMasterPinDialogOpen || isProfitPinDialogOpen) return;\r\n\r\n      const now = Date.now();\r\n      if (e.key === 'Enter') {\r\n        const code = (barcodeBufferRef.current || '').trim();\r\n        barcodeBufferRef.current = '';\r\n        if (code) {\r\n          processBarcode(code);\r\n        }\r\n        return;\r\n      }\r\n      if (e.key.length === 1) {\r\n        if (now - (lastKeyTimeRef.current || 0) > 100) {\r\n          barcodeBufferRef.current = '';\r\n        }\r\n        barcodeBufferRef.current += e.key;\r\n        lastKeyTimeRef.current = now;\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handler as unknown as EventListener);\r\n    return () => window.removeEventListener('keydown', handler as unknown as EventListener);\r\n  }, [isOpen, shopProducts, isMasterPinActionOpen, isMasterPinDialogOpen, isProfitPinDialogOpen]);\r\n\r\n  //        \r\n  useEffect(() => {\r\n    if (isOpen && initialBarcode) {\r\n      processBarcode(initialBarcode);\r\n    }\r\n  }, [isOpen, initialBarcode]);\r\n\r\n  //     Firestore\r\n  const loadShopProducts = async () => {\r\n    if (!user?.uid) return;\r\n    try {\r\n      const shopId = profile?.shopId;\r\n      let snap;\r\n      let products: ShopProduct[] = [];\r\n\r\n      //         \r\n      if (shopId) {\r\n        const byUserAndShop = query(\r\n          collection(db, 'products'),\r\n          where('shopId', '==', shopId),\r\n          where('userId', '==', user.uid)\r\n        );\r\n        snap = await getDocs(byUserAndShop);\r\n        products = snap.docs.map(d => ({\r\n          id: d.id,\r\n          name: String(d.data().name ?? ''),\r\n          sellingPrice: Number(d.data().sellingPrice ?? 0),\r\n          wholesalePrice: Number(d.data().wholesalePrice ?? 0),\r\n          quantity: Number(d.data().quantity ?? 0),\r\n          barcode: String(d.data().barcode ?? ''),\r\n          serialNumber: String(d.data().serialNumber ?? ''),\r\n        }));\r\n\r\n        //  :          \r\n        if (products.length === 0) {\r\n          const byUserOnly = query(\r\n            collection(db, 'products'),\r\n            where('userId', '==', user.uid)\r\n          );\r\n          const fallbackSnap = await getDocs(byUserOnly);\r\n          const fallbackProducts: ShopProduct[] = fallbackSnap.docs.map(d => ({\r\n            id: d.id,\r\n            name: String(d.data().name ?? ''),\r\n            sellingPrice: Number(d.data().sellingPrice ?? 0),\r\n            wholesalePrice: Number(d.data().wholesalePrice ?? 0),\r\n            quantity: Number(d.data().quantity ?? 0),\r\n            barcode: String(d.data().barcode ?? ''),\r\n            serialNumber: String(d.data().serialNumber ?? ''),\r\n          }));\r\n\r\n          if (fallbackProducts.length > 0) {\r\n            products = fallbackProducts;\r\n            //        /\r\n            toast({\r\n              title: '  ',\r\n              description: '         .',\r\n            });\r\n          }\r\n        }\r\n      } else {\r\n        const byUser = query(\r\n          collection(db, 'products'),\r\n          where('userId', '==', user.uid)\r\n        );\r\n        snap = await getDocs(byUser);\r\n        products = snap.docs.map(d => ({\r\n          id: d.id,\r\n          name: String(d.data().name ?? ''),\r\n          sellingPrice: Number(d.data().sellingPrice ?? 0),\r\n          wholesalePrice: Number(d.data().wholesalePrice ?? 0),\r\n          quantity: Number(d.data().quantity ?? 0),\r\n          barcode: String(d.data().barcode ?? ''),\r\n          serialNumber: String(d.data().serialNumber ?? ''),\r\n        }));\r\n      }\r\n\r\n      setShopProducts(products);\r\n\r\n      //  :        shopId   \r\n      if (profile?.shopId && products.length > 0) {\r\n        const missingShopProducts = products.filter(p => {\r\n          //       \r\n          const original = (snap?.docs || []).find(d => d.id === p.id);\r\n          const hasShopId = !!original && !!(original.data() as any).shopId;\r\n          return !hasShopId;\r\n        });\r\n        if (missingShopProducts.length > 0) {\r\n          try {\r\n            await Promise.all(\r\n              missingShopProducts.map(p => updateDoc(doc(db, 'products', p.id), {\r\n                shopId: profile.shopId,\r\n                updatedAt: serverTimestamp(),\r\n              }))\r\n            );\r\n            toast({\r\n              title: '  ',\r\n              description: '        .',\r\n            });\r\n          } catch (migrationError) {\r\n            console.warn('  shopId  :', migrationError);\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading shop products:', error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isOpen && user?.uid) {\r\n      loadShopProducts();\r\n      loadMonthlyStats();\r\n      loadSalesData();\r\n      recoverUnsyncedSalesToFirestore();\r\n    }\r\n  }, [isOpen, user?.uid, profile?.shopId]);\r\n\r\n  const getLocalDateYYYYMMDD = () => {\r\n    const d = new Date();\r\n    const y = d.getFullYear();\r\n    const m = String(d.getMonth() + 1).padStart(2, '0');\r\n    const dd = String(d.getDate()).padStart(2, '0');\r\n    return `${y}-${m}-${dd}`;\r\n  };\r\n\r\n  const sortSales = (arr: SaleItem[]) => {\r\n    const key = (it: SaleItem) => {\r\n      if (typeof it.createdAtMs === 'number') return it.createdAtMs;\r\n      const n = parseInt(it.id, 10);\r\n      if (!isNaN(n)) return n;\r\n      const dt = new Date(it.date);\r\n      return isNaN(dt.getTime()) ? 0 : dt.getTime();\r\n    };\r\n    return [...arr].sort((a, b) => key(b) - key(a));\r\n  };\r\n\r\n  const loadSalesData = () => {\r\n    if (!user?.uid) {\r\n      console.log('No user authenticated, cannot load sales data');\r\n      return;\r\n    }\r\n    const sid = shopIdCtx || (profile as any)?.shopId || 'main';\r\n    const allKey = `salesData_all_${user.uid}_${sid}`;\r\n    const savedAll = localStorage.getItem(allKey);\r\n    if (savedAll) {\r\n      try {\r\n        const parsed = JSON.parse(savedAll);\r\n        setSalesData(Array.isArray(parsed) ? sortSales(parsed) : []);\r\n        return;\r\n      } catch {}\r\n    }\r\n    const todayLocal = getLocalDateYYYYMMDD();\r\n    const localKey = `salesData_${user.uid}_${sid}_${todayLocal}`;\r\n    const savedLocal = localStorage.getItem(localKey);\r\n    if (savedLocal) {\r\n      const parsed = JSON.parse(savedLocal);\r\n      const sorted = Array.isArray(parsed) ? sortSales(parsed) : [];\r\n      setSalesData(sorted);\r\n      try { localStorage.setItem(allKey, JSON.stringify(sorted)); } catch {}\r\n      return;\r\n    }\r\n    const todayUtc = new Date().toISOString().split('T')[0];\r\n    const utcKey = `salesData_${user.uid}_${sid}_${todayUtc}`;\r\n    const savedUtc = localStorage.getItem(utcKey);\r\n    if (savedUtc) {\r\n      const parsed = JSON.parse(savedUtc);\r\n      const sorted = Array.isArray(parsed) ? sortSales(parsed) : [];\r\n      setSalesData(sorted);\r\n      try {\r\n        localStorage.setItem(localKey, JSON.stringify(sorted));\r\n        localStorage.setItem(allKey, JSON.stringify(sorted));\r\n      } catch {}\r\n      return;\r\n    }\r\n    syncSalesDataFromFirestore();\r\n  };\r\n\r\n  const saveSalesData = (data: SaleItem[]) => {\r\n    if (!user?.uid) {\r\n      console.log('No user authenticated, cannot save sales data');\r\n      return;\r\n    }\r\n    const sid = shopIdCtx || (profile as any)?.shopId || 'main';\r\n    const todayLocal = getLocalDateYYYYMMDD();\r\n    const localKey = `salesData_${user.uid}_${sid}_${todayLocal}`;\r\n    const allKey = `salesData_all_${user.uid}_${sid}`;\r\n    const sortedDay = sortSales(data);\r\n    localStorage.setItem(localKey, JSON.stringify(sortedDay));\r\n    try {\r\n      const existingAllRaw = localStorage.getItem(allKey);\r\n      const existingAll = existingAllRaw ? JSON.parse(existingAllRaw) : [];\r\n      const byId: Record<string, SaleItem> = {} as any;\r\n      [...(Array.isArray(existingAll) ? existingAll : []), ...sortedDay].forEach((item: SaleItem) => {\r\n        byId[item.id] = item;\r\n      });\r\n      const mergedAll = Object.values(byId) as SaleItem[];\r\n      const sortedAll = sortSales(mergedAll);\r\n      localStorage.setItem(allKey, JSON.stringify(sortedAll));\r\n    } catch {}\r\n    setSalesData(sortedDay);\r\n  };\r\n\r\n  const saveAllSalesData = (data: SaleItem[]) => {\r\n    if (!user?.uid) {\r\n      console.log('No user authenticated, cannot save sales data');\r\n      return;\r\n    }\r\n    const sid = shopIdCtx || (profile as any)?.shopId || 'main';\r\n    const allKey = `salesData_all_${user.uid}_${sid}`;\r\n    try {\r\n      const existingAllRaw = localStorage.getItem(allKey);\r\n      const existingAll = existingAllRaw ? JSON.parse(existingAllRaw) : [];\r\n      const byId: Record<string, SaleItem> = {} as any;\r\n      [...(Array.isArray(existingAll) ? existingAll : []), ...data].forEach((item: SaleItem) => {\r\n        byId[item.id] = item;\r\n      });\r\n      const mergedAll = Object.values(byId) as SaleItem[];\r\n      const sortedAll = sortSales(mergedAll);\r\n      localStorage.setItem(allKey, JSON.stringify(sortedAll));\r\n    } catch {}\r\n    const sortedDay = sortSales(data);\r\n    setSalesData(sortedDay);\r\n  };\r\n\r\n  const syncSalesDataFromFirestore = async () => {\r\n    if (!user?.uid) return;\r\n    try {\r\n      const sid = shopIdCtx || (profile as any)?.shopId || null;\r\n      const todayUtc = new Date().toISOString().split('T')[0];\r\n      const todayCairo = new Intl.DateTimeFormat('en-CA', { timeZone: 'Africa/Cairo' }).format(new Date());\r\n      let snap1, snap2;\r\n      try {\r\n        const q1 = query(\r\n          collection(db, 'dailySales'),\r\n          where('userId', '==', user.uid),\r\n          ...(sid ? [where('shopId', '==', sid)] : [])\r\n        );\r\n        snap1 = await getDocs(q1);\r\n      } catch {}\r\n      try {\r\n        const q2 = query(\r\n          collection(db, 'users', user.uid, 'dailySales'),\r\n          ...(sid ? [where('shopId', '==', sid)] : [])\r\n        );\r\n        snap2 = await getDocs(q2);\r\n      } catch {}\r\n      const docs = [\r\n        ...(snap1 ? snap1.docs : []),\r\n        ...(snap2 ? snap2.docs : []),\r\n      ];\r\n      const remote = docs.map(d => {\r\n        const x: any = d.data();\r\n        return {\r\n          id: String(x.clientId || d.id),\r\n          firestoreId: d.id,\r\n          productName: String(x.productName || ''),\r\n          price: Number(x.sellingPrice || 0),\r\n          wholesalePrice: x.wholesalePrice !== undefined ? Number(x.wholesalePrice) : null,\r\n          quantity: Number(x.quantity || 0),\r\n          date: String(x.date || todayUtc),\r\n          time: String(x.time || ''),\r\n          serialNumber: x.serialNumber || undefined,\r\n          barcode: x.barcode || undefined,\r\n          performedByType: x.performedByType || undefined,\r\n          performedByName: x.performedByName || undefined,\r\n          performedByUsername: x.performedByUsername || undefined,\r\n          isDeferred: !!x.isDeferred,\r\n          customerName: x.customerName || undefined,\r\n          customerMobile: x.customerMobile || undefined,\r\n          customerId: x.customerId || undefined,\r\n          createdAtMs: x?.createdAt?.toDate?.() ? x.createdAt.toDate().getTime() : (new Date(String(x.date || todayUtc)).getTime()),\r\n        } as SaleItem;\r\n      });\r\n      const byId: Record<string, SaleItem> = {} as any;\r\n      [...salesData, ...remote].forEach((s: any) => { byId[s.id] = s; });\r\n      const merged = Object.values(byId) as SaleItem[];\r\n      saveAllSalesData(merged);\r\n    } catch {}\r\n  };\r\n\r\n  //     Firestore\r\n  const loadMonthlyStats = async () => {\r\n    if (!user?.uid) return;\r\n    try {\r\n      const now = new Date();\r\n      const start = new Date(now.getFullYear(), now.getMonth(), 1);\r\n      const end = new Date(now.getFullYear(), now.getMonth() + 1, 0);\r\n      const toDateStr = (d: Date) => d.toISOString().split('T')[0];\r\n      const startStr = toDateStr(start);\r\n      const endStr = toDateStr(end);\r\n      const sidMonthly = shopIdCtx || (profile as any)?.shopId || null;\r\n      let snap;\r\n      try {\r\n        const byUserShop = query(\r\n          collection(db, 'dailySales'),\r\n          where('userId', '==', user.uid),\r\n          ...(sidMonthly ? [where('shopId', '==', sidMonthly)] : [])\r\n        );\r\n        snap = await getDocs(byUserShop);\r\n      } catch {\r\n        const byUserShopNested = query(\r\n          collection(db, 'users', user.uid, 'dailySales'),\r\n          ...(sidMonthly ? [where('shopId', '==', sidMonthly)] : [])\r\n        );\r\n        snap = await getDocs(byUserShopNested);\r\n      }\r\n      let sales = 0;\r\n      let profit = 0;\r\n      snap.forEach(docSnap => {\r\n        const d = docSnap.data() as any;\r\n        const dateStr = String(d.date ?? '').slice(0, 10);\r\n        if (d.isDeferred) return;\r\n        if (dateStr >= startStr && dateStr <= endStr) {\r\n          const sellingPrice = Number(d.sellingPrice ?? 0);\r\n          const qty = Number(d.quantity ?? 0);\r\n          const pr = Number(d.profit ?? ((Number(d.sellingPrice ?? 0) - Number(d.wholesalePrice ?? 0)) * qty));\r\n          sales += sellingPrice * qty;\r\n          profit += pr;\r\n        }\r\n      });\r\n\r\n      setMonthlySalesTotal(sales);\r\n      setMonthlyProfitTotal(profit);\r\n    } catch (error) {\r\n      console.error('Error loading monthly stats:', error);\r\n    }\r\n  };\r\n\r\n  //     Firebase   \r\n  const saveSaleToFirebase = async (sale: SaleItem): Promise<string | null> => {\r\n    if (!user?.uid) return null;\r\n    try {\r\n      const profit = ((sale.price ?? 0) - (sale.wholesalePrice ?? 0)) * (sale.quantity ?? 0);\r\n      const performedByType = isShiftActive && shiftUser ? 'cashier' : 'admin';\r\n      const performedByName = performedByType === 'cashier' ? (shiftUser?.name || '') : (profile?.fullName || user?.displayName || ' ');\r\n      const performedByUsername = performedByType === 'cashier' ? (shiftUser?.username || null) : null;\r\n      const docRef = await addDoc(collection(db, 'dailySales'), {\r\n        userId: user.uid,\r\n        clientId: sale.id,\r\n        productName: sale.productName,\r\n        quantity: sale.quantity,\r\n        wholesalePrice: sale.wholesalePrice ?? null,\r\n        sellingPrice: sale.price,\r\n        profit,\r\n        date: sale.date,\r\n        time: sale.time,\r\n        performedByType,\r\n        performedByName,\r\n        performedByUsername,\r\n        serialNumber: sale.serialNumber ?? null,\r\n        barcode: sale.barcode ?? null,\r\n        isDeferred: !!sale.isDeferred,\r\n        customerName: sale.customerName || null,\r\n        customerMobile: sale.customerMobile || null,\r\n        customerId: sale.customerId || null,\r\n        ...(profile?.shopId ? { shopId: profile.shopId } : (shopIdCtx ? { shopId: shopIdCtx } : {})),\r\n        createdAt: serverTimestamp()\r\n      });\r\n      try {\r\n        await setDoc(doc(db, 'users', user.uid, 'dailySales', docRef.id), {\r\n          userId: user.uid,\r\n          clientId: sale.id,\r\n          productName: sale.productName,\r\n          quantity: sale.quantity,\r\n          wholesalePrice: sale.wholesalePrice ?? null,\r\n          sellingPrice: sale.price,\r\n          profit,\r\n          date: sale.date,\r\n          time: sale.time,\r\n          performedByType,\r\n          performedByName,\r\n          performedByUsername,\r\n          serialNumber: sale.serialNumber ?? null,\r\n          barcode: sale.barcode ?? null,\r\n          isDeferred: !!sale.isDeferred,\r\n          customerName: sale.customerName || null,\r\n          customerMobile: sale.customerMobile || null,\r\n          customerId: sale.customerId || null,\r\n          ...(profile?.shopId ? { shopId: profile.shopId } : (shopIdCtx ? { shopId: shopIdCtx } : {})),\r\n          createdAt: serverTimestamp()\r\n        });\r\n      } catch {}\r\n      return docRef.id;\r\n    } catch {\r\n      try {\r\n        const docRef2 = await addDoc(collection(db, 'users', user.uid, 'dailySales'), {\r\n          userId: user.uid,\r\n          clientId: sale.id,\r\n          productName: sale.productName,\r\n          quantity: sale.quantity,\r\n          wholesalePrice: sale.wholesalePrice ?? null,\r\n          sellingPrice: sale.price,\r\n          profit,\r\n          date: sale.date,\r\n          time: sale.time,\r\n          performedByType,\r\n          performedByName,\r\n          performedByUsername,\r\n          serialNumber: sale.serialNumber ?? null,\r\n          barcode: sale.barcode ?? null,\r\n          isDeferred: !!sale.isDeferred,\r\n          customerName: sale.customerName || null,\r\n          customerMobile: sale.customerMobile || null,\r\n          customerId: sale.customerId || null,\r\n          ...(profile?.shopId ? { shopId: profile.shopId } : (shopIdCtx ? { shopId: shopIdCtx } : {})),\r\n          createdAt: serverTimestamp()\r\n        });\r\n        try {\r\n          await setDoc(doc(db, 'dailySales', docRef2.id), {\r\n            userId: user.uid,\r\n            clientId: sale.id,\r\n            productName: sale.productName,\r\n            quantity: sale.quantity,\r\n            wholesalePrice: sale.wholesalePrice ?? null,\r\n            sellingPrice: sale.price,\r\n            profit,\r\n            date: sale.date,\r\n            time: sale.time,\r\n            performedByType,\r\n            performedByName,\r\n            performedByUsername,\r\n            serialNumber: sale.serialNumber ?? null,\r\n            barcode: sale.barcode ?? null,\r\n            isDeferred: !!sale.isDeferred,\r\n            customerName: sale.customerName || null,\r\n            customerMobile: sale.customerMobile || null,\r\n            customerId: sale.customerId || null,\r\n            ...(profile?.shopId ? { shopId: profile.shopId } : (shopIdCtx ? { shopId: shopIdCtx } : {})),\r\n            createdAt: serverTimestamp()\r\n          });\r\n        } catch {}\r\n        return docRef2.id;\r\n      } catch (error) {\r\n        console.error('Error saving sale:', error);\r\n        return null;\r\n      }\r\n    }\r\n  };\r\n\r\n  //      \r\n  const getCashBalanceKey = () => {\r\n    const sid = shopIdCtx || (profile as any)?.shopId || 'main';\r\n    return `cashBalance_${user?.uid || 'default'}_${sid}`;\r\n  };\r\n\r\n  //     Firebase\r\n  const updateSaleInFirebase = async (id: string, updatedFields: Partial<SaleItem>) => {\r\n    if (!user?.uid) return;\r\n    try {\r\n      const saleDoc = doc(db, 'dailySales', id);\r\n      await updateDoc(saleDoc, updatedFields as any);\r\n    } catch {\r\n      try {\r\n        const saleDoc2 = doc(db, 'users', user.uid, 'dailySales', id);\r\n        await updateDoc(saleDoc2, updatedFields as any);\r\n      } catch (error) {\r\n        console.error('Error updating sale:', error);\r\n      }\r\n    }\r\n  };\r\n\r\n  const markDeferredSalePaid = async (sale: SaleItem) => {\r\n    try {\r\n      const id = sale.firestoreId;\r\n      if (id) {\r\n        await updateSaleInFirebase(id, { isDeferred: false } as any);\r\n      } else {\r\n        try {\r\n          const q = query(\r\n            collection(db, 'dailySales'),\r\n            where('userId', '==', user?.uid || ''),\r\n            where('date', '==', sale.date),\r\n            where('productName', '==', sale.productName),\r\n            limit(5)\r\n          );\r\n          const snap = await getDocs(q);\r\n          const target = snap.docs[0];\r\n          if (target) await updateDoc(target.ref, { isDeferred: false } as any);\r\n        } catch {}\r\n      }\r\n      setSalesData(prev => prev.map(s => s.id === sale.id ? { ...s, isDeferred: false } : s));\r\n      try { await loadMonthlyStats(); } catch {}\r\n      toast({ title: ' ', description: `   ${sale.productName}` });\r\n    } catch (error) {\r\n      console.error('Error marking deferred sale as paid:', error);\r\n      toast({ title: ' ', description: '    ', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  const recoverUnsyncedSalesToFirestore = async () => {\r\n    if (!user?.uid) return;\r\n    const unsynced = salesData.filter(s => !s.firestoreId);\r\n    if (unsynced.length === 0) return;\r\n    for (const sale of unsynced) {\r\n      try {\r\n        let existingSnap;\r\n        try {\r\n          const existingQ = query(\r\n            collection(db, 'dailySales'),\r\n            where('userId', '==', user.uid),\r\n            where('clientId', '==', sale.id),\r\n            limit(1)\r\n          );\r\n          existingSnap = await getDocs(existingQ);\r\n        } catch {\r\n          const existingQ2 = query(\r\n            collection(db, 'users', user.uid, 'dailySales'),\r\n            where('clientId', '==', sale.id),\r\n            limit(1)\r\n          );\r\n          existingSnap = await getDocs(existingQ2);\r\n        }\r\n        if (!existingSnap.empty) {\r\n          const docId = existingSnap.docs[0].id;\r\n          const updated = salesData.map(s => s.id === sale.id ? { ...s, firestoreId: docId } : s);\r\n          saveSalesData(updated);\r\n          continue;\r\n        }\r\n        const docId = await saveSaleToFirebase(sale);\r\n        if (docId) {\r\n          const updated = salesData.map(s => s.id === sale.id ? { ...s, firestoreId: docId } : s);\r\n          saveSalesData(updated);\r\n        }\r\n      } catch {}\r\n    }\r\n  };\r\n\r\n  //       (Firestore   )\r\n  const addOutOfStockDeficiency = async (productName: string) => {\r\n    try {\r\n      if (user?.uid) {\r\n        try {\r\n          const ref = collection(db, 'deficiencies');\r\n          const docRef = await addDoc(ref, {\r\n            shopId: (profile?.shopId || user.uid || 'default-shop'),\r\n            name: productName,\r\n            quantity: 1,\r\n            status: 'pending',\r\n            createdAt: serverTimestamp(),\r\n          });\r\n          //         /\r\n          try {\r\n            const key = `deficiencies_${(profile?.shopId || user?.uid || 'default-shop')}`;\r\n            const raw = localStorage.getItem(key);\r\n            const list = raw ? JSON.parse(raw) : [];\r\n            const safeList = Array.isArray(list) ? list : [];\r\n            const exists = safeList.some((d: any) => String(d?.id || '') === docRef.id);\r\n            const optimisticItem = {\r\n              id: docRef.id,\r\n              name: productName,\r\n              quantity: 1,\r\n              status: 'pending',\r\n              createdAt: new Date().toISOString(),\r\n            };\r\n            const updatedOptimistic = exists ? safeList : [...safeList, optimisticItem];\r\n            localStorage.setItem(key, JSON.stringify(updatedOptimistic));\r\n          } catch {}\r\n          toast({ title: '  ', description: ` ${productName}      ` });\r\n          return;\r\n        } catch (err) {\r\n          console.warn('Failed to add deficiency to Firestore, falling back to local storage:', err);\r\n        }\r\n      }\r\n      const key = `deficiencies_${(profile?.shopId || user?.uid || 'default-shop')}`;\r\n      const raw = localStorage.getItem(key);\r\n      const list = raw ? JSON.parse(raw) : [];\r\n      const safeList = Array.isArray(list) ? list : [];\r\n      const exists = safeList.some((d: any) => String(d?.name || '').trim() === productName && String(d?.status || 'pending') === 'pending');\r\n      if (exists) return;\r\n      const newItem = {\r\n        id: Date.now().toString(),\r\n        name: productName,\r\n        quantity: 1,\r\n        status: 'pending',\r\n        createdAt: new Date().toISOString(),\r\n      };\r\n      const updated = [...safeList, newItem];\r\n      localStorage.setItem(key, JSON.stringify(updated));\r\n      toast({ title: '  ', description: ` ${productName}      ` });\r\n    } catch (e) {\r\n      console.error('Error adding deficiency for out-of-stock:', e);\r\n    }\r\n  };\r\n\r\n  //     \r\n  const sellProduct = async (product: ShopProduct, isDeferred = false, customer?: { id?: string; name: string; mobile?: string }) => {\r\n    const qtyStr = sellingQtyByProduct[product.id] || '';\r\n    const qty = parseInt(qtyStr);\r\n    if (isNaN(qty) || qty <= 0) {\r\n      toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n      return;\r\n    }\r\n    if (qty > product.quantity) {\r\n      toast({ title: '   ', description: '     ', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    const now = new Date();\r\n    const performedByType = isShiftActive && shiftUser ? 'cashier' : 'admin';\r\n    const performedByName = performedByType === 'cashier' ? (shiftUser?.name || '') : (profile?.fullName || user?.displayName || ' ');\r\n    const performedByUsername = performedByType === 'cashier' ? (shiftUser?.username || null) : null;\r\n\r\n    const serial = (product.serialNumber || '').trim();\r\n    //       \r\n    const overrideStr = sellingPriceOverrideByProduct[product.id] || '';\r\n    const overridePrice = parseFloat(overrideStr);\r\n    const usedPrice = (!isNaN(overridePrice) && overridePrice > 0) ? overridePrice : product.sellingPrice;\r\n    const sale: SaleItem = {\r\n      id: Date.now().toString(),\r\n      productName: product.name,\r\n      price: usedPrice,\r\n      wholesalePrice: product.wholesalePrice,\r\n      quantity: qty,\r\n      date: now.toISOString().split('T')[0],\r\n      time: now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }),\r\n      createdAtMs: now.getTime(),\r\n      performedByType,\r\n      performedByName,\r\n      performedByUsername,\r\n      serialNumber: serial || undefined,\r\n      barcode: product.barcode,\r\n      isDeferred,\r\n      customerName: customer?.name,\r\n      customerMobile: customer?.mobile,\r\n      customerId: customer?.id,\r\n    };\r\n\r\n    try {\r\n      //            \r\n      const docId = await saveSaleToFirebase(sale);\r\n      const saleWithId: SaleItem = docId ? { ...sale, firestoreId: docId } : sale;\r\n      saveSalesData([...salesData, saleWithId]);\r\n      //       Firestore\r\n      const newQty = product.quantity - qty;\r\n      await updateDoc(doc(db, 'products', product.id), { quantity: newQty, updatedAt: serverTimestamp() });\r\n      setShopProducts(prev => prev.map(p => p.id === product.id ? { ...p, quantity: newQty } : p));\r\n      setSellingQtyByProduct(prev => ({ ...prev, [product.id]: '' }));\r\n      setSellingPriceOverrideByProduct(prev => ({ ...prev, [product.id]: '' }));\r\n      if (newQty === 0) {\r\n        addOutOfStockDeficiency(product.name);\r\n      }\r\n\r\n      if (!isDeferred) {\r\n        try {\r\n          const saleTotal = usedPrice * qty;\r\n          const cashKey = getCashBalanceKey();\r\n          const savedCash = localStorage.getItem(cashKey);\r\n          const currentCash = savedCash ? parseFloat(savedCash) : 0;\r\n          const newCash = currentCash + saleTotal;\r\n          localStorage.setItem(cashKey, newCash.toString());\r\n          const localDataKey = `userData_${user?.uid}`;\r\n          const updateData = { cashBalance: newCash, lastUpdated: new Date().toISOString() } as any;\r\n          localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n          if (user?.uid) {\r\n            userDataService.updateUserData(user.uid, updateData).catch(() => {});\r\n          }\r\n          const shopId = (profile as any)?.shopId || shopIdCtx;\r\n          if (shopId) {\r\n            try { await updateDoc(doc(db, 'dashboardData', shopId), { cashBalance: newCash }); } catch {}\r\n          }\r\n          try { window.dispatchEvent(new CustomEvent('cashBalanceChanged', { detail: { value: newCash } })); } catch {}\r\n          try {\r\n            if (user?.uid) {\r\n              const receiptRef = `SALECASH-${user.uid}-${Date.now()}`;\r\n              const txToCloud: any = {\r\n                txnType: 'cash_addition',\r\n                type: 'cash_addition',\r\n                amount: saleTotal,\r\n                status: 'confirmed',\r\n                senderMsisdn: ' ',\r\n                receiverMsisdn: '',\r\n                reference: receiptRef,\r\n                title: '  ',\r\n                merchantUserId: user.uid,\r\n                createdBy: user.uid,\r\n                shopId: (profile as any)?.shopId || shopIdCtx || undefined,\r\n                cashierName: performedByName,\r\n                performedByType,\r\n                performedByUsername,\r\n                createdAt: new Date()\r\n              };\r\n              await userDataService.saveUserTransaction(user.uid, txToCloud);\r\n            }\r\n          } catch {}\r\n        } catch (e) {\r\n          console.warn('      :', e);\r\n        }\r\n      }\r\n\r\n      toast({ title: ' ', description: `  ${qty}   ${product.name}` });\r\n    } catch (error) {\r\n      console.error('Error selling product:', error);\r\n      toast({ title: ' ', description: '   ', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  //          \r\n  const deleteSale = async (sale: SaleItem) => {\r\n    if (!user?.uid) return;\r\n    if (isShiftActive) {\r\n      toast({ title: '    ', description: '      ', variant: 'destructive' });\r\n      return;\r\n    }\r\n    requireMasterPin(\r\n      '   ',\r\n      '       ',\r\n      async () => {\r\n        try {\r\n          //       \r\n          const todayLocal = getLocalDateYYYYMMDD();\r\n          const localKey = `salesData_${user.uid}_${todayLocal}`;\r\n          const allKey = `salesData_all_${user.uid}`;\r\n          const updatedDay = salesData.filter(s => s.id !== sale.id);\r\n          try {\r\n            localStorage.setItem(localKey, JSON.stringify(updatedDay));\r\n            const existingAllRaw = localStorage.getItem(allKey);\r\n            const existingAll = existingAllRaw ? JSON.parse(existingAllRaw) : [];\r\n            const updatedAll = (Array.isArray(existingAll) ? existingAll : []).filter((s: any) => s?.id !== sale.id);\r\n            localStorage.setItem(allKey, JSON.stringify(updatedAll));\r\n          } catch {}\r\n          setSalesData(updatedDay);\r\n\r\n          //          \r\n          const bgTasks: Promise<any>[] = [];\r\n          if (!sale.isDeferred) {\r\n            try {\r\n              const saleTotal = (sale.price ?? 0) * (sale.quantity ?? 0);\r\n              const cashKey = getCashBalanceKey();\r\n              const savedCash = localStorage.getItem(cashKey);\r\n              const currentCash = savedCash ? parseFloat(savedCash) : 0;\r\n              const newCash = currentCash - saleTotal;\r\n              localStorage.setItem(cashKey, newCash.toString());\r\n              const localDataKey = `userData_${user?.uid}`;\r\n              const updateData = { cashBalance: newCash, lastUpdated: new Date().toISOString() } as any;\r\n              try { localStorage.setItem(localDataKey, JSON.stringify(updateData)); } catch {}\r\n              if (user?.uid) {\r\n                bgTasks.push(userDataService.updateUserData(user.uid, updateData));\r\n              }\r\n              const shopId = (profile as any)?.shopId || shopIdCtx;\r\n              if (shopId) {\r\n                bgTasks.push(updateDoc(doc(db, 'dashboardData', shopId), { cashBalance: newCash }).catch(() => {}));\r\n              }\r\n              try { window.dispatchEvent(new CustomEvent('cashBalanceChanged', { detail: { value: newCash } })); } catch {}\r\n            } catch (e) {\r\n              console.warn('       :', e);\r\n            }\r\n          }\r\n\r\n          //  :       \r\n          try {\r\n            const matched = shopProducts.find(p => (sale.barcode && p.barcode === sale.barcode) || p.name === sale.productName);\r\n            if (matched) {\r\n              const newQty = (matched.quantity || 0) + (sale.quantity || 0);\r\n              setShopProducts(prev => prev.map(p => p.id === matched.id ? { ...p, quantity: newQty } : p));\r\n              bgTasks.push(updateDoc(doc(db, 'products', matched.id), { quantity: newQty, updatedAt: serverTimestamp() }));\r\n            }\r\n          } catch (e) {\r\n            console.warn('     :', e);\r\n          }\r\n\r\n          //     Firestore  \r\n          try {\r\n            if (sale.firestoreId) {\r\n              bgTasks.push(deleteDoc(doc(db, 'dailySales', sale.firestoreId)).catch(() => {}));\r\n              bgTasks.push(deleteDoc(doc(db, 'users', user.uid, 'dailySales', sale.firestoreId)).catch(() => {}));\r\n            } else {\r\n              bgTasks.push((async () => {\r\n                try {\r\n                  const q = query(\r\n                    collection(db, 'dailySales'),\r\n                    where('userId', '==', user.uid),\r\n                    where('date', '==', sale.date),\r\n                    where('productName', '==', sale.productName),\r\n                    limit(5)\r\n                  );\r\n                  let snap = await getDocs(q);\r\n                  if (snap.empty) {\r\n                    const q2 = query(\r\n                      collection(db, 'users', user.uid, 'dailySales'),\r\n                      where('date', '==', sale.date),\r\n                      where('productName', '==', sale.productName),\r\n                      limit(5)\r\n                    );\r\n                    snap = await getDocs(q2);\r\n                  }\r\n                  if (!snap.empty) {\r\n                    const target = snap.docs.find((d: any) => {\r\n                      const data: any = d.data();\r\n                      return Number(data?.sellingPrice ?? 0) === Number(sale.price ?? 0)\r\n                        && Number(data?.quantity ?? 0) === Number(sale.quantity ?? 0)\r\n                        && String(data?.time ?? '') === String(sale.time ?? '');\r\n                    }) || snap.docs[0];\r\n                    if (target) {\r\n                      await deleteDoc(target.ref);\r\n                    }\r\n                  }\r\n                } catch (e) {\r\n                  console.warn('     Firestore ( ):', e);\r\n                }\r\n              })());\r\n            }\r\n          } catch (e) {\r\n            console.warn('      Firestore:', e);\r\n          }\r\n\r\n          //       ( )\r\n          try {\r\n            if (!isMonthlyLocked) {\r\n              setTimeout(() => { try { loadMonthlyStats(); } catch {} }, 0);\r\n            }\r\n          } catch {}\r\n\r\n          //      \r\n          try { await Promise.allSettled(bgTasks); } catch {}\r\n\r\n          toast({ title: '  ', description: `     ${sale.productName}   ` });\r\n        } catch (error) {\r\n          console.error('Error deleting sale:', error);\r\n          toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  //    :   = 1\r\n  const sellProductByBarcode = async (product: ShopProduct) => {\r\n    try {\r\n      setSellingQtyByProduct(prev => ({ ...prev, [product.id]: '1' }));\r\n      await sellProduct(product);\r\n    } catch (err) {\r\n      console.error('Error selling by barcode:', err);\r\n    }\r\n  };\r\n\r\n  //      \r\n  const addPieces = async (product: ShopProduct) => {\r\n    if (isShiftActive) {\r\n      toast({ title: '    ', description: '     ', variant: 'destructive' });\r\n      return;\r\n    }\r\n    const qtyStr = addQtyByProduct[product.id] || '';\r\n    const qty = parseInt(qtyStr);\r\n    if (isNaN(qty) || qty <= 0) {\r\n      toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n      return;\r\n    }\r\n    requireMasterPin(\r\n      '  ',\r\n      '        ',\r\n      async () => {\r\n        try {\r\n          const newQty = product.quantity + qty;\r\n          await updateDoc(doc(db, 'products', product.id), { quantity: newQty, updatedAt: serverTimestamp() });\r\n          setShopProducts(prev => prev.map(p => p.id === product.id ? { ...p, quantity: newQty } : p));\r\n          setAddQtyByProduct(prev => ({ ...prev, [product.id]: '' }));\r\n          toast({ title: ' ', description: `  ${qty}   ${product.name}` });\r\n        } catch (error) {\r\n          console.error('Error adding pieces:', error);\r\n          toast({ title: ' ', description: '    ', variant: 'destructive' });\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  //      \r\n  const deleteProduct = async (product: ShopProduct) => {\r\n    if (!user?.uid) return;\r\n    if (isShiftActive) {\r\n      toast({ title: '    ', description: '     ', variant: 'destructive' });\r\n      return;\r\n    }\r\n    const ok = window.confirm(`    \"${product.name}\"`);\r\n    if (!ok) return;\r\n    requireMasterPin(\r\n      '  ',\r\n      '        ',\r\n      async () => {\r\n        try {\r\n          await deleteDoc(doc(db, 'products', product.id));\r\n          setShopProducts(prev => prev.filter(p => p.id !== product.id));\r\n          toast({ title: ' ', description: `   ${product.name}` });\r\n        } catch (error) {\r\n          console.error('Error deleting product:', error);\r\n          toast({ title: ' ', description: '  ', variant: 'destructive' });\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  //     Firestore  \r\n  const createProduct = async () => {\r\n    try {\r\n      if (!user?.uid) {\r\n        toast({ title: '', description: '  ', variant: 'destructive' });\r\n        return;\r\n      }\r\n      if (isShiftActive) {\r\n        toast({ title: '    ', description: '     ', variant: 'destructive' });\r\n        return;\r\n      }\r\n      const name = newProduct.productName.trim();\r\n      const selling = parseFloat(newProduct.price);\r\n      const wholesale = parseFloat(newProduct.wholesalePrice || '0');\r\n      const qty = parseInt(newProduct.quantity);\r\n\r\n      if (!name || isNaN(selling) || isNaN(qty)) {\r\n        toast({ title: '  ', description: '    ', variant: 'destructive' });\r\n        return;\r\n      }\r\n      //           PIN \r\n      //     undefined   Firestore\r\n      const payload: any = {\r\n        name,\r\n        sellingPrice: selling,\r\n        wholesalePrice: isNaN(wholesale) ? 0 : wholesale,\r\n        quantity: isNaN(qty) ? 0 : qty,\r\n        userId: user.uid,\r\n        createdAt: serverTimestamp(),\r\n        updatedAt: serverTimestamp(),\r\n      };\r\n\r\n      //        \r\n      const trimmedBarcode = (newProduct.barcode || '').trim();\r\n      if (trimmedBarcode) payload.barcode = trimmedBarcode;\r\n      const trimmedSerial = (newProduct.serialNumber || '').trim();\r\n      if (trimmedSerial) payload.serialNumber = trimmedSerial;\r\n\r\n      if (profile?.shopId) {\r\n        payload.shopId = profile.shopId;\r\n      }\r\n\r\n      const docRef = await addDoc(collection(db, 'products'), payload);\r\n\r\n      setShopProducts((prev) => [\r\n        {\r\n          id: docRef.id,\r\n          name,\r\n          sellingPrice: selling,\r\n          wholesalePrice: isNaN(wholesale) ? 0 : wholesale,\r\n          quantity: isNaN(qty) ? 0 : qty,\r\n          barcode: (newProduct.barcode || '').trim() || '',\r\n          serialNumber: (newProduct.serialNumber || '').trim() || '',\r\n        },\r\n        ...prev,\r\n      ]);\r\n\r\n      setNewProduct({ productName: '', price: '', wholesalePrice: '', quantity: '', barcode: '', serialNumber: '' });\r\n\r\n      toast({ title: ' ', description: `   ${name} ` });\r\n    } catch (error) {\r\n      console.error('createProduct error', error);\r\n      toast({ title: ' ', description: '  .  ', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  //  :    \r\n  const processBarcode = async (code: string) => {\r\n    const trimmed = (code || '').trim();\r\n    if (!trimmed) return;\r\n    const product = shopProducts.find((p) => (p.barcode || '') === trimmed);\r\n    if (!product) {\r\n      toast({ title: '  ', description: '      ' });\r\n      return;\r\n    }\r\n    await sellProductByBarcode(product);\r\n  };\r\n\r\n  //    \r\n  const printSelectedInvoice = () => {\r\n    const items = Object.entries(invoiceSelections)\r\n      .map(([id, qty]) => {\r\n        const q = Number(qty);\r\n        const prod = shopProducts.find(p => p.id === id);\r\n        if (!prod || !q || q <= 0) return null as any;\r\n        return { name: prod.name, qty: q, price: prod.sellingPrice, total: q * prod.sellingPrice };\r\n      })\r\n      .filter(Boolean) as { name: string; qty: number; price: number; total: number }[];\r\n\r\n    if (items.length === 0) {\r\n      toast({ title: '   ', description: '      ' });\r\n      return;\r\n    }\r\n\r\n    const shopName = (profile as any)?.shopName || user?.displayName || '';\r\n    const phone = (profile as any)?.phone || user?.phoneNumber || '';\r\n    const invoiceTotal = items.reduce((sum, it) => sum + it.total, 0);\r\n    const dateStr = new Date().toLocaleString('ar-EG');\r\n\r\n    const rowsHtml = items\r\n      .map((it) => `\r\n        <tr>\r\n          <td style=\"border:1px solid #ddd;padding:6px\">${it.name}</td>\r\n          <td style=\"border:1px solid #ddd;padding:6px;text-align:center\">${it.qty}</td>\r\n          <td style=\"border:1px solid #ddd;padding:6px;text-align:center\">${formatMoney(it.price)}</td>\r\n          <td style=\"border:1px solid #ddd;padding:6px;text-align:center;font-weight:bold;color:#0a7\">${formatMoney(it.total)}</td>\r\n        </tr>\r\n      `)\r\n      .join('');\r\n\r\n    const html = `\r\n      <html>\r\n        <head>\r\n          <meta charset=\"utf-8\" />\r\n          <title></title>\r\n          <style>\r\n            body { font-family: Tahoma, Arial, sans-serif; direction: rtl; }\r\n            .header { text-align: center; margin-bottom: 12px; }\r\n            .header h2 { margin: 0; }\r\n            .meta { text-align: center; color: #555; margin-bottom: 8px; }\r\n            table { width: 100%; border-collapse: collapse; }\r\n            .total { text-align: left; font-weight: bold; margin-top: 10px; }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          <div class=\"header\">\r\n            <h2>${shopName}</h2>\r\n            ${phone ? `<div class=\"meta\"> : ${phone}</div>` : ''}\r\n            <div class=\"meta\">: ${dateStr}</div>\r\n          </div>\r\n          <table>\r\n            <thead>\r\n              <tr>\r\n                <th style=\"border:1px solid #ddd;padding:6px\"></th>\r\n                <th style=\"border:1px solid #ddd;padding:6px\"></th>\r\n                <th style=\"border:1px solid #ddd;padding:6px\"></th>\r\n                <th style=\"border:1px solid #ddd;padding:6px\"></th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              ${rowsHtml}\r\n            </tbody>\r\n          </table>\r\n          <div class=\"total\"> : ${formatMoney(invoiceTotal)}</div>\r\n        </body>\r\n      </html>\r\n    `;\r\n\r\n    const w = window.open('', '_blank');\r\n    if (!w) return;\r\n    w.document.write(html);\r\n    w.document.close();\r\n    w.focus();\r\n    w.print();\r\n    w.close();\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-none w-[100vw] md:w-[100vw] lg:w-[100vw] max-h-[85vh] md:h-[100dvh] md:max-h-[100dvh] p-0 overflow-y-auto\">\r\n        <DialogHeader className=\"px-3 md:px-6 py-3 md:py-4 border-b bg-gradient-to-r from-blue-50 to-purple-50\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-2 md:gap-3\">\r\n              <div className=\"p-1.5 md:p-2 bg-blue-100 rounded-lg\">\r\n                <BarChart3 className=\"h-5 w-5 md:h-6 md:w-6 text-blue-600\" />\r\n              </div>\r\n              <div>\r\n                <DialogTitle className=\"text-lg md:text-xl font-bold text-gray-800\">\r\n                    \r\n                </DialogTitle>\r\n                <p className=\"text-xs md:text-sm text-gray-600 mt-1 hidden sm:block\">\r\n                    \r\n                </p>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center gap-1 md:gap-2\">\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => recoverUnsyncedSalesToFirestore()}\r\n                className=\"text-xs md:text-sm\"\r\n              >\r\n                 \r\n              </Button>\r\n              <Button variant=\"ghost\" size=\"sm\" onClick={onClose} className=\"h-8 w-8 md:h-9 md:w-9\">\r\n                <X className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogHeader>\r\n\r\n        <div className=\"flex flex-col md:flex-row h-full\" dir=\"rtl\">\r\n          {/*   -   */}\r\n          <div className=\"w-full md:w-72 lg:w-80 bg-white/50 border-r\">\r\n            <div className=\"p-3 md:p-4 border-b bg-white/30\">\r\n              <h3 className=\"font-semibold text-gray-800 mb-3 flex items-center gap-2 text-sm md:text-base\">\r\n                <DollarSign className=\"h-4 w-4 text-green-600\" />\r\n                 \r\n              </h3>\r\n              <div className=\"grid grid-cols-2 gap-2 md:gap-3\">\r\n                <div className=\"bg-blue-50 p-1 md:p-2 rounded-lg text-center\">\r\n                  <div className=\"text-base md:text-lg font-bold text-blue-600\">{formatMoney(salesData.filter(s => !s.isDeferred).reduce((sum, item) => sum + item.price * item.quantity, 0))}</div>\r\n                  <div className=\"text-xs md:text-sm text-blue-600\"> </div>\r\n                </div>\r\n                <div className=\"relative bg-green-50 p-1 md:p-2 rounded-lg text-center\">\r\n                  <div className={isProfitLocked ? \"filter blur-sm pointer-events-none\" : \"\"}>\r\n                    <div className=\"text-base md:text-lg font-bold text-green-600\">{formatMoney(salesData.filter(s => !s.isDeferred).reduce((sum, item) => sum + ((item.price - (item.wholesalePrice ?? 0)) * item.quantity), 0))}</div>\r\n                    <div className=\"text-xs md:text-sm text-green-600\"> </div>\r\n                  </div>\r\n                  {isProfitLocked && (\r\n                    <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                      <Button\r\n                        size=\"sm\"\r\n                        variant=\"ghost\"\r\n                        onClick={() => setIsProfitPinDialogOpen(true)}\r\n                        className=\"bg-white/80 hover:bg-white text-green-700 border border-green-200\"\r\n                      >\r\n                         \r\n                      </Button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <div className=\"bg-yellow-50 p-1 md:p-2 rounded-lg text-center\">\r\n                  <div className=\"text-base md:text-lg font-bold text-yellow-600\">{formatNumber(shopProducts.length)}</div>\r\n                  <div className=\"text-xs md:text-sm text-yellow-600\"> </div>\r\n                </div>\r\n                <div className=\"bg-purple-50 p-1 md:p-2 rounded-lg text-center\">\r\n                  <div className=\"text-base md:text-lg font-bold text-purple-600\">{formatNumber(salesData.filter(s => !s.isDeferred).length)}</div>\r\n                  <div className=\"text-xs md:text-sm text-purple-600\"> </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/*            */}\r\n              <div className=\"relative mb-2\">\r\n                {/*   +  / */}\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                  <div className=\"flex items-center gap-1 md:gap-2 text-xs md:text-sm font-semibold text-indigo-700\">\r\n                    <Calendar className=\"h-3 w-3 md:h-4 md:w-4\" />\r\n                    <BarChart3 className=\"h-3 w-3 md:h-4 md:w-4\" />\r\n                    <span> </span>\r\n                  </div>\r\n                  <Button\r\n                    size=\"sm\"\r\n                    variant=\"ghost\"\r\n                    onClick={() => setIsMonthlyCollapsed(v => !v)}\r\n                    className=\"h-6 w-6 p-0 rounded-full\"\r\n                    title={isMonthlyCollapsed ? \" \" : \" \"}\r\n                  >\r\n                    {isMonthlyCollapsed ? <ChevronDown className=\"h-4 w-4\" /> : <ChevronUp className=\"h-4 w-4\" />}\r\n                  </Button>\r\n                </div>\r\n\r\n                {/*     */}\r\n                <div className={isMonthlyCollapsed ? \"overflow-hidden max-h-0 transition-[max-height] duration-300\" : \"overflow-hidden transition-[max-height] duration-300 max-h-[400px]\"}>\r\n                  <div className={isMonthlyLocked ? \"grid grid-cols-2 gap-2 md:gap-4 filter blur-sm pointer-events-none\" : \"grid grid-cols-2 gap-2 md:gap-4\"}>\r\n                    <div className=\"bg-indigo-50 p-1 md:p-2 rounded-lg text-center\">\r\n                      <div className=\"text-base md:text-lg font-bold text-indigo-600\">{formatMoney(monthlySalesTotal)}</div>\r\n                      <div className=\"text-xs md:text-sm text-indigo-600\"> </div>\r\n                    </div>\r\n                    <div className=\"bg-pink-50 p-1 md:p-2 rounded-lg text-center\">\r\n                      <div className=\"text-base md:text-lg font-bold text-pink-600\">{formatMoney(monthlyProfitTotal)}</div>\r\n                      <div className=\"text-xs md:text-sm text-pink-600\"> </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {!isMonthlyCollapsed && isMonthlyLocked && (\r\n                  <div className=\"absolute left-0 right-0 top-7 md:top-10 bottom-0 flex items-center justify-center rounded-lg bg-yellow-100/60\">\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"ghost\"\r\n                      onClick={async () => {\r\n                        try {\r\n                          //        \r\n                          if (await isZeroPlan()) {\r\n                            toast({\r\n                              title: ' ',\r\n                              description: '      .     .',\r\n                              variant: 'destructive',\r\n                            });\r\n                            return;\r\n                          }\r\n                        } catch {}\r\n                        setIsMasterPinDialogOpen(true);\r\n                      }}\r\n                      className=\"flex items-center gap-2 bg-yellow-200/70 hover:bg-yellow-300 text-yellow-900 px-3 py-2 rounded-xl shadow-md hover:shadow-lg transition-all btn-monthly-reports\"\r\n                      title=\"  \"\r\n                    >\r\n                      <Eye className=\"h-5 w-5 md:h-7 md:w-7\" />\r\n                      <span className=\"text-xs md:text-sm\">  </span>\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/*        */}\r\n            <div className=\"flex justify-end mb-3\">\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                onClick={() => setIsSalesReceiptsDialogOpen(true)}\r\n                className=\"h-7 px-3 rounded-full bg-green-50 hover:bg-green-100 text-green-700\"\r\n                title=\" \"\r\n              >\r\n                <Receipt className=\"h-4 w-4 mr-1\" />\r\n                 \r\n              </Button>\r\n            </div>\r\n\r\n            {/*   ( ) */}\r\n            <div className=\"p-3 md:p-4 border-b bg-white/30\">\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <h3 className=\"font-semibold text-gray-800 flex items-center gap-2 text-sm md:text-base\">\r\n                  <Package className=\"h-4 w-4 text-indigo-600\" />\r\n                   \r\n                </h3>\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"ghost\"\r\n                  onClick={() => setIsProductStatsCollapsed(v => !v)}\r\n                  className=\"h-6 w-6 p-0 rounded-full\"\r\n                  title={isProductStatsCollapsed ? \" \" : \" \"}\r\n                >\r\n                  {isProductStatsCollapsed ? <ChevronDown className=\"h-4 w-4\" /> : <ChevronUp className=\"h-4 w-4\" />}\r\n                </Button>\r\n              </div>\r\n              <div className={isProductStatsCollapsed ? \"overflow-hidden max-h-0 transition-[max-height] duration-300\" : \"overflow-hidden transition-[max-height] duration-300 max-h-[400px]\"}>\r\n                {/* ... existing code ... */}\r\n              </div>\r\n            </div>\r\n\r\n            {/*   ( ) -    */}\r\n            <div className=\"p-3 md:p-4 flex-1 hidden md:block\">\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <h3 className=\"font-semibold text-gray-800 flex items-center gap-2\">\r\n                  <Info className=\"h-4 w-4 text-blue-600\" />\r\n                   \r\n                </h3>\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"ghost\"\r\n                  onClick={() => setIsTipsCollapsed(v => !v)}\r\n                  className=\"h-6 w-6 p-0 rounded-full\"\r\n                  title={isTipsCollapsed ? \" \" : \" \"}\r\n                >\r\n                  {isTipsCollapsed ? <ChevronDown className=\"h-4 w-4\" /> : <ChevronUp className=\"h-4 w-4\" />}\r\n                </Button>\r\n              </div>\r\n              <div className={isTipsCollapsed ? \"overflow-hidden max-h-0 transition-[max-height] duration-300\" : \"overflow-hidden transition-[max-height] duration-300 max-h-[400px]\"}>\r\n                {/* ... existing code ... */}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/*   */}\r\n          <div className=\"flex-1 overflow-y-visible transition-all duration-300 ease-in-out\">\r\n            <div className=\"p-3 md:p-6\">\r\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 md:mb-6 gap-2\">\r\n                <h2 className=\"text-base md:text-lg font-semibold text-gray-800 flex items-center gap-2\">\r\n                  <BookOpen className=\"h-4 w-4 md:h-5 md:w-5 text-blue-600\" />\r\n                  ({salesData.filter(s => !s.isDeferred).length} )\r\n                </h2>\r\n                \r\n                <div className=\"flex items-center gap-2 text-xs md:text-sm text-gray-600\">\r\n                  <Calendar className=\"h-3 w-3 md:h-4 md:w-4\" />\r\n                  <span className=\"hidden sm:inline\">{new Date().toLocaleDateString('ar-EG')}</span>\r\n                  <Clock className=\"h-3 w-3 md:h-4 md:w-4 ml-2\" />\r\n                  <span>{new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' })}</span>\r\n                </div>\r\n              </div>\r\n\r\n\r\n              {/*       */}\r\n              <div className=\"bg-white rounded-lg border border-gray-200 p-3 md:p-4 mb-4\">\r\n                <div className=\"flex items-center justify-between mb-3\">\r\n                  <h3 className=\"text-sm md:text-base font-semibold text-gray-800 flex items-center gap-2\">\r\n                    <Plus className=\"h-4 w-4 text-emerald-600\" />\r\n                      \r\n                  </h3>\r\n                  <Button size=\"sm\" variant=\"ghost\" className=\"h-8\" onClick={() => {\r\n                    if (isShiftActive) {\r\n                      toast({ title: '    ', description: '     ', variant: 'destructive' });\r\n                      return;\r\n                    }\r\n                    //         \r\n                    requireMasterPin(\r\n                      '   ',\r\n                      '      ',\r\n                      () => setIsAddProductOpen(true)\r\n                    );\r\n                  }}>\r\n                    <Plus className=\"h-4 w-4 text-emerald-600\" />\r\n                     \r\n                  </Button>\r\n                </div>\r\n                {isAddProductOpen && (\r\n                  <div className=\"space-y-2\">\r\n                    <div>\r\n                      <Label htmlFor=\"new-product-name\" className=\"text-xs md:text-sm\"> </Label>\r\n                      <Input id=\"new-product-name\" value={newProduct.productName} onChange={(e) => setNewProduct((p) => ({ ...p, productName: e.target.value }))} placeholder=\"  \" />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 gap-2\">\r\n                      <div>\r\n                        <Label htmlFor=\"new-product-price\" className=\"text-xs md:text-sm\">  (.)</Label>\r\n                        <Input type=\"number\" id=\"new-product-price\" value={newProduct.price} onChange={(e) => setNewProduct((p) => ({ ...p, price: e.target.value }))} placeholder=\"0.00\" />\r\n                      </div>\r\n                      <div>\r\n                        <Label htmlFor=\"new-product-wholesale\" className=\"text-xs md:text-sm\">  (.)</Label>\r\n                        <Input type=\"number\" id=\"new-product-wholesale\" value={newProduct.wholesalePrice || ''} onChange={(e) => setNewProduct((p) => ({ ...p, wholesalePrice: e.target.value }))} placeholder=\"0.00\" />\r\n                      </div>\r\n                    </div>\r\n                    <div>\r\n                      <Label htmlFor=\"new-product-qty\" className=\"text-xs md:text-sm\"></Label>\r\n                      <Input type=\"number\" id=\"new-product-qty\" value={newProduct.quantity} onChange={(e) => setNewProduct((p) => ({ ...p, quantity: e.target.value }))} placeholder=\"1\" />\r\n                    </div>\r\n                    <div>\r\n                      <Label htmlFor=\"new-product-barcode\" className=\"text-xs md:text-sm\">  ()</Label>\r\n                      <Input id=\"new-product-barcode\" value={newProduct.barcode || ''} onChange={(e) => setNewProduct((p) => ({ ...p, barcode: e.target.value }))} placeholder=\"/ \" />\r\n                    </div>\r\n                    <div>\r\n                      <Label htmlFor=\"new-product-serial\" className=\"text-xs md:text-sm\">  ()</Label>\r\n                      <Input id=\"new-product-serial\" value={newProduct.serialNumber || ''} onChange={(e) => setNewProduct((p) => ({ ...p, serialNumber: e.target.value }))} placeholder=\"  \" />\r\n                    </div>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      <Button className=\"h-9 w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white\" onClick={createProduct}>\r\n                         \r\n                      </Button>\r\n                      <Button variant=\"outline\" className=\"h-9 w-full md:w-auto\" onClick={() => setIsAddProductOpen(false)}>\r\n                        \r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n\r\n              {/*   -   */}\r\n              <div id=\"shop-products-section\" className=\"bg-white rounded-lg border border-gray-200 overflow-hidden mb-4\">\r\n                <div className=\"mb-4\">\r\n                  <h3 className=\"text-sm md:text-base font-semibold text-gray-800 mb-2 flex items-center gap-2\">\r\n                    <Package className=\"h-4 w-4 text-green-600\" />\r\n                     \r\n                  </h3>\r\n                  <div className=\"flex items-center gap-2 mb-2\">\r\n                    <Button variant={isInvoiceMode ? 'default' : 'outline'} size=\"sm\" onClick={() => setIsInvoiceMode(v => !v)}>\r\n                      {isInvoiceMode ? ' : ' : '  '}\r\n                    </Button>\r\n                    <Button size=\"sm\" className=\"bg-indigo-600 hover:bg-indigo-700 text-white\" disabled={Object.keys(invoiceSelections).filter(id => (invoiceSelections[id] || 0) > 0).length === 0} onClick={printSelectedInvoice}>\r\n                       \r\n                    </Button>\r\n                  </div>\r\n                  {/*     */}\r\n                  <div className=\"flex items-center gap-2 mb-3\">\r\n                    <Input\r\n                      value={productSearchTerm}\r\n                      onChange={(e) => setProductSearchTerm(e.target.value)}\r\n                      placeholder=\"  ...\"\r\n                      className=\"h-9 w-full md:w-72 text-sm\"\r\n                      aria-label=\"     \"\r\n                    />\r\n                    <Input\r\n                      value={scannedBarcode}\r\n                      onChange={(e) => setScannedBarcode(e.target.value)}\r\n                      onKeyDown={async (e) => {\r\n                        if (e.key !== 'Enter') return;\r\n                        const code = scannedBarcode.trim();\r\n                        if (!code) return;\r\n                        await processBarcode(code);\r\n                        setScannedBarcode('');\r\n                      }}\r\n                      placeholder=\"    ()\"\r\n                      className=\"h-9 w-full md:w-64 text-sm\"\r\n                      aria-label=\"    \"\r\n                    />\r\n                    {productSearchTerm && (\r\n                      <Button variant=\"ghost\" size=\"sm\" className=\"h-9\" onClick={() => setProductSearchTerm('')}></Button>\r\n                    )}\r\n                  </div>\r\n                  {/*    */}\r\n                  <div className=\"overflow-x-auto border border-gray-200 rounded-lg hidden md:block\">\r\n                    <table className=\"w-full text-sm\">\r\n                      <thead className=\"bg-gray-50 border-b border-gray-200\">\r\n                        <tr>\r\n                          <th className=\"px-3 py-2 text-right font-medium text-gray-700\"></th>\r\n                          <th className=\"px-3 py-2 text-right font-medium text-gray-700\"> </th>\r\n                          <th className=\"px-3 py-2 text-right font-medium text-gray-700\">\r\n                            <div className=\"flex items-center justify-end gap-2\">\r\n                              <span> </span>\r\n                              <Button\r\n                                variant=\"ghost\"\r\n                                size=\"icon\"\r\n                                className=\"h-6 w-6\"\r\n                                onClick={() => setIsWholesaleVisible(v => !v)}\r\n                                aria-label={isWholesaleVisible ? '  ' : '  '}\r\n                              >\r\n                                {isWholesaleVisible ? (\r\n                                  <EyeOff className=\"h-4 w-4\" />\r\n                                ) : (\r\n                                  <Eye className=\"h-4 w-4\" />\r\n                                )}\r\n                              </Button>\r\n                            </div>\r\n                          </th>\r\n                          <th className=\"px-3 py-2 text-right font-medium text-gray-700\"></th>\r\n                          <th className=\"px-3 py-2 text-right font-medium text-gray-700\"></th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody className=\"divide-y divide-gray-200\">\r\n                        {filteredShopProducts.length === 0 ? (\r\n                          <tr>\r\n                            <td colSpan={5} className=\"px-3 py-3 text-center text-gray-500\">\r\n                              {shopProducts.length === 0 ? '        ' : '    '}\r\n                            </td>\r\n                          </tr>\r\n                        ) : (\r\n                          filteredShopProducts.map(product => (\r\n                            <tr key={product.id}>\r\n                              <td className=\"px-3 py-2 font-medium text-gray-900\">{product.name}</td>\r\n                              <td className=\"px-3 py-2 text-gray-700\">{formatMoney(product.sellingPrice)}</td>\r\n                              <td className=\"px-3 py-2 text-gray-700\">\r\n                                <span className={isWholesaleVisible ? '' : 'blur-sm select-none'}>\r\n                                  {formatMoney(product.wholesalePrice)}\r\n                                </span>\r\n                              </td>\r\n                              <td className=\"px-3 py-2 text-gray-700\">{formatNumber(product.quantity)}</td>\r\n                              <td className=\"px-3 py-2\">\r\n                                <div className=\"flex items-center gap-2 flex-nowrap\">\r\n                                  <Input\r\n                                    value={sellingQtyByProduct[product.id] || ''}\r\n                                    onChange={(e) => setSellingQtyByProduct(prev => ({ ...prev, [product.id]: e.target.value }))}\r\n                                    type=\"number\"\r\n                                    placeholder=\"  \"\r\n                                    className=\"h-8 w-28 text-sm\"\r\n                                  />\r\n\r\n                                  <Input\r\n                                    value={sellingPriceOverrideByProduct[product.id] || ''}\r\n                                    onChange={(e) => setSellingPriceOverrideByProduct(prev => ({ ...prev, [product.id]: e.target.value }))}\r\n                                    type=\"number\"\r\n                                    placeholder=\"  \"\r\n                                    className=\"h-8 w-32 text-sm\"\r\n                                    aria-label={`    ${product.name}`}\r\n                                  />\r\n\r\n                                  <Button size=\"sm\" className=\"h-8 min-w-[64px] bg-indigo-600 hover:bg-indigo-700 text-white\" onClick={() => sellProduct(product)}></Button>\r\n                                  <Button size=\"sm\" className=\"h-8 min-w-[64px] bg-amber-600 hover:bg-amber-700 text-white\" onClick={() => { setPendingDeferredProduct(product); setIsDeferredFormOpen(true); }}> </Button>\r\n                                  {isInvoiceMode && (\r\n                                    <Input\r\n                                      value={invoiceSelections[product.id] ?? ''}\r\n                                      onChange={(e) => {\r\n                                        const num = parseInt(e.target.value || '0');\r\n                                        setInvoiceSelections(prev => ({ ...prev, [product.id]: isNaN(num) ? 0 : num }));\r\n                                      }}\r\n                                      type=\"number\"\r\n                                      placeholder=\" \"\r\n                                      className=\"h-8 w-24 text-sm\"\r\n                                    />\r\n                                  )}\r\n                                  <Input\r\n                                    value={addQtyByProduct[product.id] || ''}\r\n                                    onChange={(e) => setAddQtyByProduct(prev => ({ ...prev, [product.id]: e.target.value }))}\r\n                                    type=\"number\"\r\n                                    placeholder=\" \"\r\n                                    className=\"h-8 w-28 text-sm\"\r\n                                    disabled={isShiftActive}\r\n                                  />\r\n                                  <div className=\"inline-flex items-center gap-2 flex-nowrap\">\r\n                                    <Button size=\"sm\" variant=\"outline\" className=\"h-8 whitespace-nowrap\" onClick={() => addPieces(product)} disabled={isShiftActive} title={isShiftActive ? '    ' : undefined}>  </Button>\r\n                                    <Button size=\"sm\" variant=\"destructive\" className=\"h-8\" onClick={() => deleteProduct(product)} title=\" \" disabled={isShiftActive}>\r\n                                      <Trash2 className=\"h-4 w-4\" />\r\n                                    </Button>\r\n                                  </div>\r\n                                </div>\r\n                              </td>\r\n                            </tr>\r\n                          ))\r\n                        )}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n\r\n                  {/*   */}\r\n                  <div className=\"block md:hidden space-y-3\">\r\n                    {filteredShopProducts.length === 0 ? (\r\n                      <div className=\"text-center text-gray-500 text-sm\">{shopProducts.length === 0 ? '        ' : '    '}</div>\r\n                    ) : (\r\n                      filteredShopProducts.map(product => (\r\n                        <div key={product.id} className=\"bg-white rounded-xl p-3 border border-gray-200 shadow-sm\">\r\n                          <div className=\"flex items-center justify-between mb-2\">\r\n                            <h4 className=\"font-semibold text-gray-900 text-sm break-words\">{product.name}</h4>\r\n                            <Button size=\"sm\" variant=\"destructive\" className=\"h-8 min-w-[44px] touch-manipulation\" onClick={() => deleteProduct(product)} title=\" \" disabled={isShiftActive}>\r\n                              <Trash2 className=\"h-4 w-4\" />\r\n                            </Button>\r\n                          </div>\r\n                          <div className=\"grid grid-cols-2 gap-x-4 gap-y-2 text-xs text-gray-700\">\r\n                            <div className=\"text-gray-600\"> </div>\r\n                            <div className=\"text-right font-medium\">{formatMoney(product.sellingPrice)}</div>\r\n\r\n                            <div className=\"text-gray-600 inline-flex items-center gap-1\">\r\n                              <span> </span>\r\n                              <Button\r\n                                variant=\"ghost\"\r\n                                size=\"icon\"\r\n                                className=\"h-5 w-5\"\r\n                                onClick={() => setIsWholesaleVisible(v => !v)}\r\n                                aria-label={isWholesaleVisible ? '  ' : '  '}\r\n                              >\r\n                                {isWholesaleVisible ? (\r\n                                  <EyeOff className=\"h-4 w-4\" />\r\n                                ) : (\r\n                                  <Eye className=\"h-4 w-4\" />\r\n                                )}\r\n                              </Button>\r\n                            </div>\r\n                            <div className=\"text-right font-medium\">\r\n                              <span className={isWholesaleVisible ? '' : 'blur-sm select-none'}>\r\n                                {formatMoney(product.wholesalePrice)}\r\n                              </span>\r\n                            </div>\r\n\r\n                            <div className=\"text-gray-600\"></div>\r\n                            <div className=\"text-right font-medium\">{formatNumber(product.quantity)}</div>\r\n                          </div>\r\n\r\n                          <div className=\"mt-3 space-y-2\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <Input\r\n                                value={sellingQtyByProduct[product.id] || ''}\r\n                                onChange={(e) => setSellingQtyByProduct(prev => ({ ...prev, [product.id]: e.target.value }))}\r\n                                type=\"number\"\r\n                                placeholder=\"  \"\r\n                                className=\"h-9 flex-1 text-sm\"\r\n                                aria-label={`    ${product.name}`}\r\n                              />\r\n\r\n                              <Input\r\n                                value={sellingPriceOverrideByProduct[product.id] || ''}\r\n                                onChange={(e) => setSellingPriceOverrideByProduct(prev => ({ ...prev, [product.id]: e.target.value }))}\r\n                                type=\"number\"\r\n                                placeholder=\"  \"\r\n                                className=\"h-9 w-28 text-sm\"\r\n                                aria-label={`    ${product.name}`}\r\n                              />\r\n\r\n                              <Button size=\"sm\" className=\"h-9 min-w-[64px] bg-indigo-600 hover:bg-indigo-700 text-white\" onClick={() => sellProduct(product)}></Button>\r\n                              <Button size=\"sm\" className=\"h-9 min-w-[64px] bg-amber-600 hover:bg-amber-700 text-white\" onClick={() => { setPendingDeferredProduct(product); setIsDeferredFormOpen(true); }}> </Button>\r\n                            </div>\r\n\r\n                            {isInvoiceMode && (\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <Input\r\n                                  value={invoiceSelections[product.id] ?? ''}\r\n                                  onChange={(e) => {\r\n                                    const num = parseInt(e.target.value || '0');\r\n                                    setInvoiceSelections(prev => ({ ...prev, [product.id]: isNaN(num) ? 0 : num }));\r\n                                  }}\r\n                                  type=\"number\"\r\n                                  placeholder=\" \"\r\n                                  className=\"h-9 flex-1 text-sm\"\r\n                                  aria-label={`   ${product.name}`}\r\n                                />\r\n                              </div>\r\n                            )}\r\n\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <Input\r\n                                value={addQtyByProduct[product.id] || ''}\r\n                                onChange={(e) => setAddQtyByProduct(prev => ({ ...prev, [product.id]: e.target.value }))}\r\n                                type=\"number\"\r\n                                placeholder=\" \"\r\n                                className=\"h-9 flex-1 text-sm\"\r\n                                aria-label={`    ${product.name}`}\r\n                                disabled={isShiftActive}\r\n                              />\r\n                              <Button size=\"sm\" variant=\"outline\" className=\"h-9 min-w-[64px]\" onClick={() => addPieces(product)} disabled={isShiftActive} title={isShiftActive ? '    ' : undefined}></Button>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ))\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/*      */}\r\n              {salesData.length === 0 ? (\r\n                <div className=\"text-center py-8 md:py-12\">\r\n                  <div className=\"w-16 h-16 md:w-24 md:h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center\">\r\n                    <Package className=\"h-8 w-8 md:h-12 md:w-12 text-gray-400\" />\r\n                  </div>\r\n                  <h3 className=\"text-base md:text-lg font-medium text-gray-900 mb-2\">   </h3>\r\n                  <p className=\"text-sm text-gray-500\">     </p>\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  {/*     */}\r\n                  <div className=\"block md:hidden\">\r\n                    <div className=\"max-h-[70vh] overflow-y-auto space-y-3 p-3\">\r\n                      {salesData.map((item) => (\r\n                        <div key={item.id} className=\"bg-white rounded-xl p-4 border border-gray-200 shadow-sm\">\r\n                          <div className=\"mb-3\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <h4 className=\"font-semibold text-gray-900 text-base break-words\">{item.productName}</h4>\r\n                              {item.isDeferred && (\r\n                                <span className=\"px-2 py-0.5 rounded bg-amber-100 text-amber-700 text-[11px]\"></span>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-gray-700\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <DollarSign className=\"h-4 w-4 text-blue-600\" />\r\n                              <span className=\"text-gray-600\"> </span>\r\n                            </div>\r\n                            <div className=\"text-right font-medium\">{formatMoney(item.price)}</div>\r\n\r\n                            {typeof item.wholesalePrice === 'number' && (\r\n                              <>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <DollarSign className=\"h-4 w-4 text-indigo-600\" />\r\n                                  <span className=\"text-gray-600 inline-flex items-center gap-1\">\r\n                                     \r\n                                    <Button\r\n                                      variant=\"ghost\"\r\n                                      size=\"icon\"\r\n                                      className=\"h-5 w-5\"\r\n                                      onClick={() => setIsWholesaleVisible(v => !v)}\r\n                                      aria-label={isWholesaleVisible ? '  ' : '  '}\r\n                                    >\r\n                                      {isWholesaleVisible ? (\r\n                                        <EyeOff className=\"h-4 w-4\" />\r\n                                      ) : (\r\n                                        <Eye className=\"h-4 w-4\" />\r\n                                      )}\r\n                                    </Button>\r\n                                  </span>\r\n                                </div>\r\n                                <div className=\"text-right font-medium\">\r\n                                  <span className={isWholesaleVisible ? '' : 'blur-sm select-none'}>\r\n                                    {formatMoney(item.wholesalePrice as number)}\r\n                                  </span>\r\n                                </div>\r\n                              </>\r\n                            )}\r\n\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <Package className=\"h-4 w-4 text-emerald-600\" />\r\n                              <span className=\"text-gray-600\"></span>\r\n                            </div>\r\n                            <div className=\"text-right font-medium\">{formatNumber(item.quantity)}</div>\r\n\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <TrendingUp className=\"h-4 w-4 text-indigo-600\" />\r\n                              <span className=\"text-gray-600\"></span>\r\n                            </div>\r\n                            <div className=\"text-right font-semibold text-indigo-600\">\r\n                              <span className={isWholesaleVisible ? '' : 'blur-sm select-none'}>\r\n                                {formatMoney(((item.price ?? 0) - (item.wholesalePrice ?? 0)) * (item.quantity ?? 0))}\r\n                              </span>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <DollarSign className=\"h-4 w-4 text-green-600\" />\r\n                              <span className=\"text-gray-600\"></span>\r\n                            </div>\r\n                            <div className=\"text-right font-bold text-green-700\">\r\n                              {formatMoney(item.price * item.quantity)}\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <Award className=\"h-4 w-4 text-amber-600\" />\r\n                              <span className=\"text-gray-600\"></span>\r\n                            </div>\r\n                            <div className=\"text-right text-gray-700\">{item.performedByName ?? '-'}</div>\r\n\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <Calendar className=\"h-4 w-4 text-blue-600\" />\r\n                              <span className=\"text-gray-600\"></span>\r\n                            </div>\r\n                            <div className=\"text-right text-gray-600\">{formatDate(item.date)}</div>\r\n\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <Clock className=\"h-4 w-4 text-gray-500\" />\r\n                              <span className=\"text-gray-600\"></span>\r\n                            </div>\r\n                            <div className=\"text-right text-gray-600\">{item.time}</div>\r\n                          </div>\r\n                          <div className=\"mt-3 flex items-center justify-end gap-2\">\r\n                            {item.isDeferred && (\r\n                              <Button\r\n                                size=\"sm\"\r\n                                className=\"h-8 min-w-[64px] bg-amber-600 hover:bg-amber-700 text-white\"\r\n                                onClick={() => markDeferredSalePaid(item)}\r\n                                title=\" \"\r\n                              >\r\n                                 \r\n                              </Button>\r\n                            )}\r\n                            <Button\r\n                              size=\"sm\"\r\n                              variant=\"outline\"\r\n                              onClick={() => openDeleteConfirm(item, 'return')}\r\n                              disabled={isShiftActive}\r\n                              title={isShiftActive ? '    ' : ''}\r\n                              className=\"h-8 border-red-300 text-red-600 hover:bg-red-50\"\r\n                            >\r\n                              \r\n                            </Button>\r\n                            <Button\r\n                              size=\"sm\"\r\n                              variant=\"destructive\"\r\n                              onClick={() => openDeleteConfirm(item, 'delete')}\r\n                              disabled={isShiftActive}\r\n                              title={isShiftActive ? '    ' : ' '}\r\n                              className=\"h-8\"\r\n                            >\r\n                              <Trash2 className=\"h-4 w-4\" />\r\n                              <span className=\"ml-1\"> </span>\r\n                            </Button>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/*      */}\r\n                  <div className=\"hidden md:block overflow-x-auto max-h-96 overflow-y-auto scrollbar-thin scrollbar-thumb-green-300 scrollbar-track-green-100 hover:scrollbar-thumb-green-400\">\r\n                    <table className=\"w-full\">\r\n                      <thead className=\"bg-gray-50 border-b border-gray-200\">\r\n                        <tr>\r\n                          <th className=\"px-4 py-3 text-right text-sm font-medium text-gray-700\"></th>\r\n                          <th className=\"px-4 py-3 text-right text-sm font-medium text-gray-700\">  (.)</th>\r\n                          <th className=\"px-4 py-3 text-right text-sm font-medium text-gray-700\">\r\n                            <div className=\"flex items-center justify-end gap-2\">\r\n                              <span>  (.)</span>\r\n                              <Button\r\n                                variant=\"ghost\"\r\n                                size=\"icon\"\r\n                                className=\"h-6 w-6\"\r\n                                onClick={() => setIsWholesaleVisible(v => !v)}\r\n                                aria-label={isWholesaleVisible ? '  ' : '  '}\r\n                              >\r\n                                {isWholesaleVisible ? (\r\n                                  <EyeOff className=\"h-4 w-4\" />\r\n                                ) : (\r\n                                  <Eye className=\"h-4 w-4\" />\r\n                                )}\r\n                              </Button>\r\n                            </div>\r\n                          </th>\r\n                          <th className=\"px-4 py-3 text-right text-sm font-medium text-gray-700\"></th>\r\n                          <th className=\"px-4 py-3 text-right text-sm font-medium text-gray-700\"> (.)</th>\r\n                          <th className=\"px-4 py-3 text-right text-sm font-medium text-gray-700\"> (.)</th>\r\n                          <th className=\"px-4 py-3 text-right text-sm font-medium text-gray-700\"></th>\r\n                          <th className=\"px-4 py-3 text-right text-sm font-medium text-gray-700\"></th>\r\n                          <th className=\"px-4 py-3 text-right text-sm font-medium text-gray-700\"></th>\r\n                          <th className=\"px-4 py-3 text-right text-sm font-medium text-gray-700\"></th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody className=\"divide-y divide-gray-200\">\r\n                        {salesData.map((item, index) => (\r\n  <tr key={item.id} className={index % 2 === 0 ? 'bg-white' : 'bg-gray-50/50'}>\r\n    <td className=\"px-4 py-3 text-sm font-medium text-gray-900\">\r\n      <div className=\"flex items-center gap-2 justify-end md:justify-start\">\r\n        <span>{item.productName}</span>\r\n        {item.isDeferred && (\r\n          <span className=\"px-2 py-0.5 rounded bg-amber-100 text-amber-700 text-xs\"></span>\r\n        )}\r\n      </div>\r\n    </td>\r\n    <td className=\"px-4 py-3 text-sm text-gray-700\">{formatMoney(item.price)}</td>\r\n    <td className=\"px-4 py-3 text-sm text-gray-700\">{typeof item.wholesalePrice === 'number' ? (\r\n      <span className={isWholesaleVisible ? '' : 'blur-sm select-none'}>\r\n        {formatMoney(item.wholesalePrice as number)}\r\n      </span>\r\n    ) : '-'}</td>\r\n    <td className=\"px-4 py-3 text-sm text-gray-700\">{formatNumber(item.quantity)}</td>\r\n    <td className=\"px-4 py-3 text-sm font-medium text-green-600\">{formatMoney(item.price * item.quantity)}</td>\r\n    <td className=\"px-4 py-3 text-sm font-medium text-indigo-600\">\r\n      <span className={isWholesaleVisible ? '' : 'blur-sm select-none'}>\r\n        {formatMoney(((item.price ?? 0) - (item.wholesalePrice ?? 0)) * (item.quantity ?? 0))}\r\n      </span>\r\n    </td>\r\n    <td className=\"px-4 py-3 text-sm text-gray-500\">{formatDate(item.date)}</td>\r\n    <td className=\"px-4 py-3 text-sm text-gray-500\">{item.time}</td>\r\n    <td className=\"px-4 py-3 text-sm text-gray-700\">{item.performedByName ?? '-'}</td>\r\n    <td className=\"px-4 py-3 text-sm text-right\">\r\n      <div className=\"flex items-center justify-end gap-2\">\r\n        {item.isDeferred && (\r\n          <Button\r\n            size=\"sm\"\r\n            className=\"h-8 min-w-[64px] bg-amber-600 hover:bg-amber-700 text-white\"\r\n            onClick={() => markDeferredSalePaid(item)}\r\n            title=\" \"\r\n          >\r\n             \r\n          </Button>\r\n        )}\r\n        <Button\r\n          size=\"sm\"\r\n          variant=\"outline\"\r\n          onClick={() => openDeleteConfirm(item, 'return')}\r\n          disabled={isShiftActive}\r\n          title={isShiftActive ? '    ' : ''}\r\n          className=\"h-8 border-red-300 text-red-600 hover:bg-red-50\"\r\n        >\r\n          \r\n        </Button>\r\n        <Button\r\n          size=\"sm\"\r\n          variant=\"destructive\"\r\n          onClick={() => openDeleteConfirm(item, 'delete')}\r\n          disabled={isShiftActive}\r\n          title={isShiftActive ? '    ' : ' '}\r\n          className=\"h-8\"\r\n        >\r\n          <Trash2 className=\"h-4 w-4\" />\r\n        </Button>\r\n      </div>\r\n    </td>\r\n  </tr>\r\n))}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                </>\r\n              )}\r\n\r\n              \r\n            </div>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n      <Dialog open={isDeferredFormOpen} onOpenChange={setIsDeferredFormOpen}>\r\n        <DialogContent className=\"max-w-sm mx-auto bg-white border border-gray-200 shadow-2xl rounded-2xl sm:max-w-md\">\r\n          <DialogHeader className=\"text-center\">\r\n            <DialogTitle className=\"text-base md:text-lg font-bold text-gray-900\"> </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-3\">\r\n            <div className=\"grid grid-cols-1 gap-2\">\r\n              <Label className=\"text-sm\">  ()</Label>\r\n              <select\r\n                className=\"h-9 border rounded px-2 text-sm\"\r\n                value={deferredCustomerId}\r\n                onChange={(e) => {\r\n                  const val = e.target.value;\r\n                  setDeferredCustomerId(val);\r\n                  const c = customers.find(x => x.id === val);\r\n                  if (c) {\r\n                    setDeferredCustomerName(c.name);\r\n                    setDeferredCustomerMobile(c.mobile || '');\r\n                  }\r\n                }}\r\n              >\r\n                <option value=\"\">--   --</option>\r\n                {customers.map(c => (\r\n                  <option key={c.id} value={c.id}>{c.name}{c.mobile ? ` - ${c.mobile}` : ''}</option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            <div className=\"grid grid-cols-1 gap-2\">\r\n              <Label className=\"text-sm\"> </Label>\r\n              <Input\r\n                value={deferredCustomerName}\r\n                onChange={(e) => setDeferredCustomerName(e.target.value)}\r\n                placeholder=\" \"\r\n                className=\"h-9 text-sm\"\r\n              />\r\n            </div>\r\n            <div className=\"grid grid-cols-1 gap-2\">\r\n              <Label className=\"text-sm\">  ()</Label>\r\n              <Input\r\n                value={deferredCustomerMobile}\r\n                onChange={(e) => setDeferredCustomerMobile(e.target.value)}\r\n                placeholder=\" \"\r\n                className=\"h-9 text-sm\"\r\n              />\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-center justify-center gap-3 mt-3\">\r\n            <Button variant=\"outline\" className=\"h-8 min-w-[80px]\" onClick={() => setIsDeferredFormOpen(false)}></Button>\r\n            <Button\r\n              className=\"h-8 min-w-[100px] bg-amber-600 hover:bg-amber-700 text-white\"\r\n              onClick={async () => {\r\n                try {\r\n                  const prod = pendingDeferredProduct;\r\n                  if (!prod) { setIsDeferredFormOpen(false); return; }\r\n                  const name = deferredCustomerName.trim();\r\n                  const mobile = deferredCustomerMobile.trim() || undefined;\r\n                  const id = deferredCustomerId || undefined;\r\n                  if (!name) { toast({ title: ' ', description: '  ', variant: 'destructive' }); return; }\r\n                  await sellProduct(prod, true, { id, name, mobile });\r\n                try {\r\n                  if (user?.uid) {\r\n                    const saleTotal = prod.sellingPrice * (parseInt(sellingQtyByProduct[prod.id] || '0') || 0);\r\n                    const userData = await userDataService.getUserData(user.uid);\r\n                    const list: any[] = Array.isArray(userData?.debts) ? userData.debts : [];\r\n                    const newDebt = {\r\n                      id: Date.now().toString(),\r\n                      debtorName: name,\r\n                      customerId: id || null,\r\n                      mobile: mobile || null,\r\n                      amount: saleTotal,\r\n                      reason: `   ${prod.name}`,\r\n                      status: 'pending',\r\n                      createdAt: new Date(),\r\n                      partialPayments: []\r\n                    };\r\n                    const updated = [newDebt, ...list];\r\n                    await userDataService.updateUserData(user.uid, { debts: updated });\r\n                    try {\r\n                      const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n                      localStorage.setItem(`debts_${user.uid}_${sid}`, JSON.stringify(updated));\r\n                      localStorage.setItem(`debts_default_${sid}`, JSON.stringify(updated));\r\n                      localStorage.setItem(`debts_last_write_${user.uid}_${sid}`, Date.now().toString());\r\n                    } catch {}\r\n                    try { window.dispatchEvent(new CustomEvent('debtsUpdated', { detail: { count: updated.length } })); } catch {}\r\n                    try { await telegramNotifier.send(user.uid, `    ${newDebt.debtorName}  ${newDebt.amount} `); } catch {}\r\n                  }\r\n                } catch {}\r\n                  setIsDeferredFormOpen(false);\r\n                  setPendingDeferredProduct(null);\r\n                } catch {}\r\n              }}\r\n            >\r\n                \r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n      {/*     */}\r\n      <Dialog open={isSalesReceiptsDialogOpen} onOpenChange={setIsSalesReceiptsDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-3xl\">\r\n          <DialogHeader>\r\n            <DialogTitle> </DialogTitle>\r\n          </DialogHeader>\r\n          {salesData.filter(s => !s.isDeferred).length === 0 ? (\r\n            <div className=\"text-sm text-gray-600\">     .</div>\r\n          ) : (\r\n            <div className=\"overflow-x-auto border border-gray-200 rounded-lg max-h-[70vh] overflow-y-auto\">\r\n              <table className=\"w-full text-sm\">\r\n                <thead className=\"bg-gray-50 border-b border-gray-200\">\r\n                  <tr>\r\n                    <th className=\"px-3 py-2 text-right font-medium text-gray-700\"></th>\r\n                    <th className=\"px-3 py-2 text-right font-medium text-gray-700\"> </th>\r\n                    <th className=\"px-3 py-2 text-right font-medium text-gray-700\"> </th>\r\n                    <th className=\"px-3 py-2 text-right font-medium text-gray-700\"></th>\r\n                    <th className=\"px-3 py-2 text-right font-medium text-gray-700\"></th>\r\n                    <th className=\"px-3 py-2 text-right font-medium text-gray-700\"></th>\r\n                    <th className=\"px-3 py-2 text-right font-medium text-gray-700\"></th>\r\n                    <th className=\"px-3 py-2 text-right font-medium text-gray-700\"></th>\r\n                    <th className=\"px-3 py-2 text-right font-medium text-gray-700\"></th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {salesData.filter(s => !s.isDeferred).map((item) => (\r\n                    <tr key={item.id}>\r\n                      <td className=\"px-3 py-2 font-medium text-gray-900\">{item.productName}</td>\r\n                      <td className=\"px-3 py-2 text-gray-700\">{formatMoney(item.price)}</td>\r\n                      <td className=\"px-3 py-2 text-gray-700\">{formatMoney(item.wholesalePrice ?? 0)}</td>\r\n                      <td className=\"px-3 py-2 text-gray-700\">{formatNumber(item.quantity)}</td>\r\n                      <td className=\"px-3 py-2 text-gray-700\">{formatMoney((item.price ?? 0) * (item.quantity ?? 0))}</td>\r\n                      <td className=\"px-3 py-2 text-gray-700\">{formatMoney(((item.price ?? 0) - (item.wholesalePrice ?? 0)) * (item.quantity ?? 0))}</td>\r\n                      <td className=\"px-3 py-2 text-gray-500\">{formatDate(item.date)}</td>\r\n                      <td className=\"px-3 py-2 text-gray-500\">{item.time}</td>\r\n                      <td className=\"px-3 py-2 text-gray-700\">{item.executedBy || '-'}</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          )}\r\n          <div className=\"flex justify-end mt-3\">\r\n            <Button variant=\"outline\" onClick={() => setIsSalesReceiptsDialogOpen(false)}></Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n      {/*   /    */}\r\n      <Dialog open={isDeleteConfirmOpen} onOpenChange={setIsDeleteConfirmOpen}>\r\n        <DialogContent className=\"max-w-sm mx-auto bg-white border border-gray-200 shadow-2xl rounded-2xl sm:max-w-md\">\r\n          <DialogHeader className=\"text-center\">\r\n            <DialogTitle className=\"text-base md:text-lg font-bold text-gray-900\">\r\n              {deleteActionType === 'return' ? ' ' : '  '}\r\n            </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-3 text-center px-2\">\r\n            <p className=\"text-sm text-gray-700\">\r\n                {deleteActionType === 'return' ? ' ' : ' '} :\r\n              <span className=\"font-semibold text-gray-900\"> {deleteTargetSale?.productName} </span>\r\n              \r\n              <span className=\"font-semibold text-gray-900\"> {formatNumber(deleteTargetSale?.quantity || 0)} </span>\r\n            </p>\r\n            <p className=\"text-xs text-gray-500\">     .</p>\r\n          </div>\r\n          <div className=\"flex items-center justify-center gap-3 mt-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-8 min-w-[80px]\"\r\n              onClick={() => setIsDeleteConfirmOpen(false)}\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              className=\"h-8 min-w-[100px] bg-red-600 hover:bg-red-700 text-white\"\r\n              onClick={() => {\r\n                const tgt = deleteTargetSale;\r\n                setIsDeleteConfirmOpen(false);\r\n                if (tgt) deleteSale(tgt);\r\n              }}\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n      {/*        */}\r\n      <MasterPinDialog\r\n        open={isProfitPinDialogOpen}\r\n        onOpenChange={setIsProfitPinDialogOpen}\r\n        mode=\"verify\"\r\n        title=\"  \"\r\n        description=\"      \"\r\n        onSuccess={() => {\r\n          setIsProfitLocked(false);\r\n          setIsProfitPinDialogOpen(false);\r\n        }}\r\n      />\r\n      {/*         */}\r\n      <MasterPinDialog\r\n        open={isMasterPinDialogOpen}\r\n        onOpenChange={setIsMasterPinDialogOpen}\r\n        mode=\"verify\"\r\n        title=\"  \"\r\n        description=\"          \"\r\n        onSuccess={async () => {\r\n          try {\r\n            const uid = user?.uid;\r\n            if (uid) {\r\n              const sub = await getUserSubscription(uid);\r\n              const rawPlan: any = (sub as any)?.planType ?? (sub as any)?.plan ?? null;\r\n              const planStr = typeof rawPlan === 'string' ? rawPlan.toLowerCase() : null;\r\n              const isZero = rawPlan === SubscriptionPlan.ZERO || planStr === 'zero';\r\n              if (isZero) {\r\n                toast({\r\n                  title: ' ',\r\n                  description: '      .     .',\r\n                  variant: 'destructive',\r\n                });\r\n                //    \r\n                return;\r\n              }\r\n            }\r\n          } catch (e) {}\r\n          setIsMonthlyLocked(false);\r\n          setIsMasterPinDialogOpen(false);\r\n          //       \r\n          loadMonthlyStats();\r\n        }}\r\n      />\r\n      {/*       (/) */}\r\n      <MasterPinDialog\r\n        open={isMasterPinActionOpen}\r\n        onOpenChange={setIsMasterPinActionOpen}\r\n        mode=\"verify\"\r\n        title={masterPinActionTitle}\r\n        description={masterPinActionDescription}\r\n        onSuccess={() => {\r\n          const act = protectedActionRef.current;\r\n          protectedActionRef.current = null;\r\n          setIsMasterPinActionOpen(false);\r\n          if (act) act();\r\n        }}\r\n      />\r\n    </Dialog>\r\n  );\r\n}\r\n\r\n//  //     \r\nconst formatNumber = (n: number) => new Intl.NumberFormat('ar-EG').format(Number(n || 0));\r\nconst formatMoney = (n: number) => `${new Intl.NumberFormat('ar-EG', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(Number(n || 0))} .`;\r\nconst formatDate = (dateStr: string) => {\r\n  try {\r\n    const d = new Date(dateStr);\r\n    if (isNaN(d.getTime())) return new Date(`${dateStr}T00:00:00`).toLocaleDateString('ar-EG');\r\n    return d.toLocaleDateString('ar-EG');\r\n  } catch {\r\n    return dateStr;\r\n  }\r\n};\r\n","import React from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { DollarSign, Package, ArrowRightLeft } from 'lucide-react';\r\nimport { db } from '@/firebase';\r\nimport { useShop } from '@/hooks/useShop';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { collection, getDocs, query, where, doc, updateDoc, getDoc, onSnapshot } from 'firebase/firestore';\r\nimport { reportsService } from '@/utils/reportsService';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\r\nimport { userDataService } from '@/integrations/firebase/services';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\n\r\ninterface CashSummaryDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  userId?: string | null;\r\n  cashBalance: number;\r\n  walletBalances: Record<string, number>;\r\n  transactions: any[];\r\n}\r\n\r\nexport const CashSummaryDialog: React.FC<CashSummaryDialogProps> = ({ open, onOpenChange, userId, cashBalance, walletBalances, transactions }) => {\r\n  const [accessorySalesToday, setAccessorySalesToday] = React.useState(0);\r\n  const [ackAccessoryToday, setAckAccessoryToday] = React.useState(0);\r\n  const [maintenanceTotalToday, setMaintenanceTotalToday] = React.useState(0);\r\n  const [ackMaintenanceToday, setAckMaintenanceToday] = React.useState(0);\r\n  const [localCashBalance, setLocalCashBalance] = React.useState<number>(cashBalance || 0);\r\n  const [isReceiptPinOpen, setIsReceiptPinOpen] = React.useState(false);\r\n  const [pendingReceiptType, setPendingReceiptType] = React.useState<'accessory' | 'maintenance' | null>(null);\r\n  const { toast } = useToast();\r\n  const { shopId: shopIdCtx } = useShop() || ({} as any);\r\n  const { profile } = useFirebaseAuth();\r\n  const [isDeductReasonOpen, setIsDeductReasonOpen] = React.useState(false);\r\n  const [deductReason, setDeductReason] = React.useState('');\r\n  const [isDeductPinOpen, setIsDeductPinOpen] = React.useState(false);\r\n  const [isDeductAmountOpen, setIsDeductAmountOpen] = React.useState(false);\r\n  const [deductAmount, setDeductAmount] = React.useState('');\r\n\r\n  const getCashBalanceKey = () => `cashBalance_${userId || 'default'}_${(shopIdCtx || (profile as any)?.shopId || 'main')}`;\r\n  const getGenericCashKey = () => `cashBalance_${userId || 'default'}`;\r\n\r\n  const formatCurrency = (n: number) => `${new Intl.NumberFormat('ar-EG').format(Number(n || 0))} `;\r\n\r\n  React.useEffect(() => {\r\n    const loadAccessorySales = async () => {\r\n      try {\r\n        if (!userId) { setAccessorySalesToday(0); return; }\r\n        const d = new Date();\r\n        const y = d.getFullYear();\r\n        const m = String(d.getMonth() + 1).padStart(2, '0');\r\n        const dd = String(d.getDate()).padStart(2, '0');\r\n        const todayStr = `${y}-${m}-${dd}`;\r\n        let snap;\r\n        try {\r\n          const q = query(\r\n            collection(db, 'dailySales'),\r\n            where('userId', '==', userId),\r\n            ...(shopIdCtx ? [where('shopId', '==', shopIdCtx)] : []),\r\n            where('date', '==', todayStr)\r\n          );\r\n          snap = await getDocs(q);\r\n        } catch {\r\n          const q2 = query(\r\n            collection(db, 'users', userId, 'dailySales'),\r\n            ...(shopIdCtx ? [where('shopId', '==', shopIdCtx)] : []),\r\n            where('date', '==', todayStr)\r\n          );\r\n          snap = await getDocs(q2);\r\n        }\r\n        let total = 0;\r\n        snap.forEach(docSnap => {\r\n          const d: any = docSnap.data();\r\n          const price = Number(d.sellingPrice ?? 0);\r\n          const qty = Number(d.quantity ?? 0);\r\n          if (price > 0 && qty > 0) {\r\n            total += price * qty;\r\n          }\r\n        });\r\n        setAccessorySalesToday(total);\r\n      } catch (e) {\r\n        console.warn('    :', e);\r\n      }\r\n    };\r\n\r\n    const loadMaintenanceTotal = async () => {\r\n      try {\r\n        if (!userId) { setMaintenanceProfitToday(0); return; }\r\n        const d = new Date();\r\n        const start = new Date(d.getFullYear(), d.getMonth(), d.getDate(), 0, 0, 0, 0);\r\n        const end = new Date(d.getFullYear(), d.getMonth(), d.getDate(), 23, 59, 59, 999);\r\n        let snap;\r\n        try {\r\n          const q = query(\r\n            collection(db, 'maintenance_items'),\r\n            where('userId', '==', userId),\r\n            where('status', '==', 'completed')\r\n          );\r\n          snap = await getDocs(q);\r\n        } catch (e) {\r\n          snap = await getDocs(query(collection(db, 'maintenance_items'), where('userId', '==', userId)));\r\n        }\r\n        let totalAmount = 0;\r\n        snap.forEach(docSnap => {\r\n          const d: any = docSnap.data();\r\n          if ((d.status || 'in_progress') !== 'completed') return;\r\n          const completedAt = d.completedAt?.toDate?.();\r\n          if (!completedAt) return;\r\n          if (completedAt.getTime() >= start.getTime() && completedAt.getTime() <= end.getTime()) {\r\n            const repair = Number(d.repairPrice || 0);\r\n            if (Number.isFinite(repair) && repair > 0) totalAmount += repair;\r\n          }\r\n        });\r\n        setMaintenanceTotalToday(Math.max(0, totalAmount));\r\n      } catch (e) {\r\n        console.warn('     :', e);\r\n      }\r\n    };\r\n\r\n    \r\n\r\n    const loadDailyReceipts = async () => {\r\n      try {\r\n        if (!userId) { setAckAccessoryToday(0); return; }\r\n        const data = await userDataService.getUserData(userId);\r\n        const todayStr = new Date().toISOString().slice(0, 10);\r\n        const r = data?.dailyReceipts || {};\r\n        if (r?.date && String(r.date).slice(0,10) === todayStr) {\r\n          setAckAccessoryToday(Number(r.accessory || 0));\r\n          setAckMaintenanceToday(Number(r.maintenance || 0));\r\n        } else {\r\n          setAckAccessoryToday(0);\r\n          setAckMaintenanceToday(0);\r\n        }\r\n        try {\r\n          const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n          const snap = await getDoc(doc(db, 'dashboardData', sid));\r\n          if (snap.exists()) {\r\n            const v = Number((snap.data() as any)?.cashBalance || 0);\r\n            setLocalCashBalance(v);\r\n            try { localStorage.setItem(`cashBalance_${userId}`, String(v)); localStorage.setItem(getCashBalanceKey(), String(v)); } catch {}\r\n          } else {\r\n            setLocalCashBalance(Number(data?.cashBalance || cashBalance || 0));\r\n          }\r\n        } catch {\r\n          setLocalCashBalance(Number(data?.cashBalance || cashBalance || 0));\r\n        }\r\n      } catch (e) {\r\n        setAckAccessoryToday(0);\r\n        setAckMaintenanceToday(0);\r\n      }\r\n    };\r\n\r\n    if (open) {\r\n      loadAccessorySales();\r\n      loadMaintenanceTotal();\r\n      loadDailyReceipts();\r\n    }\r\n  }, [open, userId, transactions, cashBalance, shopIdCtx]);\r\n\r\n  React.useEffect(() => {\r\n    const handler = (e: any) => {\r\n      try {\r\n        const v = Number(e?.detail?.value);\r\n        if (Number.isFinite(v)) {\r\n          setLocalCashBalance(v);\r\n        }\r\n      } catch {}\r\n    };\r\n    window.addEventListener('cashBalanceChanged', handler as EventListener);\r\n    return () => window.removeEventListener('cashBalanceChanged', handler as EventListener);\r\n  }, [open]);\r\n\r\n  React.useEffect(() => {\r\n    if (!open || !userId) return;\r\n    const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n    let unsub: any = null;\r\n    try {\r\n      unsub = onSnapshot(doc(db, 'dashboardData', sid), (snap) => {\r\n        try {\r\n          if (snap.exists()) {\r\n            const v = Number((snap.data() as any)?.cashBalance || 0);\r\n            setLocalCashBalance(v);\r\n            try { localStorage.setItem(`cashBalance_${userId}`, String(v)); localStorage.setItem(getCashBalanceKey(), String(v)); } catch {}\r\n          }\r\n        } catch {}\r\n      });\r\n    } catch {}\r\n    return () => { try { if (typeof unsub === 'function') unsub(); } catch {} };\r\n  }, [open, userId, shopIdCtx]);\r\n\r\n  const effectiveAccessoryToday = Math.max(0, Number(accessorySalesToday) - Number(ackAccessoryToday));\r\n  const effectiveMaintenanceToday = Math.max(0, Number(maintenanceTotalToday) - Number(ackMaintenanceToday));\r\n\r\n  const handleReceipt = async (type: 'accessory' | 'maintenance') => {\r\n    if (!userId) return;\r\n    const todayStr = new Date().toISOString().slice(0, 10);\r\n    try {\r\n      const amountToAck = type === 'accessory' ? effectiveAccessoryToday : effectiveMaintenanceToday;\r\n      if (amountToAck <= 0) {\r\n        toast({ title: '    ', variant: 'default' });\r\n        return;\r\n      }\r\n      const newCash = Math.max(0, Number(localCashBalance) - amountToAck);\r\n      setLocalCashBalance(newCash);\r\n      if (type === 'accessory') {\r\n        setAckAccessoryToday(prev => prev + amountToAck);\r\n      } else {\r\n        setAckMaintenanceToday(prev => prev + amountToAck);\r\n      }\r\n      await userDataService.updateUserData(userId, {\r\n        cashBalance: newCash,\r\n        dailyReceipts: {\r\n          date: todayStr,\r\n          accessory: type === 'accessory' ? (ackAccessoryToday + amountToAck) : ackAccessoryToday,\r\n          maintenance: type === 'maintenance' ? (ackMaintenanceToday + amountToAck) : ackMaintenanceToday,\r\n        }\r\n      });\r\n      try {\r\n        const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n        await updateDoc(doc(db, 'dashboardData', sid), { cashBalance: newCash, lastUpdated: new Date().toISOString() } as any);\r\n      } catch { }\r\n      try {\r\n        localStorage.setItem(`cashBalance_${userId}`, String(newCash));\r\n        localStorage.setItem(getCashBalanceKey(), String(newCash));\r\n      } catch {}\r\n      try {\r\n        window.dispatchEvent(new CustomEvent('cashBalanceChanged', { detail: { value: newCash } }));\r\n      } catch {}\r\n      toast({ title: ' ', description: `  ${amountToAck.toFixed(2)}     ${type === 'accessory' ? '' : ''}` });\r\n    } catch (e) {\r\n      toast({ title: '', description: '    ', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  const startDeductionFlow = () => {\r\n    setDeductReason('');\r\n    setDeductAmount('');\r\n    setIsDeductReasonOpen(true);\r\n  };\r\n\r\n  const confirmDeductReason = () => {\r\n    if (!deductReason.trim()) {\r\n      toast({ title: '  ', variant: 'destructive' });\r\n      return;\r\n    }\r\n    setIsDeductReasonOpen(false);\r\n    setIsDeductPinOpen(true);\r\n  };\r\n\r\n  const openDeductAmount = () => {\r\n    setIsDeductPinOpen(false);\r\n    setIsDeductAmountOpen(true);\r\n  };\r\n\r\n  const performDeduction = async () => {\r\n    try {\r\n      if (!userId) return;\r\n      const amt = Math.max(0, Number(deductAmount || 0));\r\n      if (!Number.isFinite(amt) || amt <= 0) {\r\n        toast({ title: '  ', description: '      ', variant: 'destructive' });\r\n        return;\r\n      }\r\n      const newCash = Math.max(0, Number(localCashBalance) - amt);\r\n      setLocalCashBalance(newCash);\r\n      await userDataService.updateUserData(userId, { cashBalance: newCash });\r\n      try {\r\n        const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n        await updateDoc(doc(db, 'dashboardData', sid), { cashBalance: newCash, lastUpdated: new Date().toISOString() } as any);\r\n      } catch { }\r\n      try { localStorage.setItem(`cashBalance_${userId}`, String(newCash)); } catch {}\r\n      try { localStorage.setItem(getCashBalanceKey(), String(newCash)); } catch {}\r\n\r\n      const tx = {\r\n        title: '    ',\r\n        type: 'cash_deduction',\r\n        amount: amt,\r\n        status: 'completed',\r\n        createdAt: new Date(),\r\n        note: deductReason,\r\n        cashierName: ' '\r\n      };\r\n      try { await userDataService.saveUserTransaction(userId, tx); } catch {}\r\n\r\n      toast({ title: ' ', description: `  ${amt.toFixed(2)}  ` });\r\n      setIsDeductAmountOpen(false);\r\n      setDeductAmount('');\r\n      setDeductReason('');\r\n    } catch (e) {\r\n      toast({ title: ' ', description: '   ', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-lg animate-in fade-in-90 zoom-in-95 slide-in-from-top-4\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            <DollarSign className=\"h-5 w-5 text-emerald-600\" />\r\n              \r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-3\">\r\n          <div className=\"flex items-center justify-between bg-amber-50 border border-amber-200 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-amber-800 font-bold text-sm\">\r\n              <DollarSign className=\"h-4 w-4\" />\r\n                 ()\r\n            </div>\r\n            <div className=\"text-amber-700 font-extrabold text-sm\">\r\n              {formatCurrency(localCashBalance)}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between bg-blue-50 border border-blue-200 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-blue-800 font-bold text-sm\">\r\n              <Package className=\"h-4 w-4\" />\r\n               \r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"text-blue-700 font-extrabold text-sm\">\r\n                {formatCurrency(effectiveAccessoryToday)}\r\n              </div>\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"h-6 px-2 rounded-lg bg-gradient-to-r from-blue-100 to-blue-200 text-blue-700 hover:from-blue-200 hover:to-blue-300 hover:text-blue-800\"\r\n                onClick={() => { setPendingReceiptType('accessory'); setIsReceiptPinOpen(true); }}\r\n              >\r\n                 \r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between bg-emerald-50 border border-emerald-200 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-emerald-800 font-bold text-sm\">\r\n              <ArrowRightLeft className=\"h-4 w-4\" />\r\n               \r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"text-emerald-700 font-extrabold text-sm\">\r\n                {formatCurrency(effectiveMaintenanceToday)}\r\n              </div>\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"h-6 px-2 rounded-lg bg-gradient-to-r from-emerald-100 to-emerald-200 text-emerald-700 hover:from-emerald-200 hover:to-emerald-300 hover:text-emerald-800\"\r\n                onClick={() => { setPendingReceiptType('maintenance'); setIsReceiptPinOpen(true); }}\r\n              >\r\n                 \r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          \r\n\r\n          <div className=\"flex items-center justify-between bg-red-50 border border-red-200 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-red-800 font-bold text-sm\">\r\n                  \r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"h-6 px-2 rounded-lg bg-gradient-to-r from-red-100 to-red-200 text-red-700 hover:from-red-200 hover:to-red-300 hover:text-red-800\"\r\n                onClick={startDeductionFlow}\r\n              >\r\n                \r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/*       */}\r\n        <MasterPinDialog\r\n          open={isReceiptPinOpen}\r\n          onOpenChange={setIsReceiptPinOpen}\r\n          mode=\"verify\"\r\n          title=\"     \"\r\n          description=\"       \" \r\n          onSuccess={() => {\r\n            if (pendingReceiptType) {\r\n              handleReceipt(pendingReceiptType);\r\n              setPendingReceiptType(null);\r\n            }\r\n            setIsReceiptPinOpen(false);\r\n          }}\r\n        />\r\n\r\n        <Dialog open={isDeductReasonOpen} onOpenChange={setIsDeductReasonOpen}>\r\n          <DialogContent className=\"sm:max-w-sm\">\r\n            <DialogHeader>\r\n              <DialogTitle> </DialogTitle>\r\n            </DialogHeader>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"deduct-reason\">  </Label>\r\n              <Input id=\"deduct-reason\" value={deductReason} onChange={(e) => setDeductReason(e.target.value)} placeholder=\" \" />\r\n            </div>\r\n            <div className=\"flex justify-end gap-2 mt-3\">\r\n              <Button variant=\"outline\" onClick={() => setIsDeductReasonOpen(false)}></Button>\r\n              <Button onClick={confirmDeductReason} className=\"bg-red-600 hover:bg-red-700\"></Button>\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n\r\n        <MasterPinDialog\r\n          open={isDeductPinOpen}\r\n          onOpenChange={setIsDeductPinOpen}\r\n          mode=\"verify\"\r\n          title=\"    \"\r\n          description=\"      \"\r\n          onSuccess={openDeductAmount}\r\n        />\r\n\r\n        <Dialog open={isDeductAmountOpen} onOpenChange={setIsDeductAmountOpen}>\r\n          <DialogContent className=\"sm:max-w-sm\">\r\n            <DialogHeader>\r\n              <DialogTitle> </DialogTitle>\r\n            </DialogHeader>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"deduct-amount\">  </Label>\r\n              <Input id=\"deduct-amount\" type=\"number\" value={deductAmount} onChange={(e) => setDeductAmount(e.target.value)} placeholder=\"0.00\" />\r\n            </div>\r\n            <div className=\"flex justify-end gap-2 mt-3\">\r\n              <Button variant=\"outline\" onClick={() => setIsDeductAmountOpen(false)}></Button>\r\n              <Button onClick={performDeduction} className=\"bg-red-600 hover:bg-red-700\"> </Button>\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default CashSummaryDialog;\r\n","import React from 'react';\r\n\r\nexport interface FawryMachineIconProps extends React.SVGProps<SVGSVGElement> {\r\n  size?: number;\r\n}\r\n\r\n//    (POS) -   currentColor  \r\nexport default function FawryMachineIcon({ size = 24, className, ...props }: FawryMachineIconProps) {\r\n  return (\r\n    <svg\r\n      width={size}\r\n      height={size}\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      className={className}\r\n      {...props}\r\n    >\r\n      {/*   */}\r\n      <rect x=\"5\" y=\"2.5\" width=\"14\" height=\"19\" rx=\"2.5\" stroke=\"currentColor\" strokeWidth=\"1.5\" />\r\n      {/*  */}\r\n      <rect x=\"7\" y=\"4.5\" width=\"10\" height=\"5.5\" rx=\"1\" stroke=\"currentColor\" strokeWidth=\"1.2\" />\r\n      {/*   */}\r\n      <path d=\"M9.5 11.5h5\" stroke=\"currentColor\" strokeWidth=\"1.4\" strokeLinecap=\"round\" />\r\n      {/*   (3x3) */}\r\n      <circle cx=\"8.5\" cy=\"14\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n      <circle cx=\"12\" cy=\"14\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n      <circle cx=\"15.5\" cy=\"14\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n\r\n      <circle cx=\"8.5\" cy=\"17\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n      <circle cx=\"12\" cy=\"17\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n      <circle cx=\"15.5\" cy=\"17\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n\r\n      {/*    */}\r\n      <rect x=\"8\" y=\"19\" width=\"9\" height=\"1.8\" rx=\"0.6\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n    </svg>\r\n  );\r\n}","\"use client\";\n\n// src/alert-dialog.tsx\nimport * as React from \"react\";\nimport { createContextScope } from \"@radix-ui/react-context\";\nimport { useComposedRefs } from \"@radix-ui/react-compose-refs\";\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\";\nimport { createDialogScope } from \"@radix-ui/react-dialog\";\nimport { composeEventHandlers } from \"@radix-ui/primitive\";\nimport { createSlottable } from \"@radix-ui/react-slot\";\nimport { jsx, jsxs } from \"react/jsx-runtime\";\nvar ROOT_NAME = \"AlertDialog\";\nvar [createAlertDialogContext, createAlertDialogScope] = createContextScope(ROOT_NAME, [\n  createDialogScope\n]);\nvar useDialogScope = createDialogScope();\nvar AlertDialog = (props) => {\n  const { __scopeAlertDialog, ...alertDialogProps } = props;\n  const dialogScope = useDialogScope(__scopeAlertDialog);\n  return /* @__PURE__ */ jsx(DialogPrimitive.Root, { ...dialogScope, ...alertDialogProps, modal: true });\n};\nAlertDialog.displayName = ROOT_NAME;\nvar TRIGGER_NAME = \"AlertDialogTrigger\";\nvar AlertDialogTrigger = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...triggerProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Trigger, { ...dialogScope, ...triggerProps, ref: forwardedRef });\n  }\n);\nAlertDialogTrigger.displayName = TRIGGER_NAME;\nvar PORTAL_NAME = \"AlertDialogPortal\";\nvar AlertDialogPortal = (props) => {\n  const { __scopeAlertDialog, ...portalProps } = props;\n  const dialogScope = useDialogScope(__scopeAlertDialog);\n  return /* @__PURE__ */ jsx(DialogPrimitive.Portal, { ...dialogScope, ...portalProps });\n};\nAlertDialogPortal.displayName = PORTAL_NAME;\nvar OVERLAY_NAME = \"AlertDialogOverlay\";\nvar AlertDialogOverlay = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...overlayProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Overlay, { ...dialogScope, ...overlayProps, ref: forwardedRef });\n  }\n);\nAlertDialogOverlay.displayName = OVERLAY_NAME;\nvar CONTENT_NAME = \"AlertDialogContent\";\nvar [AlertDialogContentProvider, useAlertDialogContentContext] = createAlertDialogContext(CONTENT_NAME);\nvar Slottable = createSlottable(\"AlertDialogContent\");\nvar AlertDialogContent = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, children, ...contentProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    const contentRef = React.useRef(null);\n    const composedRefs = useComposedRefs(forwardedRef, contentRef);\n    const cancelRef = React.useRef(null);\n    return /* @__PURE__ */ jsx(\n      DialogPrimitive.WarningProvider,\n      {\n        contentName: CONTENT_NAME,\n        titleName: TITLE_NAME,\n        docsSlug: \"alert-dialog\",\n        children: /* @__PURE__ */ jsx(AlertDialogContentProvider, { scope: __scopeAlertDialog, cancelRef, children: /* @__PURE__ */ jsxs(\n          DialogPrimitive.Content,\n          {\n            role: \"alertdialog\",\n            ...dialogScope,\n            ...contentProps,\n            ref: composedRefs,\n            onOpenAutoFocus: composeEventHandlers(contentProps.onOpenAutoFocus, (event) => {\n              event.preventDefault();\n              cancelRef.current?.focus({ preventScroll: true });\n            }),\n            onPointerDownOutside: (event) => event.preventDefault(),\n            onInteractOutside: (event) => event.preventDefault(),\n            children: [\n              /* @__PURE__ */ jsx(Slottable, { children }),\n              /* @__PURE__ */ jsx(DescriptionWarning, { contentRef })\n            ]\n          }\n        ) })\n      }\n    );\n  }\n);\nAlertDialogContent.displayName = CONTENT_NAME;\nvar TITLE_NAME = \"AlertDialogTitle\";\nvar AlertDialogTitle = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...titleProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Title, { ...dialogScope, ...titleProps, ref: forwardedRef });\n  }\n);\nAlertDialogTitle.displayName = TITLE_NAME;\nvar DESCRIPTION_NAME = \"AlertDialogDescription\";\nvar AlertDialogDescription = React.forwardRef((props, forwardedRef) => {\n  const { __scopeAlertDialog, ...descriptionProps } = props;\n  const dialogScope = useDialogScope(__scopeAlertDialog);\n  return /* @__PURE__ */ jsx(DialogPrimitive.Description, { ...dialogScope, ...descriptionProps, ref: forwardedRef });\n});\nAlertDialogDescription.displayName = DESCRIPTION_NAME;\nvar ACTION_NAME = \"AlertDialogAction\";\nvar AlertDialogAction = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...actionProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Close, { ...dialogScope, ...actionProps, ref: forwardedRef });\n  }\n);\nAlertDialogAction.displayName = ACTION_NAME;\nvar CANCEL_NAME = \"AlertDialogCancel\";\nvar AlertDialogCancel = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...cancelProps } = props;\n    const { cancelRef } = useAlertDialogContentContext(CANCEL_NAME, __scopeAlertDialog);\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    const ref = useComposedRefs(forwardedRef, cancelRef);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Close, { ...dialogScope, ...cancelProps, ref });\n  }\n);\nAlertDialogCancel.displayName = CANCEL_NAME;\nvar DescriptionWarning = ({ contentRef }) => {\n  const MESSAGE = `\\`${CONTENT_NAME}\\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \\`${CONTENT_NAME}\\` by passing a \\`${DESCRIPTION_NAME}\\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \\`id\\` and passing the same value to the \\`aria-describedby\\` prop in \\`${CONTENT_NAME}\\`. If the description is confusing or duplicative for sighted users, you can use the \\`@radix-ui/react-visually-hidden\\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;\n  React.useEffect(() => {\n    const hasDescription = document.getElementById(\n      contentRef.current?.getAttribute(\"aria-describedby\")\n    );\n    if (!hasDescription) console.warn(MESSAGE);\n  }, [MESSAGE, contentRef]);\n  return null;\n};\nvar Root2 = AlertDialog;\nvar Trigger2 = AlertDialogTrigger;\nvar Portal2 = AlertDialogPortal;\nvar Overlay2 = AlertDialogOverlay;\nvar Content2 = AlertDialogContent;\nvar Action = AlertDialogAction;\nvar Cancel = AlertDialogCancel;\nvar Title2 = AlertDialogTitle;\nvar Description2 = AlertDialogDescription;\nexport {\n  Action,\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogOverlay,\n  AlertDialogPortal,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n  Cancel,\n  Content2 as Content,\n  Description2 as Description,\n  Overlay2 as Overlay,\n  Portal2 as Portal,\n  Root2 as Root,\n  Title2 as Title,\n  Trigger2 as Trigger,\n  createAlertDialogScope\n};\n//# sourceMappingURL=index.mjs.map\n","import * as React from \"react\"\r\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\nimport { buttonVariants } from \"@/components/ui/button\"\r\n\r\nconst AlertDialog = AlertDialogPrimitive.Root\r\n\r\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\r\n\r\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\r\n\r\nconst AlertDialogOverlay = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Overlay\r\n    className={cn(\r\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\r\n      className\r\n    )}\r\n    {...props}\r\n    ref={ref}\r\n  />\r\n))\r\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\r\n\r\nconst AlertDialogContent = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPortal>\r\n    <AlertDialogOverlay />\r\n    <AlertDialogPrimitive.Content\r\n      ref={ref}\r\n      className={cn(\r\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  </AlertDialogPortal>\r\n))\r\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\r\n\r\nconst AlertDialogHeader = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) => (\r\n  <div\r\n    className={cn(\r\n      \"flex flex-col space-y-2 text-center sm:text-left\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n)\r\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\r\n\r\nconst AlertDialogFooter = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) => (\r\n  <div\r\n    className={cn(\r\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n)\r\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\r\n\r\nconst AlertDialogTitle = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Title\r\n    ref={ref}\r\n    className={cn(\"text-lg font-semibold\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\r\n\r\nconst AlertDialogDescription = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Description\r\n    ref={ref}\r\n    className={cn(\"text-sm text-muted-foreground\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogDescription.displayName =\r\n  AlertDialogPrimitive.Description.displayName\r\n\r\nconst AlertDialogAction = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Action\r\n    ref={ref}\r\n    className={cn(buttonVariants(), className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\r\n\r\nconst AlertDialogCancel = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Cancel\r\n    ref={ref}\r\n    className={cn(\r\n      buttonVariants({ variant: \"outline\" }),\r\n      \"mt-2 sm:mt-0\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\r\n\r\nexport {\r\n  AlertDialog,\r\n  AlertDialogPortal,\r\n  AlertDialogOverlay,\r\n  AlertDialogTrigger,\r\n  AlertDialogContent,\r\n  AlertDialogHeader,\r\n  AlertDialogFooter,\r\n  AlertDialogTitle,\r\n  AlertDialogDescription,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n}\r\n","import React, { useEffect, useMemo, useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from '@/components/ui/dialog';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { Receipt, Calendar, Clock, ChevronDown, Trash2 } from 'lucide-react';\r\nimport FawryMachineIcon from '@/components/icons/FawryMachineIcon';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useShift } from '@/contexts/ShiftContext';\r\nimport { AlertDialog, AlertDialogContent, AlertDialogHeader, AlertDialogTitle, AlertDialogDescription, AlertDialogAction, AlertDialogCancel } from '@/components/ui/alert-dialog';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { db } from '@/firebase';\r\nimport { addDoc, collection, doc, setDoc, serverTimestamp, deleteDoc, getDocs, onSnapshot, orderBy, query } from 'firebase/firestore';\r\nimport { useShop } from '@/hooks/useShop';\r\n\r\ninterface MachineDailyDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\ninterface MachineReceipt {\r\n  id: string;\r\n  openingBase: number; //   \r\n  openingAir: number;  //   \r\n  deliveryBase: number; //    \r\n  deliveryAir: number;  //    \r\n  netResult: number;    //  : () - ()\r\n  createdAt: string;    //  \r\n  cashierName?: string; //    \r\n  requiredDrawerNoProfit?: number; //     \r\n}\r\n\r\ninterface TransferReceipt {\r\n  id: string;\r\n  wholesalePrice: number; //    \r\n  retailPrice: number;    //    \r\n  profit: number;         //  :  - \r\n  createdAt: string;\r\n  cashierName?: string;\r\n  deductFrom?: 'base' | 'air'; //  :   \r\n}\r\n\r\nconst formatNumber = (n: number) => {\r\n  try { return n.toLocaleString('en-US', { maximumFractionDigits: 2 }); } catch { return String(n); }\r\n};\r\n\r\nconst formatDateTime = (iso?: string) => {\r\n  try {\r\n    const d = iso ? new Date(iso) : new Date();\r\n    return d.toLocaleString('en-GB', {\r\n      year: 'numeric', month: '2-digit', day: '2-digit',\r\n      hour: '2-digit', minute: '2-digit', second: '2-digit',\r\n      hour12: false,\r\n    });\r\n  } catch {\r\n    return new Date().toISOString();\r\n  }\r\n};\r\n\r\n//         \r\nconst STORAGE_KEY_OPENING = 'machine_daily_opening_values';\r\nconst STORAGE_KEY_OPENING_SNAPSHOT = 'machine_daily_opening_snapshot';\r\n\r\nexport default function MachineDailyDialog({ open, onOpenChange }: MachineDailyDialogProps) {\r\n  const { toast } = useToast();\r\n  const { shiftUser } = useShift();\r\n  const { shopId, shopName } = useShop();\r\n  const getFallbackShopId = () => {\r\n    try {\r\n      const keys = Object.keys(localStorage || {}).filter(k => k.startsWith('selectedShopId_'));\r\n      for (const k of keys) {\r\n        const v = localStorage.getItem(k);\r\n        if (v) return v;\r\n      }\r\n      return null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  //           \r\n  useEffect(() => {\r\n    try {\r\n      if (open) {\r\n        const prev = document.body.style.overflow;\r\n        document.body.setAttribute('data-prev-overflow', prev);\r\n        document.body.style.overflow = 'hidden';\r\n      } else {\r\n        const prev = document.body.getAttribute('data-prev-overflow') || '';\r\n        document.body.style.overflow = prev;\r\n        document.body.removeAttribute('data-prev-overflow');\r\n      }\r\n    } catch {}\r\n    return () => {\r\n      try {\r\n        const prev = document.body.getAttribute('data-prev-overflow') || '';\r\n        document.body.style.overflow = prev;\r\n        document.body.removeAttribute('data-prev-overflow');\r\n      } catch {}\r\n    };\r\n  }, [open]);\r\n\r\n  //   \r\n  const [openingBase, setOpeningBase] = useState<string>('');\r\n  const [openingAir, setOpeningAir] = useState<string>('');\r\n  const [drawerCash, setDrawerCash] = useState<string>('');\r\n\r\n  //    \r\n  const [savedOpeningBase, setSavedOpeningBase] = useState<number | null>(null);\r\n  const [savedOpeningAir, setSavedOpeningAir] = useState<number | null>(null);\r\n  const [savedDrawerCash, setSavedDrawerCash] = useState<number | null>(null);\r\n  const [openingSnapshot, setOpeningSnapshot] = useState<{ openingBase: number; openingAir: number; drawerCash: number } | null>(null);\r\n\r\n  // /   \r\n  const [isOpeningOpen, setIsOpeningOpen] = useState(false);\r\n\r\n  //   \r\n  const [isDeliverySectionOpen, setIsDeliverySectionOpen] = useState(false);\r\n  const [deliveryBase, setDeliveryBase] = useState<string>('');\r\n  const [deliveryAir, setDeliveryAir] = useState<string>('');\r\n  const [netResult, setNetResult] = useState<number | null>(null);\r\n\r\n  //    (  )\r\n  const [receipts, setReceipts] = useState<MachineReceipt[]>([]);\r\n\r\n  //    (  )\r\n  const [transferReceipts, setTransferReceipts] = useState<TransferReceipt[]>([]);\r\n\r\n  //     /\r\n  const [transferDialogOpen, setTransferDialogOpen] = useState(false);\r\n  const [wholesalePrice, setWholesalePrice] = useState<string>('');\r\n  const [retailPrice, setRetailPrice] = useState<string>('');\r\n\r\n  //      \r\n  const [deductDialogOpen, setDeductDialogOpen] = useState(false);\r\n  const [pendingTransfer, setPendingTransfer] = useState<{\r\n    wholesalePrice: number;\r\n    retailPrice: number;\r\n    profit: number;\r\n  } | null>(null);\r\n\r\n  //   (/)\r\n  const [machines, setMachines] = useState<{ id: string; name: string }[]>([]);\r\n  const [selectedMachineId, setSelectedMachineId] = useState<string | null>(null);\r\n  const [newMachineName, setNewMachineName] = useState<string>('');\r\n  const [transferServerHydrated, setTransferServerHydrated] = useState(false);\r\n  const [deliveriesServerHydrated, setDeliveriesServerHydrated] = useState(false);\r\n\r\n  // Hydrate per-machine opening values when dialog opens or machine changes\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    try {\r\n      const keyOpening = selectedMachineId ? `${STORAGE_KEY_OPENING}_${selectedMachineId}` : STORAGE_KEY_OPENING;\r\n      const keySnap = selectedMachineId ? `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}` : STORAGE_KEY_OPENING_SNAPSHOT;\r\n      const savedOpening = localStorage.getItem(keyOpening);\r\n      if (savedOpening) {\r\n        const obj = JSON.parse(savedOpening);\r\n        if (typeof obj?.openingBase === 'number') setSavedOpeningBase(obj.openingBase);\r\n        if (typeof obj?.openingAir === 'number') setSavedOpeningAir(obj.openingAir);\r\n        if (typeof obj?.drawerCash === 'number') setSavedDrawerCash(obj.drawerCash);\r\n      } else {\r\n        setSavedOpeningBase(null);\r\n        setSavedOpeningAir(null);\r\n        setSavedDrawerCash(null);\r\n      }\r\n\r\n      const savedSnap = localStorage.getItem(keySnap);\r\n      if (savedSnap) {\r\n        const snap = JSON.parse(savedSnap);\r\n        if (typeof snap?.openingBase === 'number' && typeof snap?.openingAir === 'number') {\r\n          setOpeningSnapshot({ openingBase: snap.openingBase, openingAir: snap.openingAir, drawerCash: snap.drawerCash || 0 });\r\n        } else {\r\n          setOpeningSnapshot(null);\r\n        }\r\n      } else {\r\n        setOpeningSnapshot(null);\r\n      }\r\n    } catch {}\r\n  }, [open, selectedMachineId]);\r\n\r\n  //      \r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const sid = shopId || getFallbackShopId();\r\n        if (!open || !sid) return;\r\n        const { getDocs } = await import('firebase/firestore');\r\n        const col = collection(db, 'shops', sid, 'machines');\r\n        const snap = await getDocs(query(col));\r\n        const list = snap.docs.map(d => ({ id: d.id, name: String(d.data().name || '') }));\r\n        setMachines(list);\r\n        try {\r\n          const savedId = localStorage.getItem(`machineDaily_selected_${sid}`);\r\n          const exists = savedId && list.some(m => m.id === savedId);\r\n          if (exists) {\r\n            setSelectedMachineId(savedId as string);\r\n          } else if (!selectedMachineId && list.length > 0) {\r\n            setSelectedMachineId(list[0].id);\r\n            localStorage.setItem(`machineDaily_selected_${sid}`, list[0].id);\r\n          }\r\n        } catch {}\r\n      } catch (err) {\r\n        console.error('Load machines error:', err);\r\n      }\r\n    })();\r\n  }, [open, shopId]);\r\n\r\n  //       \r\n\r\n  const cashierName = useMemo(() => {\r\n    return shiftUser?.displayName || shiftUser?.name || shiftUser?.username || undefined;\r\n  }, [shiftUser]);\r\n\r\n  const totalTransferProfit = useMemo(() => transferReceipts.reduce((sum, t) => sum + (t.profit || 0), 0), [transferReceipts]);\r\n  const totalWholesaleTransferred = useMemo(() => transferReceipts.reduce((sum, t) => sum + (t.wholesalePrice || 0), 0), [transferReceipts]);\r\n\r\n  const handleClearTransferReceipts = async () => {\r\n    try {\r\n      const sid = shopId || getFallbackShopId();\r\n      if (sid && selectedMachineId) {\r\n        const col = collection(db, 'shops', sid, 'machines', selectedMachineId, 'transfers');\r\n        const snap = await getDocs(query(col));\r\n        await Promise.all(snap.docs.map(d => deleteDoc(d.ref)));\r\n        try { localStorage.setItem(`machineDaily_transfers_${sid}_${selectedMachineId}`, JSON.stringify([])); } catch {}\r\n      }\r\n    } catch {}\r\n    setTransferReceipts([]);\r\n    toast({ title: '  ', description: '    .' });\r\n  };\r\n\r\n  const handleClearMachineReceipts = async () => {\r\n    try {\r\n      const sid = shopId || getFallbackShopId();\r\n      if (sid && selectedMachineId) {\r\n        const col = collection(db, 'shops', sid, 'machines', selectedMachineId, 'deliveries');\r\n        const snap = await getDocs(query(col));\r\n        await Promise.all(snap.docs.map(d => deleteDoc(d.ref)));\r\n        try { localStorage.setItem(`machineDaily_deliveries_${sid}_${selectedMachineId}`, JSON.stringify([])); } catch {}\r\n      }\r\n    } catch {}\r\n    setReceipts([]);\r\n    toast({ title: '  ', description: '    .' });\r\n  };\r\n\r\n  const handleDeleteMachineReceipt = (id: string) => {\r\n    setReceipts(prev => prev.filter(r => r.id !== id));\r\n    toast({ title: '  ', description: '    .' });\r\n  };\r\n\r\n  //     \r\n  const handleResetOpening = () => {\r\n    setSavedOpeningBase(null);\r\n    setSavedOpeningAir(null);\r\n    setSavedDrawerCash(null);\r\n    setOpeningSnapshot(null);\r\n  \r\n    setOpeningBase('');\r\n    setOpeningAir('');\r\n    setDrawerCash('');\r\n  \r\n    try {\r\n      const keyOpening = selectedMachineId ? `${STORAGE_KEY_OPENING}_${selectedMachineId}` : STORAGE_KEY_OPENING;\r\n      const keySnap = selectedMachineId ? `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}` : STORAGE_KEY_OPENING_SNAPSHOT;\r\n      localStorage.removeItem(keyOpening);\r\n      localStorage.removeItem(keySnap);\r\n    } catch {}\r\n  \r\n    toast({ title: ' ', description: '     .' });\r\n  };\r\n  const handleAddOpening = async () => {\r\n    const base = parseFloat(openingBase || '0');\r\n    const air = parseFloat(openingAir || '0');\r\n    const dc = parseFloat(drawerCash || '0');\r\n\r\n    if (isNaN(base) || isNaN(air) || isNaN(dc)) {\r\n      toast({ title: '  ', description: '       .', variant: 'destructive' });\r\n      return;\r\n    }\r\n    if (base < 0 || air < 0 || dc < 0) {\r\n      toast({ title: ' ', description: '    .', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    setSavedOpeningBase(base);\r\n    setSavedOpeningAir(air);\r\n    setSavedDrawerCash(dc);\r\n    try {\r\n      const keyOpening = selectedMachineId ? `${STORAGE_KEY_OPENING}_${selectedMachineId}` : STORAGE_KEY_OPENING;\r\n      const keySnap = selectedMachineId ? `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}` : STORAGE_KEY_OPENING_SNAPSHOT;\r\n      localStorage.setItem(keyOpening, JSON.stringify({ openingBase: base, openingAir: air, drawerCash: dc }));\r\n      localStorage.setItem(keySnap, JSON.stringify({ openingBase: base, openingAir: air, drawerCash: dc }));\r\n      setOpeningSnapshot({ openingBase: base, openingAir: air, drawerCash: dc });\r\n      //   Firestore   \r\n      const sid0 = shopId || getFallbackShopId();\r\n      if (sid0 && selectedMachineId) {\r\n        const ref = doc(db, 'shops', sid0, 'machines', selectedMachineId);\r\n        await setDoc(ref, {\r\n          name: machines.find(m => m.id === selectedMachineId)?.name || '',\r\n          openingBase: base,\r\n          openingAir: air,\r\n          drawerCash: dc,\r\n          cashierName,\r\n          shopName: shopName || null,\r\n          updatedAt: serverTimestamp(),\r\n        }, { merge: true });\r\n      }\r\n    } catch {}\r\n\r\n    toast({ title: '  ', description: ` : ${formatNumber(base)} : ${formatNumber(air)}  : ${formatNumber(dc)}` });\r\n  };\r\n\r\n  const handleStartDelivery = () => {\r\n    if (savedOpeningBase == null || savedOpeningAir == null) {\r\n      toast({ title: '   ', description: '    \"\"   .' });\r\n      return;\r\n    }\r\n    setIsDeliverySectionOpen(true);\r\n  };\r\n\r\n  const handleDoDelivery = () => {\r\n    const dBase = parseFloat(deliveryBase || '0');\r\n    const dAir = parseFloat(deliveryAir || '0');\r\n\r\n    if (isNaN(dBase) || isNaN(dAir)) {\r\n      toast({ title: '  ', description: '     .', variant: 'destructive' });\r\n      return;\r\n    }\r\n    if (dBase < 0 || dAir < 0) {\r\n      toast({ title: ' ', description: '    .', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    const openingBaseForReceipt = openingSnapshot?.openingBase ?? (savedOpeningBase || 0);\r\n    const openingAirForReceipt = openingSnapshot?.openingAir ?? (savedOpeningAir || 0);\r\n\r\n    const openingSum = (openingBaseForReceipt) + (openingAirForReceipt);\r\n    const deliverySum = dBase + dAir;\r\n    const result = deliverySum - openingSum;\r\n\r\n    setNetResult(result);\r\n\r\n    const receipt: MachineReceipt = {\r\n      id: `${Date.now()}`,\r\n      openingBase: openingBaseForReceipt,\r\n      openingAir: openingAirForReceipt,\r\n      deliveryBase: dBase,\r\n      deliveryAir: dAir,\r\n      netResult: result,\r\n      createdAt: new Date().toISOString(),\r\n      cashierName,\r\n      requiredDrawerNoProfit: result < 0 ? Math.round(-result * 100) / 100 : 0,\r\n    };\r\n\r\n    //    Firestore   \r\n    void (async () => {\r\n      try {\r\n        const sid1 = shopId || getFallbackShopId();\r\n        if (sid1 && selectedMachineId) {\r\n          await addDoc(collection(db, 'shops', sid1, 'machines', selectedMachineId, 'deliveries'), {\r\n            cashierName,\r\n            openingBase: openingBaseForReceipt,\r\n            openingAir: openingAirForReceipt,\r\n            deliveryBase: dBase,\r\n            deliveryAir: dAir,\r\n            netResult: result,\r\n            createdAt: serverTimestamp(),\r\n          });\r\n          await setDoc(doc(db, 'shops', sid1, 'machines', selectedMachineId), {\r\n            lastDeliveryAt: serverTimestamp(),\r\n            updatedAt: serverTimestamp(),\r\n          }, { merge: true });\r\n        }\r\n      } catch (err) {\r\n        console.error('Persist delivery error:', err);\r\n      }\r\n    })();\r\n\r\n    setReceipts((prev) => [receipt, ...prev]);\r\n    try {\r\n      const sid = shopId || getFallbackShopId();\r\n      const key = sid && selectedMachineId ? `machineDaily_deliveries_${sid}_${selectedMachineId}` : `machineDaily_deliveries_${selectedMachineId}`;\r\n      const current = localStorage.getItem(key);\r\n      const arr = current ? JSON.parse(current) : [];\r\n      const next = [receipt, ...(Array.isArray(arr) ? arr : [])];\r\n      localStorage.setItem(key, JSON.stringify(next));\r\n    } catch {}\r\n\r\n    toast({ title: '   ', description: ` : ${formatNumber(result)}` });\r\n  };\r\n\r\n  const handleTransferConfirm = () => {\r\n    const w = parseFloat(wholesalePrice || '0');\r\n    const r = parseFloat(retailPrice || '0');\r\n    if (!Number.isFinite(w) || !Number.isFinite(r)) {\r\n      toast({ title: '  ', description: '       .', variant: 'destructive' });\r\n      return;\r\n    }\r\n    if (w < 0 || r < 0) {\r\n      toast({ title: ' ', description: '    .', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    if (savedOpeningBase == null || savedOpeningAir == null) {\r\n      toast({ title: '   ', description: '        \"\".' });\r\n      return;\r\n    }\r\n\r\n    const profit = Math.round((r - w) * 100) / 100;\r\n    setPendingTransfer({ wholesalePrice: w, retailPrice: r, profit });\r\n    setDeductDialogOpen(true);\r\n  };\r\n\r\n  const finalizeTransfer = async (from: 'base' | 'air') => {\r\n    if (!pendingTransfer) return;\r\n    const receipt: TransferReceipt = {\r\n      id: `transfer_${Date.now()}`,\r\n      wholesalePrice: pendingTransfer.wholesalePrice,\r\n      retailPrice: pendingTransfer.retailPrice,\r\n      profit: pendingTransfer.profit,\r\n      createdAt: new Date().toISOString(),\r\n      cashierName,\r\n      deductFrom: from,\r\n    };\r\n\r\n    //     \r\n    const stockDeductAmount = pendingTransfer.wholesalePrice; //     \r\n    const prevBase = savedOpeningBase ?? 0;\r\n    const prevAir = savedOpeningAir ?? 0;\r\n    const prevDrawer = savedDrawerCash ?? 0;\r\n\r\n    //      \r\n    const availableStock = from === 'base' ? prevBase : prevAir;\r\n    if (stockDeductAmount > availableStock) {\r\n      toast({ title: '  ', description: '      .', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    const newBase = from === 'base' ? Math.round((prevBase - stockDeductAmount) * 100) / 100 : prevBase;\r\n    const newAir = from === 'air' ? Math.round((prevAir - stockDeductAmount) * 100) / 100 : prevAir;\r\n    const totalDrawerAdded = pendingTransfer.retailPrice;\r\n    const newDrawer = Math.round((prevDrawer + totalDrawerAdded) * 100) / 100;\r\n\r\n    setSavedOpeningBase(newBase);\r\n    setSavedOpeningAir(newAir);\r\n    setSavedDrawerCash(newDrawer);\r\n    try {\r\n      const keyOpening = selectedMachineId ? `${STORAGE_KEY_OPENING}_${selectedMachineId}` : STORAGE_KEY_OPENING;\r\n      const keySnap = selectedMachineId ? `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}` : STORAGE_KEY_OPENING_SNAPSHOT;\r\n      localStorage.setItem(keyOpening, JSON.stringify({ openingBase: newBase, openingAir: newAir, drawerCash: newDrawer }));\r\n      localStorage.setItem(keySnap, JSON.stringify({ openingBase: newBase, openingAir: newAir, drawerCash: newDrawer }));\r\n      //    Firestore +   \r\n      const sid2 = shopId || getFallbackShopId();\r\n      if (sid2 && selectedMachineId) {\r\n        const machineRef = doc(db, 'shops', sid2, 'machines', selectedMachineId);\r\n        await setDoc(machineRef, {\r\n          openingBase: newBase,\r\n          openingAir: newAir,\r\n          drawerCash: newDrawer,\r\n          cashierName,\r\n          updatedAt: serverTimestamp(),\r\n        }, { merge: true });\r\n        await addDoc(collection(db, 'shops', sid2, 'machines', selectedMachineId, 'transfers'), {\r\n          wholesalePrice: pendingTransfer.wholesalePrice,\r\n          retailPrice: pendingTransfer.retailPrice,\r\n          profit: pendingTransfer.profit,\r\n          deductFrom: from,\r\n          cashierName,\r\n          createdAt: serverTimestamp(),\r\n        });\r\n      }\r\n    } catch {}\r\n\r\n    setTransferReceipts(prev => [receipt, ...prev]);\r\n    try {\r\n      const sidKey = shopId || getFallbackShopId();\r\n      const key = sidKey && selectedMachineId ? `machineDaily_transfers_${sidKey}_${selectedMachineId}` : 'machineDaily_transfers';\r\n      const current = localStorage.getItem(key);\r\n      const arr = current ? JSON.parse(current) : [];\r\n      const next = [receipt, ...(Array.isArray(arr) ? arr : [])];\r\n      localStorage.setItem(key, JSON.stringify(next));\r\n    } catch {}\r\n    setTransferDialogOpen(false);\r\n    setWholesalePrice('');\r\n    setRetailPrice('');\r\n    setPendingTransfer(null);\r\n    setDeductDialogOpen(false);\r\n    toast({ title: '  ', description: ` : ${formatNumber(receipt.profit)} |  : -${formatNumber(stockDeductAmount)} (${from === 'base' ? '' : ''}) |  ( ): +${formatNumber(totalDrawerAdded)}` });\r\n  };\r\n\r\n  const resetDialogState = () => {\r\n    setOpeningBase('');\r\n    setOpeningAir('');\r\n    setIsDeliverySectionOpen(false);\r\n    setDeliveryBase('');\r\n    setDeliveryAir('');\r\n    setNetResult(null);\r\n  };\r\n\r\n  //     Firestore      \r\n  useEffect(() => {\r\n    const sid = shopId || getFallbackShopId();\r\n    if (!open || !sid || !selectedMachineId) return;\r\n    try {\r\n      const col = collection(db, 'shops', sid, 'machines', selectedMachineId, 'transfers');\r\n      const unsub = onSnapshot(col, async (snap) => {\r\n        const list: TransferReceipt[] = snap.docs.map((d) => {\r\n          const x: any = d.data();\r\n          const created = x?.createdAt?.toDate?.() ? x.createdAt.toDate() : new Date();\r\n          const ded: any = x?.deductFrom;\r\n          return {\r\n            id: d.id,\r\n            wholesalePrice: Number(x?.wholesalePrice || 0),\r\n            retailPrice: Number(x?.retailPrice || 0),\r\n            profit: Number(x?.profit ?? ((Number(x?.retailPrice || 0) - Number(x?.wholesalePrice || 0)) || 0)),\r\n            createdAt: created.toISOString(),\r\n            cashierName: x?.cashierName || undefined,\r\n            deductFrom: ded === 'base' || ded === 'air' ? ded : undefined,\r\n          } as TransferReceipt;\r\n        });\r\n        const sorted = [...list].sort((a, b) => {\r\n          const ta = new Date(a.createdAt).getTime();\r\n          const tb = new Date(b.createdAt).getTime();\r\n          return tb - ta;\r\n        });\r\n        if (sorted.length > 0) {\r\n          setTransferReceipts(sorted);\r\n          setTransferServerHydrated(true);\r\n          try { localStorage.setItem(`machineDaily_transfers_${sid}_${selectedMachineId}`, JSON.stringify(sorted)); } catch {}\r\n        } else {\r\n          if (transferServerHydrated) {\r\n            setTransferReceipts([]);\r\n            try { localStorage.setItem(`machineDaily_transfers_${sid}_${selectedMachineId}`, JSON.stringify([])); } catch {}\r\n          }\r\n        }\r\n      });\r\n      return () => { try { unsub(); } catch {} };\r\n    } catch {}\r\n  }, [open, shopId, selectedMachineId, transferServerHydrated]);\r\n\r\n  useEffect(() => {\r\n    const sid = shopId || getFallbackShopId();\r\n    if (!open || !sid || !selectedMachineId) return;\r\n    try {\r\n      const col = collection(db, 'shops', sid, 'machines', selectedMachineId, 'deliveries');\r\n      const unsub = onSnapshot(col, (snap) => {\r\n        const list: MachineReceipt[] = snap.docs.map((d) => {\r\n          const x: any = d.data();\r\n          const created = x?.createdAt?.toDate?.() ? x.createdAt.toDate() : new Date();\r\n          return {\r\n            id: d.id,\r\n            openingBase: Number(x?.openingBase || 0),\r\n            openingAir: Number(x?.openingAir || 0),\r\n            deliveryBase: Number(x?.deliveryBase || 0),\r\n            deliveryAir: Number(x?.deliveryAir || 0),\r\n            netResult: typeof x?.netResult === 'number'\r\n              ? Number(x.netResult)\r\n              : Math.round(((Number(x?.deliveryBase || 0) + Number(x?.deliveryAir || 0)) - (Number(x?.openingBase || 0) + Number(x?.openingAir || 0))) * 100) / 100,\r\n            createdAt: created.toISOString(),\r\n            cashierName: x?.cashierName || undefined,\r\n            requiredDrawerNoProfit: typeof x?.requiredDrawerNoProfit === 'number' ? x.requiredDrawerNoProfit : undefined,\r\n          } as MachineReceipt;\r\n        });\r\n        const sorted = [...list].sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n        if (sorted.length > 0) {\r\n          setReceipts(sorted);\r\n          setDeliveriesServerHydrated(true);\r\n          try { localStorage.setItem(`machineDaily_deliveries_${sid}_${selectedMachineId}`, JSON.stringify(sorted)); } catch {}\r\n        } else {\r\n          if (deliveriesServerHydrated) {\r\n            setReceipts([]);\r\n            try { localStorage.setItem(`machineDaily_deliveries_${sid}_${selectedMachineId}`, JSON.stringify([])); } catch {}\r\n          }\r\n        }\r\n      });\r\n      return () => { try { unsub(); } catch {} };\r\n    } catch {}\r\n  }, [open, shopId, selectedMachineId, deliveriesServerHydrated]);\r\n\r\n  useEffect(() => {\r\n    if (!open || !selectedMachineId) return;\r\n    try {\r\n      const sid = shopId || getFallbackShopId();\r\n      const key = sid ? `machineDaily_deliveries_${sid}_${selectedMachineId}` : `machineDaily_deliveries_${selectedMachineId}`;\r\n      const cached = localStorage.getItem(key);\r\n      if (cached) {\r\n        const parsed = JSON.parse(cached);\r\n        if (Array.isArray(parsed) && parsed.length > 0) setReceipts(parsed);\r\n      }\r\n      (async () => {\r\n        try {\r\n          const sid2 = shopId || getFallbackShopId();\r\n          if (!sid2) return;\r\n          const col = collection(db, 'shops', sid2, 'machines', selectedMachineId, 'deliveries');\r\n          const snap = await getDocs(query(col));\r\n          const list: MachineReceipt[] = snap.docs.map((d) => {\r\n            const x: any = d.data();\r\n            const created = x?.createdAt?.toDate?.() ? x.createdAt.toDate() : new Date();\r\n            return {\r\n              id: d.id,\r\n              openingBase: Number(x?.openingBase || 0),\r\n              openingAir: Number(x?.openingAir || 0),\r\n              deliveryBase: Number(x?.deliveryBase || 0),\r\n              deliveryAir: Number(x?.deliveryAir || 0),\r\n              netResult: typeof x?.netResult === 'number'\r\n                ? Number(x.netResult)\r\n                : Math.round(((Number(x?.deliveryBase || 0) + Number(x?.deliveryAir || 0)) - (Number(x?.openingBase || 0) + Number(x?.openingAir || 0))) * 100) / 100,\r\n              createdAt: created.toISOString(),\r\n              cashierName: x?.cashierName || undefined,\r\n              requiredDrawerNoProfit: typeof x?.requiredDrawerNoProfit === 'number' ? x.requiredDrawerNoProfit : undefined,\r\n            } as MachineReceipt;\r\n          });\r\n          const sorted = [...list].sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n          if (sorted.length > 0) {\r\n            setReceipts(sorted);\r\n            try { localStorage.setItem(`machineDaily_deliveries_${sid2}_${selectedMachineId}`, JSON.stringify(sorted)); } catch {}\r\n          }\r\n        } catch {}\r\n      })();\r\n    } catch {}\r\n  }, [open, shopId, selectedMachineId]);\r\n\r\n  useEffect(() => {\r\n    if (!open || !selectedMachineId) return;\r\n    try {\r\n      const sid = shopId || getFallbackShopId();\r\n      const key = sid ? `machineDaily_transfers_${sid}_${selectedMachineId}` : `machineDaily_transfers_${selectedMachineId}`;\r\n      const cached = localStorage.getItem(key);\r\n      if (cached) {\r\n        const parsed = JSON.parse(cached);\r\n        if (Array.isArray(parsed) && parsed.length > 0) {\r\n          setTransferReceipts(parsed);\r\n        }\r\n      }\r\n      (async () => {\r\n        try {\r\n          const sid2 = shopId || getFallbackShopId();\r\n          if (!sid2) return;\r\n          const col = collection(db, 'shops', sid2, 'machines', selectedMachineId, 'transfers');\r\n          const snap = await getDocs(query(col));\r\n          const list: TransferReceipt[] = snap.docs.map((d) => {\r\n            const x: any = d.data();\r\n            const created = x?.createdAt?.toDate?.() ? x.createdAt.toDate() : new Date();\r\n            const ded: any = x?.deductFrom;\r\n            return {\r\n              id: d.id,\r\n              wholesalePrice: Number(x?.wholesalePrice || 0),\r\n              retailPrice: Number(x?.retailPrice || 0),\r\n              profit: Number(x?.profit ?? ((Number(x?.retailPrice || 0) - Number(x?.wholesalePrice || 0)) || 0)),\r\n              createdAt: created.toISOString(),\r\n              cashierName: x?.cashierName || undefined,\r\n              deductFrom: ded === 'base' || ded === 'air' ? ded : undefined,\r\n            } as TransferReceipt;\r\n          });\r\n          const sorted = [...list].sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n          if (sorted.length > 0) {\r\n            setTransferReceipts(sorted);\r\n            try { localStorage.setItem(`machineDaily_transfers_${sid2}_${selectedMachineId}`, JSON.stringify(sorted)); } catch {}\r\n          }\r\n        } catch {}\r\n      })();\r\n    } catch {}\r\n  }, [open, shopId, selectedMachineId]);\r\n\r\n  const handleClose = (nextOpen: boolean) => {\r\n    if (!nextOpen) {\r\n      //           \r\n      resetDialogState();\r\n    }\r\n    onOpenChange(nextOpen);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"w-screen h-[100vh] overflow-hidden rounded-none p-0 flex flex-col dark:bg-[#121212]\">\r\n        <DialogHeader className=\"sticky top-0 bg-white dark:bg-[#0F0F0F] z-20 border-b border-gray-200 dark:border-[#333] px-4 py-3\">\r\n          <DialogTitle className=\"flex items-center justify-between text-right\">\r\n            <span className=\"flex items-center gap-2\">\r\n              <FawryMachineIcon className=\"h-5 w-5 text-yellow-500\" />\r\n               \r\n            </span>\r\n          </DialogTitle>\r\n          <DialogDescription className=\"text-right\">\r\n                           \" \".\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"px-4 py-3 overflow-y-auto flex-1 grid grid-cols-1 gap-6\">\r\n          {/* /  */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n          <CardTitle className=\"flex items-center justify-between\">\r\n            <span className=\"text-right\"> </span>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                variant=\"destructive\"\r\n                onClick={async () => {\r\n                  try {\r\n                    if (!shopId || !selectedMachineId) return;\r\n                    const baseRef = doc(db, 'shops', shopId, 'machines', selectedMachineId);\r\n                    try {\r\n                      const transSnap = await getDocs(collection(db, 'shops', shopId, 'machines', selectedMachineId, 'transfers'));\r\n                      await Promise.all(transSnap.docs.map(d => deleteDoc(d.ref)));\r\n                    } catch {}\r\n                    try {\r\n                      const delSnap = await getDocs(collection(db, 'shops', shopId, 'machines', selectedMachineId, 'deliveries'));\r\n                      await Promise.all(delSnap.docs.map(d => deleteDoc(d.ref)));\r\n                    } catch {}\r\n                    await deleteDoc(baseRef);\r\n                    setMachines(prev => prev.filter(m => m.id !== selectedMachineId));\r\n                    const next = machines.find(m => m.id !== selectedMachineId);\r\n                    setSelectedMachineId(next ? next.id : null);\r\n                    try {\r\n                      const keyOpening = `${STORAGE_KEY_OPENING}_${selectedMachineId}`;\r\n                      const keySnap = `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}`;\r\n                      localStorage.removeItem(keyOpening);\r\n                      localStorage.removeItem(keySnap);\r\n                    } catch {}\r\n                    toast({ title: '  ', description: '  .' });\r\n                  } catch (err) {\r\n                    toast({ title: ' ', description: '  .' , variant: 'destructive' });\r\n                  }\r\n                }}\r\n                disabled={!selectedMachineId}\r\n                title=\" \"\r\n              >\r\n                <Trash2 className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n          </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 items-end\">\r\n                <div>\r\n                  <label className=\"text-sm font-medium block text-right\"> </label>\r\n                  <Select value={selectedMachineId ?? ''} onValueChange={(v) => { setSelectedMachineId(v); try { const sidSel = shopId || getFallbackShopId(); if (sidSel) localStorage.setItem(`machineDaily_selected_${sidSel}`, v); } catch {} }}>\r\n                    <SelectTrigger className=\"text-right\">\r\n                      <SelectValue placeholder=\" \" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {machines.map(m => (\r\n                        <SelectItem key={m.id} value={m.id}>{m.name}</SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-2\">\r\n                  <div className=\"md:col-span-2\">\r\n                    <label className=\"text-sm font-medium block text-right\">  </label>\r\n                    <Input value={newMachineName} onChange={(e) => setNewMachineName(e.target.value)} placeholder=\" \" className=\"text-right\" />\r\n                  </div>\r\n                  <div className=\"flex justify-end md:justify-start\">\r\n                    <Button\r\n                      onClick={async () => {\r\n                        try {\r\n                          if (!shopId) {\r\n                            toast({ title: '  ', description: '     .', variant: 'destructive' });\r\n                            return;\r\n                          }\r\n                          const name = (newMachineName || '').trim();\r\n                          if (!name) {\r\n                            toast({ title: '  ', description: '   .', variant: 'destructive' });\r\n                            return;\r\n                          }\r\n                          const ref = await addDoc(collection(db, 'shops', shopId, 'machines'), {\r\n                            name,\r\n                            shopId,\r\n                            createdAt: serverTimestamp(),\r\n                            updatedAt: serverTimestamp(),\r\n                            isActive: true,\r\n                          });\r\n                          const created = { id: ref.id, name };\r\n                          setMachines(prev => [created, ...prev]);\r\n                          setSelectedMachineId(ref.id);\r\n                          setNewMachineName('');\r\n                          toast({ title: '  ', description: `  ${name}` });\r\n                        } catch (err) {\r\n                          console.error('Create machine error:', err);\r\n                          toast({ title: '  ', description: '  .', variant: 'destructive' });\r\n                        }\r\n                      }}\r\n                      className=\"bg-violet-600 hover:bg-violet-700\"\r\n                    >\r\n                      \r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n          {/*   */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n              <CardTitle className=\"flex items-center justify-between\">\r\n                <span className=\"text-right\"> </span>\r\n                <Button variant=\"ghost\" size=\"sm\" onClick={() => setIsOpeningOpen((v) => !v)} className=\"flex items-center gap-1\">\r\n                  <ChevronDown className={`h-4 w-4 transition-transform ${isOpeningOpen ? 'rotate-180' : ''}`} />\r\n                </Button>\r\n              </CardTitle>\r\n            </CardHeader>\r\n            {/*        */}\r\n            <div className=\"flex items-center justify-between px-6\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <Button variant=\"outline\" onClick={() => setTransferDialogOpen(true)} disabled={savedOpeningBase == null || savedOpeningAir == null} className=\"border-violet-300 text-violet-700\">\r\n                  \r\n                </Button>\r\n              </div>\r\n              {savedOpeningBase != null && savedOpeningAir != null && (\r\n                <Badge className=\"bg-violet-100 text-violet-700 border border-violet-200\">\r\n                   :  {formatNumber(savedOpeningBase)} |  {formatNumber(savedOpeningAir)} |  {formatNumber(savedDrawerCash ?? 0)}\r\n                </Badge>\r\n              )}\r\n            </div>\r\n            <CardContent className={`space-y-4 ${isOpeningOpen ? '' : 'hidden'}`}>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div className=\"space-y-1\">\r\n                  <label className=\"text-sm font-medium block text-right\"> </label>\r\n                  <Input\r\n                    inputMode=\"decimal\"\r\n                    type=\"number\"\r\n                    min={0}\r\n                    step=\"0.01\"\r\n                    value={openingBase}\r\n                    onChange={(e) => setOpeningBase(e.target.value)}\r\n                    placeholder=\"0.00\"\r\n                    className=\"text-right\"\r\n                  />\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                  <label className=\"text-sm font-medium block text-right\"> </label>\r\n                  <Input\r\n                    inputMode=\"decimal\"\r\n                    type=\"number\"\r\n                    min={0}\r\n                    step=\"0.01\"\r\n                    value={openingAir}\r\n                    onChange={(e) => setOpeningAir(e.target.value)}\r\n                    placeholder=\"0.00\"\r\n                    className=\"text-right\"\r\n                  />\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                  <label className=\"text-sm font-medium block text-right\"> </label>\r\n                  <Input\r\n                    inputMode=\"decimal\"\r\n                    type=\"number\"\r\n                    min={0}\r\n                    step=\"0.01\"\r\n                    value={drawerCash}\r\n                    onChange={(e) => setDrawerCash(e.target.value)}\r\n                    placeholder=\"0.00\"\r\n                    className=\"text-right\"\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"flex items-center justify-end\">\r\n                <Button variant=\"outline\" className=\"mr-2\" onClick={handleResetOpening}>\r\n                  \r\n                </Button>\r\n                <Button onClick={handleAddOpening} className=\"bg-violet-600 hover:bg-violet-700\">\r\n                  \r\n                </Button>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/*   */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n              <CardTitle className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <span className=\"text-right\"> </span>\r\n                  <Badge className=\"bg-green-100 text-green-700 border border-green-200\">: {formatNumber(totalTransferProfit)}</Badge>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Button variant=\"outline\" size=\"sm\" onClick={handleClearTransferReceipts} className=\"border-red-300 text-red-700 hover:bg-red-50\"> </Button>\r\n                  <Receipt className=\"h-4 w-4 text-gray-500\" />\r\n                </div>\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              {transferReceipts.length === 0 ? (\r\n                <p className=\"text-sm text-gray-500 text-right\">   .</p>\r\n              ) : (\r\n                <div className=\"space-y-3 max-h-52 overflow-y-auto pr-1\">\r\n                  {transferReceipts.map((t) => (\r\n                    <div key={t.id} className=\"rounded-lg border p-3 grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\"> </p>\r\n                        <p className=\"text-sm\">{formatNumber(t.wholesalePrice)}</p>\r\n                      </div>\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\"> </p>\r\n                        <p className=\"text-sm\">{formatNumber(t.retailPrice)}</p>\r\n                      </div>\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\"> </p>\r\n                        <p className=\"text-sm text-green-700\">{formatNumber(t.profit)}</p>\r\n                        {t.deductFrom && (\r\n                          <div className=\"mt-1\">\r\n                            <span className=\"text-[11px] bg-violet-100 text-violet-700 border border-violet-200 rounded px-2 py-0.5\"> : {t.deductFrom === 'base' ? '' : ''}</span>\r\n                          </div>\r\n                        )}\r\n                        <div className=\"flex items-center justify-end gap-2 text-xs text-gray-500\">\r\n                          <Calendar className=\"h-3 w-3\" />\r\n                          <span>{formatDateTime(t.createdAt)}</span>\r\n                          {t.cashierName && (\r\n                            <>\r\n                              <Separator orientation=\"vertical\" className=\"h-3\" />\r\n                              <span>: {t.cashierName}</span>\r\n                            </>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/*   -   */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n              <CardTitle className=\"text-right\"> </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              {!isDeliverySectionOpen ? (\r\n                <div className=\"flex justify-end\">\r\n                  <Button variant=\"outline\" onClick={handleStartDelivery} className=\"border-violet-300 text-violet-700\">\r\n                     \r\n                  </Button>\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div className=\"space-y-1\">\r\n                      <label className=\"text-sm font-medium block text-right\">  </label>\r\n                      <Input\r\n                        inputMode=\"decimal\"\r\n                        type=\"number\"\r\n                        min={0}\r\n                        step=\"0.01\"\r\n                        value={deliveryBase}\r\n                        onChange={(e) => setDeliveryBase(e.target.value)}\r\n                        placeholder=\"0.00\"\r\n                        className=\"text-right\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-1\">\r\n                      <label className=\"text-sm font-medium block text-right\">  </label>\r\n                      <Input\r\n                        inputMode=\"decimal\"\r\n                        type=\"number\"\r\n                        min={0}\r\n                        step=\"0.01\"\r\n                        value={deliveryAir}\r\n                        onChange={(e) => setDeliveryAir(e.target.value)}\r\n                        placeholder=\"0.00\"\r\n                        className=\"text-right\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-center justify-end gap-2\">\r\n                    <Button variant=\"secondary\" onClick={() => setIsDeliverySectionOpen(false)}></Button>\r\n                    <Button onClick={handleDoDelivery} className=\"bg-green-600 hover:bg-green-700\"></Button>\r\n                  </div>\r\n\r\n                  {netResult != null && (\r\n                    <div className=\"mt-3\">\r\n                      <div className=\"text-right\">\r\n                        <Badge className={netResult >= 0 ? 'bg-green-100 text-green-700 border border-green-200' : 'bg-red-100 text-red-700 border border-red-200'}>\r\n                           : {formatNumber(netResult)}\r\n                        </Badge>\r\n                      </div>\r\n                      <div className=\"mt-2 flex items-center justify-end gap-2\">\r\n                        <Badge className=\"bg-blue-100 text-blue-700 border border-blue-200\">\r\n                           : {formatNumber(parseFloat(deliveryBase || '0') + parseFloat(deliveryAir || '0'))}\r\n                        </Badge>\r\n                        <Badge className=\"bg-amber-100 text-amber-700 border border-amber-200\">\r\n                             ( ): {formatNumber(totalWholesaleTransferred)}\r\n                        </Badge>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/*   */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n              <CardTitle className=\"flex items-center justify-between\">\r\n                <span className=\"text-right\"> </span>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Button variant=\"outline\" size=\"sm\" onClick={handleClearMachineReceipts} className=\"border-red-300 text-red-700 hover:bg-red-50\"> </Button>\r\n                  <Receipt className=\"h-4 w-4 text-gray-500\" />\r\n                </div>\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              {receipts.length === 0 ? (\r\n                <p className=\"text-sm text-gray-500 text-right\">    .</p>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {receipts.map((r) => (\r\n                    <div key={r.id} className=\"rounded-lg border p-3 grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\"></p>\r\n                        <p className=\"text-sm\">: {formatNumber(r.openingBase)}</p>\r\n                        <p className=\"text-sm\">: {formatNumber(r.openingAir)}</p>\r\n                      </div>\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\"></p>\r\n                        <p className=\"text-sm\">: {formatNumber(r.deliveryBase)}</p>\r\n                        <p className=\"text-sm\">: {formatNumber(r.deliveryAir)}</p>\r\n                      </div>\r\n                      <div className=\"text-right space-y-1\">\r\n                        <div className=\"flex items-center justify-end\">\r\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => handleDeleteMachineReceipt(r.id)} className=\"border-red-300 text-red-700 hover:bg-red-50\">\r\n                            <Trash2 className=\"h-3 w-3 mr-1\" /> \r\n                          </Button>\r\n                        </div>\r\n                        <p className=\"text-xs text-gray-500\"></p>\r\n                        <p className={`text-sm ${r.netResult >= 0 ? 'text-green-700' : 'text-red-700'}`}>{formatNumber(r.netResult)}</p>\r\n                        <div className=\"mt-1 flex items-center justify-end gap-2\">\r\n                          <span className=\"text-[11px] bg-blue-100 text-blue-700 border border-blue-200 rounded px-2 py-0.5\">\r\n                             : {formatNumber(r.deliveryBase + r.deliveryAir)}\r\n                          </span>\r\n                          {typeof r.requiredDrawerNoProfit === 'number' && (\r\n                            <span className=\"text-[11px] bg-amber-100 text-amber-700 border border-amber-200 rounded px-2 py-0.5\">\r\n                                 ( ): {formatNumber(r.requiredDrawerNoProfit || 0)}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"flex items-center justify-end gap-2 text-xs text-gray-500\">\r\n                          <Calendar className=\"h-3 w-3\" />\r\n                          <span>{formatDateTime(r.createdAt)}</span>\r\n                          {r.cashierName && (\r\n                            <>\r\n                              <Separator orientation=\"vertical\" className=\"h-3\" />\r\n                              <span>: {r.cashierName}</span>\r\n                            </>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        <DialogFooter className=\"sticky bottom-0 bg-white dark:bg-[#0F0F0F] z-20 border-t border-gray-200 dark:border-[#333] px-4 py-3 flex items-center justify-between\">\r\n          <Button variant=\"outline\" onClick={() => handleClose(false)}></Button>\r\n          <div className=\"text-xs text-gray-500 flex items-center gap-1\">\r\n            <Clock className=\"h-3 w-3\" />\r\n            <span>     </span>\r\n          </div>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n\r\n      {/*    */}\r\n      <Dialog open={transferDialogOpen} onOpenChange={setTransferDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-sm\">\r\n          <DialogHeader>\r\n            <DialogTitle> </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-3\">\r\n            <div>\r\n              <label className=\"text-sm font-medium block text-right\"> </label>\r\n              <Input\r\n                inputMode=\"decimal\"\r\n                type=\"number\"\r\n                min={0}\r\n                step=\"0.01\"\r\n                value={wholesalePrice}\r\n                onChange={(e) => setWholesalePrice(e.target.value)}\r\n                placeholder=\"0.00\"\r\n                className=\"text-right\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"text-sm font-medium block text-right\"> </label>\r\n              <Input\r\n                inputMode=\"decimal\"\r\n                type=\"number\"\r\n                min={0}\r\n                step=\"0.01\"\r\n                value={retailPrice}\r\n                onChange={(e) => setRetailPrice(e.target.value)}\r\n                placeholder=\"0.00\"\r\n                className=\"text-right\"\r\n              />\r\n            </div>\r\n            <div className=\"text-right\">\r\n              <Badge className=\"bg-green-100 text-green-700 border border-green-200\">\r\n                 : {formatNumber((parseFloat(retailPrice || '0') - parseFloat(wholesalePrice || '0')) || 0)}\r\n              </Badge>\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex items-center justify-end gap-2\">\r\n            <Button variant=\"secondary\" onClick={() => setTransferDialogOpen(false)}></Button>\r\n            <Button onClick={handleTransferConfirm} className=\"bg-violet-600 hover:bg-violet-700\"></Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n      {/*     */}\r\n      <AlertDialog open={deductDialogOpen} onOpenChange={setDeductDialogOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>  </AlertDialogTitle>\r\n            <AlertDialogDescription>         </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <div className=\"flex items-center justify-end gap-2 mt-4\">\r\n            <AlertDialogCancel onClick={() => setDeductDialogOpen(false)}></AlertDialogCancel>\r\n            <AlertDialogAction className=\"bg-emerald-600 hover:bg-emerald-700 text-white\" onClick={() => finalizeTransfer('base')}>  </AlertDialogAction>\r\n            <AlertDialogAction className=\"bg-blue-600 hover:bg-blue-700 text-white\" onClick={() => finalizeTransfer('air')}>  </AlertDialogAction>\r\n          </div>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </Dialog>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport function useDebouncedValue<T>(value: T, delay = 300) {\r\n  const [debounced, setDebounced] = React.useState<T>(value);\r\n\r\n  React.useEffect(() => {\r\n    const handler = setTimeout(() => setDebounced(value), delay);\r\n    return () => clearTimeout(handler);\r\n  }, [value, delay]);\r\n\r\n  return debounced;\r\n}","import React, { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Eye, DollarSign, ArrowDownLeft, ArrowRightLeft, Clock, Calendar } from 'lucide-react';\r\nimport { ProfitService } from '@/utils/profitService';\r\nimport { reportsService } from '@/utils/reportsService';\r\nimport { MasterPinDialog } from './MasterPinDialog';\r\nimport { toast } from '@/hooks/use-toast'\r\nimport { getUserSubscription, SubscriptionPlan } from '@/utils/subscriptionService'\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext'\r\n\r\ninterface MonthlyProfitDisplayDialogProps {\r\n  userId?: string;\r\n  transactions: any[];\r\n}\r\n\r\ninterface ProfitData {\r\n  monthlyWithdrawalProfit: number;\r\n  monthlyTransferProfit: number;\r\n  lastUpdated: Date;\r\n}\r\n\r\nconst MonthlyProfitDisplayDialog: React.FC<MonthlyProfitDisplayDialogProps> = ({ userId, transactions }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isMasterPinDialogOpen, setIsMasterPinDialogOpen] = useState(false);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [profitData, setProfitData] = useState<ProfitData>({\r\n    monthlyWithdrawalProfit: 0,\r\n    monthlyTransferProfit: 0,\r\n    lastUpdated: new Date()\r\n  });\r\n  const { userSubscription } = useFirebaseAuth();\r\n\r\n  useEffect(() => {\r\n    if (userId && isOpen && isAuthenticated) {\r\n      loadProfitData();\r\n    }\r\n  }, [userId, isOpen, isAuthenticated]);\r\n\r\n  const loadProfitData = async () => {\r\n    if (!userId) return;\r\n    \r\n    try {\r\n      //            localStorage\r\n      if (Array.isArray(transactions) && transactions.length > 0) {\r\n        const today = new Date();\r\n        const currentMonth = today.getMonth();\r\n        const currentYear = today.getFullYear();\r\n\r\n        const visibleMonthly = reportsService.filterVisibleTransactions(transactions as any[], 'monthly', userId);\r\n\r\n        let monthlyWithdrawProfit = 0;\r\n        let monthlyTransferProfit = 0;\r\n\r\n        visibleMonthly.forEach((tx: any) => {\r\n          const txDate = new Date(tx.createdAt);\r\n          const status = String(tx.status || 'confirmed').toLowerCase();\r\n          if (txDate.getMonth() !== currentMonth || txDate.getFullYear() !== currentYear) return;\r\n          if (status !== 'completed' && status !== 'confirmed') return;\r\n\r\n          const t = (tx.type || tx.txnType || '').toLowerCase();\r\n          const txForCalc = {\r\n            type: t === 'withdrawal' ? 'withdraw' : t,\r\n            amount: Number(tx.amount || 0),\r\n            commission: tx.commission,\r\n          };\r\n\r\n          if (txForCalc.type === 'withdraw') {\r\n            monthlyWithdrawProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          } else if (txForCalc.type === 'send' || txForCalc.type === 'receive' || txForCalc.type === 'transfer') {\r\n            monthlyTransferProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          }\r\n        });\r\n\r\n        setProfitData({\r\n          monthlyWithdrawalProfit: Math.round(monthlyWithdrawProfit * 100) / 100,\r\n          monthlyTransferProfit: Math.round(monthlyTransferProfit * 100) / 100,\r\n          lastUpdated: new Date()\r\n        });\r\n        return;\r\n      }\r\n\r\n      //        localStorage ()\r\n      const profits = ProfitService.getWithdrawTransferProfits(userId);\r\n      setProfitData({\r\n        monthlyWithdrawalProfit: profits.monthlyWithdrawProfit || 0,\r\n        monthlyTransferProfit: profits.monthlyTransferProfit || 0,\r\n        lastUpdated: new Date()\r\n      });\r\n    } catch (error) {\r\n      console.error('Error loading profit data:', error);\r\n    }\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return `${amount.toFixed(2)} .`;\r\n  };\r\n\r\n  const formatDate = (date: Date) => {\r\n    return new Intl.DateTimeFormat('ar-EG', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }).format(date);\r\n  };\r\n\r\n  //         \r\n  const isZeroPlan = async (): Promise<boolean> => {\r\n    try {\r\n      const localSub: any = (userSubscription as any)?.subscription || null;\r\n      const rawLocal: any = localSub?.planType ?? localSub?.plan ?? null;\r\n      const planLocalStr = typeof rawLocal === 'string' ? rawLocal.toLowerCase() : null;\r\n      if (rawLocal === SubscriptionPlan.ZERO || planLocalStr === 'zero' || planLocalStr === '0' || rawLocal === 0) {\r\n        return true;\r\n      }\r\n    } catch {}\r\n\r\n    try {\r\n      if (userId) {\r\n        const remoteSub: any = await getUserSubscription(userId);\r\n        const rawRemote: any = remoteSub?.planType ?? remoteSub?.plan ?? null;\r\n        const planRemoteStr = typeof rawRemote === 'string' ? rawRemote.toLowerCase() : null;\r\n        if (rawRemote === SubscriptionPlan.ZERO || planRemoteStr === 'zero' || planRemoteStr === '0' || rawRemote === 0) {\r\n          return true;\r\n        }\r\n      }\r\n    } catch {}\r\n\r\n    return false;\r\n  };\r\n\r\n  const handleEyeClick = async () => {\r\n    //         \r\n    try {\r\n      if (await isZeroPlan()) {\r\n        toast({\r\n          title: ' ',\r\n          description: '       .     .',\r\n          variant: 'destructive'\r\n        })\r\n        return\r\n      }\r\n    } catch {}\r\n    setIsMasterPinDialogOpen(true)\r\n  }\r\n\r\n  const handlePinSuccess = async () => {\r\n    //            \r\n    try {\r\n      if (await isZeroPlan()) {\r\n        toast({\r\n          title: ' ',\r\n          description: '       .     .',\r\n          variant: 'destructive'\r\n        });\r\n        setIsMasterPinDialogOpen(false);\r\n        return;\r\n      }\r\n    } catch {}\r\n\r\n    setIsAuthenticated(true);\r\n    setIsOpen(true);\r\n    setIsMasterPinDialogOpen(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        size=\"sm\"\r\n        variant=\"ghost\"\r\n        onClick={handleEyeClick}\r\n        className=\"h-2 w-2 p-0 bg-gradient-to-r from-blue-100 to-blue-200 text-blue-700 hover:from-blue-200 hover:to-blue-300 hover:text-blue-800 rounded transition-all duration-300 hover:scale-110 shadow-sm hover:shadow-md\"\r\n        title=\"  \"\r\n      >\r\n        <Eye className=\"h-1.5 w-1.5\" />\r\n      </Button>\r\n\r\n      <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n        <DialogContent className=\"max-w-[220px] mx-auto bg-white border border-gray-200 shadow-md rounded sm:max-w-[180px] sm:bg-gradient-to-br sm:from-purple-50 sm:to-white sm:border-2 sm:border-purple-200 sm:shadow-2xl sm:rounded-2xl\">\r\n          <DialogHeader className=\"text-center pb-0 border-b-0 sm:pb-2 sm:border-b sm:border-purple-200\">\r\n            <DialogTitle className=\"text-xs font-bold text-purple-800 flex items-center justify-center gap-0 mb-0 leading-tight tracking-tight sm:text-xs sm:gap-1 sm:mb-0 sm:leading-normal sm:tracking-normal\">\r\n              <Calendar className=\"h-2 w-2 text-purple-600 sm:h-3 sm:w-3\" />\r\n              \r\n            </DialogTitle>\r\n          </DialogHeader>\r\n\r\n          {/*       */}\r\n          <div className=\"py-0 sm:py-3\">\r\n            <div className=\"rounded-xl border border-purple-300 bg-white overflow-hidden\">\r\n              {/*  */}\r\n              <div className=\"p-2 sm:p-3 bg-red-50 border-b border-purple-100\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <ArrowDownLeft className=\"h-3 w-3 text-red-600\" />\r\n                    <span className=\"font-medium text-red-800 text-xs\"></span>\r\n                  </div>\r\n                  <span className=\"font-bold text-sm text-red-900 bg-white px-2 py-0.5 rounded\">\r\n                    {formatCurrency(profitData.monthlyWithdrawalProfit)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              {/*  */}\r\n              <div className=\"p-2 sm:p-3 bg-blue-50 border-b border-purple-100\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <ArrowRightLeft className=\"h-3 w-3 text-blue-600\" />\r\n                    <span className=\"font-medium text-blue-800 text-xs\"></span>\r\n                  </div>\r\n                  <span className=\"font-bold text-sm text-blue-900 bg-white px-2 py-0.5 rounded\">\r\n                    {formatCurrency(profitData.monthlyTransferProfit)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              {/*  */}\r\n              <div className=\"p-2 sm:p-3 bg-purple-50\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <DollarSign className=\"h-3 w-3 text-purple-600\" />\r\n                    <span className=\"font-medium text-purple-800 text-xs\"></span>\r\n                  </div>\r\n                  <span className=\"font-bold text-sm text-purple-900 bg-white px-2 py-0.5 rounded\">\r\n                    {formatCurrency(profitData.monthlyWithdrawalProfit + profitData.monthlyTransferProfit)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/*      */}\r\n          {!isAuthenticated && (\r\n            <div className=\"absolute inset-0 bg-yellow-200/70 backdrop-blur-sm flex items-center justify-center rounded sm:rounded-2xl border border-yellow-300 pointer-events-auto\">\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                onClick={() => setIsMasterPinDialogOpen(true)}\r\n                className=\"p-2 bg-yellow-300/80 text-yellow-900 hover:bg-yellow-400/90 rounded-full shadow-sm hover:shadow-md transition-all duration-300\"\r\n                title=\"   \"\r\n              >\r\n                <Eye className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex justify-center pt-0 border-t-0 sm:pt-2 sm:border-t sm:border-purple-200\">\r\n            <Button\r\n              onClick={() => setIsOpen(false)}\r\n              className=\"bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-xl text-sm sm:bg-gradient-to-r sm:from-purple-600 sm:to-purple-700 sm:hover:from-purple-700 sm:hover:to-purple-800 sm:px-4 sm:py-1 sm:rounded-xl sm:shadow-lg sm:hover:shadow-xl sm:transition-all sm:duration-300\"\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <MasterPinDialog\r\n        open={isMasterPinDialogOpen}\r\n        onOpenChange={setIsMasterPinDialogOpen}\r\n        onSuccess={handlePinSuccess}\r\n        description=\"          \"\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport const MonthlyProfitEyeButton: React.FC<MonthlyProfitDisplayDialogProps> = (props) => {\r\n  return <MonthlyProfitDisplayDialog {...props} />;\r\n};\r\n\r\nexport default MonthlyProfitDisplayDialog;","import React, { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Eye, EyeOff, Lock, AlertCircle } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { ProfitService } from '@/utils/profitService';\r\nimport { MasterPinService } from '@/utils/masterPinService';\r\nimport { useEffect } from 'react';\r\n\r\ninterface ProfitPinDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  onSuccess: () => void;\r\n  userId?: string;\r\n}\r\n\r\nexport function ProfitPinDialog({ \r\n  open, \r\n  onOpenChange, \r\n  onSuccess, \r\n  userId \r\n}: ProfitPinDialogProps) {\r\n  const [pin, setPin] = useState('');\r\n  const [confirmPin, setConfirmPin] = useState('');\r\n  const [showPin, setShowPin] = useState(false);\r\n  const [showConfirmPin, setShowConfirmPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [hasExistingPin, setHasExistingPin] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n      const has = await MasterPinService.hasMasterPin(userId);\r\n      if (mounted) setHasExistingPin(has);\r\n    })();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [userId, open]);\r\n\r\n  const handleClose = () => {\r\n    setPin('');\r\n    setConfirmPin('');\r\n    setError('');\r\n    setShowPin(false);\r\n    setShowConfirmPin(false);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      if (hasExistingPin) {\r\n        //     \r\n        const ok = await MasterPinService.verifyMasterPin(pin, userId);\r\n        if (!ok) {\r\n          setError('   ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n      } else {\r\n        //     \r\n        if (pin.length < 4) {\r\n          setError('     4   ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        if (pin !== confirmPin) {\r\n          setError('   ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        const created = await MasterPinService.createMasterPin(pin, userId);\r\n        if (!created) {\r\n          setError('    ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      toast({\r\n        title: \" \",\r\n        description: hasExistingPin \r\n          ? \"      \" \r\n          : \"     \",\r\n      });\r\n\r\n      onSuccess();\r\n      handleClose();\r\n    } catch (error) {\r\n      setError('     ');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-lg font-semibold\">\r\n            <Lock className=\"h-5 w-5 text-green-600\" />\r\n            {hasExistingPin ? '   ' : '   '}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-gray-600 bg-blue-50 p-3 rounded-lg\">\r\n            {hasExistingPin \r\n              ? '      '\r\n              : '       .      .'\r\n            }\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"pin\">\r\n              {hasExistingPin ? '  ' : '   '}\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"pin\"\r\n                type={showPin ? \"text\" : \"password\"}\r\n                value={pin}\r\n                onChange={(e) => setPin(e.target.value)}\r\n                placeholder={hasExistingPin ? \"  \" : \"    (4   )\"}\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n                autoComplete=\"off\"\r\n                required\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowPin(!showPin)}\r\n              >\r\n                {showPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*     (  ) */}\r\n          {!hasExistingPin && (\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"confirmPin\">  </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"confirmPin\"\r\n                  type={showConfirmPin ? \"text\" : \"password\"}\r\n                  value={confirmPin}\r\n                  onChange={(e) => setConfirmPin(e.target.value)}\r\n                  placeholder=\"   \"\r\n                  className=\"pr-10\"\r\n                  dir=\"ltr\"\r\n                  autoComplete=\"off\"\r\n                  required\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowConfirmPin(!showConfirmPin)}\r\n                >\r\n                  {showConfirmPin ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/*   */}\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-red-600 text-sm\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {/*   */}\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              className=\"flex-1 bg-green-600 hover:bg-green-700\"\r\n            >\r\n              <Lock className=\"h-4 w-4 mr-2\" />\r\n              {isLoading \r\n                ? \" ...\" \r\n                : hasExistingPin \r\n                  ? \" \" \r\n                  : \"  \"\r\n              }\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              disabled={isLoading}\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}","import React, { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Eye, DollarSign, ArrowDownLeft, ArrowRightLeft, Clock } from 'lucide-react';\r\nimport { ProfitService } from '@/utils/profitService';\r\nimport { ProfitPinDialog } from './ProfitPinDialog';\r\nimport { formatCurrency } from '@/utils/formatters';\r\nimport { reportsService } from '@/utils/reportsService';\r\n\r\ninterface DailyProfitDisplayDialogProps {\r\n  userId?: string;\r\n  transactions: any[];\r\n}\r\n\r\ninterface ProfitData {\r\n  dailyWithdrawalProfit: number;\r\n  dailyTransferProfit: number;\r\n  lastUpdated: Date;\r\n}\r\n\r\nconst DailyProfitDisplayDialog: React.FC<DailyProfitDisplayDialogProps> = ({ userId, transactions }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isPinDialogOpen, setIsPinDialogOpen] = useState(false);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [profitData, setProfitData] = useState<ProfitData>({\r\n    dailyWithdrawalProfit: 0,\r\n    dailyTransferProfit: 0,\r\n    lastUpdated: new Date()\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (userId && isOpen && isAuthenticated) {\r\n      loadProfitData();\r\n    }\r\n  }, [userId, isOpen, isAuthenticated, transactions]);\r\n\r\n  const loadProfitData = async () => {\r\n    if (!userId) return;\r\n    \r\n    try {\r\n      //            localStorage\r\n      if (Array.isArray(transactions) && transactions.length > 0) {\r\n        const today = new Date();\r\n        const visibleDaily = reportsService.filterVisibleTransactions(transactions as any[], 'daily', userId);\r\n\r\n        let dailyWithdrawProfit = 0;\r\n        let dailyTransferProfit = 0;\r\n\r\n        visibleDaily.forEach((tx: any) => {\r\n          const txDate = new Date(tx.createdAt);\r\n          const status = String(tx.status || 'confirmed').toLowerCase();\r\n          if (txDate.toDateString() !== today.toDateString()) return;\r\n          //    (pending)    \r\n        \r\n          const t = (tx.type || tx.txnType || '').toLowerCase();\r\n          const title = String(tx.title || '');\r\n          if (t === 'cash_addition' || title.includes('  ')) return;\r\n          const txForCalc = {\r\n            type: t === 'withdrawal' ? 'withdraw' : t,\r\n            amount: Number(tx.amount || 0),\r\n            commission: tx.commission,\r\n          };\r\n\r\n          if (txForCalc.type === 'withdraw') {\r\n            dailyWithdrawProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          } else if (txForCalc.type === 'send' || txForCalc.type === 'receive' || txForCalc.type === 'transfer') {\r\n            dailyTransferProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          }\r\n        });\r\n\r\n        setProfitData({\r\n          dailyWithdrawalProfit: Math.round(dailyWithdrawProfit * 100) / 100,\r\n          dailyTransferProfit: Math.round(dailyTransferProfit * 100) / 100,\r\n          lastUpdated: new Date()\r\n        });\r\n\r\n        //         \r\n        try { ProfitService.updateProfitsFromTransactions(transactions, userId); } catch {}\r\n        return;\r\n      }\r\n\r\n      //        localStorage ()\r\n      const profits = ProfitService.getWithdrawTransferProfits(userId);\r\n      setProfitData({\r\n        dailyWithdrawalProfit: profits.dailyWithdrawProfit || 0,\r\n        dailyTransferProfit: profits.dailyTransferProfit || 0,\r\n        lastUpdated: new Date()\r\n      });\r\n    } catch (error) {\r\n      console.error('Error loading profit data:', error);\r\n    }\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return `${amount.toFixed(2)} .`;\r\n  };\r\n\r\n  const formatDate = (date: Date) => {\r\n    return new Intl.DateTimeFormat('ar-EG', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }).format(date);\r\n  };\r\n\r\n  const handleEyeClick = () => {\r\n    if (ProfitService.hasProfitPin(userId)) {\r\n      setIsPinDialogOpen(true);\r\n    } else {\r\n      setIsPinDialogOpen(true);\r\n    }\r\n  };\r\n\r\n  const handlePinSuccess = () => {\r\n    setIsAuthenticated(true);\r\n    setIsOpen(true);\r\n    setIsPinDialogOpen(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        size=\"sm\"\r\n        variant=\"ghost\"\r\n        onClick={handleEyeClick}\r\n        className=\"h-2 w-2 p-0 bg-gradient-to-r from-blue-100 to-blue-200 text-blue-700 hover:from-blue-200 hover:to-blue-300 hover:text-blue-800 rounded transition-all duration-300 hover:scale-110 shadow-sm hover:shadow-md\"\r\n        title=\"  \"\r\n      >\r\n        <Eye className=\"h-1.5 w-1.5\" />\r\n      </Button>\r\n\r\n      <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n        <DialogContent className=\"max-w-[220px] mx-auto bg-white border border-gray-200 shadow-md rounded sm:max-w-[180px] sm:bg-gradient-to-br sm:from-blue-50 sm:to-white sm:border-2 sm:border-blue-200 sm:shadow-2xl sm:rounded-2xl\">\r\n          <DialogHeader className=\"text-center pb-0 border-b-0 sm:pb-2 sm:border-b sm:border-blue-200\">\r\n            <DialogTitle className=\"text-xs font-bold text-blue-800 flex items-center justify-center gap-0 mb-0 leading-tight tracking-tight sm:text-sm sm:gap-1 sm:mb-0 sm:leading-normal sm:tracking-normal\">\r\n              <DollarSign className=\"h-2 w-2 text-blue-600 sm:h-3 sm:w-3\" />\r\n              \r\n            </DialogTitle>\r\n          </DialogHeader>\r\n\r\n          {/*       */}\r\n          <div className=\"py-0 sm:py-3\">\r\n            <div className=\"rounded-xl border border-blue-300 bg-white overflow-hidden\">\r\n              {/*  */}\r\n              <div className=\"p-2 sm:p-3 bg-red-50 border-b border-blue-100\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <ArrowDownLeft className=\"h-3 w-3 text-red-600\" />\r\n                    <span className=\"font-medium text-red-800 text-xs\"></span>\r\n                  </div>\r\n                  <span className=\"font-bold text-sm text-red-900 bg-white px-2 py-0.5 rounded\">\r\n                    {formatCurrency(profitData.dailyWithdrawalProfit)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              {/*  */}\r\n              <div className=\"p-2 sm:p-3 bg-green-50 border-b border-blue-100\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <ArrowRightLeft className=\"h-3 w-3 text-green-600\" />\r\n                    <span className=\"font-medium text-green-800 text-xs\"></span>\r\n                  </div>\r\n                  <span className=\"font-bold text-sm text-green-900 bg-white px-2 py-0.5 rounded\">\r\n                    {formatCurrency(profitData.dailyTransferProfit)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              {/*  */}\r\n              <div className=\"p-2 sm:p-3 bg-blue-50\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <DollarSign className=\"h-3 w-3 text-blue-600\" />\r\n                    <span className=\"font-medium text-blue-800 text-xs\"></span>\r\n                  </div>\r\n                  <span className=\"font-bold text-sm text-blue-900 bg-white px-2 py-0.5 rounded\">\r\n                    {formatCurrency(profitData.dailyWithdrawalProfit + profitData.dailyTransferProfit)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex justify-center pt-0 border-t-0 sm:pt-2 sm:border-t sm:border-blue-200\">\r\n            <Button\r\n              onClick={() => setIsOpen(false)}\r\n              className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl text-sm sm:bg-gradient-to-r sm:from-blue-600 sm:to-blue-700 sm:hover:from-blue-700 sm:hover:to-blue-800 sm:px-4 sm:py-1 sm:rounded-xl sm:shadow-lg sm:hover:shadow-xl sm:transition-all sm:duration-300 sm:text-xs\"\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <ProfitPinDialog\r\n        open={isPinDialogOpen}\r\n        onOpenChange={setIsPinDialogOpen}\r\n        onSuccess={handlePinSuccess}\r\n        userId={userId}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport const DailyProfitEyeButton: React.FC<DailyProfitDisplayDialogProps> = (props) => {\r\n  return <DailyProfitDisplayDialog {...props} />;\r\n};\r\n\r\nexport default DailyProfitDisplayDialog;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useShift } from '@/contexts/ShiftContext';\r\n//        (PIN)      \r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { getLastTransactions } from '@/integrations/firebase/functions';\r\nimport { userDataService } from '@/integrations/firebase/services';\r\nimport { WalletCashService } from '@/utils/walletCashService';\r\nimport { db } from '@/firebase';\r\nimport { doc, getDoc, setDoc, onSnapshot } from 'firebase/firestore';\r\n//        \r\n\r\ninterface Props {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nconst CashierShiftModal: React.FC<Props> = ({ open, onOpenChange }) => {\r\n  const { shiftUser, isShiftActive, shiftStartAt, setShiftUser, startShift, endShift } = useShift();\r\n  const { userSubscription, user, signIn, profile } = useFirebaseAuth();\r\n  const { toast } = useToast();\r\n  const [name, setName] = useState(shiftUser?.name || '');\r\n  const [username, setUsername] = useState(shiftUser?.username || '');\r\n  const [password, setPassword] = useState('');\r\n  const [handoverDialogOpen, setHandoverDialogOpen] = useState(false);\r\n  const [handoverMode, setHandoverMode] = useState<'toAdmin' | 'toUser' | null>(null);\r\n  const [mainPassword, setMainPassword] = useState('');\r\n  const [mainAuthError, setMainAuthError] = useState('');\r\n  const [isVerifyingMain, setIsVerifyingMain] = useState(false);\r\n  const [handoverSelectedUser, setHandoverSelectedUser] = useState<CashierUser | null>(null);\r\n  const [handoverPassword, setHandoverPassword] = useState('');\r\n  const [handoverError, setHandoverError] = useState('');\r\n  const [isHandoverProcessing, setIsHandoverProcessing] = useState(false);\r\n  const [reportDialogOpen, setReportDialogOpen] = useState(false);\r\n  const [reportTotals, setReportTotals] = useState<{ totalTransfers: number; totalWithdrawals: number }>({ totalTransfers: 0, totalWithdrawals: 0 });\r\n  const [deficitChoice, setDeficitChoice] = useState<'yes' | 'no' | null>(null);\r\n  const [deficitAmount, setDeficitAmount] = useState('');\r\n  //    \r\n  const [receivedDrawerFunds, setReceivedDrawerFunds] = useState(''); //      \r\n  const [receivedWalletBalancesTotal, setReceivedWalletBalancesTotal] = useState<number>(0); //    ()\r\n  const [receivedWalletBalancesMap, setReceivedWalletBalancesMap] = useState<Record<string, number>>({}); //    \r\n  const [deliveredDrawerFunds, setDeliveredDrawerFunds] = useState<number>(0); //      \r\n  const [deliveredWalletBalancesTotal, setDeliveredWalletBalancesTotal] = useState<number>(0); //    ()\r\n  const [deliveredWalletBalancesMap, setDeliveredWalletBalancesMap] = useState<Record<string, number>>({}); //     \r\n  const [handoverTargetLabel, setHandoverTargetLabel] = useState<string>('');\r\n  //        \r\n  const [initialIntakeDialogOpen, setInitialIntakeDialogOpen] = useState(false);\r\n\r\n  const normalizeDigits = (s: string) => {\r\n    const map: Record<string, string> = {\r\n      '':'0','':'1','':'2','':'3','':'4','':'5','':'6','':'7','':'8','':'9',\r\n      '':'0','':'1','':'2','':'3','':'4','':'5','':'6','':'7','':'8','':'9',\r\n      '':'.','':'.','':'.',' ':'',\r\n    };\r\n    return s.split('').map(ch => map[ch] ?? ch).join('');\r\n  };\r\n\r\n  type CashierUser = { name: string; username: string; password: string };\r\n  //             \r\n  const getCashierUsersKey = () => `cashierUsers_${user?.uid || 'default'}`;\r\n  const [users, setUsers] = useState<CashierUser[]>(() => {\r\n    try {\r\n      //      \r\n      let saved = localStorage.getItem(getCashierUsersKey());\r\n      //       \r\n      if (!saved) {\r\n        const legacy = localStorage.getItem('cashierUsers');\r\n        if (legacy) {\r\n          saved = legacy;\r\n        }\r\n      }\r\n      return saved ? JSON.parse(saved) : [];\r\n    } catch {\r\n      return [];\r\n    }\r\n  });\r\n\r\n  //     Firestore     \r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        if (!user?.uid) return;\r\n        const ref = doc(db, 'profiles', user.uid, 'cashierUsers', 'list');\r\n        const snap = await getDoc(ref);\r\n        if (snap.exists()) {\r\n          const data = snap.data() as any;\r\n          const cloudUsers: CashierUser[] = Array.isArray(data?.users) ? data.users : [];\r\n          if (cloudUsers && cloudUsers.length > 0) {\r\n            setUsers(cloudUsers);\r\n          }\r\n        }\r\n      } catch {}\r\n    })();\r\n  }, [user?.uid]);\r\n\r\n  //        \r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n    const ref = doc(db, 'profiles', user.uid, 'cashierUsers', 'list');\r\n    const unsub = onSnapshot(ref, (snap) => {\r\n      try {\r\n        if (snap.exists()) {\r\n          const data = snap.data() as any;\r\n          const cloudUsers: CashierUser[] = Array.isArray(data?.users) ? data.users : [];\r\n          if (cloudUsers && cloudUsers.length > 0) {\r\n            setUsers(cloudUsers);\r\n          } else {\r\n            try {\r\n              const saved = localStorage.getItem(getCashierUsersKey());\r\n              const localUsers: CashierUser[] = saved ? JSON.parse(saved) : [];\r\n              setUsers(localUsers);\r\n            } catch {\r\n              setUsers([]);\r\n            }\r\n          }\r\n        }\r\n      } catch {}\r\n    }, (err) => {\r\n      console.warn('cashierUsers realtime subscription error:', err);\r\n    });\r\n    return () => unsub();\r\n  }, [user?.uid]);\r\n\r\n  //      \r\n  const planType = userSubscription?.subscription?.planType as ('monthly' | 'yearly' | 'lifetime' | undefined);\r\n  const maxCashiers = planType === 'yearly' ? 2 : planType === 'lifetime' ? 4 : Number.POSITIVE_INFINITY;\r\n\r\n  useEffect(() => {\r\n    try {\r\n      //     \r\n      localStorage.setItem(getCashierUsersKey(), JSON.stringify(users));\r\n      //         ()\r\n      try { localStorage.removeItem('cashierUsers'); } catch {}\r\n    } catch {}\r\n    //     \r\n    (async () => {\r\n      try {\r\n        if (!user?.uid) return;\r\n        const ref = doc(db, 'profiles', user.uid, 'cashierUsers', 'list');\r\n        await setDoc(ref, { users }, { merge: true });\r\n      } catch {}\r\n    })();\r\n  }, [users]);\r\n\r\n  const [authDialogOpen, setAuthDialogOpen] = useState(false);\r\n  const [enteredPassword, setEnteredPassword] = useState('');\r\n  const [selectedUser, setSelectedUser] = useState<CashierUser | null>(null);\r\n  //    \r\n  const [deliveryReports, setDeliveryReports] = useState<any[]>([]);\r\n  const [deliveryReportsDialogOpen, setDeliveryReportsDialogOpen] = useState(false);\r\n  //           \r\n  const [selectedDeliveryReport, setSelectedDeliveryReport] = useState<any | null>(null);\r\n  const [isDeliveryReportOpen, setIsDeliveryReportOpen] = useState(false);\r\n  //    \r\n  const [addUserDialogOpen, setAddUserDialogOpen] = useState(false);\r\n\r\n  const handleDeleteUser = (usernameToDelete: string) => {\r\n    const isCurrentShiftUser = shiftUser?.username === usernameToDelete;\r\n    let lastHandoverToAdmin = false;\r\n    try { lastHandoverToAdmin = localStorage.getItem('lastHandoverToAdmin') === 'true'; } catch {}\r\n    const handedToAdmin = handoverTargetLabel === ' ' || lastHandoverToAdmin;\r\n    const canDeleteCurrentShiftUser = isCurrentShiftUser && !isShiftActive && handedToAdmin;\r\n\r\n    //                   \r\n    if (isCurrentShiftUser && !canDeleteCurrentShiftUser) {\r\n      toast({ title: '  ', description: '            ' });\r\n      return;\r\n    }\r\n\r\n    const confirmMsg = `      ${usernameToDelete}\\n\\n     .`;\r\n    if (!window.confirm(confirmMsg)) return;\r\n\r\n    setUsers((prev) => prev.filter((u) => u.username !== usernameToDelete));\r\n\r\n    //                 \r\n    if (isCurrentShiftUser) {\r\n      setShiftUser(null);\r\n    }\r\n\r\n    toast({ title: '  ', description: usernameToDelete });\r\n  };\r\n\r\n  const handleAddUser = () => {\r\n    if (!name.trim() || !username.trim() || !password.trim()) return;\r\n    if (users.length >= maxCashiers) {\r\n      toast({\r\n        title: '   ',\r\n        description: `    ${Number.isFinite(maxCashiers) ? maxCashiers : '  '}  `,\r\n        variant: 'destructive',\r\n      });\r\n      return;\r\n    }\r\n    const newUser: CashierUser = { name: name.trim(), username: username.trim(), password: password.trim() };\r\n    setUsers(prev => [newUser, ...prev]);\r\n    //         \r\n    setName('');\r\n    setUsername('');\r\n    setPassword('');\r\n  };\r\n\r\n  const handleStartShift = () => {\r\n    //           \r\n    if (!shiftUser) return;\r\n    //          \r\n    try { localStorage.setItem('lastHandoverToAdmin', 'false'); } catch {}\r\n    startShift();\r\n  };\r\n\r\n  const handleEndShift = () => {\r\n    //     :      \r\n    setHandoverDialogOpen(true);\r\n    setHandoverMode(null);\r\n    setHandoverSelectedUser(null);\r\n    setHandoverPassword('');\r\n    setHandoverError('');\r\n  };\r\n\r\n  const computeShiftTotals = async () => {\r\n    try {\r\n      // 1)  :    Firestore\r\n      let transactions: any[] = [];\r\n      try {\r\n        if (user?.uid) {\r\n          transactions = await userDataService.getUserTransactions(user.uid);\r\n        }\r\n      } catch {}\r\n\r\n      // 2)     (  )      \r\n      if (!transactions || transactions.length === 0) {\r\n        try {\r\n          const res = await getLastTransactions({ merchantUserId: user?.uid, limit: 200 });\r\n          transactions = res?.transactions || [];\r\n        } catch {\r\n          //      \r\n        }\r\n      }\r\n\r\n      //         \r\n\r\n      const startTime = shiftStartAt ? new Date(shiftStartAt) : null;\r\n      const now = new Date();\r\n\r\n      const isWithdrawTx = (t: any) => {\r\n        const type = t.type;\r\n        const xn = (t as any).txnType;\r\n        return (\r\n          type === 'withdraw' ||\r\n          type === 'withdrawal' ||\r\n          type === 'receive' ||\r\n          xn === 'receive'\r\n        );\r\n      };\r\n\r\n      const isSendTx = (t: any) => {\r\n        const type = t.type;\r\n        const xn = (t as any).txnType;\r\n        return (\r\n          type === 'send' ||\r\n          type === 'transfer' ||\r\n          xn === 'send'\r\n        );\r\n      };\r\n\r\n      const parseDate = (val: any) => {\r\n        if (!val) return null;\r\n        if (val instanceof Date) return val;\r\n        //    ISO  Timestamp  Firebase\r\n        try {\r\n          const d = new Date(val);\r\n          return Number.isNaN(d.getTime()) ? null : d;\r\n        } catch {\r\n          return null;\r\n        }\r\n      };\r\n\r\n      const inShiftWindow = (t: any) => {\r\n        const created = parseDate((t as any).createdAt || (t as any).created_at || (t as any).timestamp);\r\n        if (!created) return false;\r\n        if (startTime && created < startTime) return false;\r\n        return created <= now;\r\n      };\r\n\r\n      const isCompletedStatus = (s: any) => {\r\n        return s === 'completed' || s === 'confirmed'; //     Firebase\r\n      };\r\n\r\n      const completed = transactions.filter((t: any) => isCompletedStatus(t.status) && inShiftWindow(t));\r\n\r\n      const totalWithdrawals = completed\r\n        .filter((t: any) => isWithdrawTx(t))\r\n        .reduce((sum: number, t: any) => {\r\n          const amount = (t as any).withdrawnAmount ?? (t as any).receivedAmount ?? (t as any).amount ?? 0;\r\n          return sum + (Number(amount) || 0);\r\n        }, 0);\r\n\r\n      const totalTransfers = completed\r\n        .filter((t: any) => isSendTx(t))\r\n        .reduce((sum: number, t: any) => {\r\n          const amount = (t as any).sentAmount ?? (t as any).transferredAmount ?? (t as any).amount ?? 0;\r\n          return sum + (Number(amount) || 0);\r\n        }, 0);\r\n\r\n      return { totalTransfers, totalWithdrawals };\r\n    } catch {\r\n      return { totalTransfers: 0, totalWithdrawals: 0 };\r\n    }\r\n  };\r\n\r\n  //   :         \r\n  useEffect(() => {\r\n    if (!reportDialogOpen) return;\r\n    //           \r\n    try {\r\n      const d = localStorage.getItem('shiftInitialReceivedDrawerFunds');\r\n      if (d !== null) setReceivedDrawerFunds(d);\r\n    } catch {}\r\n    try {\r\n      const w = localStorage.getItem('shiftInitialReceivedWalletBalancesTotal');\r\n      if (w !== null) {\r\n        const v = parseFloat(w);\r\n        setReceivedWalletBalancesTotal(Number.isFinite(v) ? v : 0);\r\n      }\r\n    } catch {}\r\n  }, [reportDialogOpen]);\r\n\r\n  useEffect(() => {\r\n    if (!handoverDialogOpen) return;\r\n    (async () => {\r\n      try {\r\n        const t = await computeShiftTotals();\r\n        setReportTotals(t);\r\n      } catch {}\r\n    })();\r\n  }, [handoverDialogOpen]);\r\n\r\n  //        \r\n  useEffect(() => {\r\n    if (!open && !deliveryReportsDialogOpen) return;\r\n    const loadReports = async () => {\r\n      try {\r\n        const txs = user?.uid ? await userDataService.getUserTransactions(user.uid) : [];\r\n        const reports = (txs || []).filter((t: any) => t?.type === 'report' || (t?.title || '').includes('  '));\r\n        reports.sort((a: any, b: any) => {\r\n          const ad = new Date(a.createdAt || 0).getTime();\r\n          const bd = new Date(b.createdAt || 0).getTime();\r\n          return bd - ad;\r\n        });\r\n        setDeliveryReports(reports);\r\n      } catch {\r\n        setDeliveryReports([]);\r\n      }\r\n    };\r\n    loadReports();\r\n  }, [open, reportDialogOpen, deliveryReportsDialogOpen, user?.uid]);\r\n\r\n  const saveShiftReceiptToRecent = async (totals: { totalTransfers: number; totalWithdrawals: number }, deficit: boolean, deficitAmt: number) => {\r\n    try {\r\n      //          \r\n      let initialDrawerFunds = 0;\r\n      let initialWalletBalancesTotal = 0;\r\n      try {\r\n        const d = parseFloat(localStorage.getItem('shiftInitialReceivedDrawerFunds') || '0');\r\n        initialDrawerFunds = Number.isFinite(d) ? d : 0;\r\n      } catch {}\r\n      try {\r\n        const w = parseFloat(localStorage.getItem('shiftInitialReceivedWalletBalancesTotal') || '0');\r\n        initialWalletBalancesTotal = Number.isFinite(w) ? w : 0;\r\n      } catch {}\r\n      const receipt = {\r\n        id: `shift_receipt_${Date.now()}`,\r\n        type: 'report',\r\n        senderPhone: shiftUser?.username || 'cashier',\r\n        receiverPhone: handoverTargetLabel || 'admin',\r\n        amount: 0,\r\n        status: 'completed',\r\n        createdAt: new Date().toISOString(),\r\n        title: '  ',\r\n        //          \r\n        cashierName: shiftUser?.name || shiftUser?.username || null,\r\n        deficit: deficit,\r\n        deficitAmount: deficit ? deficitAmt : 0,\r\n        shiftStartAt,\r\n        //   \r\n        receivedDrawerFunds: initialDrawerFunds,\r\n        receivedWalletBalancesTotal: initialWalletBalancesTotal,\r\n        receivedWalletBalances: receivedWalletBalancesMap,\r\n        deliveredDrawerFunds: deliveredDrawerFunds || 0,\r\n        deliveredWalletBalancesTotal: deliveredWalletBalancesTotal || 0,\r\n        deliveredWalletBalances: deliveredWalletBalancesMap,\r\n        //      \r\n        shiftProfit: Math.round((((deliveredDrawerFunds || 0) + (deliveredWalletBalancesTotal || 0)) - (initialDrawerFunds + initialWalletBalancesTotal)) * 100) / 100,\r\n      };\r\n\r\n      if (user?.uid) {\r\n        await userDataService.saveUserTransaction(user.uid, receipt);\r\n      }\r\n\r\n      //       \r\n      setDeliveryReports(prev => [receipt, ...(prev || [])]);\r\n    } catch {}\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={open} onOpenChange={onOpenChange}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n        <DialogTitle>{isShiftActive ? '  ' : '  '}</DialogTitle>\r\n          </DialogHeader>\r\n          {!isShiftActive ? (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"text-xs text-gray-600\">       \"  \"  .</div>\r\n\r\n              {/*    */}\r\n              {users.length > 0 && (\r\n                <div className=\"mt-4 border-t pt-3\">\r\n                  <div className=\"text-sm font-medium mb-2\"> </div>\r\n                  <div className=\"space-y-2 max-h-48 overflow-auto\">\r\n                    {users.map((u, idx) => (\r\n                      <div key={idx} className=\"flex items-center justify-between rounded border px-3 py-2\">\r\n                        <div>\r\n                          <div className=\"text-sm font-semibold\">{u.name}</div>\r\n                          <div className=\"text-xs text-gray-500\">{u.username}</div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2 flex-wrap\">\r\n                          <Button size=\"sm\" className=\"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white\" onClick={() => { setSelectedUser(u); setAuthDialogOpen(true); }}></Button>\r\n                          <Button size=\"sm\" className=\"w-full sm:w-auto\" variant=\"destructive\" onClick={() => handleDeleteUser(u.username)}></Button>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"p-3 rounded border bg-gray-50\">\r\n                <div className=\"text-sm\">  :</div>\r\n                <div className=\"font-semibold text-sm\">{shiftUser?.name} ({shiftUser?.username})</div>\r\n              </div>\r\n            <div className=\"text-xs text-gray-600\">    \"  \"   .</div>\r\n            </div>\r\n          )}\r\n          <DialogFooter className=\"flex flex-wrap gap-2 justify-between\">\r\n            {!isShiftActive ? (\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                <Button className=\"w-full sm:w-auto bg-emerald-600 hover:bg-emerald-700 text-white\" onClick={() => setAddUserDialogOpen(true)}>  </Button>\r\n                <Button className=\"w-full sm:w-auto\" variant=\"outline\" onClick={() => setDeliveryReportsDialogOpen(true)}> </Button>\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                <Button className=\"w-full sm:w-auto\" variant=\"destructive\" onClick={handleEndShift}>  </Button>\r\n              </div>\r\n            )}\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*     */}\r\n      <Dialog open={addUserDialogOpen} onOpenChange={setAddUserDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>  </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <Label className=\"mb-1 block\"></Label>\r\n              <Input value={name} onChange={(e) => setName(e.target.value)} placeholder=\" \" />\r\n            </div>\r\n            <div>\r\n              <Label className=\"mb-1 block\"> </Label>\r\n              <Input value={username} onChange={(e) => setUsername(e.target.value)} placeholder=\"  \" />\r\n            </div>\r\n            <div>\r\n              <Label className=\"mb-1 block\"> </Label>\r\n              <Input type=\"password\" autoComplete=\"new-password\" value={password} onChange={(e) => setPassword(e.target.value)} placeholder=\"  \" />\r\n            </div>\r\n            <div className=\"text-xs text-gray-500\"> :     .</div>\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              variant=\"secondary\"\r\n              onClick={() => {\r\n                setAddUserDialogOpen(false);\r\n              }}\r\n            ></Button>\r\n            <Button\r\n              onClick={() => {\r\n                if (!name.trim() || !username.trim() || !password.trim()) return;\r\n                handleAddUser();\r\n                setAddUserDialogOpen(false);\r\n              }}\r\n            className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n            > </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*      */}\r\n      <Dialog open={deliveryReportsDialogOpen} onOpenChange={setDeliveryReportsDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-lg\">\r\n          <DialogHeader>\r\n            <DialogTitle> </DialogTitle>\r\n          </DialogHeader>\r\n          {deliveryReports.length === 0 ? (\r\n            <div className=\"text-xs text-gray-600\">     .</div>\r\n          ) : (\r\n            <div className=\"space-y-2 max-h-[60vh] overflow-auto\">\r\n              {deliveryReports.map((r: any) => (\r\n                <div\r\n                  key={r.id}\r\n                  className=\"rounded border px-3 py-2 cursor-pointer hover:bg-gray-50\"\r\n                  onClick={() => {\r\n                    setSelectedDeliveryReport(r);\r\n                    setIsDeliveryReportOpen(true);\r\n                  }}\r\n                >\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div className=\"text-sm font-semibold\">{new Date(r.createdAt).toLocaleString('ar-EG')}</div>\r\n                    <div className=\"text-xs text-gray-500\">: {r.receiverPhone}</div>\r\n                  </div>\r\n                  <div className=\"grid grid-cols-2 gap-2 mt-1\">\r\n                    <div className=\"text-xs text-gray-600\"> : {r.deliveredDrawerFunds ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">  (): {r.deliveredWalletBalancesTotal ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\"> : {r.receivedDrawerFunds ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">  (): {r.receivedWalletBalancesTotal ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\"> : {r.deliveredDrawerFunds ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">  (): {r.deliveredWalletBalancesTotal ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\"> : {r.receivedDrawerFunds ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">  (): {r.receivedWalletBalancesTotal ?? 0}</div>\r\n                    <div className={[\r\n                      'text-xs',\r\n                      ((r.shiftProfit ?? ((r.deliveredDrawerFunds ?? 0) + (r.deliveredWalletBalancesTotal ?? 0) - (r.receivedDrawerFunds ?? 0) - (r.receivedWalletBalancesTotal ?? 0))) >= 0)\r\n                        ? 'text-green-700'\r\n                        : 'text-red-700'\r\n                    ].join(' ')}> : {r.shiftProfit ?? ((r.deliveredDrawerFunds ?? 0) + (r.deliveredWalletBalancesTotal ?? 0) - (r.receivedDrawerFunds ?? 0) - (r.receivedWalletBalancesTotal ?? 0))}</div>\r\n                  </div>\r\n                  {r.deficit && (\r\n                    <div className=\"text-xs text-red-600 mt-1\">: {r.deficitAmount ?? 0}</div>\r\n                  )}\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button variant=\"secondary\" onClick={() => setDeliveryReportsDialogOpen(false)}></Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*        */}\r\n      <Dialog open={isDeliveryReportOpen} onOpenChange={setIsDeliveryReportOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>  </DialogTitle>\r\n          </DialogHeader>\r\n          {selectedDeliveryReport ? (\r\n            <div className=\"space-y-3\">\r\n              <div className=\"p-3 rounded border bg-gray-50\">\r\n                <div className=\"text-sm\">: {new Date(selectedDeliveryReport.createdAt).toLocaleString('ar-EG')}</div>\r\n                <div className=\"text-xs text-gray-600 mt-1\">  : {selectedDeliveryReport.receiverPhone}</div>\r\n              </div>\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2\">  </div>\r\n                  <div className=\"text-xs text-gray-600\">: {selectedDeliveryReport.receivedDrawerFunds ?? 0}</div>\r\n                  <div className=\"text-xs text-gray-600\">  (): {selectedDeliveryReport.receivedWalletBalancesTotal ?? 0}</div>\r\n                </div>\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2\">  </div>\r\n                  <div className=\"text-xs text-gray-600\">: {selectedDeliveryReport.deliveredDrawerFunds ?? 0}</div>\r\n                  <div className=\"text-xs text-gray-600\">  (): {selectedDeliveryReport.deliveredWalletBalancesTotal ?? 0}</div>\r\n                </div>\r\n              </div>\r\n              {selectedDeliveryReport.deficit && (\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2 text-red-600\"></div>\r\n                  <div className=\"text-xs text-red-600\">: {selectedDeliveryReport.deficitAmount ?? 0}</div>\r\n                </div>\r\n              )}\r\n              {/*      */}\r\n              {(selectedDeliveryReport.receivedWalletBalances && Object.keys(selectedDeliveryReport.receivedWalletBalances).length > 0) && (\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2\">  </div>\r\n                  <div className=\"space-y-1\">\r\n                    {Object.entries(selectedDeliveryReport.receivedWalletBalances as Record<string, number>).map(([k, v]) => (\r\n                      <div key={k} className=\"flex items-center justify-between text-xs\">\r\n                        <span className=\"text-gray-600\">{k}</span>\r\n                        <span className=\"font-semibold\">{v}</span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {(selectedDeliveryReport.deliveredWalletBalances && Object.keys(selectedDeliveryReport.deliveredWalletBalances).length > 0) && (\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2\">  </div>\r\n                  <div className=\"space-y-1\">\r\n                    {Object.entries(selectedDeliveryReport.deliveredWalletBalances as Record<string, number>).map(([k, v]) => (\r\n                      <div key={k} className=\"flex items-center justify-between text-xs\">\r\n                        <span className=\"text-gray-600\">{k}</span>\r\n                        <span className=\"font-semibold\">{v}</span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-xs text-gray-600\">    .</div>\r\n          )}\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button variant=\"secondary\" onClick={() => setIsDeliveryReportOpen(false)}></Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*      */}\r\n      <Dialog open={authDialogOpen} onOpenChange={setAuthDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>   </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-3\">\r\n            <div className=\"text-sm\">{selectedUser ? `${selectedUser.name} (${selectedUser.username})` : ''}</div>\r\n            <Input\r\n              type=\"password\"\r\n              autoComplete=\"off\"\r\n              value={enteredPassword}\r\n              onChange={(e) => setEnteredPassword(e.target.value)}\r\n              placeholder=\"  \"\r\n            />\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              variant=\"secondary\"\r\n              onClick={() => { setEnteredPassword(''); setSelectedUser(null); setAuthDialogOpen(false); }}\r\n            ></Button>\r\n            <Button\r\n              className=\"bg-emerald-600 hover:bg-emerald-700 text-white\"\r\n              onClick={() => {\r\n                if (!selectedUser) return;\r\n                if (enteredPassword.trim() !== selectedUser.password) {\r\n                  toast({ title: '   ', description: '    ', variant: 'destructive' });\r\n                  return;\r\n                }\r\n                setShiftUser({ name: selectedUser.name, username: selectedUser.username });\r\n                setEnteredPassword('');\r\n                setAuthDialogOpen(false);\r\n                onOpenChange(false);\r\n                startShift();\r\n                //       \r\n                setInitialIntakeDialogOpen(true);\r\n              }}\r\n            > </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*          */}\r\n      <Dialog open={initialIntakeDialogOpen} onOpenChange={setInitialIntakeDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>   </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"rounded border p-3\">\r\n              <Label className=\"mb-1 block\">    </Label>\r\n              <Input\r\n                type=\"text\"\r\n                inputMode=\"decimal\"\r\n                value={receivedDrawerFunds}\r\n                onChange={(e) => setReceivedDrawerFunds(normalizeDigits(e.target.value))}\r\n                placeholder=\"       \"\r\n              />\r\n            </div>\r\n            <div className=\"rounded border p-3\">\r\n              <Label className=\"mb-1 block\">   ()  </Label>\r\n              <Input\r\n                type=\"text\"\r\n                inputMode=\"decimal\"\r\n                value={Number.isFinite(receivedWalletBalancesTotal) ? receivedWalletBalancesTotal : 0}\r\n                onChange={(e) => {\r\n                  const v = parseFloat(normalizeDigits(e.target.value));\r\n                  setReceivedWalletBalancesTotal(Number.isFinite(v) ? v : 0);\r\n                }}\r\n                placeholder=\"      \"\r\n              />\r\n              <div className=\"text-xs text-gray-600 mt-1\">        .</div>\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              className=\"bg-emerald-600 hover:bg-emerald-700 text-white\"\r\n              onClick={() => {\r\n                const drawer = parseFloat(receivedDrawerFunds);\r\n                const wallets = receivedWalletBalancesTotal;\r\n                const isDrawerValid = Number.isFinite(drawer) && drawer >= 0;\r\n                const isWalletsValid = Number.isFinite(wallets) && wallets >= 0;\r\n                if (!isDrawerValid || !isWalletsValid) {\r\n                  toast({ title: '   ', description: '        ', variant: 'destructive' });\r\n                  return;\r\n                }\r\n                //        \r\n                try {\r\n                  localStorage.setItem('shiftInitialReceivedDrawerFunds', String(drawer));\r\n                  localStorage.setItem('shiftInitialReceivedWalletBalancesTotal', String(wallets));\r\n                } catch {}\r\n                toast({ title: '   ', description: '      ' });\r\n                setInitialIntakeDialogOpen(false);\r\n              }}\r\n            > </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*   :       */}\r\n      <Dialog open={handoverDialogOpen} onOpenChange={(open) => { if (open) setHandoverDialogOpen(true); }}>\r\n        <DialogContent className=\"sm:max-w-md\" hideClose disableOutsideClose disableEscClose>\r\n          <DialogHeader>\r\n            <DialogTitle>  </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            {/*   */}\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                variant={handoverMode === 'toUser' ? 'default' : 'secondary'}\r\n                onClick={() => setHandoverMode('toUser')}\r\n              >   </Button>\r\n              <Button\r\n                variant={handoverMode === 'toAdmin' ? 'default' : 'secondary'}\r\n                onClick={() => setHandoverMode('toAdmin')}\r\n              >   </Button>\r\n            </div>\r\n\r\n            {/*      */}\r\n            {handoverMode === 'toUser' && (\r\n              <div className=\"space-y-3\">\r\n                {users.length === 0 ? (\r\n                  <div className=\"text-sm text-gray-600\">   .    .</div>\r\n                ) : (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"text-sm font-medium\">    </div>\r\n                    <div className=\"space-y-2 max-h-40 overflow-auto\">\r\n                      {users.map((u, idx) => (\r\n                        <div\r\n                          key={idx}\r\n                          className={`flex items-center justify-between rounded border px-3 py-2 cursor-pointer ${handoverSelectedUser?.username === u.username ? 'bg-indigo-50 border-indigo-200' : ''}`}\r\n                          onClick={() => setHandoverSelectedUser(u)}\r\n                        >\r\n                          <div>\r\n                            <div className=\"text-sm font-semibold\">{u.name}</div>\r\n                            <div className=\"text-xs text-gray-500\">{u.username}</div>\r\n                          </div>\r\n                          <span className=\"text-xs text-gray-400\"></span>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                <div>\r\n                  <Label className=\"mb-1 block\">   </Label>\r\n                  <Input\r\n                    type=\"password\"\r\n                    autoComplete=\"off\"\r\n                    value={handoverPassword}\r\n                    onChange={(e) => setHandoverPassword(e.target.value)}\r\n                    placeholder=\"  \"\r\n                  />\r\n                </div>\r\n                {handoverError && <div className=\"text-xs text-red-600\">{handoverError}</div>}\r\n              </div>\r\n            )}\r\n\r\n            {/*      */}\r\n            {handoverMode === 'toAdmin' && (\r\n              <div className=\"space-y-3\">\r\n                <div className=\"text-sm text-gray-600\">         .</div>\r\n                <Input\r\n                  type=\"password\"\r\n                  autoComplete=\"off\"\r\n                  value={mainPassword}\r\n                  onChange={(e) => setMainPassword(e.target.value)}\r\n                  placeholder=\" \"\r\n                />\r\n                {mainAuthError && (\r\n                  <div className=\"text-xs text-red-600\">{mainAuthError}</div>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              disabled={isHandoverProcessing || !handoverMode}\r\n              onClick={async () => {\r\n                if (!handoverMode) return;\r\n                setIsHandoverProcessing(true);\r\n                try {\r\n                  const totals = reportTotals;\r\n                  computeShiftTotals().then(setReportTotals).catch(() => {});\r\n                  if (handoverMode === 'toUser') {\r\n                    if (!handoverSelectedUser) {\r\n                      setHandoverError('   ');\r\n                      setIsHandoverProcessing(false);\r\n                      return;\r\n                    }\r\n                    if (handoverPassword.trim() !== handoverSelectedUser.password) {\r\n                      setHandoverError('   ');\r\n                      setIsHandoverProcessing(false);\r\n                      return;\r\n                    }\r\n                    //      \r\n                    endShift();\r\n                    setShiftUser({ name: handoverSelectedUser.name, username: handoverSelectedUser.username });\r\n                    startShift();\r\n                    setHandoverTargetLabel(`${handoverSelectedUser.name} (${handoverSelectedUser.username})`);\r\n                    //   :    \r\n                    try { localStorage.setItem('lastHandoverToAdmin', 'false'); } catch {}\r\n                    //  \r\n                    setHandoverDialogOpen(false);\r\n                    setHandoverMode(null);\r\n                    setHandoverSelectedUser(null);\r\n                    setHandoverPassword('');\r\n                    setHandoverError('');\r\n                    onOpenChange(false);\r\n                    //   \r\n                    setReportTotals(totals);\r\n                    setDeficitChoice(null);\r\n                    setDeficitAmount('');\r\n                    setReportDialogOpen(true);\r\n                  } else if (handoverMode === 'toAdmin') {\r\n                    setMainAuthError('');\r\n                    const email = user?.email || '';\r\n                    if (!email) {\r\n                      setMainAuthError('     ');\r\n                      setIsHandoverProcessing(false);\r\n                      return;\r\n                    }\r\n                    const { error } = await signIn(email, mainPassword);\r\n                    if (error) {\r\n                      setMainAuthError('   ');\r\n                      setIsHandoverProcessing(false);\r\n                      return;\r\n                    }\r\n                    //     (  )\r\n                    endShift();\r\n                    //        \r\n                    setShiftUser(null);\r\n                    //         \r\n                    try { localStorage.setItem('lastHandoverToAdmin', 'true'); } catch {}\r\n                    setMainPassword('');\r\n                    setHandoverDialogOpen(false);\r\n                    onOpenChange(false);\r\n                    setHandoverTargetLabel(' ');\r\n                    //   \r\n                    setReportTotals(totals);\r\n                    setDeficitChoice(null);\r\n                    setDeficitAmount('');\r\n                    setReportDialogOpen(true);\r\n                  }\r\n                } catch (e) {\r\n                  setHandoverError('      ');\r\n                } finally {\r\n                  setIsHandoverProcessing(false);\r\n                }\r\n              }}\r\n            className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n            > </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*      */}\r\n      <Dialog open={reportDialogOpen} onOpenChange={setReportDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-lg\" hideClose disableOutsideClose disableEscClose>\r\n          <DialogHeader>\r\n            <DialogTitle>   </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"p-3 rounded border bg-gray-50\">\r\n              <div className=\"text-sm\">   : <span className=\"font-semibold\">{handoverTargetLabel}</span></div>\r\n              {shiftStartAt && (\r\n                <div className=\"text-xs text-gray-600 mt-1\"> : {new Date(shiftStartAt).toLocaleString('ar-EG')}</div>\r\n              )}\r\n              <div className=\"text-xs text-gray-600\"> : {new Date().toLocaleString('ar-EG')}</div>\r\n            </div>\r\n            {/*         */}\r\n            {/*     */}\r\n            <div className=\"space-y-3\">\r\n                <div className=\"grid grid-cols-2 gap-3\">\r\n                  <div className=\"rounded border p-3\">\r\n                    <Label className=\"mb-1 block\">  </Label>\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={receivedDrawerFunds}\r\n                      readOnly\r\n                      disabled\r\n                      placeholder=\"    \"\r\n                    />\r\n                    <div className=\"text-xs text-gray-600 mt-1\">      .</div>\r\n                  </div>\r\n                  <div className=\"rounded border p-3\">\r\n                    <Label className=\"mb-1 block\">   ()</Label>\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={receivedWalletBalancesTotal}\r\n                      readOnly\r\n                      disabled\r\n                      placeholder=\"    \"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                <div className=\"rounded border p-3\">\r\n                  <Label className=\"mb-1 block\">  </Label>\r\n                  <Input\r\n                    type=\"text\"\r\n                    inputMode=\"decimal\"\r\n                    value={deliveredDrawerFunds}\r\n                    onChange={(e) => {\r\n                      const v = parseFloat(normalizeDigits(e.target.value));\r\n                      setDeliveredDrawerFunds(Number.isFinite(v) ? v : 0);\r\n                    }}\r\n                    placeholder=\"      \"\r\n                  />\r\n                  <div className=\"text-xs text-gray-600 mt-1\">       </div>\r\n                </div>\r\n                <div className=\"rounded border p-3\">\r\n                  <Label className=\"mb-1 block\">   ()</Label>\r\n                  <Input\r\n                    type=\"text\"\r\n                    inputMode=\"decimal\"\r\n                    value={deliveredWalletBalancesTotal}\r\n                    onChange={(e) => {\r\n                      const v = parseFloat(normalizeDigits(e.target.value));\r\n                      setDeliveredWalletBalancesTotal(Number.isFinite(v) ? v : 0);\r\n                    }}\r\n                    placeholder=\"    \"\r\n                  />\r\n                  <div className=\"text-xs text-gray-600 mt-1\">       </div>\r\n                </div>\r\n              </div>\r\n              {/*   */}\r\n              <div className=\"rounded border p-3\">\r\n                <div className=\"text-sm font-semibold mb-1\"> </div>\r\n                <div className={[\r\n                  'text-sm',\r\n                  ((((deliveredDrawerFunds ?? 0) + (deliveredWalletBalancesTotal ?? 0) - (((parseFloat(receivedDrawerFunds || '0') || 0)) + (receivedWalletBalancesTotal ?? 0))) >= 0)\r\n                    ? 'text-green-700'\r\n                    : 'text-red-700')\r\n                ].join(' ')}>\r\n                  {Math.round((((deliveredDrawerFunds ?? 0) + (deliveredWalletBalancesTotal ?? 0) - (((parseFloat(receivedDrawerFunds || '0') || 0)) + (receivedWalletBalancesTotal ?? 0))) ) * 100) / 100}\r\n                </div>\r\n                <div className=\"text-xs text-gray-600\">: (  )  + </div>\r\n                <div className=\"mt-2 grid grid-cols-1 gap-2\">\r\n                  <div className=\"rounded border p-2 bg-gray-50\">\r\n                    <div className=\"text-xs text-gray-700\">   ( )</div>\r\n                    <div className=\"text-sm font-semibold text-gray-900\">\r\n                      {Math.round(((deliveredDrawerFunds ?? 0) - ((parseFloat(receivedDrawerFunds || '0') || 0))) * 100) / 100}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <div className=\"text-sm font-medium\">  </div>\r\n              <div className=\"flex gap-2\">\r\n                <Button variant={deficitChoice === 'no' ? 'default' : 'secondary'} onClick={() => setDeficitChoice('no')}></Button>\r\n                <Button variant={deficitChoice === 'yes' ? 'default' : 'secondary'} onClick={() => setDeficitChoice('yes')}></Button>\r\n              </div>\r\n              {deficitChoice === 'yes' && (\r\n                <div>\r\n                  <Label className=\"mb-1 block\"> </Label>\r\n                  <Input type=\"number\" value={deficitAmount} onChange={(e) => setDeficitAmount(e.target.value)} placeholder=\"  \" />\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              onClick={() => {\r\n                const deficit = deficitChoice === 'yes';\r\n                const amt = parseFloat(deficitAmount) || 0;\r\n                (async () => { await saveShiftReceiptToRecent(reportTotals, deficit, amt); })();\r\n                toast({ title: '    ', description: '        ' });\r\n                setReportDialogOpen(false);\r\n              }}\r\n            className=\"bg-emerald-600 hover:bg-emerald-700 text-white\"\r\n            >  </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default CashierShiftModal;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useShift } from '@/contexts/ShiftContext';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { db } from '@/firebase';\r\nimport { doc, getDoc, onSnapshot } from 'firebase/firestore';\r\n\r\ninterface Props {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\ntype CashierUser = { name: string; username: string; password: string };\r\n\r\nconst ShiftProfileDialog: React.FC<Props> = ({ open, onOpenChange }) => {\r\n  const { shiftUser, endShift, setShiftUser } = useShift();\r\n  const [enteredPassword, setEnteredPassword] = useState('');\r\n  const [error, setError] = useState('');\r\n  const [users, setUsers] = useState<CashierUser[]>([]);\r\n  const { user } = useFirebaseAuth();\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      //             fallback \r\n      try {\r\n        if (user?.uid) {\r\n          const ref = doc(db, 'profiles', user.uid, 'cashierUsers', 'list');\r\n          const snap = await getDoc(ref);\r\n          if (snap.exists()) {\r\n            const data = snap.data() as any;\r\n            const cloudUsers: CashierUser[] = Array.isArray(data?.users) ? data.users : [];\r\n            if (cloudUsers && cloudUsers.length > 0) {\r\n              setUsers(cloudUsers);\r\n              return;\r\n            }\r\n          }\r\n        }\r\n      } catch {}\r\n      try {\r\n        const key = `cashierUsers_${user?.uid || 'default'}`;\r\n        let saved = localStorage.getItem(key);\r\n        //             \r\n        if (!saved) {\r\n          const legacy = localStorage.getItem('cashierUsers');\r\n          if (legacy) saved = legacy;\r\n        }\r\n        setUsers(saved ? JSON.parse(saved) : []);\r\n      } catch {\r\n        setUsers([]);\r\n      }\r\n    })();\r\n  }, [open, user?.uid]);\r\n\r\n  //          \r\n  useEffect(() => {\r\n    if (!open || !user?.uid) return;\r\n    const ref = doc(db, 'profiles', user.uid, 'cashierUsers', 'list');\r\n    const unsubscribe = onSnapshot(ref, (snap) => {\r\n      if (snap.exists()) {\r\n        const data = snap.data() as any;\r\n        const cloudUsers: CashierUser[] = Array.isArray(data?.users) ? data.users : [];\r\n        if (cloudUsers && cloudUsers.length > 0) {\r\n          setUsers(cloudUsers);\r\n        } else {\r\n          try {\r\n            const key = `cashierUsers_${user?.uid || 'default'}`;\r\n            let saved = localStorage.getItem(key);\r\n            if (!saved) {\r\n              const legacy = localStorage.getItem('cashierUsers');\r\n              if (legacy) saved = legacy;\r\n            }\r\n            setUsers(saved ? JSON.parse(saved) : []);\r\n          } catch {\r\n            setUsers([]);\r\n          }\r\n        }\r\n      }\r\n    }, (err) => {\r\n      console.warn('ShiftProfileDialog cashierUsers snapshot error:', err);\r\n    });\r\n    return () => unsubscribe();\r\n  }, [open, user?.uid]);\r\n\r\n  const handleEndShift = async () => {\r\n    setError('');\r\n    if (!shiftUser) return;\r\n    const match = users.find(u => u.username === shiftUser.username);\r\n    if (!match) {\r\n      setError('     ');\r\n      return;\r\n    }\r\n    if (enteredPassword.trim() !== match.password) {\r\n      setError('   ');\r\n      return;\r\n    }\r\n    //       \r\n    endShift();\r\n    setShiftUser(null);\r\n    setEnteredPassword('');\r\n    onOpenChange(false);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={(o) => { setEnteredPassword(''); setError(''); onOpenChange(o); }}>\r\n      <DialogContent className=\"sm:max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle> </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        {shiftUser ? (\r\n          <div className=\"space-y-3\">\r\n            <div className=\"rounded-lg border p-3 bg-gradient-to-r from-blue-50 to-indigo-50\">\r\n              <div className=\"text-sm font-semibold text-gray-800\">{shiftUser.name}</div>\r\n              <div className=\"text-xs text-gray-600\">{shiftUser.username}</div>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label className=\"block\">    </Label>\r\n              <Input\r\n                type=\"password\"\r\n                value={enteredPassword}\r\n                onChange={(e) => setEnteredPassword(e.target.value)}\r\n                placeholder=\"  \"\r\n                dir=\"ltr\"\r\n              />\r\n              {error && (\r\n                <div className=\"text-red-600 text-xs\">{error}</div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-sm text-gray-600\">     </div>\r\n        )}\r\n\r\n        <DialogFooter className=\"flex justify-between\">\r\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)}></Button>\r\n          <Button onClick={handleEndShift} disabled={!shiftUser}> </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default ShiftProfileDialog;","import React from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { ListChecks, Sparkles, Wrench } from 'lucide-react';\r\n\r\ninterface ChangeLogDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nexport const ChangeLogDialog: React.FC<ChangeLogDialogProps> = ({ open, onOpenChange }) => {\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-lg rounded-2xl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"text-right flex items-center gap-2 justify-end\">\r\n            <ListChecks className=\"w-5 h-5\" />\r\n              \r\n          </DialogTitle>\r\n          <DialogDescription className=\"text-right\">\r\n                   .\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4\">\r\n          <div className=\"flex items-start gap-3\">\r\n            <Wrench className=\"w-5 h-5 text-amber-600 mt-1\" />\r\n            <div className=\"text-right\">\r\n              <div className=\"font-semibold\">   </div>\r\n              <div className=\"text-sm text-muted-foreground\">    (prompt)      .</div>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-start gap-3\">\r\n            <Sparkles className=\"w-5 h-5 text-violet-600 mt-1\" />\r\n            <div className=\"text-right\">\r\n              <div className=\"font-semibold\">  </div>\r\n              <div className=\"text-sm text-muted-foreground\">   \"  \"      .</div>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-start gap-3\">\r\n            <ListChecks className=\"w-5 h-5 text-green-600 mt-1\" />\r\n            <div className=\"text-right\">\r\n              <div className=\"font-semibold\">   </div>\r\n              <div className=\"text-sm text-muted-foreground\">          .</div>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-start gap-3\">\r\n            <ListChecks className=\"w-5 h-5 text-blue-600 mt-1\" />\r\n            <div className=\"text-right\">\r\n              <div className=\"font-semibold\">   </div>\r\n              <div className=\"text-sm text-muted-foreground\">         .</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex justify-end gap-2 mt-6\">\r\n          <Button variant=\"secondary\" onClick={() => onOpenChange(false)}></Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default ChangeLogDialog;","/**\r\n *         \r\n * \r\n *    :\r\n * 1. :       \r\n * 2. :       \r\n * 3.       \r\n */\r\n\r\nimport { walletDailyLimitsService } from './walletDailyLimitsService';\r\n\r\nexport interface WalletBalance {\r\n  [walletId: string]: number;\r\n}\r\n\r\nexport interface TransactionResult {\r\n  success: boolean;\r\n  newCashBalance: number;\r\n  newWalletBalances: WalletBalance;\r\n  message: string;\r\n  error?: string;\r\n}\r\n\r\nexport interface TransferOperation {\r\n  amount: number;\r\n  currentCashBalance: number;\r\n  currentWalletBalances: WalletBalance;\r\n  wallets: Array<{ id: string; name: string; isDefault?: boolean }>;\r\n  selectedWalletId?: string; //    \r\n  //  :         \r\n  skipRemoteLimitsCheck?: boolean;\r\n  nonBlockingUsageUpdate?: boolean;\r\n}\r\n\r\nexport interface WithdrawOperation {\r\n  amount: number;\r\n  currentCashBalance: number;\r\n  currentWalletBalances: WalletBalance;\r\n  wallets: Array<{ id: string; name: string; isDefault?: boolean }>;\r\n  selectedWalletId?: string; //    \r\n  //  :         \r\n  skipRemoteLimitsCheck?: boolean;\r\n  nonBlockingUsageUpdate?: boolean;\r\n}\r\n\r\nexport class WalletCashService {\r\n  \r\n  /**\r\n   *  :       \r\n   *      \r\n   * @param operation   \r\n   * @returns  \r\n   */\r\n  static async processTransfer(operation: TransferOperation): Promise<TransactionResult> {\r\n    const { amount, currentCashBalance, currentWalletBalances, wallets, selectedWalletId } = operation;\r\n    \r\n    //    \r\n    if (amount <= 0) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"INVALID_AMOUNT\"\r\n      };\r\n    }\r\n\r\n    //       \r\n    if (selectedWalletId && !operation.skipRemoteLimitsCheck) {\r\n      try {\r\n        const limitCheck = await walletDailyLimitsService.canPerformOperation(selectedWalletId, amount, 'transfer');\r\n        if (!limitCheck.canPerform) {\r\n          return {\r\n            success: false,\r\n            newCashBalance: currentCashBalance,\r\n            newWalletBalances: currentWalletBalances,\r\n            message: limitCheck.message || \"   \",\r\n            error: \"LIMIT_EXCEEDED\"\r\n          };\r\n        }\r\n      } catch (error) {\r\n        console.error('     :', error);\r\n        return {\r\n          success: false,\r\n          newCashBalance: currentCashBalance,\r\n          newWalletBalances: currentWalletBalances,\r\n          message: \"     \",\r\n          error: \"LIMIT_CHECK_ERROR\"\r\n        };\r\n      }\r\n    }\r\n    \r\n    //    \r\n    if (amount <= 0) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"INVALID_AMOUNT\"\r\n      };\r\n    }\r\n\r\n    //         \r\n    if (selectedWalletId) {\r\n      const available = Math.max(currentWalletBalances[selectedWalletId] || 0, 0);\r\n      if (available < amount) {\r\n        const target = wallets.find(w => w.id === selectedWalletId);\r\n        return {\r\n          success: false,\r\n          newCashBalance: currentCashBalance,\r\n          newWalletBalances: currentWalletBalances,\r\n          message: `    ${target ? ` ${target.name}` : ''}. : ${available}  : ${amount} `,\r\n          error: \"INSUFFICIENT_WALLET_BALANCE\"\r\n        };\r\n      }\r\n    } else {\r\n      const totalAvailable = WalletCashService.calculateTotalWalletBalance(currentWalletBalances);\r\n      if (totalAvailable < amount) {\r\n        return {\r\n          success: false,\r\n          newCashBalance: currentCashBalance,\r\n          newWalletBalances: currentWalletBalances,\r\n          message: `    .  : ${totalAvailable}   : ${amount} `,\r\n          error: \"INSUFFICIENT_WALLET_BALANCE\"\r\n        };\r\n      }\r\n    }\r\n\r\n    //       \r\n    const newWalletBalances = { ...currentWalletBalances };\r\n\r\n    if (selectedWalletId) {\r\n      const currentBalance = newWalletBalances[selectedWalletId] || 0;\r\n      newWalletBalances[selectedWalletId] = currentBalance - amount;\r\n    } else {\r\n      let remainingAmount = amount;\r\n      for (const wallet of wallets) {\r\n        if (remainingAmount <= 0) break;\r\n        const currentBalance = Math.max(newWalletBalances[wallet.id] || 0, 0);\r\n        const deductAmount = Math.min(currentBalance, remainingAmount);\r\n        if (deductAmount > 0) {\r\n          newWalletBalances[wallet.id] = (newWalletBalances[wallet.id] || 0) - deductAmount;\r\n          remainingAmount -= deductAmount;\r\n        }\r\n      }\r\n      //   :      \r\n    }\r\n\r\n    const newCashBalance = currentCashBalance + amount;\r\n\r\n    \r\n\r\n    //         \r\n    let message = \"  \";\r\n    if (selectedWalletId) {\r\n      const afterBalance = newWalletBalances[selectedWalletId] || 0;\r\n      if (afterBalance < 0) {\r\n        message = `    :   ${selectedWalletId}  ${afterBalance} .`;\r\n      }\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      newCashBalance,\r\n      newWalletBalances,\r\n      message\r\n    };\r\n  }\r\n\r\n  /**\r\n   *  :       \r\n   * @param operation   \r\n   * @returns  \r\n   */\r\n  static processDeposit(operation: TransferOperation): TransactionResult {\r\n    const { amount, currentCashBalance, currentWalletBalances, wallets } = operation;\r\n    \r\n    //    \r\n    if (amount <= 0) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"INVALID_AMOUNT\"\r\n      };\r\n    }\r\n\r\n    //       \r\n    const totalWalletBalance = this.calculateTotalWalletBalance(currentWalletBalances);\r\n    if (totalWalletBalance < amount) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: `    .  : ${totalWalletBalance}   : ${amount} `,\r\n        error: \"INSUFFICIENT_WALLET_BALANCE\"\r\n      };\r\n    }\r\n\r\n    //    \r\n    const newCashBalance = currentCashBalance + amount;\r\n\r\n    //    \r\n    const newWalletBalances = { ...currentWalletBalances };\r\n    let remainingAmount = amount;\r\n\r\n    //     \r\n    const defaultWallet = wallets.find(w => w.isDefault);\r\n    \r\n    if (defaultWallet && newWalletBalances[defaultWallet.id] >= remainingAmount) {\r\n      //        \r\n      newWalletBalances[defaultWallet.id] -= remainingAmount;\r\n      remainingAmount = 0;\r\n    } else {\r\n      //     \r\n      for (const wallet of wallets) {\r\n        if (remainingAmount <= 0) break;\r\n        \r\n        const balance = newWalletBalances[wallet.id] || 0;\r\n        if (balance > 0) {\r\n          const deductAmount = Math.min(balance, remainingAmount);\r\n          newWalletBalances[wallet.id] = balance - deductAmount;\r\n          remainingAmount -= deductAmount;\r\n        }\r\n      }\r\n    }\r\n\r\n    const message = remainingAmount > 0 \r\n      ? `  .   ${amount - remainingAmount}    `\r\n      : `  .   ${amount}    `;\r\n\r\n    return {\r\n      success: true,\r\n      newCashBalance,\r\n      newWalletBalances,\r\n      message\r\n    };\r\n  }\r\n\r\n  /**\r\n   *  :       \r\n   * @param operation   \r\n   * @returns  \r\n   */\r\n  static async processWithdraw(operation: WithdrawOperation): Promise<TransactionResult> {\r\n    const { amount, currentCashBalance, currentWalletBalances, wallets, selectedWalletId } = operation;\r\n    \r\n    //    \r\n    if (amount <= 0) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"INVALID_AMOUNT\"\r\n      };\r\n    }\r\n\r\n    //       \r\n    if (selectedWalletId && !operation.skipRemoteLimitsCheck) {\r\n      try {\r\n        const limitCheck = await walletDailyLimitsService.canPerformOperation(selectedWalletId, amount, 'withdraw');\r\n        if (!limitCheck.canPerform) {\r\n          return {\r\n            success: false,\r\n            newCashBalance: currentCashBalance,\r\n            newWalletBalances: currentWalletBalances,\r\n            message: limitCheck.message || \"   \",\r\n            error: \"LIMIT_EXCEEDED\"\r\n          };\r\n        }\r\n      } catch (error) {\r\n        console.error('     :', error);\r\n        return {\r\n          success: false,\r\n          newCashBalance: currentCashBalance,\r\n          newWalletBalances: currentWalletBalances,\r\n          message: \"     \",\r\n          error: \"LIMIT_CHECK_ERROR\"\r\n        };\r\n      }\r\n    }\r\n\r\n    //        \r\n    if (currentCashBalance < amount) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: `     .  : ${currentCashBalance}   : ${amount} `,\r\n        error: \"INSUFFICIENT_CASH_BALANCE\"\r\n      };\r\n    }\r\n\r\n    //     \r\n    const newCashBalance = currentCashBalance - amount;\r\n\r\n    //     \r\n    const newWalletBalances = { ...currentWalletBalances };\r\n    const targetWallet = selectedWalletId ? wallets.find(w => w.id === selectedWalletId) : (wallets.find(w => w.isDefault) || wallets[0]);\r\n    \r\n    if (targetWallet) {\r\n      const currentBalance = newWalletBalances[targetWallet.id] || 0;\r\n      newWalletBalances[targetWallet.id] = currentBalance + amount;\r\n    } else {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"NO_WALLETS_AVAILABLE\"\r\n      };\r\n    }\r\n\r\n    \r\n\r\n    return {\r\n      success: true,\r\n      newCashBalance,\r\n      newWalletBalances,\r\n      message: `  .   ${amount}    ${targetWallet?.name || ''}`\r\n    };\r\n  }\r\n\r\n  /**\r\n   *       \r\n   * @param amount \r\n   * @param wallets  \r\n   * @returns true    \r\n   */\r\n  static validateOperation(amount: number, wallets: Array<{ id: string; name: string }>): { valid: boolean; error?: string } {\r\n    if (amount <= 0) {\r\n      return { valid: false, error: \"      \" };\r\n    }\r\n\r\n    if (!wallets || wallets.length === 0) {\r\n      return { valid: false, error: \"   \" };\r\n    }\r\n\r\n    return { valid: true };\r\n  }\r\n\r\n  /**\r\n   *    \r\n   * @param walletBalances  \r\n   * @returns  \r\n   */\r\n  static calculateTotalWalletBalance(walletBalances: WalletBalance): number {\r\n    return Object.values(walletBalances).reduce((total, balance) => total + Math.max(balance, 0), 0);\r\n  }\r\n\r\n  /**\r\n   *         ()\r\n   * @param amount   \r\n   * @param currentCashBalance    \r\n   * @param currentWalletBalances   \r\n   * @param wallets  \r\n   * @returns  \r\n   */\r\n  static deductFromWalletsAddToCash(\r\n    amount: number,\r\n    currentCashBalance: number,\r\n    currentWalletBalances: WalletBalance,\r\n    wallets: Array<{ id: string; name: string; isDefault?: boolean }>\r\n  ): TransactionResult {\r\n    return this.processTransfer({\r\n      amount,\r\n      currentCashBalance,\r\n      currentWalletBalances,\r\n      wallets\r\n    });\r\n  }\r\n\r\n  /**\r\n   *         ()\r\n   * @param amount   \r\n   * @param currentCashBalance    \r\n   * @param currentWalletBalances   \r\n   * @param wallets  \r\n   * @returns  \r\n   */\r\n  static deductFromWalletsAddToCashDeposit(\r\n    amount: number,\r\n    currentCashBalance: number,\r\n    currentWalletBalances: WalletBalance,\r\n    wallets: Array<{ id: string; name: string; isDefault?: boolean }>\r\n  ): TransactionResult {\r\n    return this.processDeposit({\r\n      amount,\r\n      currentCashBalance,\r\n      currentWalletBalances,\r\n      wallets\r\n    });\r\n  }\r\n\r\n  /**\r\n   *         ()\r\n   * @param amount   \r\n   * @param currentCashBalance    \r\n   * @param currentWalletBalances   \r\n   * @param wallets  \r\n   * @returns  \r\n   */\r\n  static deductFromCashAddToWallets(\r\n    amount: number,\r\n    currentCashBalance: number,\r\n    currentWalletBalances: WalletBalance,\r\n    wallets: Array<{ id: string; name: string; isDefault?: boolean }>\r\n  ): TransactionResult {\r\n    return this.processWithdraw({\r\n      amount,\r\n      currentCashBalance,\r\n      currentWalletBalances,\r\n      wallets\r\n    });\r\n  }\r\n\r\n  /**\r\n   *        \r\n   * @param result  \r\n   * @param updateCashBalance    \r\n   * @param updateWalletBalances    \r\n   */\r\n  static applyTransactionResult(\r\n    result: TransactionResult,\r\n    updateCashBalance: (newBalance: number) => void,\r\n    updateWalletBalances: (newBalances: WalletBalance) => void\r\n  ): void {\r\n    if (result.success) {\r\n      updateCashBalance(result.newCashBalance);\r\n      updateWalletBalances(result.newWalletBalances);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *      \r\n   * @param amount \r\n   * @param operationType   (transfer  withdraw  deposit)\r\n   * @param currentCashBalance    \r\n   * @param currentWalletBalances   \r\n   * @returns  \r\n   */\r\n  static validateTransaction(\r\n    amount: number,\r\n    operationType: 'transfer' | 'withdraw' | 'deposit',\r\n    currentCashBalance: number,\r\n    currentWalletBalances: WalletBalance\r\n  ): { isValid: boolean; warning?: string; error?: string } {\r\n    if (amount <= 0) {\r\n      return {\r\n        isValid: false,\r\n        error: \"      \"\r\n      };\r\n    }\r\n\r\n    if (operationType === 'transfer') {\r\n      const totalWalletBalance = this.calculateTotalWalletBalance(currentWalletBalances);\r\n      if (totalWalletBalance < amount) {\r\n        return {\r\n          isValid: false,\r\n          error: `    (${totalWalletBalance} )     (${amount} )`\r\n        };\r\n      }\r\n    } else if (operationType === 'withdraw') {\r\n      if (currentCashBalance < amount) {\r\n        return {\r\n          isValid: false,\r\n          error: `     (${currentCashBalance} )     (${amount} )`\r\n        };\r\n      }\r\n    } else if (operationType === 'deposit') {\r\n      const totalWalletBalance = this.calculateTotalWalletBalance(currentWalletBalances);\r\n      if (totalWalletBalance < amount) {\r\n        return {\r\n          isValid: false,\r\n          error: `    (${totalWalletBalance} )     (${amount} )`\r\n        };\r\n      }\r\n    }\r\n\r\n    return { isValid: true };\r\n  }\r\n\r\n  /**\r\n   *        ( )\r\n   * @param amount   \r\n   * @param currentWalletBalances   \r\n   * @param wallets  \r\n   * @returns  \r\n   */\r\n  static getDeductionPreview(\r\n    amount: number, \r\n    currentWalletBalances: WalletBalance, \r\n    wallets: Array<{ id: string; name: string; isDefault?: boolean }>\r\n  ): Array<{ walletId: string; walletName: string; currentBalance: number; deductedAmount: number; newBalance: number }> {\r\n    const preview: Array<{ walletId: string; walletName: string; currentBalance: number; deductedAmount: number; newBalance: number }> = [];\r\n    let remainingAmount = amount;\r\n\r\n    //    \r\n    for (const wallet of wallets) {\r\n      if (remainingAmount <= 0) break;\r\n      \r\n      const currentBalance = currentWalletBalances[wallet.id] || 0;\r\n      const deductAmount = Math.min(Math.max(currentBalance, 0), remainingAmount);\r\n      \r\n      if (deductAmount > 0) {\r\n        preview.push({\r\n          walletId: wallet.id,\r\n          walletName: wallet.name,\r\n          currentBalance,\r\n          deductedAmount: deductAmount,\r\n          newBalance: currentBalance - deductAmount\r\n        });\r\n        remainingAmount -= deductAmount;\r\n      }\r\n    }\r\n\r\n    //       \r\n\r\n    return preview;\r\n  }\r\n}\r\n\r\nexport default WalletCashService;\r\n","// Simple double-beep (\"tin tin\") sound to play on confirmations\r\n// Uses Web Audio API and keeps a singleton AudioContext for reuse\r\n\r\nlet audioCtx: AudioContext | null = null;\r\n\r\nfunction getAudioContext(): AudioContext {\r\n  const AnyWindow = window as any;\r\n  if (!audioCtx) {\r\n    const Ctx = (AnyWindow.AudioContext || AnyWindow.webkitAudioContext);\r\n    audioCtx = new Ctx();\r\n  }\r\n  if (audioCtx.state === 'suspended') {\r\n    // Resume context on user gesture\r\n    audioCtx.resume();\r\n  }\r\n  return audioCtx;\r\n}\r\n\r\nfunction scheduleBeep(ctx: AudioContext, startTime: number, freq: number, durationMs: number) {\r\n  const osc = ctx.createOscillator();\r\n  const gain = ctx.createGain();\r\n  osc.type = 'sine';\r\n  osc.frequency.value = freq;\r\n  osc.connect(gain);\r\n  gain.connect(ctx.destination);\r\n\r\n  const durationSec = durationMs / 1000;\r\n  // soft attack then decay\r\n  gain.gain.setValueAtTime(0.0001, startTime);\r\n  gain.gain.exponentialRampToValueAtTime(0.2, startTime + 0.02);\r\n  gain.gain.exponentialRampToValueAtTime(0.0001, startTime + durationSec);\r\n\r\n  osc.start(startTime);\r\n  osc.stop(startTime + durationSec + 0.02);\r\n}\r\n\r\nexport function playTinTin() {\r\n  try {\r\n    const ctx = getAudioContext();\r\n    const now = ctx.currentTime;\r\n    // First beep\r\n    scheduleBeep(ctx, now, 880, 140);\r\n    // Second beep a short moment later\r\n    scheduleBeep(ctx, now + 0.18, 980, 140);\r\n  } catch (e) {\r\n    // fail silently to avoid breaking UX if audio is unavailable\r\n    // console.warn('Audio playback failed', e);\r\n  }\r\n}\r\n\r\n// --- Vodafone \"Shakshan\" style tone ---\r\n// Approximation using a short noise burst (\"shak\") followed by a brief tone sweep (\"shan\")\r\nfunction scheduleNoiseBurst(ctx: AudioContext, startTime: number, durationMs: number) {\r\n  const durationSec = durationMs / 1000;\r\n  const bufferSize = Math.floor(ctx.sampleRate * durationSec);\r\n  const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);\r\n  const data = buffer.getChannelData(0);\r\n  for (let i = 0; i < bufferSize; i++) {\r\n    // white noise\r\n    data[i] = (Math.random() * 2 - 1) * 0.6;\r\n  }\r\n  const source = ctx.createBufferSource();\r\n  source.buffer = buffer;\r\n\r\n  const filter = ctx.createBiquadFilter();\r\n  filter.type = 'highpass';\r\n  filter.frequency.value = 1500;\r\n  filter.Q.value = 0.7;\r\n\r\n  const gain = ctx.createGain();\r\n  gain.gain.setValueAtTime(0.0001, startTime);\r\n  gain.gain.exponentialRampToValueAtTime(0.4, startTime + 0.015);\r\n  gain.gain.exponentialRampToValueAtTime(0.0001, startTime + durationSec);\r\n\r\n  source.connect(filter);\r\n  filter.connect(gain);\r\n  gain.connect(ctx.destination);\r\n\r\n  source.start(startTime);\r\n  source.stop(startTime + durationSec + 0.01);\r\n}\r\n\r\nfunction scheduleToneSweep(ctx: AudioContext, startTime: number, startFreq: number, endFreq: number, durationMs: number, type: OscillatorType = 'triangle') {\r\n  const osc = ctx.createOscillator();\r\n  const gain = ctx.createGain();\r\n  osc.type = type;\r\n\r\n  const durationSec = durationMs / 1000;\r\n  osc.frequency.setValueAtTime(startFreq, startTime);\r\n  osc.frequency.linearRampToValueAtTime(endFreq, startTime + durationSec);\r\n\r\n  // gentle attack/decay envelope\r\n  gain.gain.setValueAtTime(0.0001, startTime);\r\n  gain.gain.exponentialRampToValueAtTime(0.25, startTime + 0.02);\r\n  gain.gain.exponentialRampToValueAtTime(0.0001, startTime + durationSec);\r\n\r\n  osc.connect(gain);\r\n  gain.connect(ctx.destination);\r\n\r\n  osc.start(startTime);\r\n  osc.stop(startTime + durationSec + 0.02);\r\n}\r\n\r\nexport function playVodafoneShakshan() {\r\n  try {\r\n    const ctx = getAudioContext();\r\n    const now = ctx.currentTime;\r\n    // \"shak\": short filtered noise burst\r\n    scheduleNoiseBurst(ctx, now, 90);\r\n    // \"shan\": brief downward tone sweep\r\n    scheduleToneSweep(ctx, now + 0.12, 1900, 1100, 180, 'sawtooth');\r\n  } catch (e) {\r\n    // silent fail\r\n  }\r\n}\r\n","/**\r\n *       \r\n * Egyptian wallet number validation utilities\r\n */\r\n\r\n//    \r\nexport type WalletProvider = 'vodafone' | 'orange' | 'etisalat' | 'we';\r\n\r\n//   \r\nexport type ValidationErrorCode = \r\n  | 'INVALID_MSISDN'\r\n  | 'PROVIDER_MISMATCH'\r\n  | 'ALREADY_EXISTS'\r\n  | 'UNAUTHENTICATED'\r\n  | 'RLS_DENIED'\r\n  | 'UNKNOWN';\r\n\r\n//  \r\nexport interface ValidationResult {\r\n  isValid: boolean;\r\n  normalizedMsisdn?: string;\r\n  errorCode?: ValidationErrorCode;\r\n  errorMessage?: string;\r\n}\r\n\r\n//      \r\nconst PROVIDER_PREFIXES: Record<WalletProvider, string> = {\r\n  vodafone: '010',\r\n  orange: '012',\r\n  etisalat: '011',\r\n  we: '015'\r\n};\r\n\r\n/**\r\n *   MSISDN    E.164\r\n * @param rawMsisdn     \r\n * @returns    E.164  null    \r\n */\r\nexport function normalizeEgyptianMsisdn(rawMsisdn: string): string | null {\r\n  if (!rawMsisdn) return null;\r\n\r\n  //      \r\n  let cleaned = rawMsisdn.replace(/[^0-9-]/g, '');\r\n  \r\n  //     \r\n  cleaned = cleaned.replace(/[-]/g, (match) => {\r\n    const arabicDigits = '';\r\n    const englishDigits = '0123456789';\r\n    return englishDigits[arabicDigits.indexOf(match)];\r\n  });\r\n\r\n  //     11    01\r\n  if (cleaned.length !== 11 || !cleaned.startsWith('01')) {\r\n    return null;\r\n  }\r\n\r\n  //   E.164: 01XXXXXXXXX  +201XXXXXXXXX\r\n  return `+20${cleaned.substring(1)}`;\r\n}\r\n\r\n/**\r\n *        \r\n * @param provider   \r\n * @param normalizedMsisdn    E.164\r\n * @returns true       \r\n */\r\nexport function validateProviderMatch(provider: WalletProvider, normalizedMsisdn: string): boolean {\r\n  if (!normalizedMsisdn.startsWith('+201')) return false;\r\n  \r\n  //      ( +201)\r\n  const prefix = normalizedMsisdn.substring(3, 6); // +201XXXXXXXXX  0XX\r\n  const expectedPrefix = PROVIDER_PREFIXES[provider];\r\n  \r\n  return prefix === expectedPrefix;\r\n}\r\n\r\n/**\r\n *      \r\n * @param provider  \r\n * @param rawMsisdn  \r\n * @returns        \r\n */\r\nexport function validateWalletNumber(provider: WalletProvider, rawMsisdn: string): ValidationResult {\r\n  //  \r\n  const normalizedMsisdn = normalizeEgyptianMsisdn(rawMsisdn);\r\n  \r\n  if (!normalizedMsisdn) {\r\n    return {\r\n      isValid: false,\r\n      errorCode: 'INVALID_MSISDN',\r\n      errorMessage: '   .  11    01'\r\n    };\r\n  }\r\n\r\n  //    \r\n  if (!validateProviderMatch(provider, normalizedMsisdn)) {\r\n    const expectedPrefix = PROVIDER_PREFIXES[provider];\r\n    return {\r\n      isValid: false,\r\n      errorCode: 'PROVIDER_MISMATCH',\r\n      errorMessage: `  ${getProviderDisplayName(provider)}     ${expectedPrefix}`\r\n    };\r\n  }\r\n\r\n  return {\r\n    isValid: true,\r\n    normalizedMsisdn\r\n  };\r\n}\r\n\r\n/**\r\n *      \r\n * @param provider  \r\n * @returns   \r\n */\r\nexport function getProviderDisplayName(provider: WalletProvider): string {\r\n  const names: Record<WalletProvider, string> = {\r\n    vodafone: ' ',\r\n    orange: ' ',\r\n    etisalat: ' ',\r\n    we: ' '\r\n  };\r\n  return names[provider];\r\n}\r\n\r\n/**\r\n *       \r\n * @param msisd  \r\n * @returns true     \r\n */\r\nexport function quickValidateMsisdn(msisdn: string): boolean {\r\n  if (!msisdn) return false;\r\n  \r\n  //   \r\n  const cleaned = msisdn.replace(/[^0-9-]/g, '');\r\n  \r\n  //   \r\n  const normalized = cleaned.replace(/[-]/g, (match) => {\r\n    const arabicDigits = '';\r\n    const englishDigits = '0123456789';\r\n    return englishDigits[arabicDigits.indexOf(match)];\r\n  });\r\n\r\n  //   : 11    01\r\n  return /^01[0-9]{9}$/.test(normalized);\r\n}\r\n\r\n/**\r\n *  : 11     010  011  012  015\r\n *      /\r\n */\r\nexport function strictValidateMsisdn(msisdn: string): boolean {\r\n  if (!msisdn) return false;\r\n  const cleaned = msisdn.replace(/[^0-9-]/g, '');\r\n  const normalized = cleaned.replace(/[-]/g, (match) => {\r\n    const arabicDigits = '';\r\n    const englishDigits = '0123456789';\r\n    return englishDigits[arabicDigits.indexOf(match)];\r\n  });\r\n  return /^(010|011|012|015)[0-9]{8}$/.test(normalized);\r\n}\r\n\r\n/**\r\n *      \r\n * @param errorCode  \r\n * @returns   \r\n */\r\nexport function getErrorMessage(errorCode: ValidationErrorCode): string {\r\n  const messages: Record<ValidationErrorCode, string> = {\r\n    INVALID_MSISDN: '   .  11    01',\r\n    PROVIDER_MISMATCH: '      ',\r\n    ALREADY_EXISTS: '   ',\r\n    UNAUTHENTICATED: '   ',\r\n    RLS_DENIED: '      ',\r\n    UNKNOWN: '      '\r\n  };\r\n  return messages[errorCode];\r\n}","import React, { useState, useEffect, useLayoutEffect, useRef } from 'react';\r\nimport { useIsMobile } from '@/hooks/use-mobile';\r\nimport { useLocation, useNavigate, useParams } from 'react-router-dom';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Popover, PopoverTrigger, PopoverContent } from '@/components/ui/popover';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from '@/components/ui/dialog';\r\nimport { Label } from '@/components/ui/label';\r\nimport { ArrowUpDown, Plus, Minus, CheckCircle, Clock, XCircle, Phone, DollarSign, Wallet, ArrowDownLeft, ArrowUpRight, Trash2, Edit, LogOut, Settings, Banknote, RefreshCw, Search, Calendar, Download, Calculator, BarChart, Crown, MessageCircle, FileText, Receipt, CreditCard, Eye, User, Wrench, BatteryCharging, ChevronDown, ChevronUp, AlertTriangle, Store, Notebook, BadgePercent } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport WalletManagement from '@/components/WalletManagement';\r\nimport TransactionDetailsModal from '@/components/TransactionDetailsModal';\r\nimport ReceiptModal from '@/components/ReceiptModal';\r\n// import { SecretPinDialog } from '@/components/SecretPinDialog';\r\nimport { EditBalanceDialog } from '@/components/EditBalanceDialog';\r\nimport { ChangePinDialog } from '@/components/ChangePinDialog';\r\nimport { ChangeCashPinDialog } from '@/components/ChangeCashPinDialog';\r\nimport { ChangeWalletTotalPinDialog } from '@/components/ChangeWalletTotalPinDialog';\r\nimport PasswordConfirmDialog from '@/components/PasswordConfirmDialog';\r\nimport { auth, db } from '@/firebase';\r\nimport { EmailAuthProvider, reauthenticateWithCredential } from 'firebase/auth';\r\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { AddToWalletDialog } from '@/components/AddToWalletDialog';\r\nimport { walletLimitsService } from '@/utils/walletLimitsService';\r\nimport walletDailyLimitsService from '@/utils/walletDailyLimitsService';\r\nimport { reportsService } from '@/utils/reportsService';\r\nimport ProfileIcon from '@/components/ProfileIcon';\r\nimport NotificationBell from '@/components/NotificationBell';\r\nimport LogoLoader from '@/components/LogoLoader';\r\nimport { CalculatorDialog } from '@/components/CalculatorDialog';\r\nimport { SalesDataDialog } from '@/components/SalesDataDialog';\r\nimport { CashSummaryDialog } from '@/components/CashSummaryDialog';\r\nimport CreditCardsDialog from '@/components/CreditCardsDialog';\r\nimport InstallmentModal from '@/components/InstallmentModal';\r\nimport MaintenanceDialog from '@/components/MaintenanceDialog';\r\nimport MachineDailyDialog from '@/components/MachineDailyDialog';\r\nimport FawryMachineIcon from '@/components/icons/FawryMachineIcon';\r\nimport { useDebouncedValue } from '@/hooks/useDebouncedValue';\r\nimport { ProfitEyeButton } from '@/components/ProfitDisplayDialog';\r\nimport { MonthlyProfitEyeButton } from '@/components/MonthlyProfitDisplayDialog';\r\nimport { DailyProfitEyeButton } from '@/components/DailyProfitDisplayDialog';\r\nimport { WalletsManagement } from '@/components/merchant/WalletsManagement';\r\nimport { useShift } from '@/contexts/ShiftContext';\r\nimport CashierShiftModal from '@/components/CashierShiftModal';\r\nimport ShiftProfileDialog from '@/components/ShiftProfileDialog';\r\nimport ChangeLogDialog from '@/components/ChangeLogDialog';\r\nimport ChangeLogFloatingButton from '@/components/ChangeLogFloatingButton';\r\nimport { useShop } from '@/hooks/useShop';\r\n// Firebase imports\r\nimport { userDataService, transactionService, merchantWalletService, auditLogService, dailyReportsArchiveService, telegramNotifier } from '@/integrations/firebase/services';\r\nimport { doc, getDoc, onSnapshot, writeBatch, collection, query as fsQuery, where, getDocs, updateDoc, deleteDoc, addDoc, serverTimestamp, setDoc } from 'firebase/firestore';\r\nimport WalletCashService from '@/utils/walletCashService';\r\nimport { FreeTrialService } from '@/utils/freeTrialService';\r\nimport { getUserSubscription, SubscriptionData, isSubscriptionValid, getDaysRemaining, getPlanDisplayName, formatDate, SubscriptionPlan } from '@/utils/subscriptionService';\r\nimport { MasterPinService } from '@/utils/masterPinService';\r\nimport { playVodafoneShakshan } from '@/utils/sound';\r\nimport { strictValidateMsisdn } from '@/utils/walletValidation';\r\nimport { openUssdDeepLink, sendTransferDeepLink, getUssdCode, getUssdCodeBySender, sendTransferFromWalletDeepLink } from '@/utils/ussdDialer';\r\nimport { walletSelectionPinService } from '@/utils/walletSelectionPinService';\r\nimport { Capacitor } from '@capacitor/core';\r\nimport PinModal from '@/components/PinModal';\r\nimport { backupToGoogleDrive, restoreFromGoogleDrive, saveGoogleBackupToken } from '@/utils/googleDriveBackup';\r\nimport { formatNumberEnglish } from '@/utils/formatters';\r\nimport { Preferences } from '@capacitor/preferences';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\n\r\nasync function waitForOAuthCode(popup: Window): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    const timer = setInterval(() => {\r\n      try {\r\n        const url = popup.location.href;\r\n        if (url.includes('/oauth2/callback') && url.includes('code=')) {\r\n          const u = new URL(url);\r\n          const code = u.searchParams.get('code');\r\n          popup.close();\r\n          clearInterval(timer);\r\n          if (code) return resolve(code);\r\n          return reject(new Error('    '));\r\n        }\r\n      } catch { }\r\n      if (popup.closed) {\r\n        clearInterval(timer);\r\n        reject(new Error('     '));\r\n      }\r\n    }, 500);\r\n  });\r\n}\r\n\r\nasync function exchangeCodeForRefreshToken(code: string, clientId: string, redirectUri: string): Promise<{ access_token: string; refresh_token: string }> {\r\n  const clientSecret = String((import.meta as any)?.env?.VITE_GOOGLE_OAUTH_CLIENT_SECRET || '').trim();\r\n  const body = new URLSearchParams({\r\n    code,\r\n    client_id: clientId,\r\n    grant_type: 'authorization_code',\r\n    redirect_uri: redirectUri,\r\n  });\r\n  if (clientSecret) body.set('client_secret', clientSecret);\r\n  const resp = await fetch('https://oauth2.googleapis.com/token', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n    body: body.toString(),\r\n  });\r\n  const json = await resp.json();\r\n  if (!resp.ok || !json.refresh_token || !json.access_token) throw new Error('    tokens');\r\n  return { access_token: String(json.access_token), refresh_token: String(json.refresh_token) };\r\n}\r\n\r\nasync function fetchGoogleEmail(accessToken: string): Promise<string> {\r\n  const resp = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {\r\n    headers: { Authorization: `Bearer ${accessToken}` },\r\n  });\r\n  const json = await resp.json();\r\n  return String(json?.email || '');\r\n}\r\n\r\nfunction GoogleBackupBar({ userId }: { userId?: string }) {\r\n  const [loading, setLoading] = React.useState<'link' | 'backup' | 'restore' | null>(null);\r\n  const [message, setMessage] = React.useState<string>('');\r\n\r\n  async function linkGoogle() {\r\n    setLoading('link');\r\n    setMessage('');\r\n    try {\r\n      const clientId = String((import.meta as any)?.env?.VITE_GOOGLE_OAUTH_CLIENT_ID || '').trim();\r\n      const redirectUri = window.location.origin + '/oauth2/callback';\r\n      const scope = encodeURIComponent('https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.email');\r\n      const url = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&response_type=code&access_type=offline&prompt=consent&scope=${scope}&redirect_uri=${encodeURIComponent(redirectUri)}`;\r\n      const popup = window.open(url, '_blank', 'width=500,height=600');\r\n      if (!popup) throw new Error('    ');\r\n      const code = await waitForOAuthCode(popup);\r\n      const token = await exchangeCodeForRefreshToken(code, clientId, redirectUri);\r\n      const email = await fetchGoogleEmail(token.access_token);\r\n      const ok = await saveGoogleBackupToken(userId || 'current', email, token.refresh_token);\r\n      setMessage(ok ? '   ' : '   ');\r\n    } catch (e: any) {\r\n      setMessage(e?.message || '  ');\r\n    } finally {\r\n      setLoading(null);\r\n    }\r\n  }\r\n\r\n  async function backup() {\r\n    setLoading('backup');\r\n    setMessage('');\r\n    const res = await backupToGoogleDrive(userId || 'current');\r\n    setMessage(res.ok ? '   ' : (res.error || ' '));\r\n    setLoading(null);\r\n  }\r\n\r\n  async function restore() {\r\n    setLoading('restore');\r\n    setMessage('');\r\n    const res = await restoreFromGoogleDrive(userId || 'current');\r\n    setMessage(res.ok ? '  ' : (res.error || ' '));\r\n    setLoading(null);\r\n  }\r\n\r\n  //             \r\n  return null;\r\n}\r\n\r\ninterface Transaction {\r\n  id: string;\r\n  type: 'send' | 'receive' | 'withdraw';\r\n  senderPhone: string;\r\n  receiverPhone: string;\r\n  amount: number;\r\n  status: 'pending' | 'completed' | 'failed';\r\n  createdAt: Date;\r\n  withdrawnAmount?: number; //  \r\n  sentAmount?: number; //  \r\n  fromWallet?: string; //   \r\n  //    \r\n  senderNumber?: string; //  \r\n  senderName?: string; //    \r\n  shopName?: string; //  \r\n  transferredAmount?: number; //  \r\n  receiverNumber?: string; //  \r\n  withdrawnAmountDetailed?: number; //   \r\n  merchantShopName?: string; //        \r\n  transactionReference?: string; //  \r\n  commission?: number; // \r\n  fee?: number; //   \r\n  notes?: string; //  \r\n  commissionMode?: 'add' | 'deduct';\r\n  totalCharged?: number;\r\n}\r\n\r\ninterface DailyStats {\r\n  date: string;\r\n  totalTransactions: number;\r\n  totalAmount: number;\r\n  totalWithdrawn: number;\r\n  totalSent: number;\r\n}\r\n\r\ninterface MonthlyStats {\r\n  month: string;\r\n  totalTransactions: number;\r\n  totalAmount: number;\r\n  totalWithdrawn: number;\r\n  totalSent: number;\r\n}\r\n\r\ninterface Debt {\r\n  id: string;\r\n  debtorName: string;\r\n  customerId?: string;\r\n  mobile?: string;\r\n  amount: number;\r\n  reason: string;\r\n  status: 'pending' | 'paid';\r\n  createdAt: Date;\r\n  paidAmount?: number;\r\n  partialPayments?: { amount: number; paidAt: Date }[];\r\n}\r\n\r\ninterface Customer {\r\n  id: string;\r\n  name: string;\r\n  mobile: string;\r\n  createdAt: Date;\r\n}\r\n\r\ninterface ShopExpense {\r\n  id: string;\r\n  name: string;\r\n  amount: number;\r\n  notes?: string;\r\n  source: 'cash' | 'wallet' | 'fawry';\r\n  walletId?: string;\r\n  createdAt: Date;\r\n}\r\n\r\ninterface DeficiencyItem {\r\n  id: string;\r\n  name: string;\r\n  quantity: number;\r\n  status: 'pending' | 'purchased';\r\n  createdAt: Date;\r\n}\r\n\r\nconst UserDashboardPage = () => {\r\n  console.log(' UserDashboardPage component is loading...');\r\n\r\n  const { toast } = useToast();\r\n  const formRef = useRef<HTMLDivElement | null>(null);\r\n  const [formTranslateY, setFormTranslateY] = useState(0);\r\n\r\n  //     API\r\n  const submitTopUp = async () => {\r\n    const allowedEmail = 'alkaptin678678@gmail.com';\r\n    const userEmail = auth.currentUser?.email?.toLowerCase();\r\n    if (!userEmail || userEmail !== allowedEmail) {\r\n      toast({ title: ' ', description: '    .' });\r\n      return;\r\n    }\r\n    if (!topupPhone || !topupOperator || !topupAmount) {\r\n      toast({ title: ' ', description: '    ', variant: 'destructive' });\r\n      return;\r\n    }\r\n    try {\r\n      setTopupLoading(true);\r\n      const idToken = await auth.currentUser?.getIdToken();\r\n      const resp = await fetch('/api/topup', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          ...(idToken ? { Authorization: `Bearer ${idToken}` } : {}),\r\n        },\r\n        body: JSON.stringify({\r\n          phone: topupPhone,\r\n          countryCode: 'EG',\r\n          operator: topupOperator,\r\n          amount: Number(topupAmount),\r\n          useLocalAmount: true,\r\n        })\r\n      });\r\n      const data: any = await resp.json().catch(() => ({}));\r\n      if (resp.ok && data?.success) {\r\n        toast({ title: ' ', description: data?.message || '    ' });\r\n        setIsTopUpOpen(false);\r\n        setTopupPhone('');\r\n        setTopupOperator('');\r\n        setTopupAmount('');\r\n      } else {\r\n        toast({ title: ' ', description: data?.message || '    ', variant: 'destructive' });\r\n      }\r\n    } catch (err) {\r\n      console.error('Topup request error:', err);\r\n      toast({ title: '  ', description: '   .  .', variant: 'destructive' });\r\n    } finally {\r\n      setTopupLoading(false);\r\n    }\r\n  };\r\n  const { signOut, user, profile } = useFirebaseAuth();\r\n  const isVodafoneCashUser = ((user?.email || '').toLowerCase() === 'vodafonecash00@gmail.com');\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const params = useParams();\r\n  const { isShiftActive, shiftUser } = useShift();\r\n  const { shopId: shopIdCtx, shopName } = useShop();\r\n  const queryClientHook = useQueryClient();\r\n  const isMobile = useIsMobile();\r\n  //     (Electron)\r\n  const isDesktopApp = (() => {\r\n    try {\r\n      return Boolean((window as any).electronAPI) ||\r\n        (typeof navigator !== 'undefined' && navigator.userAgent.toLowerCase().includes('electron')) ||\r\n        (typeof window !== 'undefined' && window.location && window.location.protocol === 'file:');\r\n    } catch {\r\n      return false;\r\n    }\r\n  })();\r\n  const [isCashierModalOpen, setIsCashierModalOpen] = useState(false);\r\n  const [isShiftProfileOpen, setIsShiftProfileOpen] = useState(false);\r\n  const [isChangeLogOpen, setIsChangeLogOpen] = useState(false);\r\n  const [branchDialogOpen, setBranchDialogOpen] = useState(false);\r\n  const [branches, setBranches] = useState<any[]>([]);\r\n  const [managerNameInput, setManagerNameInput] = useState('');\r\n  const [branchNameInput, setBranchNameInput] = useState('');\r\n  const [loginUsernameInput, setLoginUsernameInput] = useState('');\r\n  const [loginPasswordInput, setLoginPasswordInput] = useState('');\r\n  const [branchLoading, setBranchLoading] = useState(false);\r\n  const [branchLoginOpen, setBranchLoginOpen] = useState(false);\r\n  const [branchLoginTarget, setBranchLoginTarget] = useState<any | null>(null);\r\n  const [branchLoginUsername, setBranchLoginUsername] = useState('');\r\n  const [branchLoginPassword, setBranchLoginPassword] = useState('');\r\n  const [branchAuthLoading, setBranchAuthLoading] = useState(false);\r\n  const [selectedWallet, setSelectedWallet] = useState<string>('');\r\n  useEffect(() => {\r\n    const sid = (params as any)?.shopId;\r\n    if (sid && user?.uid) {\r\n      try {\r\n        const key = `selectedShopId_${user.uid}`;\r\n        localStorage.setItem(key, String(sid));\r\n        window.dispatchEvent(new Event('selectedShopIdChanged'));\r\n      } catch { }\r\n    }\r\n  }, [(params as any)?.shopId, user?.uid]);\r\n  //   ADB      \r\n  const [adbDevices, setAdbDevices] = useState<Array<{ id: string; model?: string; name?: string; type?: string }>>([]);\r\n  const [selectedAdbDeviceId, setSelectedAdbDeviceId] = useState<string | null>(() => {\r\n    try { return localStorage.getItem('cashySelectedDevice') || null; } catch { return null; }\r\n  });\r\n\r\n  // Request SMS Permissions on Mount\r\n  useEffect(() => {\r\n    //      SMS      \r\n    //          .\r\n  }, []);\r\n\r\n  // Sync selected wallet to Capacitor Preferences for Native Receiver\r\n  useEffect(() => {\r\n    const syncWalletToNative = async () => {\r\n      if (selectedWallet) {\r\n        try {\r\n          await Preferences.set({ key: 'selected_wallet_id', value: selectedWallet });\r\n          console.log(' Synced selected_wallet_id to Native:', selectedWallet);\r\n        } catch (e) {\r\n          console.error('Failed to sync wallet to native:', e);\r\n        }\r\n      } else {\r\n        await Preferences.remove({ key: 'selected_wallet_id' });\r\n      }\r\n    };\r\n    syncWalletToNative();\r\n  }, [selectedWallet]);\r\n\r\n  // Sync shopId to Capacitor Preferences for Native Receiver\r\n  useEffect(() => {\r\n    const syncShopIdToNative = async () => {\r\n      if (shopIdCtx) {\r\n        try {\r\n          await Preferences.set({ key: 'shopId', value: shopIdCtx });\r\n          console.log(' Synced shopId to Native:', shopIdCtx);\r\n        } catch (e) {\r\n          console.error('Failed to sync shopId to native:', e);\r\n        }\r\n      }\r\n    };\r\n    syncShopIdToNative();\r\n  }, [shopIdCtx]);\r\n\r\n  const isDeviceConnected = (id?: string) => !!(id && adbDevices.some(d => d.id === id));\r\n\r\n  async function ensureDeviceReadyBeforeSend(): Promise<string | null> {\r\n    const api: any = (window as any).electronAPI;\r\n    const sel = selectedAdbDeviceId || '';\r\n    if (!api || typeof api.sendUssd !== 'function') return null;\r\n    try { /*        */ } catch { }\r\n    if (!sel) {\r\n      toast({ title: '  ', description: '       ', variant: 'destructive' });\r\n      return null;\r\n    }\r\n    if (isDeviceConnected(sel)) return sel;\r\n    //   USB   \r\n    try {\r\n      const usb = adbDevices.find((d: any) => d && d.id && !String(d.id).includes(':'));\r\n      if (usb && usb.id) { setSelectedAdbDeviceId(usb.id); return usb.id; }\r\n    } catch { }\r\n\r\n    const ip = sel.includes(':') ? sel.split(':').slice(0, 2).join(':') : '';\r\n    if (ip && typeof api.connectWifi === 'function') {\r\n      try { await api.connectWifi(ip); } catch { }\r\n      await new Promise(r => setTimeout(r, 250));\r\n      if (isDeviceConnected(sel)) return sel;\r\n    }\r\n\r\n    const base = sel.split(':')[0];\r\n    const wifiCandidate = adbDevices.find(d => (d.id.startsWith(base) || d.id.includes(base)) && d.id.includes(':'));\r\n    if (wifiCandidate?.id) {\r\n      const wifiIp = wifiCandidate.id.split(':').slice(0, 2).join(':');\r\n      if (!isDeviceConnected(wifiCandidate.id) && typeof api.connectWifi === 'function') {\r\n        try { await api.connectWifi(wifiIp); } catch { }\r\n        await new Promise(r => setTimeout(r, 250));\r\n      }\r\n      if (isDeviceConnected(wifiCandidate.id)) {\r\n        setSelectedAdbDeviceId(wifiCandidate.id);\r\n        return wifiCandidate.id;\r\n      }\r\n    }\r\n\r\n    toast({ title: '  ', description: ' Wireless debugging    WiFi   ', variant: 'destructive' });\r\n    return null;\r\n  }\r\n\r\n  useEffect(() => {\r\n    const api: any = (window as any).electronAPI;\r\n    if (api && typeof api.onAdbDevices === 'function') {\r\n      api.onAdbDevices((devices: Array<{ id: string; model?: string; name?: string; type?: string }>) => {\r\n        const list = Array.isArray(devices) ? devices : [];\r\n        setAdbDevices(list);\r\n        //         \r\n        const saved = (() => { try { return localStorage.getItem('cashySelectedDevice') || ''; } catch { return ''; } })();\r\n        if (saved && list.some(d => d.id === saved)) {\r\n          setSelectedAdbDeviceId(saved);\r\n        } else if (list[0]?.id) {\r\n          setSelectedAdbDeviceId((prev) => prev || list[0].id);\r\n        } else {\r\n          setSelectedAdbDeviceId(null);\r\n        }\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  //         \r\n  function sendTransfer(receiverPhone: string, amount: number) {\r\n    try {\r\n      const sw = getSelectedWalletObj?.();\r\n      const senderPhone = sw?.phone || '';\r\n      if (!senderPhone) {\r\n        toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n        return;\r\n      }\r\n      sendTransferFromWalletDeepLink(senderPhone, receiverPhone, amount);\r\n      toast({ title: '   ', description: '     ' });\r\n      setIsPostConfirmPopupOpen(false);\r\n      setIsPinModalOpen(false);\r\n    } catch (err: any) {\r\n      const msg = err?.message || '      ';\r\n      toast({ title: ' ', description: msg, variant: 'destructive' });\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  //           \r\n  const triggerSendTransferCode = async () => {\r\n    if (!lastUSSDTransfer || !lastUSSDTransfer.receiver || !lastUSSDTransfer.amount) {\r\n      toast({\r\n        title: '  ',\r\n        description: '       ',\r\n        variant: 'destructive',\r\n      });\r\n      return;\r\n    }\r\n    const receiver = String(lastUSSDTransfer.receiver);\r\n    const amount = Math.round(Number(lastUSSDTransfer.amount));\r\n    setUssdLoading(true);\r\n    //     :      \r\n    try {\r\n      //    (Android)     USSD  \r\n      if (Capacitor?.isNativePlatform && Capacitor.getPlatform() === 'android') {\r\n        const sw = getSelectedWalletObj?.();\r\n        const senderPhone = sw?.phone || '';\r\n        if (!senderPhone) {\r\n          toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n          setUssdLoading(false);\r\n          return;\r\n        }\r\n        const code = getUssdCodeBySender(senderPhone, receiver, amount);\r\n        if (!code) {\r\n          toast({ title: '  ', description: '    010/011/012/015', variant: 'destructive' });\r\n          setUssdLoading(false);\r\n          return;\r\n        }\r\n        openUssdDeepLink(code);\r\n        toast({ title: '   ', description: '     ' });\r\n        setIsPostConfirmPopupOpen(false);\r\n        setIsPinModalOpen(false);\r\n        return;\r\n      }\r\n\r\n      //      ADB    \r\n      const api: any = (window as any).electronAPI;\r\n      if (api && typeof api.sendUssd === 'function' && selectedAdbDeviceId) {\r\n        const sw = getSelectedWalletObj?.();\r\n        const senderPhone = sw?.phone || '';\r\n        if (!senderPhone) {\r\n          toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n          setUssdLoading(false);\r\n          return;\r\n        }\r\n        const readyId = await ensureDeviceReadyBeforeSend();\r\n        if (!readyId) { setUssdLoading(false); return; }\r\n        const code = getUssdCodeBySender(senderPhone, receiver, amount);\r\n        if (!code) {\r\n          toast({ title: '  ', description: '    010/011/012/015', variant: 'destructive' });\r\n          setUssdLoading(false);\r\n          return;\r\n        }\r\n        try {\r\n          const pick = typeof api.pickSimAutomatically === 'function'\r\n            ? await api.pickSimAutomatically(readyId, senderPhone)\r\n            : { deviceId: readyId, slot: 0 };\r\n          const decoratedId = `${pick.deviceId}:sim${pick.slot}`;\r\n          setLastDecoratedDeviceId(decoratedId);\r\n          await api.sendUssd(decoratedId, code);\r\n        } catch (e1: any) {\r\n          try {\r\n            await api.sendUssd(readyId, code);\r\n          } catch (e2: any) {\r\n            const maybeIp = readyId.includes(':') ? readyId.split(':').slice(0, 2).join(':') : '';\r\n            if (maybeIp && typeof api.connectWifi === 'function') {\r\n              await api.connectWifi(maybeIp);\r\n              await api.sendUssd(readyId, code);\r\n            } else {\r\n              throw e2;\r\n            }\r\n          }\r\n        }\r\n\r\n        toast({ title: '   ', description: '  ' });\r\n        setIsPostConfirmPopupOpen(false);\r\n        setIsPinModalOpen(true);\r\n      } else {\r\n        //           \r\n        //               \r\n        sendTransfer(receiver, amount);\r\n      }\r\n    } catch (e: any) {\r\n      const msg = (e && e.message) ? e.message : '     ';\r\n      const dev = (lastDecoratedDeviceId || selectedAdbDeviceId || ' ');\r\n      toast({ title: '  ', description: `: ${dev}  ${msg}`, variant: 'destructive' });\r\n    } finally {\r\n      setUssdLoading(false);\r\n    }\r\n  };\r\n\r\n\r\n  //   USSD   ADB   electronAPI\r\n  const handleSendUssd = async () => {\r\n    //        :   \r\n    await triggerSendTransferCode();\r\n  };\r\n\r\n  //         \r\n  const handlePinSubmit = async (deviceId: string, pin: string) => {\r\n    const api: any = (window as any).electronAPI;\r\n    try {\r\n      if (api && typeof api.enterPin === 'function' && deviceId) {\r\n        await api.enterPin(deviceId, pin);\r\n        setIsPinModalOpen(false);\r\n        return;\r\n      }\r\n\r\n      //   ADB:  PIN       \r\n      const rawLink = String((profile as any)?.bridgeLink || '').trim();\r\n      const devId = String((profile as any)?.bridgeDeviceId || '').trim() || undefined;\r\n      if (!rawLink) {\r\n        toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n        return;\r\n      }\r\n      const receiverDigits = String((lastUSSDTransfer?.receiver || receiverPhone || '')).replace(/\\D/g, '');\r\n      const amountInt = Math.max(1, Math.round(Number(lastUSSDTransfer?.amount || amount || 0)) || 0);\r\n      const pinDigits = String(pin || '').replace(/\\D/g, '');\r\n      const normalizeLink = (url: string) => {\r\n        let u = (url || '').trim();\r\n        u = u.replace(/\\/+$/, '');\r\n        if (!/^https?:\\/\\//i.test(u)) u = `https://${u}`;\r\n        return u;\r\n      };\r\n      const baseUrl = normalizeLink(rawLink);\r\n      //        PIN    \r\n      setIsPinModalOpen(false);\r\n    } catch (err: any) {\r\n      const msg = err?.message || '     ';\r\n      toast({ title: ' ', description: msg, variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  console.log(' UserDashboardPage - user:', user ? 'exists' : 'null');\r\n\r\n  //    -   \r\n  const [isUserActive, setIsUserActive] = useState<boolean>(true);\r\n  const [isCheckingActivation, setIsCheckingActivation] = useState<boolean>(true);\r\n\r\n  //   \r\n  const [isShopExpensesDialogOpen, setIsShopExpensesDialogOpen] = useState(false);\r\n  const [isShopExpensesPinDialogOpen, setIsShopExpensesPinDialogOpen] = useState(false);\r\n  const [expenseName, setExpenseName] = useState('');\r\n  const [expenseAmount, setExpenseAmount] = useState('');\r\n  const [expenseNotes, setExpenseNotes] = useState('');\r\n  const [expenses, setExpenses] = useState<ShopExpense[]>([]);\r\n  const [isExpenseDeductionChoiceOpen, setIsExpenseDeductionChoiceOpen] = useState(false);\r\n  const [expenseDeductionSource, setExpenseDeductionSource] = useState<'cash' | 'wallet' | 'fawry' | null>(null);\r\n  const [selectedWalletForExpense, setSelectedWalletForExpense] = useState('');\r\n  const [isReceiptsOpen, setIsReceiptsOpen] = useState(false);\r\n  const [isReceiptsDialogOpen, setIsReceiptsDialogOpen] = useState(false);\r\n  const [showActivationModal, setShowActivationModal] = useState<boolean>(false);\r\n\r\n  //  \r\n  const [isDeficienciesDialogOpen, setIsDeficienciesDialogOpen] = useState(false);\r\n  const [deficiencyName, setDeficiencyName] = useState('');\r\n  const [deficiencyQuantity, setDeficiencyQuantity] = useState('');\r\n  const [deficiencies, setDeficiencies] = useState<DeficiencyItem[]>([]);\r\n\r\n  //   \r\n  const [isOnFreeTrial, setIsOnFreeTrial] = useState<boolean>(false);\r\n  const [freeTrialHoursRemaining, setFreeTrialHoursRemaining] = useState<number>(0);\r\n  const [hasUsedFreeTrial, setHasUsedFreeTrial] = useState<boolean>(false);\r\n\r\n  //  \r\n  const [userSubscription, setUserSubscription] = useState<SubscriptionData | null>(null);\r\n  const [isRefreshingSubscription, setIsRefreshingSubscription] = useState<boolean>(false);\r\n\r\n\r\n\r\n  //   useState\r\n  const [senderPhone, setSenderPhone] = useState<string>('');\r\n  const [receiverPhone, setReceiverPhone] = useState('');\r\n  const [amount, setAmount] = useState('');\r\n  const [withdrawNote, setWithdrawNote] = useState('');\r\n  const [withdrawSenderName, setWithdrawSenderName] = useState('');\r\n  //      \r\n  const [isQuickDebtOpen, setIsQuickDebtOpen] = useState(false);\r\n  const [quickDebtName, setQuickDebtName] = useState('');\r\n  const [quickDebtAmount, setQuickDebtAmount] = useState('');\r\n  const [quickDebtNotes, setQuickDebtNotes] = useState('');\r\n  const [quickDebtCustomerId, setQuickDebtCustomerId] = useState<string>('');\r\n  const [quickDebtInfo, setQuickDebtInfo] = useState<{\r\n    debtorName: string;\r\n    amount: number;\r\n    notes?: string;\r\n    customerId?: string;\r\n    mobile?: string;\r\n  } | null>(null);\r\n  const [didCreateQuickDebt, setDidCreateQuickDebt] = useState<boolean>(false);\r\n  const [isWalletsDialogOpen, setIsWalletsDialogOpen] = useState<boolean>(false);\r\n  const [isWalletsPinDialogOpen, setIsWalletsPinDialogOpen] = useState<boolean>(false);\r\n  // PIN gating for changing selected wallet\r\n  const [isWalletSelectionPinDialogOpen, setIsWalletSelectionPinDialogOpen] = useState<boolean>(false);\r\n  const [pendingSelectedWalletId, setPendingSelectedWalletId] = useState<string | null>(null);\r\n  const [manualCommission, setManualCommission] = useState(''); //    \r\n  const [transferCommission, setTransferCommission] = useState(''); //    \r\n  const [transferExtraFee, setTransferExtraFee] = useState(''); //      (010011)\r\n  const [isMonthlyLimitWarnOpen, setIsMonthlyLimitWarnOpen] = useState(false);\r\n  const [selectedQuickIcon, setSelectedQuickIcon] = useState<string | null>(null);\r\n  const [monthlyLimitWarnData, setMonthlyLimitWarnData] = useState<{ type: 'withdraw' | 'transfer'; used: number; limit: number; walletName: string } | null>(null);\r\n  const [isWithdrawSenderNameInputEnabled, setIsWithdrawSenderNameInputEnabled] = useState<boolean>(false);\r\n  useEffect(() => {\r\n    const loadSetting = async () => {\r\n      try {\r\n        const key = user?.uid ? `withdrawSenderNameInputEnabled_${user?.uid}` : 'withdrawSenderNameInputEnabled';\r\n        let v: string | null = null;\r\n        try { v = localStorage.getItem(key) ?? localStorage.getItem('withdrawSenderNameInputEnabled'); } catch {}\r\n        if (user?.uid) {\r\n          try {\r\n            const data = await withRetry(() => userDataService.getUserData(user.uid));\r\n            const remote: any = (data as any)?.withdrawSenderNameInputEnabled;\r\n            if (typeof remote === 'boolean') {\r\n              setIsWithdrawSenderNameInputEnabled(remote);\r\n              try { localStorage.setItem(key, remote ? 'true' : 'false'); } catch {}\r\n              return;\r\n            }\r\n          } catch {}\r\n        }\r\n        setIsWithdrawSenderNameInputEnabled(v === 'true' ? true : false);\r\n      } catch {\r\n        setIsWithdrawSenderNameInputEnabled(false);\r\n      }\r\n    };\r\n    loadSetting();\r\n  }, [user?.uid]);\r\n  // Helper: normalize Arabic/Persian digits to ASCII\r\n  const normalizeDigits = (s: string) => {\r\n    const arabicIndic = '';\r\n    const easternIndic = '';\r\n    return (s || '').split('').map(ch => {\r\n      const ai = arabicIndic.indexOf(ch);\r\n      if (ai > -1) return String(ai);\r\n      const ei = easternIndic.indexOf(ch);\r\n      if (ei > -1) return String(ei);\r\n      return ch;\r\n    }).join('');\r\n  };\r\n\r\n  // Prefill latest pending SMS into withdraw form\r\n  const normalizeToLocalMsisdn = (input: string): string => {\r\n    const digits = normalizeDigits(input || '').replace(/\\D/g, '');\r\n    if (!digits) return '';\r\n    // Handle common Egypt formats: 201XXXXXXXXX, +201XXXXXXXXX, 010XXXXXXXXX, 011, 012, 015\r\n    if (digits.startsWith('201') && digits.length === 12) {\r\n      // 2010XXXXXXXX -> 010XXXXXXXX\r\n      return '0' + digits.slice(2);\r\n    }\r\n    if (digits.startsWith('00201') && digits.length === 14) {\r\n      return '0' + digits.slice(4);\r\n    }\r\n    if (digits.startsWith('01') && digits.length === 11) {\r\n      return digits;\r\n    }\r\n    // Fallback: return original digits; matching will be by digits only\r\n    return digits;\r\n  };\r\n\r\n  const prefillFromLatest = async () => {\r\n    try {\r\n      const res = await fetch('/api/pending_sms');\r\n      if (!res.ok) throw new Error('   /api/pending_sms');\r\n      const data = await res.json();\r\n      if (!Array.isArray(data) || data.length === 0) {\r\n        toast({ title: '  ', description: '  SMS  ' });\r\n        return;\r\n      }\r\n      const s = data[0] || {};\r\n      const rawMsisdn = (s.msisdn || s.address || '') as string;\r\n      const localMsisdn = normalizeToLocalMsisdn(rawMsisdn);\r\n\r\n      // Try to select wallet by msisdn\r\n      if (localMsisdn) {\r\n        const targetDigits = localMsisdn.replace(/\\D/g, '');\r\n        const found = wallets.find(w => normalizeDigits(w.phone || '').replace(/\\D/g, '') === targetDigits);\r\n        if (found) {\r\n          setWalletSelection(found.id, 'prefillFromLatest');\r\n        }\r\n      }\r\n\r\n      // Fill amount\r\n      const rawAmount = (s.amount ?? s.value ?? s.amountEgp ?? '') as any;\r\n      let nextAmount = '';\r\n      if (typeof rawAmount === 'number') {\r\n        nextAmount = String(rawAmount);\r\n      } else if (typeof rawAmount === 'string' && rawAmount.trim() !== '') {\r\n        const parsed = parseFloat(normalizeDigits(rawAmount).replace(/[^0-9.]/g, ''));\r\n        if (!Number.isNaN(parsed)) nextAmount = String(parsed);\r\n      } else if ((s.message || s.body)) {\r\n        const msg = normalizeDigits(String(s.message || s.body));\r\n        const m = msg.match(/([0-9]+(?:\\.[0-9]+)?)/);\r\n        if (m) nextAmount = m[1];\r\n      }\r\n      setAmount(nextAmount || '');\r\n      setTransactionType('withdraw');\r\n      toast({ title: '  ', description: '       SMS' });\r\n    } catch (err: any) {\r\n      toast({ title: '  ', description: err?.message || '  ', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  const [isCommissionAddMode, setIsCommissionAddMode] = useState<boolean>(() => {\r\n    try {\r\n      const v = localStorage.getItem('commissionMode') || localStorage.getItem('commissionMode_default');\r\n      return v ? v === 'add' : true; // :  \r\n    } catch { return true; }\r\n  });\r\n  const [transactionType, setTransactionType] = useState<'transfer' | 'withdraw'>('transfer');\r\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n  const [activeTab, setActiveTab] = useState('all');\r\n  const [debts, setDebts] = useState<Debt[]>([]);\r\n\r\n  const recentTransactionsQuery = useQuery({\r\n    enabled: !!user?.uid,\r\n    queryKey: ['recentTransactions', user?.uid, (shopIdCtx || 'main')],\r\n    queryFn: async () => {\r\n      const { collection, query, where, orderBy, limit, getDocs } = await import('firebase/firestore');\r\n      const { db } = await import('@/firebase');\r\n      const q = query(\r\n        collection(db, 'userTransactions'),\r\n        where('userId', '==', String(user?.uid || '')),\r\n        orderBy('createdAt', 'desc'),\r\n        limit(100)\r\n      );\r\n      const snap = await getDocs(q);\r\n      const items = snap.docs.map((d) => {\r\n        const data: any = d.data();\r\n        const created = data.createdAt?.toDate ? data.createdAt.toDate() : new Date(data.createdAt);\r\n        const rawType = String(data.transactionType || data.txnType || data.type || '').toLowerCase();\r\n        const type = rawType === 'withdraw' || rawType === 'receive' ? 'withdraw' : 'send';\r\n        const status = data.status === 'confirmed' ? 'completed' : (data.status || 'completed');\r\n        const senderPhone = data.senderMsisdn || data.senderPhone || '';\r\n        const receiverPhone = data.receiverMsisdn || data.receiverPhone || '';\r\n        const amount = Number(data.amount ?? data.transferredAmount ?? data.withdrawnAmount ?? 0);\r\n        return { id: d.id, ...data, type, status, senderPhone, receiverPhone, amount, createdAt: created };\r\n      });\r\n      const filtered = items.filter((t: any) => !(t?.type === 'report' || String((t as any)?.title || '').includes('  ')));\r\n      const deletedIds = new Set<string>((deletedTransactions || []).map((dt: any) => String(dt.id || dt.originalTransactionId || '')));\r\n      const active = filtered.filter((t: any) => !deletedIds.has(String(t.id || '')));\r\n      const getKey = (t: any) => String(\r\n        (t as any).transactionId || t.id || (t as any).reference || ((t as any).receipt?.reference) || `${new Date(t.createdAt).getTime()}`\r\n      );\r\n      const seen = new Set<string>();\r\n      const distinct: any[] = [];\r\n      for (const t of active) {\r\n        const key = getKey(t);\r\n        if (!seen.has(key)) { seen.add(key); distinct.push(t); }\r\n      }\r\n      return distinct;\r\n    },\r\n    staleTime: 60_000,\r\n    gcTime: 300_000,\r\n    refetchOnWindowFocus: false,\r\n    refetchOnReconnect: true,\r\n  });\r\n\r\n  useEffect(() => {\r\n    const data = recentTransactionsQuery.data as any[] | undefined;\r\n    if (data && Array.isArray(data)) {\r\n      setTransactions(data as any);\r\n    }\r\n  }, [recentTransactionsQuery.data]);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      //        \r\n      localStorage.setItem('commissionMode', isCommissionAddMode ? 'add' : 'deduct');\r\n      if (user?.uid) {\r\n        const key = `commissionMode_${user.uid}`;\r\n        localStorage.setItem(key, isCommissionAddMode ? 'add' : 'deduct');\r\n      }\r\n    } catch { }\r\n  }, [isCommissionAddMode, user?.uid]);\r\n\r\n  //     \"\"    :          \"\"\r\n  useEffect(() => {\r\n    try {\r\n      const completedDebtIds = new Set<string>(\r\n        (transactions || [])\r\n          .filter((t: any) => String(t?.status || '') === 'completed' && t?.linkedDebtId)\r\n          .map((t: any) => String(t.linkedDebtId))\r\n      );\r\n      if (completedDebtIds.size === 0) return;\r\n      const updated = debts.map((d) => {\r\n        if (completedDebtIds.has(String(d.id))) {\r\n          const amt = Number(d.amount || 0);\r\n          const paid = Number(d.paidAmount || 0);\r\n          if (d.status !== 'paid' || paid < amt) {\r\n            return { ...d, status: 'paid' as const, paidAmount: amt };\r\n          }\r\n        }\r\n        return d;\r\n      });\r\n      const changed = updated.some((d, i) => d !== debts[i]);\r\n      if (changed) {\r\n        setDebts(updated);\r\n        (async () => { await saveDebtsToStorage(updated); })();\r\n        try {\r\n          if (user?.uid) {\r\n            const newlyPaid = updated.filter((d, i) => d !== debts[i] && d.status === 'paid');\r\n            newlyPaid.forEach((dp) => { try { telegramNotifier.send(user.uid!, `     ${dp.debtorName}:  ${Number(dp.paidAmount || dp.amount || 0)} `); } catch {} });\r\n          }\r\n        } catch {}\r\n      }\r\n    } catch { }\r\n  }, [transactions, debts, user?.uid]);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const userVal = user?.uid ? localStorage.getItem(`commissionMode_${user.uid}`) : null;\r\n      const globalVal = localStorage.getItem('commissionMode');\r\n      const defVal = localStorage.getItem('commissionMode_default');\r\n      const v = userVal ?? globalVal ?? defVal;\r\n      if (v) setIsCommissionAddMode(v === 'add');\r\n    } catch { }\r\n  }, [user?.uid]);\r\n\r\n  //    \r\n  const [isSalesDataOpen, setIsSalesDataOpen] = useState(false);\r\n  const [pendingBarcode, setPendingBarcode] = useState<string | null>(null);\r\n  const barcodeBufferRef = React.useRef<string>('');\r\n  const lastKeyTimeRef = React.useRef<number>(0);\r\n\r\n  //        \r\n  useEffect(() => {\r\n    const handler = (e: KeyboardEvent) => {\r\n      if (isSalesDataOpen) return;\r\n      //   Enter      /\r\n      try {\r\n        const active = document.activeElement as HTMLElement | null;\r\n        if (active) {\r\n          const tag = active.tagName?.toLowerCase();\r\n          const isTyping = (\r\n            tag === 'input' ||\r\n            tag === 'textarea' ||\r\n            tag === 'select' ||\r\n            tag === 'button' ||\r\n            active.isContentEditable === true\r\n          );\r\n          if (isTyping) return;\r\n        }\r\n      } catch { }\r\n      const now = Date.now();\r\n      if (e.key === 'Enter') {\r\n        const code = (barcodeBufferRef.current || '').trim();\r\n        barcodeBufferRef.current = '';\r\n        if (code) {\r\n          setPendingBarcode(code);\r\n          setIsSalesDataOpen(true);\r\n        }\r\n        return;\r\n      }\r\n      if (e.key.length === 1) {\r\n        if (now - (lastKeyTimeRef.current || 0) > 100) {\r\n          barcodeBufferRef.current = '';\r\n        }\r\n        barcodeBufferRef.current += e.key;\r\n        lastKeyTimeRef.current = now;\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handler as unknown as EventListener);\r\n    return () => window.removeEventListener('keydown', handler as unknown as EventListener);\r\n  }, [isSalesDataOpen]);\r\n  const [isWalletManagementOpen, setIsWalletManagementOpen] = useState(false);\r\n  const [editingWalletForDropdown, setEditingWalletForDropdown] = useState<any | null>(null);\r\n\r\n  //        (/)\r\n  useEffect(() => {\r\n    if (!isQuickDebtOpen) return;\r\n    const sw = getSelectedWalletObj();\r\n    const baseAmount = parseFloat(amount || '0') || 0;\r\n    let commissionCalc = 0;\r\n\r\n    if (transactionType === 'transfer') {\r\n      if (sw?.defaultTransferCommission != null) {\r\n        const ratePerThousand = Number(sw.defaultTransferCommission) || 0;\r\n        commissionCalc = Math.round(((ratePerThousand * baseAmount) / 1000) * 100) / 100;\r\n      } else {\r\n        const manual = transferCommission && transferCommission.trim() !== '' ? parseFloat(transferCommission) : 0;\r\n        commissionCalc = Math.max(0, manual);\r\n      }\r\n      const debtAmount = baseAmount + commissionCalc; // :   \r\n      setQuickDebtAmount((debtAmount || 0).toString());\r\n    } else {\r\n      // \r\n      if (sw?.defaultWithdrawCommission != null) {\r\n        const ratePerThousand = Number(sw.defaultWithdrawCommission) || 0;\r\n        commissionCalc = Math.round(((ratePerThousand * baseAmount) / 1000) * 100) / 100;\r\n      } else {\r\n        const manual = manualCommission && manualCommission.trim() !== '' ? parseFloat(manualCommission) : Math.round((baseAmount * 0.01) * 100) / 100;\r\n        commissionCalc = Math.max(0, manual);\r\n      }\r\n      const debtAmount = isCommissionAddMode\r\n        ? baseAmount\r\n        : Math.max(0, Math.round((baseAmount - commissionCalc) * 100) / 100);\r\n      setQuickDebtAmount((debtAmount || 0).toString());\r\n    }\r\n  }, [isQuickDebtOpen, amount, transferCommission, manualCommission, selectedWallet, isCommissionAddMode, transactionType]);\r\n\r\n  //        fallback   \r\n  const getSelectedWalletObj = () => {\r\n    let sw = wallets.find((w: any) => w.id === selectedWallet);\r\n    if (!sw) {\r\n      try {\r\n        const savedWalletsStr = localStorage.getItem(getWalletsKey());\r\n        if (savedWalletsStr) {\r\n          const parsedWallets = JSON.parse(savedWalletsStr);\r\n          if (Array.isArray(parsedWallets) && parsedWallets.length > 0) {\r\n            const savedSelected = localStorage.getItem(getSelectedWalletKey());\r\n            const candidateId = savedSelected || parsedWallets.find((w: any) => w.isDefault)?.id || parsedWallets[0]?.id;\r\n            sw = parsedWallets.find((w: any) => w.id === candidateId);\r\n          }\r\n        }\r\n      } catch (e) {\r\n        //        \r\n      }\r\n    }\r\n    return sw;\r\n  };\r\n  //             \r\n  useLayoutEffect(() => {\r\n    try {\r\n      //          user\r\n      const preferredKey = `wallets_${user?.uid || 'default'}`;\r\n      let savedWalletsStr = localStorage.getItem(preferredKey);\r\n      if (!savedWalletsStr) {\r\n        const anyWalletKey = Object.keys(localStorage).find(k => k.startsWith('wallets_'));\r\n        if (anyWalletKey) {\r\n          savedWalletsStr = localStorage.getItem(anyWalletKey) || null;\r\n        }\r\n      }\r\n      if (savedWalletsStr) {\r\n        const parsedWallets = JSON.parse(savedWalletsStr);\r\n        if (Array.isArray(parsedWallets) && parsedWallets.length > 0) {\r\n          //        \r\n          setWallets(parsedWallets);\r\n          const savedSelected = localStorage.getItem(getSelectedWalletKey());\r\n          const walletToSelect =\r\n            (savedSelected && parsedWallets.find((w: any) => w.id === savedSelected)) ||\r\n            parsedWallets.find((w: any) => w.isDefault) ||\r\n            parsedWallets[0];\r\n          if (walletToSelect) {\r\n            setSelectedWallet(walletToSelect.id);\r\n            setSenderPhone(walletToSelect.phone);\r\n          }\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error('      :', e);\r\n    }\r\n    //       \r\n  }, []);\r\n\r\n  // Add logging for selectedWallet state changes\r\n  useEffect(() => {\r\n    console.log(' selectedWallet state changed to:', selectedWallet);\r\n  }, [selectedWallet]);\r\n\r\n  //           \r\n  useEffect(() => {\r\n    loadExpensesFromStorage();\r\n  }, [user?.uid]);\r\n\r\n  //     \r\n  useEffect(() => {\r\n    loadDeficienciesFromStorage();\r\n  }, []);\r\n\r\n  const [wallets, setWallets] = useState<Array<{ id: string, name: string, phone: string, isDefault: boolean, monthlyWithdrawalLimit?: number, monthlyTransferLimit?: number, defaultTransferCommission?: number | null, defaultWithdrawCommission?: number | null }>>(() => {\r\n    try {\r\n      const anyWalletKey = Object.keys(localStorage).find(k => k.startsWith('wallets_'));\r\n      const savedWalletsStr = anyWalletKey ? localStorage.getItem(anyWalletKey) : null;\r\n      if (savedWalletsStr) {\r\n        const parsedWallets = JSON.parse(savedWalletsStr);\r\n        if (Array.isArray(parsedWallets)) {\r\n          return parsedWallets;\r\n        }\r\n      }\r\n    } catch { }\r\n    return [];\r\n  });\r\n\r\n  const walletsQuery = useQuery({\r\n    enabled: !!user?.uid,\r\n    queryKey: ['wallets', user?.uid],\r\n    queryFn: async () => {\r\n      const { merchantWalletService } = await import('@/integrations/firebase/services');\r\n      const list: any[] = await merchantWalletService.getByMerchantId(String(user?.uid || ''));\r\n      const actives = (Array.isArray(list) ? list : []).filter((w: any) => (w as any).isActive === true);\r\n      return actives.map((w: any) => ({\r\n        id: w.id,\r\n        name: w.label || '  ',\r\n        phone: w.msisdn,\r\n        isDefault: !!(w as any).isDefault,\r\n        monthlyWithdrawalLimit: (w.monthlyWithdrawalLimit ?? w.withdrawLimit ?? 200000),\r\n        monthlyTransferLimit: (w.monthlyTransferLimit ?? w.transferLimit ?? 200000),\r\n        defaultTransferCommission: (w.defaultTransferCommission != null ? Number(w.defaultTransferCommission) : null),\r\n        defaultWithdrawCommission: (w.defaultWithdrawCommission != null ? Number(w.defaultWithdrawCommission) : null)\r\n      }));\r\n    },\r\n    staleTime: 60_000,\r\n    gcTime: 300_000,\r\n    refetchOnReconnect: true,\r\n  });\r\n\r\n  useEffect(() => {\r\n    const data = walletsQuery.data as any[] | undefined;\r\n    if (data && Array.isArray(data)) {\r\n      setWallets(data as any);\r\n      const savedSelectedWallet = localStorage.getItem(getSelectedWalletKey());\r\n      const hasCurrent = !!(selectedWallet && data.find((w: any) => w.id === selectedWallet));\r\n      if (!hasCurrent) {\r\n        const candidateId = (savedSelectedWallet && data.find((w: any) => w.id === savedSelectedWallet)) ? savedSelectedWallet : (data[0]?.id || '');\r\n        if (candidateId) {\r\n          setSelectedWallet(candidateId);\r\n          const obj = data.find((w: any) => w.id === candidateId);\r\n          setSenderPhone(String(obj?.phone || ''));\r\n        }\r\n      }\r\n    }\r\n  }, [walletsQuery.data]);\r\n\r\n  //       \r\n  const [walletSearch, setWalletSearch] = useState('');\r\n  const filteredWallets = (() => {\r\n    const query = walletSearch.replace(/\\D/g, '');\r\n    if (!query) return wallets;\r\n    return wallets.filter(w => (w.phone || '').replace(/\\D/g, '').includes(query));\r\n  })();\r\n  const [selectedTransaction, setSelectedTransaction] = useState<Transaction | null>(null);\r\n  const [isTransactionDetailsOpen, setIsTransactionDetailsOpen] = useState(false);\r\n  const [isReceiptOpen, setIsReceiptOpen] = useState(false);\r\n  const [receiptTransaction, setReceiptTransaction] = useState<any | null>(null);\r\n  const [dailyStats, setDailyStats] = useState<DailyStats[]>([]);\r\n  const [monthlyStatsArray, setMonthlyStatsArray] = useState<MonthlyStats[]>([]);\r\n\r\n  //  \r\n  const [isResetDialogOpen, setIsResetDialogOpen] = useState(false);\r\n  const [resetType, setResetType] = useState<'daily' | 'monthly'>('daily');\r\n\r\n  //  \r\n  const [deletedTransactions, setDeletedTransactions] = useState<Transaction[]>([]);\r\n  const [isRealtimeActive, setIsRealtimeActive] = useState(false);\r\n  const deletedEffectsAppliedRef = React.useRef<Set<string>>(new Set());\r\n  const limitsRollbackAppliedRef = React.useRef<Set<string>>(new Set());\r\n  const transactionsRef = React.useRef<Transaction[]>([]);\r\n  useEffect(() => { transactionsRef.current = transactions; }, [transactions]);\r\n\r\n  //          \r\n  const applyLocalDeleteEffects = async (tx: Transaction) => {\r\n    try {\r\n      if (!user) return;\r\n      //          \r\n      const cashKey = getCashBalanceKey();\r\n      const walletKey = getWalletBalancesKey();\r\n      const savedCash = localStorage.getItem(cashKey);\r\n      const savedWallets = localStorage.getItem(walletKey);\r\n      let newCashBalance = savedCash ? parseFloat(savedCash) : cashBalance;\r\n      let newWalletBalances: Record<string, number> = savedWallets ? JSON.parse(savedWallets) : { ...walletBalances };\r\n\r\n      const amountVal = Number((tx as any).withdrawnAmount ?? (tx as any).sentAmount ?? (tx as any).transferredAmount ?? tx.amount ?? 0);\r\n\r\n      if ((tx as any).type === 'send' && ((tx as any).fromWallet || selectedWallet)) {\r\n        // :      \r\n        newCashBalance -= amountVal;\r\n        const walletId = (tx as any).fromWallet || selectedWallet!;\r\n        newWalletBalances[walletId] = (newWalletBalances[walletId] || 0) + amountVal;\r\n      } else if ((tx as any).type === 'withdraw' && ((tx as any).fromWallet || selectedWallet)) {\r\n        // :      \r\n        newCashBalance += amountVal;\r\n        const walletId = (tx as any).fromWallet || selectedWallet!;\r\n        newWalletBalances[walletId] = Math.max(0, (newWalletBalances[walletId] || 0) - amountVal);\r\n      }\r\n\r\n      //    \r\n      setCashBalance(newCashBalance);\r\n      setWalletBalances(newWalletBalances);\r\n      localStorage.setItem(cashKey, newCashBalance.toString());\r\n      localStorage.setItem(walletKey, JSON.stringify(newWalletBalances));\r\n\r\n      //      Firebase ( )\r\n      const updateData = {\r\n        cashBalance: newCashBalance,\r\n        walletBalances: newWalletBalances,\r\n        lastUpdated: new Date().toISOString()\r\n      };\r\n      const localDataKey = `userData_${user?.uid}`;\r\n      localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n      try {\r\n        await userDataService.updateUserData(user.uid, updateData);\r\n        localStorage.removeItem(localDataKey);\r\n        setHasLocalDataToSync(false);\r\n      } catch (err) {\r\n        console.warn('    Firebase   ( ):', err);\r\n        setHasLocalDataToSync(true);\r\n      }\r\n\r\n      //    /\r\n      try {\r\n        const walletId = (tx as any).fromWallet || selectedWallet!;\r\n        const limits = await walletDailyLimitsService.getWalletLimits(user.uid, walletId);\r\n        if (limits) {\r\n          const updatedLimits: any = { ...limits };\r\n          if ((tx as any).type === 'send') {\r\n            updatedLimits.dailyTransferUsed = Math.max(0, (limits.dailyTransferUsed || 0) - amountVal);\r\n            updatedLimits.monthlyTransferUsed = Math.max(0, (limits.monthlyTransferUsed || 0) - amountVal);\r\n          } else {\r\n            updatedLimits.dailyWithdrawUsed = Math.max(0, (limits.dailyWithdrawUsed || 0) - amountVal);\r\n            updatedLimits.monthlyWithdrawUsed = Math.max(0, (limits.monthlyWithdrawUsed || 0) - amountVal);\r\n          }\r\n          await walletDailyLimitsService.updateWalletLimits(user.uid, walletId, updatedLimits);\r\n        }\r\n      } catch (e) {\r\n        console.warn('      ():', e);\r\n      }\r\n\r\n      //     /\r\n      try {\r\n        reportsService.removeTransactionEffects(tx as any, user.uid);\r\n      } catch (e) {\r\n        console.warn('     ():', e);\r\n      }\r\n    } catch (e) {\r\n      console.warn('     :', e);\r\n    }\r\n  };\r\n\r\n  //         \r\n  const handleDeleteReceipt = async (transactionId: string) => {\r\n    try {\r\n      const tx = transactions.find(t => t.id === transactionId);\r\n      if (!tx || !user) return;\r\n      const idStr = String(transactionId);\r\n      const refStr = String((tx as any)?.transactionId || (tx as any)?.reference || '');\r\n      const alreadyApplied = deletedEffectsAppliedRef.current.has(idStr) || (refStr && deletedEffectsAppliedRef.current.has(refStr));\r\n\r\n      //        (   Firestore )\r\n      const updatedTransactions = transactions.filter(t => t.id !== transactionId);\r\n      setTransactions(updatedTransactions);\r\n\r\n      //    Firebase   \r\n      try {\r\n        await userDataService.removeUserTransaction(user.uid, transactionId);\r\n        await auditLogService.permanentlyDeleteTransaction(transactionId, user.uid);\r\n      } catch (e) {\r\n        console.warn('        :', e);\r\n      }\r\n      //      \r\n      if (!alreadyApplied) {\r\n        deletedEffectsAppliedRef.current.add(idStr);\r\n        if (refStr) deletedEffectsAppliedRef.current.add(refStr);\r\n        await applyLocalDeleteEffects(tx);\r\n        try { if (user?.uid) userDataService.removeLocalReceiptById(user.uid, transactionId); } catch { }\r\n      }\r\n\r\n      toast({\r\n        title: '  ',\r\n        description: '         .',\r\n      });\r\n\r\n      setIsReceiptOpen(false);\r\n    } catch (err) {\r\n      console.error('   :', err);\r\n      toast({\r\n        title: '   ',\r\n        description: '     .',\r\n        variant: 'destructive',\r\n      });\r\n    }\r\n  };\r\n\r\n  //  :     \r\n  const handleCompleteReceipt = async (transactionId: string) => {\r\n    try {\r\n      const tx = transactions.find(t => t.id === transactionId);\r\n      if (!tx || !user) return;\r\n\r\n      //   : 5   /\r\n      try {\r\n        const plan = userSubscription?.subscription?.planType;\r\n        if (plan === SubscriptionPlan.ZERO) {\r\n          const { dailyOperationCountService } = await import('@/utils/dailyOperationCountService');\r\n          const opType = (tx as any).type === 'send' ? 'transfer' : 'withdraw';\r\n          const res = await dailyOperationCountService.checkAndIncrement(user.uid, opType, 5);\r\n          if (!res.allowed) {\r\n            toast({\r\n              title: '    ',\r\n              description: '   5   /.     .',\r\n              variant: 'destructive',\r\n            });\r\n            return;\r\n          }\r\n        } else if (plan === SubscriptionPlan.TAHWEELA) {\r\n          const { dailyOperationCountService } = await import('@/utils/dailyOperationCountService');\r\n          const opType = (tx as any).type === 'send' ? 'transfer' : 'withdraw';\r\n          const res = await dailyOperationCountService.checkAndIncrementCombined(user.uid, opType, 40);\r\n          if (!res.allowed) {\r\n            toast({\r\n              title: '    ',\r\n              description: '     40  / .',\r\n              variant: 'destructive',\r\n            });\r\n            return;\r\n          }\r\n        }\r\n      } catch (limitErr) {\r\n        console.warn('     :', limitErr);\r\n      }\r\n\r\n      await updateDoc(doc(db, 'userTransactions', transactionId), {\r\n        status: 'completed',\r\n        confirmedAt: new Date()\r\n      });\r\n\r\n      setTransactions(prev => prev.map(t => t.id === transactionId ? { ...t, status: 'completed' } : t));\r\n\r\n      toast({\r\n        title: ' ',\r\n        description: '   .'\r\n      });\r\n\r\n      setIsReceiptOpen(false);\r\n    } catch (err) {\r\n      console.error('   :', err);\r\n      toast({\r\n        title: ' ',\r\n        description: '      .',\r\n        variant: 'destructive'\r\n      });\r\n    }\r\n  };\r\n\r\n  //        \r\n  useEffect(() => {\r\n    if (!user) return;\r\n    try {\r\n      const q = fsQuery(collection(db, 'deletedTransactions'), where('userId', '==', user.uid));\r\n      const unsub = onSnapshot(q, (snap) => {\r\n        snap.docChanges().forEach((change) => {\r\n          if (change.type !== 'added') return;\r\n          const data: any = change.doc.data();\r\n          const originalId = String(data?.originalTransactionId || '');\r\n          const txnId = String(data?.transactionId || '');\r\n          const refId = String(data?.reference || '');\r\n          const key = originalId || txnId || refId || String(change.doc.id);\r\n          if (!key) return;\r\n          if (deletedEffectsAppliedRef.current.has(key)) return;\r\n          deletedEffectsAppliedRef.current.add(key);\r\n          setTransactions((prev) => {\r\n            const tx = prev.find((t) => t.id === originalId);\r\n            if (!tx) return prev; //     \r\n            //     \r\n            (async () => { await applyLocalDeleteEffects(tx); })();\r\n            const updated = prev.filter((t) => t.id !== originalId);\r\n            return updated;\r\n          });\r\n        });\r\n      }, (err) => {\r\n        console.warn('   deletedTransactions:', err);\r\n      });\r\n      return () => unsub();\r\n    } catch (e) {\r\n      console.warn('   deletedTransactions:', e);\r\n    }\r\n  }, [user?.uid]);\r\n\r\n  //    reportsData ( /)  \r\n  useEffect(() => {\r\n    if (!user) return;\r\n    try {\r\n      const ref = doc(db, 'users', user.uid);\r\n      const unsub = onSnapshot(ref, async (snap) => {\r\n        if (!snap.exists()) return;\r\n        const data = snap.data() as any;\r\n        if (!data?.reportsData) return;\r\n        //        \r\n        try {\r\n          await reportsService.syncReportsDataFromFirebase(user.uid);\r\n          //        \r\n          setDailyStats(calculateDailyStats());\r\n        } catch (e) {\r\n          console.warn('  reportsData  :', e);\r\n        }\r\n      }, (err) => {\r\n        console.warn('   users.reportsData:', err);\r\n      });\r\n      return () => unsub();\r\n    } catch (e) {\r\n      console.warn('   users.reportsData:', e);\r\n    }\r\n  }, [user?.uid]);\r\n\r\n  //    \r\n  const [searchPhone, setSearchPhone] = useState('');\r\n  const debouncedSearchPhone = useDebouncedValue(searchPhone, 300);\r\n  const [selectedDate, setSelectedDate] = useState('');\r\n  const [selectedTime, setSelectedTime] = useState('');\r\n  //    \r\n  const [reportSearchPhone, setReportSearchPhone] = useState('');\r\n\r\n  //   \r\n  const [isTransferSuccess, setIsTransferSuccess] = useState(false);\r\n  const [isWithdrawSuccess, setIsWithdrawSuccess] = useState(false);\r\n  const [isPostConfirmPopupOpen, setIsPostConfirmPopupOpen] = useState(false);\r\n  const [postConfirmInfo, setPostConfirmInfo] = useState<{ type: 'transfer' | 'withdraw', amount: number } | null>(null);\r\n  const [lastUSSDTransfer, setLastUSSDTransfer] = useState<{ receiver: string; amount: number } | null>(null);\r\n  const [ussdLoading, setUssdLoading] = useState(false);\r\n  const [isPinModalOpen, setIsPinModalOpen] = useState(false);\r\n  const [lastDecoratedDeviceId, setLastDecoratedDeviceId] = useState<string>('');\r\n  //           \r\n\r\n  //   \r\n  const [isCalculatorOpen, setIsCalculatorOpen] = useState(false);\r\n  const showDesktopQuickIcons = false;\r\n  const [isInstallmentPinOpen, setIsInstallmentPinOpen] = useState(false);\r\n  const [isInstallmentModalOpen, setIsInstallmentModalOpen] = useState(false);\r\n\r\n\r\n  //    \r\n  const [isCreditCardsOpen, setIsCreditCardsOpen] = useState(false);\r\n  //   \r\n  const [isMaintenanceOpen, setIsMaintenanceOpen] = useState(false);\r\n  //    \r\n  const [isMachineDailyDialogOpen, setIsMachineDailyDialogOpen] = useState(false);\r\n\r\n  //          \r\n  const [isMonthlyLocked, setIsMonthlyLocked] = useState<boolean>(true);\r\n  const [areReportsCollapsed, setAreReportsCollapsed] = useState<boolean>(false);\r\n  const [isMonthlyPinDialogOpen, setIsMonthlyPinDialogOpen] = useState<boolean>(false);\r\n  const [isTelegramOpen, setIsTelegramOpen] = useState(false);\r\n  const [telegramChatId, setTelegramChatId] = useState('');\r\n  const [telegramDailyEnabled, setTelegramDailyEnabled] = useState(false);\r\n  const [isVipOpen, setIsVipOpen] = useState(false);\r\n\r\n  //      \r\n  const [isDailyLocked, setIsDailyLocked] = useState<boolean>(() => {\r\n    try {\r\n      const key = user?.uid ? `dailyReportsLockEnabled_${user?.uid}` : 'dailyReportsLockEnabled';\r\n      const v = localStorage.getItem(key) ?? localStorage.getItem('dailyReportsLockEnabled');\r\n      return v === 'true';\r\n    } catch {\r\n      return false;\r\n    }\r\n  });\r\n  const [isDailyPinDialogOpen, setIsDailyPinDialogOpen] = useState<boolean>(false);\r\n  useEffect(() => {\r\n    try {\r\n      const key = user?.uid ? `dailyReportsLockEnabled_${user?.uid}` : 'dailyReportsLockEnabled';\r\n      const v = localStorage.getItem(key) ?? localStorage.getItem('dailyReportsLockEnabled');\r\n      setIsDailyLocked(v === 'true');\r\n    } catch { }\r\n  }, [user?.uid]);\r\n\r\n  //   \r\n  const [isDebtsDialogOpen, setIsDebtsDialogOpen] = useState(false);\r\n  const [isDebtsPasswordDialogOpen, setIsDebtsPasswordDialogOpen] = useState(false);\r\n  const [isDebtsPinRequired, setIsDebtsPinRequired] = useState<boolean>(() => {\r\n    try {\r\n      const uid = user?.uid;\r\n      const key = uid ? `debtsPinRequired_${uid}` : 'debtsPinRequired';\r\n      const v = localStorage.getItem(key) ?? localStorage.getItem('debtsPinRequired');\r\n      return v === 'true';\r\n    } catch { return false; }\r\n  });\r\n  const [isDebtsPinToggleOpen, setIsDebtsPinToggleOpen] = useState(false);\r\n  const [pendingDebtsPinValue, setPendingDebtsPinValue] = useState<boolean | null>(null);\r\n  const [debtorName, setDebtorName] = useState('');\r\n  const [debtAmount, setDebtAmount] = useState('');\r\n  const [debtReason, setDebtReason] = useState('');\r\n  const [debtRole, setDebtRole] = useState<'debtor' | 'creditor' | null>(null);\r\n  const [selectedDebt, setSelectedDebt] = useState<Debt | null>(null);\r\n  const [isDebtReceiptOpen, setIsDebtReceiptOpen] = useState(false);\r\n  const [isDebtAdjustDialogOpen, setIsDebtAdjustDialogOpen] = useState<boolean>(false);\r\n  const [debtAdjustType, setDebtAdjustType] = useState<'increase' | 'decrease' | null>(null);\r\n  const [debtAdjustAmount, setDebtAdjustAmount] = useState<string>('');\r\n  const [pendingDebtAdjustment, setPendingDebtAdjustment] = useState<{ debtId: string; delta: number; type: 'increase' | 'decrease' } | null>(null);\r\n  //     \r\n  const [isDebtsPinDialogOpen, setIsDebtsPinDialogOpen] = useState(false);\r\n  //    \r\n  const [isPartialPaymentOpen, setIsPartialPaymentOpen] = useState(false);\r\n  const [partialPaymentAmount, setPartialPaymentAmount] = useState('');\r\n  //    \r\n  const [isDebtReceiptsListOpen, setIsDebtReceiptsListOpen] = useState(false);\r\n  const [debtsPage, setDebtsPage] = useState(1);\r\n  const DEBTS_PAGE_SIZE = isMobile ? 10 : 20;\r\n  const visibleDebts = React.useMemo(() => debts.slice(0, debtsPage * DEBTS_PAGE_SIZE), [debts, debtsPage]);\r\n  useEffect(() => {\r\n    if (isDebtReceiptsListOpen) {\r\n      setDebtsPage(1);\r\n    }\r\n  }, [isDebtReceiptsListOpen]);\r\n\r\n  const openDebts = async () => {\r\n    if (isZeroPlan) {\r\n      toast({ title: ' ', description: ' /     .  .', variant: 'destructive' });\r\n      return;\r\n    }\r\n    try {\r\n      const hasPin = await MasterPinService.hasMasterPin(user?.uid);\r\n      if (isDebtsPinRequired && hasPin) {\r\n        setIsDebtsPasswordDialogOpen(true);\r\n      } else {\r\n        setIsDebtsDialogOpen(true);\r\n      }\r\n    } catch {\r\n      setIsDebtsDialogOpen(true);\r\n    }\r\n  };\r\n\r\n  const handleDebtsPinToggle = (val: boolean) => {\r\n    setPendingDebtsPinValue(val);\r\n    setIsDebtsPinToggleOpen(true);\r\n  };\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const uid = user?.uid;\r\n      const key = uid ? `debtsPinRequired_${uid}` : 'debtsPinRequired';\r\n      const v = localStorage.getItem(key) ?? localStorage.getItem('debtsPinRequired');\r\n      if (v === 'true' || v === 'false') setIsDebtsPinRequired(v === 'true');\r\n    } catch { }\r\n  }, [user?.uid]);\r\n\r\n  useEffect(() => {\r\n    const handler = () => { try { loadDebtsFromStorage(); } catch { } };\r\n    try { window.addEventListener('debtsUpdated', handler as EventListener); } catch { }\r\n    return () => { try { window.removeEventListener('debtsUpdated', handler as EventListener); } catch { } };\r\n  }, [user?.uid, shopIdCtx, profile?.shopId]);\r\n\r\n  //  \r\n  const [isAddCustomerDialogOpen, setIsAddCustomerDialogOpen] = useState(false);\r\n  const [customers, setCustomers] = useState<Customer[]>([]);\r\n  const [newCustomerName, setNewCustomerName] = useState('');\r\n  const [newCustomerMobile, setNewCustomerMobile] = useState('');\r\n  const [selectedCustomerId, setSelectedCustomerId] = useState('');\r\n  const [customerDebtAmount, setCustomerDebtAmount] = useState('');\r\n  const [isEditCustomerDialogOpen, setIsEditCustomerDialogOpen] = useState(false);\r\n  const [editingCustomerId, setEditingCustomerId] = useState<string>('');\r\n  const [editingCustomerName, setEditingCustomerName] = useState<string>('');\r\n  const [editingCustomerMobile, setEditingCustomerMobile] = useState<string>('');\r\n  const [isDeleteCustomerConfirmOpen, setIsDeleteCustomerConfirmOpen] = useState(false);\r\n  const [customerToDeleteId, setCustomerToDeleteId] = useState<string>('');\r\n  const [customerToDeleteName, setCustomerToDeleteName] = useState<string>('');\r\n\r\n  //    \r\n  const [isDebtDeductionChoiceOpen, setIsDebtDeductionChoiceOpen] = useState(false);\r\n  const [pendingDebtToCreate, setPendingDebtToCreate] = useState<Debt | null>(null);\r\n  const [deductionSource, setDeductionSource] = useState<'cash' | 'wallet' | 'none' | null>(null);\r\n  const [selectedWalletForDeduction, setSelectedWalletForDeduction] = useState<string>('');\r\n  //      (  )\r\n  const [isPaymentCreditChoiceOpen, setIsPaymentCreditChoiceOpen] = useState(false);\r\n  const [paymentAmountPending, setPaymentAmountPending] = useState<number>(0);\r\n  const [paymentCreditSource, setPaymentCreditSource] = useState<'cash' | 'wallet' | 'fawry' | 'none' | null>(null);\r\n  const [selectedWalletForPaymentCredit, setSelectedWalletForPaymentCredit] = useState<string>('');\r\n  const [selectedWalletLimits, setSelectedWalletLimits] = useState<any | null>(null);\r\n  const [selectedWalletName, setSelectedWalletName] = useState<string>('');\r\n\r\n  //    \r\n  const saveDebtsToStorage = async (debtsToSave: Debt[]) => {\r\n    try {\r\n      //   localStorage        \r\n      const serialized = JSON.stringify(debtsToSave);\r\n      localStorage.setItem(getDebtsKey(), serialized);\r\n      try { localStorage.setItem(getDebtsDefaultKey(), serialized); } catch { }\r\n      //           \r\n      try { localStorage.setItem(getDebtsLastWriteKey(), Date.now().toString()); } catch { }\r\n\r\n      //   Firebase (     )     \r\n      if (user?.uid) {\r\n        userDataService.updateUserData(user.uid, { debts: debtsToSave })\r\n          .then(() => {\r\n            try { localStorage.removeItem(`debts_unsynced_${user.uid}`); } catch { }\r\n          })\r\n          .catch(() => {\r\n            setHasLocalDataToSync(true);\r\n            try { localStorage.setItem(`debts_unsynced_${user.uid}`, 'true'); } catch { }\r\n          });\r\n      }\r\n    } catch (error) {\r\n      console.error('   :', error);\r\n    }\r\n  };\r\n\r\n  const loadDebtsFromStorage = async () => {\r\n    try {\r\n      // 1)           \r\n      const localUserKey = getDebtsKey();\r\n      const localDefaultKey = getDebtsDefaultKey();\r\n      const localLastWriteKey = getDebtsLastWriteKey();\r\n      const localByUser = localStorage.getItem(localUserKey);\r\n      const localByDefault = localStorage.getItem(localDefaultKey);\r\n      const lastWriteStr = localStorage.getItem(localLastWriteKey);\r\n      const lastWriteMs = lastWriteStr ? Number(lastWriteStr) : 0;\r\n\r\n      const parseDebts = (listStr: string | null) => {\r\n        if (!listStr) return null;\r\n        try {\r\n          const raw = JSON.parse(listStr);\r\n          return Array.isArray(raw)\r\n            ? raw.map((debt: any) => ({\r\n              ...debt,\r\n              createdAt: debt.createdAt?.toDate ? debt.createdAt.toDate() : new Date(debt.createdAt),\r\n              partialPayments: Array.isArray(debt.partialPayments)\r\n                ? debt.partialPayments.map((p: any) => ({\r\n                  amount: Number(p.amount) || 0,\r\n                  paidAt: p.paidAt?.toDate ? p.paidAt.toDate() : new Date(p.paidAt)\r\n                }))\r\n                : []\r\n            }))\r\n            : [];\r\n        } catch (e) {\r\n          console.warn('    localStorage:', e);\r\n          return null;\r\n        }\r\n      };\r\n\r\n      let localDebts: Debt[] | null = parseDebts(localByUser);\r\n      if (!localDebts || localDebts.length === 0) {\r\n        const migrated = parseDebts(localByDefault);\r\n        if (migrated && migrated.length > 0) {\r\n          localDebts = migrated;\r\n          setDebts(migrated);\r\n          //          Firebase    \r\n          try {\r\n            localStorage.setItem(getDebtsKey(), JSON.stringify(migrated));\r\n            localStorage.removeItem(localDefaultKey);\r\n          } catch (e) {\r\n            console.warn('      :', e);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (localDebts && localDebts.length > 0) {\r\n        setDebts(localDebts);\r\n      }\r\n\r\n      // 2)   Firebase           \r\n      if (user?.uid) {\r\n        try {\r\n          const debtsUnsyncedKey = `debts_unsynced_${user.uid}`;\r\n          const hasDebtsUnsynced = localStorage.getItem(debtsUnsyncedKey) === 'true';\r\n          const userDocSnap = await getDoc(doc(db, 'users', user.uid));\r\n          if (userDocSnap.exists()) {\r\n            const userData = userDocSnap.data();\r\n            const fbDebts: Debt[] = userData.debts && Array.isArray(userData.debts)\r\n              ? userData.debts.map((debt: any) => ({\r\n                ...debt,\r\n                amount: Number(debt.amount || 0),\r\n                paidAmount: Number(debt.paidAmount || 0),\r\n                createdAt: debt.createdAt?.toDate ? debt.createdAt.toDate() : new Date(debt.createdAt),\r\n                partialPayments: Array.isArray(debt.partialPayments)\r\n                  ? debt.partialPayments.map((p: any) => ({\r\n                    amount: Number(p.amount) || 0,\r\n                    paidAt: p.paidAt?.toDate ? p.paidAt.toDate() : new Date(p.paidAt)\r\n                  }))\r\n                  : []\r\n              }))\r\n              : [];\r\n\r\n            //              \r\n            const debtsDeletedAt = userData.debtsDeletedAt;\r\n            const remoteMarkedDeleted = !!debtsDeletedAt;\r\n\r\n            if (remoteMarkedDeleted) {\r\n              setDebts([]);\r\n              try {\r\n                localStorage.setItem(localUserKey, JSON.stringify([]));\r\n                localStorage.setItem(localDefaultKey, JSON.stringify([]));\r\n              } catch {}\r\n              return; //   \r\n            }\r\n\r\n            //  :        \r\n            if ((fbDebts?.length || 0) > 0) {\r\n              setDebts(fbDebts);\r\n              try { localStorage.setItem(localUserKey, JSON.stringify(fbDebts)); } catch {}\r\n            } else {\r\n              //  :      \r\n              //         \r\n            }\r\n          } else if (localDebts && localDebts.length > 0) {\r\n            //       \r\n            //             \r\n            //           \r\n          }\r\n        } catch (e) {\r\n          console.warn('    Firebase   :', e);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('   :', error);\r\n    }\r\n  };\r\n\r\n  //           UI\r\n  useEffect(() => {\r\n    try {\r\n      (window as any).exportDebts = () => {\r\n        try { return JSON.stringify(debts || []); } catch { return '[]'; }\r\n      };\r\n      (window as any).importDebts = async (json: string) => {\r\n        try {\r\n          const arr = JSON.parse(json);\r\n          if (!Array.isArray(arr)) throw new Error('       ');\r\n          await saveDebtsToStorage(arr);\r\n          return { ok: true, count: arr.length };\r\n        } catch (e) {\r\n          console.error('  :', e);\r\n          return { ok: false, error: String(e) };\r\n        }\r\n      };\r\n      (window as any).fixWalletsForCurrentUser = async (msisdns: string[]) => {\r\n        try {\r\n          if (!user?.uid) throw new Error('   ');\r\n          const svc = (await import('@/integrations/firebase/services')).merchantWalletService;\r\n          return await svc.reassignByMsisdns(msisdns, user.uid);\r\n        } catch (e) {\r\n          console.error('    :', e);\r\n          return { updated: 0, failed: (msisdns?.length || 0), error: String(e) };\r\n        }\r\n      };\r\n    } catch (e) {\r\n      //     window\r\n    }\r\n  }, [debts, user?.uid]);\r\n\r\n  //       :     \r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n\r\n    const ref = doc(db, 'users', user.uid);\r\n    const unsubscribe = onSnapshot(ref, (docSnap) => {\r\n      if (!docSnap.exists()) return;\r\n      const data = docSnap.data() as any;\r\n      const fbDebtsRaw = Array.isArray(data?.debts) ? data.debts : [];\r\n\r\n      \r\n\r\n      try {\r\n        const parsed: Debt[] = fbDebtsRaw.map((debt: any) => ({\r\n          ...debt,\r\n          createdAt: debt.createdAt?.toDate ? debt.createdAt.toDate() : new Date(debt.createdAt),\r\n          partialPayments: Array.isArray(debt.partialPayments)\r\n            ? debt.partialPayments.map((p: any) => ({\r\n              amount: Number(p.amount) || 0,\r\n              paidAt: p.paidAt?.toDate ? p.paidAt.toDate() : new Date(p.paidAt)\r\n            }))\r\n            : []\r\n        }));\r\n        setDebts(parsed);\r\n        try { localStorage.setItem(getDebtsKey(), JSON.stringify(parsed)); } catch { }\r\n      } catch (e) {\r\n        console.warn('     :', e);\r\n      }\r\n    }, (error) => {\r\n      console.warn('     :', error);\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [user?.uid]);\r\n\r\n\r\n\r\n  //     \r\n  const recheckUserStatus = async () => {\r\n    if (!user?.uid) return;\r\n\r\n    console.log('    ...');\r\n\r\n    try {\r\n      //          \r\n      await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n      const userDoc = await getDoc(doc(db, 'users', user.uid));\r\n      if (userDoc.exists()) {\r\n        const userData = userDoc.data();\r\n        const isActive = userData.isActive === true;\r\n\r\n        //    \r\n        const trialValidity = await FreeTrialService.checkTrialValidity(user.uid);\r\n        const isOnTrial = trialValidity.isValid && !trialValidity.isExpired;\r\n\r\n        console.log('  :', {\r\n          isActive,\r\n          isOnTrial,\r\n          hoursRemaining: trialValidity.hoursRemaining\r\n        });\r\n\r\n        setIsUserActive(isActive || isOnTrial);\r\n        setIsOnFreeTrial(isOnTrial);\r\n        setFreeTrialHoursRemaining(trialValidity.hoursRemaining);\r\n        setHasUsedFreeTrial(trialValidity.hasUsedTrial);\r\n        setShowActivationModal(!isActive && !isOnTrial);\r\n\r\n        console.log('     :', {\r\n          userIsActive: isActive || isOnTrial,\r\n          isOnFreeTrial: isOnTrial\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('     :', error);\r\n    }\r\n  };\r\n\r\n  //      \r\n  const handleTrialStarted = async () => {\r\n    console.log('        ...');\r\n    await recheckUserStatus();\r\n    //      \r\n  };\r\n\r\n  //    \r\n  const fetchSubscriptionData = async () => {\r\n    if (!user?.uid) return;\r\n\r\n    try {\r\n      setIsRefreshingSubscription(true);\r\n      const subscriptionData = await getUserSubscription(user.uid);\r\n      setUserSubscription(subscriptionData);\r\n    } catch (error) {\r\n      console.error('    :', error);\r\n    } finally {\r\n      setIsRefreshingSubscription(false);\r\n    }\r\n  };\r\n\r\n  const [isRefreshing, setIsRefreshing] = useState(false);\r\n  const [isDatePickerOpen, setIsDatePickerOpen] = useState(false);\r\n\r\n  //   \r\n  const MONTHLY_WITHDRAWAL_LIMIT = 200000; //   \r\n  const MONTHLY_TRANSFER_LIMIT = 200000; //   \r\n\r\n  //   \r\n  const [cashBalance, setCashBalance] = useState(0); //    \r\n  const [walletBalances, setWalletBalances] = useState<{ [key: string]: number }>({}); //  \r\n\r\n  //   \r\n  const [isEditCashDialogOpen, setIsEditCashDialogOpen] = useState(false);\r\n  const [isEditWalletDialogOpen, setIsEditWalletDialogOpen] = useState(false);\r\n  const [isAddToWalletDialogOpen, setIsAddToWalletDialogOpen] = useState(false);\r\n  //     \r\n  const [isResetSelectedWalletDialogOpen, setIsResetSelectedWalletDialogOpen] = useState(false);\r\n  const [resetSelectedWalletPinInput, setResetSelectedWalletPinInput] = useState('');\r\n  //    \r\n  const [isResetRecentDialogOpen, setIsResetRecentDialogOpen] = useState(false);\r\n\r\n  //     \r\n  const [isCashAmountDialogOpen, setIsCashAmountDialogOpen] = useState(false);\r\n  const [cashAmountInput, setCashAmountInput] = useState('');\r\n\r\n  //       \r\n  const [isTopUpOpen, setIsTopUpOpen] = useState(false);\r\n  const [topupPhone, setTopupPhone] = useState('');\r\n  const [topupOperator, setTopupOperator] = useState('');\r\n  const [topupAmount, setTopupAmount] = useState<number | ''>('');\r\n  const [topupLoading, setTopupLoading] = useState(false);\r\n  const [isYourReportsOpen, setIsYourReportsOpen] = useState(false);\r\n  const [isReportsPinOpen, setIsReportsPinOpen] = useState(false);\r\n  const [reportArchives, setReportArchives] = useState<any[]>([]);\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        if (!user?.uid || !isYourReportsOpen) return;\r\n        try { await dailyReportsArchiveService.trimToMaxCount(user.uid, 30); } catch { }\r\n        const data = await dailyReportsArchiveService.getByUser(user.uid, 30);\r\n        setReportArchives(data);\r\n      } catch { }\r\n    })();\r\n  }, [user?.uid, isYourReportsOpen]);\r\n\r\n  //     localStorage  \r\n  const getWalletBalancesKey = () => {\r\n    const sid = (shopIdCtx || profile?.shopId || 'main');\r\n    return `walletBalances_${user?.uid || 'default'}_${sid}`;\r\n  };\r\n  const getCashBalanceKey = () => {\r\n    const sid = (shopIdCtx || profile?.shopId || 'main');\r\n    return `cashBalance_${user?.uid || 'default'}_${sid}`;\r\n  };\r\n  const getDebtsKey = () => {\r\n    const sid = (shopIdCtx || profile?.shopId || 'main');\r\n    return `debts_${user?.uid || 'default'}_${sid}`;\r\n  };\r\n  const getCustomersKey = () => {\r\n    const sid = (shopIdCtx || profile?.shopId || 'main');\r\n    return `customers_${user?.uid || 'default'}_${sid}`;\r\n  };\r\n  //         uid  \r\n  const getDebtsDefaultKey = () => {\r\n    const sid = (shopIdCtx || profile?.shopId || 'main');\r\n    return `debts_default_${sid}`;\r\n  };\r\n  //        \r\n  const getDebtsLastWriteKey = () => {\r\n    const sid = (shopIdCtx || profile?.shopId || 'main');\r\n    return `debts_last_write_${user?.uid || 'default'}_${sid}`;\r\n  };\r\n\r\n  // /  \r\n  const getExpensesKey = () => `shopExpenses_${(shopIdCtx || profile?.shopId || user?.uid || 'default')}`;\r\n  const loadExpensesFromStorage = () => {\r\n    try {\r\n      const saved = localStorage.getItem(getExpensesKey());\r\n      if (saved) {\r\n        const parsed = JSON.parse(saved) as ShopExpense[];\r\n        setExpenses(parsed.map(e => ({ ...e, createdAt: new Date(e.createdAt) })));\r\n      }\r\n    } catch (e) {\r\n      console.error('      :', e);\r\n    }\r\n  };\r\n  const saveExpensesToStorage = async (list: ShopExpense[]) => {\r\n    try {\r\n      localStorage.setItem(getExpensesKey(), JSON.stringify(list));\r\n      setExpenses(list);\r\n    } catch (e) {\r\n      console.error('      :', e);\r\n    }\r\n  };\r\n\r\n  //     (    )\r\n  const permanentlyDeleteExpense = async (expenseId: string) => {\r\n    try {\r\n      const remaining = expenses.filter(e => e.id !== expenseId);\r\n      await saveExpensesToStorage(remaining);\r\n\r\n      //   Firestore       \r\n      try {\r\n        if (user?.uid && expenseId) {\r\n          const { doc, deleteDoc } = await import('firebase/firestore');\r\n          const { db } = await import('@/firebase');\r\n          const ref = doc(db, 'shop_expenses', expenseId);\r\n          await deleteDoc(ref);\r\n        }\r\n      } catch (cloudErr) {\r\n        console.warn('             :', cloudErr);\r\n      }\r\n\r\n      toast({ title: ' ', description: '    .' });\r\n    } catch (err) {\r\n      console.error('     :', err);\r\n      toast({ title: ' ', description: '  .   .', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  //      Firestore (          )\r\n  React.useEffect(() => {\r\n    let unsubscribe: (() => void) | undefined;\r\n    (async () => {\r\n      try {\r\n        if (!user?.uid) {\r\n          //            \r\n          loadExpensesFromStorage();\r\n          return;\r\n        }\r\n        const { collection, query, where, onSnapshot } = await import('firebase/firestore');\r\n        const { db } = await import('@/firebase');\r\n        const shopId = shopIdCtx || profile?.shopId;\r\n        //  shopId       userId     \r\n        const q = shopId\r\n          ? query(collection(db, 'shop_expenses'), where('shopId', '==', shopId))\r\n          : query(collection(db, 'shop_expenses'), where('userId', '==', user.uid));\r\n        unsubscribe = onSnapshot(q, async (snap) => {\r\n          const cloudItems: ShopExpense[] = snap.docs.map((d) => {\r\n            const data: any = d.data();\r\n            const created = data.createdAt?.toDate\r\n              ? data.createdAt.toDate()\r\n              : (data.createdAt ? new Date(data.createdAt) : new Date());\r\n            return {\r\n              id: d.id,\r\n              name: String(data.name || ''),\r\n              amount: Number(data.amount || 0),\r\n              notes: data.notes ? String(data.notes) : undefined,\r\n              source: (data.source === 'wallet') ? 'wallet' : 'cash',\r\n              walletId: data.walletId ? String(data.walletId) : undefined,\r\n              createdAt: created,\r\n            };\r\n          });\r\n          //    createdAt        \r\n          const finalList: ShopExpense[] = cloudItems.sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\r\n          setExpenses(finalList);\r\n          //       \r\n          try { localStorage.setItem(getExpensesKey(), JSON.stringify(finalList)); } catch { }\r\n        });\r\n      } catch (e) {\r\n        console.error('      Firestore:', e);\r\n      }\r\n    })();\r\n\r\n    return () => unsubscribe?.();\r\n  }, [user?.uid, profile?.shopId, shopIdCtx]);\r\n\r\n  // / \r\n  const getDeficienciesKey = () => `deficiencies_${(shopIdCtx || profile?.shopId || user?.uid || 'default-shop')}`;\r\n  const loadDeficienciesFromStorage = () => {\r\n    try {\r\n      //        \r\n      const newKey = getDeficienciesKey();\r\n      const oldKey = `deficiencies_${(user?.uid || 'default')}`;\r\n      if (oldKey !== newKey) {\r\n        const oldRaw = localStorage.getItem(oldKey);\r\n        const newRaw = localStorage.getItem(newKey);\r\n        if (oldRaw) {\r\n          try {\r\n            const oldList = JSON.parse(oldRaw) || [];\r\n            const newList = newRaw ? JSON.parse(newRaw) : [];\r\n            const merged = Array.isArray(newList) ? [...newList] : [];\r\n            const has = (arr: any[], item: any) => arr.some((d) => (d?.id && item?.id && String(d.id) === String(item.id)) || (String(d?.name || '') === String(item?.name || '') && String(d?.status || 'pending') === String(item?.status || 'pending')));\r\n            if (Array.isArray(oldList)) {\r\n              for (const it of oldList) { if (!has(merged, it)) merged.push(it); }\r\n            }\r\n            localStorage.setItem(newKey, JSON.stringify(merged));\r\n            try { localStorage.removeItem(oldKey); } catch { }\r\n          } catch { }\r\n        }\r\n      }\r\n\r\n      const saved = localStorage.getItem(newKey);\r\n      if (saved) {\r\n        const parsed = JSON.parse(saved) as DeficiencyItem[];\r\n        setDeficiencies(parsed.map(d => ({ ...d, createdAt: new Date(d.createdAt) })));\r\n      }\r\n    } catch (e) {\r\n      console.error('     :', e);\r\n    }\r\n  };\r\n  const saveDeficienciesToStorage = async (list: DeficiencyItem[]) => {\r\n    try {\r\n      localStorage.setItem(getDeficienciesKey(), JSON.stringify(list));\r\n      setDeficiencies(list);\r\n    } catch (e) {\r\n      console.error('     :', e);\r\n    }\r\n  };\r\n\r\n  //     Firestore  (      )\r\n  React.useEffect(() => {\r\n    let unsubscribe: (() => void) | undefined;\r\n    (async () => {\r\n      try {\r\n        if (!user?.uid) return;\r\n        const { collection, query, where, orderBy, onSnapshot } = await import('firebase/firestore');\r\n        const { db } = await import('@/firebase');\r\n        const currentShopId = (shopIdCtx || profile?.shopId || user.uid || 'default-shop');\r\n        const q = query(collection(db, 'deficiencies'), where('shopId', '==', currentShopId), orderBy('createdAt', 'desc'));\r\n        unsubscribe = onSnapshot(q, async (snap) => {\r\n          const items: DeficiencyItem[] = snap.docs.map((d) => {\r\n            const data: any = d.data();\r\n            const created = data.createdAt?.toDate ? data.createdAt.toDate() : (data.createdAt ? new Date(data.createdAt) : new Date());\r\n            return {\r\n              id: d.id,\r\n              name: String(data.name || ''),\r\n              quantity: Number(data.quantity || 1),\r\n              status: (data.status === 'purchased') ? 'purchased' : 'pending',\r\n              createdAt: created,\r\n            };\r\n          });\r\n          setDeficiencies(items);\r\n          //       \r\n          try { localStorage.setItem(getDeficienciesKey(), JSON.stringify(items)); } catch { }\r\n        }, (err) => {\r\n          console.warn('     Firestore:', err);\r\n        });\r\n      } catch (e) {\r\n        console.warn('     Firestore:', e);\r\n      }\r\n    })();\r\n    return () => { try { if (unsubscribe) { unsubscribe(); } } catch { } };\r\n  }, [user?.uid, profile?.shopId, shopIdCtx]);\r\n\r\n  // / \r\n  const saveCustomersToStorage = async (list: Customer[]) => {\r\n    try {\r\n      localStorage.setItem(getCustomersKey(), JSON.stringify(list));\r\n      setCustomers(list);\r\n      if (user?.uid) {\r\n        await userDataService.updateUserData(user.uid, { customers: list });\r\n      }\r\n    } catch (e) {\r\n      console.error('     :', e);\r\n    }\r\n  };\r\n  const loadCustomersFromStorage = async () => {\r\n    try {\r\n      if (user?.uid) {\r\n        const userDoc = await getDoc(doc(db, 'users', user.uid));\r\n        if (userDoc.exists()) {\r\n          const userData = userDoc.data();\r\n          if (userData.customers && Array.isArray(userData.customers)) {\r\n            const firebaseCustomers = userData.customers.map((c: any) => ({\r\n              ...c,\r\n              createdAt: c.createdAt?.toDate ? c.createdAt.toDate() : new Date(c.createdAt)\r\n            }));\r\n            setCustomers(firebaseCustomers);\r\n            return;\r\n          }\r\n        }\r\n      }\r\n      //      Firestore       \r\n      setCustomers([]);\r\n    } catch (e) {\r\n      console.error('     Firestore:', e);\r\n      //           \r\n    }\r\n  };\r\n  const getTransactionsKey = () => {\r\n    const sid = (shopIdCtx || profile?.shopId || 'main');\r\n    return `transactions_${user?.uid || 'default'}_${sid}`;\r\n  };\r\n  const getDeletedTransactionsKey = () => {\r\n    const sid = (shopIdCtx || profile?.shopId || 'main');\r\n    return `deletedTransactions_${user?.uid || 'default'}_${sid}`;\r\n  };\r\n  const getWalletsKey = () => {\r\n    const sid = (shopIdCtx || profile?.shopId || 'main');\r\n    return `wallets_${user?.uid || 'default'}_${sid}`;\r\n  };\r\n  const getSelectedWalletKey = () => {\r\n    const sid = (shopIdCtx || profile?.shopId || 'main');\r\n    return `selectedWallet_${user?.uid || 'default'}_${sid}`;\r\n  };\r\n\r\n  const loadWalletsFromLocalWithMigration = (): any[] | null => {\r\n    try {\r\n      const currentKey = getWalletsKey();\r\n      const current = localStorage.getItem(currentKey);\r\n      if (current) {\r\n        const parsed = JSON.parse(current);\r\n        if (Array.isArray(parsed) && parsed.length > 0) return parsed;\r\n      }\r\n    } catch (e) {\r\n      console.warn('loadWalletsFromLocalWithMigration failed:', e);\r\n    }\r\n    return null;\r\n  };\r\n\r\n  useEffect(() => {\r\n    let unsubscribe: (() => void) | undefined;\r\n    (async () => {\r\n      try {\r\n        if (!user?.uid) return;\r\n        const { collection, query, where, orderBy, limit, onSnapshot } = await import('firebase/firestore');\r\n        const { db } = await import('@/firebase');\r\n        const q = query(\r\n          collection(db, 'userTransactions'),\r\n          where('userId', '==', user.uid),\r\n          orderBy('createdAt', 'desc'),\r\n          limit(100)\r\n        );\r\n        unsubscribe = onSnapshot(q, (snap) => {\r\n          if (!isRealtimeActive) setIsRealtimeActive(true);\r\n          const items = snap.docs.map((d) => {\r\n            const data: any = d.data();\r\n            const created = data.createdAt?.toDate ? data.createdAt.toDate() : new Date(data.createdAt);\r\n            const type = data.txnType === 'send' ? 'send' : (data.txnType === 'receive' ? 'withdraw' : (data.type || 'withdraw'));\r\n            const status = data.status === 'confirmed' ? 'completed' : (data.status || 'completed');\r\n            const senderPhone = data.senderMsisdn || data.senderPhone || '';\r\n            const receiverPhone = data.receiverMsisdn || data.receiverPhone || '';\r\n            const amount = Number(data.amount ?? data.transferredAmount ?? data.withdrawnAmount ?? 0);\r\n            return { id: d.id, ...data, type, status, senderPhone, receiverPhone, amount, createdAt: created };\r\n          });\r\n          const filtered = items.filter((t: any) => !(t?.type === 'report' || String((t as any)?.title || '').includes('  ')));\r\n          const deletedIds = new Set<string>((deletedTransactions || []).map((dt: any) => String(dt.id || dt.originalTransactionId || '')));\r\n          const active = filtered.filter((t: any) => !deletedIds.has(String(t.id || '')));\r\n          const getKey = (t: any) => String(\r\n            (t as any).transactionId || t.id || (t as any).reference || ((t as any).receipt?.reference) || `${new Date(t.createdAt).getTime()}`\r\n          );\r\n          const seen = new Set<string>();\r\n          const distinct: any[] = [];\r\n          for (const t of active) {\r\n            const key = getKey(t);\r\n            if (!seen.has(key)) {\r\n              seen.add(key);\r\n              distinct.push(t);\r\n            }\r\n          }\r\n          setTransactions(distinct);\r\n        });\r\n      } catch { }\r\n    })();\r\n    return () => { try { unsubscribe && unsubscribe(); } catch { } };\r\n  }, [user?.uid, deletedTransactions.length]);\r\n\r\n  //    deletedTransactions    \r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n    let unsub: (() => void) | null = null;\r\n    (async () => {\r\n      try {\r\n        const { collection, query, where, onSnapshot } = await import('firebase/firestore');\r\n        const { db } = await import('@/firebase');\r\n        const q = query(collection(db, 'deletedTransactions'), where('userId', '==', user.uid));\r\n        unsub = onSnapshot(q, (snap) => {\r\n          try {\r\n            snap.docChanges().forEach((chg) => {\r\n              const data: any = chg.doc.data();\r\n              const keys = [data.originalTransactionId, data.transactionId, data.reference, chg.doc.id].filter(Boolean).map((v: any) => String(v));\r\n              const seenKey = keys.find((k) => limitsRollbackAppliedRef.current.has(k));\r\n              if (seenKey) return;\r\n              const tx = transactionsRef.current.find((t: any) => {\r\n                const id = String(t.id || '');\r\n                const tid = String((t as any).transactionId || '');\r\n                const ref = String((t as any).reference || '');\r\n                return keys.includes(id) || keys.includes(tid) || keys.includes(ref);\r\n              });\r\n              if (tx) {\r\n                const walletId = (tx as any).fromWallet || selectedWallet || '';\r\n                const amt = Number((tx as any).withdrawnAmount ?? (tx as any).sentAmount ?? (tx as any).amount ?? 0);\r\n                const typ = tx.type === 'send' ? 'transfer' : 'withdraw';\r\n                if (walletId && amt > 0) {\r\n                  walletDailyLimitsService.rollbackUsage(walletId, amt, typ).catch(() => { });\r\n                  keys.forEach((k) => limitsRollbackAppliedRef.current.add(k));\r\n                }\r\n              }\r\n            });\r\n            const items = snap.docs.map((d) => {\r\n              const dd: any = d.data();\r\n              const created = dd.createdAt?.toDate ? dd.createdAt.toDate() : new Date(dd.createdAt || Date.now());\r\n              return { id: d.id, ...dd, createdAt: created } as any;\r\n            });\r\n            setDeletedTransactions(items as any);\r\n            (async () => {\r\n              try {\r\n                const sid = (shopIdCtx || profile?.shopId);\r\n                if (!sid) return;\r\n                const dataRef = doc(db, 'dashboardData', sid);\r\n                const snapData = await getDoc(dataRef);\r\n                if (snapData.exists()) {\r\n                  const d: any = snapData.data();\r\n                  if (typeof d.cashBalance === 'number') setCashBalance(Number(d.cashBalance || 0));\r\n                  if (d.walletBalances && typeof d.walletBalances === 'object') setWalletBalances(d.walletBalances || {});\r\n                }\r\n              } catch { }\r\n            })();\r\n          } catch { }\r\n        }, (err) => {\r\n          console.warn('deletedTransactions subscription error (Dashboard):', err);\r\n        });\r\n      } catch { }\r\n    })();\r\n    return () => { try { unsub && unsub(); } catch { } };\r\n  }, [user?.uid]);\r\n\r\n\r\n\r\n  const migrateSelectedWalletKeyIfNeeded = (walletsList: any[]) => {\r\n    try {\r\n      const currentSelectedKey = getSelectedWalletKey();\r\n      const currentSelected = localStorage.getItem(currentSelectedKey);\r\n      if (currentSelected && walletsList.find((w: any) => w.id === currentSelected)) {\r\n        return currentSelected;\r\n      }\r\n    } catch { }\r\n    return null;\r\n  };\r\n\r\n  const [cashPinInput, setCashPinInput] = useState('');\r\n  const [editingWalletId, setEditingWalletId] = useState<string>('');\r\n\r\n  //   /   \r\n  const isShiftHandoverAllowed = React.useMemo(() => {\r\n    const sub = userSubscription; //      \r\n    if (!sub) return false;\r\n    const valid = isSubscriptionValid(sub);\r\n    //      enum   \"plan\"  \r\n    const rawPlan: any = (sub as any).planType ?? (sub as any).plan ?? null;\r\n    const planStr = typeof rawPlan === 'string' ? rawPlan.toLowerCase() : null;\r\n    //        \r\n    const allowedPlan =\r\n      (planStr === 'monthly' || planStr === 'quarterly' || planStr === 'yearly' || planStr === 'lifetime') ||\r\n      (rawPlan === SubscriptionPlan.MONTHLY || rawPlan === SubscriptionPlan.QUARTERLY || rawPlan === SubscriptionPlan.YEARLY || rawPlan === SubscriptionPlan.LIFETIME);\r\n    return valid && allowedPlan;\r\n  }, [userSubscription]);\r\n\r\n  //        \r\n  const isZeroPlan = React.useMemo(() => {\r\n    const sub = userSubscription;\r\n    if (!sub) return false;\r\n    const rawPlan: any = (sub as any).subscription?.planType ?? (sub as any).subscription?.plan ?? (sub as any).planType ?? (sub as any).plan ?? null;\r\n    const planStr = typeof rawPlan === 'string' ? rawPlan.toLowerCase() : null;\r\n    return rawPlan === SubscriptionPlan.ZERO || planStr === 'zero';\r\n  }, [userSubscription]);\r\n\r\n  const isTahweelaPlan = React.useMemo(() => {\r\n    const sub = userSubscription;\r\n    if (!sub) return false;\r\n    const rawPlan: any = (sub as any).subscription?.planType ?? (sub as any).subscription?.plan ?? (sub as any).planType ?? (sub as any).plan ?? null;\r\n    const planStr = typeof rawPlan === 'string' ? String(rawPlan).trim().toLowerCase() : null;\r\n    return rawPlan === SubscriptionPlan.TAHWEELA || planStr === 'tahweela' || planStr === '';\r\n  }, [userSubscription]);\r\n\r\n  const handleOpenShiftProfile = () => {\r\n    if (!isShiftHandoverAllowed) {\r\n      toast({\r\n        title: ' ',\r\n        description: '   :      .   .',\r\n        variant: 'destructive'\r\n      });\r\n      return;\r\n    }\r\n    setIsCashierModalOpen(true);\r\n  };\r\n  const [isEditCashBalanceOpen, setIsEditCashBalanceOpen] = useState(false);\r\n  const [isChangePinDialogOpen, setIsChangePinDialogOpen] = useState(false);\r\n  const [isChangeCashPinDialogOpen, setIsChangeCashPinDialogOpen] = useState(false);\r\n  const [isChangeWalletTotalPinDialogOpen, setIsChangeWalletTotalPinDialogOpen] = useState(false);\r\n\r\n  //     \r\n  const [isAddCashDialogOpen, setIsAddCashDialogOpen] = useState(false);\r\n  const [addCashAmountInput, setAddCashAmountInput] = useState('');\r\n  const [addCashPinInput, setAddCashPinInput] = useState('');\r\n  const [isAddingCash, setIsAddingCash] = useState(false);\r\n  const [addCashNoteEnabled, setAddCashNoteEnabled] = useState<'yes' | 'no' | null>(null);\r\n  const [addCashNoteText, setAddCashNoteText] = useState('');\r\n\r\n  //      PIN\r\n  const [isCashSummaryOpen, setIsCashSummaryOpen] = useState(false);\r\n  const [isCashSummaryPinDialogOpen, setIsCashSummaryPinDialogOpen] = useState(false);\r\n\r\n  //      \r\n  const [isAddWalletTotalDialogOpen, setIsAddWalletTotalDialogOpen] = useState(false);\r\n  const [addWalletTotalAmountInput, setAddWalletTotalAmountInput] = useState('');\r\n  const [addWalletTotalPinInput, setAddWalletTotalPinInput] = useState('');\r\n  const [isAddingWalletTotal, setIsAddingWalletTotal] = useState(false);\r\n\r\n\r\n\r\n\r\n\r\n\r\n  //      Firebase\r\n  const syncLocalDataWithFirebase = async () => {\r\n    if (!user?.uid) return;\r\n\r\n    try {\r\n      const localDataKey = `userData_${user.uid}`;\r\n      const localDataStr = localStorage.getItem(localDataKey);\r\n      const debtsUnsyncedKey = `debts_unsynced_${user.uid}`;\r\n      const localDebtsStr = localStorage.getItem(getDebtsKey());\r\n      const hasDebtsUnsynced = localStorage.getItem(debtsUnsyncedKey) === 'true';\r\n\r\n      if (localDataStr) {\r\n        const localData = JSON.parse(localDataStr);\r\n        console.log('     Firebase...', localData);\r\n\r\n        //     undefined   Firestore\r\n        const payload: any = { lastSynced: new Date().toISOString() };\r\n        if (typeof localData.cashBalance === 'number') {\r\n          payload.cashBalance = localData.cashBalance;\r\n        }\r\n        if (localData.walletBalances && typeof localData.walletBalances === 'object') {\r\n          payload.walletBalances = localData.walletBalances;\r\n        }\r\n\r\n        //     Firebase  \r\n        await userDataService.updateUserData(user.uid, payload);\r\n\r\n        //      \r\n        localStorage.removeItem(localDataKey);\r\n        setHasLocalDataToSync(false);\r\n        console.log('      ');\r\n\r\n        //        \r\n      } else {\r\n        //          \r\n        console.log('     ');\r\n      }\r\n\r\n      //        \r\n      if (hasDebtsUnsynced && localDebtsStr) {\r\n        try {\r\n          const localDebtsRaw = JSON.parse(localDebtsStr) || [];\r\n          const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : (v ? new Date(String(v)) : new Date());\r\n          const normalize = (arr: any[]) => (Array.isArray(arr) ? arr : []).map((d: any) => ({\r\n            ...d,\r\n            amount: Number(d.amount || 0),\r\n            paidAmount: Number(d.paidAmount || 0),\r\n            createdAt: toJsDate(d.createdAt),\r\n            partialPayments: Array.isArray(d.partialPayments)\r\n              ? d.partialPayments.map((p: any) => ({ amount: Number(p.amount || 0), paidAt: toJsDate(p.paidAt) }))\r\n              : []\r\n          }));\r\n          const snap = await getDoc(doc(db, 'users', user.uid));\r\n          const remoteDebtsRaw = snap.exists() ? (((snap.data() as any)?.debts) || []) : [];\r\n          const remoteDebts = normalize(remoteDebtsRaw);\r\n          const localDebts = normalize(localDebtsRaw);\r\n          const byIdRemote: Record<string, any> = {};\r\n          for (const r of remoteDebts) { byIdRemote[String(r.id || '')] = r; }\r\n          const merged: any[] = [];\r\n          const used = new Set<string>();\r\n          for (const ld of localDebts) {\r\n            const id = String(ld.id || '');\r\n            const rd = byIdRemote[id];\r\n            if (rd) {\r\n              const rdPaid = Number(rd.paidAmount || 0) + (Array.isArray(rd.partialPayments) ? rd.partialPayments.reduce((s: number, p: any) => s + Number(p.amount || 0), 0) : 0);\r\n              const ldPaid = Number(ld.paidAmount || 0) + (Array.isArray(ld.partialPayments) ? ld.partialPayments.reduce((s: number, p: any) => s + Number(p.amount || 0), 0) : 0);\r\n              const rdStatus = String(rd.status || 'pending');\r\n              const ldStatus = String(ld.status || 'pending');\r\n              const take = (rdStatus === 'paid' || rdPaid >= Number(rd.amount || 0))\r\n                ? rd\r\n                : (ldStatus === 'paid'\r\n                  ? { ...rd, paidAmount: Number(ld.paidAmount || 0), partialPayments: ld.partialPayments, status: 'paid' }\r\n                  : (ldPaid > rdPaid\r\n                    ? { ...rd, paidAmount: Number(ld.paidAmount || 0), partialPayments: ld.partialPayments, status: (ldPaid >= Number(rd.amount || 0) ? 'paid' : 'pending') }\r\n                    : rd));\r\n              merged.push(take);\r\n              used.add(id);\r\n            } else {\r\n              merged.push(ld);\r\n              used.add(id);\r\n            }\r\n          }\r\n          for (const rd of remoteDebts) {\r\n            const id = String(rd.id || '');\r\n            if (!used.has(id)) merged.push(rd);\r\n          }\r\n          await userDataService.updateUserData(user.uid, { debts: merged });\r\n          try { localStorage.removeItem(debtsUnsyncedKey); } catch { }\r\n          setHasLocalDataToSync(false);\r\n        } catch (e) {\r\n          setHasLocalDataToSync(true);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('    :', error);\r\n      toast({\r\n        title: \"  \",\r\n        description: \"      \",\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  };\r\n\r\n  //      \r\n  const checkForLocalData = () => {\r\n    if (!user?.uid) return;\r\n\r\n    const localDataKey = `userData_${user.uid}`;\r\n    const localDataStr = localStorage.getItem(localDataKey);\r\n    setHasLocalDataToSync(!!localDataStr);\r\n  };\r\n\r\n  //   \r\n  const refreshTransactions = async () => {\r\n    if (!user?.uid) return;\r\n\r\n    setIsRefreshing(true);\r\n    try {\r\n      await loadUserData();\r\n      toast({\r\n        title: \" \",\r\n        description: \"   \",\r\n        variant: \"default\",\r\n      });\r\n    } catch (error) {\r\n      console.error('   :', error);\r\n      toast({\r\n        title: \" \",\r\n        description: \"    \",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsRefreshing(false);\r\n    }\r\n  };\r\n\r\n  //        +      N  \r\n  const [recentResetConfig, setRecentResetConfig] = useState<{ keepLastCount: number; intervalDays: number; lastResetAt: Date | null }>({ keepLastCount: 30, intervalDays: 7, lastResetAt: null });\r\n  useEffect(() => {\r\n    const initWeeklyReset = async () => {\r\n      if (!user?.uid) return;\r\n      try {\r\n        const data = await userDataService.getUserData(user.uid);\r\n        const raw = (data?.recentReset || {}) as any;\r\n        const keep = Number(raw?.keepLastCount) > 0 ? Number(raw.keepLastCount) : 30;\r\n        const interval = Number(raw?.intervalDays) > 0 ? Number(raw.intervalDays) : 7;\r\n        const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : (v ? new Date(String(v)) : null);\r\n        const last: Date | null = raw?.lastResetAt ? toJsDate(raw.lastResetAt) : null;\r\n        const now = new Date();\r\n        const needReset = !last || (now.getTime() - last.getTime()) >= interval * 24 * 60 * 60 * 1000;\r\n        if (needReset) {\r\n          await userDataService.updateUserData(user.uid, { recentReset: { keepLastCount: keep, intervalDays: interval, lastResetAt: now } });\r\n          setRecentResetConfig({ keepLastCount: keep, intervalDays: interval, lastResetAt: now });\r\n        } else {\r\n          setRecentResetConfig({ keepLastCount: keep, intervalDays: interval, lastResetAt: last });\r\n        }\r\n      } catch {\r\n        setRecentResetConfig({ keepLastCount: 30, intervalDays: 7, lastResetAt: null });\r\n      }\r\n    };\r\n    initWeeklyReset();\r\n  }, [user?.uid]);\r\n\r\n  const effectiveTransactions = React.useMemo(() => {\r\n    const base = transactions || [];\r\n    const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : new Date(String(v));\r\n    const now = new Date();\r\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\r\n    const nextMonthStart = new Date(now.getFullYear(), now.getMonth() + 1, 1);\r\n    const sorted = [...base].sort((a: any, b: any) => toJsDate(b.createdAt).getTime() - toJsDate(a.createdAt).getTime());\r\n    return sorted.filter((t: any) => {\r\n      const d = toJsDate(t.createdAt);\r\n      return d >= monthStart && d < nextMonthStart;\r\n    });\r\n  }, [transactions]);\r\n  const hiddenCount = React.useMemo(() => {\r\n    const base = transactions || [];\r\n    const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : new Date(String(v));\r\n    const now = new Date();\r\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\r\n    const nextMonthStart = new Date(now.getFullYear(), now.getMonth() + 1, 1);\r\n    const visibleMonthly = base.filter((t: any) => {\r\n      const d = toJsDate(t.createdAt);\r\n      return d >= monthStart && d < nextMonthStart;\r\n    }).length;\r\n    return Math.max(0, (transactions?.length || 0) - visibleMonthly);\r\n  }, [transactions?.length]);\r\n\r\n  const vipTop10 = React.useMemo(() => {\r\n    const now = new Date();\r\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\r\n    const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 1);\r\n    const items: Record<string, { phone: string; count: number; total: number }> = {};\r\n    for (const t of transactions) {\r\n      const d = new Date((t as any).createdAt || 0);\r\n      if (!(d >= monthStart && d < monthEnd)) continue;\r\n      const type = String((t as any).type || (t as any).txnType || '').toLowerCase();\r\n      if (!(type === 'send' || type === 'withdraw' || type === 'transfer')) continue;\r\n      const phoneRaw = String((t as any).receiverPhone || (t as any).senderPhone || '').trim();\r\n      if (!phoneRaw) continue;\r\n      const phone = formatNumberEnglish(phoneRaw);\r\n      const amount = Number((t as any).amount || (t as any).withdrawnAmount || (t as any).sentAmount || 0) || 0;\r\n      if (!items[phone]) items[phone] = { phone, count: 0, total: 0 };\r\n      items[phone].count += 1;\r\n      items[phone].total += amount;\r\n    }\r\n    const arr = Object.values(items).sort((a, b) => {\r\n      if (b.count !== a.count) return b.count - a.count;\r\n      return b.total - a.total;\r\n    });\r\n    return arr.slice(0, 10);\r\n  }, [transactions]);\r\n\r\n  const toWaNumber = (p: string) => {\r\n    const s = formatNumberEnglish(String(p));\r\n    if (s.startsWith('+20')) return '20' + s.slice(3);\r\n    if (s.startsWith('0')) return '20' + s.slice(1);\r\n    return s.replace(/[^0-9]/g, '');\r\n  };\r\n\r\n  const sendVipWhatsApp = (item: { phone: string; count: number; total: number }) => {\r\n    const num = toWaNumber(item.phone);\r\n    const msg = ` VIP  \\n : ${item.count}\\n: ${item.total} `;\r\n    const url = `https://wa.me/${num}?text=${encodeURIComponent(msg)}`;\r\n    try { window.open(url, '_blank'); } catch { }\r\n  };\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        if (!user?.uid) return;\r\n        const tag = `${new Date().getFullYear()}-${new Date().getMonth() + 1}`;\r\n        await userDataService.updateUserData(user.uid, { vipTop10, vipMonthTag: tag });\r\n      } catch { }\r\n    })();\r\n  }, [user?.uid, vipTop10]);\r\n\r\n  async function composeTelegramDailySummary(): Promise<string> {\r\n    const now = new Date();\r\n    const dateStr = new Intl.DateTimeFormat('ar-EG', { timeZone: 'Africa/Cairo', year: 'numeric', month: '2-digit', day: '2-digit' }).format(now);\r\n    const start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0, 0);\r\n    const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999);\r\n    const txToday = (transactions || []).filter((t: any) => {\r\n      const d = new Date(t.createdAt || 0);\r\n      return d >= start && d <= end;\r\n    });\r\n    const totalOps = txToday.length;\r\n    const totalWithdrawn = txToday\r\n      .filter((t: any) => String(t.type || t.txnType || '').toLowerCase() === 'withdraw' || String(t.type || '').toLowerCase() === 'receive')\r\n      .reduce((s: number, t: any) => s + (t.withdrawnAmount != null ? Number(t.withdrawnAmount) : Number(t.amount || 0)), 0);\r\n    const totalSent = txToday\r\n      .filter((t: any) => String(t.type || t.txnType || '').toLowerCase() === 'send' || String(t.type || '').toLowerCase() === 'transfer')\r\n      .reduce((s: number, t: any) => s + (t.sentAmount != null ? Number(t.sentAmount) : Number(t.amount || 0)), 0);\r\n    let profit = 0;\r\n    try { profit = txToday.reduce((sum: number, t: any) => sum + reportsService.calculateTransactionProfit(t), 0); } catch { }\r\n    let accessoriesSales = 0;\r\n    try {\r\n      const cairoDate = new Intl.DateTimeFormat('en-CA', { timeZone: 'Africa/Cairo' }).format(now);\r\n      const byUser = fsQuery(collection(db, 'dailySales'), where('userId', '==', user?.uid || ''));\r\n      const snap = await getDocs(byUser);\r\n      const list = snap.docs.map(d => d.data() as any).filter(v => String(v.date || cairoDate) === cairoDate);\r\n      accessoriesSales = list.reduce((s, v) => s + Number(v.sellingPrice || v.price || 0) * Number(v.quantity || 1), 0);\r\n    } catch { }\r\n    let totalDebts = 0;\r\n    try {\r\n      const ds = debts || [];\r\n      totalDebts = ds.filter(d => String(d.status || '') === 'pending').reduce((s, d: any) => {\r\n        const paid = Number(d.paidAmount || 0) + ((Array.isArray(d.partialPayments) ? d.partialPayments : []).reduce((pp: number, p: any) => pp + Number(p.amount || 0), 0));\r\n        return s + Math.max(0, Number(d.amount || 0) - paid);\r\n      }, 0);\r\n    } catch { }\r\n    let deficienciesText = '';\r\n    try {\r\n      const sid = shopIdCtx || (profile as any)?.shopId || null;\r\n      const q = sid ? fsQuery(collection(db, 'deficiencies'), where('shopId', '==', sid)) : fsQuery(collection(db, 'deficiencies'), where('userId', '==', user?.uid || ''));\r\n      const snap = await getDocs(q);\r\n      const items = snap.docs.map(d => d.data() as any).filter(v => String(v.status || 'pending') === 'pending');\r\n      const top = items.slice(0, 10);\r\n      deficienciesText = top.map((v: any, i: number) => `${i + 1}- ${String(v.name || v.productName || '')}  ${Number(v.quantity || v.qty || 0)}`).join('\\n');\r\n    } catch { }\r\n    const lines = [\r\n      `  - ${dateStr}`,\r\n      ` : ${totalOps}`,\r\n      ` : ${totalWithdrawn} `,\r\n      ` : ${totalSent} `,\r\n      `: ${profit} `,\r\n      `  : ${accessoriesSales} `,\r\n      ` : ${totalDebts} `,\r\n      ` :`,\r\n      deficienciesText || '   '\r\n    ];\r\n    return lines.join('\\n');\r\n  }\r\n\r\n  const getFilteredTransactions = React.useCallback(() => {\r\n    let filtered = effectiveTransactions;\r\n\r\n    const phoneQuery = debouncedSearchPhone.trim();\r\n    if (phoneQuery) {\r\n      filtered = filtered.filter(transaction => {\r\n        const t: any = transaction as any;\r\n        const isCashAdd = (String(t.type || '').toLowerCase() === 'cash_addition') ||\r\n          (String(t.txnType || '').toLowerCase() === 'cash_addition') ||\r\n          (String(t.title || '').includes('  '));\r\n        if (isCashAdd) return true;\r\n        return (\r\n          (transaction.senderPhone && transaction.senderPhone.includes(phoneQuery)) ||\r\n          (transaction.receiverPhone && transaction.receiverPhone.includes(phoneQuery))\r\n        );\r\n      });\r\n    }\r\n\r\n    //     \r\n    if (selectedDate) {\r\n      const selectedDateObj = new Date(selectedDate);\r\n      filtered = filtered.filter(transaction => {\r\n        const transactionDate = new Date(transaction.createdAt);\r\n\r\n        if (selectedTime) {\r\n          //         \r\n          const [hours, minutes] = selectedTime.split(':');\r\n          const filterDateTime = new Date(selectedDateObj);\r\n          filterDateTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);\r\n          const nextHour = new Date(filterDateTime);\r\n          nextHour.setHours(nextHour.getHours() + 1);\r\n\r\n          return transactionDate >= filterDateTime && transactionDate < nextHour;\r\n        } else {\r\n          //         \r\n          return transactionDate.toDateString() === selectedDateObj.toDateString();\r\n        }\r\n      });\r\n    }\r\n\r\n    //          \r\n    try {\r\n      filtered = [...filtered].sort((a: any, b: any) => {\r\n        const ad = new Date(a.createdAt || 0).getTime();\r\n        const bd = new Date(b.createdAt || 0).getTime();\r\n        return bd - ad;\r\n      });\r\n    } catch { }\r\n\r\n    return filtered;\r\n  }, [effectiveTransactions, debouncedSearchPhone, selectedDate, selectedTime]);\r\n\r\n  //     \r\n  const exportDailyReport = () => {\r\n    if (!selectedDate) {\r\n      toast({\r\n        title: \"  \",\r\n        description: \"    \",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    const filteredTransactions = getFilteredTransactions();\r\n    const totalAmount = filteredTransactions.reduce((sum, tx) => sum + tx.amount, 0);\r\n    const totalWithdrawn = filteredTransactions\r\n      .filter(tx => tx.type === 'withdraw' || tx.type === 'withdrawal' || tx.type === 'receive' || (tx as any).txnType === 'receive')\r\n      .reduce((sum, tx) => sum + (((tx as any).withdrawnAmount !== undefined ? (tx as any).withdrawnAmount : tx.amount) || 0), 0);\r\n    const totalSent = filteredTransactions\r\n      .filter(tx => tx.type === 'send' || tx.type === 'transfer' || (tx as any).txnType === 'send')\r\n      .reduce((sum, tx) => sum + (((tx as any).sentAmount !== undefined ? (tx as any).sentAmount : tx.amount) || 0), 0);\r\n    const totalReceived = filteredTransactions.filter(tx => tx.type === 'receive').reduce((sum, tx) => sum + tx.amount, 0);\r\n\r\n    const reportData = {\r\n      date: selectedDate,\r\n      totalTransactions: filteredTransactions.length,\r\n      totalAmount,\r\n      totalWithdrawn,\r\n      totalSent,\r\n      totalReceived,\r\n      transactions: filteredTransactions\r\n    };\r\n\r\n    //      \r\n    const reportText = `\r\n  - ${selectedDate}\r\n====================\r\n : ${reportData.totalTransactions}\r\n : ${reportData.totalAmount} \r\n : ${reportData.totalWithdrawn} \r\n : ${reportData.totalSent} \r\n : ${reportData.totalReceived} \r\n\r\n :\r\n${filteredTransactions.map(tx =>\r\n      `${tx.createdAt.toLocaleString('ar-EG')} - ${tx.type === 'withdraw' ? '' : tx.senderPhone + '  ' + tx.receiverPhone} - ${tx.amount}  - ${tx.status}`\r\n    ).join('\\n')}\r\n    `;\r\n\r\n    //    \r\n    const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });\r\n    const url = URL.createObjectURL(blob);\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = `_${selectedDate}.txt`;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    URL.revokeObjectURL(url);\r\n\r\n    toast({\r\n      title: \"  \",\r\n      description: `   ${selectedDate} `,\r\n      variant: \"default\",\r\n    });\r\n  };\r\n\r\n  //     \r\n  const [isResetWalletTotalDialogOpen, setIsResetWalletTotalDialogOpen] = useState(false);\r\n  const [resetWalletTotalPinInput, setResetWalletTotalPinInput] = useState('');\r\n\r\n  //     \r\n  const [isResetCashDialogOpen, setIsResetCashDialogOpen] = useState(false);\r\n  const [resetCashPinInput, setResetCashPinInput] = useState('');\r\n\r\n  //      \r\n  const [hasLocalDataToSync, setHasLocalDataToSync] = useState(false);\r\n\r\n  const withRetry = async <T,>(fn: () => Promise<T>, retries = 2, delayMs = 700): Promise<T> => {\r\n    let lastErr: any;\r\n    for (let i = 0; i <= retries; i++) {\r\n      try {\r\n        return await fn();\r\n      } catch (e) {\r\n        lastErr = e;\r\n        if (i === retries) break;\r\n        await new Promise((r) => setTimeout(r, delayMs * Math.pow(2, i)));\r\n      }\r\n    }\r\n    throw lastErr;\r\n  };\r\n\r\n  // Calculate total wallet balance\r\n  const totalWalletBalance = wallets.reduce((total, wallet) => {\r\n    return total + (walletBalances[wallet.id] || 0);\r\n  }, 0);\r\n\r\n  //        -     ( )\r\n  const verifyWalletTotalPin = async (inputPin: string): Promise<boolean> => {\r\n    return await MasterPinService.verifyMasterPin(inputPin, user?.uid);\r\n  };\r\n\r\n  //        ( )\r\n  const verifyCashDrawerPin = async (inputPin: string): Promise<boolean> => {\r\n    //    \r\n    return await MasterPinService.verifyMasterPin(inputPin, user?.uid);\r\n  };\r\n\r\n  //       \r\n  const verifyLoginPassword = async (inputPassword: string): Promise<boolean> => {\r\n    try {\r\n      const currentUser = auth.currentUser;\r\n      if (!currentUser || !currentUser.email) return false;\r\n      const credential = EmailAuthProvider.credential(currentUser.email, inputPassword);\r\n      await reauthenticateWithCredential(currentUser, credential);\r\n      return true;\r\n    } catch (e) {\r\n      console.error('    :', e);\r\n      return false;\r\n    }\r\n  };\r\n\r\n\r\n\r\n  //      (  )   \r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n    try {\r\n      const wbKeyNew = getWalletBalancesKey();\r\n      const wbKeyOld = `walletBalances_${user.uid}`;\r\n      const savedWalletBalances = localStorage.getItem(wbKeyNew) ?? localStorage.getItem(wbKeyOld);\r\n      if (savedWalletBalances) {\r\n        const parsed = JSON.parse(savedWalletBalances);\r\n        setWalletBalances(parsed && typeof parsed === 'object' ? parsed : {});\r\n        try { localStorage.setItem(wbKeyNew, JSON.stringify(parsed || {})); } catch { }\r\n      }\r\n    } catch { }\r\n    try {\r\n      const cbKeyNew = getCashBalanceKey();\r\n      const cbKeyOld = `cashBalance_${user.uid}`;\r\n      const legacyKey = `userCashBalance_${user.uid}`;\r\n      let savedCashBalance = localStorage.getItem(cbKeyNew) ?? localStorage.getItem(cbKeyOld) ?? localStorage.getItem(legacyKey);\r\n      if (savedCashBalance != null) {\r\n        const v = parseFloat(savedCashBalance);\r\n        setCashBalance(Number.isFinite(v) ? v : 0);\r\n        try {\r\n          localStorage.setItem(cbKeyNew, String(Number.isFinite(v) ? v : 0));\r\n          localStorage.removeItem(cbKeyOld);\r\n          localStorage.removeItem(legacyKey);\r\n        } catch { }\r\n      }\r\n    } catch { }\r\n  }, [user?.uid, shopIdCtx, profile?.shopId]);\r\n\r\n  //            \r\n  useEffect(() => {\r\n    const handler = (e: any) => {\r\n      try {\r\n        const v = Number(e?.detail?.value);\r\n        if (Number.isFinite(v)) {\r\n          setCashBalance(v);\r\n        } else {\r\n          const saved = localStorage.getItem(getCashBalanceKey());\r\n          if (saved != null) setCashBalance(parseFloat(saved) || 0);\r\n        }\r\n      } catch {\r\n        const saved = localStorage.getItem(getCashBalanceKey());\r\n        if (saved != null) setCashBalance(parseFloat(saved) || 0);\r\n      }\r\n    };\r\n    window.addEventListener('cashBalanceChanged', handler as EventListener);\r\n    return () => window.removeEventListener('cashBalanceChanged', handler as EventListener);\r\n  }, [user?.uid, shopIdCtx, profile?.shopId]);\r\n\r\n  //           \r\n  useEffect(() => {\r\n    try {\r\n      if (!user?.uid) return;\r\n      const sid = (shopIdCtx || profile?.shopId);\r\n      if (!sid) return;\r\n      const ref = doc(db, 'dashboardData', sid);\r\n      let unsub: (() => void) | null = null;\r\n      unsub = onSnapshot(ref, (snap) => {\r\n        if (!snap.exists()) return;\r\n        const d: any = snap.data();\r\n        const cb = Number(d?.cashBalance || 0);\r\n        const wbs = (d?.walletBalances && typeof d.walletBalances === 'object') ? d.walletBalances : {};\r\n        setCashBalance(cb);\r\n        setWalletBalances(wbs);\r\n        try {\r\n          localStorage.setItem(getCashBalanceKey(), String(cb));\r\n          localStorage.setItem(getWalletBalancesKey(), JSON.stringify(wbs));\r\n        } catch { }\r\n      }, (err) => {\r\n        console.warn('dashboardData subscription error:', err);\r\n      });\r\n      return () => {\r\n        try {\r\n          if (unsub) { unsub(); }\r\n        } catch { }\r\n      };\r\n    } catch { }\r\n  }, [user?.uid, shopIdCtx, profile?.shopId]);\r\n\r\n  const getWalletLimitsCacheKey = (wid?: string) => `walletLimits_${user?.uid || 'default'}_${wid || 'none'}`;\r\n  useEffect(() => {\r\n    if (!selectedWallet) return;\r\n    try {\r\n      const k = getWalletLimitsCacheKey(selectedWallet);\r\n      const s = localStorage.getItem(k);\r\n      if (s) {\r\n        const parsed = JSON.parse(s);\r\n        setSelectedWalletLimits(parsed);\r\n      }\r\n    } catch { }\r\n    const ref = doc(db, 'walletLimits', String(selectedWallet));\r\n    let unsub: (() => void) | null = null;\r\n    try {\r\n      unsub = onSnapshot(ref, (snap) => {\r\n        if (!snap.exists()) return;\r\n        const d: any = snap.data();\r\n        const limitsObj = {\r\n          walletId: selectedWallet,\r\n          dailyTransferLimit: d.dailyTransferLimit ?? 60000,\r\n          dailyWithdrawLimit: d.dailyWithdrawLimit ?? 100000,\r\n          dailyTransferUsed: d.dailyTransferUsed ?? 0,\r\n          dailyWithdrawUsed: d.dailyWithdrawUsed ?? 0,\r\n          monthlyTransferLimit: d.monthlyTransferLimit ?? 200000,\r\n          monthlyWithdrawLimit: d.monthlyWithdrawLimit ?? 200000,\r\n          monthlyTransferUsed: d.monthlyTransferUsed ?? 0,\r\n          monthlyWithdrawUsed: d.monthlyWithdrawUsed ?? 0\r\n        };\r\n        setSelectedWalletLimits(limitsObj);\r\n        try { localStorage.setItem(getWalletLimitsCacheKey(selectedWallet), JSON.stringify(limitsObj)); } catch { }\r\n      });\r\n    } catch { }\r\n    return () => { if (unsub) unsub(); };\r\n  }, [selectedWallet]);\r\n\r\n  useEffect(() => {\r\n    if (!selectedWallet) return;\r\n    const w = wallets.find((x: any) => x.id === selectedWallet);\r\n    if (w?.name) {\r\n      setSelectedWalletName(String(w.name));\r\n      try { localStorage.setItem(`walletName_${user?.uid || 'default'}_${selectedWallet}`, String(w.name)); } catch { }\r\n      return;\r\n    }\r\n    try {\r\n      const s = localStorage.getItem(`walletName_${user?.uid || 'default'}_${selectedWallet}`);\r\n      if (s) setSelectedWalletName(String(s));\r\n    } catch { }\r\n  }, [selectedWallet, wallets]);\r\n\r\n\r\n\r\n  //      \r\n  const refreshSelectedWalletLimits = async () => {\r\n    try {\r\n      if (!selectedWallet) return;\r\n      const limits = await walletDailyLimitsService.autoResetLimitsIfNeeded(selectedWallet);\r\n      setSelectedWalletLimits(limits);\r\n    } catch (error) {\r\n      console.error('     :', error);\r\n    }\r\n  };\r\n\r\n  //       /   \r\n  useEffect(() => {\r\n    refreshSelectedWalletLimits();\r\n  }, [selectedWallet]);\r\n\r\n  //          \r\n  useEffect(() => {\r\n    const handler = (e: any) => {\r\n      if (!e?.detail?.walletId) return;\r\n      if (e.detail.walletId === selectedWallet) {\r\n        refreshSelectedWalletLimits();\r\n      }\r\n    };\r\n    window.addEventListener('walletLimitsUpdated', handler as EventListener);\r\n    return () => window.removeEventListener('walletLimitsUpdated', handler as EventListener);\r\n  }, [selectedWallet]);\r\n\r\n  useEffect(() => {\r\n    const handler = (e: any) => {\r\n      try {\r\n        const wid = String(e?.detail?.walletId || '');\r\n        if (wid) {\r\n          setWalletSelection(wid, 'sms:auto');\r\n        }\r\n      } catch {}\r\n    };\r\n    window.addEventListener('walletSelection:update', handler as EventListener);\r\n    return () => window.removeEventListener('walletSelection:update', handler as EventListener);\r\n  }, [wallets]);\r\n\r\n  // Handle navigation state for opening specific dialogs\r\n  useEffect(() => {\r\n    if (location.state) {\r\n      console.log('Location state:', location.state); //   \r\n\r\n      if (location.state.openDebtDialog) {\r\n        openDebts();\r\n        window.history.replaceState({}, document.title);\r\n      }\r\n      if (location.state.openSalesDialog) {\r\n        if (isZeroPlan || isTahweelaPlan) {\r\n          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\r\n        } else {\r\n          setIsSalesDataOpen(true);\r\n        }\r\n        // Clear the state to prevent reopening on subsequent navigations\r\n        window.history.replaceState({}, document.title);\r\n      }\r\n      //       ()\r\n      if (location.state.openMaintenanceDialog) {\r\n        if (isZeroPlan || isTahweelaPlan) {\r\n          toast({ title: ' ', description: '     .  .', variant: 'destructive' });\r\n        } else {\r\n          setIsMaintenanceOpen(true);\r\n        }\r\n        //     \r\n        window.history.replaceState({}, document.title);\r\n      }\r\n      if (location.state.openCreditCardsDialog) {\r\n        console.log('Opening credit cards dialog'); //   \r\n        if (isZeroPlan || isTahweelaPlan) {\r\n          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\r\n        } else {\r\n          setIsCreditCardsOpen(true);\r\n        }\r\n        // Clear the state to prevent reopening on subsequent navigations\r\n        window.history.replaceState({}, document.title);\r\n      }\r\n      //        ()\r\n      if (location.state.openShopExpensesDialog) {\r\n        if (isZeroPlan || isTahweelaPlan) {\r\n          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\r\n        } else {\r\n          if (MasterPinService.hasMasterPin()) {\r\n            setIsShopExpensesPinDialogOpen(true);\r\n          } else {\r\n            setIsShopExpensesDialogOpen(true);\r\n          }\r\n        }\r\n        //     \r\n        window.history.replaceState({}, document.title);\r\n      }\r\n      //       ()\r\n      if (location.state.openDeficienciesDialog) {\r\n        if (isZeroPlan || isTahweelaPlan) {\r\n          toast({ title: ' ', description: '     .  .', variant: 'destructive' });\r\n        } else {\r\n          setIsDeficienciesDialogOpen(true);\r\n        }\r\n        window.history.replaceState({}, document.title);\r\n      }\r\n      if ((location.state as any).openInstallment) {\r\n        if (isZeroPlan || isTahweelaPlan) {\r\n          toast({ title: ' ', description: '      .', variant: 'destructive' });\r\n        } else {\r\n          setIsInstallmentPinOpen(true);\r\n        }\r\n        window.history.replaceState({}, document.title);\r\n      }\r\n      if (location.state.openTransactionSection) {\r\n        // Scroll to transaction section or set active tab\r\n        const transactionSection = document.getElementById('transaction-section');\r\n        if (transactionSection) {\r\n          transactionSection.scrollIntoView({ behavior: 'smooth' });\r\n        }\r\n\r\n        // Set transaction type if specified\r\n        if (location.state.transactionType) {\r\n          setTransactionType(location.state.transactionType);\r\n        }\r\n\r\n        // Start new transaction if specified\r\n        if (location.state.startNewTransaction) {\r\n          // Clear all form fields to start fresh\r\n          setReceiverPhone('');\r\n          setAmount('');\r\n          setManualCommission('');\r\n          setTransferCommission('');\r\n\r\n          //  REMOVED: Auto-select default wallet for withdraw transactions\r\n          // This was causing the wallet to reset when switching to withdraw\r\n          // The user's wallet selection should persist across all transaction types\r\n          console.log(' Starting new transaction without changing wallet selection');\r\n        }\r\n\r\n        // Focus on wallet selection if specified (legacy support)\r\n        if (location.state.focusWalletSelection) {\r\n          setTimeout(() => {\r\n            const walletSelect = document.querySelector('[data-testid=\"wallet-select\"]');\r\n            if (walletSelect) {\r\n              walletSelect.focus();\r\n            }\r\n          }, 500);\r\n        }\r\n\r\n        // Clear the state after handling transaction section\r\n        window.history.replaceState({}, document.title);\r\n      }\r\n      //        ()\r\n      if (location.state.openCashierShiftModal) {\r\n        if (!isShiftHandoverAllowed || isTahweelaPlan) {\r\n          toast({ title: ' ', description: '   :      .', variant: 'destructive' });\r\n        } else {\r\n          setIsCashierModalOpen(true);\r\n        }\r\n        //     \r\n        window.history.replaceState({}, document.title);\r\n      }\r\n      //       \r\n      if (location.state.openMachineDailyDialog) {\r\n        if (!isShiftHandoverAllowed || isTahweelaPlan) {\r\n          toast({ title: ' ', description: '   :      .', variant: 'destructive' });\r\n        } else {\r\n          setIsMachineDailyDialogOpen(true);\r\n        }\r\n        //     \r\n        window.history.replaceState({}, document.title);\r\n      }\r\n    }\r\n  }, [location.state, wallets, isTahweelaPlan]);\r\n\r\n  //     localStorage:      Firebase\r\n  //  useEffect       \r\n  useEffect(() => {\r\n    //       \r\n    if (location.pathname === '/user/dashboard') {\r\n      const previousPath = sessionStorage.getItem('previousPath');\r\n      if (previousPath === '/user/add-wallet') {\r\n        console.log(' Returned from wallet addition page - reloading wallets');\r\n        loadWalletsFromFirebase();\r\n        sessionStorage.removeItem('previousPath'); //   \r\n      }\r\n    }\r\n\r\n    //   \r\n    sessionStorage.setItem('previousPath', location.pathname);\r\n  }, [location.pathname, user?.uid]);\r\n\r\n\r\n\r\n  // Load data from Firebase on component mount\r\n  //       \r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n\r\n    console.log(' Setting up real-time user activation listener for:', user.uid);\r\n\r\n    //       \r\n    const userDocRef = doc(db, 'users', user.uid);\r\n    const unsubscribe = onSnapshot(userDocRef, (docSnapshot) => {\r\n      if (docSnapshot.exists()) {\r\n        const userData = docSnapshot.data();\r\n        const isActive = userData.isActive === true;\r\n\r\n        console.log(' Real-time user status update:', {\r\n          userId: user.uid,\r\n          isActive,\r\n          subscription: userData.subscription\r\n        });\r\n\r\n        //       \r\n        if (isActive && !isUserActive) {\r\n          console.log(' User activated! Redirecting to dashboard...');\r\n          setIsUserActive(true);\r\n          setShowActivationModal(false);\r\n          setIsCheckingActivation(false);\r\n\r\n          //       \r\n          // window.location.reload(); //       \r\n        } else if (!isActive && isUserActive) {\r\n          //     \r\n          console.log(' User deactivated! Showing activation modal...');\r\n          setIsUserActive(false);\r\n          setShowActivationModal(true);\r\n        }\r\n      }\r\n    }, (error) => {\r\n      console.error(' Error in real-time user listener:', error);\r\n    });\r\n\r\n    return () => {\r\n      console.log(' Cleaning up real-time user listener');\r\n      unsubscribe();\r\n    };\r\n  }, [user?.uid, isUserActive]);\r\n\r\n  //    \r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n\r\n    const handleSubscriptionActivated = (event: CustomEvent) => {\r\n      const { userId } = event.detail;\r\n      if (userId === user.uid) {\r\n        console.log(' Subscription activation event received for current user!');\r\n        setIsUserActive(true);\r\n        setShowActivationModal(false);\r\n        setIsCheckingActivation(false);\r\n\r\n        //       \r\n        setTimeout(() => {\r\n          //        \r\n          console.log(' User activation completed - data updated');\r\n        }, 1000);\r\n      }\r\n    };\r\n\r\n    const handleUserSubscriptionUpdated = (event: CustomEvent) => {\r\n      const { userId, isActive } = event.detail;\r\n      if (userId === user.uid) {\r\n        console.log(' User subscription update event received:', { userId, isActive });\r\n        if (isActive && !isUserActive) {\r\n          setIsUserActive(true);\r\n          setShowActivationModal(false);\r\n          setIsCheckingActivation(false);\r\n\r\n          //       \r\n          setTimeout(() => {\r\n            //        \r\n            console.log(' User subscription updated - data refreshed');\r\n          }, 1000);\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('subscriptionActivated', handleSubscriptionActivated as EventListener);\r\n    window.addEventListener('userSubscriptionUpdated', handleUserSubscriptionUpdated as EventListener);\r\n\r\n    return () => {\r\n      window.removeEventListener('subscriptionActivated', handleSubscriptionActivated as EventListener);\r\n      window.removeEventListener('userSubscriptionUpdated', handleUserSubscriptionUpdated as EventListener);\r\n    };\r\n  }, [user?.uid, isUserActive]);\r\n\r\n  //      (1-9)\r\n  useEffect(() => {\r\n    const handleGlobalShortcuts = (e: KeyboardEvent) => {\r\n      const target = e.target as HTMLElement | null;\r\n      const tag = target?.tagName?.toLowerCase();\r\n      const isTyping = tag === 'input' || tag === 'textarea' || tag === 'select' || (target?.isContentEditable ?? false);\r\n      if (isTyping) return;\r\n      if (e.ctrlKey || e.altKey || e.metaKey) return;\r\n      if (e.repeat) return;\r\n\r\n      if ((isZeroPlan || isTahweelaPlan) && e.key >= '1' && e.key <= '9') {\r\n        e.preventDefault();\r\n        return;\r\n      }\r\n\r\n      switch (e.key) {\r\n        case '1':\r\n          break;\r\n        case '2':\r\n          setIsCalculatorOpen(true);\r\n          break;\r\n        case '3':\r\n          if (isZeroPlan || isTahweelaPlan) {\r\n            toast({ title: ' ', description: '      .  .', variant: 'destructive' });\r\n          } else {\r\n            setIsCreditCardsOpen(true);\r\n          }\r\n          break;\r\n        case '4':\r\n          if (!isShiftHandoverAllowed) {\r\n            toast({ title: ' ', description: '   :      .', variant: 'destructive' });\r\n          } else {\r\n            setIsCashierModalOpen(true);\r\n          }\r\n          break;\r\n        case '5':\r\n          if (isZeroPlan || isTahweelaPlan) {\r\n            toast({ title: ' ', description: '      .  .', variant: 'destructive' });\r\n          } else {\r\n            setIsSalesDataOpen(true);\r\n          }\r\n          break;\r\n        case '6':\r\n          openDebts();\r\n          break;\r\n        case '7':\r\n          if (isZeroPlan || isTahweelaPlan) {\r\n            toast({ title: ' ', description: '     .  .', variant: 'destructive' });\r\n          } else {\r\n            setIsMaintenanceOpen(true);\r\n          }\r\n          break;\r\n        case '8':\r\n          if (!isShiftHandoverAllowed) {\r\n            toast({ title: ' ', description: '   :      .', variant: 'destructive' });\r\n          } else {\r\n            setIsMachineDailyDialogOpen(true);\r\n          }\r\n          break;\r\n        case '9':\r\n          if (isZeroPlan || isTahweelaPlan) {\r\n            toast({ title: ' ', description: '      .  .', variant: 'destructive' });\r\n          } else {\r\n            if (MasterPinService.hasMasterPin()) {\r\n              setIsShopExpensesPinDialogOpen(true);\r\n            } else {\r\n              setIsShopExpensesDialogOpen(true);\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleGlobalShortcuts);\r\n    return () => window.removeEventListener('keydown', handleGlobalShortcuts);\r\n  }, [isZeroPlan, isTahweelaPlan, isShiftHandoverAllowed]);\r\n\r\n  useEffect(() => {\r\n    console.log(' useEffect loadUserData started', { user: user?.uid, isCheckingActivation });\r\n\r\n    const loadUserData = async () => {\r\n      try {\r\n        //     \r\n        if (!user?.uid) {\r\n          console.log(' No user UID, setting isCheckingActivation to false');\r\n          setIsCheckingActivation(false);\r\n          return;\r\n        }\r\n\r\n        //      localStorage:    Firebase \r\n\r\n        try {\r\n          const userDoc = await getDoc(doc(db, 'users', user.uid));\r\n          if (userDoc.exists()) {\r\n            const userData = userDoc.data();\r\n            const isActive = userData.isActive === true;\r\n\r\n            //    \r\n            const trialValidity = await FreeTrialService.checkTrialValidity(user.uid);\r\n            const isOnTrial = trialValidity.isValid && !trialValidity.isExpired;\r\n\r\n            setIsUserActive(isActive || isOnTrial);\r\n            setIsOnFreeTrial(isOnTrial);\r\n            setFreeTrialHoursRemaining(trialValidity.hoursRemaining);\r\n            setHasUsedFreeTrial(trialValidity.hasUsedTrial);\r\n            setShowActivationModal(!isActive && !isOnTrial);\r\n\r\n            console.log('  :', {\r\n              isActive,\r\n              isOnTrial,\r\n              hoursRemaining: trialValidity.hoursRemaining,\r\n              hasUsedTrial: trialValidity.hasUsedTrial\r\n            });\r\n          } else {\r\n            //           \r\n            setIsUserActive(false);\r\n            setShowActivationModal(true);\r\n          }\r\n        } catch (error) {\r\n          console.error('     :', error);\r\n          setIsUserActive(false);\r\n          setShowActivationModal(true);\r\n        } finally {\r\n          setIsCheckingActivation(false);\r\n        }\r\n\r\n        //     Firebase     \r\n        console.log('      Firebase...', { userId: user?.uid });\r\n\r\n        //      \r\n        //     :    Firebase \r\n\r\n        //   Firebase            \r\n        if (user?.uid) {\r\n          const userData = await withRetry(() => userDataService.getUserData(user.uid));\r\n\r\n          if (userData) {\r\n            const remoteBalances: Record<string, number> = userData?.walletBalances || {};\r\n            setWalletBalances(remoteBalances);\r\n\r\n            if (userData?.cashBalance !== undefined) {\r\n              setCashBalance(userData.cashBalance);\r\n            }\r\n\r\n            try {\r\n              const firebaseDeletedTransactions = user?.uid\r\n                ? await withRetry(() => auditLogService.getDeletedTransactionsByUser(user.uid))\r\n                : [];\r\n              setDeletedTransactions(firebaseDeletedTransactions || []);\r\n            } catch (error) {\r\n              setDeletedTransactions([]);\r\n            }\r\n          } else {\r\n            setWalletBalances({});\r\n            try {\r\n              const firebaseDeletedTransactions = user?.uid\r\n                ? await auditLogService.getDeletedTransactionsByUser(user.uid)\r\n                : [];\r\n              setDeletedTransactions(firebaseDeletedTransactions || []);\r\n            } catch {\r\n              setDeletedTransactions([]);\r\n            }\r\n          }\r\n        }\r\n\r\n        //    Firebase  merchantWalletService ( )\r\n        console.log('     Firebase...');\r\n        try {\r\n          const firebaseWallets = await withRetry(() => merchantWalletService.getByMerchantId(user?.uid || ''));\r\n          if (firebaseWallets && firebaseWallets.length > 0) {\r\n            console.log('      Firebase:', firebaseWallets.length);\r\n\r\n            //    Firebase   \r\n            const activeOnly = firebaseWallets.filter(w => (w as any).isActive === true);\r\n            const formattedWallets = activeOnly.map(w => ({\r\n              id: w.id,\r\n              name: w.label || '  ',\r\n              phone: w.msisdn,\r\n              isDefault: false, //     \r\n              monthlyWithdrawalLimit: (w.monthlyWithdrawalLimit ?? w.withdrawLimit ?? 200000),\r\n              monthlyTransferLimit: (w.monthlyTransferLimit ?? w.transferLimit ?? 200000),\r\n              //      \r\n              defaultTransferCommission: (w.defaultTransferCommission != null ? Number(w.defaultTransferCommission) : null),\r\n              defaultWithdrawCommission: (w.defaultWithdrawCommission != null ? Number(w.defaultWithdrawCommission) : null)\r\n            }));\r\n\r\n            setWallets(formattedWallets);\r\n\r\n            // Set default wallet as selected if available\r\n            //       localStorage\r\n            const savedSelectedWallet = localStorage.getItem(getSelectedWalletKey());\r\n            let walletToSelect = null;\r\n\r\n            if (savedSelectedWallet && formattedWallets.find(w => w.id === savedSelectedWallet)) {\r\n              //      \r\n              walletToSelect = formattedWallets.find(w => w.id === savedSelectedWallet);\r\n            } else {\r\n              //     \r\n              walletToSelect = formattedWallets[0];\r\n            }\r\n\r\n            if (walletToSelect) {\r\n              setSelectedWallet(walletToSelect.id);\r\n              setSenderPhone(walletToSelect.phone);\r\n            }\r\n\r\n            console.log('     Firebase   localStorage');\r\n          } else {\r\n            console.log('     Firebase.        .');\r\n            setWallets([]);\r\n          }\r\n        } catch (error) {\r\n          console.error('     Firebase:', error);\r\n          //   :      localStorage\r\n          setWallets([]);\r\n        }\r\n\r\n        //    Firebase     \r\n        const userTransactions = user?.uid\r\n          ? await withRetry(() => userDataService.getUserTransactions(user.uid))\r\n          : [];\r\n        if (userTransactions && userTransactions.length > 0) {\r\n          console.log('     Firebase:', userTransactions.length);\r\n\r\n          //      Firebase format  Local format\r\n          const transactionsWithDates = userTransactions.map((tx: any) => ({\r\n            ...tx,\r\n            createdAt: new Date(tx.createdAt),\r\n            //    Firebase format  Local format\r\n            senderPhone: tx.senderMsisdn || tx.senderPhone || '',\r\n            receiverPhone: tx.receiverMsisdn || tx.receiverPhone || '',\r\n            type: tx.txnType === 'send' ? 'send' :\r\n              tx.txnType === 'receive' ? 'withdraw' :\r\n                tx.type || 'withdraw',\r\n            status: tx.status === 'confirmed' ? 'completed' : tx.status || 'completed'\r\n          }));\r\n\r\n          //     \r\n          const deletedTransactionIds = deletedTransactions.map(dt => dt.id || dt.originalTransactionId);\r\n\r\n          //          \r\n          let permanentDeletedKeys: string[] = [];\r\n          try {\r\n            const permQ = fsQuery(\r\n              collection(db, 'deletedTransactions'),\r\n              where('userId', '==', user?.uid || ''),\r\n              where('permanent', '==', true)\r\n            );\r\n            const permSnap = await getDocs(permQ);\r\n            permanentDeletedKeys = permSnap.docs.map(d => {\r\n              const data: any = d.data();\r\n              const tombId = String(data.originalTransactionId || data.transactionId || d.id || '');\r\n              return tombId;\r\n            }).filter(Boolean);\r\n          } catch { }\r\n\r\n          const permSet = new Set(permanentDeletedKeys);\r\n          const activeTransactions = transactionsWithDates.filter(tx => {\r\n            const txId = String(tx.id || '');\r\n            const txTxnId = String((tx as any).transactionId || '');\r\n            const txRef = String((tx as any).reference || (tx as any).transactionReference || (tx as any).receipt?.reference || '');\r\n            const inDeleted = deletedTransactionIds.includes(txId);\r\n            const blockedByPerm = permSet.has(txId) || (txTxnId && permSet.has(txTxnId));\r\n            return !inDeleted && !blockedByPerm;\r\n          });\r\n\r\n          console.log('    :', {\r\n            total: userTransactions.length,\r\n            deleted: deletedTransactionIds.length,\r\n            active: activeTransactions.length\r\n          });\r\n          //           \r\n          //             id\r\n          {\r\n            const getKey = (t: any) => String(\r\n              t?.transactionId || t?.id || `${t?.transactionReference || t?.receipt?.reference || 'ref'}-${new Date(t?.createdAt || 0).getTime()}`\r\n            );\r\n            const seen = new Set<string>();\r\n            const distinct: any[] = [];\r\n            for (const t of activeTransactions) {\r\n              const key = getKey(t);\r\n              if (!seen.has(key)) {\r\n                seen.add(key);\r\n                distinct.push(t);\r\n              }\r\n            }\r\n            if (!isRealtimeActive) setTransactions(distinct);\r\n\r\n          }\r\n        }\r\n\r\n        //     Firebase   \r\n        await syncLocalDataWithFirebase();\r\n\r\n      } catch (error) {\r\n        console.error('      Firebase:', error);\r\n        //   :       localStorage     \r\n      }\r\n    };\r\n\r\n    loadUserData().then(async () => {\r\n      await autoMonthlyDbCleanup();\r\n      await autoResetLimits();\r\n      await autoResetReports();\r\n    });\r\n\r\n    //          \r\n    const autoResetLimits = async () => {\r\n      try {\r\n        if (!user?.uid) return;\r\n        //          \r\n        const wallets = await merchantWalletService.getByMerchantId(user.uid);\r\n        await Promise.all(\r\n          wallets.map((w: any) => walletLimitsService.autoResetLimitsIfNeeded(w.id))\r\n        );\r\n      } catch (error) {\r\n        console.error('    :', error);\r\n      }\r\n    };\r\n\r\n    //      \r\n    const autoResetReports = async () => {\r\n      try {\r\n        //     Firebase      \r\n        await reportsService.syncReportsDataFromFirebase(user?.uid);\r\n        const data = reportsService.getReportsData(user?.uid);\r\n        const shouldArchiveDaily = data.lastDailyResetDate ? reportsService.shouldResetDailyReports(data.lastDailyResetDate) : false;\r\n        if (shouldArchiveDaily && user?.uid && data.lastDailyResetDate) {\r\n          const dayDate = new Date(data.lastDailyResetDate);\r\n          const baseDateStr = dayDate.toDateString();\r\n          //                \r\n          const dayTransactions = transactions.filter(tx =>\r\n            new Date(tx.createdAt).toDateString() === baseDateStr && tx.status === 'completed'\r\n          );\r\n          const totalTransactions = dayTransactions.length;\r\n          const totalAmount = dayTransactions.reduce((sum, tx) => sum + tx.amount, 0);\r\n          const totalWithdrawn = dayTransactions\r\n            .filter(isWithdrawTx)\r\n            .reduce((sum, tx) => {\r\n              const amount = (tx as any).withdrawnAmount !== undefined ? (tx as any).withdrawnAmount : tx.amount;\r\n              return sum + amount;\r\n            }, 0);\r\n          const totalSent = dayTransactions\r\n            .filter(isSendTx)\r\n            .reduce((sum, tx) => {\r\n              const amount = (tx as any).sentAmount !== undefined ? (tx as any).sentAmount : tx.amount;\r\n              return sum + amount;\r\n            }, 0);\r\n          const profit = dayTransactions.reduce((sum, tx) => sum + reportsService.calculateTransactionProfit(tx), 0);\r\n\r\n          const reportDateStr = new Date(dayDate).toISOString().slice(0, 10);\r\n          await dailyReportsArchiveService.add({\r\n            userId: user.uid,\r\n            reportDate: reportDateStr,\r\n            totalTransactions,\r\n            totalAmount: Number(totalAmount.toFixed(2)),\r\n            totalWithdrawn: Number(totalWithdrawn.toFixed(2)),\r\n            totalSent: Number(totalSent.toFixed(2)),\r\n            profit: Number(profit.toFixed(2)),\r\n            walletId: null\r\n          });\r\n        }\r\n\r\n        const resetResult = reportsService.autoResetReportsIfNeeded(user?.uid);\r\n        if (resetResult.dailyReset || resetResult.monthlyReset) {\r\n          console.log('  :', resetResult);\r\n          //             \r\n        }\r\n      } catch (error) {\r\n        console.error('    :', error);\r\n      }\r\n    };\r\n\r\n    //      1    (     Firebase )\r\n    const autoMonthlyDbCleanup = async () => {\r\n      try {\r\n        if (!user?.uid) return;\r\n        const today = new Date();\r\n        if (today.getDate() !== 1) return; //    1\r\n        const tag = `${today.getFullYear()}-${today.getMonth() + 1}`;\r\n        const key = `lastMonthlyDbCleanup:${user.uid}`;\r\n        const last = localStorage.getItem(key);\r\n        if (last === tag) return; //     \r\n\r\n        const monthStart = new Date(today.getFullYear(), today.getMonth(), 1, 0, 0, 0, 0);\r\n        const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : new Date(String(v));\r\n\r\n        // userTransactions\r\n        let utDocs: any[] = [];\r\n        try {\r\n          const q1 = fsQuery(\r\n            collection(db, 'userTransactions'),\r\n            where('userId', '==', user.uid),\r\n            where('createdAt', '<', monthStart)\r\n          );\r\n          const snap1 = await getDocs(q1);\r\n          utDocs = snap1.docs;\r\n        } catch {\r\n          const q1fb = fsQuery(\r\n            collection(db, 'userTransactions'),\r\n            where('userId', '==', user.uid)\r\n          );\r\n          const snap1fb = await getDocs(q1fb);\r\n          utDocs = snap1fb.docs.filter(d => toJsDate(d.data()?.createdAt) < monthStart);\r\n        }\r\n        await Promise.allSettled(utDocs.map(d => deleteDoc(d.ref)));\r\n\r\n        // transactions ( )\r\n        let gDocs: any[] = [];\r\n        try {\r\n          const q2 = fsQuery(\r\n            collection(db, 'transactions'),\r\n            where('userId', '==', user.uid),\r\n            where('createdAt', '<', monthStart)\r\n          );\r\n          const snap2 = await getDocs(q2);\r\n          gDocs = snap2.docs;\r\n        } catch {\r\n          const q2fb = fsQuery(\r\n            collection(db, 'transactions'),\r\n            where('userId', '==', user.uid)\r\n          );\r\n          const snap2fb = await getDocs(q2fb);\r\n          gDocs = snap2fb.docs.filter(d => toJsDate(d.data()?.createdAt) < monthStart);\r\n        }\r\n        await Promise.allSettled(gDocs.map(d => deleteDoc(d.ref)));\r\n\r\n        try { localStorage.setItem(key, tag); } catch { }\r\n        console.log('      (Firebase ):', {\r\n          userTransactionsDeleted: utDocs.length,\r\n          globalTransactionsDeleted: gDocs.length,\r\n          monthStart\r\n        });\r\n      } catch (e) {\r\n        console.error('     :', e);\r\n      }\r\n    };\r\n\r\n    //   \r\n    fetchSubscriptionData();\r\n\r\n    //  \r\n    loadDebtsFromStorage();\r\n    //  \r\n    loadCustomersFromStorage();\r\n\r\n    console.log(' useEffect loadUserData completed');\r\n  }, [user?.uid]);\r\n\r\n  //      Firebase\r\n  const loadWalletsFromFirebase = async () => {\r\n    if (!user?.uid) return;\r\n\r\n    try {\r\n      const firebaseWallets = await withRetry(() => merchantWalletService.getByMerchantId(user.uid));\r\n      if (firebaseWallets && firebaseWallets.length > 0) {\r\n        //    Firebase   \r\n        const activeOnly = firebaseWallets.filter(w => (w as any).isActive === true);\r\n        const formattedWallets = activeOnly.map(w => ({\r\n          id: w.id,\r\n          name: w.label || '  ',\r\n          phone: w.msisdn,\r\n          isDefault: false, //     \r\n          monthlyWithdrawalLimit: (w.monthlyWithdrawalLimit ?? w.withdrawLimit ?? 200000),\r\n          monthlyTransferLimit: (w.monthlyTransferLimit ?? w.transferLimit ?? 200000),\r\n          //         null  undefined\r\n          defaultTransferCommission: (w.defaultTransferCommission != null ? Number(w.defaultTransferCommission) : undefined),\r\n          defaultWithdrawCommission: (w.defaultWithdrawCommission != null ? Number(w.defaultWithdrawCommission) : undefined)\r\n        }));\r\n\r\n        setWallets(formattedWallets);\r\n\r\n        //         \r\n\r\n        //             \r\n        if (user?.uid) {\r\n          const savedWallet = localStorage.getItem(getSelectedWalletKey());\r\n          const isCurrentValid = !!(selectedWallet && formattedWallets.find(w => w.id === selectedWallet));\r\n          if (!isCurrentValid) {\r\n            const validSaved = savedWallet && formattedWallets.find(w => w.id === savedWallet) ? savedWallet : null;\r\n            const newWalletId = validSaved || formattedWallets[0]?.id;\r\n            if (newWalletId) {\r\n              console.log(' Fixing invalid wallet selection:', newWalletId);\r\n              setWalletSelection(newWalletId);\r\n            }\r\n          } else {\r\n            console.log(' Preserving current wallet selection:', selectedWallet);\r\n          }\r\n        }\r\n\r\n        console.log('     Firebase:', formattedWallets.length);\r\n      }\r\n    } catch (error) {\r\n      console.error('     Firebase:', error);\r\n    }\r\n  };\r\n\r\n  // useEffect         \r\n  useEffect(() => {\r\n    const currentPath = location.pathname;\r\n    const previousPath = sessionStorage.getItem('previousPath');\r\n\r\n    //           \r\n    if (previousPath === '/user/add-wallet' && currentPath === '/user/dashboard') {\r\n      queryClientHook.invalidateQueries({ queryKey: ['wallets', user?.uid] });\r\n      try { walletsQuery.refetch(); } catch {}\r\n      sessionStorage.removeItem('previousPath');\r\n    }\r\n\r\n    //   \r\n    sessionStorage.setItem('previousPath', currentPath);\r\n  }, [location.pathname, user?.uid]);\r\n\r\n  // useEffect      \r\n  useEffect(() => {\r\n    const handleWindowFocus = () => {\r\n      const currentSelectedWallet = selectedWallet;\r\n      queryClientHook.invalidateQueries({ queryKey: ['wallets', user?.uid] });\r\n      try { walletsQuery.refetch(); } catch {}\r\n    };\r\n\r\n    //     \r\n    window.addEventListener('focus', handleWindowFocus);\r\n\r\n    //      \r\n    return () => {\r\n      window.removeEventListener('focus', handleWindowFocus);\r\n    };\r\n  }, [user?.uid, selectedWallet, wallets]);\r\n\r\n  // Centralized wallet selection management\r\n  const setWalletSelection = async (walletId: string, source: string = 'unknown') => {\r\n    console.log(` setWalletSelection called from ${source} with walletId:`, walletId);\r\n    console.log(' Previous selectedWallet:', selectedWallet);\r\n\r\n    setSelectedWallet(walletId);\r\n    const wallet = wallets.find(w => w.id === walletId);\r\n    if (wallet) {\r\n      setSenderPhone(wallet.phone);\r\n      console.log(' Wallet set successfully:', walletId, 'Phone:', wallet.phone);\r\n    }\r\n\r\n    //     localStorage\r\n    if (user?.uid) {\r\n      localStorage.setItem(getSelectedWalletKey(), walletId);\r\n      console.log(' Saved wallet to localStorage:', walletId);\r\n\r\n      // Save to Capacitor Preferences for native access (SmsReceiver)\r\n      try {\r\n        await Preferences.set({\r\n          key: 'selected_wallet_id',\r\n          value: walletId\r\n        });\r\n        await Preferences.set({\r\n          key: 'current_user_id',\r\n          value: user.uid\r\n        });\r\n        console.log(' Saved wallet and user ID to Capacitor Preferences:', walletId, user.uid);\r\n      } catch (err) {\r\n        console.error(' Failed to save to Capacitor Preferences:', err);\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handler = () => {\r\n      loadWalletsFromFirebase();\r\n    };\r\n    try {\r\n      window.addEventListener('wallets:activation-updated' as any, handler as unknown as EventListener);\r\n    } catch { }\r\n    return () => {\r\n      try {\r\n        window.removeEventListener('wallets:activation-updated' as any, handler as unknown as EventListener);\r\n      } catch { }\r\n    };\r\n  }, [user?.uid]);\r\n\r\n  // Update sender phone when wallet selection changes\r\n  const handleWalletChange = (walletId: string) => {\r\n    //      \r\n    if (walletId === '__add_wallet') {\r\n      navigate('/user/add-wallet');\r\n      return;\r\n    }\r\n    if (walletId === '__view_wallets') {\r\n      setIsWalletsPinDialogOpen(true);\r\n      return;\r\n    }\r\n\r\n    // Gate changing selected wallet behind master PIN verification (configurable)\r\n    const requirePin = walletSelectionPinService.isEnabled(user?.uid);\r\n    if (requirePin) {\r\n      setPendingSelectedWalletId(walletId);\r\n      setIsWalletSelectionPinDialogOpen(true);\r\n    } else {\r\n      setWalletSelection(walletId, 'walletSelectionNoPin');\r\n    }\r\n  };\r\n\r\n  // Handle transaction type changes\r\n  const handleTransactionTypeChange = (type: 'transfer' | 'withdraw') => {\r\n    console.log(' handleTransactionTypeChange called with type:', type);\r\n    console.log(' Current selectedWallet before change:', selectedWallet);\r\n    console.log(' Available wallets count:', wallets.length);\r\n\r\n    setTransactionType(type);\r\n    // Clear receiver phone when switching transaction types\r\n    setReceiverPhone('');\r\n    // Clear amount when switching transaction types\r\n    setAmount('');\r\n    // Clear commission fields when switching transaction types\r\n    setManualCommission('');\r\n    setTransferCommission('');\r\n\r\n    // NEVER change the selected wallet when switching transaction types\r\n    // The user's wallet selection should persist across all transaction types\r\n    console.log(' Transaction type changed to:', type, '- Wallet selection preserved:', selectedWallet);\r\n\r\n    // Scroll to transaction section to show confirm button after a short delay\r\n    setTimeout(() => {\r\n      const transactionSection = document.getElementById('transaction-section');\r\n      if (transactionSection) {\r\n        transactionSection.scrollIntoView({\r\n          behavior: 'smooth',\r\n          block: 'start',\r\n          inline: 'nearest'\r\n        });\r\n      }\r\n    }, 100);\r\n  };\r\n\r\n  // Keyboard controls: Left/Right to toggle type, Enter to confirm\r\n  useEffect(() => {\r\n    const onKeyDown = (e: KeyboardEvent) => {\r\n      const target = e.target as HTMLElement | null;\r\n      const isEditable = !!target && (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.tagName === 'SELECT' || target.isContentEditable);\r\n\r\n      // Toggle type with arrows only when not editing an input\r\n      if (!isEditable) {\r\n        if (e.key === 'ArrowLeft') {\r\n          e.preventDefault();\r\n          handleTransactionTypeChange('withdraw');\r\n        } else if (e.key === 'ArrowRight') {\r\n          e.preventDefault();\r\n          handleTransactionTypeChange('transfer');\r\n        }\r\n      }\r\n\r\n      // Confirm current action with Enter\r\n      if (e.key === 'Enter') {\r\n        const id = transactionType === 'transfer' ? 'transferSubmitButton' : 'withdrawSubmitButton';\r\n        const btn = document.getElementById(id) as HTMLButtonElement | null;\r\n        if (btn && !btn.disabled) {\r\n          e.preventDefault();\r\n          btn.click();\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', onKeyDown);\r\n    return () => window.removeEventListener('keydown', onKeyDown);\r\n  }, [transactionType]);\r\n\r\n  // Handle transaction click to show details\r\n  const handleTransactionClick = (transaction: Transaction) => {\r\n    //        \r\n    const mapToReceiptTransaction = (t: Transaction) => ({\r\n      id: t.id,\r\n      type: t.type === 'send' ? 'transfer' : 'withdraw',\r\n      sender_msisdn: t.senderPhone,\r\n      receiver_msisdn: t.receiverPhone,\r\n      amount: t.amount,\r\n      commission: t.commission || 0,\r\n      fee: (t as any)?.fee ?? 0,\r\n      status: t.status === 'failed' ? 'failed' : (t.status === 'completed' ? 'completed' : 'pending'),\r\n      createdAt: new Date(t.createdAt).toISOString(),\r\n      updatedAt: new Date(t.createdAt).toISOString(),\r\n      shopName: shopName ?? profile?.shopName ?? user?.displayName ?? '',\r\n      //          \r\n      cashierName: (t as any)?.cashierName ?? null,\r\n      commissionMode: (t as any)?.commissionMode ?? (t.type === 'send' ? 'add' : (isCommissionAddMode ? 'add' : 'deduct')),\r\n      totalCharged: (t as any)?.totalCharged ?? (\r\n        t.type === 'send'\r\n          ? (Number(t.amount || 0) + Number(t.commission || 0) + Number((t as any)?.fee || 0))\r\n          : (isCommissionAddMode ? (Number(t.amount || 0) + Number(t.commission || 0)) : Number(t.amount || 0))\r\n      ),\r\n      note: (t as any)?.note ?? (t as any)?.notes ?? undefined,\r\n      senderName: (t as any)?.senderName ?? undefined\r\n    });\r\n\r\n    setReceiptTransaction(mapToReceiptTransaction(transaction));\r\n    setIsReceiptOpen(true);\r\n  };\r\n\r\n  // Handle transaction deletion\r\n  const handleDeleteTransaction = async (transactionId: string) => {\r\n    //     \r\n    if (!user?.uid) {\r\n      toast({\r\n        title: \"  \",\r\n        description: \"     \",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    //     \r\n    const transactionToDelete = transactions.find(t => t.id === transactionId);\r\n\r\n    if (!transactionToDelete) {\r\n      toast({\r\n        title: \"  \",\r\n        description: \"      \",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    const txKey = String(transactionId);\r\n    const refKey = String((transactionToDelete as any)?.transactionId || (transactionToDelete as any)?.reference || '');\r\n    deletedEffectsAppliedRef.current.add(txKey);\r\n    if (refKey) deletedEffectsAppliedRef.current.add(refKey);\r\n\r\n    try {\r\n      console.log('    :', transactionId);\r\n\r\n      // :     Firebase    \r\n      console.log('     Firebase...', {\r\n        transactionId: transactionToDelete.id,\r\n        userId: user.uid,\r\n        transactionData: transactionToDelete\r\n      });\r\n\r\n      //      userTransactions  Firebase\r\n      await userDataService.removeUserTransaction(user.uid, transactionToDelete.id);\r\n      console.log('      Firebase userTransactions');\r\n\r\n      //       \r\n      try {\r\n        await auditLogService.saveDeletedTransaction({\r\n          ...transactionToDelete,\r\n          userId: user.uid,\r\n          originalTransactionId: transactionToDelete.id,\r\n          transactionId: (transactionToDelete as any).transactionId || transactionToDelete.id,\r\n          reference: (transactionToDelete as any).reference || (transactionToDelete as any).transactionReference || (transactionToDelete as any).receipt?.reference,\r\n          deletedAt: new Date().toISOString(),\r\n          permanent: true\r\n        });\r\n        console.log('         ');\r\n      } catch (saveError) {\r\n        console.warn('           Firebase :', saveError);\r\n        //        \r\n      }\r\n\r\n      //          \r\n      try {\r\n        await auditLogService.permanentlyDeleteTransaction(transactionToDelete.id, user.uid);\r\n      } catch (e) {\r\n        console.warn('       :', e);\r\n      }\r\n\r\n      // :        Firebase\r\n      const updatedDeletedTransactions = [...deletedTransactions, transactionToDelete];\r\n      const updatedTransactions = transactions.filter(t => t.id !== transactionId);\r\n\r\n      setDeletedTransactions(updatedDeletedTransactions);\r\n      setTransactions(updatedTransactions);\r\n      setIsTransactionDetailsOpen(false);\r\n\r\n      console.log('       Firebase (  )');\r\n\r\n      //   /   Firebase\r\n      try {\r\n        const fromWalletId = (transactionToDelete as any).fromWallet;\r\n        if (fromWalletId) {\r\n          const { walletDailyLimitsService } = await import('@/utils/walletDailyLimitsService');\r\n          const limits = await walletDailyLimitsService.getWalletLimits(fromWalletId);\r\n          if (limits) {\r\n            const isTransfer = transactionToDelete.type === 'send';\r\n            const update: any = { updatedAt: (await import('firebase/firestore')).serverTimestamp() };\r\n            if (isTransfer) {\r\n              update.dailyTransferUsed = Math.max(0, (limits.dailyTransferUsed || 0) - transactionToDelete.amount);\r\n              update.monthlyTransferUsed = Math.max(0, (limits.monthlyTransferUsed || 0) - transactionToDelete.amount);\r\n            } else {\r\n              update.dailyWithdrawUsed = Math.max(0, (limits.dailyWithdrawUsed || 0) - transactionToDelete.amount);\r\n              update.monthlyWithdrawUsed = Math.max(0, (limits.monthlyWithdrawUsed || 0) - transactionToDelete.amount);\r\n            }\r\n            const { doc, setDoc } = await import('firebase/firestore');\r\n            const { db } = await import('@/firebase');\r\n            const ref = doc(db, 'walletLimits', fromWalletId);\r\n            await setDoc(ref, update, { merge: true });\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.warn('     :', e);\r\n      }\r\n\r\n      //       \r\n      try {\r\n        const { ProfitService } = await import('@/utils/profitService');\r\n        const { ReportsService } = await import('@/utils/reportsService');\r\n        const txnType = transactionToDelete.type === 'send' ? 'send' : 'receive';\r\n        const transactionData: any = {\r\n          txnType,\r\n          amount: transactionToDelete.amount,\r\n          commission: transactionToDelete.commission || 0,\r\n          createdAt: transactionToDelete.createdAt,\r\n          status: 'confirmed'\r\n        };\r\n        const profit = ProfitService.calculateProfitFromTransaction(transactionData);\r\n        if (profit > 0) {\r\n          ProfitService.addProfit(-profit, user.uid);\r\n        }\r\n        try {\r\n          ReportsService.removeTransactionEffects(transactionToDelete, user.uid);\r\n        } catch { }\r\n      } catch (e) {\r\n        console.warn('  /  :', e);\r\n      }\r\n\r\n      //   \r\n      toast({\r\n        title: \"   \",\r\n        description: \"     .      \",\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('      Firebase:', error);\r\n\r\n      //      Firebase    \r\n      let errorMessage = \"     .    \";\r\n\r\n      //       \r\n      if (error instanceof Error) {\r\n        if (error.message.includes('network') || error.message.includes('offline')) {\r\n          errorMessage = \"   .      \";\r\n        } else if (error.message.includes('permission') || error.message.includes('unauthorized')) {\r\n          errorMessage = \"     \";\r\n        } else if (error.message.includes('not-found')) {\r\n          errorMessage = \"      \";\r\n        }\r\n      }\r\n\r\n      toast({\r\n        title: \"  \",\r\n        description: errorMessage,\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  };\r\n\r\n  // Calculate withdrawal commission (no default commission - user must enter manually)\r\n  const calculateWithdrawalCommission = (amount: number) => {\r\n    return 0; // No default commission - user must enter manually\r\n  };\r\n\r\n  // Calculate transfer commission (5 per 1000)\r\n  const calculateTransferCommission = (amount: number) => {\r\n    return Math.ceil((amount / 1000) * 5);\r\n  };\r\n\r\n  const getWithdrawalTotal = () => {\r\n    const amountNum = parseFloat(amount) || 0;\r\n    //     -    \r\n    const commission = (manualCommission && manualCommission.trim() !== '') ? parseFloat(manualCommission) : 0;\r\n    return amountNum + commission;\r\n  };\r\n\r\n  const getTransferTotal = () => {\r\n    const amountNum = parseFloat(amount) || 0;\r\n    const commission = (transferCommission && transferCommission.trim() !== '') ? parseFloat(transferCommission) : 0;\r\n    return amountNum + commission;\r\n  };\r\n\r\n  //      \r\n  const isWithdrawTx = (tx: any) => {\r\n    const t = tx.type;\r\n    const xn = (tx as any).txnType;\r\n    return t === 'withdraw' || t === 'withdrawal' || t === 'receive' || xn === 'receive';\r\n  };\r\n  const isSendTx = (tx: any) => {\r\n    const t = tx.type;\r\n    const xn = (tx as any).txnType;\r\n    return t === 'send' || t === 'transfer' || xn === 'send';\r\n  };\r\n\r\n  //      \r\n  const calculateDailyStats = (walletId?: string, dateOverride?: Date) => {\r\n    const baseDateStr = (dateOverride ?? new Date()).toDateString();\r\n    let dayTransactions = transactions.filter(tx => {\r\n      const sameDay = new Date(tx.createdAt).toDateString() === baseDateStr;\r\n      const status = String(tx.status || '').toLowerCase();\r\n      return sameDay && (status === 'completed' || status === 'confirmed' || status === 'pending');\r\n    });\r\n\r\n    //         \r\n    if (walletId) {\r\n      dayTransactions = dayTransactions.filter(tx => tx.fromWallet === walletId);\r\n    }\r\n\r\n    //        \r\n    if (reportSearchPhone && reportSearchPhone.trim() !== '') {\r\n      dayTransactions = dayTransactions.filter(tx =>\r\n        (tx.senderPhone && tx.senderPhone.includes(reportSearchPhone)) ||\r\n        (tx.receiverPhone && tx.receiverPhone.includes(reportSearchPhone))\r\n      );\r\n    }\r\n\r\n    //      \r\n    const visibleTransactions = reportsService.filterVisibleTransactions(dayTransactions, 'daily', user?.uid);\r\n\r\n    const totalTransactions = visibleTransactions.length;\r\n    //        ( )\r\n    const totalAmount = visibleTransactions.reduce((sum, tx) => sum + tx.amount, 0);\r\n\r\n    //     \r\n    const totalWithdrawn = visibleTransactions\r\n      .filter(isWithdrawTx)\r\n      .reduce((sum, tx) => {\r\n        const amount = (tx as any).withdrawnAmount !== undefined ? (tx as any).withdrawnAmount : tx.amount;\r\n        return sum + amount;\r\n      }, 0);\r\n\r\n    const totalSent = visibleTransactions\r\n      .filter(isSendTx)\r\n      .reduce((sum, tx) => {\r\n        const amount = (tx as any).sentAmount !== undefined ? (tx as any).sentAmount : tx.amount;\r\n        return sum + amount;\r\n      }, 0);\r\n\r\n    return { totalTransactions, totalAmount, totalWithdrawn, totalSent };\r\n  };\r\n\r\n  const calculateMonthlyStats = (walletId?: string) => {\r\n    const currentMonth = new Date().getMonth();\r\n    const currentYear = new Date().getFullYear();\r\n\r\n    let monthlyTransactions = transactions.filter(tx => {\r\n      const txDate = new Date(tx.createdAt);\r\n      return txDate.getMonth() === currentMonth &&\r\n        txDate.getFullYear() === currentYear &&\r\n        tx.status === 'completed';\r\n    });\r\n\r\n    //         \r\n    if (walletId) {\r\n      monthlyTransactions = monthlyTransactions.filter(tx => tx.fromWallet === walletId);\r\n    }\r\n\r\n    //        \r\n    if (reportSearchPhone && reportSearchPhone.trim() !== '') {\r\n      monthlyTransactions = monthlyTransactions.filter(tx =>\r\n        (tx.senderPhone && tx.senderPhone.includes(reportSearchPhone)) ||\r\n        (tx.receiverPhone && tx.receiverPhone.includes(reportSearchPhone))\r\n      );\r\n    }\r\n\r\n    //      \r\n    const visibleMonthlyTransactions = reportsService.filterVisibleTransactions(monthlyTransactions, 'monthly', user?.uid);\r\n\r\n    const totalTransactions = visibleMonthlyTransactions.length;\r\n    //        ( )\r\n    const totalAmount = visibleMonthlyTransactions.reduce((sum, tx) => sum + tx.amount, 0);\r\n\r\n    //       \r\n    const totalWithdrawn = visibleMonthlyTransactions\r\n      .filter(isWithdrawTx)\r\n      .reduce((sum, tx) => {\r\n        const amount = (tx as any).withdrawnAmount !== undefined ? (tx as any).withdrawnAmount : tx.amount;\r\n        return sum + amount;\r\n      }, 0);\r\n\r\n    const totalSent = visibleMonthlyTransactions\r\n      .filter(isSendTx)\r\n      .reduce((sum, tx) => {\r\n        const amount = (tx as any).sentAmount !== undefined ? (tx as any).sentAmount : tx.amount;\r\n        return sum + amount;\r\n      }, 0);\r\n\r\n    return { totalTransactions, totalAmount, totalWithdrawn, totalSent };\r\n  };\r\n\r\n  //     \r\n  const calculateWalletMonthlyUsage = (walletId: string) => {\r\n    const currentMonth = new Date().getMonth();\r\n    const currentYear = new Date().getFullYear();\r\n\r\n    const walletTransactions = transactions.filter(tx => {\r\n      const txDate = new Date(tx.createdAt);\r\n      return txDate.getMonth() === currentMonth &&\r\n        txDate.getFullYear() === currentYear &&\r\n        tx.status === 'completed' &&\r\n        tx.fromWallet === walletId;\r\n    });\r\n\r\n    const totalWithdrawn = walletTransactions\r\n      .filter(isWithdrawTx)\r\n      .reduce((sum, tx) => {\r\n        const amount = (tx as any).withdrawnAmount || tx.amount;\r\n        return sum + amount;\r\n      }, 0);\r\n\r\n    const totalTransferred = walletTransactions\r\n      .filter(isSendTx)\r\n      .reduce((sum, tx) => {\r\n        const amount = (tx as any).sentAmount || tx.amount;\r\n        return sum + amount;\r\n      }, 0);\r\n\r\n    return { totalWithdrawn, totalTransferred };\r\n  };\r\n\r\n  //     \r\n  const calculateWalletDailyUsage = (walletId: string) => {\r\n    const today = new Date();\r\n    const currentDay = today.getDate();\r\n    const currentMonth = today.getMonth();\r\n    const currentYear = today.getFullYear();\r\n\r\n    const walletTransactions = transactions.filter(tx => {\r\n      const txDate = new Date(tx.createdAt);\r\n      return txDate.getDate() === currentDay &&\r\n        txDate.getMonth() === currentMonth &&\r\n        txDate.getFullYear() === currentYear &&\r\n        tx.status === 'completed' &&\r\n        tx.fromWallet === walletId;\r\n    });\r\n\r\n    const totalWithdrawn = walletTransactions\r\n      .filter(isWithdrawTx)\r\n      .reduce((sum, tx) => {\r\n        const amount = (tx as any).withdrawnAmount || tx.amount;\r\n        return sum + amount;\r\n      }, 0);\r\n\r\n    const totalTransferred = walletTransactions\r\n      .filter(isSendTx)\r\n      .reduce((sum, tx) => {\r\n        const amount = (tx as any).sentAmount || tx.amount;\r\n        return sum + amount;\r\n      }, 0);\r\n\r\n    return { totalWithdrawn, totalTransferred };\r\n  };\r\n\r\n  //       (   )\r\n  const currentMonthlyStats = React.useMemo(() => calculateMonthlyStats(), [transactions, selectedWallet, reportSearchPhone]);\r\n  const monthlyWithdrawn = currentMonthlyStats.totalWithdrawn;\r\n  const monthlyTransferred = currentMonthlyStats.totalSent;\r\n\r\n  //        \r\n  const walletMonthlyUsageMemo = React.useMemo(\r\n    () => calculateWalletMonthlyUsage(selectedWallet),\r\n    [transactions, selectedWallet]\r\n  );\r\n\r\n  //           ( 85%)\r\n  useEffect(() => {\r\n    try {\r\n      if (!selectedWallet || wallets.length === 0) return;\r\n      const selectedWalletObj = wallets.find(w => w.id === selectedWallet);\r\n      if (!selectedWalletObj) return;\r\n      const monthlyWithdrawalLimit = selectedWalletLimits?.monthlyWithdrawLimit ?? selectedWalletObj?.monthlyWithdrawalLimit ?? 200000;\r\n      const monthlyTransferLimit = selectedWalletLimits?.monthlyTransferLimit ?? selectedWalletObj?.monthlyTransferLimit ?? 200000;\r\n      const amountNum = parseFloat(amount || '0') || 0;\r\n      const monthlyWithdrawUsed = (walletMonthlyUsageMemo as any)?.totalWithdrawn ?? selectedWalletLimits?.monthlyWithdrawUsed ?? 0;\r\n      const monthlyTransferUsed = (walletMonthlyUsageMemo as any)?.totalTransferred ?? selectedWalletLimits?.monthlyTransferUsed ?? 0;\r\n      const predictedMonthlyWithdrawUsed = monthlyWithdrawUsed + (transactionType === 'withdraw' ? amountNum : 0);\r\n      const predictedMonthlyTransferUsed = monthlyTransferUsed + (transactionType === 'transfer' ? amountNum : 0);\r\n\r\n      const percent = 0.85;\r\n      const withdrawThreshold = Math.floor(Math.max(monthlyWithdrawalLimit, 1) * percent);\r\n      const transferThreshold = Math.floor(Math.max(monthlyTransferLimit, 1) * percent);\r\n      const monthKey = (() => {\r\n        const d = new Date();\r\n        return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;\r\n      })();\r\n      const warnKeyBase = `monthlyLimitWarnShown:${selectedWallet}:${monthKey}`;\r\n\r\n      if (predictedMonthlyWithdrawUsed >= withdrawThreshold) {\r\n        const key = `${warnKeyBase}:withdraw`;\r\n        const shown = localStorage.getItem(key) === 'true';\r\n        if (!shown) {\r\n          setMonthlyLimitWarnData({ type: 'withdraw', used: predictedMonthlyWithdrawUsed, limit: monthlyWithdrawalLimit, walletName: selectedWalletObj.name });\r\n          setIsMonthlyLimitWarnOpen(true);\r\n          try { localStorage.setItem(key, 'true'); } catch { }\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (predictedMonthlyTransferUsed >= transferThreshold) {\r\n        const key = `${warnKeyBase}:transfer`;\r\n        const shown = localStorage.getItem(key) === 'true';\r\n        if (!shown) {\r\n          setMonthlyLimitWarnData({ type: 'transfer', used: predictedMonthlyTransferUsed, limit: monthlyTransferLimit, walletName: selectedWalletObj.name });\r\n          setIsMonthlyLimitWarnOpen(true);\r\n          try { localStorage.setItem(key, 'true'); } catch { }\r\n          return;\r\n        }\r\n      }\r\n    } catch { }\r\n  }, [selectedWallet, wallets, selectedWalletLimits, walletMonthlyUsageMemo, transactionType, amount]);\r\n\r\n  //      localStorage:    Firebase \r\n\r\n  //      localStorage:     \r\n\r\n  const handleTransaction = async () => {\r\n    //    ()     \r\n    playVodafoneShakshan();\r\n    console.log('   /');\r\n    console.log('  :', {\r\n      senderPhone,\r\n      receiverPhone,\r\n      amount,\r\n      transactionType\r\n    });\r\n\r\n    //      (Optimistic UI)\r\n    const setSuccessOptimistic = () => {\r\n      if (transactionType === 'transfer') {\r\n        setIsTransferSuccess(true);\r\n      } else {\r\n        setIsWithdrawSuccess(true);\r\n      }\r\n    };\r\n    const revertSuccess = () => {\r\n      if (transactionType === 'transfer') {\r\n        setIsTransferSuccess(false);\r\n      } else {\r\n        setIsWithdrawSuccess(false);\r\n      }\r\n    };\r\n    setSuccessOptimistic();\r\n\r\n    if (!senderPhone || !amount) {\r\n      console.log(' :  ');\r\n      toast({\r\n        title: \"  \",\r\n        description: \"    \",\r\n        variant: \"destructive\",\r\n      });\r\n      revertSuccess();\r\n      return;\r\n    }\r\n\r\n    if (transactionType === 'transfer' && !receiverPhone && !isVodafoneCashUser) {\r\n      console.log(' :   ');\r\n      toast({\r\n        title: \"  \",\r\n        description: \"   \",\r\n        variant: \"destructive\",\r\n      });\r\n      revertSuccess();\r\n      return;\r\n    }\r\n\r\n    //    :       \r\n    //    /      \r\n    if (transactionType === 'transfer' && !isVodafoneCashUser) {\r\n      const onlyDigits = String(receiverPhone || '').replace(/[^0-9-]/g, '');\r\n      const hasLettersOrText = /[^0-9-\\s]/.test(String(receiverPhone || ''));\r\n      if (!hasLettersOrText) {\r\n        if (!strictValidateMsisdn(receiverPhone)) {\r\n          toast({\r\n            title: \"   \",\r\n            description: \"     11    015  010  012  011\",\r\n            variant: \"destructive\",\r\n          });\r\n          revertSuccess();\r\n          return;\r\n        }\r\n      }\r\n    }\r\n\r\n    const amountNum = parseFloat(amount);\r\n    console.log('  :', amountNum);\r\n\r\n    if (amountNum <= 0) {\r\n      console.log(' :   ');\r\n      toast({\r\n        title: \"  \",\r\n        description: \"   \",\r\n        variant: \"destructive\",\r\n      });\r\n      revertSuccess();\r\n      return;\r\n    }\r\n\r\n    //      : 10  \r\n    if (isZeroPlan) {\r\n      try {\r\n        const today = new Date();\r\n        const yyyy = today.getFullYear();\r\n        const mm = String(today.getMonth() + 1).padStart(2, '0');\r\n        const dd = String(today.getDate()).padStart(2, '0');\r\n        const dailyKey = `zeroPlanDailyConfirmCount:${user?.uid || 'default'}:${yyyy}-${mm}-${dd}`;\r\n        const usedCountRaw = localStorage.getItem(dailyKey);\r\n        const usedCount = usedCountRaw ? parseInt(usedCountRaw, 10) || 0 : 0;\r\n        if (usedCount >= 10) {\r\n          toast({\r\n            title: '  ',\r\n            description: '    10  /  .',\r\n            variant: 'destructive',\r\n          });\r\n          revertSuccess();\r\n          return;\r\n        }\r\n      } catch (e) {\r\n        console.warn('        :', e);\r\n      }\r\n    }\r\n\r\n    //      \r\n    const selectedWalletObj = wallets.find(w => w.id === selectedWallet);\r\n    if (!selectedWalletObj) {\r\n      toast({\r\n        title: \"  \",\r\n        description: \"   \",\r\n        variant: \"destructive\",\r\n      });\r\n      revertSuccess();\r\n      return;\r\n    }\r\n\r\n    const walletUsage = walletMonthlyUsageMemo;\r\n    console.log('     ');\r\n    console.log('   :', {\r\n      walletId: selectedWallet,\r\n      walletName: selectedWalletObj.name,\r\n      currentWithdrawn: walletUsage.totalWithdrawn,\r\n      currentTransferred: walletUsage.totalTransferred,\r\n      withdrawalLimit: selectedWalletObj.monthlyWithdrawalLimit,\r\n      transferLimit: selectedWalletObj.monthlyTransferLimit\r\n    });\r\n\r\n    if (transactionType === 'withdraw') {\r\n      console.log('     ');\r\n      console.log(`    : ${walletUsage.totalWithdrawn},  : ${amountNum},  : ${selectedWalletObj.monthlyWithdrawalLimit}`);\r\n\r\n      if (walletUsage.totalWithdrawn + amountNum > selectedWalletObj.monthlyWithdrawalLimit) {\r\n        console.log('     ');\r\n        toast({\r\n          title: \"   \",\r\n          description: `     ${selectedWalletObj.monthlyWithdrawalLimit}     ${selectedWalletObj.name}`,\r\n          variant: \"destructive\",\r\n        });\r\n        revertSuccess();\r\n        return;\r\n      }\r\n    } else {\r\n      console.log('     ');\r\n      console.log(`    : ${walletUsage.totalTransferred},  : ${amountNum},  : ${selectedWalletObj.monthlyTransferLimit}`);\r\n\r\n      if (walletUsage.totalTransferred + amountNum > selectedWalletObj.monthlyTransferLimit) {\r\n        console.log('     ');\r\n        toast({\r\n          title: \"   \",\r\n          description: `     ${selectedWalletObj.monthlyTransferLimit}     ${selectedWalletObj.name}`,\r\n          variant: \"destructive\",\r\n        });\r\n        revertSuccess();\r\n        return;\r\n      }\r\n    }\r\n\r\n    //        (    )\r\n    const merchantShopName = profile?.shopName || user?.displayName || '  ';\r\n\r\n    const newTransaction: Transaction = {\r\n      id: Date.now().toString(),\r\n      type: transactionType === 'transfer' ? 'send' : transactionType === 'deposit' ? 'deposit' : 'withdraw',\r\n      senderPhone,\r\n      receiverPhone: transactionType === 'transfer' ? receiverPhone : senderPhone,\r\n      amount: amountNum,\r\n      status: 'completed',\r\n      createdAt: new Date(),\r\n      withdrawnAmount: transactionType === 'withdraw' ? amountNum : undefined,\r\n      sentAmount: transactionType === 'transfer' ? amountNum : undefined,\r\n      depositedAmount: undefined,\r\n      fromWallet: selectedWallet,\r\n      //    \r\n      senderNumber: senderPhone,\r\n      senderName: transactionType === 'withdraw' && withdrawSenderName.trim() !== '' ? withdrawSenderName.trim() : undefined,\r\n      shopName: selectedWalletObj?.name || ' ',\r\n      transferredAmount: transactionType === 'transfer' ? amountNum : undefined,\r\n      receiverNumber: transactionType === 'transfer' ? receiverPhone : undefined,\r\n      withdrawnAmountDetailed: transactionType === 'withdraw' ? amountNum : undefined,\r\n      depositedAmountDetailed: undefined,\r\n      merchantShopName: merchantShopName,\r\n      transactionReference: `TXN-${Date.now()}`,\r\n      commission: 0, //       \r\n      notes: transactionType === 'transfer'\r\n        ? undefined\r\n        : (withdrawNote && withdrawNote.trim() !== '' ? withdrawNote.trim() : undefined)\r\n    };\r\n\r\n    //               \r\n    if (isShiftActive && (shiftUser?.name || shiftUser?.username)) {\r\n      (newTransaction as any).cashierName = shiftUser?.name || shiftUser?.username;\r\n    }\r\n\r\n    //       \r\n    const validation = WalletCashService.validateTransaction(\r\n      amountNum,\r\n      transactionType,\r\n      cashBalance,\r\n      walletBalances\r\n    );\r\n\r\n    if (!validation.isValid) {\r\n      toast({\r\n        title: \"  \",\r\n        description: validation.error,\r\n        variant: \"destructive\",\r\n      });\r\n      revertSuccess();\r\n      return;\r\n    }\r\n\r\n    //      \r\n    if (validation.warning) {\r\n      toast({\r\n        title: \"\",\r\n        description: validation.warning,\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n\r\n    //  :\r\n    // -      ( )    .\r\n    // -          .\r\n    // -       :    (1%  ).\r\n    let commissionAmount: number;\r\n    if (transactionType === 'transfer') {\r\n      if (selectedWalletObj?.defaultTransferCommission != null) {\r\n        const rate = Number(selectedWalletObj.defaultTransferCommission) || 0;\r\n        commissionAmount = Math.round(((rate * amountNum) / 1000) * 100) / 100;\r\n      } else if (transferCommission && transferCommission.trim() !== '') {\r\n        commissionAmount = Math.max(0, parseFloat(transferCommission));\r\n      } else {\r\n        commissionAmount = 0;\r\n      }\r\n    } else { // withdraw\r\n      if (selectedWalletObj?.defaultWithdrawCommission != null) {\r\n        const rate = Number(selectedWalletObj.defaultWithdrawCommission) || 0;\r\n        commissionAmount = Math.round(((rate * amountNum) / 1000) * 100) / 100;\r\n      } else if (manualCommission && manualCommission.trim() !== '') {\r\n        commissionAmount = Math.max(0, parseFloat(manualCommission));\r\n      } else {\r\n        //   : 1%  \r\n        commissionAmount = Math.round((amountNum * 0.01) * 100) / 100;\r\n      }\r\n    }\r\n\r\n    //        /\r\n    newTransaction.commission = commissionAmount;\r\n\r\n    //        (/)\r\n    if (transactionType !== 'transfer' && !isCommissionAddMode && commissionAmount >= amountNum) {\r\n      toast({\r\n        title: \"  \",\r\n        description: \"      \",\r\n        variant: \"destructive\",\r\n      });\r\n      revertSuccess();\r\n      return;\r\n    }\r\n    const effectiveAmount = transactionType === 'transfer'\r\n      ? amountNum\r\n      : (isCommissionAddMode ? amountNum : Math.round((amountNum - commissionAmount) * 100) / 100);\r\n    //          \r\n    newTransaction.amount = effectiveAmount;\r\n    newTransaction.withdrawnAmount = transactionType === 'withdraw' ? effectiveAmount : undefined;\r\n    newTransaction.sentAmount = transactionType === 'transfer' ? effectiveAmount : undefined;\r\n    newTransaction.transferredAmount = transactionType === 'transfer' ? effectiveAmount : undefined;\r\n    newTransaction.withdrawnAmountDetailed = transactionType === 'withdraw' ? effectiveAmount : undefined;\r\n\r\n    //     \r\n    let result;\r\n    //         (  )\r\n    const isDeferredTransfer = transactionType === 'transfer' && !!quickDebtInfo;\r\n    const isDeferredWithdraw = transactionType === 'withdraw' && !!quickDebtInfo;\r\n    const skipProcess = isDeferredTransfer || isDeferredWithdraw;\r\n    let linkedDebtId: string | null = null;\r\n\r\n    //     010011   \r\n    const sDigits = normalizeDigits(senderPhone || '').replace(/\\D/g, '');\r\n    const rDigits = normalizeDigits(receiverPhone || '').replace(/\\D/g, '');\r\n    const is010To011 = transactionType === 'transfer' && ((sDigits.startsWith('010') && (rDigits.startsWith('011') || rDigits.startsWith('012') || rDigits.startsWith('015'))) || (sDigits.startsWith('012') && rDigits.startsWith('010')) || (sDigits.startsWith('011') && rDigits.startsWith('010')) || (sDigits.startsWith('015') && rDigits.startsWith('010')));\r\n    const extraFee = Math.max(0, parseFloat(transferExtraFee || '0'));\r\n    const fullCommission = Math.round((commissionAmount * 100)) / 100;\r\n    newTransaction.commission = fullCommission;\r\n    (newTransaction as any).fee = extraFee;\r\n    (newTransaction as any).totalCharged = transactionType === 'transfer'\r\n      ? (Number(effectiveAmount) + Number(fullCommission) + Number(extraFee))\r\n      : (isCommissionAddMode ? (Number(effectiveAmount) + Number(fullCommission)) : Number(effectiveAmount));\r\n\r\n    //       \r\n    if (is010To011 && !skipProcess && extraFee <= 0) {\r\n      toast({\r\n        title: \"\",\r\n        description: \"    010  011/012/015  012  010  011  010  015  010\",\r\n        variant: \"destructive\",\r\n      });\r\n      revertSuccess();\r\n      return;\r\n    }\r\n\r\n    //        (  )\r\n    if (transactionType === 'transfer' && !skipProcess) {\r\n      const currentWalletBalance = Number(walletBalances[selectedWallet] || 0);\r\n      const totalDebit = Number(effectiveAmount) + Number(extraFee);\r\n      if (currentWalletBalance < totalDebit) {\r\n        toast({\r\n          title: \"   \",\r\n          description: `  ${currentWalletBalance}    ${totalDebit}`,\r\n          variant: \"destructive\",\r\n        });\r\n        revertSuccess();\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (skipProcess) {\r\n      //  \r\n      if (isDeferredTransfer) {\r\n        const check = WalletCashService.validateTransaction(\r\n          effectiveAmount,\r\n          'transfer',\r\n          cashBalance,\r\n          walletBalances\r\n        );\r\n        if (!check.isValid) {\r\n          result = {\r\n            success: false,\r\n            newCashBalance: cashBalance,\r\n            newWalletBalances: walletBalances,\r\n            message: check.error || '    ',\r\n            error: 'INSUFFICIENT_WALLET_BALANCE'\r\n          } as any;\r\n        } else {\r\n          const effectiveSelectedWalletId = selectedWallet || (wallets.find((w: any) => w.isDefault)?.id) || (wallets[0]?.id);\r\n          const limitsSrc = selectedWalletLimits ?? await walletDailyLimitsService.getWalletLimits(effectiveSelectedWalletId!);\r\n          const todayStr = new Date().toDateString();\r\n          const pendingToday = transactions\r\n            .filter(tx => tx.type === 'send' && String(tx.status || '').toLowerCase() === 'pending' && (tx.fromWallet === effectiveSelectedWalletId) && new Date(tx.createdAt).toDateString() === todayStr)\r\n            .reduce((sum, tx) => sum + Number((tx as any).sentAmount ?? (tx as any).transferredAmount ?? tx.amount ?? 0), 0);\r\n          const dailyLimit = Number((limitsSrc as any)?.dailyTransferLimit ?? 60000);\r\n          const dailyUsed = Number((limitsSrc as any)?.dailyTransferUsed ?? 0);\r\n          if (dailyUsed + pendingToday + Number(effectiveAmount) > dailyLimit) {\r\n            toast({ title: '   ', description: ` : ${(dailyLimit - dailyUsed - pendingToday).toLocaleString()} .`, variant: 'destructive' });\r\n            revertSuccess();\r\n            return;\r\n          }\r\n\r\n          const now = new Date();\r\n          const pendingMonth = transactions\r\n            .filter(tx => tx.type === 'send' && String(tx.status || '').toLowerCase() === 'pending' && (tx.fromWallet === effectiveSelectedWalletId) && new Date(tx.createdAt).getMonth() === now.getMonth() && new Date(tx.createdAt).getFullYear() === now.getFullYear())\r\n            .reduce((sum, tx) => sum + Number((tx as any).sentAmount ?? (tx as any).transferredAmount ?? tx.amount ?? 0), 0);\r\n          const monthlyLimit = Number((limitsSrc as any)?.monthlyTransferLimit ?? 200000);\r\n          const monthlyUsed = Number((limitsSrc as any)?.monthlyTransferUsed ?? 0);\r\n          if (monthlyUsed + pendingMonth + Number(effectiveAmount) > monthlyLimit) {\r\n            toast({ title: '   ', description: `  : ${(monthlyLimit - monthlyUsed - pendingMonth).toLocaleString()} .`, variant: 'destructive' });\r\n            revertSuccess();\r\n            return;\r\n          }\r\n\r\n          result = { success: true, newCashBalance: cashBalance, newWalletBalances: walletBalances } as any;\r\n        }\r\n      } else {\r\n        const effectiveSelectedWalletId = selectedWallet || (wallets.find((w: any) => w.isDefault)?.id) || (wallets[0]?.id);\r\n        const limitsSrc = selectedWalletLimits ?? await walletDailyLimitsService.getWalletLimits(effectiveSelectedWalletId!);\r\n        const todayStr = new Date().toDateString();\r\n        const pendingToday = transactions\r\n          .filter(tx => tx.type === 'withdraw' && String(tx.status || '').toLowerCase() === 'pending' && (tx.fromWallet === effectiveSelectedWalletId) && new Date(tx.createdAt).toDateString() === todayStr)\r\n          .reduce((sum, tx) => sum + Number((tx as any).withdrawnAmount ?? tx.amount ?? 0), 0);\r\n        const dailyLimit = Number((limitsSrc as any)?.dailyWithdrawLimit ?? 100000);\r\n        const dailyUsed = Number((limitsSrc as any)?.dailyWithdrawUsed ?? 0);\r\n        if (dailyUsed + pendingToday + Number(effectiveAmount) > dailyLimit) {\r\n          toast({ title: '   ', description: ` : ${(dailyLimit - dailyUsed - pendingToday).toLocaleString()} .`, variant: 'destructive' });\r\n          revertSuccess();\r\n          return;\r\n        }\r\n\r\n        const now = new Date();\r\n        const pendingMonth = transactions\r\n          .filter(tx => tx.type === 'withdraw' && String(tx.status || '').toLowerCase() === 'pending' && (tx.fromWallet === effectiveSelectedWalletId) && new Date(tx.createdAt).getMonth() === now.getMonth() && new Date(tx.createdAt).getFullYear() === now.getFullYear())\r\n          .reduce((sum, tx) => sum + Number((tx as any).withdrawnAmount ?? tx.amount ?? 0), 0);\r\n        const monthlyLimit = Number((limitsSrc as any)?.monthlyWithdrawLimit ?? 200000);\r\n        const monthlyUsed = Number((limitsSrc as any)?.monthlyWithdrawUsed ?? 0);\r\n        if (monthlyUsed + pendingMonth + Number(effectiveAmount) > monthlyLimit) {\r\n          toast({ title: '   ', description: `  : ${(monthlyLimit - monthlyUsed - pendingMonth).toLocaleString()} .`, variant: 'destructive' });\r\n          revertSuccess();\r\n          return;\r\n        }\r\n\r\n        const newCash = Math.round((Number(cashBalance) - Number(effectiveAmount)) * 100) / 100;\r\n        result = { success: true, newCashBalance: newCash, newWalletBalances: walletBalances } as any;\r\n      }\r\n    } else if (transactionType === 'transfer') {\r\n      // :      \r\n      result = await WalletCashService.processTransfer({\r\n        amount: effectiveAmount,\r\n        currentCashBalance: cashBalance,\r\n        currentWalletBalances: walletBalances,\r\n        wallets: wallets,\r\n        selectedWalletId: selectedWallet,\r\n        //     /\r\n        skipRemoteLimitsCheck: false,\r\n        nonBlockingUsageUpdate: true\r\n      });\r\n    } else {\r\n      // :      \r\n      result = await WalletCashService.processWithdraw({\r\n        amount: effectiveAmount,\r\n        currentCashBalance: cashBalance,\r\n        currentWalletBalances: walletBalances,\r\n        wallets: wallets,\r\n        selectedWalletId: selectedWallet,\r\n        //     /\r\n        skipRemoteLimitsCheck: false,\r\n        nonBlockingUsageUpdate: true\r\n      });\r\n    }\r\n\r\n    if (!result.success) {\r\n      toast({\r\n        title: \"  \",\r\n        description: result.error || result.message,\r\n        variant: \"destructive\",\r\n      });\r\n      revertSuccess();\r\n      return;\r\n    }\r\n\r\n    //       \r\n    let newCashBalance = skipProcess ? (isDeferredWithdraw ? result.newCashBalance : cashBalance) : result.newCashBalance;\r\n    let newWalletBalances = skipProcess ? walletBalances : result.newWalletBalances;\r\n    //          \r\n    if (!skipProcess && transactionType === 'transfer' && extraFee > 0) {\r\n      const prevBalance = Number(newWalletBalances[selectedWallet] || 0);\r\n      newWalletBalances = {\r\n        ...newWalletBalances,\r\n        [selectedWallet]: Math.round((prevBalance - Number(extraFee)) * 100) / 100,\r\n      };\r\n    }\r\n    //          \r\n    //       \r\n\r\n    //              \r\n    if (skipProcess && isDeferredTransfer) {\r\n      const walletObj =\r\n        wallets.find((w: any) => w.id === selectedWallet) ??\r\n        wallets.find((w: any) => w.isDefault) ??\r\n        wallets[0];\r\n      const effectiveSelectedWalletId = walletObj?.id || selectedWallet;\r\n\r\n      if (effectiveSelectedWalletId !== selectedWallet) {\r\n        try {\r\n          setWalletSelection(effectiveSelectedWalletId);\r\n        } catch { }\r\n      }\r\n\r\n      const previousBalance = Number(walletBalances[effectiveSelectedWalletId] || 0);\r\n      newWalletBalances = {\r\n        ...walletBalances,\r\n        [effectiveSelectedWalletId]: Math.round((previousBalance - Number(effectiveAmount) - Number(extraFee)) * 100) / 100\r\n      };\r\n    }\r\n\r\n    //     (  )       \r\n    if ((isDeferredTransfer || isDeferredWithdraw) && quickDebtInfo && !didCreateQuickDebt) {\r\n      const newDebt: Debt = {\r\n        id: `DEBT-${Date.now()}`,\r\n        debtorName: quickDebtInfo.debtorName,\r\n        amount: quickDebtInfo.amount,\r\n        reason: quickDebtInfo.notes || '',\r\n        customerId: quickDebtInfo.customerId,\r\n        mobile: quickDebtInfo.mobile,\r\n        status: 'pending',\r\n        createdAt: new Date(),\r\n      };\r\n      linkedDebtId = newDebt.id;\r\n      const updatedDebts = [newDebt, ...debts];\r\n      setDebts(updatedDebts);\r\n      try {\r\n        await saveDebtsToStorage(updatedDebts);\r\n      } catch (e) {\r\n        console.error('     :', e);\r\n      }\r\n      toast({ title: '  ', description: '      ', variant: 'default' });\r\n    }\r\n\r\n    //      ( )\r\n    //          \r\n    if (!skipProcess) {\r\n      const addToCash = Math.max(0, Number(commissionAmount)) + Math.max(0, Number(extraFee));\r\n      if (addToCash > 0) {\r\n        newCashBalance = Math.round((newCashBalance + addToCash) * 100) / 100;\r\n        console.log(`   / ${addToCash}   `);\r\n      }\r\n    }\r\n\r\n    //          startTransition\r\n    console.log('       startTransition...');\r\n    const updatedTransactionsList = [newTransaction, ...transactions];\r\n    React.startTransition(() => {\r\n      setCashBalance(newCashBalance);\r\n      setWalletBalances(newWalletBalances);\r\n      if (skipProcess) {\r\n        (newTransaction as any).status = 'pending';\r\n      }\r\n      setTransactions(updatedTransactionsList);\r\n    });\r\n    try {\r\n      setTimeout(() => {\r\n        try {\r\n          localStorage.setItem(getTransactionsKey(), JSON.stringify(updatedTransactionsList));\r\n        } catch { }\r\n      }, 0);\r\n    } catch { }\r\n\r\n    //       \r\n    if (isZeroPlan) {\r\n      try {\r\n        const today = new Date();\r\n        const yyyy = today.getFullYear();\r\n        const mm = String(today.getMonth() + 1).padStart(2, '0');\r\n        const dd = String(today.getDate()).padStart(2, '0');\r\n        const dailyKey = `zeroPlanDailyConfirmCount:${user?.uid || 'default'}:${yyyy}-${mm}-${dd}`;\r\n        const usedCountRaw = localStorage.getItem(dailyKey);\r\n        const usedCount = usedCountRaw ? parseInt(usedCountRaw, 10) || 0 : 0;\r\n        localStorage.setItem(dailyKey, String(usedCount + 1));\r\n      } catch { }\r\n    }\r\n\r\n    //     localStorage      \r\n    setTimeout(() => {\r\n      try {\r\n        localStorage.setItem(getCashBalanceKey(), newCashBalance.toString());\r\n        localStorage.setItem(getWalletBalancesKey(), JSON.stringify(newWalletBalances));\r\n      } catch { }\r\n    }, 0);\r\n\r\n    try {\r\n      if (user?.uid) {\r\n        const walletObj =\r\n          wallets.find((w: any) => w.id === selectedWallet) ??\r\n          wallets.find((w: any) => w.isDefault) ??\r\n          wallets[0];\r\n        const effectiveWalletId = walletObj?.id || selectedWallet;\r\n        const remainingWalletBalance = Number((newWalletBalances as any)[effectiveWalletId] || 0);\r\n        const srcPhone = String(walletObj?.phone || senderPhone || '').trim();\r\n        const dstPhone = String(receiverPhone || '').trim();\r\n        const hasFee = Number(extraFee) > 0;\r\n        const mark = transactionType === 'transfer' ? '' : '';\r\n        const commissionPart = Number(fullCommission) > 0 ? `${Number(fullCommission)} ` : '0 ';\r\n        const feePart = hasFee ? `   ${Number(extraFee)} ` : '';\r\n        const msg = transactionType === 'transfer'\r\n          ? `${mark}    ${Number(effectiveAmount)}     ${srcPhone}    ${dstPhone}    ${commissionPart}${feePart}.    : ${remainingWalletBalance} .   : ${Number(newCashBalance)} .`\r\n          : `${mark}    ${Number(effectiveAmount)}       ${srcPhone}    ${commissionPart}${feePart}.    : ${remainingWalletBalance} .   : ${Number(newCashBalance)} .`;\r\n        const key = user?.uid ? `tg_last_msg_${user.uid}` : 'tg_last_msg';\r\n        const now = Date.now();\r\n        let shouldSend = true;\r\n        try {\r\n          const raw = localStorage.getItem(key);\r\n          if (raw) {\r\n            const prev = JSON.parse(raw);\r\n            const prevMsg = String(prev?.text || '');\r\n            const prevAt = Number(prev?.at || 0);\r\n            if (prevMsg === msg && now - prevAt < 5000) shouldSend = false;\r\n          }\r\n        } catch {}\r\n        if (shouldSend) {\r\n          Promise.resolve(telegramNotifier.send(user.uid, msg)).catch(() => {});\r\n          try { localStorage.setItem(key, JSON.stringify({ text: msg, at: now })); } catch {}\r\n        }\r\n      }\r\n    } catch {}\r\n\r\n    //     - \r\n    // toast({\r\n    //   title: transactionType === 'transfer' ? \"  \" : \"  \",\r\n    //   description: \"       ...\",\r\n    // });\r\n\r\n    //      Firebase  \r\n    (async () => {\r\n      try {\r\n        console.log('     Firebase  ...');\r\n\r\n        //      Firebase Transaction type\r\n        const transactionDataCreate = {\r\n          shopId: (shopIdCtx || profile?.shopId || user?.uid || 'default-shop'),\r\n          lineId: selectedWallet || 'default-line',\r\n          walletId: selectedWallet || undefined,\r\n          merchantUserId: user?.uid || null,\r\n          provider: 'vodafone_cash' as const,\r\n          txnType: transactionType === 'transfer' ? 'send' as const : 'receive' as const,\r\n          originType: transactionType === 'transfer' ? 'transfer' as const : 'withdraw' as const,\r\n          amount: effectiveAmount,\r\n          commission: fullCommission,\r\n          fee: extraFee,\r\n          profit: 0,\r\n          senderMsisdn: senderPhone,\r\n          receiverMsisdn: transactionType === 'transfer' ? receiverPhone : senderPhone,\r\n          //           \r\n          note: transactionType === 'transfer'\r\n            ? undefined\r\n            : (withdrawNote && withdrawNote.trim() !== '' ? withdrawNote.trim() : undefined),\r\n          status: (skipProcess ? 'pending' as const : 'confirmed' as const),\r\n          linkedDebtId: linkedDebtId || undefined,\r\n          createdBy: user?.uid || null,\r\n          walletEffectAppliedOnCreation: false,\r\n          cashEffectAppliedOnCreation: !!(skipProcess && isDeferredWithdraw),\r\n          limitsReservedOnCreation: !!(skipProcess),\r\n          limitReservedType: (transactionType === 'transfer' ? 'transfer' as const : 'withdraw' as const),\r\n          profitAddedOnCreation: false\r\n        };\r\n        const transactionDataForUser = {\r\n          ...transactionDataCreate,\r\n          status: (skipProcess ? 'pending' as const : 'completed' as const),\r\n          commissionMode: transactionType === 'transfer' ? 'add' : (isCommissionAddMode ? 'add' : 'deduct'),\r\n          totalCharged: transactionType === 'transfer' ? (effectiveAmount + fullCommission + extraFee) : (isCommissionAddMode ? (effectiveAmount + commissionAmount) : effectiveAmount),\r\n          walletEffectAppliedOnCreation: false,\r\n          cashEffectAppliedOnCreation: !!(skipProcess && isDeferredWithdraw),\r\n          limitsReservedOnCreation: !!(skipProcess),\r\n          limitReservedType: (transactionType === 'transfer' ? 'transfer' as const : 'withdraw' as const),\r\n          sentAmount: transactionType === 'transfer' ? effectiveAmount : undefined,\r\n          transferredAmount: transactionType === 'transfer' ? effectiveAmount : undefined,\r\n          withdrawnAmount: transactionType === 'withdraw' ? effectiveAmount : undefined,\r\n          senderName: transactionType === 'withdraw' && withdrawSenderName.trim() !== '' ? withdrawSenderName.trim() : undefined,\r\n          //     \r\n          createdAt: new Date()\r\n        };\r\n\r\n        //        \r\n        const { ProfitService } = await import('@/utils/profitService');\r\n        const profit = ProfitService.calculateProfitFromTransaction({ ...transactionDataForUser, status: 'confirmed' });\r\n        if (profit > 0) {\r\n          ProfitService.addProfit(profit, user?.uid);\r\n          (transactionDataCreate as any).profitAddedOnCreation = true;\r\n          (transactionDataForUser as any).profitAddedOnCreation = true;\r\n          console.log('   :', profit, '');\r\n        }\r\n\r\n        //           \r\n        const createdTransactionId = await transactionService.create(transactionDataCreate);\r\n\r\n        if (selectedWallet) {\r\n          try {\r\n            await walletDailyLimitsService.updateUsage(selectedWallet, effectiveAmount, transactionType === 'transfer' ? 'transfer' : 'withdraw');\r\n            try { window.dispatchEvent(new CustomEvent('walletLimitsUpdated', { detail: { walletId: selectedWallet } })); } catch { }\r\n            try { await refreshSelectedWalletLimits(); } catch { }\r\n          } catch (e) { }\r\n        }\r\n\r\n        await Promise.all([\r\n          ...(user?.uid ? [userDataService.updateUserData(user.uid, {\r\n            cashBalance: newCashBalance,\r\n            walletBalances: newWalletBalances,\r\n            lastUpdated: new Date().toISOString()\r\n          })] : []),\r\n          ...(user?.uid ? [userDataService.saveUserTransaction(user.uid, {\r\n            ...transactionDataForUser,\r\n            transactionType,\r\n            fromWallet: selectedWallet,\r\n            toWallet: transactionType === 'transfer' ? (isDeferredTransfer ? null : 'cash') : null,\r\n            cashierName: isShiftActive ? (shiftUser?.name || shiftUser?.username || ' ') : ' ',\r\n            linkedDebtId: linkedDebtId || undefined,\r\n            transactionId: createdTransactionId,\r\n            description: `${transactionType === 'transfer' ? '' : ''} ${effectiveAmount}  ${selectedWallet} ${transactionType === 'transfer' ? (isDeferredTransfer ? '' : '  ') : ''}  : ${commissionAmount} (${transactionType === 'transfer' ? '' : (isCommissionAddMode ? '' : '')})${extraFee > 0 ? `  : ${extraFee}` : ''}${skipProcess ? '    ( )' : ''}`\r\n          })] : [])\r\n        ]);\r\n\r\n\r\n\r\n        console.log('      Firebase ');\r\n        try { queryClientHook.invalidateQueries({ queryKey: ['recentTransactions', user?.uid, (shopIdCtx || 'main')] }); } catch {}\r\n        try { await recentTransactionsQuery.refetch(); } catch {}\r\n\r\n        //       \r\n        const localDataKey = `userData_${user?.uid}`;\r\n        const localData = {\r\n          cashBalance: newCashBalance,\r\n          walletBalances: newWalletBalances,\r\n          lastUpdated: new Date().toISOString()\r\n        };\r\n        localStorage.setItem(localDataKey, JSON.stringify(localData));\r\n\r\n      } catch (error) {\r\n        console.error('      Firebase ( ):', error);\r\n\r\n        //      Firebase    \r\n        //     \r\n        try {\r\n          if (user?.uid) {\r\n            userDataService.saveLocalReceipt(user.uid, {\r\n              ...transactionDataForUser,\r\n              transactionType,\r\n              fromWallet: selectedWallet,\r\n              toWallet: transactionType === 'transfer' ? (isDeferredTransfer ? null : 'cash') : null,\r\n              cashierName: isShiftActive ? (shiftUser?.name || shiftUser?.username || ' ') : ' ',\r\n              linkedDebtId: linkedDebtId || undefined,\r\n              description: `${transactionType === 'transfer' ? '' : ''} ${effectiveAmount}  ${selectedWallet} ${transactionType === 'transfer' ? (isDeferredTransfer ? '' : '  ') : ''}  : ${commissionAmount} (${transactionType === 'transfer' ? '' : (isCommissionAddMode ? '' : '')})${extraFee > 0 ? `  : ${extraFee}` : ''}${skipProcess ? '    ( )' : ''}`\r\n            });\r\n          }\r\n        } catch { }\r\n        toast({ title: \"\", description: \"        .     .\", variant: \"destructive\" });\r\n      }\r\n    })();\r\n\r\n    //       +    \r\n    if (transactionType === 'transfer') {\r\n      setIsTransferSuccess(true);\r\n      //        ( )\r\n      const amountToReceive = Number(amountNum) + Number(commissionAmount) + Math.max(0, Number(extraFee));\r\n      setPostConfirmInfo({ type: 'transfer', amount: Math.max(0, Math.round(amountToReceive * 100) / 100) });\r\n      //      USSD \r\n      setLastUSSDTransfer({ receiver: receiverPhone, amount: amountNum });\r\n      setIsPostConfirmPopupOpen(true);\r\n      //      \r\n      setTimeout(() => {\r\n        setIsTransferSuccess(false);\r\n      }, 2000);\r\n    } else {\r\n      setIsWithdrawSuccess(true);\r\n      //      \r\n      const amountToDeliver = isCommissionAddMode\r\n        ? Number(amountNum)\r\n        : Math.max(0, Math.round((Number(amountNum) - Number(commissionAmount)) * 100) / 100);\r\n      setPostConfirmInfo({ type: 'withdraw', amount: Math.max(0, Math.round(amountToDeliver * 100) / 100) });\r\n      setIsPostConfirmPopupOpen(true);\r\n      //      \r\n      setTimeout(() => {\r\n        setIsWithdrawSuccess(false);\r\n      }, 2000);\r\n    }\r\n\r\n    // Clear form\r\n    setReceiverPhone('');\r\n    setAmount('');\r\n    setWithdrawNote('');\r\n    setWithdrawSenderName('');\r\n    setQuickDebtInfo(null);\r\n    setQuickDebtName('');\r\n    setQuickDebtAmount('');\r\n    setQuickDebtNotes('');\r\n    setDidCreateQuickDebt(false);\r\n  };\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return <CheckCircle className=\"h-2.5 w-2.5 text-green-500\" />;\r\n      case 'pending':\r\n        return <Clock className=\"h-2.5 w-2.5 text-yellow-500\" />;\r\n      case 'failed':\r\n        return <XCircle className=\"h-2.5 w-2.5 text-red-500\" />;\r\n      default:\r\n        return <Clock className=\"h-2.5 w-2.5 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  const getStatusText = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return '';\r\n      case 'pending':\r\n        return ' ';\r\n      case 'failed':\r\n        return '';\r\n      default:\r\n        return ' ';\r\n    }\r\n  };\r\n\r\n  const dateFormatter = React.useMemo(() => new Intl.DateTimeFormat('ar-EG'), []);\r\n  const timeFormatter = React.useMemo(() => new Intl.DateTimeFormat('ar-EG', { hour: '2-digit', minute: '2-digit' }), []);\r\n  const totalOutstandingDebts = React.useMemo(() => {\r\n    try {\r\n      return debts.reduce((sum, d) => {\r\n        const paid = Number(d.paidAmount || 0);\r\n        const outstanding = Math.max(0, Number(d.amount || 0) - paid);\r\n        return sum + outstanding;\r\n      }, 0);\r\n    } catch {\r\n      return 0;\r\n    }\r\n  }, [debts]);\r\n  const filteredTransactions = React.useMemo(() => {\r\n    const base = getFilteredTransactions();\r\n    return base.filter(transaction => {\r\n      if (activeTab === 'all') return true;\r\n      if (activeTab === 'send') return transaction.type === 'send';\r\n      if (activeTab === 'receive') return transaction.type === 'receive';\r\n      if (activeTab === 'withdraw') return transaction.type === 'withdraw';\r\n      if (activeTab === 'deleted') return false; //    \r\n      return true;\r\n    });\r\n  }, [getFilteredTransactions, activeTab]);\r\n\r\n  //    \r\n  const restoreTransaction = (transactionId: string) => {\r\n    const transactionToRestore = deletedTransactions.find(t => t.id === transactionId);\r\n\r\n    if (transactionToRestore) {\r\n      //     \r\n      const updatedTransactions = [transactionToRestore, ...transactions];\r\n      setTransactions(updatedTransactions);\r\n\r\n      //     \r\n      const updatedDeletedTransactions = deletedTransactions.filter(t => t.id !== transactionId);\r\n      setDeletedTransactions(updatedDeletedTransactions);\r\n      localStorage.setItem(getDeletedTransactionsKey(), JSON.stringify(updatedDeletedTransactions));\r\n\r\n      toast({\r\n        title: \"  \",\r\n        description: \"      \",\r\n      });\r\n    }\r\n  };\r\n\r\n  //    \r\n  const permanentlyDeleteTransaction = async (transactionId: string) => {\r\n    //     \r\n    if (!user?.uid) {\r\n      toast({\r\n        title: \"  \",\r\n        description: \"     \",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      //      \r\n      const updatedDeletedTransactions = deletedTransactions.filter(t => t.id !== transactionId);\r\n      setDeletedTransactions(updatedDeletedTransactions);\r\n      localStorage.setItem(getDeletedTransactionsKey(), JSON.stringify(updatedDeletedTransactions));\r\n\r\n      //    Firebase (deletedTransactions + userTransactions + transactions)\r\n      await auditLogService.permanentlyDeleteTransaction(transactionId, user.uid);\r\n      await userDataService.removeUserTransaction(user.uid, transactionId);\r\n\r\n      toast({\r\n        title: \"   \",\r\n        description: \"      \",\r\n      });\r\n    } catch (error) {\r\n      console.error('   :', error);\r\n      toast({\r\n        title: \"   \",\r\n        description: \"     .    \",\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  };\r\n\r\n  //  \r\n  const handleResetDaily = () => {\r\n    setResetType('daily');\r\n    setIsResetDialogOpen(true);\r\n  };\r\n\r\n  const handleResetMonthly = () => {\r\n    setResetType('monthly');\r\n    setIsResetDialogOpen(true);\r\n  };\r\n\r\n  const handleResetSuccess = () => {\r\n    if (resetType === 'daily') {\r\n      //    \r\n      const hiddenIds = reportsService.resetReportsManually('daily', transactions, user?.uid);\r\n\r\n      //   \r\n      setIsResetDialogOpen(false);\r\n\r\n      //    \r\n      toast({\r\n        title: \"   \",\r\n        description: `  ${hiddenIds.length}     (  )`,\r\n      });\r\n    } else {\r\n      //    \r\n      const hiddenIds = reportsService.resetReportsManually('monthly', transactions, user?.uid);\r\n\r\n      //   \r\n      setIsResetDialogOpen(false);\r\n\r\n      //    \r\n      toast({\r\n        title: \"   \",\r\n        description: `  ${hiddenIds.length}     (  )`,\r\n      });\r\n    }\r\n  };\r\n\r\n  const getResetDialogTitle = () => {\r\n    return resetType === 'daily' ? '  ' : '  ';\r\n  };\r\n\r\n  const getResetDialogDescription = () => {\r\n    return resetType === 'daily'\r\n      ? '       '\r\n      : '       ';\r\n  };\r\n\r\n  //   \r\n  const handleEditCashBalance = () => {\r\n    setIsEditCashDialogOpen(true);\r\n  };\r\n\r\n  const handleEditWalletBalance = (walletId: string) => {\r\n    setEditingWalletId(walletId);\r\n    setIsAddToWalletDialogOpen(true);\r\n  };\r\n\r\n  const handleEditCashSuccess = (newBalance: number) => {\r\n    const previousBalance = cashBalance;\r\n    const delta = Number(newBalance) - Number(previousBalance);\r\n    setCashBalance(newBalance);\r\n    localStorage.setItem(getCashBalanceKey(), newBalance.toString());\r\n    setIsEditCashDialogOpen(false);\r\n\r\n    const updateData = { cashBalance: newBalance, lastUpdated: new Date().toISOString() };\r\n    const localDataKey = `userData_${user?.uid}`;\r\n    try { localStorage.setItem(localDataKey, JSON.stringify(updateData)); } catch { }\r\n\r\n    const ops: Array<Promise<any>> = [];\r\n    if (user?.uid) {\r\n      ops.push(userDataService.updateUserData(user.uid, updateData).then(() => { try { localStorage.removeItem(localDataKey); } catch { }; }).catch(() => { }));\r\n      const receiptRef = `${delta > 0 ? 'CASHADD' : 'CASHDEDUCT'}-${user?.uid || 'anon'}-${Date.now()}`;\r\n      const txToCloud: any = delta > 0\r\n        ? { txnType: 'cash_addition', type: 'cash_addition', amount: delta, status: 'confirmed', senderMsisdn: ' ', receiverMsisdn: '', reference: receiptRef, title: '  ', merchantUserId: user.uid, createdBy: user.uid, shopId: (profile as any)?.shopId || undefined }\r\n        : (delta < 0\r\n          ? { amount: Math.abs(delta), status: 'completed', title: '    ', merchantUserId: user.uid, createdBy: user.uid, shopId: (profile as any)?.shopId || undefined }\r\n          : null);\r\n      if (txToCloud) { ops.push(userDataService.saveUserTransaction(user.uid, txToCloud)); }\r\n      const shopId = (profile as any)?.shopId;\r\n      if (shopId) {\r\n        const dataRef = doc(db, 'dashboardData', shopId);\r\n        ops.push(updateDoc(dataRef, { cashBalance: newBalance }));\r\n      }\r\n    }\r\n    Promise.allSettled(ops).then(() => { }).catch(() => { });\r\n\r\n    toast({\r\n      title: delta > 0 ? '  ' : (delta < 0 ? '  ' : '   '),\r\n      description: delta !== 0 ? `: ${Math.abs(delta)}   : ${newBalance} ` : `     ${newBalance} `,\r\n    });\r\n  };\r\n\r\n  //        \r\n  const handleEditWalletBalanceSuccess = async (newBalance: number) => {\r\n    if (!editingWalletId) {\r\n      console.warn('      ');\r\n      return;\r\n    }\r\n\r\n    const updatedBalances = {\r\n      ...walletBalances,\r\n      [editingWalletId]: newBalance,\r\n    };\r\n\r\n    //   \r\n    setWalletBalances(updatedBalances);\r\n\r\n    //     \r\n    const timestamp = new Date().toISOString();\r\n    const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp };\r\n    const localDataKey = `userData_${user?.uid}`;\r\n    try {\r\n      localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n      localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\r\n      localStorage.setItem(`walletBalances_backup_${timestamp}`, JSON.stringify(updatedBalances));\r\n    } catch { }\r\n\r\n    try {\r\n      if (user?.uid) {\r\n        await userDataService.updateUserData(user.uid, updateData);\r\n      }\r\n    } catch (e) {\r\n      console.error('      Firebase:', e);\r\n    }\r\n\r\n    setIsEditWalletDialogOpen(false);\r\n    const walletName = wallets.find(w => w.id === editingWalletId)?.name || '';\r\n    toast({\r\n      title: '   ',\r\n      description: `   ${walletName}  ${newBalance.toLocaleString()} `,\r\n    });\r\n  };\r\n\r\n  const handleAddToWalletSuccess = async (addedAmount: number) => {\r\n    console.log('    ');\r\n    console.log('   :', editingWalletId);\r\n    console.log('  /:', addedAmount);\r\n\r\n    if (editingWalletId) {\r\n      const currentBalance = walletBalances[editingWalletId] || 0;\r\n      console.log('  :', currentBalance);\r\n\r\n      const newBalance = currentBalance + addedAmount;\r\n      console.log('  :', newBalance);\r\n\r\n      const updatedBalances = {\r\n        ...walletBalances,\r\n        [editingWalletId]: newBalance\r\n      };\r\n\r\n      console.log('  :', updatedBalances);\r\n\r\n      //    \r\n      setWalletBalances(updatedBalances);\r\n\r\n      //        \r\n      const timestamp = new Date().toISOString();\r\n      const updateData = {\r\n        walletBalances: updatedBalances,\r\n        lastUpdated: timestamp\r\n      };\r\n\r\n      //  :   localStorage   \r\n      const localDataKey = `userData_${user?.uid}`;\r\n      localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n\r\n      //  :    \r\n      localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\r\n\r\n      //  :    \r\n      localStorage.setItem(`walletBalances_backup_${timestamp}`, JSON.stringify(updatedBalances));\r\n\r\n      try {\r\n\r\n        //    Firebase\r\n        if (user?.uid) {\r\n          console.log('    Firebase...');\r\n          try {\r\n            await userDataService.updateUserData(user.uid, updateData);\r\n            console.log('     Firebase ');\r\n\r\n            //          \r\n            setTimeout(() => {\r\n              localStorage.removeItem(localDataKey);\r\n              console.log('        ');\r\n            }, 60000); //    \r\n\r\n          } catch (error) {\r\n            console.error('      Firebase:', error);\r\n            //       Firebase\r\n            setHasLocalDataToSync(true);\r\n          }\r\n        } else {\r\n          //         localStorage  \r\n          console.log('       localStorage');\r\n          localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\r\n        }\r\n\r\n        const walletName = wallets.find(w => w.id === editingWalletId)?.name || '';\r\n        const operationType = addedAmount > 0 ? '' : '';\r\n        const operationAmount = Math.abs(addedAmount);\r\n\r\n        toast({\r\n          title: ` ${operationType}  ${operationType === '' ? '' : ''}  `,\r\n          description: ` ${operationType} ${operationAmount}  ${operationType === '' ? '' : ''}  ${walletName}.  : ${newBalance.toLocaleString()} `,\r\n        });\r\n      } catch (error) {\r\n        console.error('      Firebase:', error);\r\n\r\n        //     Firebase   localStorage  \r\n        localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\r\n\r\n        //    \r\n        if (user?.uid) {\r\n          const localDataKey = `userData_${user.uid}`;\r\n          const localData = {\r\n            walletBalances: updatedBalances,\r\n            lastUpdated: new Date().toISOString()\r\n          };\r\n          localStorage.setItem(localDataKey, JSON.stringify(localData));\r\n          setHasLocalDataToSync(true);\r\n        }\r\n\r\n        toast({\r\n          title: \"   \",\r\n          description: \"        \",\r\n          variant: \"default\",\r\n        });\r\n      }\r\n    } else {\r\n      console.log('     ');\r\n    }\r\n\r\n    //     (  5  )\r\n    setTimeout(() => {\r\n      const allKeys = Object.keys(localStorage);\r\n      const backupKeys = allKeys.filter(key => key.startsWith('walletBalances_backup_')).sort();\r\n\r\n      if (backupKeys.length > 5) {\r\n        const keysToDelete = backupKeys.slice(0, backupKeys.length - 5);\r\n        keysToDelete.forEach(key => {\r\n          localStorage.removeItem(key);\r\n          console.log('    :', key);\r\n        });\r\n      }\r\n    }, 5000); //   5 \r\n\r\n    setIsAddToWalletDialogOpen(false);\r\n    setEditingWalletId('');\r\n  };\r\n\r\n  console.log(' UserDashboardPage - Render conditions:', {\r\n    isCheckingActivation,\r\n    isUserActive,\r\n    showActivationModal\r\n  });\r\n\r\n  //   :        (  )\r\n\r\n  //           \r\n  if (isCheckingActivation) {\r\n    console.log(' UserDashboardPage - Showing loading screen');\r\n    return <LogoLoader />;\r\n  }\r\n\r\n  console.log(' UserDashboardPage - Rendering main dashboard');\r\n\r\n  return (\r\n    <div className=\"user-dashboard min-h-screen px-2 sm:px-4 py-2 sm:py-4 relative bg-gray-50 bg-[radial-gradient(140%_140%_at_10%_10%,#f3f4f6_0%,#e5e7eb_45%,#d1d5db_100%)]\">\r\n      <GoogleBackupBar userId={user?.uid} />\r\n      {/*       */}\r\n      {/*               */}\r\n\r\n      <div className=\"max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-3 sm:gap-6 relative z-10\">\r\n        {/* Statistics and Transactions */}\r\n        <div className=\"lg:col-span-2 space-y-2 sm:space-y-3\">\r\n\r\n          {/* Detailed Reports Section */}\r\n          <div className=\"grid grid-cols-2 gap-2 sm:grid-cols-2 sm:gap-3 fade-in-up\">\r\n            {/*           */}\r\n            {/*   */}\r\n            {!areReportsCollapsed && (\r\n              <Card className=\"monthly-stats-card bg-gradient-to-br from-purple-50 via-purple-25 to-white border border-purple-200/60 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 group relative overflow-hidden\">\r\n                <div className=\"absolute inset-0 bg-gradient-to-br from-purple-500/5 to-purple-600/3 opacity-0 group-hover:opacity-100 transition-opacity duration-300\"></div>\r\n                <div className=\"absolute top-0 right-0 w-20 sm:w-32 h-20 sm:h-32 bg-gradient-to-br from-purple-300/15 to-transparent rounded-full -translate-y-8 sm:-translate-y-16 translate-x-8 sm:translate-x-16 group-hover:scale-110 transition-transform duration-300\"></div>\r\n                <CardHeader className=\"monthly-stats-header pb-2 sm:pb-1 lg:pb-1 px-3 sm:px-3 lg:px-2 pt-3 sm:pt-2 lg:pt-1 relative z-10\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <CardTitle className=\"text-xs font-bold text-purple-800 flex items-center gap-1.5 sm:gap-1\">\r\n                      <div className=\"relative\">\r\n                        <div className=\"w-2.5 sm:w-2 h-2.5 sm:h-2 bg-gradient-to-r from-purple-500 to-purple-600 rounded-full shadow-sm\"></div>\r\n                        <div className=\"absolute inset-0 w-2.5 sm:w-2 h-2.5 sm:h-2 bg-purple-400 rounded-full opacity-60 animate-pulse\"></div>\r\n                      </div>\r\n                      <span className=\"text-xs\"></span>\r\n                    </CardTitle>\r\n                    <div className=\"flex items-center gap-1 sm:gap-1\">\r\n                      <div className=\"hidden\" />\r\n                      <Button\r\n                        size=\"sm\"\r\n                        variant=\"ghost\"\r\n                        onClick={() => {\r\n                          setResetType('monthly');\r\n                          setIsResetDialogOpen(true);\r\n                        }}\r\n                        className=\"monthly-stat-action h-7 w-7 sm:h-6 sm:w-6 p-0 bg-white/60 backdrop-blur-md border border-white/50 text-purple-700 hover:bg-white hover:text-purple-900 rounded-xl transition-all duration-300 hover:scale-110 shadow-[0_8px_16px_-6px_rgba(124,58,237,0.35)] ring-1 ring-purple-200\"\r\n                        title=\"  \"\r\n                      >\r\n                        <Trash2 className=\"h-3 w-3 sm:h-2.5 sm:w-2.5\" />\r\n                      </Button>\r\n                      <div className=\"monthly-stat-action p-1.5 sm:p-1 bg-gradient-to-br from-purple-500/20 to-pink-500/20 border border-white/50 backdrop-blur-md rounded-xl shadow-[0_8px_16px_-6px_rgba(236,72,153,0.35)]\">\r\n                        <ArrowUpDown className=\"h-3 w-3 sm:h-2.5 sm:w-2.5 text-purple-700\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </CardHeader>\r\n                {!areReportsCollapsed && (\r\n                  <CardContent className=\"space-y-0.5 sm:space-y-1 lg:space-y-0 pt-0 px-2 sm:px-3 lg:px-2 pb-1.5 sm:pb-2 lg:pb-1 relative z-10\">\r\n                    <div className=\"stat-row stat-row--monthly flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-gray-100 to-purple-50/80 rounded-sm sm:rounded-lg hover:from-gray-200 hover:to-purple-50/90 transition-all duration-300 border border-purple-100/60\">\r\n                      <span className=\"stat-label stat-label--monthly text-xs font-semibold text-purple-700\"> :</span>\r\n                      <span className=\"stat-value stat-value--monthly font-bold text-xs text-purple-900 bg-gradient-to-r from-purple-100 to-purple-200 px-1 py-0.5 rounded-sm sm:rounded-lg shadow-sm\">{calculateMonthlyStats().totalTransactions}</span>\r\n                    </div>\r\n                    <div className=\"stat-row stat-row--monthly flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-gray-100 to-purple-50/80 rounded-sm sm:rounded-lg hover:from-gray-200 hover:to-purple-50/90 transition-all duration-300 border border-purple-100/60\">\r\n                      <span className=\"stat-label stat-label--monthly text-xs font-semibold text-purple-700\"> :</span>\r\n                      <span className=\"stat-value stat-value--monthly font-bold text-xs text-purple-900 bg-gradient-to-r from-purple-100 to-purple-200 px-1 py-0.5 rounded-sm sm:rounded-lg shadow-sm\">{calculateMonthlyStats().totalAmount.toFixed(2)}</span>\r\n                    </div>\r\n                    <div className=\"stat-row stat-row--monthly flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-gray-100 to-purple-50/80 rounded-sm sm:rounded-lg hover:from-gray-200 hover:to-purple-50/90 transition-all duration-300 border border-purple-100/60\">\r\n                      <span className=\"stat-label stat-label--monthly text-xs font-semibold text-purple-700\">:</span>\r\n                      <span className=\"stat-value stat-value--monthly font-bold text-xs text-purple-900 bg-gradient-to-r from-purple-100 to-purple-200 px-1 py-0.5 rounded-sm sm:rounded-lg shadow-sm\">{calculateMonthlyStats().totalWithdrawn.toFixed(2)}</span>\r\n                    </div>\r\n                    <div className=\"stat-row stat-row--monthly flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-gray-100 to-purple-50/80 rounded-sm sm:rounded-lg hover:from-gray-200 hover:to-purple-50/90 transition-all duration-300 border border-purple-100/60\">\r\n                      <span className=\"stat-label stat-label--monthly text-xs font-semibold text-purple-700\">:</span>\r\n                      <span className=\"stat-value stat-value--monthly font-bold text-xs text-purple-900 bg-gradient-to-r from-purple-100 to-purple-200 px-1 py-0.5 rounded-sm sm:rounded-lg shadow-sm\">{calculateMonthlyStats().totalSent.toFixed(2)}</span>\r\n                    </div>\r\n                    {/*      */}\r\n                    <div className=\"stat-row stat-row--monthly flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-gray-100 to-purple-50/80 rounded-sm sm:rounded-lg hover:from-gray-200 hover:to-purple-50/90 transition-all duration-300 border border-purple-100/60\">\r\n                      <span className=\"stat-label stat-label--monthly text-xs font-semibold text-purple-700\">:</span>\r\n                      <MonthlyProfitEyeButton userId={user?.uid} transactions={transactions} />\r\n                    </div>\r\n                    {/*    \" \"     */}\r\n                  </CardContent>\r\n                )}\r\n                {isMonthlyLocked && (\r\n                  <div className=\"monthly-overlay absolute inset-0 z-20 bg-yellow-100/60 backdrop-blur-sm rounded-xl border border-yellow-300/70 flex items-center justify-center p-0 pointer-events-auto\">\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"ghost\"\r\n                      onClick={async () => {\r\n                        if (isZeroPlan) {\r\n                          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\r\n                          return;\r\n                        }\r\n                        setIsMonthlyPinDialogOpen(true);\r\n                      }}\r\n                      className=\"px-2.5 py-1 rounded-full bg-gradient-to-r from-yellow-500 to-yellow-600 text-black hover:from-yellow-600 hover:to-yellow-700 shadow-md flex items-center gap-1 text-[11px] font-semibold\"\r\n                      title=\"   (  )\"\r\n                    >\r\n                      <span>  </span>\r\n                      <Eye className=\"h-2.5 w-2.5\" />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </Card>)}\r\n\r\n            {/*       */}\r\n            <MasterPinDialog\r\n              open={isMonthlyPinDialogOpen}\r\n              onOpenChange={setIsMonthlyPinDialogOpen}\r\n              mode=\"verify\"\r\n              title=\"    \"\r\n              description=\"          \"\r\n              onSuccess={() => {\r\n                if (isZeroPlan) {\r\n                  toast({ title: ' ', description: '      .  .', variant: 'destructive' });\r\n                  setIsMonthlyPinDialogOpen(false);\r\n                  setIsMonthlyLocked(true);\r\n                  return;\r\n                }\r\n                setIsMonthlyLocked(false);\r\n                setIsMonthlyPinDialogOpen(false);\r\n              }}\r\n              userId={user?.uid}\r\n            />\r\n\r\n            {/*   */}\r\n            {userSubscription?.subscription?.planType !== SubscriptionPlan.TAHWEELA && (\r\n              <Card className=\"daily-stats-card bg-gradient-to-br from-blue-50 via-blue-25 to-white border border-blue-200/60 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 group relative overflow-hidden\">\r\n                <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/5 to-blue-600/3 opacity-0 group-hover:opacity-100 transition-opacity duration-300\"></div>\r\n                <div className=\"absolute top-0 right-0 w-20 sm:w-32 h-20 sm:h-32 bg-gradient-to-br from-blue-300/15 to-transparent rounded-full -translate-y-8 sm:-translate-y-16 translate-x-8 sm:translate-x-16 group-hover:scale-110 transition-transform duration-300\"></div>\r\n                <CardHeader className=\"daily-stats-header pb-2 sm:pb-3 lg:pb-1 px-3 sm:px-4 lg:px-2 pt-3 sm:pt-4 lg:pt-1 relative z-10\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <CardTitle className=\"text-sm sm:text-base font-bold text-blue-800 flex items-center gap-1.5 sm:gap-2\">\r\n                      <div className=\"relative\">\r\n                        <div className=\"w-2.5 sm:w-3 h-2.5 sm:h-3 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full shadow-sm\"></div>\r\n                        <div className=\"absolute inset-0 w-2.5 sm:w-3 h-2.5 sm:h-3 bg-blue-400 rounded-full opacity-60 animate-pulse\"></div>\r\n                      </div>\r\n                      <span className=\"text-xs sm:text-sm\"></span>\r\n                    </CardTitle>\r\n                    <div className=\"flex items-center gap-1 sm:gap-1.5\">\r\n                      <Button\r\n                        size=\"sm\"\r\n                        variant=\"ghost\"\r\n                        onClick={() => {\r\n                          setResetType('daily');\r\n                          setIsResetDialogOpen(true);\r\n                        }}\r\n                        className=\"daily-stat-action h-7 w-7 sm:h-8 sm:w-8 p-0 bg-white/60 backdrop-blur-md border border-white/50 text-blue-700 hover:bg-white hover:text-blue-900 rounded-xl transition-all duration-300 hover:scale-110 shadow-[0_8px_16px_-6px_rgba(59,130,246,0.35)] ring-1 ring-blue-200\"\r\n                        title=\"  \"\r\n                      >\r\n                        <Trash2 className=\"h-3 w-3 sm:h-3.5 sm:w-3.5\" />\r\n                      </Button>\r\n                      <Button\r\n                        size=\"sm\"\r\n                        variant=\"ghost\"\r\n                        onClick={() => setAreReportsCollapsed(prev => !prev)}\r\n                        className=\"daily-stat-action h-7 w-7 sm:h-8 sm:w-8 p-0 bg-white/60 backdrop-blur-md border border-white/50 text-blue-700 hover:bg-white hover:text-blue-900 rounded-xl transition-all duration-300 hover:scale-110 shadow-[0_8px_16px_-6px_rgba(59,130,246,0.35)] ring-1 ring-blue-200\"\r\n                        title={areReportsCollapsed ? '  ' : '  '}\r\n                      >\r\n                        {areReportsCollapsed ? (\r\n                          <ChevronDown className=\"h-3 w-3 sm:h-3.5 sm:w-3.5\" />\r\n                        ) : (\r\n                          <ChevronUp className=\"h-3 w-3 sm:h-3.5 sm:w-3.5\" />\r\n                        )}\r\n                      </Button>\r\n                      <div className=\"p-1.5 sm:p-2 bg-gradient-to-br from-blue-500/20 to-emerald-500/20 border border-white/50 backdrop-blur-md rounded-xl shadow-[0_8px_16px_-6px_rgba(16,185,129,0.35)]\">\r\n                        <ArrowUpDown className=\"h-3 w-3 sm:h-3.5 sm:w-3.5 text-blue-700\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </CardHeader>\r\n                {!areReportsCollapsed && (\r\n                  <CardContent className=\"space-y-0 pt-0 px-2 pb-1 relative z-10\">\r\n                    <div className=\"stat-row flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-gray-100 to-blue-50/80 rounded-sm sm:rounded-lg hover:from-gray-200 hover:to-blue-50/90 transition-all duration-300 border border-blue-100/60\">\r\n                      <span className=\"stat-label text-xs font-semibold text-blue-700\"> :</span>\r\n                      <span className=\"stat-value font-bold text-xs text-blue-900 bg-gradient-to-r from-blue-100 to-blue-200 px-1 py-0.5 rounded-sm shadow-sm\">{calculateDailyStats().totalTransactions}</span>\r\n                    </div>\r\n                    <div className=\"stat-row flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-gray-100 to-blue-50/80 rounded-sm sm:rounded-lg hover:from-gray-200 hover:to-blue-50/90 transition-all duration-300 border border-blue-100/60\">\r\n                      <span className=\"stat-label text-xs font-semibold text-blue-700\"> :</span>\r\n                      <span className=\"stat-value font-bold text-xs text-blue-900 bg-gradient-to-r from-blue-100 to-blue-200 px-1 py-0.5 rounded-sm shadow-sm\">{calculateDailyStats().totalAmount.toFixed(2)}</span>\r\n                    </div>\r\n                    <div className=\"stat-row flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-gray-100 to-blue-50/80 rounded-sm sm:rounded-lg hover:from-gray-200 hover:to-blue-50/90 transition-all duration-300 border border-blue-100/60\">\r\n                      <span className=\"stat-label text-xs font-semibold text-blue-700\">:</span>\r\n                      <span className=\"stat-value font-bold text-xs text-blue-900 bg-gradient-to-r from-blue-100 to-blue-200 px-1 py-0.5 rounded-sm shadow-sm\">{calculateDailyStats().totalWithdrawn.toFixed(2)}</span>\r\n                    </div>\r\n                    <div className=\"stat-row flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from_gray-100 to-blue-50/80 rounded-sm sm:rounded-lg hover:from-gray-200 hover:to-blue-50/90 transition-all duration-300 border border-blue-100/60\">\r\n                      <span className=\"stat-label text-xs font-semibold text-blue-700\">:</span>\r\n                      <span className=\"stat-value font-bold text-xs text-blue-900 bg-gradient-to-r from-blue-100 to-blue-200 px-1 py-0.5 rounded-sm shadow-sm\">{calculateDailyStats().totalSent.toFixed(2)}</span>\r\n                    </div>\r\n                    {/*     */}\r\n                    <div className=\"stat-row flex justify-between items-center p-0.5 sm:p-1 lg:p-0.5 bg-gradient-to-r from-gray-100 to-blue-50/80 rounded-sm sm:rounded-lg hover:from-gray-200 hover:to-blue-50/90 transition-all duration-300 border border-blue-100/60\">\r\n                      <span className=\"stat-label text-xs font-semibold text-blue-700\">:</span>\r\n                      <DailyProfitEyeButton userId={user?.uid} transactions={transactions} />\r\n                    </div>\r\n                  </CardContent>)}\r\n                {isDailyLocked && (\r\n                  <div className=\"absolute inset-0 z-20 bg-yellow-100/60 backdrop-blur-sm rounded-xl border border-yellow-300/70 flex items-center justify-center p-0 pointer-events-auto\">\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"ghost\"\r\n                      onClick={() => setIsDailyPinDialogOpen(true)}\r\n                      className=\"px-2.5 py-1 rounded-full bg-gradient-to-r from-yellow-300 to-yellow-400 text-black hover:from-yellow-400 hover:to-yellow-500 shadow-md flex items-center gap-1 text-[11px] font-semibold\"\r\n                      title=\"   (  )\"\r\n                    >\r\n                      <span>  </span>\r\n                      <Eye className=\"h-2.5 w-2.5\" />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </Card>\r\n            )}\r\n            {/*           */}\r\n            {/*       */}\r\n            <MasterPinDialog\r\n              open={isDailyPinDialogOpen}\r\n              onOpenChange={setIsDailyPinDialogOpen}\r\n              mode=\"verify\"\r\n              title=\"    \"\r\n              description=\"          \"\r\n              onSuccess={() => {\r\n                setIsDailyLocked(false);\r\n                setIsDailyPinDialogOpen(false);\r\n              }}\r\n              userId={user?.uid}\r\n            />\r\n          </div>\r\n\r\n          {/* Balance Bar */}\r\n          <Card className=\"balance-bar bg-white border-2 border-gray-200/50 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 group relative overflow-hidden   transform fade-in-up mb-6\">\r\n            <div className=\"absolute inset-0 bg-gradient-to-r from-emerald-500/5 via-blue-500/5 to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"></div>\r\n            <div className=\"absolute top-0 left-0 w-40 h-40 bg-gradient-to-br from-emerald-300/10 to-transparent rounded-full -translate-y-20 -translate-x-20 group-hover:scale-150 transition-transform duration-200\"></div>\r\n            <div className=\"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-blue-300/10 to-transparent rounded-full translate-y-20 translate-x-20 group-hover:scale-150 transition-transform duration-200\"></div>\r\n            <CardContent className=\"p-3 relative z-10\">\r\n              <div className=\"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-3\">\r\n                <div className=\"bg-emerald-50 border-2 border-emerald-200/50 p-1 rounded-xl shadow-lg hover:shadow-md transition-all duration-200 group/cash relative overflow-hidden \">\r\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-emerald-500/10 to-transparent opacity-0 group-hover/cash:opacity-100 transition-opacity duration-300\"></div>\r\n                  <div className=\"flex items-center justify-between relative z-10\">\r\n                    <div className=\"flex items-center gap-0.5\">\r\n                      <div className=\"p-0.5 bg-gradient-to-r from-emerald-100 to-emerald-200 rounded-lg shadow-sm\">\r\n                        <DollarSign className=\"h-1.5 w-1.5 text-emerald-600\" />\r\n                      </div>\r\n                      <div className=\"flex flex-col\">\r\n                        <span className=\"text-[10px] font-bold text-emerald-800\"> </span>\r\n                        <span className=\"text-[10px] font-extrabold text-emerald-700 bg-gradient-to-r from-emerald-100 to-emerald-200 px-1 py-0.5 rounded-lg shadow-sm\">\r\n                          {cashBalance.toLocaleString('en-US')} \r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        className=\"h-6 w-6 p-0 bg-gradient-to-r from-green-100 to-green-200 text-green-700 hover:from-green-200 hover:to-green-300 hover:text-green-800 rounded-xl transition-all duration-300 hover:scale-110 shadow-md hover:shadow-lg\"\r\n                        onClick={() => setIsAddCashDialogOpen(true)}\r\n                      >\r\n                        <Plus className=\"h-2 w-2\" />\r\n                      </Button>\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        className=\"h-6 w-6 p-0 bg-gradient-to-r from-emerald-100 to-emerald-200 text-emerald-700 hover:from-emerald-200 hover:to-emerald-300 hover:text-emerald-800 rounded-xl transition-all duration-300 hover:scale-110 shadow-md hover:shadow-lg\"\r\n                        onClick={() => setIsCashSummaryOpen(true)}\r\n                        title=\"  \"\r\n                      >\r\n                        <Banknote className=\"h-2 w-2\" />\r\n                      </Button>\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        className=\"h-6 w-6 p-0 bg-gradient-to-r from-red-100 to-red-200 text-red-700 hover:from-red-200 hover:to-red-300 hover:text-red-800 rounded-xl transition-all duration-300  hover:rotate-12 shadow-md hover:shadow-lg\"\r\n                        onClick={() => setIsResetCashDialogOpen(true)}\r\n                      >\r\n                        <Trash2 className=\"h-2 w-2\" />\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"bg-blue-50 border-2 border-blue-200/50 p-1 rounded-xl shadow-lg hover:shadow-md transition-all duration-200 group/wallet relative overflow-hidden \">\r\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/10 to-transparent opacity-0 group-hover/wallet:opacity-100 transition-opacity duration-300\"></div>\r\n                  <div className=\"flex items-center justify-between relative z-10\">\r\n                    <div className=\"flex items-center gap-0.5\">\r\n                      <div className=\"p-0.5 bg-gradient-to-r from-blue-100 to-blue-200 rounded-lg shadow-sm\">\r\n                        <Wallet className=\"h-1.5 w-1.5 text-blue-600\" />\r\n                      </div>\r\n                      <div className=\"flex flex-col\">\r\n                        <span className=\"text-[10px] font-bold text-blue-800\">  </span>\r\n                        <span className=\"text-[10px] font-extrabold text-blue-700 bg-gradient-to-r from-blue-100 to-blue-200 px-1 py-0.5 rounded-lg shadow-sm\">\r\n                          {Object.values(walletBalances).reduce((sum, balance) => sum + balance, 0).toLocaleString('en-US')} \r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        className=\"h-6 w-6 p-0 bg-gradient-to-r from-green-100 to-green-200 text-green-700 hover:from-green-200 hover:to-green-300 hover:text-green-800 rounded-xl transition-all duration-300 hover:scale-110 shadow-md hover:shadow-lg\"\r\n                        onClick={() => setIsAddWalletTotalDialogOpen(true)}\r\n                        title=\"   \"\r\n                      >\r\n                        <Plus className=\"h-2 w-2\" />\r\n                      </Button>\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        className=\"h-6 w-6 p-0 bg-gradient-to-r from-red-100 to-red-200 text-red-700 hover:from-red-200 hover:to-red-300 hover:text-red-800 rounded-xl transition-all duration-300  hover:rotate-12 shadow-md hover:shadow-lg\"\r\n                        onClick={() => {\r\n                          setIsResetWalletTotalDialogOpen(true);\r\n                          setResetWalletTotalPinInput('');\r\n                        }}\r\n                        title=\"  \"\r\n                      >\r\n                        <Trash2 className=\"h-2 w-2\" />\r\n                      </Button>\r\n\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                {/*     */}\r\n                <div className=\"col-span-2 sm:col-span-1 bg-indigo-50 border-2 border-indigo-200/50 p-1 rounded-xl shadow-lg hover:shadow-md transition-all duration-200 group/selwallet relative overflow-hidden \">\r\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-transparent opacity-0 group-hover/selwallet:opacity-100 transition-opacity duration-300\"></div>\r\n                  <div className=\"flex items-center justify-between relative z-10\">\r\n                    <div className=\"flex items-center gap-0.5\">\r\n                      <div className=\"p-0.5 bg-gradient-to-r from-indigo-100 to-indigo-200 rounded-lg shadow-sm\">\r\n                        <Wallet className=\"h-1.5 w-1.5 text-indigo-600\" />\r\n                      </div>\r\n                      <div className=\"flex flex-col\">\r\n                        <span className=\"text-[10px] font-bold text-indigo-800\"> </span>\r\n                        <span className=\"text-[10px] font-extrabold text-indigo-700 bg-gradient-to-r from-indigo-100 to-indigo-200 px-1 py-0.5 rounded-lg shadow-sm\">\r\n                          {(selectedWallet ? (walletBalances[selectedWallet] || 0) : 0).toLocaleString('en-US')} \r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        className=\"h-6 w-6 p-0 bg-gradient-to-r from-green-100 to-green-200 text-green-700 hover:from-green-200 hover:to-green-300 hover:text-green-800 rounded-xl transition-all duration-300 hover:scale-110 shadow-md hover:shadow-lg\"\r\n                        onClick={() => {\r\n                          if (!selectedWallet) {\r\n                            toast({\r\n                              title: ' ',\r\n                              description: '       ',\r\n                              variant: 'destructive',\r\n                            });\r\n                            return;\r\n                          }\r\n                          handleEditWalletBalance(selectedWallet);\r\n                        }}\r\n                        title=\"/    \"\r\n                      >\r\n                        <Plus className=\"h-2 w-2\" />\r\n                      </Button>\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        className=\"h-6 w-6 p-0 bg-gradient-to-r from-red-100 to-red-200 text-red-700 hover:from-red-200 hover:to-red-300 hover:text-red-800 rounded-xl transition-all duration-300  hover:rotate-12 shadow-md hover:shadow-lg\"\r\n                        onClick={() => {\r\n                          if (!selectedWallet) {\r\n                            toast({\r\n                              title: ' ',\r\n                              description: '     ',\r\n                              variant: 'destructive',\r\n                            });\r\n                            return;\r\n                          }\r\n                          //        \r\n                          setIsResetSelectedWalletDialogOpen(true);\r\n                        }}\r\n                        title=\"   \"\r\n                      >\r\n                        <Trash2 className=\"h-2 w-2\" />\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Recent Transactions Section */}\r\n          <Card className=\"bg-gradient-to-br from-gray-50 via-white to-slate-50 border border-gray-200/60 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 group relative overflow-hidden fade-in-up\">\r\n            <div className=\"absolute inset-0 bg-gradient-to-br from-gray-500/5 to-slate-600/3 opacity-0 group-hover:opacity-100 transition-opacity duration-300\"></div>\r\n            <CardHeader className={`pb-2 px-4 pt-4 relative z-10 ${isMobile ? 'sticky top-0 z-20 bg-white/90 backdrop-blur supports-[backdrop-filter]:bg-white/60' : ''}`}>\r\n              <div className=\"flex items-center justify-between\">\r\n                <CardTitle className=\"text-sm font-bold flex items-center gap-2 text-gray-800\">\r\n                  {!isMobile && (\r\n                    <div className=\"p-1.5 sm:p-2 bg-gradient-to-r from-gray-100 to-slate-200 rounded-lg\">\r\n                      <ArrowUpDown className=\"h-3 w-3 sm:h-3.5 sm:w-3.5 text-gray-600\" />\r\n                    </div>\r\n                  )}\r\n                  <span className=\"bg-gradient-to-r from-gray-600 to-slate-600 bg-clip-text text-transparent\">\r\n                     \r\n                  </span>\r\n                </CardTitle>\r\n                {/*       */}\r\n                <div className=\"flex items-center gap-2\">\r\n                  {/*    */}\r\n                  {!isMobile && (\r\n                    <div className=\"flex items-center gap-0.5 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]\">\r\n                      <Search className=\"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors\" />\r\n                      <Input\r\n                        placeholder=\"...\"\r\n                        value={searchPhone}\r\n                        onChange={(e) => setSearchPhone(e.target.value)}\r\n                        className=\"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400\"\r\n                      />\r\n                    </div>\r\n                  )}\r\n                  {/*     (    ) */}\r\n                  {!isMobile && (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      {/*  -    */}\r\n                      <div className=\"flex flex-col items-center\">\r\n                        <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\r\n                          onClick={() => {\r\n                            if (isZeroPlan || isTahweelaPlan) {\r\n                              toast({ title: ' ', description: '      .', variant: 'destructive' });\r\n                              return;\r\n                            }\r\n                            setIsInstallmentPinOpen(true);\r\n                          }}\r\n                          title=\" \"\r\n                        >\r\n                          <BadgePercent className=\"h-5 w-5 text-purple-600\" />\r\n                        </Button>\r\n                      </div>\r\n                      {/*   -    */}\r\n                      <div className=\"flex flex-col items-center\">\r\n                        <span className=\"text-[10px] font-semibold text-green-600 mb-1\"></span>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-10 w-10 p-0 rounded-full bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 ring-3 ring-green-300 transition-all duration-200 hover:scale-105 active:bg-green-600 active:text-white active:border-green-600\"\r\n                          onClick={() => {\r\n                            toast({ title: ' ', description: '    .' });\r\n                          }}\r\n                          title=\" \"\r\n                        >\r\n                          <CreditCard className=\"h-5 w-5 text-green-600\" />\r\n                        </Button>\r\n                      </div>\r\n                      {/*   -    */}\r\n                      <div className=\"flex flex-col items-center\">\r\n                        <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\r\n                          onClick={() => setIsCalculatorOpen(true)}\r\n                          title=\" \"\r\n                        >\r\n                          <Calculator className=\"h-5 w-5 text-purple-600\" />\r\n                        </Button>\r\n                      </div>\r\n                      {/*   -    */}\r\n                      <div className=\"flex flex-col items-center\">\r\n                        <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\r\n                          onClick={() => {\r\n                            if (isZeroPlan || isTahweelaPlan) {\r\n                              toast({\r\n                                title: ' ',\r\n                                description: '      .',\r\n                                variant: 'destructive'\r\n                              });\r\n                            } else {\r\n                              setIsCreditCardsOpen(true);\r\n                            }\r\n                          }}\r\n                          title=\" \"\r\n                        >\r\n                          <CreditCard className=\"h-5 w-5 text-purple-600\" />\r\n                        </Button>\r\n                      </div>\r\n                      {/*  -    */}\r\n                      <div className=\"flex flex-col items-center\">\r\n                        <span className=\"text-[10px] font-semibold text-blue-600 mb-1\"></span>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-10 w-10 p-0 rounded-full bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600\"\r\n                          onClick={() => {\r\n                            if (isZeroPlan || isTahweelaPlan) {\r\n                              toast({ title: ' ', description: '      .', variant: 'destructive' });\r\n                              return;\r\n                            }\r\n                            setIsReportsPinOpen(true);\r\n                          }}\r\n                          title=\"\"\r\n                        >\r\n                          <Notebook className=\"h-5 w-5 text-blue-600\" />\r\n                        </Button>\r\n                      </div>\r\n                      {/*   /   -    */}\r\n                      <div className=\"flex flex-col items-center\">\r\n                        <span className=\"text-[10px] font-semibold text-blue-600 mb-1\"></span>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-10 w-10 p-0 rounded-full bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600\"\r\n                          onClick={handleOpenShiftProfile}\r\n                          title={isShiftActive && (shiftUser?.name || shiftUser?.username) ? ` : ${shiftUser?.name || shiftUser?.username}` : ' '}\r\n                        >\r\n                          <User className=\"h-5 w-5 text-blue-600\" />\r\n                        </Button>\r\n                      </div>\r\n                      {/*   -    */}\r\n                      <div className=\"flex flex-col items-center\">\r\n                        <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\r\n                          onClick={() => {\r\n                            if (isZeroPlan || isTahweelaPlan) {\r\n                              toast({\r\n                                title: ' ',\r\n                                description: '      .',\r\n                                variant: 'destructive'\r\n                              });\r\n                            } else {\r\n                              setIsSalesDataOpen(true);\r\n                            }\r\n                          }}\r\n                          title=\" \"\r\n                        >\r\n                          <BarChart className=\"h-5 w-5 text-purple-600\" />\r\n                        </Button>\r\n                      </div>\r\n\r\n                      {/*  -    */}\r\n                      <div className=\"flex flex-col items-center\">\r\n                        <div className=\"flex items-center gap-2 mb-1\">\r\n                          <span className=\"text-[10px] font-semibold text-purple-600\"></span>\r\n                          {debts.filter(d => d.status === 'pending').length > 0 && (\r\n                            <span className=\"h-4 w-4 rounded-full bg-red-600 text-white text-[10px] flex items-center justify-center ring-2 ring-white\">\r\n                              {debts.filter(d => d.status === 'pending').length}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\r\n                          onClick={() => { openDebts(); }}\r\n                          title=\"\"\r\n                        >\r\n                          <FileText className=\"h-5 w-5 text-purple-600\" />\r\n                        </Button>\r\n                      </div>\r\n                      {/*  -    */}\r\n                      <div className=\"flex flex-col items-center\">\r\n                        <span className=\"text-[10px] font-semibold text-amber-700 mb-1\"></span>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-10 w-10 p-0 rounded-full bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 ring-3 ring-amber-300 transition-all duration-200 hover:scale-105 active:bg-amber-600 active:text-white active:border-amber-600\"\r\n                          onClick={() => {\r\n                            if (isZeroPlan || isTahweelaPlan) {\r\n                              toast({\r\n                                title: ' ',\r\n                                description: '      .',\r\n                                variant: 'destructive'\r\n                              });\r\n                            } else {\r\n                              setIsMaintenanceOpen(true);\r\n                            }\r\n                          }}\r\n                          title=\"\"\r\n                        >\r\n                          <Wrench className=\"h-5 w-5 text-amber-700\" />\r\n                        </Button>\r\n                      </div>\r\n                      {/*   -    */}\r\n                      <div className=\"flex flex-col items-center\">\r\n                        <span className=\"text-[10px] font-semibold text-yellow-500 mb-1\"></span>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-10 w-10 p-0 rounded-full bg-violet-50 text-violet-700 hover:bg-violet-100 border border-violet-200 ring-3 ring-violet-300 transition-all duration-200 hover:scale-105 active:bg-violet-700 active:text-white active:border-violet-700\"\r\n                          onClick={() => {\r\n                            if (!isShiftHandoverAllowed || isTahweelaPlan) {\r\n                              toast({\r\n                                title: ' ',\r\n                                description: '      .',\r\n                                variant: 'destructive'\r\n                              });\r\n                            } else {\r\n                              setIsMachineDailyDialogOpen(true);\r\n                            }\r\n                          }}\r\n                          title=\" \"\r\n                        >\r\n                          <FawryMachineIcon className=\"h-5 w-5 text-yellow-500\" />\r\n                        </Button>\r\n                      </div>\r\n                      {/*   -    */}\r\n                      <div className=\"flex flex-col items-center\">\r\n                        <span className=\"text-[10px] font-semibold text-orange-600 mb-1\"></span>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-10 w-10 p-0 rounded-full bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 ring-3 ring-orange-300 transition-all duration-200 hover:scale-105 active:bg-orange-600 active:text-white active:border-orange-600\"\r\n                          onClick={() => {\r\n                            if (isZeroPlan || isTahweelaPlan) {\r\n                              toast({\r\n                                title: ' ',\r\n                                description: '      .',\r\n                                variant: 'destructive'\r\n                              });\r\n                            } else {\r\n                              if (MasterPinService.hasMasterPin()) {\r\n                                setIsShopExpensesPinDialogOpen(true);\r\n                              } else {\r\n                                setIsShopExpensesDialogOpen(true);\r\n                              }\r\n                            }\r\n                          }}\r\n                          title=\" \"\r\n                        >\r\n                          <Receipt className=\"h-5 w-5 text-orange-600\" />\r\n                        </Button>\r\n                      </div>\r\n\r\n                      {/*  -    */}\r\n                      <div className=\"flex flex-col items-center\">\r\n                        <span className=\"text-[10px] font-semibold text-rose-600 mb-1\"></span>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-10 w-10 p-0 rounded-full bg-rose-50 text-rose-600 hover:bg-rose-100 border border-rose-200 ring-3 ring-rose-300 transition-all duration-200 hover:scale-105 active:bg-rose-600 active:text-white active:border-rose-600\"\r\n                          onClick={() => {\r\n                            if (isZeroPlan || isTahweelaPlan) {\r\n                              toast({\r\n                                title: ' ',\r\n                                description: '      .',\r\n                                variant: 'destructive'\r\n                              });\r\n                            } else {\r\n                              setIsDeficienciesDialogOpen(true);\r\n                            }\r\n                          }}\r\n                          title=\"\"\r\n                        >\r\n                          <AlertTriangle className=\"h-5 w-5 text-rose-600\" />\r\n                        </Button>\r\n                      </div>\r\n\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n              </div>\r\n\r\n              {/*         */}\r\n              {/*    :  /  /  */}\r\n              {!isMobile && (\r\n                <div className=\"mt-2 w-full\">\r\n                  <div className=\"filters-bar flex items-center justify-center gap-3 bg-gray-50 rounded-md p-3 border border-gray-200\">\r\n                    <Button\r\n                      variant={'ghost'}\r\n                      size=\"sm\"\r\n                      className={`btn-filter-send h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${activeTab === 'send' ? 'bg-green-600 text-white border-green-600' : 'text-green-700 border-green-300 hover:bg-green-50'}`}\r\n                      onClick={() => setActiveTab('send')}\r\n                      title=\" \"\r\n                    >\r\n                      \r\n                    </Button>\r\n                    <Button\r\n                      variant={'ghost'}\r\n                      size=\"sm\"\r\n                      className={`btn-filter-withdraw h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${activeTab === 'withdraw' ? 'bg-red-600 text-white border-red-600' : 'text-red-700 border-red-300 hover:bg-red-50'}`}\r\n                      onClick={() => setActiveTab('withdraw')}\r\n                      title=\" \"\r\n                    >\r\n                      \r\n                    </Button>\r\n                    <Button\r\n                      variant={'ghost'}\r\n                      size=\"sm\"\r\n                      className={`btn-filter-all h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${activeTab === 'all' ? 'bg-green-600 text-white border-green-600' : 'text-green-700 border-green-300 hover:bg-green-50'}`}\r\n                      onClick={() => setActiveTab('all')}\r\n                      title=\" \"\r\n                    >\r\n                      \r\n                    </Button>\r\n\r\n                    {/*       */}\r\n                    <div className=\"relative ml-1\">\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        className=\"h-8 px-3 text-[12px] rounded-full border bg-red-50 text-red-700 border-red-300 hover:bg-red-100\"\r\n                        onClick={() => setIsResetRecentDialogOpen(true)}\r\n                        title=\"  \"\r\n                      >\r\n                        <Trash2 className=\"h-3.5 w-3.5 mr-1\" />\r\n                        \r\n                      </Button>\r\n                      {hiddenCount > 0 && (\r\n                        <span className=\"absolute -top-0.5 -right-0.5 h-2 w-2 rounded-full bg-red-500 ring-2 ring-white\" />\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </CardHeader>\r\n            {/*       */}\r\n            <MasterPinDialog\r\n              open={isInstallmentPinOpen}\r\n              onOpenChange={setIsInstallmentPinOpen}\r\n              mode=\"verify\"\r\n              title=\"  \"\r\n              description=\"       \"\r\n              onSuccess={() => {\r\n                setIsInstallmentPinOpen(false);\r\n                setIsInstallmentModalOpen(true);\r\n              }}\r\n            />\r\n            <InstallmentModal\r\n              open={isInstallmentModalOpen}\r\n              onOpenChange={setIsInstallmentModalOpen}\r\n            />\r\n            {/*          */}\r\n            {showDesktopQuickIcons && (\r\n              <div className=\"px-4 mt-4 mb-1 flex flex-wrap items-center justify-center gap-3\">\r\n                {/*   -    */}\r\n                <div className=\"flex flex-col items-center\">\r\n                  <span className=\"text-[10px] font-semibold text-green-600 mb-1\"></span>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className={`h-10 w-10 p-0 rounded-full bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 ring-3 ring-green-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'charge' ? ' bg-green-600 text-white border-green-600' : ''}`}\r\n                    onClick={() => {\r\n                      toast({ title: ' ', description: '    .' });\r\n                      setSelectedQuickIcon('charge');\r\n                    }}\r\n                    title=\" \"\r\n                  >\r\n                    <CreditCard className=\"h-5 w-5 text-green-600\" />\r\n                  </Button>\r\n                </div>\r\n                {/*   -    */}\r\n                <div className=\"flex flex-col items-center\">\r\n                  <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className={`h-10 w-10 p-0 rounded-full bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'calculator' ? ' bg-purple-600 text-white border-purple-600' : ''}`}\r\n                    onClick={() => setIsCalculatorOpen(true)}\r\n                    title=\" \"\r\n                  >\r\n                    <Calculator className=\"h-5 w-5 text-purple-600\" />\r\n                  </Button>\r\n                </div>\r\n                {/*   -    */}\r\n                <div className=\"flex flex-col items-center\">\r\n                  <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className={`h-10 w-10 p-0 rounded-full bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'creditcards' ? ' bg-purple-600 text-white border-purple-600' : ''}`}\r\n                    onClick={() => {\r\n                      if (isZeroPlan) {\r\n                        toast({\r\n                          title: ' ',\r\n                          description: '      .  .',\r\n                          variant: 'destructive'\r\n                        });\r\n                      } else {\r\n                        setIsCreditCardsOpen(true);\r\n                        setSelectedQuickIcon('creditcards');\r\n                      }\r\n                    }}\r\n                    title=\" \"\r\n                  >\r\n                    <CreditCard className=\"h-5 w-5 text-purple-600\" />\r\n                  </Button>\r\n                </div>\r\n                {/*   /   -    */}\r\n                <div className=\"flex flex-col items-center\">\r\n                  <span className=\"text-[10px] font-semibold text-blue-600 mb-1\"></span>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className={`h-10 w-10 p-0 rounded-full bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'shift' ? ' bg-blue-600 text-white border-blue-600' : ''}`}\r\n                    onClick={handleOpenShiftProfile}\r\n                    title={isShiftActive && (shiftUser?.name || shiftUser?.username) ? ` : ${shiftUser?.name || shiftUser?.username}` : ' '}\r\n                  >\r\n                    <User className=\"h-5 w-5 text-blue-600\" />\r\n                  </Button>\r\n                </div>\r\n                {/*   -    */}\r\n                <div className=\"flex flex-col items-center\">\r\n                  <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className={`h-10 w-10 p-0 rounded-full bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'sales' ? ' bg-purple-600 text-white border-purple-600' : ''}`}\r\n                    onClick={() => {\r\n                      if (isZeroPlan) {\r\n                        toast({\r\n                          title: ' ',\r\n                          description: '      .  .',\r\n                          variant: 'destructive'\r\n                        });\r\n                      } else {\r\n                        setIsSalesDataOpen(true);\r\n                        setSelectedQuickIcon('sales');\r\n                      }\r\n                    }}\r\n                    title=\" \"\r\n                  >\r\n                    <BarChart className=\"h-5 w-5 text-purple-600\" />\r\n                  </Button>\r\n                </div>\r\n                {/*  -    */}\r\n                <div className=\"flex flex-col items-center\">\r\n                  <div className=\"flex items-center gap-2 mb-1\">\r\n                    <span className=\"text-[10px] font-semibold text-purple-600\"></span>\r\n                    {debts.filter(d => d.status === 'pending').length > 0 && (\r\n                      <span className=\"h-4 w-4 rounded-full bg-red-600 text-white text-[10px] flex items-center justify-center ring-2 ring-white\">\r\n                        {debts.filter(d => d.status === 'pending').length}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className={`h-10 w-10 p-0 rounded-full bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'debts' ? ' bg-purple-600 text-white border-purple-600' : ''}`}\r\n                    onClick={() => { openDebts(); }}\r\n                    title=\"\"\r\n                  >\r\n                    <FileText className=\"h-5 w-5 text-purple-600\" />\r\n                  </Button>\r\n                </div>\r\n                {/*  -    */}\r\n                <div className=\"flex flex-col items-center\">\r\n                  <span className=\"text-[10px] font-semibold text-amber-700 mb-1\"></span>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className={`h-10 w-10 p-0 rounded-full bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 ring-3 ring-amber-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'maintenance' ? ' bg-amber-600 text-white border-amber-600' : ''}`}\r\n                    onClick={() => {\r\n                      if (isZeroPlan) {\r\n                        toast({\r\n                          title: ' ',\r\n                          description: '     .  .',\r\n                          variant: 'destructive'\r\n                        });\r\n                      } else {\r\n                        setIsMaintenanceOpen(true);\r\n                        setSelectedQuickIcon('maintenance');\r\n                      }\r\n                    }}\r\n                    title=\"\"\r\n                  >\r\n                    <Wrench className=\"h-5 w-5 text-amber-700\" />\r\n                  </Button>\r\n                </div>\r\n                {/*   -    */}\r\n                <div className=\"flex flex-col items-center\">\r\n                  <span className=\"text-[10px] font-semibold text-yellow-500 mb-1\"></span>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className={`h-10 w-10 p-0 rounded-full bg-violet-50 text-violet-700 hover:bg-violet-100 border border-violet-200 ring-3 ring-violet-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'machine' ? ' bg-violet-700 text-white border-violet-700' : ''}`}\r\n                    onClick={() => {\r\n                      if (!isShiftHandoverAllowed) {\r\n                        toast({\r\n                          title: ' ',\r\n                          description: '   :      .',\r\n                          variant: 'destructive'\r\n                        });\r\n                      } else {\r\n                        setIsMachineDailyDialogOpen(true);\r\n                        setSelectedQuickIcon('machine');\r\n                      }\r\n                    }}\r\n                    title=\" \"\r\n                  >\r\n                    <FawryMachineIcon className=\"h-5 w-5 text-yellow-500\" />\r\n                  </Button>\r\n                </div>\r\n                {/*   -    */}\r\n                <div className=\"flex flex-col items-center\">\r\n                  <span className=\"text-[10px] font-semibold text-orange-600 mb-1\"></span>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className={`h-10 w-10 p-0 rounded-full bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 ring-3 ring-orange-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'expenses' ? ' bg-orange-600 text-white border-orange-600' : ''}`}\r\n                    onClick={() => {\r\n                      if (isZeroPlan) {\r\n                        toast({\r\n                          title: ' ',\r\n                          description: '      .  .',\r\n                          variant: 'destructive'\r\n                        });\r\n                      } else {\r\n                        if (MasterPinService.hasMasterPin()) {\r\n                          setIsShopExpensesPinDialogOpen(true);\r\n                        } else {\r\n                          setIsShopExpensesDialogOpen(true);\r\n                        }\r\n                        setSelectedQuickIcon('expenses');\r\n                      }\r\n                    }}\r\n                    title=\" \"\r\n                  >\r\n                    <Receipt className=\"h-5 w-5 text-orange-600\" />\r\n                  </Button>\r\n                </div>\r\n                {/*  -    */}\r\n                <div className=\"flex flex-col items-center\">\r\n                  <span className=\"text-[10px] font-semibold text-rose-600 mb-1\"></span>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className={`h-10 w-10 p-0 rounded-full bg-rose-50 text-rose-600 hover:bg-rose-100 border border-rose-200 ring-3 ring-rose-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'deficiencies' ? ' bg-rose-600 text-white border-rose-600' : ''}`}\r\n                    onClick={() => {\r\n                      if (isZeroPlan) {\r\n                        toast({\r\n                          title: ' ',\r\n                          description: '     .  .',\r\n                          variant: 'destructive'\r\n                        });\r\n                      } else {\r\n                        setIsDeficienciesDialogOpen(true);\r\n                        setSelectedQuickIcon('deficiencies');\r\n                      }\r\n                    }}\r\n                    title=\"\"\r\n                  >\r\n                    <AlertTriangle className=\"h-5 w-5 text-rose-600\" />\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            )}\r\n            <CardContent className=\"space-y-2 pt-0 px-4 pb-4 relative z-10\">\r\n              {filteredTransactions.length === 0 ? (\r\n                <div className=\"text-center py-8 text-gray-500\">\r\n                  <ArrowUpDown className=\"h-12 w-12 mx-auto mb-2 text-gray-300\" />\r\n                  <p className=\"text-sm\">    </p>\r\n                </div>\r\n              ) : (\r\n                isMobile ? (\r\n                  <div className={`overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors max-h-[310px]`}>\r\n                    <div className=\"space-y-2 pr-2\">\r\n                      {filteredTransactions.map((transaction) => (\r\n                        <div\r\n                          key={transaction.id}\r\n                          className=\"receipts-row flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-colors duration-100 hover:bg-gray-50\"\r\n                          onClick={() => handleTransactionClick(transaction)}\r\n                        >\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              {transaction.status === 'completed' && <CheckCircle className={`h-4 w-4 ${transaction.type === 'withdraw' ? 'text-red-500' : 'text-green-500'}`} />}\r\n                              {transaction.status === 'pending' && <Clock className=\"h-4 w-4 text-yellow-500\" />}\r\n                              {transaction.status === 'failed' && <XCircle className=\"h-4 w-4 text-red-500\" />}\r\n                            </div>\r\n                            <div>\r\n                              {(() => {\r\n                                const t: any = transaction as any;\r\n                                const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\r\n                                const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\r\n                                return (\r\n                                  <p className={`font-medium text-sm ${isShiftReceipt || isCashAddReceipt ? 'text-gray-800' : (transaction.type === 'send' ? 'text-green-700' : 'text-red-700')}`}>\r\n                                    {isShiftReceipt\r\n                                      ? '  '\r\n                                      : isCashAddReceipt\r\n                                        ? `   - ${formatNumberEnglish(transaction.amount)} `\r\n                                        : (transaction.type === 'send' ? '' : '') + ` - ${formatNumberEnglish(transaction.amount)} `}\r\n                                  </p>\r\n                                );\r\n                              })()}\r\n                              <p className=\"text-[10px] text-gray-700\">\r\n                                 : {(transaction as any)?.cashierName ?? ' '}\r\n                              </p>\r\n                              {(() => {\r\n                                const t: any = transaction as any;\r\n                                const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\r\n                                const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\r\n                                const noteText = (t?.note || t?.notes || '');\r\n                                return (\r\n                                  <p className={`text-xs ${isShiftReceipt || isCashAddReceipt ? 'text-gray-500' : (transaction.type === 'send' ? 'text-green-600' : 'text-red-500')}`}>\r\n                                    {isShiftReceipt\r\n                                      ? `  : ${transaction.receiverPhone}`\r\n                                      : isCashAddReceipt\r\n                                        ? (noteText ? `: ${noteText}` : '   ')\r\n                                        : ` ${transaction.senderPhone}${transaction.type === 'send' ? `  ${transaction.receiverPhone}` : ''}`}\r\n                                  </p>\r\n                                );\r\n                              })()}\r\n                              <p className=\"text-xs text-gray-400\">\r\n                                {dateFormatter.format(transaction.createdAt instanceof Date ? transaction.createdAt : new Date(transaction.createdAt))} - {timeFormatter.format(transaction.createdAt instanceof Date ? transaction.createdAt : new Date(transaction.createdAt))}\r\n                              </p>\r\n                            </div>\r\n                          </div>\r\n                          <Badge variant={\r\n                            transaction.status === 'completed' ? 'default' :\r\n                              transaction.status === 'pending' ? 'secondary' : 'destructive'\r\n                          } className={`text-xs ${transaction.status === 'completed' ? (transaction.type === 'withdraw' ? 'bg-red-100 text-red-700 border-red-300' : (transaction.type === 'send' ? 'bg-green-100 text-green-700 border-green-300' : '')) : ''}`}>\r\n                            {transaction.status === 'completed' ? '' :\r\n                              transaction.status === 'pending' ? ' ' : ''}\r\n                          </Badge>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  <div className={`overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors max-h-[calc(100dvh-300px)]`}>\r\n                    <div className=\"space-y-2 pr-2\">\r\n                      {filteredTransactions.map((transaction) => (\r\n                        <div\r\n                          key={transaction.id}\r\n                          className=\"receipts-row flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-colors duration-100 hover:bg-gray-50\"\r\n                          onClick={() => handleTransactionClick(transaction)}\r\n                        >\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              {transaction.status === 'completed' && <CheckCircle className={`h-4 w-4 ${transaction.type === 'withdraw' ? 'text-red-500' : 'text-green-500'}`} />}\r\n                              {transaction.status === 'pending' && <Clock className=\"h-4 w-4 text-yellow-500\" />}\r\n                              {transaction.status === 'failed' && <XCircle className=\"h-4 w-4 text-red-500\" />}\r\n                            </div>\r\n                            <div>\r\n                              {(() => {\r\n                                const t: any = transaction as any;\r\n                                const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\r\n                                const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\r\n                                return (\r\n                                  <p className={`font-medium text-sm ${isShiftReceipt || isCashAddReceipt ? 'text-gray-800' : (transaction.type === 'send' ? 'text-green-700' : 'text-red-700')}`}>\r\n                                    {isShiftReceipt\r\n                                      ? '  '\r\n                                      : isCashAddReceipt\r\n                                        ? `   - ${formatNumberEnglish(transaction.amount)} `\r\n                                        : (transaction.type === 'send' ? '' : '') + ` - ${formatNumberEnglish(transaction.amount)} `}\r\n                                  </p>\r\n                                );\r\n                              })()}\r\n                              <p className=\"text-[10px] text-gray-700\">\r\n                                 : {(transaction as any)?.cashierName ?? ' '}\r\n                              </p>\r\n                              {(() => {\r\n                                const t: any = transaction as any;\r\n                                const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\r\n                                const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\r\n                                const noteText = (t?.note || t?.notes || '');\r\n                                return (\r\n                                  <p className={`text-xs ${isShiftReceipt || isCashAddReceipt ? 'text-gray-500' : (transaction.type === 'send' ? 'text-green-600' : 'text-red-500')}`}>\r\n                                    {isShiftReceipt\r\n                                      ? `  : ${transaction.receiverPhone}`\r\n                                      : isCashAddReceipt\r\n                                        ? (noteText ? `: ${noteText}` : '   ')\r\n                                        : ` ${transaction.senderPhone}${transaction.type === 'send' ? `  ${transaction.receiverPhone}` : ''}`}\r\n                                  </p>\r\n                                );\r\n                              })()}\r\n                              <p className=\"text-xs text-gray-400\">\r\n                                {dateFormatter.format(transaction.createdAt instanceof Date ? transaction.createdAt : new Date(transaction.createdAt))} - {timeFormatter.format(transaction.createdAt instanceof Date ? transaction.createdAt : new Date(transaction.createdAt))}\r\n                              </p>\r\n                            </div>\r\n                          </div>\r\n                          <Badge variant={\r\n                            transaction.status === 'completed' ? 'default' :\r\n                              transaction.status === 'pending' ? 'secondary' : 'destructive'\r\n                          } className={`text-xs ${transaction.status === 'completed' ? (transaction.type === 'withdraw' ? 'bg-red-100 text-red-700 border-red-300' : (transaction.type === 'send' ? 'bg-green-100 text-green-700 border-green-300' : '')) : ''}`}>\r\n                            {transaction.status === 'completed' ? '' :\r\n                              transaction.status === 'pending' ? ' ' : ''}\r\n                          </Badge>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )\r\n              )}\r\n              {/*         */}\r\n              {isMobile && (\r\n                <div className=\"mt-2 flex justify-end\">\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"h-7 px-2 text-[11px] rounded-full border bg-red-50 text-red-700 border-red-300 hover:bg-red-100\"\r\n                    onClick={() => setIsResetRecentDialogOpen(true)}\r\n                    title=\"  \"\r\n                  >\r\n                    <Trash2 className=\"h-3 w-3 mr-1\" />\r\n                    \r\n                  </Button>\r\n                  {user?.uid && localStorage.getItem(`recentTransactionsResetAt:${user.uid}`) && (\r\n                    <span className=\"inline-block h-1.5 w-1.5 rounded-full bg-red-500 ml-1 align-middle\" />\r\n                  )}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n        </div>\r\n\r\n        {/* Receipt Modal for desktop view */}\r\n        <ReceiptModal\r\n          isOpen={isReceiptOpen}\r\n          onClose={() => setIsReceiptOpen(false)}\r\n          transaction={receiptTransaction}\r\n          onPrint={() => window.print()}\r\n          onDelete={handleDeleteReceipt}\r\n          onComplete={handleCompleteReceipt}\r\n        />\r\n\r\n        {/* Transaction Form */}\r\n        <div className=\"space-y-1 fade-in-right w-full lg:w-[92%] xl:w-[95%] mx-auto\">\r\n          <Card id=\"transaction-section\" className={`bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/50 border border-blue-200/40 rounded-lg shadow-lg hover:shadow-lg transition-all duration-200 group relative overflow-hidden`}>\r\n            {/* Animated background elements */}\r\n            <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/5 via-indigo-500/3 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"></div>\r\n            <div className=\"absolute top-0 right-0 w-32 h-32 sm:w-28 sm:h-28 lg:w-20 lg:h-20 bg-gradient-to-bl from-blue-400/10 to-transparent rounded-full  \"></div>\r\n            <div className=\"absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-indigo-400/10 to-transparent rounded-full  \" style={{ animationDelay: '1s' }}></div>\r\n\r\n            <CardHeader className=\"sticky top-0 z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 pb-0.5 px-3 pt-1 lg:pt-0.5 lg:pb-0.5 lg:px-2\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <CardTitle className=\"text-sm font-bold flex items-center gap-2 text-gray-800\">\r\n                  <div className=\"relative\">\r\n                    <CheckCircle className=\"h-1 w-1 text-emerald-500 \" />\r\n                    <div className=\"absolute inset-0 h-1 w-1 bg-emerald-400 rounded-full opacity-20 \"></div>\r\n                  </div>\r\n                  <span className=\"bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent\">\r\n                      \r\n                  </span>\r\n                </CardTitle>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                  {isOnFreeTrial && (\r\n                    <div className=\"hidden md:flex items-center gap-1 bg-gradient-to-r from-emerald-50 to-green-50 hover:from-emerald-100 hover:to-green-100 border border-emerald-200 text-emerald-800 text-sm transition-all duration-300 hover:scale-105 h-9 px-3 rounded-xl shadow-sm\">\r\n                      <span className=\"text-sm font-semibold whitespace-nowrap\">: {freeTrialHoursRemaining} {freeTrialHoursRemaining >= 3 && freeTrialHoursRemaining <= 10 ? '' : freeTrialHoursRemaining === 2 ? '' : ''}</span>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"top-icons-bar hidden md:flex items-center gap-2 bg-gradient-to-r from-gray-50 to-slate-50 hover:from-gray-100 hover:to-slate-100 border border-gray-200 transition-all duration-300 hover:scale-105 h-9 px-3 rounded-xl shadow-sm\">\r\n                    <NotificationBell />\r\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" title=\"VIP\" onClick={() => setIsVipOpen(true)}>\r\n                      <Crown className=\"h-5 w-5 text-yellow-500\" />\r\n                    </Button>\r\n                    {/* Telegram button removed */}\r\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" title=\" \" onClick={() => { toast({ title: ' ', description: '    ' }); }}>\r\n                      <Store className=\"h-5 w-5\" />\r\n                    </Button>\r\n                    <ProfileIcon />\r\n                  </div>\r\n                </div>\r\n                {hasLocalDataToSync && (\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    className=\"hidden flex items-center gap-1.5 sm:gap-2 bg-gradient-to-r from-cyan-50 to-blue-50 hover:from-cyan-100 hover:to-blue-100 border-cyan-200 text-cyan-800 text-xs sm:text-sm transition-all duration-300 hover:scale-105 hover:shadow-lg h-10 sm:h-12 px-4 sm:px-5 rounded-xl min-w-[44px] touch-manipulation\"\r\n                    onClick={syncLocalDataWithFirebase}\r\n                    title=\"     \"\r\n                  >\r\n                    <RefreshCw className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 animate-spin\" />\r\n                    <span className=\"text-xs sm:text-sm font-semibold whitespace-nowrap\"></span>\r\n                  </Button>\r\n                )}\r\n\r\n              </div>\r\n            </CardHeader>\r\n            <Dialog open={isVipOpen} onOpenChange={setIsVipOpen}>\r\n              <DialogContent className=\"sm:max-w-md\">\r\n                <DialogHeader>\r\n                  <DialogTitle> 10   </DialogTitle>\r\n                </DialogHeader>\r\n                <div className=\"space-y-2\">\r\n                  {vipTop10.length === 0 ? (\r\n                    <div className=\"text-sm text-gray-600\">    </div>\r\n                  ) : (\r\n                    vipTop10.map((item, idx) => (\r\n                      <div\r\n                        key={item.phone + idx}\r\n                        className={`flex items-center justify-between border rounded-md px-3 py-2 bg-white ${idx === 0 ? 'bg-yellow-50 border-yellow-300' : ''}`}\r\n                      >\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Badge\r\n                            variant=\"outline\"\r\n                            className={`min-w-[28px] justify-center ${idx === 0 ? 'border-yellow-300 text-yellow-700 bg-yellow-50' : ''}`}\r\n                          >\r\n                            {idx + 1}\r\n                          </Badge>\r\n                          <span className={`font-semibold ${idx === 0 ? 'text-yellow-700' : ''}`}>{item.phone}</span>\r\n                        </div>\r\n                        <div className=\"text-sm text-gray-700 flex items-center gap-3\">\r\n                          <span>: {item.count}</span>\r\n                          <span>: {item.total}</span>\r\n                          <Button variant=\"outline\" size=\"sm\" className=\"h-8\" onClick={() => sendVipWhatsApp(item)} title=\" \">\r\n                            <MessageCircle className=\"h-4 w-4\" />\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    ))\r\n                  )}\r\n                </div>\r\n                <DialogFooter>\r\n                  <Button onClick={() => setIsVipOpen(false)}></Button>\r\n                </DialogFooter>\r\n              </DialogContent>\r\n            </Dialog>\r\n\r\n            <Dialog open={isTelegramOpen} onOpenChange={setIsTelegramOpen}>\r\n              <DialogContent className=\"sm:max-w-md\">\r\n                <DialogHeader>\r\n                  <DialogTitle>  </DialogTitle>\r\n                </DialogHeader>\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"space-y-1\">\r\n                    <Label>Telegram Chat ID</Label>\r\n                    <Input value={telegramChatId} onChange={(e) => setTelegramChatId(e.target.value)} placeholder=\"  \" />\r\n                  </div>\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <Label>  12 </Label>\r\n                    <Switch checked={telegramDailyEnabled} onCheckedChange={(v) => setTelegramDailyEnabled(!!v)} />\r\n                  </div>\r\n                </div>\r\n                <DialogFooter>\r\n                  <Button variant=\"outline\" onClick={() => setIsTelegramOpen(false)}></Button>\r\n                  <Button onClick={async () => {\r\n                    if (!user?.uid) return;\r\n                    await userDataService.updateUserData(user.uid, { telegramChatId, telegramDailyEnabled });\r\n                    toast({ title: ' ' });\r\n                  }}></Button>\r\n                  <Button onClick={async () => {\r\n                    if (!user?.uid || !telegramChatId) { toast({ title: ' Chat ID' }); return; }\r\n                    const text = await composeTelegramDailySummary();\r\n                    try {\r\n                      const { sendTelegramMessage } = await import('@/integrations/firebase/functions');\r\n                      await sendTelegramMessage({ chatId: telegramChatId, text });\r\n                      toast({ title: ' ' });\r\n                    } catch (e) {\r\n                      toast({ title: ' ', description: '   ', variant: 'destructive' });\r\n                    }\r\n                  }}> </Button>\r\n                </DialogFooter>\r\n              </DialogContent>\r\n            </Dialog>\r\n            <Dialog open={branchDialogOpen} onOpenChange={setBranchDialogOpen}>\r\n              <DialogContent className=\"sm:max-w-lg\">\r\n                <DialogHeader>\r\n                  <DialogTitle> </DialogTitle>\r\n                  <DialogDescription>      </DialogDescription>\r\n                  <div className=\"flex items-center justify-end gap-2 mt-2\">\r\n                    <Button variant=\"outline\" size=\"sm\" onClick={() => {\r\n                      try {\r\n                        const key = user?.uid ? `selectedShopId_${user.uid}` : 'selectedShopId';\r\n                        localStorage.removeItem(key);\r\n                        try { window.dispatchEvent(new Event('selectedShopIdChanged')); } catch { }\r\n                        toast({ title: '   ' });\r\n                        navigate(`/branch/${String(b.shopId)}/dashboard`);\r\n                      } catch { }\r\n                    }}>  </Button>\r\n                  </div>\r\n                </DialogHeader>\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                    <div>\r\n                      <Label> </Label>\r\n                      <Input value={managerNameInput} onChange={e => setManagerNameInput(e.target.value)} placeholder=\"  \" />\r\n                    </div>\r\n                    <div>\r\n                      <Label> </Label>\r\n                      <Input value={branchNameInput} onChange={e => setBranchNameInput(e.target.value)} placeholder=\"  \" />\r\n                    </div>\r\n                    <div>\r\n                      <Label>  </Label>\r\n                      <Input value={loginUsernameInput} onChange={e => setLoginUsernameInput(e.target.value)} placeholder=\": branch1\" />\r\n                    </div>\r\n                    <div>\r\n                      <Label> </Label>\r\n                      <Input type=\"password\" value={loginPasswordInput} onChange={e => setLoginPasswordInput(e.target.value)} placeholder=\"\" />\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-center justify-end gap-2\">\r\n                    <Button variant=\"outline\" onClick={() => { setManagerNameInput(''); setBranchNameInput(''); setLoginUsernameInput(''); setLoginPasswordInput(''); }}></Button>\r\n                    <Button className=\"bg-indigo-600 hover:bg-indigo-700\" disabled={branchLoading} onClick={async () => {\r\n                      if (!user?.uid) return;\r\n                      const manager = managerNameInput.trim();\r\n                      const bname = branchNameInput.trim();\r\n                      const uname = loginUsernameInput.trim();\r\n                      const pw = loginPasswordInput.trim();\r\n                      if (!manager || !bname || !uname || !pw) { toast({ title: '   ' }); return; }\r\n\r\n                      //      (3 )\r\n                      if (branches.length >= 3) {\r\n                        toast({\r\n                          title: '',\r\n                          description: '      (3 )',\r\n                          variant: 'destructive'\r\n                        });\r\n                        return;\r\n                      }\r\n\r\n                      try {\r\n                        setBranchLoading(true);\r\n                        let shopIdNew = '';\r\n                        try {\r\n                          const shopRef = await addDoc(collection(db, 'shops'), { name: bname, ownerId: user.uid, createdAt: serverTimestamp(), updatedAt: serverTimestamp(), isActive: true });\r\n                          shopIdNew = shopRef.id;\r\n                        } catch {\r\n                          const shopRef2 = await addDoc(collection(db, 'users', user.uid, 'shops'), { name: bname, ownerId: user.uid, createdAt: serverTimestamp(), updatedAt: serverTimestamp(), isActive: true });\r\n                          shopIdNew = shopRef2.id;\r\n                        }\r\n                        const safeEncode = (s: string) => {\r\n                          try { return btoa(unescape(encodeURIComponent(s))); } catch { return btoa(s); }\r\n                        };\r\n                        try {\r\n                          await addDoc(collection(db, 'branches'), { ownerId: user.uid, shopId: shopIdNew, branchName: bname, managerName: manager, loginUsername: uname, passwordEncoded: safeEncode(pw), createdAt: serverTimestamp() });\r\n                        } catch {\r\n                          await addDoc(collection(db, 'users', user.uid, 'branches'), { ownerId: user.uid, shopId: shopIdNew, branchName: bname, managerName: manager, loginUsername: uname, passwordEncoded: safeEncode(pw), createdAt: serverTimestamp() });\r\n                        }\r\n                        try {\r\n                          const q = fsQuery(collection(db, 'branches'), where('ownerId', '==', user.uid));\r\n                          const snap = await getDocs(q);\r\n                          let list = snap.docs.map(d => ({ id: d.id, ...(d.data() as any) }));\r\n                          if (list.length === 0) {\r\n                            const q2 = fsQuery(collection(db, 'users', user.uid, 'branches'));\r\n                            const snap2 = await getDocs(q2);\r\n                            list = snap2.docs.map(d => ({ id: d.id, ...(d.data() as any) }));\r\n                          }\r\n                          setBranches(list);\r\n                        } catch {\r\n                          try {\r\n                            const q2 = fsQuery(collection(db, 'users', user.uid, 'branches'));\r\n                            const snap2 = await getDocs(q2);\r\n                            const list2 = snap2.docs.map(d => ({ id: d.id, ...(d.data() as any) }));\r\n                            setBranches(list2);\r\n                          } catch { }\r\n                        }\r\n                        setManagerNameInput(''); setBranchNameInput(''); setLoginUsernameInput(''); setLoginPasswordInput('');\r\n                        toast({ title: '   ' });\r\n                      } catch (e) {\r\n                        toast({ title: '  ' });\r\n                      } finally { setBranchLoading(false); }\r\n                    }}> </Button>\r\n                  </div>\r\n                  <div className=\"border-t pt-3\">\r\n                    <h4 className=\"text-sm font-semibold mb-2\"> </h4>\r\n                    {branchLoading ? (\r\n                      <div className=\"text-sm text-gray-500\"> ...</div>\r\n                    ) : branches.length === 0 ? (\r\n                      <div className=\"text-sm text-gray-500\">   </div>\r\n                    ) : (\r\n                      <div className=\"space-y-2\">\r\n                        {branches.map((b) => (\r\n                          <div key={b.id} className=\"flex items-center justify-between p-2 border rounded-lg bg-white\">\r\n                            <div className=\"text-sm\">\r\n                              <div className=\"font-medium\">{b.branchName}</div>\r\n                              <div className=\"text-gray-600\">: {b.managerName}</div>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <Button size=\"sm\" className=\"bg-blue-600 hover:bg-blue-700\" onClick={() => {\r\n                                setBranchLoginTarget(b);\r\n                                setBranchLoginUsername(String(b.loginUsername || ''));\r\n                                setBranchLoginPassword('');\r\n                                setBranchLoginOpen(true);\r\n                              }}> </Button>\r\n                              <Button size=\"sm\" variant=\"destructive\" onClick={async () => {\r\n                                if (!confirm('          .')) return;\r\n                                try {\r\n                                  try { await deleteDoc(doc(db, 'branches', b.id)); } catch { }\r\n                                  try { await deleteDoc(doc(db, 'users', user?.uid || '', 'branches', b.id)); } catch { }\r\n                                  if (b.shopId) {\r\n                                    try { await deleteDoc(doc(db, 'shops', String(b.shopId))); } catch { }\r\n                                    try { await deleteDoc(doc(db, 'users', user?.uid || '', 'shops', String(b.shopId))); } catch { }\r\n                                  }\r\n                                  setBranches(prev => prev.filter(x => x.id !== b.id));\r\n                                  toast({ title: '  ' });\r\n                                } catch { toast({ title: '  ' }); }\r\n                              }}> </Button>\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </DialogContent>\r\n            </Dialog>\r\n            <Dialog open={branchLoginOpen} onOpenChange={setBranchLoginOpen}>\r\n              <DialogContent className=\"sm:max-w-md\">\r\n                <DialogHeader>\r\n                  <DialogTitle> </DialogTitle>\r\n                  <DialogDescription>    </DialogDescription>\r\n                </DialogHeader>\r\n                <div className=\"space-y-3\">\r\n                  <div>\r\n                    <Label> </Label>\r\n                    <Input value={branchLoginUsername} onChange={e => setBranchLoginUsername(e.target.value)} placeholder=\" \" />\r\n                  </div>\r\n                  <div>\r\n                    <Label> </Label>\r\n                    <Input type=\"password\" value={branchLoginPassword} onChange={e => setBranchLoginPassword(e.target.value)} placeholder=\"\" />\r\n                  </div>\r\n                  <div className=\"flex items-center justify-end gap-2\">\r\n                    <Button variant=\"outline\" onClick={() => { setBranchLoginUsername(''); setBranchLoginPassword(''); }}></Button>\r\n                    <Button className=\"bg-blue-600 hover:bg-blue-700\" disabled={branchAuthLoading} onClick={async () => {\r\n                      const b = branchLoginTarget;\r\n                      if (!b) { setBranchLoginOpen(false); return; }\r\n                      const expectedUser = String(b.loginUsername || '');\r\n                      let expectedPw = '';\r\n                      try {\r\n                        const enc = String(b.passwordEncoded || '');\r\n                        expectedPw = enc ? decodeURIComponent(escape(atob(enc))) : '';\r\n                      } catch {\r\n                        try { expectedPw = b.passwordEncoded ? atob(String(b.passwordEncoded)) : ''; } catch { expectedPw = ''; }\r\n                      }\r\n                      const u = branchLoginUsername.trim();\r\n                      const p = branchLoginPassword.trim();\r\n                      if (!u || !p) { toast({ title: '     ' }); return; }\r\n                      if (u !== expectedUser || p !== expectedPw) { toast({ title: '   ', variant: 'destructive' }); return; }\r\n                      try {\r\n                        setBranchAuthLoading(true);\r\n                        const key = user?.uid ? `selectedShopId_${user.uid}` : 'selectedShopId';\r\n                        localStorage.setItem(key, String(b.shopId));\r\n                        toast({ title: '   ', description: String(b.branchName || '') });\r\n                        setBranchLoginOpen(false);\r\n                        setBranchDialogOpen(false);\r\n                        navigate('/user/dashboard');\r\n                      } catch { }\r\n                      setBranchAuthLoading(false);\r\n                    }}></Button>\r\n                  </div>\r\n                </div>\r\n              </DialogContent>\r\n            </Dialog>\r\n            <CardContent\r\n              ref={formRef}\r\n              className=\"space-y-1 px-2 pb-2 relative z-10 transition-transform duration-200 ease-out will-change-transform\"\r\n              style={{ transform: formTranslateY ? `translateY(${formTranslateY}px)` : undefined }}\r\n              onFocusCapture={(e) => {\r\n                const target = e.target as HTMLElement | null;\r\n                const isTransferFee = target?.id === 'transferExtraFeeInput';\r\n                if (!isTransferFee) {\r\n                  setFormTranslateY(0);\r\n                  return;\r\n                }\r\n                const btn = document.getElementById('transferSubmitButton') as HTMLButtonElement | null;\r\n                if (btn) {\r\n                  const rect = btn.getBoundingClientRect();\r\n                  const viewBottom = window.innerHeight;\r\n                  if (rect.bottom > viewBottom) {\r\n                    const needed = rect.bottom - viewBottom;\r\n                    const offset = Math.min(needed, 220);\r\n                    setFormTranslateY(-offset);\r\n                  } else {\r\n                    setFormTranslateY(0);\r\n                  }\r\n                } else {\r\n                  setFormTranslateY(0);\r\n                }\r\n              }}\r\n              onBlurCapture={(e) => {\r\n                if (!e.currentTarget.contains(e.relatedTarget as Node)) {\r\n                  setFormTranslateY(0);\r\n                }\r\n              }}\r\n            >\r\n              <div className=\"transaction-type-tabs grid grid-cols-2 gap-0.5 p-0.5 bg-gradient-to-r from-gray-50 to-slate-50 rounded-xl border border-gray-200/50 fade-in-up w-full lg:w-[92%] xl:w-[95%] mx-auto \">\r\n                <Button\r\n                  variant={transactionType === 'transfer' ? 'default' : 'ghost'}\r\n                  onClick={() => handleTransactionTypeChange('transfer')}\r\n                  className={`text-xs font-semibold transition-all duration-300 hover:scale-105 h-7 rounded-lg px-2 ${transactionType === 'transfer'\r\n                    ? 'bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg hover:shadow-md hover:from-blue-600 hover:to-indigo-700'\r\n                    : 'text-gray-600 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 hover:text-blue-700 hover:border-blue-200'\r\n                    }`}\r\n                >\r\n                  <ArrowUpDown className=\"h-1 w-1 mr-1\" />\r\n                  \r\n                </Button>\r\n                <Button\r\n                  variant={transactionType === 'withdraw' ? 'default' : 'ghost'}\r\n                  onClick={() => handleTransactionTypeChange('withdraw')}\r\n                  className={`text-xs font-semibold transition-all duration-300 hover:scale-105 h-7 rounded-lg px-2 ${transactionType === 'withdraw'\r\n                    ? 'bg-gradient-to-r from-emerald-500 to-green-600 text-white shadow-lg hover:shadow-md hover:from-emerald-600 hover:to-green-700'\r\n                    : 'text-gray-600 hover:bg-gradient-to-r hover:from-emerald-50 hover:to-green-50 hover:text-emerald-700 hover:border-emerald-200'\r\n                    }`}\r\n                >\r\n                  <ArrowDownLeft className=\"h-1 w-1 mr-1\" />\r\n                  \r\n                </Button>\r\n              </div>\r\n\r\n              {/* Wallet Selection */}\r\n              <div className=\"fade-in-up\">\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                  <label className=\"text-sm font-semibold text-gray-700 block flex items-center gap-2\">\r\n                    <Wallet className=\"h-1 w-1 text-blue-600\" />\r\n                     \r\n                  </label>\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <Button\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      className=\"h-6 rounded-md px-2 text-[10px] bg-emerald-50 text-emerald-700 hover:bg-emerald-100 border border-emerald-200\"\r\n                      onClick={() => navigate('/user/add-wallet')}\r\n                      title=\" \"\r\n                    >\r\n                      <Plus className=\"h-3 w-3 mr-1\" />\r\n                       \r\n                    </Button>\r\n                    <Button\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      className=\"h-6 rounded-md px-2 text-[10px] bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200\"\r\n                      onClick={() => {\r\n                        //          \r\n                        setIsWalletsPinDialogOpen(true);\r\n                      }}\r\n                      title=\"\"\r\n                    >\r\n                      <Wallet className=\"h-3 w-3 mr-1\" />\r\n                      \r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n                {wallets.length > 0 ? (\r\n                  <Select value={selectedWallet} onValueChange={handleWalletChange}>\r\n                    <SelectTrigger data-testid=\"wallet-select\" className={`selected-number-card w-full h-12 text-sm bg-gradient-to-r from-white to-gray-50 border-2 border-gray-200 hover:border-blue-400 focus:border-blue-500 rounded-xl transition-all duration-300 hover:shadow-md focus:shadow-lg`}>\r\n                      <SelectValue placeholder=\"  \" className=\"text-gray-600\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent className=\"rounded-xl border-2 border-gray-200 shadow-md z-[9999]\">\r\n                      {/*      */}\r\n                      <div data-fixed-header=\"true\" className=\"sticky top-0 z-10 bg-white p-2 border-b border-gray-200\">\r\n                        <Input\r\n                          value={walletSearch}\r\n                          onChange={(e) => setWalletSearch(e.target.value)}\r\n                          placeholder=\"  \"\r\n                          className=\"h-6 text-xs\"\r\n                        />\r\n                      </div>\r\n                      <div className=\"pr-1\">\r\n                        {filteredWallets.length === 0 ? (\r\n                          <div className=\"text-xs text-gray-500 p-2\">   </div>\r\n                        ) : (\r\n                          filteredWallets.map((wallet) => (\r\n                            <SelectItem key={wallet.id} value={wallet.id} className=\"rounded-lg hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 transition-all duration-200\">\r\n                              <div className=\"flex items-center gap-1 py-1 w-full justify-between\">\r\n                                <div className=\"p-1 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-lg\">\r\n                                  <Wallet className=\"h-1 w-1 text-blue-600\" />\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2 flex-1\">\r\n                                  <div className=\"flex items-center gap-1\">\r\n                                    <span className=\"text-sm font-medium text-gray-800\">{wallet.name}</span>\r\n                                    <span className=\"text-sm font-semibold text-red-600\">({wallet.phone})</span>\r\n                                  </div>\r\n                                  {wallet.isDefault && (\r\n                                    <Badge variant=\"secondary\" className=\"text-[10px] bg-gradient-to-r from-emerald-100 to-green-100 text-emerald-700 border-emerald-200\"></Badge>\r\n                                  )}\r\n                                </div>\r\n                                <div className=\"ml-auto flex flex-col items-end gap-1\">\r\n\r\n                                </div>\r\n                              </div>\r\n                            </SelectItem>\r\n                          ))\r\n                        )}\r\n                      </div>\r\n                    </SelectContent>\r\n                  </Select>\r\n                ) : (\r\n                  <div className=\"rounded-xl border-2 border-dashed border-gray-200 bg-gray-50 px-3 py-3 text-xs text-gray-600\">\r\n                        .      .\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Wallets View Dialog */}\r\n              <Dialog open={isWalletsDialogOpen} onOpenChange={setIsWalletsDialogOpen}>\r\n                <DialogContent className=\"sm:max-w-3xl w-[95vw] sm:w-auto max-h-[80vh] overflow-y-auto\">\r\n                  <DialogHeader>\r\n                    <DialogTitle> </DialogTitle>\r\n                  </DialogHeader>\r\n                  <div className=\"mt-2\">\r\n                    <WalletsManagement\r\n                      showAddButton={false}\r\n                      showUsageBars={false}\r\n                      showLimitCards={false}\r\n                      showEditButton={true}\r\n                    />\r\n                  </div>\r\n                </DialogContent>\r\n              </Dialog>\r\n\r\n              {/*       */}\r\n              <MasterPinDialog\r\n                open={isWalletsPinDialogOpen}\r\n                onOpenChange={setIsWalletsPinDialogOpen}\r\n                mode=\"verify\"\r\n                title=\"   \"\r\n                description=\"      \"\r\n                onSuccess={() => {\r\n                  setIsWalletsPinDialogOpen(false);\r\n                  setIsWalletsDialogOpen(true);\r\n                }}\r\n                userId={user?.uid}\r\n              />\r\n\r\n              {/*       */}\r\n              <MasterPinDialog\r\n                open={isWalletSelectionPinDialogOpen}\r\n                onOpenChange={(open) => {\r\n                  setIsWalletSelectionPinDialogOpen(open);\r\n                  if (!open) {\r\n                    setPendingSelectedWalletId(null);\r\n                  }\r\n                }}\r\n                mode=\"verify\"\r\n                title=\"  \"\r\n                description=\"      \"\r\n                onSuccess={() => {\r\n                  if (pendingSelectedWalletId) {\r\n                    setWalletSelection(pendingSelectedWalletId, 'walletSelectionPin');\r\n                    setPendingSelectedWalletId(null);\r\n                  }\r\n                  setIsWalletSelectionPinDialogOpen(false);\r\n                }}\r\n                userId={user?.uid}\r\n              />\r\n\r\n              {/*      */}\r\n              <Dialog open={isMonthlyLimitWarnOpen} onOpenChange={setIsMonthlyLimitWarnOpen}>\r\n                <DialogContent className=\"sm:max-w-md\">\r\n                  <DialogHeader>\r\n                    <DialogTitle className=\"flex items-center gap-2 text-red-700\">\r\n                      <AlertTriangle className=\"h-5 w-5 text-red-600\" />\r\n                         \r\n                    </DialogTitle>\r\n                  </DialogHeader>\r\n                  <div className=\"space-y-3\">\r\n                    <div className=\"p-3 rounded-md border bg-red-50 border-red-200\">\r\n                      <p className=\"text-sm text-red-800\">\r\n                        : <span className=\"font-semibold\">{monthlyLimitWarnData?.walletName || ''}</span>\r\n                      </p>\r\n                      <p className=\"text-sm text-red-800\">\r\n                          ({monthlyLimitWarnData?.type === 'withdraw' ? '' : ''}):\r\n                        <span className=\"font-mono\"> {Number(monthlyLimitWarnData?.used || 0).toLocaleString('en-US')} </span> \r\n                      </p>\r\n                      <p className=\"text-sm text-red-800\">\r\n                         : <span className=\"font-mono\">{Number(monthlyLimitWarnData?.limit || 0).toLocaleString('en-US')}</span> \r\n                      </p>\r\n                      <p className=\"text-sm font-semibold text-red-900 mt-1\">\r\n                           85%        .\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-2\">\r\n                      <Button variant=\"outline\" onClick={() => setIsMonthlyLimitWarnOpen(false)}></Button>\r\n                    </div>\r\n                  </div>\r\n                </DialogContent>\r\n              </Dialog>\r\n\r\n              {/* Combined Progress Bar for Monthly and Daily Limits - Per Wallet */}\r\n              {selectedWallet && wallets.length > 0 && (() => {\r\n                const selectedWalletObj = wallets.find(w => w.id === selectedWallet);\r\n                const walletMonthlyUsage = walletMonthlyUsageMemo;\r\n                const walletDailyUsage = calculateWalletDailyUsage(selectedWallet);\r\n\r\n                //      (    / )\r\n                const monthlyWithdrawalLimit = selectedWalletLimits?.monthlyWithdrawLimit ?? selectedWalletObj?.monthlyWithdrawalLimit ?? 200000;\r\n                const monthlyTransferLimit = selectedWalletLimits?.monthlyTransferLimit ?? selectedWalletObj?.monthlyTransferLimit ?? 200000;\r\n                const monthlyWithdrawUsed = selectedWalletLimits?.monthlyWithdrawUsed ?? walletMonthlyUsage.totalWithdrawn ?? 0;\r\n                const monthlyTransferUsed = selectedWalletLimits?.monthlyTransferUsed ?? walletMonthlyUsage.totalTransferred ?? 0;\r\n\r\n                const isTahweelaPlan = userSubscription?.subscription?.planType === SubscriptionPlan.TAHWEELA;\r\n                const dailyWithdrawalLimit = isTahweelaPlan ? 0 : (selectedWalletLimits?.dailyWithdrawLimit ?? 100000);\r\n                const dailyTransferLimit = isTahweelaPlan ? 0 : (selectedWalletLimits?.dailyTransferLimit ?? 60000);\r\n                const dailyWithdrawUsed = isTahweelaPlan ? 0 : (selectedWalletLimits?.dailyWithdrawUsed ?? walletDailyUsage.totalWithdrawn ?? 0);\r\n                const dailyTransferUsed = isTahweelaPlan ? 0 : (selectedWalletLimits?.dailyTransferUsed ?? walletDailyUsage.totalTransferred ?? 0);\r\n\r\n                //        \r\n                const amountNum = parseFloat(amount || '0') || 0;\r\n                const predictedMonthlyWithdrawUsed = monthlyWithdrawUsed + (transactionType === 'withdraw' ? amountNum : 0);\r\n                const predictedMonthlyTransferUsed = monthlyTransferUsed + (transactionType === 'transfer' ? amountNum : 0);\r\n                const predictedDailyWithdrawUsed = dailyWithdrawUsed + (transactionType === 'withdraw' ? amountNum : 0);\r\n                const predictedDailyTransferUsed = dailyTransferUsed + (transactionType === 'transfer' ? amountNum : 0);\r\n\r\n                if (!selectedWalletObj) return null;\r\n\r\n                return (\r\n                  <div className=\"fade-in-up mb-2 space-y-2\">\r\n                    {/* Monthly Limits */}\r\n                    <div className=\"bg-gradient-to-r from-gray-50 to-gray-100 p-1 rounded-md border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300\">\r\n                      {/* Wallet Name Header */}\r\n                      <div className=\"text-[10px] text-gray-600 font-medium mb-1 text-center\"> : {selectedWalletName || selectedWalletObj?.name || ' '}</div>\r\n\r\n                      {/* Combined Progress Bar */}\r\n                      <div className=\"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex\">\r\n                        {/* Withdrawal Half */}\r\n                        <div className=\"w-1/2 bg-red-200 relative\">\r\n                          <div\r\n                            className=\"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-200 ease-out shadow-sm\"\r\n                            style={{ width: `${Math.min(((predictedMonthlyWithdrawUsed / Math.max(monthlyWithdrawalLimit, 1)) * 100), 100)}%` }}\r\n                          ></div>\r\n                        </div>\r\n                        {/* Transfer Half */}\r\n                        <div className=\"w-1/2 bg-blue-200 relative\">\r\n                          <div\r\n                            className=\"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-200 ease-out shadow-sm\"\r\n                            style={{ width: `${Math.min(((predictedMonthlyTransferUsed / Math.max(monthlyTransferLimit, 1)) * 100), 100)}%` }}\r\n                          ></div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Footer with remaining amounts */}\r\n                      <div className=\"flex justify-between items-center mt-0.5\">\r\n                        <div className=\"text-[10px] text-red-600 font-medium\">\r\n                           : {Math.max(monthlyWithdrawalLimit - predictedMonthlyWithdrawUsed, 0).toLocaleString('en-US')} \r\n                        </div>\r\n                        <div className=\"text-[10px] text-blue-600 font-medium\">\r\n                           : {Math.max(monthlyTransferLimit - predictedMonthlyTransferUsed, 0).toLocaleString('en-US')} \r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Daily Limits */}\r\n                    {(\r\n                      <div className=\"bg-gradient-to-r from-gray-50 to-gray-100 p-1 rounded-md border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300\">\r\n                        {/* Daily Limits Header */}\r\n                        <div className=\"text-[10px] text-gray-600 font-medium mb-1 text-center\"> : {selectedWalletName || selectedWalletObj?.name || ' '}</div>\r\n\r\n                        {/* Combined Progress Bar for Daily Limits */}\r\n                        <div className=\"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex\">\r\n                          {/* Daily Withdrawal Half */}\r\n                          <div className=\"w-1/2 bg-orange-200 relative\">\r\n                            <div\r\n                              className=\"bg-gradient-to-r from-orange-400 to-orange-600 h-1 transition-all duration-200 ease-out shadow-sm\"\r\n                              style={{ width: `${Math.min(((predictedDailyWithdrawUsed / Math.max(dailyWithdrawalLimit, 1)) * 100), 100)}%` }}\r\n                            ></div>\r\n                          </div>\r\n                          {/* Daily Transfer Half */}\r\n                          <div className=\"w-1/2 bg-green-200 relative\">\r\n                            <div\r\n                              className=\"bg-gradient-to-r from-green-400 to-green-600 h-1 transition-all duration-200 ease-out shadow-sm\"\r\n                              style={{ width: `${Math.min(((predictedDailyTransferUsed / Math.max(dailyTransferLimit, 1)) * 100), 100)}%` }}\r\n                            ></div>\r\n                          </div>\r\n                        </div>\r\n\r\n                        {/* Footer with remaining daily amounts */}\r\n                        <div className=\"flex justify-between items-center mt-0.5\">\r\n                          <div className=\"text-[10px] text-orange-600 font-medium\">\r\n                              : {Math.max(dailyWithdrawalLimit - predictedDailyWithdrawUsed, 0).toLocaleString('en-US')} \r\n                          </div>\r\n                          <div className=\"text-[10px] text-green-600 font-medium\">\r\n                              : {Math.max(dailyTransferLimit - predictedDailyTransferUsed, 0).toLocaleString('en-US')} \r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })()}\r\n\r\n              {transactionType === 'transfer' ? (\r\n                <>\r\n                  <div className=\"fade-in-up\">\r\n                    <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\r\n                       \r\n                    </label>\r\n                    <div className=\"relative\">\r\n                      <Phone className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400\" />\r\n                      <Input\r\n                        value={senderPhone}\r\n                        onChange={(e) => setSenderPhone(e.target.value)}\r\n                        onKeyDown={(e) => {\r\n                          if (e.key === 'Enter') {\r\n                            const dest = document.getElementById('receiverPhoneInput') as HTMLInputElement | null;\r\n                            if (dest) {\r\n                              dest.focus();\r\n                            } else {\r\n                              const amountEl = document.getElementById('amountInput') as HTMLInputElement | null;\r\n                              amountEl?.focus();\r\n                            }\r\n                          }\r\n                        }}\r\n                        placeholder=\"01030302038\"\r\n                        className=\"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base transition-all duration-300 hover:border-blue-400 focus:border-blue-500\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  {!isVodafoneCashUser && (\r\n                    <div className=\"fade-in-up\">\r\n                      <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\r\n                         \r\n                      </label>\r\n                      <div className=\"relative\">\r\n                        <Phone className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400\" />\r\n                        <Input\r\n                          id=\"receiverPhoneInput\"\r\n                          value={receiverPhone}\r\n                          onChange={(e) => {\r\n                            setReceiverPhone(e.target.value);\r\n                            if (isTransferSuccess) {\r\n                              setIsTransferSuccess(false);\r\n                            }\r\n                          }}\r\n                          onKeyDown={(e) => {\r\n                            if (e.key === 'Enter') {\r\n                              const next = document.getElementById('amountInput') as HTMLInputElement | null;\r\n                              next?.focus();\r\n                            }\r\n                          }}\r\n                          inputMode=\"numeric\"\r\n                          maxLength={11}\r\n                          placeholder=\"  \"\r\n                          className=\"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base transition-all duration-300 hover:border-blue-400 focus:border-blue-500\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </>\r\n              ) : (\r\n                <div className=\"fade-in-up\">\r\n                  <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\r\n                     \r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <Phone className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400\" />\r\n                    <Input\r\n                      value={selectedWallet ? wallets.find(w => w.id === selectedWallet)?.phone || '' : ''}\r\n                      readOnly\r\n                      placeholder=\"  \"\r\n                      className=\"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base bg-gray-50 transition-all duration-300\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {transactionType === 'transfer' ? (\r\n                <>\r\n                  <div className=\"fade-in-up\">\r\n                    <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\r\n                       ()\r\n                    </label>\r\n                    <div className=\"relative flex items-center gap-2\">\r\n                      <DollarSign className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400\" />\r\n                      <Input\r\n                        id=\"amountInput\"\r\n                        value={amount}\r\n                        onChange={(e) => {\r\n                          setAmount(e.target.value);\r\n                          if (isTransferSuccess) {\r\n                            setIsTransferSuccess(false);\r\n                          }\r\n                        }}\r\n                        onKeyDown={(e) => {\r\n                          if (e.key === 'Enter') {\r\n                            const commissionEl = document.getElementById('transferCommissionInput') as HTMLInputElement | null;\r\n                            if (commissionEl) {\r\n                              commissionEl.focus();\r\n                            } else {\r\n                              const quickBtn = document.getElementById('quickDebtButton') as HTMLButtonElement | null;\r\n                              quickBtn?.focus();\r\n                            }\r\n                          }\r\n                        }}\r\n                        placeholder=\" \"\r\n                        type=\"number\"\r\n                        className=\"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base transition-all duration-300 hover:border-blue-400 focus:border-blue-500\"\r\n                      />\r\n\r\n                    </div>\r\n                    {quickDebtInfo ? (\r\n                      <div className=\"mt-2 text-xs text-green-700 bg-green-50 border border-green-200 rounded px-2 py-1 flex items-center gap-2\">\r\n                        <span>     {quickDebtInfo.debtorName}  {quickDebtInfo.amount} </span>\r\n                        <Button type=\"button\" variant=\"ghost\" size=\"sm\" className=\"h-6 px-2\" onClick={() => setQuickDebtInfo(null)}></Button>\r\n                      </div>\r\n                    ) : null}\r\n                  </div>\r\n\r\n                  {(() => {\r\n                    if (isVodafoneCashUser) return null;\r\n                    const sw = getSelectedWalletObj();\r\n                    const hasDefault = sw && sw.defaultTransferCommission != null;\r\n                    if (hasDefault) {\r\n                      return (\r\n                        <div className=\"fade-in-up\">\r\n                          <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\r\n                              ()\r\n                          </label>\r\n                          <div className=\"text-xs text-gray-500 mt-1\">\r\n                                  : {sw?.defaultTransferCommission}   \r\n                          </div>\r\n                          <div className=\"mt-2 flex items-center gap-2\">\r\n                            <Button\r\n                              id=\"quickDebtButton\"\r\n                              type=\"button\"\r\n                              size=\"sm\"\r\n                              className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n                              onClick={() => {\r\n                                const swInner = getSelectedWalletObj();\r\n                                const commissionPerThousand = swInner?.defaultTransferCommission != null\r\n                                  ? Number(swInner.defaultTransferCommission)\r\n                                  : 0;\r\n                                const baseAmount = parseFloat(amount || '0') || 0;\r\n                                const commissionCalc = Math.round((((commissionPerThousand || 0) * baseAmount) / 1000) * 100) / 100;\r\n                                const debtVal = baseAmount + commissionCalc;\r\n                                setQuickDebtAmount((debtVal || 0).toString());\r\n                                if (isZeroPlan) {\r\n                                  toast({ title: ' ', description: '      .  .', variant: 'destructive' });\r\n                                } else {\r\n                                  setIsQuickDebtOpen(true);\r\n                                }\r\n                              }}\r\n                            >\r\n                              \r\n                            </Button>\r\n                            <Button\r\n                              type=\"button\"\r\n                              variant=\"outline\"\r\n                              size=\"icon\"\r\n                              className=\"hidden\"\r\n                              title={isCommissionAddMode ? ' ' : ' '}\r\n                            >\r\n                              {isCommissionAddMode ? <Plus className=\"h-4 w-4 text-green-600\" /> : <Minus className=\"h-4 w-4 text-red-600\" />}\r\n                            </Button>\r\n                            <span className=\"hidden\">\r\n                              {isCommissionAddMode ? ' ' : ' '}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    }\r\n                    return (\r\n                      <div className=\"fade-in-up\">\r\n                        <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\r\n                              ()\r\n                        </label>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"relative flex-1\">\r\n                            <DollarSign className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-orange-500\" />\r\n                            <Input\r\n                              id=\"transferCommissionInput\"\r\n                              value={transferCommission}\r\n                              onChange={(e) => setTransferCommission(e.target.value)\r\n                              }\r\n                              placeholder=\"  \"\r\n                              type=\"number\"\r\n                              className=\"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base transition-all duration-300 hover:border-blue-400 focus:border-blue-500\"\r\n                            />\r\n                          </div>\r\n                          <Button\r\n                            type=\"button\"\r\n                            size=\"sm\"\r\n                            className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n                            onClick={() => {\r\n                              const swInner = getSelectedWalletObj();\r\n                              const baseAmount = parseFloat(amount || '0') || 0;\r\n                              let commissionCalc = 0;\r\n                              if (swInner?.defaultTransferCommission != null) {\r\n                                const rate = Number(swInner.defaultTransferCommission) || 0;\r\n                                commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\r\n                              } else {\r\n                                const manualFixed = transferCommission && transferCommission.trim() !== '' ? parseFloat(transferCommission) : 0;\r\n                                commissionCalc = Math.max(0, manualFixed);\r\n                              }\r\n                              const debtVal = baseAmount + commissionCalc;\r\n                              setQuickDebtAmount((debtVal || 0).toString());\r\n                              if (isZeroPlan) {\r\n                                toast({ title: ' ', description: '      .  .', variant: 'destructive' });\r\n                              } else {\r\n                                setIsQuickDebtOpen(true);\r\n                              }\r\n                            }}\r\n                          >\r\n                            \r\n                          </Button>\r\n                          <Button\r\n                            type=\"button\"\r\n                            variant=\"outline\"\r\n                            size=\"icon\"\r\n                            className=\"hidden\"\r\n                            title={isCommissionAddMode ? ' ' : ' '}\r\n                          >\r\n                            {isCommissionAddMode ? <Plus className=\"h-4 w-4 text-green-600\" /> : <Minus className=\"h-4 w-4 text-red-600\" />}\r\n                          </Button>\r\n                          <span className=\"hidden\">\r\n                            {isCommissionAddMode ? ' ' : ' '}\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-500 mt-1\">\r\n                               ()\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })()}\r\n\r\n                  {(() => {\r\n                    const s = normalizeDigits(senderPhone || '').replace(/\\D/g, '');\r\n                    const r = normalizeDigits(receiverPhone || '').replace(/\\D/g, '');\r\n                    const showFee = transactionType === 'transfer' && (\r\n  (s.startsWith('010') && r.startsWith('010')) ||\r\n  (s.startsWith('010') && (r.startsWith('011') || r.startsWith('012') || r.startsWith('015'))) ||\r\n  (s.startsWith('012') && r.startsWith('010')) ||\r\n  (s.startsWith('011') && r.startsWith('010')) ||\r\n  (s.startsWith('015') && r.startsWith('010'))\r\n);\r\n                    if (!showFee) return null;\r\n                    return (\r\n                      <div className=\"fade-in-up\">\r\n                        <label className=\"text-sm font-medium text-gray-700 mb-1 block\">  ()</label>\r\n                        <div className=\"relative\">\r\n                          <DollarSign className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-orange-500\" />\r\n                          <Input\r\n                            id=\"transferExtraFeeInput\"\r\n                            value={transferExtraFee}\r\n                            onChange={(e) => setTransferExtraFee(e.target.value)}\r\n                            placeholder=\"  \"\r\n                            type=\"number\"\r\n                            className=\"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base transition-all duration-300 hover:border-blue-400 focus:border-blue-500\"\r\n                          />\r\n                        </div>\r\n                        <div className=\"hidden\">\r\n                                 010  011/012/015  012  010  011  010  015  010\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })()}\r\n\r\n                  <div className=\"sticky bottom-0 z-10 pt-2 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60\">\r\n                    <Button\r\n                      id=\"transferSubmitButton\"\r\n                      onClick={handleTransaction}\r\n                      className=\"btn-transfer-confirm w-full font-medium h-11 lg:h-12 text-sm lg:text-base btn-bounce hover-glow transition-all duration-300 text-white\"\r\n                    >\r\n                      {isTransferSuccess ? \"  \" : \" \"}\r\n                    </Button>\r\n                  </div>\r\n                </>\r\n              ) : (\r\n                <>\r\n                <div className=\"fade-in-up\">\r\n                  <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\r\n                      ()\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <ArrowDownLeft className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-green-500\" />\r\n                    <Input\r\n                      id=\"amountInput\"\r\n                      value={amount}\r\n                      onChange={(e) => {\r\n                        setAmount(e.target.value);\r\n                        if (isWithdrawSuccess) {\r\n                          setIsWithdrawSuccess(false);\r\n                        }\r\n                      }}\r\n                      onKeyDown={(e) => {\r\n                        if (e.key === 'Enter') {\r\n                          const manualEl = document.getElementById('manualWithdrawCommissionInput') as HTMLInputElement | null;\r\n                          if (manualEl) {\r\n                            manualEl.focus();\r\n                          } else {\r\n                            const submitBtn = document.getElementById('withdrawSubmitButton') as HTMLButtonElement | null;\r\n                            submitBtn?.focus();\r\n                          }\r\n                        }\r\n                      }}\r\n                      placeholder=\"  \"\r\n                      type=\"number\"\r\n                      className=\"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base transition-all duration-300 hover:border-blue-400 focus:border-blue-500\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {isWithdrawSenderNameInputEnabled && (\r\n                  <div className=\"fade-in-up\">\r\n                    <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\r\n                        ()\r\n                    </label>\r\n                    <div className=\"relative\">\r\n                      <User className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-500\" />\r\n                      <Input\r\n                        id=\"withdrawSenderNameInput\"\r\n                        value={withdrawSenderName}\r\n                        onChange={(e) => setWithdrawSenderName(e.target.value)}\r\n                        onKeyDown={(e) => {\r\n                          if (e.key === 'Enter') {\r\n                            const manualEl = document.getElementById('manualWithdrawCommissionInput') as HTMLInputElement | null;\r\n                            manualEl?.focus();\r\n                          }\r\n                        }}\r\n                        placeholder=\"    \"\r\n                        className=\"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base transition-all duration-300 hover:border-blue-400 focus:border-blue-500\"\r\n                        type=\"text\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                  {(() => {\r\n                    const sw = getSelectedWalletObj();\r\n                    const hasDefault = sw && sw.defaultWithdrawCommission != null;\r\n                    if (hasDefault) {\r\n                      return (\r\n                        <div className=\"fade-in-up\">\r\n                          <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\r\n                              ()\r\n                          </label>\r\n                          <div className=\"text-xs text-gray-500 mt-1\">\r\n                                  : {sw?.defaultWithdrawCommission}   \r\n                          </div>\r\n                          <div className=\"mt-2 flex items-center gap-2\">\r\n                            <Button\r\n                              type=\"button\"\r\n                              size=\"sm\"\r\n                              className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n                              onClick={() => {\r\n                                const swInner = getSelectedWalletObj();\r\n                                const baseAmount = parseFloat(amount || '0') || 0;\r\n                                const rate = swInner?.defaultWithdrawCommission != null ? Number(swInner.defaultWithdrawCommission) || 0 : 0;\r\n                                const commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\r\n                                const debtVal = isCommissionAddMode ? (baseAmount + commissionCalc) : baseAmount;\r\n                                setQuickDebtAmount((debtVal || 0).toString());\r\n                                if (isZeroPlan) {\r\n                                  toast({ title: ' ', description: '      .  .', variant: 'destructive' });\r\n                                } else {\r\n                                  setIsQuickDebtOpen(true);\r\n                                }\r\n                              }}\r\n                            >\r\n                              \r\n                            </Button>\r\n                            <Button\r\n                              type=\"button\"\r\n                              variant=\"outline\"\r\n                              size=\"icon\"\r\n                              className=\"h-8 w-8\"\r\n                              onClick={() => setIsCommissionAddMode((prev) => !prev)}\r\n                              title={isCommissionAddMode ? '   ' : '   '}\r\n                            >\r\n                              {isCommissionAddMode ? (\r\n                                <Plus className=\"h-4 w-4\" />\r\n                              ) : (\r\n                                <Minus className=\"h-4 w-4\" />\r\n                              )}\r\n                            </Button>\r\n                            <span className=\"text-xs text-gray-600\">\r\n                              {isCommissionAddMode ? ' ' : ' '}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    }\r\n                    return (\r\n                      <div className=\"fade-in-up\">\r\n                        <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\r\n                              ()\r\n                        </label>\r\n                        <div className=\"relative\">\r\n                          <DollarSign className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-orange-500\" />\r\n                          <Input\r\n                            id=\"manualWithdrawCommissionInput\"\r\n                            value={manualCommission}\r\n                            onChange={(e) => setManualCommission(e.target.value)}\r\n                            onKeyDown={(e) => {\r\n                              if (e.key === 'Enter') {\r\n                                const submitBtn = document.getElementById('withdrawSubmitButton') as HTMLButtonElement | null;\r\n                                submitBtn?.focus();\r\n                              }\r\n                            }}\r\n                            placeholder=\"  \"\r\n                            type=\"number\"\r\n                            className=\"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base transition-all duration-300 hover:border-blue-400 focus:border-blue-500\"\r\n                          />\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-500 mt-1\">\r\n                               \r\n                        </div>\r\n                        <div className=\"mt-2 flex items-center gap-2\">\r\n                          <Button\r\n                            type=\"button\"\r\n                            size=\"sm\"\r\n                            className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n                            onClick={() => {\r\n                              const swInner = getSelectedWalletObj();\r\n                              const baseAmount = parseFloat(amount || '0') || 0;\r\n                              let commissionCalc = 0;\r\n                              if (swInner?.defaultWithdrawCommission != null) {\r\n                                const rate = Number(swInner.defaultWithdrawCommission) || 0;\r\n                                commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\r\n                              } else {\r\n                                const manualFixed = manualCommission && manualCommission.trim() !== ''\r\n                                  ? parseFloat(manualCommission)\r\n                                  : Math.round((baseAmount * 0.01) * 100) / 100;\r\n                                commissionCalc = Math.max(0, manualFixed);\r\n                              }\r\n                              const debtVal = isCommissionAddMode ? (baseAmount + commissionCalc) : baseAmount;\r\n                              setQuickDebtAmount((debtVal || 0).toString());\r\n                              if (isZeroPlan) {\r\n                                toast({ title: ' ', description: '      .  .', variant: 'destructive' });\r\n                              } else {\r\n                                setIsQuickDebtOpen(true);\r\n                              }\r\n                            }}\r\n                          >\r\n                            \r\n                          </Button>\r\n                          <Button\r\n                            type=\"button\"\r\n                            variant=\"outline\"\r\n                            size=\"icon\"\r\n                            title={isCommissionAddMode ? ' ' : ' '}\r\n                            onClick={() => setIsCommissionAddMode(prev => !prev)}\r\n                          >\r\n                            {isCommissionAddMode ? <Plus className=\"h-4 w-4 text-green-600\" /> : <Minus className=\"h-4 w-4 text-red-600\" />}\r\n                          </Button>\r\n                          <span className=\"text-xs text-gray-600\">\r\n                            {isCommissionAddMode ? ' ' : ' '}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })()}\r\n\r\n                  {/*    */}\r\n                  {profile?.showWithdrawNote && (\r\n                    <div className=\"fade-in-up\">\r\n                      <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\r\n                          ()\r\n                      </label>\r\n                      <div className=\"relative\">\r\n                        <MessageCircle className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400\" />\r\n                        <Input\r\n                          id=\"withdrawNoteInput\"\r\n                          value={withdrawNote}\r\n                          onChange={(e) => setWithdrawNote(e.target.value)}\r\n                          onKeyDown={(e) => {\r\n                            if (e.key === 'Enter') {\r\n                              const submitBtn = document.getElementById('withdrawSubmitButton') as HTMLButtonElement | null;\r\n                              submitBtn?.focus();\r\n                            }\r\n                          }}\r\n                          placeholder=\"   ()\"\r\n                          className=\"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base transition-all duration-300 hover:border-blue-400 focus:border-blue-500\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  <div className=\"sticky bottom-0 z-10 pt-2 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60\">\r\n                    <Button\r\n                      id=\"withdrawSubmitButton\"\r\n                      onClick={handleTransaction}\r\n                      className=\"w-full font-medium h-11 lg:h-12 text-sm lg:text-base btn-bounce hover-glow transition-all duration-300 bg-green-600 hover:bg-green-700 text-white\"\r\n                    >\r\n                      {isWithdrawSuccess ? \"  \" : \" \"}\r\n                    </Button>\r\n                  </div>\r\n                </>\r\n              )}\r\n\r\n              {/*      */}\r\n              <Dialog open={isQuickDebtOpen} onOpenChange={setIsQuickDebtOpen}>\r\n                <DialogContent>\r\n                  <DialogHeader>\r\n                    <DialogTitle> </DialogTitle>\r\n                    <DialogDescription>        </DialogDescription>\r\n                  </DialogHeader>\r\n                  <div className=\"space-y-3\">\r\n                    {customers && customers.length > 0 ? (\r\n                      <div>\r\n                        <Label> </Label>\r\n                        <Select value={quickDebtCustomerId} onValueChange={(val) => {\r\n                          setQuickDebtCustomerId(val);\r\n                          const selected = customers.find(c => c.id === val);\r\n                          if (selected) {\r\n                            setQuickDebtName(selected.name);\r\n                          }\r\n                        }}>\r\n                          <SelectTrigger className=\"w-full\">\r\n                            <SelectValue placeholder=\" \" />\r\n                          </SelectTrigger>\r\n                          <SelectContent>\r\n                            {customers.map(c => (\r\n                              <SelectItem key={c.id} value={c.id}>{c.name}{c.mobile ? `  ${c.mobile}` : ''}</SelectItem>\r\n                            ))}\r\n                          </SelectContent>\r\n                        </Select>\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"text-xs text-gray-500\">    .      .</div>\r\n                    )}\r\n                    <div>\r\n                      <Label htmlFor=\"quickDebtName\">  </Label>\r\n                      <Input id=\"quickDebtName\" value={quickDebtName} onChange={(e) => setQuickDebtName(e.target.value)} placeholder=\" \" />\r\n                    </div>\r\n                    <div>\r\n                      <Label htmlFor=\"quickDebtAmount\"> ( )</Label>\r\n                      <Input id=\"quickDebtAmount\" type=\"number\" value={quickDebtAmount} readOnly placeholder=\" +  \" />\r\n                    </div>\r\n                    <div>\r\n                      <Label htmlFor=\"quickDebtCommission\"> ( )</Label>\r\n                      <Input\r\n                        id=\"quickDebtCommission\"\r\n                        type=\"number\"\r\n                        value={(function () {\r\n                          const sw = getSelectedWalletObj();\r\n                          const baseAmount = parseFloat((amount || '0').toString()) || 0;\r\n                          let commissionCalc = 0;\r\n                          if (transactionType === 'transfer') {\r\n                            if (sw?.defaultTransferCommission != null) {\r\n                              const rate = Number(sw.defaultTransferCommission) || 0;\r\n                              commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\r\n                            } else {\r\n                              const manualFixed = transferCommission && transferCommission.trim() !== '' ? parseFloat(transferCommission) : 0;\r\n                              commissionCalc = Math.max(0, manualFixed);\r\n                            }\r\n                          } else {\r\n                            if (sw?.defaultWithdrawCommission != null) {\r\n                              const rate = Number(sw.defaultWithdrawCommission) || 0;\r\n                              commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\r\n                            } else {\r\n                              const manualFixed = manualCommission && manualCommission.trim() !== '' ? parseFloat(manualCommission) : Math.round((baseAmount * 0.01) * 100) / 100;\r\n                              commissionCalc = Math.max(0, manualFixed);\r\n                            }\r\n                          }\r\n                          return String(commissionCalc || 0);\r\n                        })()}\r\n                        readOnly\r\n                        placeholder=\" \"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <Label htmlFor=\"quickDebtNotes\"></Label>\r\n                      <Input id=\"quickDebtNotes\" value={quickDebtNotes} onChange={(e) => setQuickDebtNotes(e.target.value)} placeholder=\"  ()\" />\r\n                    </div>\r\n                  </div>\r\n                  <DialogFooter>\r\n                    <Button\r\n                      type=\"button\"\r\n                      variant=\"default\"\r\n                      className=\"bg-green-600 text-white hover:bg-green-700\"\r\n                      onClick={() => {\r\n                        const sw = getSelectedWalletObj();\r\n                        const baseAmount = parseFloat((amount || '').toString()) || 0;\r\n                        let commissionCalc = 0;\r\n                        if (transactionType === 'transfer') {\r\n                          if (sw?.defaultTransferCommission != null) {\r\n                            const rate = Number(sw.defaultTransferCommission) || 0;\r\n                            commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\r\n                          } else {\r\n                            const manualFixed = transferCommission && transferCommission.trim() !== '' ? parseFloat(transferCommission) : 0;\r\n                            commissionCalc = Math.max(0, manualFixed);\r\n                          }\r\n                        } else {\r\n                          if (sw?.defaultWithdrawCommission != null) {\r\n                            const rate = Number(sw.defaultWithdrawCommission) || 0;\r\n                            commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\r\n                          } else {\r\n                            const manualFixed = manualCommission && manualCommission.trim() !== '' ? parseFloat(manualCommission) : Math.round((baseAmount * 0.01) * 100) / 100;\r\n                            commissionCalc = Math.max(0, manualFixed);\r\n                          }\r\n                        }\r\n                        let amountToSave = 0;\r\n                        if (transactionType === 'withdraw') {\r\n                          amountToSave = isCommissionAddMode\r\n                            ? baseAmount\r\n                            : Math.max(0, Math.round((baseAmount - commissionCalc) * 100) / 100);\r\n                        } else {\r\n                          //       \r\n                          amountToSave = Math.max(0, Math.round((baseAmount + commissionCalc) * 100) / 100);\r\n                        }\r\n                        if (!quickDebtName || isNaN(amountToSave) || amountToSave <= 0) {\r\n                          toast({ title: '   ', description: '     ', variant: 'destructive' });\r\n                          return;\r\n                        }\r\n                        const selectedCustomer = customers.find(c => c.id === quickDebtCustomerId);\r\n                        //              \r\n                        setQuickDebtInfo({ debtorName: quickDebtName, amount: amountToSave, notes: quickDebtNotes, customerId: quickDebtCustomerId || undefined, mobile: selectedCustomer?.mobile });\r\n                        setDidCreateQuickDebt(false);\r\n                        setIsQuickDebtOpen(false);\r\n                        toast({ title: '   ', description: '     ', variant: 'default' });\r\n                      }}\r\n                    >\r\n                      \r\n                    </Button>\r\n                  </DialogFooter>\r\n                </DialogContent>\r\n              </Dialog>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Quick Actions */}\r\n          <Card className=\"bg-gradient-to-br from-red-50 to-red-100 border-red-200 fade-in-up card-float\">\r\n            <CardContent className=\"p-3 text-center\">\r\n              <div className=\"text-red-600 font-medium text-[10px] mb-1\">\r\n                   \r\n              </div>\r\n              <div className=\"text-[10px] text-red-700\">\r\n                         \r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n\r\n      </div>\r\n\r\n      {/* Wallet Management Modal */}\r\n      <WalletManagement\r\n        isOpen={isWalletManagementOpen}\r\n        onClose={() => setIsWalletManagementOpen(false)}\r\n        initialEditingWallet={editingWalletForDropdown}\r\n        onWalletUpdate={async () => {\r\n          try {\r\n            await loadWalletsFromFirebase();\r\n          } catch (error) {\r\n            console.error('Error reloading wallets after update:', error);\r\n          }\r\n        }}\r\n      />\r\n\r\n      {/* Transaction Details Modal */}\r\n      <TransactionDetailsModal\r\n        isOpen={isTransactionDetailsOpen}\r\n        onClose={() => setIsTransactionDetailsOpen(false)}\r\n        transaction={selectedTransaction}\r\n        onDelete={handleDeleteTransaction}\r\n      />\r\n\r\n      {/* Master PIN Dialog for Reset */}\r\n      <MasterPinDialog\r\n        open={isResetDialogOpen}\r\n        onOpenChange={setIsResetDialogOpen}\r\n        onSuccess={handleResetSuccess}\r\n        title={getResetDialogTitle()}\r\n        description={getResetDialogDescription()}\r\n        mode=\"verify\"\r\n      />\r\n\r\n\r\n\r\n\r\n      {/* Edit Cash Balance Dialog */}\r\n      <EditBalanceDialog\r\n        open={isEditCashDialogOpen}\r\n        onOpenChange={setIsEditCashDialogOpen}\r\n        onSuccess={handleEditCashSuccess}\r\n        title=\"    \"\r\n        description=\"         \"\r\n        currentBalance={cashBalance}\r\n        balanceLabel=\" \"\r\n        userId={user?.uid}\r\n      />\r\n\r\n      {/* Edit Wallet Balance Dialog */}\r\n      <EditBalanceDialog\r\n        open={isEditWalletDialogOpen}\r\n        onOpenChange={setIsEditWalletDialogOpen}\r\n        onSuccess={handleEditWalletBalanceSuccess}\r\n        title=\"  \"\r\n        description=\"       \"\r\n        currentBalance={editingWalletId ? (walletBalances[editingWalletId] || 0) : 0}\r\n        balanceLabel={` ${wallets.find(w => w.id === editingWalletId)?.name || ''}`}\r\n        userId={user?.uid}\r\n      />\r\n\r\n      {/* Add To Wallet Dialog */}\r\n      <AddToWalletDialog\r\n        open={isAddToWalletDialogOpen}\r\n        onOpenChange={setIsAddToWalletDialogOpen}\r\n        onSuccess={handleAddToWalletSuccess}\r\n        title=\"      \"\r\n        description=\"          \"\r\n        currentBalance={editingWalletId ? (walletBalances[editingWalletId] || 0) : 0}\r\n        balanceLabel={` ${wallets.find(w => w.id === editingWalletId)?.name || ''}`}\r\n        userId={user?.uid}\r\n      />\r\n\r\n      {/* Change Pin Dialog */}\r\n      <ChangePinDialog\r\n        open={isChangePinDialogOpen}\r\n        onOpenChange={setIsChangePinDialogOpen}\r\n        userId={user?.uid}\r\n      />\r\n\r\n      {/* Change Cash Pin Dialog */}\r\n      <ChangeCashPinDialog\r\n        open={isChangeCashPinDialogOpen}\r\n        onOpenChange={setIsChangeCashPinDialogOpen}\r\n        userId={user?.uid}\r\n      />\r\n\r\n      {/* Change Wallet Total Pin Dialog */}\r\n      <ChangeWalletTotalPinDialog\r\n        open={isChangeWalletTotalPinDialogOpen}\r\n        onOpenChange={setIsChangeWalletTotalPinDialogOpen}\r\n      />\r\n\r\n      {/* Cash Amount Dialog */}\r\n      <Dialog open={isCashAmountDialogOpen} onOpenChange={setIsCashAmountDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right\">  </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-1 py-4\">\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"amount\" className=\"text-right block\">\r\n                \r\n              </Label>\r\n              <div className=\"flex gap-2 items-center\">\r\n                <Input\r\n                  id=\"amount\"\r\n                  type=\"number\"\r\n                  placeholder=\" \"\r\n                  value={cashAmountInput}\r\n                  onChange={(e) => setCashAmountInput(e.target.value)}\r\n                  className=\"text-right flex-1\"\r\n                  dir=\"rtl\"\r\n                  min=\"0\"\r\n                />\r\n                <div className=\"flex gap-1\">\r\n                  <Button\r\n                    type=\"button\"\r\n                    size=\"sm\"\r\n                    className=\"bg-green-600 hover:bg-green-700 text-white px-3 py-2\"\r\n                    onClick={async () => {\r\n                      //    \r\n                      if (!(await verifyCashDrawerPin(cashPinInput))) {\r\n                        toast({\r\n                          title: \"\",\r\n                          description: \"   \",\r\n                          variant: \"destructive\",\r\n                        });\r\n                        return;\r\n                      }\r\n\r\n                      //    \r\n                      const amount = parseFloat(cashAmountInput);\r\n                      if (isNaN(amount) || amount <= 0) {\r\n                        toast({\r\n                          title: \"\",\r\n                          description: \"   \",\r\n                          variant: \"destructive\",\r\n                        });\r\n                        return;\r\n                      }\r\n\r\n                      //  \r\n                      const newBalance = cashBalance + amount;\r\n                      setCashBalance(newBalance);\r\n\r\n                      //    Firebase  timestamp\r\n                      const updateData = {\r\n                        cashBalance: newBalance,\r\n                        lastUpdated: new Date().toISOString()\r\n                      };\r\n\r\n                      //       \r\n                      const localDataKey = `userData_${user?.uid}`;\r\n                      localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n\r\n                      //   Firebase   \r\n                      if (user?.uid) {\r\n                        userDataService.updateUserData(user.uid, updateData)\r\n                          .then(() => {\r\n                            console.log('       Firebase ');\r\n                            //      \r\n                            localStorage.removeItem(localDataKey);\r\n                            setHasLocalDataToSync(false);\r\n                          })\r\n                          .catch(error => {\r\n                            console.error('      Firebase:', error);\r\n                            setHasLocalDataToSync(true);\r\n                            //       Firebase\r\n                          });\r\n                      } else {\r\n                        setHasLocalDataToSync(true);\r\n                      }\r\n\r\n                      toast({\r\n                        title: \" \",\r\n                        description: `  ${amount}       `,\r\n                      });\r\n\r\n                      setIsCashAmountDialogOpen(false);\r\n                      setCashAmountInput('');\r\n                      setCashPinInput('');\r\n                    }}\r\n                  >\r\n                    <Plus className=\"h-1 w-1 mr-1\" />\r\n                    \r\n                  </Button>\r\n                  <Button\r\n                    type=\"button\"\r\n                    size=\"sm\"\r\n                    className=\"bg-red-600 hover:bg-red-700 text-white px-3 py-2\"\r\n                    onClick={async () => {\r\n                      //    \r\n                      if (!(await verifyCashDrawerPin(cashPinInput))) {\r\n                        toast({\r\n                          title: \"\",\r\n                          description: \"   \",\r\n                          variant: \"destructive\",\r\n                        });\r\n                        return;\r\n                      }\r\n\r\n                      //    \r\n                      const amount = parseFloat(cashAmountInput);\r\n                      if (isNaN(amount) || amount <= 0) {\r\n                        toast({\r\n                          title: \"\",\r\n                          description: \"   \",\r\n                          variant: \"destructive\",\r\n                        });\r\n                        return;\r\n                      }\r\n\r\n                      //  \r\n                      const newBalance = cashBalance - amount;\r\n                      setCashBalance(newBalance);\r\n\r\n                      //    Firebase  timestamp\r\n                      const updateData = {\r\n                        cashBalance: newBalance,\r\n                        lastUpdated: new Date().toISOString()\r\n                      };\r\n\r\n                      //       \r\n                      const localDataKey = `userData_${user?.uid}`;\r\n                      localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n\r\n                      //   Firebase  \r\n                      if (user?.uid) {\r\n                        userDataService.updateUserData(user.uid, updateData)\r\n                          .then(() => {\r\n                            console.log('       Firebase ');\r\n                            localStorage.removeItem(localDataKey);\r\n                            setHasLocalDataToSync(false);\r\n                          })\r\n                          .catch(error => {\r\n                            console.error('      Firebase:', error);\r\n                            setHasLocalDataToSync(true);\r\n                          });\r\n                      } else {\r\n                        setHasLocalDataToSync(true);\r\n                      }\r\n\r\n                      toast({\r\n                        title: \" \",\r\n                        description: `  ${amount}       `,\r\n                      });\r\n\r\n                      setIsCashAmountDialogOpen(false);\r\n                      setCashAmountInput('');\r\n                      setCashPinInput('');\r\n                    }}\r\n                  >\r\n                    <Minus className=\"h-1 w-1 mr-1\" />\r\n                    \r\n                  </Button>\r\n                </div>\r\n              </div>\r\n              <p className=\"text-[10px] text-gray-500 text-right\">\r\n                 : {cashBalance.toLocaleString()} \r\n              </p>\r\n            </div>\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"pin\" className=\"text-right block\">\r\n                 \r\n              </Label>\r\n              <Input\r\n                id=\"pin\"\r\n                type=\"password\"\r\n                placeholder=\"  \"\r\n                value={cashPinInput}\r\n                onChange={(e) => setCashPinInput(e.target.value)}\r\n                className=\"text-right\"\r\n                dir=\"rtl\"\r\n              />\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setIsCashAmountDialogOpen(false);\r\n                setCashAmountInput('');\r\n                setCashPinInput('');\r\n              }}\r\n            >\r\n              \r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n\r\n\r\n      {/* Reset Wallet Total Dialog */}\r\n      <Dialog open={isResetWalletTotalDialogOpen} onOpenChange={setIsResetWalletTotalDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right text-red-600\">  </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-1 py-4\">\r\n            <div className=\"text-center p-4 bg-red-50 rounded-lg border border-red-200\">\r\n              <p className=\"text-red-800 font-medium mb-2\">!</p>\r\n              <p className=\"text-red-700 text-sm\">\r\n                      .      .\r\n              </p>\r\n              <p className=\"text-red-600 text-sm mt-2\">\r\n                 : {Object.values(walletBalances).reduce((sum, balance) => sum + balance, 0).toLocaleString()} \r\n              </p>\r\n            </div>\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"resetWalletTotalPin\" className=\"text-right block\">\r\n                  \r\n              </Label>\r\n              <Input\r\n                id=\"resetWalletTotalPin\"\r\n                type=\"password\"\r\n                placeholder=\"   \"\r\n                value={resetWalletTotalPinInput}\r\n                onChange={(e) => setResetWalletTotalPinInput(e.target.value)}\r\n                className=\"text-right\"\r\n                dir=\"rtl\"\r\n              />\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setIsResetWalletTotalDialogOpen(false);\r\n                setResetWalletTotalPinInput('');\r\n              }}\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              variant=\"destructive\"\r\n              onClick={async () => {\r\n                //     \r\n                const isValid = await MasterPinService.verifyMasterPin(resetWalletTotalPinInput, user?.uid);\r\n                if (!isValid) {\r\n                  toast({\r\n                    title: \"\",\r\n                    description: \"   \",\r\n                    variant: \"destructive\",\r\n                  });\r\n                  return;\r\n                }\r\n\r\n                try {\r\n                  //    \r\n                  const updatedBalances: { [key: string]: number } = {};\r\n                  Object.keys(walletBalances).forEach(walletId => {\r\n                    updatedBalances[walletId] = 0;\r\n                  });\r\n\r\n                  //     \r\n                  setWalletBalances(updatedBalances);\r\n                  localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\r\n\r\n                  //     \r\n                  setIsResetWalletTotalDialogOpen(false);\r\n                  setResetWalletTotalPinInput('');\r\n\r\n                  //    \r\n                  // toast({\r\n                  //   title: \"  \",\r\n                  //   description: \"      \",\r\n                  // });\r\n\r\n                  //   Firebase     \r\n                  const timestamp = new Date().toISOString();\r\n                  const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp } as any;\r\n                  const localDataKey = `userData_${user?.uid}`;\r\n                  localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n                  if (user?.uid) {\r\n                    userDataService.updateUserData(user.uid, updateData)\r\n                      .then(() => {\r\n                        localStorage.removeItem(localDataKey);\r\n                        setHasLocalDataToSync(false);\r\n                      })\r\n                      .catch(error => {\r\n                        console.error('      Firebase:', error);\r\n                        setHasLocalDataToSync(true);\r\n                        toast({\r\n                          title: \"\",\r\n                          description: \"       \",\r\n                          variant: \"default\",\r\n                        });\r\n                      });\r\n                  } else {\r\n                    setHasLocalDataToSync(true);\r\n                  }\r\n\r\n                  //    \r\n                  setTimeout(() => {\r\n                    setWalletBalances({ ...updatedBalances });\r\n                  }, 100);\r\n\r\n                } catch (error) {\r\n                  console.error('    :', error);\r\n                  toast({\r\n                    title: \"\",\r\n                    description: \"    \",\r\n                    variant: \"destructive\",\r\n                  });\r\n                }\r\n              }}\r\n            >\r\n               \r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Reset Selected Wallet Dialog */}\r\n      <Dialog open={isResetSelectedWalletDialogOpen} onOpenChange={setIsResetSelectedWalletDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right text-red-600\">   </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-1 py-4\">\r\n            <div className=\"text-center p-4 bg-red-50 rounded-lg border border-red-200\">\r\n              <p className=\"text-red-800 font-medium mb-2\">!</p>\r\n              <p className=\"text-red-700 text-sm\">\r\n                      .      .\r\n              </p>\r\n              <p className=\"text-red-600 text-sm mt-2\">\r\n                : {wallets.find(w => w.id === selectedWallet)?.name || selectedWallet}\r\n              </p>\r\n              <p className=\"text-red-600 text-sm\">\r\n                 : {(selectedWallet && walletBalances[selectedWallet] ? walletBalances[selectedWallet] : 0).toLocaleString()} \r\n              </p>\r\n            </div>\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"resetSelectedWalletPin\" className=\"text-right block\">\r\n                  \r\n              </Label>\r\n              <Input\r\n                id=\"resetSelectedWalletPin\"\r\n                type=\"password\"\r\n                autoComplete=\"off\"\r\n                placeholder=\"   \"\r\n                value={resetSelectedWalletPinInput}\r\n                onChange={(e) => setResetSelectedWalletPinInput(e.target.value)}\r\n                className=\"text-right\"\r\n                dir=\"rtl\"\r\n              />\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setIsResetSelectedWalletDialogOpen(false);\r\n                setResetSelectedWalletPinInput('');\r\n              }}\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              variant=\"destructive\"\r\n              onClick={async () => {\r\n                if (!selectedWallet) {\r\n                  toast({ title: ' ', description: '   ', variant: 'destructive' });\r\n                  return;\r\n                }\r\n                //     \r\n                const isValid = await MasterPinService.verifyMasterPin(resetSelectedWalletPinInput, user?.uid);\r\n                if (!isValid) {\r\n                  toast({\r\n                    title: '',\r\n                    description: '   ',\r\n                    variant: 'destructive',\r\n                  });\r\n                  return;\r\n                }\r\n\r\n                try {\r\n                  //    \r\n                  const updatedBalances: { [key: string]: number } = { ...walletBalances };\r\n                  updatedBalances[selectedWallet] = 0;\r\n\r\n                  //    \r\n                  setWalletBalances(updatedBalances);\r\n                  localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\r\n\r\n                  //     \r\n                  setIsResetSelectedWalletDialogOpen(false);\r\n                  setResetSelectedWalletPinInput('');\r\n\r\n                  //   Firebase     \r\n                  const timestamp = new Date().toISOString();\r\n                  const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp } as any;\r\n                  const localDataKey = `userData_${user?.uid}`;\r\n                  localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n                  if (user?.uid) {\r\n                    userDataService.updateUserData(user.uid, updateData)\r\n                      .then(() => {\r\n                        localStorage.removeItem(localDataKey);\r\n                        setHasLocalDataToSync(false);\r\n                      })\r\n                      .catch(error => {\r\n                        console.error('      Firebase:', error);\r\n                        setHasLocalDataToSync(true);\r\n                        toast({\r\n                          title: '',\r\n                          description: '       ',\r\n                          variant: 'default',\r\n                        });\r\n                      });\r\n                  } else {\r\n                    setHasLocalDataToSync(true);\r\n                  }\r\n\r\n                  toast({\r\n                    title: '  ',\r\n                    description: `    ${wallets.find(w => w.id === selectedWallet)?.name || selectedWallet}`,\r\n                  });\r\n                } catch (error) {\r\n                  console.error('     :', error);\r\n                  toast({\r\n                    title: '',\r\n                    description: '      ',\r\n                    variant: 'destructive',\r\n                  });\r\n                }\r\n              }}\r\n            >\r\n               \r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*      */}\r\n      <Dialog open={isAddWalletTotalDialogOpen} onOpenChange={setIsAddWalletTotalDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right text-green-600 flex items-center gap-2 justify-end\">\r\n              <Plus className=\"h-4 w-4\" />\r\n                 \r\n            </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4 py-4\">\r\n            <div className=\"text-center p-4 bg-green-50 rounded-lg border border-green-200\">\r\n              <p className=\"text-green-800 font-medium mb-2\"> </p>\r\n              <p className=\"text-green-700 text-sm\">\r\n                           .\r\n              </p>\r\n              <p className=\"text-green-600 text-sm mt-2\">\r\n                 : {Object.values(walletBalances).reduce((sum, balance) => sum + balance, 0).toLocaleString()} \r\n              </p>\r\n            </div>\r\n            <div className=\"space-y-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"addWalletTotalAmount\" className=\"text-right block\">\r\n                    \r\n                </Label>\r\n                <Input\r\n                  id=\"addWalletTotalAmount\"\r\n                  type=\"number\"\r\n                  placeholder=\" \"\r\n                  value={addWalletTotalAmountInput}\r\n                  onChange={(e) => setAddWalletTotalAmountInput(e.target.value)}\r\n                  className=\"text-right\"\r\n                  dir=\"rtl\"\r\n                />\r\n              </div>\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"addWalletTotalPin\" className=\"text-right block\">\r\n                    \r\n                </Label>\r\n                <Input\r\n                  id=\"addWalletTotalPin\"\r\n                  type=\"password\"\r\n                  autoComplete=\"off\"\r\n                  placeholder=\"  \"\r\n                  value={addWalletTotalPinInput}\r\n                  onChange={(e) => setAddWalletTotalPinInput(e.target.value)}\r\n                  className=\"text-right\"\r\n                  dir=\"rtl\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setIsAddWalletTotalDialogOpen(false);\r\n                setAddWalletTotalAmountInput('');\r\n                setAddWalletTotalPinInput('');\r\n              }}\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              variant=\"default\"\r\n              className=\"bg-green-600 hover:bg-green-700\"\r\n              disabled={isAddingWalletTotal}\r\n              onClick={async () => {\r\n                //    \r\n                const amount = parseFloat(addWalletTotalAmountInput);\r\n                if (!amount || amount <= 0) {\r\n                  toast({\r\n                    title: \"\",\r\n                    description: \"   \",\r\n                    variant: \"destructive\",\r\n                  });\r\n                  return;\r\n                }\r\n\r\n                //    \r\n                if (!(await verifyWalletTotalPin(addWalletTotalPinInput))) {\r\n                  toast({\r\n                    title: \"\",\r\n                    description: \"   \",\r\n                    variant: \"destructive\",\r\n                  });\r\n                  return;\r\n                }\r\n\r\n                setIsAddingWalletTotal(true);\r\n\r\n                try {\r\n                  //    \r\n                  const currentTotal = Object.values(walletBalances).reduce((sum, balance) => sum + balance, 0);\r\n\r\n                  //        \r\n                  if (currentTotal === 0) {\r\n                    const walletIds = Object.keys(walletBalances);\r\n                    const amountPerWallet = amount / walletIds.length;\r\n                    const updatedBalances: { [key: string]: number } = {};\r\n\r\n                    walletIds.forEach(walletId => {\r\n                      updatedBalances[walletId] = amountPerWallet;\r\n                    });\r\n\r\n                    //     localStorage\r\n                    setWalletBalances(updatedBalances);\r\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\r\n\r\n                    //   Firebase  \r\n                    if (user?.uid) {\r\n                      await userDataService.updateUserData(user.uid, { walletBalances: updatedBalances, lastUpdated: new Date().toISOString() });\r\n                    } else {\r\n                      setHasLocalDataToSync(true);\r\n                    }\r\n                  } else {\r\n                    //      \r\n                    const updatedBalances: { [key: string]: number } = {};\r\n\r\n                    Object.entries(walletBalances).forEach(([walletId, balance]) => {\r\n                      const ratio = balance / currentTotal;\r\n                      const additionalAmount = amount * ratio;\r\n                      updatedBalances[walletId] = balance + additionalAmount;\r\n                    });\r\n\r\n                    //     localStorage\r\n                    setWalletBalances(updatedBalances);\r\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\r\n\r\n                    //   Firebase  \r\n                    if (user?.uid) {\r\n                      await userDataService.updateUserData(user.uid, { walletBalances: updatedBalances, lastUpdated: new Date().toISOString() });\r\n                    } else {\r\n                      setHasLocalDataToSync(true);\r\n                    }\r\n                  }\r\n\r\n                  //    \r\n                  setTimeout(() => {\r\n                    setWalletBalances(prev => ({ ...prev }));\r\n                  }, 100);\r\n\r\n                  // toast({\r\n                  //   title: \"   \",\r\n                  //   description: `  ${amount.toLocaleString()}    `,\r\n                  // });\r\n\r\n                  //    \r\n                  setIsAddWalletTotalDialogOpen(false);\r\n                  setAddWalletTotalAmountInput('');\r\n                  setAddWalletTotalPinInput('');\r\n                } catch (error) {\r\n                  console.error('      Firebase:', error);\r\n                  toast({\r\n                    title: \"\",\r\n                    description: \"    \",\r\n                    variant: \"destructive\",\r\n                  });\r\n                } finally {\r\n                  setIsAddingWalletTotal(false);\r\n                }\r\n              }}\r\n            >\r\n              {isAddingWalletTotal ? \" ...\" : \" \"}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*     */}\r\n      <Dialog open={isResetCashDialogOpen} onOpenChange={setIsResetCashDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-[425px]\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-red-600 flex items-center gap-2\">\r\n              <Trash2 className=\"h-1 w-1\" />\r\n                \r\n            </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-1\">\r\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\r\n              <p className=\"text-sm text-red-700\">\r\n                 :        .      .\r\n              </p>\r\n            </div>\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"resetCashPin\">  </Label>\r\n              <Input\r\n                id=\"resetCashPin\"\r\n                type=\"password\"\r\n                autoComplete=\"off\"\r\n                placeholder=\"   \"\r\n                value={resetCashPinInput}\r\n                onChange={(e) => setResetCashPinInput(e.target.value)}\r\n              />\r\n            </div>\r\n          </div>\r\n          <DialogFooter>\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setIsResetCashDialogOpen(false);\r\n                setResetCashPinInput('');\r\n              }}\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              variant=\"destructive\"\r\n              onClick={async () => {\r\n                if (!resetCashPinInput) {\r\n                  toast({\r\n                    title: \"\",\r\n                    description: \"   \",\r\n                    variant: \"destructive\",\r\n                  });\r\n                  return;\r\n                }\r\n\r\n                const isValid = await MasterPinService.verifyMasterPin(resetCashPinInput, user?.uid);\r\n                if (!isValid) {\r\n                  toast({\r\n                    title: \"\",\r\n                    description: \"   \",\r\n                    variant: \"destructive\",\r\n                  });\r\n                  return;\r\n                }\r\n\r\n                try {\r\n                  //    \r\n                  setCashBalance(0);\r\n\r\n                  //     \r\n                  setIsResetCashDialogOpen(false);\r\n                  setResetCashPinInput('');\r\n\r\n                  //    \r\n                  // toast({\r\n                  //   title: \"  \",\r\n                  //   description: \"       \",\r\n                  // });\r\n\r\n                  //     \r\n                  const updateData = { cashBalance: 0, lastUpdated: new Date().toISOString() };\r\n                  localStorage.setItem(getCashBalanceKey(), '0');\r\n                  const localDataKey = `userData_${user?.uid}`;\r\n                  localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n\r\n                  //   Firebase    fallback\r\n                  if (user?.uid) {\r\n                    userDataService.updateUserData(user.uid, updateData)\r\n                      .then(() => {\r\n                        localStorage.removeItem(localDataKey);\r\n                        setHasLocalDataToSync(false);\r\n                      })\r\n                      .catch(error => {\r\n                        console.error('     Firebase:', error);\r\n                        setHasLocalDataToSync(true);\r\n                        toast({\r\n                          title: \"\",\r\n                          description: \"       \",\r\n                          variant: \"default\",\r\n                        });\r\n                      });\r\n                  } else {\r\n                    setHasLocalDataToSync(true);\r\n                  }\r\n\r\n                } catch (error) {\r\n                  console.error('    :', error);\r\n                  toast({\r\n                    title: \"\",\r\n                    description: \"     \",\r\n                    variant: \"destructive\",\r\n                  });\r\n                }\r\n              }}\r\n            >\r\n               \r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Cash Summary Dialog */}\r\n      <CashSummaryDialog\r\n        open={isCashSummaryOpen}\r\n        onOpenChange={setIsCashSummaryOpen}\r\n        userId={user?.uid}\r\n        cashBalance={cashBalance}\r\n        walletBalances={walletBalances}\r\n        transactions={transactions}\r\n      />\r\n\r\n      {/*     */}\r\n      <Dialog open={isAddCashDialogOpen} onOpenChange={setIsAddCashDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-[425px]\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-green-600 flex items-center gap-2\">\r\n              <Plus className=\"h-4 w-4\" />\r\n                \r\n            </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"bg-green-50 border border-green-200 rounded-lg p-3\">\r\n              <p className=\"text-sm text-green-700\">\r\n                         \r\n              </p>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"addCashAmount\">  </Label>\r\n              <Input\r\n                id=\"addCashAmount\"\r\n                type=\"number\"\r\n                placeholder=\" \"\r\n                value={addCashAmountInput}\r\n                onChange={(e) => setAddCashAmountInput(e.target.value)}\r\n                min=\"0\"\r\n                step=\"0.01\"\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label className=\"text-right\">   </Label>\r\n              <div className=\"flex gap-2\">\r\n                <Button type=\"button\" variant={addCashNoteEnabled === 'yes' ? 'default' : 'outline'} onClick={() => setAddCashNoteEnabled('yes')} className=\"flex-1\"></Button>\r\n                <Button\r\n                  type=\"button\"\r\n                  variant={addCashNoteEnabled === 'no' ? 'default' : 'outline'}\r\n                  onClick={async () => {\r\n                    setAddCashNoteEnabled('no');\r\n                    if (!addCashAmountInput || parseFloat(addCashAmountInput) <= 0) {\r\n                      toast({ title: '', description: '      ', variant: 'destructive' });\r\n                      return;\r\n                    }\r\n                    if (!addCashPinInput) {\r\n                      toast({ title: '', description: '   ', variant: 'destructive' });\r\n                      return;\r\n                    }\r\n                    if (!(await verifyCashDrawerPin(addCashPinInput))) {\r\n                      toast({ title: '', description: '   ', variant: 'destructive' });\r\n                      return;\r\n                    }\r\n                    setIsAddingCash(true);\r\n                    try {\r\n                      const amountToAdd = parseFloat(addCashAmountInput);\r\n                      const newCashBalance = cashBalance + amountToAdd;\r\n                      setCashBalance(newCashBalance);\r\n                      localStorage.setItem(getCashBalanceKey(), newCashBalance.toString());\r\n                      const updateData = { cashBalance: newCashBalance, lastUpdated: new Date().toISOString() };\r\n                      const localDataKey = `userData_${user?.uid}`;\r\n                      localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n                      const receiptRef = `CASHADD-${user?.uid || 'anon'}-${Date.now()}`;\r\n                      setIsAddCashDialogOpen(false);\r\n                      setAddCashAmountInput('');\r\n                      setAddCashPinInput('');\r\n                      setAddCashNoteEnabled(null);\r\n                      setAddCashNoteText('');\r\n                      const ops: Array<Promise<any>> = [];\r\n                      if (user?.uid) {\r\n                        ops.push(userDataService.updateUserData(user.uid, updateData).then(() => { localStorage.removeItem(localDataKey); setHasLocalDataToSync(false); }).catch(() => { setHasLocalDataToSync(true); }));\r\n                        const txToCloud: any = { txnType: 'cash_addition', type: 'cash_addition', amount: amountToAdd, status: 'confirmed', senderMsisdn: ' ', receiverMsisdn: '', reference: receiptRef, title: '  ', merchantUserId: user.uid, createdBy: user.uid, shopId: (profile as any)?.shopId || undefined };\r\n                        ops.push(userDataService.saveUserTransaction(user.uid, txToCloud));\r\n                        const shopId = (profile as any)?.shopId;\r\n                        if (shopId) {\r\n                          const dataRef = doc(db, 'dashboardData', shopId);\r\n                          ops.push(updateDoc(dataRef, { cashBalance: newCashBalance }));\r\n                        }\r\n                      }\r\n                      Promise.allSettled(ops).then(() => { }).catch(() => { });\r\n                    } catch (error) {\r\n                      setCashBalance(cashBalance);\r\n                      localStorage.setItem('cashBalance', cashBalance.toString());\r\n                      toast({ title: '', description: '        ', variant: 'destructive' });\r\n                    } finally {\r\n                      setIsAddingCash(false);\r\n                    }\r\n                  }}\r\n                  className=\"flex-1\"\r\n                >\r\n                  \r\n                </Button>\r\n              </div>\r\n            </div>\r\n            {addCashNoteEnabled === 'yes' && (\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"addCashNote\"></Label>\r\n                <Input id=\"addCashNote\" type=\"text\" placeholder=\" \" value={addCashNoteText} onChange={(e) => setAddCashNoteText(e.target.value)} />\r\n              </div>\r\n            )}\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"addCashPin\">   </Label>\r\n              <Input\r\n                id=\"addCashPin\"\r\n                type=\"password\"\r\n                placeholder=\"  \"\r\n                value={addCashPinInput}\r\n                onChange={(e) => setAddCashPinInput(e.target.value)}\r\n              />\r\n            </div>\r\n          </div>\r\n          <DialogFooter>\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setIsAddCashDialogOpen(false);\r\n                setAddCashAmountInput('');\r\n                setAddCashPinInput('');\r\n                setAddCashNoteEnabled(null);\r\n                setAddCashNoteText('');\r\n              }}\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              variant=\"default\"\r\n              className=\"bg-green-600 hover:bg-green-700\"\r\n              disabled={isAddingCash}\r\n              onClick={async () => {\r\n                //    \r\n                if (!addCashAmountInput || parseFloat(addCashAmountInput) <= 0) {\r\n                  toast({\r\n                    title: \"\",\r\n                    description: \"      \",\r\n                    variant: \"destructive\",\r\n                  });\r\n                  return;\r\n                }\r\n\r\n                if (!addCashPinInput) {\r\n                  toast({\r\n                    title: \"\",\r\n                    description: \"   \",\r\n                    variant: \"destructive\",\r\n                  });\r\n                  return;\r\n                }\r\n\r\n                if (!(await verifyCashDrawerPin(addCashPinInput))) {\r\n                  toast({\r\n                    title: \"\",\r\n                    description: \"   \",\r\n                    variant: \"destructive\",\r\n                  });\r\n                  return;\r\n                }\r\n\r\n                if (addCashNoteEnabled === 'yes' && addCashNoteText.trim().length === 0) {\r\n                  toast({ title: '', description: '    ', variant: 'destructive' });\r\n                  return;\r\n                }\r\n\r\n                setIsAddingCash(true);\r\n                try {\r\n                  const amountToAdd = parseFloat(addCashAmountInput);\r\n                  const newCashBalance = cashBalance + amountToAdd;\r\n                  setCashBalance(newCashBalance);\r\n                  localStorage.setItem(getCashBalanceKey(), newCashBalance.toString());\r\n                  const updateData = { cashBalance: newCashBalance, lastUpdated: new Date().toISOString() };\r\n                  const localDataKey = `userData_${user?.uid}`;\r\n                  localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n                  const receiptRef = `CASHADD-${user?.uid || 'anon'}-${Date.now()}`;\r\n                  setIsAddCashDialogOpen(false);\r\n                  setAddCashAmountInput('');\r\n                  setAddCashPinInput('');\r\n                  setAddCashNoteEnabled(null);\r\n                  setAddCashNoteText('');\r\n                  const ops: Array<Promise<any>> = [];\r\n                  if (user?.uid) {\r\n                    ops.push(userDataService.updateUserData(user.uid, updateData).then(() => { localStorage.removeItem(localDataKey); setHasLocalDataToSync(false); }).catch(() => { setHasLocalDataToSync(true); }));\r\n                    const txToCloud: any = { txnType: 'cash_addition', type: 'cash_addition', amount: amountToAdd, status: 'confirmed', senderMsisdn: ' ', receiverMsisdn: '', reference: receiptRef, note: addCashNoteEnabled === 'yes' ? addCashNoteText.trim() : undefined, title: '  ', merchantUserId: user.uid, createdBy: user.uid, shopId: (profile as any)?.shopId || undefined };\r\n                    ops.push(userDataService.saveUserTransaction(user.uid, txToCloud));\r\n                    const shopId = (profile as any)?.shopId;\r\n                    if (shopId) {\r\n                      const dataRef = doc(db, 'dashboardData', shopId);\r\n                      ops.push(updateDoc(dataRef, { cashBalance: newCashBalance }));\r\n                    }\r\n                  }\r\n                  Promise.allSettled(ops).then(() => { }).catch(() => { });\r\n                } catch (error) {\r\n                  setCashBalance(cashBalance);\r\n                  localStorage.setItem('cashBalance', cashBalance.toString());\r\n                  toast({ title: '', description: '        ', variant: 'destructive' });\r\n                } finally {\r\n                  setIsAddingCash(false);\r\n                }\r\n              }}\r\n            >\r\n              {isAddingCash ? \" ...\" : \" \"}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*     */}\r\n      <Dialog open={isDatePickerOpen} onOpenChange={setIsDatePickerOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right\">   </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-1 py-4\">\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"search-date\" className=\"text-right block\"></Label>\r\n              <Input\r\n                id=\"search-date\"\r\n                type=\"date\"\r\n                value={selectedDate}\r\n                onChange={(e) => setSelectedDate(e.target.value)}\r\n                className=\"text-right\"\r\n              />\r\n            </div>\r\n            <div className=\"space-y-1\">\r\n              <Label htmlFor=\"search-time\" className=\"text-right block\"> ()</Label>\r\n              <Input\r\n                id=\"search-time\"\r\n                type=\"time\"\r\n                value={selectedTime}\r\n                onChange={(e) => setSelectedTime(e.target.value)}\r\n                className=\"text-right\"\r\n                placeholder=\"     \"\r\n              />\r\n              <p className=\"text-[10px] text-gray-500 text-right\">\r\n                         \r\n              </p>\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex justify-between\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setSelectedDate('');\r\n                setSelectedTime('');\r\n                setIsDatePickerOpen(false);\r\n              }}\r\n            >\r\n              \r\n            </Button>\r\n            <Button onClick={() => setIsDatePickerOpen(false)}>\r\n              \r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n\r\n\r\n      {/*       */}\r\n\r\n      {/*   */}\r\n      <CalculatorDialog\r\n        isOpen={isCalculatorOpen}\r\n        onClose={() => setIsCalculatorOpen(false)}\r\n      />\r\n\r\n      {/*    */}\r\n      <SalesDataDialog\r\n        isOpen={isSalesDataOpen}\r\n        onClose={() => setIsSalesDataOpen(false)}\r\n        initialBarcode={pendingBarcode}\r\n      />\r\n\r\n      {/*    */}\r\n      <CreditCardsDialog\r\n        isOpen={isCreditCardsOpen}\r\n        onClose={() => setIsCreditCardsOpen(false)}\r\n      />\r\n\r\n      {/*   */}\r\n      <MaintenanceDialog\r\n        open={isMaintenanceOpen}\r\n        onOpenChange={setIsMaintenanceOpen}\r\n      />\r\n\r\n      {/*    */}\r\n      <MachineDailyDialog\r\n        open={isMachineDailyDialogOpen}\r\n        onOpenChange={(open) => {\r\n          if (open && !isShiftHandoverAllowed) {\r\n            toast({\r\n              title: ' ',\r\n              description: '   :      .',\r\n              variant: 'destructive'\r\n            });\r\n            return;\r\n          }\r\n          setIsMachineDailyDialogOpen(open);\r\n        }}\r\n      />\r\n\r\n      {/*    */}\r\n      <CashierShiftModal\r\n        open={isCashierModalOpen}\r\n        onOpenChange={(open) => {\r\n          if (open && !isShiftHandoverAllowed) {\r\n            toast({\r\n              title: ' ',\r\n              description: '   :      .   .',\r\n              variant: 'destructive'\r\n            });\r\n            return;\r\n          }\r\n          setIsCashierModalOpen(open);\r\n        }}\r\n      />\r\n\r\n      {/*    */}\r\n      <ShiftProfileDialog\r\n        open={isShiftProfileOpen}\r\n        onOpenChange={(open) => {\r\n          if (open && !isShiftHandoverAllowed) {\r\n            toast({\r\n              title: ' ',\r\n              description: '   :      .   .',\r\n              variant: 'destructive'\r\n            });\r\n            return;\r\n          }\r\n          setIsShiftProfileOpen(open);\r\n        }}\r\n      />\r\n\r\n      {/*  -      */}\r\n      <MasterPinDialog\r\n        open={isReportsPinOpen}\r\n        onOpenChange={setIsReportsPinOpen}\r\n        onSuccess={() => setIsYourReportsOpen(true)}\r\n        title=\"\"\r\n        description=\"      \"\r\n        mode=\"verify\"\r\n      />\r\n\r\n      <Dialog open={isYourReportsOpen} onOpenChange={setIsYourReportsOpen}>\r\n        <DialogContent className=\"sm:max-w-xl\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <BarChart className=\"h-4 w-4 text-blue-600\" />\r\n               \r\n            </DialogTitle>\r\n            <DialogDescription>\r\n                   30     \r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            {(() => {\r\n              const todayStr = new Date().toDateString();\r\n              const todayTx = transactions.filter((t: any) => {\r\n                const dt = new Date(t.createdAt).toDateString();\r\n                const st = String(t.status || 'completed').toLowerCase();\r\n                return dt === todayStr && (st === 'completed' || st === 'confirmed');\r\n              });\r\n              const totalTransactions = todayTx.length;\r\n              const totalAmount = todayTx.reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\r\n              const totalWithdrawn = todayTx.filter((t: any) => t.type === 'withdraw').reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\r\n              const totalSent = todayTx.filter((t: any) => t.type === 'send').reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\r\n              const profit = todayTx.reduce((s: number, t: any) => s + Number(reportsService.calculateTransactionProfit(t) || 0), 0);\r\n              return (\r\n                <div className=\"grid grid-cols-2 gap-3\">\r\n                  <div className=\"rounded-lg p-3 bg-gradient-to-r from-blue-50 to-slate-100 border\">\r\n                    <div className=\"text-xs text-blue-700\"> </div>\r\n                    <div className=\"text-lg font-bold text-blue-800\">{totalTransactions}</div>\r\n                  </div>\r\n                  <div className=\"rounded-lg p-3 bg-gradient-to-r from-indigo-50 to-slate-100 border\">\r\n                    <div className=\"text-xs text-indigo-700\"> </div>\r\n                    <div className=\"text-lg font-bold text-indigo-800\">{Number(totalAmount).toFixed(2)}</div>\r\n                  </div>\r\n                  <div className=\"rounded-lg p-3 bg-gradient-to-r from-red-50 to-slate-100 border\">\r\n                    <div className=\"text-xs text-red-700\"> </div>\r\n                    <div className=\"text-lg font-bold text-red-800\">{Number(totalWithdrawn).toFixed(2)}</div>\r\n                  </div>\r\n                  <div className=\"rounded-lg p-3 bg-gradient-to-r from-green-50 to-slate-100 border\">\r\n                    <div className=\"text-xs text-green-700\"> </div>\r\n                    <div className=\"text-lg font-bold text-green-800\">{Number(totalSent).toFixed(2)}</div>\r\n                  </div>\r\n                  <div className=\"col-span-2 rounded-lg p-3 bg-gradient-to-r from-amber-50 to-slate-100 border\">\r\n                    <div className=\"text-xs text-amber-700\"></div>\r\n                    <div className=\"text-lg font-bold text-amber-800\">{Number(profit).toFixed(2)}</div>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })()}\r\n            <div className=\"flex items-center justify-between\">\r\n              <Button\r\n                variant=\"default\"\r\n                onClick={async () => {\r\n                  try {\r\n                    if (!user?.uid) return;\r\n                    const today = new Date();\r\n                    const yyyy = today.getFullYear();\r\n                    const mm = String(today.getMonth() + 1).padStart(2, '0');\r\n                    const dd = String(today.getDate()).padStart(2, '0');\r\n                    const reportDate = `${yyyy}-${mm}-${dd}`;\r\n                    const todayStr = today.toDateString();\r\n                    const todayTx = transactions.filter((t: any) => {\r\n                      const dt = new Date(t.createdAt).toDateString();\r\n                      const st = String(t.status || 'completed').toLowerCase();\r\n                      return dt === todayStr && (st === 'completed' || st === 'confirmed');\r\n                    });\r\n                    const totalTransactions = todayTx.length;\r\n                    const totalAmount = todayTx.reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\r\n                    const totalWithdrawn = todayTx.filter((t: any) => t.type === 'withdraw').reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\r\n                    const totalSent = todayTx.filter((t: any) => t.type === 'send').reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\r\n                    const profit = todayTx.reduce((s: number, t: any) => s + Number(reportsService.calculateTransactionProfit(t) || 0), 0);\r\n                    await dailyReportsArchiveService.add({\r\n                      userId: user.uid,\r\n                      reportDate,\r\n                      totalTransactions,\r\n                      totalAmount: Number(totalAmount.toFixed(2)),\r\n                      totalWithdrawn: Number(totalWithdrawn.toFixed(2)),\r\n                      totalSent: Number(totalSent.toFixed(2)),\r\n                      profit: Number(profit.toFixed(2)),\r\n                      walletId: null\r\n                    });\r\n                    try { await dailyReportsArchiveService.trimToMaxCount(user.uid, 30); } catch { }\r\n                    toast({ title: ' ', description: `   ${reportDate}` });\r\n                  } catch (e) {\r\n                    toast({ title: ' ', description: '  ', variant: 'destructive' });\r\n                  }\r\n                }}\r\n              >\r\n                 \r\n              </Button>\r\n              <Button variant=\"outline\" onClick={() => setIsYourReportsOpen(false)}></Button>\r\n            </div>\r\n            <div className=\"mt-2 border-t pt-2\">\r\n              <div className=\"space-y-2 max-h-[40vh] overflow-auto\">\r\n                {reportArchives.length === 0 ? (\r\n                  <div className=\"text-xs text-muted-foreground\">   </div>\r\n                ) : (\r\n                  reportArchives.map((a) => (\r\n                    <div key={a.id || `${a.userId}-${a.reportDate}`} className=\"border rounded-md p-2 bg-gradient-to-r from-white/80 to-blue-50/70\">\r\n                      <div className=\"flex justify-between items-center\">\r\n                        <div className=\"font-bold text-blue-800\">{a.reportDate}</div>\r\n                        <div className=\"text-xs text-blue-700\"> : {a.totalTransactions}</div>\r\n                      </div>\r\n                      <div className=\"grid grid-cols-2 gap-2 mt-1\">\r\n                        <div className=\"text-xs text-blue-800\"> : <span className=\"font-semibold\">{Number(a.totalAmount).toFixed(2)}</span></div>\r\n                        <div className=\"text-xs text-blue-800\">: <span className=\"font-semibold\">{Number(a.totalWithdrawn).toFixed(2)}</span></div>\r\n                        <div className=\"text-xs text-blue-800\">: <span className=\"font-semibold\">{Number(a.totalSent).toFixed(2)}</span></div>\r\n                        <div className=\"text-xs text-blue-800\">: <span className=\"font-semibold\">{Number(a.profit ?? 0).toFixed(2)}</span></div>\r\n                      </div>\r\n                    </div>\r\n                  ))\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*    -   */}\r\n      <Dialog open={isTopUpOpen} onOpenChange={(open) => {\r\n        if (open) {\r\n          toast({ title: ' ', description: '    .' });\r\n          return;\r\n        }\r\n        setIsTopUpOpen(false);\r\n      }}>\r\n        <DialogContent dir=\"rtl\" className=\"sm:max-w-md w-[95vw] sm:w-auto rounded-2xl border border-emerald-200 shadow-xl bg-gradient-to-br from-white via-green-50 to-emerald-50 backdrop-blur-md data-[state=open]:animate-in data-[state=open]:fade-in-0 data-[state=open]:zoom-in-90 data-[state=open]:slide-in-from-bottom-8 duration-300\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right text-green-700\">  </DialogTitle>\r\n            <DialogDescription className=\"text-right text-gray-600\">    </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-3\">\r\n            <div>\r\n              <Label htmlFor=\"topupPhone\" className=\"text-right block\"> </Label>\r\n              <Input id=\"topupPhone\" value={topupPhone} onChange={(e) => setTopupPhone(e.target.value)} placeholder=\"010xxxxxxx\" className=\"text-right\" />\r\n            </div>\r\n\r\n            <div>\r\n              <Label className=\"text-right block\"> </Label>\r\n              <Select value={topupOperator} onValueChange={setTopupOperator}>\r\n                <SelectTrigger className=\"text-right\">\r\n                  <SelectValue placeholder=\" \" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"vodafone\"></SelectItem>\r\n                  <SelectItem value=\"orange\"></SelectItem>\r\n                  <SelectItem value=\"etisalat\"></SelectItem>\r\n                  <SelectItem value=\"we\">WE</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n\r\n            <div>\r\n              <Label htmlFor=\"topupAmount\" className=\"text-right block\"> </Label>\r\n              <Input id=\"topupAmount\" type=\"number\" value={topupAmount as number | ''} onChange={(e) => setTopupAmount(e.target.value ? Number(e.target.value) : '')} placeholder=\"50\" className=\"text-right\" />\r\n            </div>\r\n          </div>\r\n\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button variant=\"outline\" onClick={() => setIsTopUpOpen(false)} className=\"border-gray-300\"></Button>\r\n            <Button onClick={submitTopUp} disabled={topupLoading || !topupPhone || !topupOperator || !topupAmount} className=\"bg-emerald-600 hover:bg-emerald-700 text-white\">\r\n              {topupLoading ? ' ...' : ' '}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*       */}\r\n      <MasterPinDialog\r\n        open={isDebtsPasswordDialogOpen}\r\n        onOpenChange={setIsDebtsPasswordDialogOpen}\r\n        mode=\"verify\"\r\n        title=\"    \"\r\n        description=\"      \"\r\n        onSuccess={() => {\r\n          setIsDebtsPasswordDialogOpen(false);\r\n          setIsDebtsDialogOpen(true);\r\n        }}\r\n      />\r\n\r\n      <MasterPinDialog\r\n        open={isDebtsPinToggleOpen}\r\n        onOpenChange={setIsDebtsPinToggleOpen}\r\n        mode=\"verify\"\r\n        title=\"     \"\r\n        description=\"            \"\r\n        onSuccess={async () => {\r\n          if (pendingDebtsPinValue !== null) {\r\n            const nextVal = pendingDebtsPinValue;\r\n            setIsDebtsPinRequired(nextVal);\r\n            try {\r\n              const uid = user?.uid;\r\n              const key = uid ? `debtsPinRequired_${uid}` : 'debtsPinRequired';\r\n              localStorage.setItem(key, String(nextVal));\r\n              if (uid) await userDataService.updateUserData(uid, { debtsPinRequired: nextVal });\r\n            } catch { }\r\n            toast({\r\n              title: nextVal ? '     ' : '     ',\r\n              description: nextVal ? '       .' : '       .',\r\n            });\r\n          }\r\n          setPendingDebtsPinValue(null);\r\n          setIsDebtsPinToggleOpen(false);\r\n        }}\r\n      />\r\n\r\n      {/*       */}\r\n      <PasswordConfirmDialog\r\n        open={isResetRecentDialogOpen}\r\n        onOpenChange={setIsResetRecentDialogOpen}\r\n        title=\"     \"\r\n        description=\"        Firebase.\"\r\n        onSuccess={async () => {\r\n          try {\r\n            if (!user?.uid) {\r\n              setIsResetRecentDialogOpen(false);\r\n              return;\r\n            }\r\n            const resetAt = new Date();\r\n            const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : new Date(String(v));\r\n\r\n            //        (   )\r\n            const toDelete = transactions.filter(t => toJsDate((t as any).createdAt) < resetAt);\r\n\r\n            //          .\r\n            //           .\r\n\r\n            //      Firestore    \r\n            await userDataService.updateUserData(user.uid, {\r\n              recentReset: {\r\n                keepLastCount: recentResetConfig.keepLastCount ?? 30,\r\n                intervalDays: recentResetConfig.intervalDays ?? 7,\r\n                lastResetAt: resetAt\r\n              }\r\n            });\r\n            setRecentResetConfig(cfg => ({ ...cfg, lastResetAt: resetAt }));\r\n\r\n            toast({ title: '   ', description: '              /  .' });\r\n          } catch (e) {\r\n            console.error('   :', e);\r\n            toast({ title: ' ', description: '     .', variant: 'destructive' });\r\n          } finally {\r\n            setIsResetRecentDialogOpen(false);\r\n          }\r\n        }}\r\n      />\r\n\r\n      {/*       */}\r\n      <MasterPinDialog\r\n        open={isShopExpensesPinDialogOpen}\r\n        onOpenChange={setIsShopExpensesPinDialogOpen}\r\n        mode=\"verify\"\r\n        title=\"    \"\r\n        description=\"       \"\r\n        onSuccess={() => {\r\n          setIsShopExpensesPinDialogOpen(false);\r\n          setIsShopExpensesDialogOpen(true);\r\n        }}\r\n      />\r\n\r\n      {/*    */}\r\n      <Dialog open={isDebtsDialogOpen} onOpenChange={setIsDebtsDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-[425px]\">\r\n          <DialogHeader className=\"flex items-center justify-between\">\r\n            <DialogTitle className=\"text-right\"> </DialogTitle>\r\n            <div className=\"flex items-center gap-1 text-orange-700\">\r\n              <Banknote className=\"h-4 w-4\" />\r\n              <span className=\"text-xs font-bold\">{totalOutstandingDebts} </span>\r\n            </div>\r\n          </DialogHeader>\r\n          <div className=\"grid gap-4 py-4\">\r\n            <div className=\"flex items-center justify-center gap-2\">\r\n              <Button variant={debtRole === 'debtor' ? 'default' : 'outline'} onClick={() => setDebtRole('debtor')}></Button>\r\n              <Button variant={debtRole === 'creditor' ? 'default' : 'outline'} onClick={() => setDebtRole('creditor')}></Button>\r\n            </div>\r\n            {debtRole === 'creditor' && (\r\n              <div className=\"grid grid-cols-4 items-center gap-4\">\r\n                <Label htmlFor=\"debtorName\" className=\"text-right col-span-1\"> </Label>\r\n                <Input id=\"debtorName\" value={debtorName} onChange={(e) => setDebtorName(e.target.value)} className=\"col-span-3 text-right\" placeholder=\"  \" />\r\n              </div>\r\n            )}\r\n            {debtRole && (\r\n              <>\r\n                <div className=\"grid grid-cols-4 items-center gap-4\">\r\n                  <Label htmlFor=\"debtAmount\" className=\"text-right col-span-1\"></Label>\r\n                  <Input id=\"debtAmount\" type=\"number\" value={debtAmount} onChange={(e) => setDebtAmount(e.target.value)} className=\"col-span-3 text-right\" placeholder=\" \" />\r\n                </div>\r\n                <div className=\"grid grid-cols-4 items-center gap-4\">\r\n                  <Label htmlFor=\"debtReason\" className=\"text-right col-span-1\"> </Label>\r\n                  <Input id=\"debtReason\" value={debtReason} onChange={(e) => setDebtReason(e.target.value)} className=\"col-span-3 text-right\" placeholder=\"  \" />\r\n                </div>\r\n              </>\r\n            )}\r\n          </div>\r\n          <DialogFooter>\r\n            <Button\r\n              onClick={() => {\r\n                const isDebtor = debtRole === 'debtor';\r\n                const isCreditor = debtRole === 'creditor';\r\n                if (!isDebtor && !isCreditor) {\r\n                  toast({ title: '  ', description: '     ', variant: 'destructive' });\r\n                  return;\r\n                }\r\n                if (!debtAmount || !debtReason || (isCreditor && !debtorName)) {\r\n                  toast({ title: '  ', description: isCreditor ? '    ' : '   ', variant: 'destructive' });\r\n                  return;\r\n                }\r\n                const newDebt: Debt = {\r\n                  id: Date.now().toString(),\r\n                  debtorName: isDebtor ? '' : debtorName,\r\n                  amount: parseFloat(debtAmount),\r\n                  reason: debtReason,\r\n                  status: 'pending',\r\n                  createdAt: new Date(),\r\n                  paidAmount: 0,\r\n                  partialPayments: []\r\n                };\r\n                setPendingDebtToCreate(newDebt);\r\n                setIsDebtDeductionChoiceOpen(true);\r\n              }}\r\n              className=\"bg-orange-500 hover:bg-orange-600\"\r\n            >\r\n              \r\n            </Button>\r\n          </DialogFooter>\r\n\r\n          {/*         */}\r\n          <div className=\"mt-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"w-full\"\r\n              onClick={() => setIsDebtReceiptsListOpen(true)}\r\n            >\r\n               \r\n            </Button>\r\n          </div>\r\n          {/*        */}\r\n          <div className=\"mt-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"w-full\"\r\n              onClick={() => setIsAddCustomerDialogOpen(true)}\r\n            >\r\n               \r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*     */}\r\n      <Dialog open={isDebtReceiptsListOpen} onOpenChange={setIsDebtReceiptsListOpen}>\r\n        <DialogContent className=\"sm:max-w-[520px]\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right\"> </DialogTitle>\r\n            <DialogDescription className=\"text-right\">\r\n                  \r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          {debts.length > 0 ? (\r\n            <div\r\n              className=\"max-h-[70vh] overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 space-y-2\"\r\n              style={{ contain: 'layout paint' }}\r\n              onScroll={(e) => {\r\n                const target = e.currentTarget;\r\n                if (visibleDebts.length < debts.length) {\r\n                  if (target.scrollTop + target.clientHeight >= target.scrollHeight - 50) {\r\n                    setDebtsPage((p) => p + 1);\r\n                  }\r\n                }\r\n              }}\r\n            >\r\n              {visibleDebts.map((debt) => (\r\n                <div\r\n                  key={debt.id}\r\n                  onClick={() => {\r\n                    setSelectedDebt(debt);\r\n                    setIsDebtReceiptOpen(true);\r\n                    //         \r\n                    setIsDebtReceiptsListOpen(false);\r\n                    //        \r\n                    setIsDebtsDialogOpen(false);\r\n                  }}\r\n                  className=\"p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors\"\r\n                >\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <div className=\"text-right\">\r\n                      <p className=\"font-medium\">{debt.debtorName}</p>\r\n                      <p className=\"text-sm text-gray-600\">{debt.reason}</p>\r\n                      <p className=\"text-sm text-gray-500\">\r\n                        {dateFormatter.format(debt.createdAt instanceof Date ? debt.createdAt : new Date(debt.createdAt))}\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"text-left\">\r\n                      <p className=\"font-bold text-lg\">{debt.amount} </p>\r\n                      <Badge\r\n                        variant={debt.status === 'paid' ? 'default' : 'secondary'}\r\n                        className={debt.status === 'paid' ? 'bg-green-500' : 'bg-yellow-500'}\r\n                      >\r\n                        {debt.status === 'paid' ? '' : ' '}\r\n                      </Badge>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n              {visibleDebts.length < debts.length && (\r\n                <div className=\"flex justify-center pt-1\">\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => setDebtsPage(p => p + 1)}\r\n                  >\r\n                     \r\n                  </Button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-center text-sm text-gray-500\">   </div>\r\n          )}\r\n\r\n          {/*       */}\r\n          <DialogFooter className=\"flex justify-between mt-3\">\r\n            <Button\r\n              variant=\"destructive\"\r\n              onClick={async () => {\r\n                try {\r\n                  if (!debts || debts.length === 0) {\r\n                    toast({ title: '  ', description: '  .' });\r\n                    return;\r\n                  }\r\n                  const confirmed = window.confirm('           .');\r\n                  if (!confirmed) return;\r\n                  const cleared: Debt[] = [];\r\n                  setDebts(cleared);\r\n                  setSelectedDebt(null);\r\n                  //      Firebase  \r\n                  await saveDebtsToStorage(cleared);\r\n                  if (user?.uid) {\r\n                    try {\r\n                      await userDataService.updateUserData(user.uid, { debts: [], debtsDeletedAt: serverTimestamp() });\r\n                      try { localStorage.removeItem(`debts_unsynced_${user.uid}`); } catch { }\r\n                    } catch (e) {\r\n                      console.error('    Firebase:', e);\r\n                      toast({ title: '   ', description: '    Firebase   .', variant: 'destructive' });\r\n                      return;\r\n                    }\r\n                  }\r\n                  toast({ title: '    ', description: '   .' });\r\n                  setIsDebtReceiptsListOpen(false);\r\n                } catch (e) {\r\n                  console.error('    :', e);\r\n                  toast({ title: ' ', description: '      .', variant: 'destructive' });\r\n                }\r\n              }}\r\n            >\r\n                \r\n            </Button>\r\n            <Button variant=\"outline\" onClick={() => setIsDebtReceiptsListOpen(false)}>\r\n              \r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*         */}\r\n      <Dialog open={isAddCustomerDialogOpen} onOpenChange={setIsAddCustomerDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-[480px]\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right\"> </DialogTitle>\r\n            <DialogDescription className=\"text-right\">        </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"grid gap-4 py-4\">\r\n            <div className=\"grid grid-cols-4 items-center gap-4\">\r\n              <Label htmlFor=\"customerName\" className=\"text-right col-span-1\"> </Label>\r\n              <Input\r\n                id=\"customerName\"\r\n                value={newCustomerName}\r\n                onChange={(e) => setNewCustomerName(e.target.value)}\r\n                className=\"col-span-3 text-right\"\r\n                placeholder=\"  \"\r\n              />\r\n            </div>\r\n            <div className=\"grid grid-cols-4 items-center gap-4\">\r\n              <Label htmlFor=\"customerMobile\" className=\"text-right col-span-1\"> </Label>\r\n              <Input\r\n                id=\"customerMobile\"\r\n                value={newCustomerMobile}\r\n                onChange={(e) => setNewCustomerMobile(e.target.value)}\r\n                className=\"col-span-3 text-right\"\r\n                placeholder=\"  \"\r\n              />\r\n            </div>\r\n            <div className=\"flex justify-end\">\r\n              <Button\r\n                className=\"bg-green-600 hover:bg-green-700\"\r\n                onClick={async () => {\r\n                  if (!newCustomerName || !newCustomerMobile) {\r\n                    toast({ title: '  ', description: '     ', variant: 'destructive' });\r\n                    return;\r\n                  }\r\n                  const newCustomer: Customer = {\r\n                    id: Date.now().toString(),\r\n                    name: newCustomerName.trim(),\r\n                    mobile: newCustomerMobile.trim(),\r\n                    createdAt: new Date(),\r\n                  };\r\n                  const updated = [newCustomer, ...customers];\r\n                  await saveCustomersToStorage(updated);\r\n                  setNewCustomerName('');\r\n                  setNewCustomerMobile('');\r\n                  toast({ title: '  ', description: `  ${newCustomer.name}` });\r\n                }}\r\n              >\r\n                \r\n              </Button>\r\n            </div>\r\n            <div className=\"border-t pt-4 space-y-3\">\r\n              <Label className=\"text-right block\">   </Label>\r\n              {customers.length > 0 ? (\r\n                <div className=\"space-y-3\">\r\n                  <Select value={selectedCustomerId} onValueChange={setSelectedCustomerId}>\r\n                    <SelectTrigger className=\"w-full\">\r\n                      <SelectValue placeholder=\" \" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {customers.map(c => (\r\n                        <SelectItem key={c.id} value={c.id}>{c.name}  {c.mobile}</SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                  <div className=\"grid grid-cols-4 items-center gap-4\">\r\n                    <Label htmlFor=\"customerDebtAmount\" className=\"text-right col-span-1\"></Label>\r\n                    <Input\r\n                      id=\"customerDebtAmount\"\r\n                      type=\"number\"\r\n                      value={customerDebtAmount}\r\n                      onChange={(e) => setCustomerDebtAmount(e.target.value)}\r\n                      className=\"col-span-3 text-right\"\r\n                      placeholder=\" \"\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex justify-end\">\r\n                    <Button\r\n                      className=\"bg-orange-600 hover:bg-orange-700\"\r\n                      onClick={async () => {\r\n                        const amt = parseFloat(customerDebtAmount);\r\n                        if (!selectedCustomerId) {\r\n                          toast({ title: ' ', description: '   ', variant: 'destructive' });\r\n                          return;\r\n                        }\r\n                        if (isNaN(amt) || amt <= 0) {\r\n                          toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n                          return;\r\n                        }\r\n                        const customer = customers.find(c => c.id === selectedCustomerId);\r\n                        if (!customer) return;\r\n                        const newDebt: Debt = {\r\n                          id: Date.now().toString(),\r\n                          debtorName: customer.name,\r\n                          customerId: customer.id,\r\n                          mobile: customer.mobile,\r\n                          amount: Number(amt.toFixed(2)),\r\n                          reason: ' ',\r\n                          status: 'pending',\r\n                          createdAt: new Date(),\r\n                          paidAmount: 0,\r\n                          partialPayments: []\r\n                        };\r\n                        setPendingDebtToCreate(newDebt);\r\n                        setIsDebtDeductionChoiceOpen(true);\r\n                      }}\r\n                    >\r\n                       \r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                <p className=\"text-sm text-gray-500 text-right\">   .   .</p>\r\n              )}\r\n            </div>\r\n            <div className=\"border-t pt-4 space-y-2\">\r\n              <Label className=\"text-right block\"> </Label>\r\n              {customers.length > 0 ? (\r\n                <div className=\"space-y-2 max-h-48 overflow-y-auto\">\r\n                  {customers.map((c) => (\r\n                    <div key={c.id} className=\"p-2 border rounded-md flex items-center justify-between\">\r\n                      <div className=\"text-right\">\r\n                        <div className=\"font-medium text-sm\">{c.name}</div>\r\n                        <div className=\"text-xs text-gray-600\">{c.mobile}</div>\r\n                      </div>\r\n                      <div className=\"flex gap-2\">\r\n                        <Button\r\n                          variant=\"outline\"\r\n                          size=\"sm\"\r\n                          onClick={() => {\r\n                            setEditingCustomerId(c.id);\r\n                            setEditingCustomerName(c.name || '');\r\n                            setEditingCustomerMobile(c.mobile || '');\r\n                            setIsEditCustomerDialogOpen(true);\r\n                          }}\r\n                        >\r\n                          \r\n                        </Button>\r\n                        <Button\r\n                          variant=\"destructive\"\r\n                          size=\"sm\"\r\n                          onClick={() => {\r\n                            setCustomerToDeleteId(c.id);\r\n                            setCustomerToDeleteName(c.name || '');\r\n                            setIsDeleteCustomerConfirmOpen(true);\r\n                          }}\r\n                        >\r\n                           \r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                <div className=\"text-xs text-gray-500\">    .</div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex justify-end\">\r\n            <Button variant=\"outline\" onClick={() => setIsAddCustomerDialogOpen(false)}></Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <Dialog open={isDeleteCustomerConfirmOpen} onOpenChange={setIsDeleteCustomerConfirmOpen}>\r\n        <DialogContent hideClose className=\"sm:max-w-[420px] rounded-2xl bg-gradient-to-br from-white via-rose-50 to-red-50 shadow-2xl border border-red-100 text-center\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-center text-xl font-bold text-red-700\">  </DialogTitle>\r\n            <DialogDescription className=\"text-center text-gray-600\">   : {customerToDeleteName}</DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"py-2 text-sm text-gray-700\">     .</div>\r\n          <DialogFooter className=\"flex justify-center gap-3\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setIsDeleteCustomerConfirmOpen(false);\r\n                setCustomerToDeleteId('');\r\n                setCustomerToDeleteName('');\r\n              }}\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              variant=\"destructive\"\r\n              className=\"bg-red-600 hover:bg-red-700\"\r\n              onClick={async () => {\r\n                const id = customerToDeleteId;\r\n                const updated = customers.filter(x => x.id !== id);\r\n                await saveCustomersToStorage(updated);\r\n                if (selectedCustomerId === id) setSelectedCustomerId('');\r\n                setIsDeleteCustomerConfirmOpen(false);\r\n                setCustomerToDeleteId('');\r\n                setCustomerToDeleteName('');\r\n                toast({ title: '  ', description: customerToDeleteName });\r\n              }}\r\n            >\r\n               \r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <Dialog open={isEditCustomerDialogOpen} onOpenChange={setIsEditCustomerDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-[420px]\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right\">  </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"grid gap-4 py-4\">\r\n            <div className=\"grid grid-cols-4 items-center gap-4\">\r\n              <Label htmlFor=\"editCustomerName\" className=\"text-right col-span-1\"></Label>\r\n              <Input id=\"editCustomerName\" value={editingCustomerName} onChange={(e) => setEditingCustomerName(e.target.value)} className=\"col-span-3 text-right\" />\r\n            </div>\r\n            <div className=\"grid grid-cols-4 items-center gap-4\">\r\n              <Label htmlFor=\"editCustomerMobile\" className=\"text-right col-span-1\"></Label>\r\n              <Input id=\"editCustomerMobile\" value={editingCustomerMobile} onChange={(e) => setEditingCustomerMobile(e.target.value)} className=\"col-span-3 text-right\" />\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex justify-between\">\r\n            <Button variant=\"outline\" onClick={() => setIsEditCustomerDialogOpen(false)}></Button>\r\n            <Button\r\n              className=\"bg-green-600 hover:bg-green-700\"\r\n              onClick={async () => {\r\n                const id = editingCustomerId;\r\n                const name = editingCustomerName.trim();\r\n                const mobile = editingCustomerMobile.trim();\r\n                if (!id || !name || !mobile) {\r\n                  toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n                  return;\r\n                }\r\n                const updated = customers.map(c => c.id === id ? { ...c, name, mobile } : c);\r\n                await saveCustomersToStorage(updated);\r\n                const updatedDebts = debts.map(d => d.customerId === id ? { ...d, debtorName: name, mobile } : d);\r\n                if (updatedDebts !== debts) {\r\n                  setDebts(updatedDebts);\r\n                  await saveDebtsToStorage(updatedDebts);\r\n                }\r\n                setIsEditCustomerDialogOpen(false);\r\n                setEditingCustomerId('');\r\n                setEditingCustomerName('');\r\n                setEditingCustomerMobile('');\r\n                toast({ title: '  ', description: name });\r\n              }}\r\n            >\r\n              \r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*    */}\r\n      <Dialog open={isShopExpensesDialogOpen} onOpenChange={setIsShopExpensesDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-[520px]\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right\"> </DialogTitle>\r\n            <DialogDescription className=\"text-right\">\r\n                    .\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"grid gap-4 py-4\">\r\n            <div className=\"grid grid-cols-4 items-center gap-4\">\r\n              <Label htmlFor=\"expenseName\" className=\"text-right col-span-1\">\r\n                 \r\n              </Label>\r\n              <Input\r\n                id=\"expenseName\"\r\n                value={expenseName}\r\n                onChange={(e) => setExpenseName(e.target.value)}\r\n                className=\"col-span-3 text-right\"\r\n                placeholder=\":   \"\r\n              />\r\n            </div>\r\n            <div className=\"grid grid-cols-4 items-center gap-4\">\r\n              <Label htmlFor=\"expenseAmount\" className=\"text-right col-span-1\">\r\n                 \r\n              </Label>\r\n              <Input\r\n                id=\"expenseAmount\"\r\n                type=\"number\"\r\n                value={expenseAmount}\r\n                onChange={(e) => setExpenseAmount(e.target.value)}\r\n                className=\"col-span-3 text-right\"\r\n                placeholder=\"0.00\"\r\n              />\r\n            </div>\r\n            <div className=\"grid grid-cols-4 items-center gap-4\">\r\n              <Label htmlFor=\"expenseNotes\" className=\"text-right col-span-1\">\r\n                \r\n              </Label>\r\n              <Input\r\n                id=\"expenseNotes\"\r\n                value={expenseNotes}\r\n                onChange={(e) => setExpenseNotes(e.target.value)}\r\n                className=\"col-span-3 text-right\"\r\n                placeholder=\"   \"\r\n              />\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex justify-between\">\r\n            <Button\r\n              className=\"bg-orange-600 hover:bg-orange-700\"\r\n              onClick={() => {\r\n                if (!expenseName || !expenseAmount) {\r\n                  toast({ title: '  ', description: '    ', variant: 'destructive' });\r\n                  return;\r\n                }\r\n                setIsExpenseDeductionChoiceOpen(true);\r\n              }}\r\n            >\r\n               \r\n            </Button>\r\n            {/*        */}\r\n            <Button variant=\"outline\" onClick={() => setIsReceiptsDialogOpen(true)}> </Button>\r\n          </DialogFooter>\r\n\r\n\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*     */}\r\n      <Dialog open={isReceiptsDialogOpen} onOpenChange={setIsReceiptsDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-[420px]\" dir=\"rtl\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right\"> </DialogTitle>\r\n            <DialogDescription className=\"text-right\">  </DialogDescription>\r\n          </DialogHeader>\r\n          {expenses.length > 0 ? (\r\n            <div className=\"space-y-2 max-h-64 overflow-y-auto\">\r\n              {expenses.map((ex) => (\r\n                <div key={ex.id} className=\"p-2 border rounded-lg bg-white hover:bg-gray-50 transition-colors\">\r\n                  <div className=\"flex justify-between items-start\">\r\n                    <div className=\"text-right\">\r\n                      <p className=\"font-medium text-sm\">{ex.name}</p>\r\n                      <p className=\"text-[11px] text-gray-600\">{ex.notes || ' '}</p>\r\n                      <p className=\"text-[10px] text-gray-500\">{new Date(ex.createdAt).toLocaleString('ar-EG')}</p>\r\n                    </div>\r\n                    <div className=\"text-left flex items-start gap-2\">\r\n                      <div className=\"text-left\">\r\n                        <p className=\"font-bold text-sm\">{ex.amount} </p>\r\n                        <Badge variant=\"secondary\" className={ex.source === 'cash' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'}>\r\n                          {ex.source === 'cash' ? ' ' : ` ${ex.walletId ? ` (${ex.walletId})` : ''}`}\r\n                        </Badge>\r\n                      </div>\r\n                      <Button\r\n                        variant=\"destructive\"\r\n                        size=\"sm\"\r\n                        className=\"shrink-0\"\r\n                        onClick={() => permanentlyDeleteExpense(ex.id)}\r\n                        title=\" \"\r\n                      >\r\n                        <Trash2 className=\"w-4 h-4 ml-1\" />\r\n                        \r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <p className=\"text-sm text-gray-500 text-center\">    </p>\r\n          )}\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*      */}\r\n      <Dialog open={isExpenseDeductionChoiceOpen} onOpenChange={setIsExpenseDeductionChoiceOpen}>\r\n        <DialogContent className=\"sm:max-w-[480px]\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right\">   </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <p className=\"text-sm text-gray-600 text-right\">\r\n                            .\r\n            </p>\r\n            <div className=\"grid grid-cols-3 gap-3\">\r\n              <Button\r\n                variant={expenseDeductionSource === 'cash' ? 'default' : 'outline'}\r\n                className={expenseDeductionSource === 'cash' ? 'bg-blue-600 hover:bg-blue-700 text-white' : ''}\r\n                onClick={() => setExpenseDeductionSource('cash')}\r\n              >\r\n                 \r\n              </Button>\r\n              <Button\r\n                variant={expenseDeductionSource === 'wallet' ? 'default' : 'outline'}\r\n                className={expenseDeductionSource === 'wallet' ? 'bg-purple-600 hover:bg-purple-700 text-white' : ''}\r\n                onClick={() => setExpenseDeductionSource('wallet')}\r\n              >\r\n                 \r\n              </Button>\r\n              <Button\r\n                variant={expenseDeductionSource === 'fawry' ? 'default' : 'outline'}\r\n                className={expenseDeductionSource === 'fawry' ? 'bg-amber-600 hover:bg-amber-700 text-white' : ''}\r\n                onClick={() => setExpenseDeductionSource('fawry')}\r\n              >\r\n                \r\n              </Button>\r\n            </div>\r\n\r\n            {expenseDeductionSource === 'wallet' && (\r\n              <div className=\"space-y-2\">\r\n                <Label className=\"text-right block\">  </Label>\r\n                <Select value={selectedWalletForExpense} onValueChange={setSelectedWalletForExpense}>\r\n                  <SelectTrigger className=\"w-full\">\r\n                    <SelectValue placeholder=\" \" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {wallets.map(w => (\r\n                      <SelectItem key={w.id} value={w.id}>{w.phone || w.name || w.id}</SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            )}\r\n          </div>\r\n          <DialogFooter className=\"flex justify-between\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setIsExpenseDeductionChoiceOpen(false);\r\n                setExpenseDeductionSource(null);\r\n                setSelectedWalletForExpense('');\r\n              }}\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              className=\"bg-green-600 hover:bg-green-700\"\r\n              onClick={async () => {\r\n                const amt = Number(expenseAmount);\r\n                if (isNaN(amt) || amt <= 0) {\r\n                  toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n                  return;\r\n                }\r\n                if (!expenseDeductionSource) {\r\n                  toast({ title: '  ', description: '    ', variant: 'destructive' });\r\n                  return;\r\n                }\r\n                try {\r\n                  if (expenseDeductionSource === 'cash') {\r\n                    const newCash = Number((cashBalance - amt).toFixed(2));\r\n                    setCashBalance(newCash);\r\n                    localStorage.setItem(getCashBalanceKey(), newCash.toString());\r\n                    const updateData = { cashBalance: newCash, lastUpdated: new Date().toISOString() };\r\n                    const localDataKey = `userData_${user?.uid}`;\r\n                    localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n                    if (user?.uid) {\r\n                      await userDataService.updateUserData(user.uid, updateData);\r\n                      localStorage.removeItem(localDataKey);\r\n                      setHasLocalDataToSync(false);\r\n                    } else {\r\n                      setHasLocalDataToSync(true);\r\n                    }\r\n                  } else if (expenseDeductionSource === 'wallet') {\r\n                    if (!selectedWalletForExpense) {\r\n                      toast({ title: ' ', description: '   ', variant: 'destructive' });\r\n                      return;\r\n                    }\r\n                    const current = walletBalances[selectedWalletForExpense] || 0;\r\n                    const newBalance = Number((current - amt).toFixed(2));\r\n                    const updatedBalances = { ...walletBalances, [selectedWalletForExpense]: newBalance };\r\n                    setWalletBalances(updatedBalances);\r\n                    const timestamp = new Date().toISOString();\r\n                    const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp } as any;\r\n                    const localDataKey = `userData_${user?.uid}`;\r\n                    localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\r\n                    localStorage.setItem(`walletBalances_backup_${timestamp}`, JSON.stringify(updatedBalances));\r\n                    if (user?.uid) {\r\n                      await userDataService.updateUserData(user.uid, updateData);\r\n                    }\r\n                  } else if (expenseDeductionSource === 'fawry') {\r\n                    //            \"\"\r\n                  }\r\n                } catch (e) {\r\n                  console.error('      :', e);\r\n                }\r\n\r\n                //    Firestore     \r\n                let newExpenseId = Date.now().toString();\r\n                try {\r\n                  if (user?.uid) {\r\n                    const { addDoc, collection, serverTimestamp } = await import('firebase/firestore');\r\n                    const { db } = await import('@/firebase');\r\n                    const docRef = await addDoc(collection(db, 'shop_expenses'), {\r\n                      userId: user.uid,\r\n                      shopId: (shopIdCtx || profile?.shopId || user.uid || 'default-shop'),\r\n                      name: expenseName,\r\n                      amount: amt,\r\n                      notes: expenseNotes || '',\r\n                      source: expenseDeductionSource,\r\n                      walletId: expenseDeductionSource === 'wallet' ? selectedWalletForExpense : null,\r\n                      createdAt: serverTimestamp(),\r\n                    });\r\n                    newExpenseId = docRef.id;\r\n                  }\r\n                } catch (e) {\r\n                  console.error('     Firestore:', e);\r\n                }\r\n\r\n                //          \r\n                const newExpense: ShopExpense = {\r\n                  id: newExpenseId,\r\n                  name: expenseName,\r\n                  amount: amt,\r\n                  notes: expenseNotes,\r\n                  source: expenseDeductionSource,\r\n                  walletId: expenseDeductionSource === 'wallet' ? selectedWalletForExpense : undefined,\r\n                  createdAt: new Date(),\r\n                };\r\n                const updatedExpenses = [...expenses, newExpense];\r\n                await saveExpensesToStorage(updatedExpenses);\r\n\r\n                //  \r\n                setExpenseName('');\r\n                setExpenseAmount('');\r\n                setExpenseNotes('');\r\n                setExpenseDeductionSource(null);\r\n                setSelectedWalletForExpense('');\r\n                //         \r\n                setIsExpenseDeductionChoiceOpen(false);\r\n                setIsShopExpensesDialogOpen(true);\r\n\r\n                //       \r\n                setIsReceiptsDialogOpen(true);\r\n\r\n                toast({\r\n                  title: '  ',\r\n                  description:\r\n                    expenseDeductionSource === 'cash'\r\n                      ? '   '\r\n                      : expenseDeductionSource === 'wallet'\r\n                        ? '    '\r\n                        : '    ',\r\n                });\r\n              }}\r\n            >\r\n               \r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*   */}\r\n      <Dialog open={isDeficienciesDialogOpen} onOpenChange={setIsDeficienciesDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-[520px]\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right\"></DialogTitle>\r\n            <DialogDescription className=\"text-right\">\r\n                     .\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"grid gap-4 py-4\">\r\n            <div className=\"grid grid-cols-4 items-center gap-4\">\r\n              <Label htmlFor=\"deficiencyName\" className=\"text-right col-span-1\">\r\n                 \r\n              </Label>\r\n              <Input\r\n                id=\"deficiencyName\"\r\n                value={deficiencyName}\r\n                onChange={(e) => setDeficiencyName(e.target.value)}\r\n                className=\"col-span-3 text-right\"\r\n                placeholder=\":   \"\r\n              />\r\n            </div>\r\n            <div className=\"grid grid-cols-4 items-center gap-4\">\r\n              <Label htmlFor=\"deficiencyQuantity\" className=\"text-right col-span-1\">\r\n                \r\n              </Label>\r\n              <Input\r\n                id=\"deficiencyQuantity\"\r\n                type=\"number\"\r\n                value={deficiencyQuantity}\r\n                onChange={(e) => setDeficiencyQuantity(e.target.value)}\r\n                className=\"col-span-3 text-right\"\r\n                placeholder=\"1\"\r\n              />\r\n            </div>\r\n            <div className=\"flex justify-end\">\r\n              <Button\r\n                className=\"bg-rose-600 hover:bg-rose-700\"\r\n                onClick={() => {\r\n                  if (isZeroPlan) {\r\n                    toast({ title: ' ', description: '     .  .', variant: 'destructive' });\r\n                    return;\r\n                  }\r\n                  const qty = parseInt(deficiencyQuantity || '1', 10);\r\n                  if (!deficiencyName) {\r\n                    toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n                    return;\r\n                  }\r\n                  if (isNaN(qty) || qty <= 0) {\r\n                    toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n                    return;\r\n                  }\r\n                  (async () => {\r\n                    //  :   Firestore     \r\n                    if (user?.uid) {\r\n                      try {\r\n                        const { collection, addDoc, serverTimestamp } = await import('firebase/firestore');\r\n                        const { db } = await import('@/firebase');\r\n                        const docRef = await addDoc(collection(db, 'deficiencies'), {\r\n                          userId: user.uid,\r\n                          shopId: (shopIdCtx || profile?.shopId || user.uid || 'default-shop'),\r\n                          name: deficiencyName,\r\n                          quantity: qty,\r\n                          status: 'pending',\r\n                          createdAt: serverTimestamp(),\r\n                        });\r\n                        //          /\r\n                        try {\r\n                          const key = getDeficienciesKey();\r\n                          const raw = localStorage.getItem(key);\r\n                          const list = raw ? JSON.parse(raw) : [];\r\n                          const safeList = Array.isArray(list) ? list : [];\r\n                          const exists = safeList.some((d: any) => String(d?.id || '') === docRef.id);\r\n                          const optimisticItem = {\r\n                            id: docRef.id,\r\n                            name: deficiencyName,\r\n                            quantity: qty,\r\n                            status: 'pending',\r\n                            createdAt: new Date().toISOString(),\r\n                          };\r\n                          const updatedOptimistic = exists ? safeList : [...safeList, optimisticItem];\r\n                          localStorage.setItem(key, JSON.stringify(updatedOptimistic));\r\n                        } catch { }\r\n                        setDeficiencyName('');\r\n                        setDeficiencyQuantity('');\r\n                        toast({ title: ' ', description: '     ' });\r\n                        return;\r\n                      } catch (e) {\r\n                        console.warn('    Firestore   :', e);\r\n                      }\r\n                    }\r\n                    // :          Firestore\r\n                    const newItem: DeficiencyItem = {\r\n                      id: Date.now().toString(),\r\n                      name: deficiencyName,\r\n                      quantity: qty,\r\n                      status: 'pending',\r\n                      createdAt: new Date(),\r\n                    };\r\n                    setDeficiencies(prev => {\r\n                      const updated = [...prev, newItem];\r\n                      saveDeficienciesToStorage(updated);\r\n                      return updated;\r\n                    });\r\n                    setDeficiencyName('');\r\n                    setDeficiencyQuantity('');\r\n                    toast({ title: ' ', description: '     ' });\r\n                  })();\r\n                }}\r\n              >\r\n                 \r\n              </Button>\r\n            </div>\r\n\r\n            {/*   */}\r\n            {deficiencies.length > 0 ? (\r\n              <div className=\"space-y-2 max-h-64 overflow-y-auto\">\r\n                {deficiencies.map((d) => (\r\n                  <div key={d.id} className=\"p-2 border rounded-lg bg-white hover:bg-gray-50 transition-colors\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"text-right\">\r\n                        <p className=\"font-medium text-sm\">{d.name}</p>\r\n                        <p className=\"text-[11px] text-gray-600\">: {d.quantity}</p>\r\n                        <p className=\"text-[10px] text-gray-500\">{new Date(d.createdAt).toLocaleString('ar-EG')}</p>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Badge variant=\"secondary\" className={d.status === 'pending' ? 'bg-rose-100 text-rose-700' : 'bg-green-100 text-green-700'}>\r\n                          {d.status === 'pending' ? ' ' : ' '}\r\n                        </Badge>\r\n                        <Button\r\n                          variant=\"outline\"\r\n                          className={d.status === 'pending' ? 'text-green-700 border-green-300 hover:bg-green-50' : 'text-rose-700 border-rose-300 hover:bg-rose-50'}\r\n                          onClick={() => {\r\n                            (async () => {\r\n                              const next = d.status === 'pending' ? 'purchased' : 'pending';\r\n                              if (user?.uid) {\r\n                                try {\r\n                                  const { doc, updateDoc, serverTimestamp } = await import('firebase/firestore');\r\n                                  const { db } = await import('@/firebase');\r\n                                  await updateDoc(doc(db, 'deficiencies', d.id), { status: next, updatedAt: serverTimestamp() });\r\n                                  return;\r\n                                } catch (e) {\r\n                                  console.warn('     Firestore   :', e);\r\n                                }\r\n                              }\r\n                              setDeficiencies(prev => {\r\n                                const updated = prev.map(item => item.id === d.id ? { ...item, status: next } : item);\r\n                                saveDeficienciesToStorage(updated);\r\n                                return updated;\r\n                              });\r\n                            })();\r\n                          }}\r\n                          title={d.status === 'pending' ? ' ' : ' '}\r\n                        >\r\n                          {d.status === 'pending' ? ' ' : ' '}\r\n                        </Button>\r\n                        <Button\r\n                          variant=\"outline\"\r\n                          className=\"text-red-700 border-red-300 hover:bg-red-50\"\r\n                          onClick={() => {\r\n                            (async () => {\r\n                              if (user?.uid) {\r\n                                try {\r\n                                  const { doc, deleteDoc } = await import('firebase/firestore');\r\n                                  const { db } = await import('@/firebase');\r\n                                  await deleteDoc(doc(db, 'deficiencies', d.id));\r\n                                  return;\r\n                                } catch (e) {\r\n                                  console.warn('     Firestore   :', e);\r\n                                }\r\n                              }\r\n                              setDeficiencies(prev => {\r\n                                const updated = prev.filter(item => item.id !== d.id);\r\n                                saveDeficienciesToStorage(updated);\r\n                                return updated;\r\n                              });\r\n                            })();\r\n                          }}\r\n                          title=\"\"\r\n                        >\r\n                          \r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <p className=\"text-sm text-gray-500 text-center\">     </p>\r\n            )}\r\n          </div>\r\n\r\n          <DialogFooter className=\"flex justify-end\">\r\n            <Button variant=\"outline\" onClick={() => setIsDeficienciesDialogOpen(false)}></Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*      */}\r\n      <Dialog open={isDebtDeductionChoiceOpen} onOpenChange={setIsDebtDeductionChoiceOpen}>\r\n        <DialogContent className=\"sm:max-w-[480px]\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right\">   </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <p className=\"text-sm text-gray-600 text-right\">\r\n                                .\r\n            </p>\r\n            <div className=\"grid grid-cols-3 gap-3\">\r\n              <Button\r\n                variant={deductionSource === 'cash' ? 'default' : 'outline'}\r\n                className={deductionSource === 'cash' ? 'bg-blue-600 hover:bg-blue-700 text-white' : ''}\r\n                onClick={() => setDeductionSource('cash')}\r\n              >\r\n                 \r\n              </Button>\r\n              <Button\r\n                variant={deductionSource === 'wallet' ? 'default' : 'outline'}\r\n                className={deductionSource === 'wallet' ? 'bg-purple-600 hover:bg-purple-700 text-white' : ''}\r\n                onClick={() => setDeductionSource('wallet')}\r\n              >\r\n                 \r\n              </Button>\r\n              <Button\r\n                variant={deductionSource === 'none' ? 'default' : 'outline'}\r\n                className={deductionSource === 'none' ? 'bg-gray-600 hover:bg-gray-700 text-white' : ''}\r\n                onClick={() => setDeductionSource('none')}\r\n              >\r\n                 \r\n              </Button>\r\n            </div>\r\n\r\n            {deductionSource === 'wallet' && (\r\n              <div className=\"space-y-2\">\r\n                <Label className=\"text-right block\">  </Label>\r\n                <Select value={selectedWalletForDeduction} onValueChange={setSelectedWalletForDeduction}>\r\n                  <SelectTrigger className=\"w-full\">\r\n                    <SelectValue placeholder=\" \" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {wallets.map(w => (\r\n                      <SelectItem key={w.id} value={w.id}>{w.phone || w.name || w.id}</SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            )}\r\n          </div>\r\n          <DialogFooter className=\"flex justify-between\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setIsDebtDeductionChoiceOpen(false);\r\n                setPendingDebtToCreate(null);\r\n                setDeductionSource(null);\r\n                setSelectedWalletForDeduction('');\r\n              }}\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              className=\"bg-green-600 hover:bg-green-700\"\r\n              onClick={async () => {\r\n                const isAdjustment = !!pendingDebtAdjustment && !pendingDebtToCreate;\r\n                const amt = isAdjustment ? Number(pendingDebtAdjustment!.delta) : Number(pendingDebtToCreate?.amount || 0);\r\n                if (!deductionSource) {\r\n                  toast({ title: '  ', description: '    ', variant: 'destructive' });\r\n                  return;\r\n                }\r\n\r\n                try {\r\n                  if (deductionSource === 'cash') {\r\n                    const newCash = Number((cashBalance - amt).toFixed(2));\r\n                    setCashBalance(newCash);\r\n                    localStorage.setItem(getCashBalanceKey(), newCash.toString());\r\n                    const timestamp = new Date().toISOString();\r\n                    const updateData = { cashBalance: newCash, lastUpdated: timestamp } as any;\r\n                    const localDataKey = `userData_${user?.uid}`;\r\n                    localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n                    if (user?.uid) {\r\n                      await userDataService.updateUserData(user.uid, updateData)\r\n                        .then(() => {\r\n                          localStorage.removeItem(localDataKey);\r\n                          setHasLocalDataToSync(false);\r\n                        })\r\n                        .catch(() => {\r\n                          setHasLocalDataToSync(true);\r\n                        });\r\n                    } else {\r\n                      setHasLocalDataToSync(true);\r\n                    }\r\n                  } else if (deductionSource === 'wallet') {\r\n                    if (!selectedWalletForDeduction) {\r\n                      toast({ title: ' ', description: '   ', variant: 'destructive' });\r\n                      return;\r\n                    }\r\n                    const current = walletBalances[selectedWalletForDeduction] || 0;\r\n                    const newBalance = Number((current - amt).toFixed(2));\r\n                    const updatedBalances = { ...walletBalances, [selectedWalletForDeduction]: newBalance };\r\n                    setWalletBalances(updatedBalances);\r\n                    const timestamp = new Date().toISOString();\r\n                    const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp };\r\n                    const localDataKey = `userData_${user?.uid}`;\r\n                    localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\r\n                    localStorage.setItem(`walletBalances_backup_${timestamp}`, JSON.stringify(updatedBalances));\r\n                    if (user?.uid) {\r\n                      await userDataService.updateUserData(user.uid, updateData);\r\n                    }\r\n                  } else if (deductionSource === 'none') {\r\n                    //       \r\n                  }\r\n                } catch (e) {\r\n                  console.error('     / :', e);\r\n                }\r\n\r\n                if (isAdjustment) {\r\n                  if (!selectedDebt) return;\r\n                  const currentAmount = Number(selectedDebt.amount || 0);\r\n                  const paid = Number(selectedDebt.paidAmount || 0);\r\n                  const delta = Number(pendingDebtAdjustment!.delta || 0);\r\n                  if (pendingDebtAdjustment!.type === 'decrease') {\r\n                    const newAmount = Number((currentAmount - delta).toFixed(2));\r\n                    const becamePaid = paid >= newAmount;\r\n                    const updated: Debt = {\r\n                      ...selectedDebt,\r\n                      amount: newAmount,\r\n                      status: becamePaid ? 'paid' : 'pending',\r\n                    };\r\n                    const updatedDebts = debts.map(d => d.id === selectedDebt.id ? updated : d);\r\n                    setDebts(updatedDebts);\r\n                    setSelectedDebt(updated);\r\n                    await saveDebtsToStorage(updatedDebts);\r\n                    try {\r\n                      if (becamePaid && user?.uid) {\r\n                        (async () => {\r\n                          const q = fsQuery(\r\n                            collection(db, 'userTransactions'),\r\n                            where('userId', '==', user.uid),\r\n                            where('linkedDebtId', '==', selectedDebt.id),\r\n                            where('status', '==', 'pending')\r\n                          );\r\n                          const snap = await getDocs(q);\r\n                          await Promise.allSettled(\r\n                            snap.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\r\n                          );\r\n                          try {\r\n                            const ids = snap.docs.map(d => String((d.data() as any)?.transactionId || ''));\r\n                            if (user?.uid) ids.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\r\n                          } catch { }\r\n                          const q2 = fsQuery(\r\n                            collection(db, 'transactions'),\r\n                            where('userId', '==', user.uid),\r\n                            where('linkedDebtId', '==', selectedDebt.id),\r\n                            where('status', '==', 'pending')\r\n                          );\r\n                          const snap2 = await getDocs(q2);\r\n                          await Promise.allSettled(\r\n                            snap2.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\r\n                          );\r\n                          try {\r\n                            const ids2 = snap2.docs.map(d => String(d.id || (d.data() as any)?.transactionId || ''));\r\n                            if (user?.uid) ids2.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\r\n                          } catch { }\r\n                          const q3 = fsQuery(\r\n                            collection(db, 'transactions'),\r\n                            where('merchantUserId', '==', user.uid),\r\n                            where('linkedDebtId', '==', selectedDebt.id),\r\n                            where('status', '==', 'pending')\r\n                          );\r\n                          const snap3 = await getDocs(q3);\r\n                          await Promise.allSettled(\r\n                            snap3.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\r\n                          );\r\n                          try {\r\n                            const ids3 = snap3.docs.map(d => String(d.id || (d.data() as any)?.transactionId || ''));\r\n                            if (user?.uid) ids3.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\r\n                          } catch { }\r\n                        })().catch((e) => {\r\n                          console.error('       :', e);\r\n                          toast({ title: '   ', description: '     ', variant: 'destructive' });\r\n                        });\r\n                      }\r\n                    } catch (e) {\r\n                      console.error('       :', e);\r\n                    }\r\n                    toast({ title: '  ', description: ` : ${newAmount} ` });\r\n                  } else {\r\n                    const newAmount = currentAmount + delta;\r\n                    const stillPaid = paid >= newAmount;\r\n                    const updated: Debt = {\r\n                      ...selectedDebt,\r\n                      amount: Number(newAmount.toFixed(2)),\r\n                      status: stillPaid ? 'paid' : 'pending',\r\n                    };\r\n                    const updatedDebts = debts.map(d => d.id === selectedDebt.id ? updated : d);\r\n                    setDebts(updatedDebts);\r\n                    setSelectedDebt(updated);\r\n                    await saveDebtsToStorage(updatedDebts);\r\n                    toast({ title: '  ', description: ` : ${newAmount} ` });\r\n                  }\r\n                } else if (pendingDebtToCreate) {\r\n                  const updatedDebts = [...debts, pendingDebtToCreate];\r\n                  setDebts(updatedDebts);\r\n                  await saveDebtsToStorage(updatedDebts);\r\n                  try { if (user?.uid) { await telegramNotifier.send(user.uid, `    ${pendingDebtToCreate.debtorName}  ${pendingDebtToCreate.amount} `); } } catch {}\r\n                }\r\n\r\n                setDebtorName('');\r\n                setDebtAmount('');\r\n                setDebtReason('');\r\n                setIsDebtsDialogOpen(false);\r\n                setIsDebtDeductionChoiceOpen(false);\r\n                setPendingDebtToCreate(null);\r\n                setPendingDebtAdjustment(null);\r\n                setDeductionSource(null);\r\n                setSelectedWalletForDeduction('');\r\n\r\n                toast({\r\n                  title: isAdjustment ? '    ' : (deductionSource === 'none' ? '    ' : '    '),\r\n                  description: deductionSource === 'none'\r\n                    ? '      '\r\n                    : deductionSource === 'cash'\r\n                      ? `  ${amt}   `\r\n                      : `  ${amt}   `,\r\n                });\r\n              }}\r\n            >\r\n               \r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*    */}\r\n      <Dialog open={isDebtReceiptOpen} onOpenChange={setIsDebtReceiptOpen}>\r\n        <DialogContent className=\"sm:max-w-[425px]\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right\"> </DialogTitle>\r\n          </DialogHeader>\r\n          {selectedDebt && (\r\n            <div className=\"grid gap-4 py-4\">\r\n              <div className=\"text-center border-b pb-4\">\r\n                <h2 className=\"text-xl font-bold\"> </h2>\r\n                <p className=\"text-sm text-gray-500\">\r\n                  {dateFormatter.format(selectedDebt.createdAt instanceof Date ? selectedDebt.createdAt : new Date(selectedDebt.createdAt))}\r\n                </p>\r\n              </div>\r\n\r\n              <div className=\"space-y-3\">\r\n                <div className=\"flex justify-between\">\r\n                  <span className=\"font-medium\"> :</span>\r\n                  <span>{selectedDebt.debtorName}</span>\r\n                </div>\r\n                <div className=\"flex justify-between items-center\">\r\n                  <span className=\"font-medium\">:</span>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      className=\"h-8 w-8 p-0\"\r\n                      aria-label=\" \"\r\n                      onClick={() => {\r\n                        setDebtAdjustType('decrease');\r\n                        setDebtAdjustAmount('');\r\n                        //          \r\n                        setIsDebtReceiptOpen(false);\r\n                        setIsDebtAdjustDialogOpen(true);\r\n                      }}\r\n                    >\r\n                      \r\n                    </Button>\r\n                    <span className=\"font-bold text-lg\">{selectedDebt.amount} </span>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      className=\"h-8 w-8 p-0\"\r\n                      aria-label=\" \"\r\n                      onClick={() => {\r\n                        setDebtAdjustType('increase');\r\n                        setDebtAdjustAmount('');\r\n                        //          \r\n                        setIsDebtReceiptOpen(false);\r\n                        setIsDebtAdjustDialogOpen(true);\r\n                      }}\r\n                    >\r\n                      +\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n                {(() => {\r\n                  try {\r\n                    const profit = (transactions || []).filter((t: any) => String(t?.linkedDebtId || '') === String(selectedDebt.id))\r\n                      .reduce((sum: number, t: any) => sum + Math.max(0, Number(t?.commission || 0)), 0);\r\n                    return profit > 0 ? (\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"font-medium\">:</span>\r\n                        <span className=\"text-green-700 font-semibold\">{profit} </span>\r\n                      </div>\r\n                    ) : null;\r\n                  } catch {\r\n                    return null;\r\n                  }\r\n                })()}\r\n                <div className=\"flex justify-between\">\r\n                  <span className=\"font-medium\"> :</span>\r\n                  <span>{selectedDebt.reason}</span>\r\n                </div>\r\n                <div className=\"flex justify-between\">\r\n                  <span className=\"font-medium\">:</span>\r\n                  <Badge\r\n                    variant={selectedDebt.status === 'paid' ? 'default' : 'secondary'}\r\n                    className={selectedDebt.status === 'paid' ? 'bg-green-500' : 'bg-yellow-500'}\r\n                  >\r\n                    {selectedDebt.status === 'paid' ? '' : ''}\r\n                  </Badge>\r\n                </div>\r\n                {/*      */}\r\n                {(() => {\r\n                  try {\r\n                    const related = (transactions || []).filter((t: any) => String(t?.linkedDebtId || '') === String(selectedDebt.id));\r\n                    const profit = related.reduce((sum: number, t: any) => sum + Math.max(0, Number(t?.commission || 0)), 0);\r\n                    const principal = related.reduce((sum: number, t: any) => sum + Math.max(0, Number((t?.sentAmount ?? t?.transferredAmount ?? t?.withdrawnAmount ?? t?.amount) || 0)), 0);\r\n                    const base = Number(selectedDebt.amount || 0);\r\n                    const paid = Number(selectedDebt.paidAmount || 0);\r\n                    const shouldIncludeProfit = base < (principal + profit);\r\n                    const totalDue = shouldIncludeProfit ? (base + profit) : base;\r\n                    const remaining = Math.max(0, Number(totalDue) - paid);\r\n                    return (\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"font-medium\"> :</span>\r\n                        <span className=\"font-bold text-lg\">{remaining} </span>\r\n                      </div>\r\n                    );\r\n                  } catch {\r\n                    return (\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"font-medium\"> :</span>\r\n                        <span className=\"font-bold text-lg\">{Number(selectedDebt.amount || 0) - Number(selectedDebt.paidAmount || 0)} </span>\r\n                      </div>\r\n                    );\r\n                  }\r\n                })()}\r\n                {selectedDebt.paidAmount ? (\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"font-medium\"> :</span>\r\n                    <span className=\"text-green-700\">{selectedDebt.paidAmount} </span>\r\n                  </div>\r\n                ) : null}\r\n                <div className=\"mt-3 p-3 border rounded-lg bg-gray-50\">\r\n                  {!isPartialPaymentOpen ? (\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      className=\"w-full\"\r\n                      onClick={() => setIsPartialPaymentOpen(true)}\r\n                    >\r\n                       \r\n                    </Button>\r\n                  ) : (\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"partialAmount\" className=\"text-right block\">  </Label>\r\n                      <Input\r\n                        id=\"partialAmount\"\r\n                        type=\"number\"\r\n                        value={partialPaymentAmount}\r\n                        onChange={(e) => setPartialPaymentAmount(e.target.value)}\r\n                        className=\"text-right\"\r\n                        placeholder=\" \"\r\n                      />\r\n                      <div className=\"flex gap-2\">\r\n                        <Button\r\n                          variant=\"outline\"\r\n                          onClick={() => {\r\n                            setIsPartialPaymentOpen(false);\r\n                            setPartialPaymentAmount('');\r\n                          }}\r\n                        >\r\n                          \r\n                        </Button>\r\n                        <Button\r\n                          className=\"bg-blue-600 hover:bg-blue-700\"\r\n                          onClick={async () => {\r\n                            const amt = parseFloat(partialPaymentAmount);\r\n                            if (!selectedDebt || isNaN(amt) || amt <= 0) {\r\n                              toast({\r\n                                title: '',\r\n                                description: '   ',\r\n                                variant: 'destructive',\r\n                              });\r\n                              return;\r\n                            }\r\n                            const remainingBefore = Math.max(0, Number(selectedDebt.amount || 0) - Number(selectedDebt.paidAmount || 0));\r\n                            if (amt > remainingBefore) {\r\n                              toast({\r\n                                title: ' ',\r\n                                description: '    ',\r\n                                variant: 'destructive',\r\n                              });\r\n                              return;\r\n                            }\r\n\r\n                            const newPaidTotal = Number(((selectedDebt.paidAmount || 0) + amt).toFixed(2));\r\n                            const isFullyPaid = newPaidTotal >= Number(selectedDebt.amount || 0);\r\n                            const updated: Debt = {\r\n                              ...selectedDebt,\r\n                              amount: Number(selectedDebt.amount || 0),\r\n                              paidAmount: newPaidTotal,\r\n                              status: isFullyPaid ? 'paid' : 'pending',\r\n                              partialPayments: [\r\n                                ...(selectedDebt.partialPayments || []),\r\n                                { amount: amt, paidAt: new Date() }\r\n                              ]\r\n                            };\r\n\r\n                            const updatedDebts = debts.map(d => d.id === selectedDebt.id ? updated : d);\r\n                            setDebts(updatedDebts);\r\n                            setSelectedDebt(updated);\r\n                            await saveDebtsToStorage(updatedDebts);\r\n                            try { if (user?.uid) { const remaining = Math.max(0, Number(updated.amount || 0) - Number(updated.paidAmount || 0)); await telegramNotifier.send(user.uid, `     ${updated.debtorName}:  ${amt}   ${remaining} `); } } catch {}\r\n                            //              \r\n                            try {\r\n                              if (updated.status === 'paid' && user?.uid) {\r\n                                (async () => {\r\n                                  const q = fsQuery(\r\n                                    collection(db, 'userTransactions'),\r\n                                    where('userId', '==', user.uid),\r\n                                    where('linkedDebtId', '==', selectedDebt.id),\r\n                                    where('status', '==', 'pending')\r\n                                  );\r\n                                  const snap = await getDocs(q);\r\n                                  await Promise.allSettled(\r\n                                    snap.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\r\n                                  );\r\n                                  try {\r\n                                    const ids = snap.docs.map(d => String((d.data() as any)?.transactionId || ''));\r\n                                    if (user?.uid) ids.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\r\n                                  } catch { }\r\n                                  const q2 = fsQuery(\r\n                                    collection(db, 'transactions'),\r\n                                    where('userId', '==', user.uid),\r\n                                    where('linkedDebtId', '==', selectedDebt.id),\r\n                                    where('status', '==', 'pending')\r\n                                  );\r\n                                  const snap2 = await getDocs(q2);\r\n                                  await Promise.allSettled(\r\n                                    snap2.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\r\n                                  );\r\n                                  try {\r\n                                    const ids2 = snap2.docs.map(d => String(d.id || (d.data() as any)?.transactionId || ''));\r\n                                    if (user?.uid) ids2.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\r\n                                  } catch { }\r\n                                  const q3 = fsQuery(\r\n                                    collection(db, 'transactions'),\r\n                                    where('merchantUserId', '==', user.uid),\r\n                                    where('linkedDebtId', '==', selectedDebt.id),\r\n                                    where('status', '==', 'pending')\r\n                                  );\r\n                                  const snap3 = await getDocs(q3);\r\n                                  await Promise.allSettled(\r\n                                    snap3.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\r\n                                  );\r\n                                  try {\r\n                                    const ids3 = snap3.docs.map(d => String(d.id || (d.data() as any)?.transactionId || ''));\r\n                                    if (user?.uid) ids3.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\r\n                                  } catch { }\r\n                                })().catch((e) => {\r\n                                  console.error('     :', e);\r\n                                  toast({ title: '   ', description: '     ', variant: 'destructive' });\r\n                                });\r\n                              }\r\n                            } catch (e) {\r\n                              console.error('     :', e);\r\n                            }\r\n                            try {\r\n                              const localKey = getTransactionsKey();\r\n                              const raw = localStorage.getItem(localKey);\r\n                              if (raw) {\r\n                                const arr = JSON.parse(raw) || [];\r\n                                const updatedArr = arr.map((t: any) =>\r\n                                  (t?.linkedDebtId === selectedDebt.id && t?.status === 'pending')\r\n                                    ? { ...t, status: 'completed', confirmedAt: new Date() }\r\n                                    : t\r\n                                );\r\n                                localStorage.setItem(localKey, JSON.stringify(updatedArr));\r\n                                setTransactions(prev => prev.map((t: any) =>\r\n                                  (t?.linkedDebtId === selectedDebt.id && t?.status === 'pending')\r\n                                    ? { ...t, status: 'completed', confirmedAt: new Date() }\r\n                                    : t\r\n                                ));\r\n                              }\r\n                            } catch (err) {\r\n                              console.warn('        :', err);\r\n                            }\r\n                            //          \r\n                            setPaymentAmountPending(amt);\r\n                            setPaymentCreditSource('none');\r\n                            setIsPaymentCreditChoiceOpen(true);\r\n                            setIsPartialPaymentOpen(false);\r\n                            setPartialPaymentAmount('');\r\n                            toast({\r\n                              title: '   ',\r\n                              description: `  ${amt}   ${new Date().toLocaleString('ar-EG')}`,\r\n                            });\r\n                          }}\r\n                        >\r\n                          \r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  {selectedDebt.partialPayments && selectedDebt.partialPayments.length > 0 && (\r\n                    <div className=\"mt-3 text-xs text-gray-600\">\r\n                      <p className=\"font-medium mb-1\">  :</p>\r\n                      <div className=\"space-y-1 max-h-24 overflow-y-auto\">\r\n                        {selectedDebt.partialPayments.map((p, idx) => (\r\n                          <div key={idx} className=\"flex justify-between\">\r\n                            <span>: {p.amount} </span>\r\n                            <span>{new Date(p.paidAt).toLocaleString('ar-EG')}</span>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n          <DialogFooter className=\"flex gap-2 justify-center\">\r\n            <Button\r\n              onClick={async () => {\r\n                if (selectedDebt) {\r\n                  const updatedDebts = debts.map(debt =>\r\n                    debt.id === selectedDebt.id\r\n                      ? { ...debt, status: 'pending' as const }\r\n                      : debt\r\n                  );\r\n                  setDebts(updatedDebts);\r\n\r\n                  //    \r\n                  await saveDebtsToStorage(updatedDebts);\r\n                  try { if (user?.uid) { const payAmount = computedRemaining; await telegramNotifier.send(user.uid, `     ${selectedDebt.debtorName}:  ${payAmount} `); } } catch {}\r\n\r\n                  setIsDebtReceiptOpen(false);\r\n                  toast({\r\n                    title: \"   \",\r\n                    description: \"   \",\r\n                  });\r\n                }\r\n              }}\r\n              variant=\"outline\"\r\n              className=\"bg-yellow-500 hover:bg-yellow-600 text-white\"\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              onClick={async () => {\r\n                if (selectedDebt) {\r\n                  const base = Number(selectedDebt.amount || 0);\r\n                  const paid = Number(selectedDebt.paidAmount || 0);\r\n                  let computedRemaining = Math.max(0, base - paid);\r\n                  try {\r\n                    const related = (transactions || []).filter((t: any) => String(t?.linkedDebtId || '') === String(selectedDebt.id));\r\n                    const profit = related.reduce((sum: number, t: any) => sum + Math.max(0, Number(t?.commission || 0)), 0);\r\n                    const principal = related.reduce((sum: number, t: any) => sum + Math.max(0, Number((t?.sentAmount ?? t?.transferredAmount ?? t?.withdrawnAmount ?? t?.amount) || 0)), 0);\r\n                    const shouldIncludeProfit = base < (principal + profit);\r\n                    const totalDue = shouldIncludeProfit ? (base + profit) : base;\r\n                    computedRemaining = Math.max(0, Number(totalDue) - paid);\r\n                  } catch { }\r\n                  const payAmount = computedRemaining;\r\n                  const updatedDebts = debts.map(debt => {\r\n                    if (debt.id !== selectedDebt.id) return debt;\r\n                    const baseAmt = Number(debt.amount || 0);\r\n                    const prevPaid = Number(debt.paidAmount || 0);\r\n                    const newPaidTotal = Number((prevPaid + payAmount).toFixed(2));\r\n                    const isFullyPaid = newPaidTotal >= baseAmt;\r\n                    return {\r\n                      ...debt,\r\n                      amount: baseAmt,\r\n                      paidAmount: isFullyPaid ? baseAmt : newPaidTotal,\r\n                      status: 'paid' as const,\r\n                      partialPayments: [\r\n                        ...(debt.partialPayments || []),\r\n                        ...(payAmount > 0 ? [{ amount: payAmount, paidAt: new Date() }] : [])\r\n                      ]\r\n                    };\r\n                  });\r\n                  setDebts(updatedDebts);\r\n                  try { setSelectedDebt(updatedDebts.find(d => d.id === selectedDebt.id) || null); } catch {}\r\n\r\n                  setPaymentAmountPending(payAmount);\r\n                  setPaymentCreditSource('none');\r\n                  setIsPaymentCreditChoiceOpen(true);\r\n\r\n                  //    \r\n                  await saveDebtsToStorage(updatedDebts);\r\n\r\n                  //       \r\n                  try {\r\n                    if (user?.uid && selectedDebt?.id) {\r\n                      (async () => {\r\n                        const q = fsQuery(\r\n                          collection(db, 'userTransactions'),\r\n                          where('userId', '==', user.uid),\r\n                          where('linkedDebtId', '==', selectedDebt.id),\r\n                          where('status', '==', 'pending')\r\n                        );\r\n                        const snap = await getDocs(q);\r\n                        await Promise.allSettled(\r\n                          snap.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\r\n                        );\r\n                        try {\r\n                          const ids = snap.docs.map(d => String((d.data() as any)?.transactionId || ''));\r\n                          if (user?.uid) ids.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\r\n                        } catch { }\r\n                        const q2 = fsQuery(\r\n                          collection(db, 'transactions'),\r\n                          where('userId', '==', user.uid),\r\n                          where('linkedDebtId', '==', selectedDebt.id),\r\n                          where('status', '==', 'pending')\r\n                        );\r\n                        const snap2 = await getDocs(q2);\r\n                        await Promise.allSettled(\r\n                          snap2.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\r\n                        );\r\n                        try {\r\n                          const ids2 = snap2.docs.map(d => String(d.id || (d.data() as any)?.transactionId || ''));\r\n                          if (user?.uid) ids2.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\r\n                        } catch { }\r\n                        const q3 = fsQuery(\r\n                          collection(db, 'transactions'),\r\n                          where('merchantUserId', '==', user.uid),\r\n                          where('linkedDebtId', '==', selectedDebt.id),\r\n                          where('status', '==', 'pending')\r\n                        );\r\n                        const snap3 = await getDocs(q3);\r\n                        await Promise.allSettled(\r\n                          snap3.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\r\n                        );\r\n                        try {\r\n                          const ids3 = snap3.docs.map(d => String(d.id || (d.data() as any)?.transactionId || ''));\r\n                          if (user?.uid) ids3.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\r\n                        } catch { }\r\n                      })().catch((e) => {\r\n                        console.error('     :', e);\r\n                        toast({ title: '   ', description: '     ', variant: 'destructive' });\r\n                      });\r\n                    }\r\n                  } catch (e) {\r\n                    console.error('     :', e);\r\n                  }\r\n\r\n                  try {\r\n                    const localKey = getTransactionsKey();\r\n                    const raw = localStorage.getItem(localKey);\r\n                    if (raw) {\r\n                      const arr = JSON.parse(raw) || [];\r\n                      const updatedArr = arr.map((t: any) =>\r\n                        (t?.linkedDebtId === selectedDebt.id && t?.status === 'pending')\r\n                          ? { ...t, status: 'completed', confirmedAt: new Date() }\r\n                          : t\r\n                      );\r\n                      localStorage.setItem(localKey, JSON.stringify(updatedArr));\r\n                      setTransactions(prev => prev.map((t: any) =>\r\n                        (t?.linkedDebtId === selectedDebt.id && t?.status === 'pending')\r\n                          ? { ...t, status: 'completed', confirmedAt: new Date() }\r\n                          : t\r\n                      ));\r\n                    }\r\n                  } catch (err) {\r\n                    console.warn('        :', err);\r\n                  }\r\n\r\n                  setIsDebtReceiptOpen(false);\r\n                  toast({\r\n                    title: \"   \",\r\n                    description: \"   \",\r\n                  });\r\n                }\r\n              }}\r\n              className=\"bg-green-500 hover:bg-green-600\"\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              onClick={async () => {\r\n                if (selectedDebt) {\r\n                  const updatedDebts = debts.filter(debt => debt.id !== selectedDebt.id);\r\n                  setDebts(updatedDebts);\r\n\r\n                  //    \r\n                  await saveDebtsToStorage(updatedDebts);\r\n\r\n                  setIsDebtReceiptOpen(false);\r\n                  toast({\r\n                    title: \"  \",\r\n                    description: \"   \",\r\n                  });\r\n                }\r\n              }}\r\n              variant=\"destructive\"\r\n            >\r\n              \r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*       */}\r\n      <Dialog open={isDebtAdjustDialogOpen} onOpenChange={setIsDebtAdjustDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md rounded-2xl shadow-elegant border border-gray-200\">\r\n          <DialogHeader>\r\n            <DialogTitle className={`text-right ${debtAdjustType === 'decrease' ? 'text-red-600' : 'text-green-600'}`}>\r\n              {debtAdjustType === 'decrease' ? '  ' : debtAdjustType === 'increase' ? '  ' : '  '}\r\n            </DialogTitle>\r\n            <DialogDescription className=\"text-right\">\r\n                    {debtAdjustType === 'decrease' ? '' : ''}.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"grid gap-4 py-2\">\r\n            <Label htmlFor=\"debtAdjustAmount\" className=\"text-right\"> ()</Label>\r\n            <Input id=\"debtAdjustAmount\" type=\"number\" placeholder=\"0.00\" value={debtAdjustAmount}\r\n              onChange={(e) => setDebtAdjustAmount(e.target.value)} />\r\n            {selectedDebt && (\r\n              <div className=\"text-right text-sm text-muted-foreground\">\r\n                 : <span className=\"font-semibold\">{Number(selectedDebt.amount || 0).toFixed(2)}</span> \r\n              </div>\r\n            )}\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2\">\r\n            <Button variant=\"secondary\" onClick={() => { setIsDebtAdjustDialogOpen(false); setIsDebtReceiptOpen(true); }}></Button>\r\n            <Button\r\n              className={debtAdjustType === 'decrease' ? 'bg-red-600 hover:bg-red-700' : 'bg-green-600 hover:bg-green-700'}\r\n              onClick={async () => {\r\n                try {\r\n                  if (!selectedDebt || !debtAdjustType) return;\r\n                  const delta = Number(parseFloat(debtAdjustAmount || '0').toFixed(2));\r\n                  if (!delta || isNaN(delta) || delta <= 0) {\r\n                    toast({ title: '  ', description: '     ', variant: 'destructive' });\r\n                    return;\r\n                  }\r\n                  setPendingDebtAdjustment({ debtId: selectedDebt.id, delta, type: debtAdjustType });\r\n                  setIsDebtAdjustDialogOpen(false);\r\n                  setIsDebtDeductionChoiceOpen(true);\r\n                } catch (e) {\r\n                  console.error('    :', e);\r\n                  toast({ title: '', description: '    ', variant: 'destructive' });\r\n                }\r\n              }}\r\n            >\r\n              \r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*          */}\r\n      <Dialog open={isPaymentCreditChoiceOpen} onOpenChange={setIsPaymentCreditChoiceOpen}>\r\n        <DialogContent className=\"sm:max-w-[480px]\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right\">   </DialogTitle>\r\n            <DialogDescription className=\"text-right\">\r\n                         \r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"space-y-3\">\r\n            <div className=\"flex flex-wrap gap-2 justify-center\">\r\n              <Button\r\n                variant={paymentCreditSource === 'cash' ? 'default' : 'outline'}\r\n                className={paymentCreditSource === 'cash' ? 'bg-blue-600 text-white' : ''}\r\n                size=\"sm\"\r\n                onClick={() => setPaymentCreditSource('cash')}\r\n              >\r\n                 \r\n              </Button>\r\n              <Button\r\n                variant={paymentCreditSource === 'wallet' ? 'default' : 'outline'}\r\n                className={paymentCreditSource === 'wallet' ? 'bg-blue-600 text-white' : ''}\r\n                size=\"sm\"\r\n                onClick={() => setPaymentCreditSource('wallet')}\r\n              >\r\n                 \r\n              </Button>\r\n              <Button\r\n                variant={paymentCreditSource === 'fawry' ? 'default' : 'outline'}\r\n                className={paymentCreditSource === 'fawry' ? 'bg-amber-600 text-white' : ''}\r\n                size=\"sm\"\r\n                onClick={() => setPaymentCreditSource('fawry')}\r\n              >\r\n                \r\n              </Button>\r\n              <Button\r\n                variant={paymentCreditSource === 'none' ? 'default' : 'outline'}\r\n                className={paymentCreditSource === 'none' ? 'bg-gray-600 text-white' : ''}\r\n                size=\"sm\"\r\n                onClick={() => setPaymentCreditSource('none')}\r\n              >\r\n                 \r\n              </Button>\r\n            </div>\r\n            {paymentCreditSource === 'wallet' && (\r\n              <div className=\"space-y-2\">\r\n                <label className=\"block text-right\"> </label>\r\n                <select\r\n                  className=\"w-full border rounded p-2 text-right\"\r\n                  value={selectedWalletForPaymentCredit}\r\n                  onChange={(e) => setSelectedWalletForPaymentCredit(e.target.value)}\r\n                >\r\n                  <option value=\"\">   </option>\r\n                  {(wallets && wallets.length > 0\r\n                    ? wallets.map((w) => (\r\n                      <option key={w.id} value={w.id}>\r\n                        {w.phone || w.name || w.id}\r\n                      </option>\r\n                    ))\r\n                    : Object.keys(walletBalances || {}).map((wid) => (\r\n                      <option key={wid} value={wid}>\r\n                        {wallets.find(w => w.id === wid)?.phone\r\n                          || (JSON.parse(localStorage.getItem(getWalletsKey()) || '[]')?.find((w: any) => w.id === wid)?.phone)\r\n                          || (JSON.parse(localStorage.getItem(getWalletsKey()) || '[]')?.find((w: any) => w.id === wid)?.name)\r\n                          || (wallets.find(w => w.id === wid)?.name)\r\n                          || wid}\r\n                      </option>\r\n                    ))\r\n                  )}\r\n                </select>\r\n              </div>\r\n            )}\r\n            <div className=\"text-right text-sm text-gray-600\">\r\n                : <span className=\"font-bold\">{paymentAmountPending} </span>\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex flex-wrap justify-between gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setIsPaymentCreditChoiceOpen(false);\r\n                setPaymentAmountPending(0);\r\n                setPaymentCreditSource(null);\r\n                setSelectedWalletForPaymentCredit('');\r\n              }}\r\n            >\r\n              \r\n            </Button>\r\n              <Button\r\n                onClick={async () => {\r\n                  try {\r\n                    const amt = paymentAmountPending;\r\n                    if (!amt || amt <= 0) {\r\n                      setIsPaymentCreditChoiceOpen(false);\r\n                      return;\r\n                    }\r\n                    if (paymentCreditSource === 'cash') {\r\n                    const newCashBalance = cashBalance + amt;\r\n                    setCashBalance(newCashBalance);\r\n                    localStorage.setItem(getCashBalanceKey(), newCashBalance.toString());\r\n                    const updateData = { cashBalance: newCashBalance, lastUpdated: new Date().toISOString() };\r\n                    const localDataKey = `userData_${user?.uid}`;\r\n                    localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n                    if (user?.uid) {\r\n                      userDataService.updateUserData(user.uid, updateData).catch(() => setHasLocalDataToSync(true));\r\n                      localStorage.removeItem(localDataKey);\r\n                      setHasLocalDataToSync(false);\r\n                    } else {\r\n                      setHasLocalDataToSync(true);\r\n                    }\r\n                      toast({\r\n                        title: '   ',\r\n                        description: `  ${amt}    `,\r\n                      });\r\n                      try {\r\n                        if (selectedDebt) {\r\n                          const updatedDebts = debts.map(d => d.id === selectedDebt.id ? { ...d, status: 'paid' as const, paidAmount: Math.max(Number(d.paidAmount || 0), Number(d.amount || 0)) } : d);\r\n                          setDebts(updatedDebts);\r\n                          try { setSelectedDebt(updatedDebts.find(d => d.id === selectedDebt.id) || null); } catch {}\r\n                          try { await saveDebtsToStorage(updatedDebts); } catch {}\r\n                        }\r\n                      } catch {}\r\n                    } else if (paymentCreditSource === 'wallet') {\r\n                    if (!selectedWalletForPaymentCredit) {\r\n                      toast({\r\n                        title: '  ',\r\n                        description: '      ',\r\n                        variant: 'destructive',\r\n                      });\r\n                      return;\r\n                    }\r\n                    const updatedBalances = {\r\n                      ...walletBalances,\r\n                      [selectedWalletForPaymentCredit]: (walletBalances[selectedWalletForPaymentCredit] || 0) + amt,\r\n                    };\r\n                    setWalletBalances(updatedBalances);\r\n\r\n                    //          \r\n                    const newCashBalance = (cashBalance || 0) - amt;\r\n                    setCashBalance(newCashBalance);\r\n                    localStorage.setItem(getCashBalanceKey(), newCashBalance.toString());\r\n\r\n                    const timestamp = new Date().toISOString();\r\n                    const updateData = { walletBalances: updatedBalances, cashBalance: newCashBalance, lastUpdated: timestamp };\r\n                    const localDataKey = `userData_${user?.uid}`;\r\n                    localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\r\n                    localStorage.setItem(`walletBalances_backup_${timestamp}`, JSON.stringify(updatedBalances));\r\n                    if (user?.uid) {\r\n                      userDataService.updateUserData(user.uid, updateData).catch(() => setHasLocalDataToSync(true));\r\n                      try { localStorage.removeItem(localDataKey); } catch { }\r\n                      setHasLocalDataToSync(false);\r\n                    } else {\r\n                      setHasLocalDataToSync(true);\r\n                    }\r\n                      toast({\r\n                        title: '   ',\r\n                        description: `  ${amt}    ${(wallets.find(w => w.id === selectedWalletForPaymentCredit)?.phone || wallets.find(w => w.id === selectedWalletForPaymentCredit)?.name || selectedWalletForPaymentCredit)}       `,\r\n                      });\r\n                      try {\r\n                        if (selectedDebt) {\r\n                          const updatedDebts = debts.map(d => d.id === selectedDebt.id ? { ...d, status: 'paid' as const, paidAmount: Math.max(Number(d.paidAmount || 0), Number(d.amount || 0)) } : d);\r\n                          setDebts(updatedDebts);\r\n                          try { setSelectedDebt(updatedDebts.find(d => d.id === selectedDebt.id) || null); } catch {}\r\n                          try { await saveDebtsToStorage(updatedDebts); } catch {}\r\n                        }\r\n                      } catch {}\r\n                    } else if (paymentCreditSource === 'none') {\r\n                      toast({\r\n                        title: '  ',\r\n                        description: `  ${amt}    `,\r\n                      });\r\n                      try {\r\n                        if (selectedDebt) {\r\n                          const updatedDebts = debts.map(d => d.id === selectedDebt.id ? { ...d, status: 'paid' as const, paidAmount: Math.max(Number(d.paidAmount || 0), Number(d.amount || 0)) } : d);\r\n                          setDebts(updatedDebts);\r\n                          try { setSelectedDebt(updatedDebts.find(d => d.id === selectedDebt.id) || null); } catch {}\r\n                          try { await saveDebtsToStorage(updatedDebts); } catch {}\r\n                        }\r\n                      } catch {}\r\n                    } else if (paymentCreditSource === 'fawry') {\r\n                    //        \r\n                    toast({\r\n                      title: '    ',\r\n                      description: `  ${amt}       `,\r\n                      });\r\n                    } else {\r\n                    toast({\r\n                      title: '  ',\r\n                      description: '       ',\r\n                      variant: 'destructive',\r\n                    });\r\n                    return;\r\n                    }\r\n\r\n                    try {\r\n                      const sentAmt = amt > 0 ? amt : Number(selectedDebt?.amount || 0);\r\n                      if (user?.uid && selectedDebt) {\r\n                        await telegramNotifier.send(user.uid, `     ${selectedDebt.debtorName}:  ${sentAmt} `);\r\n                      }\r\n                    } catch {}\r\n                  } catch (e) {\r\n                    console.error('    :', e);\r\n                    toast({\r\n                      title: ' ',\r\n                      description: '      ',\r\n                    variant: 'destructive',\r\n                  });\r\n                } finally {\r\n                  setIsPaymentCreditChoiceOpen(false);\r\n                  setPaymentAmountPending(0);\r\n                  setPaymentCreditSource(null);\r\n                  setSelectedWalletForPaymentCredit('');\r\n                  try { setIsDebtReceiptsListOpen(true); } catch {}\r\n                }\r\n              }}\r\n              className=\"bg-green-600 hover:bg-green-700\"\r\n            >\r\n               \r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*     / */}\r\n      <Dialog open={isPostConfirmPopupOpen} onOpenChange={setIsPostConfirmPopupOpen}>\r\n        <DialogContent hideClose className=\"post-confirm-card sm:max-w-[420px] w-[90vw] rounded-2xl bg-gradient-to-br from-white via-indigo-50 to-blue-50 shadow-2xl border border-indigo-100\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-right text-2xl font-bold\">\r\n              {postConfirmInfo?.type === 'transfer' ? '  ' : '  '}\r\n            </DialogTitle>\r\n            <DialogDescription className=\"text-right text-gray-600\">\r\n              {postConfirmInfo?.type === 'transfer'\r\n                ? '        .'\r\n                : '       .'}\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"py-3 flex flex-col items-center gap-1.5\">\r\n            <div className=\"text-xl sm:text-2xl font-bold text-blue-700 tracking-wide\">{formatNumberEnglish(postConfirmInfo?.amount || 0)} </div>\r\n            <div className=\"text-sm text-gray-500 text-right w-full\">\r\n              {postConfirmInfo?.type === 'transfer'\r\n                ? '    .'\r\n                : (isCommissionAddMode\r\n                  ? '      .'\r\n                  : '     .')}\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex justify-end gap-2\">\r\n            {postConfirmInfo?.type === 'transfer' && (\r\n              <Button\r\n                variant=\"outline\"\r\n                id=\"sendCodeBtn\"\r\n                onClick={triggerSendTransferCode}\r\n                disabled={ussdLoading}\r\n                className=\"btn-transfer-confirm\"\r\n              >\r\n                {ussdLoading ? ' ...' : '  '}\r\n              </Button>\r\n            )}\r\n            <Button\r\n              onClick={() => {\r\n                setIsPostConfirmPopupOpen(false);\r\n                setPostConfirmInfo(null);\r\n              }}\r\n              className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n            >\r\n              {postConfirmInfo?.type === 'transfer' ? ' ' : ' '}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*   PIN     */}\r\n      <PinModal\r\n        open={isPinModalOpen}\r\n        onClose={() => setIsPinModalOpen(false)}\r\n        onSubmit={handlePinSubmit}\r\n        deviceId={(lastDecoratedDeviceId || selectedAdbDeviceId || '')}\r\n        recipientMsisdn={String(\r\n          transactionType === 'transfer'\r\n            //            \r\n            ? (lastUSSDTransfer?.receiver || receiverPhone || '')\r\n            //         \r\n            : ((wallets.find(w => w.id === selectedWallet)?.phone) || '')\r\n        ).replace(/\\D/g, '')}\r\n      />\r\n\r\n      {/*     :       */}\r\n\r\n      {/* Change Log Dialog */}\r\n      <ChangeLogDialog open={isChangeLogOpen} onOpenChange={setIsChangeLogOpen} />\r\n\r\n      {/*          */}\r\n      {showDesktopQuickIcons && <ChangeLogFloatingButton onClick={() => setIsChangeLogOpen(true)} />}\r\n\r\n\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UserDashboardPage;\r\n"],"file":"assets/UserDashboardPage-AOyofZAh.js"}