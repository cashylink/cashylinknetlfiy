const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DhbnydJl.js","./index-DLaPizfT.css"])))=>i.map(i=>d[i]);
import{a0 as Me,u as pe,r as d,m as je,j as e,aa as Ne,ab as ve,ac as we,ad as be,a3 as ae,B as I,aU as se,c as Y,d as re,e as ne,aC as Pe,ap as Ae,g as $,P as he,U as Ke,bW as Te,bA as fe,bX as Ce,bz as de,aD as Xe,C as Qe,aT as Ze,a as es,K as ss,ay as ts,I as X,aE as as,aG as rs,aN as ns}from"./index-DhbnydJl.js";import{S as is,a as ls,b as cs,c as os,d as ds}from"./select-Bn8RCTk-.js";import{W as ce}from"./wallet--cZcBirk.js";import{S as Fe}from"./star-BSPZIAqJ.js";import{S as _e}from"./square-pen-CSLFtBCt.js";import{A as Re}from"./arrow-left-DTf_k4UZ.js";import{P as De}from"./progress-QxZkw5ok.js";import{S as ms}from"./separator-Cn84CDdZ.js";import{C as hs}from"./calendar-4dCWv1Gk.js";import{C as Ue}from"./chart-column-CP9zHq0e.js";import{T as me}from"./trending-down-CYLWGiMe.js";import{D as xe}from"./dollar-sign-AUKMnGdi.js";import{A as oe}from"./activity-NKT3hJFE.js";import{C as xs}from"./users-D9PlfCO2.js";import{C as us}from"./circle-check-big-Dtvck6_a.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],ze=Me("building",gs);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]],ye=Me("id-card",fs),ys=[{id:"vodafone",name:"فودافون كاش",ownerName:"أحمد محمد علي",nationalId:"29012345678901"},{id:"etisalat",name:"اتصالات كاش",ownerName:"فاطمة حسن محمود",nationalId:"28506789012345"},{id:"orange",name:"أورنج كاش",ownerName:"محمد أحمد السيد",nationalId:"29309876543210"},{id:"we_pay",name:"وي باي",ownerName:"نورا عبد الرحمن",nationalId:"29112345678901"},{id:"smart_wallet",name:"سمارت ولت",ownerName:"خالد محمد عبد الله",nationalId:"28809876543210"},{id:"access_pay",name:"أكسس باي",ownerName:"مريم أحمد حسن",nationalId:"29456789012345"},{id:"insta_pay",name:"انستا باي",ownerName:"عمر سعد محمد",nationalId:"29012345678901"}],ps=({isOpen:o,onClose:V,onWalletSelect:U,onEditWallet:f,onDeleteWallet:k,allowedWalletIds:L})=>{const{user:l}=pe(),[b,M]=d.useState([]),[C,F]=d.useState(!1),[z,S]=d.useState([]),[B,y]=d.useState(!1),{toast:O}=je(),G=async(a,c)=>{const N=new Date().getMonth(),T=new Date().getFullYear(),x=c.filter(i=>{const g=new Date(i.createdAt);return g.getMonth()===N&&g.getFullYear()===T&&(i.lineId===a||i.fromWallet===a)}),p=i=>{const g=i.type;return i.txnType==="receive"||g==="withdraw"||g==="withdrawal"||g==="receive"},u=i=>{const g=i.type;return i.txnType==="send"||g==="send"||g==="transfer"},v=x.filter(p).reduce((i,g)=>{const j=g.withdrawnAmount!==void 0?g.withdrawnAmount:g.amount;return i+(j||0)},0),R=x.filter(u).reduce((i,g)=>{const j=g.sentAmount!==void 0?g.sentAmount:g.amount;return i+(j||0)},0);return{withdrawalUsage:v,transferUsage:R}},P=a=>{const c=new Date().toISOString().split("T")[0],N=a.lastResetDate;if(!N)return{...a,monthlyWithdrawalUsage:0,monthlyTransferUsage:0,lastResetDate:c};const T=new Date(N),x=new Date;return T.getMonth()!==x.getMonth()||T.getFullYear()!==x.getFullYear()?{...a,monthlyWithdrawalUsage:0,monthlyTransferUsage:0,lastResetDate:c}:a};d.useEffect(()=>{if(!(l!=null&&l.uid)||!o)return;(async()=>{y(!0);try{const c=await se.getByMerchantId(l.uid),N=await Te.getByUserId(l.uid);let T=c;if(L&&L.length>0){const u=new Set(L.map(v=>String(v)));T=c.filter(v=>u.has(String(v.id)))}const p=(await Promise.all(T.map(async u=>{const{withdrawalUsage:v,transferUsage:R}=await G(u.id,N),i=await fe.getWalletLimits(u.id);return{id:u.id,name:u.label||"محفظة بدون اسم",phone:u.msisdn,ownerName:u.ownerName,nationalId:u.nationalId||"",isDefault:!1,isActive:u.isActive===!0,monthlyWithdrawalLimit:(i==null?void 0:i.monthlyWithdrawLimit)??u.withdrawLimit??2e5,monthlyTransferLimit:(i==null?void 0:i.monthlyTransferLimit)??u.transferLimit??2e5,monthlyWithdrawalUsage:(i==null?void 0:i.monthlyWithdrawUsed)??v??0,monthlyTransferUsage:(i==null?void 0:i.monthlyTransferUsed)??R??0,lastResetDate:new Date().toISOString().split("T")[0],walletProvider:u.walletProvider||""}}))).map(P);M(p)}catch(c){console.error("Error loading wallets:",c),O({title:"فشل جلب بيانات المحافظ",description:"قد تكون المشكلة بسبب الصلاحيات أو الاتصال. سيتم عرض البيانات المحلية إن وُجدت. جرّب تسجيل الدخول مجددًا أو افتح صفحة اختبار المصادقة من القائمة.",variant:"destructive"})}finally{y(!1)}})()},[l==null?void 0:l.uid,o,L]);const J=a=>ys.find(c=>c.id===a),E=(a,c)=>c>0?Math.min(a/c*100,100):0,H=a=>new Intl.NumberFormat("ar-EG",{maximumFractionDigits:0}).format(a);return e.jsx(Ne,{open:o,onOpenChange:V,children:e.jsxs(ve,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(we,{className:"pb-4",children:[e.jsxs(be,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ce,{className:"h-5 w-5"}),"الاطلاع على جميع المحافظ",e.jsxs(ae,{variant:"secondary",className:"mr-2",children:[b.length," محفظة"]})]}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:C?e.jsxs(e.Fragment,{children:[e.jsx(I,{size:"sm",onClick:async()=>{try{if(!(l!=null&&l.uid))return;const a=b.map(c=>se.update(c.id,{isActive:z.includes(c.id)}));await Promise.all(a),M(c=>c.map(N=>({...N,isActive:z.includes(N.id)}))),F(!1),O({title:"تم تفعيل المحافظ",description:"فقط المحافظ المحددة ستظهر في الاختيار الخارجي"});try{window.dispatchEvent(new CustomEvent("wallets:activation-updated"))}catch{}}catch(a){console.error("Error activating wallets:",a),O({title:"فشل التفعيل",description:"تعذر تفعيل المحافظ المحددة",variant:"destructive"})}},className:"h-7",children:"تفعيل المحافظ"}),e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>{F(!1),S([])},className:"h-7",children:"إلغاء"})]}):e.jsx(I,{variant:"outline",size:"sm",onClick:()=>F(!0),className:"h-7",children:"تحديد المحافظ"})})]}),B?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"جاري تحميل المحافظ..."})]})}):b.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ce,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"لا توجد محافظ مضافة حتى الآن"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map(a=>{const c=J(a.walletProvider||"");E(a.monthlyWithdrawalUsage||0,a.monthlyWithdrawalLimit),E(a.monthlyTransferUsage||0,a.monthlyTransferLimit);const N=z.includes(a.id),T=C?`cursor-pointer transition-shadow border-2 ${N?"border-blue-500 shadow-lg":"hover:border-blue-300"}`:"cursor-pointer hover:shadow-lg transition-shadow border-2 hover:border-blue-300";return e.jsxs(Y,{className:T,onClick:()=>{C?S(x=>x.includes(a.id)?x.filter(p=>p!==a.id):[...x,a.id]):U(a)},children:[e.jsx(re,{className:"pb-3",children:e.jsxs(ne,{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx("span",{children:a.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.isActive&&e.jsx(ae,{variant:"default",className:"text-xs",children:"نشطة"}),a.isDefault&&e.jsxs(ae,{variant:"default",className:"text-xs",children:[e.jsx(Fe,{className:"h-3 w-3 mr-1"}),"افتراضية"]}),e.jsx(I,{variant:"ghost",size:"sm",onClick:x=>{x.stopPropagation(),f==null||f(a)},className:"h-7 px-2",children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",onClick:x=>{x.stopPropagation(),k==null||k(a.id)},className:"h-7 px-2 text-destructive hover:text-destructive",children:e.jsx(Ae,{className:"h-4 w-4"})})]})]})}),e.jsxs($,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(he,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"font-mono",children:a.phone})]}),a.ownerName&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ke,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{children:a.ownerName})]}),a.nationalId&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ye,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"font-mono",children:a.nationalId})]}),c&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ze,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{children:c.name})]})]}),(()=>{const x=a.monthlyWithdrawalLimit,p=a.monthlyTransferLimit,u=a.monthlyWithdrawalUsage||0,v=a.monthlyTransferUsage||0,R=Math.max(x-u,0),i=Math.max(p-v,0);return e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2",children:[e.jsxs("div",{className:"text-xs text-gray-600 font-medium text-center",children:["الحدود الشهرية: ",(c==null?void 0:c.name)||a.walletProvider," - ",a.phone]}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-red-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-200 ease-out shadow-sm",style:{width:`${Math.min(u/Math.max(x,1)*100,100)}%`}})}),e.jsx("div",{className:"w-1/2 bg-blue-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-200 ease-out shadow-sm",style:{width:`${Math.min(v/Math.max(p,1)*100,100)}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsxs("div",{className:"text-xs text-red-600 font-medium",children:["متبقي سحب: ",H(R)," جنيه"]}),e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["متبقي تحويل: ",H(i)," جنيه"]})]})]})})(),e.jsx(I,{variant:"outline",size:"sm",className:"w-full text-xs",onClick:x=>{x.stopPropagation(),U(a)},children:"عرض التفاصيل الكاملة"})]})]},a.id)})}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsxs(I,{onClick:V,variant:"outline",children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"إغلاق"]})})]})})},js=[{id:"vodafone",name:"فودافون كاش",ownerName:"أحمد محمد علي",nationalId:"29012345678901"},{id:"etisalat",name:"اتصالات كاش",ownerName:"فاطمة حسن محمود",nationalId:"28506789012345"},{id:"orange",name:"أورنج كاش",ownerName:"محمد أحمد السيد",nationalId:"29309876543210"},{id:"we_pay",name:"وي باي",ownerName:"نورا عبد الرحمن",nationalId:"29112345678901"},{id:"smart_wallet",name:"سمارت ولت",ownerName:"خالد محمد عبد الله",nationalId:"28809876543210"},{id:"access_pay",name:"أكسس باي",ownerName:"مريم أحمد حسن",nationalId:"29456789012345"},{id:"insta_pay",name:"انستا باي",ownerName:"عمر سعد محمد",nationalId:"29012345678901"}],Ns=({wallet:o,isOpen:V,onClose:U,onBack:f})=>{const{user:k}=pe(),[L,l]=d.useState([]),[b,M]=d.useState(!1),[C,F]=d.useState("month"),{toast:z}=je();if(d.useEffect(()=>{if(!o||!(k!=null&&k.uid)||!V)return;(async()=>{M(!0);try{const w=(await Te.getByUserId(k.uid)).filter(te=>te.walletId===o.id).sort((te,Q)=>new Date(Q.createdAt).getTime()-new Date(te.createdAt).getTime());l(w)}catch(r){console.error("Error loading transactions:",r),z({title:"فشل جلب معاملات المحفظة",description:"قد تكون المشكلة بسبب صلاحيات Firestore أو الاتصال. تم عرض ما أمكن محليًا. جرّب تسجيل الدخول مجددًا أو صفحة اختبار المصادقة.",variant:"destructive"})}finally{M(!1)}})()},[o,k==null?void 0:k.uid,V]),!o)return null;const S=t=>js.find(r=>r.id===t),B=(t,r)=>r>0?Math.min(t/r*100,100):0,y=t=>new Intl.NumberFormat("ar-EG").format(t),O=t=>new Date(t).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),P=(()=>{const t=new Date;let r;switch(C){case"week":r=new Date(t.getTime()-7*24*60*60*1e3);break;case"month":r=new Date(t.getFullYear(),t.getMonth(),1);break;default:return L}return L.filter(w=>new Date(w.createdAt)>=r)})(),J=t=>{const r=t.type,w=t.txnType;return r==="withdraw"||r==="withdrawal"||r==="receive"||w==="receive"},E=t=>{const r=t.type,w=t.txnType;return r==="send"||r==="transfer"||w==="send"},H=P.filter(t=>J(t)&&t.status==="completed").reduce((t,r)=>{const w=r.withdrawnAmount!==void 0?r.withdrawnAmount:r.amount;return t+(w||0)},0),a=P.filter(t=>E(t)&&t.status==="completed"&&t.title!=="إيصال تحويل مكينه").reduce((t,r)=>{const w=r.sentAmount!==void 0?r.sentAmount:r.amount;return t+(w||0)},0),c=P.filter(t=>t.type==="deposit"&&t.status==="completed").reduce((t,r)=>t+r.amount,0),N=P.filter(t=>t.status==="completed"),T=N.length,x=N.reduce((t,r)=>{if(J(r)){const w=r.withdrawnAmount??r.receivedAmount??r.amount??0;return t+Ce(Number(w)||0,"receive")}if(E(r)){const w=r.sentAmount??r.transferredAmount??r.amount??0;return t+Ce(Number(w)||0,"send")}return t},0),p=S(o.walletProvider||""),u=B(o.monthlyWithdrawalUsage||0,o.monthlyWithdrawalLimit),v=B(o.monthlyTransferUsage||0,o.monthlyTransferLimit),R=t=>{switch(t){case"withdrawal":return e.jsx(me,{className:"h-4 w-4 text-red-500"});case"transfer":return e.jsx(de,{className:"h-4 w-4 text-blue-500"});case"deposit":return e.jsx(xe,{className:"h-4 w-4 text-green-500"});default:return e.jsx(oe,{className:"h-4 w-4 text-gray-500"})}},i=t=>{switch(t){case"completed":return e.jsx(us,{className:"h-4 w-4 text-green-500"});case"pending":return e.jsx(Qe,{className:"h-4 w-4 text-yellow-500"});case"failed":return e.jsx(xs,{className:"h-4 w-4 text-red-500"});default:return e.jsx(Xe,{className:"h-4 w-4 text-gray-500"})}},g=t=>{switch(t){case"withdrawal":return"سحب";case"transfer":return"تحويل";case"deposit":return"إيداع";default:return"معاملة"}},j=t=>{switch(t){case"completed":return"مكتملة";case"pending":return"قيد الانتظار";case"failed":return"فاشلة";default:return"غير محدد"}};return e.jsx(Ne,{open:V,onOpenChange:U,children:e.jsxs(ve,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(we,{className:"pb-4",children:e.jsxs(be,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Pe,{className:"h-5 w-5"}),"تفاصيل المحفظة: ",o.name,o.isDefault&&e.jsxs(ae,{variant:"default",className:"mr-2",children:[e.jsx(Fe,{className:"h-3 w-3 mr-1"}),"افتراضية"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsxs(Y,{children:[e.jsx(re,{children:e.jsxs(ne,{className:"text-sm flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"المعلومات الأساسية"]})}),e.jsxs($,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(he,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-mono",children:o.phone})]}),o.nationalId&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ye,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-mono",children:o.nationalId})]}),p&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ze,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:p.name})]}),e.jsxs("div",{className:"text-xs text-gray-600 pr-6",children:[e.jsxs("div",{children:["المالك: ",p.ownerName]}),e.jsxs("div",{className:"font-mono",children:["الرقم القومي: ",p.nationalId]})]})]}),o.lastResetDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(hs,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:["آخر إعادة تعيين: ",new Date(o.lastResetDate).toLocaleDateString("ar-EG")]})]})]})]}),e.jsxs(Y,{children:[e.jsx(re,{children:e.jsxs(ne,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4"}),"حدود الاستخدام الشهري"]})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-3 w-3 text-red-500"}),"السحب الشهري"]}),e.jsxs("span",{className:"font-mono",children:[y(o.monthlyWithdrawalUsage||0)," / ",y(o.monthlyWithdrawalLimit)]})]}),e.jsx(De,{value:u,className:"h-2"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["متبقي: ",y(o.monthlyWithdrawalLimit-(o.monthlyWithdrawalUsage||0))," جنيه"]})]}),e.jsx(ms,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3 text-green-500"}),"التحويل الشهري"]}),e.jsxs("span",{className:"font-mono",children:[y(o.monthlyTransferUsage||0)," / ",y(o.monthlyTransferLimit)]})]}),e.jsx(De,{value:v,className:"h-2"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["متبقي: ",y(o.monthlyTransferLimit-(o.monthlyTransferUsage||0))," جنيه"]})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(Y,{children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(me,{className:"h-5 w-5 text-red-500"})}),e.jsx("div",{className:"text-lg font-bold",children:y(H)}),e.jsx("div",{className:"text-xs text-gray-600",children:"إجمالي السحب"})]})}),e.jsx(Y,{children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(de,{className:"h-5 w-5 text-blue-500"})}),e.jsx("div",{className:"text-lg font-bold",children:y(a)}),e.jsx("div",{className:"text-xs text-gray-600",children:"إجمالي التحويل"})]})}),e.jsx(Y,{children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(xe,{className:"h-5 w-5 text-green-500"})}),e.jsx("div",{className:"text-lg font-bold",children:y(c)}),e.jsx("div",{className:"text-xs text-gray-600",children:"إجمالي الإيداع"})]})}),e.jsx(Y,{children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(Ue,{className:"h-5 w-5 text-emerald-600"})}),e.jsx("div",{className:"text-lg font-bold",children:y(x)}),e.jsx("div",{className:"text-xs text-gray-600",children:"أرباح الفترة"})]})}),e.jsx(Y,{children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(oe,{className:"h-5 w-5 text-purple-600"})}),e.jsx("div",{className:"text-lg font-bold",children:y(T)}),e.jsx("div",{className:"text-xs text-gray-600",children:"عدد العمليات"})]})})]}),e.jsxs(Y,{children:[e.jsx(re,{children:e.jsxs(ne,{className:"text-sm flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"سجل المعاملات"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{size:"sm",variant:C==="week"?"default":"outline",onClick:()=>F("week"),className:"text-xs",children:"أسبوع"}),e.jsx(I,{size:"sm",variant:C==="month"?"default":"outline",onClick:()=>F("month"),className:"text-xs",children:"شهر"}),e.jsx(I,{size:"sm",variant:C==="all"?"default":"outline",onClick:()=>F("all"),className:"text-xs",children:"الكل"})]})]})}),e.jsx($,{children:b?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"جاري تحميل المعاملات..."})]})}):P.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(oe,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"لا توجد معاملات في هذه الفترة"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:P.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[R(t.type),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:[g(t.type)," - ",y(t.amount)," جنيه"]}),e.jsx("div",{className:"text-xs text-gray-600",children:O(t.createdAt)}),t.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:t.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i(t.status),e.jsx("span",{className:"text-xs",children:j(t.status)})]})]},t.id))})})]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsxs(I,{onClick:f,variant:"outline",children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"العودة للمحافظ"]}),e.jsx(I,{onClick:U,variant:"outline",children:"إغلاق"})]})]})})},ke=[{id:"vodafone",name:"فودافون كاش"},{id:"etisalat",name:"اتصالات كاش"},{id:"orange",name:"أورنج كاش"},{id:"we_pay",name:"وي باي"},{id:"smart_wallet",name:"سمارت ولت"},{id:"access_pay",name:"أكسس باي"},{id:"insta_pay",name:"انستا باي"}],zs=({isOpen:o,onClose:V,onWalletUpdate:U,initialEditingWallet:f,autoStartAdd:k})=>{const{toast:L}=je(),{user:l,userSubscription:b}=pe();(()=>{var m,W;const s=((m=b==null?void 0:b.subscription)==null?void 0:m.planType)??((W=b==null?void 0:b.subscription)==null?void 0:W.plan)??(b==null?void 0:b.planType)??(b==null?void 0:b.plan)??null,n=typeof s=="string"?String(s).trim().toLowerCase():null;return s===Ze.TAHWEELA||n==="tahweela"||n==="تحويله"})(),es();const[M,C]=d.useState([]),[F,z]=d.useState(!1),[S,B]=d.useState(null),[y,O]=d.useState(""),[G,P]=d.useState(""),[J,E]=d.useState(""),[H,a]=d.useState(""),[c,N]=d.useState(""),[T,x]=d.useState("200000"),[p,u]=d.useState("200000"),[v,R]=d.useState("100000"),[i,g]=d.useState("60000"),[j,t]=d.useState(""),[r,w]=d.useState(""),[te,Q]=d.useState(!1),[vs,ws]=d.useState(null),[bs,Z]=d.useState(!1),[Oe,ie]=d.useState(!1),[Ye,ue]=d.useState(!1),[Ie,ge]=d.useState(null),le=()=>`wallets_${(l==null?void 0:l.uid)||"default"}`;d.useEffect(()=>{f&&(B(f),z(!0),O(f.name||""),P(f.phone||""),E(f.ownerName||""),a(f.nationalId||""),N(f.walletProvider||""),x((f.monthlyWithdrawalLimit||2e5).toString()),u((f.monthlyTransferLimit||2e5).toString()),R((f.dailyWithdrawalLimit||1e5).toString()),g((f.dailyTransferLimit||6e4).toString()),t(f.defaultTransferCommission!=null?String(f.defaultTransferCommission):""),w(f.defaultWithdrawCommission!=null?String(f.defaultWithdrawCommission):""),Q(!!f.isDefault))},[f]);const $e=s=>{const n=new Date,m=n.getMonth(),W=n.getFullYear();if(!s.lastResetDate)return{...s,monthlyWithdrawalUsage:s.monthlyWithdrawalUsage||0,monthlyTransferUsage:s.monthlyTransferUsage||0,lastResetDate:n.toISOString().split("T")[0]};const _=new Date(s.lastResetDate),q=_.getMonth(),ee=_.getFullYear();return m!==q||W!==ee?{...s,monthlyWithdrawalUsage:0,monthlyTransferUsage:0,lastResetDate:n.toISOString().split("T")[0]}:s},Be=async(s,n)=>{const m=new Date().getMonth(),W=new Date().getFullYear(),_=n.filter(D=>{const h=new Date(D.createdAt);return h.getMonth()===m&&h.getFullYear()===W&&D.lineId===s}),q=_.filter(D=>D.txnType==="receive").reduce((D,h)=>D+(h.amount||0),0),ee=_.filter(D=>D.txnType==="send").reduce((D,h)=>D+(h.amount||0),0);return{withdrawalUsage:q,transferUsage:ee}},Ee=async(s,n)=>{const m=new Date,W=m.getDate(),_=m.getMonth(),q=m.getFullYear(),ee=n.filter(A=>{const K=new Date(A.createdAt);return K.getDate()===W&&K.getMonth()===_&&K.getFullYear()===q&&A.lineId===s}),D=ee.filter(A=>A.txnType==="receive").reduce((A,K)=>A+(K.amount||0),0),h=ee.filter(A=>A.txnType==="send").reduce((A,K)=>A+(K.amount||0),0);return{withdrawalUsage:D,transferUsage:h}};d.useEffect(()=>{(async()=>{if(!(l!=null&&l.uid)){console.log("No user authenticated, skipping wallet loading"),Z(!1);return}console.log("Loading wallets for user:",l.uid),Z(!0);try{const{auth:n}=await ns(async()=>{const{auth:h}=await import("./index-DhbnydJl.js").then(A=>A.cQ);return{auth:h}},__vite__mapDeps([0,1]),import.meta.url);let m=0;const W=5;for(;!n.currentUser&&m<W;)console.log(`Waiting for auth state... attempt ${m+1}`),await new Promise(h=>setTimeout(h,1e3)),m++;if(!n.currentUser)throw console.error("User not authenticated in Firebase Auth after retries"),new Error("not authenticated");console.log("Firebase Auth User:",n.currentUser.uid),console.log("Context User:",l.uid),console.log("Fetching wallets from Firebase...");const _=await se.getByMerchantId(l.uid);console.log("Fetched wallets:",_),console.log("Fetching transactions from Firebase...");const q=await Te.getByUserId(l.uid);console.log("Fetched transactions:",q);const D=(await Promise.all(_.map(async h=>{const{withdrawalUsage:A,transferUsage:K}=await Be(h.id,q),{withdrawalUsage:He,transferUsage:qe}=await Ee(h.id,q);return{id:h.id,name:h.label||"محفظة بدون اسم",phone:h.msisdn,ownerName:h.ownerName,nationalId:h.nationalId,isDefault:!1,monthlyWithdrawalLimit:h.withdrawLimit||2e5,monthlyTransferLimit:h.transferLimit||2e5,dailyWithdrawalLimit:h.dailyWithdrawLimit||1e5,dailyTransferLimit:h.dailyTransferLimit||6e4,monthlyWithdrawalUsage:A,monthlyTransferUsage:K,dailyWithdrawalUsage:He,dailyTransferUsage:qe,lastResetDate:new Date().toISOString().split("T")[0],defaultTransferCommission:h.defaultTransferCommission!=null?Number(h.defaultTransferCommission):null,defaultWithdrawCommission:h.defaultWithdrawCommission!=null?Number(h.defaultWithdrawCommission):null}}))).map($e);C(D),console.log("Wallets loaded successfully:",D)}catch(n){console.error("Error loading wallets:",n),C([])}finally{Z(!1)}})()},[l==null?void 0:l.uid]);const Le=()=>{O(""),P(""),E(""),a(""),N(""),x("200000"),u("200000"),R("100000"),g("60000"),t(""),w(""),Q(!1),B(null),z(!1)},We=()=>{O(""),P(""),E(""),a(""),N(""),x("200000"),u("200000"),R("100000"),g("60000"),t(""),w(""),Q(!1),B(null),z(!0)};d.useEffect(()=>{o&&k&&!F&&!S&&We()},[o,k,F,S]);const Ve=async()=>{if(!y.trim()||!G.trim()||!c.trim()){L({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}if(!(l!=null&&l.uid)){L({title:"خطأ",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}Z(!0);try{if(S){await se.update(S.id,{label:y.trim(),msisdn:G.trim(),ownerName:J.trim(),nationalId:H.trim(),withdrawLimit:parseInt(T),transferLimit:parseInt(p),dailyWithdrawLimit:parseInt(v),dailyTransferLimit:parseInt(i),defaultTransferCommission:j!=null&&j.trim()!==""?parseFloat(j):null,defaultWithdrawCommission:r!=null&&r.trim()!==""?parseFloat(r):null}),await fe.setLimits(S.id,{dailyTransferLimit:parseInt(i||"0"),dailyWithdrawLimit:parseInt(v||"0"),monthlyTransferLimit:parseInt(p||"0"),monthlyWithdrawLimit:parseInt(T||"0")});const s=M.map(n=>n.id===S.id?{...n,name:y.trim(),phone:G.trim(),ownerName:J.trim(),nationalId:H.trim(),walletProvider:c,monthlyWithdrawalLimit:parseInt(T),monthlyTransferLimit:parseInt(p),dailyWithdrawalLimit:parseInt(v),dailyTransferLimit:parseInt(i),defaultTransferCommission:j!=null&&j.trim()!==""?parseFloat(j):null,defaultWithdrawCommission:r!=null&&r.trim()!==""?parseFloat(r):null}:n);C(s),localStorage.setItem(le(),JSON.stringify(s)),L({title:"تم التحديث",description:"تم تحديث المحفظة بنجاح"})}else{const s={merchantUserId:l.uid,provider:c,msisdn:G.trim(),label:y.trim(),ownerName:J.trim(),nationalId:H.trim(),isActive:!0,dailyLimit:2e5,monthlyLimit:2e5,withdrawLimit:parseInt(T),transferLimit:parseInt(p),dailyTransferLimit:parseInt(i),dailyWithdrawLimit:parseInt(v),dailyUsage:0,monthlyUsage:0,transferUsage:0,withdrawUsage:0,defaultTransferCommission:j!=null&&j.trim()!==""?parseFloat(j):null,defaultWithdrawCommission:r!=null&&r.trim()!==""?parseFloat(r):null},n=await se.create(s);await fe.setLimits(n,{dailyTransferLimit:parseInt(i||"0"),dailyWithdrawLimit:parseInt(v||"0"),monthlyTransferLimit:parseInt(p||"0"),monthlyWithdrawLimit:parseInt(T||"0")});const m=new Date().toISOString().split("T")[0],W={id:n,name:y.trim(),phone:G.trim(),ownerName:J.trim(),nationalId:H.trim(),walletProvider:c,isDefault:te,monthlyWithdrawalLimit:parseInt(T),monthlyTransferLimit:parseInt(p),dailyWithdrawalLimit:parseInt(v),dailyTransferLimit:parseInt(i),monthlyWithdrawalUsage:0,monthlyTransferUsage:0,dailyWithdrawalUsage:0,dailyTransferUsage:0,lastResetDate:m,defaultTransferCommission:j!=null&&j.trim()!==""?parseFloat(j):null,defaultWithdrawCommission:r!=null&&r.trim()!==""?parseFloat(r):null},_=[...M,W];C(_),localStorage.setItem(le(),JSON.stringify(_)),L({title:"تم الإنشاء",description:"تم إنشاء المحفظة بنجاح"})}U&&U(),Le(),z(!1),B(null)}catch(s){console.error("Error saving wallet:",s),L({title:"خطأ",description:"حدث خطأ أثناء حفظ المحفظة",variant:"destructive"})}finally{Z(!1)}},Se=s=>{B(s),O(s.name),P(s.phone),E(s.ownerName||""),a(s.nationalId||""),N(s.walletProvider||""),x(s.monthlyWithdrawalLimit.toString()),u(s.monthlyTransferLimit.toString()),Q(s.isDefault),z(!0)},Ge=async s=>{const n=M.find(m=>m.id===s);if(n!=null&&n.isDefault){L({title:"تحذير",description:"لا يمكن حذف المحفظة الافتراضية",variant:"destructive"});return}if(!(l!=null&&l.uid)){L({title:"خطأ",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}Z(!0);try{await se.delete(s);const m=M.filter(W=>W.id!==s);C(m),localStorage.setItem(le(),JSON.stringify(m)),U&&U(),L({title:"تم الحذف",description:"تم حذف المحفظة بنجاح"})}catch(m){console.error("Error deleting wallet:",m),L({title:"خطأ",description:"حدث خطأ أثناء حذف المحفظة",variant:"destructive"})}finally{Z(!1)}},Je=s=>{const n=M.map(m=>({...m,isDefault:m.id===s}));C(n),localStorage.setItem(le(),JSON.stringify(n)),U&&U(),L({title:"تم تحديث المحفظة الافتراضية",description:"تم تعيين المحفظة كافتراضية بنجاح"})};return e.jsxs(Ne,{open:o,onOpenChange:V,children:[e.jsx(ve,{className:"sm:max-w-3xl w-[95vw] max-h-[80vh] overflow-hidden p-0 rounded-2xl shadow-[0_0_40px_rgba(15,23,42,0.35)]",children:e.jsxs("div",{className:"max-h-[80vh] overflow-y-auto scrollbar-hide",children:[e.jsx(we,{className:"px-4 pt-3 pb-2",children:e.jsxs(be,{className:"flex items-center gap-1 text-sm",children:[e.jsx(ce,{className:"h-3 w-3"}),"إدارة المحافظ"]})}),e.jsxs("div",{className:"space-y-3 px-4 pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-sm font-semibold",children:["المحافظ المتاحة (",M.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(I,{onClick:()=>{ue(!0)},className:"flex items-center gap-1 h-6 px-2 text-xs",size:"sm",variant:"outline",children:[e.jsx(ss,{className:"h-3 w-3"}),"الاطلاع على المحافظ"]}),e.jsxs(I,{onClick:()=>{We()},className:"flex items-center gap-1 h-6 px-2 text-xs",size:"sm",children:[e.jsx(ts,{className:"h-3 w-3"}),"إضافة محفظة جديدة"]})]})]}),(F||S)&&e.jsxs(Y,{className:"border-0 bg-gradient-to-b from-blue-50/70 via-white to-white rounded-2xl shadow-md",children:[e.jsx(re,{className:"pb-3 border-b border-blue-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-blue-600 text-white flex items-center justify-center",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(ne,{className:"text-sm font-semibold text-gray-800",children:S?"تعديل المحفظة":"إضافة محفظة جديدة"}),e.jsx("span",{className:"text-[11px] text-gray-500",children:"اربط بيانات المحفظة بالحدود اليومية والشهرية بسهولة"})]})]}),S&&e.jsx(ae,{variant:"outline",className:"text-[10px] px-2 py-0.5 border-blue-200 text-blue-700 bg-blue-50",children:"وضع التعديل"})]})}),e.jsxs($,{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2 bg-white/70 rounded-xl border border-gray-100 px-3 py-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"شركة المحفظة"}),e.jsx("div",{className:"flex gap-1 items-center",children:e.jsxs(is,{value:c,onValueChange:N,children:[e.jsx(ls,{className:"h-8 text-xs flex-1 bg-gray-50",children:e.jsx(cs,{placeholder:"اختر شركة المحفظة"})}),e.jsx(os,{children:ke.map(s=>e.jsx(ds,{value:s.id,className:"text-xs",children:e.jsx("div",{className:"flex items-center justify-between w-full",children:e.jsx("span",{children:s.name})})},s.id))})]})})]}),e.jsxs("div",{className:"space-y-2 bg-white/70 rounded-xl border border-gray-100 px-3 py-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"اسم المحفظة"}),e.jsx(X,{value:y,onChange:s=>O(s.target.value),placeholder:"مثال: محفظة العمل",className:"h-8 text-xs bg-gray-50"})]})]}),e.jsxs("div",{className:"space-y-2 bg-white/70 rounded-xl border border-gray-100 px-3 py-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(X,{value:G,onChange:s=>P(s.target.value),placeholder:"أدخل رقم المحفظة",className:"pl-6 h-8 text-xs bg-gray-50"})]})]}),e.jsxs("div",{className:"bg-white/70 rounded-xl border border-gray-100 px-3 py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-800",children:"الحدود الشهرية واليومية"}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"اضبط حدود السحب والتحويل"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block text-right",children:"الحد الشهري للسحب (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(X,{type:"number",value:T,onChange:s=>x(s.target.value),placeholder:"200000",className:"pl-6 pr-2 h-6 text-xs text-right"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block text-right",children:"الحد الشهري للتحويل (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(X,{type:"number",value:p,onChange:s=>u(s.target.value),placeholder:"200000",className:"pl-6 pr-2 h-6 text-xs text-right"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block text-right",children:"الحد اليومي للسحب (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-red-400"}),e.jsx(X,{type:"number",value:v,onChange:s=>R(s.target.value),placeholder:"100000",className:"pl-6 pr-2 h-6 text-xs text-right"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block text-right",children:"الحد اليومي للتحويل (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-blue-400"}),e.jsx(X,{type:"number",value:i,onChange:s=>g(s.target.value),placeholder:"60000",className:"pl-6 pr-2 h-6 text-xs text-right"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("input",{type:"checkbox",id:"isDefault",checked:te,onChange:s=>Q(s.target.checked),className:"rounded w-3 h-3"}),e.jsx("label",{htmlFor:"isDefault",className:"text-xs font-medium text-gray-700",children:"تعيين كمحفظة افتراضية"})]}),e.jsxs("div",{className:"mt-3 bg-white/70 rounded-xl border border-gray-100 px-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(as,{className:"h-3 w-3 text-gray-600"}),e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"إعدادات العمولة الافتراضية"})]}),e.jsx("p",{className:"text-[10px] text-gray-500 mb-2",children:"يمكنك ترك قيم العمولات فارغة لإدخال العمولة يدويًا أثناء العملية، أو تحديدها هنا لتُستخدم تلقائيًا كمبلغ افتراضي."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"عمولة التحويل الافتراضية (جنيه)"}),e.jsx(X,{type:"number",step:"0.01",min:"0",value:j,onChange:s=>t(s.target.value),placeholder:"مثال: 5",className:"h-6 text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"عمولة السحب الافتراضية (جنيه)"}),e.jsx(X,{type:"number",step:"0.01",min:"0",value:r,onChange:s=>w(s.target.value),placeholder:"مثال: 5",className:"h-6 text-xs"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-3",children:[e.jsx(I,{onClick:Ve,className:"w-full h-9 text-xs bg-blue-600 hover:bg-blue-700 text-white",size:"sm",children:S?"تحديث المحفظة":"إضافة المحفظة"}),e.jsx(I,{variant:"outline",onClick:()=>{Le(),V()},className:"w-full h-9 text-xs bg-white border border-gray-300 hover:bg-gray-50",size:"sm",children:"إغلاق"})]})]})]}),!F&&!S&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:M.map(s=>{var n;return e.jsxs(Y,{className:`${s.isDefault?"border-green-300 bg-green-50":""}`,children:[e.jsx(re,{className:"pb-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ne,{className:"text-sm flex items-center gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),s.name]}),s.isDefault&&e.jsx(ae,{variant:"default",className:"bg-green-600 text-xs px-1 py-0",children:"افتراضية"})]})}),e.jsxs($,{className:"space-y-1 pt-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"text-xs",children:s.phone})]}),s.walletProvider&&e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:((n=ke.find(m=>m.id===s.walletProvider))==null?void 0:n.name)||s.walletProvider}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"الحدود الشهرية"}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-red-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((s.monthlyWithdrawalUsage||0)/s.monthlyWithdrawalLimit*100,100)}%`}})}),e.jsx("div",{className:"w-1/2 bg-blue-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((s.monthlyTransferUsage||0)/s.monthlyTransferLimit*100,100)}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-0.5",children:[e.jsxs("div",{className:"text-xs text-red-600 font-medium",children:["متبقي سحب: ",Math.max(s.monthlyWithdrawalLimit-(s.monthlyWithdrawalUsage||0),0)," جنيه"]}),e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["متبقي تحويل: ",Math.max(s.monthlyTransferLimit-(s.monthlyTransferUsage||0),0)," جنيه"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"الحدود اليومية"}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-orange-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-orange-400 to-orange-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((s.dailyWithdrawalUsage||0)/s.dailyWithdrawalLimit*100,100)}%`}})}),e.jsx("div",{className:"w-1/2 bg-green-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-green-400 to-green-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((s.dailyTransferUsage||0)/s.dailyTransferLimit*100,100)}%`}})})]}),e.jsxs("div",{className:"flex justify بين items-center mt-0.5",children:[e.jsxs("div",{className:"text-xs text-orange-600 font-medium",children:["متبقي سحب يومي: ",Math.max(s.dailyWithdrawalLimit-(s.dailyWithdrawalUsage||0),0)," جنيه"]}),e.jsxs("div",{className:"text-xs text-green-600 font-medium",children:["متبقي تحويل يومي: ",Math.max(s.dailyTransferLimit-(s.dailyTransferUsage||0),0)," جنيه"]})]})]})]}),e.jsxs("div",{className:"flex gap-1 pt-1",children:[e.jsxs(I,{size:"sm",variant:"outline",onClick:()=>Se(s),className:"flex-1 h-5 text-xs px-1",children:[e.jsx(_e,{className:"h-2 w-2 mr-0.5"}),"تعديل"]}),!s.isDefault&&e.jsxs(e.Fragment,{children:[e.jsx(I,{size:"sm",variant:"outline",onClick:()=>Je(s.id),className:"flex-1 h-5 text-xs px-1",children:"جعلها افتراضية"}),e.jsx(I,{size:"sm",variant:"destructive",onClick:()=>Ge(s.id),className:"h-5 px-1",children:e.jsx(Ae,{className:"h-2 w-2"})})]})]})]})]},s.id)})}),!F&&!S&&M.length===0&&e.jsx("div",{className:"text-center py-4 text-gray-500 text-xs",children:"لا توجد محافظ متاحة. قم بإضافة محفظة جديدة للبدء."})]})]})}),e.jsx(rs,{open:Ye,onOpenChange:ue,mode:"verify",title:"إدخال الرقم السري الرئيسي",description:"لا يمكن الاطلاع على المحافظ إلا بإدخال الرقم السري الرئيسي",userId:l==null?void 0:l.uid,onSuccess:()=>{ue(!1),ie(!0)}}),e.jsx(ps,{isOpen:Oe,onClose:()=>ie(!1),onWalletSelect:s=>{ge(s),ie(!1)},onEditWallet:s=>{Se(s),ie(!1)},onDeleteWallet:async s=>{try{if(await se.delete(s),C(n=>{const m=n.filter(W=>W.id!==s);try{localStorage.setItem(le(),JSON.stringify(m))}catch(W){console.error("Failed to update localStorage wallets after delete:",W)}return m}),U)try{await U()}catch(n){console.error("onWalletUpdate callback failed:",n)}}catch(n){console.error("Error deleting wallet:",n)}}}),e.jsx(Ns,{wallet:Ie,isOpen:!!Ie,onClose:()=>ge(null),onBack:()=>{ge(null),ie(!0)}})]})};export{zs as default};
//# sourceMappingURL=WalletManagement-lpVl8Tb_.js.map
