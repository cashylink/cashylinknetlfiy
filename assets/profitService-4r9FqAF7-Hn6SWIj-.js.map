{"version":3,"file":"profitService-4r9FqAF7-Hn6SWIj-.js","sources":["../../assets/profitService-4r9FqAF7.js"],"sourcesContent":["var F=Object.defineProperty;var M=(m,t,e)=>t in m?F(m,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[t]=e;var S=(m,t,e)=>M(m,typeof t!=\"symbol\"?t+\"\":t,e);import{a0 as n,a1 as D}from\"./index-tnWDkOuX.js\";class _{static getProfitPinKey(t){return t?`${this.PROFIT_PIN_KEY_BASE}_${t}`:this.PROFIT_PIN_KEY_BASE}static getMasterPinKey(t){return t?`${this.MASTER_PIN_KEY_BASE}_${t}`:this.MASTER_PIN_KEY_BASE}static setProfitPin(t,e){console.warn(\"setProfitPin is deprecated. Using master PIN instead.\")}static hasProfitPin(t){try{const e=localStorage.getItem(this.getMasterPinKey(t));return!!e&&e.length>0}catch{return!1}}static verifyProfitPin(t,e){try{const o=localStorage.getItem(this.getMasterPinKey(e));return o?atob(o)===t:!1}catch{return!1}}static getProfitData(t){n.autoResetReportsIfNeeded(t);const e=n.getProfits(t),o=this.getWithdrawTransferProfits(t);return{dailyProfit:e.dailyProfit,monthlyProfit:e.monthlyProfit,dailyWithdrawProfit:o.dailyWithdrawProfit,monthlyWithdrawProfit:o.monthlyWithdrawProfit,dailyTransferProfit:o.dailyTransferProfit,monthlyTransferProfit:o.monthlyTransferProfit,lastUpdated:new Date}}static addProfit(t,e){n.addProfit(t,\"daily\",e),n.addProfit(t,\"monthly\",e)}static calculateProfitFromTransaction(t){return n.calculateTransactionProfit(t)}static resetProfits(t,e,o){if(!this.verifyProfitPin(e,o))return!1;const c=o?`reportsData_${o}`:\"reportsData\",s=n.getReportsData(o);if(t===\"daily\"?(s.dailyProfit=0,s.lastDailyProfitResetDate=new Date):(s.monthlyProfit=0,s.lastMonthlyProfitResetDate=new Date),localStorage.setItem(c,JSON.stringify(s)),o)try{D.updateUserData(o,{reportsData:{...s}})}catch(y){console.warn(\"تعذر مزامنة تصفير الأرباح مع Firebase:\",y)}return!0}static clearProfitPin(t){localStorage.removeItem(this.getProfitPinKey(t))}static updateProfitsFromTransactions(t,e){const o=e?`reportsData_${e}`:\"reportsData\",c=n.getReportsData(e);let s=0,y=0;const P=new Date,w=P.getMonth(),T=P.getFullYear(),g=n.filterVisibleTransactions(t,\"daily\",e),u=n.filterVisibleTransactions(t,\"monthly\",e);if(g.forEach(r=>{const i=String(r.type||r.txnType||\"\").toLowerCase(),h=String(r.title||\"\");if(i===\"cash_addition\"||h.includes(\"إيصال إضافة نقدية\"))return;const f=new Date(r.createdAt);if(String(r.status||\"confirmed\").toLowerCase(),f.toDateString()!==P.toDateString())return;const l=String(r.type||r.txnType||\"\").toLowerCase(),p={type:l===\"withdrawal\"?\"withdraw\":l,amount:Number(r.amount||0),commission:r.commission};s+=this.calculateProfitFromTransaction(p)}),u.forEach(r=>{const i=String(r.type||r.txnType||\"\").toLowerCase(),h=String(r.title||\"\");if(i===\"cash_addition\"||h.includes(\"إيصال إضافة نقدية\"))return;const f=new Date(r.createdAt);if(String(r.status||\"confirmed\").toLowerCase(),f.getMonth()!==w||f.getFullYear()!==T)return;const l=String(r.type||r.txnType||\"\").toLowerCase(),p={type:l===\"withdrawal\"?\"withdraw\":l,amount:Number(r.amount||0),commission:r.commission};y+=this.calculateProfitFromTransaction(p)}),c.dailyProfit=Math.round(s*100)/100,c.monthlyProfit=Math.round(y*100)/100,localStorage.setItem(o,JSON.stringify(c)),e)try{D.updateUserData(e,{reportsData:{...c}})}catch(r){console.warn(\"تعذر مزامنة تحديث الأرباح من المعاملات مع Firebase:\",r)}}static getWithdrawTransferProfits(t){n.getReportsData(t);const e=new Date,o=e.getMonth(),c=e.getFullYear(),s=`transactions_${t||\"default\"}`,y=JSON.parse(localStorage.getItem(s)||\"[]\");let P=0,w=0,T=0,g=0;const u=n.filterVisibleTransactions(y,\"daily\",t),r=n.filterVisibleTransactions(y,\"monthly\",t);return u.forEach(i=>{const h=String(i.type||i.txnType||\"\").toLowerCase(),f=String(i.title||\"\");if(h===\"cash_addition\"||f.includes(\"إيصال إضافة نقدية\"))return;const l=new Date(i.createdAt);if(String(i.status||\"confirmed\").toLowerCase(),l.toDateString()!==e.toDateString())return;const d=String(i.type||i.txnType||\"\").toLowerCase(),a={type:d===\"withdrawal\"?\"withdraw\":d,amount:Number(i.amount||0),commission:i.commission};a.type===\"withdraw\"?P+=this.calculateProfitFromTransaction(a):(a.type===\"receive\"||a.type===\"send\"||a.type===\"transfer\")&&(T+=this.calculateProfitFromTransaction(a))}),r.forEach(i=>{const h=String(i.type||i.txnType||\"\").toLowerCase(),f=String(i.title||\"\");if(h===\"cash_addition\"||f.includes(\"إيصال إضافة نقدية\"))return;const l=new Date(i.createdAt);if(String(i.status||\"confirmed\").toLowerCase(),l.getMonth()!==o||l.getFullYear()!==c)return;const d=String(i.type||i.txnType||\"\").toLowerCase(),a={type:d===\"withdrawal\"?\"withdraw\":d,amount:Number(i.amount||0),commission:i.commission};a.type===\"withdraw\"?w+=this.calculateProfitFromTransaction(a):(a.type===\"receive\"||a.type===\"send\"||a.type===\"transfer\")&&(g+=this.calculateProfitFromTransaction(a))}),{dailyWithdrawProfit:Math.round(P*100)/100,monthlyWithdrawProfit:Math.round(w*100)/100,dailyTransferProfit:Math.round(T*100)/100,monthlyTransferProfit:Math.round(g*100)/100}}}S(_,\"PROFIT_PIN_KEY_BASE\",\"profit_pin\"),S(_,\"MASTER_PIN_KEY_BASE\",\"master_pin\");export{_ as ProfitService};\r\n//# sourceMappingURL=profitService-4r9FqAF7.js.map\r\n"],"names":["F","M","m","S","o","n","c","D","P","w","T","g","u","i","f","l","p","d","a"],"mappings":"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"}