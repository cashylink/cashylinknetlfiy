import{a as A,c as P,r as i,j as e,I as C,B as d,f as N}from"./index-ByNAQd9J.js";import{C as I,a as B,b as L,d as U}from"./card-DkkzKPOG.js";import{S as z,a as D,b as G,c as J,d as W}from"./select-C6YIhHRk.js";const q=[{label:"Vodafone",value:"Vodafone"},{label:"Orange",value:"Orange"},{label:"Etisalat",value:"Etisalat"},{label:"WE",value:"WE"}],y=u=>{const a=u.replace(/\D/g,"");return a.length===10||a.length===11},$=()=>{const u=A(),{toast:a}=P(),[l,S]=i.useState(""),[w,F]=i.useState("EG"),[h,T]=i.useState("Vodafone"),[o,E]=i.useState(""),[c,x]=i.useState(!1),[k,m]=i.useState(!1),X=async t=>{if(t.preventDefault(),!y(l)){a({title:"رقم غير صالح",description:"من فضلك أدخل رقم مصري صحيح (10 أو 11 رقم)",variant:"destructive"});return}const n=Number(o);if(!Number.isFinite(n)||n<=0){a({title:"قيمة غير صالحة",description:"من فضلك أدخل مبلغ صحيح بالجنيه المصري",variant:"destructive"});return}m(!0)},O=async()=>{var p,g,b;m(!1);const t="alkaptin678678@gmail.com",n=(g=(p=N.currentUser)==null?void 0:p.email)==null?void 0:g.toLowerCase();if(!n||n!==t){a({title:"قيد الإنشاء",description:"ميزة الشحن متاحة لهذا الحساب فقط حالياً."});return}x(!0);try{const r=new AbortController,V=setTimeout(()=>r.abort(),15e3),f=await((b=N.currentUser)==null?void 0:b.getIdToken()),j=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...f?{Authorization:`Bearer ${f}`}:{}},body:JSON.stringify({phone:l,countryCode:w,operator:h,amount:Number(o),useLocalAmount:!0}),signal:r.signal});clearTimeout(V);const v=await j.text();let s;try{s=JSON.parse(v)}catch{s={success:!1,message:v||"فشل قراءة استجابة الخادم"}}j.ok&&(s!=null&&s.success)?a({title:"تم الشحن",description:(s==null?void 0:s.message)||"تم تنفيذ عملية الشحن بنجاح"}):a({title:"فشل الشحن",description:(s==null?void 0:s.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(r){console.error("Topup request error:",r),(r==null?void 0:r.name)==="AbortError"?a({title:"انتهت المهلة",description:"الخادم لم يستجب في الوقت المحدد. تأكد أن السيرفر يعمل.",variant:"destructive"}):a({title:"خطأ في الاتصال",description:"تعذر الاتصال بالخادم. حاول لاحقاً.",variant:"destructive"})}finally{x(!1)}};return e.jsxs("div",{className:"min-h-screen p-4",children:[e.jsxs(I,{className:"max-w-md mx-auto",children:[e.jsx(B,{children:e.jsx(L,{className:"text-right",children:"شحن رصيد الموبايل"})}),e.jsx(U,{children:e.jsxs("form",{onSubmit:X,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-right mb-1",children:"رقم الموبايل"}),e.jsx(C,{value:l,onChange:t=>S(t.target.value),placeholder:"01XXXXXXXXX",dir:"ltr"}),!y(l)&&l.length>0&&e.jsx("p",{className:"text-xs text-red-600 mt-1 text-right",children:"رقم غير صالح (10 أو 11 رقم)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-right mb-1",children:"الشركة"}),e.jsxs(z,{value:h,onValueChange:T,children:[e.jsx(D,{className:"w-full",children:e.jsx(G,{placeholder:"اختر الشركة"})}),e.jsx(J,{children:q.map(t=>e.jsx(W,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-right mb-1",children:"المبلغ بالجنيه (EGP)"}),e.jsx(C,{type:"number",inputMode:"decimal",value:o,onChange:t=>E(t.target.value),placeholder:"مثال: 10",dir:"ltr"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>u(-1),children:"رجوع"}),e.jsx(d,{type:"submit",disabled:c,children:c?"جارٍ التنفيذ...":"شحن"})]})]})})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-[90%] max-w-md",children:[e.jsx("h2",{className:"text-lg font-semibold text-right mb-2",children:"تأكيد العملية"}),e.jsxs("p",{className:"text-right mb-4",children:["هتشحن رقم ",l," مبلغ ",o," جنيه — تأكيد؟"]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(d,{variant:"outline",onClick:()=>m(!1),children:"إلغاء"}),e.jsx(d,{onClick:O,disabled:c,children:c?"جارٍ التنفيذ...":"تأكيد"})]})]})})]})};export{$ as default};
//# sourceMappingURL=TopUpPage-BNKQ0vCC.js.map
