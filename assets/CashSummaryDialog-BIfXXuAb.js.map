{"version":3,"file":"CashSummaryDialog-BIfXXuAb.js","sources":["../../src/components/CashSummaryDialog.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { DollarSign, Package, ArrowRightLeft, BatteryCharging } from 'lucide-react';\r\nimport { db } from '@/firebase';\r\nimport { useShop } from '@/hooks/useShop';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { collection, getDocs, query, where, doc, updateDoc, getDoc, onSnapshot } from 'firebase/firestore';\r\nimport { reportsService } from '@/utils/reportsService';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\r\nimport { userDataService } from '@/integrations/firebase/services';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\n\r\ninterface CashSummaryDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  userId?: string | null;\r\n  cashBalance: number;\r\n  walletBalances: Record<string, number>;\r\n  transactions: any[];\r\n}\r\n\r\nexport const CashSummaryDialog: React.FC<CashSummaryDialogProps> = ({ open, onOpenChange, userId, cashBalance, walletBalances, transactions }) => {\r\n  const [accessorySalesToday, setAccessorySalesToday] = React.useState(0);\r\n  const [ackAccessoryToday, setAckAccessoryToday] = React.useState(0);\r\n  const [maintenanceTotalToday, setMaintenanceTotalToday] = React.useState(0);\r\n  const [ackMaintenanceToday, setAckMaintenanceToday] = React.useState(0);\r\n  const [machineChargingTotalToday, setMachineChargingTotalToday] = React.useState(0);\r\n  const [ackMachineChargingToday, setAckMachineChargingToday] = React.useState(0);\r\n  const [localCashBalance, setLocalCashBalance] = React.useState<number>(cashBalance || 0);\r\n  const [lastUpdate, setLastUpdate] = React.useState(0);\r\n  const [isReceiptPinOpen, setIsReceiptPinOpen] = React.useState(false);\r\n  const [pendingReceiptType, setPendingReceiptType] = React.useState<'accessory' | 'maintenance' | 'machineCharging' | null>(null);\r\n  const { toast } = useToast();\r\n  const { shopId: shopIdCtx } = useShop() || ({} as any);\r\n  const { profile } = useFirebaseAuth();\r\n  const [isDeductReasonOpen, setIsDeductReasonOpen] = React.useState(false);\r\n  const [deductReason, setDeductReason] = React.useState('');\r\n  const [isDeductPinOpen, setIsDeductPinOpen] = React.useState(false);\r\n  const [isDeductAmountOpen, setIsDeductAmountOpen] = React.useState(false);\r\n  const [deductAmount, setDeductAmount] = React.useState('');\r\n\r\n  const getCashBalanceKey = () => `cashBalance_${userId || 'default'}_${(shopIdCtx || (profile as any)?.shopId || 'main')}`;\r\n  const getGenericCashKey = () => `cashBalance_${userId || 'default'}`;\r\n\r\n  const formatCurrency = (n: number) => `${new Intl.NumberFormat('ar-EG').format(Number(n || 0))} جنيه`;\r\n\r\n  // 1. Setup real-time listener for Accessory Sales\r\n  React.useEffect(() => {\r\n    let unsubscribeAccessory: () => void | undefined;\r\n    \r\n    const setupListener = async () => {\r\n      if (!open || !userId) {\r\n        if (!open) setAccessorySalesToday(0);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const userDoc = await userDataService.getUserData(userId);\r\n        const lastReceiptStr = userDoc?.[`lastReceipt_accessory`];\r\n        const lastReceiptDate = lastReceiptStr ? new Date(lastReceiptStr) : new Date(0);\r\n        const lastReceiptDayStr = lastReceiptDate.toISOString().slice(0, 10);\r\n\r\n        const q = query(\r\n          collection(db, 'dailySales'),\r\n          where('userId', '==', userId),\r\n          ...(shopIdCtx ? [where('shopId', '==', shopIdCtx)] : []),\r\n          where('date', '>=', lastReceiptDayStr)\r\n        );\r\n\r\n        unsubscribeAccessory = onSnapshot(q, (snap) => {\r\n          let total = 0;\r\n          snap.forEach(docSnap => {\r\n            const d: any = docSnap.data();\r\n            if (d.isDeferred) return; \r\n            \r\n            let createdAt = 0;\r\n            if (d.createdAt?.toDate) createdAt = d.createdAt.toDate().getTime();\r\n            else if (d.createdAt instanceof Date) createdAt = d.createdAt.getTime();\r\n            else if (d.date) createdAt = new Date(d.date + 'T' + (d.time || '00:00')).getTime();\r\n\r\n            if (createdAt > lastReceiptDate.getTime()) {\r\n              const price = Number(d.sellingPrice ?? 0);\r\n              const qty = Number(d.quantity ?? 0);\r\n              if (price > 0 && qty > 0) {\r\n                total += price * qty;\r\n              }\r\n            }\r\n          });\r\n          setAccessorySalesToday(total);\r\n          setAckAccessoryToday(0);\r\n        }, (err) => {\r\n          console.warn('Error listening to daily sales:', err);\r\n        });\r\n      } catch (e) {\r\n        console.warn('Failed to setup accessory sales listener:', e);\r\n      }\r\n    };\r\n\r\n    setupListener();\r\n\r\n    return () => {\r\n      if (unsubscribeAccessory) unsubscribeAccessory();\r\n    };\r\n  }, [open, userId, shopIdCtx, lastUpdate]);\r\n\r\n  // 2. Load other data (Maintenance, Machine Charging, Receipts)\r\n  React.useEffect(() => {\r\n    if (!open) return;\r\n\r\n    const loadOtherData = async () => {\r\n      let userDoc: any = {};\r\n      try {\r\n         if (userId) userDoc = await userDataService.getUserData(userId) || {};\r\n      } catch {}\r\n\r\n      // Maintenance\r\n      const loadMaintenanceTotal = async () => {\r\n        try {\r\n          if (!userId) { setMaintenanceTotalToday(0); return; }\r\n          \r\n          const lastReceiptStr = userDoc?.[`lastReceipt_maintenance`];\r\n          const lastReceiptTime = lastReceiptStr ? new Date(lastReceiptStr).getTime() : 0;\r\n\r\n          let snap;\r\n          try {\r\n            const q = query(\r\n              collection(db, 'maintenance_items'),\r\n              where('userId', '==', userId),\r\n              where('status', '==', 'completed')\r\n            );\r\n            snap = await getDocs(q);\r\n          } catch (e) {\r\n            snap = await getDocs(query(collection(db, 'maintenance_items'), where('userId', '==', userId)));\r\n          }\r\n          let totalAmount = 0;\r\n          snap.forEach(docSnap => {\r\n            const d: any = docSnap.data();\r\n            if ((d.status || 'in_progress') !== 'completed') return;\r\n            const completedAt = d.completedAt?.toDate?.();\r\n            if (!completedAt) return;\r\n            if (completedAt.getTime() > lastReceiptTime) {\r\n              const repair = Number(d.repairPrice || 0);\r\n              if (Number.isFinite(repair) && repair > 0) totalAmount += repair;\r\n            }\r\n          });\r\n          setMaintenanceTotalToday(Math.max(0, totalAmount));\r\n          setAckMaintenanceToday(0);\r\n        } catch (e) {\r\n          console.warn('فشل تحميل إجمالي فلوس الصيانة لليوم:', e);\r\n        }\r\n      };\r\n\r\n      // Machine Charging\r\n      const calculateMachineChargingTotal = async () => {\r\n        try {\r\n            if (!userId) { setMachineChargingTotalToday(0); return; }\r\n            \r\n            const lastReceiptStr = userDoc?.[`lastReceipt_machineCharging`];\r\n            const lastReceiptTime = lastReceiptStr ? new Date(lastReceiptStr).getTime() : 0;\r\n\r\n            const q = query(\r\n              collection(db, 'userTransactions'),\r\n              where('userId', '==', userId)\r\n            );\r\n            const snap = await getDocs(q);\r\n            \r\n            let total = 0;\r\n            snap.forEach(d => {\r\n              const t: any = d.data();\r\n              let tTime = 0;\r\n              if (t.createdAt?.toDate) tTime = t.createdAt.toDate().getTime();\r\n              else if (typeof t.createdAt === 'string') tTime = new Date(t.createdAt).getTime();\r\n              \r\n              if (tTime <= lastReceiptTime) return;\r\n\r\n              const desc = String(t.description || '');\r\n              const rawTitle = String(t.title || '');\r\n              const isMachine = \r\n                t.title === 'إيصال تحويل مكينه' || \r\n                desc.includes('تحويل مكنه') || \r\n                desc.includes('تحويل مكينه') || \r\n                rawTitle.includes('تحويل مكنه') || \r\n                rawTitle.includes('تحويل مكينه');\r\n              \r\n              const isCompleted = t.status === 'completed' || t.status === 'confirmed';\r\n      \r\n              if (isMachine && isCompleted) {\r\n                total += (Number(t.amount) || 0);\r\n              }\r\n            });\r\n            setMachineChargingTotalToday(total);\r\n            setAckMachineChargingToday(0);\r\n        } catch (e) { console.warn(e); }\r\n      };\r\n\r\n      // Daily Receipts & Cash Balance\r\n      const loadDailyReceipts = async () => {\r\n        try {\r\n          if (!userId) { setAckAccessoryToday(0); return; }\r\n          \r\n          try {\r\n            const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n            const snap = await getDoc(doc(db, 'dashboardData', sid));\r\n            if (snap.exists()) {\r\n              const v = Number((snap.data() as any)?.cashBalance || 0);\r\n              setLocalCashBalance(v);\r\n              try { localStorage.setItem(`cashBalance_${userId}`, String(v)); localStorage.setItem(getCashBalanceKey(), String(v)); } catch {}\r\n            } else {\r\n              setLocalCashBalance(Number(userDoc?.cashBalance || cashBalance || 0));\r\n            }\r\n          } catch {\r\n            setLocalCashBalance(Number(userDoc?.cashBalance || cashBalance || 0));\r\n          }\r\n        } catch (e) {\r\n          setAckAccessoryToday(0);\r\n          setAckMaintenanceToday(0);\r\n          setAckMachineChargingToday(0);\r\n        }\r\n      };\r\n\r\n      await loadMaintenanceTotal();\r\n      await calculateMachineChargingTotal();\r\n      await loadDailyReceipts();\r\n    };\r\n\r\n    loadOtherData();\r\n  }, [open, userId, transactions, cashBalance, shopIdCtx, lastUpdate]);\r\n\r\n  React.useEffect(() => {\r\n    const handler = (e: any) => {\r\n      try {\r\n        const v = Number(e?.detail?.value);\r\n        if (Number.isFinite(v)) {\r\n          setLocalCashBalance(v);\r\n        }\r\n      } catch {}\r\n    };\r\n    window.addEventListener('cashBalanceChanged', handler as EventListener);\r\n    return () => window.removeEventListener('cashBalanceChanged', handler as EventListener);\r\n  }, [open]);\r\n\r\n  React.useEffect(() => {\r\n    if (!open || !userId) return;\r\n    const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n    // استبدال onSnapshot بـ getDoc لتقليل القراءات\r\n    const fetchDashboardData = async () => {\r\n      try {\r\n        const snap = await getDoc(doc(db, 'dashboardData', sid));\r\n        if (snap.exists()) {\r\n          const v = Number((snap.data() as any)?.cashBalance || 0);\r\n          setLocalCashBalance(v);\r\n          try { \r\n            localStorage.setItem(`cashBalance_${userId}`, String(v)); \r\n            localStorage.setItem(getCashBalanceKey(), String(v)); \r\n          } catch {}\r\n        }\r\n      } catch (e) {\r\n        console.warn('Error fetching dashboard data:', e);\r\n      }\r\n    };\r\n    \r\n    fetchDashboardData();\r\n    \r\n    return () => { };\r\n  }, [open, userId, shopIdCtx]);\r\n\r\n  const effectiveAccessoryToday = Math.max(0, Number(accessorySalesToday) - Number(ackAccessoryToday));\r\n  const effectiveMaintenanceToday = Math.max(0, Number(maintenanceTotalToday) - Number(ackMaintenanceToday));\r\n  const effectiveMachineChargingToday = Math.max(0, Number(machineChargingTotalToday) - Number(ackMachineChargingToday));\r\n\r\n  const handleReceipt = async (type: 'accessory' | 'maintenance' | 'machineCharging') => {\r\n    if (!userId) return;\r\n    const todayStr = new Date().toISOString().slice(0, 10);\r\n    try {\r\n      let amountToAck = 0;\r\n      if (type === 'accessory') amountToAck = effectiveAccessoryToday;\r\n      else if (type === 'maintenance') amountToAck = effectiveMaintenanceToday;\r\n      else if (type === 'machineCharging') amountToAck = effectiveMachineChargingToday;\r\n\r\n      if (amountToAck <= 0) {\r\n        toast({ title: 'لا يوجد مبلغ لتأكيد استلامه', variant: 'default' });\r\n        return;\r\n      }\r\n      const newCash = Math.max(0, Number(localCashBalance) - amountToAck);\r\n      setLocalCashBalance(newCash);\r\n      \r\n      const now = new Date().toISOString();\r\n      await userDataService.updateUserData(userId, {\r\n        cashBalance: newCash,\r\n        [`lastReceipt_${type}`]: now\r\n      });\r\n\r\n      try {\r\n        const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n        await updateDoc(doc(db, 'dashboardData', sid), { cashBalance: newCash, lastUpdated: new Date().toISOString() } as any);\r\n      } catch { }\r\n      try {\r\n        localStorage.setItem(`cashBalance_${userId}`, String(newCash));\r\n        localStorage.setItem(getCashBalanceKey(), String(newCash));\r\n      } catch {}\r\n      try {\r\n        window.dispatchEvent(new CustomEvent('cashBalanceChanged', { detail: { value: newCash } }));\r\n      } catch {}\r\n\r\n      setLastUpdate(Date.now());\r\n      \r\n      let typeLabel = '';\r\n      if (type === 'accessory') typeLabel = 'الإكسسوار';\r\n      else if (type === 'maintenance') typeLabel = 'الصيانة';\r\n      else typeLabel = 'مكن الشحن';\r\n\r\n      toast({ title: 'تم الاستلام', description: `تم خصم ${amountToAck.toFixed(2)} من الدرج وتصفير بند ${typeLabel}` });\r\n    } catch (e) {\r\n      toast({ title: 'خطأ', description: 'تعذر تنفيذ عملية تم الاستلام', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  const startDeductionFlow = () => {\r\n    setDeductReason('');\r\n    setDeductAmount('');\r\n    setIsDeductReasonOpen(true);\r\n  };\r\n\r\n  const confirmDeductReason = () => {\r\n    if (!deductReason.trim()) {\r\n      toast({ title: 'سبب الخصم مطلوب', variant: 'destructive' });\r\n      return;\r\n    }\r\n    setIsDeductReasonOpen(false);\r\n    setIsDeductPinOpen(true);\r\n  };\r\n\r\n  const openDeductAmount = () => {\r\n    setIsDeductPinOpen(false);\r\n    setIsDeductAmountOpen(true);\r\n  };\r\n\r\n  const performDeduction = async () => {\r\n    try {\r\n      if (!userId) return;\r\n      const amt = Math.max(0, Number(deductAmount || 0));\r\n      if (!Number.isFinite(amt) || amt <= 0) {\r\n        toast({ title: 'مبلغ غير صالح', description: 'أدخل مبلغ خصم صحيح أكبر من الصفر', variant: 'destructive' });\r\n        return;\r\n      }\r\n      const newCash = Math.max(0, Number(localCashBalance) - amt);\r\n      setLocalCashBalance(newCash);\r\n      await userDataService.updateUserData(userId, { cashBalance: newCash });\r\n      try {\r\n        const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n        await updateDoc(doc(db, 'dashboardData', sid), { cashBalance: newCash, lastUpdated: new Date().toISOString() } as any);\r\n      } catch { }\r\n      try { localStorage.setItem(`cashBalance_${userId}`, String(newCash)); } catch {}\r\n      try {\r\n        const timestamp = new Date().toISOString();\r\n        localStorage.setItem(getCashBalanceKey(), String(newCash));\r\n        localStorage.setItem(getCashBalanceKey() + '_lastUpdated', timestamp);\r\n      } catch {}\r\n\r\n      const tx = {\r\n        title: 'ايصال خصم من الفلوس النقديه',\r\n        type: 'cash_deduction',\r\n        amount: amt,\r\n        status: 'completed',\r\n        createdAt: new Date(),\r\n        note: deductReason,\r\n        cashierName: 'الحساب الرئيسي'\r\n      };\r\n      try { await userDataService.saveUserTransaction(userId, tx); } catch {}\r\n\r\n      toast({ title: 'تم الخصم', description: `تم خصم ${amt.toFixed(2)} من الدرج` });\r\n      setIsDeductAmountOpen(false);\r\n      setDeductAmount('');\r\n      setDeductReason('');\r\n    } catch (e) {\r\n      toast({ title: 'فشل الخصم', description: 'تعذر تنفيذ عملية الخصم', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-lg animate-in fade-in-90 zoom-in-95 slide-in-from-top-4 bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-800\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right text-gray-900 dark:text-gray-100\">\r\n            <DollarSign className=\"h-5 w-5 text-emerald-600 dark:text-emerald-500\" />\r\n            تفاصيل الفلوس النقدية\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-3\">\r\n          <div className=\"flex items-center justify-between bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-900/50 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-amber-800 dark:text-amber-300 font-bold text-sm\">\r\n              <DollarSign className=\"h-4 w-4\" />\r\n              مجموع الفلوس النقدية (الدرج)\r\n            </div>\r\n            <div className=\"text-amber-700 dark:text-amber-400 font-extrabold text-sm\">\r\n              {formatCurrency(localCashBalance)}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-900/50 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-blue-800 dark:text-blue-300 font-bold text-sm\">\r\n              <Package className=\"h-4 w-4\" />\r\n              فلوس الاكسسوار\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"text-blue-700 dark:text-blue-400 font-extrabold text-sm\">\r\n                {formatCurrency(effectiveAccessoryToday)}\r\n              </div>\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"h-6 px-2 rounded-lg bg-gradient-to-r from-blue-100 to-blue-200 text-blue-700 hover:from-blue-200 hover:to-blue-300 hover:text-blue-800 dark:from-blue-900/50 dark:to-blue-800/50 dark:text-blue-200 dark:hover:from-blue-800 dark:hover:to-blue-700\"\r\n                onClick={() => { setPendingReceiptType('accessory'); setIsReceiptPinOpen(true); }}\r\n              >\r\n                تم الاستلام\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between bg-emerald-50 dark:bg-emerald-950/30 border border-emerald-200 dark:border-emerald-900/50 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-emerald-800 dark:text-emerald-300 font-bold text-sm\">\r\n              <ArrowRightLeft className=\"h-4 w-4\" />\r\n              فلوس الصيانة\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"text-emerald-700 dark:text-emerald-400 font-extrabold text-sm\">\r\n                {formatCurrency(effectiveMaintenanceToday)}\r\n              </div>\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"h-6 px-2 rounded-lg bg-gradient-to-r from-emerald-100 to-emerald-200 text-emerald-700 hover:from-emerald-200 hover:to-emerald-300 hover:text-emerald-800 dark:from-emerald-900/50 dark:to-emerald-800/50 dark:text-emerald-200 dark:hover:from-emerald-800 dark:hover:to-emerald-700\"\r\n                onClick={() => { setPendingReceiptType('maintenance'); setIsReceiptPinOpen(true); }}\r\n              >\r\n                تم الاستلام\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between bg-violet-50 dark:bg-violet-950/30 border border-violet-200 dark:border-violet-900/50 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-violet-800 dark:text-violet-300 font-bold text-sm\">\r\n              <BatteryCharging className=\"h-4 w-4\" />\r\n              مكن الشحن\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"text-violet-700 dark:text-violet-400 font-extrabold text-sm\">\r\n                {formatCurrency(effectiveMachineChargingToday)}\r\n              </div>\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"h-6 px-2 rounded-lg bg-gradient-to-r from-violet-100 to-violet-200 text-violet-700 hover:from-violet-200 hover:to-violet-300 hover:text-violet-800 dark:from-violet-900/50 dark:to-violet-800/50 dark:text-violet-200 dark:hover:from-violet-800 dark:hover:to-violet-700\"\r\n                onClick={() => { setPendingReceiptType('machineCharging'); setIsReceiptPinOpen(true); }}\r\n              >\r\n                تم الاستلام\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          \r\n\r\n          <div className=\"flex items-center justify-between bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-900/50 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-red-800 dark:text-red-300 font-bold text-sm\">\r\n              خصم فلوس من الفلوس النقديه\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"h-6 px-2 rounded-lg bg-gradient-to-r from-red-100 to-red-200 text-red-700 hover:from-red-200 hover:to-red-300 hover:text-red-800 dark:from-red-900/50 dark:to-red-800/50 dark:text-red-200 dark:hover:from-red-800 dark:hover:to-red-700\"\r\n                onClick={startDeductionFlow}\r\n              >\r\n                خصم\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* نافذة الرقم السري لعملية تم الاستلام */}\r\n        <MasterPinDialog\r\n          open={isReceiptPinOpen}\r\n          onOpenChange={setIsReceiptPinOpen}\r\n          mode=\"verify\"\r\n          title=\"تأكيد الرقم السري لعملية تم الاستلام\"\r\n          description=\"يرجى إدخال الرقم السري الرئيسي لتأكيد استلام المبلغ\" \r\n          onSuccess={() => {\r\n            if (pendingReceiptType) {\r\n              handleReceipt(pendingReceiptType);\r\n              setPendingReceiptType(null);\r\n            }\r\n            setIsReceiptPinOpen(false);\r\n          }}\r\n        />\r\n\r\n        <Dialog open={isDeductReasonOpen} onOpenChange={setIsDeductReasonOpen}>\r\n          <DialogContent className=\"sm:max-w-sm bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-800\">\r\n            <DialogHeader>\r\n              <DialogTitle className=\"text-gray-900 dark:text-gray-100\">سبب الخصم</DialogTitle>\r\n            </DialogHeader>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"deduct-reason\" className=\"text-gray-900 dark:text-gray-100\">اكتب سبب الخصم</Label>\r\n              <Input \r\n                id=\"deduct-reason\" \r\n                value={deductReason} \r\n                onChange={(e) => setDeductReason(e.target.value)} \r\n                placeholder=\"سبب الخصم\" \r\n                className=\"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100\"\r\n              />\r\n            </div>\r\n            <div className=\"flex justify-end gap-2 mt-3\">\r\n              <Button variant=\"outline\" onClick={() => setIsDeductReasonOpen(false)} className=\"dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-800\">إلغاء</Button>\r\n              <Button onClick={confirmDeductReason} className=\"bg-red-600 hover:bg-red-700 text-white\">متابعة</Button>\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n\r\n        <MasterPinDialog\r\n          open={isDeductPinOpen}\r\n          onOpenChange={setIsDeductPinOpen}\r\n          mode=\"verify\"\r\n          title=\"تأكيد الرقم السري لعملية الخصم\"\r\n          description=\"يرجى إدخال الرقم السري الرئيسي لمتابعة الخصم\"\r\n          onSuccess={openDeductAmount}\r\n        />\r\n\r\n        <Dialog open={isDeductAmountOpen} onOpenChange={setIsDeductAmountOpen}>\r\n          <DialogContent className=\"sm:max-w-sm bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-800\">\r\n            <DialogHeader>\r\n              <DialogTitle className=\"text-gray-900 dark:text-gray-100\">مبلغ الخصم</DialogTitle>\r\n            </DialogHeader>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"deduct-amount\" className=\"text-gray-900 dark:text-gray-100\">أدخل مبلغ الخصم</Label>\r\n              <Input \r\n                id=\"deduct-amount\" \r\n                type=\"number\" \r\n                value={deductAmount} \r\n                onChange={(e) => setDeductAmount(e.target.value)} \r\n                placeholder=\"0.00\" \r\n                className=\"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100\"\r\n              />\r\n            </div>\r\n            <div className=\"flex justify-end gap-2 mt-3\">\r\n              <Button variant=\"outline\" onClick={() => setIsDeductAmountOpen(false)} className=\"dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-800\">إلغاء</Button>\r\n              <Button onClick={performDeduction} className=\"bg-red-600 hover:bg-red-700 text-white\">تأكيد الخصم</Button>\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default CashSummaryDialog;"],"names":["CashSummaryDialog","open","onOpenChange","userId","cashBalance","walletBalances","transactions","accessorySalesToday","setAccessorySalesToday","React","ackAccessoryToday","setAckAccessoryToday","maintenanceTotalToday","setMaintenanceTotalToday","ackMaintenanceToday","setAckMaintenanceToday","machineChargingTotalToday","setMachineChargingTotalToday","ackMachineChargingToday","setAckMachineChargingToday","localCashBalance","setLocalCashBalance","lastUpdate","setLastUpdate","isReceiptPinOpen","setIsReceiptPinOpen","pendingReceiptType","setPendingReceiptType","toast","useToast","shopIdCtx","useShop","profile","useFirebaseAuth","isDeductReasonOpen","setIsDeductReasonOpen","deductReason","setDeductReason","isDeductPinOpen","setIsDeductPinOpen","isDeductAmountOpen","setIsDeductAmountOpen","deductAmount","setDeductAmount","getCashBalanceKey","formatCurrency","n","unsubscribeAccessory","userDoc","userDataService","lastReceiptStr","lastReceiptDate","lastReceiptDayStr","q","query","collection","db","where","onSnapshot","snap","total","docSnap","createdAt","_a","price","qty","err","e","loadMaintenanceTotal","lastReceiptTime","getDocs","totalAmount","completedAt","_b","repair","calculateMachineChargingTotal","t","tTime","desc","rawTitle","isMachine","isCompleted","loadDailyReceipts","sid","getDoc","doc","v","handler","effectiveAccessoryToday","effectiveMaintenanceToday","effectiveMachineChargingToday","handleReceipt","type","amountToAck","newCash","now","updateDoc","typeLabel","startDeductionFlow","confirmDeductReason","openDeductAmount","performDeduction","amt","timestamp","tx","jsx","Dialog","DialogContent","DialogHeader","jsxs","DialogTitle","DollarSign","Package","Button","ArrowRightLeft","BatteryCharging","MasterPinDialog","Label","Input"],"mappings":"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"}