{"version":3,"file":"functions-DxNA6i1h.js","sources":["../../src/integrations/firebase/functions.ts"],"sourcesContent":["import { getFunctions, httpsCallable } from 'firebase/functions';\nimport { functions } from '../../firebase';\nimport { Transaction } from './types';\n\n// واجهة بيانات الحصول على آخر المعاملات\ninterface GetLastTransactionsData {\n  limit?: number;\n  walletId?: string;\n  lineId?: string;\n  merchantUserId?: string;\n}\n\n// واجهة نتيجة الحصول على آخر المعاملات\ninterface GetLastTransactionsResult {\n  transactions: Transaction[];\n}\n\n// واجهات البيانات للوظائف الإضافية\ninterface CancelTransactionData {\n  transactionId: string;\n  reason: string;\n  cancelledBy: string;\n}\n\ninterface UpdateTransactionStatusData {\n  transactionId: string;\n  status: 'pending' | 'completed' | 'failed' | 'cancelled';\n  updatedBy: string;\n  note?: string;\n}\n\n// واجهات النتائج للوظائف الإضافية\ninterface CancelTransactionResult {\n  success: boolean;\n  message?: string;\n}\n\ninterface UpdateTransactionStatusResult {\n  success: boolean;\n  message?: string;\n}\n\n// استخدام خدمة Functions المُهيأة مسبقاً\n// const functions = getFunctions(app); // تم استيرادها من firebase.ts\n\n// واجهة بيانات تسجيل المعاملة\ninterface RecordTransactionData {\n  lineId: string;\n  walletId: string;\n  txnType: 'send' | 'receive';\n  amount: number;\n  senderMsisdn?: string;\n  receiverMsisdn?: string;\n  reference?: string;\n  fee?: number;\n}\n\n// واجهة نتيجة تسجيل المعاملة\ninterface RecordTransactionResult {\n  id: string;\n  shopId: string;\n  lineId: string;\n  walletId: string;\n  merchantUserId: string;\n  provider: string;\n  txnType: 'send' | 'receive';\n  amount: number;\n  commission: number;\n  profit: number;\n  sender_msisdn: string;\n  receiver_msisdn: string;\n  reference: string | null;\n  status: 'confirmed';\n  createdAt: string;\n  fee?: number;\n}\n\n/**\n * تسجيل معاملة جديدة باستخدام Cloud Function\n * @param data بيانات المعاملة\n * @returns وعد بنتيجة المعاملة\n */\nexport const recordTransaction = async (data: RecordTransactionData): Promise<RecordTransactionResult> => {\n  try {\n    // استدعاء دالة Cloud Function\n    const recordTransactionFn = httpsCallable<RecordTransactionData, RecordTransactionResult>(\n      functions,\n      'recordTransaction'\n    );\n\n    // تنفيذ الاستدعاء\n    const result = await recordTransactionFn(data);\n    \n    // إرجاع البيانات\n    return result.data;\n  } catch (error: any) {\n    console.error('Error recording transaction:', error);\n    \n    // إعادة رمي الخطأ مع رسالة مناسبة\n    if (error.code === 'functions/unauthenticated') {\n      throw new Error('يجب تسجيل الدخول لتسجيل المعاملة');\n    } else if (error.code === 'functions/invalid-argument') {\n      throw new Error('بيانات المعاملة غير صالحة: ' + error.message);\n    } else if (error.code === 'functions/resource-exhausted') {\n      throw new Error('تم تجاوز الحد: ' + error.message);\n    } else if (error.code === 'functions/failed-precondition') {\n      throw new Error('شرط مسبق غير محقق: ' + error.message);\n    } else {\n      throw new Error('حدث خطأ أثناء تسجيل المعاملة: ' + (error.message || 'خطأ غير معروف'));\n    }\n  }\n};\n\n/**\n * إلغاء معاملة باستخدام Cloud Function\n * @param data بيانات إلغاء المعاملة\n * @returns وعد بنتيجة العملية\n */\nexport const cancelTransaction = async (data: CancelTransactionData): Promise<CancelTransactionResult> => {\n  try {\n    // استدعاء دالة Cloud Function\n    const cancelTransactionFn = httpsCallable<CancelTransactionData, CancelTransactionResult>(\n      functions,\n      'cancelTransaction'\n    );\n\n    // تنفيذ الاستدعاء\n    const result = await cancelTransactionFn(data);\n    \n    // إرجاع البيانات\n    return result.data;\n  } catch (error: any) {\n    console.error('Error cancelling transaction:', error);\n    \n    // إعادة رمي الخطأ مع رسالة مناسبة\n    if (error.code === 'functions/unauthenticated') {\n      throw new Error('يجب تسجيل الدخول لإلغاء المعاملة');\n    } else if (error.code === 'functions/invalid-argument') {\n      throw new Error('بيانات الإلغاء غير صالحة: ' + error.message);\n    } else if (error.code === 'functions/not-found') {\n      throw new Error('المعاملة غير موجودة: ' + error.message);\n    } else if (error.code === 'functions/permission-denied') {\n      throw new Error('ليس لديك صلاحية لإلغاء هذه المعاملة: ' + error.message);\n    } else {\n      throw new Error('حدث خطأ أثناء إلغاء المعاملة: ' + (error.message || 'خطأ غير معروف'));\n    }\n  }\n};\n\n/**\n * تحديث حالة معاملة باستخدام Cloud Function\n * @param data بيانات تحديث الحالة\n * @returns وعد بنتيجة العملية\n */\n/**\n * الحصول على آخر المعاملات باستخدام Cloud Function\n * @param data بيانات الاستعلام\n * @returns وعد بقائمة المعاملات\n */\nexport const getLastTransactions = async (data: GetLastTransactionsData = {}): Promise<GetLastTransactionsResult> => {\n  try {\n    // استدعاء دالة Cloud Function\n    const getLastTransactionsFn = httpsCallable<GetLastTransactionsData, GetLastTransactionsResult>(\n      functions,\n      'getLastTransactions'\n    );\n\n    // تنفيذ الاستدعاء\n    const result = await getLastTransactionsFn(data);\n    \n    // إرجاع البيانات\n    return result.data;\n  } catch (error: any) {\n    console.error('Error getting last transactions:', error);\n    \n    // إعادة رمي الخطأ مع رسالة مناسبة\n    if (error.code === 'functions/unauthenticated') {\n      throw new Error('يجب تسجيل الدخول للوصول إلى المعاملات');\n    } else if (error.code === 'functions/invalid-argument') {\n      throw new Error('بيانات الاستعلام غير صالحة: ' + error.message);\n    } else if (error.code === 'functions/permission-denied') {\n      throw new Error('ليس لديك صلاحية للوصول إلى هذه المعاملات: ' + error.message);\n    } else {\n      throw new Error('حدث خطأ أثناء جلب المعاملات: ' + (error.message || 'خطأ غير معروف'));\n    }\n  }\n};\n\nexport const updateTransactionStatus = async (data: UpdateTransactionStatusData): Promise<UpdateTransactionStatusResult> => {\n  try {\n    // استدعاء دالة Cloud Function\n    const updateStatusFn = httpsCallable<UpdateTransactionStatusData, UpdateTransactionStatusResult>(\n      functions,\n      'updateTransactionStatus'\n    );\n\n    // تنفيذ الاستدعاء\n    const result = await updateStatusFn(data);\n    \n    // إرجاع البيانات\n    return result.data;\n  } catch (error: any) {\n    console.error('Error updating transaction status:', error);\n    \n    // إعادة رمي الخطأ مع رسالة مناسبة\n    if (error.code === 'functions/unauthenticated') {\n      throw new Error('يجب تسجيل الدخول لتحديث حالة المعاملة');\n    } else if (error.code === 'functions/invalid-argument') {\n      throw new Error('بيانات التحديث غير صالحة: ' + error.message);\n    } else if (error.code === 'functions/not-found') {\n      throw new Error('المعاملة غير موجودة: ' + error.message);\n    } else if (error.code === 'functions/permission-denied') {\n      throw new Error('ليس لديك صلاحية لتحديث حالة هذه المعاملة: ' + error.message);\n    } else {\n      throw new Error('حدث خطأ أثناء تحديث حالة المعاملة: ' + (error.message || 'خطأ غير معروف'));\n    }\n  }\n};\n\nexport const sendTelegramMessage = async (data: { chatId: string; text: string }): Promise<{ ok: boolean }> => {\n  const fn = httpsCallable<typeof data, { ok: boolean }>(functions, 'sendTelegramMessage');\n  const res = await fn(data);\n  return res.data;\n};\n\nexport const sendTelegramDailySummary = async (data: { userId?: string; chatId: string; text: string }): Promise<{ ok: boolean }> => {\n  return sendTelegramMessage({ chatId: data.chatId, text: data.text });\n};\n"],"names":["getLastTransactions","data","httpsCallable","functions","error","sendTelegramMessage"],"mappings":"+CA+JO,MAAMA,EAAsB,MAAOC,EAAgC,KAA2C,CACnH,GAAI,CAWF,OAHe,MANeC,EAC5BC,EACA,qBAAA,EAIyCF,CAAI,GAGjC,IAChB,OAASG,EAAY,CAInB,MAHA,QAAQ,MAAM,mCAAoCA,CAAK,EAGnDA,EAAM,OAAS,4BACX,IAAI,MAAM,uCAAuC,EAC9CA,EAAM,OAAS,6BAClB,IAAI,MAAM,+BAAiCA,EAAM,OAAO,EACrDA,EAAM,OAAS,8BAClB,IAAI,MAAM,6CAA+CA,EAAM,OAAO,EAEtE,IAAI,MAAM,iCAAmCA,EAAM,SAAW,gBAAgB,CAExF,CACF,EAiCaC,EAAsB,MAAOJ,IAE5B,MADDC,EAA4CC,EAAW,qBAAqB,EAClEF,CAAI,GACd"}