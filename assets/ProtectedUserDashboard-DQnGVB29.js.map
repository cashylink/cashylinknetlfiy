{"version":3,"mappings":";iQAWA,MAAMA,EAAqB,wBAEdC,GAA+B,IAAM,CAChD,KAAM,CAAE,KAAAC,EAAM,QAAAC,EAAS,qBAAAC,EAAsB,iBAAAC,CAAA,EAAqBC,EAAA,EAC5D,CAACC,EAAWC,CAAY,EAAIC,WAA2B,IAAI,EAC3D,CAACC,EAAMC,CAAO,EAAIF,WAAS,EAAK,EAChC,CAACG,EAASC,CAAU,EAAIJ,WAAS,EAAK,EACtC,CAACK,EAAiBC,CAAkB,EAAIN,WAAmB,EAAE,EAC7DO,EAAWC,EAAA,EACXC,EAAWC,EAAA,EAEXC,EAAaC,UAAQ,IAAM,0BAAyBnB,GAAA,YAAAA,EAAM,MAAO,QAAQ,GAAG,CAACA,GAAA,YAAAA,EAAM,GAAG,CAAC,EAEvFoB,EAAeD,UAAQ,IAAM,CACjC,MAAME,EAAO,CAAC,QAAQ,EACtB,OAAIpB,GAAA,MAAAA,EAAS,QAAQoB,EAAK,KAAK,QAAQpB,EAAQ,MAAM,EAAE,EACnDD,GAAA,MAAAA,EAAM,KAAKqB,EAAK,KAAK,QAAQrB,EAAK,GAAG,EAAE,EACpCqB,CACT,EAAG,CAACpB,GAAA,YAAAA,EAAS,OAAQD,GAAA,YAAAA,EAAM,GAAG,CAAC,EAEzBsB,EAAeR,EAAS,SAAS,WAAW,QAAQ,EAG1DS,YAAU,IAAM,CACd,GAAI,EAACvB,GAAA,MAAAA,EAAM,KAAK,QACY,SAAY,CACtC,GAAI,CACF,MAAMwB,EAAMC,EAAIC,EAAI,QAAS1B,EAAK,GAAG,EAC/B2B,EAAO,YAAM,OAAO,qBAAoB,OAAAC,KAAA,4CAAE,KAAKC,GAAKA,EAAE,OAAOL,CAAG,CAAC,EACvE,GAAIG,EAAK,SAAU,CACjB,MAAMG,EAAOH,EAAK,OACZI,EAAM,MAAM,QAAQD,GAAA,YAAAA,EAAM,qBAAqB,EAAIA,EAAK,sBAAwB,GACtFjB,EAAmBkB,CAAG,EAEtB,GAAI,CACF,MAAMC,EAAM,aAAa,QAAQd,CAAU,EACrCe,EAAWD,EAAM,KAAK,MAAMA,CAAG,EAAI,GACnCE,EAAQ,MAAM,KAAK,IAAI,IAAI,CAAC,GAAI,MAAM,QAAQD,CAAQ,EAAIA,EAAW,GAAK,GAAGF,CAAG,CAAC,CAAC,EACxF,aAAa,QAAQb,EAAY,KAAK,UAAUgB,CAAK,CAAC,EACtD,aAAa,QAAQpC,EAAoB,KAAK,UAAUoC,CAAK,CAAC,CAChE,MAAQ,CAAC,CACX,CACF,OAASC,EAAK,CACZ,QAAQ,MAAM,uCAAwCA,CAAG,CAC3D,CACF,GACA,CACF,EAAG,CAACnC,GAAA,YAAAA,EAAM,IAAKkB,CAAU,CAAC,EAE1BK,YAAU,IAAM,CAKd,GAJI,CAACvB,GAAQsB,GAIT,GADgBrB,GAAA,YAAAA,EAAS,YAAa,IAASC,IAAyBC,GAAA,YAAAA,EAA0B,iBAAkB,IACvG,OAEjB,MAAMiC,EAAcC,GAA4BjB,EAAekB,GAAM,CAEnE,GAAKA,EAGL,CAAAhC,EAAagC,CAAC,EACd,GAAI,CACF,MAAMC,EAAS,aAAa,QAAQrB,CAAU,EACxCsB,EAAY,aAAa,QAAQ1C,CAAkB,EACnD2C,EAASF,EAAS,KAAK,MAAMA,CAAM,EAAW,GAC9CG,EAAYF,EAAY,KAAK,MAAMA,CAAS,EAAW,GACvDG,EAAsB,MAAM,QAAQF,CAAM,EAAI,CAAC,GAAGA,CAAM,EAAI,GAClE,GAAI,MAAM,QAAQC,CAAS,EACzB,UAAWE,KAAMF,EACVC,EAAU,SAASC,CAAE,GAAGD,EAAU,KAAKC,CAAE,EAIlD,GAAI,MAAM,QAAQhC,CAAe,EAC/B,UAAWgC,KAAMhC,EACV+B,EAAU,SAASC,CAAE,GAAGD,EAAU,KAAKC,CAAE,EAGlD,MAAMC,EAAmBP,EAAE,IAAMK,EAAU,SAASL,EAAE,EAAE,EACxD7B,EAAQ,CAACoC,CAAgB,EAEzBlC,EAAW,EAAK,EAChB,sBAAsB,IAAMA,EAAW,EAAI,CAAC,CAC9C,MAAQ,CACNF,EAAQ,EAAI,EACZE,EAAW,EAAI,CACjB,EACF,CAAC,EACD,MAAO,IAAMyB,EAAA,CACf,EAAG,CAACpC,EAAMoB,EAAcE,EAAcrB,GAAA,YAAAA,EAAS,SAAUC,EAAsBC,EAAkBS,CAAe,CAAC,EAEjH,MAAMkC,EAAc,SAAY,CAC9BrC,EAAQ,EAAK,EACb,GAAI,CACF,MAAMsC,EAAe,aAAa,QAAQ7B,CAAU,EAC9CyB,EAAYI,EAAe,KAAK,MAAMA,CAAY,EAAgB,GAClEH,EAAKvC,GAAA,YAAAA,EAAW,GACtB,GAAIuC,GAAM,CAACD,EAAU,SAASC,CAAE,EAAG,CACjCD,EAAU,KAAKC,CAAE,EACjB,aAAa,QAAQ1B,EAAY,KAAK,UAAUyB,CAAS,CAAC,EAE1D,GAAI,CACF,aAAa,QAAQ7C,EAAoB,KAAK,UAAU6C,CAAS,CAAC,CACpE,MAAQ,CAAC,CAET,GAAI,CACE3C,GAAA,MAAAA,EAAM,KACR,MAAMgD,GAAUvB,EAAIC,EAAI,QAAS1B,EAAK,GAAG,EAAG,CAAE,sBAAuBiD,GAAWL,CAAE,EAAG,CAEzF,OAASM,EAAG,CACV,QAAQ,KAAK,0EAA2EA,CAAC,CAC3F,CACF,CACF,MAAQ,CAAC,CACX,EAEA,MAAI,CAAC1C,GAAQ,CAACH,EAAkB,KAG9B8C,OAAC,OAAI,UAAU,yBACb,UAAAC,MAAC,OACC,UAAW,6DAA6D1C,EAAU,cAAgB,WAAW,kCAI/GyC,OAAC,OACC,UAAW,0OAA0OzC,EAAU,wBAA0B,oBAAoB,GAG7S,UAAA0C,MAAC,OAAI,UAAU,yCACb,SAAAD,OAAC,OAAI,UAAU,uEACb,UAAAC,MAAC,UACC,aAAW,QACX,QAASN,EACT,UAAU,wEAEV,SAAAM,MAACC,GAAA,CAAE,UAAU,qBAAqB,IAEpCD,MAAC,OAAI,UAAU,MACb,SAAAA,MAAC,MAAG,UAAU,0EACX,SAAA/C,EAAU,OAAS,QACtB,EACF,GACF,EACF,QAGC,OAAI,UAAU,MACb,SAAA8C,OAAC,OAAI,UAAU,yCACb,UAAAC,MAAC,KAAE,UAAU,qDACV,SAAA/C,EAAU,QACb,EAECA,EAAU,SACT8C,OAAC,UACC,aAAW,aACX,MAAM,aACN,QAAS,IAAM,CACb,MAAMG,EAAMjD,EAAU,QAClB,gBAAgB,KAAKiD,CAAG,EAC1B,OAAO,KAAKA,EAAK,SAAU,UAAU,EAErCtC,EAASsC,CAAG,CAEhB,EACA,UAAU,8LAET,0BAAgB,KAAKjD,EAAU,OAAO,EACrC+C,MAACG,GAAA,CAAa,UAAU,UAAU,EAElCH,MAACI,GAAA,CAAS,UAAU,UAAU,QAE/B,QAAK,UAAU,mCAAoC,SAAAnD,EAAU,YAAc,aAAa,IAC3F,EAEJ,EACF,IACF,EACF,CAEJ,EC7LMoD,EAAW,sBACXC,EAAmB,+BAEzB,SAASC,EAAOC,EAAiB,CAC/B,OAAOA,EAAS,GAAGH,CAAQ,IAAIG,CAAM,GAAKH,CAC5C,CAEA,SAASI,EAAcD,EAAiB,CACtC,OAAOA,EAAS,GAAGF,CAAgB,IAAIE,CAAM,GAAKF,CACpD,CAEO,MAAMI,EAAoB,CAC/B,UAAUF,EAA0B,CAClC,GAAI,CAEF,OADY,aAAa,QAAQD,EAAOC,CAAM,CAAC,IAChC,MACjB,MAAQ,CACN,MAAO,EACT,CACF,EAEA,WAAWG,EAAkBH,EAAuB,CAClD,GAAI,CACF,aAAa,QAAQD,EAAOC,CAAM,EAAGG,EAAU,OAAS,OAAO,EAE/D,eAAe,WAAWF,EAAcD,CAAM,CAAC,CACjD,MAAQ,CAAC,CACX,EAEA,kBAAkBA,EAA0B,CAC1C,GAAI,CACF,OAAO,eAAe,QAAQC,EAAcD,CAAM,CAAC,IAAM,MAC3D,MAAQ,CACN,MAAO,EACT,CACF,EAEA,oBAAoBA,EAAuB,CACzC,GAAI,CACF,eAAe,QAAQC,EAAcD,CAAM,EAAG,MAAM,CACtD,MAAQ,CAAC,CACX,CACF,ECjCMI,GAAwBC,EAAM,KAAK,IAAAC,EAAA,IAAM,OAAO,iCAA4B,OAAAtC,KAAA,yHAAC,EAE7EuC,GAAyB,IAAM,SACnC,MAAMnD,EAAWC,EAAA,EACX,CAAE,KAAAjB,EAAM,QAAAC,EAAS,QAAAmE,EAAS,eAAAC,EAAgB,qBAAAnE,EAAsB,iBAAAC,EAAkB,wBAAAmE,CAAA,EAA4BlE,EAAA,EAC9G,CAACmE,EAAiBC,CAAkB,EAAIjE,WAAS,EAAK,EACtD,CAACkE,EAAwBC,CAAyB,EAAInE,WAAS,EAAK,EACxDoE,GAAA,EAClB,KAAM,CAACC,EAAgBC,CAAiB,EAAItE,WAAS,EAAK,EAG1DgB,YAAU,IAAM,CACd,GAAI,EAACvB,GAAA,MAAAA,EAAM,MAAO,CAACG,EAAkB,OAyCrC,MAAM2E,EAAW,YArCe,IAAM,eACpC,MAAMC,EAAU5E,EAChB,GAAI,CAAC4E,EAAS,OAEd,MAAMC,MAAU,KAGhB,IAAIC,EAAe,GACnB,GAAIF,GAAA,MAAAA,EAAS,cAAe,CACxB,MAAMG,GAAWC,EAAAJ,EAAQ,mBAAR,MAAAI,EAA0B,OAASJ,EAAQ,iBAAiB,SAAYA,EAAQ,iBAAmB,IAAI,KAAKA,EAAQ,gBAAgB,EAAI,KACzJE,EAAeC,GAAYF,EAAME,CACrC,CAGA,IAAIE,EAAa,GACjB,IAAIC,EAAAN,GAAA,YAAAA,EAAS,eAAT,MAAAM,EAAuB,SAAU,CACjC,MAAMC,GAASC,EAAAR,EAAQ,aAAa,UAArB,MAAAQ,EAA8B,OAASR,EAAQ,aAAa,QAAQ,SAAYA,EAAQ,aAAa,QAAU,IAAI,KAAKA,EAAQ,aAAa,OAAO,EAAI,KAEvKK,EAAa,CAACE,GAAUN,EAAMM,CAClC,CAGA,IAAIE,EAAgB,GACpB,KAAIC,EAAAV,GAAA,YAAAA,EAAS,gBAAT,YAAAU,EAAwB,UAAW,SAAU,CAC7C,MAAMC,GAAYC,EAAAZ,EAAQ,cAAc,UAAtB,MAAAY,EAA+B,OAASZ,EAAQ,cAAc,QAAQ,SAAYA,EAAQ,cAAc,QAAU,IAAI,KAAKA,EAAQ,cAAc,OAAO,EAAI,KAE9KS,EAAgB,CAACE,GAAaV,EAAMU,CACxC,CAGI,CAACT,GAAgB,CAACG,GAAc,CAACI,IAChC,QAAQ,IAAI,iEAAiE,EAC7ExE,EAAS,wBAAwB,EAExC,EAGsD,GAAK,GAAK,GAAI,EACpE,MAAO,IAAM,cAAc8D,CAAQ,CACrC,EAAG,CAAC9E,GAAA,YAAAA,EAAM,IAAKG,EAAkBa,CAAQ,CAAC,EAK1CO,YAAU,IACD,IAAM,CAAC,EACb,EAAE,EAELA,YAAU,IAAM,OASd,GARA,QAAQ,IAAI,+CAAgD,CAC1D,QAAA6C,EACA,KAAMpE,EAAO,SAAW,OACxB,QAASC,EAAU,CAAE,KAAMA,EAAQ,KAAM,SAAUA,EAAQ,UAAa,OACxE,qBAAAC,EACA,iBAAkBC,EAAmB,SAAW,OACjD,EAEG,CAACiE,GACH,GAAI,CAACpE,EACH,QAAQ,IAAI,wDAAwD,EAEpEgB,EAAS,aAAa,UACbf,EAQT,GAPA,QAAQ,IAAI,0CAA2C,CACrD,KAAMA,EAAQ,KACd,SAAUA,EAAQ,SAClB,qBAAAC,EACA,gBAAiB,CAAC,EAACC,GAAA,MAAAA,EAAkB,cACtC,EAEGA,EAAkB,CACpB,MAAMyF,IAAeT,EAAAhF,GAAA,YAAAA,EAAkB,gBAAlB,YAAAgF,EAAiC,UAAW,SAC3DU,GAAe1F,GAAA,YAAAA,EAA0B,iBAAkB,GAKjE,GADwB,EADT,CAAC,CAACD,GAAwB2F,IACN,CAACD,EACf,CACnB,GAAI,CAAE5E,EAAS,yBAA0B,CAAE,QAAS,GAAM,CAAG,MAAQ,CAAC,CACtE,MACF,CACIf,EAAQ,OAAS,QACnBuE,EAAmB,EAAI,EAEzB,MAAMsB,EAAehC,EAAkB,UAAU9D,GAAA,YAAAA,EAAM,GAAG,EACpD+F,EAAkBjC,EAAkB,kBAAkB9D,GAAA,YAAAA,EAAM,GAAG,EACrE,GAAI8F,GAAgB,CAACC,EAAiB,CACpC,GAAI,CAAEjC,EAAkB,oBAAoB9D,GAAA,YAAAA,EAAM,GAAG,CAAG,MAAQ,CAAC,CACjE0E,EAA0B,EAAK,EAC/BF,EAAmB,EAAI,CACzB,MACEA,EAAmB,EAAI,CAE3B,KAAO,CACL,GAAI,CAAEF,EAAA,CAA2B,MAAQ,CAAC,CAC1C,MACF,EAGN,EAAG,CAACtE,EAAMC,EAASmE,EAASpD,EAAUd,EAAsBC,CAAgB,CAAC,EAE7EoB,YAAU,IAAM,CACd,IAAIyE,EAAa,KACjB,MAAI,CAAC5B,GAAapE,EAChB6E,EAAkB,EAAI,EACb7E,IACTgG,EAAQ,WAAW,IAAMnB,EAAkB,EAAI,EAAG,GAAI,GAEjD,IAAM,CAAE,GAAI,CAAE,aAAamB,CAAK,CAAG,MAAQ,CAAC,CAAE,CACvD,EAAG,CAAC5B,EAASpE,CAAI,CAAC,EAElBuB,YAAU,IAAM,OAId,GAHI6C,GACA,CAACpE,GACD,CAAC4E,GACD,CAACzE,EAAkB,OACvB,MAAM8F,GAAiB9F,GAAA,YAAAA,EAA0B,YAAa,GACxDyF,IAAeT,EAAAhF,GAAA,YAAAA,EAAkB,gBAAlB,YAAAgF,EAAiC,UAAW,SAC3DU,GAAe1F,GAAA,YAAAA,EAA0B,iBAAkB,GAE3D+F,EAAS,CAAC,CAAChG,GAAwB2F,EAGnCM,EAA0BC,GAAW,SACzC,GAAI,CAACA,EAAG,MAAO,OACf,MAAMC,EAAMD,EAAE,aACRE,EAAcD,GAAA,MAAAA,EAAK,YAAeA,EAAI,YAAY,OAASA,EAAI,YAAY,SAAS,cAAgB,IAAI,KAAKA,EAAI,WAAW,EAAE,cAAiB,OAC/IE,GAAOF,GAAA,YAAAA,EAAK,WAAY,OACxBG,EAAWJ,EAAE,WAAa,GAC1BK,GAAYJ,GAAA,YAAAA,EAAK,YAAa,GAC9BT,IAAeT,EAAAiB,EAAE,gBAAF,YAAAjB,EAAiB,UAAW,SAC3CuB,GAAoBrB,EAAAe,EAAE,gBAAF,MAAAf,EAAiB,YAAee,EAAE,cAAc,YAAY,OAASA,EAAE,cAAc,YAAY,SAAS,cAAgB,IAAI,KAAKA,EAAE,cAAc,WAAW,EAAE,cAAiB,OAC3M,MAAO,GAAGI,CAAQ,IAAIC,CAAS,IAAIF,CAAI,IAAID,CAAW,IAAIV,CAAY,IAAIc,CAAiB,EAC7F,EAGA,GAAI,CAACT,EAAe,CAClB,QAAQ,IAAI,mFAAmF,EAC/F,GAAI,CACF,eAAe,QAAQ,2BAA4BE,EAAuBhG,CAAgB,CAAC,EAC3Fa,EAAS,yBAA0B,CAAE,QAAS,GAAM,CACtD,MAAQ,CAAC,CACT,MACF,CAEA,GAAI,CAACkF,GAAU,CAACN,EACd,GAAI,CACF,eAAe,QAAQ,2BAA4BO,EAAuBhG,CAAgB,CAAC,EAC3Fa,EAAS,wBAAwB,CACnC,MAAQ,CAAC,CAEb,EAAG,CAACoD,EAASpE,EAAMG,EAAkBD,EAAsBc,EAAU4D,CAAc,CAAC,EAEpFrD,YAAU,IAAM,CAKhB,EAAG,CAAC6C,EAASpE,EAAMG,EAAkBD,EAAsBoE,EAAyBtD,EAAU4D,CAAc,CAAC,EAE7G,MAAM+B,EAAiB,OAAO,OAAW,MAAkB,OAAe,aAAiB,OAAO,UAAc,KAAe,UAAU,UAAU,cAAc,SAAS,UAAU,GAAO,OAAO,OAAW,KAAe,OAAO,UAAY,OAAO,SAAS,WAAa,SAI5Q,IAHwBxB,EAAAyB,IAAA,MAAAzB,EAAW,kBAAoByB,EAAU,cAG7DxC,IAAYuC,GAAiB,CAAC3G,GAChC,aAAQ6G,EAAA,EAAW,EAGrB,GAAI,CAACjC,EACH,aAAQiC,EAAA,EAAW,EAMrB,GAAI7G,GAAQ,CAACoE,GAAW,CAACjE,EACvB,aAAQ0G,EAAA,EAAW,EAKrB,MAAMC,GAAiB3G,GAAA,YAAAA,EAA0B,iBAAkB,GAC7D4G,IAAiB1B,EAAAlF,GAAA,YAAAA,EAAkB,gBAAlB,YAAAkF,EAAiC,UAAW,SAGnE,OAAIrF,GAAQ,CAACoE,GAAWjE,GAAoB,EAFtB,CAAC,CAACD,GAAwB4G,GAAiBC,SAIvDF,EAAA,EAAW,EAIhBtC,GAqBL,QAAQ,IAAI,yCAA0C,CACpD,gBAAAA,EACA,YAAatE,GAAA,YAAAA,EAAS,KACtB,gBAAiBA,GAAA,YAAAA,EAAS,SAC1B,qBAAAC,EACA,gBAAiB,CAAC,EAACC,GAAA,MAAAA,EAAkB,cACtC,EAED,QAAQ,IAAI,oCAAqCH,EAAO,CAAE,IAAKA,EAAK,IAAK,MAAOA,EAAK,OAAU,MAAM,EACrG,QAAQ,IAAI,uCAAwCC,EAAU,CAAE,OAAQA,EAAQ,OAAQ,KAAMA,EAAQ,MAAS,MAAM,EACrH,QAAQ,IAAI,uCAAwCmE,CAAO,EAC3D,QAAQ,IAAI,+DAA+D,EAGzEjB,OAAC,OAAI,UAAU,WACb,UAAAC,MAACa,EAAM,SAAN,CAAe,eAAW4C,EAAA,EAAW,EACpC,SAAAzD,MAACY,GAAA,EAAsB,EACzB,QACCjE,GAAA,EAAmB,EACpBqD,MAAC4D,EAAA,CACC,KAAMvC,EACN,aAAejE,GAASkE,EAA0BlE,CAAI,EACtD,KAAK,SACL,MAAM,uBACN,YAAY,oDACZ,UAAW,IAAM,CACfsD,EAAkB,oBAAoB9D,GAAA,YAAAA,EAAM,GAAG,EAC/C0E,EAA0B,EAAK,EAC/BF,EAAmB,EAAI,CACzB,GACF,EACF,GAlDErB,OAAA8D,WAAA,CACE,UAAA7D,MAACyD,EAAA,EAAW,EACZzD,MAAC4D,EAAA,CACC,KAAMvC,EACN,aAAejE,GAASkE,EAA0BlE,CAAI,EACtD,KAAK,SACL,MAAM,uBACN,YAAY,oDACZ,UAAW,IAAM,CAEfsD,EAAkB,oBAAoB9D,GAAA,YAAAA,EAAM,GAAG,EAC/C0E,EAA0B,EAAK,EAC/BF,EAAmB,EAAI,CACzB,GACF,EACF,CAqCN","names":["LEGACY_STORAGE_KEY","UserBroadcastModal","user","profile","isSubscriptionActive","userSubscription","useFirebaseAuth","broadcast","setBroadcast","useState","open","setOpen","mounted","setMounted","remoteDismissed","setRemoteDismissed","location","useLocation","navigate","useNavigate","storageKey","useMemo","audienceKeys","keys","isAdminRoute","useEffect","ref","doc","db","snap","n","m","data","arr","raw","localArr","union","err","unsubscribe","subscribeToActiveBroadcasts","b","rawNew","rawLegacy","arrNew","arrLegacy","dismissed","id","alreadyDismissed","handleClose","dismissedRaw","updateDoc","arrayUnion","e","jsxs","jsx","X","url","ExternalLink","LinkIcon","KEY_BASE","SESSION_KEY_BASE","getKey","userId","getSessionKey","quickLoginService","enabled","UserDashboardPageLazy","React","__vitePreload","ProtectedUserDashboard","loading","refreshProfile","checkSubscriptionStatus","isAuthenticated","setIsAuthenticated","isQuickLoginDialogOpen","setIsQuickLoginDialogOpen","useToast","hydrationReady","setHydrationReady","interval","subData","now","isTrialValid","trialEnd","_a","isSubValid","_b","subEnd","_c","isBranchValid","_d","branchEnd","_e","branchActive","trialActive","quickEnabled","sessionVerified","timer","accountActive","active","generateStateSignature","u","sub","activatedAt","plan","isActive","subActive","branchActivatedAt","isElectronEnv","Capacitor","LogoLoader","isTrialActive","isBranchActive","MasterPinDialog","Fragment"],"ignoreList":[],"sources":["../../src/components/UserBroadcastModal.tsx","../../src/utils/quickLoginService.ts","../../src/components/ProtectedUserDashboard.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { X } from 'lucide-react';\r\nimport { Link as LinkIcon, ExternalLink } from 'lucide-react';\r\nimport { subscribeToActiveBroadcasts, type Broadcast } from '@/utils/broadcastService';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { db } from '@/firebase';\r\nimport { doc, updateDoc, arrayUnion } from 'firebase/firestore';\r\n\r\n// Ù…ÙØªØ§Ø­ ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø¶Ù…Ø§Ù† Ø«Ø¨Ø§Øª Ø§Ù„Ø¥Ø®ÙØ§Ø¡ Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…\r\n// ÙŠØªÙ… Ø£ÙŠØ¶Ø§Ù‹ Ø¯Ø¹Ù… Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ±Ø­ÙŠÙ„ Ø¨Ø³Ù„Ø§Ø³Ø©\r\nconst LEGACY_STORAGE_KEY = 'dismissedBroadcastIds';\r\n\r\nexport const UserBroadcastModal: React.FC = () => {\r\n  const { user, profile, isSubscriptionActive, userSubscription } = useFirebaseAuth();\r\n  const [broadcast, setBroadcast] = useState<Broadcast | null>(null);\r\n  const [open, setOpen] = useState(false);\r\n  const [mounted, setMounted] = useState(false); // Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø³Ù„Ø³\r\n  const [remoteDismissed, setRemoteDismissed] = useState<string[]>([]);\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n\r\n  const storageKey = useMemo(() => `dismissedBroadcastIds:${user?.uid || 'global'}`,[user?.uid]);\r\n\r\n  const audienceKeys = useMemo(() => {\r\n    const keys = ['global'];\r\n    if (profile?.shopId) keys.push(`shop:${profile.shopId}`);\r\n    if (user?.uid) keys.push(`user:${user.uid}`);\r\n    return keys;\r\n  }, [profile?.shopId, user?.uid]);\r\n\r\n  const isAdminRoute = location.pathname.startsWith('/admin');\r\n\r\n  // Ø¬Ù„Ø¨ Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Firestore\r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n    const fetchUserDismissals = async () => {\r\n      try {\r\n        const ref = doc(db, 'users', user.uid);\r\n        const snap = await import('firebase/firestore').then(m => m.getDoc(ref));\r\n        if (snap.exists()) {\r\n          const data = snap.data() as any;\r\n          const arr = Array.isArray(data?.dismissedBroadcastIds) ? data.dismissedBroadcastIds : [];\r\n          setRemoteDismissed(arr);\r\n          // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ\r\n          try {\r\n            const raw = localStorage.getItem(storageKey);\r\n            const localArr = raw ? JSON.parse(raw) : [];\r\n            const union = Array.from(new Set([...(Array.isArray(localArr) ? localArr : []), ...arr]));\r\n            localStorage.setItem(storageKey, JSON.stringify(union));\r\n            localStorage.setItem(LEGACY_STORAGE_KEY, JSON.stringify(union));\r\n          } catch {}\r\n        }\r\n      } catch (err) {\r\n        console.error('UserBroadcastModal: fetch user error', err);\r\n      }\r\n    };\r\n    fetchUserDismissals();\r\n  }, [user?.uid, storageKey]);\r\n\r\n  useEffect(() => {\r\n    if (!user || isAdminRoute) return; // Ù†Ø´Ø· ÙÙ‚Ø· Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† ÙˆØºÙŠØ± Ø§Ù„Ø£Ø¯Ù…Ù†\r\n\r\n    // Ø§Ù„Ø³Ù…Ø§Ø­ ÙÙ‚Ø· Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ÙØ¹Ù„ÙŠÙ† Ø£Ùˆ Ø¹Ù„Ù‰ ØªØ¬Ø±Ø¨Ø© Ù…Ø¬Ø§Ù†ÙŠØ© Ù†Ø´Ø·Ø©\r\n    const isEligible = (profile?.approved === true) || isSubscriptionActive || (userSubscription as any)?.isOnFreeTrial === true;\r\n    if (!isEligible) return;\r\n\r\n    const unsubscribe = subscribeToActiveBroadcasts(audienceKeys, (b) => {\r\n      // Ù„Ø§ Ù†ØºÙ„Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØºÙŠØ§Ø¨ Ø¨Ø« Ù†Ø´Ø·Ø› Ù†Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©\r\n      if (!b) {\r\n        return;\r\n      }\r\n      setBroadcast(b);\r\n      try {\r\n        const rawNew = localStorage.getItem(storageKey);\r\n        const rawLegacy = localStorage.getItem(LEGACY_STORAGE_KEY);\r\n        const arrNew = rawNew ? JSON.parse(rawNew) as any : [];\r\n        const arrLegacy = rawLegacy ? JSON.parse(rawLegacy) as any : [];\r\n        const dismissed: string[] = Array.isArray(arrNew) ? [...arrNew] : [];\r\n        if (Array.isArray(arrLegacy)) {\r\n          for (const id of arrLegacy) {\r\n            if (!dismissed.includes(id)) dismissed.push(id);\r\n          }\r\n        }\r\n        // Ø¯Ù…Ø¬ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† Firestore\r\n        if (Array.isArray(remoteDismissed)) {\r\n          for (const id of remoteDismissed) {\r\n            if (!dismissed.includes(id)) dismissed.push(id);\r\n          }\r\n        }\r\n        const alreadyDismissed = b.id && dismissed.includes(b.id);\r\n        setOpen(!alreadyDismissed);\r\n        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø¨Ø« Ø¬Ø¯ÙŠØ¯\r\n        setMounted(false);\r\n        requestAnimationFrame(() => setMounted(true));\r\n      } catch {\r\n        setOpen(true);\r\n        setMounted(true);\r\n      }\r\n    });\r\n    return () => unsubscribe();\r\n  }, [user, audienceKeys, isAdminRoute, profile?.approved, isSubscriptionActive, userSubscription, remoteDismissed]);\r\n\r\n  const handleClose = async () => {\r\n    setOpen(false);\r\n    try {\r\n      const dismissedRaw = localStorage.getItem(storageKey);\r\n      const dismissed = dismissedRaw ? JSON.parse(dismissedRaw) as string[] : [];\r\n      const id = broadcast?.id;\r\n      if (id && !dismissed.includes(id)) {\r\n        dismissed.push(id);\r\n        localStorage.setItem(storageKey, JSON.stringify(dismissed));\r\n        // ÙƒØªØ§Ø¨Ø© Ù„Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø£ÙŠØ¶Ø§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø£ÙŠ Ù‚Ø±Ø§Ø¡Ø§Øª Ø³Ø§Ø¨Ù‚Ø©\r\n        try {\r\n          localStorage.setItem(LEGACY_STORAGE_KEY, JSON.stringify(dismissed));\r\n        } catch {}\r\n        // ØªØ­Ø¯ÙŠØ« Firestore Ù„ÙŠØµØ¨Ø­ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ù…Ø´ØªØ±ÙƒÙ‹Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©\r\n        try {\r\n          if (user?.uid) {\r\n            await updateDoc(doc(db, 'users', user.uid), { dismissedBroadcastIds: arrayUnion(id) });\r\n          }\r\n        } catch (e) {\r\n          console.warn('UserBroadcastModal: failed to update dismissedBroadcastIds in Firestore', e);\r\n        }\r\n      }\r\n    } catch {}\r\n  };\r\n\r\n  if (!open || !broadcast) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[9999]\">\r\n      <div\r\n        className={`absolute inset-0 transition-opacity duration-300 ease-out ${mounted ? 'opacity-100' : 'opacity-0'} bg-black/20 dark:bg-black/20`}\r\n      />\r\n\r\n      {/* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù…Ø¹ Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø£Ù†ÙŠÙ‚ */}\r\n      <div\r\n        className={`absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[92%] sm:w-auto sm:min-w-[380px] sm:max-w-md md:max-w-lg bg-white shadow-2xl rounded-2xl border border-gray-100 ring-1 ring-black/5 transition-all duration-300 ease-out ${mounted ? 'opacity-100 scale-100' : 'opacity-0 scale-95'}`}\r\n      >\r\n        {/* Ø±Ø£Ø³ Ø¨ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ Ø¬Ø°Ø§Ø¨ */}\r\n        <div className=\"relative overflow-hidden rounded-t-2xl\">\r\n          <div className=\"bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 relative\">\r\n            <button\r\n              aria-label=\"Ø¥ØºÙ„Ø§Ù‚\"\r\n              onClick={handleClose}\r\n              className=\"absolute top-3 right-3 p-2 rounded-full bg-white/10 hover:bg-white/20\"\r\n            >\r\n              <X className=\"w-5 h-5 text-white\" />\r\n            </button>\r\n            <div className=\"p-4\">\r\n              <h3 className=\"text-base sm:text-lg font-semibold text-white tracking-wide text-center\">\r\n                {broadcast.title || 'Ø¥Ø´Ø¹Ø§Ø±'}\r\n              </h3>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */}\r\n        <div className=\"p-5\">\r\n          <div className=\"flex items-start justify-between gap-3\">\r\n            <p className=\"text-gray-700 leading-relaxed text-sm sm:text-base\">\r\n              {broadcast.message}\r\n            </p>\r\n            {/* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù† ÙˆÙØ¬Ø¯ */}\r\n            {broadcast.linkUrl && (\r\n              <button\r\n                aria-label=\"ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·\"\r\n                title=\"ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·\"\r\n                onClick={() => {\r\n                  const url = broadcast.linkUrl as string;\r\n                  if (/^https?:\\/\\//i.test(url)) {\r\n                    window.open(url, '_blank', 'noopener');\r\n                  } else {\r\n                    navigate(url);\r\n                  }\r\n                }}\r\n                className=\"shrink-0 inline-flex items-center gap-2 px-3 py-2 rounded-md bg-indigo-600 text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400 whitespace-nowrap\"\r\n              >\r\n                {/^https?:\\/\\//i.test(broadcast.linkUrl) ? (\r\n                  <ExternalLink className=\"w-6 h-6\" />\r\n                ) : (\r\n                  <LinkIcon className=\"w-6 h-6\" />\r\n                )}\r\n                <span className=\"text-xs sm:text-sm font-semibold\">{broadcast.actionText || 'ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·'}</span>\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UserBroadcastModal;","// Ø®Ø¯Ù…Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹: Ø­ÙØ¸ ØªÙØ¶ÙŠÙ„ Ø·Ù„Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ÙÙ‚Ø· Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚\r\n// ØªØ®Ø²ÙŠÙ† Ø§Ù„ØªÙØ¹ÙŠÙ„ ÙÙŠ localStorageØŒ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ sessionStorage\r\n\r\nconst KEY_BASE = 'quick_login_enabled';\r\nconst SESSION_KEY_BASE = 'quick_login_session_verified';\r\n\r\nfunction getKey(userId?: string) {\r\n  return userId ? `${KEY_BASE}_${userId}` : KEY_BASE;\r\n}\r\n\r\nfunction getSessionKey(userId?: string) {\r\n  return userId ? `${SESSION_KEY_BASE}_${userId}` : SESSION_KEY_BASE;\r\n}\r\n\r\nexport const quickLoginService = {\r\n  isEnabled(userId?: string): boolean {\r\n    try {\r\n      const val = localStorage.getItem(getKey(userId));\r\n      return val === 'true';\r\n    } catch {\r\n      return false;\r\n    }\r\n  },\r\n\r\n  setEnabled(enabled: boolean, userId?: string): void {\r\n    try {\r\n      localStorage.setItem(getKey(userId), enabled ? 'true' : 'false');\r\n      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ØªØ­Ù‚Ù‚ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯\r\n      sessionStorage.removeItem(getSessionKey(userId));\r\n    } catch {}\r\n  },\r\n\r\n  isSessionVerified(userId?: string): boolean {\r\n    try {\r\n      return sessionStorage.getItem(getSessionKey(userId)) === 'true';\r\n    } catch {\r\n      return false;\r\n    }\r\n  },\r\n\r\n  markSessionVerified(userId?: string): void {\r\n    try {\r\n      sessionStorage.setItem(getSessionKey(userId), 'true');\r\n    } catch {}\r\n  }\r\n};","import React, { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\nimport UserBroadcastModal from './UserBroadcastModal';\n// ØªÙ… Ø¥Ø²Ø§Ù„Ø© TrialOfferModal\nimport { useToast } from '@/hooks/use-toast';\nimport LogoLoader from '@/components/LogoLoader';\nimport MasterPinDialog from '@/components/MasterPinDialog';\nimport { quickLoginService } from '@/utils/quickLoginService';\nimport { Capacitor } from '@capacitor/core';\n// ØµÙØ­Ø© Ø·Ù„Ø¨ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø³ÙŠØªÙ… ÙØªØ­Ù‡Ø§ Ø¹Ø¨Ø± Ø§Ù„ØªÙˆØ¬ÙŠÙ‡\n\nconst UserDashboardPageLazy = React.lazy(() => import('../pages/UserDashboardPage'));\n\nconst ProtectedUserDashboard = () => {\n  const navigate = useNavigate();\n  const { user, profile, loading, refreshProfile, isSubscriptionActive, userSubscription, checkSubscriptionStatus } = useFirebaseAuth();\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [isQuickLoginDialogOpen, setIsQuickLoginDialogOpen] = useState(false);\n  const { toast } = useToast();\n  const [hydrationReady, setHydrationReady] = useState(false);\n  \n  // Check trial or subscription validity periodically (CLIENT-SIDE ONLY)\n  useEffect(() => {\n    if (!user?.uid || !userSubscription) return;\n    \n    // We only use client-side interval to update UI state if expired locally.\n    // We do NOT call Firestore.\n    const checkValidityClientSide = () => {\n      const subData = userSubscription as any;\n      if (!subData) return;\n\n      const now = new Date();\n\n      // 1. Check Trial\n      let isTrialValid = false;\n      if (subData?.isOnFreeTrial) {\n          const trialEnd = subData.freeTrialEndDate?.toDate ? subData.freeTrialEndDate.toDate() : (subData.freeTrialEndDate ? new Date(subData.freeTrialEndDate) : null);\n          isTrialValid = trialEnd && now < trialEnd;\n      }\n\n      // 2. Check Regular Subscription\n      let isSubValid = false;\n      if (subData?.subscription?.isActive) {\n          const subEnd = subData.subscription.endDate?.toDate ? subData.subscription.endDate.toDate() : (subData.subscription.endDate ? new Date(subData.subscription.endDate) : null);\n          // If no end date (lifetime) or end date is future\n          isSubValid = !subEnd || now < subEnd;\n      }\n\n      // 3. Check Branch Package\n      let isBranchValid = false;\n      if (subData?.branchPackage?.status === 'active') {\n          const branchEnd = subData.branchPackage.endDate?.toDate ? subData.branchPackage.endDate.toDate() : (subData.branchPackage.endDate ? new Date(subData.branchPackage.endDate) : null);\n          // If no end date (lifetime) or end date is future\n          isBranchValid = !branchEnd || now < branchEnd;\n      }\n\n      // If NO valid access method remains, lock out.\n      if (!isTrialValid && !isSubValid && !isBranchValid) {\n           console.log('ProtectedUserDashboard: All access methods expired client-side.');\n           navigate('/user/pending-approval');\n      }\n    };\n    \n    // Check every 1 hour (Client Side Only) for lockout upon expiration\n    const interval = setInterval(checkValidityClientSide, 60 * 60 * 1000);\n    return () => clearInterval(interval);\n  }, [user?.uid, userSubscription, navigate]);\n\n\n  // Removed real-time listener logic as requested to strictly limit reads.\n  // Updates are now manual only.\n  useEffect(() => {\n    return () => {};\n  }, []);\n\n  useEffect(() => {\n    console.log('ProtectedUserDashboard - useEffect triggered', { \n      loading, \n      user: user ? 'exists' : 'null', \n      profile: profile ? { role: profile.role, approved: profile.approved } : 'null',\n      isSubscriptionActive,\n      userSubscription: userSubscription ? 'exists' : 'null'\n    });\n    \n    if (!loading) {\n      if (!user) {\n        console.log('ProtectedUserDashboard - No user, redirecting to login');\n        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…\n        navigate('/user/login');\n      } else if (profile) {\n        console.log('ProtectedUserDashboard - Profile found:', { \n          role: profile.role, \n          approved: profile.approved,\n          isSubscriptionActive,\n          hasSubscription: !!userSubscription?.subscription\n        });\n        \n        if (userSubscription) {\n          const branchActive = userSubscription?.branchPackage?.status === 'active';\n          const trialActive = (userSubscription as any)?.isOnFreeTrial === true;\n          // Fix: Rely strictly on calculated validity (isSubscriptionActive) which checks dates.\n          // Do NOT trust raw isActive flag from DB as it might be stale.\n          const active = !!isSubscriptionActive || trialActive;\n          const shouldGoPending = !active && !branchActive;\n          if (shouldGoPending) {\n            try { navigate('/user/pending-approval', { replace: true }); } catch {}\n            return;\n          }\n          if (profile.role === \"user\") {\n            setIsAuthenticated(true);\n          }\n          const quickEnabled = quickLoginService.isEnabled(user?.uid);\n          const sessionVerified = quickLoginService.isSessionVerified(user?.uid);\n          if (quickEnabled && !sessionVerified) {\n            try { quickLoginService.markSessionVerified(user?.uid); } catch {}\n            setIsQuickLoginDialogOpen(false);\n            setIsAuthenticated(true);\n          } else {\n            setIsAuthenticated(true);\n          }\n        } else {\n          try { checkSubscriptionStatus(); } catch {}\n          return;\n        }\n      }\n    }\n  }, [user, profile, loading, navigate, isSubscriptionActive, userSubscription]);\n\n  useEffect(() => {\n    let timer: any = null;\n    if (!loading && !!user) {\n      setHydrationReady(true);\n    } else if (user) {\n      timer = setTimeout(() => setHydrationReady(true), 3000);\n    }\n    return () => { try { clearTimeout(timer); } catch {} };\n  }, [loading, user]);\n\n  useEffect(() => {\n    if (loading) return;\n    if (!user) return;\n    if (!hydrationReady) return;\n    if (!userSubscription) return;\n    const accountActive = (userSubscription as any)?.isActive !== false;\n    const branchActive = userSubscription?.branchPackage?.status === 'active';\n    const trialActive = (userSubscription as any)?.isOnFreeTrial === true;\n    // Fix: Rely strictly on calculated validity (isSubscriptionActive) which checks dates.\n    const active = !!isSubscriptionActive || trialActive;\n    \n    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙˆÙ„ÙŠØ¯ ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø©\n    const generateStateSignature = (u: any) => {\n      if (!u) return 'null';\n      const sub = u.subscription;\n      const activatedAt = sub?.activatedAt ? (sub.activatedAt.toDate ? sub.activatedAt.toDate().toISOString() : new Date(sub.activatedAt).toISOString()) : 'null';\n      const plan = sub?.planType || 'null';\n      const isActive = u.isActive !== false;\n      const subActive = sub?.isActive === true;\n      const branchActive = u.branchPackage?.status === 'active';\n      const branchActivatedAt = u.branchPackage?.activatedAt ? (u.branchPackage.activatedAt.toDate ? u.branchPackage.activatedAt.toDate().toISOString() : new Date(u.branchPackage.activatedAt).toISOString()) : 'null';\n      return `${isActive}|${subActive}|${plan}|${activatedAt}|${branchActive}|${branchActivatedAt}`;\n    };\n\n    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø·Ù„Ø§Ù‹ (isActive=false)ØŒ ÙŠØ¬Ø¨ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ÙÙˆØ±Ø§Ù‹ Ø¨ØºØ¶ Ø§Ù„Ù†Ø¸Ø± Ø¹Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ\n    if (!accountActive) {\n      console.log('â›” ProtectedUserDashboard: Account is deactivated, redirecting to pending approval');\n      try { \n        sessionStorage.setItem('dashboard_kick_signature', generateStateSignature(userSubscription));\n        navigate('/user/pending-approval', { replace: true }); \n      } catch {}\n      return;\n    }\n\n    if (!active && !branchActive) {\n      try { \n        sessionStorage.setItem('dashboard_kick_signature', generateStateSignature(userSubscription));\n        navigate('/user/pending-approval'); \n      } catch {}\n    }\n  }, [loading, user, userSubscription, isSubscriptionActive, navigate, hydrationReady]);\n\n  useEffect(() => {\n    if (loading) return;\n    if (!user) return;\n    if (!hydrationReady) return;\n    return;\n  }, [loading, user, userSubscription, isSubscriptionActive, checkSubscriptionStatus, navigate, hydrationReady]);\n\n  const isElectronEnv = (typeof window !== 'undefined' && (((window as any).electronAPI) || (typeof navigator !== 'undefined' && navigator.userAgent.toLowerCase().includes('electron')) || (typeof window !== 'undefined' && window.location && window.location.protocol === 'file:')));\n  const isAndroidNative = Capacitor?.isNativePlatform && Capacitor.getPlatform() === 'android';\n\n  // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø­Ù…Ù‘Ù„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ ÙˆØ¹Ù„Ù‰ Ø§Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…\n  if (loading && (isElectronEnv || !user)) {\n    return <LogoLoader />;\n  }\n\n  if (!hydrationReady) {\n    return <LogoLoader />;\n  }\n\n  // Critical Security Check:\n  // If user is logged in but subscription data is not loaded yet, BLOCK access.\n  // This prevents the dashboard from briefly rendering for expired users before the redirect effect runs.\n  if (user && !loading && !userSubscription) {\n    return <LogoLoader />;\n  }\n\n  // Critical: Block rendering if subscription is expired\n  // This ensures the \"account closes\" visually before the redirect happens\n  const isTrialActive = (userSubscription as any)?.isOnFreeTrial === true;\n  const isBranchActive = userSubscription?.branchPackage?.status === 'active';\n  const isAccessValid = !!isSubscriptionActive || isTrialActive || isBranchActive;\n\n  if (user && !loading && userSubscription && !isAccessValid) {\n    // We are already redirecting in the useEffect, but we must NOT render the dashboard content\n    return <LogoLoader />;\n  }\n\n  // ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¨Ø³Ø¨Ø¨ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ØŒ Ø§Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ÙÙˆÙ‚ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„\n  if (!isAuthenticated) {\n    return (\n      <>\n        <LogoLoader />\n        <MasterPinDialog\n          open={isQuickLoginDialogOpen}\n          onOpenChange={(open) => setIsQuickLoginDialogOpen(open)}\n          mode=\"verify\"\n          title=\"Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹\"\n          description=\"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…\"\n          onSuccess={() => {\n            // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø© ÙÙ‚Ø·\n            quickLoginService.markSessionVerified(user?.uid);\n            setIsQuickLoginDialogOpen(false);\n            setIsAuthenticated(true);\n          }}\n        />\n      </>\n    );\n  }\n\n  console.log('ProtectedUserDashboard - Render state:', { \n    isAuthenticated, \n    profileRole: profile?.role,\n    profileApproved: profile?.approved,\n    isSubscriptionActive,\n    hasSubscription: !!userSubscription?.subscription\n  });\n\n  console.log('ğŸ”¥ ProtectedUserDashboard - user:', user ? { uid: user.uid, email: user.email } : 'null');\n  console.log('ğŸ”¥ ProtectedUserDashboard - profile:', profile ? { userId: profile.userId, role: profile.role } : 'null');\n  console.log('ğŸ”¥ ProtectedUserDashboard - loading:', loading);\n  console.log('ğŸ”¥ ProtectedUserDashboard - About to render UserDashboardPage');\n\n  return (\n    <div className=\"relative\">\n      <React.Suspense fallback={<LogoLoader /> }>\n        <UserDashboardPageLazy />\n      </React.Suspense>\n      <UserBroadcastModal />\n      <MasterPinDialog\n        open={isQuickLoginDialogOpen}\n        onOpenChange={(open) => setIsQuickLoginDialogOpen(open)}\n        mode=\"verify\"\n        title=\"Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹\"\n        description=\"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…\"\n        onSuccess={() => {\n          quickLoginService.markSessionVerified(user?.uid);\n          setIsQuickLoginDialogOpen(false);\n          setIsAuthenticated(true);\n        }}\n      />\n    </div>\n  );\n};\n\nexport default ProtectedUserDashboard;\n"],"file":"assets/ProtectedUserDashboard-DQnGVB29.js"}