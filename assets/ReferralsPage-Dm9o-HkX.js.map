{"version":3,"file":"ReferralsPage-Dm9o-HkX.js","sources":["../../src/pages/ReferralsPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { \n  Share2, \n  Users, \n  Copy, \n  CheckCircle, \n  Clock, \n  XCircle,\n  Gift,\n  Link as LinkIcon,\n  UserPlus\n} from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\nimport { referralService } from '@/integrations/firebase/services';\nimport { Referral } from '@/integrations/firebase/types';\n\nconst ReferralsPage = () => {\n  const { user, profile } = useFirebaseAuth();\n  const { toast } = useToast();\n  const [referrals, setReferrals] = useState<Referral[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [copySuccess, setCopySuccess] = useState(false);\n\n  // إنشاء رابط الإحالة\n  const referralLink = profile?.referralCode \n    ? `${window.location.origin}/register?ref=${profile.referralCode}`\n    : '';\n\n  useEffect(() => {\n    if (user?.uid) {\n      loadReferrals();\n    } else {\n      setLoading(false);\n    }\n  }, [user]);\n\n  const loadReferrals = async () => {\n    try {\n      setLoading(true);\n      if (user?.uid) {\n        const userReferrals = await referralService.getByReferrerId(user.uid);\n        setReferrals(userReferrals);\n      }\n    } catch (error) {\n      console.error('Error loading referrals:', error);\n      toast({\n        title: \"خطأ في تحميل الإحالات\",\n        description: \"حدث خطأ أثناء تحميل قائمة الإحالات\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const copyReferralLink = async () => {\n    try {\n      await navigator.clipboard.writeText(referralLink);\n      setCopySuccess(true);\n      toast({\n        title: \"تم النسخ بنجاح\",\n        description: \"تم نسخ رابط الإحالة إلى الحافظة\",\n      });\n      setTimeout(() => setCopySuccess(false), 2000);\n    } catch (error) {\n      toast({\n        title: \"خطأ في النسخ\",\n        description: \"حدث خطأ أثناء نسخ الرابط\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'completed':\n        return (\n          <Badge variant=\"default\" className=\"bg-green-100 text-green-800 border-green-200\">\n            <CheckCircle className=\"w-3 h-3 mr-1\" />\n            مكتملة\n          </Badge>\n        );\n      case 'pending':\n        return (\n          <Badge variant=\"secondary\" className=\"bg-yellow-100 text-yellow-800 border-yellow-200\">\n            <Clock className=\"w-3 h-3 mr-1\" />\n            قيد الانتظار\n          </Badge>\n        );\n      case 'cancelled':\n        return (\n          <Badge variant=\"destructive\" className=\"bg-red-100 text-red-800 border-red-200\">\n            <XCircle className=\"w-3 h-3 mr-1\" />\n            ملغية\n          </Badge>\n        );\n      default:\n        return (\n          <Badge variant=\"outline\">\n            غير محدد\n          </Badge>\n        );\n    }\n  };\n\n  const formatDate = (timestamp: any) => {\n    if (!timestamp) return 'غير محدد';\n    const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);\n    return date.toLocaleDateString('ar-SA', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-background p-4\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"text-center py-12\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto\"></div>\n            <p className=\"mt-4 text-gray-600\">جاري تحميل الإحالات...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-4\">\n      <div className=\"max-w-6xl mx-auto space-y-6\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2 flex items-center justify-center gap-2\">\n            <Share2 className=\"h-8 w-8 text-green-600\" />\n            نظام الإحالات\n          </h1>\n          <p className=\"text-gray-600\">\n            ادع أصدقاءك واحصل على مكافآت عند انضمامهم\n          </p>\n        </div>\n\n        {/* رابط الإحالة */}\n        <Card className=\"shadow-lg border-0 bg-white/80 backdrop-blur-sm\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-green-700\">\n              <LinkIcon className=\"h-5 w-5\" />\n              رابط الإحالة الخاص بك\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {referralLink ? (\n              <>\n                <div className=\"flex gap-2\">\n                  <Input\n                    value={referralLink}\n                    readOnly\n                    className=\"flex-1 bg-gray-50 border-gray-200\"\n                  />\n                  <Button\n                    onClick={copyReferralLink}\n                    variant={copySuccess ? \"default\" : \"outline\"}\n                    className={copySuccess ? \"bg-green-600 hover:bg-green-700\" : \"\"}\n                  >\n                    {copySuccess ? (\n                      <CheckCircle className=\"h-4 w-4\" />\n                    ) : (\n                      <Copy className=\"h-4 w-4\" />\n                    )}\n                  </Button>\n                </div>\n                <Alert className=\"border-green-200 bg-green-50\">\n                  <Gift className=\"h-4 w-4 text-green-600\" />\n                  <AlertDescription className=\"text-green-700\">\n                    شارك هذا الرابط مع أصدقائك للحصول على مكافآت عند تسجيلهم\n                  </AlertDescription>\n                </Alert>\n              </>\n            ) : (\n              <Alert variant=\"destructive\">\n                <AlertDescription>\n                  لم يتم العثور على رمز الإحالة الخاص بك\n                </AlertDescription>\n              </Alert>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* إحصائيات الإحالات */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <Card className=\"shadow-lg border-0 bg-white/80 backdrop-blur-sm\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">إجمالي الإحالات</p>\n                  <p className=\"text-2xl font-bold text-gray-900\">{referrals.length}</p>\n                </div>\n                <Users className=\"h-8 w-8 text-blue-600\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"shadow-lg border-0 bg-white/80 backdrop-blur-sm\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">الإحالات المكتملة</p>\n                  <p className=\"text-2xl font-bold text-green-600\">\n                    {referrals.filter(r => r.status === 'completed').length}\n                  </p>\n                </div>\n                <CheckCircle className=\"h-8 w-8 text-green-600\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"shadow-lg border-0 bg-white/80 backdrop-blur-sm\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">قيد الانتظار</p>\n                  <p className=\"text-2xl font-bold text-yellow-600\">\n                    {referrals.filter(r => r.status === 'pending').length}\n                  </p>\n                </div>\n                <Clock className=\"h-8 w-8 text-yellow-600\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* قائمة الإحالات */}\n        <Card className=\"shadow-lg border-0 bg-white/80 backdrop-blur-sm\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <UserPlus className=\"h-5 w-5 text-green-600\" />\n              المستخدمون المحالون\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {referrals.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <Users className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n                  لا توجد إحالات بعد\n                </h3>\n                <p className=\"text-gray-600 mb-4\">\n                  ابدأ بدعوة أصدقائك باستخدام رابط الإحالة أعلاه\n                </p>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {referrals.map((referral) => (\n                  <div\n                    key={referral.id}\n                    className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50/50\"\n                  >\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-3 mb-2\">\n                        <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center\">\n                          <UserPlus className=\"h-5 w-5 text-green-600\" />\n                        </div>\n                        <div>\n                          <p className=\"font-medium text-gray-900\">\n                            {referral.referredUserEmail}\n                          </p>\n                          <p className=\"text-sm text-gray-600\">\n                            تاريخ الإحالة: {formatDate(referral.createdAt)}\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-3\">\n                      {getStatusBadge(referral.status)}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n};\n\nexport default ReferralsPage;"],"names":["ReferralsPage","user","profile","useFirebaseAuth","toast","useToast","referrals","setReferrals","useState","loading","setLoading","copySuccess","setCopySuccess","referralLink","useEffect","loadReferrals","userReferrals","referralService","error","copyReferralLink","getStatusBadge","status","jsxs","Badge","jsx","CheckCircle","Clock","XCircle","formatDate","timestamp","Share2","Card","CardHeader","CardTitle","LinkIcon","CardContent","Fragment","Input","Button","Copy","Alert","Gift","AlertDescription","Users","r","UserPlus","referral"],"mappings":"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"}