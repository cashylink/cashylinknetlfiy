const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-F79wE54_.js","./index-CF_cwj-9.css"])))=>i.map(i=>d[i]);
import{$ as ke,u as ye,r as d,m as je,j as e,af as pe,ag as Ne,ah as ve,ai as we,B as p,a1 as ee,c as Y,d as te,e as se,a3 as Me,at as Pe,g as $,P as oe,U as Ae,bt as be,a7 as ge,bu as De,bq as le,a4 as qe,C as Ke,a5 as Xe,a as Qe,K as Ze,a2 as et,I as X,aF as tt,aH as st,aO as at}from"./index-F79wE54_.js";import{B as ne}from"./badge-CL3KS5lq.js";import{S as rt,a as nt,b as it,c as lt,d as ct}from"./select-_viMUn4-.js";import{W as de}from"./wallet-D7yXYRLl.js";import{S as Fe}from"./star-dm_eEDi1.js";import{S as Re}from"./square-pen-CdIGtQFW.js";import{A as Te}from"./arrow-left-DVGZRrC9.js";import{P as Se}from"./progress-BPFzI8Ao.js";import{S as ot}from"./separator-5VE7iToZ.js";import{C as dt}from"./calendar-4HaEghcA.js";import{C as Ce}from"./chart-column-VEedLMl7.js";import{T as ce}from"./trending-down-ClOMxZ55.js";import{D as me}from"./dollar-sign-C1EWy7pl.js";import{A as ie}from"./activity-C0UmLZcn.js";import{C as mt}from"./users-DWr6-GT6.js";import{C as ht}from"./circle-check-big-nRabPr17.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],_e=ke("building",xt);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]],he=ke("id-card",ut),ft=[{id:"vodafone",name:"فودافون كاش",ownerName:"أحمد محمد علي",nationalId:"29012345678901"},{id:"etisalat",name:"اتصالات كاش",ownerName:"فاطمة حسن محمود",nationalId:"28506789012345"},{id:"orange",name:"أورنج كاش",ownerName:"محمد أحمد السيد",nationalId:"29309876543210"},{id:"we_pay",name:"وي باي",ownerName:"نورا عبد الرحمن",nationalId:"29112345678901"},{id:"smart_wallet",name:"سمارت ولت",ownerName:"خالد محمد عبد الله",nationalId:"28809876543210"},{id:"access_pay",name:"أكسس باي",ownerName:"مريم أحمد حسن",nationalId:"29456789012345"},{id:"insta_pay",name:"انستا باي",ownerName:"عمر سعد محمد",nationalId:"29012345678901"}],gt=({isOpen:o,onClose:G,onWalletSelect:S,onEditWallet:N,onDeleteWallet:y})=>{const{user:n}=ye(),[v,M]=d.useState([]),[C,B]=d.useState(!1),[P,F]=d.useState([]),[J,R]=d.useState(!1),{toast:j}=je(),E=async(a,l)=>{const w=new Date().getMonth(),b=new Date().getFullYear(),m=l.filter(u=>{const f=new Date(u.createdAt);return f.getMonth()===w&&f.getFullYear()===b&&(u.lineId===a||u.fromWallet===a)}),h=u=>{const f=u.type;return u.txnType==="receive"||f==="withdraw"||f==="withdrawal"||f==="receive"},I=u=>{const f=u.type;return u.txnType==="send"||f==="send"||f==="transfer"},L=m.filter(h).reduce((u,f)=>{const V=f.withdrawnAmount!==void 0?f.withdrawnAmount:f.amount;return u+(V||0)},0),g=m.filter(I).reduce((u,f)=>{const V=f.sentAmount!==void 0?f.sentAmount:f.amount;return u+(V||0)},0);return{withdrawalUsage:L,transferUsage:g}},K=a=>{const l=new Date().toISOString().split("T")[0],w=a.lastResetDate;if(!w)return{...a,monthlyWithdrawalUsage:0,monthlyTransferUsage:0,lastResetDate:l};const b=new Date(w),m=new Date;return b.getMonth()!==m.getMonth()||b.getFullYear()!==m.getFullYear()?{...a,monthlyWithdrawalUsage:0,monthlyTransferUsage:0,lastResetDate:l}:a};d.useEffect(()=>{if(!(n!=null&&n.uid)||!o)return;(async()=>{R(!0);try{const l=await ee.getByMerchantId(n.uid),w=await be.getByUserId(n.uid),m=(await Promise.all(l.map(async h=>{const{withdrawalUsage:I,transferUsage:L}=await E(h.id,w),g=await ge.getWalletLimits(h.id);return{id:h.id,name:h.label||"محفظة بدون اسم",phone:h.msisdn,ownerName:h.ownerName,nationalId:h.nationalId||"",isDefault:!1,isActive:h.isActive===!0,monthlyWithdrawalLimit:(g==null?void 0:g.monthlyWithdrawLimit)??h.withdrawLimit??2e5,monthlyTransferLimit:(g==null?void 0:g.monthlyTransferLimit)??h.transferLimit??2e5,monthlyWithdrawalUsage:(g==null?void 0:g.monthlyWithdrawUsed)??I??0,monthlyTransferUsage:(g==null?void 0:g.monthlyTransferUsed)??L??0,lastResetDate:new Date().toISOString().split("T")[0],walletProvider:h.walletProvider||""}}))).map(K);M(m)}catch(l){console.error("Error loading wallets:",l),j({title:"فشل جلب بيانات المحافظ",description:"قد تكون المشكلة بسبب الصلاحيات أو الاتصال. سيتم عرض البيانات المحلية إن وُجدت. جرّب تسجيل الدخول مجددًا أو افتح صفحة اختبار المصادقة من القائمة.",variant:"destructive"})}finally{R(!1)}})()},[n==null?void 0:n.uid,o]);const U=a=>ft.find(l=>l.id===a),_=(a,l)=>l>0?Math.min(a/l*100,100):0,z=a=>new Intl.NumberFormat("ar-EG").format(a);return e.jsx(pe,{open:o,onOpenChange:G,children:e.jsxs(Ne,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ve,{className:"pb-4",children:[e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(de,{className:"h-5 w-5"}),"الاطلاع على جميع المحافظ",e.jsxs(ne,{variant:"secondary",className:"mr-2",children:[v.length," محفظة"]})]}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:C?e.jsxs(e.Fragment,{children:[e.jsx(p,{size:"sm",onClick:async()=>{try{if(!(n!=null&&n.uid))return;const a=v.map(l=>ee.update(l.id,{isActive:P.includes(l.id)}));await Promise.all(a),M(l=>l.map(w=>({...w,isActive:P.includes(w.id)}))),B(!1),j({title:"تم تفعيل المحافظ",description:"فقط المحافظ المحددة ستظهر في الاختيار الخارجي"});try{window.dispatchEvent(new CustomEvent("wallets:activation-updated"))}catch{}}catch(a){console.error("Error activating wallets:",a),j({title:"فشل التفعيل",description:"تعذر تفعيل المحافظ المحددة",variant:"destructive"})}},className:"h-7",children:"تفعيل المحافظ"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{B(!1),F([])},className:"h-7",children:"إلغاء"})]}):e.jsx(p,{variant:"outline",size:"sm",onClick:()=>B(!0),className:"h-7",children:"تحديد المحافظ"})})]}),J?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"جاري تحميل المحافظ..."})]})}):v.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(de,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"لا توجد محافظ مضافة حتى الآن"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(a=>{const l=U(a.walletProvider||"");_(a.monthlyWithdrawalUsage||0,a.monthlyWithdrawalLimit),_(a.monthlyTransferUsage||0,a.monthlyTransferLimit);const w=P.includes(a.id),b=C?`cursor-pointer transition-shadow border-2 ${w?"border-blue-500 shadow-lg":"hover:border-blue-300"}`:"cursor-pointer hover:shadow-lg transition-shadow border-2 hover:border-blue-300";return e.jsxs(Y,{className:b,onClick:()=>{C?F(m=>m.includes(a.id)?m.filter(h=>h!==a.id):[...m,a.id]):S(a)},children:[e.jsx(te,{className:"pb-3",children:e.jsxs(se,{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx("span",{children:a.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.isActive&&e.jsx(ne,{variant:"default",className:"text-xs",children:"نشطة"}),a.isDefault&&e.jsxs(ne,{variant:"default",className:"text-xs",children:[e.jsx(Fe,{className:"h-3 w-3 mr-1"}),"افتراضية"]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:m=>{m.stopPropagation(),N==null||N(a)},className:"h-7 px-2",children:e.jsx(Re,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:m=>{m.stopPropagation(),y==null||y(a.id)},className:"h-7 px-2 text-destructive hover:text-destructive",children:e.jsx(Pe,{className:"h-4 w-4"})})]})]})}),e.jsxs($,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(oe,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"font-mono",children:a.phone})]}),a.ownerName&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ae,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{children:a.ownerName})]}),a.nationalId&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(he,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"font-mono",children:a.nationalId})]}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(_e,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{children:l.name})]})]}),(()=>{const m=a.monthlyWithdrawalLimit,h=a.monthlyTransferLimit,I=a.monthlyWithdrawalUsage||0,L=a.monthlyTransferUsage||0,g=Math.max(m-I,0),u=Math.max(h-L,0);return e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2",children:[e.jsxs("div",{className:"text-xs text-gray-600 font-medium text-center",children:["الحدود الشهرية: ",(l==null?void 0:l.name)||a.walletProvider," - ",a.phone]}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-red-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-200 ease-out shadow-sm",style:{width:`${Math.min(I/Math.max(m,1)*100,100)}%`}})}),e.jsx("div",{className:"w-1/2 bg-blue-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-200 ease-out shadow-sm",style:{width:`${Math.min(L/Math.max(h,1)*100,100)}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsxs("div",{className:"text-xs text-red-600 font-medium",children:["متبقي سحب: ",z(g)," جنيه"]}),e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["متبقي تحويل: ",z(u)," جنيه"]})]})]})})(),e.jsx(p,{variant:"outline",size:"sm",className:"w-full text-xs",onClick:m=>{m.stopPropagation(),S(a)},children:"عرض التفاصيل الكاملة"})]})]},a.id)})}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsxs(p,{onClick:G,variant:"outline",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"إغلاق"]})})]})})},yt=[{id:"vodafone",name:"فودافون كاش",ownerName:"أحمد محمد علي",nationalId:"29012345678901"},{id:"etisalat",name:"اتصالات كاش",ownerName:"فاطمة حسن محمود",nationalId:"28506789012345"},{id:"orange",name:"أورنج كاش",ownerName:"محمد أحمد السيد",nationalId:"29309876543210"},{id:"we_pay",name:"وي باي",ownerName:"نورا عبد الرحمن",nationalId:"29112345678901"},{id:"smart_wallet",name:"سمارت ولت",ownerName:"خالد محمد عبد الله",nationalId:"28809876543210"},{id:"access_pay",name:"أكسس باي",ownerName:"مريم أحمد حسن",nationalId:"29456789012345"},{id:"insta_pay",name:"انستا باي",ownerName:"عمر سعد محمد",nationalId:"29012345678901"}],jt=({wallet:o,isOpen:G,onClose:S,onBack:N})=>{const{user:y}=ye(),[n,v]=d.useState([]),[M,C]=d.useState(!1),[B,P]=d.useState("month"),{toast:F}=je();if(d.useEffect(()=>{if(!o||!(y!=null&&y.uid)||!G)return;(async()=>{C(!0);try{const W=(await be.getByUserId(y.uid)).filter(O=>O.walletId===o.id).sort((O,xe)=>new Date(xe.createdAt).getTime()-new Date(O.createdAt).getTime());v(W)}catch(i){console.error("Error loading transactions:",i),F({title:"فشل جلب معاملات المحفظة",description:"قد تكون المشكلة بسبب صلاحيات Firestore أو الاتصال. تم عرض ما أمكن محليًا. جرّب تسجيل الدخول مجددًا أو صفحة اختبار المصادقة.",variant:"destructive"})}finally{C(!1)}})()},[o,y==null?void 0:y.uid,G]),!o)return null;const J=s=>yt.find(i=>i.id===s),R=(s,i)=>i>0?Math.min(s/i*100,100):0,j=s=>new Intl.NumberFormat("ar-EG").format(s),E=s=>new Date(s).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=(()=>{const s=new Date;let i;switch(B){case"week":i=new Date(s.getTime()-7*24*60*60*1e3);break;case"month":i=new Date(s.getFullYear(),s.getMonth(),1);break;default:return n}return n.filter(W=>new Date(W.createdAt)>=i)})(),_=s=>{const i=s.type,W=s.txnType;return i==="withdraw"||i==="withdrawal"||i==="receive"||W==="receive"},z=s=>{const i=s.type,W=s.txnType;return i==="send"||i==="transfer"||W==="send"},a=U.filter(s=>_(s)&&s.status==="completed").reduce((s,i)=>{const W=i.withdrawnAmount!==void 0?i.withdrawnAmount:i.amount;return s+(W||0)},0),l=U.filter(s=>z(s)&&s.status==="completed"&&s.title!=="إيصال تحويل مكينه").reduce((s,i)=>{const W=i.sentAmount!==void 0?i.sentAmount:i.amount;return s+(W||0)},0),w=U.filter(s=>s.type==="deposit"&&s.status==="completed").reduce((s,i)=>s+i.amount,0),b=U.filter(s=>s.status==="completed"),m=b.length,h=b.reduce((s,i)=>{if(_(i)){const W=i.withdrawnAmount??i.receivedAmount??i.amount??0;return s+De(Number(W)||0,"receive")}if(z(i)){const W=i.sentAmount??i.transferredAmount??i.amount??0;return s+De(Number(W)||0,"send")}return s},0),I=J(o.walletProvider||""),L=R(o.monthlyWithdrawalUsage||0,o.monthlyWithdrawalLimit),g=R(o.monthlyTransferUsage||0,o.monthlyTransferLimit),u=s=>{switch(s){case"withdrawal":return e.jsx(ce,{className:"h-4 w-4 text-red-500"});case"transfer":return e.jsx(le,{className:"h-4 w-4 text-blue-500"});case"deposit":return e.jsx(me,{className:"h-4 w-4 text-green-500"});default:return e.jsx(ie,{className:"h-4 w-4 text-gray-500"})}},f=s=>{switch(s){case"completed":return e.jsx(ht,{className:"h-4 w-4 text-green-500"});case"pending":return e.jsx(Ke,{className:"h-4 w-4 text-yellow-500"});case"failed":return e.jsx(mt,{className:"h-4 w-4 text-red-500"});default:return e.jsx(qe,{className:"h-4 w-4 text-gray-500"})}},V=s=>{switch(s){case"withdrawal":return"سحب";case"transfer":return"تحويل";case"deposit":return"إيداع";default:return"معاملة"}},Q=s=>{switch(s){case"completed":return"مكتملة";case"pending":return"قيد الانتظار";case"failed":return"فاشلة";default:return"غير محدد"}};return e.jsx(pe,{open:G,onOpenChange:S,children:e.jsxs(Ne,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ve,{className:"pb-4",children:e.jsxs(we,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Me,{className:"h-5 w-5"}),"تفاصيل المحفظة: ",o.name,o.isDefault&&e.jsxs(ne,{variant:"default",className:"mr-2",children:[e.jsx(Fe,{className:"h-3 w-3 mr-1"}),"افتراضية"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsxs(Y,{children:[e.jsx(te,{children:e.jsxs(se,{className:"text-sm flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"المعلومات الأساسية"]})}),e.jsxs($,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(oe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-mono",children:o.phone})]}),o.nationalId&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(he,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-mono",children:o.nationalId})]}),I&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(_e,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:I.name})]}),e.jsxs("div",{className:"text-xs text-gray-600 pr-6",children:[e.jsxs("div",{children:["المالك: ",I.ownerName]}),e.jsxs("div",{className:"font-mono",children:["الرقم القومي: ",I.nationalId]})]})]}),o.lastResetDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(dt,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:["آخر إعادة تعيين: ",new Date(o.lastResetDate).toLocaleDateString("ar-EG")]})]})]})]}),e.jsxs(Y,{children:[e.jsx(te,{children:e.jsxs(se,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"حدود الاستخدام الشهري"]})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"h-3 w-3 text-red-500"}),"السحب الشهري"]}),e.jsxs("span",{className:"font-mono",children:[j(o.monthlyWithdrawalUsage||0)," / ",j(o.monthlyWithdrawalLimit)]})]}),e.jsx(Se,{value:L,className:"h-2"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["متبقي: ",j(o.monthlyWithdrawalLimit-(o.monthlyWithdrawalUsage||0))," جنيه"]})]}),e.jsx(ot,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-3 w-3 text-green-500"}),"التحويل الشهري"]}),e.jsxs("span",{className:"font-mono",children:[j(o.monthlyTransferUsage||0)," / ",j(o.monthlyTransferLimit)]})]}),e.jsx(Se,{value:g,className:"h-2"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["متبقي: ",j(o.monthlyTransferLimit-(o.monthlyTransferUsage||0))," جنيه"]})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(Y,{children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(ce,{className:"h-5 w-5 text-red-500"})}),e.jsx("div",{className:"text-lg font-bold",children:j(a)}),e.jsx("div",{className:"text-xs text-gray-600",children:"إجمالي السحب"})]})}),e.jsx(Y,{children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(le,{className:"h-5 w-5 text-blue-500"})}),e.jsx("div",{className:"text-lg font-bold",children:j(l)}),e.jsx("div",{className:"text-xs text-gray-600",children:"إجمالي التحويل"})]})}),e.jsx(Y,{children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(me,{className:"h-5 w-5 text-green-500"})}),e.jsx("div",{className:"text-lg font-bold",children:j(w)}),e.jsx("div",{className:"text-xs text-gray-600",children:"إجمالي الإيداع"})]})}),e.jsx(Y,{children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(Ce,{className:"h-5 w-5 text-emerald-600"})}),e.jsx("div",{className:"text-lg font-bold",children:j(h)}),e.jsx("div",{className:"text-xs text-gray-600",children:"أرباح الفترة"})]})}),e.jsx(Y,{children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(ie,{className:"h-5 w-5 text-purple-600"})}),e.jsx("div",{className:"text-lg font-bold",children:j(m)}),e.jsx("div",{className:"text-xs text-gray-600",children:"عدد العمليات"})]})})]}),e.jsxs(Y,{children:[e.jsx(te,{children:e.jsxs(se,{className:"text-sm flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"سجل المعاملات"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{size:"sm",variant:B==="week"?"default":"outline",onClick:()=>P("week"),className:"text-xs",children:"أسبوع"}),e.jsx(p,{size:"sm",variant:B==="month"?"default":"outline",onClick:()=>P("month"),className:"text-xs",children:"شهر"}),e.jsx(p,{size:"sm",variant:B==="all"?"default":"outline",onClick:()=>P("all"),className:"text-xs",children:"الكل"})]})]})}),e.jsx($,{children:M?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"جاري تحميل المعاملات..."})]})}):U.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ie,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"لا توجد معاملات في هذه الفترة"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:U.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[u(s.type),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:[V(s.type)," - ",j(s.amount)," جنيه"]}),e.jsx("div",{className:"text-xs text-gray-600",children:E(s.createdAt)}),s.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[f(s.status),e.jsx("span",{className:"text-xs",children:Q(s.status)})]})]},s.id))})})]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsxs(p,{onClick:N,variant:"outline",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"العودة للمحافظ"]}),e.jsx(p,{onClick:S,variant:"outline",children:"إغلاق"})]})]})})},Ue=[{id:"vodafone",name:"فودافون كاش"},{id:"etisalat",name:"اتصالات كاش"},{id:"orange",name:"أورنج كاش"},{id:"we_pay",name:"وي باي"},{id:"smart_wallet",name:"سمارت ولت"},{id:"access_pay",name:"أكسس باي"},{id:"insta_pay",name:"انستا باي"}],At=({isOpen:o,onClose:G,onWalletUpdate:S,initialEditingWallet:N})=>{const{toast:y}=je(),{user:n,userSubscription:v}=ye();(()=>{var c,T;const t=((c=v==null?void 0:v.subscription)==null?void 0:c.planType)??((T=v==null?void 0:v.subscription)==null?void 0:T.plan)??(v==null?void 0:v.planType)??(v==null?void 0:v.plan)??null,r=typeof t=="string"?String(t).trim().toLowerCase():null;return t===Xe.TAHWEELA||r==="tahweela"||r==="تحويله"})(),Qe();const[M,C]=d.useState([]),[B,P]=d.useState(!1),[F,J]=d.useState(null),[R,j]=d.useState(""),[E,K]=d.useState(""),[U,_]=d.useState(""),[z,a]=d.useState(""),[l,w]=d.useState(""),[b,m]=d.useState("200000"),[h,I]=d.useState("200000"),[L,g]=d.useState("100000"),[u,f]=d.useState("60000"),[V,Q]=d.useState(!1),[s,i]=d.useState(null),[W,O]=d.useState(!1),[xe,ae]=d.useState(!1),[ze,ue]=d.useState(!1),[Ie,fe]=d.useState(null),re=()=>`wallets_${(n==null?void 0:n.uid)||"default"}`;d.useEffect(()=>{N&&(J(N),P(!0),j(N.name||""),K(N.phone||""),_(N.ownerName||""),a(N.nationalId||""),w(N.walletProvider||""),m((N.monthlyWithdrawalLimit||2e5).toString()),I((N.monthlyTransferLimit||2e5).toString()),g((N.dailyWithdrawalLimit||1e5).toString()),f((N.dailyTransferLimit||6e4).toString()),Q(!!N.isDefault))},[N]);const Oe=t=>{const r=new Date,c=r.getMonth(),T=r.getFullYear();if(!t.lastResetDate)return{...t,monthlyWithdrawalUsage:t.monthlyWithdrawalUsage||0,monthlyTransferUsage:t.monthlyTransferUsage||0,lastResetDate:r.toISOString().split("T")[0]};const A=new Date(t.lastResetDate),H=A.getMonth(),Z=A.getFullYear();return c!==H||T!==Z?{...t,monthlyWithdrawalUsage:0,monthlyTransferUsage:0,lastResetDate:r.toISOString().split("T")[0]}:t},Ye=async(t,r)=>{const c=new Date().getMonth(),T=new Date().getFullYear(),A=r.filter(D=>{const x=new Date(D.createdAt);return x.getMonth()===c&&x.getFullYear()===T&&D.lineId===t}),H=A.filter(D=>D.txnType==="receive").reduce((D,x)=>D+(x.amount||0),0),Z=A.filter(D=>D.txnType==="send").reduce((D,x)=>D+(x.amount||0),0);return{withdrawalUsage:H,transferUsage:Z}},$e=async(t,r)=>{const c=new Date,T=c.getDate(),A=c.getMonth(),H=c.getFullYear(),Z=r.filter(k=>{const q=new Date(k.createdAt);return q.getDate()===T&&q.getMonth()===A&&q.getFullYear()===H&&k.lineId===t}),D=Z.filter(k=>k.txnType==="receive").reduce((k,q)=>k+(q.amount||0),0),x=Z.filter(k=>k.txnType==="send").reduce((k,q)=>k+(q.amount||0),0);return{withdrawalUsage:D,transferUsage:x}};d.useEffect(()=>{(async()=>{if(!(n!=null&&n.uid)){console.log("No user authenticated, skipping wallet loading"),O(!1);return}console.log("Loading wallets for user:",n.uid),O(!0);try{const{auth:r}=await at(async()=>{const{auth:x}=await import("./index-F79wE54_.js").then(k=>k.cG);return{auth:x}},__vite__mapDeps([0,1]),import.meta.url);let c=0;const T=5;for(;!r.currentUser&&c<T;)console.log(`Waiting for auth state... attempt ${c+1}`),await new Promise(x=>setTimeout(x,1e3)),c++;if(!r.currentUser)throw console.error("User not authenticated in Firebase Auth after retries"),new Error("not authenticated");console.log("Firebase Auth User:",r.currentUser.uid),console.log("Context User:",n.uid),console.log("Fetching wallets from Firebase...");const A=await ee.getByMerchantId(n.uid);console.log("Fetched wallets:",A),console.log("Fetching transactions from Firebase...");const H=await be.getByUserId(n.uid);console.log("Fetched transactions:",H);const D=(await Promise.all(A.map(async x=>{const{withdrawalUsage:k,transferUsage:q}=await Ye(x.id,H),{withdrawalUsage:Je,transferUsage:He}=await $e(x.id,H);return{id:x.id,name:x.label||"محفظة بدون اسم",phone:x.msisdn,ownerName:x.ownerName,nationalId:x.nationalId,isDefault:!1,monthlyWithdrawalLimit:x.withdrawLimit||2e5,monthlyTransferLimit:x.transferLimit||2e5,dailyWithdrawalLimit:x.dailyWithdrawLimit||1e5,dailyTransferLimit:x.dailyTransferLimit||6e4,monthlyWithdrawalUsage:k,monthlyTransferUsage:q,dailyWithdrawalUsage:Je,dailyTransferUsage:He,lastResetDate:new Date().toISOString().split("T")[0],defaultTransferCommission:x.defaultTransferCommission!=null?Number(x.defaultTransferCommission):null,defaultWithdrawCommission:x.defaultWithdrawCommission!=null?Number(x.defaultWithdrawCommission):null}}))).map(Oe);C(D),console.log("Wallets loaded successfully:",D)}catch(r){console.error("Error loading wallets:",r),C([])}finally{O(!1)}})()},[n==null?void 0:n.uid]);const Le=()=>{j(""),K(""),_(""),a(""),w(""),m("200000"),I("200000"),g("100000"),f("60000"),Q(!1),J(null),P(!1)},Be=()=>{j(""),K(""),_(""),a(""),w(""),m("200000"),I("200000"),g("100000"),f("60000"),Q(!1),J(null),P(!0)},Ee=async()=>{if(!R.trim()||!E.trim()||!l.trim()){y({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}if(!(n!=null&&n.uid)){y({title:"خطأ",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}O(!0);try{if(F){await ee.update(F.id,{label:R.trim(),msisdn:E.trim(),ownerName:U.trim(),nationalId:z.trim(),withdrawLimit:parseInt(b),transferLimit:parseInt(h),dailyWithdrawLimit:parseInt(L),dailyTransferLimit:parseInt(u)}),await ge.setLimits(F.id,{dailyTransferLimit:parseInt(u||"0"),dailyWithdrawLimit:parseInt(L||"0"),monthlyTransferLimit:parseInt(h||"0"),monthlyWithdrawLimit:parseInt(b||"0")});const t=M.map(r=>r.id===F.id?{...r,name:R.trim(),phone:E.trim(),ownerName:U.trim(),nationalId:z.trim(),walletProvider:l,monthlyWithdrawalLimit:parseInt(b),monthlyTransferLimit:parseInt(h),dailyWithdrawalLimit:parseInt(L),dailyTransferLimit:parseInt(u)}:r);C(t),localStorage.setItem(re(),JSON.stringify(t)),y({title:"تم التحديث",description:"تم تحديث المحفظة بنجاح"})}else{const t={merchantUserId:n.uid,provider:l,msisdn:E.trim(),label:R.trim(),ownerName:U.trim(),nationalId:z.trim(),isActive:!0,dailyLimit:2e5,monthlyLimit:2e5,withdrawLimit:parseInt(b),transferLimit:parseInt(h),dailyTransferLimit:parseInt(u),dailyWithdrawLimit:parseInt(L),dailyUsage:0,monthlyUsage:0,transferUsage:0,withdrawUsage:0},r=await ee.create(t);await ge.setLimits(r,{dailyTransferLimit:parseInt(u||"0"),dailyWithdrawLimit:parseInt(L||"0"),monthlyTransferLimit:parseInt(h||"0"),monthlyWithdrawLimit:parseInt(b||"0")});const c=new Date().toISOString().split("T")[0],T={id:r,name:R.trim(),phone:E.trim(),ownerName:U.trim(),nationalId:z.trim(),walletProvider:l,isDefault:V,monthlyWithdrawalLimit:parseInt(b),monthlyTransferLimit:parseInt(h),dailyWithdrawalLimit:parseInt(L),dailyTransferLimit:parseInt(u),monthlyWithdrawalUsage:0,monthlyTransferUsage:0,dailyWithdrawalUsage:0,dailyTransferUsage:0,lastResetDate:c,defaultTransferCommission:null,defaultWithdrawCommission:null},A=[...M,T];C(A),localStorage.setItem(re(),JSON.stringify(A)),y({title:"تم الإنشاء",description:"تم إنشاء المحفظة بنجاح"})}S&&S(),Le(),P(!1),J(null)}catch(t){console.error("Error saving wallet:",t),y({title:"خطأ",description:"حدث خطأ أثناء حفظ المحفظة",variant:"destructive"})}finally{O(!1)}},We=t=>{J(t),j(t.name),K(t.phone),_(t.ownerName||""),a(t.nationalId||""),w(t.walletProvider||""),m(t.monthlyWithdrawalLimit.toString()),I(t.monthlyTransferLimit.toString()),Q(t.isDefault),P(!0)},Ve=async t=>{const r=M.find(c=>c.id===t);if(r!=null&&r.isDefault){y({title:"تحذير",description:"لا يمكن حذف المحفظة الافتراضية",variant:"destructive"});return}if(!(n!=null&&n.uid)){y({title:"خطأ",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}O(!0);try{await ee.delete(t);const c=M.filter(T=>T.id!==t);C(c),localStorage.setItem(re(),JSON.stringify(c)),S&&S(),y({title:"تم الحذف",description:"تم حذف المحفظة بنجاح"})}catch(c){console.error("Error deleting wallet:",c),y({title:"خطأ",description:"حدث خطأ أثناء حذف المحفظة",variant:"destructive"})}finally{O(!1)}},Ge=t=>{const r=M.map(c=>({...c,isDefault:c.id===t}));C(r),localStorage.setItem(re(),JSON.stringify(r)),S&&S(),y({title:"تم تحديث المحفظة الافتراضية",description:"تم تعيين المحفظة كافتراضية بنجاح"})};return e.jsxs(pe,{open:o,onOpenChange:G,children:[e.jsxs(Ne,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(ve,{className:"pb-2",children:e.jsxs(we,{className:"flex items-center gap-1 text-sm",children:[e.jsx(de,{className:"h-3 w-3"}),"إدارة المحافظ"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-sm font-semibold",children:["المحافظ المتاحة (",M.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{onClick:()=>{ue(!0)},className:"flex items-center gap-1 h-6 px-2 text-xs",size:"sm",variant:"outline",children:[e.jsx(Ze,{className:"h-3 w-3"}),"الاطلاع على المحافظ"]}),e.jsxs(p,{onClick:()=>{Be()},className:"flex items-center gap-1 h-6 px-2 text-xs",size:"sm",children:[e.jsx(et,{className:"h-3 w-3"}),"إضافة محفظة جديدة"]})]})]}),(B||F)&&e.jsxs(Y,{className:"border-2 border-blue-200 bg-blue-50",children:[e.jsx(te,{className:"pb-1",children:e.jsx(se,{className:"text-sm",children:F?"تعديل المحفظة":"إضافة محفظة جديدة"})}),e.jsxs($,{className:"space-y-2 pt-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"شركة المحفظة"}),e.jsx("div",{className:"flex gap-1 items-center",children:e.jsxs(rt,{value:l,onValueChange:w,children:[e.jsx(nt,{className:"h-6 text-xs flex-1",children:e.jsx(it,{placeholder:"اختر شركة المحفظة"})}),e.jsx(lt,{children:Ue.map(t=>e.jsx(ct,{value:t.id,className:"text-xs",children:e.jsx("div",{className:"flex items-center justify-between w-full",children:e.jsx("span",{children:t.name})})},t.id))})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"اسم المحفظة"}),e.jsx(X,{value:R,onChange:t=>j(t.target.value),placeholder:"مثال: محفظة العمل",className:"h-6 text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(X,{value:E,onChange:t=>K(t.target.value),placeholder:"01030302038",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"اسم مالك المحفظة"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(X,{value:U,onChange:t=>_(t.target.value),placeholder:"أدخل اسم مالك المحفظة",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الرقم القومي للخط"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(X,{value:z,onChange:t=>a(t.target.value),placeholder:"29012345678901",maxLength:14,className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الحد الشهري للسحب (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(X,{type:"number",value:b,onChange:t=>m(t.target.value),placeholder:"200000",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الحد الشهري للتحويل (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(X,{type:"number",value:h,onChange:t=>I(t.target.value),placeholder:"200000",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الحد اليومي للسحب (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-red-400"}),e.jsx(X,{type:"number",value:L,onChange:t=>g(t.target.value),placeholder:"100000",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الحد اليومي للتحويل (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-blue-400"}),e.jsx(X,{type:"number",value:u,onChange:t=>f(t.target.value),placeholder:"60000",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"isDefault",checked:V,onChange:t=>Q(t.target.checked),className:"rounded w-3 h-3"}),e.jsx("label",{htmlFor:"isDefault",className:"text-xs font-medium text-gray-700",children:"تعيين كمحفظة افتراضية"})]}),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(tt,{className:"h-3 w-3 text-gray-600"}),e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"إعدادات العمولة"})]})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(p,{onClick:Ee,className:"flex-1 h-6 text-xs",size:"sm",children:F?"تحديث المحفظة":"إضافة المحفظة"}),e.jsx(p,{variant:"outline",onClick:Le,className:"h-6 text-xs",size:"sm",children:"إلغاء"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:M.map(t=>{var r;return e.jsxs(Y,{className:`${t.isDefault?"border-green-300 bg-green-50":""}`,children:[e.jsx(te,{className:"pb-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(se,{className:"text-sm flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),t.name]}),t.isDefault&&e.jsx(ne,{variant:"default",className:"bg-green-600 text-xs px-1 py-0",children:"افتراضية"})]})}),e.jsxs($,{className:"space-y-1 pt-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"text-xs",children:t.phone})]}),t.walletProvider&&e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:((r=Ue.find(c=>c.id===t.walletProvider))==null?void 0:r.name)||t.walletProvider}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"الحدود الشهرية"}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-red-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((t.monthlyWithdrawalUsage||0)/t.monthlyWithdrawalLimit*100,100)}%`}})}),e.jsx("div",{className:"w-1/2 bg-blue-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((t.monthlyTransferUsage||0)/t.monthlyTransferLimit*100,100)}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-0.5",children:[e.jsxs("div",{className:"text-xs text-red-600 font-medium",children:["متبقي سحب: ",Math.max(t.monthlyWithdrawalLimit-(t.monthlyWithdrawalUsage||0),0)," جنيه"]}),e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["متبقي تحويل: ",Math.max(t.monthlyTransferLimit-(t.monthlyTransferUsage||0),0)," جنيه"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"الحدود اليومية"}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-orange-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-orange-400 to-orange-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((t.dailyWithdrawalUsage||0)/t.dailyWithdrawalLimit*100,100)}%`}})}),e.jsx("div",{className:"w-1/2 bg-green-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-green-400 to-green-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((t.dailyTransferUsage||0)/t.dailyTransferLimit*100,100)}%`}})})]}),e.jsxs("div",{className:"flex justify بين items-center mt-0.5",children:[e.jsxs("div",{className:"text-xs text-orange-600 font-medium",children:["متبقي سحب يومي: ",Math.max(t.dailyWithdrawalLimit-(t.dailyWithdrawalUsage||0),0)," جنيه"]}),e.jsxs("div",{className:"text-xs text-green-600 font-medium",children:["متبقي تحويل يومي: ",Math.max(t.dailyTransferLimit-(t.dailyTransferUsage||0),0)," جنيه"]})]})]})]}),e.jsxs("div",{className:"flex gap-1 pt-1",children:[e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>We(t),className:"flex-1 h-5 text-xs px-1",children:[e.jsx(Re,{className:"h-2 w-2 mr-0.5"}),"تعديل"]}),!t.isDefault&&e.jsxs(e.Fragment,{children:[e.jsx(p,{size:"sm",variant:"outline",onClick:()=>Ge(t.id),className:"flex-1 h-5 text-xs px-1",children:"جعلها افتراضية"}),e.jsx(p,{size:"sm",variant:"destructive",onClick:()=>Ve(t.id),className:"h-5 px-1",children:e.jsx(Pe,{className:"h-2 w-2"})})]})]})]})]},t.id)})}),M.length===0&&e.jsx("div",{className:"text-center py-4 text-gray-500 text-xs",children:"لا توجد محافظ متاحة. قم بإضافة محفظة جديدة للبدء."})]}),e.jsx(p,{variant:"ghost",size:"icon",className:"fixed bottom-6 right-6 h-14 w-14 rounded-full bg-red-600 text-white shadow-lg hover:bg-red-700 hover:scale-105 transition-all duration-300 z-[60]",onClick:t=>{t.preventDefault(),t.stopPropagation(),G()},children:e.jsx(Te,{className:"h-6 w-6"})})]}),e.jsx(st,{open:ze,onOpenChange:ue,mode:"verify",title:"إدخال الرقم السري الرئيسي",description:"لا يمكن الاطلاع على المحافظ إلا بإدخال الرقم السري الرئيسي",userId:n==null?void 0:n.uid,onSuccess:()=>{ue(!1),ae(!0)}}),e.jsx(gt,{isOpen:xe,onClose:()=>ae(!1),onWalletSelect:t=>{fe(t),ae(!1)},onEditWallet:t=>{We(t),ae(!1)},onDeleteWallet:async t=>{try{if(await ee.delete(t),C(r=>{const c=r.filter(T=>T.id!==t);try{localStorage.setItem(re(),JSON.stringify(c))}catch(T){console.error("Failed to update localStorage wallets after delete:",T)}return c}),S)try{await S()}catch(r){console.error("onWalletUpdate callback failed:",r)}}catch(r){console.error("Error deleting wallet:",r)}}}),e.jsx(jt,{wallet:Ie,isOpen:!!Ie,onClose:()=>fe(null),onBack:()=>{fe(null),ae(!0)}})]})};export{At as default};
//# sourceMappingURL=WalletManagement-CbL_OaSL.js.map
