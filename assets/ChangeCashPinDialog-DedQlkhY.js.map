{"version":3,"file":"ChangeCashPinDialog-DedQlkhY.js","sources":["../../src/components/ChangeCashPinDialog.tsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Lock, Eye, EyeOff, AlertCircle, DollarSign } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\nconst cashPinsCache: Map<string, string> = new Map();\r\n\r\ninterface ChangeCashPinDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  userId?: string;\r\n}\r\n\r\nexport function ChangeCashPinDialog({ open, onOpenChange, userId }: ChangeCashPinDialogProps) {\r\n  const [currentPin, setCurrentPin] = useState('');\r\n  const [newPin, setNewPin] = useState('');\r\n  const [confirmPin, setConfirmPin] = useState('');\r\n  const [showCurrentPin, setShowCurrentPin] = useState(false);\r\n  const [showNewPin, setShowNewPin] = useState(false);\r\n  const [showConfirmPin, setShowConfirmPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  const CASH_PIN_KEY = userId ? `cash_drawer_pin_${userId}` : 'cash_drawer_pin';\r\n  \r\n  const hasExistingPin = () => {\r\n    return cashPinsCache.has(CASH_PIN_KEY);\r\n  };\r\n\r\n  const verifyCurrentPin = (pin: string) => {\r\n    const savedPin = cashPinsCache.get(CASH_PIN_KEY);\r\n    if (!savedPin) return false;\r\n    \r\n    try {\r\n      const decodedPin = atob(savedPin);\r\n      return decodedPin === pin;\r\n    } catch {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const saveNewPin = (pin: string) => {\r\n    const encodedPin = btoa(pin);\r\n    cashPinsCache.set(CASH_PIN_KEY, encodedPin);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      // ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ุงููุฏุฎูุฉ\r\n      if (!newPin || newPin.length < 4) {\r\n        setError('ูุฌุจ ุฃู ูููู ุงูุฑูู ุงูุณุฑู 4 ุฃุฑูุงู ุนูู ุงูุฃูู');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (newPin !== confirmPin) {\r\n        setError('ุงูุฑูู ุงูุณุฑู ุงูุฌุฏูุฏ ูุชุฃููุฏู ุบูุฑ ูุชุทุงุจููู');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      // ุฅุฐุง ูุงู ููุงู ุฑูู ุณุฑู ููุฌูุฏุ ูุฌุจ ุงูุชุญูู ููู ุฃููุงู\r\n      if (hasExistingPin()) {\r\n        if (!currentPin) {\r\n          setError('ูุฑุฌู ุฅุฏุฎุงู ุงูุฑูู ุงูุณุฑู ุงูุญุงูู ูุฏุฑุฌ ุงูููุฏูุฉ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        if (!verifyCurrentPin(currentPin)) {\r\n          setError('ุงูุฑูู ุงูุณุฑู ุงูุญุงูู ูุฏุฑุฌ ุงูููุฏูุฉ ุบูุฑ ุตุญูุญ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      // ุญูุธ ุงูุฑูู ุงูุณุฑู ุงูุฌุฏูุฏ\r\n      saveNewPin(newPin);\r\n\r\n      // ุฅุธูุงุฑ ุฑุณุงูุฉ ูุฌุงุญ\r\n      toast({\r\n        title: hasExistingPin() ? \"ุชู ุชุบููุฑ ุฑูู ุฏุฑุฌ ุงูููุฏูุฉ\" : \"ุชู ุชุนููู ุฑูู ุฏุฑุฌ ุงูููุฏูุฉ\",\r\n        description: hasExistingPin() \r\n          ? \"ุชู ุชุบููุฑ ุงูุฑูู ุงูุณุฑู ูุฏุฑุฌ ุงูููุฏูุฉ ุจูุฌุงุญ\" \r\n          : \"ุชู ุชุนููู ุงูุฑูู ุงูุณุฑู ูุฏุฑุฌ ุงูููุฏูุฉ ุจูุฌุงุญ\",\r\n      });\r\n\r\n      // ุฅุบูุงู ุงููุงูุฐุฉ ูุฅุนุงุฏุฉ ุชุนููู ุงูุญููู\r\n      handleClose();\r\n    } catch (error) {\r\n      setError('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงูุฑูู ุงูุณุฑู ูุฏุฑุฌ ุงูููุฏูุฉ');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setCurrentPin('');\r\n    setNewPin('');\r\n    setConfirmPin('');\r\n    setError('');\r\n    setShowCurrentPin(false);\r\n    setShowNewPin(false);\r\n    setShowConfirmPin(false);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            <DollarSign className=\"h-5 w-5 text-green-600\" />\r\n            {hasExistingPin() ? \"ุชุบููุฑ ุฑูู ุฏุฑุฌ ุงูููุฏูุฉ\" : \"ุชุนููู ุฑูู ุฏุฑุฌ ุงูููุฏูุฉ\"}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-muted-foreground text-right\">\r\n            {hasExistingPin() \r\n              ? \"ุฃุฏุฎู ุงูุฑูู ุงูุณุฑู ุงูุญุงูู ูุงูุฑูู ุงูุณุฑู ุงูุฌุฏูุฏ ูุฏุฑุฌ ุงูููุฏูุฉ\"\r\n              : \"ุฃุฏุฎู ุงูุฑูู ุงูุณุฑู ุงูุฌุฏูุฏ ุงูุฐู ุชุฑูุฏ ุงุณุชุฎุฏุงูู ูุญูุงูุฉ ุฏุฑุฌ ุงูููุฏูุฉ\"\r\n            }\r\n          </div>\r\n\r\n          {/* ุงูุฑูู ุงูุณุฑู ุงูุญุงูู (ุฅุฐุง ูุงู ููุฌูุฏุงู) */}\r\n          {hasExistingPin() && (\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"currentPin\" className=\"text-right block\">\r\n                ุงูุฑูู ุงูุณุฑู ุงูุญุงูู ูุฏุฑุฌ ุงูููุฏูุฉ\r\n              </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"currentPin\"\r\n                  type={showCurrentPin ? \"text\" : \"password\"}\r\n                  autoComplete=\"off\"\r\n                  value={currentPin}\r\n                  onChange={(e) => setCurrentPin(e.target.value)}\r\n                  placeholder=\"ุฃุฏุฎู ุงูุฑูู ุงูุณุฑู ุงูุญุงูู\"\r\n                  className=\"pr-10\"\r\n                  dir=\"ltr\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowCurrentPin(!showCurrentPin)}\r\n                >\r\n                  {showCurrentPin ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* ุงูุฑูู ุงูุณุฑู ุงูุฌุฏูุฏ */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"newPin\" className=\"text-right block\">\r\n              ุงูุฑูู ุงูุณุฑู ุงูุฌุฏูุฏ ูุฏุฑุฌ ุงูููุฏูุฉ\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"newPin\"\r\n                type={showNewPin ? \"text\" : \"password\"}\r\n                autoComplete=\"off\"\r\n                value={newPin}\r\n                onChange={(e) => setNewPin(e.target.value)}\r\n                placeholder=\"ุฃุฏุฎู ุงูุฑูู ุงูุณุฑู ุงูุฌุฏูุฏ\"\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowNewPin(!showNewPin)}\r\n              >\r\n                {showNewPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* ุชุฃููุฏ ุงูุฑูู ุงูุณุฑู ุงูุฌุฏูุฏ */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"confirmPin\" className=\"text-right block\">\r\n              ุชุฃููุฏ ุงูุฑูู ุงูุณุฑู ุงูุฌุฏูุฏ\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"confirmPin\"\r\n                type={showConfirmPin ? \"text\" : \"password\"}\r\n                autoComplete=\"off\"\r\n                value={confirmPin}\r\n                onChange={(e) => setConfirmPin(e.target.value)}\r\n                placeholder=\"ุฃุนุฏ ุฅุฏุฎุงู ุงูุฑูู ุงูุณุฑู ุงูุฌุฏูุฏ\"\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowConfirmPin(!showConfirmPin)}\r\n              >\r\n                {showConfirmPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* ุฑุณุงูุฉ ุงูุฎุทุฃ */}\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-red-600 text-sm\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {/* ุฃุฒุฑุงุฑ ุงูุชุญูู */}\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              className=\"flex-1 bg-green-600 hover:bg-green-700\"\r\n            >\r\n              <Lock className=\"h-4 w-4 mr-2\" />\r\n              {isLoading ? \"ุฌุงุฑู ุงูุญูุธ...\" : (hasExistingPin() ? \"ุชุบููุฑ ุฑูู ุฏุฑุฌ ุงูููุฏูุฉ\" : \"ุชุนููู ุฑูู ุฏุฑุฌ ุงูููุฏูุฉ\")}\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              disabled={isLoading}\r\n            >\r\n              ุฅูุบุงุก\r\n            </Button>\r\n          </div>\r\n        </form>\r\n\r\n        <div className=\"text-xs text-gray-500 text-center mt-2\">\r\n          ๐ฐ ูุฐุง ุงูุฑูู ุงูุณุฑู ุฎุงุต ุจุญูุงูุฉ ุฏุฑุฌ ุงูููุฏูุฉ ููุท\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}"],"names":["cashPinsCache","ChangeCashPinDialog","open","onOpenChange","userId","currentPin","setCurrentPin","useState","newPin","setNewPin","confirmPin","setConfirmPin","showCurrentPin","setShowCurrentPin","showNewPin","setShowNewPin","showConfirmPin","setShowConfirmPin","error","setError","isLoading","setIsLoading","toast","useToast","CASH_PIN_KEY","hasExistingPin","verifyCurrentPin","pin","savedPin","saveNewPin","encodedPin","handleSubmit","e","handleClose","jsx","Dialog","DialogContent","DialogHeader","jsxs","DialogTitle","DollarSign","Label","Input","Button","EyeOff","Eye","AlertCircle","Lock"],"mappings":"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"}