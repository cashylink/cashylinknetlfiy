const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dailyOperationCountService-BuoXgFag-ByT7vHq7.js","./index-BsVRzvOf.js","./index-Bpuv6Nub.css","./profitService-4r9FqAF7-Hn6SWIj-.js"])))=>i.map(i=>d[i]);
import{C as Ca,W as kt,j as ve,a9 as Z,aB as Da,w as _a,S as u,aC as b,as as U,v as Q,G as W,L as re,z as ne,R as ie,aj as K,f as At,aD as Ea,e as ka,aE as fe,u as La,p as Ze,B as ce,I as t,a as E,t as qe,b as Lt,aF as Pa,aG as Tt,ad as Ia,aH as Oa,aI as Ie,aJ as Oe,aK as Re,aL as Fe,A as Ke,aM as Ra,Z as G,_ as H,a0 as ke,aN as Fa,aO as $a,aP as Wa,aQ as $e,aR as tt,Y as Je,aS as St,m as Ct,aT as Ye,aU as Ma,at as Qe}from"./index-BsVRzvOf.js";import{o as Ba,c as za,i as Ua,l as Va}from"./card-SlwaggFS-BswsJdJN.js";import{o as Xa,$ as Ga,r as Ha,Z as Za,Q as Le,X as qa}from"./select-QKdc2TYn-4nnF_b5r.js";import{d as Pe}from"./badge-Cq-GDK1F-DqoYRGyo.js";import{l as Pt,f as Ka,d as Ya}from"./index-CS8iiUxP-o3s-AvoK.js";import{P as Qa,R as Ja,l as V,_ as es,j as ts,O as as,G as ss,M as Dt,V as _t}from"./MaintenanceDialog-BLQvmu15-CR1GbJWU.js";import{E as et,N as rs}from"./MasterPinDialog-CDin1iyv-BfIYYvfI.js";import{ProfitService as ge}from"./profitService-4r9FqAF7-Hn6SWIj-.js";import{o as ns}from"./dollar-sign-bNLkxbzG-Dyq9Naiu.js";import{a as It}from"./calendar-DYpYXkMW-DdYk4Ijy.js";import{t as is}from"./arrow-left-BDVMu6ut-7df8sdbj.js";import{S as ls}from"./separator-Dk6MyxBB-Dcj4B0Mo.js";import{L as Et}from"./progress-BOoGedvV-DsOOhwhn.js";import{r as os}from"./circle-x-CAZlwHZs-PgSdbLi6.js";import{t as ds}from"./circle-check-big-DcMEd0KV-CypIUhpt.js";import"./download-DFIibxe--CsopZRn5.js";import"./label-_mnIMROJ-DudSd8Mh.js";import"./circle-alert-BbiXZQj6-CJFrf0QN.js";import"./shield-DSoskD-c-BzN5L-qY.js";import"./whatsappService-D7s14JCG-CtNQG8BW.js";const X=(h,A=X,S=A.f||(A.f=["./dailyOperationCountService-BuoXgFag.js","./index-tnWDkOuX.js","./index-Bpuv6Nub.css","./profitService-4r9FqAF7.js"]))=>h.map(D=>S[D]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=Lt("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const us=Lt("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);var We="Tabs",[ms]=$a(We,[Pt]),Ot=Pt(),[ps,at]=ms(We),Rt=u.forwardRef((h,A)=>{const{__scopeTabs:S,value:D,onValueChange:R,defaultValue:P,orientation:k="horizontal",dir:z,activationMode:O="automatic",...M}=h,r=qa(z),[v,y]=Fa({prop:D,onChange:R,defaultProp:P??"",caller:We});return t.jsx(ps,{scope:S,baseId:Wa(),value:v,onValueChange:y,orientation:k,dir:r,activationMode:O,children:t.jsx($e.div,{dir:r,"data-orientation":k,...M,ref:A})})});Rt.displayName=We;var Ft="TabsList",$t=u.forwardRef((h,A)=>{const{__scopeTabs:S,loop:D=!0,...R}=h,P=at(Ft,S),k=Ot(S);return t.jsx(Ka,{asChild:!0,...k,orientation:P.orientation,dir:P.dir,loop:D,children:t.jsx($e.div,{role:"tablist","aria-orientation":P.orientation,...R,ref:A})})});$t.displayName=Ft;var Wt="TabsTrigger",Mt=u.forwardRef((h,A)=>{const{__scopeTabs:S,value:D,disabled:R=!1,...P}=h,k=at(Wt,S),z=Ot(S),O=Ut(k.baseId,D),M=Vt(k.baseId,D),r=D===k.value;return t.jsx(Ya,{asChild:!0,...z,focusable:!R,active:r,children:t.jsx($e.button,{type:"button",role:"tab","aria-selected":r,"aria-controls":M,"data-state":r?"active":"inactive","data-disabled":R?"":void 0,disabled:R,id:O,...P,ref:A,onMouseDown:Ye(h.onMouseDown,v=>{!R&&v.button===0&&v.ctrlKey===!1?k.onValueChange(D):v.preventDefault()}),onKeyDown:Ye(h.onKeyDown,v=>{[" ","Enter"].includes(v.key)&&k.onValueChange(D)}),onFocus:Ye(h.onFocus,()=>{const v=k.activationMode!=="manual";!r&&!R&&v&&k.onValueChange(D)})})})});Mt.displayName=Wt;var Bt="TabsContent",zt=u.forwardRef((h,A)=>{const{__scopeTabs:S,value:D,forceMount:R,children:P,...k}=h,z=at(Bt,S),O=Ut(z.baseId,D),M=Vt(z.baseId,D),r=D===z.value,v=u.useRef(r);return u.useEffect(()=>{const y=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(y)},[]),t.jsx(Ma,{present:R||r,children:({present:y})=>t.jsx($e.div,{"data-state":r?"active":"inactive","data-orientation":z.orientation,role:"tabpanel","aria-labelledby":O,hidden:!y,id:M,tabIndex:0,...k,ref:A,style:{...h.style,animationDuration:v.current?"0s":void 0},children:y&&P})})});zt.displayName=Bt;function Ut(h,A){return`${h}-trigger-${A}`}function Vt(h,A){return`${h}-content-${A}`}var hs=Rt,Xt=$t,Gt=Mt,Ht=zt;const xs=hs,Zt=u.forwardRef(({className:h,...A},S)=>t.jsx(Xt,{ref:S,className:tt("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",h),...A}));Zt.displayName=Xt.displayName;const we=u.forwardRef(({className:h,...A},S)=>t.jsx(Gt,{ref:S,className:tt("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",h),...A}));we.displayName=Gt.displayName;const be=u.forwardRef(({className:h,...A},S)=>t.jsx(Ht,{ref:S,className:tt("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",h),...A}));be.displayName=Ht.displayName;const vs=({userId:h,transactions:A=[]})=>{const[S,D]=u.useState(!1),[R,P]=u.useState(!1),[k,z]=u.useState(!1),[O,M]=u.useState({dailyWithdraw:0,dailyTransfer:0,monthlyWithdraw:0,monthlyTransfer:0,lastUpdated:new Date}),{userSubscription:r}=kt();u.useEffect(()=>{h&&S&&k&&Be()},[h,S,k]);const v=_=>`${_.toFixed(2)} ج.م`,y=async()=>{try{const _=(r==null?void 0:r.subscription)||null,g=(_==null?void 0:_.planType)??(_==null?void 0:_.plan)??null,w=typeof g=="string"?g.toLowerCase():null;if(g===Z.ZERO||w==="zero"||w==="0"||g===0)return!0}catch{}try{if(h){const _=await Qe(h),g=(_==null?void 0:_.planType)??(_==null?void 0:_.plan)??null,w=typeof g=="string"?g.toLowerCase():null;if(g===Z.ZERO||w==="zero"||w==="0"||g===0)return!0}}catch{}return!1},J=async()=>{try{const _=await(async()=>{try{const g=(r==null?void 0:r.subscription)||null,w=(g==null?void 0:g.planType)??(g==null?void 0:g.plan)??null,F=typeof w=="string"?w.toLowerCase():null;if(w===Z.TAHWEELA||F==="tahweela")return!0}catch{}try{if(h){const g=await Qe(h),w=(g==null?void 0:g.planType)??(g==null?void 0:g.plan)??null,F=typeof w=="string"?w.toLowerCase():null;if(w===Z.TAHWEELA||F==="tahweela")return!0}}catch{}return!1})();if(await y()||_){b({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"});return}}catch{}P(!0)},Me=async()=>{try{const _=await(async()=>{try{const g=(r==null?void 0:r.subscription)||null,w=(g==null?void 0:g.planType)??(g==null?void 0:g.plan)??null,F=typeof w=="string"?w.toLowerCase():null;if(w===Z.TAHWEELA||F==="tahweela")return!0}catch{}try{if(h){const g=await Qe(h),w=(g==null?void 0:g.planType)??(g==null?void 0:g.plan)??null,F=typeof w=="string"?w.toLowerCase():null;if(w===Z.TAHWEELA||F==="tahweela")return!0}}catch{}return!1})();if(await y()||_){b({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"}),P(!1);return}}catch{}z(!0),D(!0),P(!1)},Be=async()=>{if(h)try{if(Array.isArray(A)&&A.length>0){const g=new Date,w=g.getMonth(),F=g.getFullYear(),ue=St.filterVisibleTransactions(A,"daily",h),le=St.filterVisibleTransactions(A,"monthly",h);let oe=0,ee=0,ye=0,te=0;ue.forEach(C=>{const Y=new Date(C.createdAt),q=String(C.status||"confirmed").toLowerCase();if(Y.toDateString()!==g.toDateString()||q!=="completed"&&q!=="confirmed"&&q!=="pending")return;const ae=(C.type||C.txnType||"").toLowerCase(),L={type:ae==="withdrawal"?"withdraw":ae,amount:Number(C.amount||0),commission:C.commission};L.type==="withdraw"?oe+=ge.calculateProfitFromTransaction(L):(L.type==="send"||L.type==="receive"||L.type==="transfer")&&(ee+=ge.calculateProfitFromTransaction(L))}),le.forEach(C=>{const Y=new Date(C.createdAt),q=String(C.status||"confirmed").toLowerCase();if(Y.getMonth()!==w||Y.getFullYear()!==F||q!=="completed"&&q!=="confirmed"&&q!=="pending")return;const ae=(C.type||C.txnType||"").toLowerCase(),L={type:ae==="withdrawal"?"withdraw":ae,amount:Number(C.amount||0),commission:C.commission};L.type==="withdraw"?ye+=ge.calculateProfitFromTransaction(L):(L.type==="send"||L.type==="receive"||L.type==="transfer")&&(te+=ge.calculateProfitFromTransaction(L))}),M({dailyWithdraw:Math.round(oe*100)/100,dailyTransfer:Math.round(ee*100)/100,monthlyWithdraw:Math.round(ye*100)/100,monthlyTransfer:Math.round(te*100)/100,lastUpdated:new Date});return}const _=ge.getWithdrawTransferProfits(h);M({dailyWithdraw:_.dailyWithdrawProfit||0,dailyTransfer:_.dailyTransferProfit||0,monthlyWithdraw:_.monthlyWithdrawProfit||0,monthlyTransfer:_.monthlyTransferProfit||0,lastUpdated:new Date})}catch(_){console.error("Error loading total profits:",_)}};return t.jsxs(t.Fragment,{children:[t.jsx(E,{size:"sm",variant:"ghost",onClick:J,className:"h-2 w-2 p-0 bg-gradient-to-r from-blue-100 to-purple-200 text-purple-700 hover:from-blue-200 hover:to-purple-300 hover:text-purple-800 rounded transition-all duration-300 hover:scale-110 shadow-sm hover:shadow-md",title:"عرض إجمالي الأرباح",children:t.jsx(Ct,{className:"h-1.5 w-1.5"})}),t.jsx(Ie,{open:S,onOpenChange:D,children:t.jsxs(Oe,{className:"max-w-[240px] mx-auto bg-white border border-gray-200 shadow-md rounded sm:max-w-[220px] sm:bg-gradient-to-br sm:from-purple-50 sm:to-white sm:border-2 sm:border-purple-200 sm:shadow-2xl sm:rounded-2xl",children:[t.jsx(Re,{className:"text-center pb-0 border-b-0 sm:pb-2 sm:border-b sm:border-purple-200",children:t.jsxs(Fe,{className:"text-xs font-bold text-purple-800 flex items-center justify-center gap-1 mb-0 leading-tight tracking-tight sm:text-xs sm:gap-1 sm:mb-0 sm:leading-normal sm:tracking-normal",children:[t.jsx(ns,{className:"h-2 w-2 text-purple-600 sm:h-3 sm:w-3"}),"إجمالي الأرباح (فوري)"]})}),t.jsxs("div",{className:"space-y-1 py-1 sm:space-y-2 sm:py-2",children:[t.jsxs("div",{className:"bg-blue-50 p-1 rounded border border-blue-200 sm:bg-gradient-to-r sm:from-blue-50 sm:to-blue-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Je,{className:"h-2 w-2 text-blue-600"}),t.jsx("span",{className:"text-[10px] font-semibold text-blue-800",children:"يومي"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-900",children:v((O.dailyWithdraw??0)+(O.dailyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 p-0.5 rounded border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Dt,{className:"h-2 w-2 text-red-600"}),t.jsx("span",{className:"text-[10px] text-red-800",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700",children:v(O.dailyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-green-50 p-0.5 rounded border border-green-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(_t,{className:"h-2 w-2 text-green-600"}),t.jsx("span",{className:"text-[10px] text-green-800",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-green-700",children:v(O.dailyTransfer)})]})]})]}),t.jsxs("div",{className:"bg-purple-50 p-1 rounded border border-purple-200 sm:bg-gradient-to-r sm:from-purple-50 sm:to-purple-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(It,{className:"h-2 w-2 text-purple-600"}),t.jsx("span",{className:"text-[10px] font-semibold text-purple-800",children:"شهري"})]}),t.jsx("span",{className:"text-[10px] font-bold text-purple-900",children:v((O.monthlyWithdraw??0)+(O.monthlyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 p-0.5 rounded border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Dt,{className:"h-2 w-2 text-red-600"}),t.jsx("span",{className:"text-[10px] text-red-800",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700",children:v(O.monthlyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-0.5 rounded border border-blue-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(_t,{className:"h-2 w-2 text-blue-600"}),t.jsx("span",{className:"text-[10px] text-blue-800",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-700",children:v(O.monthlyTransfer)})]})]})]})]}),!k&&t.jsx("div",{className:"absolute inset-0 bg-yellow-200/70 backdrop-blur-sm flex items-center justify-center rounded sm:rounded-2xl border border-yellow-300 pointer-events-auto",children:t.jsx(E,{size:"sm",variant:"ghost",onClick:()=>P(!0),className:"p-2 bg-yellow-300/80 text-yellow-900 hover:bg-yellow-400/90 rounded-full shadow-sm hover:shadow-md transition-all duration-300",title:"إدخال الرقم السري الرئيسي",children:t.jsx(Ct,{className:"h-4 w-4"})})}),t.jsx("div",{className:"flex justify-center pt-1 border-t-0 sm:pt-2 sm:border-t sm:border-purple-200",children:t.jsx(E,{onClick:()=>D(!1),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-1 rounded-xl text-xs sm:bg-gradient-to-r sm:from-purple-600 sm:to-purple-700 sm:hover:from-purple-700 sm:hover:to-purple-800 sm:px-4 sm:py-1 sm:rounded-xl sm:shadow-lg sm:hover:shadow-xl sm:transition-all sm:duration-300",children:"إغلاق"})})]})}),t.jsx(et,{open:R,onOpenChange:P,onSuccess:Me,description:"لا يمكن الاطلاع على إجمالي الأرباح إلا بإدخال الرقم السري الرئيسي"})]})},fs=h=>t.jsx(vs,{...h}),Vs=()=>{var h,A,S,D,R,P,k,z,O;const M=Ca(),{user:r,profile:v,userSubscription:y}=kt(),J=ve.useMemo(()=>{var e,s,i,n;const a=((e=y==null?void 0:y.subscription)==null?void 0:e.planType)??((s=y==null?void 0:y.subscription)==null?void 0:s.plan)??((i=v==null?void 0:v.subscription)==null?void 0:i.planType)??((n=v==null?void 0:v.subscription)==null?void 0:n.plan)??null;return a===Z.ZERO||String(a).toLowerCase()==="zero"},[(h=y==null?void 0:y.subscription)==null?void 0:h.planType,(A=y==null?void 0:y.subscription)==null?void 0:A.plan,(S=v==null?void 0:v.subscription)==null?void 0:S.planType,(D=v==null?void 0:v.subscription)==null?void 0:D.plan]),Me=ve.useMemo(()=>{var e,s,i,n;const a=((e=y==null?void 0:y.subscription)==null?void 0:e.planType)??((s=y==null?void 0:y.subscription)==null?void 0:s.plan)??((i=v==null?void 0:v.subscription)==null?void 0:i.planType)??((n=v==null?void 0:v.subscription)==null?void 0:n.plan)??null;return a===Z.TAHWEELA||String(a).toLowerCase()==="tahweela"},[(R=y==null?void 0:y.subscription)==null?void 0:R.planType,(P=y==null?void 0:y.subscription)==null?void 0:P.plan,(k=v==null?void 0:v.subscription)==null?void 0:k.planType,(z=v==null?void 0:v.subscription)==null?void 0:z.plan]),{shopName:Be}=Da(),{isShiftActive:_,shiftUser:g}=_a(),[w,F]=u.useState([]),[ue,le]=u.useState([]),[oe,ee]=u.useState(new Set),[ye,te]=u.useState(!1),[C,Y]=u.useState(null),[q,ae]=u.useState("all"),[L,st]=u.useState(""),[me,qt]=u.useState(""),[pe,Kt]=u.useState(""),[gs,Yt]=u.useState(!1),[Qt,ze]=u.useState(!1),[Jt,rt]=u.useState(!1),[ea,nt]=u.useState(!1),[it,lt]=u.useState(""),[ta,ot]=u.useState("شرح التطبيق"),[ws,dt]=u.useState(null),[je,aa]=u.useState(null),[sa,Ne]=u.useState(!1);ve.useEffect(()=>{var e;((e=y==null?void 0:y.subscription)==null?void 0:e.planType)===Z.TAHWEELA&&(b({title:"غير متاح لاشتراكك",description:"صفحة المعاملات غير متاحة في باقة تحويله. استخدم لوحة المستخدم للتحويل/السحب فقط.",variant:"destructive"}),M("/user/dashboard"))},[(O=y==null?void 0:y.subscription)==null?void 0:O.planType]);const[bs,ra]=u.useState(!1),[ys,na]=u.useState(!1),[js,Ns]=u.useState(!1),[ia,Ue]=u.useState(!1),[la,ct]=u.useState(!1),[oa,ut]=u.useState(!1),[da,Ve]=u.useState(!1),[ca,ua]=u.useState(null),[ma,Ae]=u.useState(!1),[mt,Te]=u.useState({keepLastCount:30,intervalDays:7,lastResetAt:null});u.useEffect(()=>{(async()=>{if(r!=null&&r.uid)try{const e=await U.getUserData(r.uid),s=(e==null?void 0:e.recentReset)||{},i=Number(s==null?void 0:s.keepLastCount)>0?Number(s.keepLastCount):30,n=Number(s==null?void 0:s.intervalDays)>0?Number(s.intervalDays):7,a=p=>p instanceof Date?p:typeof(p==null?void 0:p.toDate)=="function"?p.toDate():p?new Date(String(p)):null,l=s!=null&&s.lastResetAt?a(s.lastResetAt):null,d=new Date;!l||d.getTime()-l.getTime()>=n*24*60*60*1e3?(await U.updateUserData(r.uid,{recentReset:{keepLastCount:i,intervalDays:n,lastResetAt:d}}),Te({keepLastCount:i,intervalDays:n,lastResetAt:d})):Te({keepLastCount:i,intervalDays:n,lastResetAt:l})}catch{Te({keepLastCount:30,intervalDays:7,lastResetAt:null})}})()},[r==null?void 0:r.uid]),u.useEffect(()=>{if(!(r!=null&&r.uid))return;const e=Q(W,"users",r.uid),s=re(e,i=>{try{const n=i.exists()?i.data():{},a=n==null?void 0:n.tutorialSeenAt,l=a!=null&&a.toDate?a.toDate():a?new Date(a):null;aa(l)}catch{}});return()=>s()},[r==null?void 0:r.uid]),u.useEffect(()=>{const e=re(Q(W,"app_guides","latest"),s=>{try{const i=s.exists()?s.data():null;if(!i){lt(""),ot(""),dt(null),Ne(!1);return}const n=String(i.url||""),a=String(i.title||"شرح التطبيق"),l=i.publishedAt,d=l!=null&&l.toDate?l.toDate():l?new Date(l):new Date;lt(n),ot(a),dt(d),Ne(d?!je||d.getTime()>((je==null?void 0:je.getTime())||0):!1)}catch{Ne(!1)}},s=>{console.warn("فشل الاشتراك في دليل التطبيق:",s)});return()=>e()},[je]);const pa=e=>{try{const s=new URL(e);let i="";return s.hostname.includes("youtube.com")?s.pathname==="/watch"?i=s.searchParams.get("v")||"":(s.pathname.startsWith("/embed/")||s.pathname.startsWith("/shorts/"))&&(i=s.pathname.split("/").pop()||""):s.hostname==="youtu.be"&&(i=s.pathname.replace(/^\//,"")),i?`https://www.youtube.com/embed/${i}?autoplay=1&rel=0`:e}catch{return e}},ha=async()=>{nt(!0);try{r!=null&&r.uid&&await U.updateUserData(r.uid,{tutorialSeenAt:new Date}),Ne(!1)}catch{}},[xa,Se]=u.useState(!1),[Ce,pt]=u.useState(""),[he,ht]=u.useState(""),[De,xt]=u.useState(""),[vt,ft]=u.useState(!1),[gt,_e]=u.useState(0);u.useEffect(()=>{if(!(r!=null&&r.uid)){_e(0);return}const e=Q(W,"users",r.uid),s=re(e,i=>{try{const n=i.exists()?i.data():{},a=(Array.isArray(n==null?void 0:n.debts)?n.debts:[]).filter(l=>(l==null?void 0:l.status)==="pending"&&(Number(l==null?void 0:l.amount)||0)>0).length;_e(a)}catch{_e(0)}},i=>{console.warn("فشل الاشتراك في ديون المستخدم من Firestore:",i),_e(0)});return()=>s()},[r==null?void 0:r.uid]),u.useEffect(()=>{va(),fa()},[r]),u.useEffect(()=>{if(!(r!=null&&r.uid))return;let e=null,s=null;try{const i=ne(ie(W,"deletedTransactions"),K("userId","==",r.uid));e=re(i,n=>{try{const a=[];n.docChanges().forEach(l=>{const d=l.doc.data(),p=[d.originalTransactionId,d.transactionId,d.reference,l.doc.id].filter(Boolean).map(m=>String(m));a.push(...p)}),a.length>0&&(ee(l=>{const d=new Set(l);return a.forEach(p=>d.add(p)),d}),F(l=>l.filter(d=>{const p=String(d.id||""),m=String(d.transactionId||""),N=String(d.reference||"");return!(a.includes(p)||a.includes(m)||a.includes(N))})))}catch(a){console.warn("deletedTransactions snapshot handling failed:",a)}},n=>{console.warn("deletedTransactions subscription error:",n)});try{s=U.subscribeDeletedTransactionsLocalSync(r.uid)}catch{}}catch{}return()=>{try{e&&e()}catch{}try{s&&s()}catch{}}},[r==null?void 0:r.uid]),u.useEffect(()=>{(async()=>{try{if(!(r!=null&&r.uid)){ee(new Set);return}const e=ne(ie(W,"deletedTransactions"),K("userId","==",r.uid),K("permanent","==",!0)),s=(await At(e)).docs.flatMap(i=>{const n=i.data();return[n.originalTransactionId,n.transactionId,n.reference,i.id].filter(Boolean).map(String)});ee(new Set(s))}catch{ee(new Set)}})()},[r==null?void 0:r.uid]),u.useEffect(()=>{if(!(r!=null&&r.uid))return;let e=null,s=!1;const i=a=>{const l=a.map(o=>{const c=o.data(),x=c==null?void 0:c.createdAt,j=x!=null&&x.toDate?x.toDate():x instanceof Date?x:new Date(x);return{id:o.id,...c,createdAt:j}}).filter(o=>(o==null?void 0:o.status)!=="cancelled"&&!(o!=null&&o.isDeleted)).filter(o=>!((o==null?void 0:o.type)==="report"||((o==null?void 0:o.title)||"").includes("إيصال تسليم وردية"))).sort((o,c)=>{const x=o.createdAt?new Date(o.createdAt).getTime():0;return(c.createdAt?new Date(c.createdAt).getTime():0)-x}).filter(o=>{const c=String(o.id||""),x=String(o.transactionId||""),j=String(o.reference||o.transactionReference||"");return!oe.has(c)&&(!x||!oe.has(x))&&(!j||!oe.has(j))}),d=r!=null&&r.uid?U.getLocalReceipts(r.uid):[],p=[...l,...Array.isArray(d)?d:[]],m=o=>{var c;return String((o==null?void 0:o.transactionId)||(o==null?void 0:o.id)||(o==null?void 0:o.reference)||(o==null?void 0:o.transactionReference)||((c=o==null?void 0:o.receipt)==null?void 0:c.reference)||`${new Date((o==null?void 0:o.createdAt)||Date.now()).getTime()}`)},N=new Set,I=p.filter(o=>{const c=m(o);return N.has(c)?!1:(N.add(c),!0)});F(I.map(Ge))},n=()=>{const a=ne(ie(W,"userTransactions"),K("userId","==",r.uid));e=re(a,l=>{try{i(l.docs)}catch(d){console.error("خطأ في معالجة بيانات الاشتراك الاحتياطي:",d)}},l=>{console.error("خطأ في الاشتراك الاحتياطي لمعاملات المستخدم:",l)})};(async()=>{try{const a=ne(ie(W,"userTransactions"),K("userId","==",r.uid)),l=await Ea(a);if(l&&l.docs&&l.docs.length>0)try{i(l.docs)}catch{}}catch{}})();try{const a=ne(ie(W,"userTransactions"),K("userId","==",r.uid),ka("createdAt","desc"),limit(200));try{e=re(a,{includeMetadataChanges:!0},l=>{try{i(l.docs)}catch(d){console.error("خطأ في معالجة بيانات الاشتراك:",d)}},l=>{if(console.error("خطأ في الاشتراك لمعاملات المستخدم:",l),!s){s=!0;try{e&&e()}catch{}n()}})}catch{const l=ne(ie(W,"userTransactions"),K("userId","==",r.uid));e=re(l,d=>{try{i(d.docs)}catch{}},d=>{console.error("خطأ في الاشتراك البسيط لمعاملات المستخدم:",d),s||(s=!0,n())})}}catch(a){console.error("فشل إعداد الاشتراك الفوري لمعاملات المستخدم، بدء السقوط الاحتياطي:",a),n()}return()=>{try{e&&e()}catch{}}},[r==null?void 0:r.uid]);const va=async()=>{try{if(!r)return;const e=ne(ie(W,"deletedTransactions"),K("userId","==",r.uid),K("permanent","==",!0)),[s,i,n]=await Promise.all([U.getUserTransactions(r.uid).catch(()=>[]),U.getByUserId(r.uid).catch(()=>[]),At(e).then(c=>c.docs.flatMap(x=>{const j=x.data();return[j.originalTransactionId,j.transactionId,j.reference,x.id].filter(Boolean).map(String)})).catch(()=>[])]),a=Array.isArray(s)&&s.length>0?s:Array.isArray(i)?i:[],l=new Set(n),d=(a||[]).map(c=>({...c,createdAt:c.createdAt instanceof Date?c.createdAt:new Date(c.createdAt)})).filter(c=>!((c==null?void 0:c.type)==="report"||((c==null?void 0:c.title)||"").includes("إيصال تسليم وردية"))).filter(c=>{const x=String(c.id||""),j=String(c.transactionId||""),f=String(c.reference||c.transactionReference||"");return!l.has(x)&&(!j||!l.has(j))&&(!f||!l.has(f))}),p=r!=null&&r.uid?U.getLocalReceipts(r.uid):[],m=[...d,...Array.isArray(p)?p:[]],N=c=>{var x;return String((c==null?void 0:c.transactionId)||(c==null?void 0:c.id)||(c==null?void 0:c.reference)||(c==null?void 0:c.transactionReference)||((x=c==null?void 0:c.receipt)==null?void 0:x.reference)||`${new Date((c==null?void 0:c.createdAt)||Date.now()).getTime()}`)},I=new Set,o=m.filter(c=>{const x=N(c);return I.has(x)?!1:(I.add(x),!0)});F(o.map(Ge))}catch(e){console.error("خطأ في تحميل معاملات المستخدم من Firestore:",e),b({title:"فشل جلب معاملات المستخدم",description:"قد تكون المشكلة صلاحيات Firestore أو اتصال الشبكة. سيتم عرض المتاح محليًا إن وُجد. جرّب تسجيل الدخول مجددًا أو افتح صفحة اختبار المصادقة.",variant:"destructive"})}},fa=async()=>{try{if(!r)return;const e=(await fe.getDeletedTransactionsByUser(r.uid)).map(s=>({...s,createdAt:s.createdAt instanceof Date?s.createdAt:new Date(s.createdAt)}));le(e.map(Ge))}catch(e){console.error("خطأ في تحميل المعاملات المحذوفة من Firestore:",e),b({title:"فشل جلب المعاملات المحذوفة",description:"تحقق من الصلاحيات والاتصال. يمكن مراجعة صفحة اختبار المصادقة للتشخيص.",variant:"destructive"})}},xe=ve.useMemo(()=>{const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,1);return[...w].sort((n,a)=>a.createdAt.getTime()-n.createdAt.getTime()).filter(n=>n.createdAt>=s&&n.createdAt<i)},[w]),ga=ve.useMemo(()=>{const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,1);return Math.max(0,((w==null?void 0:w.length)||0)-(w||[]).filter(n=>n.createdAt>=s&&n.createdAt<i).length)},[w==null?void 0:w.length]),wt=xe.filter(e=>{const s=!L||e.senderPhone.includes(L)||e.receiverPhone.includes(L),i=!me||e.createdAt.toDateString()===new Date(me).toDateString(),n=!pe||e.createdAt.toTimeString().startsWith(pe);return s&&i&&n}),Ee=(e,s)=>{switch(e){case"completed":return t.jsx(ds,{className:`h-4 w-4 ${s==="withdraw"?"text-red-500":"text-green-500"}`});case"pending":return t.jsx(Je,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return t.jsx(os,{className:"h-4 w-4 text-red-500"});default:return t.jsx(Je,{className:"h-4 w-4 text-gray-500"})}},Xe=e=>{switch(e){case"completed":return"مكتمل";case"pending":return"قيد المراجعة";case"cancelled":return"ملغي";default:return"غير معروف"}},Ge=e=>{const s=((e==null?void 0:e.status)??"").toString().toLowerCase(),i=s==="confirmed"||s==="success"||s==="completed"?"completed":s==="failed"||s==="error"||s==="cancelled"||s==="canceled"?"cancelled":"pending",n=((e==null?void 0:e.type)??(e==null?void 0:e.txnType)??"").toString().toLowerCase()==="withdraw"?"withdraw":"send",a=(e==null?void 0:e.senderPhone)??(e==null?void 0:e.senderMsisdn)??(e==null?void 0:e.sender_msisdn)??(e==null?void 0:e.sender)??(e==null?void 0:e.from)??"",l=(e==null?void 0:e.receiverPhone)??(e==null?void 0:e.receiverMsisdn)??(e==null?void 0:e.receiver_msisdn)??(e==null?void 0:e.receiver)??(e==null?void 0:e.to)??"",d=e==null?void 0:e.createdAt,p=d instanceof Date?d:d!=null&&d.toDate?d.toDate():new Date(d);return{id:e==null?void 0:e.id,senderPhone:a||"غير معروف",receiverPhone:l||"غير معروف",amount:Number((e==null?void 0:e.amount)??0),status:i,type:n,createdAt:p,commission:(e==null?void 0:e.commission)??void 0,withdrawnAmount:(e==null?void 0:e.withdrawnAmount)??void 0,sentAmount:(e==null?void 0:e.sentAmount)??void 0,fromWallet:(e==null?void 0:e.fromWallet)??(e==null?void 0:e.walletId)??void 0,cashierName:(e==null?void 0:e.cashierName)??(e==null?void 0:e.createdByName)??(e==null?void 0:e.cashier)??void 0,commissionMode:(e==null?void 0:e.commissionMode)??(e==null?void 0:e.commission_mode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,walletEffectAppliedOnCreation:(e==null?void 0:e.walletEffectAppliedOnCreation)??(e==null?void 0:e.effectsAppliedOnCreation)??(e==null?void 0:e.effectAppliedOnCreation)??!1,cashEffectAppliedOnCreation:(e==null?void 0:e.cashEffectAppliedOnCreation)??!1,fee:(e==null?void 0:e.fee)??void 0,senderName:(e==null?void 0:e.senderName)??(e==null?void 0:e.customerName)??void 0}},wa=e=>({id:e.id,type:e.type==="send"?"transfer":"withdraw",sender_msisdn:e.senderPhone,receiver_msisdn:e.receiverPhone,amount:e.amount,commission:e.commission||0,status:e.status==="cancelled"?"failed":e.status,createdAt:e.createdAt.toISOString(),updatedAt:e.createdAt.toISOString(),shopName:Be??(v==null?void 0:v.shopName)??(r==null?void 0:r.displayName)??"المحل",cashierName:(e==null?void 0:e.cashierName)??null,commissionMode:(e==null?void 0:e.commissionMode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,fee:(e==null?void 0:e.fee)??void 0,note:(e==null?void 0:e.note)??(e==null?void 0:e.notes)??void 0,senderName:(e==null?void 0:e.senderName)??void 0}),He=e=>{const s=wa(e);ua(s),Ve(!0)},ba=e=>{Y(e),te(!0)},ya=async()=>{C&&(await ja(C.id),te(!1),Y(null))},ja=async e=>{try{const s=ue.find(a=>a.id===e);if(!s||!r)return;const i=await U.saveUserTransaction(r.uid,{...s,userId:r.uid,status:"completed",cashierName:s.cashierName??"الحساب الرئيسي"});await fe.permanentlyDeleteTransaction(e,r.uid);const n={...s,id:i};F(a=>[...a,n]),le(a=>a.filter(l=>l.id!==e)),b({title:"تم الاسترجاع",description:"تم استرجاع الإيصال إلى حسابك."})}catch(s){console.error("خطأ في استرجاع المعاملة من Firestore:",s),b({title:"فشل الاسترجاع",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},Na=async e=>{try{if(!r)return;le(s=>s.filter(i=>i.id!==e)),await fe.permanentlyDeleteTransaction(e,r.uid),await U.removeUserTransaction(r.uid,e),b({title:"تم الحذف نهائيًا",description:"الإيصال لن يعود بعد التحديث."})}catch(s){console.error("فشل الحذف النهائي للمعاملة:",s),b({title:"خطأ في الحذف النهائي",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},bt=async e=>{var s,i,n;try{const a=w.find(f=>f.id===e);if(!a||!r)return;try{const f=(s=y==null?void 0:y.subscription)==null?void 0:s.planType;if(f===Z.ZERO){const{dailyOperationCountService:T}=await G(async()=>{const{dailyOperationCountService:$}=await H(()=>import("./dailyOperationCountService-BuoXgFag-ByT7vHq7.js"),__vite__mapDeps([0,1,2]),import.meta.url);return{dailyOperationCountService:$}},X([0,1,2]),import.meta.url),B=a.type==="send"?"transfer":"withdraw";if(!(await T.checkAndIncrement(r.uid,B,5)).allowed){b({title:"تم بلوغ حد باقة الزيرو",description:"مسموح بحد أقصى 5 تأكيدات يوميًا للتحويل/السحب. جرّب غدًا أو قم بالترقية.",variant:"destructive"});return}}else if(f===Z.TAHWEELA){const{dailyOperationCountService:T}=await G(async()=>{const{dailyOperationCountService:$}=await H(()=>import("./dailyOperationCountService-BuoXgFag-ByT7vHq7.js"),__vite__mapDeps([0,1,2]),import.meta.url);return{dailyOperationCountService:$}},X([0,1,2]),import.meta.url),B=a.type==="send"?"transfer":"withdraw";if(!(await T.checkAndIncrementCombined(r.uid,B,40)).allowed){b({title:"تم بلوغ حد باقة تحويله",description:"هذه الباقة تسمح بحد أقصى 40 عملية تحويل/سحب يومياً.",variant:"destructive"});return}}}catch(f){console.warn("تعذر التحقق من حد التأكيد اليومي:",f)}const l=await Ze.getById(r.uid);if(!(l!=null&&l.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const d=Q(W,"dashboardData",l.shopId),p=await ce(d);let m=p.exists()?Number(((i=p.data())==null?void 0:i.cashBalance)||0):0;const N=p.exists()?((n=p.data())==null?void 0:n.walletBalances)||{}:{},I=a.fromWallet||Object.keys(N)[0],o=!!(a!=null&&a.limitsReservedOnCreation),c=Number(a.withdrawnAmount??a.sentAmount??a.amount??0),x=a.type==="send"?"transfer":"withdraw";try{const{walletDailyLimitsService:f}=await G(async()=>{const{walletDailyLimitsService:B}=await H(()=>import("./index-BsVRzvOf.js").then($=>$.c3),__vite__mapDeps([1,2]),import.meta.url).then($=>$.c8);return{walletDailyLimitsService:B}},X([1,2]),import.meta.url),T=await f.canPerformOperation(I,c,x);if(!o&&!T.canPerform){b({title:"تجاوز الحدود",description:String(T.message||"لا يمكن الإكمال لتجاوز الحد اليومي/الشهري"),variant:"destructive"});return}}catch{b({title:"فشل التحقق من الحدود",description:"حاول مجددًا بعد قليل",variant:"destructive"});return}let j=!1;if(a.type==="withdraw"){const f=a.fromWallet||Object.keys(N)[0],T=Number(a.withdrawnAmount??a.amount??0),B=Number(a.commission??0),$=!!(a!=null&&a.walletEffectAppliedOnCreation),se=!!(a!=null&&a.cashEffectAppliedOnCreation);if(!$&&f&&T>0){const de=N[f]||0;N[f]=de+T}se?m=m+T:m=m-T,j=!0,await ke(d,{cashBalance:m,walletBalances:N})}else if(a.type==="send"){const f=Number(a.commission??0),T=Number((a==null?void 0:a.fee)??0),B=Number((a==null?void 0:a.sentAmount)??(a==null?void 0:a.transferredAmount)??a.amount??0),$=Math.max(0,B)+Math.max(0,T);$>0&&(m=m+$,await ke(d,{cashBalance:m}),j=!0)}await ke(Q(W,"userTransactions",e),{status:"completed",confirmedAt:new Date});try{const f=a.fromWallet||Object.keys(N)[0],T=Number(a.withdrawnAmount??a.sentAmount??a.amount??0);if(f&&T>0&&!o){const{walletDailyLimitsService:B}=await G(async()=>{const{walletDailyLimitsService:$}=await H(()=>import("./index-BsVRzvOf.js").then(se=>se.c3),__vite__mapDeps([1,2]),import.meta.url).then(se=>se.c8);return{walletDailyLimitsService:$}},X([1,2]),import.meta.url);await B.updateUsage(f,T,a.type==="send"?"transfer":"withdraw")}}catch{b({title:"فشل تحديث الحدود",description:"تجاوز حد اليوم/الشهر يمنع الإكمال",variant:"destructive"});return}try{const{ProfitService:f}=await G(async()=>{const{ProfitService:B}=await H(()=>import("./profitService-4r9FqAF7-Hn6SWIj-.js"),__vite__mapDeps([3,1,2]),import.meta.url);return{ProfitService:B}},X([3,1,2]),import.meta.url),T=f.calculateProfitFromTransaction({type:a.type==="send"?"transfer":"withdraw",amount:Number(a.amount||0),commission:Number(a.commission||0),fee:Number((a==null?void 0:a.fee)||0)});!(a!=null&&a.profitAddedOnCreation)&&T>0&&f.addProfit(T,r==null?void 0:r.uid)}catch{}F(f=>f.map(T=>T.id===e?{...T,status:"completed"}:T)),b({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),Ve(!1)}catch(a){console.error("خطأ في إكمال المعاملة:",a),b({title:"فشل الإكمال",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},yt=async e=>{var s,i;try{const n=w.find(a=>a.id===e);if(!n||!r)return;F(a=>a.filter(l=>l.id!==e)),le(a=>[{...n},...a]);try{let a={};try{const m=await ce(Q(W,"userTransactions",e));a=m.exists()?m.data():{}}catch{}const l=e,d=String((a==null?void 0:a.transactionId)||(n==null?void 0:n.transactionId)||l),p=String((a==null?void 0:a.reference)||(a==null?void 0:a.transactionReference)||(n==null?void 0:n.reference)||(n==null?void 0:n.transactionReference)||"");await U.removeUserTransaction(r.uid,e),await fe.saveDeletedTransaction({...n,userId:r.uid,originalTransactionId:e,transactionId:d,reference:p||void 0,permanent:!0});try{await fe.permanentlyDeleteTransaction(e,r.uid)}catch{}}catch(a){console.warn("تعذر الحذف النهائي من قواعد البيانات في هذه الخطوة، سيتم الحذف من لائحة المحذوفات عند التنفيذ اليدوي للحذف النهائي:",a)}try{const a=await Ze.getById(r.uid);if(!(a!=null&&a.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const l=Q(W,"dashboardData",a.shopId),d=await ce(l);let p=d.exists()?Number(((s=d.data())==null?void 0:s.cashBalance)||0):0;const m=d.exists()?((i=d.data())==null?void 0:i.walletBalances)||{}:{},N=Number(n.withdrawnAmount??n.amount??0),I=Number(n.commission??0),o=n.fromWallet||Object.keys(m)[0],c=!!(n!=null&&n.walletEffectAppliedOnCreation);if(n.type==="send"){const x=Number(n.fee??0),j=Number((n==null?void 0:n.sentAmount)??(n==null?void 0:n.transferredAmount)??n.amount??0);if(n.status==="completed"&&(p=p-(j+I+x)),o&&j>0){const f=m[o]||0;m[o]=f+j}}else if(n.type==="withdraw"){if(n.status==="completed"){if(p=p+N-I,o&&N>0){const x=m[o]||0;m[o]=x-N}}else if(o&&c&&N>0){const x=m[o]||0;m[o]=x-N}}await ke(l,{cashBalance:p,walletBalances:m})}catch(a){console.warn("فشل عكس تأثير الأرصدة محليًا:",a)}try{const a=n.fromWallet;if(a){const{walletDailyLimitsService:l}=await G(async()=>{const{walletDailyLimitsService:p}=await H(()=>import("./index-BsVRzvOf.js").then(m=>m.c3),__vite__mapDeps([1,2]),import.meta.url).then(m=>m.c8);return{walletDailyLimitsService:p}},X([1,2]),import.meta.url),d=await l.getWalletLimits(a);if(d){const p=n.type==="send",m={updatedAt:(await G(async()=>{const{serverTimestamp:x}=await H(()=>import("./index-BsVRzvOf.js").then(j=>j.c3),__vite__mapDeps([1,2]),import.meta.url).then(j=>j.c2);return{serverTimestamp:x}},X([1,2]),import.meta.url)).serverTimestamp()};p?(m.dailyTransferUsed=Math.max(0,(d.dailyTransferUsed||0)-n.amount),m.monthlyTransferUsed=Math.max(0,(d.monthlyTransferUsed||0)-n.amount)):(m.dailyWithdrawUsed=Math.max(0,(d.dailyWithdrawUsed||0)-n.amount),m.monthlyWithdrawUsed=Math.max(0,(d.monthlyWithdrawUsed||0)-n.amount));const{doc:N,setDoc:I}=await G(async()=>{const{doc:x,setDoc:j}=await H(()=>import("./index-BsVRzvOf.js").then(f=>f.c3),__vite__mapDeps([1,2]),import.meta.url).then(f=>f.c2);return{doc:x,setDoc:j}},X([1,2]),import.meta.url),{db:o}=await G(async()=>{const{db:x}=await H(()=>import("./index-BsVRzvOf.js").then(j=>j.c3),__vite__mapDeps([1,2]),import.meta.url).then(j=>j.c3);return{db:x}},X([1,2]),import.meta.url),c=N(o,"walletLimits",a);await I(c,m,{merge:!0})}}}catch(a){console.warn("فشل استرجاع حدود المحفظة:",a)}try{const{ProfitService:a}=await G(async()=>{const{ProfitService:m}=await H(()=>import("./profitService-4r9FqAF7-Hn6SWIj-.js"),__vite__mapDeps([3,1,2]),import.meta.url);return{ProfitService:m}},X([3,1,2]),import.meta.url),{ReportsService:l}=await G(async()=>{const{ReportsService:m}=await H(()=>import("./index-BsVRzvOf.js").then(N=>N.c3),__vite__mapDeps([1,2]),import.meta.url).then(N=>N.c7);return{ReportsService:m}},X([1,2]),import.meta.url),d={txnType:n.type==="send"?"send":"receive",amount:n.amount,commission:n.commission||0,createdAt:n.createdAt,status:"confirmed"},p=a.calculateProfitFromTransaction(d);p>0&&a.addProfit(-p,r.uid);try{l.removeTransactionEffects(n,r.uid)}catch{}}catch(a){console.warn("فشل تحديث التقارير/الأرباح بعد الحذف:",a)}}catch(n){console.error("خطأ أثناء حذف الإيصال:",n)}},jt=u.useRef(!1),Nt=La();u.useEffect(()=>{new URLSearchParams(Nt.search).get("autoTestBalances")!=="1"||jt.current||(jt.current=!0,(async()=>{var e,s,i,n,a,l;try{if(!r)return;const d=await Ze.getById(r.uid);if(!(d!=null&&d.shopId)){console.warn("autoTest: لا يوجد shopId للمستخدم، سيتم إيقاف الاختبار.");return}const p=Q(W,"dashboardData",d.shopId),m=await ce(p),N=m.exists()?Number(((e=m.data())==null?void 0:e.cashBalance)||0):0,I=m.exists()?((s=m.data())==null?void 0:s.walletBalances)||{}:{},o=Object.keys(I)[0]||void 0,c=100,x=5,j=await U.saveUserTransaction(r.uid,{senderPhone:"auto-test-sender",receiverPhone:"auto-test-receiver",amount:c,status:"pending",type:"withdraw",createdAt:new Date,reference:`AUTO-${Date.now()}`,commission:x,withdrawnAmount:c,fromWallet:o,cashierName:"AutoTest",commissionMode:"add",totalCharged:c+x,walletEffectAppliedOnCreation:!1});console.log("autoTest: تم إنشاء إيصال سحب تجريبي:",j),await bt(j);const f=await ce(p),T=f.exists()?Number(((i=f.data())==null?void 0:i.cashBalance)||0):0,B=f.exists()?((n=f.data())==null?void 0:n.walletBalances)||{}:{},$=N-c+x,se=o?Number(I[o]||0)+c:void 0;console.log("autoTest: توقع الدرج بعد الإكمال:",$,"فعلي:",T),o&&console.log("autoTest: توقع المحفظة بعد الإكمال:",se,"فعلي:",B[o]),await yt(j);const de=await ce(p),Ta=de.exists()?Number(((a=de.data())==null?void 0:a.cashBalance)||0):0,Sa=de.exists()?((l=de.data())==null?void 0:l.walletBalances)||{}:{};console.log("autoTest: تحقق نهائي — الدرج قبل/بعد الحذف:",N,Ta),o&&console.log("autoTest: تحقق نهائي — المحفظة قبل/بعد الحذف:",I[o]||0,Sa[o]||0),b({title:"اختبار الأرصدة (Firestore فقط)",description:"تم إنشاء/إكمال/حذف إيصال تجريبي والتحقق من الأرصدة.",variant:"default"})}catch(d){console.error("autoTest: فشل اختبار الأرصدة:",d),b({title:"فشل اختبار الأرصدة",description:"تحقق من الاتصال ووجود shopId والمحافظ في Firestore.",variant:"destructive"})}})())},[Nt.search,r]);const Aa=async()=>{var e,s,i;const n="alkaptin678678@gmail.com",a=(s=(e=Ke.currentUser)==null?void 0:e.email)==null?void 0:s.toLowerCase();if(!a||a!==n){b({title:"قيد الإنشاء",description:"ميزة الشحن متاحة لهذا الحساب فقط حالياً."});return}if(!Ce||!he||!De){b({title:"بيانات ناقصة",description:"يرجى إدخال رقم وشركة والمبلغ",variant:"destructive"});return}ft(!0);try{const l={vodafone_eg:"Vodafone",orange_eg:"Orange",etisalat_eg:"Etisalat",we_eg:"WE"}[he]??he,d=new AbortController,p=setTimeout(()=>d.abort(),15e3),m=await((i=Ke.currentUser)==null?void 0:i.getIdToken()),N=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...m?{Authorization:`Bearer ${m}`}:{}},body:JSON.stringify({phone:Ce,countryCode:"EG",operator:l,amount:Number(De),useLocalAmount:!0}),signal:d.signal});clearTimeout(p);const I=await N.text();let o;try{o=JSON.parse(I)}catch{o={success:!1,message:I||"فشل قراءة استجابة الخادم"}}N.ok&&o!=null&&o.success?(b({title:"تم الشحن",description:(o==null?void 0:o.message)||"تم تنفيذ عملية الشحن بنجاح"}),Se(!1),pt(""),ht(""),xt("")):b({title:"فشل الشحن",description:(o==null?void 0:o.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(l){console.error("Topup request error:",l),(l==null?void 0:l.name)==="AbortError"?b({title:"انتهت المهلة",description:"الخادم لم يستجب في الوقت المحدد. تأكد أن السيرفر يعمل.",variant:"destructive"}):b({title:"خطأ في الاتصال",description:"تعذر الاتصال بالخادم. حاول لاحقاً.",variant:"destructive"})}finally{ft(!1)}};return t.jsxs("div",{className:"fixed inset-0 overscroll-y-none overflow-y-auto bg-background p-4",children:[t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs(E,{variant:"ghost",size:"sm",onClick:()=>M("/user/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800",children:[t.jsx(is,{className:"h-4 w-4"}),"العودة"]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"المعاملات"})]}),t.jsxs(Ba,{className:"card-modern fade-in-up",children:[t.jsxs(za,{className:"pb-2 px-3 pt-3",children:[t.jsx(Ua,{className:"text-sm font-bold",children:"المعاملات الأخيرة"}),t.jsxs("div",{className:"flex items-center gap-0.5 mt-1 relative",children:[t.jsxs("div",{className:"flex items-center gap-0.5 flex-1 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[t.jsx(ls,{className:"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors"}),t.jsx(qe,{placeholder:"بحث...",value:L,onChange:e=>st(e.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400"})]}),t.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(E,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:ha,title:"شرح التطبيق",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(us,{className:"h-2.5 w-2.5"}),sa&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-600 rounded-full"})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شرح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(E,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 hover:border-purple-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(J||Me){b({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"});return}ze(!0)},title:"إدارة التقسيط",children:t.jsx(Pa,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تقسيط"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(fs,{userId:r==null?void 0:r.uid,transactions:w}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"أرباح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(E,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border border-emerald-200 hover:border-emerald-300 transition-all duration-200 hover:scale-105",onClick:()=>{b({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."})},title:"نافذة شحن سريعة",children:t.jsx(Tt,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شحن"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(E,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:scale-105",onClick:()=>Yt(!0),title:"آلة حاسبة",children:t.jsx(Qa,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"حاسبة"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(E,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 hover:border-green-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(J){b({title:"الخطة الحالية لا تسمح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية."});return}ra(!0)},title:"بيانات المبيعات",children:t.jsx(Ja,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مبيعات"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(E,{variant:"ghost",size:"sm",className:`h-5 w-5 p-0 rounded border transition-all duration-200 hover:scale-105 ${me||pe?"bg-purple-100 text-purple-600 border-purple-300":"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200 hover:border-purple-300"}`,onClick:()=>na(!0),title:"اختيار التاريخ",children:[t.jsx(It,{className:"h-2.5 w-2.5"}),(me||pe)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-purple-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تاريخ"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(E,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 hover:border-orange-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(J){b({title:"الخطة الحالية لا تسمح",description:"إدارة الديون غير متاحة في خطة زيرو. قم بالترقية."});return}Ue(!0)},title:"إدارة الديون",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(Ia,{className:"h-2.5 w-2.5"}),gt>0&&t.jsx("div",{className:"absolute -top-1 -right-1 z-10 min-w-[12px] h-[12px] px-[2px] bg-red-600 text-white rounded-full text-[8px] leading-[12px] flex items-center justify-center pointer-events-none ring-1 ring-white",children:gt})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"ديون"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(E,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(J){b({title:"الخطة الحالية لا تسمح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية."});return}ut(!0)},title:"الصيانة",children:t.jsx(Oa,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"صيانه"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(E,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-violet-50 text-violet-600 hover:bg-violet-100 border border-violet-200 hover:border-violet-300 transition-all duration-200 hover:scale-105",onClick:()=>{M("/user/dashboard",{state:{openCashierShiftModal:!0}})},title:"يومية المكنة",children:t.jsx(cs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"المكنة"})]}),t.jsxs("div",{className:"hidden sm:flex items-center gap-1",children:[t.jsx(E,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(J){b({title:"الخطة الحالية لا تسمح",description:"الفيز الائتمانية غير متاحة في خطة زيرو. قم بالترقية."});return}ct(!0)},title:"الفيز الائتمانية",children:t.jsx(Tt,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"فيز"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(E,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105 relative",onClick:()=>{Ae(!0)},title:"تصفير المعاملات الأخيرة",children:[t.jsx(Et,{className:"h-2.5 w-2.5"}),ga>0&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تصفير"})]}),(L||me||pe)&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(E,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:()=>{st(""),qt(""),Kt("")},title:"مسح",children:t.jsx("span",{className:"text-[10px] font-bold",children:"×"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مسح"})]})]})]})]}),t.jsx(Va,{className:"px-3 pb-3",children:t.jsxs(xs,{value:q,onValueChange:ae,className:"w-full",children:[t.jsxs(Zt,{className:"hidden sm:grid w-full grid-cols-4 h-10 text-sm bg-gradient-to-r from-gray-50 via-blue-50/30 to-purple-50/30 border border-gray-200/60 rounded-md p-1 shadow-sm relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 opacity-0 hover:opacity-100 transition-all duration-200"}),t.jsxs(we,{value:"all",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-blue-200/50 hover:bg-blue-50/80 hover:text-blue-700 group",children:[t.jsx("span",{className:"relative z-10",children:"الكل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(we,{value:"send",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-green-200/50 hover:bg-green-50/80 hover:text-green-700 group",children:[t.jsx("span",{className:"relative z-10",children:"مرسل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(we,{value:"withdraw",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-orange-200/50 hover:bg-orange-50/80 hover:text-orange-700 group",children:[t.jsx("span",{className:"relative z-10",children:"سحب"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-orange-500/10 to-amber-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(we,{value:"deleted",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-rose-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-red-200/50 hover:bg-red-50/80 hover:text-red-700 group",children:[t.jsx("span",{className:"relative z-10",children:"محذوف"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-500/10 to-rose-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]})]}),t.jsx(be,{value:"all",className:"mt-2 receipts-list",children:wt.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:wt.map((e,s)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>He(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[Ee(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:`font-medium text-sm ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[V(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-red-600",children:["عمولة: ",V(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:`text-[10px] ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:`text-sm ${e.type==="withdraw"?"text-red-500":"text-green-600"}`,children:e.createdAt.toLocaleString("en-GB")})]})]}),t.jsxs("div",{className:"text-right",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-green-700",children:[V(e.amount)," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",V(e.withdrawnAmount)," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",V(e.sentAmount)," جنيه"]}),t.jsx(Pe,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?e.type==="withdraw"?"bg-red-100 text-red-800 border-red-300":e.type==="send"?"bg-green-100 text-green-800 border-green-300":"":e.type==="withdraw"?"bg-red-100 text-red-800":""}`,children:e.type==="withdraw"?"سحب":Xe(e.status)})]})]},e.id))})}),t.jsx(be,{value:"send",className:"mt-2 receipts-list",children:xe.filter(e=>e.type==="send").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات إرسال محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:xe.filter(e=>e.type==="send").map((e,s)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-all duration-200",onClick:()=>He(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[Ee(e.status,e.type),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-sm text-green-700",children:[e.senderPhone," → ",e.receiverPhone]}),t.jsxs("p",{className:"text-[10px] text-green-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-green-600",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm text-green-700",children:[V(e.amount)," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",V(e.sentAmount)," جنيه"]}),t.jsx(Pe,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?"bg-green-100 text-green-800 border-green-300":""}`,children:Xe(e.status)})]})]},e.id))})}),t.jsx(be,{value:"withdraw",className:"mt-2 receipts-list",children:xe.filter(e=>e.type==="withdraw").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات سحب محفوظة بعد"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:xe.filter(e=>e.type==="withdraw").map((e,s)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border cursor-pointer",onClick:()=>He(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[Ee(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.receiverPhone}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[V(e.amount)," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",V(e.withdrawnAmount)," جنيه"]}),t.jsx(Pe,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?"bg-red-100 text-red-800 border-red-300":"bg-red-100 text-red-800"}`,children:Xe(e.status)})]})]},e.id))})}),t.jsx(be,{value:"deleted",className:"mt-2",children:ue.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محذوفة"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ue.map((e,s)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[Ee(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[V(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-500",children:["عمولة: ",V(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"text-right mr-2",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[V(e.amount)," جنيه"]}),t.jsx(Pe,{variant:"secondary",className:"text-[10px] bg-red-100 text-red-800",children:"محذوف"})]}),t.jsx(E,{variant:"ghost",size:"sm",className:"text-green-600 hover:bg-green-100 h-10 sm:h-12 px-4 sm:px-5 min-w-[44px] touch-manipulation",onClick:()=>ba(e),children:t.jsx("span",{className:"text-xs sm:text-sm",children:"استرجاع"})}),t.jsx(E,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 h-10 sm:h-12 px-3 sm:px-4 min-w-[44px] touch-manipulation",onClick:()=>Na(e.id),children:t.jsx(Et,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})]},e.id))})})]})})]}),t.jsx(Ie,{open:ea,onOpenChange:nt,children:t.jsxs(Oe,{className:"dialog-modern max-w-3xl w-full p-0 overflow-hidden border-0 shadow-2xl",children:[t.jsx(Re,{className:"px-4 pt-4",children:t.jsx(Fe,{className:"text-lg font-bold",children:ta||"شرح التطبيق"})}),t.jsx("div",{className:"aspect-video w-full bg-black",children:it?t.jsx("iframe",{src:pa(it),title:"Application Guide",className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0}):t.jsx("div",{className:"flex items-center justify-center h-full text-white/80",children:"لا يوجد فيديو متاح حالياً"})})]})}),t.jsx(es,{open:oa,onOpenChange:ut})]}),t.jsx(ts,{isOpen:la,onClose:()=>ct(!1)}),t.jsx(et,{open:ia,onOpenChange:Ue,mode:"verify",title:"الرقم السري الرئيسي لفتح الديون",description:"أدخل الرقم السري الرئيسي لفتح صفحة الديون",onSuccess:()=>{Ue(!1),M("/user",{state:{openDebtDialog:!0}})}}),t.jsx(rs,{open:ma,onOpenChange:Ae,title:"تأكيد كلمة المرور لتصفير المعاملات الأخيرة",description:"سيتم حذف كل المعاملات السابقة نهائيًا من حسابك وFirebase.",onSuccess:async()=>{try{if(!(r!=null&&r.uid)){Ae(!1);return}const e=new Date,s=i=>i instanceof Date?i:typeof(i==null?void 0:i.toDate)=="function"?i.toDate():new Date(String(i));await U.updateUserData(r.uid,{recentReset:{keepLastCount:mt.keepLastCount??30,intervalDays:mt.intervalDays??7,lastResetAt:e}}),Te(i=>({...i,lastResetAt:e})),b({title:"تم إخفاء المعاملات السابقة",description:"تم إخفاء كل الإيصالات الأقدم من وقت التصفير من العرض بدون التأثير على التقارير اليومية/الشهرية أو الحدود."})}catch(e){console.error("فشل تنفيذ التصفير النهائي:",e),b({title:"فشل التصفير",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}finally{Ae(!1)}}}),t.jsx(Ie,{open:xa,onOpenChange:e=>{var s,i;if(e){const n="alkaptin678678@gmail.com",a=(i=(s=Ke.currentUser)==null?void 0:s.email)==null?void 0:i.toLowerCase();if(!a||a!==n){b({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."});return}Se(!0)}else Se(!1)},children:t.jsxs(Oe,{dir:"rtl",className:"sm:max-w-md",children:[t.jsx(Re,{children:t.jsx(Fe,{children:"شحن رصيد الموبايل"})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"رقم الموبايل"}),t.jsx(qe,{value:Ce,onChange:e=>pt(e.target.value),placeholder:"01XXXXXXXXX",dir:"ltr"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"الشركة"}),t.jsxs(Xa,{value:he,onValueChange:ht,children:[t.jsx(Ga,{className:"w-full",children:t.jsx(Ha,{placeholder:"اختر الشركة"})}),t.jsxs(Za,{children:[t.jsx(Le,{value:"vodafone_eg",children:"فودافون"}),t.jsx(Le,{value:"orange_eg",children:"أورنج"}),t.jsx(Le,{value:"etisalat_eg",children:"اتصالات"}),t.jsx(Le,{value:"we_eg",children:"WE"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"المبلغ بالجنيه"}),t.jsx(qe,{type:"number",min:1,value:De,onChange:e=>xt(e.target.value?Number(e.target.value):""),placeholder:"50"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-2",children:[t.jsx(E,{variant:"outline",onClick:()=>Se(!1),children:"إلغاء"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(E,{variant:"secondary",onClick:()=>M("/topup"),children:"صفحة الشحن الكاملة"}),t.jsx(E,{onClick:Aa,disabled:vt||!Ce||!he||!De,children:vt?"جارٍ التنفيذ...":"تأكيد الشحن"})]})]})]})]})}),t.jsx(Ie,{open:ye,onOpenChange:te,children:t.jsxs(Oe,{className:"sm:max-w-[460px]",children:[t.jsxs(Re,{children:[t.jsx(Fe,{children:"تأكيد استرجاع الإيصال"}),t.jsx(Ra,{children:"سيتم إعادة الإيصال إلى قائمة المعاملات الحالية."})]}),C&&t.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"المبلغ"}),t.jsxs("span",{className:"font-bold",children:[C.amount," جنيه"]})]}),C.type==="withdraw"?t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"العميل"}),t.jsx("span",{className:"font-medium",children:C.receiverPhone})]}):t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"من → إلى"}),t.jsxs("span",{className:"font-medium",children:[C.senderPhone," → ",C.receiverPhone]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"الكاشير"}),t.jsx("span",{className:"font-medium",children:C.cashierName??"الحساب الرئيسي"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"التاريخ"}),t.jsx("span",{className:"font-medium",children:C.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3",children:[t.jsx(E,{variant:"outline",onClick:()=>{te(!1),Y(null)},children:"إلغاء"}),t.jsx(E,{onClick:ya,children:"تأكيد الاسترجاع"})]})]})}),t.jsx(as,{isOpen:da,onClose:()=>Ve(!1),transaction:ca,onPrint:()=>window.print(),onDelete:yt,onComplete:bt}),t.jsx(et,{open:Qt,onOpenChange:ze,mode:"verify",title:"فتح إدارة التقسيط",description:"أدخل الرقم السري الرئيسي للوصول إلى إدارة التقسيط",onSuccess:()=>{ze(!1),rt(!0)}}),t.jsx(ss,{open:Jt,onOpenChange:rt})]})};export{Vs as default};
//# sourceMappingURL=TransactionsPage-ByCAGb8I-CH5r4KE8.js.map
