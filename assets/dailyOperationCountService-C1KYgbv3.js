import{y as c,i as d,K as f,s as u,P as C}from"./index-B57-Wohm.js";const g={getCurrentDayId(){const n=new Date;return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`},async getCounts(n,i){const r=i||this.getCurrentDayId(),e=c(d,"users",n,"dailyOps",r),s=await C(e);if(!s.exists()){const a={dayId:r,confirmTransferCount:0,confirmWithdrawCount:0,updatedAt:u()};return await f(e,a),{...a,updatedAt:new Date}}const t=s.data();return{dayId:r,confirmTransferCount:Number((t==null?void 0:t.confirmTransferCount)||0),confirmWithdrawCount:Number((t==null?void 0:t.confirmWithdrawCount)||0),updatedAt:(t==null?void 0:t.updatedAt)||u()}},async checkAndIncrement(n,i,r){const e=this.getCurrentDayId(),s=c(d,"users",n,"dailyOps",e),t=await this.getCounts(n,e),a=i==="transfer"?t.confirmTransferCount:t.confirmWithdrawCount;if(a>=r)return{allowed:!1,remaining:0};const o={updatedAt:u()};return i==="transfer"?o.confirmTransferCount=t.confirmTransferCount+1:o.confirmWithdrawCount=t.confirmWithdrawCount+1,await f(s,o,{merge:!0}),{allowed:!0,remaining:Math.max(0,r-(a+1))}},async checkAndIncrementCombined(n,i,r){const e=this.getCurrentDayId(),s=c(d,"users",n,"dailyOps",e),t=await this.getCounts(n,e),a=Number(t.confirmTransferCount||0)+Number(t.confirmWithdrawCount||0);if(a>=r)return{allowed:!1,remaining:0};const o={updatedAt:u()};return i==="transfer"?o.confirmTransferCount=t.confirmTransferCount+1:o.confirmWithdrawCount=t.confirmWithdrawCount+1,await f(s,o,{merge:!0}),{allowed:!0,remaining:Math.max(0,r-(a+1))}}};export{g as dailyOperationCountService,g as default};
