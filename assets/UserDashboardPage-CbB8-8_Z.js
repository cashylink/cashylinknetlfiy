const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-CZwBW8vR.js","./index-QuU6lc3e.css","./WalletManagement-BU9BOeFr.js","./badge-DziRw6yR.js","./select-C1gLQVXw.js","./wallet-Dsq7die0.js","./star-fi--yZsO.js","./square-pen-BNGOa0P6.js","./arrow-left-c8JkXMlT.js","./progress-DNDgASyf.js","./separator-DqjOD3lx.js","./calendar-DdlfWvl7.js","./chart-column-B2vSKImg.js","./trending-down-CuqoCFKY.js","./dollar-sign-CQHak9ia.js","./activity-DF1Gg1F-.js","./users-_xFOxS2A.js","./circle-check-big-DUSZXsZt.js","./TransactionDetailsModal-DWJIvvJy.js","./SimCardsAccessDialog-DcM4jv_g.js","./printer-1f8tOea1.js","./ReceiptModal-CUVVTBKF.js","./html2canvas.esm-BfYXEYrK.js","./download-CaSm4wTL.js","./EditBalanceDialog-KUSbAL4E.js","./ChangePinDialog-DY8Ze77r.js","./ChangeCashPinDialog-D8iQCRLF.js","./ChangeWalletTotalPinDialog-5tYWf41W.js","./AddToWalletDialog-DOOUUUvQ.js","./CalculatorDialog-D7rvp9uf.js","./SalesDataDialog-Ckw-kGqN.js","./table-CDVWZ-zt.js","./tabs-CAePOU2u.js","./index-hfObMVTV.js","./dropdown-menu-C7pAJ7HV.js","./alert-dialog-U7gr_XyE.js","./refresh-cw-CgaW6Naz.js","./save-BUsX5Y5v.js","./pen-line-Bt9u66V1.js","./ProfileSettingsPage-BUDyCzwb.js","./switch-Cbj9EOUh.js","./textarea---GTGD5h.js","./crown-D2LsYl_u.js","./ProfileIcon-DNLaXpP6.js","./freeTrialService-DszjNQE8.js","./broadcastService-CeRBX8uu.js","./bell-BivkKK-P.js","./profitService-BUBYCoKY.js","./arrow-down-left-BvLIcVR-.js","./CashSummaryDialog-BjljNQCE.js","./battery-charging-BQPdtoWU.js","./CreditCardsDialog-Bud6dwHH.js","./InstallmentModal-CsKS9UTM.js","./SimCardsDialog-Dk2f3tEb.js","./wifi-DvA5dCu9.js","./AdslCardsDialog-CqVtVE8d.js","./MaintenanceDialog-Dbu_6lr7.js","./MachineDailyDialog-DZzSVmtZ.js","./WalletsManagement-CB1iQn8-.js","./WalletPrinterDialog-D1JFk5sw.js","./WalletsListDialog-CMaqV3ja.js","./building-2-DASBz-lN.js","./CashierShiftModal-Cd-Pbsqj.js","./functions-P4y9aL9k.js","./ShiftProfileDialog-DDkjfNzd.js","./ChangeLogDialog-Cb2F-pE-.js","./sparkles-C1eiJo_o.js","./dailyOperationCountService-Bsh4gYfW.js"])))=>i.map(i=>d[i]);
import{$ as Gr,r as u,j as e,bt as Q0,bu as Zu,ap as em,bv as G0,aj as Tl,al as X0,ao as Xr,am as Zs,an as Xa,bw as tm,ba as Pl,bx as Z0,by as eg,bB as tg,bA as ag,bC as sg,bD as rg,bE as ng,bF as ig,a9 as Za,bm as pu,a1 as pi,V as Ae,t as $,_ as Gt,E as ht,p as Ys,ct as hs,a0 as ua,q as Te,s as de,aG as K,x as De,u as El,ab as am,bI as og,B as I,aV as wi,R as ae,ac as _t,K as Qs,af as fe,ag as ge,ah as pe,ai as xe,aF as lg,b6 as xu,av as Wt,a5 as Qt,a6 as sm,m as Si,H as yu,y as H,I as J,J as bu,a4 as cg,ae as rm,bp as dg,bq as ug,aH as rt,aQ as Oe,O as mg,a7 as Ma,aK as kl,cu as hl,a as hg,cv as fg,aL as gg,cj as pg,aU as xg,n as yg,b4 as fs,ad as oe,T as vu,aM as ne,cw as Br,W as bg,aJ as wu,cx as $r,a_ as vg,c as Aa,d as gs,e as ps,at as ca,aS as ui,aX as Ur,g as Ta,a2 as It,cy as wg,S as Ng,b8 as jg,F as Vr,a3 as Sg,cz as Dg,U as qr,b3 as Nu,aN as kg,as as zr,bK as ju,P as mi,aR as hi,C as Su,au as fi,M as fl,aE as gi,bL as Cg,bM as Ig,bN as _g,bO as Ag,bP as Tg,D as Yr,bQ as Pg,bR as Du,ar as ta,X as ku,v as gl,w as Eg,b7 as Kr,br as Og,cA as Mg,b_ as pl,cB as Cu,cC as Rg}from"./index-CZwBW8vR.js";import{C as Wg,P as Lg,a as Fg,w as Bg}from"./ProfileSettingsPage-BUDyCzwb.js";import{B as Pa}from"./badge-DziRw6yR.js";import{S as Iu,T as $g,a as Ug,b as _u,c as Au}from"./tabs-CAePOU2u.js";import{u as Vg,S as Ja,a as Ha,b as Qa,c as Ga,d as da,f as qg,C as zg}from"./select-C1gLQVXw.js";import{C as Yg,D as Kg,a as Jg,b as Hg,c as Qg,d as Gg,f as Xg}from"./dropdown-menu-C7pAJ7HV.js";import{L as zs,S as Zg}from"./switch-Cbj9EOUh.js";import{P as ep}from"./ProfileIcon-DNLaXpP6.js";import{E as tp,a as ap}from"./broadcastService-CeRBX8uu.js";import{B as xl}from"./bell-BivkKK-P.js";import{C as xi}from"./circle-check-big-DUSZXsZt.js";import{ProfitService as ba}from"./profitService-BUBYCoKY.js";import{C as yi}from"./calendar-DdlfWvl7.js";import{A as Ks}from"./arrow-down-left-BvLIcVR-.js";import{A as nm,u as Jr,f as Rt,B as Tu,C as sp,a as yl,S as Pu,b as Eu}from"./SimCardsAccessDialog-DcM4jv_g.js";import{D as Oa}from"./dollar-sign-CQHak9ia.js";import{c as im,R as rp,I as np}from"./index-hfObMVTV.js";import{FreeTrialService as Ou}from"./freeTrialService-DszjNQE8.js";import{W as Vs}from"./wallet-Dsq7die0.js";import{C as ip}from"./crown-D2LsYl_u.js";import{R as bl}from"./refresh-cw-CgaW6Naz.js";import{S as Mu}from"./square-pen-BNGOa0P6.js";import{P as op}from"./printer-1f8tOea1.js";import{S as lp}from"./star-fi--yZsO.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cp=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],Ru=Gr("calendar-days",cp);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dp=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],up=Gr("chevron-left",dp);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mp=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],hp=Gr("circle-plus",mp);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fp=[["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["path",{d:"M16 2v20",key:"rotuqe"}]],Wu=Gr("notebook",fp);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gp=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],om=Gr("package",gp);function pp(r){const t=xp(r),n=u.forwardRef((o,c)=>{const{children:h,...x}=o,N=u.Children.toArray(h),D=N.find(bp);if(D){const S=D.props.children,j=N.map(T=>T===D?u.Children.count(S)>1?u.Children.only(null):u.isValidElement(S)?S.props.children:null:T);return e.jsx(t,{...x,ref:c,children:u.isValidElement(S)?u.cloneElement(S,void 0,j):null})}return e.jsx(t,{...x,ref:c,children:h})});return n.displayName=`${r}.Slot`,n}function xp(r){const t=u.forwardRef((n,o)=>{const{children:c,...h}=n;if(u.isValidElement(c)){const x=wp(c),N=vp(h,c.props);return c.type!==u.Fragment&&(N.ref=o?Q0(o,x):x),u.cloneElement(c,N)}return u.Children.count(c)>1?u.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var yp=Symbol("radix.slottable");function bp(r){return u.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===yp}function vp(r,t){const n={...t};for(const o in t){const c=r[o],h=t[o];/^on[A-Z]/.test(o)?c&&h?n[o]=(...N)=>{const D=h(...N);return c(...N),D}:c&&(n[o]=c):o==="style"?n[o]={...c,...h}:o==="className"&&(n[o]=[c,h].filter(Boolean).join(" "))}return{...r,...n}}function wp(r){var o,c;let t=(o=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?r.ref:(t=(c=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:c.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?r.props.ref:r.props.ref||r.ref)}var Di="Popover",[lm]=Tl(Di,[Zu]),Zr=Zu(),[Np,es]=lm(Di),cm=r=>{const{__scopePopover:t,children:n,open:o,defaultOpen:c,onOpenChange:h,modal:x=!1}=r,N=Zr(t),D=u.useRef(null),[S,j]=u.useState(!1),[T,O]=em({prop:o,defaultProp:c??!1,onChange:h,caller:Di});return e.jsx(G0,{...N,children:e.jsx(Np,{scope:t,contentId:X0(),triggerRef:D,open:T,onOpenChange:O,onOpenToggle:u.useCallback(()=>O(P=>!P),[O]),hasCustomAnchor:S,onCustomAnchorAdd:u.useCallback(()=>j(!0),[]),onCustomAnchorRemove:u.useCallback(()=>j(!1),[]),modal:x,children:n})})};cm.displayName=Di;var dm="PopoverAnchor",jp=u.forwardRef((r,t)=>{const{__scopePopover:n,...o}=r,c=es(dm,n),h=Zr(n),{onCustomAnchorAdd:x,onCustomAnchorRemove:N}=c;return u.useEffect(()=>(x(),()=>N()),[x,N]),e.jsx(tm,{...h,...o,ref:t})});jp.displayName=dm;var um="PopoverTrigger",mm=u.forwardRef((r,t)=>{const{__scopePopover:n,...o}=r,c=es(um,n),h=Zr(n),x=Xr(t,c.triggerRef),N=e.jsx(Zs.button,{type:"button","aria-haspopup":"dialog","aria-expanded":c.open,"aria-controls":c.contentId,"data-state":xm(c.open),...o,ref:x,onClick:Xa(r.onClick,c.onOpenToggle)});return c.hasCustomAnchor?N:e.jsx(tm,{asChild:!0,...h,children:N})});mm.displayName=um;var Ol="PopoverPortal",[Sp,Dp]=lm(Ol,{forceMount:void 0}),hm=r=>{const{__scopePopover:t,forceMount:n,children:o,container:c}=r,h=es(Ol,t);return e.jsx(Sp,{scope:t,forceMount:n,children:e.jsx(Pl,{present:n||h.open,children:e.jsx(Z0,{asChild:!0,container:c,children:o})})})};hm.displayName=Ol;var Gs="PopoverContent",fm=u.forwardRef((r,t)=>{const n=Dp(Gs,r.__scopePopover),{forceMount:o=n.forceMount,...c}=r,h=es(Gs,r.__scopePopover);return e.jsx(Pl,{present:o||h.open,children:h.modal?e.jsx(Cp,{...c,ref:t}):e.jsx(Ip,{...c,ref:t})})});fm.displayName=Gs;var kp=pp("PopoverContent.RemoveScroll"),Cp=u.forwardRef((r,t)=>{const n=es(Gs,r.__scopePopover),o=u.useRef(null),c=Xr(t,o),h=u.useRef(!1);return u.useEffect(()=>{const x=o.current;if(x)return eg(x)},[]),e.jsx(tg,{as:kp,allowPinchZoom:!0,children:e.jsx(gm,{...r,ref:c,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Xa(r.onCloseAutoFocus,x=>{var N;x.preventDefault(),h.current||(N=n.triggerRef.current)==null||N.focus()}),onPointerDownOutside:Xa(r.onPointerDownOutside,x=>{const N=x.detail.originalEvent,D=N.button===0&&N.ctrlKey===!0,S=N.button===2||D;h.current=S},{checkForDefaultPrevented:!1}),onFocusOutside:Xa(r.onFocusOutside,x=>x.preventDefault(),{checkForDefaultPrevented:!1})})})}),Ip=u.forwardRef((r,t)=>{const n=es(Gs,r.__scopePopover),o=u.useRef(!1),c=u.useRef(!1);return e.jsx(gm,{...r,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:h=>{var x,N;(x=r.onCloseAutoFocus)==null||x.call(r,h),h.defaultPrevented||(o.current||(N=n.triggerRef.current)==null||N.focus(),h.preventDefault()),o.current=!1,c.current=!1},onInteractOutside:h=>{var D,S;(D=r.onInteractOutside)==null||D.call(r,h),h.defaultPrevented||(o.current=!0,h.detail.originalEvent.type==="pointerdown"&&(c.current=!0));const x=h.target;((S=n.triggerRef.current)==null?void 0:S.contains(x))&&h.preventDefault(),h.detail.originalEvent.type==="focusin"&&c.current&&h.preventDefault()}})}),gm=u.forwardRef((r,t)=>{const{__scopePopover:n,trapFocus:o,onOpenAutoFocus:c,onCloseAutoFocus:h,disableOutsidePointerEvents:x,onEscapeKeyDown:N,onPointerDownOutside:D,onFocusOutside:S,onInteractOutside:j,...T}=r,O=es(Gs,n),P=Zr(n);return ag(),e.jsx(sg,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:c,onUnmountAutoFocus:h,children:e.jsx(rg,{asChild:!0,disableOutsidePointerEvents:x,onInteractOutside:j,onEscapeKeyDown:N,onPointerDownOutside:D,onFocusOutside:S,onDismiss:()=>O.onOpenChange(!1),children:e.jsx(ng,{"data-state":xm(O.open),role:"dialog",id:O.contentId,...P,...T,ref:t,style:{...T.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),pm="PopoverClose",_p=u.forwardRef((r,t)=>{const{__scopePopover:n,...o}=r,c=es(pm,n);return e.jsx(Zs.button,{type:"button",...o,ref:t,onClick:Xa(r.onClick,()=>c.onOpenChange(!1))})});_p.displayName=pm;var Ap="PopoverArrow",Tp=u.forwardRef((r,t)=>{const{__scopePopover:n,...o}=r,c=Zr(n);return e.jsx(ig,{...c,...o,ref:t})});Tp.displayName=Ap;function xm(r){return r?"open":"closed"}var Pp=cm,Ep=mm,Op=hm,ym=fm;const Lu=Pp,Fu=Ep,Cl=u.forwardRef(({className:r,align:t="center",sideOffset:n=4,...o},c)=>e.jsx(Op,{children:e.jsx(ym,{ref:c,align:t,sideOffset:n,className:Za("z-[9999] w-72 rounded-xl border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...o})}));Cl.displayName=ym.displayName;function Ee(r){const t=Object.prototype.toString.call(r);return r instanceof Date||typeof r=="object"&&t==="[object Date]"?new r.constructor(+r):typeof r=="number"||t==="[object Number]"||typeof r=="string"||t==="[object String]"?new Date(r):new Date(NaN)}function Xt(r,t){return r instanceof Date?new r.constructor(t):new Date(t)}function Lt(r,t){const n=Ee(r);return isNaN(t)?Xt(r,NaN):(t&&n.setDate(n.getDate()+t),n)}function ha(r,t){const n=Ee(r);if(isNaN(t))return Xt(r,NaN);if(!t)return n;const o=n.getDate(),c=Xt(r,n.getTime());c.setMonth(n.getMonth()+t+1,0);const h=c.getDate();return o>=h?c:(n.setFullYear(c.getFullYear(),c.getMonth(),o),n)}const Ml=6048e5,Mp=864e5;let Rp={};function en(){return Rp}function ja(r,t){var N,D,S,j;const n=en(),o=(t==null?void 0:t.weekStartsOn)??((D=(N=t==null?void 0:t.locale)==null?void 0:N.options)==null?void 0:D.weekStartsOn)??n.weekStartsOn??((j=(S=n.locale)==null?void 0:S.options)==null?void 0:j.weekStartsOn)??0,c=Ee(r),h=c.getDay(),x=(h<o?7:0)+h-o;return c.setDate(c.getDate()-x),c.setHours(0,0,0,0),c}function ys(r){return ja(r,{weekStartsOn:1})}function bm(r){const t=Ee(r),n=t.getFullYear(),o=Xt(r,0);o.setFullYear(n+1,0,4),o.setHours(0,0,0,0);const c=ys(o),h=Xt(r,0);h.setFullYear(n,0,4),h.setHours(0,0,0,0);const x=ys(h);return t.getTime()>=c.getTime()?n+1:t.getTime()>=x.getTime()?n:n-1}function Xs(r){const t=Ee(r);return t.setHours(0,0,0,0),t}function Ni(r){const t=Ee(r),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+r-+n}function Na(r,t){const n=Xs(r),o=Xs(t),c=+n-Ni(n),h=+o-Ni(o);return Math.round((c-h)/Mp)}function Wp(r){const t=bm(r),n=Xt(r,0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),ys(n)}function Il(r,t){const n=t*7;return Lt(r,n)}function Lp(r,t){return ha(r,t*12)}function Fp(r){let t;return r.forEach(function(n){const o=Ee(n);(t===void 0||t<o||isNaN(Number(o)))&&(t=o)}),t||new Date(NaN)}function Bp(r){let t;return r.forEach(n=>{const o=Ee(n);(!t||t>o||isNaN(+o))&&(t=o)}),t||new Date(NaN)}function qt(r,t){const n=Xs(r),o=Xs(t);return+n==+o}function Rl(r){return r instanceof Date||typeof r=="object"&&Object.prototype.toString.call(r)==="[object Date]"}function $p(r){if(!Rl(r)&&typeof r!="number")return!1;const t=Ee(r);return!isNaN(Number(t))}function Qr(r,t){const n=Ee(r),o=Ee(t),c=n.getFullYear()-o.getFullYear(),h=n.getMonth()-o.getMonth();return c*12+h}function Up(r,t,n){const o=ja(r,n),c=ja(t,n),h=+o-Ni(o),x=+c-Ni(c);return Math.round((h-x)/Ml)}function Wl(r){const t=Ee(r),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function zt(r){const t=Ee(r);return t.setDate(1),t.setHours(0,0,0,0),t}function vm(r){const t=Ee(r),n=Xt(r,0);return n.setFullYear(t.getFullYear(),0,1),n.setHours(0,0,0,0),n}function Ll(r,t){var N,D,S,j;const n=en(),o=(t==null?void 0:t.weekStartsOn)??((D=(N=t==null?void 0:t.locale)==null?void 0:N.options)==null?void 0:D.weekStartsOn)??n.weekStartsOn??((j=(S=n.locale)==null?void 0:S.options)==null?void 0:j.weekStartsOn)??0,c=Ee(r),h=c.getDay(),x=(h<o?-7:0)+6-(h-o);return c.setDate(c.getDate()+x),c.setHours(23,59,59,999),c}function wm(r){return Ll(r,{weekStartsOn:1})}const Vp={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},qp=(r,t,n)=>{let o;const c=Vp[r];return typeof c=="string"?o=c:t===1?o=c.one:o=c.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+o:o+" ago":o};function Hs(r){return(t={})=>{const n=t.width?String(t.width):r.defaultWidth;return r.formats[n]||r.formats[r.defaultWidth]}}const zp={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Yp={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Kp={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Jp={date:Hs({formats:zp,defaultWidth:"full"}),time:Hs({formats:Yp,defaultWidth:"full"}),dateTime:Hs({formats:Kp,defaultWidth:"full"})},Hp={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Qp=(r,t,n,o)=>Hp[r];function va(r){return(t,n)=>{const o=n!=null&&n.context?String(n.context):"standalone";let c;if(o==="formatting"&&r.formattingValues){const x=r.defaultFormattingWidth||r.defaultWidth,N=n!=null&&n.width?String(n.width):x;c=r.formattingValues[N]||r.formattingValues[x]}else{const x=r.defaultWidth,N=n!=null&&n.width?String(n.width):r.defaultWidth;c=r.values[N]||r.values[x]}const h=r.argumentCallback?r.argumentCallback(t):t;return c[h]}}const Gp={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Xp={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Zp={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},ex={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},tx={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},ax={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},sx=(r,t)=>{const n=Number(r),o=n%100;if(o>20||o<10)switch(o%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},rx={ordinalNumber:sx,era:va({values:Gp,defaultWidth:"wide"}),quarter:va({values:Xp,defaultWidth:"wide",argumentCallback:r=>r-1}),month:va({values:Zp,defaultWidth:"wide"}),day:va({values:ex,defaultWidth:"wide"}),dayPeriod:va({values:tx,defaultWidth:"wide",formattingValues:ax,defaultFormattingWidth:"wide"})};function wa(r){return(t,n={})=>{const o=n.width,c=o&&r.matchPatterns[o]||r.matchPatterns[r.defaultMatchWidth],h=t.match(c);if(!h)return null;const x=h[0],N=o&&r.parsePatterns[o]||r.parsePatterns[r.defaultParseWidth],D=Array.isArray(N)?ix(N,T=>T.test(x)):nx(N,T=>T.test(x));let S;S=r.valueCallback?r.valueCallback(D):D,S=n.valueCallback?n.valueCallback(S):S;const j=t.slice(x.length);return{value:S,rest:j}}}function nx(r,t){for(const n in r)if(Object.prototype.hasOwnProperty.call(r,n)&&t(r[n]))return n}function ix(r,t){for(let n=0;n<r.length;n++)if(t(r[n]))return n}function Nm(r){return(t,n={})=>{const o=t.match(r.matchPattern);if(!o)return null;const c=o[0],h=t.match(r.parsePattern);if(!h)return null;let x=r.valueCallback?r.valueCallback(h[0]):h[0];x=n.valueCallback?n.valueCallback(x):x;const N=t.slice(c.length);return{value:x,rest:N}}}const ox=/^(\d+)(th|st|nd|rd)?/i,lx=/\d+/i,cx={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},dx={any:[/^b/i,/^(a|c)/i]},ux={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},mx={any:[/1/i,/2/i,/3/i,/4/i]},hx={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},fx={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},gx={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},px={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},xx={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},yx={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},bx={ordinalNumber:Nm({matchPattern:ox,parsePattern:lx,valueCallback:r=>parseInt(r,10)}),era:wa({matchPatterns:cx,defaultMatchWidth:"wide",parsePatterns:dx,defaultParseWidth:"any"}),quarter:wa({matchPatterns:ux,defaultMatchWidth:"wide",parsePatterns:mx,defaultParseWidth:"any",valueCallback:r=>r+1}),month:wa({matchPatterns:hx,defaultMatchWidth:"wide",parsePatterns:fx,defaultParseWidth:"any"}),day:wa({matchPatterns:gx,defaultMatchWidth:"wide",parsePatterns:px,defaultParseWidth:"any"}),dayPeriod:wa({matchPatterns:xx,defaultMatchWidth:"any",parsePatterns:yx,defaultParseWidth:"any"})},jm={code:"en-US",formatDistance:qp,formatLong:Jp,formatRelative:Qp,localize:rx,match:bx,options:{weekStartsOn:0,firstWeekContainsDate:1}};function vx(r){const t=Ee(r);return Na(t,vm(t))+1}function Sm(r){const t=Ee(r),n=+ys(t)-+Wp(t);return Math.round(n/Ml)+1}function Dm(r,t){var j,T,O,P;const n=Ee(r),o=n.getFullYear(),c=en(),h=(t==null?void 0:t.firstWeekContainsDate)??((T=(j=t==null?void 0:t.locale)==null?void 0:j.options)==null?void 0:T.firstWeekContainsDate)??c.firstWeekContainsDate??((P=(O=c.locale)==null?void 0:O.options)==null?void 0:P.firstWeekContainsDate)??1,x=Xt(r,0);x.setFullYear(o+1,0,h),x.setHours(0,0,0,0);const N=ja(x,t),D=Xt(r,0);D.setFullYear(o,0,h),D.setHours(0,0,0,0);const S=ja(D,t);return n.getTime()>=N.getTime()?o+1:n.getTime()>=S.getTime()?o:o-1}function wx(r,t){var N,D,S,j;const n=en(),o=(t==null?void 0:t.firstWeekContainsDate)??((D=(N=t==null?void 0:t.locale)==null?void 0:N.options)==null?void 0:D.firstWeekContainsDate)??n.firstWeekContainsDate??((j=(S=n.locale)==null?void 0:S.options)==null?void 0:j.firstWeekContainsDate)??1,c=Dm(r,t),h=Xt(r,0);return h.setFullYear(c,0,o),h.setHours(0,0,0,0),ja(h,t)}function km(r,t){const n=Ee(r),o=+ja(n,t)-+wx(n,t);return Math.round(o/Ml)+1}function Le(r,t){const n=r<0?"-":"",o=Math.abs(r).toString().padStart(t,"0");return n+o}const Ya={y(r,t){const n=r.getFullYear(),o=n>0?n:1-n;return Le(t==="yy"?o%100:o,t.length)},M(r,t){const n=r.getMonth();return t==="M"?String(n+1):Le(n+1,2)},d(r,t){return Le(r.getDate(),t.length)},a(r,t){const n=r.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(r,t){return Le(r.getHours()%12||12,t.length)},H(r,t){return Le(r.getHours(),t.length)},m(r,t){return Le(r.getMinutes(),t.length)},s(r,t){return Le(r.getSeconds(),t.length)},S(r,t){const n=t.length,o=r.getMilliseconds(),c=Math.trunc(o*Math.pow(10,n-3));return Le(c,t.length)}},qs={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Bu={G:function(r,t,n){const o=r.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(o,{width:"abbreviated"});case"GGGGG":return n.era(o,{width:"narrow"});case"GGGG":default:return n.era(o,{width:"wide"})}},y:function(r,t,n){if(t==="yo"){const o=r.getFullYear(),c=o>0?o:1-o;return n.ordinalNumber(c,{unit:"year"})}return Ya.y(r,t)},Y:function(r,t,n,o){const c=Dm(r,o),h=c>0?c:1-c;if(t==="YY"){const x=h%100;return Le(x,2)}return t==="Yo"?n.ordinalNumber(h,{unit:"year"}):Le(h,t.length)},R:function(r,t){const n=bm(r);return Le(n,t.length)},u:function(r,t){const n=r.getFullYear();return Le(n,t.length)},Q:function(r,t,n){const o=Math.ceil((r.getMonth()+1)/3);switch(t){case"Q":return String(o);case"QQ":return Le(o,2);case"Qo":return n.ordinalNumber(o,{unit:"quarter"});case"QQQ":return n.quarter(o,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(o,{width:"wide",context:"formatting"})}},q:function(r,t,n){const o=Math.ceil((r.getMonth()+1)/3);switch(t){case"q":return String(o);case"qq":return Le(o,2);case"qo":return n.ordinalNumber(o,{unit:"quarter"});case"qqq":return n.quarter(o,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(o,{width:"wide",context:"standalone"})}},M:function(r,t,n){const o=r.getMonth();switch(t){case"M":case"MM":return Ya.M(r,t);case"Mo":return n.ordinalNumber(o+1,{unit:"month"});case"MMM":return n.month(o,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(o,{width:"wide",context:"formatting"})}},L:function(r,t,n){const o=r.getMonth();switch(t){case"L":return String(o+1);case"LL":return Le(o+1,2);case"Lo":return n.ordinalNumber(o+1,{unit:"month"});case"LLL":return n.month(o,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(o,{width:"wide",context:"standalone"})}},w:function(r,t,n,o){const c=km(r,o);return t==="wo"?n.ordinalNumber(c,{unit:"week"}):Le(c,t.length)},I:function(r,t,n){const o=Sm(r);return t==="Io"?n.ordinalNumber(o,{unit:"week"}):Le(o,t.length)},d:function(r,t,n){return t==="do"?n.ordinalNumber(r.getDate(),{unit:"date"}):Ya.d(r,t)},D:function(r,t,n){const o=vx(r);return t==="Do"?n.ordinalNumber(o,{unit:"dayOfYear"}):Le(o,t.length)},E:function(r,t,n){const o=r.getDay();switch(t){case"E":case"EE":case"EEE":return n.day(o,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(o,{width:"short",context:"formatting"});case"EEEE":default:return n.day(o,{width:"wide",context:"formatting"})}},e:function(r,t,n,o){const c=r.getDay(),h=(c-o.weekStartsOn+8)%7||7;switch(t){case"e":return String(h);case"ee":return Le(h,2);case"eo":return n.ordinalNumber(h,{unit:"day"});case"eee":return n.day(c,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(c,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(c,{width:"short",context:"formatting"});case"eeee":default:return n.day(c,{width:"wide",context:"formatting"})}},c:function(r,t,n,o){const c=r.getDay(),h=(c-o.weekStartsOn+8)%7||7;switch(t){case"c":return String(h);case"cc":return Le(h,t.length);case"co":return n.ordinalNumber(h,{unit:"day"});case"ccc":return n.day(c,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(c,{width:"narrow",context:"standalone"});case"cccccc":return n.day(c,{width:"short",context:"standalone"});case"cccc":default:return n.day(c,{width:"wide",context:"standalone"})}},i:function(r,t,n){const o=r.getDay(),c=o===0?7:o;switch(t){case"i":return String(c);case"ii":return Le(c,t.length);case"io":return n.ordinalNumber(c,{unit:"day"});case"iii":return n.day(o,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(o,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(o,{width:"short",context:"formatting"});case"iiii":default:return n.day(o,{width:"wide",context:"formatting"})}},a:function(r,t,n){const c=r.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(c,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(c,{width:"wide",context:"formatting"})}},b:function(r,t,n){const o=r.getHours();let c;switch(o===12?c=qs.noon:o===0?c=qs.midnight:c=o/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(c,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(c,{width:"wide",context:"formatting"})}},B:function(r,t,n){const o=r.getHours();let c;switch(o>=17?c=qs.evening:o>=12?c=qs.afternoon:o>=4?c=qs.morning:c=qs.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(c,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(c,{width:"wide",context:"formatting"})}},h:function(r,t,n){if(t==="ho"){let o=r.getHours()%12;return o===0&&(o=12),n.ordinalNumber(o,{unit:"hour"})}return Ya.h(r,t)},H:function(r,t,n){return t==="Ho"?n.ordinalNumber(r.getHours(),{unit:"hour"}):Ya.H(r,t)},K:function(r,t,n){const o=r.getHours()%12;return t==="Ko"?n.ordinalNumber(o,{unit:"hour"}):Le(o,t.length)},k:function(r,t,n){let o=r.getHours();return o===0&&(o=24),t==="ko"?n.ordinalNumber(o,{unit:"hour"}):Le(o,t.length)},m:function(r,t,n){return t==="mo"?n.ordinalNumber(r.getMinutes(),{unit:"minute"}):Ya.m(r,t)},s:function(r,t,n){return t==="so"?n.ordinalNumber(r.getSeconds(),{unit:"second"}):Ya.s(r,t)},S:function(r,t){return Ya.S(r,t)},X:function(r,t,n){const o=r.getTimezoneOffset();if(o===0)return"Z";switch(t){case"X":return Uu(o);case"XXXX":case"XX":return xs(o);case"XXXXX":case"XXX":default:return xs(o,":")}},x:function(r,t,n){const o=r.getTimezoneOffset();switch(t){case"x":return Uu(o);case"xxxx":case"xx":return xs(o);case"xxxxx":case"xxx":default:return xs(o,":")}},O:function(r,t,n){const o=r.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+$u(o,":");case"OOOO":default:return"GMT"+xs(o,":")}},z:function(r,t,n){const o=r.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+$u(o,":");case"zzzz":default:return"GMT"+xs(o,":")}},t:function(r,t,n){const o=Math.trunc(r.getTime()/1e3);return Le(o,t.length)},T:function(r,t,n){const o=r.getTime();return Le(o,t.length)}};function $u(r,t=""){const n=r>0?"-":"+",o=Math.abs(r),c=Math.trunc(o/60),h=o%60;return h===0?n+String(c):n+String(c)+t+Le(h,2)}function Uu(r,t){return r%60===0?(r>0?"-":"+")+Le(Math.abs(r)/60,2):xs(r,t)}function xs(r,t=""){const n=r>0?"-":"+",o=Math.abs(r),c=Le(Math.trunc(o/60),2),h=Le(o%60,2);return n+c+t+h}const Vu=(r,t)=>{switch(r){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Cm=(r,t)=>{switch(r){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Nx=(r,t)=>{const n=r.match(/(P+)(p+)?/)||[],o=n[1],c=n[2];if(!c)return Vu(r,t);let h;switch(o){case"P":h=t.dateTime({width:"short"});break;case"PP":h=t.dateTime({width:"medium"});break;case"PPP":h=t.dateTime({width:"long"});break;case"PPPP":default:h=t.dateTime({width:"full"});break}return h.replace("{{date}}",Vu(o,t)).replace("{{time}}",Cm(c,t))},jx={p:Cm,P:Nx},Sx=/^D+$/,Dx=/^Y+$/,kx=["D","DD","YY","YYYY"];function Cx(r){return Sx.test(r)}function Ix(r){return Dx.test(r)}function _x(r,t,n){const o=Ax(r,t,n);if(console.warn(o),kx.includes(r))throw new RangeError(o)}function Ax(r,t,n){const o=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${t}\`) for formatting ${o} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Tx=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Px=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ex=/^'([^]*?)'?$/,Ox=/''/g,Mx=/[a-zA-Z]/;function ma(r,t,n){var j,T,O,P,p,z,B,le;const o=en(),c=(n==null?void 0:n.locale)??o.locale??jm,h=(n==null?void 0:n.firstWeekContainsDate)??((T=(j=n==null?void 0:n.locale)==null?void 0:j.options)==null?void 0:T.firstWeekContainsDate)??o.firstWeekContainsDate??((P=(O=o.locale)==null?void 0:O.options)==null?void 0:P.firstWeekContainsDate)??1,x=(n==null?void 0:n.weekStartsOn)??((z=(p=n==null?void 0:n.locale)==null?void 0:p.options)==null?void 0:z.weekStartsOn)??o.weekStartsOn??((le=(B=o.locale)==null?void 0:B.options)==null?void 0:le.weekStartsOn)??0,N=Ee(r);if(!$p(N))throw new RangeError("Invalid time value");let D=t.match(Px).map(re=>{const U=re[0];if(U==="p"||U==="P"){const te=jx[U];return te(re,c.formatLong)}return re}).join("").match(Tx).map(re=>{if(re==="''")return{isToken:!1,value:"'"};const U=re[0];if(U==="'")return{isToken:!1,value:Rx(re)};if(Bu[U])return{isToken:!0,value:re};if(U.match(Mx))throw new RangeError("Format string contains an unescaped latin alphabet character `"+U+"`");return{isToken:!1,value:re}});c.localize.preprocessor&&(D=c.localize.preprocessor(N,D));const S={firstWeekContainsDate:h,weekStartsOn:x,locale:c};return D.map(re=>{if(!re.isToken)return re.value;const U=re.value;(!(n!=null&&n.useAdditionalWeekYearTokens)&&Ix(U)||!(n!=null&&n.useAdditionalDayOfYearTokens)&&Cx(U))&&_x(U,t,String(r));const te=Bu[U[0]];return te(N,U,c.localize,S)}).join("")}function Rx(r){const t=r.match(Ex);return t?t[1].replace(Ox,"'"):r}function Wx(r){const t=Ee(r),n=t.getFullYear(),o=t.getMonth(),c=Xt(r,0);return c.setFullYear(n,o+1,0),c.setHours(0,0,0,0),c.getDate()}function Lx(r){return Math.trunc(+Ee(r)/1e3)}function Fx(r){const t=Ee(r),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(0,0,0,0),t}function Bx(r,t){return Up(Fx(r),zt(r),t)+1}function _l(r,t){const n=Ee(r),o=Ee(t);return n.getTime()>o.getTime()}function Im(r,t){const n=Ee(r),o=Ee(t);return+n<+o}function Fl(r,t){const n=Ee(r),o=Ee(t);return n.getFullYear()===o.getFullYear()&&n.getMonth()===o.getMonth()}function $x(r,t){const n=Ee(r),o=Ee(t);return n.getFullYear()===o.getFullYear()}function vl(r,t){return Lt(r,-t)}function wl(r,t){const n=Ee(r),o=n.getFullYear(),c=n.getDate(),h=Xt(r,0);h.setFullYear(o,t,15),h.setHours(0,0,0,0);const x=Wx(h);return n.setMonth(t,Math.min(c,x)),n}function qu(r,t){const n=Ee(r);return isNaN(+n)?Xt(r,NaN):(n.setFullYear(t),n)}const Ux={lessThanXSeconds:{one:"أقل من ثانية",two:"أقل من ثانيتين",threeToTen:"أقل من {{count}} ثواني",other:"أقل من {{count}} ثانية"},xSeconds:{one:"ثانية واحدة",two:"ثانيتان",threeToTen:"{{count}} ثواني",other:"{{count}} ثانية"},halfAMinute:"نصف دقيقة",lessThanXMinutes:{one:"أقل من دقيقة",two:"أقل من دقيقتين",threeToTen:"أقل من {{count}} دقائق",other:"أقل من {{count}} دقيقة"},xMinutes:{one:"دقيقة واحدة",two:"دقيقتان",threeToTen:"{{count}} دقائق",other:"{{count}} دقيقة"},aboutXHours:{one:"ساعة واحدة تقريباً",two:"ساعتين تقريبا",threeToTen:"{{count}} ساعات تقريباً",other:"{{count}} ساعة تقريباً"},xHours:{one:"ساعة واحدة",two:"ساعتان",threeToTen:"{{count}} ساعات",other:"{{count}} ساعة"},xDays:{one:"يوم واحد",two:"يومان",threeToTen:"{{count}} أيام",other:"{{count}} يوم"},aboutXWeeks:{one:"أسبوع واحد تقريبا",two:"أسبوعين تقريبا",threeToTen:"{{count}} أسابيع تقريبا",other:"{{count}} أسبوعا تقريبا"},xWeeks:{one:"أسبوع واحد",two:"أسبوعان",threeToTen:"{{count}} أسابيع",other:"{{count}} أسبوعا"},aboutXMonths:{one:"شهر واحد تقريباً",two:"شهرين تقريبا",threeToTen:"{{count}} أشهر تقريبا",other:"{{count}} شهرا تقريباً"},xMonths:{one:"شهر واحد",two:"شهران",threeToTen:"{{count}} أشهر",other:"{{count}} شهرا"},aboutXYears:{one:"سنة واحدة تقريباً",two:"سنتين تقريبا",threeToTen:"{{count}} سنوات تقريباً",other:"{{count}} سنة تقريباً"},xYears:{one:"سنة واحد",two:"سنتان",threeToTen:"{{count}} سنوات",other:"{{count}} سنة"},overXYears:{one:"أكثر من سنة",two:"أكثر من سنتين",threeToTen:"أكثر من {{count}} سنوات",other:"أكثر من {{count}} سنة"},almostXYears:{one:"ما يقارب سنة واحدة",two:"ما يقارب سنتين",threeToTen:"ما يقارب {{count}} سنوات",other:"ما يقارب {{count}} سنة"}},Vx=(r,t,n)=>{const o=Ux[r];let c;return typeof o=="string"?c=o:t===1?c=o.one:t===2?c=o.two:t<=10?c=o.threeToTen.replace("{{count}}",String(t)):c=o.other.replace("{{count}}",String(t)),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"خلال "+c:"منذ "+c:c},qx={full:"EEEE، do MMMM y",long:"do MMMM y",medium:"d MMM y",short:"dd/MM/yyyy"},zx={full:"HH:mm:ss",long:"HH:mm:ss",medium:"HH:mm:ss",short:"HH:mm"},Yx={full:"{{date}} 'عند الساعة' {{time}}",long:"{{date}} 'عند الساعة' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Kx={date:Hs({formats:qx,defaultWidth:"full"}),time:Hs({formats:zx,defaultWidth:"full"}),dateTime:Hs({formats:Yx,defaultWidth:"full"})},Jx={lastWeek:"eeee 'الماضي عند الساعة' p",yesterday:"'الأمس عند الساعة' p",today:"'اليوم عند الساعة' p",tomorrow:"'غدا عند الساعة' p",nextWeek:"eeee 'القادم عند الساعة' p",other:"P"},Hx=r=>Jx[r],Qx={narrow:["ق","ب"],abbreviated:["ق.م.","ب.م."],wide:["قبل الميلاد","بعد الميلاد"]},Gx={narrow:["1","2","3","4"],abbreviated:["ر1","ر2","ر3","ر4"],wide:["الربع الأول","الربع الثاني","الربع الثالث","الربع الرابع"]},Xx={narrow:["ي","ف","م","أ","م","ي","ي","أ","س","أ","ن","د"],abbreviated:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],wide:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"]},Zx={narrow:["ح","ن","ث","ر","خ","ج","س"],short:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],abbreviated:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],wide:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"]},ey={narrow:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"},abbreviated:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"},wide:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"}},ty={narrow:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"},abbreviated:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"},wide:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"}},ay=r=>String(r),sy={ordinalNumber:ay,era:va({values:Qx,defaultWidth:"wide"}),quarter:va({values:Gx,defaultWidth:"wide",argumentCallback:r=>r-1}),month:va({values:Xx,defaultWidth:"wide"}),day:va({values:Zx,defaultWidth:"wide"}),dayPeriod:va({values:ey,defaultWidth:"wide",formattingValues:ty,defaultFormattingWidth:"wide"})},ry=/^(\d+)(th|st|nd|rd)?/i,ny=/\d+/i,iy={narrow:/[قب]/,abbreviated:/[قب]\.م\./,wide:/(قبل|بعد) الميلاد/},oy={any:[/قبل/,/بعد/]},ly={narrow:/^[1234]/i,abbreviated:/ر[1234]/,wide:/الربع (الأول|الثاني|الثالث|الرابع)/},cy={any:[/1/i,/2/i,/3/i,/4/i]},dy={narrow:/^[أيفمسند]/,abbreviated:/^(يناير|فبراير|مارس|أبريل|مايو|يونيو|يوليو|أغسطس|سبتمبر|أكتوبر|نوفمبر|ديسمبر)/,wide:/^(يناير|فبراير|مارس|أبريل|مايو|يونيو|يوليو|أغسطس|سبتمبر|أكتوبر|نوفمبر|ديسمبر)/},uy={narrow:[/^ي/i,/^ف/i,/^م/i,/^أ/i,/^م/i,/^ي/i,/^ي/i,/^أ/i,/^س/i,/^أ/i,/^ن/i,/^د/i],any:[/^يناير/i,/^فبراير/i,/^مارس/i,/^أبريل/i,/^مايو/i,/^يونيو/i,/^يوليو/i,/^أغسطس/i,/^سبتمبر/i,/^أكتوبر/i,/^نوفمبر/i,/^ديسمبر/i]},my={narrow:/^[حنثرخجس]/i,short:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,abbreviated:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,wide:/^(الأحد|الاثنين|الثلاثاء|الأربعاء|الخميس|الجمعة|السبت)/i},hy={narrow:[/^ح/i,/^ن/i,/^ث/i,/^ر/i,/^خ/i,/^ج/i,/^س/i],wide:[/^الأحد/i,/^الاثنين/i,/^الثلاثاء/i,/^الأربعاء/i,/^الخميس/i,/^الجمعة/i,/^السبت/i],any:[/^أح/i,/^اث/i,/^ث/i,/^أر/i,/^خ/i,/^ج/i,/^س/i]},fy={narrow:/^(ص|م|منتصف الليل|الظهر|بعد الظهر|في الصباح|في المساء|في الليل)/,any:/^(ص|م|منتصف الليل|الظهر|بعد الظهر|في الصباح|في المساء|في الليل)/},gy={any:{am:/^ص/,pm:/^م/,midnight:/منتصف الليل/,noon:/الظهر/,afternoon:/بعد الظهر/,morning:/في الصباح/,evening:/في المساء/,night:/في الليل/}},py={ordinalNumber:Nm({matchPattern:ry,parsePattern:ny,valueCallback:r=>parseInt(r,10)}),era:wa({matchPatterns:iy,defaultMatchWidth:"wide",parsePatterns:oy,defaultParseWidth:"any"}),quarter:wa({matchPatterns:ly,defaultMatchWidth:"wide",parsePatterns:cy,defaultParseWidth:"any",valueCallback:r=>r+1}),month:wa({matchPatterns:dy,defaultMatchWidth:"wide",parsePatterns:uy,defaultParseWidth:"any"}),day:wa({matchPatterns:my,defaultMatchWidth:"wide",parsePatterns:hy,defaultParseWidth:"any"}),dayPeriod:wa({matchPatterns:fy,defaultMatchWidth:"any",parsePatterns:gy,defaultParseWidth:"any"})},zu={code:"ar",formatDistance:Vx,formatLong:Kx,formatRelative:Hx,localize:sy,match:py,options:{weekStartsOn:6,firstWeekContainsDate:1}};var me=function(){return me=Object.assign||function(t){for(var n,o=1,c=arguments.length;o<c;o++){n=arguments[o];for(var h in n)Object.prototype.hasOwnProperty.call(n,h)&&(t[h]=n[h])}return t},me.apply(this,arguments)};function xy(r,t){var n={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&t.indexOf(o)<0&&(n[o]=r[o]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,o=Object.getOwnPropertySymbols(r);c<o.length;c++)t.indexOf(o[c])<0&&Object.prototype.propertyIsEnumerable.call(r,o[c])&&(n[o[c]]=r[o[c]]);return n}function _m(r,t,n){for(var o=0,c=t.length,h;o<c;o++)(h||!(o in t))&&(h||(h=Array.prototype.slice.call(t,0,o)),h[o]=t[o]);return r.concat(h||Array.prototype.slice.call(t))}function tn(r){return r.mode==="multiple"}function an(r){return r.mode==="range"}function ki(r){return r.mode==="single"}var yy={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function by(r,t){return ma(r,"LLLL y",t)}function vy(r,t){return ma(r,"d",t)}function wy(r,t){return ma(r,"LLLL",t)}function Ny(r){return"".concat(r)}function jy(r,t){return ma(r,"cccccc",t)}function Sy(r,t){return ma(r,"yyyy",t)}var Dy=Object.freeze({__proto__:null,formatCaption:by,formatDay:vy,formatMonthCaption:wy,formatWeekNumber:Ny,formatWeekdayName:jy,formatYearCaption:Sy}),ky=function(r,t,n){return ma(r,"do MMMM (EEEE)",n)},Cy=function(){return"Month: "},Iy=function(){return"Go to next month"},_y=function(){return"Go to previous month"},Ay=function(r,t){return ma(r,"cccc",t)},Ty=function(r){return"Week n. ".concat(r)},Py=function(){return"Year: "},Ey=Object.freeze({__proto__:null,labelDay:ky,labelMonthDropdown:Cy,labelNext:Iy,labelPrevious:_y,labelWeekNumber:Ty,labelWeekday:Ay,labelYearDropdown:Py});function Oy(){var r="buttons",t=yy,n=jm,o={},c={},h=1,x={},N=new Date;return{captionLayout:r,classNames:t,formatters:Dy,labels:Ey,locale:n,modifiersClassNames:o,modifiers:c,numberOfMonths:h,styles:x,today:N,mode:"default"}}function My(r){var t=r.fromYear,n=r.toYear,o=r.fromMonth,c=r.toMonth,h=r.fromDate,x=r.toDate;return o?h=zt(o):t&&(h=new Date(t,0,1)),c?x=Wl(c):n&&(x=new Date(n,11,31)),{fromDate:h?Xs(h):void 0,toDate:x?Xs(x):void 0}}var Am=u.createContext(void 0);function Ry(r){var t,n=r.initialProps,o=Oy(),c=My(n),h=c.fromDate,x=c.toDate,N=(t=n.captionLayout)!==null&&t!==void 0?t:o.captionLayout;N!=="buttons"&&(!h||!x)&&(N="buttons");var D;(ki(n)||tn(n)||an(n))&&(D=n.onSelect);var S=me(me(me({},o),n),{captionLayout:N,classNames:me(me({},o.classNames),n.classNames),components:me({},n.components),formatters:me(me({},o.formatters),n.formatters),fromDate:h,labels:me(me({},o.labels),n.labels),mode:n.mode||o.mode,modifiers:me(me({},o.modifiers),n.modifiers),modifiersClassNames:me(me({},o.modifiersClassNames),n.modifiersClassNames),onSelect:D,styles:me(me({},o.styles),n.styles),toDate:x});return e.jsx(Am.Provider,{value:S,children:r.children})}function ze(){var r=u.useContext(Am);if(!r)throw new Error("useDayPicker must be used within a DayPickerProvider.");return r}function Tm(r){var t=ze(),n=t.locale,o=t.classNames,c=t.styles,h=t.formatters.formatCaption;return e.jsx("div",{className:o.caption_label,style:c.caption_label,"aria-live":"polite",role:"presentation",id:r.id,children:h(r.displayMonth,{locale:n})})}function Wy(r){return e.jsx("svg",me({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},r,{children:e.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Pm(r){var t,n,o=r.onChange,c=r.value,h=r.children,x=r.caption,N=r.className,D=r.style,S=ze(),j=(n=(t=S.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&n!==void 0?n:Wy;return e.jsxs("div",{className:N,style:D,children:[e.jsx("span",{className:S.classNames.vhidden,children:r["aria-label"]}),e.jsx("select",{name:r.name,"aria-label":r["aria-label"],className:S.classNames.dropdown,style:S.styles.dropdown,value:c,onChange:o,children:h}),e.jsxs("div",{className:S.classNames.caption_label,style:S.styles.caption_label,"aria-hidden":"true",children:[x,e.jsx(j,{className:S.classNames.dropdown_icon,style:S.styles.dropdown_icon})]})]})}function Ly(r){var t,n=ze(),o=n.fromDate,c=n.toDate,h=n.styles,x=n.locale,N=n.formatters.formatMonthCaption,D=n.classNames,S=n.components,j=n.labels.labelMonthDropdown;if(!o)return e.jsx(e.Fragment,{});if(!c)return e.jsx(e.Fragment,{});var T=[];if($x(o,c))for(var O=zt(o),P=o.getMonth();P<=c.getMonth();P++)T.push(wl(O,P));else for(var O=zt(new Date),P=0;P<=11;P++)T.push(wl(O,P));var p=function(B){var le=Number(B.target.value),re=wl(zt(r.displayMonth),le);r.onChange(re)},z=(t=S==null?void 0:S.Dropdown)!==null&&t!==void 0?t:Pm;return e.jsx(z,{name:"months","aria-label":j(),className:D.dropdown_month,style:h.dropdown_month,onChange:p,value:r.displayMonth.getMonth(),caption:N(r.displayMonth,{locale:x}),children:T.map(function(B){return e.jsx("option",{value:B.getMonth(),children:N(B,{locale:x})},B.getMonth())})})}function Fy(r){var t,n=r.displayMonth,o=ze(),c=o.fromDate,h=o.toDate,x=o.locale,N=o.styles,D=o.classNames,S=o.components,j=o.formatters.formatYearCaption,T=o.labels.labelYearDropdown,O=[];if(!c)return e.jsx(e.Fragment,{});if(!h)return e.jsx(e.Fragment,{});for(var P=c.getFullYear(),p=h.getFullYear(),z=P;z<=p;z++)O.push(qu(vm(new Date),z));var B=function(re){var U=qu(zt(n),Number(re.target.value));r.onChange(U)},le=(t=S==null?void 0:S.Dropdown)!==null&&t!==void 0?t:Pm;return e.jsx(le,{name:"years","aria-label":T(),className:D.dropdown_year,style:N.dropdown_year,onChange:B,value:n.getFullYear(),caption:j(n,{locale:x}),children:O.map(function(re){return e.jsx("option",{value:re.getFullYear(),children:j(re,{locale:x})},re.getFullYear())})})}function By(r,t){var n=u.useState(r),o=n[0],c=n[1],h=t===void 0?o:t;return[h,c]}function $y(r){var t=r.month,n=r.defaultMonth,o=r.today,c=t||n||o||new Date,h=r.toDate,x=r.fromDate,N=r.numberOfMonths,D=N===void 0?1:N;if(h&&Qr(h,c)<0){var S=-1*(D-1);c=ha(h,S)}return x&&Qr(c,x)<0&&(c=x),zt(c)}function Uy(){var r=ze(),t=$y(r),n=By(t,r.month),o=n[0],c=n[1],h=function(x){var N;if(!r.disableNavigation){var D=zt(x);c(D),(N=r.onMonthChange)===null||N===void 0||N.call(r,D)}};return[o,h]}function Vy(r,t){for(var n=t.reverseMonths,o=t.numberOfMonths,c=zt(r),h=zt(ha(c,o)),x=Qr(h,c),N=[],D=0;D<x;D++){var S=ha(c,D);N.push(S)}return n&&(N=N.reverse()),N}function qy(r,t){if(!t.disableNavigation){var n=t.toDate,o=t.pagedNavigation,c=t.numberOfMonths,h=c===void 0?1:c,x=o?h:1,N=zt(r);if(!n)return ha(N,x);var D=Qr(n,r);if(!(D<h))return ha(N,x)}}function zy(r,t){if(!t.disableNavigation){var n=t.fromDate,o=t.pagedNavigation,c=t.numberOfMonths,h=c===void 0?1:c,x=o?h:1,N=zt(r);if(!n)return ha(N,-x);var D=Qr(N,n);if(!(D<=0))return ha(N,-x)}}var Em=u.createContext(void 0);function Yy(r){var t=ze(),n=Uy(),o=n[0],c=n[1],h=Vy(o,t),x=qy(o,t),N=zy(o,t),D=function(T){return h.some(function(O){return Fl(T,O)})},S=function(T,O){D(T)||(O&&Im(T,O)?c(ha(T,1+t.numberOfMonths*-1)):c(T))},j={currentMonth:o,displayMonths:h,goToMonth:c,goToDate:S,previousMonth:N,nextMonth:x,isDateDisplayed:D};return e.jsx(Em.Provider,{value:j,children:r.children})}function sn(){var r=u.useContext(Em);if(!r)throw new Error("useNavigation must be used within a NavigationProvider");return r}function Yu(r){var t,n=ze(),o=n.classNames,c=n.styles,h=n.components,x=sn().goToMonth,N=function(j){x(ha(j,r.displayIndex?-r.displayIndex:0))},D=(t=h==null?void 0:h.CaptionLabel)!==null&&t!==void 0?t:Tm,S=e.jsx(D,{id:r.id,displayMonth:r.displayMonth});return e.jsxs("div",{className:o.caption_dropdowns,style:c.caption_dropdowns,children:[e.jsx("div",{className:o.vhidden,children:S}),e.jsx(Ly,{onChange:N,displayMonth:r.displayMonth}),e.jsx(Fy,{onChange:N,displayMonth:r.displayMonth})]})}function Ky(r){return e.jsx("svg",me({width:"16px",height:"16px",viewBox:"0 0 120 120"},r,{children:e.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Jy(r){return e.jsx("svg",me({width:"16px",height:"16px",viewBox:"0 0 120 120"},r,{children:e.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var ji=u.forwardRef(function(r,t){var n=ze(),o=n.classNames,c=n.styles,h=[o.button_reset,o.button];r.className&&h.push(r.className);var x=h.join(" "),N=me(me({},c.button_reset),c.button);return r.style&&Object.assign(N,r.style),e.jsx("button",me({},r,{ref:t,type:"button",className:x,style:N}))});function Hy(r){var t,n,o=ze(),c=o.dir,h=o.locale,x=o.classNames,N=o.styles,D=o.labels,S=D.labelPrevious,j=D.labelNext,T=o.components;if(!r.nextMonth&&!r.previousMonth)return e.jsx(e.Fragment,{});var O=S(r.previousMonth,{locale:h}),P=[x.nav_button,x.nav_button_previous].join(" "),p=j(r.nextMonth,{locale:h}),z=[x.nav_button,x.nav_button_next].join(" "),B=(t=T==null?void 0:T.IconRight)!==null&&t!==void 0?t:Jy,le=(n=T==null?void 0:T.IconLeft)!==null&&n!==void 0?n:Ky;return e.jsxs("div",{className:x.nav,style:N.nav,children:[!r.hidePrevious&&e.jsx(ji,{name:"previous-month","aria-label":O,className:P,style:N.nav_button_previous,disabled:!r.previousMonth,onClick:r.onPreviousClick,children:c==="rtl"?e.jsx(B,{className:x.nav_icon,style:N.nav_icon}):e.jsx(le,{className:x.nav_icon,style:N.nav_icon})}),!r.hideNext&&e.jsx(ji,{name:"next-month","aria-label":p,className:z,style:N.nav_button_next,disabled:!r.nextMonth,onClick:r.onNextClick,children:c==="rtl"?e.jsx(le,{className:x.nav_icon,style:N.nav_icon}):e.jsx(B,{className:x.nav_icon,style:N.nav_icon})})]})}function Ku(r){var t=ze().numberOfMonths,n=sn(),o=n.previousMonth,c=n.nextMonth,h=n.goToMonth,x=n.displayMonths,N=x.findIndex(function(p){return Fl(r.displayMonth,p)}),D=N===0,S=N===x.length-1,j=t>1&&(D||!S),T=t>1&&(S||!D),O=function(){o&&h(o)},P=function(){c&&h(c)};return e.jsx(Hy,{displayMonth:r.displayMonth,hideNext:j,hidePrevious:T,nextMonth:c,previousMonth:o,onPreviousClick:O,onNextClick:P})}function Qy(r){var t,n=ze(),o=n.classNames,c=n.disableNavigation,h=n.styles,x=n.captionLayout,N=n.components,D=(t=N==null?void 0:N.CaptionLabel)!==null&&t!==void 0?t:Tm,S;return c?S=e.jsx(D,{id:r.id,displayMonth:r.displayMonth}):x==="dropdown"?S=e.jsx(Yu,{displayMonth:r.displayMonth,id:r.id}):x==="dropdown-buttons"?S=e.jsxs(e.Fragment,{children:[e.jsx(Yu,{displayMonth:r.displayMonth,displayIndex:r.displayIndex,id:r.id}),e.jsx(Ku,{displayMonth:r.displayMonth,displayIndex:r.displayIndex,id:r.id})]}):S=e.jsxs(e.Fragment,{children:[e.jsx(D,{id:r.id,displayMonth:r.displayMonth,displayIndex:r.displayIndex}),e.jsx(Ku,{displayMonth:r.displayMonth,id:r.id})]}),e.jsx("div",{className:o.caption,style:h.caption,children:S})}function Gy(r){var t=ze(),n=t.footer,o=t.styles,c=t.classNames.tfoot;return n?e.jsx("tfoot",{className:c,style:o.tfoot,children:e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:n})})}):e.jsx(e.Fragment,{})}function Xy(r,t,n){for(var o=n?ys(new Date):ja(new Date,{locale:r,weekStartsOn:t}),c=[],h=0;h<7;h++){var x=Lt(o,h);c.push(x)}return c}function Zy(){var r=ze(),t=r.classNames,n=r.styles,o=r.showWeekNumber,c=r.locale,h=r.weekStartsOn,x=r.ISOWeek,N=r.formatters.formatWeekdayName,D=r.labels.labelWeekday,S=Xy(c,h,x);return e.jsxs("tr",{style:n.head_row,className:t.head_row,children:[o&&e.jsx("td",{style:n.head_cell,className:t.head_cell}),S.map(function(j,T){return e.jsx("th",{scope:"col",className:t.head_cell,style:n.head_cell,"aria-label":D(j,{locale:c}),children:N(j,{locale:c})},T)})]})}function eb(){var r,t=ze(),n=t.classNames,o=t.styles,c=t.components,h=(r=c==null?void 0:c.HeadRow)!==null&&r!==void 0?r:Zy;return e.jsx("thead",{style:o.head,className:n.head,children:e.jsx(h,{})})}function tb(r){var t=ze(),n=t.locale,o=t.formatters.formatDay;return e.jsx(e.Fragment,{children:o(r.date,{locale:n})})}var Bl=u.createContext(void 0);function ab(r){if(!tn(r.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return e.jsx(Bl.Provider,{value:t,children:r.children})}return e.jsx(sb,{initialProps:r.initialProps,children:r.children})}function sb(r){var t=r.initialProps,n=r.children,o=t.selected,c=t.min,h=t.max,x=function(S,j,T){var O,P;(O=t.onDayClick)===null||O===void 0||O.call(t,S,j,T);var p=!!(j.selected&&c&&(o==null?void 0:o.length)===c);if(!p){var z=!!(!j.selected&&h&&(o==null?void 0:o.length)===h);if(!z){var B=o?_m([],o):[];if(j.selected){var le=B.findIndex(function(re){return qt(S,re)});B.splice(le,1)}else B.push(S);(P=t.onSelect)===null||P===void 0||P.call(t,B,S,j,T)}}},N={disabled:[]};o&&N.disabled.push(function(S){var j=h&&o.length>h-1,T=o.some(function(O){return qt(O,S)});return!!(j&&!T)});var D={selected:o,onDayClick:x,modifiers:N};return e.jsx(Bl.Provider,{value:D,children:n})}function $l(){var r=u.useContext(Bl);if(!r)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return r}function rb(r,t){var n=t||{},o=n.from,c=n.to;return o&&c?qt(c,r)&&qt(o,r)?void 0:qt(c,r)?{from:c,to:void 0}:qt(o,r)?void 0:_l(o,r)?{from:r,to:c}:{from:o,to:r}:c?_l(r,c)?{from:c,to:r}:{from:r,to:c}:o?Im(r,o)?{from:r,to:o}:{from:o,to:r}:{from:r,to:void 0}}var Ul=u.createContext(void 0);function nb(r){if(!an(r.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return e.jsx(Ul.Provider,{value:t,children:r.children})}return e.jsx(ib,{initialProps:r.initialProps,children:r.children})}function ib(r){var t=r.initialProps,n=r.children,o=t.selected,c=o||{},h=c.from,x=c.to,N=t.min,D=t.max,S=function(P,p,z){var B,le;(B=t.onDayClick)===null||B===void 0||B.call(t,P,p,z);var re=rb(P,o);(le=t.onSelect)===null||le===void 0||le.call(t,re,P,p,z)},j={range_start:[],range_end:[],range_middle:[],disabled:[]};if(h?(j.range_start=[h],x?(j.range_end=[x],qt(h,x)||(j.range_middle=[{after:h,before:x}])):j.range_end=[h]):x&&(j.range_start=[x],j.range_end=[x]),N&&(h&&!x&&j.disabled.push({after:vl(h,N-1),before:Lt(h,N-1)}),h&&x&&j.disabled.push({after:h,before:Lt(h,N-1)}),!h&&x&&j.disabled.push({after:vl(x,N-1),before:Lt(x,N-1)})),D){if(h&&!x&&(j.disabled.push({before:Lt(h,-D+1)}),j.disabled.push({after:Lt(h,D-1)})),h&&x){var T=Na(x,h)+1,O=D-T;j.disabled.push({before:vl(h,O)}),j.disabled.push({after:Lt(x,O)})}!h&&x&&(j.disabled.push({before:Lt(x,-D+1)}),j.disabled.push({after:Lt(x,D-1)}))}return e.jsx(Ul.Provider,{value:{selected:o,onDayClick:S,modifiers:j},children:n})}function Vl(){var r=u.useContext(Ul);if(!r)throw new Error("useSelectRange must be used within a SelectRangeProvider");return r}function bi(r){return Array.isArray(r)?_m([],r):r!==void 0?[r]:[]}function ob(r){var t={};return Object.entries(r).forEach(function(n){var o=n[0],c=n[1];t[o]=bi(c)}),t}var fa;(function(r){r.Outside="outside",r.Disabled="disabled",r.Selected="selected",r.Hidden="hidden",r.Today="today",r.RangeStart="range_start",r.RangeEnd="range_end",r.RangeMiddle="range_middle"})(fa||(fa={}));var lb=fa.Selected,Ea=fa.Disabled,cb=fa.Hidden,db=fa.Today,Nl=fa.RangeEnd,jl=fa.RangeMiddle,Sl=fa.RangeStart,ub=fa.Outside;function mb(r,t,n){var o,c=(o={},o[lb]=bi(r.selected),o[Ea]=bi(r.disabled),o[cb]=bi(r.hidden),o[db]=[r.today],o[Nl]=[],o[jl]=[],o[Sl]=[],o[ub]=[],o);return r.fromDate&&c[Ea].push({before:r.fromDate}),r.toDate&&c[Ea].push({after:r.toDate}),tn(r)?c[Ea]=c[Ea].concat(t.modifiers[Ea]):an(r)&&(c[Ea]=c[Ea].concat(n.modifiers[Ea]),c[Sl]=n.modifiers[Sl],c[jl]=n.modifiers[jl],c[Nl]=n.modifiers[Nl]),c}var Om=u.createContext(void 0);function hb(r){var t=ze(),n=$l(),o=Vl(),c=mb(t,n,o),h=ob(t.modifiers),x=me(me({},c),h);return e.jsx(Om.Provider,{value:x,children:r.children})}function Mm(){var r=u.useContext(Om);if(!r)throw new Error("useModifiers must be used within a ModifiersProvider");return r}function fb(r){return!!(r&&typeof r=="object"&&"before"in r&&"after"in r)}function gb(r){return!!(r&&typeof r=="object"&&"from"in r)}function pb(r){return!!(r&&typeof r=="object"&&"after"in r)}function xb(r){return!!(r&&typeof r=="object"&&"before"in r)}function yb(r){return!!(r&&typeof r=="object"&&"dayOfWeek"in r)}function bb(r,t){var n,o=t.from,c=t.to;if(o&&c){var h=Na(c,o)<0;h&&(n=[c,o],o=n[0],c=n[1]);var x=Na(r,o)>=0&&Na(c,r)>=0;return x}return c?qt(c,r):o?qt(o,r):!1}function vb(r){return Rl(r)}function wb(r){return Array.isArray(r)&&r.every(Rl)}function Nb(r,t){return t.some(function(n){if(typeof n=="boolean")return n;if(vb(n))return qt(r,n);if(wb(n))return n.includes(r);if(gb(n))return bb(r,n);if(yb(n))return n.dayOfWeek.includes(r.getDay());if(fb(n)){var o=Na(n.before,r),c=Na(n.after,r),h=o>0,x=c<0,N=_l(n.before,n.after);return N?x&&h:h||x}return pb(n)?Na(r,n.after)>0:xb(n)?Na(n.before,r)>0:typeof n=="function"?n(r):!1})}function ql(r,t,n){var o=Object.keys(t).reduce(function(h,x){var N=t[x];return Nb(r,N)&&h.push(x),h},[]),c={};return o.forEach(function(h){return c[h]=!0}),n&&!Fl(r,n)&&(c.outside=!0),c}function jb(r,t){for(var n=zt(r[0]),o=Wl(r[r.length-1]),c,h,x=n;x<=o;){var N=ql(x,t),D=!N.disabled&&!N.hidden;if(!D){x=Lt(x,1);continue}if(N.selected)return x;N.today&&!h&&(h=x),c||(c=x),x=Lt(x,1)}return h||c}var Sb=365;function Rm(r,t){var n=t.moveBy,o=t.direction,c=t.context,h=t.modifiers,x=t.retry,N=x===void 0?{count:0,lastFocused:r}:x,D=c.weekStartsOn,S=c.fromDate,j=c.toDate,T=c.locale,O={day:Lt,week:Il,month:ha,year:Lp,startOfWeek:function(B){return c.ISOWeek?ys(B):ja(B,{locale:T,weekStartsOn:D})},endOfWeek:function(B){return c.ISOWeek?wm(B):Ll(B,{locale:T,weekStartsOn:D})}},P=O[n](r,o==="after"?1:-1);o==="before"&&S?P=Fp([S,P]):o==="after"&&j&&(P=Bp([j,P]));var p=!0;if(h){var z=ql(P,h);p=!z.disabled&&!z.hidden}return p?P:N.count>Sb?N.lastFocused:Rm(P,{moveBy:n,direction:o,context:c,modifiers:h,retry:me(me({},N),{count:N.count+1})})}var Wm=u.createContext(void 0);function Db(r){var t=sn(),n=Mm(),o=u.useState(),c=o[0],h=o[1],x=u.useState(),N=x[0],D=x[1],S=jb(t.displayMonths,n),j=c??(N&&t.isDateDisplayed(N))?N:S,T=function(){D(c),h(void 0)},O=function(B){h(B)},P=ze(),p=function(B,le){if(c){var re=Rm(c,{moveBy:B,direction:le,context:P,modifiers:n});qt(c,re)||(t.goToDate(re,c),O(re))}},z={focusedDay:c,focusTarget:j,blur:T,focus:O,focusDayAfter:function(){return p("day","after")},focusDayBefore:function(){return p("day","before")},focusWeekAfter:function(){return p("week","after")},focusWeekBefore:function(){return p("week","before")},focusMonthBefore:function(){return p("month","before")},focusMonthAfter:function(){return p("month","after")},focusYearBefore:function(){return p("year","before")},focusYearAfter:function(){return p("year","after")},focusStartOfWeek:function(){return p("startOfWeek","before")},focusEndOfWeek:function(){return p("endOfWeek","after")}};return e.jsx(Wm.Provider,{value:z,children:r.children})}function zl(){var r=u.useContext(Wm);if(!r)throw new Error("useFocusContext must be used within a FocusProvider");return r}function kb(r,t){var n=Mm(),o=ql(r,n,t);return o}var Yl=u.createContext(void 0);function Cb(r){if(!ki(r.initialProps)){var t={selected:void 0};return e.jsx(Yl.Provider,{value:t,children:r.children})}return e.jsx(Ib,{initialProps:r.initialProps,children:r.children})}function Ib(r){var t=r.initialProps,n=r.children,o=function(h,x,N){var D,S,j;if((D=t.onDayClick)===null||D===void 0||D.call(t,h,x,N),x.selected&&!t.required){(S=t.onSelect)===null||S===void 0||S.call(t,void 0,h,x,N);return}(j=t.onSelect)===null||j===void 0||j.call(t,h,h,x,N)},c={selected:t.selected,onDayClick:o};return e.jsx(Yl.Provider,{value:c,children:n})}function Lm(){var r=u.useContext(Yl);if(!r)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return r}function _b(r,t){var n=ze(),o=Lm(),c=$l(),h=Vl(),x=zl(),N=x.focusDayAfter,D=x.focusDayBefore,S=x.focusWeekAfter,j=x.focusWeekBefore,T=x.blur,O=x.focus,P=x.focusMonthBefore,p=x.focusMonthAfter,z=x.focusYearBefore,B=x.focusYearAfter,le=x.focusStartOfWeek,re=x.focusEndOfWeek,U=function(Q){var G,ft,gt,Ve;ki(n)?(G=o.onDayClick)===null||G===void 0||G.call(o,r,t,Q):tn(n)?(ft=c.onDayClick)===null||ft===void 0||ft.call(c,r,t,Q):an(n)?(gt=h.onDayClick)===null||gt===void 0||gt.call(h,r,t,Q):(Ve=n.onDayClick)===null||Ve===void 0||Ve.call(n,r,t,Q)},te=function(Q){var G;O(r),(G=n.onDayFocus)===null||G===void 0||G.call(n,r,t,Q)},ve=function(Q){var G;T(),(G=n.onDayBlur)===null||G===void 0||G.call(n,r,t,Q)},we=function(Q){var G;(G=n.onDayMouseEnter)===null||G===void 0||G.call(n,r,t,Q)},Z=function(Q){var G;(G=n.onDayMouseLeave)===null||G===void 0||G.call(n,r,t,Q)},V=function(Q){var G;(G=n.onDayPointerEnter)===null||G===void 0||G.call(n,r,t,Q)},Se=function(Q){var G;(G=n.onDayPointerLeave)===null||G===void 0||G.call(n,r,t,Q)},Re=function(Q){var G;(G=n.onDayTouchCancel)===null||G===void 0||G.call(n,r,t,Q)},Fe=function(Q){var G;(G=n.onDayTouchEnd)===null||G===void 0||G.call(n,r,t,Q)},Ge=function(Q){var G;(G=n.onDayTouchMove)===null||G===void 0||G.call(n,r,t,Q)},yt=function(Q){var G;(G=n.onDayTouchStart)===null||G===void 0||G.call(n,r,t,Q)},Zt=function(Q){var G;(G=n.onDayKeyUp)===null||G===void 0||G.call(n,r,t,Q)},We=function(Q){var G;switch(Q.key){case"ArrowLeft":Q.preventDefault(),Q.stopPropagation(),n.dir==="rtl"?N():D();break;case"ArrowRight":Q.preventDefault(),Q.stopPropagation(),n.dir==="rtl"?D():N();break;case"ArrowDown":Q.preventDefault(),Q.stopPropagation(),S();break;case"ArrowUp":Q.preventDefault(),Q.stopPropagation(),j();break;case"PageUp":Q.preventDefault(),Q.stopPropagation(),Q.shiftKey?z():P();break;case"PageDown":Q.preventDefault(),Q.stopPropagation(),Q.shiftKey?B():p();break;case"Home":Q.preventDefault(),Q.stopPropagation(),le();break;case"End":Q.preventDefault(),Q.stopPropagation(),re();break}(G=n.onDayKeyDown)===null||G===void 0||G.call(n,r,t,Q)},Ye={onClick:U,onFocus:te,onBlur:ve,onKeyDown:We,onKeyUp:Zt,onMouseEnter:we,onMouseLeave:Z,onPointerEnter:V,onPointerLeave:Se,onTouchCancel:Re,onTouchEnd:Fe,onTouchMove:Ge,onTouchStart:yt};return Ye}function Ab(){var r=ze(),t=Lm(),n=$l(),o=Vl(),c=ki(r)?t.selected:tn(r)?n.selected:an(r)?o.selected:void 0;return c}function Tb(r){return Object.values(fa).includes(r)}function Pb(r,t){var n=[r.classNames.day];return Object.keys(t).forEach(function(o){var c=r.modifiersClassNames[o];if(c)n.push(c);else if(Tb(o)){var h=r.classNames["day_".concat(o)];h&&n.push(h)}}),n}function Eb(r,t){var n=me({},r.styles.day);return Object.keys(t).forEach(function(o){var c;n=me(me({},n),(c=r.modifiersStyles)===null||c===void 0?void 0:c[o])}),n}function Ob(r,t,n){var o,c,h,x=ze(),N=zl(),D=kb(r,t),S=_b(r,D),j=Ab(),T=!!(x.onDayClick||x.mode!=="default");u.useEffect(function(){var we;D.outside||N.focusedDay&&T&&qt(N.focusedDay,r)&&((we=n.current)===null||we===void 0||we.focus())},[N.focusedDay,r,n,T,D.outside]);var O=Pb(x,D).join(" "),P=Eb(x,D),p=!!(D.outside&&!x.showOutsideDays||D.hidden),z=(h=(c=x.components)===null||c===void 0?void 0:c.DayContent)!==null&&h!==void 0?h:tb,B=e.jsx(z,{date:r,displayMonth:t,activeModifiers:D}),le={style:P,className:O,children:B,role:"gridcell"},re=N.focusTarget&&qt(N.focusTarget,r)&&!D.outside,U=N.focusedDay&&qt(N.focusedDay,r),te=me(me(me({},le),(o={disabled:D.disabled,role:"gridcell"},o["aria-selected"]=D.selected,o.tabIndex=U||re?0:-1,o)),S),ve={isButton:T,isHidden:p,activeModifiers:D,selectedDays:j,buttonProps:te,divProps:le};return ve}function Mb(r){var t=u.useRef(null),n=Ob(r.date,r.displayMonth,t);return n.isHidden?e.jsx("div",{role:"gridcell"}):n.isButton?e.jsx(ji,me({name:"day",ref:t},n.buttonProps)):e.jsx("div",me({},n.divProps))}function Rb(r){var t=r.number,n=r.dates,o=ze(),c=o.onWeekNumberClick,h=o.styles,x=o.classNames,N=o.locale,D=o.labels.labelWeekNumber,S=o.formatters.formatWeekNumber,j=S(Number(t),{locale:N});if(!c)return e.jsx("span",{className:x.weeknumber,style:h.weeknumber,children:j});var T=D(Number(t),{locale:N}),O=function(P){c(t,n,P)};return e.jsx(ji,{name:"week-number","aria-label":T,className:x.weeknumber,style:h.weeknumber,onClick:O,children:j})}function Wb(r){var t,n,o=ze(),c=o.styles,h=o.classNames,x=o.showWeekNumber,N=o.components,D=(t=N==null?void 0:N.Day)!==null&&t!==void 0?t:Mb,S=(n=N==null?void 0:N.WeekNumber)!==null&&n!==void 0?n:Rb,j;return x&&(j=e.jsx("td",{className:h.cell,style:c.cell,children:e.jsx(S,{number:r.weekNumber,dates:r.dates})})),e.jsxs("tr",{className:h.row,style:c.row,children:[j,r.dates.map(function(T){return e.jsx("td",{className:h.cell,style:c.cell,role:"presentation",children:e.jsx(D,{displayMonth:r.displayMonth,date:T})},Lx(T))})]})}function Ju(r,t,n){for(var o=n!=null&&n.ISOWeek?wm(t):Ll(t,n),c=n!=null&&n.ISOWeek?ys(r):ja(r,n),h=Na(o,c),x=[],N=0;N<=h;N++)x.push(Lt(c,N));var D=x.reduce(function(S,j){var T=n!=null&&n.ISOWeek?Sm(j):km(j,n),O=S.find(function(P){return P.weekNumber===T});return O?(O.dates.push(j),S):(S.push({weekNumber:T,dates:[j]}),S)},[]);return D}function Lb(r,t){var n=Ju(zt(r),Wl(r),t);if(t!=null&&t.useFixedWeeks){var o=Bx(r,t);if(o<6){var c=n[n.length-1],h=c.dates[c.dates.length-1],x=Il(h,6-o),N=Ju(Il(h,1),x,t);n.push.apply(n,N)}}return n}function Fb(r){var t,n,o,c=ze(),h=c.locale,x=c.classNames,N=c.styles,D=c.hideHead,S=c.fixedWeeks,j=c.components,T=c.weekStartsOn,O=c.firstWeekContainsDate,P=c.ISOWeek,p=Lb(r.displayMonth,{useFixedWeeks:!!S,ISOWeek:P,locale:h,weekStartsOn:T,firstWeekContainsDate:O}),z=(t=j==null?void 0:j.Head)!==null&&t!==void 0?t:eb,B=(n=j==null?void 0:j.Row)!==null&&n!==void 0?n:Wb,le=(o=j==null?void 0:j.Footer)!==null&&o!==void 0?o:Gy;return e.jsxs("table",{id:r.id,className:x.table,style:N.table,role:"grid","aria-labelledby":r["aria-labelledby"],children:[!D&&e.jsx(z,{}),e.jsx("tbody",{className:x.tbody,style:N.tbody,children:p.map(function(re){return e.jsx(B,{displayMonth:r.displayMonth,dates:re.dates,weekNumber:re.weekNumber},re.weekNumber)})}),e.jsx(le,{displayMonth:r.displayMonth})]})}function Bb(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var $b=Bb()?u.useLayoutEffect:u.useEffect,Dl=!1,Ub=0;function Hu(){return"react-day-picker-".concat(++Ub)}function Vb(r){var t,n=r??(Dl?Hu():null),o=u.useState(n),c=o[0],h=o[1];return $b(function(){c===null&&h(Hu())},[]),u.useEffect(function(){Dl===!1&&(Dl=!0)},[]),(t=r??c)!==null&&t!==void 0?t:void 0}function qb(r){var t,n,o=ze(),c=o.dir,h=o.classNames,x=o.styles,N=o.components,D=sn().displayMonths,S=Vb(o.id?"".concat(o.id,"-").concat(r.displayIndex):void 0),j=o.id?"".concat(o.id,"-grid-").concat(r.displayIndex):void 0,T=[h.month],O=x.month,P=r.displayIndex===0,p=r.displayIndex===D.length-1,z=!P&&!p;c==="rtl"&&(t=[P,p],p=t[0],P=t[1]),P&&(T.push(h.caption_start),O=me(me({},O),x.caption_start)),p&&(T.push(h.caption_end),O=me(me({},O),x.caption_end)),z&&(T.push(h.caption_between),O=me(me({},O),x.caption_between));var B=(n=N==null?void 0:N.Caption)!==null&&n!==void 0?n:Qy;return e.jsxs("div",{className:T.join(" "),style:O,children:[e.jsx(B,{id:S,displayMonth:r.displayMonth,displayIndex:r.displayIndex}),e.jsx(Fb,{id:j,"aria-labelledby":S,displayMonth:r.displayMonth})]},r.displayIndex)}function zb(r){var t=ze(),n=t.classNames,o=t.styles;return e.jsx("div",{className:n.months,style:o.months,children:r.children})}function Yb(r){var t,n,o=r.initialProps,c=ze(),h=zl(),x=sn(),N=u.useState(!1),D=N[0],S=N[1];u.useEffect(function(){c.initialFocus&&h.focusTarget&&(D||(h.focus(h.focusTarget),S(!0)))},[c.initialFocus,D,h.focus,h.focusTarget,h]);var j=[c.classNames.root,c.className];c.numberOfMonths>1&&j.push(c.classNames.multiple_months),c.showWeekNumber&&j.push(c.classNames.with_weeknumber);var T=me(me({},c.styles.root),c.style),O=Object.keys(o).filter(function(p){return p.startsWith("data-")}).reduce(function(p,z){var B;return me(me({},p),(B={},B[z]=o[z],B))},{}),P=(n=(t=o.components)===null||t===void 0?void 0:t.Months)!==null&&n!==void 0?n:zb;return e.jsx("div",me({className:j.join(" "),style:T,dir:c.dir,id:c.id,nonce:o.nonce,title:o.title,lang:o.lang},O,{children:e.jsx(P,{children:x.displayMonths.map(function(p,z){return e.jsx(qb,{displayIndex:z,displayMonth:p},z)})})}))}function Kb(r){var t=r.children,n=xy(r,["children"]);return e.jsx(Ry,{initialProps:n,children:e.jsx(Yy,{children:e.jsx(Cb,{initialProps:n,children:e.jsx(ab,{initialProps:n,children:e.jsx(nb,{initialProps:n,children:e.jsx(hb,{children:e.jsx(Db,{children:t})})})})})})})}function Jb(r){return e.jsx(Kb,me({},r,{children:e.jsx(Yb,{initialProps:r})}))}function Al({className:r,classNames:t,showOutsideDays:n=!0,...o}){return e.jsx(Jb,{showOutsideDays:n,className:Za("p-3",r),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:Za(pu({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:Za(pu({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...c})=>e.jsx(up,{className:"h-4 w-4"}),IconRight:({...c})=>e.jsx(Yg,{className:"h-4 w-4"})},...o})}Al.displayName="Calendar";const Qu={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_VERSION:"0.0.0",VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"false",VITE_FIREBASE_API_KEY:["AI","za","SyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s"].join(""),VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_AUTH_EMULATOR_URL:"http://localhost:9099",VITE_FIREBASE_FIRESTORE_EMULATOR_HOST:"localhost:8080",VITE_FIREBASE_FUNCTIONS_EMULATOR_HOST:"localhost:5001",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.appspot.com",VITE_FORCE_HASH_ROUTER:"true",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"محل كاشي لينك التجريبي",VITE_SHOW_ENV_BANNER:"true",VITE_USE_EMULATORS:"false",VITE_USE_FIREBASE_EMULATOR:"false"},Ka=r=>typeof r=="string"&&r.trim().length>0,Hb={getCurrentMonthId(){const r=new Date;return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`},async getWalletUsage(r){var t;try{if(!Ka(r))return console.error("Error getting wallet usage: invalid walletId",r),null;const n=Ae($,"walletLimits",r),o=await ua(n);if(o.exists()){const h=o.data();return{walletId:r,used_transfer:h.monthlyTransferUsed??h.used_transfer??0,used_withdraw:h.monthlyWithdrawUsed??h.used_withdraw??0,monthly_limit:h.monthlyLimit??h.monthlyTransferLimit??h.monthlyWithdrawLimit??2e5,last_reset:h.lastMonthlyReset??h.last_reset??null,updatedAt:h.updatedAt||hs.now()}}const c={walletId:r,used_transfer:0,used_withdraw:0,monthly_limit:2e5,last_reset:null,updatedAt:hs.now()};return await Gt(n,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,monthlyTransferLimit:2e5,monthlyWithdrawLimit:2e5,lastMonthlyReset:null,updatedAt:ht(),ownerId:(t=Ys.currentUser)==null?void 0:t.uid}),c}catch(n){return console.error("Error getting wallet usage:",n),{walletId:r,used_transfer:0,used_withdraw:0,monthly_limit:2e5,last_reset:null,updatedAt:hs.now()}}},shouldResetLimits(r){const t=new Date,n=t.getDate();if(!r)return n===1;if(n===1){const o=r.toDate(),c=t.getMonth(),h=t.getFullYear();return o.getMonth()!==c||o.getFullYear()!==h}return!1},async autoResetLimitsIfNeeded(r){try{if(!Ka(r))return console.error("خطأ في التصفير التلقائي للحدود: walletId غير صالح",r),!1;typeof import.meta<"u";const t=await this.getWalletUsage(r);return t&&this.shouldResetLimits(t.last_reset)?(console.log(`🔄 تصفير تلقائي للحدود للمحفظة ${r} - اليوم الأول من الشهر`),await this.resetWalletUsage(r)):!1}catch(t){return console.error("خطأ في التصفير التلقائي للحدود:",t),!1}},async resetWalletUsage(r){try{if(!Ka(r))return console.error("خطأ في تصفير استخدام المحفظة: walletId غير صالح",r),!1;const t=Ae($,"walletLimits",r);return await Gt(t,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:ht(),updatedAt:ht()},{merge:!0}),console.log(`🔄 تم تصفير استخدام المحفظة ${r} بنجاح`),!0}catch(t){return console.error("خطأ في تصفير استخدام المحفظة:",t),!1}},async calculateUsageFromTransactions(r){var t,n;try{if(!Ka(r))return console.error("خطأ في حساب الاستخدام من المعاملات: walletId غير صالح",r),{used_transfer:0,used_withdraw:0};const o=Ae($,"walletLimits",r),c=new Date;let h=hs.fromDate(new Date(c.getFullYear(),c.getMonth(),1));try{const j=await ua(o);h=j.exists()?((t=j.data())==null?void 0:t.lastMonthlyReset)??((n=j.data())==null?void 0:n.last_reset)??h:h}catch{}const x=Te(de($,"tx"),K("uid","==",r),...h?[K("createdAt",">=",h)]:[]),N=await De(x);let D=0,S=0;return N.forEach(j=>{const T=j.data();T.status==="completed"&&(T.type==="transfer"?D+=T.amount:T.type==="withdraw"&&(S+=T.amount))}),{used_transfer:D,used_withdraw:S}}catch(o){return console.error("خطأ في حساب الاستخدام من المعاملات:",o),{used_transfer:0,used_withdraw:0}}},async getWalletUsageWithRefresh(r){var t,n;try{if(!Ka(r))return console.error("خطأ في الحصول على الاستخدام مع التحديث: walletId غير صالح",r),null;typeof import.meta<"u";const o=await this.getWalletUsage(r);if(!o){const h=await this.calculateUsageFromTransactions(r),x=Ae($,"walletLimits",r);try{await Gt(x,{monthlyTransferUsed:h.used_transfer,monthlyWithdrawUsed:h.used_withdraw,updatedAt:ht(),ownerId:(t=Ys.currentUser)==null?void 0:t.uid},{merge:!0})}catch{}return{walletId:r,used_transfer:h.used_transfer,used_withdraw:h.used_withdraw,monthly_limit:2e5,last_reset:null,updatedAt:hs.now()}}const c=await this.calculateUsageFromTransactions(r);if(o.used_transfer!==c.used_transfer||o.used_withdraw!==c.used_withdraw){const h=Ae($,"walletLimits",r);try{await Gt(h,{monthlyTransferUsed:c.used_transfer,monthlyWithdrawUsed:c.used_withdraw,updatedAt:ht(),ownerId:(n=Ys.currentUser)==null?void 0:n.uid},{merge:!0})}catch{}return await this.getWalletUsage(r)}return o}catch(o){return console.error("خطأ في الحصول على الاستخدام مع التحديث:",o),{walletId:r,used_transfer:0,used_withdraw:0,monthly_limit:2e5,last_reset:null,updatedAt:hs.now()}}},calculateRemaining(r){return{remainingTransfer:Math.max(0,r.monthly_limit-r.used_transfer),remainingWithdraw:Math.max(0,r.monthly_limit-r.used_withdraw)}},async canPerformOperation(r,t,n){try{if(!Ka(r))return console.error("Error checking operation limits: invalid walletId",r),{canPerform:!1,message:"walletId غير صالح"};const o=await this.getWalletUsageWithRefresh(r);if(!o)return{canPerform:!1,message:"لا يمكن العثور على بيانات الاستخدام للمحفظة"};const c=this.calculateRemaining(o);return n==="transfer"&&t>c.remainingTransfer?{canPerform:!1,message:`تجاوز حد التحويل المسموح. المتبقي: ${c.remainingTransfer.toLocaleString()} ج.م من أصل ${o.monthly_limit.toLocaleString()} ج.م`,remaining:c.remainingTransfer}:n==="withdraw"&&t>c.remainingWithdraw?{canPerform:!1,message:`تجاوز حد السحب المسموح. المتبقي: ${c.remainingWithdraw.toLocaleString()} ج.م من أصل ${o.monthly_limit.toLocaleString()} ج.م`,remaining:c.remainingWithdraw}:{canPerform:!0}}catch(o){return console.error("Error checking operation limits:",o),{canPerform:!1,message:"خطأ في التحقق من الحدود"}}},async updateUsage(r,t,n){var o;try{if(!Ka(r))throw new Error("walletId غير صالح");const c=await this.getWalletUsageWithRefresh(r);if(!c)throw new Error("لا يمكن العثور على بيانات الاستخدام للمحفظة");const h=await this.canPerformOperation(r,t,n);if(!h.canPerform)throw new Error(h.message||"لا يمكن إجراء العملية");const x=n==="transfer"?c.used_transfer+t:c.used_transfer,N=n==="withdraw"?c.used_withdraw+t:c.used_withdraw,D=Ae($,"walletLimits",c.walletId);try{await Gt(D,{monthlyTransferUsed:x,monthlyWithdrawUsed:N,updatedAt:ht(),ownerId:(o=Ys.currentUser)==null?void 0:o.uid},{merge:!0})}catch{}let S=await this.getWalletUsageWithRefresh(r);return S||(S={walletId:r,used_transfer:x,used_withdraw:N,monthly_limit:c.monthly_limit,last_reset:c.last_reset,updatedAt:hs.now()}),S}catch(c){throw console.error("Error updating wallet usage:",c),c}},async resetWalletUsageManually(r){try{if(!Ka(r))throw new Error("walletId غير صالح");const t=Ae($,"walletLimits",r),n={walletId:r,used_transfer:0,used_withdraw:0,monthly_limit:0,last_reset:null,updatedAt:new Date};return Gt(t,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:ht(),updatedAt:ht()},{merge:!0}).catch(o=>{console.error("خطأ في حفظ تصفير الاستخدام في Firebase:",o)}),console.log(`✅ تم تصفير استخدام المحفظة ${r} بنجاح`),n}catch(t){throw console.error("Error resetting wallet usage:",t),t}},async getAllWalletsUsage(r){try{const n=(await pi.getByMerchantId(r)).map(c=>this.getWalletUsageWithRefresh(c.id));return(await Promise.all(n)).filter(c=>c!==null)}catch(t){return console.error("Error getting all wallets usage:",t),[]}}};function Qb(r){return r?`readBroadcastIds_${r}`:"readBroadcastIds_guest"}function Gb({className:r}){const{user:t,profile:n,isSubscriptionActive:o}=El(),c=am(),[h,x]=u.useState([]),[N,D]=u.useState(new Set),[S,j]=u.useState(!1),[T,O]=u.useState(""),[P,p]=u.useState(!1),[z,B]=u.useState(null),[le,re]=u.useState("none"),[U,te]=u.useState(null),[ve,we]=u.useState(!1),Z=u.useRef(new Set);u.useRef(!1);const V=u.useRef(!0),Se=u.useRef(null),Re=u.useRef(null),Fe=u.useRef(null),[Ge,yt]=u.useState({position:"fixed",top:0,left:0,zIndex:1e4}),Zt=u.useMemo(()=>{const X=["global"];return t!=null&&t.uid&&X.push(`user:${t.uid}`),n!=null&&n.shopId&&X.push(`shop:${n.shopId}`),X},[t==null?void 0:t.uid,n==null?void 0:n.shopId]),We=Qb(t==null?void 0:t.uid),Ye=u.useMemo(()=>{var se;const X=(se=c==null?void 0:c.pathname)==null?void 0:se.includes("/user/pending-approval");return!!(t!=null&&t.uid)&&!X},[t==null?void 0:t.uid,c==null?void 0:c.pathname]);u.useEffect(()=>{try{const X=localStorage.getItem(We);if(X){const M=JSON.parse(X);Array.isArray(M)&&D(new Set(M.filter(Boolean)))}else D(new Set)}catch(X){console.warn("Failed to load read ids",X),D(new Set)}},[We]),u.useEffect(()=>{if(!Ye){x([]);return}V.current=!0;const X=()=>{ap(Zt,se=>{if(V.current){const Be=Date.now(),Ke=60*1e3,Sa=se.filter(ct=>{var er,Da;const Ft=(er=ct.createdAt)!=null&&er.toMillis?ct.createdAt.toMillis():(Da=ct.createdAt)!=null&&Da.seconds?ct.createdAt.seconds*1e3:0;return!(Be-Ft<Ke)}).map(ct=>ct.id).filter(Boolean);Z.current=new Set(Sa),V.current=!1}x(se)})};X();const M=se=>{console.log("🔔 OneSignal Notification received",se);try{const Be=se.notification||se;if(Be&&(Be.title||Be.body)){const Ke={id:`temp_${Date.now()}`,title:Be.title||"إشعار جديد",message:Be.body||Be.message||"",audienceKey:"global",active:!0,createdAt:{toMillis:()=>Date.now(),seconds:Math.floor(Date.now()/1e3),nanoseconds:0}};te(Ke),we(!0),Se.current&&clearTimeout(Se.current),Se.current=window.setTimeout(()=>{we(!1),te(null)},5e3)}}catch(Be){console.error("Error parsing OneSignal event for instant alert",Be)}X()};try{const se=window.OneSignal;se&&se.Notifications&&se.Notifications.addEventListener&&se.Notifications.addEventListener("foregroundWillDisplay",M)}catch(se){console.error("Failed to add OneSignal listener",se)}return()=>{try{const se=window.OneSignal;se&&se.Notifications&&se.Notifications.removeEventListener&&se.Notifications.removeEventListener("foregroundWillDisplay",M)}catch{}}},[Zt,Ye]),u.useEffect(()=>{const X=new Set(h.map(se=>se.id).filter(Boolean)),M=h.filter(se=>se.id&&!Z.current.has(se.id));M.length>0&&(te(M[0]),we(!0),Se.current&&clearTimeout(Se.current),Se.current=window.setTimeout(()=>{we(!1),te(null)},5e3)),Z.current=X},[h]),u.useEffect(()=>()=>{Se.current&&clearTimeout(Se.current)},[]);const Q=h.reduce((X,M)=>X+(M.id&&!N.has(M.id)?1:0),0),G=X=>{if(!X||N.has(X))return;const M=new Set(N);M.add(X),D(M);try{localStorage.setItem(We,JSON.stringify(Array.from(M)))}catch{}},ft=()=>{const X=h.map(se=>se.id).filter(Boolean),M=new Set(N);X.forEach(se=>M.add(se)),D(M);try{localStorage.setItem(We,JSON.stringify(Array.from(M)))}catch{}},gt=(X,M)=>{var se;if(X)try{const Be=((se=wi)==null?void 0:se.isNativePlatform)&&wi.getPlatform()==="android",Ke=/\.apk(\?|$)/i.test(X);if(Be&&Ke){const Sa=`cashy://update?url=${encodeURIComponent(X)}`;window.location.href=Sa}else window.open(X,"_blank")}catch{try{window.open(X,"_blank")}catch{}}M&&G(M)},Ve=()=>{if(!Re.current||!Fe.current)return;const X=Re.current.getBoundingClientRect(),M=8,se=Fe.current.offsetWidth||320,Be=X.bottom+M;let Ke=X.right-se;const Sa=window.innerWidth;Ke=Math.min(Math.max(Ke,M),Sa-se-M),yt(ct=>({...ct,top:Be,left:Ke}))};return u.useEffect(()=>{if(!ve)return;Ve();const X=()=>Ve();return window.addEventListener("resize",X),window.addEventListener("scroll",X,!0),()=>{window.removeEventListener("resize",X),window.removeEventListener("scroll",X,!0)}},[ve]),u.useEffect(()=>{if(!(t!=null&&t.uid)){re("none");return}(async()=>{try{const M=Te(de($,"waiting_list"),K("userId","==",t.uid)),Be=(await De(M)).docs.map(ct=>({id:ct.id,...ct.data()})).sort((ct,Ft)=>{var Da,nn,on,Ra,Wa,La;const rn=((nn=(Da=ct==null?void 0:ct.createdAt)==null?void 0:Da.toMillis)==null?void 0:nn.call(Da))??((on=ct==null?void 0:ct.createdAt)==null?void 0:on.seconds)*1e3??0;return(((Wa=(Ra=Ft==null?void 0:Ft.createdAt)==null?void 0:Ra.toMillis)==null?void 0:Wa.call(Ra))??((La=Ft==null?void 0:Ft.createdAt)==null?void 0:La.seconds)*1e3??0)-rn});if(Be.length===0){re("none");return}const Ke=Be[0],Sa=(Ke==null?void 0:Ke.contacted)===!0||(Ke==null?void 0:Ke.status)==="contacted";re(Sa?"contacted":"pending")}catch(M){console.warn("⚠️ فشل جلب حالة waiting_list:",M),re("none")}})()},[t==null?void 0:t.uid]),Ye?e.jsxs("div",{className:`relative inline-flex items-center gap-2 ${r||""}`,ref:Re,children:[e.jsxs(Kg,{onOpenChange:X=>{X&&Q>0&&ft()},children:[e.jsx(Jg,{asChild:!0,children:e.jsx(I,{variant:"ghost",className:"relative h-8 w-8 rounded-full p-0 hover:bg-transparent focus:ring-1 focus:ring-primary focus:ring-offset-1 transition-all",title:"الإشعارات",children:e.jsxs("div",{className:"relative h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center border border-border shadow-sm hover:shadow-md",children:[e.jsx(xl,{className:"h-4 w-4 text-primary"}),Q>0&&e.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-red-500 text-white text-[10px] font-bold flex items-center justify-center shadow",children:Q})]})})}),e.jsxs(Hg,{className:"w-80",align:"end",forceMount:!0,children:[e.jsxs(Qg,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"الإشعارات"}),h.length>0&&e.jsxs(I,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:ft,children:[e.jsx(xi,{className:"h-3 w-3 mr-1"}),"تمييز الكل كمقروء"]})]}),e.jsx(Gg,{}),h.length===0?e.jsx("div",{className:"p-3 text-sm text-muted-foreground",children:"لا توجد إشعارات حالياً"}):e.jsx("div",{className:"max-h-64 overflow-y-auto pr-1",children:h.map(X=>{const M=X.id?!N.has(X.id):!1;return e.jsx("div",{className:`px-2 py-2 rounded-md ${M?"bg-primary/5":""}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xl,{className:`h-4 w-4 ${M?"text-primary":"text-muted-foreground"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:X.title||"إشعار"}),e.jsx("div",{className:"text-xs text-muted-foreground whitespace-pre-line",children:X.message}),X.linkUrl&&e.jsxs(I,{variant:"link",className:"px-0 h-6 text-xs",onClick:()=>gt(X.linkUrl,X.id),children:["فتح الرابط ",e.jsx(tp,{className:"h-3 w-3 ml-1"})]})]}),M?e.jsx(I,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>G(X.id),title:"تمييز كمقروء",children:e.jsx(xi,{className:"h-4 w-4 text-primary"})}):e.jsx(I,{variant:"ghost",size:"icon",className:"h-6 w-6",disabled:!0,title:"مقروء",children:e.jsx(xi,{className:"h-4 w-4 text-muted-foreground"})})]})},X.id)})})]})]}),U&&og.createPortal(e.jsx("div",{ref:Fe,style:Ge,className:`pointer-events-auto transition-all duration-300 ${ve?"opacity-100 translate-y-0":"opacity-0 -translate-y-3"}`,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-gray-200 p-4 w-80 max-w-[calc(100vw-16px)] flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(xl,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-semibold",children:U.title||"إشعار جديد"}),e.jsx("div",{className:"text-xs text-muted-foreground whitespace-pre-line",children:U.message}),U.linkUrl&&e.jsx(I,{variant:"link",className:"px-0 h-6 text-xs",onClick:()=>gt(U.linkUrl,U.id),children:"فتح الرابط"})]})]})}),document.body)]}):null}function Xb(r,t=300){const[n,o]=ae.useState(r);return ae.useEffect(()=>{const c=setTimeout(()=>o(r),t);return()=>clearTimeout(c)},[r,t]),n}const Zb=({userId:r,transactions:t})=>{const[n,o]=u.useState(!1),[c,h]=u.useState(!1),[x,N]=u.useState(!1),[D,S]=u.useState({monthlyWithdrawalProfit:0,monthlyTransferProfit:0,monthlySalesProfit:0,lastUpdated:new Date}),{userSubscription:j,user:T,profile:O}=El();u.useEffect(()=>{r&&n&&x&&p()},[r,n,x]),u.useEffect(()=>{if(!n||!x)return;const U=setInterval(()=>{const te=new Date;(D.lastUpdated.getMonth()!==te.getMonth()||D.lastUpdated.getFullYear()!==te.getFullYear())&&p()},3e4);return()=>clearInterval(U)},[n,x,D.lastUpdated]);const P=async()=>{try{if(!r)return 0;const U=new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Cairo"}),te=new Date,ve=U.format(te),[we,Z]=ve.split("-"),V=`${we}-${Z}-01`,Se=parseInt(we),Re=parseInt(Z),Fe=new Date(Se,Re,0).getDate(),Ge=`${we}-${Z}-${String(Fe).padStart(2,"0")}`;let yt;try{const We=Te(de($,"dailySales"),K("userId","==",r));yt=await De(We)}catch{const We=Te(de($,"users",r,"dailySales"));yt=await De(We)}let Zt=0;return yt.forEach(We=>{const Ye=We.data(),Q=String(Ye.date??"").slice(0,10);if(Q&&!Ye.isDeferred&&Q>=V&&Q<=Ge){const G=Number(Ye.sellingPrice??Ye.price??0),ft=Number(Ye.wholesalePrice??0),gt=Number(Ye.quantity??Ye.qty??0),Ve=Number(Ye.profit??(G-ft)*gt);Zt+=Ve}}),Math.round(Zt*100)/100}catch(U){return console.warn("تعذر حساب أرباح المبيعات الشهرية:",U),0}},p=async()=>{if(r)try{if(Array.isArray(t)&&t.length>0){const ve=new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Cairo"}),we=new Date,[Z,V]=ve.format(we).split("-"),Se=parseInt(Z),Re=parseInt(V)-1,Fe=_t.filterVisibleTransactions(t,"monthly",r);let Ge=0,yt=0;Fe.forEach(We=>{var M,se,Be;let Ye;We.createdAt instanceof Date?Ye=We.createdAt:typeof((M=We.createdAt)==null?void 0:M.toDate)=="function"?Ye=We.createdAt.toDate():Ye=new Date(We.createdAt||0);const Q=ve.formatToParts(Ye),G=parseInt(((se=Q.find(Ke=>Ke.type==="year"))==null?void 0:se.value)||"0"),ft=parseInt(((Be=Q.find(Ke=>Ke.type==="month"))==null?void 0:Be.value)||"0")-1,gt=String(We.status||"confirmed").toLowerCase();if(G!==Se||ft!==Re||gt!=="completed"&&gt!=="confirmed")return;const Ve=(We.type||We.txnType||"").toLowerCase(),X={type:Ve==="withdrawal"||Ve==="machine_withdrawal"?"withdraw":Ve,amount:Number(We.amount||0),commission:We.commission};X.type==="withdraw"?Ge+=ba.calculateProfitFromTransaction(X):(X.type==="send"||X.type==="receive"||X.type==="transfer")&&(yt+=ba.calculateProfitFromTransaction(X))});const Zt=await P();S({monthlyWithdrawalProfit:Math.round(Ge*100)/100,monthlyTransferProfit:Math.round(yt*100)/100,monthlySalesProfit:Zt,lastUpdated:new Date});return}const U=ba.getWithdrawTransferProfits(r),te=await P();S({monthlyWithdrawalProfit:U.monthlyWithdrawProfit||0,monthlyTransferProfit:U.monthlyTransferProfit||0,monthlySalesProfit:te,lastUpdated:new Date})}catch(U){console.error("Error loading profit data:",U)}},z=U=>`${U.toFixed(2)} ج.م`,B=async()=>{try{const U=(j==null?void 0:j.subscription)||null,te=(U==null?void 0:U.planType)??(U==null?void 0:U.plan)??null,ve=typeof te=="string"?te.toLowerCase():null;if(te===Qt.ZERO||ve==="zero"||ve==="0"||te===0)return!0}catch{}try{if(r){const U=await sm(r),te=(U==null?void 0:U.planType)??(U==null?void 0:U.plan)??null,ve=typeof te=="string"?te.toLowerCase():null;if(te===Qt.ZERO||ve==="zero"||ve==="0"||te===0)return!0}}catch{}return!1},le=async()=>{try{if(await B()){xu({title:"الخطة زيرو",description:"عرض الأرباح الشهرية غير متاح في خطة زيرو. قم بالترقية للوصول إلى التقارير.",variant:"destructive"});return}}catch{}const U=r||(T==null?void 0:T.uid),te=U?`monthlyReportsLock_v4_${U}`:"monthlyReportsLock_v4",ve=(localStorage.getItem(te)??localStorage.getItem("monthlyReportsLock_v4"))==="true",we=await Wt.hasMasterPin(U);ve&&we?h(!0):(N(!0),o(!0))},re=async()=>{try{if(await B()){xu({title:"الخطة زيرو",description:"عرض الأرباح الشهرية غير متاح في خطة زيرو. قم بالترقية للوصول إلى التقارير.",variant:"destructive"}),h(!1);return}}catch{}N(!0),o(!0),h(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(I,{size:"sm",variant:"ghost",onClick:le,className:"h-6 w-6 p-0 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded-full transition-colors duration-200",title:"عرض الأرباح الشهرية",children:e.jsx(Qs,{className:"h-4 w-4"})}),e.jsx(fe,{open:n,onOpenChange:o,children:e.jsxs(ge,{className:"max-w-[280px] sm:max-w-[320px] mx-auto bg-white dark:bg-[#0f172a] border border-gray-200 dark:border-slate-800 shadow-xl rounded-xl p-0 overflow-hidden",children:[e.jsx(pe,{className:"bg-gray-50 dark:bg-slate-900/50 px-4 py-3 border-b border-gray-100 dark:border-slate-800",children:e.jsxs(xe,{className:"text-sm font-bold text-gray-900 dark:text-slate-100 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white dark:bg-slate-800 rounded-full border border-gray-200 dark:border-slate-700",children:e.jsx(yi,{className:"h-4 w-4 text-purple-600 dark:text-purple-400"})}),"أرباح الشهر"]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-red-50 dark:bg-red-900/20 rounded-md",children:e.jsx(Ks,{className:"h-3.5 w-3.5 text-red-600 dark:text-red-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"سحب"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:z(D.monthlyWithdrawalProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-green-50 dark:bg-green-900/20 rounded-md",children:e.jsx(nm,{className:"h-3.5 w-3.5 text-green-600 dark:text-green-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"تحويل"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:z(D.monthlyTransferProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-violet-50 dark:bg-violet-900/20 rounded-md",children:e.jsx(om,{className:"h-3.5 w-3.5 text-violet-600 dark:text-violet-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"أرباح المبيعات"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:z(D.monthlySalesProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-100 dark:border-purple-900/30 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white dark:bg-slate-800 rounded-md shadow-sm",children:e.jsx(Oa,{className:"h-3.5 w-3.5 text-purple-600 dark:text-purple-400"})}),e.jsx("span",{className:"font-bold text-purple-900 dark:text-purple-100 text-sm",children:"الإجمالي"})]}),e.jsx("span",{className:"font-bold text-base text-purple-700 dark:text-purple-300",children:z(D.monthlyWithdrawalProfit+D.monthlyTransferProfit+D.monthlySalesProfit)})]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-slate-900/50 px-4 py-3 border-t border-gray-100 dark:border-slate-800 flex justify-center",children:e.jsx(I,{onClick:()=>o(!1),className:"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 hover:text-gray-900 w-full sm:w-auto px-8 rounded-lg text-sm font-medium shadow-sm",children:"إغلاق"})})]})}),e.jsx(lg,{open:c,onOpenChange:h,mode:"verify",title:"التحقق من الرقم السري الرئيسي",description:"الرجاء إدخال الرقم السري الرئيسي لعرض الأرباح الشهرية",userId:r||(T==null?void 0:T.uid),userRole:O==null?void 0:O.role,onSuccess:re})]})},ev=r=>e.jsx(Zb,{...r});function tv({open:r,onOpenChange:t,onSuccess:n,userId:o}){const[c,h]=u.useState(""),[x,N]=u.useState(""),[D,S]=u.useState(!1),[j,T]=u.useState(!1),[O,P]=u.useState(""),[p,z]=u.useState(!1),[B,le]=u.useState(!1),{toast:re}=Si(),U=ae.useRef(null);u.useEffect(()=>{let we=!0;return(async()=>{const Z=await Wt.hasMasterPin(o);we&&le(Z)})(),()=>{we=!1}},[o,r]);const te=()=>{h(""),N(""),P(""),S(!1),T(!1),t(!1)},ve=async we=>{we.preventDefault(),P(""),z(!0);try{if(B){if(!await Wt.verifyMasterPin(c,o)){P("الرقم السري غير صحيح"),z(!1);return}}else{if(c.length<4){P("يجب أن يكون الرقم السري 4 أرقام على الأقل"),z(!1);return}if(c!==x){P("الرقم السري غير متطابق"),z(!1);return}if(!await Wt.createMasterPin(c,o)){P("تعذر إنشاء الرقم السري الرئيسي"),z(!1);return}}re({title:"نجح العملية",description:B?"تم التحقق من الرقم السري الرئيسي بنجاح":"تم إنشاء الرقم السري الرئيسي بنجاح"}),n(),te()}catch{P("حدث خطأ أثناء معالجة الرقم السري")}finally{z(!1)}};return e.jsx(fe,{open:r,onOpenChange:t,children:e.jsxs(ge,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(yu,{className:"h-5 w-5 text-green-600"}),B?"أدخل الرقم السري الرئيسي":"إنشاء الرقم السري الرئيسي"]})}),e.jsxs("form",{ref:U,onSubmit:ve,className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 bg-blue-50 p-3 rounded-lg",children:B?"أدخل الرقم السري الرئيسي لعرض بيانات الأرباح":"قم بإنشاء الرقم السري الرئيسي لحماية بيانات الأرباح. يمكنك تغييره لاحقاً من إعدادات البروفيل."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"pin",children:B?"الرقم السري الرئيسي":"الرقم السري الرئيسي الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{id:"pin",type:D?"text":"password",value:c,onChange:we=>h(we.target.value),onKeyDown:we=>{var Z;we.key==="Enter"&&(we.preventDefault(),(Z=U.current)==null||Z.requestSubmit())},placeholder:B?"أدخل الرقم السري":"أدخل رقم سري جديد (4 أرقام على الأقل)",className:"pr-10",dir:"ltr",autoComplete:"off",required:!0}),e.jsx(I,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>S(!D),children:D?e.jsx(bu,{className:"h-4 w-4"}):e.jsx(Qs,{className:"h-4 w-4"})})]})]}),!B&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"confirmPin",children:"تأكيد الرقم السري"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{id:"confirmPin",type:j?"text":"password",value:x,onChange:we=>N(we.target.value),onKeyDown:we=>{var Z;we.key==="Enter"&&(we.preventDefault(),(Z=U.current)==null||Z.requestSubmit())},placeholder:"أعد إدخال الرقم السري",className:"pr-10",dir:"ltr",autoComplete:"off",required:!0}),e.jsx(I,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>T(!j),children:j?e.jsx(bu,{className:"h-4 w-4"}):e.jsx(Qs,{className:"h-4 w-4"})})]})]}),O&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(cg,{className:"h-4 w-4"}),O]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(I,{type:"submit",disabled:p,className:"flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx(yu,{className:"h-4 w-4 mr-2"}),p?"جاري المعالجة...":B?"عرض الأرباح":"إنشاء وعرض الأرباح"]}),e.jsx(I,{type:"button",variant:"outline",onClick:te,disabled:p,children:"إلغاء"})]})]})]})})}const av=({userId:r,transactions:t})=>{const[n,o]=u.useState(!1),[c,h]=u.useState(!1),[x,N]=u.useState(!1),[D,S]=u.useState({dailyWithdrawalProfit:0,dailyTransferProfit:0,dailySalesProfit:0,lastUpdated:new Date}),{shopId:j}=rm();u.useEffect(()=>{r&&n&&x&&O()},[r,n,x,t,j]),u.useEffect(()=>{if(!n||!x)return;const B=setInterval(()=>{const le=new Date;D.lastUpdated.getDate()!==le.getDate()&&O()},3e4);return()=>clearInterval(B)},[n,x,D.lastUpdated]);const T=async()=>{if(!r)return 0;const B=new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Cairo"}),le=B.format(new Date);let re=0;try{const U=Te(de($,"dailySales"),K("userId","==",r),...j?[K("shopId","==",j)]:[]),te=await De(U),ve=[];te.forEach(V=>{ve.push({id:V.id,data:V.data()})}),(await De(de($,"users",r,"dailySales"))).forEach(V=>{const Se=V.data();j&&Se.shopId&&Se.shopId!==j||ve.push({id:V.id,data:Se})});const Z=new Map;ve.forEach(V=>{const Se=String(V.data.clientId||V.id);Z.has(Se)||Z.set(Se,V.data)}),Z.forEach(V=>{if(V.isDeferred)return;let Se=null;if(V.createdAt)typeof V.createdAt.toDate=="function"?Se=V.createdAt.toDate():V.createdAt instanceof Date?Se=V.createdAt:typeof V.createdAt=="number"?Se=new Date(V.createdAt):typeof V.createdAt=="string"&&(Se=new Date(V.createdAt));else if(V.date){const Fe=V.time||"00:00";Se=new Date(`${V.date}T${Fe}:00`)}let Re=!1;if(Se&&!isNaN(Se.getTime())?B.format(Se)===le&&(Re=!0):String(V.date||"").slice(0,10)===le&&(Re=!0),Re){const Fe=Number(V.quantity||1),Ge=Number(V.profit??(Number(V.sellingPrice||0)-Number(V.wholesalePrice||0))*Fe);re+=Ge}})}catch(U){console.warn("تعذر جلب أرباح المبيعات اليومية:",U)}return Math.round(re*100)/100},O=async()=>{if(r)try{if(Array.isArray(t)&&t.length>0){const re=new Date,U=_t.filterVisibleTransactions(t,"daily",r);let te=0,ve=0;U.forEach(Z=>{const V=new Date(Z.createdAt),Se=String(Z.status||"confirmed").toLowerCase();if(V.toDateString()!==re.toDateString())return;const Re=(Z.type||Z.txnType||"").toLowerCase(),Fe=String(Z.title||"");if(Re==="cash_addition"||Fe.includes("إيصال إضافة نقدية"))return;const Ge={type:Re==="withdrawal"||Re==="machine_withdrawal"?"withdraw":Re,amount:Number(Z.amount||0),commission:Z.commission};Ge.type==="withdraw"?te+=ba.calculateProfitFromTransaction(Ge):(Ge.type==="send"||Ge.type==="receive"||Ge.type==="transfer")&&(ve+=ba.calculateProfitFromTransaction(Ge))});const we=await T();S({dailyWithdrawalProfit:Math.round(te*100)/100,dailyTransferProfit:Math.round(ve*100)/100,dailySalesProfit:we,lastUpdated:new Date});try{ba.updateProfitsFromTransactions(t,r)}catch{}return}const B=ba.getWithdrawTransferProfits(r),le=await T();S({dailyWithdrawalProfit:B.dailyWithdrawProfit||0,dailyTransferProfit:B.dailyTransferProfit||0,dailySalesProfit:le,lastUpdated:new Date})}catch(B){console.error("Error loading profit data:",B)}},P=B=>`${B.toFixed(2)} ج.م`,p=()=>{ba.hasProfitPin(r),h(!0)},z=()=>{N(!0),o(!0),h(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(I,{size:"sm",variant:"ghost",onClick:p,className:"h-6 w-6 p-0 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-colors duration-200",title:"عرض الأرباح اليومية",children:e.jsx(Qs,{className:"h-4 w-4"})}),e.jsx(fe,{open:n,onOpenChange:o,children:e.jsxs(ge,{className:"max-w-[280px] sm:max-w-[320px] mx-auto bg-white dark:bg-[#0f172a] border border-gray-200 dark:border-slate-800 shadow-xl rounded-xl p-0 overflow-hidden",children:[e.jsx(pe,{className:"bg-gray-50 dark:bg-slate-900/50 px-4 py-3 border-b border-gray-100 dark:border-slate-800",children:e.jsxs(xe,{className:"text-sm font-bold text-gray-900 dark:text-slate-100 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white dark:bg-slate-800 rounded-full border border-gray-200 dark:border-slate-700",children:e.jsx(Oa,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})}),"أرباح اليوم"]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-red-50 dark:bg-red-900/20 rounded-md",children:e.jsx(Ks,{className:"h-3.5 w-3.5 text-red-600 dark:text-red-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"سحب"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:P(D.dailyWithdrawalProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-green-50 dark:bg-green-900/20 rounded-md",children:e.jsx(nm,{className:"h-3.5 w-3.5 text-green-600 dark:text-green-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"تحويل"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:P(D.dailyTransferProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-violet-50 dark:bg-violet-900/20 rounded-md",children:e.jsx(om,{className:"h-3.5 w-3.5 text-violet-600 dark:text-violet-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"أرباح المبيعات"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:P(D.dailySalesProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-900/30 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white dark:bg-slate-800 rounded-md shadow-sm",children:e.jsx(Oa,{className:"h-3.5 w-3.5 text-blue-600 dark:text-blue-400"})}),e.jsx("span",{className:"font-bold text-blue-900 dark:text-blue-100 text-sm",children:"الإجمالي"})]}),e.jsx("span",{className:"font-bold text-base text-blue-700 dark:text-blue-300",children:P(D.dailyWithdrawalProfit+D.dailyTransferProfit+D.dailySalesProfit)})]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-slate-900/50 px-4 py-3 border-t border-gray-100 dark:border-slate-800 flex justify-center",children:e.jsx(I,{onClick:()=>o(!1),className:"bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-700 text-gray-700 dark:text-slate-200 hover:bg-gray-50 dark:hover:bg-slate-700 hover:text-gray-900 w-full sm:w-auto px-8 rounded-lg text-sm font-medium shadow-sm",children:"إغلاق"})})]})}),e.jsx(tv,{open:c,onOpenChange:h,onSuccess:z,userId:r})]})},sv=r=>e.jsx(av,{...r});var Kl="Radio",[rv,Fm]=Tl(Kl),[nv,iv]=rv(Kl),Bm=u.forwardRef((r,t)=>{const{__scopeRadio:n,name:o,checked:c=!1,required:h,disabled:x,value:N="on",onCheck:D,form:S,...j}=r,[T,O]=u.useState(null),P=Xr(t,B=>O(B)),p=u.useRef(!1),z=T?S||!!T.closest("form"):!0;return e.jsxs(nv,{scope:n,checked:c,disabled:x,children:[e.jsx(Zs.button,{type:"button",role:"radio","aria-checked":c,"data-state":qm(c),"data-disabled":x?"":void 0,disabled:x,value:N,...j,ref:P,onClick:Xa(r.onClick,B=>{c||D==null||D(),z&&(p.current=B.isPropagationStopped(),p.current||B.stopPropagation())})}),z&&e.jsx(Vm,{control:T,bubbles:!p.current,name:o,value:N,checked:c,required:h,disabled:x,form:S,style:{transform:"translateX(-100%)"}})]})});Bm.displayName=Kl;var $m="RadioIndicator",Um=u.forwardRef((r,t)=>{const{__scopeRadio:n,forceMount:o,...c}=r,h=iv($m,n);return e.jsx(Pl,{present:o||h.checked,children:e.jsx(Zs.span,{"data-state":qm(h.checked),"data-disabled":h.disabled?"":void 0,...c,ref:t})})});Um.displayName=$m;var ov="RadioBubbleInput",Vm=u.forwardRef(({__scopeRadio:r,control:t,checked:n,bubbles:o=!0,...c},h)=>{const x=u.useRef(null),N=Xr(x,h),D=dg(n),S=ug(t);return u.useEffect(()=>{const j=x.current;if(!j)return;const T=window.HTMLInputElement.prototype,P=Object.getOwnPropertyDescriptor(T,"checked").set;if(D!==n&&P){const p=new Event("click",{bubbles:o});P.call(j,n),j.dispatchEvent(p)}},[D,n,o]),e.jsx(Zs.input,{type:"radio","aria-hidden":!0,defaultChecked:n,...c,tabIndex:-1,ref:N,style:{...c.style,...S,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Vm.displayName=ov;function qm(r){return r?"checked":"unchecked"}var lv=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Ci="RadioGroup",[cv]=Tl(Ci,[im,Fm]),zm=im(),Ym=Fm(),[dv,uv]=cv(Ci),Km=u.forwardRef((r,t)=>{const{__scopeRadioGroup:n,name:o,defaultValue:c,value:h,required:x=!1,disabled:N=!1,orientation:D,dir:S,loop:j=!0,onValueChange:T,...O}=r,P=zm(n),p=Vg(S),[z,B]=em({prop:h,defaultProp:c??null,onChange:T,caller:Ci});return e.jsx(dv,{scope:n,name:o,required:x,disabled:N,value:z,onValueChange:B,children:e.jsx(rp,{asChild:!0,...P,orientation:D,dir:p,loop:j,children:e.jsx(Zs.div,{role:"radiogroup","aria-required":x,"aria-orientation":D,"data-disabled":N?"":void 0,dir:p,...O,ref:t})})})});Km.displayName=Ci;var Jm="RadioGroupItem",Hm=u.forwardRef((r,t)=>{const{__scopeRadioGroup:n,disabled:o,...c}=r,h=uv(Jm,n),x=h.disabled||o,N=zm(n),D=Ym(n),S=u.useRef(null),j=Xr(t,S),T=h.value===c.value,O=u.useRef(!1);return u.useEffect(()=>{const P=z=>{lv.includes(z.key)&&(O.current=!0)},p=()=>O.current=!1;return document.addEventListener("keydown",P),document.addEventListener("keyup",p),()=>{document.removeEventListener("keydown",P),document.removeEventListener("keyup",p)}},[]),e.jsx(np,{asChild:!0,...N,focusable:!x,active:T,children:e.jsx(Bm,{disabled:x,required:h.required,checked:T,...D,...c,name:h.name,ref:j,onCheck:()=>h.onValueChange(c.value),onKeyDown:Xa(P=>{P.key==="Enter"&&P.preventDefault()}),onFocus:Xa(c.onFocus,()=>{var P;O.current&&((P=S.current)==null||P.click())})})})});Hm.displayName=Jm;var mv="RadioGroupIndicator",Qm=u.forwardRef((r,t)=>{const{__scopeRadioGroup:n,...o}=r,c=Ym(n);return e.jsx(Um,{...c,...o,ref:t})});Qm.displayName=mv;var Gm=Km,Xm=Hm,hv=Qm;const Zm=u.forwardRef(({className:r,...t},n)=>e.jsx(Gm,{className:Za("grid gap-2",r),...t,ref:n}));Zm.displayName=Gm.displayName;const vi=u.forwardRef(({className:r,...t},n)=>e.jsx(Xm,{ref:n,className:Za("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...t,children:e.jsx(hv,{className:"flex items-center justify-center",children:e.jsx(Xg,{className:"h-2.5 w-2.5 fill-current text-current"})})}));vi.displayName=Xm.displayName;const fv=({isOpen:r,onClose:t,userId:n,wallets:o,walletBalances:c,onSuccess:h})=>{const{toast:x}=Si(),[N,D]=u.useState(1),[S,j]=u.useState(""),[T,O]=u.useState(""),[P,p]=u.useState(""),[z,B]=u.useState("cash"),[le,re]=u.useState(""),[U,te]=u.useState(!1);u.useEffect(()=>{r&&(D(1),j(""),O(""),p(""),B("cash"),re(""))},[r]);const ve=()=>{if(!S||parseFloat(S)<=0){x({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}if(!P){x({title:"خطأ",description:"يرجى اختيار المحفظة",variant:"destructive"});return}const Z=c[P]||0;if(parseFloat(S)>Z){x({title:"خطأ",description:"رصيد المحفظة غير كافٍ",variant:"destructive"});return}D(2)},we=async()=>{var Z;if(z==="wallet"&&!le){x({title:"خطأ",description:"يرجى اختيار محفظة الإضافة",variant:"destructive"});return}te(!0);try{const V=parseFloat(S),Se=T?parseFloat(T):0,Re=V+Se,Fe=V,Ge=Ae($,"users",n),yt=await ua(Ge);if(!yt.exists())throw"User document not found";const We=yt.data().walletBalances||{},Ye=Number(We[P]||0);if(console.log("[AtmWithdrawDialog] Validation:",{sourceWalletId:P,currentSourceBalance:Ye,numericAmount:V,numericCommission:Se,totalDeductedFromWallet:Re}),Ye<Re)throw`رصيد المحفظة غير كافٍ (المتاح: ${Ye}, المطلوب خصمه: ${Re})`;const Q=await Ma.canPerformOperation(P,V,"transfer");if(!Q.canPerform)throw Q.message||"تجاوز حد التحويل المسموح";const G=kl($),ft={};ft[`walletBalances.${P}`]=hl(-Re);let gt="";z==="wallet"&&le?(ft[`walletBalances.${le}`]=hl(Fe),gt=`Wallet: ${(Z=o.find(se=>se.id===le))==null?void 0:Z.name}`):z==="cash"?(ft.cashBalance=hl(Fe),gt="Cash Drawer"):gt="No Addition",G.update(Ge,ft);const Ve=o.find(se=>se.id===P),X=Ae(de($,"userTransactions"));G.set(X,{userId:n,type:"atm_withdraw",amount:V,commission:Se,totalCharged:Re,netAmount:Fe,sourceWalletId:P,destinationType:z,destinationWalletId:z==="wallet"?le:null,status:"completed",createdAt:ht(),note:`سحب ATM من ${Ve==null?void 0:Ve.name}`,walletId:P,sender_msisdn:(Ve==null?void 0:Ve.phone)||"",details:`ATM Withdraw from ${Ve==null?void 0:Ve.name} -> ${gt}`}),await G.commit();try{await Ma.updateUsage(P,V,"transfer")}catch(se){console.error("Failed to update wallet limits:",se)}let M={};if(z==="cash")M={delta:{amount:Fe,commission:Se,totalDeducted:Re,type:"atm_withdraw",walletId:P}};else{const se={...c};se[P]=(se[P]||0)-Re,z==="wallet"&&(se[le]=(se[le]||0)+Fe),M={walletBalances:se}}window.dispatchEvent(new CustomEvent("dashboard:external-update",{detail:M})),x({title:"نجاح",description:"تمت عملية السحب بنجاح"}),h==null||h(),t()}catch(V){console.error("ATM Withdraw Error:",V),x({title:"خطأ",description:typeof V=="string"?V:"حدث خطأ أثناء العملية",variant:"destructive"})}finally{te(!1)}};return e.jsx(fe,{open:r,onOpenChange:t,children:e.jsxs(ge,{className:"sm:max-w-[425px]",dir:"rtl",children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"سحب ATM"}),e.jsx(rt,{children:N===1?"أدخل تفاصيل عملية السحب":"اختر مكان إضافة النقدية"})]}),N===1?e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"مبلغ السحب"}),e.jsx(J,{type:"number",placeholder:"أدخل المبلغ",value:S,onChange:Z=>j(Z.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"عمولة الخصم (اختياري)"}),e.jsx(J,{type:"number",placeholder:"أدخل العمولة",value:T,onChange:Z=>O(Z.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"اختر المحفظة للسحب منها"}),e.jsxs(Ja,{value:P,onValueChange:p,children:[e.jsx(Ha,{children:e.jsx(Qa,{placeholder:"اختر المحفظة"})}),e.jsx(Ga,{children:o.map(Z=>e.jsx(da,{value:Z.id,children:e.jsxs("div",{className:"flex justify-between w-full gap-4",children:[e.jsx("span",{children:Z.phone||Z.name}),e.jsx("span",{className:"text-muted-foreground text-xs",children:c[Z.id]?`${c[Z.id]} ج.م`:"0 ج.م"})]})},Z.id))})]})]})]}):e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg mb-4",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"المبلغ:"}),e.jsxs("span",{className:"font-bold",children:[S," ج.م"]})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"العمولة (خصم إضافي):"}),e.jsxs("span",{className:"font-bold text-red-500",children:[T||0," ج.م"]})]}),e.jsxs("div",{className:"flex justify-between mb-2 pt-2 border-t border-dashed",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"إجمالي الخصم من المحفظة:"}),e.jsxs("span",{className:"font-bold text-red-600",children:[parseFloat(S)+(parseFloat(T)||0)," ج.م"]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between",children:[e.jsx("span",{className:"text-sm font-semibold",children:"المبلغ المضاف للوجهة:"}),e.jsxs("span",{className:"font-bold text-green-600",children:[S," ج.م"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(H,{children:"مكان إضافة النقدية"}),e.jsxs(Zm,{value:z,onValueChange:Z=>B(Z),className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(vi,{value:"cash",id:"r1"}),e.jsx(H,{htmlFor:"r1",className:"cursor-pointer",children:"الدرج النقدي (Cash Drawer)"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(vi,{value:"wallet",id:"r2"}),e.jsx(H,{htmlFor:"r2",className:"cursor-pointer",children:"محفظة أخرى"})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(vi,{value:"none",id:"r3"}),e.jsx(H,{htmlFor:"r3",className:"cursor-pointer",children:"بدون إضافة (سحب فقط)"})]})]})]}),z==="wallet"&&e.jsxs("div",{className:"space-y-2 mt-4 animate-in fade-in slide-in-from-top-2",children:[e.jsx(H,{children:"اختر محفظة الإضافة"}),e.jsxs(Ja,{value:le,onValueChange:re,children:[e.jsx(Ha,{children:e.jsx(Qa,{placeholder:"اختر المحفظة"})}),e.jsx(Ga,{children:o.filter(Z=>Z.id!==P).map(Z=>e.jsx(da,{value:Z.id,children:Z.phone||Z.name},Z.id))})]})]})]}),e.jsxs(Oe,{className:"flex-col sm:flex-row gap-2",children:[N===2&&e.jsx(I,{variant:"outline",onClick:()=>D(1),disabled:U,children:"عودة"}),N===1?e.jsxs(I,{onClick:ve,className:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white",children:["التالي ",e.jsx(mg,{className:"mr-2 h-4 w-4"})]}):e.jsxs(I,{onClick:we,disabled:U,className:"w-full sm:w-auto bg-green-600 hover:bg-green-700",children:[U&&e.jsx(zs,{className:"mr-2 h-4 w-4 animate-spin"}),"تأكيد السحب"]})]})]})})};class Js{static async processTransfer(t){const{amount:n,currentCashBalance:o,currentWalletBalances:c,wallets:h,selectedWalletId:x}=t;if(n<=0)return{success:!1,newCashBalance:o,newWalletBalances:c,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};if(x&&!t.skipRemoteLimitsCheck)try{const j=await Ma.canPerformOperation(x,n,"transfer");if(!j.canPerform)return{success:!1,newCashBalance:o,newWalletBalances:c,message:j.message||"تم تجاوز الحد الأقصى",error:"LIMIT_EXCEEDED"}}catch(j){return console.error("خطأ في التحقق من حدود التحويل:",j),{success:!1,newCashBalance:o,newWalletBalances:c,message:"خطأ في التحقق من حدود التحويل",error:"LIMIT_CHECK_ERROR"}}if(n<=0)return{success:!1,newCashBalance:o,newWalletBalances:c,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};if(x){const j=Math.max(c[x]||0,0);if(j<n){const T=h.find(O=>O.id===x);return{success:!1,newCashBalance:o,newWalletBalances:c,message:`رصيد غير كافي في المحفظة${T?` ${T.name}`:""}. المتاح: ${j} جنيه، المطلوب: ${n} جنيه`,error:"INSUFFICIENT_WALLET_BALANCE"}}}else{const j=Js.calculateTotalWalletBalance(c);if(j<n)return{success:!1,newCashBalance:o,newWalletBalances:c,message:`رصيد غير كافي في المحافظ. الرصيد المتاح: ${j} جنيه، المبلغ المطلوب: ${n} جنيه`,error:"INSUFFICIENT_WALLET_BALANCE"}}const N={...c};if(x){const j=N[x]||0;N[x]=j-n}else{let j=n;for(const T of h){if(j<=0)break;const O=Math.max(N[T.id]||0,0),P=Math.min(O,j);P>0&&(N[T.id]=(N[T.id]||0)-P,j-=P)}}const D=o+n;let S="تم التحويل بنجاح";if(x){const j=N[x]||0;j<0&&(S=`تم التحويل بنجاح مع تحذير: رصيد محفظة ${x} أصبح ${j} جنيه.`)}return{success:!0,newCashBalance:D,newWalletBalances:N,message:S}}static processDeposit(t){const{amount:n,currentCashBalance:o,currentWalletBalances:c,wallets:h}=t;if(n<=0)return{success:!1,newCashBalance:o,newWalletBalances:c,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};const x=this.calculateTotalWalletBalance(c);if(x<n)return{success:!1,newCashBalance:o,newWalletBalances:c,message:`رصيد غير كافي في المحافظ. الرصيد المتاح: ${x} جنيه، المبلغ المطلوب: ${n} جنيه`,error:"INSUFFICIENT_WALLET_BALANCE"};const N=o+n,D={...c};let S=n;const j=h.find(O=>O.isDefault);if(j&&D[j.id]>=S)D[j.id]-=S,S=0;else for(const O of h){if(S<=0)break;const P=D[O.id]||0;if(P>0){const p=Math.min(P,S);D[O.id]=P-p,S-=p}}const T=S>0?`تم الإيداع جزئياً. تم إيداع ${n-S} جنيه في صندوق النقدية`:`تم الإيداع بنجاح. تم إضافة ${n} جنيه إلى صندوق النقدية`;return{success:!0,newCashBalance:N,newWalletBalances:D,message:T}}static async processWithdraw(t){const{amount:n,currentCashBalance:o,currentWalletBalances:c,wallets:h,selectedWalletId:x}=t;if(n<=0)return{success:!1,newCashBalance:o,newWalletBalances:c,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};if(x&&!t.skipRemoteLimitsCheck)try{const j=await Ma.canPerformOperation(x,n,"withdraw");if(!j.canPerform)return{success:!1,newCashBalance:o,newWalletBalances:c,message:j.message||"تم تجاوز الحد الأقصى",error:"LIMIT_EXCEEDED"}}catch(j){return console.error("خطأ في التحقق من حدود السحب:",j),{success:!1,newCashBalance:o,newWalletBalances:c,message:"خطأ في التحقق من حدود السحب",error:"LIMIT_CHECK_ERROR"}}if(o<n)return{success:!1,newCashBalance:o,newWalletBalances:c,message:`رصيد غير كافي في صندوق النقدية. الرصيد المتاح: ${o} جنيه، المبلغ المطلوب: ${n} جنيه`,error:"INSUFFICIENT_CASH_BALANCE"};const N=o-n,D={...c},S=x?h.find(j=>j.id===x):h.find(j=>j.isDefault)||h[0];if(S){const j=D[S.id]||0;D[S.id]=j+n}else return{success:!1,newCashBalance:o,newWalletBalances:c,message:"لا توجد محافظ متاحة لإضافة المبلغ إليها",error:"NO_WALLETS_AVAILABLE"};return{success:!0,newCashBalance:N,newWalletBalances:D,message:`تم السحب بنجاح. تم إضافة ${n} جنيه إلى محفظة ${(S==null?void 0:S.name)||""}`}}static validateOperation(t,n){return t<=0?{valid:!1,error:"المبلغ يجب أن يكون أكبر من الصفر"}:!n||n.length===0?{valid:!1,error:"لا توجد محافظ متاحة"}:{valid:!0}}static calculateTotalWalletBalance(t){return Object.values(t).reduce((n,o)=>n+Math.max(o,0),0)}static deductFromWalletsAddToCash(t,n,o,c){return this.processTransfer({amount:t,currentCashBalance:n,currentWalletBalances:o,wallets:c})}static deductFromWalletsAddToCashDeposit(t,n,o,c){return this.processDeposit({amount:t,currentCashBalance:n,currentWalletBalances:o,wallets:c})}static deductFromCashAddToWallets(t,n,o,c){return this.processWithdraw({amount:t,currentCashBalance:n,currentWalletBalances:o,wallets:c})}static applyTransactionResult(t,n,o){t.success&&(n(t.newCashBalance),o(t.newWalletBalances))}static validateTransaction(t,n,o,c){if(t<=0)return{isValid:!1,error:"المبلغ يجب أن يكون أكبر من الصفر"};if(n==="transfer"){const h=this.calculateTotalWalletBalance(c);if(h<t)return{isValid:!1,error:`الرصيد المتاح في المحافظ (${h} جنيه) غير كافي للمبلغ المطلوب (${t} جنيه)`}}else if(n==="withdraw"){if(o<t)return{isValid:!1,error:`الرصيد المتاح في صندوق النقدية (${o} جنيه) غير كافي للمبلغ المطلوب (${t} جنيه)`}}else if(n==="deposit"){const h=this.calculateTotalWalletBalance(c);if(h<t)return{isValid:!1,error:`الرصيد المتاح في المحافظ (${h} جنيه) غير كافي للمبلغ المطلوب (${t} جنيه)`}}return{isValid:!0}}static getDeductionPreview(t,n,o){const c=[];let h=t;for(const x of o){if(h<=0)break;const N=n[x.id]||0,D=Math.min(Math.max(N,0),h);D>0&&(c.push({walletId:x.id,walletName:x.name,currentBalance:N,deductedAmount:D,newBalance:N-D}),h-=D)}return c}}let Hr=null;function gv(){const r=window;if(!Hr){const t=r.AudioContext||r.webkitAudioContext;Hr=new t}return Hr.state==="suspended"&&Hr.resume(),Hr}function pv(r,t,n){const o=n/1e3,c=Math.floor(r.sampleRate*o),h=r.createBuffer(1,c,r.sampleRate),x=h.getChannelData(0);for(let j=0;j<c;j++)x[j]=(Math.random()*2-1)*.6;const N=r.createBufferSource();N.buffer=h;const D=r.createBiquadFilter();D.type="highpass",D.frequency.value=1500,D.Q.value=.7;const S=r.createGain();S.gain.setValueAtTime(1e-4,t),S.gain.exponentialRampToValueAtTime(.4,t+.015),S.gain.exponentialRampToValueAtTime(1e-4,t+o),N.connect(D),D.connect(S),S.connect(r.destination),N.start(t),N.stop(t+o+.01)}function xv(r,t,n,o,c,h="triangle"){const x=r.createOscillator(),N=r.createGain();x.type=h;const D=c/1e3;x.frequency.setValueAtTime(n,t),x.frequency.linearRampToValueAtTime(o,t+D),N.gain.setValueAtTime(1e-4,t),N.gain.exponentialRampToValueAtTime(.25,t+.02),N.gain.exponentialRampToValueAtTime(1e-4,t+D),x.connect(N),N.connect(r.destination),x.start(t),x.stop(t+D+.02)}function yv(){try{const r=gv(),t=r.currentTime;pv(r,t,90),xv(r,t+.12,1900,1100,180,"sawtooth")}catch{}}function bv(r){if(!r)return!1;const n=r.replace(/[^0-9٠-٩]/g,"").replace(/[٠-٩]/g,o=>"0123456789"["٠١٢٣٤٥٦٧٨٩".indexOf(o)]);return/^(010|011|012|015)[0-9]{8}$/.test(n)}const vv=({isOpen:r,onClose:t,senderPhone:n,receiverPhone:o,amount:c,deviceId:h,api:x})=>{const{toast:N}=Si(),[D,S]=u.useState(1),[j,T]=u.useState(!1),[O,P]=u.useState("");u.useEffect(()=>{r&&(S(1),P(""))},[r]);const p=async te=>{try{return x&&typeof x.enterPin=="function"?(await x.enterPin(h,te),!0):!1}catch(ve){return console.error("ADB error:",ve),N({title:"خطأ ADB",description:ve.message||"فشل الاتصال",variant:"destructive"}),!1}},z=async()=>{if(!O){N({title:"أدخل الرقم السري",variant:"destructive"});return}T(!0);const te=await p(O);T(!1),te&&S(2)},B=async()=>{T(!0);const te=await p(String(c));T(!1),te&&S(3)},le=async()=>{T(!0);const te=await p(o);T(!1),te&&S(4)},re=async()=>{T(!0);const te=await p(o);T(!1),te&&S(5)},U=async()=>{T(!0);const te=await p("1");T(!1),te&&(N({title:"تم التحويل بنجاح",description:"تم تأكيد العملية"}),t())};return e.jsx(fe,{open:r,onOpenChange:te=>!te&&t(),children:e.jsxs(ge,{className:"sm:max-w-[400px]",children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"تحويل اتصالات كاش (USSD)"}),e.jsxs(rt,{children:[D===1&&"الخطوة 1: أدخل الرقم السري للمحفظة",D===2&&"الخطوة 2: تأكيد مبلغ التحويل",D===3&&"الخطوة 3: إدخال رقم المستقبل",D===4&&"الخطوة 4: تأكيد رقم المستقبل",D===5&&"الخطوة 5: تأكيد العملية النهائية"]})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[D===1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"الرقم السري (PIN)"}),e.jsx(J,{type:"password",value:O,onChange:te=>P(te.target.value),placeholder:"****",autoFocus:!0,className:"text-center text-lg tracking-widest",maxLength:6,onKeyDown:te=>{te.key==="Enter"&&O&&z()}})]}),D===2&&e.jsxs("div",{className:"text-center bg-gray-50 dark:bg-slate-800 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"سيتم إرسال المبلغ:"}),e.jsx("p",{className:"text-2xl font-bold font-mono tracking-wider",children:c})]}),D===3&&e.jsxs("div",{className:"text-center bg-gray-50 dark:bg-slate-800 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"سيتم إرسال رقم المستقبل:"}),e.jsx("p",{className:"text-2xl font-bold font-mono tracking-wider",children:o})]}),D===4&&e.jsxs("div",{className:"text-center bg-gray-50 dark:bg-slate-800 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"تأكيد الرقم مرة أخرى:"}),e.jsx("p",{className:"text-2xl font-bold font-mono tracking-wider",children:o})]}),D===5&&e.jsxs("div",{className:"text-center bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-100 dark:border-green-900",children:[e.jsx("p",{className:"text-lg font-bold text-green-700 dark:text-green-400 mb-2",children:"جاهز للتأكيد"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"سيتم إرسال رقم 1 لتأكيد التحويل"})]})]}),e.jsxs(Oe,{children:[D===1&&e.jsx(I,{onClick:z,disabled:j||!O,className:"w-full bg-black hover:bg-neutral-800 text-white",children:j?e.jsx(zs,{className:"animate-spin h-4 w-4 mr-2"}):"إرسال الرقم السري"}),D===2&&e.jsx(I,{onClick:B,disabled:j,className:"w-full bg-black hover:bg-neutral-800 text-white",children:j?e.jsx(zs,{className:"animate-spin h-4 w-4 mr-2"}):"إرسال المبلغ"}),D===3&&e.jsx(I,{onClick:le,disabled:j,className:"w-full bg-black hover:bg-neutral-800 text-white",children:j?e.jsx(zs,{className:"animate-spin h-4 w-4 mr-2"}):"إرسال الرقم"}),D===4&&e.jsx(I,{onClick:re,disabled:j,className:"w-full bg-black hover:bg-neutral-800 text-white",children:j?e.jsx(zs,{className:"animate-spin h-4 w-4 mr-2"}):"تأكيد الرقم"}),D===5&&e.jsx(I,{onClick:U,disabled:j,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:j?e.jsx(zs,{className:"animate-spin h-4 w-4 mr-2"}):"تأكيد (1)"})]})]})})},wv=ae.lazy(()=>ne(()=>import("./index-CZwBW8vR.js").then(r=>r.cK),__vite__mapDeps([0,1]),import.meta.url).then(r=>({default:r.BranchRequestDialog}))),Nv=ae.lazy(()=>ne(()=>import("./WalletManagement-BU9BOeFr.js"),__vite__mapDeps([2,0,1,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),import.meta.url)),jv=ae.lazy(()=>ne(()=>import("./TransactionDetailsModal-DWJIvvJy.js"),__vite__mapDeps([18,0,1,19,4,3,14,11,20,16,17]),import.meta.url)),Sv=ae.lazy(()=>ne(()=>import("./ReceiptModal-CUVVTBKF.js"),__vite__mapDeps([21,0,1,19,4,10,3,22,17,20,23]),import.meta.url)),Gu=ae.lazy(()=>ne(()=>import("./EditBalanceDialog-KUSbAL4E.js"),__vite__mapDeps([24,0,1,14]),import.meta.url).then(r=>({default:r.EditBalanceDialog}))),Dv=ae.lazy(()=>ne(()=>import("./ChangePinDialog-DY8Ze77r.js"),__vite__mapDeps([25,0,1]),import.meta.url).then(r=>({default:r.ChangePinDialog}))),kv=ae.lazy(()=>ne(()=>import("./ChangeCashPinDialog-D8iQCRLF.js"),__vite__mapDeps([26,0,1,14]),import.meta.url).then(r=>({default:r.ChangeCashPinDialog}))),Cv=ae.lazy(()=>ne(()=>import("./ChangeWalletTotalPinDialog-5tYWf41W.js"),__vite__mapDeps([27,0,1,5]),import.meta.url).then(r=>({default:r.ChangeWalletTotalPinDialog}))),Iv=ae.lazy(()=>ne(()=>import("./index-CZwBW8vR.js").then(r=>r.cI),__vite__mapDeps([0,1]),import.meta.url)),aa=ae.lazy(()=>ne(()=>import("./index-CZwBW8vR.js").then(r=>r.cJ),__vite__mapDeps([0,1]),import.meta.url)),_v=ae.lazy(()=>ne(()=>import("./AddToWalletDialog-DOOUUUvQ.js"),__vite__mapDeps([28,0,1]),import.meta.url).then(r=>({default:r.AddToWalletDialog}))),Av=ae.lazy(()=>ne(()=>import("./CalculatorDialog-D7rvp9uf.js"),__vite__mapDeps([29,0,1,19,4]),import.meta.url).then(r=>({default:r.CalculatorDialog}))),Tv=ae.lazy(()=>ne(()=>import("./SalesDataDialog-Ckw-kGqN.js"),__vite__mapDeps([30,0,1,31,3,32,33,4,34,10,35,12,36,14,11,37,20,38,8,13,16,39,40,7,41,17,42,43,44,45,46,47,48,19,5,6]),import.meta.url).then(r=>({default:r.SalesDataDialog}))),Pv=ae.lazy(()=>ne(()=>import("./CashSummaryDialog-BjljNQCE.js"),__vite__mapDeps([49,0,1,14,19,4,50,39,40,7,41,16,17,37,36,42,8,3,32,33,34,43,44,45,46,47,11,48,5,20,6]),import.meta.url).then(r=>({default:r.CashSummaryDialog}))),Ev=ae.lazy(()=>ne(()=>import("./CreditCardsDialog-Bud6dwHH.js"),__vite__mapDeps([51,0,1,17,38,11,14]),import.meta.url)),Ov=ae.lazy(()=>ne(()=>import("./InstallmentModal-CsKS9UTM.js"),__vite__mapDeps([52,0,1,3,11]),import.meta.url)),Mv=ae.lazy(()=>ne(()=>import("./SimCardsDialog-Dk2f3tEb.js"),__vite__mapDeps([53,0,1,35,41,31,4,16,19,32,33,54,37]),import.meta.url).then(r=>({default:r.SimCardsDialog}))),Rv=ae.lazy(()=>ne(()=>import("./AdslCardsDialog-CqVtVE8d.js"),__vite__mapDeps([55,0,1,41,31,54,19,4,32,33,37]),import.meta.url).then(r=>({default:r.AdslCardsDialog}))),Wv=ae.lazy(()=>ne(()=>import("./MaintenanceDialog-Dbu_6lr7.js"),__vite__mapDeps([56,0,1,3,10,47,36,17]),import.meta.url).then(r=>({default:r.default}))),Lv=ae.lazy(()=>ne(()=>import("./MachineDailyDialog-DZzSVmtZ.js"),__vite__mapDeps([57,0,1,3,10,35,4,11]),import.meta.url)),Fv=ae.lazy(()=>ne(()=>import("./WalletsManagement-CB1iQn8-.js"),__vite__mapDeps([58,0,1,3,9,4,59,41,22,20,5,8,37,23,7]),import.meta.url).then(r=>({default:r.WalletsManagement}))),Bv=ae.lazy(()=>ne(()=>import("./WalletsListDialog-CMaqV3ja.js"),__vite__mapDeps([60,0,1,4,5,61]),import.meta.url).then(r=>({default:r.WalletsListDialog}))),Xu=ae.lazy(()=>ne(()=>import("./WalletPrinterDialog-D1JFk5sw.js"),__vite__mapDeps([59,0,1,41,22,20,5,8,37,23]),import.meta.url)),$v=ae.lazy(()=>ne(()=>import("./CashierShiftModal-Cd-Pbsqj.js"),__vite__mapDeps([62,0,1,4,63]),import.meta.url)),Uv=ae.lazy(()=>ne(()=>import("./ShiftProfileDialog-DDkjfNzd.js"),__vite__mapDeps([64,0,1]),import.meta.url)),Vv=ae.lazy(()=>ne(()=>import("./ChangeLogDialog-Cb2F-pE-.js"),__vite__mapDeps([65,0,1,66]),import.meta.url));function qv({userId:r}){const[t,n]=ae.useState(null),[o,c]=ae.useState("");return null}const zv=()=>{var cu,du,uu,mu,hu,fu,gu;console.log("🔥 UserDashboardPage component is loading...");const{signOut:r,user:t,profile:n,userData:o}=El(),c=((t==null?void 0:t.email)||"").toLowerCase()==="vodafonecash00@gmail.com",h=am(),x=hg(),N=fg(),{isShiftActive:D,shiftUser:S}=gg(),{shopId:j,shopName:T}=rm(),O=pg(),P=xg(),{toast:p}=Si(),z=u.useRef(null),[B,le]=u.useState(0),[re,U]=u.useState(!1),[te,ve]=u.useState(!1),[we,Z]=u.useState(!1),V=(a,s)=>{if(D&&(S!=null&&S.permissions)&&S.permissions[a]===!1){ve(!0);return}s()},Se=()=>{const a=(o==null?void 0:o.simSubscription)||(t==null?void 0:t.simSubscription);let s=!1;a!=null&&a.active&&(a!=null&&a.endsAt)&&(a.endsAt.seconds?new Date(a.endsAt.seconds*1e3):new Date(a.endsAt))>new Date&&(s=!0),s?_n(!0):yt(!0)},[Re,Fe]=u.useState(!1),[Ge,yt]=u.useState(!1),[Zt,We]=u.useState(!1),[Ye,Q]=u.useState(!1),[G,ft]=u.useState(!1),[gt,Ve]=u.useState(!1),X=u.useRef(!1),[M,se]=u.useState(()=>{try{const a=Object.keys(localStorage).find(i=>i.startsWith("wallets_")),s=a?localStorage.getItem(a):null;if(s){const i=JSON.parse(s);if(Array.isArray(i))return i}}catch{}return[]}),[Be,Ke]=u.useState([]);u.useEffect(()=>{var a;(a=h.state)!=null&&a.openProfileSettings&&(U(!0),window.history.replaceState({},document.title))},[h.state]),u.useEffect(()=>{if(t!=null&&t.uid){const a=`linesPinEnabled_${t.uid}`;if((localStorage.getItem(a)??localStorage.getItem("linesPinEnabled"))==="true"&&Q(!0),o&&o.linesPinEnabled!==void 0){const i=o.linesPinEnabled;Q(i),localStorage.setItem(a,i?"true":"false")}}},[t==null?void 0:t.uid,o]);const Sa=async()=>{var i,l,d;const a="alkaptin678678@gmail.com",s=(l=(i=Ys.currentUser)==null?void 0:i.email)==null?void 0:l.toLowerCase();if(!s||s!==a){p({title:"قيد التطوير",description:"هذه الميزة غير متاحة حالياً."});return}if(!Yn||!Kn||!Jn){p({title:"بيانات ناقصة",description:"أدخل رقم الموبايل، الشركة والمبلغ",variant:"destructive"});return}try{Rd(!0);const m=await((d=Ys.currentUser)==null?void 0:d.getIdToken()),f=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...m?{Authorization:`Bearer ${m}`}:{}},body:JSON.stringify({phone:Yn,countryCode:"EG",operator:Kn,amount:Number(Jn),useLocalAmount:!0})}),g=await f.json().catch(()=>({}));f.ok&&(g!=null&&g.success)?(p({title:"تم الشحن",description:(g==null?void 0:g.message)||"تم تنفيذ عملية الشحن بنجاح"}),zo(!1),Pd(""),Ed(""),Od("")):p({title:"فشل الشحن",description:(g==null?void 0:g.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(m){console.error("Topup request error:",m),p({title:"خطأ غير متوقع",description:"تعذّر تنفيذ عملية الشحن. حاول لاحقاً.",variant:"destructive"})}finally{Rd(!1)}};(()=>{try{return!!window.electronAPI||typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("electron")||typeof window<"u"&&window.location&&window.location.protocol==="file:"}catch{return!1}})();const[ct,Ft]=u.useState(!1),[rn,er]=u.useState(!1),[Da,nn]=u.useState(!1),[on,Ra]=u.useState(!1),[Wa,La]=u.useState(!1),[eh,tr]=u.useState(!1),[ar,Ii]=u.useState([]),[Jl,_i]=u.useState(""),[Hl,Ai]=u.useState(""),[Ql,Ti]=u.useState(""),[Gl,Pi]=u.useState(""),[Ei,ln]=u.useState(!1),[th,Oi]=u.useState(!1),[ah,Yv]=u.useState(null),[Xl,Zl]=u.useState(""),[ec,tc]=u.useState(""),[sh,ac]=u.useState(!1),[rh,cn]=u.useState(!1),[nh,sc]=u.useState(!1),[At,ih]=u.useState(null),[bs,rc]=u.useState(!1),[nc,oh]=u.useState(!1),[pt,lh]=u.useState(null);u.useEffect(()=>{yg().then(lh).catch(()=>{})},[]);const[ic,ch]=u.useState(void 0);u.useEffect(()=>{try{const a=window.electronAPI;a&&typeof a.appVersion=="function"&&a.appVersion().then(s=>{typeof s=="string"&&!s.startsWith("err:")&&ch(s)}).catch(()=>{})}catch{}},[]);const oc=(()=>{var i,l;const a=(l=(i=import.meta)==null?void 0:i.env)==null?void 0:l.VITE_APP_VERSION,s=typeof window<"u"&&(window.electronAPI||window.location.protocol==="file:"||typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("electron"));if(s&&(n!=null&&n.desktopInstalledVersion))return n==null?void 0:n.desktopInstalledVersion;if(s&&ic)return ic;if(a)return a;if(!(!pt&&!n))return P?(n==null?void 0:n.androidInstalledVersion)||(n==null?void 0:n.lastAckAndroidVersion)||(pt==null?void 0:pt.androidVersion)||(pt==null?void 0:pt.pcVersion):(pt==null?void 0:pt.pcVersion)||(pt==null?void 0:pt.androidVersion)})();u.useEffect(()=>{Wa&&(t!=null&&t.uid)&&!nc&&(async()=>{ln(!0);try{let s=[],i=[];try{const f=de($,"users",t.uid,"branches");s=(await De(f)).docs.map(v=>({id:v.id,...v.data(),source:"sub"}))}catch(f){console.warn("Failed to fetch subcollection branches:",f)}try{const f=Te(de($,"branches"),K("ownerId","==",t.uid));i=(await De(f)).docs.map(v=>({id:v.id,...v.data(),source:"root"}))}catch(f){console.warn("Failed to fetch root branches:",f)}const l=[...s,...i],d=new Map;l.forEach(f=>{const g=f.branchUserId||f.id;(!d.has(g)||f.source==="sub")&&d.set(g,f)});const m=Array.from(d.values());console.log("Loaded branches:",m),Ii(m),oh(!0)}catch(s){console.error("Error in branch loading process:",s),p({title:"تنبيه",description:"حدث خطأ أثناء تحديث القائمة",variant:"destructive"})}finally{ln(!1)}})()},[Wa,t==null?void 0:t.uid,nc]),u.useEffect(()=>{Wa||rc(!1)},[Wa]);const[dh,dn]=u.useState(!1),[lc,cc]=u.useState(!1),[vs,uh]=u.useState(null),[un,dc]=u.useState(""),[mn,uc]=u.useState(""),[mh,hh]=u.useState(""),[mc,hc]=u.useState(!1),fh=a=>{uh(a),dc(a.branchName||""),uc(a.managerName||""),hh(a.loginUsername||a.email||a.username||""),dn(!0)},gh=async()=>{if(!(!vs||!un||!mn)){hc(!0);try{const a={branchName:un,managerName:mn,updatedAt:new Date};if(vs.branchUserId)try{await Gt(Ae($,"users",(t==null?void 0:t.uid)||"","branches",String(vs.branchUserId)),a,{merge:!0});try{await ta(Ae($,"users",vs.branchUserId),{displayName:un,managerName:mn})}catch(s){console.warn("Could not update branch root user doc",s)}}catch(s){console.warn("Sub branch update failed:",s)}try{await ta(Ae($,"branches",vs.id),a)}catch{}Ii(s=>s.map(i=>i.id===vs.id?{...i,...a}:i)),p({title:"تم تحديث بيانات الفرع بنجاح"}),dn(!1)}catch(a){console.error("Error updating branch:",a),p({title:"فشل تحديث البيانات",description:a.message,variant:"destructive"})}finally{hc(!1)}}},ph=async a=>{if(!(a!=null&&a.branchUserId)){p({title:"خطأ",description:"بيانات الفرع غير مكتملة",variant:"destructive"});return}sc(!0),cn(!0);try{const s=a.branchUserId;if(t!=null&&t.uid&&a.branchUserId&&a.source!=="sub")try{await Gt(Ae($,"users",t.uid,"branches",a.branchUserId),{branchUserId:a.branchUserId,branchName:a.branchName||"Unknown Branch",managerName:a.managerName||"",active:!0,lastSynced:ht()},{merge:!0}),console.log("✅ Branch link synced successfully"),await new Promise(Ie=>setTimeout(Ie,500))}catch(Ie){console.error("❌ Failed to sync branch link:",Ie)}const[i,l,d,m]=await Promise.all([ua(Ae($,"users",s)),(async()=>{try{const Ie=Te(de($,"merchantWallets"),K("merchantUserId","==",s)),he=await De(Ie);if(!he.empty)return he;const at=await De(de($,"users",s,"wallets"));return at.empty?await De(Te(de($,"wallets"),K("userId","==",s))):at}catch(Ie){console.error("Error fetching wallets",Ie);try{return await De(Te(de($,"wallets"),K("userId","==",s)))}catch{return{docs:[]}}}})(),(async()=>{try{return await De(Te(de($,"debts"),K("userId","==",s)))}catch{return await De(de($,"users",s,"debts"))}})(),(async()=>{try{const Ie=Te(de($,"dailySales"),K("userId","==",s)),he=await De(Ie);return he.empty?await De(de($,"users",s,"dailySales")):he}catch(Ie){return console.error("Error fetching sales",Ie),await De(de($,"users",s,"dailySales"))}})()]),f=i.exists()?i.data():{},g=Number(f.cashBalance||0),v=f.reportsData||{},y=Number(v.dailyProfit||0),b=Number(v.monthlyProfit||0),w=f.walletBalances||{},C=l.docs.filter(Ie=>Ie.data().isActive===!0),k=new Set(C.map(Ie=>Ie.id));let A=0;k.size>0&&(A=Object.entries(w).filter(([Ie])=>k.has(Ie)).reduce((Ie,[he,at])=>Ie+Number(at||0),0)),A===0&&C.length>0&&(A=C.reduce((Ie,he)=>Ie+Number(he.data().balance||he.data().amount||0),0));let L=0;d.forEach(Ie=>{const he=Ie.data();if(he.type!=="debtor"){const at=Number(he.paidAmount||0),mt=Math.max(0,Number(he.amount||0)-at);L+=mt}});const E=new Date().toISOString().split("T")[0],q=E.slice(0,7);let ie=0,ee=0,Ce=y,et=b,tt=0;console.log(`Branch Details - UID: ${s}, Wallets: ${l.size}, Sales: ${m.size}, ReportsDaily: ${y}`),m.forEach(Ie=>{const he=Ie.data(),at=String(he.date||""),mt=Number(he.sellingPrice||0)*Number(he.quantity||1),ot=Number(he.profit||0);tt+=mt,at===E&&(ie+=mt,Ce+=ot),at.startsWith(q)&&(ee+=mt,et+=ot)}),ih({branchName:a.branchName,managerName:a.managerName,todaySales:ie,monthSales:ee,todayProfit:Ce,monthProfit:et,walletsTotal:A,cashBalance:g,totalSalesSection:tt,debtsTotal:L})}catch(s){console.error("Error fetching branch details:",s),p({title:"تعذر تحميل بيانات الفرع",description:s.message,variant:"destructive"}),cn(!1)}finally{sc(!1)}},[W,sr]=u.useState("");u.useEffect(()=>{const a=N==null?void 0:N.shopId;if(a&&(t!=null&&t.uid))try{const s=`selectedShopId_${t.uid}`;localStorage.setItem(s,String(a)),window.dispatchEvent(new Event("selectedShopIdChanged"))}catch{}},[N==null?void 0:N.shopId,t==null?void 0:t.uid]);const[Mi,xh]=u.useState([]),[ts,as]=u.useState(()=>{try{return localStorage.getItem("cashySelectedDevice")||null}catch{return null}});u.useEffect(()=>{},[]),u.useEffect(()=>{(async()=>{if(W)try{await $r.set({key:"selected_wallet_id",value:W}),console.log("📱 Synced selected_wallet_id to Native:",W)}catch(s){console.error("Failed to sync wallet to native:",s)}else await $r.remove({key:"selected_wallet_id"})})()},[W]),u.useEffect(()=>{(async()=>{if(j)try{await $r.set({key:"shopId",value:j}),console.log("📱 Synced shopId to Native:",j)}catch(s){console.error("Failed to sync shopId to native:",s)}})()},[j]);const Ri=a=>!!(a&&Mi.some(s=>s.id===a));async function Wi(){const a=window.electronAPI,s=ts||"";if(!a||typeof a.sendUssd!="function")return null;if(!s)return p({title:"الجهاز غير محدد",description:"اتصل بالموبايل أولاً ثم اختر الجهاز من القائمة",variant:"destructive"}),null;if(Ri(s))return s;try{const m=Mi.find(f=>f&&f.id&&!String(f.id).includes(":"));if(m&&m.id)return as(m.id),m.id}catch{}const i=s.includes(":")?s.split(":").slice(0,2).join(":"):"";if(i&&typeof a.connectWifi=="function"){try{const m=await a.connectWifi(i);if(typeof m=="string"&&(m.includes("✅")||m.toLowerCase().includes("connected")))return s}catch{}if(typeof a.refreshAdbDevices=="function")try{await a.refreshAdbDevices()}catch{}await new Promise(m=>setTimeout(m,250))}const l=s.split(":")[0],d=Mi.find(m=>(m.id.startsWith(l)||m.id.includes(l))&&m.id.includes(":"));if(d!=null&&d.id){const m=d.id.split(":").slice(0,2).join(":");if(!Ri(d.id)&&typeof a.connectWifi=="function"){try{const f=await a.connectWifi(m);if(typeof f=="string"&&(f.includes("✅")||f.toLowerCase().includes("connected")))return as(d.id),d.id}catch{}await new Promise(f=>setTimeout(f,250))}if(Ri(d.id))return as(d.id),d.id}return s&&i?s:(p({title:"الجهاز غير متصل",description:"فعّل Wireless debugging أو استخدم اتصال Wi‑Fi ثم أعد المحاولة",variant:"destructive"}),null)}u.useEffect(()=>{const a=window.electronAPI;a&&typeof a.onAdbDevices=="function"&&a.onAdbDevices(s=>{var m;const i=Array.isArray(s)?s:[];xh(i);const l=(()=>{try{return localStorage.getItem("cashySelectedDevice")||""}catch{return""}})();if(l&&i.some(f=>f.id===l))as(l);else{const f=l?String(l).split(":")[0]:"",g=f?i.find(v=>(v.id.startsWith(f)||v.id.includes(f))&&String(v.type||"").toLowerCase().includes("wifi")):void 0;g!=null&&g.id?as(g.id):!l&&((m=i[0])!=null&&m.id)?as(v=>v||i[0].id):i.length||as(null)}})},[]);function yh(a,s){try{const i=nt==null?void 0:nt(),l=(i==null?void 0:i.phone)||"";if(!l){p({title:"يجب اختيار محفظة",description:"اختر محفظة المُرسل أولاً",variant:"destructive"});return}if(P&&l.startsWith("011")){pl("*777*1#"),p({title:"تم إرسال كود التحويل",description:"تم طلب كود اتصالات *777*1#"}),ia(!1),Ca(!1);return}Rg(l,a,s),p({title:"تم إرسال كود التحويل",description:"تم تنفيذ الاتصال مباشرة على الهاتف"}),ia(!1),Ca(!1)}catch(i){const l=(i==null?void 0:i.message)||"تعذر إرسال الكود — تحقق من البيانات";throw p({title:"فشل الإرسال",description:l,variant:"destructive"}),i}}const[Bt,Li]=u.useState(null),bh=async()=>{var f;if(!ut||!ut.receiver||!ut.amount){p({title:"بيانات غير مكتملة",description:"تأكد من إدخال رقم المستقبل والمبلغ قبل الإرسال",variant:"destructive"});return}const a=String(ut.receiver),s=Math.round(Number(ut.amount));oa(!0);const i=nt==null?void 0:nt(),l=(i==null?void 0:i.phone)||"",d=Mg(l),m=window.electronAPI;if(d==="etisalat"&&l.startsWith("011")&&m&&typeof m.sendUssd=="function"&&ts){try{const g=await Wi();if(!g){oa(!1);return}let v=g;Bt!==null&&(v=`${g}:sim${Bt}`),bo(v),await m.sendUssd(v,"*777*1#"),Qc(!0),ia(!1)}catch(g){console.error("Etisalat flow init error",g),p({title:"خطأ",description:"فشل بدء تحويل اتصالات: "+(g.message||""),variant:"destructive"})}finally{oa(!1)}return}if(d==="orange"&&l.startsWith("012")&&m&&typeof m.sendUssd=="function"&&ts){try{const g=await Wi();if(!g){oa(!1);return}const v=`*7115*7*${a}*${s}#`;let y=g;Bt!==null&&(y=`${g}:sim${Bt}`),bo(y),await m.sendUssd(y,v),Ca(!0),ia(!1)}catch(g){console.error("Orange flow init error",g),p({title:"خطأ",description:"فشل بدء تحويل أورنج: "+(g.message||""),variant:"destructive"})}finally{oa(!1)}return}try{if((f=wi)!=null&&f.isNativePlatform&&wi.getPlatform()==="android"){const v=nt==null?void 0:nt(),y=(v==null?void 0:v.phone)||"";if(!y){p({title:"يجب اختيار محفظة",description:"اختر محفظة المُرسل أولاً",variant:"destructive"}),oa(!1);return}if(y.startsWith("011")){pl("*777*1#",Bt===0?"sim1":Bt===1?"sim2":void 0),p({title:"تم الاتصال",description:"تم طلب كود اتصالات *777*1#"}),ia(!1),Ca(!1);return}const b=Cu(y,a,s);if(!b){p({title:"رقم غير مدعوم",description:"تحقق من بداية الرقم 010/011/012/015",variant:"destructive"}),oa(!1);return}pl(b,Bt===0?"sim1":Bt===1?"sim2":void 0),p({title:"تم إرسال كود التحويل",description:"تم تنفيذ الاتصال مباشرة على الهاتف"}),ia(!1),Ca(!1);return}const g=window.electronAPI;if(g&&typeof g.sendUssd=="function"&&ts){const v=nt==null?void 0:nt(),y=(v==null?void 0:v.phone)||"";if(!y){p({title:"يجب اختيار محفظة",description:"اختر محفظة المُرسل أولاً",variant:"destructive"}),oa(!1);return}const b=await Wi();if(!b){oa(!1);return}const w=Cu(y,a,s);if(!w){p({title:"رقم غير مدعوم",description:"تحقق من بداية الرقم 010/011/012/015",variant:"destructive"}),oa(!1);return}try{let C="";if(Bt!==null)C=`${b}:sim${Bt}`;else{const k=typeof g.pickSimAutomatically=="function"?await g.pickSimAutomatically(b,y):{deviceId:b,slot:0};C=`${k.deviceId}:sim${k.slot}`}bo(C),await g.sendUssd(C,w)}catch{try{await g.sendUssd(b,w)}catch(k){const A=b.includes(":")?b.split(":").slice(0,2).join(":"):"";if(A&&typeof g.connectWifi=="function")await g.connectWifi(A),await g.sendUssd(b,w);else throw k}}p({title:"تم إرسال كود التحويل",description:"تم التنفيذ بنجاح"}),ia(!1),Ca(!0)}else yh(a,s)}catch(g){const v=g&&g.message?g.message:"حدث خطأ غير متوقع أثناء الإرسال";p({title:"خطأ أثناء الإرسال",description:`الجهاز: ${yo||ts||"غير معروف"} — ${v}`,variant:"destructive"})}finally{oa(!1)}},vh=async(a,s)=>{const i=window.electronAPI;try{if(i&&typeof i.enterPin=="function"&&a){await i.enterPin(a,s),Ca(!1);return}const l=String((n==null?void 0:n.bridgeLink)||"").trim(),d=String((n==null?void 0:n.bridgeDeviceId)||"").trim()||void 0;if(!l){p({title:"الرابط غير مُعدّ",description:"احفظ رابط الجسر أولاً",variant:"destructive"});return}const m=String((ut==null?void 0:ut.receiver)||jt||"").replace(/\D/g,""),f=Math.max(1,Math.round(Number((ut==null?void 0:ut.amount)||xt||0))||0),g=String(s||"").replace(/\D/g,""),y=(b=>{let w=(b||"").trim();return w=w.replace(/\/+$/,""),/^https?:\/\//i.test(w)||(w=`https://${w}`),w})(l);Ca(!1)}catch(l){const d=(l==null?void 0:l.message)||"حدث خطأ أثناء إدخال الرقم السري";p({title:"فشل الإدخال",description:d,variant:"destructive"})}};console.log("🔥 UserDashboardPage - user:",t?"exists":"null");const[rr,Fa]=u.useState(!0),[Fi,nr]=u.useState(!0),[wh,ss]=u.useState(!1),[Nh,ws]=u.useState(!1),[hn,fc]=u.useState(""),[Bi,gc]=u.useState(""),[$i,pc]=u.useState(""),[fn,Ui]=u.useState([]),[jh,gn]=u.useState(!1),[wt,ir]=u.useState(null),[Ns,Vi]=u.useState(""),[Kv,Jv]=u.useState(!1),[Sh,qi]=u.useState(!1),[Dh,Ba]=u.useState(!1),[kh,or]=u.useState(!1),[lr,zi]=u.useState(""),[xc,Yi]=u.useState(""),[yc,js]=u.useState([]),[Ch,pn]=u.useState(!1),[Ki,Ss]=u.useState({}),[xn,yn]=u.useState(null),[bc,cr]=u.useState(""),[vc,dr]=u.useState(""),[Hv,wc]=u.useState(!1),[Qv,Nc]=u.useState(0),[Gv,jc]=u.useState(!1),[Tt,Sc]=u.useState(null),[Nt,Ih]=u.useState(null),[Xv,Dc]=u.useState(!1),[Yt,Ds]=u.useState(""),[jt,ur]=u.useState(""),[xt,ks]=u.useState(""),[rs,kc]=u.useState(""),[mr,Cc]=u.useState(""),[Ji,Cs]=u.useState(!1),[Hi,Qi]=u.useState(""),[_h,ns]=u.useState(""),[Ic,_c]=u.useState(""),[Gi,Ah]=u.useState(""),[sa,Xi]=u.useState(null),[Th,Ac]=u.useState(!1),[Ph,Tc]=u.useState(!1),[Eh,bn]=u.useState(!1),[Oh,Zi]=u.useState(!1),[Pc,eo]=u.useState(null),[dt,vn]=u.useState(""),[St,wn]=u.useState(""),[Ec,Mh]=u.useState(""),[Rh,Oc]=u.useState(!1),[Zv,ew]=u.useState(null),[to,Mc]=u.useState(null),[Wh,ao]=u.useState(!1);u.useEffect(()=>{(async()=>{try{const s=t!=null&&t.uid?`withdrawSenderNameInputEnabled_${t==null?void 0:t.uid}`:"withdrawSenderNameInputEnabled";let i=null;try{i=localStorage.getItem(s)??localStorage.getItem("withdrawSenderNameInputEnabled")}catch{}if(t!=null&&t.uid)try{const l=await ms(()=>oe.getUserData(t.uid)),d=l==null?void 0:l.withdrawSenderNameInputEnabled;if(typeof d=="boolean"){ao(d);try{localStorage.setItem(s,d?"true":"false")}catch{}return}}catch{}ao(i==="true")}catch{ao(!1)}})()},[t==null?void 0:t.uid]),u.useEffect(()=>{try{const a=`clientNumberAssignments_${(t==null?void 0:t.uid)||"default"}`,s=localStorage.getItem(a);if(!s){Ss({});return}const i=JSON.parse(s);if(i&&typeof i=="object"){const l={};Object.entries(i).forEach(([d,m])=>{if(typeof m=="string")l[d]={name:m,amount:""};else if(m&&typeof m=="object"){const f=m,g=typeof f.name=="string"?f.name:"",v=typeof f.amount=="string"||typeof f.amount=="number"?String(f.amount):"";(g||v)&&(l[d]={name:g,amount:v})}}),Ss(l)}else Ss({})}catch{Ss({})}},[t==null?void 0:t.uid]);const hr=a=>{const s="٠١٢٣٤٥٦٧٨٩",i="۰۱۲۳۴۵۶۷۸۹";return(a||"").split("").map(l=>{const d=s.indexOf(l);if(d>-1)return String(d);const m=i.indexOf(l);return m>-1?String(m):l}).join("")},[Je,Lh]=u.useState(!0),so=ae.useMemo(()=>{if((n==null?void 0:n.transferFeesEnabled)!==void 0)return n.transferFeesEnabled;try{const a=t!=null&&t.uid?`transferFeesEnabled_${t.uid}`:"transferFeesEnabled";return(localStorage.getItem(a)??localStorage.getItem("transferFeesEnabled"))!=="false"}catch{return!0}},[n,t==null?void 0:t.uid]),[F,ro]=u.useState("transfer"),Fh=ae.useMemo(()=>{const a=hr(Yt||"").replace(/\D/g,""),s=hr(jt||"").replace(/\D/g,"");return!so||F!=="transfer"?!1:a.startsWith("010")&&s.startsWith("010")||a.startsWith("010")&&(s.startsWith("011")||s.startsWith("012")||s.startsWith("015"))||a.startsWith("012")&&s.startsWith("010")||a.startsWith("011")&&s.startsWith("010")||a.startsWith("015")&&s.startsWith("010")},[Yt,jt,so,F]),[ue,$t]=u.useState([]),[ra,Nn]=u.useState("all"),[Pe,Ut]=u.useState([]),[no,Bh]=u.useState(!1),[io,$h]=u.useState([]),[Is,Uh]=u.useState(new Date().toISOString().split("T")[0]),[is,Rc]=u.useState("day");u.useEffect(()=>{if(!no||!(t!=null&&t.uid))return;(async()=>{try{let s;if(is==="day"){const d=new Date(Is);d.setHours(0,0,0,0);const m=new Date(Is);m.setHours(23,59,59,999),s=Te(de($,"debtReceipts"),K("userId","==",t.uid),K("createdAt",">=",d),K("createdAt","<=",m),gl("createdAt","desc"))}else{const[d,m]=Is.split("-").map(Number),f=new Date(d,m-1,1),g=new Date(d,m,0,23,59,59,999);s=Te(de($,"debtReceipts"),K("userId","==",t.uid),K("createdAt",">=",f),K("createdAt","<=",g),gl("createdAt","desc"))}const l=(await De(s)).docs.map(d=>({id:d.id,...d.data()}));$h(l)}catch(s){console.error("Error fetching debt receipts:",s),p({title:"خطأ",description:"تعذر تحميل سجل السداد",variant:"destructive"})}})()},[no,t==null?void 0:t.uid,Is,is]);const ka=u.useRef([]),[oo,lo]=u.useState(!1),[$a,Vh]=u.useState(""),[jn,qh]=u.useState("daily"),[Ua,zh]=u.useState(""),[_s,fr]=u.useState(null),Yh=a=>{if(!a){fr(null);return}const s=new Date(a),i=new Date(s.setHours(0,0,0,0)),l=new Date(s.setHours(23,59,59,999)),d=ue.filter(b=>{const w=new Date(b.createdAt);return w>=i&&w<=l});let m=0,f=0,g=0,v=0,y=0;d.forEach(b=>{m++,f+=Number(b.amount||0);const w=(b.type||b.txnType||"").toLowerCase(),C=w==="machine_withdrawal"||b.title==="إيصال سحب فوري";!C&&(w==="withdraw"||w==="withdrawal"||w==="receive")?g+=Number(b.amount||0):!C&&(w==="send"||w==="transfer")&&(v+=Number(b.amount||0)),y+=ba.calculateProfitFromTransaction(b)}),fr({count:m,totalAmount:f,totalWithdrawn:g,totalSent:v,totalProfit:y})},Kh=a=>{if(!a){fr(null);return}const[s,i]=a.split("-"),l=Number(s),d=Number(i)-1,m=new Date(l,d,1,0,0,0,0),f=new Date(l,d+1,0,23,59,59,999),g=ue.filter(k=>{const A=new Date(k.createdAt),L=String(k.status||k.status||"completed").toLowerCase();return A>=m&&A<=f&&(L==="completed"||L==="confirmed")});let v=0,y=0,b=0,w=0,C=0;g.forEach(k=>{v++,y+=Number(k.amount||0);const A=(k.type||k.txnType||"").toLowerCase(),L=A==="machine_withdrawal"||k.title==="إيصال سحب فوري";!L&&(A==="withdraw"||A==="withdrawal"||A==="receive")?b+=Number(k.amount||0):!L&&(A==="send"||A==="transfer")&&(w+=Number(k.amount||0)),C+=ba.calculateProfitFromTransaction(k)}),fr({count:v,totalAmount:y,totalWithdrawn:b,totalSent:w,totalProfit:C})};u.useEffect(()=>{oo&&(jn==="daily"&&$a?Yh($a):jn==="monthly"&&Ua?Kh(Ua):fr(null))},[$a,Ua,jn,ue,oo]);const gr=Jr({enabled:!!(t!=null&&t.uid),queryKey:["recentTransactions",t==null?void 0:t.uid,j||"main"],queryFn:async()=>{const{collection:a,query:s,where:i,orderBy:l,limit:d,getDocs:m}=await ne(async()=>{const{collection:_,query:E,where:q,orderBy:ie,limit:ee,getDocs:Ce}=await import("./index-CZwBW8vR.js").then(et=>et.cE);return{collection:_,query:E,where:q,orderBy:ie,limit:ee,getDocs:Ce}},__vite__mapDeps([0,1]),import.meta.url),{db:f}=await ne(async()=>{const{db:_}=await import("./index-CZwBW8vR.js").then(E=>E.cF);return{db:_}},__vite__mapDeps([0,1]),import.meta.url),g=s(a(f,"userTransactions"),i("userId","==",String((t==null?void 0:t.uid)||"")),l("createdAt","desc"),d(100)),b=(await m(g)).docs.map(_=>{var he;const E=_.data(),q=(he=E.createdAt)!=null&&he.toDate?E.createdAt.toDate():new Date(E.createdAt),ie=String(E.transactionType||E.txnType||E.type||"").toLowerCase();let ee="send";ie==="withdraw"||ie==="receive"?ee="withdraw":ie==="machine_withdrawal"?ee="machine_withdrawal":ie==="cash_addition"||ie==="add"?ee="cash_addition":ee="send";const Ce=E.status==="confirmed"?"completed":E.status||"completed",et=E.senderMsisdn||E.senderPhone||"",tt=E.receiverMsisdn||E.receiverPhone||"",Ie=Number(E.amount??E.transferredAmount??E.withdrawnAmount??0);return{id:_.id,...E,type:ee,status:Ce,senderPhone:et,receiverPhone:tt,amount:Ie,createdAt:q}}).filter(_=>!((_==null?void 0:_.type)==="report"||String((_==null?void 0:_.title)||"").includes("إيصال تسليم وردية"))),w=new Set((xr||[]).map(_=>String(_.id||_.originalTransactionId||""))),C=b.filter(_=>!w.has(String(_.id||""))),k=_=>{var E;return String(_.transactionId||_.id||_.reference||((E=_.receipt)==null?void 0:E.reference)||`${new Date(_.createdAt).getTime()}`)},A=new Set,L=[];for(const _ of C){const E=k(_);A.has(E)||(A.add(E),L.push(_))}return L},staleTime:6e4,gcTime:3e5,refetchOnWindowFocus:!1,refetchOnReconnect:!0});u.useEffect(()=>{const a=()=>{try{gr.refetch()}catch{}};return window.addEventListener("transaction-created",a),()=>{window.removeEventListener("transaction-created",a)}},[gr]),u.useEffect(()=>{const a=gr.data;if(a&&Array.isArray(a)){const s=ka.current,i=Date.now(),l=s.filter(g=>{const v=a.some(w=>w.id===g.id),y=g.reference?a.some(w=>w.reference===g.reference):!1,b=i-new Date(g.createdAt).getTime()>3e5;return!v&&!y&&!b});ka.current=l;const d=[...l,...a].sort((g,v)=>new Date(v.createdAt).getTime()-new Date(g.createdAt).getTime()),m=new Set,f=[];for(const g of d)m.has(g.id)||(m.add(g.id),f.push(g));$t(f)}},[gr.data]),u.useEffect(()=>{try{if(localStorage.setItem("commissionMode",Je?"add":"deduct"),t!=null&&t.uid){const a=`commissionMode_${t.uid}`;localStorage.setItem(a,Je?"add":"deduct")}}catch{}},[Je,t==null?void 0:t.uid]),u.useEffect(()=>{try{const a=new Set((ue||[]).filter(l=>String((l==null?void 0:l.status)||"")==="completed"&&(l==null?void 0:l.linkedDebtId)).map(l=>String(l.linkedDebtId)));if(a.size===0||Pe.length===0)return;const s=Pe.map(l=>{if(!a.has(String(l.id)))return l;const d=Number(l.amount||0),m=Number(l.paidAmount||0);return m>=d&&l.status!=="paid"?{...l,amount:d,paidAmount:d,status:"paid"}:m>d?{...l,amount:d,paidAmount:d}:l});if(s.some((l,d)=>l!==Pe[d])){Ut(s),(async()=>await Ia(s))();try{t!=null&&t.uid&&s.filter((d,m)=>d!==Pe[m]&&d.status==="paid").forEach(d=>{try{const m=Number(d.paidAmount||0),f=m>0?m:Number(d.amount||0);fs.send(t.uid,`تم سداد الدين بالكامل للعميل ${d.debtorName}: المدفوع ${f} جنيه`).catch(()=>{})}catch{}})}catch{}}}catch{}},[ue,Pe,t==null?void 0:t.uid]),u.useEffect(()=>{try{const a=t!=null&&t.uid?localStorage.getItem(`commissionMode_${t.uid}`):null,s=localStorage.getItem("commissionMode"),i=localStorage.getItem("commissionMode_default"),l=a??s??i;l&&Lh(l==="add")}catch{}},[t==null?void 0:t.uid]);const[co,As]=u.useState(!1),[Jh,Hh]=u.useState(null),Sn=ae.useRef(""),Wc=ae.useRef(0);u.useEffect(()=>{const a=s=>{var l;if(co)return;try{const d=document.activeElement;if(d){const m=(l=d.tagName)==null?void 0:l.toLowerCase();if(m==="input"||m==="textarea"||m==="select"||m==="button"||d.isContentEditable===!0)return}}catch{}const i=Date.now();if(s.key==="Enter"){const d=(Sn.current||"").trim();Sn.current="",d&&(Hh(d),As(!0));return}s.key.length===1&&(i-(Wc.current||0)>100&&(Sn.current=""),Sn.current+=s.key,Wc.current=i)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[co]);const[Qh,Gh]=u.useState(!1),[Xh,uo]=u.useState(!1),[Zh,tw]=u.useState(null);u.useEffect(()=>{if(!Ji)return;const a=nt(),s=parseFloat(xt||"0")||0;let i=0;if(F==="transfer"){if((a==null?void 0:a.defaultTransferCommission)!=null){const d=Number(a.defaultTransferCommission)||0;i=Math.round(d*s/1e3*100)/100}else{const d=St&&St.trim()!==""?parseFloat(St):0;i=Math.max(0,d)}const l=s+i;ns((l||0).toString())}else{if((a==null?void 0:a.defaultWithdrawCommission)!=null){const d=Number(a.defaultWithdrawCommission)||0;i=Math.round(d*s/1e3*100)/100}else{const d=dt&&dt.trim()!==""?parseFloat(dt):Math.round(s*.01*100)/100;i=Math.max(0,d)}const l=Je?s:Math.max(0,Math.round((s-i)*100)/100);ns((l||0).toString())}},[Ji,xt,St,dt,W,Je,F]);const nt=()=>{var s,i;let a=M.find(l=>l.id===W);if(!a)try{const l=localStorage.getItem($d());if(l){const d=JSON.parse(l);if(Array.isArray(d)&&d.length>0){const f=localStorage.getItem(ds())||((s=d.find(g=>g.isDefault))==null?void 0:s.id)||((i=d[0])==null?void 0:i.id);a=d.find(g=>g.id===f)}}}catch{}return a};u.useLayoutEffect(()=>{try{const a=`wallets_${(t==null?void 0:t.uid)||"default"}`;let s=localStorage.getItem(a);if(!s){const i=Object.keys(localStorage).find(l=>l.startsWith("wallets_"));i&&(s=localStorage.getItem(i)||null)}if(s){const i=JSON.parse(s);if(Array.isArray(i)&&i.length>0){se(i);const l=localStorage.getItem(ds()),d=l&&i.find(m=>m.id===l)||i.find(m=>m.isDefault)||i[0];d&&(sr(d.id),Ds(d.phone))}}}catch(a){console.error("تهيئة فورية للمحافظ من التخزين المحلي فشلت:",a)}},[]),u.useEffect(()=>{console.log("🔍 selectedWallet state changed to:",W)},[W]),u.useEffect(()=>{Fd()},[t==null?void 0:t.uid]),u.useEffect(()=>{g0()},[]);const Dn=Jr({enabled:!!(t!=null&&t.uid),queryKey:["wallets",t==null?void 0:t.uid],queryFn:async()=>{const{merchantWalletService:a}=await ne(async()=>{const{merchantWalletService:l}=await import("./index-CZwBW8vR.js").then(d=>d.cG);return{merchantWalletService:l}},__vite__mapDeps([0,1]),import.meta.url),s=await a.getByMerchantId(String((t==null?void 0:t.uid)||""));return(Array.isArray(s)?s:[]).filter(l=>l.isActive===!0).map(l=>({id:l.id,name:l.label||"محفظة بدون اسم",phone:l.msisdn,isDefault:!!l.isDefault,monthlyWithdrawalLimit:l.monthlyWithdrawalLimit??l.withdrawLimit??2e5,monthlyTransferLimit:l.monthlyTransferLimit??l.transferLimit??2e5,defaultTransferCommission:l.defaultTransferCommission!=null?Number(l.defaultTransferCommission):null,defaultWithdrawCommission:l.defaultWithdrawCommission!=null?Number(l.defaultWithdrawCommission):null}))},staleTime:6e4,gcTime:3e5,refetchOnReconnect:!0});u.useEffect(()=>{var s;const a=Dn.data;if(a&&Array.isArray(a)){se(a);const i=localStorage.getItem(ds());if(!!!(W&&a.find(d=>d.id===W))){const d=i&&a.find(m=>m.id===i)?i:((s=a[0])==null?void 0:s.id)||"";if(d){sr(d);const m=a.find(f=>f.id===d);Ds(String((m==null?void 0:m.phone)||""))}}}},[Dn.data]),u.useEffect(()=>{const a=s=>{const{cashBalance:i,walletBalances:l,newTransaction:d,limitUpdate:m,delta:f}=s.detail||{};if(f){const{amount:g,type:v,walletId:y,commission:b,totalDeducted:w}=f,C=Number(g||0),k=Number(b||0),A=Number(w||C+k);Xe(L=>{let _=0;v==="withdraw"?_=-C+k:v==="send"||v==="transfer"?_=C+k:v==="atm_withdraw"&&(_=C);const E=L+_;try{const q=qe();localStorage.setItem(q,String(E));const ie=new Date().toISOString();if(localStorage.setItem(q+"_lastUpdated",ie),t!=null&&t.uid){const ee=`userData_${t.uid}`,Ce=localStorage.getItem(ee),tt={...Ce?JSON.parse(Ce):{},cashBalance:E,lastUpdated:ie};localStorage.setItem(ee,JSON.stringify(tt)),ye(!0)}}catch{}return E}),y&&lt(L=>{const _=Number(L[y]||0);let E=0;v==="withdraw"?E=C:v==="send"||v==="transfer"?E=-C:v==="atm_withdraw"&&(E=-A);const q=_+E,ie={...L,[y]:q};try{const ee=Ze();localStorage.setItem(ee,JSON.stringify(ie));const Ce=new Date().toISOString();if(localStorage.setItem(ee+"_lastUpdated",Ce),t!=null&&t.uid){const et=`userData_${t.uid}`,tt=localStorage.getItem(et),he={...tt?JSON.parse(tt):{},walletBalances:ie,lastUpdated:Ce};localStorage.setItem(et,JSON.stringify(he)),ye(!0)}}catch{}return ie})}if(typeof i=="number"){Xe(i);try{const g=qe();localStorage.setItem(g,String(i));const v=new Date().toISOString();if(localStorage.setItem(g+"_lastUpdated",v),t!=null&&t.uid){const y=`userData_${t.uid}`,b=localStorage.getItem(y),C={...b?JSON.parse(b):{},cashBalance:i,lastUpdated:v};localStorage.setItem(y,JSON.stringify(C)),ye(!0)}}catch{}}if(l&&typeof l=="object"){lt(l);try{const g=Ze();localStorage.setItem(g,JSON.stringify(l));const v=new Date().toISOString();if(localStorage.setItem(g+"_lastUpdated",v),t!=null&&t.uid){const y=`userData_${t.uid}`,b=localStorage.getItem(y),C={...b?JSON.parse(b):{},walletBalances:l,lastUpdated:v};localStorage.setItem(y,JSON.stringify(C)),ye(!0)}}catch{}}if(m&&m.walletId===W&&Ws(g=>{if(!g)return g;const v=Number(m.amount||0),y=m.type==="transfer",b={...g};return y?(b.dailyTransferUsed=(b.dailyTransferUsed||0)+v,b.monthlyTransferUsed=(b.monthlyTransferUsed||0)+v):(b.dailyWithdrawUsed=(b.dailyWithdrawUsed||0)+v,b.monthlyWithdrawUsed=(b.monthlyWithdrawUsed||0)+v),b}),d){const g=d.type==="machine_withdrawal"||d.txnType==="machine_withdrawal",v=Vc.current||[];if(g&&v.find(b=>{if((b.type||b.txnType)!=="machine_withdrawal")return!1;const C=Number(b.amount)===Number(d.amount),k=b.senderName===d.senderName,A=new Date(b.createdAt).getTime(),L=new Date(d.createdAt||Date.now()).getTime(),_=Math.abs(L-A);return C&&k&&_<6e4})){console.log("Skipping duplicate machine withdrawal event (fuzzy match):",d);return}try{ka.current&&(ka.current.some(y=>y.id===d.id)||ka.current.push(d))}catch{}$t(y=>y.some(b=>b.id===d.id)?y:[d,...y]),p({title:"تم تسجيل عملية خارجية",description:"تم تحديث الأرصدة والسجلات بنجاح"});try{gr.refetch()}catch{}}};return window.addEventListener("dashboard:external-update",a),()=>window.removeEventListener("dashboard:external-update",a)},[W]);const[Lc,ef]=u.useState(""),Fc=(()=>{const a=Lc.replace(/\D/g,"");return a?M.filter(s=>(s.phone||"").replace(/\D/g,"").includes(a)):M})();u.useEffect(()=>{(async()=>{try{let s=[];if(t!=null&&t.uid)try{const i=await ms(()=>oe.getUserData(t.uid)),l=i==null?void 0:i.favoriteWalletIds;Array.isArray(l)&&(s=l.map(d=>String(d)))}catch{}if(!s.length)try{const i=t!=null&&t.uid?`favoriteWallets_${t.uid}`:"favoriteWallets",l=localStorage.getItem(i)??localStorage.getItem("favoriteWallets");if(l){const d=JSON.parse(l);Array.isArray(d)&&(s=d.filter(m=>typeof m=="string"))}}catch{}s.length&&Ke(s)}catch{Ke([])}})()},[t==null?void 0:t.uid]),u.useEffect(()=>{try{const a=t!=null&&t.uid?`favoriteWallets_${t.uid}`:"favoriteWallets";localStorage.setItem(a,JSON.stringify(Be)),t!=null&&t.uid&&oe.updateUserData(t.uid,{favoriteWalletIds:Be})}catch{}},[Be,t==null?void 0:t.uid]);const Bc=ae.useMemo(()=>{const a=new Set(Be);return[...Fc].sort((s,i)=>{const l=a.has(s.id),d=a.has(i.id);return l===d?0:l?-1:1})},[Fc,Be]),tf=a=>{Ke(s=>s.includes(a)?s.filter(i=>i!==a):[...s,a])},[af,aw]=u.useState(null),[sf,$c]=u.useState(!1),[rf,kn]=u.useState(!1),[nf,of]=u.useState(null),[sw,lf]=u.useState([]),[rw,nw]=u.useState([]),[cf,pr]=u.useState(!1),[mo,Uc]=u.useState("daily"),[xr,yr]=u.useState([]),[df,iw]=u.useState(!1),ga=ae.useRef(new Set);ae.useRef(new Set);const Vc=ae.useRef([]);u.useEffect(()=>{Vc.current=ue},[ue]);const ho=async a=>{try{if(!t)return;const s=qe(),i=Ze(),l=localStorage.getItem(s),d=localStorage.getItem(i);let m=l?parseFloat(l):$e,f=d?JSON.parse(d):{...Ne};const g=Number(a.withdrawnAmount??a.sentAmount??a.transferredAmount??a.amount??0);if(a.type==="send"&&(a.fromWallet||W)){m-=g;const w=a.fromWallet||W;f[w]=(f[w]||0)+g}else if(a.type==="withdraw"&&(a.fromWallet||W)){m+=g;const w=a.fromWallet||W;f[w]=Math.max(0,(f[w]||0)-g)}Xe(m),lt(f);const v=new Date().toISOString();localStorage.setItem(s,m.toString()),localStorage.setItem(s+"_lastUpdated",v),localStorage.setItem(i,JSON.stringify(f)),localStorage.setItem(i+"_lastUpdated",v);const y={cashBalance:m,walletBalances:f,lastUpdated:new Date().toISOString()},b=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(b,JSON.stringify(y));try{await oe.updateUserData(t.uid,y),localStorage.removeItem(b),ye(!1)}catch(w){console.warn("تعذر حفظ الأرصدة في Firebase بعد الحذف (مزامنة تلقائية):",w),ye(!0)}try{const w=a.fromWallet||W,C=a.type==="send"?"transfer":"withdraw";await Ma.rollbackUsage(w,g,C,a.createdAt)}catch(w){console.warn("تعذر تحديث حدود المحفظة بعد الحذف (مزامنة):",w)}try{_t.removeTransactionEffects(a,t.uid)}catch(w){console.warn("تعذر تحديث التقارير بعد الحذف (مزامنة):",w)}}catch(s){console.warn("خطأ أثناء تطبيق تأثيرات الحذف محليًا:",s)}},uf=async a=>{try{const s=ue.find(f=>f.id===a);if(!s||!t)return;const i=String(a),l=String((s==null?void 0:s.transactionId)||(s==null?void 0:s.reference)||""),d=ga.current.has(i)||l&&ga.current.has(l),m=ue.filter(f=>f.id!==a);$t(m);try{await oe.removeUserTransaction(t.uid,a),await Kr.permanentlyDeleteTransaction(a,t.uid)}catch(f){console.warn("تعذر الحذف النهائي من قواعد البيانات أثناء حذف الإيصال:",f)}if(!d){ga.current.add(i),l&&ga.current.add(l),await ho(s);try{t!=null&&t.uid&&oe.removeLocalReceiptById(t.uid,a)}catch{}}p({title:"تم الحذف نهائيًا",description:"تم حذف الإيصال نهائيًا وعكس تأثيراته على الأرصدة والحدود والتقارير."}),kn(!1)}catch(s){console.error("خطأ أثناء حذف الإيصال:",s),p({title:"خطأ في حذف الإيصال",description:"حدث خطأ غير متوقع أثناء الحذف.",variant:"destructive"})}},mf=async a=>{try{const s=ue.find(i=>i.id===a);if(!s||!t)return;try{const i=Tt==null?void 0:Tt.planType;if(i===Qt.ZERO){const{dailyOperationCountService:l}=await ne(async()=>{const{dailyOperationCountService:f}=await import("./dailyOperationCountService-Bsh4gYfW.js");return{dailyOperationCountService:f}},__vite__mapDeps([67,0,1]),import.meta.url),d=s.type==="send"?"transfer":"withdraw";if(!(await l.checkAndIncrement(t.uid,d,5)).allowed){p({title:"تم بلوغ حد باقة الزيرو",description:"مسموح بحد أقصى 5 تأكيدات يوميًا للتحويل/السحب. جرّب غدًا أو قم بالترقية.",variant:"destructive"});return}}else if(i===Qt.TAHWEELA){const{dailyOperationCountService:l}=await ne(async()=>{const{dailyOperationCountService:f}=await import("./dailyOperationCountService-Bsh4gYfW.js");return{dailyOperationCountService:f}},__vite__mapDeps([67,0,1]),import.meta.url),d=s.type==="send"?"transfer":"withdraw";if(!(await l.checkAndIncrementCombined(t.uid,d,40)).allowed){p({title:"تم بلوغ حد باقة تحويله",description:"هذه الباقة تسمح بحد أقصى 40 عملية تحويل/سحب يومياً.",variant:"destructive"});return}}}catch(i){console.warn("تعذر التحقق من حد التأكيد اليومي:",i)}await ta(Ae($,"userTransactions",a),{status:"completed",confirmedAt:new Date}),$t(i=>i.map(l=>l.id===a?{...l,status:"completed"}:l)),p({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),kn(!1)}catch(s){console.error("خطأ أثناء إكمال الإيصال:",s),p({title:"فشل الإكمال",description:"حدث خطأ غير متوقع أثناء تحديث الحالة.",variant:"destructive"})}};u.useEffect(()=>{if(!t)return;(async()=>{try{const s=Te(de($,"deletedTransactions"),K("userId","==",t.uid),gl("createdAt","desc"),Eg(50));(await De(s)).docs.forEach(l=>{const d=l.data(),m=String((d==null?void 0:d.originalTransactionId)||""),f=String((d==null?void 0:d.transactionId)||""),g=String((d==null?void 0:d.reference)||""),v=m||f||g||String(l.id);v&&(ga.current.has(v)||(ga.current.add(v),$t(y=>{const b=y.find(w=>w.id===m);return b?((async()=>await ho(b))(),y.filter(w=>w.id!==m)):y})))})}catch(s){console.warn("تعذر جلب المعاملات المحذوفة:",s)}})()},[t==null?void 0:t.uid]),u.useEffect(()=>{if(!(t!=null&&t.uid))return;console.log("🔄 إعداد مستمع بيانات المستخدم الفوري...",{userId:t.uid});const a=vu(Ae($,"users",t.uid),async s=>{if(s.exists()){const i=s.data();if(i.walletBalances&&lt(i.walletBalances),i.cashBalance!==void 0&&Xe(i.cashBalance),i.reportsData)try{await _t.syncReportsDataFromFirebase(t.uid),lf(nu())}catch(l){console.warn("تعذر مزامنة reportsData من السحابة:",l)}}});return()=>a()},[t==null?void 0:t.uid]);const[qc,hf]=u.useState(""),zc=Xb(qc,300),[Cn,Yc]=u.useState(""),[In,Kc]=u.useState(""),[pa,ow]=u.useState(""),[fo,Ts]=u.useState(!1),[go,br]=u.useState(!1),[ff,Jc]=u.useState(null),[na,po]=u.useState(!1),[gf,ia]=u.useState(!1),[He,xo]=u.useState(null),[ut,pf]=u.useState(null),[Hc,oa]=u.useState(!1),[xf,Ca]=u.useState(!1),[yf,Qc]=u.useState(!1),[yo,bo]=u.useState(""),[bf,vo]=u.useState(!1),[vf,vr]=u.useState(!1),[wf,Gc]=u.useState(!1),[Nf,_n]=u.useState(!1),[jf,Xc]=u.useState(!1),[Sf,wr]=u.useState(!1),[Df,Nr]=u.useState(!1),[kf,jr]=u.useState(!1),[Zc,An]=u.useState(()=>{try{const a=t!=null&&t.uid?`monthlyReportsLock_v4_${t==null?void 0:t.uid}`:"monthlyReportsLock_v4";return(localStorage.getItem(a)??localStorage.getItem("monthlyReportsLock_v4"))==="true"}catch{return!1}});u.useEffect(()=>{const a=()=>{try{const i=t!=null&&t.uid?`monthlyReportsLock_v4_${t==null?void 0:t.uid}`:"monthlyReportsLock_v4",l=localStorage.getItem(i)??localStorage.getItem("monthlyReportsLock_v4");An(l==="true")}catch{}};a();const s=i=>{i.detail&&typeof i.detail.enabled=="boolean"?An(i.detail.enabled):a()};return window.addEventListener("monthlyReportsLockChanged",s),()=>window.removeEventListener("monthlyReportsLockChanged",s)},[t==null?void 0:t.uid]);const[Sr,Cf]=u.useState(!1),[If,Tn]=u.useState(!1),[_f,ed]=u.useState(!1),[Pn,Af]=u.useState(""),[td,Tf]=u.useState(!1),[Pf,wo]=u.useState(!1),[Kt,ad]=u.useState(()=>{try{const a=(t==null?void 0:t.uid)||"default",s=localStorage.getItem(`hiddenQuickActions_${a}`)??localStorage.getItem("hiddenQuickActions"),i=s?JSON.parse(s):[];return Array.isArray(i)?i.filter(l=>typeof l=="string"):[]}catch{return[]}}),[Ef,sd]=u.useState(()=>{try{const a=t!=null&&t.uid?`dailyReportsLockEnabled_${t==null?void 0:t.uid}`:"dailyReportsLockEnabled";return(localStorage.getItem(a)??localStorage.getItem("dailyReportsLockEnabled"))==="true"}catch{return!1}}),[Of,No]=u.useState(!1);u.useEffect(()=>{try{const a=t!=null&&t.uid?`dailyReportsLockEnabled_${t==null?void 0:t.uid}`:"dailyReportsLockEnabled",s=localStorage.getItem(a)??localStorage.getItem("dailyReportsLockEnabled");sd(s==="true")}catch{}},[t==null?void 0:t.uid]);const[Mf,Ps]=u.useState(!1),[Rf,jo]=u.useState(!1),[Wf,rd]=u.useState(()=>{try{const a=t==null?void 0:t.uid,s=a?`debtsPinRequired_${a}`:"debtsPinRequired";return(localStorage.getItem(s)??localStorage.getItem("debtsPinRequired"))==="true"}catch{return!1}}),[Lf,nd]=u.useState(!1),[id,Ff]=u.useState(null),[So,od]=u.useState(""),[Do,ld]=u.useState(""),[cd,dd]=u.useState(""),[xa,ud]=u.useState(null),[R,Dr]=u.useState(null),[Bf,Va]=u.useState(!1),[$f,En]=u.useState(!1),[ya,Uf]=u.useState(null),[md,hd]=u.useState(""),[fd,On]=u.useState(""),[it,gd]=u.useState(null),[lw,cw]=u.useState(!1),[Vf,Mn]=u.useState(!1),[pd,kr]=u.useState(""),[ko,os]=u.useState(!1),[xd,Rn]=u.useState(1),[Cr,yd]=u.useState(""),qf=P?10:20,Wn=ae.useMemo(()=>{if(!Cr)return Pe;const a=Cr.toLowerCase();return Pe.filter(s=>s.debtorName&&s.debtorName.toLowerCase().includes(a)||s.amount&&s.amount.toString().includes(a))},[Pe,Cr]),Ln=ae.useMemo(()=>Wn.slice(0,xd*qf),[Wn,xd]);u.useEffect(()=>{Rn(1)},[Cr]),u.useEffect(()=>{ko&&(Rn(1),yd(""))},[ko]),u.useEffect(()=>{try{const a=(t==null?void 0:t.uid)||"default",s=localStorage.getItem(`hiddenQuickActions_${a}`)??localStorage.getItem("hiddenQuickActions"),i=s?JSON.parse(s):[];Array.isArray(i)&&ad(i.filter(l=>typeof l=="string"))}catch{}},[t==null?void 0:t.uid]),u.useEffect(()=>{const a=s=>{var i;try{const l=(i=s==null?void 0:s.detail)==null?void 0:i.hiddenQuickActions;Array.isArray(l)&&ad(l.map(d=>String(d)))}catch{}};try{window.addEventListener("hiddenQuickActionsChanged",a)}catch{}return()=>{try{window.removeEventListener("hiddenQuickActionsChanged",a)}catch{}}},[]);const Fn=async()=>{if(je){p({title:"غير متاح",description:"إدارة الديون/الأجل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"});return}try{const a=await Wt.hasMasterPin(t==null?void 0:t.uid);Wf&&a?jo(!0):Ps(!0)}catch{Ps(!0)}};u.useEffect(()=>{try{const a=t==null?void 0:t.uid,s=a?`debtsPinRequired_${a}`:"debtsPinRequired",i=localStorage.getItem(s)??localStorage.getItem("debtsPinRequired");(i==="true"||i==="false")&&rd(i==="true")}catch{}},[t==null?void 0:t.uid]),u.useEffect(()=>{const a=()=>{try{Bo()}catch{}};try{window.addEventListener("debtsUpdated",a)}catch{}return()=>{try{window.removeEventListener("debtsUpdated",a)}catch{}}},[t==null?void 0:t.uid,j,n==null?void 0:n.shopId]);const[zf,Co]=u.useState(!1),[Es,Io]=u.useState("customers_list"),[Pt,_o]=u.useState([]),[Ao,bd]=u.useState(""),[To,vd]=u.useState(""),[ls,wd]=u.useState(""),[Nd,Yf]=u.useState(""),[Kf,Bn]=u.useState(!1),[Jf,jd]=u.useState(""),[Sd,Po]=u.useState(""),[Dd,Eo]=u.useState(""),[Hf,$n]=u.useState(!1),[Qf,Oo]=u.useState(""),[kd,Mo]=u.useState(""),[Gf,Ro]=u.useState(!1),[Wo,Xf]=u.useState(""),[Zf,Os]=u.useState(!1),[cs,Ir]=u.useState(null),[bt,_r]=u.useState(null),[Ms,Lo]=u.useState(""),[e0,Rs]=u.useState(!1),[Cd,Un]=u.useState(0),[Et,qa]=u.useState(null),[za,Fo]=u.useState(""),[be,Ws]=u.useState(null),[t0,Id]=u.useState(""),Ia=async a=>{try{const s=JSON.stringify(a);localStorage.setItem(Tr(),s);try{localStorage.setItem(Jo(),s)}catch{}try{localStorage.setItem(Ho(),Date.now().toString())}catch{}if(t!=null&&t.uid){try{localStorage.setItem(`debts_unsynced_${t.uid}`,"true")}catch{}const i=[];i.push(oe.updateUserData(t.uid,{debts:a,debtsDeletedAt:null})),Promise.all(i).then(()=>{try{localStorage.removeItem(`debts_unsynced_${t.uid}`)}catch{}}).catch(l=>{console.error("فشل مزامنة الديون:",l),ye(!0)})}}catch(s){console.error("خطأ في حفظ الديون:",s)}},Bo=async()=>{try{const a=Tr(),s=Jo(),i=Ho(),l=localStorage.getItem(a),d=localStorage.getItem(s),m=localStorage.getItem(i),f=m?Number(m):0,g=y=>{if(!y)return null;try{const b=JSON.parse(y);return Array.isArray(b)?b.map(w=>{var C;return{...w,createdAt:(C=w.createdAt)!=null&&C.toDate?w.createdAt.toDate():new Date(w.createdAt),partialPayments:Array.isArray(w.partialPayments)?w.partialPayments.map(k=>{var A;return{amount:Number(k.amount)||0,paidAt:(A=k.paidAt)!=null&&A.toDate?k.paidAt.toDate():new Date(k.paidAt)}}):[],additionReceipts:Array.isArray(w.additionReceipts)?w.additionReceipts.map(k=>{var A;return{amount:Number(k.amount)||0,note:typeof k.note=="string"?k.note:void 0,addedAt:(A=k.addedAt)!=null&&A.toDate?k.addedAt.toDate():new Date(k.addedAt)}}):[]}}):[]}catch(b){return console.warn("فشل في تحليل ديون localStorage:",b),null}};let v=g(l);if(!v||v.length===0){const y=g(d);if(y&&y.length>0){v=y,Ut(y);try{localStorage.setItem(Tr(),JSON.stringify(y)),localStorage.removeItem(s)}catch(b){console.warn("تعذر ترحيل الديون محلياً من المفتاح الافتراضي:",b)}}}if(v&&v.length>0&&Ut(v),t!=null&&t.uid)try{const y=`debts_unsynced_${t.uid}`,b=localStorage.getItem(y)==="true",w=await ua(Ae($,"users",t.uid)),C=[];try{const k=query(de($,"debts"),K("userId","==",t.uid));(await De(k)).forEach(L=>{var E;const _=L.data();C.push({id:L.id,..._,amount:Number(_.amount||0),paidAmount:Number(_.paidAmount||0),createdAt:(E=_.createdAt)!=null&&E.toDate?_.createdAt.toDate():new Date(_.createdAt||Date.now()),partialPayments:Array.isArray(_.partialPayments)?_.partialPayments:[],additionReceipts:Array.isArray(_.additionReceipts)?_.additionReceipts.map(q=>{var ie;return{amount:Number(q.amount)||0,note:typeof q.note=="string"?q.note:void 0,addedAt:(ie=q.addedAt)!=null&&ie.toDate?q.addedAt.toDate():new Date(q.addedAt)}}):[]})})}catch(k){console.warn("Failed to fetch from debts collection:",k)}if(w.exists()){const k=w.data();let A=k.debts&&Array.isArray(k.debts)?k.debts.map(E=>{var q;return{...E,amount:Number(E.amount||0),paidAmount:Number(E.paidAmount||0),createdAt:(q=E.createdAt)!=null&&q.toDate?E.createdAt.toDate():new Date(E.createdAt),partialPayments:Array.isArray(E.partialPayments)?E.partialPayments.map(ie=>{var ee;return{amount:Number(ie.amount)||0,paidAt:(ee=ie.paidAt)!=null&&ee.toDate?ie.paidAt.toDate():new Date(ie.paidAt)}}):[],additionReceipts:Array.isArray(E.additionReceipts)?E.additionReceipts.map(ie=>{var ee;return{amount:Number(ie.amount)||0,note:typeof ie.note=="string"?ie.note:void 0,addedAt:(ee=ie.addedAt)!=null&&ee.toDate?ie.addedAt.toDate():new Date(ie.addedAt)}}):[]}}):[];if(!!k.debtsDeletedAt){Ut([]);try{localStorage.setItem(a,JSON.stringify([])),localStorage.setItem(s,JSON.stringify([]))}catch{}return}if(((A==null?void 0:A.length)||0)>0)if(b)console.log("⚠️ تم اكتشاف ديون غير متزامنة محلياً، سيتم تجاهل نسخة السحابة مؤقتاً للحفاظ على البيانات الجديدة.");else{Ut(A);try{localStorage.setItem(a,JSON.stringify(A))}catch{}}}else if(C.length>0){Ut(C);try{localStorage.setItem(a,JSON.stringify(C))}catch{}}else v&&v.length>0}catch(y){console.warn("تعذر تحميل الديون من Firebase، الاعتماد على المحلي:",y)}}catch(a){console.error("خطأ في تحميل الديون:",a)}};u.useEffect(()=>{try{window.exportDebts=()=>{try{return JSON.stringify(Pe||[])}catch{return"[]"}},window.importDebts=async a=>{try{const s=JSON.parse(a);if(!Array.isArray(s))throw new Error("صيغة غير صحيحة — يجب أن تكون مصفوفة");return await Ia(s),{ok:!0,count:s.length}}catch(s){return console.error("فشل استيراد الديون:",s),{ok:!1,error:String(s)}}},window.fixWalletsForCurrentUser=async a=>{try{if(!(t!=null&&t.uid))throw new Error("يجب تسجيل الدخول أولاً");return await(await ne(async()=>{const{merchantWalletService:i}=await import("./index-CZwBW8vR.js").then(l=>l.cG);return{merchantWalletService:i}},__vite__mapDeps([0,1]),import.meta.url)).merchantWalletService.reassignByMsisdns(a,t.uid)}catch(s){return console.error("فشل إصلاح المحافظ للمستخدم الحالي:",s),{updated:0,failed:(a==null?void 0:a.length)||0,error:String(s)}}}}catch{}},[Pe,t==null?void 0:t.uid]),u.useEffect(()=>{t!=null&&t.uid&&Bo()},[t==null?void 0:t.uid]),u.useEffect(()=>{if(!(t!=null&&t.uid))return;const a=vu(Ae($,"users",t.uid),async s=>{var i;if(s.exists()){const l=s.data(),d=l.isActive===!0;l.subscription&&Sc(l.subscription),Ih(l.branchPackage||null);const m=await Ou.checkTrialValidity(t.uid),f=m.isValid&&!m.isExpired;Fa(d||f),wc(f),Nc(m.hoursRemaining),jc(m.hasUsedTrial);const g=!d&&!f;Ba(g),g&&(console.log("⛔ User not active, redirecting to pending approval..."),x("/user/pending-approval",{replace:!0})),console.log("🔄 تحديث فوري لحالة المستخدم (Real-time):",{isActive:d,isOnTrial:f,plan:(i=l.subscription)==null?void 0:i.planType,showModal:g})}});return()=>a()},[t==null?void 0:t.uid]);const a0=async()=>{if(t!=null&&t.uid)try{Dc(!0);const a=await sm(t.uid);Sc(a)}catch(a){console.error("خطأ في جلب بيانات الاشتراك:",a)}finally{Dc(!1)}},[dw,uw]=u.useState(!1),[s0,$o]=u.useState(!1),[$e,Xe]=u.useState(0),[Ne,lt]=u.useState({}),[r0,_d]=u.useState(!1),[n0,Ad]=u.useState(!1),[i0,Uo]=u.useState(!1),[o0,Vn]=u.useState(!1),[Td,Vo]=u.useState(""),[l0,Ar]=u.useState(!1),[c0,qn]=u.useState(!1),[qo,zn]=u.useState(""),[d0,zo]=u.useState(!1),[Yn,Pd]=u.useState(""),[Kn,Ed]=u.useState(""),[Jn,Od]=u.useState(""),[Md,Rd]=u.useState(!1),[Yo,Ko]=u.useState(!1),[u0,Wd]=u.useState(!1),[Ld,m0]=u.useState([]);u.useEffect(()=>{(async()=>{try{if(!(t!=null&&t.uid)||!Yo)return;try{await Br.trimToMaxCount(t.uid,30)}catch{}const a=await Br.getByUser(t.uid,30);m0(a)}catch{}})()},[t==null?void 0:t.uid,Yo]);const Ze=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`walletBalances_${(t==null?void 0:t.uid)||"default"}_${a}`},qe=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`cashBalance_${(t==null?void 0:t.uid)||"default"}_${a}`},Tr=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`debts_${(t==null?void 0:t.uid)||"default"}_${a}`},h0=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`customers_${(t==null?void 0:t.uid)||"default"}_${a}`},Jo=()=>`debts_default_${j||(n==null?void 0:n.shopId)||"main"}`,Ho=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`debts_last_write_${(t==null?void 0:t.uid)||"default"}_${a}`},Qo=()=>`shopExpenses_${j||(n==null?void 0:n.shopId)||(t==null?void 0:t.uid)||"default"}`,Fd=()=>{try{const a=localStorage.getItem(Qo());if(a){const s=JSON.parse(a);Ui(s.map(i=>({...i,createdAt:new Date(i.createdAt)})))}}catch(a){console.error("خطأ أثناء تحميل مصروفات المحل من التخزين:",a)}},Bd=async a=>{try{localStorage.setItem(Qo(),JSON.stringify(a)),Ui(a)}catch(s){console.error("خطأ أثناء حفظ مصروفات المحل في التخزين:",s)}},f0=async a=>{try{const s=fn.filter(i=>i.id!==a);await Bd(s);try{if(t!=null&&t.uid&&a){const{doc:i,deleteDoc:l}=await ne(async()=>{const{doc:f,deleteDoc:g}=await import("./index-CZwBW8vR.js").then(v=>v.cE);return{doc:f,deleteDoc:g}},__vite__mapDeps([0,1]),import.meta.url),{db:d}=await ne(async()=>{const{db:f}=await import("./index-CZwBW8vR.js").then(g=>g.cF);return{db:f}},__vite__mapDeps([0,1]),import.meta.url),m=i(d,"shop_expenses",a);await l(m)}}catch(i){console.warn("تعذر حذف المصروف من السحابة الآن، تم الحذف محليًا وسيبقى مخزّنًا دون هذا الإيصال:",i)}p({title:"تم الحذف",description:"تم حذف إيصال المصروف نهائيًا."})}catch(s){console.error("خطأ أثناء الحذف النهائي لإيصال المصروف:",s),p({title:"فشل الحذف",description:"تعذر حذف الإيصال. حاول مرة أخرى.",variant:"destructive"})}};ae.useEffect(()=>{let a;return(async()=>{try{if(!(t!=null&&t.uid)){Fd();return}const{collection:s,query:i,where:l,getDocs:d}=await ne(async()=>{const{collection:w,query:C,where:k,getDocs:A}=await import("./index-CZwBW8vR.js").then(L=>L.cE);return{collection:w,query:C,where:k,getDocs:A}},__vite__mapDeps([0,1]),import.meta.url),{db:m}=await ne(async()=>{const{db:w}=await import("./index-CZwBW8vR.js").then(C=>C.cF);return{db:w}},__vite__mapDeps([0,1]),import.meta.url),f=j||(n==null?void 0:n.shopId),g=f?i(s(m,"shop_expenses"),l("shopId","==",f)):i(s(m,"shop_expenses"),l("userId","==",t.uid)),b=(await d(g)).docs.map(w=>{var A;const C=w.data(),k=(A=C.createdAt)!=null&&A.toDate?C.createdAt.toDate():C.createdAt?new Date(C.createdAt):new Date;return{id:w.id,name:String(C.name||""),amount:Number(C.amount||0),notes:C.notes?String(C.notes):void 0,source:C.source==="wallet"?"wallet":"cash",walletId:C.walletId?String(C.walletId):void 0,createdAt:k}}).sort((w,C)=>{const k=w.createdAt instanceof Date?w.createdAt.getTime():0;return(C.createdAt instanceof Date?C.createdAt.getTime():0)-k});Ui(b);try{localStorage.setItem(Qo(),JSON.stringify(b))}catch{}}catch(s){console.error("خطأ في مزامنة مصروفات المحل من Firestore:",s)}})(),()=>a==null?void 0:a()},[t==null?void 0:t.uid,n==null?void 0:n.shopId,j]);const Hn=()=>`deficiencies_${j||(n==null?void 0:n.shopId)||(t==null?void 0:t.uid)||"default-shop"}`,g0=()=>{try{const a=Hn(),s=`deficiencies_${(t==null?void 0:t.uid)||"default"}`;if(s!==a){const l=localStorage.getItem(s),d=localStorage.getItem(a);if(l)try{const m=JSON.parse(l)||[],f=d?JSON.parse(d):[],g=Array.isArray(f)?[...f]:[],v=(y,b)=>y.some(w=>(w==null?void 0:w.id)&&(b==null?void 0:b.id)&&String(w.id)===String(b.id)||String((w==null?void 0:w.name)||"")===String((b==null?void 0:b.name)||"")&&String((w==null?void 0:w.status)||"pending")===String((b==null?void 0:b.status)||"pending"));if(Array.isArray(m))for(const y of m)v(g,y)||g.push(y);localStorage.setItem(a,JSON.stringify(g));try{localStorage.removeItem(s)}catch{}}catch{}}const i=localStorage.getItem(a);if(i){const l=JSON.parse(i);js(l.map(d=>({...d,createdAt:new Date(d.createdAt)})))}}catch(a){console.error("خطأ أثناء تحميل النواقص من التخزين:",a)}},Go=async a=>{try{localStorage.setItem(Hn(),JSON.stringify(a)),js(a)}catch(s){console.error("خطأ أثناء حفظ النواقص في التخزين:",s)}};ae.useEffect(()=>{(async()=>{try{if(!(t!=null&&t.uid))return;const{collection:s,query:i,where:l,orderBy:d,getDocs:m}=await ne(async()=>{const{collection:w,query:C,where:k,orderBy:A,getDocs:L}=await import("./index-CZwBW8vR.js").then(_=>_.cE);return{collection:w,query:C,where:k,orderBy:A,getDocs:L}},__vite__mapDeps([0,1]),import.meta.url),{db:f}=await ne(async()=>{const{db:w}=await import("./index-CZwBW8vR.js").then(C=>C.cF);return{db:w}},__vite__mapDeps([0,1]),import.meta.url),g=j||(n==null?void 0:n.shopId)||t.uid||"default-shop",v=i(s(f,"deficiencies"),l("shopId","==",g),d("createdAt","desc")),b=(await m(v)).docs.map(w=>{var A;const C=w.data(),k=(A=C.createdAt)!=null&&A.toDate?C.createdAt.toDate():C.createdAt?new Date(C.createdAt):new Date;return{id:w.id,name:String(C.name||""),quantity:Number(C.quantity||1),status:C.status==="purchased"?"purchased":"pending",createdAt:k}});js(b);try{localStorage.setItem(Hn(),JSON.stringify(b))}catch{}}catch(s){console.warn("فشل جلب النواقص من Firestore:",s)}})()},[t==null?void 0:t.uid,n==null?void 0:n.shopId,j]);const Xo=async a=>{try{localStorage.setItem(h0(),JSON.stringify(a)),_o(a),t!=null&&t.uid&&await oe.updateUserData(t.uid,{customers:a})}catch(s){console.error("خطأ أثناء حفظ العملاء في التخزين:",s)}},p0=async()=>{try{if(t!=null&&t.uid){const a=await ua(Ae($,"users",t.uid));if(a.exists()){const s=a.data();if(s.customers&&Array.isArray(s.customers)){const i=s.customers.map(l=>{var d;return{...l,createdAt:(d=l.createdAt)!=null&&d.toDate?l.createdAt.toDate():new Date(l.createdAt)}});_o(i);return}}}_o([])}catch(a){console.error("خطأ أثناء تحميل العملاء من Firestore:",a)}},Zo=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`transactions_${(t==null?void 0:t.uid)||"default"}_${a}`},$d=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`wallets_${(t==null?void 0:t.uid)||"default"}_${a}`},ds=()=>{const a=j||(n==null?void 0:n.shopId)||"main";return`selectedWallet_${(t==null?void 0:t.uid)||"default"}_${a}`},el=a=>{var d;const s=String((a==null?void 0:a.transactionId)||(a==null?void 0:a.id)||""),i=String((a==null?void 0:a.reference)||(a==null?void 0:a.transactionReference)||((d=a==null?void 0:a.receipt)==null?void 0:d.reference)||""),l=new Date((a==null?void 0:a.createdAt)||0).getTime();return s||i||`${i||"ref"}-${l}`},{data:tl,refetch:mw}=Jr({queryKey:["userTransactions",t==null?void 0:t.uid],queryFn:async()=>{if(!(t!=null&&t.uid))return[];const{collection:a,query:s,where:i,orderBy:l,limit:d,getDocs:m}=await ne(async()=>{const{collection:y,query:b,where:w,orderBy:C,limit:k,getDocs:A}=await import("./index-CZwBW8vR.js").then(L=>L.cE);return{collection:y,query:b,where:w,orderBy:C,limit:k,getDocs:A}},__vite__mapDeps([0,1]),import.meta.url),{db:f}=await ne(async()=>{const{db:y}=await import("./index-CZwBW8vR.js").then(b=>b.cF);return{db:y}},__vite__mapDeps([0,1]),import.meta.url),g=s(a(f,"userTransactions"),i("userId","==",t.uid),l("createdAt","desc"),d(100));return(await m(g)).docs.map(y=>{var q;const b=y.data(),w=(q=b.createdAt)!=null&&q.toDate?b.createdAt.toDate():new Date(b.createdAt),C=(b.txnType||"").toLowerCase(),k=C==="send"?"send":C==="receive"?"withdraw":b.type||"withdraw",A=b.status==="confirmed"?"completed":b.status||"completed",L=b.senderMsisdn||b.senderPhone||"",_=b.receiverMsisdn||b.receiverPhone||"",E=Number(b.amount??b.transferredAmount??b.withdrawnAmount??0);return{id:y.id,...b,type:k,status:A,senderPhone:L,receiverPhone:_,amount:E,createdAt:w,provider:b.provider||void 0}})},enabled:!!(t!=null&&t.uid),staleTime:1e3*60*5,gcTime:1e3*60*10});u.useEffect(()=>{if(tl){const s=tl.filter(f=>!((f==null?void 0:f.type)==="report"||String((f==null?void 0:f.title)||"").includes("إيصال تسليم وردية"))),i=new Set((xr||[]).map(f=>String(f.id||f.originalTransactionId||""))),l=s.filter(f=>!i.has(String(f.id||""))),d=new Set,m=[];for(const f of l){const g=el(f);d.has(g)||(d.add(g),m.push(f))}$t(m)}},[tl,xr]),u.useEffect(()=>{if(!(t!=null&&t.uid))return;let a=!0;return(async()=>{try{const{collection:i,query:l,where:d,getDocs:m,orderBy:f,limit:g}=await ne(async()=>{const{collection:w,query:C,where:k,getDocs:A,orderBy:L,limit:_}=await import("./index-CZwBW8vR.js").then(E=>E.cE);return{collection:w,query:C,where:k,getDocs:A,orderBy:L,limit:_}},__vite__mapDeps([0,1]),import.meta.url),{db:v}=await ne(async()=>{const{db:w}=await import("./index-CZwBW8vR.js").then(C=>C.cF);return{db:w}},__vite__mapDeps([0,1]),import.meta.url),y=l(i(v,"deletedTransactions"),d("userId","==",t.uid),f("createdAt","desc"),g(50)),b=await m(y);if(!a)return;b.docs.forEach(w=>{const C=w.data(),k=String((C==null?void 0:C.originalTransactionId)||""),A=String((C==null?void 0:C.transactionId)||""),L=String((C==null?void 0:C.reference)||""),_=k||A||L||String(w.id);_&&(ga.current.has(_)||(ga.current.add(_),$t(E=>{const q=E.find(ie=>ie.id===k);return q?((async()=>await ho(q))(),E.filter(ie=>ie.id!==k)):E})))})}catch(i){console.warn("تعذر جلب المعاملات المحذوفة:",i)}})(),()=>{a=!1}},[t==null?void 0:t.uid]);const[al,Qn]=u.useState(""),[Vt,Ud]=u.useState(""),Jt=ae.useMemo(()=>{const a=Tt;if(!a)return!1;const s=bg(a),i=a.planType??a.plan??null,l=typeof i=="string"?i.toLowerCase():null,d=l==="monthly"||l==="quarterly"||l==="half_yearly"||l==="yearly"||l==="lifetime"||i===Qt.MONTHLY||i===Qt.QUARTERLY||i===Qt.HALF_YEARLY||i===Qt.YEARLY||i===Qt.LIFETIME;return s&&d},[Tt]),je=ae.useMemo(()=>{var l,d;const a=Tt;if(!a)return!1;const s=((l=a.subscription)==null?void 0:l.planType)??((d=a.subscription)==null?void 0:d.plan)??a.planType??a.plan??null,i=typeof s=="string"?s.toLowerCase():null;return s===Qt.ZERO||i==="zero"},[Tt]),ke=ae.useMemo(()=>{var l,d;const a=Tt;if(!a)return!1;const s=((l=a.subscription)==null?void 0:l.planType)??((d=a.subscription)==null?void 0:d.plan)??a.planType??a.plan??null,i=typeof s=="string"?String(s).trim().toLowerCase():null;return s===Qt.TAHWEELA||i==="tahweela"||i==="تحويله"},[Tt]),x0=()=>{if(!Jt){p({title:"غير متاح",description:"هذه الميزة متاحة للاشتراكات: شهري، ربع سنوي، نصف سنوي، سنوي، ومدى الحياة. يرجى تفعيل اشتراكك.",variant:"destructive"});return}Ft(!0)},[hw,fw]=u.useState(!1),[y0,b0]=u.useState(!1),[v0,w0]=u.useState(!1),[N0,j0]=u.useState(!1),[S0,Pr]=u.useState(!1),[us,Gn]=u.useState(""),[Er,Xn]=u.useState(""),[Vd,Zn]=u.useState(!1),[Or,Mr]=u.useState(null),[sl,ei]=u.useState(""),[D0,qd]=u.useState(!1),[gw,pw]=u.useState(!1),[k0,ti]=u.useState(!1),[zd,rl]=u.useState(""),[Yd,nl]=u.useState(""),[Kd,Jd]=u.useState(!1);u.useEffect(()=>{const a=s=>{var d,m;const i=(d=s.detail)==null?void 0:d.action,l=((m=s.detail)==null?void 0:m.payload)||{};if(console.log("🔔 Dashboard Navigation Action:",i,l),i==="lines")V("lines",()=>{const f=(o==null?void 0:o.simSubscription)||(t==null?void 0:t.simSubscription);let g=!1;f!=null&&f.active&&(f!=null&&f.endsAt)&&(f.endsAt.seconds?new Date(f.endsAt.seconds*1e3):new Date(f.endsAt))>new Date&&(g=!0),g?_n(!0):yt(!0)});else if(i==="profile-settings")V("settings",()=>U(!0));else if(i==="debts")V("debts",()=>Fn());else if(i==="sales")V("sales",()=>{je||ke?p({title:"غير متاح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):As(!0)});else if(i==="maintenance")V("maintenance",()=>{je||ke?p({title:"غير متاح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Nr(!0)});else if(i==="credit-cards")V("cards",()=>{je||ke?p({title:"غير متاح",description:"كروت الائتمان غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):wr(!0)});else if(i==="shop-expenses")V("expenses",()=>{je||ke?p({title:"غير متاح",description:"مصروفات المحل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Wt.hasMasterPin()?ws(!0):ss(!0)});else if(i==="deficiencies")V("deficiencies",()=>{je||ke?p({title:"غير متاح",description:"النواقص غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):or(!0)});else if(i==="installment")V("installments",()=>{je||ke?p({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"}):vr(!0)});else if(i==="cashier-shift")!Jt||ke?p({title:"غير متاح",description:"وردية الكاشير متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"}):Ft(!0);else if(i==="machine-daily")V("machines",()=>{!Jt||ke?p({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"}):jr(!0)});else if(i==="atm-withdraw")V("withdrawals",()=>{je||ke?p({title:"غير متاح",description:"سحب ATM غير متاح في خطة زيرو أو تحويله. قم بالترقية.",variant:"destructive"}):Z(!0)});else if(i==="branch-management")V("branches",()=>{(Nt==null?void 0:Nt.status)==="active"?La(!0):tr(!0)});else if(i==="my-client-numbers")V("myNumbers",()=>pn(!0));else if(i==="transaction-section"){const f=()=>{const g=document.getElementById("transaction-section");if(g){const v=l.skipAnimation?"auto":"smooth";g.scrollIntoView({behavior:v})}l.transactionType&&ro(l.transactionType),l.startNewTransaction&&(ur(""),ks(""),vn(""),wn(""),console.log("🔒 Starting new transaction via event"))};l.transactionType==="transfer"?V("transfers",f):l.transactionType==="withdraw"?V("withdrawals",f):f()}};return window.addEventListener("dashboard-navigation-action",a),()=>window.removeEventListener("dashboard-navigation-action",a)},[M,ke,Nt,je,Jt]);const Hd=async()=>{var a;if(t!=null&&t.uid)try{const s=`userData_${t.uid}`,i=localStorage.getItem(s),l=`debts_unsynced_${t.uid}`,d=localStorage.getItem(Tr()),m=localStorage.getItem(l)==="true";if(i){const f=JSON.parse(i);console.log("🔄 مزامنة البيانات المحلية مع Firebase...",f);const g={lastSynced:new Date().toISOString()};typeof f.cashBalance=="number"&&(g.cashBalance=f.cashBalance),f.walletBalances&&typeof f.walletBalances=="object"&&(g.walletBalances=f.walletBalances),await oe.updateUserData(t.uid,g),localStorage.removeItem(s),ye(!1),console.log("✅ تمت المزامنة بنجاح وحذف البيانات المحلية")}else console.log("لا توجد بيانات محلية تحتاج للمزامنة");if(m&&d)try{const f=JSON.parse(d)||[],g=_=>_ instanceof Date?_:typeof(_==null?void 0:_.toDate)=="function"?_.toDate():_?new Date(String(_)):new Date,v=_=>(Array.isArray(_)?_:[]).map(E=>({...E,amount:Number(E.amount||0),paidAmount:Number(E.paidAmount||0),createdAt:g(E.createdAt),partialPayments:Array.isArray(E.partialPayments)?E.partialPayments.map(q=>({amount:Number(q.amount||0),paidAt:g(q.paidAt)})):[]})),y=await ua(Ae($,"users",t.uid)),b=y.exists()?((a=y.data())==null?void 0:a.debts)||[]:[],w=v(b),C=v(f),k={};for(const _ of w)k[String(_.id||"")]=_;const A=[],L=new Set;for(const _ of C){const E=String(_.id||""),q=k[E];if(q){const ie=Number(q.paidAmount||0),ee=Number(_.paidAmount||0),Ce=String(q.status||"pending"),et=String(_.status||"pending"),tt=Ce==="paid"||ie>=Number(q.amount||0)?q:et==="paid"?{...q,paidAmount:Number(_.paidAmount||0),partialPayments:_.partialPayments,status:"paid"}:ee>ie?{...q,paidAmount:Number(_.paidAmount||0),partialPayments:_.partialPayments,status:ee>=Number(q.amount||0)?"paid":"pending"}:q;A.push(tt),L.add(E)}else A.push(_),L.add(E)}for(const _ of w){const E=String(_.id||"");L.has(E)||A.push(_)}await oe.updateUserData(t.uid,{debts:A});try{localStorage.removeItem(l)}catch{}ye(!1)}catch{ye(!0)}}catch(s){console.error("❌ فشل في مزامنة البيانات:",s),p({title:"فشل في المزامنة",description:"حدث خطأ أثناء مزامنة البيانات مع الخادم",variant:"destructive"})}},[Qd,ai]=u.useState({keepLastCount:30,intervalDays:7,lastResetAt:null});u.useEffect(()=>{(async()=>{if(t!=null&&t.uid)try{const s=await oe.getUserData(t.uid),i=(s==null?void 0:s.recentReset)||{},l=Number(i==null?void 0:i.keepLastCount)>0?Number(i.keepLastCount):30,d=Number(i==null?void 0:i.intervalDays)>0?Number(i.intervalDays):7,m=y=>y instanceof Date?y:typeof(y==null?void 0:y.toDate)=="function"?y.toDate():y?new Date(String(y)):null,f=i!=null&&i.lastResetAt?m(i.lastResetAt):null,g=new Date;!f||g.getTime()-f.getTime()>=d*24*60*60*1e3?(await oe.updateUserData(t.uid,{recentReset:{keepLastCount:l,intervalDays:d,lastResetAt:g}}),ai({keepLastCount:l,intervalDays:d,lastResetAt:g})):ai({keepLastCount:l,intervalDays:d,lastResetAt:f})}catch{ai({keepLastCount:30,intervalDays:7,lastResetAt:null})}})()},[t==null?void 0:t.uid]);const Gd=ae.useMemo(()=>{const a=ue||[],s=f=>f instanceof Date?f:typeof(f==null?void 0:f.toDate)=="function"?f.toDate():new Date(String(f)),i=new Date,l=new Date(i.getFullYear(),i.getMonth(),1),d=new Date(i.getFullYear(),i.getMonth()+1,1);return[...a].sort((f,g)=>s(g.createdAt).getTime()-s(f.createdAt).getTime()).filter(f=>{const g=s(f.createdAt);return g>=l&&g<d})},[ue]),C0=ae.useMemo(()=>{const a=ue||[],s=f=>f instanceof Date?f:typeof(f==null?void 0:f.toDate)=="function"?f.toDate():new Date(String(f)),i=new Date,l=new Date(i.getFullYear(),i.getMonth(),1),d=new Date(i.getFullYear(),i.getMonth()+1,1),m=a.filter(f=>{const g=s(f.createdAt);return g>=l&&g<d}).length;return Math.max(0,((ue==null?void 0:ue.length)||0)-m)},[ue==null?void 0:ue.length]),si=ae.useMemo(()=>{const a=new Date,s=new Date(a.getFullYear(),a.getMonth(),1),i=new Date(a.getFullYear(),a.getMonth()+1,1),l={};for(const m of ue){const f=new Date(m.createdAt||0);if(!(f>=s&&f<i))continue;const g=String(m.type||m.txnType||"").toLowerCase();if(!(g==="send"||g==="withdraw"||g==="transfer"))continue;const v=String(m.receiverPhone||m.senderPhone||"").trim();if(!v)continue;const y=Rt(v),b=Number(m.amount||m.withdrawnAmount||m.sentAmount||0)||0;l[y]||(l[y]={phone:y,count:0,total:0}),l[y].count+=1,l[y].total+=b}return Object.values(l).sort((m,f)=>f.count!==m.count?f.count-m.count:f.total-m.total).slice(0,10)},[ue]),I0=a=>{const s=Rt(String(a));return s.startsWith("+20")?"20"+s.slice(3):s.startsWith("0")?"20"+s.slice(1):s.replace(/[^0-9]/g,"")},_0=a=>{const s=I0(a.phone),i=`عميل VIP هذا الشهر
عدد العمليات: ${a.count}
الإجمالي: ${a.total} جنيه`,l=`https://wa.me/${s}?text=${encodeURIComponent(i)}`;try{window.open(l,"_blank")}catch{}};u.useEffect(()=>{(async()=>{try{if(!(t!=null&&t.uid))return;const a=`${new Date().getFullYear()}-${new Date().getMonth()+1}`;await oe.updateUserData(t.uid,{vipTop10:si,vipMonthTag:a})}catch{}})()},[t==null?void 0:t.uid,si]);async function Xd(){const a=new Date,s=new Intl.DateTimeFormat("ar-EG",{timeZone:"Africa/Cairo",year:"numeric",month:"2-digit",day:"2-digit"}).format(a),i=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),l=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59,999),d=(ue||[]).filter(k=>{const A=new Date(k.createdAt||0);return A>=i&&A<=l}),m=d.length,f=d.filter(k=>String(k.type||k.txnType||"").toLowerCase()==="withdraw"||String(k.type||"").toLowerCase()==="receive").reduce((k,A)=>k+(A.withdrawnAmount!=null?Number(A.withdrawnAmount):Number(A.amount||0)),0),g=d.filter(k=>String(k.type||k.txnType||"").toLowerCase()==="send"||String(k.type||"").toLowerCase()==="transfer").reduce((k,A)=>k+(A.sentAmount!=null?Number(A.sentAmount):Number(A.amount||0)),0);let v=0;try{v=d.reduce((k,A)=>k+_t.calculateTransactionProfit(A),0)}catch{}let y=0;try{const k=new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Cairo"}).format(a),A=Te(de($,"dailySales"),K("userId","==",(t==null?void 0:t.uid)||""));y=(await De(A)).docs.map(E=>E.data()).filter(E=>String(E.date||k)===k).reduce((E,q)=>E+Number(q.sellingPrice||q.price||0)*Number(q.quantity||1),0)}catch{}let b=0;try{b=(Pe||[]).filter(A=>String(A.status||"")==="pending").reduce((A,L)=>{const _=Number(L.paidAmount||0);return A+Math.max(0,Number(L.amount||0)-_)},0)}catch{}let w="";try{const k=j||(n==null?void 0:n.shopId)||null,A=k?Te(de($,"deficiencies"),K("shopId","==",k)):Te(de($,"deficiencies"),K("userId","==",(t==null?void 0:t.uid)||""));w=(await De(A)).docs.map(q=>q.data()).filter(q=>String(q.status||"pending")==="pending").slice(0,10).map((q,ie)=>`${ie+1}- ${String(q.name||q.productName||"عنصر")} × ${Number(q.quantity||q.qty||0)}`).join(`
`)}catch{}return[`تقرير يومي - ${s}`,`عدد العمليات: ${m}`,`إجمالي المسحوبات: ${f} جنيه`,`إجمالي الإرسال: ${g} جنيه`,`الأرباح: ${v} جنيه`,`إجمالي مبيعات الاكسسوار: ${y} جنيه`,`إجمالي الديون: ${b} جنيه`,"نواقص الاكسسوار:",w||"لا توجد عناصر مسجلة"].join(`
`)}const Zd=ae.useCallback(()=>{let a=Gd;const s=zc.trim();if(s&&(a=a.filter(i=>{const l=i;return String(l.type||"").toLowerCase()==="cash_addition"||String(l.txnType||"").toLowerCase()==="cash_addition"||String(l.title||"").includes("إيصال إضافة نقدية")?!0:i.senderPhone&&i.senderPhone.includes(s)||i.receiverPhone&&i.receiverPhone.includes(s)})),Cn){const i=new Date(Cn);a=a.filter(l=>{const d=new Date(l.createdAt);if(In){const[m,f]=In.split(":"),g=new Date(i);g.setHours(parseInt(m),parseInt(f),0,0);const v=new Date(g);return v.setHours(v.getHours()+1),d>=g&&d<v}else return d.toDateString()===i.toDateString()})}try{a=[...a].sort((i,l)=>{const d=new Date(i.createdAt||0).getTime();return new Date(l.createdAt||0).getTime()-d})}catch{}return a},[Gd,zc,Cn,In]),eu=async()=>{if(je||ke){p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"});return}if(!(t!=null&&t.uid)){p({title:"خطأ في المصادقة",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}try{const a=await Xd(),s=t!=null&&t.uid?`tg_daily_report_last_${t.uid}`:"tg_daily_report_last",i=Date.now();let l=!0;try{const d=localStorage.getItem(s);if(d){const m=JSON.parse(d),f=Number((m==null?void 0:m.at)||0);i-f<3e4&&(l=!1)}}catch{}if(l){await fs.send(t.uid,a);try{localStorage.setItem(s,JSON.stringify({at:i}))}catch{}}p({title:"تم الإرسال",description:"تم إرسال التقرير اليومي إلى تليجرام",variant:"default"})}catch{p({title:"فشل الإرسال",description:"تعذّر إرسال التقرير اليومي إلى تليجرام",variant:"destructive"})}},[A0,ri]=u.useState(!1),[tu,ni]=u.useState(""),[T0,ii]=u.useState(!1),[il,ol]=u.useState(""),[P0,ye]=u.useState(!1),[E0,ll]=u.useState(!1),ms=async(a,s=2,i=700)=>{let l;for(let d=0;d<=s;d++)try{return await a()}catch(m){if(l=m,d===s)break;await new Promise(f=>setTimeout(f,i*Math.pow(2,d)))}throw l};M.reduce((a,s)=>a+(Ne[s.id]||0),0);const O0=async a=>await Wt.verifyMasterPin(a,t==null?void 0:t.uid),oi=async a=>await Wt.verifyMasterPin(a,t==null?void 0:t.uid);u.useEffect(()=>{if(t!=null&&t.uid){try{const a=Ze(),s=`walletBalances_${t.uid}`,i=localStorage.getItem(a)??localStorage.getItem(s);if(i){const l=JSON.parse(i);lt(l&&typeof l=="object"?l:{});try{localStorage.setItem(a,JSON.stringify(l||{}))}catch{}}}catch{}try{const a=qe(),s=`cashBalance_${t.uid}`,i=`userCashBalance_${t.uid}`;let l=localStorage.getItem(a)??localStorage.getItem(s)??localStorage.getItem(i);if(l!=null){const d=parseFloat(l);Xe(Number.isFinite(d)?d:0);try{localStorage.setItem(a,String(Number.isFinite(d)?d:0)),localStorage.removeItem(s),localStorage.removeItem(i)}catch{}}}catch{}}},[t==null?void 0:t.uid,j,n==null?void 0:n.shopId]),u.useEffect(()=>{const a=s=>{var i;try{const l=Number((i=s==null?void 0:s.detail)==null?void 0:i.value);if(Number.isFinite(l))Xe(l);else{const d=localStorage.getItem(qe());d!=null&&Xe(parseFloat(d)||0)}}catch{const l=localStorage.getItem(qe());l!=null&&Xe(parseFloat(l)||0)}};return window.addEventListener("cashBalanceChanged",a),()=>window.removeEventListener("cashBalanceChanged",a)},[t==null?void 0:t.uid,j,n==null?void 0:n.shopId]);const{data:cl}=Jr({queryKey:["dashboardData",j||(n==null?void 0:n.shopId)],queryFn:async()=>{const a=j||(n==null?void 0:n.shopId);if(!a)return null;const s=Ae($,"dashboardData",a),i=await ua(s);return i.exists()?i.data():null},enabled:!!(t!=null&&t.uid&&(j||n!=null&&n.shopId)),staleTime:1e3*60*5,refetchInterval:1e3*60*5});u.useEffect(()=>{if(cl){const a=cl,s=Number((a==null?void 0:a.cashBalance)||0),i=a!=null&&a.walletBalances&&typeof a.walletBalances=="object"?a.walletBalances:{};try{const l=a!=null&&a.lastUpdated?new Date(a.lastUpdated).getTime():0,d=localStorage.getItem(qe()+"_lastUpdated"),m=d?new Date(d).getTime():0;l>=m&&(Xe(s),lt(i),localStorage.setItem(qe(),String(s)),localStorage.setItem(Ze(),JSON.stringify(i)),a!=null&&a.lastUpdated&&(localStorage.setItem(qe()+"_lastUpdated",a.lastUpdated),localStorage.setItem(Ze()+"_lastUpdated",a.lastUpdated)))}catch{}}},[cl]);const au=a=>`walletLimits_${(t==null?void 0:t.uid)||"default"}_${a||"none"}`,{data:li}=Jr({queryKey:["walletLimits",W],queryFn:async()=>{if(!W)return null;const a=Ae($,"walletLimits",String(W)),s=await ua(a);return s.exists()?s.data():null},enabled:!!W,staleTime:1e3*60*5});u.useEffect(()=>{if(W)try{const a=au(W),s=localStorage.getItem(a);if(s&&!li){const i=JSON.parse(s);Ws(i)}if(li){const i=li,l={walletId:W,dailyTransferLimit:i.dailyTransferLimit??6e4,dailyWithdrawLimit:i.dailyWithdrawLimit??1e5,dailyTransferUsed:i.dailyTransferUsed??0,dailyWithdrawUsed:i.dailyWithdrawUsed??0,monthlyTransferLimit:i.monthlyTransferLimit??2e5,monthlyWithdrawLimit:i.monthlyWithdrawLimit??2e5,monthlyTransferUsed:i.monthlyTransferUsed??0,monthlyWithdrawUsed:i.monthlyWithdrawUsed??0};Ws(l);try{localStorage.setItem(au(W),JSON.stringify(l))}catch{}}}catch{}},[W,li]),u.useEffect(()=>{if(!W)return;const a=M.find(s=>s.id===W);if(a!=null&&a.name){Id(String(a.name));try{localStorage.setItem(`walletName_${(t==null?void 0:t.uid)||"default"}_${W}`,String(a.name))}catch{}return}try{const s=localStorage.getItem(`walletName_${(t==null?void 0:t.uid)||"default"}_${W}`);s&&Id(String(s))}catch{}},[W,M]);const dl=async()=>{try{if(!W)return;const a=await Ma.autoResetLimitsIfNeeded(W);Ws(a)}catch(a){console.error("خطأ في جلب حدود المحفظة المختارة:",a)}};u.useEffect(()=>{dl()},[W]),u.useEffect(()=>{const a=s=>{var i;(i=s==null?void 0:s.detail)!=null&&i.walletId&&s.detail.walletId===W&&dl()};return window.addEventListener("walletLimitsUpdated",a),()=>window.removeEventListener("walletLimitsUpdated",a)},[W]),u.useEffect(()=>{const a=s=>{var i;try{const l=String(((i=s==null?void 0:s.detail)==null?void 0:i.walletId)||"");l&&Rr(l,"sms:auto")}catch{}};return window.addEventListener("walletSelection:update",a),()=>window.removeEventListener("walletSelection:update",a)},[M]),u.useEffect(()=>{if(h.state){if(console.log("Location state:",h.state),h.state.openDebtDialog&&(Fn(),window.history.replaceState({},document.title)),h.state.openSalesDialog&&(je||ke?p({title:"غير متاح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):As(!0),window.history.replaceState({},document.title)),h.state.openMaintenanceDialog&&(je||ke?p({title:"غير متاح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Nr(!0),window.history.replaceState({},document.title)),h.state.openCreditCardsDialog&&(console.log("Opening credit cards dialog"),je||ke?p({title:"غير متاح",description:"كروت الائتمان غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):wr(!0),window.history.replaceState({},document.title)),h.state.openShopExpensesDialog&&(je||ke?p({title:"غير متاح",description:"مصروفات المحل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Wt.hasMasterPin()?ws(!0):ss(!0),window.history.replaceState({},document.title)),h.state.openDeficienciesDialog&&(je||ke?p({title:"غير متاح",description:"النواقص غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):or(!0),window.history.replaceState({},document.title)),h.state.openInstallment&&(je||ke?p({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"}):vr(!0),window.history.replaceState({},document.title)),h.state.openTransactionSection){const a=document.getElementById("transaction-section");a&&a.scrollIntoView({behavior:"smooth"}),h.state.transactionType&&ro(h.state.transactionType),h.state.startNewTransaction&&(ur(""),ks(""),vn(""),wn(""),console.log("🔒 Starting new transaction without changing wallet selection")),h.state.focusWalletSelection&&setTimeout(()=>{const s=document.querySelector('[data-testid="wallet-select"]');s&&s.focus()},500),window.history.replaceState({},document.title)}h.state.openCashierShiftModal&&(!Jt||ke?p({title:"غير متاح",description:"وردية الكاشير متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"}):Ft(!0),window.history.replaceState({},document.title)),h.state.openMachineDailyDialog&&(!Jt||ke?p({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"}):jr(!0),window.history.replaceState({},document.title)),h.state.openBranchManagement&&((Nt==null?void 0:Nt.status)==="active"?La(!0):tr(!0),window.history.replaceState({},document.title)),h.state.openMyClientNumbersDialog&&(pn(!0),window.history.replaceState({},document.title))}},[h.state,M,ke,Nt]),u.useEffect(()=>{h.pathname==="/user/dashboard"&&sessionStorage.getItem("previousPath")==="/user/add-wallet"&&(console.log("🔄 Returned from wallet addition page - reloading wallets"),ul(),sessionStorage.removeItem("previousPath")),sessionStorage.setItem("previousPath",h.pathname)},[h.pathname,t==null?void 0:t.uid]),u.useEffect(()=>{if(!(t!=null&&t.uid))return;(async()=>{try{const s=Ae($,"users",t.uid),i=await ua(s);if(i.exists()){const d=i.data().isActive===!0;d&&!rr?(Fa(!0),Ba(!1),nr(!1)):!d&&rr&&(Fa(!1),Ba(!0))}}catch(s){console.error("Check user status error",s)}})()},[t==null?void 0:t.uid]),u.useEffect(()=>{if(!(t!=null&&t.uid))return;const a=i=>{const{userId:l}=i.detail;l===t.uid&&(console.log("🎉 Subscription activation event received for current user!"),Fa(!0),Ba(!1),nr(!1),setTimeout(()=>{console.log("✅ User activation completed - data updated")},1e3))},s=i=>{const l=i.detail||{},{userId:d,isActive:m}=l;d&&d===t.uid&&(console.log("🔄 User subscription update event received:",{userId:d,isActive:m}),m&&!rr&&(Fa(!0),Ba(!1),nr(!1),setTimeout(()=>{console.log("✅ User subscription updated - data refreshed")},1e3)))};return window.addEventListener("subscriptionActivated",a),window.addEventListener("userSubscriptionUpdated",s),()=>{window.removeEventListener("subscriptionActivated",a),window.removeEventListener("userSubscriptionUpdated",s)}},[t==null?void 0:t.uid,rr]),u.useEffect(()=>{const a=s=>{var m;const i=s.target,l=(m=i==null?void 0:i.tagName)==null?void 0:m.toLowerCase();if(!(l==="input"||l==="textarea"||l==="select"||((i==null?void 0:i.isContentEditable)??!1))&&!(s.ctrlKey||s.altKey||s.metaKey)&&!s.repeat){if((je||ke)&&s.key>="1"&&s.key<="9"){s.preventDefault();return}switch(s.key){case"1":break;case"2":vo(!0);break;case"3":je||ke?p({title:"غير متاح",description:"كروت الائتمان غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):wr(!0);break;case"4":Jt?Ft(!0):p({title:"غير متاح",description:"وردية الكاشير متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"});break;case"5":je||ke?p({title:"غير متاح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):As(!0);break;case"6":Fn();break;case"7":je||ke?p({title:"غير متاح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Nr(!0);break;case"8":Jt?jr(!0):p({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"});break;case"9":je||ke?p({title:"غير متاح",description:"مصروفات المحل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Wt.hasMasterPin()?ws(!0):ss(!0);break}}};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[je,ke,Jt]),u.useEffect(()=>{console.log("🔥 useEffect loadUserData started",{user:t==null?void 0:t.uid,isCheckingActivation:Fi}),(async()=>{try{if(!(t!=null&&t.uid)){console.log("🔥 No user UID, setting isCheckingActivation to false"),nr(!1);return}try{const m=await ua(Ae($,"users",t.uid));if(m.exists()){const g=m.data().isActive===!0,v=await Ou.checkTrialValidity(t.uid),y=v.isValid&&!v.isExpired;Fa(g||y),wc(y),Nc(v.hoursRemaining),jc(v.hasUsedTrial),Ba(!g&&!y),console.log("📊 حالة المستخدم:",{isActive:g,isOnTrial:y,hoursRemaining:v.hoursRemaining,hasUsedTrial:v.hasUsedTrial})}else Fa(!1),Ba(!0)}catch(m){console.error("خطأ في فحص حالة تفعيل المستخدم:",m),Fa(!1),Ba(!0)}finally{nr(!1)}if(console.log("🔄 بدء تحميل بيانات المستخدم من Firebase...",{userId:t==null?void 0:t.uid}),t!=null&&t.uid){const m=await ms(()=>oe.getUserData(t.uid)),f=`userData_${t==null?void 0:t.uid}`;let g=null;try{const v=localStorage.getItem(f);v&&(g=JSON.parse(v))}catch{}if(m){let v=(m==null?void 0:m.walletBalances)||{},y=m==null?void 0:m.cashBalance;const b=m.lastUpdated?new Date(m.lastUpdated).getTime():0;g&&(g.lastUpdated?new Date(g.lastUpdated).getTime():0)>=b&&(g.walletBalances&&(v=g.walletBalances),g.cashBalance!==void 0&&(y=g.cashBalance));try{const w=qe(),C=Ze(),k=localStorage.getItem(w+"_lastUpdated"),A=localStorage.getItem(C+"_lastUpdated"),L=k?new Date(k).getTime():0,_=A?new Date(A).getTime():0;if(L>b){const E=localStorage.getItem(w);E!==null&&(y=parseFloat(E))}if(_>b){const E=localStorage.getItem(C);if(E!==null)try{v=JSON.parse(E)}catch{}}}catch(w){console.error("Error checking individual keys fallback:",w)}lt(v),y!==void 0&&Xe(y);try{const w=t!=null&&t.uid?await ms(()=>Kr.getDeletedTransactionsByUser(t.uid)):[];yr(w||[])}catch{yr([])}}else{lt({});try{const v=t!=null&&t.uid?await Kr.getDeletedTransactionsByUser(t.uid):[];yr(v||[])}catch{yr([])}}}console.log("🔄 بدء تحميل المحافظ من Firebase...");try{const m=await ms(()=>pi.getByMerchantId((t==null?void 0:t.uid)||""));if(m&&m.length>0){console.log("✅ تم العثور على محافظ في Firebase:",m.length);const f=m.filter(w=>w.isActive===!0),g=f.map(w=>({id:w.id,name:w.label||"محفظة بدون اسم",phone:w.msisdn,isDefault:!1,monthlyWithdrawalLimit:w.monthlyWithdrawalLimit??w.withdrawLimit??2e5,monthlyTransferLimit:w.monthlyTransferLimit??w.transferLimit??2e5,defaultTransferCommission:w.defaultTransferCommission!=null?Number(w.defaultTransferCommission):null,defaultWithdrawCommission:w.defaultWithdrawCommission!=null?Number(w.defaultWithdrawCommission):null,ownerName:w.ownerName,nationalId:w.nationalId,providerName:w.provider}));se(g);const v={};f.forEach(w=>{w.balance!==void 0&&(v[w.id]=Number(w.balance))}),Object.keys(v).length>0&&lt(w=>({...w,...v}));const y=localStorage.getItem(ds());let b=null;y&&g.find(w=>w.id===y)?b=g.find(w=>w.id===y):b=g[0],b&&(sr(b.id),Ds(b.phone)),console.log("🔄 تم تحديث المحافظ من Firebase وحفظها في localStorage")}else console.log("⚠️ لا توجد محافظ في Firebase. سيتم عرض قائمة فارغة بدون أي استرجاع محلي."),se([])}catch(m){console.error("خطأ في تحميل المحافظ من Firebase:",m),se([])}const d=t!=null&&t.uid?await ms(()=>oe.getUserTransactions(t.uid)):[];if(d&&d.length>0){console.log("📊 تم تحميل المعاملات من Firebase:",d.length);const m=d.map(b=>({...b,createdAt:new Date(b.createdAt),senderPhone:b.senderMsisdn||b.senderPhone||"",receiverPhone:b.receiverMsisdn||b.receiverPhone||"",type:b.txnType==="send"?"send":b.txnType==="receive"?"withdraw":b.type||"withdraw",status:b.status==="confirmed"?"completed":b.status||"completed"})),f=xr.map(b=>b.id||b.originalTransactionId);let g=[];try{const b=Te(de($,"deletedTransactions"),K("userId","==",(t==null?void 0:t.uid)||""),K("permanent","==",!0));g=(await De(b)).docs.map(C=>{const k=C.data();return String(k.originalTransactionId||k.transactionId||C.id||"")}).filter(Boolean)}catch{}const v=new Set(g),y=m.filter(b=>{var _;const w=String(b.id||""),C=String(b.transactionId||""),k=String(b.reference||b.transactionReference||((_=b.receipt)==null?void 0:_.reference)||""),A=f.includes(w),L=v.has(w)||C&&v.has(C);return!A&&!L});console.log("✅ تم فلترة المعاملات المحذوفة:",{total:d.length,deleted:f.length,active:y.length});{const b=new Set,w=[];for(const C of y){const k=el(C);b.has(k)||(b.add(k),w.push(C))}df||$t(w)}}await Hd()}catch(d){console.error("خطأ في تحميل بيانات المستخدم من Firebase:",d)}})().then(async()=>{await l(),await s(),await i()});const s=async()=>{try{if(!(t!=null&&t.uid))return;const d=await pi.getByMerchantId(t.uid);await Promise.all(d.map(m=>Hb.autoResetLimitsIfNeeded(m.id)))}catch(d){console.error("خطأ في التصفير التلقائي للحدود:",d)}},i=async()=>{try{await _t.syncReportsDataFromFirebase(t==null?void 0:t.uid);const d=_t.getReportsData(t==null?void 0:t.uid);if((d.lastDailyResetDate?_t.shouldResetDailyReports(d.lastDailyResetDate):!1)&&(t!=null&&t.uid)&&d.lastDailyResetDate){const g=new Date(d.lastDailyResetDate),v=g.toDateString(),y=ue.filter(_=>new Date(_.createdAt).toDateString()===v&&_.status==="completed"),b=y.length,w=y.reduce((_,E)=>_+E.amount,0),C=y.filter(Wr).reduce((_,E)=>{const q=E.withdrawnAmount!==void 0?E.withdrawnAmount:E.amount;return _+q},0),k=y.filter(Lr).reduce((_,E)=>{const q=E.sentAmount!==void 0?E.sentAmount:E.amount;return _+q},0),A=y.reduce((_,E)=>_+_t.calculateTransactionProfit(E),0),L=new Date(g).toISOString().slice(0,10);await Br.add({userId:t.uid,reportDate:L,totalTransactions:b,totalAmount:Number(w.toFixed(2)),totalWithdrawn:Number(C.toFixed(2)),totalSent:Number(k.toFixed(2)),profit:Number(A.toFixed(2)),walletId:null})}const f=_t.autoResetReportsIfNeeded(t==null?void 0:t.uid);(f.dailyReset||f.monthlyReset)&&console.log("تم التصفير التلقائي:",f)}catch(d){console.error("خطأ في التصفير التلقائي للتقارير:",d)}},l=async()=>{try{if(!(t!=null&&t.uid))return;const d=new Date;if(d.getDate()!==1)return;const m=`${d.getFullYear()}-${d.getMonth()+1}`,f=`lastMonthlyDbCleanup:${t.uid}`;if(localStorage.getItem(f)===m)return;const v=new Date(d.getFullYear(),d.getMonth(),1,0,0,0,0),y=C=>C instanceof Date?C:typeof(C==null?void 0:C.toDate)=="function"?C.toDate():new Date(String(C));let b=[];try{const C=Te(de($,"userTransactions"),K("userId","==",t.uid),K("createdAt","<",v));b=(await De(C)).docs}catch{const C=Te(de($,"userTransactions"),K("userId","==",t.uid));b=(await De(C)).docs.filter(A=>{var L;return y((L=A.data())==null?void 0:L.createdAt)<v})}await Promise.allSettled(b.map(C=>wu(C.ref)));let w=[];try{const C=Te(de($,"transactions"),K("userId","==",t.uid),K("createdAt","<",v));w=(await De(C)).docs}catch{const C=Te(de($,"transactions"),K("userId","==",t.uid));w=(await De(C)).docs.filter(A=>{var L;return y((L=A.data())==null?void 0:L.createdAt)<v})}await Promise.allSettled(w.map(C=>wu(C.ref)));try{localStorage.setItem(f,m)}catch{}console.log("✅ تم تنظيف قاعدة البيانات شهريًا (Firebase فقط):",{userTransactionsDeleted:b.length,globalTransactionsDeleted:w.length,monthStart:v})}catch(d){console.error("فشل التنظيف الشهري التلقائي لقاعدة البيانات:",d)}};a0(),Bo(),p0(),console.log("🔥 useEffect loadUserData completed")},[t==null?void 0:t.uid]),u.useEffect(()=>{if(!(t!=null&&t.uid))return;const a=oe.subscribeToUserTransactions(t.uid,s=>{if(!s||s.length===0)return;const i=s.map(l=>({...l,createdAt:new Date(l.createdAt),senderPhone:l.senderMsisdn||l.senderPhone||"",receiverPhone:l.receiverMsisdn||l.receiverPhone||"",type:l.txnType==="send"?"send":l.txnType==="receive"?"withdraw":l.type||"withdraw",status:l.status==="confirmed"?"completed":l.status||"completed"}));$t(l=>{const d=[...i,...l],m=new Set,f=[];for(const g of d){const v=el(g);m.has(v)||(m.add(v),f.push(g))}return f.sort((g,v)=>{const y=g.createdAt instanceof Date?g.createdAt.getTime():new Date(g.createdAt).getTime();return(v.createdAt instanceof Date?v.createdAt.getTime():new Date(v.createdAt).getTime())-y})})},30);return()=>a()},[t==null?void 0:t.uid]),u.useEffect(()=>{const a=j||(n==null?void 0:n.shopId);if(!a)return;const s=oe.subscribeToDashboardData(a,i=>{if(!i)return;const l=Number(i.cashBalance||0);Xe(l);const d=i.walletBalances&&typeof i.walletBalances=="object"?i.walletBalances:{};lt(d);try{if(localStorage.setItem(qe(),String(l)),localStorage.setItem(Ze(),JSON.stringify(d)),i.lastUpdated){const m=String(i.lastUpdated);localStorage.setItem(qe()+"_lastUpdated",m),localStorage.setItem(Ze()+"_lastUpdated",m)}}catch(m){console.error("Error saving real-time dashboard data to local storage",m)}});return()=>s()},[j,n==null?void 0:n.shopId]);const ul=async()=>{var a;if(t!=null&&t.uid)try{const s=await ms(()=>pi.getByMerchantId(t.uid));if(s&&s.length>0){const l=s.filter(d=>d.isActive===!0).map(d=>({id:d.id,name:d.label||"محفظة بدون اسم",phone:d.msisdn,isDefault:!1,monthlyWithdrawalLimit:d.monthlyWithdrawalLimit??d.withdrawLimit??2e5,monthlyTransferLimit:d.monthlyTransferLimit??d.transferLimit??2e5,defaultTransferCommission:d.defaultTransferCommission!=null?Number(d.defaultTransferCommission):void 0,defaultWithdrawCommission:d.defaultWithdrawCommission!=null?Number(d.defaultWithdrawCommission):void 0}));if(se(l),t!=null&&t.uid){const d=localStorage.getItem(ds());if(!!(W&&l.find(f=>f.id===W)))console.log("🔒 Preserving current wallet selection:",W);else{const g=(d&&l.find(v=>v.id===d)?d:null)||((a=l[0])==null?void 0:a.id);g&&(console.log("🔄 Fixing invalid wallet selection:",g),Rr(g))}}console.log("🔄 تم تحديث المحافظ من Firebase:",l.length)}}catch(s){console.error("خطأ في تحميل المحافظ من Firebase:",s)}};u.useEffect(()=>{const a=h.pathname;if(sessionStorage.getItem("previousPath")==="/user/add-wallet"&&a==="/user/dashboard"){O.invalidateQueries({queryKey:["wallets",t==null?void 0:t.uid]});try{Dn.refetch()}catch{}sessionStorage.removeItem("previousPath")}sessionStorage.setItem("previousPath",a)},[h.pathname,t==null?void 0:t.uid]),u.useEffect(()=>{const a=()=>{O.invalidateQueries({queryKey:["wallets",t==null?void 0:t.uid]});try{Dn.refetch()}catch{}};return window.addEventListener("focus",a),()=>{window.removeEventListener("focus",a)}},[t==null?void 0:t.uid,W,M]);const Rr=async(a,s="unknown")=>{console.log(`🎯 setWalletSelection called from ${s} with walletId:`,a),console.log("🔍 Previous selectedWallet:",W),sr(a);const i=M.find(l=>l.id===a);if(i&&(Ds(i.phone),console.log("✅ Wallet set successfully:",a,"Phone:",i.phone)),t!=null&&t.uid){localStorage.setItem(ds(),a),console.log("💾 Saved wallet to localStorage:",a);try{await $r.set({key:"selected_wallet_id",value:a}),await $r.set({key:"current_user_id",value:t.uid}),console.log("📱 Saved wallet and user ID to Capacitor Preferences:",a,t.uid)}catch(l){console.error("❌ Failed to save to Capacitor Preferences:",l)}}};u.useEffect(()=>{const a=()=>{ul()};try{window.addEventListener("wallets:activation-updated",a)}catch{}return()=>{try{window.removeEventListener("wallets:activation-updated",a)}catch{}}},[t==null?void 0:t.uid]);const M0=a=>{if(a==="__add_wallet"){x("/user/add-wallet");return}if(a==="__view_wallets"){bn(!0);return}Bg.isEnabled(t==null?void 0:t.uid)?(eo(a),Zi(!0)):Rr(a,"walletSelectionNoPin")},ci=a=>{console.log("🔄 handleTransactionTypeChange called with type:",a),console.log("🔍 Current selectedWallet before change:",W),console.log("🔍 Available wallets count:",M.length),ro(a),ur(""),ks(""),vn(""),wn(""),console.log("✅ Transaction type changed to:",a,"- Wallet selection preserved:",W),setTimeout(()=>{const s=document.getElementById("transaction-section");s&&s.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)};u.useEffect(()=>{const a=s=>{const i=s.target;if(!!i&&(i.tagName==="INPUT"||i.tagName==="TEXTAREA"||i.tagName==="SELECT"||i.isContentEditable)||(s.key==="ArrowLeft"?(s.preventDefault(),ci("withdraw")):s.key==="ArrowRight"&&(s.preventDefault(),ci("transfer"))),s.key==="Enter"){if(document.querySelector('[role="dialog"]'))return;const d=F==="transfer"?"transferSubmitButton":"withdrawSubmitButton",m=document.getElementById(d);m&&!m.disabled&&(s.preventDefault(),m.click())}};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[F]);const su=a=>{of((i=>{const l=String(i.description||""),d=String(i.title||""),m=l.includes("تحويل مكنه")||l.includes("تحويل مكينه")||l.includes("machine transfer")||d.includes("تحويل مكنه")||d.includes("تحويل مكينه"),f=String((i==null?void 0:i.provider)||"").toLowerCase(),g=f.includes("vodafone")?"vf-cash":f.includes("instapay")?"instapay":"",v=i.type==="send"?"تحويل":"سحب";let y=i.type==="withdraw"&&g?`${v} ${g}`:v;return m?y="تحويل مكينه":i.title&&(y=i.title),{id:i.id,type:m||i.type==="send"||i.type==="transfer"?"transfer":"withdraw",sender_msisdn:i.senderPhone,receiver_msisdn:i.receiverPhone,amount:i.amount,commission:i.commission||0,fee:(i==null?void 0:i.fee)??0,status:i.status==="failed"?"failed":i.status==="completed"?"completed":"pending",createdAt:new Date(i.createdAt).toISOString(),updatedAt:new Date(i.createdAt).toISOString(),shopName:T??(n==null?void 0:n.shopName)??(t==null?void 0:t.displayName)??"المحل",cashierName:(i==null?void 0:i.cashierName)??null,commissionMode:(i==null?void 0:i.commissionMode)??(i.type==="send"||Je?"add":"deduct"),totalCharged:(i==null?void 0:i.totalCharged)??(i.type==="send"?Number(i.amount||0)+Number(i.commission||0)+Number((i==null?void 0:i.fee)||0):Je?Number(i.amount||0)+Number(i.commission||0):Number(i.amount||0)),note:(i==null?void 0:i.note)??(i==null?void 0:i.notes)??void 0,senderName:(i==null?void 0:i.senderName)??void 0,provider:(i==null?void 0:i.provider)??void 0,title:y,description:(i==null?void 0:i.description)??void 0}})(a)),kn(!0)},R0=async a=>{var d;if(!(t!=null&&t.uid)){p({title:"خطأ في المصادقة",description:"يجب تسجيل الدخول أولاً لحذف المعاملات",variant:"destructive"});return}const s=ue.find(m=>m.id===a);if(!s){p({title:"خطأ في الحذف",description:"لم يتم العثور على المعاملة المطلوب حذفها",variant:"destructive"});return}const i=String(a),l=String((s==null?void 0:s.transactionId)||(s==null?void 0:s.reference)||"");ga.current.add(i),l&&ga.current.add(l);try{console.log("🗑️ بدء عملية حذف المعاملة:",a),console.log("🔄 حذف المعاملة نهائياً من Firebase...",{transactionId:s.id,userId:t.uid,transactionData:s}),await oe.removeUserTransaction(t.uid,s.id),console.log("✅ تم حذف المعاملة نهائياً من Firebase userTransactions");try{await Kr.saveDeletedTransaction({...s,userId:t.uid,originalTransactionId:s.id,transactionId:s.transactionId||s.id,reference:s.reference||s.transactionReference||((d=s.receipt)==null?void 0:d.reference),deletedAt:new Date().toISOString(),permanent:!0}),console.log("✅ تم حفظ المعاملة في سجل المحذوفات مع تاريخ الحذف")}catch(g){console.warn("⚠️ فشل في حفظ المعاملة في سجل المحذوفات، لكن الحذف من Firebase نجح:",g)}try{await Kr.permanentlyDeleteTransaction(s.id,t.uid)}catch(g){console.warn("⚠️ فشل وسم الحذف النهائي أو التنظيف الإضافي:",g)}const m=[...xr,s],f=ue.filter(g=>g.id!==a);yr(m),$t(f),$c(!1),console.log("✅ تم تحديث الحالة بعد الحذف من Firebase (بدون نسخ محلية)");try{const g=s.fromWallet;if(g){const{walletDailyLimitsService:v}=await ne(async()=>{const{walletDailyLimitsService:b}=await import("./index-CZwBW8vR.js").then(w=>w.cN);return{walletDailyLimitsService:b}},__vite__mapDeps([0,1]),import.meta.url),y=await v.getWalletLimits(g);if(y){const b=s.type==="send",w={updatedAt:(await ne(async()=>{const{serverTimestamp:_}=await import("./index-CZwBW8vR.js").then(E=>E.cE);return{serverTimestamp:_}},__vite__mapDeps([0,1]),import.meta.url)).serverTimestamp()};b?(w.dailyTransferUsed=Math.max(0,(y.dailyTransferUsed||0)-s.amount),w.monthlyTransferUsed=Math.max(0,(y.monthlyTransferUsed||0)-s.amount)):(w.dailyWithdrawUsed=Math.max(0,(y.dailyWithdrawUsed||0)-s.amount),w.monthlyWithdrawUsed=Math.max(0,(y.monthlyWithdrawUsed||0)-s.amount));const{doc:C,setDoc:k}=await ne(async()=>{const{doc:_,setDoc:E}=await import("./index-CZwBW8vR.js").then(q=>q.cE);return{doc:_,setDoc:E}},__vite__mapDeps([0,1]),import.meta.url),{db:A}=await ne(async()=>{const{db:_}=await import("./index-CZwBW8vR.js").then(E=>E.cF);return{db:_}},__vite__mapDeps([0,1]),import.meta.url),L=C(A,"walletLimits",g);await k(L,w,{merge:!0})}}}catch(g){console.warn("فشل استرجاع حدود المحفظة بعد الحذف:",g)}try{const{ProfitService:g}=await ne(async()=>{const{ProfitService:C}=await import("./profitService-BUBYCoKY.js");return{ProfitService:C}},__vite__mapDeps([47,0,1]),import.meta.url),{ReportsService:v}=await ne(async()=>{const{ReportsService:C}=await import("./index-CZwBW8vR.js").then(k=>k.cM);return{ReportsService:C}},__vite__mapDeps([0,1]),import.meta.url),b={txnType:s.type==="send"?"send":"receive",amount:s.amount,commission:s.commission||0,createdAt:s.createdAt,status:"confirmed"},w=g.calculateProfitFromTransaction(b);w>0&&g.addProfit(-w,t.uid);try{v.removeTransactionEffects(s,t.uid)}catch{}}catch(g){console.warn("فشل تحديث الأرباح/التقارير بعد الحذف:",g)}p({title:"تم حذف المعاملة نهائياً",description:"تم حذف المعاملة نهائياً من النظام. يمكنك العثور عليها في قائمة المحذوفات"})}catch(m){console.error("❌ خطأ في حذف المعاملة من Firebase:",m);let f="فشل في حذف المعاملة من الخادم. يرجى المحاولة مرة أخرى";m instanceof Error&&(m.message.includes("network")||m.message.includes("offline")?f="مشكلة في الاتصال بالإنترنت. تحقق من الاتصال وحاول مرة أخرى":m.message.includes("permission")||m.message.includes("unauthorized")?f="ليس لديك صلاحية لحذف هذه المعاملة":m.message.includes("not-found")&&(f="المعاملة غير موجودة أو تم حذفها مسبقاً")),p({title:"خطأ في الحذف",description:f,variant:"destructive"})}},Wr=a=>{const s=(a.type||"").toLowerCase(),i=(a.txnType||"").toLowerCase();return s==="withdraw"||s==="withdrawal"||s==="receive"||i==="receive"},Lr=a=>{const s=(a.type||"").toLowerCase(),i=(a.txnType||"").toLowerCase();return s==="send"||s==="transfer"||i==="send"},ru=a=>a.title==="إيصال سحب فوري",nu=(a,s)=>{const i=new Date().toDateString();let l=ue.filter(y=>{const b=new Date(y.createdAt).toDateString()===i,w=String(y.status||"").toLowerCase();return b&&(w==="completed"||w==="confirmed"||w==="pending")});pa&&pa.trim()!==""&&(l=l.filter(y=>y.senderPhone&&y.senderPhone.includes(pa)||y.receiverPhone&&y.receiverPhone.includes(pa)));const d=_t.filterVisibleTransactions(l,"daily",t==null?void 0:t.uid),m=d.length,f=d.reduce((y,b)=>y+b.amount,0),g=d.filter(Wr).reduce((y,b)=>{const w=b.withdrawnAmount!==void 0?b.withdrawnAmount:b.amount;return y+w},0),v=d.filter(y=>Lr(y)&&!ru(y)).reduce((y,b)=>{const w=b.sentAmount!==void 0?b.sentAmount:b.amount;return y+w},0);return{totalTransactions:m,totalAmount:f,totalWithdrawn:g,totalSent:v}},W0=a=>{const s=new Date().getMonth(),i=new Date().getFullYear();let l=ue.filter(y=>{const b=new Date(y.createdAt);return b.getMonth()===s&&b.getFullYear()===i&&y.status==="completed"});pa&&pa.trim()!==""&&(l=l.filter(y=>y.senderPhone&&y.senderPhone.includes(pa)||y.receiverPhone&&y.receiverPhone.includes(pa)));const d=_t.filterVisibleTransactions(l,"monthly",t==null?void 0:t.uid),m=d.length,f=d.reduce((y,b)=>y+b.amount,0),g=d.filter(Wr).reduce((y,b)=>{const w=b.withdrawnAmount!==void 0?b.withdrawnAmount:b.amount;return y+w},0),v=d.filter(y=>Lr(y)&&!ru(y)).reduce((y,b)=>{const w=b.sentAmount!==void 0?b.sentAmount:b.amount;return y+w},0);return{totalTransactions:m,totalAmount:f,totalWithdrawn:g,totalSent:v}},L0=a=>{const s=new Date().getMonth(),i=new Date().getFullYear(),l=ue.filter(f=>{const g=new Date(f.createdAt);return g.getMonth()===s&&g.getFullYear()===i&&f.status==="completed"&&f.fromWallet===a}),d=l.filter(Wr).reduce((f,g)=>{const v=g.withdrawnAmount||g.amount;return f+v},0),m=l.filter(Lr).reduce((f,g)=>{const v=g.sentAmount||g.amount;return f+v},0);return{totalWithdrawn:d,totalTransferred:m}},F0=a=>{const s=new Date,i=s.getDate(),l=s.getMonth(),d=s.getFullYear(),m=ue.filter(v=>{const y=new Date(v.createdAt);return y.getDate()===i&&y.getMonth()===l&&y.getFullYear()===d&&v.status==="completed"&&v.fromWallet===a}),f=m.filter(Wr).reduce((v,y)=>{const b=y.withdrawnAmount||y.amount;return v+b},0),g=m.filter(Lr).reduce((v,y)=>{const b=y.sentAmount||y.amount;return v+b},0);return{totalWithdrawn:f,totalTransferred:g}},Ls=ae.useMemo(()=>W0(),[ue,W,pa]),di=ae.useMemo(()=>nu(),[ue,W,pa,t==null?void 0:t.uid]);Ls.totalWithdrawn,Ls.totalSent;const _a=ae.useMemo(()=>L0(W),[ue,W]),B0=ae.useMemo(()=>F0(W),[ue,W]),Fs=ae.useMemo(()=>{try{return JSON.parse(localStorage.getItem($d())||"[]")}catch{return[]}},[t==null?void 0:t.uid]);u.useEffect(()=>{try{if(!W||M.length===0)return;const a=M.find(k=>k.id===W);if(!a)return;const s=(be==null?void 0:be.monthlyWithdrawLimit)??(a==null?void 0:a.monthlyWithdrawalLimit)??2e5,i=(be==null?void 0:be.monthlyTransferLimit)??(a==null?void 0:a.monthlyTransferLimit)??2e5,l=parseFloat(xt||"0")||0,d=(_a==null?void 0:_a.totalWithdrawn)??(be==null?void 0:be.monthlyWithdrawUsed)??0,m=(_a==null?void 0:_a.totalTransferred)??(be==null?void 0:be.monthlyTransferUsed)??0,f=d+(F==="withdraw"?l:0),g=m+(F==="transfer"?l:0),v=.85,y=Math.floor(Math.max(s,1)*v),b=Math.floor(Math.max(i,1)*v),w=(()=>{const k=new Date;return`${k.getFullYear()}-${String(k.getMonth()+1).padStart(2,"0")}`})(),C=`monthlyLimitWarnShown:${W}:${w}`;if(f>=y){const k=`${C}:withdraw`;if(!(localStorage.getItem(k)==="true")){Mc({type:"withdraw",used:f,limit:s,walletName:a.name}),Oc(!0);try{localStorage.setItem(k,"true")}catch{}return}}if(g>=b){const k=`${C}:transfer`;if(!(localStorage.getItem(k)==="true")){Mc({type:"transfer",used:g,limit:i,walletName:a.name}),Oc(!0);try{localStorage.setItem(k,"true")}catch{}return}}}catch{}},[W,M,be,_a,F,xt]);const iu=async(a,s=!1)=>{var d,m,f,g;if(X.current)return;if(D&&(S!=null&&S.permissions)){if(F==="transfer"&&S.permissions.transfers===!1){ve(!0);return}if(F==="withdraw"&&S.permissions.withdrawals===!1){ve(!0);return}}const i=F==="withdraw"&&(s||na||!Je);X.current=!0,Ve(!0);const l=()=>{F==="transfer"?Ts(!1):br(!1),X.current=!1,Ve(!1)};try{if(yv(),console.log("🔄 بدء عملية التحويل/السحب"),console.log("📊 البيانات المدخلة:",{senderPhone:Yt,receiverPhone:jt,amount:xt,transactionType:F}),(()=>{F==="transfer"?Ts(!0):br(!0)})(),!Yt||!xt){console.log("❌ خطأ: بيانات ناقصة"),p({title:"خطأ في البيانات",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"}),l();return}if(F==="transfer"&&!jt&&!c){console.log("❌ خطأ: رقم المستقبل مفقود"),p({title:"خطأ في البيانات",description:"يرجى إدخال رقم المستقبل",variant:"destructive"}),l();return}if(F==="transfer"&&!c){const Y=String(jt||"").replace(/[^0-9٠-٩]/g,"");if(!/[^0-9٠-٩\s]/.test(String(jt||""))&&!bv(jt)){p({title:"رقم المستقبل غير صالح",description:"اكتب رقم صحيح مكون من 11 رقم ويبدأ بـ 015 أو 010 أو 012 أو 011",variant:"destructive"}),l();return}}const y=parseFloat(xt);if(console.log("💰 المبلغ المحول:",y),y<=0){console.log("❌ خطأ: مبلغ غير صحيح"),p({title:"خطأ في المبلغ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"}),l();return}if(je)try{const Y=new Date,ce=Y.getFullYear(),Me=String(Y.getMonth()+1).padStart(2,"0"),Qe=String(Y.getDate()).padStart(2,"0"),vt=`zeroPlanDailyConfirmCount:${(t==null?void 0:t.uid)||"default"}:${ce}-${Me}-${Qe}`,Ot=localStorage.getItem(vt);if((Ot&&parseInt(Ot,10)||0)>=10){p({title:"حد التأكيد اليومي",description:"باقة زيرو تسمح بـ 10 تأكيدات تحويل/سحب يومياً فقط.",variant:"destructive"}),l();return}}catch(Y){console.warn("فشل قراءة عداد تأكيدات باقة زيرو من التخزين المحلي:",Y)}const b=M.find(Y=>Y.id===W);if(!b){p({title:"خطأ في المحفظة",description:"يرجى اختيار محفظة صحيحة",variant:"destructive"}),l();return}const w=_a;if(console.log("📈 فحص الحدود الشهرية للمحفظة المختارة"),console.log("📊 الإحصائيات الشهرية للمحفظة:",{walletId:W,walletName:b.name,currentWithdrawn:w.totalWithdrawn,currentTransferred:w.totalTransferred,withdrawalLimit:b.monthlyWithdrawalLimit,transferLimit:b.monthlyTransferLimit}),F==="withdraw"){if(console.log("🏧 فحص حد السحب الشهري للمحفظة"),console.log(`💸 المسحوب حالياً من المحفظة: ${w.totalWithdrawn}, المبلغ الجديد: ${y}, الحد الأقصى: ${b.monthlyWithdrawalLimit}`),w.totalWithdrawn+y>b.monthlyWithdrawalLimit){console.log("❌ تجاوز حد السحب الشهري للمحفظة"),p({title:"تجاوز حد السحب الشهري",description:`لا يمكن سحب أكثر من ${b.monthlyWithdrawalLimit} جنيه شهرياً من محفظة ${b.name}`,variant:"destructive"}),l();return}}else if(console.log("💸 فحص حد التحويل الشهري للمحفظة"),console.log(`📤 المحول حالياً من المحفظة: ${w.totalTransferred}, المبلغ الجديد: ${y}, الحد الأقصى: ${b.monthlyTransferLimit}`),w.totalTransferred+y>b.monthlyTransferLimit){console.log("❌ تجاوز حد التحويل الشهري للمحفظة"),p({title:"تجاوز حد التحويل الشهري",description:`لا يمكن تحويل أكثر من ${b.monthlyTransferLimit} جنيه شهرياً من محفظة ${b.name}`,variant:"destructive"}),l();return}const C=(n==null?void 0:n.shopName)||(t==null?void 0:t.displayName)||"محل كاشي لينك",k={id:Date.now().toString(),type:F==="transfer"?"send":F==="deposit"?"deposit":"withdraw",senderPhone:Yt,receiverPhone:F==="transfer"?jt:Yt,amount:y,status:"completed",createdAt:new Date,withdrawnAmount:F==="withdraw"?y:void 0,sentAmount:F==="transfer"?y:void 0,depositedAmount:void 0,fromWallet:W,senderNumber:Yt,senderName:F==="withdraw"&&mr.trim()!==""?mr.trim():void 0,shopName:(b==null?void 0:b.name)||"المحفظة الرئيسية",transferredAmount:F==="transfer"?y:void 0,receiverNumber:F==="transfer"?jt:void 0,withdrawnAmountDetailed:F==="withdraw"?y:void 0,depositedAmountDetailed:void 0,merchantShopName:C,transactionReference:`TXN-${Date.now()}`,commission:0,notes:F==="transfer"?void 0:rs&&rs.trim()!==""?rs.trim():void 0};D&&(S!=null&&S.name||S!=null&&S.username)&&(k.cashierName=(S==null?void 0:S.name)||(S==null?void 0:S.username));const A=Js.validateTransaction(y,F,$e,Ne);if(!A.isValid){p({title:"خطأ في العملية",description:A.error,variant:"destructive"}),l();return}A.warning&&p({title:"تحذير",description:A.warning,variant:"destructive"});let L;if(F==="transfer")if((b==null?void 0:b.defaultTransferCommission)!=null){const Y=Number(b.defaultTransferCommission)||0;L=Math.round(Y*y/1e3*100)/100}else St&&St.trim()!==""?L=Math.max(0,parseFloat(St)):L=0;else if((b==null?void 0:b.defaultWithdrawCommission)!=null){const Y=Number(b.defaultWithdrawCommission)||0;L=Math.round(Y*y/1e3*100)/100}else dt&&dt.trim()!==""?L=Math.max(0,parseFloat(dt)):L=Math.round(y*.01*100)/100;if(k.commission=L,F!=="transfer"&&!Je&&L>=y){p({title:"خطأ في العمولة",description:"العمولة أكبر من أو تساوي المبلغ المدخل",variant:"destructive"}),l();return}const _=F==="transfer"?y:i?Math.round((y-L)*100)/100:y;F==="withdraw"&&Jc(i?`سلم للعميل: ${_} جنيه`:null),k.amount=i?y:_,k.withdrawnAmount=F==="withdraw"?i?y:_:void 0,k.sentAmount=F==="transfer"?_:void 0,k.transferredAmount=F==="transfer"?_:void 0,k.withdrawnAmountDetailed=F==="withdraw"?i?y:_:void 0;let E;const q=F==="transfer"&&!!sa,ie=F==="withdraw"&&!!sa,ee=q||ie;let Ce=null;const et=hr(Yt||"").replace(/\D/g,""),tt=hr(jt||"").replace(/\D/g,""),Ie=F==="transfer"&&(et.startsWith("010")&&(tt.startsWith("011")||tt.startsWith("012")||tt.startsWith("015"))||et.startsWith("012")&&tt.startsWith("010")||et.startsWith("011")&&tt.startsWith("010")||et.startsWith("015")&&tt.startsWith("010")),he=Math.max(0,parseFloat(Ec||"0")),at=Math.round(L*100)/100;if(k.commission=at,k.fee=he,k.totalCharged=F==="transfer"?Number(_)+Number(at)+Number(he):Je?Number(_)+Number(at):Number(y),so&&Ie&&!ee&&he<=0){p({title:"خطأ",description:"أدخل رسوم التحويل لعمليات 010 → 011/012/015 أو 012 → 010 أو 011 → 010 أو 015 → 010",variant:"destructive"}),l();return}if(F==="transfer"&&!ee){const Y=Number(Ne[W]||0),ce=Number(_)+Number(he);if(Y<ce){p({title:"رصيد المحفظة غير كافٍ",description:`الرصيد الحالي ${Y} لا يكفي لخصم ${ce}`,variant:"destructive"}),l();return}}if(ee)if(q){const Y=Js.validateTransaction(_,"transfer",$e,Ne);if(!Y.isValid)E={success:!1,newCashBalance:$e,newWalletBalances:Ne,message:Y.error||"رصيد غير كافٍ للتحويل المؤجل",error:"INSUFFICIENT_WALLET_BALANCE"};else{const ce=W||((d=M.find(_e=>_e.isDefault))==null?void 0:d.id)||((m=M[0])==null?void 0:m.id),Me=be??await Ma.getWalletLimits(ce),Qe=new Date().toDateString(),vt=ue.filter(_e=>_e.type==="send"&&String(_e.status||"").toLowerCase()==="pending"&&_e.fromWallet===ce&&new Date(_e.createdAt).toDateString()===Qe).reduce((_e,Ct)=>_e+Number(Ct.sentAmount??Ct.transferredAmount??Ct.amount??0),0),Ot=Number((Me==null?void 0:Me.dailyTransferLimit)??6e4),Ht=Number((Me==null?void 0:Me.dailyTransferUsed)??0);if(Ht+vt+Number(_)>Ot){p({title:"تجاوز الحد اليومي للتحويل",description:`المتبقي اليوم: ${(Ot-Ht-vt).toLocaleString()} ج.م`,variant:"destructive"}),l();return}const st=new Date,kt=ue.filter(_e=>_e.type==="send"&&String(_e.status||"").toLowerCase()==="pending"&&_e.fromWallet===ce&&new Date(_e.createdAt).getMonth()===st.getMonth()&&new Date(_e.createdAt).getFullYear()===st.getFullYear()).reduce((_e,Ct)=>_e+Number(Ct.sentAmount??Ct.transferredAmount??Ct.amount??0),0),Mt=Number((Me==null?void 0:Me.monthlyTransferLimit)??2e5),Bs=Number((Me==null?void 0:Me.monthlyTransferUsed)??0);if(Bs+kt+Number(_)>Mt){p({title:"تجاوز الحد الشهري للتحويل",description:`المتبقي هذا الشهر: ${(Mt-Bs-kt).toLocaleString()} ج.م`,variant:"destructive"}),l();return}E={success:!0,newCashBalance:$e,newWalletBalances:Ne}}}else{const Y=W||((f=M.find(_e=>_e.isDefault))==null?void 0:f.id)||((g=M[0])==null?void 0:g.id),ce=be??await Ma.getWalletLimits(Y),Me=new Date().toDateString(),Qe=ue.filter(_e=>_e.type==="withdraw"&&String(_e.status||"").toLowerCase()==="pending"&&_e.fromWallet===Y&&new Date(_e.createdAt).toDateString()===Me).reduce((_e,Ct)=>_e+Number(Ct.withdrawnAmount??Ct.amount??0),0),vt=Number((ce==null?void 0:ce.dailyWithdrawLimit)??1e5),Ot=Number((ce==null?void 0:ce.dailyWithdrawUsed)??0);if(Ot+Qe+Number(_)>vt){p({title:"تجاوز الحد اليومي للسحب",description:`المتبقي اليوم: ${(vt-Ot-Qe).toLocaleString()} ج.م`,variant:"destructive"}),l();return}const Ht=new Date,st=ue.filter(_e=>_e.type==="withdraw"&&String(_e.status||"").toLowerCase()==="pending"&&_e.fromWallet===Y&&new Date(_e.createdAt).getMonth()===Ht.getMonth()&&new Date(_e.createdAt).getFullYear()===Ht.getFullYear()).reduce((_e,Ct)=>_e+Number(Ct.withdrawnAmount??Ct.amount??0),0),kt=Number((ce==null?void 0:ce.monthlyWithdrawLimit)??2e5),Mt=Number((ce==null?void 0:ce.monthlyWithdrawUsed)??0);if(Mt+st+Number(_)>kt){p({title:"تجاوز الحد الشهري للسحب",description:`المتبقي هذا الشهر: ${(kt-Mt-st).toLocaleString()} ج.م`,variant:"destructive"}),l();return}E={success:!0,newCashBalance:Math.round((Number($e)-Number(_))*100)/100,newWalletBalances:Ne}}else F==="transfer"?E=await Js.processTransfer({amount:_,currentCashBalance:$e,currentWalletBalances:Ne,wallets:M,selectedWalletId:W,skipRemoteLimitsCheck:!1,nonBlockingUsageUpdate:!0}):E=await Js.processWithdraw({amount:_,currentCashBalance:$e,currentWalletBalances:Ne,wallets:M,selectedWalletId:W,skipRemoteLimitsCheck:!1,nonBlockingUsageUpdate:!0});if(!E.success){p({title:"فشل في العملية",description:E.error||E.message,variant:"destructive"}),l();return}let mt=ee?ie?E.newCashBalance:$e:E.newCashBalance,ot=ee?Ne:E.newWalletBalances;if(!ee&&i&&F==="withdraw"){const Y=W,ce=Number(ot[Y]||0);ot={...ot,[Y]:Math.round((ce+L)*100)/100}}if(!ee&&F==="transfer"&&he>0){const Y=Number(ot[W]||0);ot={...ot,[W]:Math.round((Y-Number(he))*100)/100}}if(ee&&q){const Y=M.find(Qe=>Qe.id===W)??M.find(Qe=>Qe.isDefault)??M[0],ce=(Y==null?void 0:Y.id)||W;if(ce!==W)try{Rr(ce)}catch{}const Me=Number(Ne[ce]||0);ot={...Ne,[ce]:Math.round((Me-Number(_)-Number(he))*100)/100}}if((q||ie)&&sa&&!Th){const Y={id:`DEBT-${Date.now()}`,debtorName:sa.debtorName,amount:sa.amount,reason:sa.notes||"",customerId:sa.customerId,mobile:sa.mobile,status:"pending",createdAt:new Date};Ce=Y.id,k.linkedDebtId=Ce;const ce=[Y,...Pe];Ut(ce);try{if(await Ia(ce),t!=null&&t.uid){const Me=Ae($,"debts",Y.id),Qe={...Y,userId:t.uid,shopId:j||(n==null?void 0:n.shopId)||null,lastUpdated:new Date().toISOString()};Object.keys(Qe).forEach(vt=>Qe[vt]===void 0&&delete Qe[vt]),await Gt(Me,Qe,{merge:!0})}}catch(Me){console.error("⚠️ فشل حفظ الدين المؤجل محلياً أو سحابياً:",Me)}p({title:"تم إضافة الدين",description:"أضيف إلى إيصالات الديون حتى يتم السداد",variant:"default"})}if(!ee&&!i){const Y=Math.max(0,Number(L))+Math.max(0,Number(he));Y>0&&(mt=Math.round((mt+Y)*100)/100,console.log(`💰 تم إضافة عمولة/رسوم ${Y} جنيه لدرج النقدية`))}console.log("⚡ تحديث الواجهة فوراً بدون حجب باستخدام startTransition...");const ea="temp_"+Date.now()+"_"+Math.random().toString(36).substring(7),Dt={reference:ea,shopId:j||(n==null?void 0:n.shopId)||(t==null?void 0:t.uid)||"default-shop",lineId:W||"default-line",walletId:W||void 0,merchantUserId:(t==null?void 0:t.uid)||null,provider:"vodafone_cash",txnType:F==="transfer"?"send":"receive",originType:F==="transfer"?"transfer":"withdraw",amount:i?y:_,commission:at,fee:he,profit:0,senderMsisdn:Yt,receiverMsisdn:F==="transfer"?jt:Yt,note:F==="transfer"?void 0:rs&&rs.trim()!==""?rs.trim():void 0,status:ee?"pending":"confirmed",linkedDebtId:Ce||void 0,createdBy:(t==null?void 0:t.uid)||null,walletEffectAppliedOnCreation:!1,cashEffectAppliedOnCreation:!!(ee&&ie),limitsReservedOnCreation:!!ee,limitReservedType:F==="transfer"?"transfer":"withdraw",profitAddedOnCreation:!1},Ue={...Dt,id:ea,status:ee?"pending":"completed",commissionMode:F==="transfer"||Je?"add":"deduct",totalCharged:F==="transfer"?_+at+he:Je?_+L:y,walletEffectAppliedOnCreation:!1,cashEffectAppliedOnCreation:!!(ee&&ie),limitsReservedOnCreation:!!ee,limitReservedType:F==="transfer"?"transfer":"withdraw",sentAmount:F==="transfer"?_:void 0,transferredAmount:F==="transfer"?_:void 0,withdrawnAmount:F==="withdraw"?i?y:_:void 0,senderName:F==="withdraw"&&mr.trim()!==""?mr.trim():void 0,createdAt:new Date,type:F==="transfer"?"send":"withdraw",senderPhone:Yt||"",receiverPhone:jt||""};try{ka.current=[Ue,...ka.current],O.setQueryData(["recentTransactions",t==null?void 0:t.uid,j||"main"],Y=>!Y||!Array.isArray(Y)?[Ue]:[Ue,...Y])}catch(Y){console.error("Error in optimistic update:",Y)}if(W&&be)try{const Y=F==="transfer",ce={...be};Y?(ce.dailyTransferUsed=(ce.dailyTransferUsed||0)+_,ce.monthlyTransferUsed=(ce.monthlyTransferUsed||0)+_):(ce.dailyWithdrawUsed=(ce.dailyWithdrawUsed||0)+_,ce.monthlyWithdrawUsed=(ce.monthlyWithdrawUsed||0)+_),Ws(ce)}catch(Y){console.error("Error in optimistic limit update:",Y)}const la=[Ue,...ue];ae.startTransition(()=>{Xe(mt),lt(ot),ee&&(k.status="pending"),$t(la),i&&!ee&&p({title:"تم خصم العموله",description:`سلم للعميل: ${_} جنيه`,variant:"default",duration:5e3})});try{setTimeout(()=>{try{localStorage.setItem(Zo(),JSON.stringify(la))}catch{}},0)}catch{}if(je)try{const Y=new Date,ce=Y.getFullYear(),Me=String(Y.getMonth()+1).padStart(2,"0"),Qe=String(Y.getDate()).padStart(2,"0"),vt=`zeroPlanDailyConfirmCount:${(t==null?void 0:t.uid)||"default"}:${ce}-${Me}-${Qe}`,Ot=localStorage.getItem(vt),Ht=Ot&&parseInt(Ot,10)||0;localStorage.setItem(vt,String(Ht+1))}catch{}setTimeout(()=>{try{const Y=new Date().toISOString();localStorage.setItem(qe(),mt.toString()),localStorage.setItem(qe()+"_lastUpdated",Y),localStorage.setItem(Ze(),JSON.stringify(ot)),localStorage.setItem(Ze()+"_lastUpdated",Y)}catch{}},0);try{if(t!=null&&t.uid){const Y=M.find($s=>$s.id===W)??M.find($s=>$s.isDefault)??M[0],ce=(Y==null?void 0:Y.id)||W,Me=Number(ot[ce]||0),Qe=String((Y==null?void 0:Y.phone)||Yt||"").trim(),vt=String(jt||"").trim(),Ot=Number(he)>0,Ht=F==="transfer"?"🟢":"🔴",st=Number(at)>0?`${Number(at)} جنيه`:"0 جنيه",kt=Ot?` و رسوم ${Number(he)} جنيه`:"",Mt=F==="transfer"?`${Ht} تم تحويل مبلغ ${Number(_)} جنيه من رقم المحفظة ${Qe} إلى رقم المحفظة ${vt} وتم أخذ عمولة ${st}${kt}. الرصيد المتبقي في المحفظة: ${Me} جنيه. الفلوس النقدية المتبقية: ${Number(mt)} جنيه.`:`${Ht} تم السحب مبلغ ${Number(_)} جنيه من الدرج إلى رقم المحفظة ${Qe} وتم أخذ عمولة ${st}${kt}. الرصيد المتبقي في المحفظة: ${Me} جنيه. الفلوس النقدية المتبقية: ${Number(mt)} جنيه.`,Bs=t!=null&&t.uid?`tg_last_msg_${t.uid}`:"tg_last_msg",_e=Date.now();let Ct=!0;try{const $s=localStorage.getItem(Bs);if($s){const Us=JSON.parse($s),J0=String((Us==null?void 0:Us.text)||""),H0=Number((Us==null?void 0:Us.at)||0);J0===Mt&&_e-H0<5e3&&(Ct=!1)}}catch{}if(Ct){Promise.resolve(fs.send(t.uid,Mt)).catch(()=>{});try{localStorage.setItem(Bs,JSON.stringify({text:Mt,at:_e}))}catch{}}}}catch{}if((async()=>{try{console.log("🔄 بدء حفظ المعاملة في Firebase في الخلفية...");const Y={...Dt},ce={...Ue},{ProfitService:Me}=await ne(async()=>{const{ProfitService:st}=await import("./profitService-BUBYCoKY.js");return{ProfitService:st}},__vite__mapDeps([47,0,1]),import.meta.url),Qe=Me.calculateProfitFromTransaction({...ce,status:"confirmed"});Qe>0&&(Me.addProfit(Qe,t==null?void 0:t.uid),Y.profitAddedOnCreation=!0,ce.profitAddedOnCreation=!0,console.log("✅ تم إضافة الربح:",Qe,"جنيه"));const vt=await Og.create(Y);if(W)try{const st=await Ma.updateUsage(W,_,F==="transfer"?"transfer":"withdraw");st&&Ws(st);try{window.dispatchEvent(new CustomEvent("walletLimitsUpdated",{detail:{walletId:W}}))}catch{}}catch{}await Promise.all([...t!=null&&t.uid?[oe.updateUserData(t.uid,{cashBalance:mt,walletBalances:ot,lastUpdated:new Date().toISOString()})]:[],...t!=null&&t.uid?[oe.saveUserTransaction(t.uid,{...ce,transactionId:vt,transactionType:F,fromWallet:W,toWallet:F==="transfer"?q?null:"cash":null,cashierName:D&&((S==null?void 0:S.name)||(S==null?void 0:S.username))||"الحساب الرئيسي",linkedDebtId:Ce||void 0,description:`${F==="transfer"?"تحويل":"سحب"} ${_} من ${W} ${F==="transfer"?q?"":"إلى الدرج النقدي":""} — عمولة: ${L} (${F==="transfer"||Je?"مضافة":"مخصومة"})${he>0?` — رسوم: ${he}`:""}${ee?" — دين مؤجل (قيد المراجعة)":""}`})]:[]]),console.log("✅ تم حفظ جميع البيانات في Firebase بنجاح");try{const st={...Ue,id:vt};ka.current=ka.current.map(kt=>kt.id===ea?st:kt),O.setQueryData(["recentTransactions",t==null?void 0:t.uid,j||"main"],kt=>!kt||!Array.isArray(kt)?[st]:kt.map(Mt=>Mt.id===ea?st:Mt)),ae.startTransition(()=>{$t(kt=>kt.map(Mt=>Mt.id===ea?st:Mt))})}catch(st){console.error("Error updating query cache with real ID:",st)}setTimeout(()=>{try{console.log("🔄 تنفيذ التحديث المؤجل (10 ثواني) لضمان تطابق البيانات..."),O.invalidateQueries({queryKey:["recentTransactions",t==null?void 0:t.uid,j||"main"]}),O.invalidateQueries({queryKey:["dashboardData",j||(n==null?void 0:n.shopId)]}),W&&(O.invalidateQueries({queryKey:["walletLimits",W]}),dl())}catch(st){console.error("Error in delayed refresh:",st)}},1e4);const Ot=`userData_${t==null?void 0:t.uid}`,Ht={cashBalance:mt,walletBalances:ot,lastUpdated:new Date().toISOString()};localStorage.setItem(Ot,JSON.stringify(Ht))}catch(Y){console.error("❌ خطأ في حفظ المعاملة في Firebase (في الخلفية):",Y);try{t!=null&&t.uid&&oe.saveLocalReceipt(t.uid,{...transactionDataForUser,transactionType:F,fromWallet:W,toWallet:F==="transfer"?q?null:"cash":null,cashierName:D&&((S==null?void 0:S.name)||(S==null?void 0:S.username))||"الحساب الرئيسي",linkedDebtId:Ce||void 0,description:`${F==="transfer"?"تحويل":"سحب"} ${_} من ${W} ${F==="transfer"?q?"":"إلى الدرج النقدي":""} — عمولة: ${L} (${F==="transfer"||Je?"مضافة":"مخصومة"})${he>0?` — رسوم: ${he}`:""}${ee?" — دين مؤجل (قيد المراجعة)":""}`})}catch{}p({title:"تحذير",description:"تم تنفيذ العملية محلياً، لكن فشلت المزامنة مع الخادم. ستتم المحاولة مرة أخرى تلقائياً.",variant:"destructive"})}})(),F==="transfer"){Ts(!0);const Y=Number(y)+Number(L)+Math.max(0,Number(he));xo({type:"transfer",amount:Math.max(0,Math.round(Y*100)/100)}),pf({receiver:jt,amount:y}),Li(null),ia(!0),setTimeout(()=>{Ts(!1)},2e3)}else br(!0),xo({type:"withdraw",amount:_,isDeduct:i}),ia(!0),setTimeout(()=>{br(!1)},2e3);ur(""),ks(""),po(!1),kc(""),Cc(""),Xi(null),Qi(""),ns(""),_c(""),Ac(!1),setTimeout(()=>{X.current=!1,Ve(!1)},1500)}catch(v){console.error("CRITICAL ERROR IN TRANSACTION:",v),p({title:"خطأ غير متوقع",description:"حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.",variant:"destructive"}),l()}},Fr=ae.useMemo(()=>new Intl.DateTimeFormat("ar-EG"),[]),ou=ae.useMemo(()=>new Intl.DateTimeFormat("ar-EG",{hour:"2-digit",minute:"2-digit"}),[]),lu=ae.useMemo(()=>{try{return Pe.reduce((a,s)=>{const i=Number(s.paidAmount||0),l=Math.max(0,Number(s.amount||0)-i);return s.type==="debtor"?a.debtor+=l:a.creditor+=l,a},{creditor:0,debtor:0})}catch{return{creditor:0,debtor:0}}},[Pe]),ml=ae.useMemo(()=>Zd().filter(s=>ra==="all"?!0:ra==="send"?s.type==="send":ra==="receive"?s.type==="receive":ra==="withdraw"?s.type==="withdraw":ra==="deferred"?s.status==="pending":ra!=="deleted"),[Zd,ra]),$0=()=>{if(mo==="daily"){const a=_t.resetReportsManually("daily",ue,t==null?void 0:t.uid);pr(!1),p({title:"تم تصفير المعاملات اليومية",description:`تم إخفاء ${a.length} معاملة من تقارير اليوم (الحدود لم تتأثر)`})}else{const a=_t.resetReportsManually("monthly",ue,t==null?void 0:t.uid);pr(!1),p({title:"تم تصفير المعاملات الشهرية",description:`تم إخفاء ${a.length} معاملة من تقارير الشهر (الحدود لم تتأثر)`})}},U0=()=>mo==="daily"?"تصفير المعاملات اليومية":"تصفير المعاملات الشهرية",V0=()=>mo==="daily"?"أدخل الرقم السري الرئيسي لتصفير تقارير اليوم عن طريق إخفاء معاملات اليوم من التقارير":"أدخل الرقم السري الرئيسي لتصفير تقارير الشهر عن طريق إخفاء معاملات الشهر من التقارير",q0=a=>{Ud(a),Uo(!0)},z0=a=>{const s=$e,i=Number(a)-Number(s);Xe(a);const l=new Date().toISOString();localStorage.setItem(qe(),a.toString()),localStorage.setItem(qe()+"_lastUpdated",l),_d(!1);const d={cashBalance:a,lastUpdated:l},m=`userData_${t==null?void 0:t.uid}`;try{localStorage.setItem(m,JSON.stringify(d))}catch{}const f=[];if(t!=null&&t.uid){f.push(oe.updateUserData(t.uid,d).then(()=>{try{localStorage.removeItem(m)}catch{}}).catch(()=>{}));const g=`${i>0?"CASHADD":"CASHDEDUCT"}-${(t==null?void 0:t.uid)||"anon"}-${Date.now()}`,v=i>0?{txnType:"cash_addition",type:"cash_addition",amount:i,status:"confirmed",senderMsisdn:"إضافة نقدية",receiverMsisdn:"",reference:g,title:"إيصال إضافة نقدية",merchantUserId:t.uid,createdBy:t.uid,shopId:(n==null?void 0:n.shopId)||void 0}:i<0?{amount:Math.abs(i),status:"completed",title:"ايصال خصم من الفلوس النقديه",merchantUserId:t.uid,createdBy:t.uid,shopId:(n==null?void 0:n.shopId)||void 0}:null;v&&f.push(oe.saveUserTransaction(t.uid,v));const y=n==null?void 0:n.shopId;if(y){const b=Ae($,"dashboardData",y);f.push(ta(b,{cashBalance:a}))}}Promise.allSettled(f).then(()=>{}).catch(()=>{}),p({title:i>0?"تم إضافة نقدية":i<0?"تم خصم نقدية":"تم تحديث الرصيد النقدي",description:i!==0?`التغيير: ${Math.abs(i)} جنيه، الرصيد الجديد: ${a} جنيه`:`تم تحديث الرصيد النقدي إلى ${a} جنيه`})},Y0=async a=>{var f;if(!Vt){console.warn("لا يوجد معرف محفظة محدد لتعديل الرصيد");return}const s={...Ne,[Vt]:a};lt(s);const i=new Date().toISOString(),l={walletBalances:s,lastUpdated:i},d=`userData_${t==null?void 0:t.uid}`;try{localStorage.setItem(d,JSON.stringify(l)),localStorage.setItem(Ze(),JSON.stringify(s)),localStorage.setItem(Ze()+"_lastUpdated",i),localStorage.setItem(`walletBalances_backup_${i}`,JSON.stringify(s))}catch{}try{t!=null&&t.uid&&await oe.updateUserData(t.uid,l)}catch(g){console.error("خطأ أثناء حفظ رصيد المحفظة في Firebase:",g)}Ad(!1);const m=((f=M.find(g=>g.id===Vt))==null?void 0:f.name)||"المحفظة";p({title:"تم تحديث رصيد المحفظة",description:`تم تحديث رصيد ${m} إلى ${a.toLocaleString()} جنيه`})},K0=async a=>{var s;if(console.log("💰 بدء تحديث رصيد المحفظة"),console.log("📊 معرف المحفظة المحررة:",Vt),console.log("💵 المبلغ المضاف/المخصوم:",a),Vt){const i=Ne[Vt]||0;console.log("💰 الرصيد الحالي:",i);const l=i+a;console.log("💰 الرصيد الجديد:",l);const d={...Ne,[Vt]:l};console.log("📊 الأرصدة المحدثة:",d),lt(d);const m=new Date().toISOString(),f={walletBalances:d,lastUpdated:m},g=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(g,JSON.stringify(f)),localStorage.setItem(Ze(),JSON.stringify(d)),localStorage.setItem(`walletBalances_backup_${m}`,JSON.stringify(d));try{if(t!=null&&t.uid){console.log("🔄 حفظ البيانات في Firebase...");try{await oe.updateUserData(t.uid,f),console.log("✅ تم حفظ الأرصدة في Firebase بنجاح"),setTimeout(()=>{localStorage.removeItem(g),console.log("🧹 تم حذف النسخة المحلية المؤقتة بعد دقيقة واحدة")},6e4)}catch(w){console.error("❌ فشل في حفظ البيانات في Firebase:",w),ye(!0)}}else console.log("⚠️ المستخدم غير مسجل دخول، حفظ في localStorage"),localStorage.setItem(Ze(),JSON.stringify(d));const v=((s=M.find(w=>w.id===Vt))==null?void 0:s.name)||"المحفظة",y=a>0?"إضافة":"خصم",b=Math.abs(a);p({title:`تم ${y} مبلغ ${y==="إضافة"?"إلى":"من"} رصيد المحفظة`,description:`تم ${y} ${b} جنيه ${y==="إضافة"?"إلى":"من"} رصيد ${v}. الرصيد الجديد: ${l.toLocaleString()} جنيه`})}catch(v){if(console.error("❌ فشل في حفظ البيانات في Firebase:",v),localStorage.setItem(Ze(),JSON.stringify(d)),t!=null&&t.uid){const y=`userData_${t.uid}`,b={walletBalances:d,lastUpdated:new Date().toISOString()};localStorage.setItem(y,JSON.stringify(b)),ye(!0)}p({title:"تم حفظ البيانات محلياً",description:"تم حفظ التغييرات محلياً وسيتم مزامنتها مع الخادم لاحقاً",variant:"default"})}}else console.log("❌ لا يوجد معرف محفظة للتحرير");setTimeout(()=>{const l=Object.keys(localStorage).filter(d=>d.startsWith("walletBalances_backup_")).sort();l.length>5&&l.slice(0,l.length-5).forEach(m=>{localStorage.removeItem(m),console.log("🗑️ حذف النسخة الاحتياطية القديمة:",m)})},5e3),Uo(!1),Ud("")};return console.log("🔥 UserDashboardPage - Render conditions:",{isCheckingActivation:Fi,isUserActive:rr,showActivationModal:Dh}),Fi?(console.log("🔥 UserDashboardPage - Showing loading screen"),e.jsx(vg,{})):(console.log("🔥 UserDashboardPage - Rendering main dashboard"),e.jsxs("div",{id:"dashboard-content-container",className:"user-dashboard h-[100dvh] overflow-y-auto px-2 sm:px-4 pt-2 sm:py-4 relative bg-gray-100 bg-[radial-gradient(140%_140%_at_10%_10%,#e5e7eb_0%,#d1d5db_45%,#9ca3af_100%)] no-scrollbar",children:[e.jsx(qv,{userId:t==null?void 0:t.uid}),e.jsxs("div",{className:"max-w-screen-2xl mx-auto grid grid-cols-1 xl:grid-cols-3 gap-4 xl:gap-6 relative z-10",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-2 sm:gap-3 fade-in-up",children:[!Sr&&e.jsxs(Aa,{className:"bg-gray-100 dark:bg-card border border-gray-200 dark:border-gray-800 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 relative overflow-hidden",children:[e.jsx(gs,{className:"pb-2 px-3 pt-3 relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ps,{className:"text-sm font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 rounded-md bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700",children:e.jsx(Ru,{className:"h-4 w-4 text-gray-700 dark:text-gray-300"})}),e.jsx("span",{className:"text-sm",children:"الشهر"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>{Uc("monthly"),pr(!0)},className:"h-8 w-8 p-0 bg-transparent hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 rounded-full transition-colors duration-200",title:"تصفير معاملات الشهر",children:e.jsx(ca,{className:"h-3.5 w-3.5"})}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>lo(!0),className:"h-8 w-8 p-0 bg-transparent hover:bg-purple-50 dark:hover:bg-purple-900/20 text-purple-600 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300 rounded-full transition-colors duration-200",title:"عرض تقارير يوم/شهر محدد",children:e.jsx(yi,{className:"h-3.5 w-3.5"})}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>lo(!0),className:"h-8 w-8 p-0 bg-transparent hover:bg-blue-50 dark:hover:bg-blue-900/20 text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 rounded-full transition-colors duration-200",title:"تقاريرك",children:e.jsx(ui,{className:"h-3.5 w-3.5"})}),e.jsx("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 rounded-full border border-green-100 dark:border-green-900/30",children:e.jsx(Ur,{className:"h-3.5 w-3.5 text-green-600 dark:text-green-400"})})]})]})}),!Sr&&e.jsxs(Ta,{className:"pt-0 px-2 pb-2",children:[e.jsxs("div",{className:`grid grid-cols-2 gap-0 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-800 divide-x divide-y divide-gray-200 dark:divide-gray-800 bg-white dark:bg-gray-900 ${Zc?"blur-sm select-none":""}`,children:[e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-blue-600 dark:text-blue-400",children:"عدد المعاملات"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-blue-800 dark:text-blue-300 mt-0.5 sm:mt-0",children:Ls.totalTransactions})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-gray-600 dark:text-gray-400",children:"إجمالي المبالغ"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-gray-900 dark:text-gray-100 mt-0.5 sm:mt-0",children:Ls.totalAmount.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-red-600 dark:text-red-400",children:"المسحوب"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-red-800 dark:text-red-300 mt-0.5 sm:mt-0",children:Ls.totalWithdrawn.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-green-600 dark:text-green-400",children:"المرسل"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-green-800 dark:text-green-300 mt-0.5 sm:mt-0",children:Ls.totalSent.toFixed(2)})]})]}),e.jsxs("div",{className:"mt-2 rounded-lg border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-900 px-2 py-1.5 flex items-center justify-between",children:[e.jsx("span",{className:"text-[12px] font-bold text-yellow-600 dark:text-yellow-400",children:"الأرباح"}),e.jsx(ev,{userId:t==null?void 0:t.uid,transactions:ue})]})]}),Zc&&e.jsx("div",{className:"absolute inset-0 z-20 backdrop-blur-sm bg-white/60 dark:bg-black/60 flex items-center justify-center p-0 pointer-events-auto",children:e.jsxs(I,{size:"sm",variant:"ghost",onClick:async()=>{if(je){p({title:"غير متاح",description:"تقارير الشهر غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"});return}Tn(!0)},className:"px-4 py-2 rounded-full bg-white dark:bg-card border border-gray-100 dark:border-gray-800 text-gray-900 dark:text-gray-100 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-800 hover:shadow-md transition-all duration-200 flex items-center gap-2 text-xs font-medium",title:"عرض تقارير الشهر (يتطلب الرقم السري)",children:[e.jsx("span",{children:"عرض تقارير الشهر"}),e.jsx(Qs,{className:"h-3.5 w-3.5 text-gray-600 dark:text-gray-400"})]})})]}),e.jsx(aa,{open:If,onOpenChange:Tn,mode:"verify",title:"الرقم السري لفتح تقارير الشهر",description:"لا يمكن الاطلاع على إحصائيات الشهر إلا بإدخال الرقم السري الرئيسي",onSuccess:()=>{if(je){p({title:"غير متاح",description:"تقارير الشهر غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}),Tn(!1),An(!0);return}An(!1),Tn(!1)},userId:t==null?void 0:t.uid,userRole:n==null?void 0:n.role}),(Tt==null?void 0:Tt.planType)!==Qt.TAHWEELA&&e.jsxs(Aa,{className:"bg-gray-50 dark:bg-card border border-gray-200 dark:border-gray-800 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 relative overflow-hidden",children:[e.jsx(gs,{className:"pb-2 px-3 pt-3 relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ps,{className:"text-sm font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 rounded-md bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700",children:e.jsx(Ru,{className:"h-4 w-4 text-gray-700 dark:text-gray-300"})}),e.jsx("span",{className:"text-sm",children:"اليوم"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>{Uc("daily"),pr(!0)},className:"h-8 w-8 p-0 bg-transparent hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 rounded-full transition-colors duration-200",title:"تصفير معاملات اليوم",children:e.jsx(ca,{className:"h-3.5 w-3.5"})}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>Cf(a=>!a),className:"h-8 w-8 p-0 bg-transparent hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 rounded-full transition-colors duration-200",title:Sr?"توسيع اليوم والشهر":"طي اليوم والشهر",children:Sr?e.jsx(qg,{className:"h-3.5 w-3.5"}):e.jsx(zg,{className:"h-3.5 w-3.5"})}),e.jsx("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 rounded-full border border-green-100 dark:border-green-900/30",children:e.jsx(Ur,{className:"h-3.5 w-3.5 text-green-600 dark:text-green-400"})})]})]})}),!Sr&&e.jsxs(Ta,{className:"pt-0 px-2 pb-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-0 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-800 divide-x divide-y divide-gray-200 dark:divide-gray-800 bg-white dark:bg-gray-900",children:[e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-blue-600 dark:text-blue-400",children:"عدد المعاملات"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-blue-800 dark:text-blue-300 mt-0.5 sm:mt-0",children:di.totalTransactions})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-gray-600 dark:text-gray-400",children:"إجمالي المبالغ"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-gray-900 dark:text-gray-100 mt-0.5 sm:mt-0",children:di.totalAmount.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-red-600 dark:text-red-400",children:"المسحوب"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-red-800 dark:text-red-300 mt-0.5 sm:mt-0",children:di.totalWithdrawn.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-green-600 dark:text-green-400",children:"المرسل"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-green-800 dark:text-green-300 mt-0.5 sm:mt-0",children:di.totalSent.toFixed(2)})]})]}),e.jsxs("div",{className:"mt-2 rounded-lg border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-900 px-2 py-1.5 flex items-center justify-between",children:[e.jsx("span",{className:"text-[12px] font-bold text-yellow-600 dark:text-yellow-400",children:"الأرباح"}),e.jsx(sv,{userId:t==null?void 0:t.uid,transactions:ue})]})]}),Ef&&e.jsx("div",{className:"absolute inset-0 z-20 backdrop-blur-sm bg-white/60 dark:bg-black/60 flex items-center justify-center p-0 pointer-events-auto",children:e.jsxs(I,{size:"sm",variant:"ghost",onClick:()=>No(!0),className:"px-4 py-2 rounded-full bg-white dark:bg-card border border-gray-100 dark:border-gray-800 text-gray-900 dark:text-gray-100 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-800 hover:shadow-md transition-all duration-200 flex items-center gap-2 text-xs font-medium",title:"عرض تقارير اليوم (يتطلب الرقم السري)",children:[e.jsx("span",{children:"عرض تقارير اليوم"}),e.jsx(Qs,{className:"h-3.5 w-3.5 text-gray-600 dark:text-gray-400"})]})})]}),e.jsx(aa,{open:Of,onOpenChange:No,mode:"verify",title:"الرقم السري لفتح تقارير اليوم",description:"لا يمكن الاطلاع على تقارير اليوم إلا بإدخال الرقم السري الرئيسي",onSuccess:()=>{sd(!1),No(!1)},userId:t==null?void 0:t.uid})]}),e.jsxs(Aa,{className:"balance-bar bg-gray-200 border-2 border-gray-200/50 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 group relative overflow-hidden   transform fade-in-up mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-500/5 via-blue-500/5 to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),e.jsx("div",{className:"absolute top-0 left-0 w-40 h-40 bg-gradient-to-br from-emerald-300/10 to-transparent rounded-full -translate-y-20 -translate-x-20 group-hover:scale-150 transition-transform duration-200"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-blue-300/10 to-transparent rounded-full translate-y-20 translate-x-20 group-hover:scale-150 transition-transform duration-200"}),e.jsx(Ta,{className:"p-2 relative z-10",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:[e.jsxs("div",{className:"bg-white dark:bg-card border border-gray-200 dark:border-gray-800 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/cash relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-500/10 to-transparent opacity-0 group-hover/cash:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex flex-col relative z-10 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-emerald-100 to-emerald-200 dark:from-emerald-900/30 dark:to-emerald-800/30 rounded-lg shadow-sm",children:e.jsx(Oa,{className:"h-1.5 w-1.5 text-emerald-600 dark:text-emerald-400"})}),e.jsx("span",{className:"text-[11px] font-extrabold text-emerald-800 dark:text-emerald-300",children:"الفلوس النقدية"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors",onClick:()=>Pr(!0),children:e.jsx(It,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-emerald-600 dark:text-emerald-400 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-colors",onClick:()=>qd(!0),title:"تفاصيل الفلوس النقدية",children:e.jsx(Tu,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",onClick:()=>ii(!0),children:e.jsx(ca,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-0.5",children:e.jsxs("span",{className:"text-[14px] sm:text-xl font-bold text-emerald-800 dark:text-emerald-200 bg-gradient-to-r from-emerald-100 to-emerald-200 dark:from-emerald-900/30 dark:to-emerald-800/30 px-1 py-0.5 rounded-lg shadow-sm block w-fit",children:[$e.toLocaleString("en-US")," جنيه"]})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-card border border-gray-200 dark:border-gray-800 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/wallet relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/10 to-transparent opacity-0 group-hover/wallet:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex flex-col relative z-10 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-blue-100 to-blue-200 dark:from-blue-900/30 dark:to-blue-800/30 rounded-lg shadow-sm",children:e.jsx(Vs,{className:"h-1.5 w-1.5 text-blue-600 dark:text-blue-400"})}),e.jsx("span",{className:"text-[11px] font-extrabold text-blue-800 dark:text-blue-300",children:"الأرصدة علي المحافظ"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors",onClick:()=>ti(!0),title:"إضافة أموال لإجمالي المحفظة",children:e.jsx(It,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors",onClick:()=>uo(!0),title:"عرض المحافظ",children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",onClick:()=>{ri(!0),ni("")},title:"تصفير إجمالي المحفظة",children:e.jsx(ca,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-0.5",children:e.jsxs("span",{className:"text-[14px] sm:text-xl font-bold text-blue-800 dark:text-blue-200 bg-gradient-to-r from-blue-100 to-blue-200 dark:from-blue-900/30 dark:to-blue-800/30 px-1 py-0.5 rounded-lg shadow-sm block w-fit",children:[M.reduce((a,s)=>a+(Number(Ne[s.id])||0),0).toLocaleString("en-US")," جنيه"]})})]})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1 bg-white dark:bg-card border border-gray-200 dark:border-gray-800 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/selwallet relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-transparent opacity-0 group-hover/selwallet:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex flex-col relative z-10 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-indigo-100 to-indigo-200 dark:from-indigo-900/30 dark:to-indigo-800/30 rounded-lg shadow-sm",children:e.jsx(Vs,{className:"h-1.5 w-1.5 text-indigo-600 dark:text-indigo-400"})}),e.jsx("span",{className:"text-[11px] font-extrabold text-indigo-800 dark:text-indigo-300",children:"رصيد المحفظه"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors",onClick:()=>{if(!W){p({title:"اختر محفظة",description:"يرجى اختيار محفظة من اختيار المحافظ بالأعلى أولاً",variant:"destructive"});return}q0(W)},title:"إضافة/خصم إلى رصيد المحفظة المختارة",children:e.jsx(It,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",onClick:()=>{if(!W){p({title:"اختر محفظة",description:"يرجى اختيار محفظة لتصفير رصيدها فقط",variant:"destructive"});return}Vn(!0)},title:"تصفير رصيد المحفظة المختارة",children:e.jsx(ca,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-0.5",children:e.jsxs("span",{className:"text-[14px] sm:text-xl font-bold text-indigo-800 dark:text-indigo-200 bg-gradient-to-r from-indigo-100 to-indigo-200 dark:from-indigo-900/30 dark:to-indigo-800/30 px-1 py-0.5 rounded-lg shadow-sm block w-fit",children:[(W&&Ne[W]||0).toLocaleString("en-US")," جنيه"]})})]})]})]})})]}),e.jsxs(Aa,{className:"bg-gray-100 dark:bg-card border border-gray-200 dark:border-gray-800 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 group relative overflow-hidden fade-in-up",children:[e.jsxs(gs,{className:`pb-2 px-4 pt-4 relative z-10 ${P?"sticky top-0 z-20 bg-white/90 dark:bg-card/90 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:supports-[backdrop-filter]:bg-card/60":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ps,{className:"text-sm font-bold flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[!P&&e.jsx("div",{className:"p-1.5 sm:p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Ur,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5 text-gray-700 dark:text-gray-300"})}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:"المعاملات الأخيرة"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!P&&e.jsxs("div",{className:"flex items-center gap-0.5 bg-gray-100 dark:bg-gray-800 rounded px-1 py-0.5 border border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-500 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[e.jsx(Iu,{className:"h-2 w-2 text-gray-400 dark:text-gray-500 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors"}),e.jsx(J,{placeholder:"بحث...",value:qc,onChange:a=>hf(a.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 dark:text-gray-200 placeholder:text-gray-400 dark:placeholder:text-gray-500"})]}),!P&&e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-green-600 mb-1 whitespace-nowrap",children:"سحب ATM"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-green-100 text-green-600 hover:bg-green-200 border border-green-200 ring-3 ring-green-300 transition-all duration-200 hover:scale-105 active:bg-green-600 active:text-white active:border-green-600",onClick:()=>Z(!0),title:"سحب ATM",children:e.jsx(wg,{className:"h-5 w-5 text-green-600"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"خطوط"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>V("lines",()=>{Ye?We(!0):Se()}),title:"إدارة الخطوط",children:e.jsx(Ng,{className:"h-5 w-5 text-purple-600"})})]}),!Kt.includes("installment")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"تقسيط"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>V("installments",()=>{if(je||ke){p({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"});return}vr(!0)}),title:"إدارة التقسيط",children:e.jsx(jg,{className:"h-5 w-5 text-purple-600"})})]}),!Kt.includes("store")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 mb-1",children:"متجرك"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600",onClick:()=>ft(!0),title:"متجرك",children:e.jsx(Vr,{className:"h-5 w-5 text-blue-600"})})]}),!Kt.includes("calculator")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"حاسبة"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>vo(!0),title:"آلة حاسبة",children:e.jsx(sp,{className:"h-5 w-5 text-purple-600"})})]}),!Kt.includes("credit-cards")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"كروت"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>V("cards",()=>{je||ke?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):wr(!0)}),title:"كروت الائتمان",children:e.jsx(Sg,{className:"h-5 w-5 text-purple-600"})})]}),e.jsxs("div",{className:"hidden flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 mb-1",children:"تقاريرك"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600",onClick:()=>{if(je||ke){p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"});return}Wd(!0)},title:"تقاريرك",children:e.jsx(Wu,{className:"h-5 w-5 text-blue-600"})})]}),!Kt.includes("telegram")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-sky-600 mb-1",children:"تلجرام"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-sky-100 text-sky-600 hover:bg-sky-200 border border-sky-200 ring-3 ring-sky-300 transition-all duration-200 hover:scale-105 active:bg-sky-600 active:text-white active:border-sky-600",onClick:()=>{je||ke?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):Wt.hasMasterPin()?ll(!0):eu()},title:"إرسال تقرير يومي إلى تليجرام",children:e.jsx(Dg,{className:"h-5 w-5 text-sky-600"})})]}),!Kt.includes("cashier-shift")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 mb-1",children:"الوردية"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600",onClick:x0,title:D&&(S!=null&&S.name||S!=null&&S.username)?`بروفيل الوردية: ${(S==null?void 0:S.name)||(S==null?void 0:S.username)}`:"وردية الكاشير",children:e.jsx(qr,{className:"h-5 w-5 text-blue-600"})})]}),!Kt.includes("sales")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"المبيعات"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>V("sales",()=>{je||ke?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):As(!0)}),title:"بيانات المبيعات",children:e.jsx(yl,{className:"h-5 w-5 text-purple-600"})})]}),!Kt.includes("debts")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600",children:"الديون"}),Pe.filter(a=>a.status==="pending").length>0&&e.jsx("span",{className:"h-4 w-4 rounded-full bg-red-600 text-white text-[10px] flex items-center justify-center ring-2 ring-white",children:Pe.filter(a=>a.status==="pending").length})]}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>V("debts",()=>{Fn()}),title:"الديون",children:e.jsx(ui,{className:"h-5 w-5 text-purple-600"})})]}),!Kt.includes("maintenance")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-amber-700 mb-1",children:"الصيانة"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-amber-100 text-amber-700 hover:bg-amber-200 border border-amber-200 ring-3 ring-amber-300 transition-all duration-200 hover:scale-105 active:bg-amber-600 active:text-white active:border-amber-600",onClick:()=>V("maintenance",()=>{je||ke?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):Nr(!0)}),title:"الصيانة",children:e.jsx(Nu,{className:"h-5 w-5 text-amber-700"})})]}),!Kt.includes("machine")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-yellow-500 mb-1",children:"المكنة"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-violet-100 text-violet-700 hover:bg-violet-200 border border-violet-200 ring-3 ring-violet-300 transition-all duration-200 hover:scale-105 active:bg-violet-700 active:text-white active:border-violet-700",onClick:()=>V("machines",()=>{!Jt||ke?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):jr(!0)}),title:"يومية المكنة",children:e.jsx(kg,{className:"h-5 w-5 text-yellow-500"})})]}),!Kt.includes("shop-expenses")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-orange-600 mb-1",children:"مصروفات"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-orange-100 text-orange-600 hover:bg-orange-200 border border-orange-200 ring-3 ring-orange-300 transition-all duration-200 hover:scale-105 active:bg-orange-600 active:text-white active:border-orange-600",onClick:()=>V("expenses",()=>{je||ke?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):Wt.hasMasterPin()?ws(!0):ss(!0)}),title:"مصروفات المحل",children:e.jsx(zr,{className:"h-5 w-5 text-orange-600"})})]}),!Kt.includes("deficiencies")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-rose-600 mb-1",children:"النواقص"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-rose-100 text-rose-600 hover:bg-rose-200 border border-rose-200 ring-3 ring-rose-300 transition-all duration-200 hover:scale-105 active:bg-rose-600 active:text-white active:border-rose-600",onClick:()=>V("deficiencies",()=>{je||ke?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):or(!0)}),title:"النواقص",children:e.jsx(ju,{className:"h-5 w-5 text-rose-600"})})]}),!Kt.includes("my-client-numbers")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-emerald-600 mb-1",children:"أرقامي"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-emerald-100 text-emerald-700 hover:bg-emerald-200 border border-emerald-200 ring-3 ring-emerald-300 transition-all duration-200 hover:scale-105 active:bg-emerald-600 active:text-white active:border-emerald-600",onClick:()=>V("myNumbers",()=>{je||ke?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):pn(!0)}),title:"أرقامي",children:e.jsx(mi,{className:"h-5 w-5 text-emerald-700"})})]})]})]})]}),!P&&e.jsx("div",{className:"mt-2 w-full",children:e.jsxs("div",{className:"filters-bar flex items-center justify-center gap-3 bg-gray-100 rounded-md p-3 border border-gray-200",children:[e.jsx(I,{variant:"ghost",size:"sm",className:`btn-filter-send h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${ra==="send"?"bg-green-600 text-white border-green-600":"text-green-700 border-green-300 hover:bg-green-100"}`,onClick:()=>Nn("send"),title:"تصفية التحويل",children:"التحويل"}),e.jsx(I,{variant:"ghost",size:"sm",className:`btn-filter-withdraw h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${ra==="withdraw"?"bg-red-600 text-white border-red-600":"text-red-700 border-red-300 hover:bg-red-100"}`,onClick:()=>Nn("withdraw"),title:"تصفية السحب",children:"السحب"}),e.jsx(I,{variant:"ghost",size:"sm",className:`btn-filter-deferred h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${ra==="deferred"?"bg-yellow-600 text-white border-yellow-600":"text-yellow-700 border-yellow-300 hover:bg-yellow-100"}`,onClick:()=>Nn("deferred"),title:"تصفية المؤجل",children:"مؤجل"}),e.jsx(I,{variant:"ghost",size:"sm",className:`btn-filter-all h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${ra==="all"?"bg-green-600 text-white border-green-600":"text-green-700 border-green-300 hover:bg-green-100"}`,onClick:()=>Nn("all"),title:"عرض الكل",children:"الكل"}),e.jsxs("div",{className:"relative ml-1",children:[e.jsxs(I,{variant:"ghost",size:"sm",className:"h-auto px-2 py-1 text-xs text-red-600 hover:bg-red-50 rounded-md font-medium",onClick:()=>Ar(!0),title:"تصفير المعاملات الأخيرة",children:[e.jsx(ca,{className:"h-3 w-3 mr-1"}),"تصفير"]}),C0>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"})]})]})})]}),e.jsx(aa,{open:vf,onOpenChange:vr,mode:"verify",title:"فتح إدارة التقسيط",description:"أدخل الرقم السري الرئيسي للوصول إلى إدارة التقسيط",onSuccess:()=>{vr(!1),Gc(!0)}}),e.jsx(Ov,{open:wf,onOpenChange:Gc}),e.jsx(aa,{open:Zt,onOpenChange:We,mode:"verify",title:"فتح إدارة الخطوط",description:"أدخل الرقم السري الرئيسي للوصول إلى إدارة الخطوط",onSuccess:()=>{We(!1),Se()}}),e.jsx(Mv,{isOpen:Nf,onClose:()=>_n(!1),shopId:j,onOpenAdsl:()=>{_n(!1),Xc(!0)}}),e.jsx(Pu,{isOpen:Ge,onClose:()=>yt(!1),userId:(t==null?void 0:t.uid)||"",userEmail:(t==null?void 0:t.email)||""}),e.jsx(Rv,{isOpen:jf,onClose:()=>Xc(!1),shopId:j}),e.jsx(aa,{open:E0,onOpenChange:ll,mode:"verify",title:"إرسال تقرير يومي إلى تليجرام",description:"أدخل الرقم السري الرئيسي لإرسال التقرير اليومي إلى تليجرام",onSuccess:()=>{ll(!1),eu()},userId:t==null?void 0:t.uid,userRole:n==null?void 0:n.role}),e.jsxs(Ta,{className:"space-y-2 pt-0 px-4 pb-4 relative z-10",children:[ml.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ur,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"لا توجد معاملات حتى الآن"})]}):P?e.jsx("div",{className:"overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors max-h-[310px]",children:e.jsx("div",{className:"space-y-2 pr-2",children:ml.map(a=>e.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>su(a),children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center shrink-0 ${a.type==="withdraw"?"bg-red-100":"bg-green-100"}`,children:(()=>{const s=a,i=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("إيصال تسليم وردية"),l=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("إيصال إضافة نقدية"),d=String((s==null?void 0:s.type)||"").toLowerCase()==="sales"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="sales"||String((s==null?void 0:s.title)||"").includes("إيصال مبيعات")||String((s==null?void 0:s.senderMsisdn)||"")==="مبيعات";return i?e.jsx(zr,{className:"h-5 w-5 text-gray-600"}):l?e.jsx(It,{className:"h-5 w-5 text-green-600"}):d?e.jsx(zr,{className:"h-5 w-5 text-green-600"}):a.type==="withdraw"?e.jsx(Ks,{className:"h-5 w-5 text-red-600"}):e.jsx(Eu,{className:"h-5 w-5 text-green-600"})})()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"text-base font-bold truncate",children:(()=>{const s=a,i=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("إيصال تسليم وردية"),l=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("إيصال إضافة نقدية"),d=String((s==null?void 0:s.type)||"").toLowerCase()==="sales"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="sales"||String((s==null?void 0:s.title)||"").includes("إيصال مبيعات")||String((s==null?void 0:s.senderMsisdn)||"")==="مبيعات",m=String((s==null?void 0:s.title)||"").includes("إيصال تحويل مكينه")||String((s==null?void 0:s.description)||"").includes("تحويل مكنه");return i?e.jsx("span",{className:"text-foreground",children:"تسليم وردية"}):m?e.jsx("span",{className:"text-foreground",children:"إيصال تحويل مكينه"}):l?e.jsx("span",{className:"text-foreground",children:"إضافة نقدية"}):d?e.jsx("span",{className:"text-foreground",children:"مبيعات"}):a.type==="atm_withdraw"?e.jsx("span",{className:"text-green-600",children:"سحب atm"}):a.type==="send"?e.jsx("span",{className:"text-green-600",children:"تحويل أموال"}):e.jsx("span",{className:"text-red-600",children:"سحب نقدي"})})()}),e.jsxs("span",{className:`text-base font-bold whitespace-nowrap ${a.type==="withdraw"?"text-red-600":"text-green-600"}`,children:[a.type==="withdraw"||a.type==="cash_addition"||a.txnType==="cash_addition"||a.type==="sales"||a.txnType==="sales"?"+":"-"," ",Rt(a.amount)," ج.م"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:(()=>{const s=a,i=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("إيصال تسليم وردية"),l=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("إيصال إضافة نقدية"),d=String((s==null?void 0:s.type)||"").toLowerCase()==="sales"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="sales"||String((s==null?void 0:s.title)||"").includes("إيصال مبيعات")||String((s==null?void 0:s.senderMsisdn)||"")==="مبيعات",m=String((s==null?void 0:s.title)||"").includes("إيصال تحويل مكينه")||String((s==null?void 0:s.description)||"").includes("تحويل مكنه"),f=(s==null?void 0:s.note)||(s==null?void 0:s.notes)||"";if(i)return`إلى: ${a.receiverPhone}`;if(l)return f||"إضافة يدوية";if(d){const g=((s==null?void 0:s.saleProductName)||"").trim(),v=((s==null?void 0:s.saleQuantity)??"").toString();return g&&v?`${g} × ${v}`:g||"عملية بيع"}return m?`من: ${s.senderName||"ماكينة"}`:a.type==="send"?e.jsx("span",{dir:"ltr",children:a.receiverPhone}):e.jsx("span",{dir:"ltr",children:a.senderPhone})})()}),e.jsxs("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:[Fr.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))," - ",ou.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))]})]}),e.jsxs("div",{className:`px-2 py-0.5 rounded-full text-[10px] font-medium flex items-center gap-1 ${a.status==="completed"?a.type==="withdraw"?"bg-red-100 text-red-700":"bg-green-100 text-green-700":a.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[a.status==="completed"&&e.jsx(hi,{className:"h-3 w-3"}),a.status==="pending"&&e.jsx(Su,{className:"h-3 w-3"}),a.status==="failed"&&e.jsx(fi,{className:"h-3 w-3"}),e.jsx("span",{children:a.status==="completed"?"ناجحة":a.status==="pending"?"معالجة":"فشلت"})]})]})]})]},a.id))})}):e.jsx("div",{className:"overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors max-h-[calc(100dvh-300px)]",children:e.jsx("div",{className:"space-y-2 pr-2",children:ml.map(a=>e.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>su(a),children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center shrink-0 ${a.type==="withdraw"?"bg-red-100":"bg-green-100"}`,children:(()=>{const s=a,i=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("إيصال تسليم وردية"),l=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("إيصال إضافة نقدية"),d=String((s==null?void 0:s.type)||"").toLowerCase()==="sales"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="sales"||String((s==null?void 0:s.title)||"").includes("إيصال مبيعات")||String((s==null?void 0:s.senderMsisdn)||"")==="مبيعات";return i?e.jsx(zr,{className:"h-5 w-5 text-gray-600"}):l?e.jsx(It,{className:"h-5 w-5 text-green-600"}):d?e.jsx(zr,{className:"h-5 w-5 text-green-600"}):a.type==="withdraw"?e.jsx(Ks,{className:"h-5 w-5 text-red-600"}):e.jsx(Eu,{className:"h-5 w-5 text-green-600"})})()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"text-base font-bold truncate",children:(()=>{const s=a,i=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("إيصال تسليم وردية"),l=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("إيصال إضافة نقدية"),d=String((s==null?void 0:s.type)||"").toLowerCase()==="sales"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="sales"||String((s==null?void 0:s.title)||"").includes("إيصال مبيعات")||String((s==null?void 0:s.senderMsisdn)||"")==="مبيعات",m=String((s==null?void 0:s.title)||"").includes("إيصال تحويل مكينه")||String((s==null?void 0:s.description)||"").includes("تحويل مكنه");return i?e.jsx("span",{className:"text-foreground",children:"تسليم وردية"}):l?e.jsx("span",{className:"text-foreground",children:"إضافة نقدية"}):d?e.jsx("span",{className:"text-foreground",children:"مبيعات"}):m?e.jsx("span",{className:"text-foreground",children:"إيصال تحويل مكينه"}):a.type==="atm_withdraw"?e.jsx("span",{className:"text-green-600",children:"سحب atm"}):a.type==="send"?e.jsx("span",{className:"text-green-600",children:"تحويل أموال"}):e.jsx("span",{className:"text-red-600",children:"سحب نقدي"})})()}),e.jsxs("span",{className:`text-base font-bold whitespace-nowrap ${a.type==="withdraw"?"text-red-600":"text-green-600"}`,children:[a.type==="withdraw"||a.type==="cash_addition"||a.txnType==="cash_addition"||a.type==="sales"||a.txnType==="sales"?"+":"-"," ",Rt(a.amount)," ج.م"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:(()=>{const s=a,i=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("إيصال تسليم وردية"),l=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("إيصال إضافة نقدية"),d=String((s==null?void 0:s.type)||"").toLowerCase()==="sales"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="sales"||String((s==null?void 0:s.title)||"").includes("إيصال مبيعات")||String((s==null?void 0:s.senderMsisdn)||"")==="مبيعات",m=String((s==null?void 0:s.title)||"").includes("إيصال تحويل مكينه")||String((s==null?void 0:s.description)||"").includes("تحويل مكنه"),f=(s==null?void 0:s.note)||(s==null?void 0:s.notes)||"";if(i)return`إلى: ${a.receiverPhone}`;if(l)return f||"إضافة يدوية";if(d){const g=((s==null?void 0:s.saleProductName)||"").trim(),v=((s==null?void 0:s.saleQuantity)??"").toString();return g&&v?`${g} × ${v}`:g||"عملية بيع"}return m?`من: ${s.senderName||"ماكينة"}`:a.type==="send"?e.jsx("span",{dir:"ltr",children:a.receiverPhone}):e.jsx("span",{dir:"ltr",children:a.senderPhone})})()}),e.jsxs("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:[Fr.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))," - ",ou.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))]})]}),e.jsxs("div",{className:`px-2 py-0.5 rounded-full text-[10px] font-medium flex items-center gap-1 ${a.status==="completed"?a.type==="withdraw"?"bg-red-100 text-red-700":"bg-green-100 text-green-700":a.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[a.status==="completed"&&e.jsx(hi,{className:"h-3 w-3"}),a.status==="pending"&&e.jsx(Su,{className:"h-3 w-3"}),a.status==="failed"&&e.jsx(fi,{className:"h-3 w-3"}),e.jsx("span",{children:a.status==="completed"?"ناجحة":a.status==="pending"?"معالجة":"فشلت"})]})]})]})]},a.id))})}),P&&e.jsxs("div",{className:"mt-2 flex justify-end",children:[e.jsxs(I,{variant:"ghost",size:"sm",className:"h-7 px-2 text-[11px] rounded-full border bg-red-100 text-red-700 border-red-300 hover:bg-red-200",onClick:()=>Ar(!0),title:"تصفير المعاملات الأخيرة",children:[e.jsx(ca,{className:"h-3 w-3 mr-1"}),"تصفير"]}),(t==null?void 0:t.uid)&&localStorage.getItem(`recentTransactionsResetAt:${t.uid}`)&&e.jsx("span",{className:"inline-block h-1.5 w-1.5 rounded-full bg-red-500 ml-1 align-middle"})]})]})]})]}),e.jsx(Sv,{isOpen:rf,onClose:()=>kn(!1),transaction:nf,onPrint:()=>window.print(),onDelete:uf,onComplete:mf}),e.jsx(fe,{open:on,onOpenChange:Ra,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(pe,{children:e.jsx(xe,{children:"معلومات المطور"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4 bg-gradient-to-br from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 p-6 rounded-xl border border-blue-100 dark:border-blue-800 text-center",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400 shadow-sm",children:e.jsx(Wg,{className:"h-8 w-8"})}),e.jsxs("div",{className:"space-y-3 w-full",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"معلومات التطوير"}),e.jsx("p",{className:"text-lg font-bold bg-gradient-to-r from-blue-700 to-indigo-700 dark:from-blue-400 dark:to-indigo-400 bg-clip-text text-transparent leading-relaxed",children:"تم تطوير الابلكيشن بالكامل بواسطة م/أحمد عبد الرحيم محمد"}),e.jsxs("div",{className:"flex flex-col items-center gap-1 mt-4",children:[e.jsx("p",{className:"text-base font-semibold text-gray-800 dark:text-gray-300",children:"رقم خدمة العملاء الوحيد لنا"}),e.jsx("a",{href:"tel:01000392539",className:"text-2xl font-black text-blue-600 dark:text-blue-400 tracking-wider hover:underline",dir:"ltr",children:"01000392539"})]}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 font-bold bg-red-50 dark:bg-red-900/20 py-1 px-3 rounded-full inline-block mt-2",children:"ليس لنا اي ارقام اخري"})]})]}),e.jsx("div",{className:"text-center text-xs text-gray-400 mt-2",children:oc?`v${oc}`:"v1.0.0"})]}),e.jsx(Oe,{children:e.jsx(I,{onClick:()=>Ra(!1),children:"إغلاق"})})]})}),e.jsxs("div",{className:"space-y-1 fade-in-right w-full",children:[e.jsxs(Aa,{id:"transaction-section",className:"bg-gray-100 border border-blue-200/40 rounded-lg shadow-lg hover:shadow-lg transition-all duration-200 group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/5 via-indigo-500/3 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-28 sm:h-28 lg:w-20 lg:h-20 bg-gradient-to-bl from-blue-400/10 to-transparent rounded-full  "}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-indigo-400/10 to-transparent rounded-full  ",style:{animationDelay:"1s"}}),e.jsx(gs,{className:"sticky top-0 z-20 bg-white/80 dark:bg-gray-900/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:supports-[backdrop-filter]:bg-gray-900/60 pb-0.5 px-3 pt-1 lg:pt-0.5 lg:pb-0.5 lg:px-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ps,{className:"text-sm font-bold flex items-center gap-2 text-gray-800",children:[e.jsxs("div",{className:"relative",children:[e.jsx(xi,{className:"h-1 w-1 text-emerald-500 "}),e.jsx("div",{className:"absolute inset-0 h-1 w-1 bg-emerald-400 rounded-full opacity-20 "})]}),e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"إجراء معاملة جديدة"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"top-icons-bar hidden md:flex items-center gap-2 bg-gradient-to-r from-gray-50 to-slate-50 hover:from-gray-100 hover:to-slate-100 border border-gray-200 transition-all duration-300 hover:scale-105 h-9 px-3 rounded-xl shadow-sm",children:[e.jsx(Gb,{}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"VIP",onClick:()=>wo(!0),children:e.jsx(ip,{className:"h-5 w-5 text-yellow-500"})}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"إدارة الفروع",onClick:()=>(Nt==null?void 0:Nt.status)==="active"?La(!0):tr(!0),children:e.jsx(Vr,{className:"h-5 w-5"})}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"معلومات المطور",onClick:()=>Ra(!0),children:e.jsx(Nu,{className:"h-5 w-5 text-gray-600"})}),e.jsx(ep,{})]})}),P0&&e.jsxs(I,{variant:"outline",size:"sm",className:"hidden flex items-center gap-1.5 sm:gap-2 bg-gradient-to-r from-cyan-50 to-blue-50 hover:from-cyan-100 hover:to-blue-100 border-cyan-200 text-cyan-800 text-xs sm:text-sm transition-all duration-300 hover:scale-105 hover:shadow-lg h-10 sm:h-12 px-4 sm:px-5 rounded-xl min-w-[44px] touch-manipulation",onClick:Hd,title:"مزامنة البيانات المحفوظة محلياً مع الخادم",children:[e.jsx(bl,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 animate-spin"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold whitespace-nowrap",children:"مزامنة"})]})]})}),e.jsx(fe,{open:Pf,onOpenChange:wo,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(pe,{children:e.jsx(xe,{children:"أفضل 10 عملاء هذا الشهر"})}),e.jsx("div",{className:"space-y-2",children:si.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"لا توجد بيانات لهذا الشهر"}):si.map((a,s)=>e.jsxs("div",{className:`flex items-center justify-between border rounded-md px-3 py-2 bg-white dark:bg-gray-800 dark:border-gray-700 ${s===0?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-300 dark:border-yellow-700":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pa,{variant:"outline",className:`min-w-[28px] justify-center ${s===0?"border-yellow-300 text-yellow-700 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20":""}`,children:s+1}),e.jsx("span",{className:`font-semibold ${s===0?"text-yellow-700":""}`,children:a.phone})]}),e.jsxs("div",{className:"text-sm text-gray-700 flex items-center gap-3",children:[e.jsxs("span",{children:["عدد: ",a.count]}),e.jsxs("span",{children:["إجمالي: ",a.total]}),e.jsx(I,{variant:"outline",size:"sm",className:"h-8",onClick:()=>_0(a),title:"إرسال واتساب",children:e.jsx(fl,{className:"h-4 w-4"})})]})]},a.phone+s))}),e.jsx(Oe,{children:e.jsx(I,{onClick:()=>wo(!1),children:"إغلاق"})})]})}),e.jsx(fe,{open:_f,onOpenChange:ed,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(pe,{children:e.jsx(xe,{children:"ربط بوت التلجرام"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(H,{children:"Telegram Chat ID"}),e.jsx(J,{value:Pn,onChange:a=>Af(a.target.value),placeholder:"اكتب رقم المحادثة"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(H,{children:"إرسال يومي 12 صباحاً"}),e.jsx(Zg,{checked:td,onCheckedChange:a=>Tf(!!a)})]})]}),e.jsxs(Oe,{children:[e.jsx(I,{variant:"outline",onClick:()=>ed(!1),children:"إغلاق"}),e.jsx(I,{onClick:async()=>{t!=null&&t.uid&&(await oe.updateUserData(t.uid,{telegramChatId:Pn,telegramDailyEnabled:td}),p({title:"تم الحفظ"}))},children:"حفظ"}),e.jsx(I,{onClick:async()=>{if(!(t!=null&&t.uid)||!Pn){p({title:"أدخل Chat ID"});return}const a=await Xd();try{const{sendTelegramMessage:s}=await ne(async()=>{const{sendTelegramMessage:i}=await import("./functions-P4y9aL9k.js");return{sendTelegramMessage:i}},__vite__mapDeps([63,0,1]),import.meta.url);await s({chatId:Pn,text:a}),p({title:"تم الإرسال"})}catch{p({title:"تعذر الإرسال",description:"تحقق من ربط البوت",variant:"destructive"})}},children:"إرسال الآن"})]})]})}),e.jsx(fe,{open:Wa,onOpenChange:La,children:e.jsxs(ge,{className:"sm:max-w-2xl bg-gray-50/80 backdrop-blur-sm",children:[e.jsx(pe,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg",children:e.jsx(Vr,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx(xe,{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"إدارة الفروع"}),e.jsx(rt,{className:"text-gray-500 dark:text-gray-400 mt-1",children:"أضف فروعاً جديدة وتابع أداء كل فرع بسهولة"})]})]}),e.jsx(I,{size:"icon",variant:bs?"destructive":"default",className:`rounded-full transition-all duration-300 ${bs?"bg-red-50 text-red-600 hover:bg-red-100 border border-red-200":"bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg hover:shadow-indigo-200"}`,onClick:()=>rc(!bs),title:bs?"إلغاء الإضافة":"إضافة فرع جديد",children:bs?e.jsx(gi,{className:"w-6 h-6"}):e.jsx(It,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"space-y-6",children:[bs&&e.jsxs("div",{className:"bg-white dark:bg-card p-5 rounded-xl border border-gray-200 dark:border-gray-800 shadow-sm space-y-4 animate-in slide-in-from-top-4 fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-700 dark:text-indigo-400 font-semibold",children:[e.jsx(It,{className:"w-5 h-5"}),e.jsx("h3",{children:"إضافة فرع جديد"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{onClick:()=>checkSubscriptionStatus(!0).then(()=>p({title:"تم تحديث البيانات"})),variant:"ghost",size:"icon",title:"تحديث بيانات الاشتراك",children:e.jsx(bl,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})}),e.jsxs(I,{onClick:()=>tr(!0),variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(hp,{className:"w-4 h-4"}),"طلب زيادة فرع"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"text-gray-700 dark:text-gray-300",children:"اسم المدير"}),e.jsxs("div",{className:"relative",children:[e.jsx(qr,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(J,{className:"pr-9 bg-white dark:bg-gray-950 dark:border-gray-700 dark:text-gray-100",value:Jl,onChange:a=>_i(a.target.value),placeholder:"مثال: أحمد محمد"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"text-gray-700 dark:text-gray-300",children:"اسم الفرع"}),e.jsxs("div",{className:"relative",children:[e.jsx(Vr,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(J,{className:"pr-9 bg-white dark:bg-gray-950 dark:border-gray-700 dark:text-gray-100",value:Hl,onChange:a=>Ai(a.target.value),placeholder:"مثال: فرع وسط البلد"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"text-gray-700 dark:text-gray-300",children:"البريد الإلكتروني للدخول"}),e.jsxs("div",{className:"relative",children:[e.jsx(fl,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(J,{className:"pr-9 bg-white dark:bg-gray-950 dark:border-gray-700 dark:text-gray-100",value:Ql,onChange:a=>Ti(a.target.value),placeholder:"branch@example.com"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"text-gray-700 dark:text-gray-300",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400",children:"🔒"}),e.jsx(J,{type:"password",className:"pr-9 bg-white dark:bg-gray-950 dark:border-gray-700 dark:text-gray-100",value:Gl,onChange:a=>Pi(a.target.value),onKeyDown:a=>{var s;a.key==="Enter"&&(a.preventDefault(),a.stopPropagation(),(s=document.getElementById("create-branch-btn"))==null||s.click())},placeholder:"••••••"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-2",children:[e.jsx(I,{variant:"ghost",onClick:()=>{_i(""),Ai(""),Ti(""),Pi("")},className:"text-gray-500 hover:text-gray-700",children:"مسح الحقول"}),e.jsx(I,{id:"create-branch-btn",className:"bg-indigo-600 hover:bg-indigo-700 text-white min-w-[120px]",disabled:Ei,onClick:async()=>{if(!(t!=null&&t.uid))return;const a=Jl.trim(),s=Hl.trim(),i=Ql.trim(),l=Gl.trim();if(!a||!s||!i||!l){p({title:"يرجى ملء جميع الحقول المطلوبة"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){p({title:"البريد الإلكتروني غير صالح",variant:"destructive"});return}if(l.length<6){p({title:"كلمة السر يجب أن تكون 6 أحرف على الأقل",variant:"destructive"});return}const m=(Nt==null?void 0:Nt.limit)||0;if(ar.length>=m){p({title:"عفواً",description:`لقد وصلت للحد الأقصى من الفروع (${m} فروع)`,variant:"destructive"});return}try{ln(!0);let f="",g="";const v=`tempApp_${Date.now()}`,y=Cg(Ig,v),b=_g(y),w=Ag(y);try{f=(await Tg(b,i,l)).user.uid;try{await Gt(Ae(w,"users",f),{email:i,isActive:!0,isBranch:!0,ownerId:t.uid,createdAt:ht(),updatedAt:ht(),role:"branch",isActive:!1,subscription:{isActive:!1,planType:null,startDate:null,endDate:null}})}catch(A){console.error("Error creating branch user document:",A)}try{g=(await Yr(de(w,"shops"),{name:s,ownerId:f,managerName:a,createdAt:ht(),updatedAt:ht(),isActive:!0})).id}catch(A){console.error("Error creating shop as new user:",A);try{g=(await Yr(de(w,"users",f,"shops"),{name:s,ownerId:f,managerName:a,createdAt:ht(),updatedAt:ht(),isActive:!0})).id}catch(L){throw console.error("Error creating shop in subcollection:",L),A}}await Pg(b)}catch(k){console.error("Registration/Shop Creation Error:",k);let A="تعذر إنشاء المستخدم أو المتجر";k.code==="auth/email-already-in-use"&&(A="البريد الإلكتروني مستخدم بالفعل"),k.code==="auth/invalid-email"&&(A="البريد الإلكتروني غير صالح"),k.code==="auth/weak-password"&&(A="كلمة المرور ضعيفة"),k.code==="permission-denied"&&(A="ليس لديك صلاحية لإنشاء متجر لهذا المستخدم"),p({title:A,description:k.message,variant:"destructive"});try{await Du(y)}catch{}return}finally{try{await Du(y)}catch(k){console.warn("Error deleting temp app:",k)}}if(!f||!g)return;const C=k=>{try{return btoa(unescape(encodeURIComponent(k)))}catch{return btoa(k)}};try{const k={ownerId:t.uid,shopId:g,branchUserId:f,branchName:s,managerName:a,loginUsername:i,passwordEncoded:C(l),createdAt:ht()};await Gt(Ae($,"users",t.uid,"branches",f),k);try{await Yr(de($,"branches"),k)}catch(L){console.warn("Branch ref creation error in root collection (non-fatal):",L)}const A={id:f,branchUserId:f,branchName:s,managerName:a,source:"sub",...k};Ii(L=>[...L,A])}catch(k){console.error("Branch ref creation error:",k),p({title:"خطأ في حفظ بيانات الفرع",description:"تم إنشاء المستخدم ولكن فشل حفظ البيانات",variant:"destructive"})}_i(""),Ai(""),Ti(""),Pi(""),p({title:"تم إضافة الفرع وإنشاء المستخدم بنجاح"})}catch(f){console.error("General Error adding branch:",f),p({title:"تعذّر إضافة الفرع",description:f.message||"حدث خطأ غير متوقع"})}finally{ln(!1)}},children:Ei?"جارٍ الإضافة...":"إضافة فرع"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-6 bg-indigo-500 rounded-full"}),"الفروع الحالية",e.jsxs(Pa,{variant:"secondary",className:"mr-auto",children:[ar.length," / ",(Nt==null?void 0:Nt.limit)||0]})]}),Ei&&ar.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:[e.jsx(bl,{className:"w-8 h-8 animate-spin mb-2 text-indigo-400"}),e.jsx("p",{children:"جارٍ تحميل الفروع..."})]}):ar.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-xl bg-gray-50 dark:bg-gray-900/50",children:[e.jsx(Vr,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"لا يوجد فروع مضافة حالياً"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-3",children:ar.map(a=>{var s;return e.jsx("div",{className:"group relative bg-white dark:bg-card border border-gray-200 dark:border-gray-800 rounded-xl p-4 shadow-sm hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-700 dark:text-indigo-400 font-bold text-lg",children:((s=a.branchName)==null?void 0:s.charAt(0))||"B"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-gray-900 dark:text-gray-100 text-lg",children:a.branchName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(qr,{className:"w-3 h-3"}),e.jsxs("span",{children:["المدير: ",a.managerName]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto mt-2 sm:mt-0",children:[e.jsxs(I,{className:"flex-1 sm:flex-none bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200 dark:bg-indigo-900/20 dark:text-indigo-300 dark:hover:bg-indigo-900/30 dark:border-indigo-800",onClick:()=>ph(a),children:[e.jsx(yl,{className:"w-4 h-4 ml-2"}),"عرض البيانات"]}),e.jsx(I,{variant:"ghost",size:"icon",className:"text-blue-500 hover:text-blue-700 hover:bg-blue-50 dark:text-blue-400 dark:hover:text-blue-300 dark:hover:bg-blue-900/20",title:"تعديل بيانات الفرع",onClick:()=>fh(a),children:e.jsx(Mu,{className:"w-4 h-4"})})]})]})},a.id)})})]})]})]})}),e.jsx(fe,{open:th,onOpenChange:Oi,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"دخول الفرع"}),e.jsx(rt,{children:"أدخل بيانات الدخول للفرع المحدد"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(H,{children:"اسم المستخدم (البريد الإلكتروني)"}),e.jsx(J,{value:Xl,onChange:a=>Zl(a.target.value),placeholder:"example@email.com"})]}),e.jsxs("div",{children:[e.jsx(H,{children:"كلمة السر"}),e.jsx(J,{type:"password",value:ec,onChange:a=>tc(a.target.value),onKeyDown:a=>{var s;a.key==="Enter"&&(a.preventDefault(),a.stopPropagation(),(s=document.getElementById("branch-login-btn"))==null||s.click())},placeholder:"••••••"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{Zl(""),tc("")},children:"مسح"}),e.jsx(I,{id:"branch-login-btn",className:"bg-blue-600 hover:bg-blue-700",disabled:sh,onClick:async()=>{const a=ah;if(!a){Oi(!1);return}const s=String(a.loginUsername||"");let i="";try{const m=String(a.passwordEncoded||"");i=m?decodeURIComponent(escape(atob(m))):""}catch{try{i=a.passwordEncoded?atob(String(a.passwordEncoded)):""}catch{i=""}}const l=Xl.trim(),d=ec.trim();if(!l||!d){p({title:"يرجى إدخال اسم المستخدم وكلمة السر"});return}if(l!==s||d!==i){p({title:"بيانات الدخول غير صحيحة",variant:"destructive"});return}try{ac(!0);const m=t!=null&&t.uid?`selectedShopId_${t.uid}`:"selectedShopId";localStorage.setItem(m,String(a.shopId)),p({title:"تم الدخول إلى الفرع",description:String(a.branchName||"")}),Oi(!1),La(!1),x("/user/dashboard")}catch{}ac(!1)},children:"دخول"})]})]})]})}),e.jsx(fe,{open:rh,onOpenChange:cn,children:e.jsxs(ge,{className:"sm:max-w-2xl",children:[e.jsxs(pe,{children:[e.jsxs(xe,{children:["بيانات فرع ",At==null?void 0:At.branchName]}),e.jsxs(rt,{children:["مدير الفرع: ",At==null?void 0:At.managerName]})]}),nh?e.jsx("div",{className:"py-8 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):At?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 py-4",children:[e.jsxs("div",{className:"p-4 border rounded-xl bg-green-50 dark:bg-green-950/20 dark:border-green-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"مبيعات اليوم"}),e.jsxs("div",{className:"text-xl font-bold text-green-700 dark:text-green-400",children:[Rt(At.todaySales)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-blue-50 dark:bg-blue-950/20 dark:border-blue-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"مبيعات الشهر"}),e.jsxs("div",{className:"text-xl font-bold text-blue-700 dark:text-blue-400",children:[Rt(At.monthSales)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-emerald-50 dark:bg-emerald-950/20 dark:border-emerald-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"ارباح اليوم"}),e.jsxs("div",{className:"text-xl font-bold text-emerald-700 dark:text-emerald-400",children:[Rt(At.todayProfit)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-cyan-50 dark:bg-cyan-950/20 dark:border-cyan-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"ارباح الشهر"}),e.jsxs("div",{className:"text-xl font-bold text-cyan-700 dark:text-cyan-400",children:[Rt(At.monthProfit)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-purple-50 dark:bg-purple-950/20 dark:border-purple-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"أرصدة المحافظ"}),e.jsxs("div",{className:"text-xl font-bold text-purple-700 dark:text-purple-400",children:[Rt(At.walletsTotal)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-yellow-50 dark:bg-yellow-950/20 dark:border-yellow-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"نقدية الدرج"}),e.jsxs("div",{className:"text-xl font-bold text-yellow-700 dark:text-yellow-400",children:[Rt(At.cashBalance)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-indigo-50 dark:bg-indigo-950/20 dark:border-indigo-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"مبيعات قسم المبيعات"}),e.jsxs("div",{className:"text-xl font-bold text-indigo-700 dark:text-indigo-400",children:[Rt(At.totalSalesSection)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-red-50 dark:bg-red-950/20 dark:border-red-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"مجموع الديون"}),e.jsxs("div",{className:"text-xl font-bold text-red-700 dark:text-red-400",children:[Rt(At.debtsTotal)," ج.م"]})]})]}):null,e.jsx(Oe,{children:e.jsx(I,{onClick:()=>cn(!1),children:"إغلاق"})})]})}),e.jsx(fe,{open:dh,onOpenChange:dn,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"تعديل بيانات الفرع"}),e.jsx(rt,{children:"تعديل اسم الفرع واسم المدير"})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"البريد الإلكتروني (اسم المستخدم)"}),e.jsx(J,{value:mh,readOnly:!0,disabled:!0,placeholder:"لا يوجد بريد مسجل",className:"bg-gray-100 dark:bg-gray-800 text-black dark:text-gray-100 opacity-100 font-medium"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"اسم الفرع"}),e.jsx(J,{value:un,onChange:a=>dc(a.target.value),placeholder:"مثال: فرع القاهرة"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{children:"اسم المدير"}),e.jsx(J,{value:mn,onChange:a=>uc(a.target.value),placeholder:"مثال: أحمد محمد"})]})]}),e.jsxs(Oe,{children:[e.jsx(I,{variant:"outline",onClick:()=>dn(!1),children:"إلغاء"}),e.jsx(I,{onClick:gh,disabled:mc,children:mc?"جارٍ الحفظ...":"حفظ التعديلات"})]})]})}),e.jsxs(Ta,{ref:z,className:"space-y-1 px-2 pb-2 relative z-10 transition-transform duration-200 ease-out will-change-transform",style:{transform:B?`translateY(${B}px)`:void 0},onFocusCapture:a=>{const s=a.target;if(!((s==null?void 0:s.id)==="transferExtraFeeInput")){le(0);return}const l=document.getElementById("transferSubmitButton");if(l){const d=l.getBoundingClientRect(),m=window.innerHeight;if(d.bottom>m){const f=d.bottom-m,g=Math.min(f,220);le(-g)}else le(0)}else le(0)},onBlurCapture:a=>{a.currentTarget.contains(a.relatedTarget)||le(0)},children:[e.jsxs("div",{className:"transaction-type-tabs flex w-full rounded-full border border-gray-300 dark:border-gray-700 overflow-hidden bg-surface dark:bg-card",children:[e.jsxs("button",{type:"button",onClick:()=>ci("transfer"),className:`flex-1 h-10 text-sm font-medium transition-colors duration-200 flex items-center justify-center gap-2 ${F==="transfer"?"bg-blue-100 text-blue-900 dark:bg-blue-900/40 dark:text-blue-100":"bg-transparent text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[F==="transfer"&&e.jsx(hi,{className:"h-4 w-4"}),e.jsx(Ur,{className:"h-4 w-4"}),"تحويل"]}),e.jsx("div",{className:"w-[1px] bg-gray-300 dark:bg-gray-700"}),e.jsxs("button",{type:"button",onClick:()=>V("withdrawals",()=>ci("withdraw")),className:`flex-1 h-10 text-sm font-medium transition-colors duration-200 flex items-center justify-center gap-2 ${F==="withdraw"?"bg-red-100 text-red-900 dark:bg-red-900/40 dark:text-red-100":"bg-transparent text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[F==="withdraw"&&e.jsx(hi,{className:"h-4 w-4"}),e.jsx(Ks,{className:"h-4 w-4"}),"سحب"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-3",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 flex items-center gap-2 whitespace-nowrap",children:[e.jsx(Vs,{className:"h-4 w-4 text-blue-600"}),"اختيار المحفظة"]}),e.jsxs("div",{className:"flex items-center gap-1 justify-end overflow-x-auto scrollbar-hide",children:[e.jsxs(I,{variant:"outline",size:"sm",className:"h-7 rounded-md px-2 text-[10px] font-medium bg-emerald-50 text-emerald-700 hover:bg-emerald-100 border-emerald-200 shadow-sm whitespace-nowrap",onClick:()=>x("/user/add-wallet"),title:"إضافة محفظة",children:[e.jsx(It,{className:"h-3 w-3 mr-1"}),"إضافة محفظة"]}),e.jsxs(I,{variant:"outline",size:"sm",className:"h-7 rounded-md px-2 text-[10px] font-medium bg-orange-50 text-orange-700 hover:bg-orange-100 border-orange-200 shadow-sm whitespace-nowrap",onClick:()=>Fe(!0),title:"طباعة محفظة",children:[e.jsx(op,{className:"h-3 w-3 mr-1"}),"طباعة"]}),e.jsxs(I,{variant:"outline",size:"sm",className:"h-7 rounded-md px-2 text-[10px] font-medium bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border-indigo-200 shadow-sm whitespace-nowrap",onClick:()=>{bn(!0)},title:"المحافظ",children:[e.jsx(Vs,{className:"h-3 w-3 mr-1"}),"المحافظ"]})]})]}),M.length>0?e.jsxs(Ja,{value:W,onValueChange:M0,children:[e.jsx(Ha,{"data-testid":"wallet-select",className:"w-full h-14 text-base bg-surface border border-gray-400 hover:border-gray-800 focus:border-primary rounded-xl transition-colors duration-200 flex items-center",children:e.jsx(Qa,{placeholder:"اختر محفظة للمعاملة",className:"text-gray-700"})}),e.jsxs(Ga,{className:"rounded-xl border border-gray-200 dark:border-gray-800 shadow-md z-[9999] bg-white dark:bg-gray-900",children:[e.jsx("div",{"data-fixed-header":"true",className:"sticky top-0 z-10 bg-white dark:bg-gray-900 p-2 border-b border-gray-100 dark:border-gray-800",children:e.jsx(J,{value:Lc,onChange:a=>ef(a.target.value),placeholder:"ابحث برقم المحفظة",className:"h-10 text-sm border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 rounded-lg"})}),e.jsx("div",{className:"p-1",children:Bc.length===0?e.jsx("div",{className:"text-sm text-gray-500 p-3 text-center",children:"لا توجد نتائج مطابقة"}):Bc.map(a=>{const s=Be.includes(a.id);return e.jsx(da,{value:a.id,className:"rounded-lg my-1 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 focus:bg-blue-50 dark:focus:bg-blue-900/20 transition-colors duration-200",children:e.jsxs("div",{className:"flex items-center gap-3 py-2 w-full",children:[e.jsx(Vs,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"}),e.jsxs("div",{className:"flex items-center gap-2 text-right",children:[e.jsx("span",{className:"text-base font-medium text-gray-900 dark:text-gray-100",children:a.name}),e.jsx("span",{className:"text-sm font-bold text-red-600 dark:text-red-400",children:a.phone})]}),a.isDefault&&e.jsx("span",{className:"mr-auto text-[10px] bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 px-2 py-0.5 rounded-full border border-gray-200 dark:border-gray-700",children:"افتراضي"}),e.jsx("button",{type:"button",onMouseDown:i=>{i.preventDefault(),i.stopPropagation(),tf(a.id)},className:"ml-2 mr-auto rounded-full p-1 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 cursor-pointer",title:s?"إزالة من المفضلة":"تعيين كمحفظة مفضلة",children:e.jsx(lp,{className:`h-4 w-4 ${s?"text-yellow-500 fill-yellow-400 drop-shadow-[0_0_4px_rgba(250,204,21,0.8)]":"text-gray-400"}`})})]})},a.id)})})]})]}):e.jsx("div",{className:"rounded-xl border-2 border-dashed border-gray-200 bg-gray-50 px-3 py-3 text-xs text-gray-600",children:"لا توجد محافظ حتى الآن. اضغط “إضافة محفظة” لإضافة أول محفظة."})]}),e.jsx(fe,{open:Ph,onOpenChange:Tc,children:e.jsxs(ge,{className:"sm:max-w-3xl w-[95vw] sm:w-auto max-h-[80vh] overflow-y-auto",children:[e.jsx(pe,{children:e.jsx(xe,{children:"عرض المحافظ"})}),e.jsx("div",{className:"mt-2",children:e.jsx(Fv,{showAddButton:!1,showUsageBars:!1,showLimitCards:!1,showEditButton:!0})})]})}),e.jsx(aa,{open:Eh,onOpenChange:bn,mode:"verify",title:"الرقم السري لفتح المحافظ",description:"أدخل الرقم السري الرئيسي لعرض وإدارة المحافظ",onSuccess:()=>{bn(!1),Tc(!0)},userId:t==null?void 0:t.uid,userRole:n==null?void 0:n.role}),e.jsx(Xu,{isOpen:Re,onClose:()=>Fe(!1),wallets:M}),e.jsx(aa,{open:Oh,onOpenChange:a=>{Zi(a),a||eo(null)},mode:"verify",title:"تأكيد تغيير المحفظة",description:"أدخل الرقم السري الرئيسي لتغيير المحفظة المختارة",onSuccess:()=>{Pc&&(Rr(Pc,"walletSelectionPin"),eo(null)),Zi(!1)},userId:t==null?void 0:t.uid,userRole:n==null?void 0:n.role}),W&&M.length>0&&(()=>{var E;const a=M.find(q=>q.id===W),s=_a,i=B0,l=(be==null?void 0:be.monthlyWithdrawLimit)??(a==null?void 0:a.monthlyWithdrawalLimit)??2e5,d=(be==null?void 0:be.monthlyTransferLimit)??(a==null?void 0:a.monthlyTransferLimit)??2e5,m=(be==null?void 0:be.monthlyWithdrawUsed)??s.totalWithdrawn??0,f=(be==null?void 0:be.monthlyTransferUsed)??s.totalTransferred??0,g=((E=Tt==null?void 0:Tt.subscription)==null?void 0:E.planType)===Qt.TAHWEELA,v=g?0:(be==null?void 0:be.dailyWithdrawLimit)??1e5,y=g?0:(be==null?void 0:be.dailyTransferLimit)??6e4,b=g?0:(be==null?void 0:be.dailyWithdrawUsed)??i.totalWithdrawn??0,w=g?0:(be==null?void 0:be.dailyTransferUsed)??i.totalTransferred??0,C=parseFloat(xt||"0")||0,k=m+(F==="withdraw"?C:0),A=f+(F==="transfer"?C:0),L=b+(F==="withdraw"?C:0),_=w+(F==="transfer"?C:0);return a?e.jsxs("div",{className:"mb-2 space-y-2 p-2 bg-gray-50 dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 shadow-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 dark:border-gray-800 pb-1",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800 dark:text-gray-200",children:"الحدود الشهرية"}),e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 px-2 py-0.5 rounded-full border border-gray-200 dark:border-gray-700",children:t0||(a==null?void 0:a.name)})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700",children:"سحب شهري"}),e.jsxs("span",{className:"text-gray-600 dir-ltr",children:[Math.max(l-k,0).toLocaleString("en-US",{maximumFractionDigits:0})," متبقي"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50 dark:ring-gray-700/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-red-500 to-red-600 rounded-full transition-all duration-500 ease-out shadow-sm",style:{width:`${Math.min(k/Math.max(l,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["المستخدم: ",k.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["الحد: ",l.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]}),e.jsx("div",{className:"w-[1px] bg-gray-200 self-stretch"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"تحويل شهري"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 dir-ltr",children:[Math.max(d-A,0).toLocaleString("en-US",{maximumFractionDigits:0})," متبقي"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50 dark:ring-gray-700/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-blue-500 to-blue-600 rounded-full transition-all duration-500 ease-out shadow-sm",style:{width:`${Math.min(A/Math.max(d,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["المستخدم: ",A.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["الحد: ",d.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]})]})]}),e.jsxs("div",{className:"space-y-1 pt-1.5 border-t border-gray-200 dark:border-gray-800",children:[e.jsx("div",{className:"flex items-center justify-between mb-0.5",children:e.jsx("span",{className:"text-sm font-bold text-gray-800 dark:text-gray-200",children:"الحدود اليومية"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"سحب يومي"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 dir-ltr",children:[Math.max(v-L,0).toLocaleString("en-US",{maximumFractionDigits:0})," متبقي"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50 dark:ring-gray-700/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-orange-400 to-orange-500 rounded-full transition-all duration-500 ease-out",style:{width:`${Math.min(L/Math.max(v,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["المستخدم: ",L.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["الحد: ",v.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]}),e.jsx("div",{className:"w-[1px] bg-gray-200 dark:bg-gray-800 self-stretch"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"تحويل يومي"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 dir-ltr",children:[Math.max(y-_,0).toLocaleString("en-US",{maximumFractionDigits:0})," متبقي"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50 dark:ring-gray-700/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-green-500 to-green-600 rounded-full transition-all duration-500 ease-out",style:{width:`${Math.min(_/Math.max(y,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["المستخدم: ",_.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["الحد: ",y.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]})]})]})]}):null})(),F==="transfer"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"رقم المرسل"}),e.jsxs("div",{className:"relative group",children:[e.jsx(mi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-green-600 group-focus-within:text-green-700"}),e.jsx(J,{value:Yt,onChange:a=>Ds(a.target.value),onKeyDown:a=>{if(a.key==="Enter"){const s=document.getElementById("receiverPhoneInput");if(s)s.focus();else{const i=document.getElementById("amountInput");i==null||i.focus()}}},placeholder:"01030302038",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-blue-600 focus:ring-1 focus:ring-blue-600 dark:text-gray-100"})]})]}),!c&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"رقم المستقبل"}),e.jsxs("div",{className:"relative group",children:[e.jsx(mi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-green-600 group-focus-within:text-green-700"}),e.jsx(J,{id:"receiverPhoneInput",value:jt,onChange:a=>{ur(a.target.value),fo&&Ts(!1)},onKeyDown:a=>{if(a.key==="Enter"){a.preventDefault(),a.stopPropagation();const s=document.getElementById("amountInput");s==null||s.focus()}},inputMode:"numeric",maxLength:11,placeholder:"أدخل رقم المستقبل",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-blue-600 focus:ring-1 focus:ring-blue-600 dark:text-gray-100"})]})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"رقم المستقبل"}),e.jsxs("div",{className:"relative",children:[e.jsx(mi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400"}),e.jsx(J,{value:W&&((cu=M.find(a=>a.id===W))==null?void 0:cu.phone)||"",readOnly:!0,placeholder:"اختر محفظة أولاً",className:"pl-10 h-10 text-sm lg:text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl dark:text-gray-100"})]})]}),F==="transfer"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"المبلغ (جنيه)"}),e.jsxs("div",{className:"relative flex items-center gap-2 group",children:[e.jsx(Oa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-yellow-600 group-focus-within:text-yellow-700"}),e.jsx(J,{id:"amountInput",value:xt,onChange:a=>{ks(a.target.value),fo&&Ts(!1)},onKeyDown:a=>{if(a.key==="Enter"){a.preventDefault(),a.stopPropagation();const s=document.getElementById("transferCommissionInput");if(s)s.focus();else{const i=document.getElementById("quickDebtButton");i==null||i.focus()}}},placeholder:"أدخل المبلغ",type:"number",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-blue-600 focus:ring-1 focus:ring-blue-600 dark:text-gray-100"})]}),sa?e.jsxs("div",{className:"mt-2 text-xs text-green-700 dark:text-green-400 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-900/30 rounded px-2 py-1 flex items-center gap-2",children:[e.jsxs("span",{children:["تم إدخال تفاصيل الأجل لـ ",sa.debtorName," بمبلغ ",sa.amount," جنيه"]}),e.jsx(I,{type:"button",variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>Xi(null),children:"إلغاء"})]}):null]}),(()=>{if(c)return null;const a=nt();return a&&a.defaultTransferCommission!=null?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"عمولة التحويل (تلقائية)"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["سيتم تطبيق عمولة التحويل الافتراضية لكل ألف: ",a==null?void 0:a.defaultTransferCommission," جنيه لكل ألف"]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(I,{id:"quickDebtButton",type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium",onClick:()=>{const i=nt(),l=(i==null?void 0:i.defaultTransferCommission)!=null?Number(i.defaultTransferCommission):0,d=parseFloat(xt||"0")||0,m=Math.round((l||0)*d/1e3*100)/100,f=d+m;ns((f||0).toString()),je?p({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):Cs(!0)},children:"أجل"}),e.jsx(I,{type:"button",variant:"outline",size:"icon",className:"hidden",title:Je?"العمولة تُضاف":"العمولة تُخصم",children:Je?e.jsx(It,{className:"h-4 w-4 text-green-600"}):e.jsx(gi,{className:"h-4 w-4 text-red-600"})}),e.jsx("span",{className:"hidden",children:Je?"العمولة تُضاف":"العمولة تُخصم"})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"عمولة التحويل على العملية (جنيه)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(Oa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-yellow-600 group-focus-within:text-yellow-700"}),e.jsx(J,{id:"transferCommissionInput",value:St,onChange:i=>wn(i.target.value),onKeyDown:i=>{if(i.key==="Enter"){i.preventDefault(),i.stopPropagation();const l=document.getElementById("transferExtraFeeInput");if(l)l.focus();else{const d=document.getElementById("transferSubmitButton");d==null||d.click()}}},placeholder:"أدخل عمولة التحويل",type:"number",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-orange-500 focus:ring-1 focus:ring-orange-500 dark:text-gray-100"})]}),e.jsx(I,{type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium dark:bg-red-700 dark:hover:bg-red-800",onClick:()=>{const i=nt(),l=parseFloat(xt||"0")||0;let d=0;if((i==null?void 0:i.defaultTransferCommission)!=null){const f=Number(i.defaultTransferCommission)||0;d=Math.round(f*l/1e3*100)/100}else{const f=St&&St.trim()!==""?parseFloat(St):0;d=Math.max(0,f)}const m=l+d;ns((m||0).toString()),je?p({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):Cs(!0)},children:"أجل"}),e.jsx(I,{type:"button",variant:"outline",size:"icon",className:"hidden",title:Je?"العمولة تُضاف":"العمولة تُخصم",children:Je?e.jsx(It,{className:"h-4 w-4 text-green-600"}):e.jsx(gi,{className:"h-4 w-4 text-red-600"})}),e.jsx("span",{className:"hidden",children:Je?"العمولة تُضاف":"العمولة تُخصم"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"يمكنك إدخال عمولة العملية الإجمالية (اختياري)"})]})})(),Fh&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"رسوم التحويل (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Oa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-yellow-600"}),e.jsx(J,{id:"transferExtraFeeInput",value:Ec,onChange:a=>Mh(a.target.value),placeholder:"أدخل رسوم التحويل",type:"number",className:"pl-10 h-10 text-sm lg:text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 hover:border-blue-400 focus:border-blue-500 dark:text-gray-100"})]}),e.jsx("div",{className:"hidden",children:"تُخصم من المحفظة وتضاف للدرج — لعمليات 010 → 011/012/015 أو 012 → 010 أو 011 → 010 أو 015 → 010"})]}),e.jsxs("div",{className:"sticky bottom-0 z-20 pt-2 pb-2 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 backdrop-blur supports-[backdrop-filter]:bg-white/90 dark:supports-[backdrop-filter]:bg-gray-900/90",children:[e.jsx(I,{id:"transferSubmitButton",onClick:iu,className:"w-full h-12 text-base font-medium rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-none hover:shadow-md",children:fo?"تم التحويل بنجاح":"تأكيد التحويل"}),Rh&&e.jsxs("div",{className:"flex items-start gap-2 mt-2 px-1",children:[e.jsx(ju,{className:"h-4 w-4 text-amber-500 shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-gray-500 leading-tight",children:["تم الوصول إلى 85% من الحد الشهري للمحفظة ",to==null?void 0:to.walletName]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"مبلغ السحب (جنيه)"}),e.jsxs("div",{className:"relative group",children:[e.jsx(Ks,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-primary"}),e.jsx(J,{id:"amountInput",value:xt,onChange:a=>{ks(a.target.value),go&&br(!1)},onKeyDown:a=>{if(a.key==="Enter"){a.preventDefault(),a.stopPropagation();const s=document.getElementById("manualWithdrawCommissionInput");if(s)s.focus();else{const i=document.getElementById("withdrawSubmitButton");i==null||i.focus()}}},placeholder:"أدخل مبلغ السحب",type:"number",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-primary focus:ring-1 focus:ring-primary dark:text-gray-100"})]})]}),Wh&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"اسم الراسل (اختياري)"}),e.jsxs("div",{className:"relative",children:[e.jsx(qr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-500"}),e.jsx(J,{id:"withdrawSenderNameInput",value:mr,onChange:a=>Cc(a.target.value),onKeyDown:a=>{if(a.key==="Enter"){a.preventDefault(),a.stopPropagation();const s=document.getElementById("manualWithdrawCommissionInput");s==null||s.focus()}},placeholder:"أدخل اسم الراسل إن وجد",className:"pl-10 h-10 text-sm lg:text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 hover:border-blue-400 focus:border-blue-500 dark:text-gray-100",type:"text"})]})]}),(()=>{const a=nt();return a&&a.defaultWithdrawCommission!=null?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"عمولة السحب (تلقائية)"}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["سيتم تطبيق عمولة السحب الافتراضية لكل ألف: ",a==null?void 0:a.defaultWithdrawCommission," جنيه لكل ألف"]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(I,{type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium",onClick:()=>{const i=nt(),l=parseFloat(xt||"0")||0,d=(i==null?void 0:i.defaultWithdrawCommission)!=null&&Number(i.defaultWithdrawCommission)||0,m=Math.round(d*l/1e3*100)/100,f=Je?l+m:l;ns((f||0).toString()),je?p({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):Cs(!0)},children:"أجل"}),e.jsx(I,{type:"button",variant:na?"default":"outline",size:"sm",className:na?"bg-green-600 hover:bg-green-700 text-white font-medium ring-2 ring-green-400 ring-offset-2":"bg-blue-600 hover:bg-blue-700 text-white font-medium",onClick:()=>po(!na),children:na?"إلغاء خصم العموله":"خصم العموله"})]}),na&&e.jsxs("div",{className:"mt-2 text-sm font-semibold text-green-600 animate-in fade-in slide-in-from-top-1",children:["سيتم تسليم العميل: ",(()=>{const i=nt(),l=parseFloat(xt||"0")||0,d=(i==null?void 0:i.defaultWithdrawCommission)!=null&&Number(i.defaultWithdrawCommission)||0,m=Math.round(d*l/1e3*100)/100;return Math.round((l-m)*100)/100})()," جنيه"]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"عمولة السحب على العملية (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Oa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-yellow-600"}),e.jsx(J,{id:"manualWithdrawCommissionInput",value:dt,onChange:i=>vn(i.target.value),onKeyDown:i=>{if(i.key==="Enter"){const l=document.getElementById("withdrawSubmitButton");l==null||l.focus()}},placeholder:"أدخل العمولة المطلوبة",type:"number",className:"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 hover:border-blue-400 focus:border-blue-500 dark:text-gray-100"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"أدخل العمولة الإجمالية لإتمام عملية السحب"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(I,{type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium",onClick:()=>{const i=nt(),l=parseFloat(xt||"0")||0;let d=0;if((i==null?void 0:i.defaultWithdrawCommission)!=null){const f=Number(i.defaultWithdrawCommission)||0;d=Math.round(f*l/1e3*100)/100}else{const f=dt&&dt.trim()!==""?parseFloat(dt):Math.round(l*.01*100)/100;d=Math.max(0,f)}const m=Je?l+d:l;ns((m||0).toString()),je?p({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):Cs(!0)},children:"أجل"}),e.jsx(I,{type:"button",variant:na?"default":"outline",size:"sm",className:na?"bg-green-600 hover:bg-green-700 text-white font-medium ring-2 ring-green-400 ring-offset-2":"bg-blue-600 hover:bg-blue-700 text-white font-medium",onClick:()=>po(!na),children:na?"إلغاء خصم العموله":"خصم العموله"})]}),na&&e.jsxs("div",{className:"mt-2 text-sm font-semibold text-green-600 animate-in fade-in slide-in-from-top-1",children:["سيتم تسليم العميل: ",(()=>{const i=parseFloat(xt||"0")||0,l=dt&&dt.trim()!==""?parseFloat(dt):Math.round(i*.01*100)/100,d=Math.max(0,l);return Math.round((i-d)*100)/100})()," جنيه"]})]})})(),(n==null?void 0:n.showWithdrawNote)&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"ملاحظة السحب (اختياري)"}),e.jsxs("div",{className:"relative group",children:[e.jsx(fl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-primary"}),e.jsx(J,{id:"withdrawNoteInput",value:rs,onChange:a=>kc(a.target.value),onKeyDown:a=>{if(a.key==="Enter"){a.preventDefault(),a.stopPropagation();const s=document.getElementById("withdrawSubmitButton");s==null||s.focus()}},placeholder:"أدخل ملاحظة للسحب (اختياري)",className:"pl-10 h-10 text-base border-gray-400 dark:border-gray-600 rounded-xl focus:border-primary focus:ring-1 focus:ring-primary bg-white dark:bg-gray-900 dark:text-gray-100 dark:placeholder:text-gray-400"})]})]}),e.jsx("div",{className:"sticky bottom-0 z-20 pt-2 pb-2 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 backdrop-blur supports-[backdrop-filter]:bg-white/90 dark:supports-[backdrop-filter]:bg-gray-900/90",children:e.jsx(I,{id:"withdrawSubmitButton",onClick:iu,disabled:gt||go,className:"w-full font-medium h-11 lg:h-12 text-sm lg:text-base bg-green-600 hover:bg-green-700 text-white disabled:opacity-70 disabled:cursor-not-allowed",children:gt?"جاري التنفيذ...":go?ff||"تم السحب بنجاح":"تأكيد السحب"})})]}),e.jsx(fe,{open:Ji,onOpenChange:Cs,children:e.jsxs(ge,{children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"تحويل مؤجل"}),e.jsx(rt,{children:"أدخل بيانات صاحب الدين والمبلغ والملاحظات ثم اضغط حفظ"})]}),e.jsxs("div",{className:"space-y-3",children:[Pt&&Pt.length>0?e.jsxs("div",{children:[e.jsx(H,{children:"اختيار عميل"}),e.jsxs(Ja,{value:Gi,onValueChange:a=>{Ah(a);const s=Pt.find(i=>i.id===a);s&&Qi(s.name)},children:[e.jsx(Ha,{className:"w-full",children:e.jsx(Qa,{placeholder:"اختر عميل"})}),e.jsx(Ga,{children:Pt.map(a=>e.jsxs(da,{value:a.id,children:[a.name,a.mobile?` — ${a.mobile}`:""]},a.id))})]})]}):e.jsx("div",{className:"text-xs text-gray-500",children:"لا يوجد عملاء مُسجلين حالياً. يمكنك إضافة عميل من نافذة الديون."}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"quickDebtName",children:"اسم صاحب الدين"}),e.jsx(J,{id:"quickDebtName",value:Hi,onChange:a=>Qi(a.target.value),placeholder:"اكتب الاسم"})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"quickDebtAmount",children:"المبلغ (محسوب تلقائياً)"}),e.jsx(J,{id:"quickDebtAmount",type:"number",value:_h,readOnly:!0,placeholder:"المبلغ + عمولة التحويل"})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"quickDebtCommission",children:"العمولة (محسوبة تلقائياً)"}),e.jsx(J,{id:"quickDebtCommission",type:"number",value:function(){const a=nt(),s=parseFloat((xt||"0").toString())||0;let i=0;if(F==="transfer")if((a==null?void 0:a.defaultTransferCommission)!=null){const l=Number(a.defaultTransferCommission)||0;i=Math.round(l*s/1e3*100)/100}else{const l=St&&St.trim()!==""?parseFloat(St):0;i=Math.max(0,l)}else if((a==null?void 0:a.defaultWithdrawCommission)!=null){const l=Number(a.defaultWithdrawCommission)||0;i=Math.round(l*s/1e3*100)/100}else{const l=dt&&dt.trim()!==""?parseFloat(dt):Math.round(s*.01*100)/100;i=Math.max(0,l)}return String(i||0)}(),readOnly:!0,placeholder:"قيمة العمولة",className:"dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300"})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"quickDebtNotes",children:"ملاحظات"}),e.jsx(J,{id:"quickDebtNotes",value:Ic,onChange:a=>_c(a.target.value),placeholder:"اكتب ملاحظات (اختياري)"})]})]}),e.jsx(Oe,{children:e.jsx(I,{type:"button",variant:"default",className:"bg-green-600 text-white hover:bg-green-700",onClick:()=>{const a=nt(),s=parseFloat((xt||"").toString())||0;let i=0;if(F==="transfer")if((a==null?void 0:a.defaultTransferCommission)!=null){const m=Number(a.defaultTransferCommission)||0;i=Math.round(m*s/1e3*100)/100}else{const m=St&&St.trim()!==""?parseFloat(St):0;i=Math.max(0,m)}else if((a==null?void 0:a.defaultWithdrawCommission)!=null){const m=Number(a.defaultWithdrawCommission)||0;i=Math.round(m*s/1e3*100)/100}else{const m=dt&&dt.trim()!==""?parseFloat(dt):Math.round(s*.01*100)/100;i=Math.max(0,m)}let l=0;if(F==="withdraw"?l=Je?s:Math.max(0,Math.round((s-i)*100)/100):l=Math.max(0,Math.round((s+i)*100)/100),!Hi||isNaN(l)||l<=0){p({title:"خطأ في بيانات الأجل",description:"يرجى إدخال الاسم والمبلغ بشكل صحيح",variant:"destructive"});return}const d=Pt.find(m=>m.id===Gi);Xi({debtorName:Hi,amount:l,notes:Ic,customerId:Gi||void 0,mobile:d==null?void 0:d.mobile}),Ac(!1),Cs(!1),p({title:"تم حفظ بيانات الأجل",description:"سيتم إضافة الدين عند تأكيد العملية",variant:"default"})},children:"حفظ"})})]})})]})]}),e.jsx(Aa,{className:"bg-gradient-to-br from-red-50 to-red-100 border-red-200 fade-in-up card-float",children:e.jsxs(Ta,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-red-600 font-medium text-[10px] mb-1",children:"⚠️ تحذير من التحويل"}),e.jsx("div",{className:"text-[10px] text-red-700",children:"لا يمكن إلغاء أي عملية بعد تأكيدها للمحافظة على الأمان"})]})})]})]}),e.jsx(Nv,{isOpen:Qh,onClose:()=>Gh(!1),initialEditingWallet:Zh,onWalletUpdate:async()=>{try{await ul()}catch(a){console.error("Error reloading wallets after update:",a)}}}),e.jsx(jv,{isOpen:sf,onClose:()=>$c(!1),transaction:af,onDelete:R0}),e.jsx(aa,{open:cf,onOpenChange:pr,onSuccess:$0,title:U0(),description:V0(),mode:"verify",userId:t==null?void 0:t.uid,userRole:n==null?void 0:n.role}),e.jsx(Gu,{open:r0,onOpenChange:_d,onSuccess:z0,title:"تعديل الرصيد النقدي في الدرج",description:"أدخل الرقم السري والمبلغ الجديد لتعديل الرصيد النقدي في الدرج",currentBalance:$e,balanceLabel:"الرصيد النقدي",userId:t==null?void 0:t.uid}),e.jsx(Gu,{open:n0,onOpenChange:Ad,onSuccess:Y0,title:"تعديل رصيد المحفظة",description:"أدخل الرقم السري والمبلغ الجديد لتعديل رصيد المحفظة",currentBalance:Vt&&Ne[Vt]||0,balanceLabel:`رصيد ${((du=M.find(a=>a.id===Vt))==null?void 0:du.name)||"المحفظة"}`,userId:t==null?void 0:t.uid}),e.jsx(_v,{open:i0,onOpenChange:Uo,onSuccess:K0,title:"إضافة أو خصم مبلغ من رصيد المحفظة",description:"أدخل الرقم السري والمبلغ المراد إضافته أو خصمه من رصيد المحفظة",currentBalance:Vt&&Ne[Vt]||0,balanceLabel:`رصيد ${((uu=M.find(a=>a.id===Vt))==null?void 0:uu.name)||"المحفظة"}`,userId:t==null?void 0:t.uid}),e.jsx(Dv,{open:y0,onOpenChange:b0,userId:t==null?void 0:t.uid}),e.jsx(kv,{open:v0,onOpenChange:w0,userId:t==null?void 0:t.uid}),e.jsx(Cv,{open:N0,onOpenChange:j0}),e.jsx(fe,{open:c0,onOpenChange:qn,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(pe,{children:e.jsx(xe,{className:"text-right",children:"تعديل الدرج النقدية"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(H,{htmlFor:"amount",className:"text-right block",children:"المبلغ"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(J,{id:"amount",type:"number",placeholder:"أدخل المبلغ",value:qo,onChange:a=>zn(a.target.value),className:"text-right flex-1",dir:"rtl",min:"0"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(I,{type:"button",size:"sm",className:"bg-green-600 hover:bg-green-700 text-white px-3 py-2",onClick:async()=>{if(!await oi(al)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}const a=parseFloat(qo);if(isNaN(a)||a<=0){p({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const s=$e+a;Xe(s);const i={cashBalance:s,lastUpdated:new Date().toISOString()},l=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(l,JSON.stringify(i)),t!=null&&t.uid?oe.updateUserData(t.uid,i).then(()=>{console.log("✅ تم حفظ رصيد الدرج النقدي في Firebase بنجاح"),localStorage.removeItem(l),ye(!1)}).catch(d=>{console.error("❌ خطأ في حفظ الرصيد في Firebase:",d),ye(!0)}):ye(!0),p({title:"تم بنجاح",description:`تم إضافة ${a} جنيه إلى الدرج النقدية وحفظه في السحابة`}),qn(!1),zn(""),Qn("")},children:[e.jsx(It,{className:"h-1 w-1 mr-1"}),"إضافة"]}),e.jsxs(I,{id:"confirm-deduct-cash-btn",type:"button",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white px-3 py-2",onClick:async()=>{if(!await oi(al)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}const a=parseFloat(qo);if(isNaN(a)||a<=0){p({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const s=$e-a;Xe(s);const i={cashBalance:s,lastUpdated:new Date().toISOString()},l=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(l,JSON.stringify(i)),t!=null&&t.uid?oe.updateUserData(t.uid,i).then(()=>{console.log("✅ تم حفظ رصيد الدرج النقدي في Firebase بنجاح"),localStorage.removeItem(l),ye(!1)}).catch(d=>{console.error("❌ خطأ في حفظ الرصيد في Firebase:",d),ye(!0)}):ye(!0),p({title:"تم بنجاح",description:`تم خصم ${a} جنيه من الدرج النقدية وحفظه في السحابة`}),qn(!1),zn(""),Qn("")},children:[e.jsx(gi,{className:"h-1 w-1 mr-1"}),"خصم"]})]})]}),e.jsxs("p",{className:"text-[10px] text-gray-500 text-right",children:["الرصيد الحالي: ",$e.toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(H,{htmlFor:"pin",className:"text-right block",children:"الرقم السري"}),e.jsx(J,{id:"pin",type:"password",placeholder:"أدخل الرقم السري",value:al,onChange:a=>Qn(a.target.value),onKeyDown:a=>{if(a.key==="Enter"){a.preventDefault(),a.stopPropagation();const s=document.getElementById("confirm-deduct-cash-btn");s&&s.click()}},className:"text-right",dir:"rtl"})]})]}),e.jsx(Oe,{className:"flex gap-2",children:e.jsx(I,{variant:"outline",onClick:()=>{qn(!1),zn(""),Qn("")},children:"إلغاء"})})]})}),e.jsx(fe,{open:A0,onOpenChange:ri,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(pe,{children:e.jsx(xe,{className:"text-right text-red-600",children:"تصفير إجمالي المحفظة"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-red-800 font-medium mb-2",children:"تحذير!"}),e.jsx("p",{className:"text-red-700 text-sm",children:"سيتم تصفير جميع أرصدة المحافظ إلى صفر. هذا الإجراء لا يمكن التراجع عنه."}),e.jsxs("p",{className:"text-red-600 text-sm mt-2",children:["الرصيد الحالي: ",M.reduce((a,s)=>a+(Number(Ne[s.id])||0),0).toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(H,{htmlFor:"resetWalletTotalPin",className:"text-right block",children:"الرقم السري الرئيسي"}),e.jsx(J,{id:"resetWalletTotalPin",type:"password",placeholder:"أدخل الرقم السري الرئيسي",value:tu,onChange:a=>ni(a.target.value),onKeyDown:a=>{var s;a.key==="Enter"&&(a.preventDefault(),a.stopPropagation(),(s=document.getElementById("confirm-reset-wallet-total-btn"))==null||s.click())},className:"text-right",dir:"rtl"})]})]}),e.jsxs(Oe,{className:"flex gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{ri(!1),ni("")},children:"إلغاء"}),e.jsx(I,{id:"confirm-reset-wallet-total-btn",variant:"destructive",onClick:async()=>{if(!await Wt.verifyMasterPin(tu,t==null?void 0:t.uid)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}try{const s={};Object.keys(Ne).forEach(m=>{s[m]=0}),lt(s),localStorage.setItem(Ze(),JSON.stringify(s)),ri(!1),ni("");const i=new Date().toISOString(),l={walletBalances:s,lastUpdated:i},d=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(d,JSON.stringify(l)),t!=null&&t.uid?oe.updateUserData(t.uid,l).then(()=>{localStorage.removeItem(d),ye(!1)}).catch(m=>{console.error("خطأ في حفظ أرصدة المحافظ في Firebase:",m),ye(!0),p({title:"تنبيه",description:"تم التصفير محلياً، سيتم المزامنة مع الخادم قريباً",variant:"default"})}):ye(!0),setTimeout(()=>{lt({...s})},100)}catch(s){console.error("خطأ في تصفير أرصدة المحافظ:",s),p({title:"خطأ",description:"حدث خطأ أثناء تصفير المحافظ",variant:"destructive"})}},children:"تصفير المحفظة"})]})]})}),e.jsx(fe,{open:o0,onOpenChange:Vn,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(pe,{children:e.jsx(xe,{className:"text-right text-red-600",children:"تصفير رصيد المحفظة المختارة"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-red-800 font-medium mb-2",children:"تحذير!"}),e.jsx("p",{className:"text-red-700 text-sm",children:"سيتم تصفير رصيد المحفظة المحددة إلى صفر. هذا الإجراء لا يمكن التراجع عنه."}),e.jsxs("p",{className:"text-red-600 text-sm mt-2",children:["المحفظة: ",((mu=M.find(a=>a.id===W))==null?void 0:mu.name)||W]}),e.jsxs("p",{className:"text-red-600 text-sm",children:["الرصيد الحالي: ",(W&&Ne[W]?Ne[W]:0).toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(H,{htmlFor:"resetSelectedWalletPin",className:"text-right block",children:"الرقم السري الرئيسي"}),e.jsx(J,{id:"resetSelectedWalletPin",type:"password",autoComplete:"off",placeholder:"أدخل الرقم السري الرئيسي",value:Td,onChange:a=>Vo(a.target.value),onKeyDown:a=>{var s;a.key==="Enter"&&(a.preventDefault(),a.stopPropagation(),(s=document.getElementById("confirm-reset-selected-wallet-btn"))==null||s.click())},className:"text-right",dir:"rtl"})]})]}),e.jsxs(Oe,{className:"flex gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{Vn(!1),Vo("")},children:"إلغاء"}),e.jsx(I,{id:"confirm-reset-selected-wallet-btn",variant:"destructive",onClick:async()=>{var s;if(!W){p({title:"اختر محفظة",description:"يرجى اختيار محفظة أولاً",variant:"destructive"});return}if(!await Wt.verifyMasterPin(Td,t==null?void 0:t.uid)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}try{const i={...Ne};i[W]=0,lt(i),localStorage.setItem(Ze(),JSON.stringify(i)),Vn(!1),Vo("");const l=new Date().toISOString(),d={walletBalances:i,lastUpdated:l},m=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(m,JSON.stringify(d)),t!=null&&t.uid?oe.updateUserData(t.uid,d).then(()=>{localStorage.removeItem(m),ye(!1)}).catch(f=>{console.error("خطأ في حفظ أرصدة المحافظ في Firebase:",f),ye(!0),p({title:"تنبيه",description:"تم التصفير محلياً، سيتم المزامنة مع الخادم قريباً",variant:"default"})}):ye(!0),p({title:"تم التصفير بنجاح",description:`تم تصفير رصيد المحفظة ${((s=M.find(f=>f.id===W))==null?void 0:s.name)||W}`})}catch(i){console.error("خطأ في تصفير رصيد المحفظة المختارة:",i),p({title:"خطأ",description:"حدث خطأ أثناء تصفير رصيد المحفظة المختارة",variant:"destructive"})}},children:"تصفير المحفظة"})]})]})}),e.jsx(Xu,{isOpen:Re,onClose:()=>Fe(!1),wallets:M}),e.jsx(fe,{open:k0,onOpenChange:ti,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(pe,{children:e.jsxs(xe,{className:"text-right text-green-600 flex items-center gap-2 justify-end",children:[e.jsx(It,{className:"h-4 w-4"}),"إضافة أموال لإجمالي المحفظة"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-green-800 font-medium mb-2",children:"إضافة أموال"}),e.jsx("p",{className:"text-green-700 text-sm",children:"سيتم إضافة المبلغ المحدد إلى إجمالي المحفظة بشكل متناسب على جميع المحافظ."}),e.jsxs("p",{className:"text-green-600 text-sm mt-2",children:["الرصيد الحالي: ",M.reduce((a,s)=>a+(Number(Ne[s.id])||0),0).toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"addWalletTotalAmount",className:"text-right block",children:"المبلغ المراد إضافته"}),e.jsx(J,{id:"addWalletTotalAmount",type:"number",placeholder:"أدخل المبلغ",value:zd,onChange:a=>rl(a.target.value),className:"text-right",dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"addWalletTotalPin",className:"text-right block",children:"الرقم السري للتأكيد"}),e.jsx(J,{id:"addWalletTotalPin",type:"password",autoComplete:"off",placeholder:"أدخل الرقم السري",value:Yd,onChange:a=>nl(a.target.value),onKeyDown:a=>{var s;a.key==="Enter"&&(a.preventDefault(),a.stopPropagation(),(s=document.getElementById("confirm-add-wallet-total-btn"))==null||s.click())},className:"text-right",dir:"rtl"})]})]})]}),e.jsxs(Oe,{className:"flex gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{ti(!1),rl(""),nl("")},children:"إلغاء"}),e.jsx(I,{id:"confirm-add-wallet-total-btn",variant:"default",className:"bg-green-600 hover:bg-green-700",disabled:Kd,onClick:async()=>{const a=parseFloat(zd);if(!a||a<=0){p({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}if(!await O0(Yd)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}Jd(!0);try{const s=M.reduce((l,d)=>l+(Number(Ne[d.id])||0),0),i={...Ne};if(s===0){if(M.length>0){const l=a/M.length;M.forEach(d=>{i[d.id]=(Number(i[d.id])||0)+l})}}else M.forEach(l=>{const d=Number(Ne[l.id])||0,m=d/s,f=a*m;i[l.id]=d+f});lt(i),localStorage.setItem(Ze(),JSON.stringify(i)),t!=null&&t.uid?await oe.updateUserData(t.uid,{walletBalances:i,lastUpdated:new Date().toISOString()}):ye(!0),setTimeout(()=>{lt(l=>({...l}))},100),ti(!1),rl(""),nl("")}catch(s){console.error("خطأ في حفظ أرصدة المحافظ في Firebase:",s),p({title:"خطأ",description:"حدث خطأ أثناء حفظ البيانات",variant:"destructive"})}finally{Jd(!1)}},children:Kd?"جاري الإضافة...":"إضافة الأموال"})]})]})}),e.jsx(fe,{open:T0,onOpenChange:ii,children:e.jsxs(ge,{className:"sm:max-w-[425px]",children:[e.jsx(pe,{children:e.jsxs(xe,{className:"text-red-600 flex items-center gap-2",children:[e.jsx(ca,{className:"h-1 w-1"}),"تصفير الرصيد النقدي"]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-700",children:"⚠️ تحذير: سيتم تصفير الرصيد النقدي في الدرج إلى صفر. هذا الإجراء لا يمكن التراجع عنه."})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(H,{htmlFor:"resetCashPin",children:"الرقم السري الرئيسي"}),e.jsx(J,{id:"resetCashPin",type:"password",autoComplete:"off",placeholder:"أدخل الرقم السري الرئيسي",value:il,onChange:a=>ol(a.target.value),onKeyDown:a=>{var s;a.key==="Enter"&&(a.preventDefault(),a.stopPropagation(),(s=document.getElementById("confirm-reset-cash-btn"))==null||s.click())}})]})]}),e.jsxs(Oe,{children:[e.jsx(I,{variant:"outline",onClick:()=>{ii(!1),ol("")},children:"إلغاء"}),e.jsx(I,{id:"confirm-reset-cash-btn",variant:"destructive",onClick:async()=>{if(!il){p({title:"خطأ",description:"يرجى إدخال الرقم السري",variant:"destructive"});return}if(!await Wt.verifyMasterPin(il,t==null?void 0:t.uid)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}try{Xe(0),ii(!1),ol("");const s={cashBalance:0,lastUpdated:new Date().toISOString()};localStorage.setItem(qe(),"0"),localStorage.setItem(qe()+"_lastUpdated",s.lastUpdated);const i=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(i,JSON.stringify(s)),t!=null&&t.uid?oe.updateUserData(t.uid,s).then(()=>{localStorage.removeItem(i),ye(!1)}).catch(l=>{console.error("خطأ في حفظ الرصيد في Firebase:",l),ye(!0),p({title:"تنبيه",description:"تم التصفير محلياً، سيتم المزامنة مع الخادم قريباً",variant:"default"})}):ye(!0)}catch(s){console.error("خطأ في تصفير الرصيد النقدي:",s),p({title:"خطأ",description:"حدث خطأ أثناء تصفير الرصيد النقدي",variant:"destructive"})}},children:"تصفير الرصيد"})]})]})}),e.jsx(Pv,{open:D0,onOpenChange:qd,userId:t==null?void 0:t.uid,cashBalance:$e,walletBalances:Ne,transactions:ue}),e.jsx(fe,{open:S0,onOpenChange:Pr,children:e.jsxs(ge,{className:"sm:max-w-[425px]",children:[e.jsx(pe,{children:e.jsxs(xe,{className:"text-green-600 flex items-center gap-2",children:[e.jsx(It,{className:"h-4 w-4"}),"إضافة أموال للدرج"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-green-700",children:"💰 سيتم إضافة المبلغ المحدد إلى الرصيد النقدي في الدرج"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"addCashAmount",children:"المبلغ المراد إضافته"}),e.jsx(J,{id:"addCashAmount",type:"number",placeholder:"أدخل المبلغ",value:us,onChange:a=>Gn(a.target.value),min:"0",step:"0.01"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"text-right",children:"هل تريد إضافة ملاحظة؟"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{type:"button",variant:Or==="yes"?"default":"outline",onClick:()=>Mr("yes"),className:"flex-1",children:"نعم"}),e.jsx(I,{type:"button",variant:Or==="no"?"default":"outline",onClick:async()=>{if(Mr("no"),!us||parseFloat(us)<=0){p({title:"خطأ",description:"يرجى إدخال مبلغ صحيح أكبر من صفر",variant:"destructive"});return}if(!Er){p({title:"خطأ",description:"يرجى إدخال الرقم السري",variant:"destructive"});return}if(!await oi(Er)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}Zn(!0);try{const a=parseFloat(us),s=$e+a;Xe(s);const i=new Date().toISOString();localStorage.setItem(qe(),s.toString()),localStorage.setItem(qe()+"_lastUpdated",i);const l={cashBalance:s,lastUpdated:i},d=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(d,JSON.stringify(l));const m=`CASHADD-${(t==null?void 0:t.uid)||"anon"}-${Date.now()}`;Pr(!1),Gn(""),Xn(""),Mr(null),ei("");const f=[];if(t!=null&&t.uid){f.push(oe.updateUserData(t.uid,l).then(()=>{localStorage.removeItem(d),ye(!1)}).catch(()=>{ye(!0)}));const g={txnType:"cash_addition",type:"cash_addition",amount:a,status:"confirmed",senderMsisdn:"إضافة نقدية",receiverMsisdn:"",reference:m,title:"إيصال إضافة نقدية",merchantUserId:t.uid,createdBy:t.uid,shopId:(n==null?void 0:n.shopId)||void 0};f.push(oe.saveUserTransaction(t.uid,g));const v=n==null?void 0:n.shopId;if(v){const y=Ae($,"dashboardData",v);f.push(ta(y,{cashBalance:s}))}}Promise.allSettled(f).then(()=>{}).catch(()=>{})}catch{Xe($e),localStorage.setItem("cashBalance",$e.toString()),p({title:"خطأ",description:"حدث خطأ أثناء حفظ البيانات، يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{Zn(!1)}},className:"flex-1",children:"لا"})]})]}),Or==="yes"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"addCashNote",children:"الملاحظة"}),e.jsx(J,{id:"addCashNote",type:"text",placeholder:"اكتب الملاحظة",value:sl,onChange:a=>ei(a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"addCashPin",children:"الرقم السري لدرج النقدية"}),e.jsx(J,{id:"addCashPin",type:"password",placeholder:"أدخل الرقم السري",value:Er,onChange:a=>Xn(a.target.value),onKeyDown:a=>{var s;a.key==="Enter"&&(a.preventDefault(),a.stopPropagation(),(s=document.getElementById("confirm-add-cash-btn"))==null||s.click())}})]})]}),e.jsxs(Oe,{children:[e.jsx(I,{variant:"outline",onClick:()=>{Pr(!1),Gn(""),Xn(""),Mr(null),ei("")},children:"إلغاء"}),e.jsx(I,{id:"confirm-add-cash-btn",variant:"default",className:"bg-green-600 hover:bg-green-700",disabled:Vd,onClick:async()=>{if(!us||parseFloat(us)<=0){p({title:"خطأ",description:"يرجى إدخال مبلغ صحيح أكبر من صفر",variant:"destructive"});return}if(!Er){p({title:"خطأ",description:"يرجى إدخال الرقم السري",variant:"destructive"});return}if(!await oi(Er)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}if(Or==="yes"&&sl.trim().length===0){p({title:"تنبيه",description:"أدخل الملاحظة أو اختر لا",variant:"destructive"});return}Zn(!0);try{const a=parseFloat(us),s=$e+a;Xe(s);const i=new Date().toISOString();localStorage.setItem(qe(),s.toString()),localStorage.setItem(qe()+"_lastUpdated",i);const l={cashBalance:s,lastUpdated:i},d=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(d,JSON.stringify(l));const m=`CASHADD-${(t==null?void 0:t.uid)||"anon"}-${Date.now()}`;Pr(!1),Gn(""),Xn(""),Mr(null),ei("");const f=[];if(t!=null&&t.uid){f.push(oe.updateUserData(t.uid,l).then(()=>{localStorage.removeItem(d),ye(!1)}).catch(()=>{ye(!0)}));const g={txnType:"cash_addition",type:"cash_addition",amount:a,status:"confirmed",senderMsisdn:"إضافة نقدية",receiverMsisdn:"",reference:m,note:Or==="yes"?sl.trim():void 0,title:"إيصال إضافة نقدية",merchantUserId:t.uid,createdBy:t.uid,shopId:(n==null?void 0:n.shopId)||void 0};f.push(oe.saveUserTransaction(t.uid,g));const v=n==null?void 0:n.shopId;if(v){const y=Ae($,"dashboardData",v);f.push(ta(y,{cashBalance:s}))}}Promise.allSettled(f).then(()=>{}).catch(()=>{})}catch{Xe($e),localStorage.setItem("cashBalance",$e.toString()),p({title:"خطأ",description:"حدث خطأ أثناء حفظ البيانات، يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{Zn(!1)}},children:Vd?"جاري الإضافة...":"إضافة الأموال"})]})]})}),e.jsx(fe,{open:s0,onOpenChange:$o,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(pe,{children:e.jsx(xe,{className:"text-right",children:"اختيار التاريخ والوقت للبحث"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(H,{htmlFor:"search-date",className:"text-right block",children:"التاريخ"}),e.jsx(J,{id:"search-date",type:"date",value:Cn,onChange:a=>Yc(a.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(H,{htmlFor:"search-time",className:"text-right block",children:"الوقت (اختياري)"}),e.jsx(J,{id:"search-time",type:"time",value:In,onChange:a=>Kc(a.target.value),className:"text-right",placeholder:"اختر الوقت للبحث في ساعة محددة"}),e.jsx("p",{className:"text-[10px] text-gray-500 text-right",children:"إذا لم تختر وقتاً محدداً، سيتم البحث في كامل اليوم"})]})]}),e.jsxs(Oe,{className:"flex justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>{Yc(""),Kc(""),$o(!1)},children:"مسح"}),e.jsx(I,{onClick:()=>$o(!1),children:"تطبيق"})]})]})}),e.jsx(Av,{isOpen:bf,onClose:()=>vo(!1)}),e.jsx(Pu,{isOpen:Ge,onClose:()=>yt(!1),userId:(t==null?void 0:t.uid)||"",userEmail:(t==null?void 0:t.email)||""}),e.jsx(Tv,{isOpen:co,onClose:()=>As(!1),initialBarcode:Jh}),e.jsx(Ev,{isOpen:Sf,onClose:()=>wr(!1)}),e.jsx(Wv,{open:Df,onOpenChange:Nr}),e.jsx(Lv,{open:kf,onOpenChange:a=>{if(a&&!Jt){p({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"});return}jr(a)}}),e.jsx($v,{open:ct,onOpenChange:a=>{if(a&&!Jt){p({title:"غير متاح",description:"هذه الميزة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة. يرجى تفعيل اشتراكك.",variant:"destructive"});return}Ft(a)}}),e.jsx(Uv,{open:rn,onOpenChange:a=>{if(a&&!Jt){p({title:"غير متاح",description:"هذه الميزة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة. يرجى تفعيل اشتراكك.",variant:"destructive"});return}er(a)}}),e.jsx(aa,{open:u0,onOpenChange:Wd,onSuccess:()=>Ko(!0),title:"تقاريرك",description:"أدخل الرقم السري الرئيسي للوصول إلى تقاريرك",mode:"verify",userId:t==null?void 0:t.uid,userRole:n==null?void 0:n.role}),e.jsx(fe,{open:Yo,onOpenChange:Ko,children:e.jsxs(ge,{className:"sm:max-w-xl",children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(yl,{className:"h-4 w-4 text-blue-600"}),"تقارير اليوم"]}),e.jsx(rt,{children:"ملخص معاملات اليوم محفوظ لآخر 30 يومًا مع أرشفة في السحابة"})]}),e.jsxs("div",{className:"space-y-4",children:[(()=>{const a=new Date().toDateString(),s=ue.filter(g=>{const v=new Date(g.createdAt).toDateString(),y=String(g.status||"completed").toLowerCase();return v===a&&(y==="completed"||y==="confirmed")}),i=s.length,l=s.reduce((g,v)=>g+Number(v.amount||0),0),d=s.filter(g=>g.type==="withdraw").reduce((g,v)=>g+Number(v.amount||0),0),m=s.filter(g=>g.type==="send").reduce((g,v)=>g+Number(v.amount||0),0),f=s.reduce((g,v)=>g+Number(_t.calculateTransactionProfit(v)||0),0);return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-blue-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-blue-700",children:"عدد المعاملات"}),e.jsx("div",{className:"text-lg font-bold text-blue-800",children:i})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-indigo-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-indigo-700",children:"إجمالي المبالغ"}),e.jsx("div",{className:"text-lg font-bold text-indigo-800",children:Number(l).toFixed(2)})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-red-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-red-700",children:"المبالغ المسحوبة"}),e.jsx("div",{className:"text-lg font-bold text-red-800",children:Number(d).toFixed(2)})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-green-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-green-700",children:"المبالغ المرسلة"}),e.jsx("div",{className:"text-lg font-bold text-green-800",children:Number(m).toFixed(2)})]}),e.jsxs("div",{className:"col-span-2 rounded-lg p-3 bg-gradient-to-r from-amber-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-amber-700",children:"الأرباح"}),e.jsx("div",{className:"text-lg font-bold text-amber-800",children:Number(f).toFixed(2)})]})]})})(),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(I,{variant:"default",onClick:async()=>{try{if(!(t!=null&&t.uid))return;const a=new Date,s=a.getFullYear(),i=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0"),d=`${s}-${i}-${l}`,m=a.toDateString(),f=ue.filter(C=>{const k=new Date(C.createdAt).toDateString(),A=String(C.status||"completed").toLowerCase();return k===m&&(A==="completed"||A==="confirmed")}),g=f.length,v=f.reduce((C,k)=>C+Number(k.amount||0),0),y=f.filter(C=>C.type==="withdraw").reduce((C,k)=>C+Number(k.amount||0),0),b=f.filter(C=>C.type==="send").reduce((C,k)=>C+Number(k.amount||0),0),w=f.reduce((C,k)=>C+Number(_t.calculateTransactionProfit(k)||0),0);await Br.add({userId:t.uid,reportDate:d,totalTransactions:g,totalAmount:Number(v.toFixed(2)),totalWithdrawn:Number(y.toFixed(2)),totalSent:Number(b.toFixed(2)),profit:Number(w.toFixed(2)),walletId:null});try{await Br.trimToMaxCount(t.uid,30)}catch{}p({title:"تم الأرشفة",description:`تم حفظ تقرير ${d}`})}catch{p({title:"فشل الأرشفة",description:"تعذر حفظ التقرير",variant:"destructive"})}},children:"أرشفة اليوم"}),e.jsx(I,{variant:"outline",onClick:()=>Ko(!1),children:"إغلاق"})]}),e.jsx("div",{className:"mt-2 border-t pt-2",children:e.jsx("div",{className:"space-y-2 max-h-[40vh] overflow-auto",children:Ld.length===0?e.jsx("div",{className:"text-xs text-muted-foreground",children:"لا توجد تقارير محفوظة"}):Ld.map(a=>e.jsxs("div",{className:"border rounded-md p-2 bg-gradient-to-r from-white/80 to-blue-50/70",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-bold text-blue-800",children:a.reportDate}),e.jsxs("div",{className:"text-xs text-blue-700",children:["عدد المعاملات: ",a.totalTransactions]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[e.jsxs("div",{className:"text-xs text-blue-800",children:["إجمالي المبالغ: ",e.jsx("span",{className:"font-semibold",children:Number(a.totalAmount).toFixed(2)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["المسحوب: ",e.jsx("span",{className:"font-semibold",children:Number(a.totalWithdrawn).toFixed(2)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["المرسل: ",e.jsx("span",{className:"font-semibold",children:Number(a.totalSent).toFixed(2)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["الربح: ",e.jsx("span",{className:"font-semibold",children:Number(a.profit??0).toFixed(2)})]})]})]},a.id||`${a.userId}-${a.reportDate}`))})})]})]})}),e.jsx(fe,{open:d0,onOpenChange:a=>{if(a){p({title:"قيد التطوير",description:"هذه الميزة غير متاحة حالياً."});return}zo(!1)},children:e.jsxs(ge,{dir:"rtl",className:"sm:max-w-md w-[95vw] sm:w-auto rounded-2xl border border-emerald-200 shadow-xl bg-gradient-to-br from-white via-green-50 to-emerald-50 backdrop-blur-md data-[state=open]:animate-in data-[state=open]:fade-in-0 data-[state=open]:zoom-in-90 data-[state=open]:slide-in-from-bottom-8 duration-300",children:[e.jsxs(pe,{children:[e.jsx(xe,{className:"text-right text-green-700",children:"شحن رصيد الموبايل"}),e.jsx(rt,{className:"text-right text-gray-600",children:"أدخل البيانات ثم اضغط تأكيد"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(H,{htmlFor:"topupPhone",className:"text-right block",children:"رقم الموبايل"}),e.jsx(J,{id:"topupPhone",value:Yn,onChange:a=>Pd(a.target.value),placeholder:"010xxxxxxx",className:"text-right"})]}),e.jsxs("div",{children:[e.jsx(H,{className:"text-right block",children:"شركة التشغيل"}),e.jsxs(Ja,{value:Kn,onValueChange:Ed,children:[e.jsx(Ha,{className:"text-right",children:e.jsx(Qa,{placeholder:"اختر الشركة"})}),e.jsxs(Ga,{children:[e.jsx(da,{value:"vodafone",children:"فودافون"}),e.jsx(da,{value:"orange",children:"أورنج"}),e.jsx(da,{value:"etisalat",children:"اتصالات"}),e.jsx(da,{value:"we",children:"WE"})]})]})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"topupAmount",className:"text-right block",children:"المبلغ بالجنيه"}),e.jsx(J,{id:"topupAmount",type:"number",value:Jn,onChange:a=>Od(a.target.value?Number(a.target.value):""),placeholder:"50",className:"text-right"})]})]}),e.jsxs(Oe,{className:"flex gap-2 justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>zo(!1),className:"border-gray-300",children:"إلغاء"}),e.jsx(I,{onClick:Sa,disabled:Md||!Yn||!Kn||!Jn,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:Md?"جارٍ التنفيذ...":"تأكيد الشحن"})]})]})}),e.jsx(aa,{open:Rf,onOpenChange:jo,mode:"verify",title:"الرقم السري الرئيسي لفتح الديون",description:"أدخل الرقم السري الرئيسي لفتح صفحة الديون",className:"!bg-[#0f172a] !text-slate-100 border border-slate-800 shadow-2xl",overlayClassName:"backdrop-blur-[5px] bg-black/10 !dark:bg-black",onSuccess:()=>{jo(!1),Ps(!0)},userId:t==null?void 0:t.uid,userRole:n==null?void 0:n.role}),e.jsx(aa,{open:Lf,onOpenChange:nd,mode:"verify",title:"تأكيد تغيير طلب الرقم السري للديون",description:"أدخل الرقم السري الرئيسي لتفعيل أو إلغاء طلب الرقم السري عند فتح الديون",userId:t==null?void 0:t.uid,userRole:n==null?void 0:n.role,onSuccess:async()=>{if(id!==null){const a=id;rd(a);try{const s=t==null?void 0:t.uid,i=s?`debtsPinRequired_${s}`:"debtsPinRequired";localStorage.setItem(i,String(a)),s&&await oe.updateUserData(s,{debtsPinRequired:a})}catch{}p({title:a?"تم تفعيل طلب الرقم السري للديون":"تم إلغاء طلب الرقم السري للديون",description:a?"سيُطلب الرقم السري الرئيسي عند فتح نافذة الديون.":"يمكن فتح نافذة الديون بدون طلب الرقم السري."})}Ff(null),nd(!1)}}),e.jsx(Iv,{open:l0,onOpenChange:Ar,title:"تأكيد كلمة المرور لإخفاء المعاملات السابقة من العرض",description:"سيتم إخفاء كل المعاملات السابقة من شاشة المعاملات والتقارير فقط، ولن تُحذف نهائيًا من حسابك أو من Firebase.",onSuccess:async()=>{try{if(!(t!=null&&t.uid)){Ar(!1);return}const a=new Date,s=l=>l instanceof Date?l:typeof(l==null?void 0:l.toDate)=="function"?l.toDate():new Date(String(l)),i=ue.filter(l=>s(l.createdAt)<a);await oe.updateUserData(t.uid,{recentReset:{keepLastCount:Qd.keepLastCount??30,intervalDays:Qd.intervalDays??7,lastResetAt:a}}),ai(l=>({...l,lastResetAt:a})),p({title:"تم إخفاء المعاملات السابقة",description:"تم إخفاء كل الإيصالات الأقدم من وقت التصفير من العرض بدون التأثير على تقارير اليوم/الشهر أو الحدود."})}catch(a){console.error("فشل تنفيذ التصفير النهائي:",a),p({title:"فشل التصفير",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}finally{Ar(!1)}}}),e.jsx(aa,{open:Nh,onOpenChange:ws,mode:"verify",title:"الرقم السري لفتح مصروفات المحل",description:"أدخل الرقم السري الرئيسي لفتح نافذة مصروفات المحل",onSuccess:()=>{ws(!1),ss(!0)},userId:t==null?void 0:t.uid,userRole:n==null?void 0:n.role}),e.jsx(fe,{open:G,onOpenChange:ft,children:e.jsx(ge,{className:"w-full h-full max-w-full max-h-full p-0 m-0 rounded-none border-none",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx(I,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-50 bg-white/50 dark:bg-black/50 hover:bg-white dark:hover:bg-black/80 rounded-full",onClick:()=>ft(!1),children:e.jsx(fi,{className:"h-6 w-6"})}),e.jsx("iframe",{src:"https://naweshop.com/login",className:"w-full h-full border-none",title:"NaweShop Login"})]})})}),e.jsx(fe,{open:Mf,onOpenChange:Ps,children:e.jsxs(ge,{className:"sm:max-w-[425px] border border-slate-800 shadow-2xl",overlayClassName:"backdrop-blur-[5px] bg-black/10 !dark:bg-black",children:[e.jsxs(pe,{className:"flex items-center justify-between",children:[e.jsx(xe,{className:"text-right",children:"إدارة الديون"}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-emerald-700",children:[e.jsx("span",{className:"text-[10px] font-bold",children:"لينا:"}),e.jsxs("span",{className:"text-xs font-bold",children:[lu.creditor," جنيه"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-red-700",children:[e.jsx("span",{className:"text-[10px] font-bold",children:"علينا:"}),e.jsxs("span",{className:"text-xs font-bold",children:[lu.debtor," جنيه"]})]})]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(I,{variant:xa==="debtor"?"default":"outline",onClick:()=>ud(xa==="debtor"?null:"debtor"),className:"w-full",children:"علينا"}),e.jsx(I,{variant:xa==="creditor"?"default":"outline",onClick:()=>ud(xa==="creditor"?null:"creditor"),className:"w-full",children:"لينا"})]}),(xa==="creditor"||xa==="debtor")&&e.jsxs(e.Fragment,{children:[xa==="creditor"&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(H,{htmlFor:"debtorName",className:"text-right col-span-1",children:"اسم المديون"}),e.jsx(J,{id:"debtorName",value:So,onChange:a=>od(a.target.value),className:"col-span-3 text-right",placeholder:"أدخل اسم المديون"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(H,{htmlFor:"debtAmount",className:"text-right col-span-1",children:"المبلغ"}),e.jsx(J,{id:"debtAmount",type:"text",inputMode:"decimal",value:Do,onChange:a=>ld(hr(a.target.value)),className:"col-span-3 text-right",placeholder:"أدخل المبلغ"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(H,{htmlFor:"debtReason",className:"text-right col-span-1",children:"سبب الدين"}),e.jsx(J,{id:"debtReason",value:cd,onChange:a=>dd(a.target.value),className:"col-span-3 text-right",placeholder:"أدخل سبب الدين"})]})]})]}),e.jsx(Oe,{children:e.jsx(I,{onClick:()=>{const a=xa==="debtor";if(!a&&!(xa==="creditor")){p({title:"اختر نوع الدين",description:"يرجى اختيار مدين أو دائن أولاً",variant:"destructive"});return}const i=a?So||"بدون اسم":So;if(!Do||!i){p({title:"بيانات غير مكتملة",description:"يرجى إدخال الاسم والمبلغ",variant:"destructive"});return}const l={id:Date.now().toString(),debtorName:i,amount:parseFloat(Do),reason:cd||"",status:"pending",createdAt:new Date,paidAmount:0,partialPayments:[],type:xa||"creditor"};Ir(l),Os(!0)},className:"bg-orange-500 hover:bg-orange-600",children:"حفظ"})}),e.jsx("div",{className:"mt-2",children:e.jsx(I,{variant:"outline",className:"w-full",onClick:()=>os(!0),children:"إيصالات الديون"})}),e.jsx("div",{className:"mt-2",children:e.jsx(I,{variant:"outline",className:"w-full",onClick:()=>Co(!0),children:"إضافة عميل"})})]})}),e.jsx(fe,{open:ko,onOpenChange:os,children:e.jsxs(ge,{className:"w-[95vw] sm:w-auto sm:max-w-[520px] rounded-2xl border border-slate-800 shadow-2xl",overlayClassName:"backdrop-blur-[5px] bg-black/10 !dark:bg-black",children:[e.jsxs(pe,{children:[e.jsx(xe,{className:"text-right",children:"إيصالات الديون"}),e.jsx(rt,{className:"text-right",children:"اختر دينًا لعرض إيصاله بالتفصيل"})]}),e.jsx("div",{className:"px-1 mb-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(Iu,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-500"}),e.jsx(J,{placeholder:"ابحث بالاسم أو المبلغ...",value:Cr,onChange:a=>yd(a.target.value),className:"pr-9 text-right"})]})}),Pe.length>0?e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 space-y-2 px-1 -mx-1 sm:mx-0 sm:px-0",style:{contain:"layout paint"},onScroll:a=>{const s=a.currentTarget;Ln.length<Wn.length&&s.scrollTop+s.clientHeight>=s.scrollHeight-50&&Rn(i=>i+1)},children:[Ln.length>0?Ln.map(a=>e.jsx("div",{onClick:()=>{Dr(a),Va(!0),os(!1),Ps(!1)},className:`p-4 sm:p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors min-h-[64px] ${a.type==="debtor"?"border-r-4 border-r-red-500 bg-red-50/10":"border-r-4 border-r-emerald-500"}`,children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center",children:[e.jsxs("div",{className:"text-right space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-[14px] sm:text-sm",children:a.debtorName}),a.type==="debtor"&&e.jsx(Pa,{variant:"destructive",className:"h-5 text-[10px] px-1",children:"علينا"}),(!a.type||a.type==="creditor")&&e.jsx(Pa,{variant:"outline",className:"h-5 text-[10px] px-1 text-emerald-700 border-emerald-200 bg-emerald-50",children:"لنا"})]}),e.jsx("p",{className:"text-[13px] sm:text-sm text-gray-600",children:a.reason}),e.jsx("p",{className:"text-[12px] sm:text-sm text-gray-500",children:Fr.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-bold text-xl sm:text-lg",children:[Number(Number(a.amount||0)-Number(a.paidAmount||0)).toFixed(2)," جنيه"]}),e.jsx(Pa,{variant:a.status==="paid"?"default":"secondary",className:`${a.status==="paid"?"bg-green-500":"bg-yellow-500"} text-[12px] sm:text-xs`,children:a.status==="paid"?"مدفوع":"قيد المراجعة"})]})]})},a.id)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{children:"لا توجد نتائج مطابقة للبحث"})}),Ln.length<Wn.length&&e.jsx("div",{className:"flex justify-center pt-1",children:e.jsx(I,{variant:"outline",size:"sm",onClick:()=>Rn(a=>a+1),children:"تحميل المزيد"})})]}):e.jsx("div",{className:"text-center text-sm text-gray-500",children:"لا توجد ديون مسجلة"}),e.jsxs(Oe,{className:"flex justify-between mt-3",children:[e.jsx(I,{variant:"destructive",onClick:async()=>{try{if(!Pe||Pe.length===0){p({title:"لا توجد ديون",description:"القائمة فارغة بالفعل."});return}if(!window.confirm("هل تريد حذف كل إيصالات الديون؟ هذا الإجراء لا يمكن التراجع عنه."))return;const s=[];if(Ut(s),Dr(null),await Ia(s),t!=null&&t.uid)try{await oe.updateUserData(t.uid,{debts:[],debtsDeletedAt:ht()});try{localStorage.removeItem(`debts_unsynced_${t.uid}`)}catch{}}catch(i){console.error("تعذر حذف الديون من Firebase:",i),p({title:"فشل الحذف من السحابة",description:"تعذر حذف الإيصالات من Firebase، حاول مرة أخرى.",variant:"destructive"});return}p({title:"تم حذف كل إيصالات الديون",description:"تم تفريغ القائمة بالكامل."}),os(!1)}catch(a){console.error("تعذر حذف كل إيصالات الديون:",a),p({title:"فشل الحذف",description:"حدث خطأ أثناء الحذف، حاول مرة أخرى.",variant:"destructive"})}},children:"حذف كل الإيصالات"}),e.jsx(I,{variant:"outline",onClick:()=>os(!1),children:"إغلاق"})]})]})}),e.jsx(fe,{open:no,onOpenChange:Bh,children:e.jsxs(ge,{className:"max-w-2xl h-[80vh] flex flex-col p-0",overlayClassName:"backdrop-blur-[5px] bg-black/10 !dark:bg-black",children:[e.jsxs(pe,{className:"p-4 border-b",children:[e.jsx(xe,{children:"سجل سداد الديون"}),e.jsx(rt,{children:"عرض عمليات السداد حسب التاريخ"})]}),e.jsxs("div",{className:"p-4 border-b bg-gray-50 dark:bg-gray-900 flex flex-col sm:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(H,{children:"نوع البحث"}),e.jsxs("div",{className:"flex bg-white dark:bg-gray-800 rounded-md border p-1",children:[e.jsx("button",{onClick:()=>Rc("day"),className:`flex-1 px-3 py-1.5 text-sm rounded-sm transition-colors ${is==="day"?"bg-purple-100 text-purple-700 font-medium":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"يومي"}),e.jsx("button",{onClick:()=>Rc("month"),className:`flex-1 px-3 py-1.5 text-sm rounded-sm transition-colors ${is==="month"?"bg-purple-100 text-purple-700 font-medium":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:"شهري"})]})]}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(H,{children:is==="day"?"اختر اليوم":"اختر الشهر"}),e.jsx(J,{type:is==="day"?"date":"month",value:is==="day"?Is:Is.substring(0,7),onChange:a=>Uh(a.target.value),className:"bg-white dark:bg-gray-800"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-500 mb-1",children:"إجمالي الفترة"}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:Rt(io.reduce((a,s)=>a+(s.amount||0),0))})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-0",children:io.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-500",children:[e.jsx(Tu,{className:"h-12 w-12 mb-2 opacity-20"}),e.jsx("p",{children:"لا توجد عمليات سداد في هذه الفترة"})]}):e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"grid grid-cols-3 bg-gray-50 dark:bg-gray-900 p-3 text-sm font-medium text-gray-500 border-b",children:[e.jsx("div",{className:"text-right",children:"التاريخ"}),e.jsx("div",{className:"text-right",children:"اسم المديون"}),e.jsx("div",{className:"text-right",children:"المبلغ"})]}),e.jsx("div",{className:"divide-y dark:divide-gray-800",children:io.map(a=>{var s;return e.jsxs("div",{className:"grid grid-cols-3 p-3 items-center hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsx("div",{className:"text-sm text-gray-500 font-mono",children:(s=a.createdAt)!=null&&s.seconds?new Date(a.createdAt.seconds*1e3).toLocaleString("ar-EG"):"الآن"}),e.jsx("div",{className:"font-medium",children:a.debtorName}),e.jsx("div",{className:"font-bold text-green-600",children:Rt(a.amount)})]},a.id)})})]})})]})}),e.jsx(fe,{open:zf,onOpenChange:Co,children:e.jsxs(ge,{className:"sm:max-w-[500px] w-full max-h-[90vh] overflow-hidden flex flex-col p-0 gap-0 !bg-[#0f172a] !text-slate-100 border border-slate-800 shadow-2xl",overlayClassName:"backdrop-blur-[5px] bg-black/10 !dark:bg-black",children:[e.jsxs("div",{className:"p-4 border-b border-slate-800 bg-[#0f172a]",children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"text-right flex items-center justify-end gap-2",children:[e.jsx(qr,{className:"w-5 h-5 text-primary"}),"إدارة العملاء والديون"]}),e.jsx(rt,{className:"text-right",children:"سجل بيانات العملاء والديون بسهولة"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4",dir:"rtl",children:[e.jsx(I,{variant:Es==="customers_list"?"default":"outline",onClick:()=>Io("customers_list"),size:"sm",className:"flex-1 text-xs h-8",children:"العملاء المسجلين"}),e.jsx(I,{variant:Es==="add_debt"?"default":"outline",onClick:()=>Io("add_debt"),size:"sm",className:"flex-1 text-xs h-8",children:"تسجيل دين"}),e.jsx(I,{variant:Es==="add_customer"?"default":"outline",onClick:()=>Io("add_customer"),size:"sm",className:"flex-1 text-xs h-8",children:"إضافة عميل"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[Es==="add_customer"&&e.jsxs(Aa,{className:"border shadow-sm bg-white dark:bg-card dark:border-gray-800",children:[e.jsx(gs,{className:"pb-2 pt-4 px-4",children:e.jsxs(ps,{className:"text-sm font-medium text-right text-gray-700 dark:text-gray-200 flex items-center justify-end gap-2",children:[e.jsx(It,{className:"w-4 h-4"}),"إضافة عميل جديد"]})}),e.jsxs(Ta,{className:"p-4 pt-2 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(H,{className:"text-right block text-xs text-gray-500 dark:text-gray-400",children:"اسم العميل"}),e.jsx(J,{value:Ao,onChange:a=>bd(a.target.value),className:"text-right h-9 dark:bg-gray-900 dark:border-gray-700",placeholder:"اكتب اسم العميل"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(H,{className:"text-right block text-xs text-gray-500 dark:text-gray-400",children:"رقم الموبايل"}),e.jsx(J,{value:To,onChange:a=>vd(a.target.value),className:"text-right h-9 dark:bg-gray-900 dark:border-gray-700",placeholder:"اكتب رقم الموبايل"})]}),e.jsxs(I,{className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white h-9 mt-2",onClick:async()=>{if(!Ao||!To){p({title:"بيانات غير مكتملة",description:"يرجى إدخال اسم العميل ورقم الموبايل",variant:"destructive"});return}const a={id:Date.now().toString(),name:Ao.trim(),mobile:To.trim(),createdAt:new Date},s=[a,...Pt];await Xo(s),bd(""),vd(""),p({title:"تمت إضافة العميل",description:`تم إضافة ${a.name}`})},children:[e.jsx(It,{className:"w-4 h-4 mr-2"}),"إضافة العميل"]})]})]}),Es==="add_debt"&&e.jsxs(Aa,{className:"border shadow-sm bg-white dark:bg-card dark:border-gray-800",children:[e.jsx(gs,{className:"pb-2 pt-4 px-4",children:e.jsxs(ps,{className:"text-sm font-medium text-right text-gray-700 dark:text-gray-200 flex items-center justify-end gap-2",children:[e.jsx(Oa,{className:"w-4 h-4 text-orange-600"}),"تسجيل مبلغ دين"]})}),e.jsx(Ta,{className:"p-4 pt-2 space-y-3",children:Pt.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(H,{className:"text-right block text-xs text-gray-500 dark:text-gray-400",children:"اختر العميل"}),e.jsxs(Ja,{value:ls,onValueChange:wd,children:[e.jsx(Ha,{className:"w-full h-9 text-right dark:bg-gray-900 dark:border-gray-700",dir:"rtl",children:e.jsx(Qa,{placeholder:"اختر عميل"})}),e.jsx(Ga,{className:"dark:bg-gray-900 dark:border-gray-800",children:Pt.map(a=>e.jsxs(da,{value:a.id,className:"text-right justify-end",children:[a.name," — ",a.mobile]},a.id))})]}),ls&&(()=>{const a=Pe.filter(s=>s.customerId===ls&&s.status==="pending").reduce((s,i)=>s+(i.amount-(i.paidAmount||0)),0);return e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(I,{variant:"ghost",size:"sm",className:"h-6 text-xs text-blue-600 hover:text-blue-700 hover:bg-blue-50 px-2",onClick:()=>{Xf(ls),Ro(!0)},children:"إيصالات ديونه"}),a>0&&e.jsxs("div",{className:"text-xs text-red-600 font-semibold text-right",children:["إجمالي الديون الحالية: ",a.toFixed(2)," جنيه"]})]})})()]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(H,{className:"text-right block text-xs text-gray-500",children:"المبلغ"}),e.jsx(J,{type:"number",value:Nd,onChange:a=>Yf(a.target.value),className:"text-right h-9",placeholder:"0.00"})]}),e.jsx(I,{className:"w-full bg-orange-600 hover:bg-orange-700 text-white h-9 mt-2",onClick:async()=>{const a=parseFloat(Nd);if(!ls){p({title:"اختر عميل",description:"يرجى اختيار عميل أولاً",variant:"destructive"});return}if(isNaN(a)||a<=0){p({title:"قيمة غير صحيحة",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const s=Pt.find(l=>l.id===ls);if(!s)return;const i={id:Date.now().toString(),debtorName:s.name,customerId:s.id,mobile:s.mobile,amount:Number(a.toFixed(2)),reason:"دين عميل",status:"pending",createdAt:new Date,paidAmount:0,partialPayments:[]};Ir(i),Os(!0)},children:"متابعة وإضافة المبلغ"})]}):e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm bg-gray-50 rounded border border-dashed",children:"لا يوجد عملاء مسجلين. أضف عميلاً أولاً."})})]}),Es==="customers_list"&&e.jsxs(Aa,{className:"border shadow-sm bg-white dark:bg-card dark:border-gray-800",children:[e.jsx(gs,{className:"pb-2 pt-4 px-4",children:e.jsxs(ps,{className:"text-sm font-medium text-right text-gray-700 dark:text-gray-200 flex items-center justify-end gap-2",children:[e.jsx(Wu,{className:"w-4 h-4"}),"العملاء المسجلين (",Pt.length,")"]})}),e.jsx(Ta,{className:"p-4 pt-2",children:Pt.length>0?e.jsx("div",{className:"space-y-2",children:Pt.map(a=>e.jsxs("div",{className:"p-3 border rounded-lg flex items-center justify-between bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors dark:border-gray-700",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>{jd(a.id),Po(a.name||""),Eo(a.mobile||""),Bn(!0)},children:e.jsx(Mu,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>{Oo(a.id),Mo(a.name||""),$n(!0)},children:e.jsx(ca,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:a.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono",children:a.mobile})]})]},a.id))}):e.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"لا توجد بيانات لعرضها"})})]})]}),e.jsx(Oe,{className:"p-4 border-t bg-white dark:bg-card dark:border-gray-800",children:e.jsx(I,{variant:"outline",className:"w-full sm:w-auto dark:bg-gray-800 dark:text-white dark:border-gray-700 dark:hover:bg-gray-700",onClick:()=>Co(!1),children:"إغلاق"})})]})}),e.jsx(fe,{open:Gf,onOpenChange:Ro,children:e.jsxs(ge,{className:"sm:max-w-[500px] max-h-[80vh] overflow-hidden flex flex-col p-0 gap-0",children:[e.jsx("div",{className:"p-4 border-b bg-white dark:bg-card dark:border-gray-800",children:e.jsxs(pe,{children:[e.jsxs(xe,{className:"text-right flex items-center justify-end gap-2 dark:text-gray-100",children:[e.jsx(ui,{className:"w-5 h-5 text-blue-600"}),"إيصالات العميل"]}),e.jsx(rt,{className:"text-right dark:text-gray-400",children:(hu=Pt.find(a=>a.id===Wo))==null?void 0:hu.name})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50/50 dark:bg-black/50",children:[Pe.filter(a=>a.customerId===Wo).sort((a,s)=>new Date(s.createdAt).getTime()-new Date(a.createdAt).getTime()).map(a=>e.jsxs("div",{className:"p-3 border rounded-lg bg-white dark:bg-card dark:border-gray-700 shadow-sm flex justify-between items-center",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold text-sm dark:text-gray-100",children:[Number(Number(a.amount||0)-Number(a.paidAmount||0)).toFixed(2)," جنيه"]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:a.reason}),e.jsx(Pa,{variant:a.status==="paid"?"default":"secondary",className:`mt-1 h-5 text-[10px] ${a.status==="paid"?"bg-green-500":"bg-yellow-500 text-yellow-950"}`,children:a.status==="paid"?"مدفوع":"قيد المراجعة"})]}),e.jsxs("div",{className:"text-left text-xs text-gray-400 flex flex-col items-end gap-1",children:[e.jsx("div",{className:"font-mono",children:Fr.format(new Date(a.createdAt))}),e.jsx("div",{className:"font-mono",children:new Date(a.createdAt).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})})]})]},a.id)),Pe.filter(a=>a.customerId===Wo).length===0&&e.jsxs("div",{className:"text-center text-gray-500 py-8 flex flex-col items-center gap-2",children:[e.jsx(ui,{className:"w-8 h-8 text-gray-300"}),e.jsx("span",{children:"لا توجد إيصالات لهذا العميل"})]})]}),e.jsx(Oe,{className:"p-4 border-t bg-white dark:bg-card dark:border-gray-800",children:e.jsx(I,{variant:"outline",className:"w-full dark:bg-gray-800 dark:text-white dark:border-gray-700 dark:hover:bg-gray-700",onClick:()=>Ro(!1),children:"إغلاق"})})]})}),e.jsx(fe,{open:Hf,onOpenChange:$n,children:e.jsxs(ge,{hideClose:!0,className:"sm:max-w-[420px] rounded-2xl bg-gradient-to-br from-white via-rose-50 to-red-50 dark:from-gray-900 dark:via-red-950/30 dark:to-red-900/10 shadow-2xl border border-red-100 dark:border-red-900/50 text-center",children:[e.jsxs(pe,{children:[e.jsx(xe,{className:"text-center text-xl font-bold text-red-700 dark:text-red-400",children:"تأكيد حذف العميل"}),e.jsxs(rt,{className:"text-center text-gray-600 dark:text-gray-300",children:["سيتم حذف العميل نهائيًا: ",kd]})]}),e.jsx("div",{className:"py-2 text-sm text-gray-700 dark:text-gray-400",children:"لا يمكن التراجع عن هذا الإجراء."}),e.jsxs(Oe,{className:"flex justify-center gap-3",children:[e.jsx(I,{variant:"outline",onClick:()=>{$n(!1),Oo(""),Mo("")},children:"إلغاء"}),e.jsx(I,{variant:"destructive",className:"bg-red-600 hover:bg-red-700",onClick:async()=>{const a=Qf,s=Pt.filter(i=>i.id!==a);await Xo(s),ls===a&&wd(""),$n(!1),Oo(""),Mo(""),p({title:"تم حذف العميل",description:kd})},children:"حذف نهائي"})]})]})}),e.jsx(fe,{open:Kf,onOpenChange:Bn,children:e.jsxs(ge,{className:"sm:max-w-[420px]",children:[e.jsx(pe,{children:e.jsx(xe,{className:"text-right",children:"تعديل بيانات العميل"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(H,{htmlFor:"editCustomerName",className:"text-right col-span-1",children:"الاسم"}),e.jsx(J,{id:"editCustomerName",value:Sd,onChange:a=>Po(a.target.value),className:"col-span-3 text-right"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(H,{htmlFor:"editCustomerMobile",className:"text-right col-span-1",children:"الموبايل"}),e.jsx(J,{id:"editCustomerMobile",value:Dd,onChange:a=>Eo(a.target.value),className:"col-span-3 text-right"})]})]}),e.jsxs(Oe,{className:"flex justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>Bn(!1),children:"إلغاء"}),e.jsx(I,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{const a=Jf,s=Sd.trim(),i=Dd.trim();if(!a||!s||!i){p({title:"بيانات غير مكتملة",description:"أدخل الاسم ورقم الموبايل",variant:"destructive"});return}const l=Pt.map(m=>m.id===a?{...m,name:s,mobile:i}:m);await Xo(l);const d=Pe.map(m=>m.customerId===a?{...m,debtorName:s,mobile:i}:m);d!==Pe&&(Ut(d),await Ia(d)),Bn(!1),jd(""),Po(""),Eo(""),p({title:"تم تحديث العميل",description:s})},children:"حفظ"})]})]})}),e.jsx(fe,{open:wh,onOpenChange:ss,children:e.jsxs(ge,{className:"sm:max-w-[520px]",children:[e.jsxs(pe,{children:[e.jsx(xe,{className:"text-right",children:"مصروفات المحل"}),e.jsx(rt,{className:"text-right",children:"أدخل تفاصيل المصروف ثم اختر مصدر الخصم."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(H,{htmlFor:"expenseName",className:"text-right col-span-1",children:"اسم المصروف"}),e.jsx(J,{id:"expenseName",value:hn,onChange:a=>fc(a.target.value),className:"col-span-3 text-right",placeholder:"مثال: كهرباء، صيانة، مشتريات"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(H,{htmlFor:"expenseAmount",className:"text-right col-span-1",children:"تمن المصروف"}),e.jsx(J,{id:"expenseAmount",type:"number",value:Bi,onChange:a=>gc(a.target.value),className:"col-span-3 text-right",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(H,{htmlFor:"expenseNotes",className:"text-right col-span-1",children:"ملاحظات"}),e.jsx(J,{id:"expenseNotes",value:$i,onChange:a=>pc(a.target.value),className:"col-span-3 text-right",placeholder:"معلومات إضافية إن وجدت"})]})]}),e.jsxs(Oe,{className:"flex justify-between",children:[e.jsx(I,{className:"bg-orange-600 hover:bg-orange-700",onClick:()=>{if(!hn||!Bi){p({title:"بيانات غير مكتملة",description:"يرجى إدخال اسم المصروف وقيمته",variant:"destructive"});return}gn(!0)},children:"إضافة مصروف"}),e.jsx(I,{variant:"outline",onClick:()=>qi(!0),children:"إيصالات المصاريف"})]})]})}),e.jsx(fe,{open:Sh,onOpenChange:qi,children:e.jsxs(ge,{className:"sm:max-w-[420px]",dir:"rtl",children:[e.jsxs(pe,{children:[e.jsx(xe,{className:"text-right",children:"إيصالات المصاريف"}),e.jsx(rt,{className:"text-right",children:"آخر المصاريف المسجلة"})]}),fn.length>0?e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:fn.map(a=>e.jsx("div",{className:"p-2 border rounded-lg bg-white dark:bg-card dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-sm dark:text-gray-200",children:a.name}),e.jsx("p",{className:"text-[11px] text-gray-600 dark:text-gray-400",children:a.notes||"بدون ملاحظات"}),e.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-500",children:new Date(a.createdAt).toLocaleString("ar-EG")})]}),e.jsxs("div",{className:"text-left flex items-start gap-2",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-bold text-sm dark:text-gray-200",children:[a.amount," جنيه"]}),e.jsx(Pa,{variant:"secondary",className:a.source==="cash"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300",children:a.source==="cash"?"من النقدية":`من المحفظة${a.walletId?` (${a.walletId})`:""}`})]}),e.jsxs(I,{variant:"destructive",size:"sm",className:"shrink-0",onClick:()=>f0(a.id),title:"حذف نهائي",children:[e.jsx(ca,{className:"w-4 h-4 ml-1"}),"حذف"]})]})]})},a.id))}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"لا توجد مصاريف مسجلة بعد"})]})}),e.jsx(fe,{open:jh,onOpenChange:gn,children:e.jsxs(ge,{className:"sm:max-w-[480px]",children:[e.jsx(pe,{children:e.jsx(xe,{className:"text-right",children:"اختيار مصدر خصم المصروف"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-right",children:"اختر هل تريد خصم مبلغ المصروف من الرصيد النقدي في الدرج أم من إحدى المحافظ."}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(I,{variant:wt==="cash"?"default":"outline",className:wt==="cash"?"bg-blue-600 hover:bg-blue-700 text-white":"",onClick:()=>ir("cash"),children:"الفلوس النقدية"}),e.jsx(I,{variant:wt==="wallet"?"default":"outline",className:wt==="wallet"?"bg-purple-600 hover:bg-purple-700 text-white":"",onClick:()=>ir("wallet"),children:"أرصدة المحافظ"}),e.jsx(I,{variant:wt==="fawry"?"default":"outline",className:wt==="fawry"?"bg-amber-600 hover:bg-amber-700 text-white":"",onClick:()=>ir("fawry"),children:"فوري"})]}),wt==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"text-right block",children:"اختر المحفظة للخصم"}),e.jsxs(Ja,{value:Ns,onValueChange:Vi,children:[e.jsx(Ha,{className:"w-full",children:e.jsx(Qa,{placeholder:"اختر محفظة"})}),e.jsx(Ga,{children:M.map(a=>e.jsx(da,{value:a.id,children:a.phone||a.name||a.id},a.id))})]})]})]}),e.jsxs(Oe,{className:"flex justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>{gn(!1),ir(null),Vi("")},children:"إلغاء"}),e.jsx(I,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{const a=Number(Bi);if(isNaN(a)||a<=0){p({title:"قيمة غير صحيحة",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}if(!wt){p({title:"اختر مصدر الخصم",description:"يرجى اختيار النقدية أو المحفظة",variant:"destructive"});return}try{if(wt==="cash"){const d=Number(($e-a).toFixed(2));Xe(d),localStorage.setItem(qe(),d.toString());const m={cashBalance:d,lastUpdated:new Date().toISOString()},f=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(f,JSON.stringify(m)),t!=null&&t.uid?(await oe.updateUserData(t.uid,m),localStorage.removeItem(f),ye(!1)):ye(!0)}else if(wt==="wallet"){if(!Ns){p({title:"اختر محفظة",description:"يرجى اختيار محفظة للخصم",variant:"destructive"});return}const d=Ne[Ns]||0,m=Number((d-a).toFixed(2)),f={...Ne,[Ns]:m};lt(f);const g=new Date().toISOString(),v={walletBalances:f,lastUpdated:g},y=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(y,JSON.stringify(v)),localStorage.setItem(Ze(),JSON.stringify(f)),localStorage.setItem(`walletBalances_backup_${g}`,JSON.stringify(f)),t!=null&&t.uid&&oe.updateUserData(t.uid,v).catch(()=>{})}}catch(d){console.error("خطأ أثناء تحديث الأرصدة عند حفظ المصروف:",d)}let s=Date.now().toString();try{if(t!=null&&t.uid){const{addDoc:d,collection:m,serverTimestamp:f}=await ne(async()=>{const{addDoc:y,collection:b,serverTimestamp:w}=await import("./index-CZwBW8vR.js").then(C=>C.cE);return{addDoc:y,collection:b,serverTimestamp:w}},__vite__mapDeps([0,1]),import.meta.url),{db:g}=await ne(async()=>{const{db:y}=await import("./index-CZwBW8vR.js").then(b=>b.cF);return{db:y}},__vite__mapDeps([0,1]),import.meta.url);s=(await d(m(g,"shop_expenses"),{userId:t.uid,shopId:j||(n==null?void 0:n.shopId)||t.uid||"default-shop",name:hn,amount:a,notes:$i||"",source:wt,walletId:wt==="wallet"?Ns:null,createdAt:f()})).id}}catch(d){console.error("خطأ أثناء حفظ المصروف في Firestore:",d)}const i={id:s,name:hn,amount:a,notes:$i,source:wt,walletId:wt==="wallet"?Ns:void 0,createdAt:new Date},l=[...fn,i];await Bd(l),fc(""),gc(""),pc(""),ir(null),Vi(""),gn(!1),ss(!0),qi(!0),p({title:"تم إضافة المصروف",description:wt==="cash"?"تم الخصم من النقدية":wt==="wallet"?"تم الخصم من أرصدة المحافظ":"تم تسجيل الدفع عبر فوري"})},children:"تأكيد الخصم"})]})]})}),e.jsx(fe,{open:kh,onOpenChange:or,children:e.jsxs(ge,{className:"sm:max-w-[520px]",children:[e.jsxs(pe,{children:[e.jsx(xe,{className:"text-right",children:"النواقص"}),e.jsx(rt,{className:"text-right",children:"سجل العناصر الناقصة التي تحتاج شراء وتابع حالتها."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(H,{htmlFor:"deficiencyName",className:"text-right col-span-1",children:"اسم العنصر"}),e.jsx(J,{id:"deficiencyName",value:lr,onChange:a=>zi(a.target.value),className:"col-span-3 text-right",placeholder:"مثال: سكر، زيت، مناديل"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(H,{htmlFor:"deficiencyQuantity",className:"text-right col-span-1",children:"الكمية"}),e.jsx(J,{id:"deficiencyQuantity",type:"number",value:xc,onChange:a=>Yi(a.target.value),className:"col-span-3 text-right",placeholder:"1"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(I,{className:"bg-rose-600 hover:bg-rose-700",onClick:()=>{if(je){p({title:"غير متاح",description:"النواقص غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"});return}const a=parseInt(xc||"1",10);if(!lr){p({title:"بيانات غير مكتملة",description:"يرجى إدخال اسم العنصر",variant:"destructive"});return}if(isNaN(a)||a<=0){p({title:"كمية غير صحيحة",description:"يرجى إدخال كمية صحيحة",variant:"destructive"});return}(async()=>{if(t!=null&&t.uid)try{const{collection:i,addDoc:l,serverTimestamp:d}=await ne(async()=>{const{collection:g,addDoc:v,serverTimestamp:y}=await import("./index-CZwBW8vR.js").then(b=>b.cE);return{collection:g,addDoc:v,serverTimestamp:y}},__vite__mapDeps([0,1]),import.meta.url),{db:m}=await ne(async()=>{const{db:g}=await import("./index-CZwBW8vR.js").then(v=>v.cF);return{db:g}},__vite__mapDeps([0,1]),import.meta.url),f=await l(i(m,"deficiencies"),{userId:t.uid,shopId:j||(n==null?void 0:n.shopId)||t.uid||"default-shop",name:lr,quantity:a,status:"pending",createdAt:d()});try{const g=Hn(),v=localStorage.getItem(g),y=v?JSON.parse(v):[],b=Array.isArray(y)?y:[],w=b.some(A=>String((A==null?void 0:A.id)||"")===f.id),C={id:f.id,name:lr,quantity:a,status:"pending",createdAt:new Date().toISOString()},k=w?b:[...b,C];localStorage.setItem(g,JSON.stringify(k))}catch{}zi(""),Yi(""),p({title:"تمت الإضافة",description:"تمت إضافة العنصر إلى قائمة النواقص"});return}catch(i){console.warn("فشل حفظ النواقص إلى Firestore، سيُستخدم التخزين المحلي:",i)}const s={id:Date.now().toString(),name:lr,quantity:a,status:"pending",createdAt:new Date};js(i=>{const l=[...i,s];return Go(l),l}),zi(""),Yi(""),p({title:"تمت الإضافة",description:"تمت إضافة العنصر إلى قائمة النواقص"})})()},children:"إضافة للنواقص"})}),yc.length>0?e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:yc.map(a=>e.jsx("div",{className:"p-2 border rounded-lg bg-white dark:bg-card dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-sm dark:text-gray-200",children:a.name}),e.jsxs("p",{className:"text-[11px] text-gray-600 dark:text-gray-400",children:["الكمية: ",a.quantity]}),e.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-500",children:new Date(a.createdAt).toLocaleString("ar-EG")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pa,{variant:"secondary",className:a.status==="pending"?"bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-300":"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",children:a.status==="pending"?"قيد الشراء":"تم الشراء"}),e.jsx(I,{variant:"outline",className:a.status==="pending"?"text-green-700 border-green-300 hover:bg-green-50":"text-rose-700 border-rose-300 hover:bg-rose-50",onClick:()=>{(async()=>{const s=a.status==="pending"?"purchased":"pending";if(t!=null&&t.uid)try{const{doc:i,updateDoc:l,serverTimestamp:d}=await ne(async()=>{const{doc:f,updateDoc:g,serverTimestamp:v}=await import("./index-CZwBW8vR.js").then(y=>y.cE);return{doc:f,updateDoc:g,serverTimestamp:v}},__vite__mapDeps([0,1]),import.meta.url),{db:m}=await ne(async()=>{const{db:f}=await import("./index-CZwBW8vR.js").then(g=>g.cF);return{db:f}},__vite__mapDeps([0,1]),import.meta.url);await l(i(m,"deficiencies",a.id),{status:s,updatedAt:d()});return}catch(i){console.warn("فشل تحديث حالة النواقص على Firestore، استخدام التخزين المحلي:",i)}js(i=>{const l=i.map(d=>d.id===a.id?{...d,status:s}:d);return Go(l),l})})()},title:a.status==="pending"?"تم الشراء":"إلغاء الشراء",children:a.status==="pending"?"تم الشراء":"إلغاء الشراء"}),e.jsx(I,{variant:"outline",className:"text-red-700 border-red-300 hover:bg-red-50",onClick:()=>{(async()=>{if(t!=null&&t.uid)try{const{doc:s,deleteDoc:i}=await ne(async()=>{const{doc:d,deleteDoc:m}=await import("./index-CZwBW8vR.js").then(f=>f.cE);return{doc:d,deleteDoc:m}},__vite__mapDeps([0,1]),import.meta.url),{db:l}=await ne(async()=>{const{db:d}=await import("./index-CZwBW8vR.js").then(m=>m.cF);return{db:d}},__vite__mapDeps([0,1]),import.meta.url);await i(s(l,"deficiencies",a.id));return}catch(s){console.warn("فشل حذف عنصر النواقص من Firestore، استخدام التخزين المحلي:",s)}js(s=>{const i=s.filter(l=>l.id!==a.id);return Go(i),i})})()},title:"حذف",children:"حذف"})]})]})},a.id))}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"لا توجد عناصر مسجلة في النواقص"})]}),e.jsx(Oe,{className:"flex justify-end",children:e.jsx(I,{variant:"outline",onClick:()=>or(!1),children:"إغلاق"})})]})}),e.jsx(fe,{open:Ch,onOpenChange:a=>{pn(a),a||(yn(null),cr(""),dr(""))},children:e.jsxs(ge,{className:"sm:max-w-[520px]",children:[e.jsxs(pe,{children:[e.jsx(xe,{className:"text-right",children:"أرقامي مع عملائي"}),e.jsx(rt,{className:"text-right",children:"استعرض أرقام المحافظ واضغط على علامة الزائد لتسليم رقم لعميل. هذه القائمة مخصصة للأرقام التي تعطيها لعملاء خارج المحل ليحوّلوا عليها، حتى تكون عارف أن الخطوط دي مخصصة لعملاء هيحولو عليها من برا المحل علشان متستلمش عليها وتوقف ليميتك"})]}),e.jsx("div",{className:"grid gap-3 py-2",children:M.length===0?e.jsx("div",{className:"text-center text-sm text-gray-500",children:"لا توجد محافظ مضافة حتى الآن."}):M.map(a=>{const s=Ki[a.id],i=!!s;return e.jsxs("div",{className:`p-3 rounded-lg border flex flex-col gap-2 ${i?"border-red-500 bg-red-50 text-red-700":"border-emerald-500 bg-emerald-50 text-emerald-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"font-semibold text-base",children:a.phone||"بدون رقم"}),a.name?e.jsx("span",{className:"text-xs text-gray-600",children:a.name}):null,i&&e.jsxs("span",{className:"text-xs mt-1",children:["لعميل: ",s.name,s.amount&&s.amount.trim()!==""?` - مبلغ: ${s.amount}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{type:"button",size:"icon",className:"h-9 w-9 rounded-full bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>{yn(a.id),cr((s==null?void 0:s.name)||""),dr((s==null?void 0:s.amount)||"")},children:e.jsx(It,{className:"h-4 w-4"})}),i&&e.jsx(I,{type:"button",size:"icon",variant:"outline",className:"h-9 w-9 rounded-full border-red-300 text-red-600 hover:bg-red-50",onClick:()=>{const l=`clientNumberAssignments_${(t==null?void 0:t.uid)||"default"}`,d={...Ki};delete d[a.id],Ss(d);try{localStorage.setItem(l,JSON.stringify(d))}catch{}xn===a.id&&(yn(null),cr(""),dr(""))},children:e.jsx(ca,{className:"h-4 w-4"})})]})]}),xn===a.id&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-stretch",children:[e.jsx(J,{placeholder:"اسم مستلم الرقم",className:"text-right",value:bc,onChange:l=>cr(l.target.value)}),e.jsx(J,{placeholder:"المبلغ المتوقع تحويله",className:"text-right sm:max-w-[160px]",value:vc,onChange:l=>dr(l.target.value),inputMode:"decimal"}),e.jsx(I,{className:"bg-red-600 hover:bg-red-700 text-white px-4",onClick:()=>{const l=bc.trim();if(!l){p({title:"اسم غير صحيح",description:"يرجى إدخال اسم مستلم الرقم",variant:"destructive"});return}if(!xn)return;const d=vc.trim(),m=`clientNumberAssignments_${(t==null?void 0:t.uid)||"default"}`,f={...Ki,[xn]:{name:l,amount:d}};Ss(f);try{localStorage.setItem(m,JSON.stringify(f))}catch{}yn(null),cr(""),dr("")},children:"تسليم"})]})]},a.id)})})]})}),e.jsx(fe,{open:Zf,onOpenChange:Os,children:e.jsxs(ge,{className:"sm:max-w-[480px]",children:[e.jsx(pe,{children:e.jsx(xe,{className:"text-right",children:(it==null?void 0:it.type)==="decrease"?"اختيار مكان إضافة مبلغ السداد":"اختيار مصدر خصم الدين"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 text-right",children:(it==null?void 0:it.type)==="decrease"?"اختر هل تريد إضافة مبلغ السداد إلى الرصيد النقدي أم إلى إحدى المحافظ أو تسجيله بدون خصم.":"اختر هل تريد خصم مبلغ الدين من الرصيد النقدي في الدرج أم من إحدى المحافظ أو تسجيله بدون خصم."}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(I,{variant:bt==="cash"?"default":"outline",className:bt==="cash"?"bg-blue-600 hover:bg-blue-700 text-white":"",onClick:()=>_r("cash"),children:"الفلوس النقدية"}),e.jsx(I,{variant:bt==="wallet"?"default":"outline",className:bt==="wallet"?"bg-purple-600 hover:bg-purple-700 text-white":"",onClick:()=>_r("wallet"),children:"أرصدة المحافظ"}),e.jsx(I,{variant:bt==="none"?"default":"outline",className:bt==="none"?"bg-gray-600 hover:bg-gray-700 text-white":"",onClick:()=>_r("none"),children:(it==null?void 0:it.type)==="decrease"?"بدون إضافة":"بدون خصم"})]}),bt==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"text-right block",children:(it==null?void 0:it.type)==="decrease"?"اختر المحفظة للإضافة":"اختر المحفظة للخصم"}),e.jsxs(Ja,{value:Ms,onValueChange:Lo,children:[e.jsx(Ha,{className:"w-full",children:e.jsx(Qa,{placeholder:"اختر محفظة"})}),e.jsx(Ga,{children:M.map(a=>e.jsx(da,{value:a.id,children:a.phone||a.name||a.id},a.id))})]})]})]}),e.jsxs(Oe,{className:"flex justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>{Os(!1),Ir(null),_r(null),Lo("")},children:"إلغاء"}),e.jsx(I,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{const a=!!it,s=a&&(it==null?void 0:it.type)==="decrease",i=Number(a?it.delta:(cs==null?void 0:cs.amount)||0);if(!bt){p({title:s?"اختر مكان الإضافة":"اختر مصدر الخصم",description:"يرجى اختيار النقدية أو المحفظة",variant:"destructive"});return}const l=new Date().toISOString();let d=$e,m=Ne,f=!1,g=!1;try{if(bt==="cash")d=Number(s?($e+i).toFixed(2):($e-i).toFixed(2)),f=!0;else if(bt==="wallet"){if(!Ms){p({title:"اختر محفظة",description:s?"يرجى اختيار محفظة للإضافة":"يرجى اختيار محفظة للخصم",variant:"destructive"});return}const k=Ne[Ms]||0,A=Number(s?(k+i).toFixed(2):(k-i).toFixed(2));m={...Ne,[Ms]:A},g=!0}}catch(k){console.error("Error calculating balances:",k);return}let v=[...Pe],y=R,b=!1;if(a){if(!R)return;const k=Number(R.amount||0),A=Number(R.paidAmount||0),L=Number(it.delta||0);if(it.type==="decrease"){const _=R.type==="debtor",E=k-L;if(_&&E<0){const q=Number(Math.abs(E).toFixed(2)),ie={...R,amount:q,type:"creditor",paidAmount:0,status:"pending"};if(v=Pe.map(ee=>ee.id===R.id?ie:ee),y=ie,b=!0,t!=null&&t.uid&&(async()=>{try{const[ee,Ce,et]=[Te(de($,"userTransactions"),K("userId","==",t.uid),K("linkedDebtId","==",R.id),K("status","==","pending")),Te(de($,"transactions"),K("userId","==",t.uid),K("linkedDebtId","==",R.id),K("status","==","pending")),Te(de($,"transactions"),K("merchantUserId","==",t.uid),K("linkedDebtId","==",R.id),K("status","==","pending"))],[tt,Ie,he]=await Promise.all([De(ee),De(Ce),De(et)]),at=kl($);let mt=0;const ot=ea=>{ea.docs.forEach(Dt=>{at.update(Dt.ref,{status:"completed",confirmedAt:new Date}),mt++})};ot(tt),ot(Ie),ot(he),mt>0&&await at.commit(),t!=null&&t.uid&&[...tt.docs.map(Dt=>{var Ue;return String(((Ue=Dt.data())==null?void 0:Ue.transactionId)||"")}),...Ie.docs.map(Dt=>{var Ue;return String(Dt.id||((Ue=Dt.data())==null?void 0:Ue.transactionId)||"")}),...he.docs.map(Dt=>{var Ue;return String(Dt.id||((Ue=Dt.data())==null?void 0:Ue.transactionId)||"")})].filter(Boolean).forEach(Dt=>oe.removeLocalReceiptById(t.uid,Dt))}catch(ee){console.error("Batch update failed for linked transactions (Flip):",ee)}})().catch(ee=>console.error("Transaction update error (Flip):",ee)),t!=null&&t.uid&&bt!=="none")try{await Yr(de($,"debtReceipts"),{debtId:R.id,debtorName:R.debtorName,amount:L,userId:t.uid,createdAt:ht(),type:"payment"});const Ce={transactionId:Ae(de($,"dummy_collection")).id,amount:L,transactionType:"cash_addition",type:"cash_addition",status:"completed",createdAt:new Date,senderName:R.debtorName,receiverName:"المحل",description:`سداد دين وتحويل المتبقي رصيد للعميل ${R.debtorName}`,paymentMethod:bt,walletId:bt==="wallet"?Ms:null,linkedDebtId:R.id,isDebtRepayment:!0};await oe.saveUserTransaction(t.uid,Ce);try{O.invalidateQueries({queryKey:["recentTransactions",t==null?void 0:t.uid]})}catch{}}catch(ee){console.error("Failed to create repayment receipt (Flip):",ee)}p({title:"تم تحويل الدين",description:`تم سداد الدين وتحويل المتبقي (${q} جنيه) إلى "لينا"`})}else{const q=Number(E.toFixed(2)),ie=A>=q,ee={...R,amount:q,status:ie?"paid":"pending"};if(v=Pe.map(Ce=>Ce.id===R.id?ee:Ce),y=ee,b=!0,ie&&(t!=null&&t.uid)&&(async()=>{try{const[Ce,et,tt]=[Te(de($,"userTransactions"),K("userId","==",t.uid),K("linkedDebtId","==",R.id),K("status","==","pending")),Te(de($,"transactions"),K("userId","==",t.uid),K("linkedDebtId","==",R.id),K("status","==","pending")),Te(de($,"transactions"),K("merchantUserId","==",t.uid),K("linkedDebtId","==",R.id),K("status","==","pending"))],[Ie,he,at]=await Promise.all([De(Ce),De(et),De(tt)]),mt=kl($);let ot=0;const ea=Dt=>{Dt.docs.forEach(Ue=>{mt.update(Ue.ref,{status:"completed",confirmedAt:new Date}),ot++})};ea(Ie),ea(he),ea(at),ot>0&&await mt.commit(),t!=null&&t.uid&&[...Ie.docs.map(Ue=>{var la;return String(((la=Ue.data())==null?void 0:la.transactionId)||"")}),...he.docs.map(Ue=>{var la;return String(Ue.id||((la=Ue.data())==null?void 0:la.transactionId)||"")}),...at.docs.map(Ue=>{var la;return String(Ue.id||((la=Ue.data())==null?void 0:la.transactionId)||"")})].filter(Boolean).forEach(Ue=>oe.removeLocalReceiptById(t.uid,Ue))}catch(Ce){console.error("Batch update failed for linked transactions:",Ce)}})().catch(Ce=>{console.error("Transaction update error:",Ce)}),t!=null&&t.uid&&bt!=="none")try{await Yr(de($,"debtReceipts"),{debtId:R.id,debtorName:R.debtorName,amount:L,userId:t.uid,createdAt:ht(),type:"payment"});const et={transactionId:Ae(de($,"dummy_collection")).id,amount:L,transactionType:"cash_addition",type:"cash_addition",status:"completed",createdAt:new Date,senderName:R.debtorName,receiverName:"المحل",description:`سداد دين من العميل ${R.debtorName}`,paymentMethod:bt,walletId:bt==="wallet"?Ms:null,linkedDebtId:R.id,isDebtRepayment:!0};await oe.saveUserTransaction(t.uid,et);try{O.invalidateQueries({queryKey:["recentTransactions",t==null?void 0:t.uid]})}catch{}}catch(Ce){console.error("Failed to create repayment receipt:",Ce)}p({title:"تم إنقاص المبلغ",description:`المبلغ الجديد: ${q} جنيه`})}}else{const _=k+L,E=A>=_,q={amount:L,note:fd||void 0,addedAt:new Date},ie={...R,amount:Number(_.toFixed(2)),status:E?"paid":"pending",additionReceipts:[...R.additionReceipts||[],q]};v=Pe.map(ee=>ee.id===R.id?ie:ee),y=ie,b=!0,p({title:"تم زيادة المبلغ",description:`المبلغ الجديد: ${_} جنيه`})}}else if(cs){v=[{...cs,userId:t==null?void 0:t.uid,shopId:j||(n==null?void 0:n.shopId)||null},...Pe],b=!0;try{t!=null&&t.uid&&fs.send(t.uid,`تم إضافة دين على ${cs.debtorName} بمبلغ ${cs.amount} جنيه`).catch(()=>{})}catch{}}f&&Xe(d),g&&lt(m),b&&(Ut(v),a&&Dr(y)),od(""),ld(""),dd(""),Ps(!1),Os(!1),!a&&b&&os(!0),Ir(null),gd(null),_r(null),Lo(""),On(""),p({title:a?"تم تعديل الدين":"تم حفظ الدين",description:bt==="none"?"لم يتم تعديل الأرصدة":bt==="cash"?s?`تمت إضافة ${i} إلى الرصيد النقدي`:`تم خصم ${i} من الرصيد النقدي`:s?`تمت إضافة ${i} إلى رصيد المحفظة`:`تم خصم ${i} من رصيد المحفظة`});const w={lastUpdated:l};if(f&&(w.cashBalance=d),g&&(w.walletBalances=m),b&&(w.debts=v,w.debtsDeletedAt=null),f&&(localStorage.setItem(qe(),d.toString()),localStorage.setItem(qe()+"_lastUpdated",l)),g&&(localStorage.setItem(Ze(),JSON.stringify(m)),localStorage.setItem(Ze()+"_lastUpdated",l)),b){localStorage.setItem(Tr(),JSON.stringify(v));try{localStorage.setItem(Jo(),JSON.stringify(v))}catch{}try{localStorage.setItem(Ho(),Date.now().toString())}catch{}}const C=`userData_${t==null?void 0:t.uid}`;if(localStorage.setItem(C,JSON.stringify(w)),t!=null&&t.uid){if(b)try{localStorage.setItem(`debts_unsynced_${t.uid}`,"true")}catch{}const k=[];k.push(oe.updateUserData(t.uid,w).then(()=>{(f||g)&&(localStorage.removeItem(C),ye(!1))}));const A=j||(n==null?void 0:n.shopId);if(A&&(f||g)){const L={lastUpdated:l};f&&(L.cashBalance=d),g&&(L.walletBalances=m),k.push(Gt(Ae($,"dashboardData",A),L,{merge:!0}).catch(_=>console.error("Failed to sync to dashboardData",_)))}Promise.all(k).then(()=>{if(b)try{localStorage.removeItem(`debts_unsynced_${t.uid}`)}catch{}}).catch(L=>{console.error("Sync error:",L),ye(!0)})}},children:(it==null?void 0:it.type)==="decrease"?"تأكيد الإضافة":"تأكيد الخصم"})]})]})}),e.jsx(fe,{open:Bf,onOpenChange:Va,children:e.jsxs(ge,{className:"w-[95vw] sm:w-auto sm:max-w-[425px] max-h-[90vh] overflow-y-auto rounded-2xl",hideClose:!0,children:[e.jsx("div",{className:"absolute left-4 top-4 z-50",children:e.jsxs(I,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full opacity-70 hover:opacity-100",onClick:()=>Va(!1),children:[e.jsx(fi,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"إغلاق"})]})}),e.jsx(pe,{children:e.jsx(xe,{className:"text-right",children:"إيصال الدين"})}),R&&e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"text-center border-b pb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"إيصال دين"}),e.jsx("p",{className:"text-sm text-gray-500",children:Fr.format(R.createdAt instanceof Date?R.createdAt:new Date(R.createdAt))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"اسم المديون:"}),e.jsx("span",{children:R.debtorName})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center",children:[e.jsx("span",{className:"font-medium",children:"المبلغ:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{variant:"outline",className:"h-10 w-10 sm:h-8 sm:w-8 p-0","aria-label":"دفع جزء من الدين",onClick:()=>{kr(""),Mn(!0)},children:"−"}),e.jsxs("span",{className:"font-bold text-xl sm:text-lg",children:[R.amount," جنيه"]}),e.jsx(I,{variant:"outline",className:"h-10 w-10 sm:h-8 sm:w-8 p-0","aria-label":"زيادة الدين",onClick:()=>{Uf("increase"),hd(""),On(""),Va(!1),En(!0)},children:"+"})]})]}),(()=>{try{const a=(ue||[]).filter(s=>String((s==null?void 0:s.linkedDebtId)||"")===String(R.id)).reduce((s,i)=>s+Math.max(0,Number((i==null?void 0:i.commission)||0)),0);return a>0?e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"الربح:"}),e.jsxs("span",{className:"text-green-700 font-semibold",children:[a," جنيه"]})]}):null}catch{return null}})(),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"سبب الدين:"}),e.jsx("span",{children:R.reason})]}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"الحالة:"}),e.jsx(Pa,{variant:R.status==="paid"?"default":"secondary",className:`${R.status==="paid"?"bg-green-500":"bg-yellow-500"} w-fit text-[12px] sm:text-xs`,children:R.status==="paid"?"مدفوع":"مؤجل"})]}),(()=>{const a=Number(R.amount||0),s=Number(R.paidAmount||0),i=Math.max(0,a-s);return e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"المبلغ المتبقي:"}),e.jsxs("span",{className:"font-bold text-xl sm:text-lg",children:[i," جنيه"]})]})})(),R.paidAmount?e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"إجمالي المدفوع:"}),e.jsxs("span",{className:"text-green-700",children:[R.paidAmount," جنيه"]})]}):null,R.partialPayments&&R.partialPayments.length>0&&e.jsxs("div",{className:"mt-3 text-[12px] sm:text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium mb-1",children:"سجل الدفعات الجزئية:"}),e.jsx("div",{className:"space-y-1 max-h-[30vh] sm:max-h-24 overflow-y-auto",children:R.partialPayments.map((a,s)=>e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsxs("span",{children:["دفع: ",a.amount," جنيه"]}),e.jsx("span",{children:new Date(a.paidAt).toLocaleString("ar-EG")})]},s))})]}),R.additionReceipts&&R.additionReceipts.length>0&&e.jsxs("div",{className:"mt-3 text-[12px] sm:text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium mb-1",children:"إيصالات الإضافة الجزئية:"}),e.jsx("div",{className:"space-y-1 max-h-[20vh] sm:max-h-32 overflow-y-auto",children:R.additionReceipts.map((a,s)=>e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsxs("span",{children:["إضافة: ",a.amount," جنيه"]}),e.jsx("span",{children:new Date(a.addedAt).toLocaleString("ar-EG")}),a.note&&e.jsxs("span",{className:"sm:col-span-2 text-right text-[11px] text-gray-500",children:["ملاحظة: ",a.note]})]},s))})]})]})]}),e.jsxs(Oe,{className:"flex gap-2 justify-center",children:[e.jsx(I,{onClick:async()=>{if(R){const a=Pe.map(s=>s.id===R.id?{...s,status:"pending"}:s);Ut(a),await Ia(a);try{if(t!=null&&t.uid){const s=computedRemaining;await fs.send(t.uid,`تم سداد الدين بالكامل للعميل ${R.debtorName}: المدفوع ${s} جنيه`)}}catch{}Va(!1),p({title:"تم تحديث حالة الدين",description:"تم تعيين الدين كمؤجل"})}},variant:"outline",className:"bg-yellow-500 hover:bg-yellow-600 text-white",children:"مؤجل"}),e.jsx(I,{onClick:async()=>{if(R){const a=Number(R.amount||0),s=Number(R.paidAmount||0);let i=Math.max(0,a-s);try{const m=(ue||[]).filter(b=>String((b==null?void 0:b.linkedDebtId)||"")===String(R.id)),f=m.reduce((b,w)=>b+Math.max(0,Number((w==null?void 0:w.commission)||0)),0),g=m.reduce((b,w)=>b+Math.max(0,Number(((w==null?void 0:w.sentAmount)??(w==null?void 0:w.transferredAmount)??(w==null?void 0:w.withdrawnAmount)??(w==null?void 0:w.amount))||0)),0),y=a<g+f?a+f:a;i=Math.max(0,Number(y)-s)}catch{}const l=i,d=Pe.map(m=>{if(m.id!==R.id)return m;const f=Number(m.amount||0),g=Number(m.paidAmount||0),v=Number((g+l).toFixed(2)),y=v>=f;return{...m,amount:f,paidAmount:y?f:v,status:"paid",partialPayments:[...m.partialPayments||[],...l>0?[{amount:l,paidAt:new Date}]:[]]}});Ut(d);try{Dr(d.find(m=>m.id===R.id)||null)}catch{}Un(l),qa("none"),Rs(!0),await Ia(d);try{const m=d.find(f=>f.id===R.id);if(t!=null&&t.uid&&(m!=null&&m.id)){const f=Ae($,"debts",m.id),g={...m,userId:t.uid,shopId:j||(n==null?void 0:n.shopId)||null,lastUpdated:new Date().toISOString()};Object.keys(g).forEach(v=>g[v]===void 0&&delete g[v]),await Gt(f,g,{merge:!0})}}catch(m){console.error("Failed to sync debt payment to collection:",m)}try{t!=null&&t.uid&&(R!=null&&R.id)&&(async()=>{const m=Te(de($,"userTransactions"),K("userId","==",t.uid),K("linkedDebtId","==",R.id),K("status","==","pending")),f=await De(m);await Promise.allSettled(f.docs.map(w=>ta(w.ref,{status:"completed",confirmedAt:new Date})));try{const w=f.docs.map(C=>{var k;return String(((k=C.data())==null?void 0:k.transactionId)||"")});t!=null&&t.uid&&w.forEach(C=>C&&oe.removeLocalReceiptById(t.uid,C))}catch{}const g=Te(de($,"transactions"),K("userId","==",t.uid),K("linkedDebtId","==",R.id),K("status","==","pending")),v=await De(g);await Promise.allSettled(v.docs.map(w=>ta(w.ref,{status:"completed",confirmedAt:new Date})));try{const w=v.docs.map(C=>{var k;return String(C.id||((k=C.data())==null?void 0:k.transactionId)||"")});t!=null&&t.uid&&w.forEach(C=>C&&oe.removeLocalReceiptById(t.uid,C))}catch{}const y=Te(de($,"transactions"),K("merchantUserId","==",t.uid),K("linkedDebtId","==",R.id),K("status","==","pending")),b=await De(y);await Promise.allSettled(b.docs.map(w=>ta(w.ref,{status:"completed",confirmedAt:new Date})));try{const w=b.docs.map(C=>{var k;return String(C.id||((k=C.data())==null?void 0:k.transactionId)||"")});t!=null&&t.uid&&w.forEach(C=>C&&oe.removeLocalReceiptById(t.uid,C))}catch{}})().catch(m=>{console.error("تعذر تحديث حالة المعاملات المرتبطة بالدين:",m),p({title:"فشل تحديث حالة المعاملة",description:"تعذر تحديث حالة المعاملات المرتبطة بالدين",variant:"destructive"})})}catch(m){console.error("تعذر تجهيز تحديث حالة المعاملات المرتبطة:",m)}try{const m=Zo(),f=localStorage.getItem(m);if(f){const v=(JSON.parse(f)||[]).map(y=>(y==null?void 0:y.linkedDebtId)===R.id&&(y==null?void 0:y.status)==="pending"?{...y,status:"completed",confirmedAt:new Date}:y);localStorage.setItem(m,JSON.stringify(v)),$t(y=>y.map(b=>(b==null?void 0:b.linkedDebtId)===R.id&&(b==null?void 0:b.status)==="pending"?{...b,status:"completed",confirmedAt:new Date}:b))}}catch(m){console.warn("فشل تحديث حالة المعاملات المرتبطة محلياً بعد سداد الدين:",m)}Va(!1),p({title:"تم تحديث حالة الدين",description:"تم تعيين الدين كمدفوع"})}},className:"bg-green-500 hover:bg-green-600",children:"مدفوع"}),e.jsx(I,{onClick:async()=>{if(R){const a=Pe.filter(s=>s.id!==R.id);Ut(a),await Ia(a),Va(!1),p({title:"تم حذف الدين",description:"تم حذف الدين بنجاح"})}},variant:"destructive",children:"حذف"})]})]})}),e.jsx(fe,{open:Vf,onOpenChange:a=>{Mn(a),a||kr("")},children:e.jsxs(ge,{className:"w-[95vw] sm:max-w-[425px] rounded-2xl",children:[e.jsxs(pe,{children:[e.jsx(xe,{className:"text-right",children:"دفع جزء من الدين"}),e.jsx(rt,{className:"text-right",children:"أدخل المبلغ الذي تريد دفعه من هذا الدين ثم اضغط دفع."})]}),R&&e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"اسم المديون:"}),e.jsx("span",{children:R.debtorName})]}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"المبلغ الكلي:"}),e.jsxs("span",{children:[R.amount," جنيه"]})]}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"إجمالي المدفوع:"}),e.jsxs("span",{className:"text-green-700",children:[Number(R.paidAmount||0)," جنيه"]})]}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"المبلغ المتبقي:"}),e.jsxs("span",{className:"font-semibold",children:[Math.max(0,Number(R.amount||0)-Number(R.paidAmount||0))," ","جنيه"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"partialAmountDialog",className:"text-right block",children:"المبلغ المراد دفعه"}),e.jsx(J,{id:"partialAmountDialog",type:"number",value:pd,onChange:a=>kr(a.target.value),className:"text-right",placeholder:"أدخل المبلغ"})]})]}),e.jsxs(Oe,{className:"flex gap-2 justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>{Mn(!1),kr("")},children:"إلغاء"}),e.jsx(I,{className:"bg-blue-600 hover:bg-blue-700",onClick:async()=>{const a=parseFloat(pd);if(!R||isNaN(a)||a<=0){p({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const s=Math.max(0,Number(R.amount||0)-Number(R.paidAmount||0)),i=a>s;let l;if(i){const m=Number((a-s).toFixed(2)),g=(R.type||"creditor")==="debtor"?"creditor":"debtor";l={...R,type:g,amount:m,paidAmount:0,status:"pending",partialPayments:[]},p({title:"تم تحويل الدين",description:`تم سداد الدين وتحويل المتبقي (${m} جنيه) إلى ${g==="debtor"?'"علينا"':'"لينا"'}`})}else{const m=Number(((R.paidAmount||0)+a).toFixed(2)),g=Number(R.amount||0)-m<.01;l={...R,amount:Number(R.amount||0),paidAmount:m,status:g?"paid":"pending",partialPayments:[...R.partialPayments||[],{amount:a,paidAt:new Date}]}}const d=Pe.map(m=>m.id===R.id?l:m);Ut(d),Dr(l),await Ia(d);try{if(t!=null&&t.uid){const m=Math.max(0,Number(l.amount||0)-Number(l.paidAmount||0)),f=i?`تم سداد الدين بالكامل للعميل ${l.debtorName} وتحويل المتبقي (${l.amount} جنيه) إلى ${l.type==="debtor"?'"علينا"':'"لينا"'}`:`تم سداد جزء من دين ${l.debtorName}: المدفوع ${a} جنيه، المتبقي ${m} جنيه`;await fs.send(t.uid,f)}}catch{}try{(l.status==="paid"||i)&&(t!=null&&t.uid)&&(async()=>{const m=Te(de($,"userTransactions"),K("userId","==",t.uid),K("linkedDebtId","==",R.id),K("status","==","pending")),f=await De(m);await Promise.allSettled(f.docs.map(w=>ta(w.ref,{status:"completed",confirmedAt:new Date})));try{const w=f.docs.map(C=>{var k;return String(((k=C.data())==null?void 0:k.transactionId)||"")});t!=null&&t.uid&&w.forEach(C=>C&&oe.removeLocalReceiptById(t.uid,C))}catch{}const g=Te(de($,"transactions"),K("userId","==",t.uid),K("linkedDebtId","==",R.id),K("status","==","pending")),v=await De(g);await Promise.allSettled(v.docs.map(w=>ta(w.ref,{status:"completed",confirmedAt:new Date})));try{const w=v.docs.map(C=>{var k;return String(C.id||((k=C.data())==null?void 0:k.transactionId)||"")});t!=null&&t.uid&&w.forEach(C=>C&&oe.removeLocalReceiptById(t.uid,C))}catch{}const y=Te(de($,"transactions"),K("merchantUserId","==",t.uid),K("linkedDebtId","==",R.id),K("status","==","pending")),b=await De(y);await Promise.allSettled(b.docs.map(w=>ta(w.ref,{status:"completed",confirmedAt:new Date})));try{const w=b.docs.map(C=>{var k;return String(C.id||((k=C.data())==null?void 0:k.transactionId)||"")});t!=null&&t.uid&&w.forEach(C=>C&&oe.removeLocalReceiptById(t.uid,C))}catch{}})().catch(m=>{console.error("تعذر تحديث حالة المعاملات المرتبطة بالدين:",m),p({title:"فشل تحديث حالة المعاملة",description:"تعذر تحديث حالة المعاملات المرتبطة بالدين",variant:"destructive"})})}catch(m){console.error("تعذر تجهيز تحديث حالة المعاملات المرتبطة:",m)}if(l.status==="paid")try{const m=Zo(),f=localStorage.getItem(m);if(f){const v=(JSON.parse(f)||[]).map(y=>(y==null?void 0:y.linkedDebtId)===R.id&&(y==null?void 0:y.status)==="pending"?{...y,status:"completed",confirmedAt:new Date}:y);localStorage.setItem(m,JSON.stringify(v)),$t(y=>y.map(b=>(b==null?void 0:b.linkedDebtId)===R.id&&(b==null?void 0:b.status)==="pending"?{...b,status:"completed",confirmedAt:new Date}:b))}}catch(m){console.warn("فشل تحديث حالة المعاملات المرتبطة محلياً بعد سداد الدين:",m)}Un(a),qa("none"),Rs(!0),Mn(!1),kr(""),p({title:"تم تسجيل دفع جزء",description:`تم دفع ${a} جنيه بتاريخ ${new Date().toLocaleString("ar-EG")}`})},children:"دفع"})]})]})}),e.jsx(fe,{open:$f,onOpenChange:En,children:e.jsxs(ge,{className:"sm:max-w-md rounded-2xl shadow-elegant border border-gray-200",children:[e.jsxs(pe,{children:[e.jsx(xe,{className:`text-right ${ya==="decrease"?"text-red-600":"text-green-600"}`,children:ya==="increase"?"كتابة بيانات الاضافة":ya==="decrease"?"إنقاص مبلغ الدين":"تعديل مبلغ الدين"}),e.jsx(rt,{className:"text-right",children:ya==="increase"?"أدخل مبلغ الإضافة وملاحظات الاضافة ثم اضغط تأكيد.":`أدخل المبلغ ثم اضغط تأكيد لإتمام ${ya==="decrease"?"الإنقاص":"التعديل"}.`})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsx(H,{htmlFor:"debtAdjustAmount",className:"text-right",children:ya==="increase"?"مبلغ الإضافة (جنيه)":"المبلغ (جنيه)"}),e.jsx(J,{id:"debtAdjustAmount",type:"number",placeholder:"0.00",value:md,onChange:a=>hd(a.target.value)}),ya==="increase"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{htmlFor:"debtAdditionNote",className:"text-right",children:"ملاحظات الإضافة (اختياري)"}),e.jsx(J,{id:"debtAdditionNote",placeholder:"اكتب ملاحظات عن سبب الإضافة",value:fd,onChange:a=>On(a.target.value)})]}),R&&e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:["المبلغ الحالي: ",e.jsx("span",{className:"font-semibold",children:Number(R.amount||0).toFixed(2)})," جنيه"]})]}),e.jsxs(Oe,{className:"flex gap-2",children:[e.jsx(I,{variant:"secondary",onClick:()=>{En(!1),Va(!0),On("")},children:"إلغاء"}),e.jsx(I,{className:ya==="decrease"?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700",onClick:async()=>{try{if(!R||!ya)return;const a=Number(parseFloat(md||"0").toFixed(2));if(!a||isNaN(a)||a<=0){p({title:"قيمة غير صالحة",description:"يرجى إدخال مبلغ أكبر من صفر",variant:"destructive"});return}Ir(null),gd({debtId:R.id,delta:a,type:ya}),En(!1),Os(!0)}catch(a){console.error("فشل تجهيز تعديل مبلغ الدين:",a),p({title:"خطأ",description:"تعذّر تجهيز تعديل مبلغ الدين",variant:"destructive"})}},children:"تأكيد"})]})]})}),e.jsx(fe,{open:e0,onOpenChange:Rs,children:e.jsxs(ge,{className:"sm:max-w-[480px]",children:[e.jsxs(pe,{children:[e.jsx(xe,{className:"text-right",children:"اختيار مكان إضافة مبلغ السداد"}),e.jsx(rt,{className:"text-right",children:"هل تريد إضافة مبلغ السداد إلى الفلوس النقدية أم إلى إحدى المحافظ؟"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsx(I,{variant:Et==="cash"?"default":"outline",className:Et==="cash"?"bg-blue-600 text-white":"",size:"sm",onClick:()=>qa("cash"),children:"الفلوس النقدية"}),e.jsx(I,{variant:Et==="wallet"?"default":"outline",className:Et==="wallet"?"bg-blue-600 text-white":"",size:"sm",onClick:()=>qa("wallet"),children:"أرصدة المحافظ"}),e.jsx(I,{variant:Et==="fawry"?"default":"outline",className:Et==="fawry"?"bg-amber-600 text-white":"",size:"sm",onClick:()=>qa("fawry"),children:"فوري"}),e.jsx(I,{variant:Et==="none"?"default":"outline",className:Et==="none"?"bg-gray-600 text-white":"",size:"sm",onClick:()=>qa("none"),children:"بدون إضافة"})]}),Et==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-right",children:"اختر المحفظة للإضافة"}),e.jsxs("select",{className:"w-full border rounded p-2 text-right",value:za,onChange:a=>Fo(a.target.value),children:[e.jsx("option",{value:"",children:"— اختر محفظة —"}),M&&M.length>0?M.map(a=>e.jsx("option",{value:a.id,children:a.phone||a.name||a.id},a.id)):Object.keys(Ne||{}).map(a=>{var s,i,l,d;return e.jsx("option",{value:a,children:((s=M.find(m=>m.id===a))==null?void 0:s.phone)||((i=Fs==null?void 0:Fs.find(m=>m.id===a))==null?void 0:i.phone)||((l=Fs==null?void 0:Fs.find(m=>m.id===a))==null?void 0:l.name)||((d=M.find(m=>m.id===a))==null?void 0:d.name)||a},a)})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:["المبلغ المراد إضافته: ",e.jsxs("span",{className:"font-bold",children:[Cd," جنيه"]})]})]}),e.jsxs(Oe,{className:"flex flex-wrap justify-between gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{Rs(!1),Un(0),qa(null),Fo("")},children:"إلغاء"}),e.jsx(I,{disabled:lc,onClick:async()=>{var s,i;if(lc)return;const a=Cd;if(!a||a<=0){Rs(!1);return}if(!Et){p({title:"اختر مصدر الإضافة",description:"يرجى اختيار إضافة المبلغ إلى النقدية أو المحفظة",variant:"destructive"});return}if(Et==="wallet"&&!za){p({title:"اختر محفظة أولاً",description:"يرجى اختيار المحفظة لإضافة مبلغ السداد إليها",variant:"destructive"});return}cc(!0),Rs(!1);try{const l=async(d,m)=>{if(t!=null&&t.uid&&R)try{const g={transactionId:Ae(de($,"dummy_collection")).id,amount:a,transactionType:"cash_addition",type:"cash_addition",status:"completed",createdAt:new Date,senderName:R.debtorName,receiverName:"المحل",description:`سداد دين من العميل ${R.debtorName}`,paymentMethod:d,walletId:m||null,linkedDebtId:R.id,isDebtRepayment:!0};await oe.saveUserTransaction(t.uid,g);try{O.invalidateQueries({queryKey:["recentTransactions",t==null?void 0:t.uid]})}catch{}}catch(f){console.error("Failed to create repayment receipt:",f)}};if(Et==="cash"){const d=$e+a;Xe(d),localStorage.setItem(qe(),d.toString());const m={cashBalance:d,lastUpdated:new Date().toISOString()},f=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(f,JSON.stringify(m)),t!=null&&t.uid?(oe.updateUserData(t.uid,m).catch(()=>ye(!0)),localStorage.removeItem(f),ye(!1)):ye(!0),p({title:"تم إضافة مبلغ السداد",description:`تم إضافة ${a} جنيه إلى الفلوس النقدية`}),await l("cash")}else if(Et==="wallet"){const d={...Ne,[za]:(Ne[za]||0)+a};lt(d);const m=new Date().toISOString(),f={walletBalances:d,lastUpdated:m},g=`userData_${t==null?void 0:t.uid}`;if(localStorage.setItem(g,JSON.stringify(f)),localStorage.setItem(Ze(),JSON.stringify(d)),localStorage.setItem(`walletBalances_backup_${m}`,JSON.stringify(d)),t!=null&&t.uid){oe.updateUserData(t.uid,f).catch(()=>ye(!0));try{localStorage.removeItem(g)}catch{}ye(!1)}else ye(!0);p({title:"تم إضافة مبلغ السداد",description:`تم إضافة ${a} جنيه إلى المحفظة ${((s=M.find(v=>v.id===za))==null?void 0:s.phone)||((i=M.find(v=>v.id===za))==null?void 0:i.name)||za}`}),await l("wallet",za)}else Et==="none"?p({title:"تم تسجيل السداد",description:`تم تسجيل ${a} جنيه بدون تعديل الأرصدة`}):Et==="fawry"&&(p({title:"تم تسجيل سداد عبر فوري",description:`تم تسجيل ${a} جنيه كسداد عبر فوري بدون تعديل الأرصدة`}),await l("fawry"));try{if(t!=null&&t.uid&&R){const d=Number(R.amount||0),m=Number(R.paidAmount||0),f=R.status==="paid"||m>=d,g=a>0?a:m||d,v=f?`تم سداد الدين بالكامل للعميل ${R.debtorName}: المدفوع ${m||g} جنيه`:`تم تسجيل سداد ${g} جنيه من دين العميل ${R.debtorName}`;await fs.send(t.uid,v)}}catch{}}catch(l){console.error("خطأ أثناء إضافة مبلغ السداد:",l),p({title:"حدث خطأ",description:"تعذر إضافة مبلغ السداد، حاول مرة أخرى",variant:"destructive"})}finally{cc(!1),Un(0),qa(null),Fo("");try{os(!0)}catch{}}},className:"bg-green-600 hover:bg-green-700",children:"تأكيد الإضافة"})]})]})}),e.jsx(fe,{open:gf,onOpenChange:ia,children:e.jsxs(ge,{hideClose:!0,className:"post-confirm-card sm:max-w-[420px] w-[90vw] rounded-2xl bg-gradient-to-br from-white via-indigo-50 to-blue-50 shadow-2xl border border-indigo-100",children:[e.jsxs(pe,{children:[e.jsx(xe,{className:"text-right text-2xl font-bold",children:(He==null?void 0:He.type)==="transfer"?"مبلغ يجب استلامه":"مبلغ يجب تسليمه"}),e.jsx(rt,{className:"text-right text-gray-600",children:(He==null?void 0:He.type)==="transfer"?"هذا هو المبلغ الواجب استلامه من العميل بعد التأكيد.":"هذا هو المبلغ الواجب تسليمه للعميل بعد التأكيد."})]}),e.jsxs("div",{className:"py-3 flex flex-col items-center gap-1.5",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-blue-700 tracking-wide",children:[Rt((He==null?void 0:He.amount)||0)," جنيه"]}),e.jsx("div",{className:"text-sm text-gray-500 text-right w-full",children:(He==null?void 0:He.type)==="transfer"?"المبلغ المعروض شامل عمولة التحويل.":He!=null&&He.isDeduct||!Je?"العمولة مخصومة من المبلغ المسلّم للعميل.":"العمولة مضافة ولا تؤثر على قيمة التسليم."})]}),e.jsxs(Oe,{className:"flex justify-end gap-2",children:[(He==null?void 0:He.type)==="transfer"&&e.jsx(I,{variant:"default",id:"sendCodeBtn",onClick:bh,disabled:Hc,className:"btn-transfer-confirm bg-blue-600 hover:bg-blue-700 text-white border-0",children:Hc?"جارٍ الإرسال...":"إرسال كود التحويل"}),e.jsx(I,{onClick:()=>{ia(!1),xo(null)},className:"bg-green-600 hover:bg-green-700 text-white",children:(He==null?void 0:He.type)==="transfer"?"تم الاستلام":"تم التسليم"})]}),(He==null?void 0:He.type)==="transfer"&&e.jsx("div",{className:"mt-4 border-t pt-4 w-full",children:e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(I,{variant:Bt===0?"default":"outline",size:"sm",onClick:()=>Li(0),className:`flex-1 h-10 ${Bt===0?"bg-blue-600 hover:bg-blue-700 text-white":"border-blue-200 text-blue-700 hover:bg-blue-50"}`,children:"SIM 1"}),e.jsx(I,{variant:Bt===1?"default":"outline",size:"sm",onClick:()=>Li(1),className:`flex-1 h-10 ${Bt===1?"bg-blue-600 hover:bg-blue-700 text-white":"border-blue-200 text-blue-700 hover:bg-blue-50"}`,children:"SIM 2"})]})})]})}),e.jsx(Lg,{open:xf,onClose:()=>Ca(!1),onSubmit:vh,deviceId:yo||ts||"",recipientMsisdn:String(F==="transfer"?(ut==null?void 0:ut.receiver)||jt||"":((fu=M.find(a=>a.id===W))==null?void 0:fu.phone)||"").replace(/\D/g,"")}),e.jsx(vv,{isOpen:yf,onClose:()=>Qc(!1),senderPhone:((gu=M.find(a=>a.id===W))==null?void 0:gu.phone)||"",receiverPhone:(ut==null?void 0:ut.receiver)||"",amount:Number((ut==null?void 0:ut.amount)||0),deviceId:yo||ts||"",api:window.electronAPI}),e.jsx(Bv,{isOpen:Xh,onClose:()=>uo(!1),wallets:M,walletBalances:Ne,userId:t==null?void 0:t.uid,onSelectWallet:a=>{sr(a);const s=M.find(i=>i.id===a);if(s){Ds(s.phone);try{localStorage.setItem(ds(),a)}catch{}}uo(!1)},selectedWalletId:W||void 0}),e.jsx(Vv,{open:Da,onOpenChange:nn}),e.jsx(wv,{open:eh,onOpenChange:tr}),!1,re&&e.jsx("div",{className:"fixed inset-0 z-[100] bg-white dark:bg-slate-950 overflow-y-auto",children:e.jsx(Fg,{onBack:()=>U(!1)})}),e.jsx(fe,{open:oo,onOpenChange:lo,children:e.jsxs(ge,{className:"sm:max-w-md",dir:"rtl",children:[e.jsxs(pe,{children:[e.jsx(xe,{children:"تقاريرك"}),e.jsx(rt,{children:"اختر نوع التقرير ثم حدّد الشهر أو اليوم"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs($g,{value:jn,onValueChange:a=>qh(a),children:[e.jsxs(Ug,{className:"grid grid-cols-2 w-full",children:[e.jsx(_u,{value:"monthly",children:"تقارير شهر"}),e.jsx(_u,{value:"daily",children:"تقارير يوم"})]}),e.jsx(Au,{value:"monthly",className:"mt-3",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(H,{className:"text-right",children:"الشهر"}),e.jsxs(Lu,{children:[e.jsx(Fu,{asChild:!0,children:e.jsxs(I,{variant:"outline",className:Za("w-full justify-start text-left font-normal",!Ua&&"text-muted-foreground"),children:[e.jsx(yi,{className:"mr-2 h-4 w-4"}),Ua?ma(new Date(`${Ua}-01`),"LLLL yyyy",{locale:zu}):e.jsx("span",{children:"اختر شهر"})]})}),e.jsx(Cl,{className:"w-auto p-0",align:"start",children:e.jsx(Al,{mode:"single",selected:Ua?new Date(`${Ua}-01`):void 0,onSelect:a=>zh(a?ma(a,"yyyy-MM"):""),initialFocus:!0})})]})]})}),e.jsx(Au,{value:"daily",className:"mt-3",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(H,{className:"text-right",children:"التاريخ"}),e.jsxs(Lu,{children:[e.jsx(Fu,{asChild:!0,children:e.jsxs(I,{variant:"outline",className:Za("w-full justify-start text-left font-normal",!$a&&"text-muted-foreground"),children:[e.jsx(yi,{className:"mr-2 h-4 w-4"}),$a?ma(new Date($a),"PPP",{locale:zu}):e.jsx("span",{children:"اختر تاريخ"})]})}),e.jsx(Cl,{className:"w-auto p-0",align:"start",children:e.jsx(Al,{mode:"single",selected:$a?new Date($a):void 0,onSelect:a=>Vh(a?ma(a,"yyyy-MM-dd"):""),initialFocus:!0})})]})]})})]}),_s&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-3 rounded-lg border border-blue-100 dark:border-blue-900/30",children:[e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"عدد المعاملات"}),e.jsx("div",{className:"text-lg font-bold text-blue-800 dark:text-blue-200",children:_s.count})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"إجمالي المبالغ"}),e.jsx("div",{className:"text-lg font-bold text-gray-800 dark:text-gray-200",children:_s.totalAmount.toFixed(2)})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-950/20 p-3 rounded-lg border border-red-100 dark:border-red-900/30",children:[e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 mb-1",children:"المسحوب"}),e.jsx("div",{className:"text-lg font-bold text-red-800 dark:text-red-200",children:_s.totalWithdrawn.toFixed(2)})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-950/20 p-3 rounded-lg border border-green-100 dark:border-green-900/30",children:[e.jsx("div",{className:"text-xs text-green-600 dark:text-green-400 mb-1",children:"المرسل"}),e.jsx("div",{className:"text-lg font-bold text-green-800 dark:text-green-200",children:_s.totalSent.toFixed(2)})]}),e.jsx("div",{className:"col-span-2 bg-yellow-50 dark:bg-yellow-950/20 p-3 rounded-lg border border-yellow-100 dark:border-yellow-900/30",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:"الأرباح"}),e.jsx("div",{className:"text-lg font-bold text-yellow-800 dark:text-yellow-200",children:_s.totalProfit.toFixed(2)})]})})]})]})]})}),e.jsx(fv,{isOpen:we,onClose:()=>Z(!1),userId:(t==null?void 0:t.uid)||"",wallets:M,walletBalances:Ne}),e.jsx(fe,{open:te,onOpenChange:ve,children:e.jsxs(ge,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(pe,{children:e.jsxs(xe,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(ku,{className:"h-5 w-5"}),"تم رفض الوصول"]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-4 space-y-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx(ku,{className:"h-6 w-6 text-red-600"})}),e.jsxs("p",{className:"text-center text-gray-600",children:["عفواً، لا تملك صلاحية للوصول إلى هذا القسم.",e.jsx("br",{}),"تم تعطيل هذه الصلاحية من قبل مالك الحساب."]})]}),e.jsx(Oe,{className:"sm:justify-center",children:e.jsx(I,{variant:"outline",onClick:()=>ve(!1),className:"w-full sm:w-auto",children:"حسناً"})})]})})]}))},$w=Object.freeze(Object.defineProperty({__proto__:null,default:zv},Symbol.toStringTag,{value:"Module"}));export{Al as C,om as P,$w as U,va as a,Hs as b,wa as c,Nm as d,Lu as e,Fu as f,ma as g,Cl as h};
//# sourceMappingURL=UserDashboardPage-CbB8-8_Z.js.map
