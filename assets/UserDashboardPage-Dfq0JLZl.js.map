{"version":3,"mappings":"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","names":["__iconNode","Banknote","createLucideIcon","CalendarDays","CirclePlus","Notebook","Send","isValidId","id","walletLimitsService","now","walletId","limitsRef","doc","db","limitsSnap","getDoc","data","Timestamp","newUsage","setDoc","serverTimestamp","_a","auth","error","lastReset","currentDay","lastResetDate","currentMonth","currentYear","usage","_b","txQuery","query","collection","where","txSnap","getDocs","used_transfer","used_withdraw","tx","calculatedUsage","amount","type","remaining","currentUsage","canPerform","newUsedTransfer","newUsedWithdraw","ref","updatedUsage","resetUsage","merchantUserId","usagePromises","merchantWalletService","wallet","useReadIdsKey","userId","NotificationBell","className","user","profile","isSubscriptionActive","useFirebaseAuth","location","useLocation","notifications","setNotifications","useState","readIds","setReadIds","queueOpen","setQueueOpen","queueReason","setQueueReason","queueSubmitting","setQueueSubmitting","queueMessage","setQueueMessage","queueLatestStatus","setQueueLatestStatus","flyAlert","setFlyAlert","flyVisible","setFlyVisible","prevIdsRef","useRef","isFirstFetchRef","flyTimerRef","triggerRef","flyNodeRef","flyStyle","setFlyStyle","audienceKeys","useMemo","keys","storageKey","canShowNotifications","onPendingApprovalPage","useEffect","raw","arr","e","fetchNotifications","subscribeToActiveBroadcastsList","list","freshThreshold","oldIds","n","createdAt","handleOneSignalNotification","event","notif","instantBroadcast","OneSignal","ids","newItems","unreadCount","acc","markAsRead","next","markAllAsRead","openLink","url","isAndroid","Capacitor","isApk","deeplink","updateFlyPosition","rect","margin","width","top","left","viewportWidth","prev","handler","q","docs","d","a","b","ta","_c","_e","_d","_f","latest","contacted","jsxs","DropdownMenu","open","jsx","DropdownMenuTrigger","Button","Bell","DropdownMenuContent","DropdownMenuLabel","CheckCircle","DropdownMenuSeparator","isUnread","ExternalLink","createPortal","FawryMachineIcon","size","props","useDebouncedValue","value","delay","debounced","setDebounced","React","MonthlyProfitDisplayDialog","transactions","isOpen","setIsOpen","isMasterPinDialogOpen","setIsMasterPinDialogOpen","isAuthenticated","setIsAuthenticated","profitData","setProfitData","userSubscription","loadProfitData","today","visibleMonthly","reportsService","monthlyWithdrawProfit","monthlyTransferProfit","txDate","status","t","txForCalc","ProfitService","profits","formatCurrency","isZeroPlan","localSub","rawLocal","planLocalStr","SubscriptionPlan","remoteSub","getUserSubscription","rawRemote","planRemoteStr","handleEyeClick","toast","handlePinSuccess","Fragment","Eye","Dialog","DialogContent","DialogHeader","DialogTitle","Calendar","ArrowDownLeft","ArrowRightLeft","DollarSign","MasterPinDialog","MonthlyProfitEyeButton","ProfitPinDialog","onOpenChange","onSuccess","pin","setPin","confirmPin","setConfirmPin","showPin","setShowPin","showConfirmPin","setShowConfirmPin","setError","isLoading","setIsLoading","hasExistingPin","setHasExistingPin","useToast","mounted","has","MasterPinService","handleClose","handleSubmit","Lock","Label","Input","EyeOff","AlertCircle","DailyProfitDisplayDialog","isPinDialogOpen","setIsPinDialogOpen","visibleDaily","dailyWithdrawProfit","dailyTransferProfit","title","DailyProfitEyeButton","WalletCashService","operation","currentCashBalance","currentWalletBalances","wallets","selectedWalletId","limitCheck","walletDailyLimitsService","available","target","w","totalAvailable","newWalletBalances","currentBalance","remainingAmount","deductAmount","newCashBalance","message","afterBalance","totalWalletBalance","defaultWallet","balance","targetWallet","walletBalances","total","result","updateCashBalance","updateWalletBalances","operationType","preview","audioCtx","getAudioContext","AnyWindow","Ctx","scheduleNoiseBurst","ctx","startTime","durationMs","durationSec","bufferSize","buffer","i","source","filter","gain","scheduleToneSweep","startFreq","endFreq","osc","playVodafoneShakshan","strictValidateMsisdn","msisdn","normalized","match","BranchRequestDialog","m","WalletManagement","__vitePreload","TransactionDetailsModal","ReceiptModal","EditBalanceDialog","ChangePinDialog","ChangeCashPinDialog","ChangeWalletTotalPinDialog","PasswordConfirmDialog","AddToWalletDialog","CalculatorDialog","SalesDataDialog","CashSummaryDialog","CreditCardsDialog","InstallmentModal","MaintenanceDialog","MachineDailyDialog","WalletsManagement","WalletsListDialog","WalletPrinterDialog","CashierShiftModal","ShiftProfileDialog","ChangeLogDialog","GoogleBackupBar","loading","setLoading","setMessage","UserDashboardPage","signOut","isVodafoneCashUser","navigate","useNavigate","params","useParams","isShiftActive","shiftUser","useShift","shopIdCtx","shopName","useShop","queryClientHook","useQueryClient","isMobile","useIsMobile","formRef","formTranslateY","setFormTranslateY","isProfileSettingsOpen","setIsProfileSettingsOpen","isWalletPrinterDialogOpen","setIsWalletPrinterDialogOpen","setWallets","anyWalletKey","k","savedWalletsStr","parsedWallets","submitTopUp","allowedEmail","userEmail","topupPhone","topupOperator","topupAmount","setTopupLoading","idToken","resp","setIsTopUpOpen","setTopupPhone","setTopupOperator","setTopupAmount","err","isCashierModalOpen","setIsCashierModalOpen","isShiftProfileOpen","setIsShiftProfileOpen","isChangeLogOpen","setIsChangeLogOpen","isDeveloperInfoOpen","setIsDeveloperInfoOpen","branchDialogOpen","setBranchDialogOpen","branchRequestOpen","setBranchRequestOpen","branches","setBranches","managerNameInput","setManagerNameInput","branchNameInput","setBranchNameInput","branchEmailInput","setBranchEmailInput","loginPasswordInput","setLoginPasswordInput","branchLoading","setBranchLoading","branchLoginOpen","setBranchLoginOpen","branchLoginTarget","setBranchLoginTarget","branchLoginUsername","setBranchLoginUsername","branchLoginPassword","setBranchLoginPassword","branchAuthLoading","setBranchAuthLoading","branchDetailsOpen","setBranchDetailsOpen","branchDetailsLoading","setBranchDetailsLoading","selectedBranchDetails","setSelectedBranchDetails","showAddBranchForm","setShowAddBranchForm","branchesLoaded","setBranchesLoaded","appDownloads","setAppDownloads","getAppDownloads","runtimeDesktopVersion","setRuntimeDesktopVersion","api","v","appVersion","localVersion","isElectronEnv","subBranches","rootBranches","branchesRef","qRoot","fsQuery","allBranches","uniqueBranchesMap","item","key","uniqueBranches","branchEditOpen","setBranchEditOpen","selectedBranchToEdit","setSelectedBranchToEdit","editBranchName","setEditBranchName","editManagerName","setEditManagerName","editBranchEmail","setEditBranchEmail","editBranchLoading","setEditBranchLoading","openEditBranchDialog","branch","handleUpdateBranch","updates","updateDoc","fetchBranchDetails","uid","resolve","userDocSnap","walletsSnap","debtsSnap","salesSnap","qMerchant","snapMerchant","snapSub","s","userData","cashBalance","reportsData","reportsDailyProfit","reportsMonthlyProfit","walletBalancesMap","walletsTotal","sum","val","debtsTotal","paid","outstanding","todayStr","monthStr","todaySales","monthSales","todayProfit","monthProfit","totalSalesSection","date","profit","selectedWallet","setSelectedWallet","sid","adbDevices","setAdbDevices","selectedAdbDeviceId","setSelectedAdbDeviceId","Preferences","isDeviceConnected","ensureDeviceReadyBeforeSend","sel","usb","ip","res","r","base","wifiCandidate","wifiIp","devices","saved","sendTransfer","receiverPhone","sw","getSelectedWalletObj","senderPhone","sendTransferFromWalletDeepLink","setIsPostConfirmPopupOpen","setIsPinModalOpen","msg","selectedSimSlotForTransfer","setSelectedSimSlotForTransfer","triggerSendTransferCode","lastUSSDTransfer","receiver","setUssdLoading","code","getUssdCodeBySender","openUssdDeepLink","readyId","decoratedId","pick","setLastDecoratedDeviceId","e2","maybeIp","lastDecoratedDeviceId","handlePinSubmit","deviceId","rawLink","devId","receiverDigits","amountInt","pinDigits","baseUrl","u","isUserActive","setIsUserActive","isCheckingActivation","setIsCheckingActivation","isShopExpensesDialogOpen","setIsShopExpensesDialogOpen","isShopExpensesPinDialogOpen","setIsShopExpensesPinDialogOpen","expenseName","setExpenseName","expenseAmount","setExpenseAmount","expenseNotes","setExpenseNotes","expenses","setExpenses","isExpenseDeductionChoiceOpen","setIsExpenseDeductionChoiceOpen","expenseDeductionSource","setExpenseDeductionSource","selectedWalletForExpense","setSelectedWalletForExpense","isReceiptsOpen","setIsReceiptsOpen","isReceiptsDialogOpen","setIsReceiptsDialogOpen","showActivationModal","setShowActivationModal","isDeficienciesDialogOpen","setIsDeficienciesDialogOpen","deficiencyName","setDeficiencyName","deficiencyQuantity","setDeficiencyQuantity","deficiencies","setDeficiencies","isOnFreeTrial","setIsOnFreeTrial","freeTrialHoursRemaining","setFreeTrialHoursRemaining","hasUsedFreeTrial","setHasUsedFreeTrial","setUserSubscription","branchPackage","setBranchPackage","isRefreshingSubscription","setIsRefreshingSubscription","setSenderPhone","setReceiverPhone","setAmount","withdrawNote","setWithdrawNote","withdrawSenderName","setWithdrawSenderName","isQuickDebtOpen","setIsQuickDebtOpen","quickDebtName","setQuickDebtName","quickDebtAmount","setQuickDebtAmount","quickDebtNotes","setQuickDebtNotes","quickDebtCustomerId","setQuickDebtCustomerId","quickDebtInfo","setQuickDebtInfo","didCreateQuickDebt","setDidCreateQuickDebt","isWalletsDialogOpen","setIsWalletsDialogOpen","isWalletsPinDialogOpen","setIsWalletsPinDialogOpen","isWalletSelectionPinDialogOpen","setIsWalletSelectionPinDialogOpen","pendingSelectedWalletId","setPendingSelectedWalletId","manualCommission","setManualCommission","transferCommission","setTransferCommission","transferExtraFee","setTransferExtraFee","isMonthlyLimitWarnOpen","setIsMonthlyLimitWarnOpen","selectedQuickIcon","setSelectedQuickIcon","monthlyLimitWarnData","setMonthlyLimitWarnData","isWithdrawSenderNameInputEnabled","setIsWithdrawSenderNameInputEnabled","withRetry","userDataService","remote","normalizeDigits","arabicIndic","easternIndic","ch","ai","ei","isCommissionAddMode","setIsCommissionAddMode","transactionType","setTransactionType","setTransactions","activeTab","setActiveTab","debts","setDebts","localTransactionsBuffer","recentTransactionsQuery","useQuery","orderBy","limit","collection2","query2","where2","orderBy2","limit2","getDocs2","db2","filtered","created","rawType","deletedIds","deletedTransactions","dt","active","getKey","seen","distinct","handleTransactionCreated","activeBuffer","bt","existsById","existsByRef","isOld","merged","completedDebtIds","updated","amt","saveDebtsToStorage","dp","telegramNotifier","userVal","globalVal","defVal","isSalesDataOpen","setIsSalesDataOpen","pendingBarcode","setPendingBarcode","barcodeBufferRef","lastKeyTimeRef","tag","isWalletManagementOpen","setIsWalletManagementOpen","isWalletsListOpen","setIsWalletsListOpen","editingWalletForDropdown","setEditingWalletForDropdown","baseAmount","commissionCalc","ratePerThousand","manual","debtAmount","getWalletsKey","candidateId","getSelectedWalletKey","useLayoutEffect","preferredKey","savedSelected","walletToSelect","loadExpensesFromStorage","loadDeficienciesFromStorage","walletsQuery","merchantWalletService2","savedSelectedWallet","obj","handleExternalUpdate","newCash","newWallets","newTransaction","limitUpdate","delta","commission","comm","setCashBalance","change","newVal","cashKey","getCashBalanceKey","localDataKey","existing","setHasLocalDataToSync","setWalletBalances","currentVal","updatedWallets","walletKey","getWalletBalancesKey","setSelectedWalletLimits","isTransfer","newLimits","walletSearch","setWalletSearch","filteredWallets","selectedTransaction","setSelectedTransaction","isTransactionDetailsOpen","setIsTransactionDetailsOpen","isReceiptOpen","setIsReceiptOpen","receiptTransaction","setReceiptTransaction","dailyStats","setDailyStats","monthlyStatsArray","setMonthlyStatsArray","isResetDialogOpen","setIsResetDialogOpen","resetType","setResetType","setDeletedTransactions","isRealtimeActive","setIsRealtimeActive","deletedEffectsAppliedRef","transactionsRef","applyLocalDeleteEffects","savedCash","savedWallets","amountVal","timestamp","updateData","opType","handleDeleteReceipt","transactionId","idStr","refStr","alreadyApplied","updatedTransactions","auditLogService","handleCompleteReceipt","plan","dailyOperationCountService","limitErr","originalId","txnId","refId","snap","calculateDailyStats","searchPhone","setSearchPhone","debouncedSearchPhone","selectedDate","setSelectedDate","selectedTime","setSelectedTime","reportSearchPhone","setReportSearchPhone","isTransferSuccess","setIsTransferSuccess","isWithdrawSuccess","setIsWithdrawSuccess","isPostConfirmPopupOpen","postConfirmInfo","setPostConfirmInfo","setLastUSSDTransfer","ussdLoading","isPinModalOpen","isCalculatorOpen","setIsCalculatorOpen","showDesktopQuickIcons","isInstallmentPinOpen","setIsInstallmentPinOpen","isInstallmentModalOpen","setIsInstallmentModalOpen","isCreditCardsOpen","setIsCreditCardsOpen","isMaintenanceOpen","setIsMaintenanceOpen","isMachineDailyDialogOpen","setIsMachineDailyDialogOpen","isMonthlyLocked","setIsMonthlyLocked","areReportsCollapsed","setAreReportsCollapsed","isMonthlyPinDialogOpen","setIsMonthlyPinDialogOpen","isTelegramOpen","setIsTelegramOpen","telegramChatId","setTelegramChatId","telegramDailyEnabled","setTelegramDailyEnabled","isVipOpen","setIsVipOpen","isDailyLocked","setIsDailyLocked","isDailyPinDialogOpen","setIsDailyPinDialogOpen","isDebtsDialogOpen","setIsDebtsDialogOpen","isDebtsPasswordDialogOpen","setIsDebtsPasswordDialogOpen","isDebtsPinRequired","setIsDebtsPinRequired","isDebtsPinToggleOpen","setIsDebtsPinToggleOpen","pendingDebtsPinValue","setPendingDebtsPinValue","debtorName","setDebtorName","setDebtAmount","debtReason","setDebtReason","debtRole","setDebtRole","selectedDebt","setSelectedDebt","isDebtReceiptOpen","setIsDebtReceiptOpen","isDebtAdjustDialogOpen","setIsDebtAdjustDialogOpen","debtAdjustType","setDebtAdjustType","debtAdjustAmount","setDebtAdjustAmount","pendingDebtAdjustment","setPendingDebtAdjustment","isDebtsPinDialogOpen","setIsDebtsPinDialogOpen","isPartialPaymentOpen","setIsPartialPaymentOpen","partialPaymentAmount","setPartialPaymentAmount","isDebtReceiptsListOpen","setIsDebtReceiptsListOpen","debtsPage","setDebtsPage","DEBTS_PAGE_SIZE","visibleDebts","openDebts","hasPin","loadDebtsFromStorage","isAddCustomerDialogOpen","setIsAddCustomerDialogOpen","customers","setCustomers","newCustomerName","setNewCustomerName","newCustomerMobile","setNewCustomerMobile","selectedCustomerId","setSelectedCustomerId","customerDebtAmount","setCustomerDebtAmount","isEditCustomerDialogOpen","setIsEditCustomerDialogOpen","editingCustomerId","setEditingCustomerId","editingCustomerName","setEditingCustomerName","editingCustomerMobile","setEditingCustomerMobile","isDeleteCustomerConfirmOpen","setIsDeleteCustomerConfirmOpen","customerToDeleteId","setCustomerToDeleteId","customerToDeleteName","setCustomerToDeleteName","isDebtDeductionChoiceOpen","setIsDebtDeductionChoiceOpen","pendingDebtToCreate","setPendingDebtToCreate","deductionSource","setDeductionSource","selectedWalletForDeduction","setSelectedWalletForDeduction","isPaymentCreditChoiceOpen","setIsPaymentCreditChoiceOpen","paymentAmountPending","setPaymentAmountPending","paymentCreditSource","setPaymentCreditSource","selectedWalletForPaymentCredit","setSelectedWalletForPaymentCredit","selectedWalletLimits","selectedWalletName","setSelectedWalletName","debtsToSave","serialized","getDebtsKey","getDebtsDefaultKey","getDebtsLastWriteKey","promises","localUserKey","localDefaultKey","localLastWriteKey","localByUser","localByDefault","lastWriteStr","lastWriteMs","parseDebts","listStr","debt","p","localDebts","migrated","debtsUnsyncedKey","hasDebtsUnsynced","collectionDebts","fbDebts","json","msisdns","unsubscribe","onSnapshot","snapshot","isActive","trialValidity","FreeTrialService","isOnTrial","shouldShowModal","fetchSubscriptionData","subscriptionData","isRefreshing","setIsRefreshing","isDatePickerOpen","setIsDatePickerOpen","isEditCashDialogOpen","setIsEditCashDialogOpen","isEditWalletDialogOpen","setIsEditWalletDialogOpen","isAddToWalletDialogOpen","setIsAddToWalletDialogOpen","isResetSelectedWalletDialogOpen","setIsResetSelectedWalletDialogOpen","resetSelectedWalletPinInput","setResetSelectedWalletPinInput","isResetRecentDialogOpen","setIsResetRecentDialogOpen","isCashAmountDialogOpen","setIsCashAmountDialogOpen","cashAmountInput","setCashAmountInput","isTopUpOpen","topupLoading","isYourReportsOpen","setIsYourReportsOpen","isReportsPinOpen","setIsReportsPinOpen","reportArchives","setReportArchives","dailyReportsArchiveService","getCustomersKey","getExpensesKey","parsed","saveExpensesToStorage","permanentlyDeleteExpense","expenseId","deleteDoc","doc2","deleteDoc2","cloudErr","shopId","finalList","timeA","getDeficienciesKey","newKey","oldKey","oldRaw","newRaw","oldList","newList","it","saveDeficienciesToStorage","currentShopId","items","saveCustomersToStorage","loadCustomersFromStorage","userDoc","firebaseCustomers","c","getTransactionsKey","getTransactionKey","createdAtMs","transactionsData","refetchTransactions","cashPinInput","setCashPinInput","editingWalletId","setEditingWalletId","isShiftHandoverAllowed","sub","valid","isSubscriptionValid","rawPlan","planStr","allowedPlan","isTahweelaPlan","handleOpenShiftProfile","isEditCashBalanceOpen","setIsEditCashBalanceOpen","isChangePinDialogOpen","setIsChangePinDialogOpen","isChangeCashPinDialogOpen","setIsChangeCashPinDialogOpen","isChangeWalletTotalPinDialogOpen","setIsChangeWalletTotalPinDialogOpen","isAddCashDialogOpen","setIsAddCashDialogOpen","addCashAmountInput","setAddCashAmountInput","addCashPinInput","setAddCashPinInput","isAddingCash","setIsAddingCash","addCashNoteEnabled","setAddCashNoteEnabled","addCashNoteText","setAddCashNoteText","isCashSummaryOpen","setIsCashSummaryOpen","isCashSummaryPinDialogOpen","setIsCashSummaryPinDialogOpen","isAddWalletTotalDialogOpen","setIsAddWalletTotalDialogOpen","addWalletTotalAmountInput","setAddWalletTotalAmountInput","addWalletTotalPinInput","setAddWalletTotalPinInput","isAddingWalletTotal","setIsAddingWalletTotal","handleNavigation","action","payload","transactionSection","behavior","syncLocalDataWithFirebase","localDataStr","localDebtsStr","localData","localDebtsRaw","toJsDate","normalize","remoteDebtsRaw","remoteDebts","byIdRemote","used","ld","rd","rdPaid","ldPaid","rdStatus","ldStatus","take","recentResetConfig","setRecentResetConfig","keep","interval","last","effectiveTransactions","monthStart","nextMonthStart","hiddenCount","vipTop10","monthEnd","phoneRaw","phone","formatNumberEnglish","toWaNumber","sendVipWhatsApp","num","composeTelegramDailySummary","dateStr","start","end","txToday","totalOps","totalWithdrawn","totalSent","accessoriesSales","cairoDate","byUser","totalDebts","pp","deficienciesText","getFilteredTransactions","phoneQuery","transaction","selectedDateObj","transactionDate","hours","minutes","filterDateTime","nextHour","ad","handleSendTelegramDailyReport","text","canSend","prevAt","isResetWalletTotalDialogOpen","setIsResetWalletTotalDialogOpen","resetWalletTotalPinInput","setResetWalletTotalPinInput","isResetCashDialogOpen","setIsResetCashDialogOpen","resetCashPinInput","setResetCashPinInput","hasLocalDataToSync","isTelegramReportPinOpen","setIsTelegramReportPinOpen","fn","retries","delayMs","lastErr","verifyWalletTotalPin","inputPin","verifyCashDrawerPin","wbKeyNew","wbKeyOld","savedWalletBalances","cbKeyNew","cbKeyOld","legacyKey","savedCashBalance","dashboardData","cb","wbs","serverTime","localCashTime","localTime","getWalletLimitsCacheKey","wid","walletLimitsData","limitsObj","x","refreshSelectedWalletLimits","limits","setWalletSelection","walletSelect","loadWalletsFromFirebase","userDocRef","docSnapshot","handleSubscriptionActivated","handleUserSubscriptionUpdated","handleGlobalShortcuts","remoteBalances","remoteCash","remoteTs","localCashTsStr","localWalletsTsStr","localCashTs","localWalletsTs","firebaseDeletedTransactions","firebaseWallets","formattedWallets","userTransactions","transactionsWithDates","deletedTransactionIds","permanentDeletedKeys","permQ","permSet","activeTransactions","txId","txTxnId","txRef","inDeleted","blockedByPerm","loadUserData","autoMonthlyDbCleanup","autoResetLimits","autoResetReports","dayDate","baseDateStr","dayTransactions","totalTransactions","totalAmount","isWithdrawTx","isSendTx","reportDateStr","resetResult","utDocs","q1","q1fb","gDocs","q2","q2fb","savedWallet","newWalletId","currentPath","handleWindowFocus","handleWalletChange","walletSelectionPinService","handleTransactionTypeChange","onKeyDown","btn","handleTransactionClick","short","handleDeleteTransaction","transactionToDelete","txKey","refKey","saveError","updatedDeletedTransactions","fromWalletId","update","setDoc2","ReportsService","transactionData","errorMessage","xn","dateOverride","sameDay","visibleTransactions","calculateMonthlyStats","monthlyTransactions","visibleMonthlyTransactions","calculateWalletMonthlyUsage","walletTransactions","totalTransferred","calculateWalletDailyUsage","currentMonthlyStats","currentDailyStats","walletMonthlyUsageMemo","walletDailyUsageMemo","cachedLocalWallets","selectedWalletObj","monthlyWithdrawalLimit","monthlyTransferLimit","amountNum","monthlyWithdrawUsed","monthlyTransferUsed","predictedMonthlyWithdrawUsed","predictedMonthlyTransferUsed","percent","withdrawThreshold","transferThreshold","monthKey","warnKeyBase","handleTransaction","setSuccessOptimistic","revertSuccess","yyyy","mm","dd","dailyKey","usedCountRaw","walletUsage","validation","commissionAmount","rate","effectiveAmount","isDeferredTransfer","isDeferredWithdraw","skipProcess","linkedDebtId","sDigits","rDigits","is010To011","extraFee","fullCommission","currentWalletBalance","totalDebit","check","effectiveSelectedWalletId","limitsSrc","pendingToday","dailyLimit","dailyUsed","pendingMonth","monthlyLimit","monthlyUsed","prevBalance","walletObj","previousBalance","newDebt","updatedDebts","debtRef","addToCash","tempTransactionId","transactionDataCreateOptimistic","optimisticTransaction","oldData","updatedTransactionsList","usedCount","effectiveWalletId","remainingWalletBalance","srcPhone","dstPhone","hasFee","mark","commissionPart","feePart","shouldSend","prevMsg","transactionDataCreate","transactionDataForUser","createdTransactionId","transactionService","updatedLimits","realTransaction","amountToReceive","amountToDeliver","dateFormatter","timeFormatter","totalOutstandingDebts","filteredTransactions","handleResetSuccess","hiddenIds","getResetDialogTitle","getResetDialogDescription","handleEditWalletBalance","handleEditCashSuccess","newBalance","ops","receiptRef","txToCloud","dataRef","handleEditWalletBalanceSuccess","updatedBalances","walletName","handleAddToWalletSuccess","addedAmount","operationAmount","backupKeys","LogoLoader","Card","CardHeader","CardTitle","Trash2","ArrowUpDown","CardContent","ChevronDown","ChevronUp","Plus","Wallet","Search","BadgePercent","CreditCard","Calculator","User","BarChart","FileText","Wrench","Receipt","AlertTriangle","isShiftReceipt","isCashAddReceipt","ArrowUpRight","noteText","Check","Clock","X","Code","DialogFooter","Crown","Store","ProfileIcon","RefreshCw","idx","Badge","MessageCircle","Switch","sendTelegramMessage","DialogDescription","Minus","PlusCircle","manager","bname","email","pw","newUserId","shopIdNew","tempAppName","tempApp","initializeApp","firebaseConfig","tempAuth","getAuth","tempDb","getFirestore","createUserWithEmailAndPassword","addDoc","shopError","subError","firebaseSignOut","deleteApp","safeEncode","branchData","fsSetDoc","fsDoc","newBranch","Edit","expectedUser","expectedPw","enc","viewBottom","needed","offset","Printer","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","walletMonthlyUsage","walletDailyUsage","dailyWithdrawalLimit","dailyTransferLimit","dailyWithdrawUsed","dailyTransferUsed","predictedDailyWithdrawUsed","predictedDailyTransferUsed","Phone","dest","amountEl","commissionEl","quickBtn","swInner","commissionPerThousand","debtVal","manualFixed","manualEl","submitBtn","selected","amountToSave","selectedCustomer","currentTotal","walletIds","amountPerWallet","ratio","additionalAmount","amountToAdd","todayTx","st","reportDate","nextVal","resetAt","toDelete","cfg","cleared","newCustomer","totalDebt","customer","name","mobile","ex","current","newExpenseId","addDoc2","serverTimestamp2","newExpense","updatedExpenses","qty","docRef","safeList","exists","optimisticItem","updatedOptimistic","newItem","updateDoc2","isAdjustment","isDecrease","newCashBalanceValue","newWalletBalancesValue","didUpdateCash","didUpdateWallet","finalSelectedDebt","didUpdateDebts","currentAmount","newAmount","becamePaid","q3","snap1","snap2","snap3","batch","writeBatch","batchCount","processSnap","docSnap","txnData","stillPaid","updatePayload","syncPromises","dashPayload","related","principal","totalDue","remainingBefore","newPaidTotal","isFullyPaid","ids2","ids3","localKey","updatedArr","payAmount","computedRemaining","baseAmt","prevPaid","createReceipt","method","sentAmt","PinModal","ProfileSettingsPage"],"ignoreList":[0,1,2,3,4],"sources":["../../node_modules/lucide-react/dist/esm/icons/banknote.js","../../node_modules/lucide-react/dist/esm/icons/calendar-days.js","../../node_modules/lucide-react/dist/esm/icons/circle-plus.js","../../node_modules/lucide-react/dist/esm/icons/notebook.js","../../node_modules/lucide-react/dist/esm/icons/send.js","../../src/utils/walletLimitsService.ts","../../src/components/NotificationBell.tsx","../../src/components/icons/FawryMachineIcon.tsx","../../src/hooks/useDebouncedValue.ts","../../src/components/MonthlyProfitDisplayDialog.tsx","../../src/components/ProfitPinDialog.tsx","../../src/components/DailyProfitDisplayDialog.tsx","../../src/utils/walletCashService.ts","../../src/utils/sound.ts","../../src/utils/walletValidation.ts","../../src/pages/UserDashboardPage.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"rect\", { width: \"20\", height: \"12\", x: \"2\", y: \"6\", rx: \"2\", key: \"9lu3g6\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"2\", key: \"1c9p78\" }],\n  [\"path\", { d: \"M6 12h.01M18 12h.01\", key: \"113zkx\" }]\n];\nconst Banknote = createLucideIcon(\"banknote\", __iconNode);\n\nexport { __iconNode, Banknote as default };\n//# sourceMappingURL=banknote.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M8 2v4\", key: \"1cmpym\" }],\n  [\"path\", { d: \"M16 2v4\", key: \"4m81vk\" }],\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"4\", rx: \"2\", key: \"1hopcy\" }],\n  [\"path\", { d: \"M3 10h18\", key: \"8toen8\" }],\n  [\"path\", { d: \"M8 14h.01\", key: \"6423bh\" }],\n  [\"path\", { d: \"M12 14h.01\", key: \"1etili\" }],\n  [\"path\", { d: \"M16 14h.01\", key: \"1gbofw\" }],\n  [\"path\", { d: \"M8 18h.01\", key: \"lrp35t\" }],\n  [\"path\", { d: \"M12 18h.01\", key: \"mhygvu\" }],\n  [\"path\", { d: \"M16 18h.01\", key: \"kzsmim\" }]\n];\nconst CalendarDays = createLucideIcon(\"calendar-days\", __iconNode);\n\nexport { __iconNode, CalendarDays as default };\n//# sourceMappingURL=calendar-days.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"M8 12h8\", key: \"1wcyev\" }],\n  [\"path\", { d: \"M12 8v8\", key: \"napkw2\" }]\n];\nconst CirclePlus = createLucideIcon(\"circle-plus\", __iconNode);\n\nexport { __iconNode, CirclePlus as default };\n//# sourceMappingURL=circle-plus.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M2 6h4\", key: \"aawbzj\" }],\n  [\"path\", { d: \"M2 10h4\", key: \"l0bgd4\" }],\n  [\"path\", { d: \"M2 14h4\", key: \"1gsvsf\" }],\n  [\"path\", { d: \"M2 18h4\", key: \"1bu2t1\" }],\n  [\"rect\", { width: \"16\", height: \"20\", x: \"4\", y: \"2\", rx: \"2\", key: \"1nb95v\" }],\n  [\"path\", { d: \"M16 2v20\", key: \"rotuqe\" }]\n];\nconst Notebook = createLucideIcon(\"notebook\", __iconNode);\n\nexport { __iconNode, Notebook as default };\n//# sourceMappingURL=notebook.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z\",\n      key: \"1ffxy3\"\n    }\n  ],\n  [\"path\", { d: \"m21.854 2.147-10.94 10.939\", key: \"12cjpa\" }]\n];\nconst Send = createLucideIcon(\"send\", __iconNode);\n\nexport { __iconNode, Send as default };\n//# sourceMappingURL=send.js.map\n","import { merchantWalletService } from '@/integrations/firebase/services';\r\nimport { db, auth } from '@/firebase';\r\nimport { doc, setDoc, getDoc, collection, query, where, getDocs, serverTimestamp, Timestamp } from 'firebase/firestore';\r\n\r\n// Runtime guard to prevent invalid Firestore document paths\r\nconst isValidId = (id: any): id is string => typeof id === 'string' && id.trim().length > 0;\r\n\r\n//    \r\ninterface WalletUsage {\r\n  walletId: string;\r\n  used_transfer: number;\r\n  used_withdraw: number;\r\n  monthly_limit: number;\r\n  last_reset: Timestamp | null;\r\n  updatedAt: Timestamp;\r\n}\r\n\r\n//   \r\ninterface Transaction {\r\n  id: string;\r\n  uid: string;\r\n  type: 'transfer' | 'withdraw';\r\n  amount: number;\r\n  createdAt: Timestamp;\r\n  status: string;\r\n}\r\n\r\n//    \r\nexport const walletLimitsService = {\r\n  //     \r\n  getCurrentMonthId(): string {\r\n    const now = new Date();\r\n    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;\r\n  },\r\n\r\n  //       Firebase\r\n  async getWalletUsage(walletId: string): Promise<WalletUsage | null> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('Error getting wallet usage: invalid walletId', walletId);\r\n        return null;\r\n      }\r\n      //        walletLimits\r\n      const limitsRef = doc(db, 'walletLimits', walletId);\r\n      const limitsSnap = await getDoc(limitsRef);\r\n      \r\n      if (limitsSnap.exists()) {\r\n        const data = limitsSnap.data();\r\n        return {\r\n          walletId,\r\n          used_transfer: (data.monthlyTransferUsed ?? data.used_transfer ?? 0),\r\n          used_withdraw: (data.monthlyWithdrawUsed ?? data.used_withdraw ?? 0),\r\n          monthly_limit: (data.monthlyLimit ?? data.monthlyTransferLimit ?? data.monthlyWithdrawLimit ?? 200000),\r\n          last_reset: (data.lastMonthlyReset ?? data.last_reset ?? null),\r\n          updatedAt: data.updatedAt || Timestamp.now()\r\n        };\r\n      }\r\n      \r\n      //       \r\n      const newUsage: WalletUsage = {\r\n        walletId,\r\n        used_transfer: 0,\r\n        used_withdraw: 0,\r\n        monthly_limit: 200000,\r\n        last_reset: null,\r\n        updatedAt: Timestamp.now()\r\n      };\r\n      \r\n      //   \r\n      await setDoc(limitsRef, {\r\n        monthlyTransferUsed: 0,\r\n        monthlyWithdrawUsed: 0,\r\n        monthlyTransferLimit: 200000,\r\n        monthlyWithdrawLimit: 200000,\r\n        lastMonthlyReset: null,\r\n        updatedAt: serverTimestamp(),\r\n        ownerId: auth.currentUser?.uid\r\n      });\r\n      \r\n      return newUsage;\r\n    } catch (error) {\r\n      console.error('Error getting wallet usage:', error);\r\n      return {\r\n        walletId,\r\n        used_transfer: 0,\r\n        used_withdraw: 0,\r\n        monthly_limit: 200000,\r\n        last_reset: null,\r\n        updatedAt: Timestamp.now()\r\n      };\r\n    }\r\n  },\r\n\r\n  //        (   )\r\n  shouldResetLimits(lastReset: Timestamp | null): boolean {\r\n    const now = new Date();\r\n    const currentDay = now.getDate();\r\n    \r\n    if (!lastReset) {\r\n      return currentDay === 1;\r\n    }\r\n    \r\n    //           \r\n    if (currentDay === 1) {\r\n      const lastResetDate = lastReset.toDate();\r\n      const currentMonth = now.getMonth();\r\n      const currentYear = now.getFullYear();\r\n      \r\n      //         \r\n      return (lastResetDate.getMonth() !== currentMonth || lastResetDate.getFullYear() !== currentYear);\r\n    }\r\n    \r\n    return false;\r\n  },\r\n\r\n  //      \r\n  async autoResetLimitsIfNeeded(walletId: string): Promise<boolean> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('    : walletId  ', walletId);\r\n        return false;\r\n      }\r\n      // Debug\r\n      if (typeof import.meta !== 'undefined' && (import.meta as any).env && (import.meta as any).env.DEV) {\r\n        console.debug('autoResetLimitsIfNeeded -> walletId:', walletId);\r\n      }\r\n      const usage = await this.getWalletUsage(walletId);\r\n      if (!usage) return false;\r\n      \r\n      if (this.shouldResetLimits(usage.last_reset)) {\r\n        console.log(`     ${walletId} -    `);\r\n        return await this.resetWalletUsage(walletId);\r\n      }\r\n      \r\n      return false;\r\n    } catch (error) {\r\n      console.error('    :', error);\r\n      return false;\r\n    }\r\n  },\r\n  \r\n  //     serverTimestamp\r\n  async resetWalletUsage(walletId: string): Promise<boolean> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('    : walletId  ', walletId);\r\n        return false;\r\n      }\r\n      const limitsRef = doc(db, 'walletLimits', walletId);\r\n      \r\n      //       serverTimestamp\r\n      await setDoc(limitsRef, {\r\n        monthlyTransferUsed: 0,\r\n        monthlyWithdrawUsed: 0,\r\n        lastMonthlyReset: serverTimestamp(),\r\n        updatedAt: serverTimestamp()\r\n      }, { merge: true });\r\n      \r\n      console.log(`     ${walletId} `);\r\n      return true;\r\n    } catch (error) {\r\n      console.error('    :', error);\r\n      return false;\r\n    }\r\n  },\r\n\r\n  //        last_reset\r\n  async calculateUsageFromTransactions(walletId: string): Promise<{ used_transfer: number; used_withdraw: number }> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('     : walletId  ', walletId);\r\n        return { used_transfer: 0, used_withdraw: 0 };\r\n      }\r\n      const limitsRef = doc(db, 'walletLimits', walletId);\r\n      const now = new Date();\r\n      let lastReset: Timestamp | null = Timestamp.fromDate(new Date(now.getFullYear(), now.getMonth(), 1));\r\n      try {\r\n        const limitsSnap = await getDoc(limitsRef);\r\n        lastReset = limitsSnap.exists() ? (limitsSnap.data()?.lastMonthlyReset ?? limitsSnap.data()?.last_reset ?? lastReset) : lastReset;\r\n      } catch {}\r\n      \r\n      //   \r\n      const txQuery = query(\r\n        collection(db, 'tx'),\r\n        where('uid', '==', walletId),\r\n        ...(lastReset ? [where('createdAt', '>=', lastReset)] : [])\r\n      );\r\n      \r\n      const txSnap = await getDocs(txQuery);\r\n      let used_transfer = 0;\r\n      let used_withdraw = 0;\r\n      \r\n      txSnap.forEach((doc) => {\r\n        const tx = doc.data() as Transaction;\r\n        if (tx.status === 'completed') {\r\n          if (tx.type === 'transfer') {\r\n            used_transfer += tx.amount;\r\n          } else if (tx.type === 'withdraw') {\r\n            used_withdraw += tx.amount;\r\n          }\r\n        }\r\n      });\r\n      \r\n      return { used_transfer, used_withdraw };\r\n    } catch (error) {\r\n      console.error('     :', error);\r\n      return { used_transfer: 0, used_withdraw: 0 };\r\n    }\r\n  },\r\n\r\n  //          (Optimistic UI)\r\n  async getWalletUsageWithRefresh(walletId: string): Promise<WalletUsage | null> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('      : walletId  ', walletId);\r\n        return null;\r\n      }\r\n      // Debug\r\n      if (typeof import.meta !== 'undefined' && (import.meta as any).env && (import.meta as any).env.DEV) {\r\n        console.debug('getWalletUsageWithRefresh -> walletId:', walletId);\r\n      }\r\n      //     \r\n      const usage = await this.getWalletUsage(walletId);\r\n      if (!usage) {\r\n        const calculatedUsage = await this.calculateUsageFromTransactions(walletId);\r\n        const limitsRef = doc(db, 'walletLimits', walletId);\r\n        try {\r\n          await setDoc(limitsRef, {\r\n            monthlyTransferUsed: calculatedUsage.used_transfer,\r\n            monthlyWithdrawUsed: calculatedUsage.used_withdraw,\r\n            updatedAt: serverTimestamp(),\r\n            ownerId: auth.currentUser?.uid\r\n          }, { merge: true });\r\n        } catch {}\r\n        return {\r\n          walletId,\r\n          used_transfer: calculatedUsage.used_transfer,\r\n          used_withdraw: calculatedUsage.used_withdraw,\r\n          monthly_limit: 200000,\r\n          last_reset: null,\r\n          updatedAt: Timestamp.now()\r\n        };\r\n      }\r\n      \r\n      //        \r\n      const calculatedUsage = await this.calculateUsageFromTransactions(walletId);\r\n      \r\n      //      \r\n      if (usage.used_transfer !== calculatedUsage.used_transfer || \r\n          usage.used_withdraw !== calculatedUsage.used_withdraw) {\r\n        \r\n        const limitsRef = doc(db, 'walletLimits', walletId);\r\n        \r\n        try {\r\n          await setDoc(limitsRef, {\r\n            monthlyTransferUsed: calculatedUsage.used_transfer,\r\n            monthlyWithdrawUsed: calculatedUsage.used_withdraw,\r\n            updatedAt: serverTimestamp(),\r\n            ownerId: auth.currentUser?.uid\r\n          }, { merge: true });\r\n        } catch {}\r\n        \r\n        //    \r\n        return await this.getWalletUsage(walletId);\r\n      }\r\n      \r\n      return usage;\r\n    } catch (error) {\r\n      console.error('      :', error);\r\n      return {\r\n        walletId,\r\n        used_transfer: 0,\r\n        used_withdraw: 0,\r\n        monthly_limit: 200000,\r\n        last_reset: null,\r\n        updatedAt: Timestamp.now()\r\n      };\r\n    }\r\n  },\r\n\r\n  //  : remaining = monthly_limit - used_*\r\n  calculateRemaining(usage: WalletUsage): { remainingTransfer: number; remainingWithdraw: number } {\r\n    return {\r\n      remainingTransfer: Math.max(0, usage.monthly_limit - usage.used_transfer),\r\n      remainingWithdraw: Math.max(0, usage.monthly_limit - usage.used_withdraw)\r\n    };\r\n  },\r\n\r\n  //          \r\n  async canPerformOperation(walletId: string, amount: number, type: 'transfer' | 'withdraw'): Promise<{ canPerform: boolean; message?: string; remaining?: number }> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('Error checking operation limits: invalid walletId', walletId);\r\n        return { canPerform: false, message: 'walletId  ' };\r\n      }\r\n      //     \r\n      const usage = await this.getWalletUsageWithRefresh(walletId);\r\n      if (!usage) {\r\n        return { canPerform: false, message: '      ' };\r\n      }\r\n\r\n      const remaining = this.calculateRemaining(usage);\r\n      \r\n      if (type === 'transfer') {\r\n        if (amount > remaining.remainingTransfer) {\r\n          return { \r\n            canPerform: false, \r\n            message: `   . : ${remaining.remainingTransfer.toLocaleString()} .   ${usage.monthly_limit.toLocaleString()} .`,\r\n            remaining: remaining.remainingTransfer\r\n          };\r\n        }\r\n      }\r\n\r\n      if (type === 'withdraw') {\r\n        if (amount > remaining.remainingWithdraw) {\r\n          return { \r\n            canPerform: false, \r\n            message: `   . : ${remaining.remainingWithdraw.toLocaleString()} .   ${usage.monthly_limit.toLocaleString()} .`,\r\n            remaining: remaining.remainingWithdraw\r\n          };\r\n        }\r\n      }\r\n\r\n      return { canPerform: true };\r\n    } catch (error) {\r\n      console.error('Error checking operation limits:', error);\r\n      return { canPerform: false, message: '    ' };\r\n    }\r\n  },\r\n  \r\n  //       Optimistic UI\r\n  async updateUsage(walletId: string, amount: number, type: 'transfer' | 'withdraw'): Promise<WalletUsage> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        throw new Error('walletId  ');\r\n      }\r\n      //      \r\n      const currentUsage = await this.getWalletUsageWithRefresh(walletId);\r\n      if (!currentUsage) {\r\n        throw new Error('      ');\r\n      }\r\n\r\n      //     \r\n      const canPerform = await this.canPerformOperation(walletId, amount, type);\r\n      if (!canPerform.canPerform) {\r\n        throw new Error(canPerform.message || '   ');\r\n      }\r\n\r\n      //  \r\n      const newUsedTransfer = type === 'transfer' ? currentUsage.used_transfer + amount : currentUsage.used_transfer;\r\n      const newUsedWithdraw = type === 'withdraw' ? currentUsage.used_withdraw + amount : currentUsage.used_withdraw;\r\n\r\n      //    Firebase  await\r\n      const ref = doc(db, 'walletLimits', currentUsage.walletId);\r\n      \r\n      try {\r\n        await setDoc(ref, {\r\n          monthlyTransferUsed: newUsedTransfer,\r\n          monthlyWithdrawUsed: newUsedWithdraw,\r\n          updatedAt: serverTimestamp(),\r\n          ownerId: auth.currentUser?.uid\r\n        }, { merge: true });\r\n      } catch {}\r\n\r\n      //      \r\n      let updatedUsage = await this.getWalletUsageWithRefresh(walletId);\r\n      if (!updatedUsage) {\r\n        updatedUsage = {\r\n          walletId,\r\n          used_transfer: newUsedTransfer,\r\n          used_withdraw: newUsedWithdraw,\r\n          monthly_limit: currentUsage.monthly_limit,\r\n          last_reset: currentUsage.last_reset,\r\n          updatedAt: Timestamp.now()\r\n        } as WalletUsage;\r\n      }\r\n\r\n      return updatedUsage;\r\n    } catch (error) {\r\n      console.error('Error updating wallet usage:', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  //       Firebase\r\n  async resetWalletUsageManually(walletId: string): Promise<WalletUsage> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        throw new Error('walletId  ');\r\n      }\r\n      const ref = doc(db, 'walletLimits', walletId);\r\n      \r\n      //       \r\n      const resetUsage: WalletUsage = {\r\n        walletId,\r\n        used_transfer: 0,\r\n        used_withdraw: 0,\r\n        monthly_limit: 0,\r\n        last_reset: null,\r\n        updatedAt: new Date() as any\r\n      };\r\n\r\n      //    Firebase  \r\n      setDoc(ref, {\r\n        monthlyTransferUsed: 0,\r\n        monthlyWithdrawUsed: 0,\r\n        lastMonthlyReset: serverTimestamp(),\r\n        updatedAt: serverTimestamp()\r\n      }, { merge: true }).catch(error => {\r\n        console.error('      Firebase:', error);\r\n      });\r\n\r\n      console.log(`     ${walletId} `);\r\n      return resetUsage;\r\n    } catch (error) {\r\n      console.error('Error resetting wallet usage:', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  //      \r\n  async getAllWalletsUsage(merchantUserId: string): Promise<WalletUsage[]> {\r\n    try {\r\n      //     \r\n      const wallets = await merchantWalletService.getByMerchantId(merchantUserId);\r\n      const usagePromises = wallets.map(wallet => this.getWalletUsageWithRefresh(wallet.id));\r\n      const usageResults = await Promise.all(usagePromises);\r\n      \r\n      return usageResults.filter(usage => usage !== null) as WalletUsage[];\r\n    } catch (error) {\r\n      console.error('Error getting all wallets usage:', error);\r\n      return [];\r\n    }\r\n  },\r\n\r\n\r\n\r\n\r\n};\r\n","import React, { useEffect, useMemo, useState, useRef } from 'react';\r\nimport { Capacitor } from '@capacitor/core';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { createPortal } from 'react-dom';\r\nimport { Bell, CheckCircle, ExternalLink } from 'lucide-react';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { Broadcast, subscribeToActiveBroadcastsList } from '@/utils/broadcastService';\r\nimport { Button } from '@/components/ui/button';\r\nimport { db } from '@/firebase';\r\nimport { collection, addDoc, query, where, getDocs, serverTimestamp } from 'firebase/firestore';\r\n\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuLabel,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from '@/components/ui/dropdown-menu';\r\n\r\ninterface NotificationBellProps {\r\n  className?: string;\r\n}\r\n\r\nfunction useReadIdsKey(userId?: string) {\r\n  return userId ? `readBroadcastIds_${userId}` : `readBroadcastIds_guest`;\r\n}\r\n\r\nexport default function NotificationBell({ className }: NotificationBellProps) {\r\n  const { user, profile, isSubscriptionActive } = useFirebaseAuth();\r\n  const location = useLocation();\r\n  const [notifications, setNotifications] = useState<Broadcast[]>([]);\r\n  const [readIds, setReadIds] = useState<Set<string>>(new Set());\r\n\r\n  // States for queue\r\n  const [queueOpen, setQueueOpen] = useState(false);\r\n  const [queueReason, setQueueReason] = useState('');\r\n  const [queueSubmitting, setQueueSubmitting] = useState(false);\r\n  const [queueMessage, setQueueMessage] = useState<string | null>(null);\r\n  const [queueLatestStatus, setQueueLatestStatus] = useState<'none' | 'pending' | 'contacted'>('none');\r\n\r\n  //        5     \r\n  const [flyAlert, setFlyAlert] = useState<Broadcast | null>(null);\r\n  const [flyVisible, setFlyVisible] = useState(false);\r\n  const prevIdsRef = useRef<Set<string>>(new Set());\r\n  const didInitRef = useRef(false);\r\n  const isFirstFetchRef = useRef(true);\r\n  const flyTimerRef = useRef<number | null>(null);\r\n  //        \r\n  const triggerRef = useRef<HTMLDivElement | null>(null);\r\n  const flyNodeRef = useRef<HTMLDivElement | null>(null);\r\n  const [flyStyle, setFlyStyle] = useState<React.CSSProperties>({ position: 'fixed', top: 0, left: 0, zIndex: 10000 });\r\n  \r\n  //     (fly-out)  \r\n  const ENABLE_FLY_ALERT = true;\r\n\r\n  const audienceKeys = useMemo(() => {\r\n    const keys: string[] = ['global'];\r\n    if (user?.uid) keys.push(`user:${user.uid}`);\r\n    if (profile?.shopId) keys.push(`shop:${profile.shopId}`);\r\n    return keys;\r\n  }, [user?.uid, profile?.shopId]);\r\n\r\n  const storageKey = useReadIdsKey(user?.uid);\r\n\r\n  //          \r\n  const canShowNotifications = useMemo(() => {\r\n    const onPendingApprovalPage = location?.pathname?.includes('/user/pending-approval');\r\n    //         \r\n    //        \r\n    const isSignedIn = Boolean(user?.uid);\r\n    return isSignedIn && !onPendingApprovalPage;\r\n  }, [user?.uid, location?.pathname]);\r\n\r\n  useEffect(() => {\r\n    //         \r\n    try {\r\n      const raw = localStorage.getItem(storageKey);\r\n      if (raw) {\r\n        const arr = JSON.parse(raw);\r\n        if (Array.isArray(arr)) setReadIds(new Set(arr.filter(Boolean)));\r\n      } else {\r\n        setReadIds(new Set());\r\n      }\r\n    } catch (e) {\r\n      console.warn('Failed to load read ids', e);\r\n      setReadIds(new Set());\r\n    }\r\n  }, [storageKey]);\r\n\r\n  useEffect(() => {\r\n    //         \r\n    if (!canShowNotifications) {\r\n      setNotifications([]);\r\n      return;\r\n    }\r\n\r\n    //         (  )\r\n    isFirstFetchRef.current = true;\r\n    \r\n    const fetchNotifications = () => {\r\n        subscribeToActiveBroadcastsList(audienceKeys, (list) => {\r\n            if (isFirstFetchRef.current) {\r\n                //        (  )   \"\"\r\n                //            \r\n                const now = Date.now();\r\n                const freshThreshold = 60 * 1000; //  \r\n                \r\n                const oldIds = list.filter(n => {\r\n                    //    \r\n                    const createdAt = n.createdAt?.toMillis ? n.createdAt.toMillis() : (n.createdAt?.seconds ? n.createdAt.seconds * 1000 : 0);\r\n                    const isFresh = (now - createdAt) < freshThreshold;\r\n                    return !isFresh; //         \r\n                }).map(n => n.id).filter(Boolean) as string[];\r\n\r\n                prevIdsRef.current = new Set(oldIds);\r\n                isFirstFetchRef.current = false;\r\n            }\r\n            setNotifications(list);\r\n        });\r\n    };\r\n\r\n    //  \r\n    fetchNotifications();\r\n\r\n    //   OneSignal       \r\n    const handleOneSignalNotification = (event: any) => {\r\n        console.log(' OneSignal Notification received', event);\r\n        \r\n        // 1.        (Client-side)  \r\n        try {\r\n            const notif = event.notification || event;\r\n            if (notif && (notif.title || notif.body)) {\r\n                const instantBroadcast: Broadcast = {\r\n                    id: `temp_${Date.now()}`,\r\n                    title: notif.title || ' ',\r\n                    message: notif.body || notif.message || '',\r\n                    audienceKey: 'global',\r\n                    active: true,\r\n                    createdAt: { toMillis: () => Date.now(), seconds: Math.floor(Date.now() / 1000), nanoseconds: 0 } as any,\r\n                };\r\n                \r\n                //  \r\n                setFlyAlert(instantBroadcast);\r\n                setFlyVisible(true);\r\n                \r\n                //   \r\n                if (flyTimerRef.current) clearTimeout(flyTimerRef.current as any);\r\n                flyTimerRef.current = window.setTimeout(() => {\r\n                    setFlyVisible(false);\r\n                    setFlyAlert(null);\r\n                }, 5000);\r\n            }\r\n        } catch (e) {\r\n            console.error('Error parsing OneSignal event for instant alert', e);\r\n        }\r\n\r\n        // 2.     \r\n        fetchNotifications();\r\n    };\r\n\r\n    //   \r\n    try {\r\n        const OneSignal = (window as any).OneSignal;\r\n        if (OneSignal && OneSignal.Notifications && OneSignal.Notifications.addEventListener) {\r\n            OneSignal.Notifications.addEventListener('foregroundWillDisplay', handleOneSignalNotification);\r\n        }\r\n    } catch (e) {\r\n        console.error('Failed to add OneSignal listener', e);\r\n    }\r\n\r\n    return () => {\r\n        try {\r\n            const OneSignal = (window as any).OneSignal;\r\n            if (OneSignal && OneSignal.Notifications && OneSignal.Notifications.removeEventListener) {\r\n                OneSignal.Notifications.removeEventListener('foregroundWillDisplay', handleOneSignalNotification);\r\n            }\r\n        } catch {}\r\n    };\r\n  }, [audienceKeys, canShowNotifications]);\r\n\r\n  //            5 \r\n  useEffect(() => {\r\n    if (!ENABLE_FLY_ALERT) return; //    \r\n    const ids = new Set((notifications.map((n) => n.id).filter(Boolean) as string[]));\r\n    \r\n    //     didInitRef    isFirstFetchRef   \r\n    //          \r\n    const newItems = notifications.filter((n) => n.id && !prevIdsRef.current.has(n.id!));\r\n    if (newItems.length > 0) {\r\n      setFlyAlert(newItems[0]);\r\n      setFlyVisible(true);\r\n      if (flyTimerRef.current) {\r\n        clearTimeout(flyTimerRef.current as any);\r\n      }\r\n      flyTimerRef.current = window.setTimeout(() => {\r\n        setFlyVisible(false);\r\n        setFlyAlert(null);\r\n      }, 5000);\r\n    }\r\n    prevIdsRef.current = ids;\r\n  }, [notifications]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (flyTimerRef.current) {\r\n        clearTimeout(flyTimerRef.current as any);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const unreadCount = notifications.reduce((acc, n) => acc + (n.id && !readIds.has(n.id) ? 1 : 0), 0);\r\n  //        \r\n\r\n  const markAsRead = (id?: string) => {\r\n    if (!id) return;\r\n    if (readIds.has(id)) return;\r\n    const next = new Set(readIds);\r\n    next.add(id);\r\n    setReadIds(next);\r\n    try {\r\n      localStorage.setItem(storageKey, JSON.stringify(Array.from(next)));\r\n    } catch {}\r\n  };\r\n\r\n  const markAllAsRead = () => {\r\n    const ids = notifications.map((n) => n.id).filter(Boolean) as string[];\r\n    const next = new Set(readIds);\r\n    ids.forEach((id) => next.add(id));\r\n    setReadIds(next);\r\n    try {\r\n      localStorage.setItem(storageKey, JSON.stringify(Array.from(next)));\r\n    } catch {}\r\n  };\r\n\r\n  const openLink = (url?: string, id?: string) => {\r\n    if (url) {\r\n      try {\r\n        const isAndroid = Capacitor?.isNativePlatform && Capacitor.getPlatform() === 'android';\r\n        const isApk = /\\.apk(\\?|$)/i.test(url);\r\n        if (isAndroid && isApk) {\r\n          const deeplink = `cashy://update?url=${encodeURIComponent(url)}`;\r\n          window.location.href = deeplink;\r\n        } else {\r\n          window.open(url, '_blank');\r\n        }\r\n      } catch {\r\n        try { window.open(url, '_blank'); } catch {}\r\n      }\r\n    }\r\n    if (id) markAsRead(id);\r\n  };\r\n\r\n  //      (  )\r\n  const updateFlyPosition = () => {\r\n    if (!triggerRef.current || !flyNodeRef.current) return;\r\n    const rect = triggerRef.current.getBoundingClientRect();\r\n    const margin = 8;\r\n    const width = flyNodeRef.current.offsetWidth || 320;\r\n    const top = rect.bottom + margin;\r\n    let left = rect.right - width; //    \r\n    const viewportWidth = window.innerWidth;\r\n    left = Math.min(Math.max(left, margin), viewportWidth - width - margin);\r\n    setFlyStyle((prev) => ({ ...prev, top, left }));\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!ENABLE_FLY_ALERT) return; //       \r\n    if (!flyVisible) return;\r\n    updateFlyPosition();\r\n    const handler = () => updateFlyPosition();\r\n    window.addEventListener('resize', handler);\r\n    window.addEventListener('scroll', handler, true);\r\n    return () => {\r\n      window.removeEventListener('resize', handler);\r\n      window.removeEventListener('scroll', handler, true);\r\n    };\r\n  }, [flyVisible]);\r\n\r\n  const submitQueueRequest = async () => {\r\n    if (!user?.uid) {\r\n      alert('    .');\r\n      return;\r\n    }\r\n    const reason = queueReason.trim();\r\n    if (!reason) {\r\n      alert('    .');\r\n      return;\r\n    }\r\n    try {\r\n      setQueueSubmitting(true);\r\n      setQueueMessage(null);\r\n      const name = (profile?.fullName && profile.fullName.trim())\r\n        ? profile.fullName.trim()\r\n        : (user.email ? user.email.split('@')[0] : '');\r\n      const phone = profile?.phone || null;\r\n      await addDoc(collection(db, 'waiting_list'), {\r\n        userId: user.uid,\r\n        name,\r\n        phone,\r\n        reason,\r\n        status: 'pending',\r\n        createdAt: serverTimestamp(),\r\n      });\r\n      setQueueMessage('       ');\r\n      setQueueReason('');\r\n      //      \r\n      setTimeout(() => setQueueOpen(false), 900);\r\n    } catch (e) {\r\n      console.error('    :', e);\r\n      alert('    .   .');\r\n    } finally {\r\n      setQueueSubmitting(false);\r\n    }\r\n  };\r\n\r\n  //          \r\n  useEffect(() => {\r\n    if (!user?.uid) {\r\n      setQueueLatestStatus('none');\r\n      return;\r\n    }\r\n    //        \r\n    const checkQueueStatus = async () => {\r\n      try {\r\n        const q = query(\r\n          collection(db, 'waiting_list'),\r\n          where('userId', '==', user.uid)\r\n        );\r\n        const snapshot = await getDocs(q);\r\n        \r\n        const docs = snapshot.docs\r\n          .map((d) => ({ id: d.id, ...d.data() }))\r\n          .sort((a: any, b: any) => {\r\n            const ta = a?.createdAt?.toMillis?.() ?? a?.createdAt?.seconds * 1000 ?? 0;\r\n            const tb = b?.createdAt?.toMillis?.() ?? b?.createdAt?.seconds * 1000 ?? 0;\r\n            return tb - ta; // \r\n          });\r\n\r\n        if (docs.length === 0) {\r\n          setQueueLatestStatus('none');\r\n          return;\r\n        }\r\n\r\n        const latest = docs[0] as any;\r\n        const contacted = latest?.contacted === true || latest?.status === 'contacted';\r\n        setQueueLatestStatus(contacted ? 'contacted' : 'pending');\r\n      } catch (e) {\r\n        console.warn('    waiting_list:', e);\r\n        setQueueLatestStatus('none');\r\n      }\r\n    };\r\n\r\n    checkQueueStatus();\r\n  }, [user?.uid]);\r\n\r\n  if (!canShowNotifications) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className={`relative inline-flex items-center gap-2 ${className || ''}`} ref={triggerRef}>\r\n      {/*     */}\r\n      <DropdownMenu onOpenChange={(open) => { if (open && unreadCount > 0) markAllAsRead(); }}>\r\n        <DropdownMenuTrigger asChild>\r\n          <Button\r\n            variant=\"ghost\"\r\n            className=\"relative h-8 w-8 rounded-full p-0 hover:bg-transparent focus:ring-1 focus:ring-primary focus:ring-offset-1 transition-all\"\r\n            title=\"\"\r\n          >\r\n            <div className=\"relative h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center border border-border shadow-sm hover:shadow-md\">\r\n              <Bell className=\"h-4 w-4 text-primary\" />\r\n              {unreadCount > 0 && (\r\n                <span className=\"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-red-500 text-white text-[10px] font-bold flex items-center justify-center shadow\">\r\n                  {unreadCount}\r\n                </span>\r\n              )}\r\n            </div>\r\n          </Button>\r\n        </DropdownMenuTrigger>\r\n        <DropdownMenuContent className=\"w-80\" align=\"end\" forceMount>\r\n          <DropdownMenuLabel className=\"flex items-center justify-between\">\r\n            <span></span>\r\n            {notifications.length > 0 && (\r\n              <Button variant=\"outline\" size=\"sm\" className=\"h-7 text-xs\" onClick={markAllAsRead}>\r\n                <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n                  \r\n              </Button>\r\n            )}\r\n          </DropdownMenuLabel>\r\n          <DropdownMenuSeparator />\r\n\r\n          {notifications.length === 0 ? (\r\n            <div className=\"p-3 text-sm text-muted-foreground\">   </div>\r\n          ) : (\r\n            <div className=\"max-h-64 overflow-y-auto pr-1\">\r\n              {notifications.map((n) => {\r\n                const isUnread = n.id ? !readIds.has(n.id) : false;\r\n                return (\r\n                  <div key={n.id} className={`px-2 py-2 rounded-md ${isUnread ? 'bg-primary/5' : ''}`}>\r\n                    <div className=\"flex items-start gap-2\">\r\n                      <Bell className={`h-4 w-4 ${isUnread ? 'text-primary' : 'text-muted-foreground'}`} />\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"text-sm font-medium\">{n.title || ''}</div>\r\n                        <div className=\"text-xs text-muted-foreground whitespace-pre-line\">{n.message}</div>\r\n                        {n.linkUrl && (\r\n                          <Button variant=\"link\" className=\"px-0 h-6 text-xs\" onClick={() => openLink(n.linkUrl, n.id)}>\r\n                              <ExternalLink className=\"h-3 w-3 ml-1\" />\r\n                          </Button>\r\n                        )}\r\n                      </div>\r\n                      {isUnread ? (\r\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => markAsRead(n.id)} title=\" \">\r\n                          <CheckCircle className=\"h-4 w-4 text-primary\" />\r\n                        </Button>\r\n                      ) : (\r\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" disabled title=\"\">\r\n                          <CheckCircle className=\"h-4 w-4 text-muted-foreground\" />\r\n                        </Button>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n        </DropdownMenuContent>\r\n      </DropdownMenu>\r\n\r\n\r\n      {/*          */}\r\n      {ENABLE_FLY_ALERT && flyAlert && createPortal(\r\n        <div ref={flyNodeRef} style={flyStyle} className={`pointer-events-auto transition-all duration-300 ${flyVisible ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-3'}`}>\r\n          <div className=\"bg-white rounded-xl shadow-2xl border border-gray-200 p-4 w-80 max-w-[calc(100vw-16px)] flex items-start gap-3\">\r\n            <div className=\"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center\">\r\n              <Bell className=\"w-4 h-4 text-primary\" />\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <div className=\"text-sm font-semibold\">{flyAlert.title || ' '}</div>\r\n              <div className=\"text-xs text-muted-foreground whitespace-pre-line\">{flyAlert.message}</div>\r\n              {flyAlert.linkUrl && (\r\n                <Button variant=\"link\" className=\"px-0 h-6 text-xs\" onClick={() => openLink(flyAlert.linkUrl, flyAlert.id)}>\r\n                   \r\n                </Button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>,\r\n        document.body\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport interface FawryMachineIconProps extends React.SVGProps<SVGSVGElement> {\r\n  size?: number;\r\n}\r\n\r\n//    (POS) -   currentColor  \r\nexport default function FawryMachineIcon({ size = 24, className, ...props }: FawryMachineIconProps) {\r\n  return (\r\n    <svg\r\n      width={size}\r\n      height={size}\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      className={className}\r\n      {...props}\r\n    >\r\n      {/*   */}\r\n      <rect x=\"5\" y=\"2.5\" width=\"14\" height=\"19\" rx=\"2.5\" stroke=\"currentColor\" strokeWidth=\"1.5\" />\r\n      {/*  */}\r\n      <rect x=\"7\" y=\"4.5\" width=\"10\" height=\"5.5\" rx=\"1\" stroke=\"currentColor\" strokeWidth=\"1.2\" />\r\n      {/*   */}\r\n      <path d=\"M9.5 11.5h5\" stroke=\"currentColor\" strokeWidth=\"1.4\" strokeLinecap=\"round\" />\r\n      {/*   (3x3) */}\r\n      <circle cx=\"8.5\" cy=\"14\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n      <circle cx=\"12\" cy=\"14\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n      <circle cx=\"15.5\" cy=\"14\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n\r\n      <circle cx=\"8.5\" cy=\"17\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n      <circle cx=\"12\" cy=\"17\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n      <circle cx=\"15.5\" cy=\"17\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n\r\n      {/*    */}\r\n      <rect x=\"8\" y=\"19\" width=\"9\" height=\"1.8\" rx=\"0.6\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n    </svg>\r\n  );\r\n}","import React from 'react';\r\n\r\nexport function useDebouncedValue<T>(value: T, delay = 300) {\r\n  const [debounced, setDebounced] = React.useState<T>(value);\r\n\r\n  React.useEffect(() => {\r\n    const handler = setTimeout(() => setDebounced(value), delay);\r\n    return () => clearTimeout(handler);\r\n  }, [value, delay]);\r\n\r\n  return debounced;\r\n}","import React, { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Eye, DollarSign, ArrowDownLeft, ArrowRightLeft, Clock, Calendar } from 'lucide-react';\r\nimport { ProfitService } from '@/utils/profitService';\r\nimport { reportsService } from '@/utils/reportsService';\r\nimport { MasterPinDialog } from './MasterPinDialog';\r\nimport { toast } from '@/hooks/use-toast'\r\nimport { getUserSubscription, SubscriptionPlan } from '@/utils/subscriptionService'\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext'\r\n\r\ninterface MonthlyProfitDisplayDialogProps {\r\n  userId?: string;\r\n  transactions: any[];\r\n}\r\n\r\ninterface ProfitData {\r\n  monthlyWithdrawalProfit: number;\r\n  monthlyTransferProfit: number;\r\n  lastUpdated: Date;\r\n}\r\n\r\nconst MonthlyProfitDisplayDialog: React.FC<MonthlyProfitDisplayDialogProps> = ({ userId, transactions }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isMasterPinDialogOpen, setIsMasterPinDialogOpen] = useState(false);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [profitData, setProfitData] = useState<ProfitData>({\r\n    monthlyWithdrawalProfit: 0,\r\n    monthlyTransferProfit: 0,\r\n    lastUpdated: new Date()\r\n  });\r\n  const { userSubscription } = useFirebaseAuth();\r\n\r\n  useEffect(() => {\r\n    if (userId && isOpen && isAuthenticated) {\r\n      loadProfitData();\r\n    }\r\n  }, [userId, isOpen, isAuthenticated]);\r\n\r\n  const loadProfitData = async () => {\r\n    if (!userId) return;\r\n    \r\n    try {\r\n      //            localStorage\r\n      if (Array.isArray(transactions) && transactions.length > 0) {\r\n        const today = new Date();\r\n        const currentMonth = today.getMonth();\r\n        const currentYear = today.getFullYear();\r\n\r\n        const visibleMonthly = reportsService.filterVisibleTransactions(transactions as any[], 'monthly', userId);\r\n\r\n        let monthlyWithdrawProfit = 0;\r\n        let monthlyTransferProfit = 0;\r\n\r\n        visibleMonthly.forEach((tx: any) => {\r\n          const txDate = new Date(tx.createdAt);\r\n          const status = String(tx.status || 'confirmed').toLowerCase();\r\n          if (txDate.getMonth() !== currentMonth || txDate.getFullYear() !== currentYear) return;\r\n          if (status !== 'completed' && status !== 'confirmed') return;\r\n\r\n          const t = (tx.type || tx.txnType || '').toLowerCase();\r\n          const txForCalc = {\r\n            type: t === 'withdrawal' ? 'withdraw' : t,\r\n            amount: Number(tx.amount || 0),\r\n            commission: tx.commission,\r\n          };\r\n\r\n          if (txForCalc.type === 'withdraw') {\r\n            monthlyWithdrawProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          } else if (txForCalc.type === 'send' || txForCalc.type === 'receive' || txForCalc.type === 'transfer') {\r\n            monthlyTransferProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          }\r\n        });\r\n\r\n        setProfitData({\r\n          monthlyWithdrawalProfit: Math.round(monthlyWithdrawProfit * 100) / 100,\r\n          monthlyTransferProfit: Math.round(monthlyTransferProfit * 100) / 100,\r\n          lastUpdated: new Date()\r\n        });\r\n        return;\r\n      }\r\n\r\n      //        localStorage ()\r\n      const profits = ProfitService.getWithdrawTransferProfits(userId);\r\n      setProfitData({\r\n        monthlyWithdrawalProfit: profits.monthlyWithdrawProfit || 0,\r\n        monthlyTransferProfit: profits.monthlyTransferProfit || 0,\r\n        lastUpdated: new Date()\r\n      });\r\n    } catch (error) {\r\n      console.error('Error loading profit data:', error);\r\n    }\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return `${amount.toFixed(2)} .`;\r\n  };\r\n\r\n  const formatDate = (date: Date) => {\r\n    return new Intl.DateTimeFormat('ar-EG', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }).format(date);\r\n  };\r\n\r\n  //         \r\n  const isZeroPlan = async (): Promise<boolean> => {\r\n    try {\r\n      const localSub: any = (userSubscription as any)?.subscription || null;\r\n      const rawLocal: any = localSub?.planType ?? localSub?.plan ?? null;\r\n      const planLocalStr = typeof rawLocal === 'string' ? rawLocal.toLowerCase() : null;\r\n      if (rawLocal === SubscriptionPlan.ZERO || planLocalStr === 'zero' || planLocalStr === '0' || rawLocal === 0) {\r\n        return true;\r\n      }\r\n    } catch {}\r\n\r\n    try {\r\n      if (userId) {\r\n        const remoteSub: any = await getUserSubscription(userId);\r\n        const rawRemote: any = remoteSub?.planType ?? remoteSub?.plan ?? null;\r\n        const planRemoteStr = typeof rawRemote === 'string' ? rawRemote.toLowerCase() : null;\r\n        if (rawRemote === SubscriptionPlan.ZERO || planRemoteStr === 'zero' || planRemoteStr === '0' || rawRemote === 0) {\r\n          return true;\r\n        }\r\n      }\r\n    } catch {}\r\n\r\n    return false;\r\n  };\r\n\r\n  const handleEyeClick = async () => {\r\n    //         \r\n    try {\r\n      if (await isZeroPlan()) {\r\n        toast({\r\n          title: ' ',\r\n          description: '       .     .',\r\n          variant: 'destructive'\r\n        })\r\n        return\r\n      }\r\n    } catch {}\r\n    setIsMasterPinDialogOpen(true)\r\n  }\r\n\r\n  const handlePinSuccess = async () => {\r\n    //            \r\n    try {\r\n      if (await isZeroPlan()) {\r\n        toast({\r\n          title: ' ',\r\n          description: '       .     .',\r\n          variant: 'destructive'\r\n        });\r\n        setIsMasterPinDialogOpen(false);\r\n        return;\r\n      }\r\n    } catch {}\r\n\r\n    setIsAuthenticated(true);\r\n    setIsOpen(true);\r\n    setIsMasterPinDialogOpen(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        size=\"sm\"\r\n        variant=\"ghost\"\r\n        onClick={handleEyeClick}\r\n        className=\"h-6 w-6 p-0 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded-full transition-colors duration-200\"\r\n        title=\"  \"\r\n      >\r\n        <Eye className=\"h-4 w-4\" />\r\n      </Button>\r\n\r\n      <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n        <DialogContent className=\"max-w-[280px] sm:max-w-[320px] mx-auto bg-white border border-gray-200 shadow-xl rounded-xl p-0 overflow-hidden\">\r\n          <DialogHeader className=\"bg-gray-50 px-4 py-3 border-b border-gray-100\">\r\n            <DialogTitle className=\"text-sm font-bold text-gray-900 flex items-center justify-center gap-2\">\r\n              <div className=\"p-1.5 bg-white rounded-full border border-gray-200\">\r\n                <Calendar className=\"h-4 w-4 text-purple-600\" />\r\n              </div>\r\n               \r\n            </DialogTitle>\r\n          </DialogHeader>\r\n\r\n          <div className=\"p-4 space-y-3\">\r\n            {/*  */}\r\n            <div className=\"flex items-center justify-between p-2 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"p-1.5 bg-red-50 rounded-md\">\r\n                  <ArrowDownLeft className=\"h-3.5 w-3.5 text-red-600\" />\r\n                </div>\r\n                <span className=\"font-medium text-gray-700 text-sm\"></span>\r\n              </div>\r\n              <span className=\"font-bold text-sm text-gray-900\">\r\n                {formatCurrency(profitData.monthlyWithdrawalProfit)}\r\n              </span>\r\n            </div>\r\n\r\n            {/*  */}\r\n            <div className=\"flex items-center justify-between p-2 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"p-1.5 bg-green-50 rounded-md\">\r\n                  <ArrowRightLeft className=\"h-3.5 w-3.5 text-green-600\" />\r\n                </div>\r\n                <span className=\"font-medium text-gray-700 text-sm\"></span>\r\n              </div>\r\n              <span className=\"font-bold text-sm text-gray-900\">\r\n                {formatCurrency(profitData.monthlyTransferProfit)}\r\n              </span>\r\n            </div>\r\n\r\n            {/*  */}\r\n            <div className=\"flex items-center justify-between p-3 bg-purple-50 rounded-lg border border-purple-100 mt-2\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"p-1.5 bg-white rounded-md shadow-sm\">\r\n                  <DollarSign className=\"h-3.5 w-3.5 text-purple-600\" />\r\n                </div>\r\n                <span className=\"font-bold text-purple-900 text-sm\"></span>\r\n              </div>\r\n              <span className=\"font-bold text-base text-purple-700\">\r\n                {formatCurrency(profitData.monthlyWithdrawalProfit + profitData.monthlyTransferProfit)}\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-gray-50 px-4 py-3 border-t border-gray-100 flex justify-center\">\r\n            <Button\r\n              onClick={() => setIsOpen(false)}\r\n              className=\"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 hover:text-gray-900 w-full sm:w-auto px-8 rounded-lg text-sm font-medium shadow-sm\"\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <MasterPinDialog\r\n        open={isMasterPinDialogOpen}\r\n        onOpenChange={setIsMasterPinDialogOpen}\r\n        onSuccess={handlePinSuccess}\r\n        description=\"          \"\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport const MonthlyProfitEyeButton: React.FC<MonthlyProfitDisplayDialogProps> = (props) => {\r\n  return <MonthlyProfitDisplayDialog {...props} />;\r\n};\r\n\r\nexport default MonthlyProfitDisplayDialog;","import React, { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Eye, EyeOff, Lock, AlertCircle } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { ProfitService } from '@/utils/profitService';\r\nimport { MasterPinService } from '@/utils/masterPinService';\r\nimport { useEffect } from 'react';\r\n\r\ninterface ProfitPinDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  onSuccess: () => void;\r\n  userId?: string;\r\n}\r\n\r\nexport function ProfitPinDialog({ \r\n  open, \r\n  onOpenChange, \r\n  onSuccess, \r\n  userId \r\n}: ProfitPinDialogProps) {\r\n  const [pin, setPin] = useState('');\r\n  const [confirmPin, setConfirmPin] = useState('');\r\n  const [showPin, setShowPin] = useState(false);\r\n  const [showConfirmPin, setShowConfirmPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [hasExistingPin, setHasExistingPin] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n      const has = await MasterPinService.hasMasterPin(userId);\r\n      if (mounted) setHasExistingPin(has);\r\n    })();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [userId, open]);\r\n\r\n  const handleClose = () => {\r\n    setPin('');\r\n    setConfirmPin('');\r\n    setError('');\r\n    setShowPin(false);\r\n    setShowConfirmPin(false);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      if (hasExistingPin) {\r\n        //     \r\n        const ok = await MasterPinService.verifyMasterPin(pin, userId);\r\n        if (!ok) {\r\n          setError('   ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n      } else {\r\n        //     \r\n        if (pin.length < 4) {\r\n          setError('     4   ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        if (pin !== confirmPin) {\r\n          setError('   ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        const created = await MasterPinService.createMasterPin(pin, userId);\r\n        if (!created) {\r\n          setError('    ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      toast({\r\n        title: \" \",\r\n        description: hasExistingPin \r\n          ? \"      \" \r\n          : \"     \",\r\n      });\r\n\r\n      onSuccess();\r\n      handleClose();\r\n    } catch (error) {\r\n      setError('     ');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-lg font-semibold\">\r\n            <Lock className=\"h-5 w-5 text-green-600\" />\r\n            {hasExistingPin ? '   ' : '   '}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-gray-600 bg-blue-50 p-3 rounded-lg\">\r\n            {hasExistingPin \r\n              ? '      '\r\n              : '       .      .'\r\n            }\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"pin\">\r\n              {hasExistingPin ? '  ' : '   '}\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"pin\"\r\n                type={showPin ? \"text\" : \"password\"}\r\n                value={pin}\r\n                onChange={(e) => setPin(e.target.value)}\r\n                placeholder={hasExistingPin ? \"  \" : \"    (4   )\"}\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n                autoComplete=\"off\"\r\n                required\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowPin(!showPin)}\r\n              >\r\n                {showPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*     (  ) */}\r\n          {!hasExistingPin && (\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"confirmPin\">  </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"confirmPin\"\r\n                  type={showConfirmPin ? \"text\" : \"password\"}\r\n                  value={confirmPin}\r\n                  onChange={(e) => setConfirmPin(e.target.value)}\r\n                  placeholder=\"   \"\r\n                  className=\"pr-10\"\r\n                  dir=\"ltr\"\r\n                  autoComplete=\"off\"\r\n                  required\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowConfirmPin(!showConfirmPin)}\r\n                >\r\n                  {showConfirmPin ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/*   */}\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-red-600 text-sm\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {/*   */}\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              className=\"flex-1 bg-green-600 hover:bg-green-700\"\r\n            >\r\n              <Lock className=\"h-4 w-4 mr-2\" />\r\n              {isLoading \r\n                ? \" ...\" \r\n                : hasExistingPin \r\n                  ? \" \" \r\n                  : \"  \"\r\n              }\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              disabled={isLoading}\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}","import React, { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Eye, DollarSign, ArrowDownLeft, ArrowRightLeft, Clock } from 'lucide-react';\r\nimport { ProfitService } from '@/utils/profitService';\r\nimport { ProfitPinDialog } from './ProfitPinDialog';\r\nimport { formatCurrency } from '@/utils/formatters';\r\nimport { reportsService } from '@/utils/reportsService';\r\n\r\ninterface DailyProfitDisplayDialogProps {\r\n  userId?: string;\r\n  transactions: any[];\r\n}\r\n\r\ninterface ProfitData {\r\n  dailyWithdrawalProfit: number;\r\n  dailyTransferProfit: number;\r\n  lastUpdated: Date;\r\n}\r\n\r\nconst DailyProfitDisplayDialog: React.FC<DailyProfitDisplayDialogProps> = ({ userId, transactions }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isPinDialogOpen, setIsPinDialogOpen] = useState(false);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [profitData, setProfitData] = useState<ProfitData>({\r\n    dailyWithdrawalProfit: 0,\r\n    dailyTransferProfit: 0,\r\n    lastUpdated: new Date()\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (userId && isOpen && isAuthenticated) {\r\n      loadProfitData();\r\n    }\r\n  }, [userId, isOpen, isAuthenticated, transactions]);\r\n\r\n  const loadProfitData = async () => {\r\n    if (!userId) return;\r\n    \r\n    try {\r\n      //            localStorage\r\n      if (Array.isArray(transactions) && transactions.length > 0) {\r\n        const today = new Date();\r\n        const visibleDaily = reportsService.filterVisibleTransactions(transactions as any[], 'daily', userId);\r\n\r\n        let dailyWithdrawProfit = 0;\r\n        let dailyTransferProfit = 0;\r\n\r\n        visibleDaily.forEach((tx: any) => {\r\n          const txDate = new Date(tx.createdAt);\r\n          const status = String(tx.status || 'confirmed').toLowerCase();\r\n          if (txDate.toDateString() !== today.toDateString()) return;\r\n          //    (pending)    \r\n        \r\n          const t = (tx.type || tx.txnType || '').toLowerCase();\r\n          const title = String(tx.title || '');\r\n          if (t === 'cash_addition' || title.includes('  ')) return;\r\n          const txForCalc = {\r\n            type: t === 'withdrawal' ? 'withdraw' : t,\r\n            amount: Number(tx.amount || 0),\r\n            commission: tx.commission,\r\n          };\r\n\r\n          if (txForCalc.type === 'withdraw') {\r\n            dailyWithdrawProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          } else if (txForCalc.type === 'send' || txForCalc.type === 'receive' || txForCalc.type === 'transfer') {\r\n            dailyTransferProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          }\r\n        });\r\n\r\n        setProfitData({\r\n          dailyWithdrawalProfit: Math.round(dailyWithdrawProfit * 100) / 100,\r\n          dailyTransferProfit: Math.round(dailyTransferProfit * 100) / 100,\r\n          lastUpdated: new Date()\r\n        });\r\n\r\n        //         \r\n        try { ProfitService.updateProfitsFromTransactions(transactions, userId); } catch {}\r\n        return;\r\n      }\r\n\r\n      //        localStorage ()\r\n      const profits = ProfitService.getWithdrawTransferProfits(userId);\r\n      setProfitData({\r\n        dailyWithdrawalProfit: profits.dailyWithdrawProfit || 0,\r\n        dailyTransferProfit: profits.dailyTransferProfit || 0,\r\n        lastUpdated: new Date()\r\n      });\r\n    } catch (error) {\r\n      console.error('Error loading profit data:', error);\r\n    }\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return `${amount.toFixed(2)} .`;\r\n  };\r\n\r\n  const formatDate = (date: Date) => {\r\n    return new Intl.DateTimeFormat('ar-EG', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }).format(date);\r\n  };\r\n\r\n  const handleEyeClick = () => {\r\n    if (ProfitService.hasProfitPin(userId)) {\r\n      setIsPinDialogOpen(true);\r\n    } else {\r\n      setIsPinDialogOpen(true);\r\n    }\r\n  };\r\n\r\n  const handlePinSuccess = () => {\r\n    setIsAuthenticated(true);\r\n    setIsOpen(true);\r\n    setIsPinDialogOpen(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        size=\"sm\"\r\n        variant=\"ghost\"\r\n        onClick={handleEyeClick}\r\n        className=\"h-6 w-6 p-0 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-colors duration-200\"\r\n        title=\"  \"\r\n      >\r\n        <Eye className=\"h-4 w-4\" />\r\n      </Button>\r\n\r\n      <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n        <DialogContent className=\"max-w-[280px] sm:max-w-[320px] mx-auto bg-white border border-gray-200 shadow-xl rounded-xl p-0 overflow-hidden\">\r\n          <DialogHeader className=\"bg-gray-50 px-4 py-3 border-b border-gray-100\">\r\n            <DialogTitle className=\"text-sm font-bold text-gray-900 flex items-center justify-center gap-2\">\r\n              <div className=\"p-1.5 bg-white rounded-full border border-gray-200\">\r\n                <DollarSign className=\"h-4 w-4 text-blue-600\" />\r\n              </div>\r\n               \r\n            </DialogTitle>\r\n          </DialogHeader>\r\n\r\n          <div className=\"p-4 space-y-3\">\r\n            {/*  */}\r\n            <div className=\"flex items-center justify-between p-2 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"p-1.5 bg-red-50 rounded-md\">\r\n                  <ArrowDownLeft className=\"h-3.5 w-3.5 text-red-600\" />\r\n                </div>\r\n                <span className=\"font-medium text-gray-700 text-sm\"></span>\r\n              </div>\r\n              <span className=\"font-bold text-sm text-gray-900\">\r\n                {formatCurrency(profitData.dailyWithdrawalProfit)}\r\n              </span>\r\n            </div>\r\n\r\n            {/*  */}\r\n            <div className=\"flex items-center justify-between p-2 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"p-1.5 bg-green-50 rounded-md\">\r\n                  <ArrowRightLeft className=\"h-3.5 w-3.5 text-green-600\" />\r\n                </div>\r\n                <span className=\"font-medium text-gray-700 text-sm\"></span>\r\n              </div>\r\n              <span className=\"font-bold text-sm text-gray-900\">\r\n                {formatCurrency(profitData.dailyTransferProfit)}\r\n              </span>\r\n            </div>\r\n\r\n            {/*  */}\r\n            <div className=\"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-100 mt-2\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"p-1.5 bg-white rounded-md shadow-sm\">\r\n                  <DollarSign className=\"h-3.5 w-3.5 text-blue-600\" />\r\n                </div>\r\n                <span className=\"font-bold text-blue-900 text-sm\"></span>\r\n              </div>\r\n              <span className=\"font-bold text-base text-blue-700\">\r\n                {formatCurrency(profitData.dailyWithdrawalProfit + profitData.dailyTransferProfit)}\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-gray-50 px-4 py-3 border-t border-gray-100 flex justify-center\">\r\n            <Button\r\n              onClick={() => setIsOpen(false)}\r\n              className=\"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 hover:text-gray-900 w-full sm:w-auto px-8 rounded-lg text-sm font-medium shadow-sm\"\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <ProfitPinDialog\r\n        open={isPinDialogOpen}\r\n        onOpenChange={setIsPinDialogOpen}\r\n        onSuccess={handlePinSuccess}\r\n        userId={userId}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport const DailyProfitEyeButton: React.FC<DailyProfitDisplayDialogProps> = (props) => {\r\n  return <DailyProfitDisplayDialog {...props} />;\r\n};\r\n\r\nexport default DailyProfitDisplayDialog;\r\n","/**\r\n *         \r\n * \r\n *    :\r\n * 1. :       \r\n * 2. :       \r\n * 3.       \r\n */\r\n\r\nimport { walletDailyLimitsService } from './walletDailyLimitsService';\r\n\r\nexport interface WalletBalance {\r\n  [walletId: string]: number;\r\n}\r\n\r\nexport interface TransactionResult {\r\n  success: boolean;\r\n  newCashBalance: number;\r\n  newWalletBalances: WalletBalance;\r\n  message: string;\r\n  error?: string;\r\n}\r\n\r\nexport interface TransferOperation {\r\n  amount: number;\r\n  currentCashBalance: number;\r\n  currentWalletBalances: WalletBalance;\r\n  wallets: Array<{ id: string; name: string; isDefault?: boolean }>;\r\n  selectedWalletId?: string; //    \r\n  //  :         \r\n  skipRemoteLimitsCheck?: boolean;\r\n  nonBlockingUsageUpdate?: boolean;\r\n}\r\n\r\nexport interface WithdrawOperation {\r\n  amount: number;\r\n  currentCashBalance: number;\r\n  currentWalletBalances: WalletBalance;\r\n  wallets: Array<{ id: string; name: string; isDefault?: boolean }>;\r\n  selectedWalletId?: string; //    \r\n  //  :         \r\n  skipRemoteLimitsCheck?: boolean;\r\n  nonBlockingUsageUpdate?: boolean;\r\n}\r\n\r\nexport class WalletCashService {\r\n  \r\n  /**\r\n   *  :       \r\n   *      \r\n   * @param operation   \r\n   * @returns  \r\n   */\r\n  static async processTransfer(operation: TransferOperation): Promise<TransactionResult> {\r\n    const { amount, currentCashBalance, currentWalletBalances, wallets, selectedWalletId } = operation;\r\n    \r\n    //    \r\n    if (amount <= 0) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"INVALID_AMOUNT\"\r\n      };\r\n    }\r\n\r\n    //       \r\n    if (selectedWalletId && !operation.skipRemoteLimitsCheck) {\r\n      try {\r\n        const limitCheck = await walletDailyLimitsService.canPerformOperation(selectedWalletId, amount, 'transfer');\r\n        if (!limitCheck.canPerform) {\r\n          return {\r\n            success: false,\r\n            newCashBalance: currentCashBalance,\r\n            newWalletBalances: currentWalletBalances,\r\n            message: limitCheck.message || \"   \",\r\n            error: \"LIMIT_EXCEEDED\"\r\n          };\r\n        }\r\n      } catch (error) {\r\n        console.error('     :', error);\r\n        return {\r\n          success: false,\r\n          newCashBalance: currentCashBalance,\r\n          newWalletBalances: currentWalletBalances,\r\n          message: \"     \",\r\n          error: \"LIMIT_CHECK_ERROR\"\r\n        };\r\n      }\r\n    }\r\n    \r\n    //    \r\n    if (amount <= 0) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"INVALID_AMOUNT\"\r\n      };\r\n    }\r\n\r\n    //         \r\n    if (selectedWalletId) {\r\n      const available = Math.max(currentWalletBalances[selectedWalletId] || 0, 0);\r\n      if (available < amount) {\r\n        const target = wallets.find(w => w.id === selectedWalletId);\r\n        return {\r\n          success: false,\r\n          newCashBalance: currentCashBalance,\r\n          newWalletBalances: currentWalletBalances,\r\n          message: `    ${target ? ` ${target.name}` : ''}. : ${available}  : ${amount} `,\r\n          error: \"INSUFFICIENT_WALLET_BALANCE\"\r\n        };\r\n      }\r\n    } else {\r\n      const totalAvailable = WalletCashService.calculateTotalWalletBalance(currentWalletBalances);\r\n      if (totalAvailable < amount) {\r\n        return {\r\n          success: false,\r\n          newCashBalance: currentCashBalance,\r\n          newWalletBalances: currentWalletBalances,\r\n          message: `    .  : ${totalAvailable}   : ${amount} `,\r\n          error: \"INSUFFICIENT_WALLET_BALANCE\"\r\n        };\r\n      }\r\n    }\r\n\r\n    //       \r\n    const newWalletBalances = { ...currentWalletBalances };\r\n\r\n    if (selectedWalletId) {\r\n      const currentBalance = newWalletBalances[selectedWalletId] || 0;\r\n      newWalletBalances[selectedWalletId] = currentBalance - amount;\r\n    } else {\r\n      let remainingAmount = amount;\r\n      for (const wallet of wallets) {\r\n        if (remainingAmount <= 0) break;\r\n        const currentBalance = Math.max(newWalletBalances[wallet.id] || 0, 0);\r\n        const deductAmount = Math.min(currentBalance, remainingAmount);\r\n        if (deductAmount > 0) {\r\n          newWalletBalances[wallet.id] = (newWalletBalances[wallet.id] || 0) - deductAmount;\r\n          remainingAmount -= deductAmount;\r\n        }\r\n      }\r\n      //   :      \r\n    }\r\n\r\n    const newCashBalance = currentCashBalance + amount;\r\n\r\n    \r\n\r\n    //         \r\n    let message = \"  \";\r\n    if (selectedWalletId) {\r\n      const afterBalance = newWalletBalances[selectedWalletId] || 0;\r\n      if (afterBalance < 0) {\r\n        message = `    :   ${selectedWalletId}  ${afterBalance} .`;\r\n      }\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      newCashBalance,\r\n      newWalletBalances,\r\n      message\r\n    };\r\n  }\r\n\r\n  /**\r\n   *  :       \r\n   * @param operation   \r\n   * @returns  \r\n   */\r\n  static processDeposit(operation: TransferOperation): TransactionResult {\r\n    const { amount, currentCashBalance, currentWalletBalances, wallets } = operation;\r\n    \r\n    //    \r\n    if (amount <= 0) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"INVALID_AMOUNT\"\r\n      };\r\n    }\r\n\r\n    //       \r\n    const totalWalletBalance = this.calculateTotalWalletBalance(currentWalletBalances);\r\n    if (totalWalletBalance < amount) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: `    .  : ${totalWalletBalance}   : ${amount} `,\r\n        error: \"INSUFFICIENT_WALLET_BALANCE\"\r\n      };\r\n    }\r\n\r\n    //    \r\n    const newCashBalance = currentCashBalance + amount;\r\n\r\n    //    \r\n    const newWalletBalances = { ...currentWalletBalances };\r\n    let remainingAmount = amount;\r\n\r\n    //     \r\n    const defaultWallet = wallets.find(w => w.isDefault);\r\n    \r\n    if (defaultWallet && newWalletBalances[defaultWallet.id] >= remainingAmount) {\r\n      //        \r\n      newWalletBalances[defaultWallet.id] -= remainingAmount;\r\n      remainingAmount = 0;\r\n    } else {\r\n      //     \r\n      for (const wallet of wallets) {\r\n        if (remainingAmount <= 0) break;\r\n        \r\n        const balance = newWalletBalances[wallet.id] || 0;\r\n        if (balance > 0) {\r\n          const deductAmount = Math.min(balance, remainingAmount);\r\n          newWalletBalances[wallet.id] = balance - deductAmount;\r\n          remainingAmount -= deductAmount;\r\n        }\r\n      }\r\n    }\r\n\r\n    const message = remainingAmount > 0 \r\n      ? `  .   ${amount - remainingAmount}    `\r\n      : `  .   ${amount}    `;\r\n\r\n    return {\r\n      success: true,\r\n      newCashBalance,\r\n      newWalletBalances,\r\n      message\r\n    };\r\n  }\r\n\r\n  /**\r\n   *  :       \r\n   * @param operation   \r\n   * @returns  \r\n   */\r\n  static async processWithdraw(operation: WithdrawOperation): Promise<TransactionResult> {\r\n    const { amount, currentCashBalance, currentWalletBalances, wallets, selectedWalletId } = operation;\r\n    \r\n    //    \r\n    if (amount <= 0) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"INVALID_AMOUNT\"\r\n      };\r\n    }\r\n\r\n    //       \r\n    if (selectedWalletId && !operation.skipRemoteLimitsCheck) {\r\n      try {\r\n        const limitCheck = await walletDailyLimitsService.canPerformOperation(selectedWalletId, amount, 'withdraw');\r\n        if (!limitCheck.canPerform) {\r\n          return {\r\n            success: false,\r\n            newCashBalance: currentCashBalance,\r\n            newWalletBalances: currentWalletBalances,\r\n            message: limitCheck.message || \"   \",\r\n            error: \"LIMIT_EXCEEDED\"\r\n          };\r\n        }\r\n      } catch (error) {\r\n        console.error('     :', error);\r\n        return {\r\n          success: false,\r\n          newCashBalance: currentCashBalance,\r\n          newWalletBalances: currentWalletBalances,\r\n          message: \"     \",\r\n          error: \"LIMIT_CHECK_ERROR\"\r\n        };\r\n      }\r\n    }\r\n\r\n    //        \r\n    if (currentCashBalance < amount) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: `     .  : ${currentCashBalance}   : ${amount} `,\r\n        error: \"INSUFFICIENT_CASH_BALANCE\"\r\n      };\r\n    }\r\n\r\n    //     \r\n    const newCashBalance = currentCashBalance - amount;\r\n\r\n    //     \r\n    const newWalletBalances = { ...currentWalletBalances };\r\n    const targetWallet = selectedWalletId ? wallets.find(w => w.id === selectedWalletId) : (wallets.find(w => w.isDefault) || wallets[0]);\r\n    \r\n    if (targetWallet) {\r\n      const currentBalance = newWalletBalances[targetWallet.id] || 0;\r\n      newWalletBalances[targetWallet.id] = currentBalance + amount;\r\n    } else {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"NO_WALLETS_AVAILABLE\"\r\n      };\r\n    }\r\n\r\n    \r\n\r\n    return {\r\n      success: true,\r\n      newCashBalance,\r\n      newWalletBalances,\r\n      message: `  .   ${amount}    ${targetWallet?.name || ''}`\r\n    };\r\n  }\r\n\r\n  /**\r\n   *       \r\n   * @param amount \r\n   * @param wallets  \r\n   * @returns true    \r\n   */\r\n  static validateOperation(amount: number, wallets: Array<{ id: string; name: string }>): { valid: boolean; error?: string } {\r\n    if (amount <= 0) {\r\n      return { valid: false, error: \"      \" };\r\n    }\r\n\r\n    if (!wallets || wallets.length === 0) {\r\n      return { valid: false, error: \"   \" };\r\n    }\r\n\r\n    return { valid: true };\r\n  }\r\n\r\n  /**\r\n   *    \r\n   * @param walletBalances  \r\n   * @returns  \r\n   */\r\n  static calculateTotalWalletBalance(walletBalances: WalletBalance): number {\r\n    return Object.values(walletBalances).reduce((total, balance) => total + Math.max(balance, 0), 0);\r\n  }\r\n\r\n  /**\r\n   *         ()\r\n   * @param amount   \r\n   * @param currentCashBalance    \r\n   * @param currentWalletBalances   \r\n   * @param wallets  \r\n   * @returns  \r\n   */\r\n  static deductFromWalletsAddToCash(\r\n    amount: number,\r\n    currentCashBalance: number,\r\n    currentWalletBalances: WalletBalance,\r\n    wallets: Array<{ id: string; name: string; isDefault?: boolean }>\r\n  ): TransactionResult {\r\n    return this.processTransfer({\r\n      amount,\r\n      currentCashBalance,\r\n      currentWalletBalances,\r\n      wallets\r\n    });\r\n  }\r\n\r\n  /**\r\n   *         ()\r\n   * @param amount   \r\n   * @param currentCashBalance    \r\n   * @param currentWalletBalances   \r\n   * @param wallets  \r\n   * @returns  \r\n   */\r\n  static deductFromWalletsAddToCashDeposit(\r\n    amount: number,\r\n    currentCashBalance: number,\r\n    currentWalletBalances: WalletBalance,\r\n    wallets: Array<{ id: string; name: string; isDefault?: boolean }>\r\n  ): TransactionResult {\r\n    return this.processDeposit({\r\n      amount,\r\n      currentCashBalance,\r\n      currentWalletBalances,\r\n      wallets\r\n    });\r\n  }\r\n\r\n  /**\r\n   *         ()\r\n   * @param amount   \r\n   * @param currentCashBalance    \r\n   * @param currentWalletBalances   \r\n   * @param wallets  \r\n   * @returns  \r\n   */\r\n  static deductFromCashAddToWallets(\r\n    amount: number,\r\n    currentCashBalance: number,\r\n    currentWalletBalances: WalletBalance,\r\n    wallets: Array<{ id: string; name: string; isDefault?: boolean }>\r\n  ): TransactionResult {\r\n    return this.processWithdraw({\r\n      amount,\r\n      currentCashBalance,\r\n      currentWalletBalances,\r\n      wallets\r\n    });\r\n  }\r\n\r\n  /**\r\n   *        \r\n   * @param result  \r\n   * @param updateCashBalance    \r\n   * @param updateWalletBalances    \r\n   */\r\n  static applyTransactionResult(\r\n    result: TransactionResult,\r\n    updateCashBalance: (newBalance: number) => void,\r\n    updateWalletBalances: (newBalances: WalletBalance) => void\r\n  ): void {\r\n    if (result.success) {\r\n      updateCashBalance(result.newCashBalance);\r\n      updateWalletBalances(result.newWalletBalances);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *      \r\n   * @param amount \r\n   * @param operationType   (transfer  withdraw  deposit)\r\n   * @param currentCashBalance    \r\n   * @param currentWalletBalances   \r\n   * @returns  \r\n   */\r\n  static validateTransaction(\r\n    amount: number,\r\n    operationType: 'transfer' | 'withdraw' | 'deposit',\r\n    currentCashBalance: number,\r\n    currentWalletBalances: WalletBalance\r\n  ): { isValid: boolean; warning?: string; error?: string } {\r\n    if (amount <= 0) {\r\n      return {\r\n        isValid: false,\r\n        error: \"      \"\r\n      };\r\n    }\r\n\r\n    if (operationType === 'transfer') {\r\n      const totalWalletBalance = this.calculateTotalWalletBalance(currentWalletBalances);\r\n      if (totalWalletBalance < amount) {\r\n        return {\r\n          isValid: false,\r\n          error: `    (${totalWalletBalance} )     (${amount} )`\r\n        };\r\n      }\r\n    } else if (operationType === 'withdraw') {\r\n      if (currentCashBalance < amount) {\r\n        return {\r\n          isValid: false,\r\n          error: `     (${currentCashBalance} )     (${amount} )`\r\n        };\r\n      }\r\n    } else if (operationType === 'deposit') {\r\n      const totalWalletBalance = this.calculateTotalWalletBalance(currentWalletBalances);\r\n      if (totalWalletBalance < amount) {\r\n        return {\r\n          isValid: false,\r\n          error: `    (${totalWalletBalance} )     (${amount} )`\r\n        };\r\n      }\r\n    }\r\n\r\n    return { isValid: true };\r\n  }\r\n\r\n  /**\r\n   *        ( )\r\n   * @param amount   \r\n   * @param currentWalletBalances   \r\n   * @param wallets  \r\n   * @returns  \r\n   */\r\n  static getDeductionPreview(\r\n    amount: number, \r\n    currentWalletBalances: WalletBalance, \r\n    wallets: Array<{ id: string; name: string; isDefault?: boolean }>\r\n  ): Array<{ walletId: string; walletName: string; currentBalance: number; deductedAmount: number; newBalance: number }> {\r\n    const preview: Array<{ walletId: string; walletName: string; currentBalance: number; deductedAmount: number; newBalance: number }> = [];\r\n    let remainingAmount = amount;\r\n\r\n    //    \r\n    for (const wallet of wallets) {\r\n      if (remainingAmount <= 0) break;\r\n      \r\n      const currentBalance = currentWalletBalances[wallet.id] || 0;\r\n      const deductAmount = Math.min(Math.max(currentBalance, 0), remainingAmount);\r\n      \r\n      if (deductAmount > 0) {\r\n        preview.push({\r\n          walletId: wallet.id,\r\n          walletName: wallet.name,\r\n          currentBalance,\r\n          deductedAmount: deductAmount,\r\n          newBalance: currentBalance - deductAmount\r\n        });\r\n        remainingAmount -= deductAmount;\r\n      }\r\n    }\r\n\r\n    //       \r\n\r\n    return preview;\r\n  }\r\n}\r\n\r\nexport default WalletCashService;\r\n","// Simple double-beep (\"tin tin\") sound to play on confirmations\r\n// Uses Web Audio API and keeps a singleton AudioContext for reuse\r\n\r\nlet audioCtx: AudioContext | null = null;\r\n\r\nfunction getAudioContext(): AudioContext {\r\n  const AnyWindow = window as any;\r\n  if (!audioCtx) {\r\n    const Ctx = (AnyWindow.AudioContext || AnyWindow.webkitAudioContext);\r\n    audioCtx = new Ctx();\r\n  }\r\n  if (audioCtx.state === 'suspended') {\r\n    // Resume context on user gesture\r\n    audioCtx.resume();\r\n  }\r\n  return audioCtx;\r\n}\r\n\r\nfunction scheduleBeep(ctx: AudioContext, startTime: number, freq: number, durationMs: number) {\r\n  const osc = ctx.createOscillator();\r\n  const gain = ctx.createGain();\r\n  osc.type = 'sine';\r\n  osc.frequency.value = freq;\r\n  osc.connect(gain);\r\n  gain.connect(ctx.destination);\r\n\r\n  const durationSec = durationMs / 1000;\r\n  // soft attack then decay\r\n  gain.gain.setValueAtTime(0.0001, startTime);\r\n  gain.gain.exponentialRampToValueAtTime(0.2, startTime + 0.02);\r\n  gain.gain.exponentialRampToValueAtTime(0.0001, startTime + durationSec);\r\n\r\n  osc.start(startTime);\r\n  osc.stop(startTime + durationSec + 0.02);\r\n}\r\n\r\nexport function playTinTin() {\r\n  try {\r\n    const ctx = getAudioContext();\r\n    const now = ctx.currentTime;\r\n    // First beep\r\n    scheduleBeep(ctx, now, 880, 140);\r\n    // Second beep a short moment later\r\n    scheduleBeep(ctx, now + 0.18, 980, 140);\r\n  } catch (e) {\r\n    // fail silently to avoid breaking UX if audio is unavailable\r\n    // console.warn('Audio playback failed', e);\r\n  }\r\n}\r\n\r\n// --- Vodafone \"Shakshan\" style tone ---\r\n// Approximation using a short noise burst (\"shak\") followed by a brief tone sweep (\"shan\")\r\nfunction scheduleNoiseBurst(ctx: AudioContext, startTime: number, durationMs: number) {\r\n  const durationSec = durationMs / 1000;\r\n  const bufferSize = Math.floor(ctx.sampleRate * durationSec);\r\n  const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);\r\n  const data = buffer.getChannelData(0);\r\n  for (let i = 0; i < bufferSize; i++) {\r\n    // white noise\r\n    data[i] = (Math.random() * 2 - 1) * 0.6;\r\n  }\r\n  const source = ctx.createBufferSource();\r\n  source.buffer = buffer;\r\n\r\n  const filter = ctx.createBiquadFilter();\r\n  filter.type = 'highpass';\r\n  filter.frequency.value = 1500;\r\n  filter.Q.value = 0.7;\r\n\r\n  const gain = ctx.createGain();\r\n  gain.gain.setValueAtTime(0.0001, startTime);\r\n  gain.gain.exponentialRampToValueAtTime(0.4, startTime + 0.015);\r\n  gain.gain.exponentialRampToValueAtTime(0.0001, startTime + durationSec);\r\n\r\n  source.connect(filter);\r\n  filter.connect(gain);\r\n  gain.connect(ctx.destination);\r\n\r\n  source.start(startTime);\r\n  source.stop(startTime + durationSec + 0.01);\r\n}\r\n\r\nfunction scheduleToneSweep(ctx: AudioContext, startTime: number, startFreq: number, endFreq: number, durationMs: number, type: OscillatorType = 'triangle') {\r\n  const osc = ctx.createOscillator();\r\n  const gain = ctx.createGain();\r\n  osc.type = type;\r\n\r\n  const durationSec = durationMs / 1000;\r\n  osc.frequency.setValueAtTime(startFreq, startTime);\r\n  osc.frequency.linearRampToValueAtTime(endFreq, startTime + durationSec);\r\n\r\n  // gentle attack/decay envelope\r\n  gain.gain.setValueAtTime(0.0001, startTime);\r\n  gain.gain.exponentialRampToValueAtTime(0.25, startTime + 0.02);\r\n  gain.gain.exponentialRampToValueAtTime(0.0001, startTime + durationSec);\r\n\r\n  osc.connect(gain);\r\n  gain.connect(ctx.destination);\r\n\r\n  osc.start(startTime);\r\n  osc.stop(startTime + durationSec + 0.02);\r\n}\r\n\r\nexport function playVodafoneShakshan() {\r\n  try {\r\n    const ctx = getAudioContext();\r\n    const now = ctx.currentTime;\r\n    // \"shak\": short filtered noise burst\r\n    scheduleNoiseBurst(ctx, now, 90);\r\n    // \"shan\": brief downward tone sweep\r\n    scheduleToneSweep(ctx, now + 0.12, 1900, 1100, 180, 'sawtooth');\r\n  } catch (e) {\r\n    // silent fail\r\n  }\r\n}\r\n","/**\r\n *       \r\n * Egyptian wallet number validation utilities\r\n */\r\n\r\n//    \r\nexport type WalletProvider = 'vodafone' | 'orange' | 'etisalat' | 'we';\r\n\r\n//   \r\nexport type ValidationErrorCode = \r\n  | 'INVALID_MSISDN'\r\n  | 'PROVIDER_MISMATCH'\r\n  | 'ALREADY_EXISTS'\r\n  | 'UNAUTHENTICATED'\r\n  | 'RLS_DENIED'\r\n  | 'UNKNOWN';\r\n\r\n//  \r\nexport interface ValidationResult {\r\n  isValid: boolean;\r\n  normalizedMsisdn?: string;\r\n  errorCode?: ValidationErrorCode;\r\n  errorMessage?: string;\r\n}\r\n\r\n//      \r\nconst PROVIDER_PREFIXES: Record<WalletProvider, string> = {\r\n  vodafone: '010',\r\n  orange: '012',\r\n  etisalat: '011',\r\n  we: '015'\r\n};\r\n\r\n/**\r\n *   MSISDN    E.164\r\n * @param rawMsisdn     \r\n * @returns    E.164  null    \r\n */\r\nexport function normalizeEgyptianMsisdn(rawMsisdn: string): string | null {\r\n  if (!rawMsisdn) return null;\r\n\r\n  //      \r\n  let cleaned = rawMsisdn.replace(/[^0-9-]/g, '');\r\n  \r\n  //     \r\n  cleaned = cleaned.replace(/[-]/g, (match) => {\r\n    const arabicDigits = '';\r\n    const englishDigits = '0123456789';\r\n    return englishDigits[arabicDigits.indexOf(match)];\r\n  });\r\n\r\n  //     11    01\r\n  if (cleaned.length !== 11 || !cleaned.startsWith('01')) {\r\n    return null;\r\n  }\r\n\r\n  //   E.164: 01XXXXXXXXX  +201XXXXXXXXX\r\n  return `+20${cleaned.substring(1)}`;\r\n}\r\n\r\n/**\r\n *        \r\n * @param provider   \r\n * @param normalizedMsisdn    E.164\r\n * @returns true       \r\n */\r\nexport function validateProviderMatch(provider: WalletProvider, normalizedMsisdn: string): boolean {\r\n  if (!normalizedMsisdn.startsWith('+201')) return false;\r\n  \r\n  //      ( +201)\r\n  const prefix = normalizedMsisdn.substring(3, 6); // +201XXXXXXXXX  0XX\r\n  const expectedPrefix = PROVIDER_PREFIXES[provider];\r\n  \r\n  return prefix === expectedPrefix;\r\n}\r\n\r\n/**\r\n *      \r\n * @param provider  \r\n * @param rawMsisdn  \r\n * @returns        \r\n */\r\nexport function validateWalletNumber(provider: WalletProvider, rawMsisdn: string): ValidationResult {\r\n  //  \r\n  const normalizedMsisdn = normalizeEgyptianMsisdn(rawMsisdn);\r\n  \r\n  if (!normalizedMsisdn) {\r\n    return {\r\n      isValid: false,\r\n      errorCode: 'INVALID_MSISDN',\r\n      errorMessage: '   .  11    01'\r\n    };\r\n  }\r\n\r\n  //    \r\n  if (!validateProviderMatch(provider, normalizedMsisdn)) {\r\n    const expectedPrefix = PROVIDER_PREFIXES[provider];\r\n    return {\r\n      isValid: false,\r\n      errorCode: 'PROVIDER_MISMATCH',\r\n      errorMessage: `  ${getProviderDisplayName(provider)}     ${expectedPrefix}`\r\n    };\r\n  }\r\n\r\n  return {\r\n    isValid: true,\r\n    normalizedMsisdn\r\n  };\r\n}\r\n\r\n/**\r\n *      \r\n * @param provider  \r\n * @returns   \r\n */\r\nexport function getProviderDisplayName(provider: WalletProvider): string {\r\n  const names: Record<WalletProvider, string> = {\r\n    vodafone: ' ',\r\n    orange: ' ',\r\n    etisalat: ' ',\r\n    we: ' '\r\n  };\r\n  return names[provider];\r\n}\r\n\r\n/**\r\n *       \r\n * @param msisd  \r\n * @returns true     \r\n */\r\nexport function quickValidateMsisdn(msisdn: string): boolean {\r\n  if (!msisdn) return false;\r\n  \r\n  //   \r\n  const cleaned = msisdn.replace(/[^0-9-]/g, '');\r\n  \r\n  //   \r\n  const normalized = cleaned.replace(/[-]/g, (match) => {\r\n    const arabicDigits = '';\r\n    const englishDigits = '0123456789';\r\n    return englishDigits[arabicDigits.indexOf(match)];\r\n  });\r\n\r\n  //   : 11    01\r\n  return /^01[0-9]{9}$/.test(normalized);\r\n}\r\n\r\n/**\r\n *  : 11     010  011  012  015\r\n *      /\r\n */\r\nexport function strictValidateMsisdn(msisdn: string): boolean {\r\n  if (!msisdn) return false;\r\n  const cleaned = msisdn.replace(/[^0-9-]/g, '');\r\n  const normalized = cleaned.replace(/[-]/g, (match) => {\r\n    const arabicDigits = '';\r\n    const englishDigits = '0123456789';\r\n    return englishDigits[arabicDigits.indexOf(match)];\r\n  });\r\n  return /^(010|011|012|015)[0-9]{8}$/.test(normalized);\r\n}\r\n\r\n/**\r\n *      \r\n * @param errorCode  \r\n * @returns   \r\n */\r\nexport function getErrorMessage(errorCode: ValidationErrorCode): string {\r\n  const messages: Record<ValidationErrorCode, string> = {\r\n    INVALID_MSISDN: '   .  11    01',\r\n    PROVIDER_MISMATCH: '      ',\r\n    ALREADY_EXISTS: '   ',\r\n    UNAUTHENTICATED: '   ',\r\n    RLS_DENIED: '      ',\r\n    UNKNOWN: '      '\r\n  };\r\n  return messages[errorCode];\r\n}","import React, { useState, useEffect, useLayoutEffect, useRef } from 'react';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport ProfileSettingsPage from './ProfileSettingsPage';\nimport { useLocation, useNavigate, useParams } from 'react-router-dom';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Popover, PopoverTrigger, PopoverContent } from '@/components/ui/popover';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from '@/components/ui/dialog';\nimport { Label } from '@/components/ui/label';\nimport { ArrowUpDown, Plus, PlusCircle, Minus, CheckCircle, Check, Clock, XCircle, X, Phone, DollarSign, Wallet, ArrowDownLeft, ArrowUpRight, Trash2, Edit, LogOut, Settings, Banknote, RefreshCw, Search, Calendar, CalendarDays, Download, Calculator, BarChart, Crown, MessageCircle, FileText, Receipt, CreditCard, Eye, User, Wrench, BatteryCharging, ChevronDown, ChevronUp, AlertTriangle, AlertCircle, Store, Notebook, BadgePercent, Send, Code, Smartphone, Printer } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\nconst BranchRequestDialog = React.lazy(() => import(\"@/components/BranchRequestDialog\").then(m => ({ default: m.BranchRequestDialog })));\nconst WalletManagement = React.lazy(() => import('@/components/WalletManagement'));\nconst TransactionDetailsModal = React.lazy(() => import('@/components/TransactionDetailsModal'));\nconst ReceiptModal = React.lazy(() => import('@/components/ReceiptModal'));\n// import { SecretPinDialog } from '@/components/SecretPinDialog';\nconst EditBalanceDialog = React.lazy(() => import('@/components/EditBalanceDialog').then(m => ({ default: m.EditBalanceDialog })));\nconst ChangePinDialog = React.lazy(() => import('@/components/ChangePinDialog').then(m => ({ default: m.ChangePinDialog })));\nconst ChangeCashPinDialog = React.lazy(() => import('@/components/ChangeCashPinDialog').then(m => ({ default: m.ChangeCashPinDialog })));\nconst ChangeWalletTotalPinDialog = React.lazy(() => import('@/components/ChangeWalletTotalPinDialog').then(m => ({ default: m.ChangeWalletTotalPinDialog })));\nconst PasswordConfirmDialog = React.lazy(() => import('@/components/PasswordConfirmDialog'));\nimport { auth, db, firebaseConfig } from '@/firebase';\nimport { EmailAuthProvider, reauthenticateWithCredential, getAuth, createUserWithEmailAndPassword, signOut as firebaseSignOut } from 'firebase/auth';\nimport { initializeApp, deleteApp } from 'firebase/app';\nimport { getFirestore, doc as fsDoc, setDoc as fsSetDoc } from 'firebase/firestore';\nimport { Switch } from '@/components/ui/switch';\nconst MasterPinDialog = React.lazy(() => import('@/components/MasterPinDialog').then(m => ({ default: m.MasterPinDialog })));\nconst AddToWalletDialog = React.lazy(() => import('@/components/AddToWalletDialog').then(m => ({ default: m.AddToWalletDialog })));\nimport { walletLimitsService } from '@/utils/walletLimitsService';\nimport walletDailyLimitsService from '@/utils/walletDailyLimitsService';\nimport { reportsService } from '@/utils/reportsService';\nimport ProfileIcon from '@/components/ProfileIcon';\nimport NotificationBell from '@/components/NotificationBell';\nimport LogoLoader from '@/components/LogoLoader';\nconst CalculatorDialog = React.lazy(() => import('@/components/CalculatorDialog').then(m => ({ default: m.CalculatorDialog })));\nconst SalesDataDialog = React.lazy(() => import('@/components/SalesDataDialog').then(m => ({ default: m.SalesDataDialog })));\nconst CashSummaryDialog = React.lazy(() => import('@/components/CashSummaryDialog').then(m => ({ default: m.CashSummaryDialog })));\nconst CreditCardsDialog = React.lazy(() => import('@/components/CreditCardsDialog'));\nconst InstallmentModal = React.lazy(() => import('@/components/InstallmentModal'));\nconst MaintenanceDialog = React.lazy(() => import('@/components/MaintenanceDialog'));\nconst MachineDailyDialog = React.lazy(() => import('@/components/MachineDailyDialog'));\nimport FawryMachineIcon from '@/components/icons/FawryMachineIcon';\nimport { useDebouncedValue } from '@/hooks/useDebouncedValue';\nimport { ProfitEyeButton } from '@/components/ProfitDisplayDialog';\nimport { MonthlyProfitEyeButton } from '@/components/MonthlyProfitDisplayDialog';\nimport { DailyProfitEyeButton } from '@/components/DailyProfitDisplayDialog';\nconst WalletsManagement = React.lazy(() => import('@/components/merchant/WalletsManagement').then(m => ({ default: m.WalletsManagement })));\nconst WalletsListDialog = React.lazy(() => import('@/components/WalletsListDialog').then(m => ({ default: m.WalletsListDialog })));\nconst WalletPrinterDialog = React.lazy(() => import('@/components/WalletPrinterDialog'));\nimport { useShift } from '@/contexts/ShiftContext';\nconst CashierShiftModal = React.lazy(() => import('@/components/CashierShiftModal'));\nconst ShiftProfileDialog = React.lazy(() => import('@/components/ShiftProfileDialog'));\nconst ChangeLogDialog = React.lazy(() => import('@/components/ChangeLogDialog'));\nimport ChangeLogFloatingButton from '@/components/ChangeLogFloatingButton';\nimport { useShop } from '@/hooks/useShop';\n// Firebase imports\nimport { userDataService, transactionService, merchantWalletService, auditLogService, dailyReportsArchiveService, telegramNotifier } from '@/integrations/firebase/services';\nimport { doc, getDoc, writeBatch, collection, query as fsQuery, where, getDocs, updateDoc, deleteDoc, addDoc, serverTimestamp, setDoc, orderBy, limit, onSnapshot } from 'firebase/firestore';\nimport WalletCashService from '@/utils/walletCashService';\nimport { FreeTrialService } from '@/utils/freeTrialService';\nimport { getUserSubscription, SubscriptionData, isSubscriptionValid, getDaysRemaining, getPlanDisplayName, formatDate, SubscriptionPlan } from '@/utils/subscriptionService';\nimport { MasterPinService } from '@/utils/masterPinService';\nimport { playVodafoneShakshan } from '@/utils/sound';\nimport { strictValidateMsisdn } from '@/utils/walletValidation';\nimport { openUssdDeepLink, sendTransferDeepLink, getUssdCode, getUssdCodeBySender, sendTransferFromWalletDeepLink } from '@/utils/ussdDialer';\nimport { walletSelectionPinService } from '@/utils/walletSelectionPinService';\nimport { Capacitor } from '@capacitor/core';\nimport PinModal from '@/components/PinModal';\nimport { backupToGoogleDrive, restoreFromGoogleDrive, saveGoogleBackupToken } from '@/utils/googleDriveBackup';\nimport { formatNumberEnglish } from '@/utils/formatters';\nimport { Preferences } from '@capacitor/preferences';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport { getAppDownloads, type AppDownloads } from '@/utils/appDownloadService';\n\nasync function waitForOAuthCode(popup: Window): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const timer = setInterval(() => {\n      try {\n        const url = popup.location.href;\n        if (url.includes('/oauth2/callback') && url.includes('code=')) {\n          const u = new URL(url);\n          const code = u.searchParams.get('code');\n          popup.close();\n          clearInterval(timer);\n          if (code) return resolve(code);\n          return reject(new Error('    '));\n        }\n      } catch { }\n      if (popup.closed) {\n        clearInterval(timer);\n        reject(new Error('     '));\n      }\n    }, 500);\n  });\n}\n\nasync function exchangeCodeForRefreshToken(code: string, clientId: string, redirectUri: string): Promise<{ access_token: string; refresh_token: string }> {\n  const clientSecret = String((import.meta as any)?.env?.VITE_GOOGLE_OAUTH_CLIENT_SECRET || '').trim();\n  const body = new URLSearchParams({\n    code,\n    client_id: clientId,\n    grant_type: 'authorization_code',\n    redirect_uri: redirectUri,\n  });\n  if (clientSecret) body.set('client_secret', clientSecret);\n  const resp = await fetch('https://oauth2.googleapis.com/token', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n    body: body.toString(),\n  });\n  const json = await resp.json();\n  if (!resp.ok || !json.refresh_token || !json.access_token) throw new Error('    tokens');\n  return { access_token: String(json.access_token), refresh_token: String(json.refresh_token) };\n}\n\nasync function fetchGoogleEmail(accessToken: string): Promise<string> {\n  const resp = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {\n    headers: { Authorization: `Bearer ${accessToken}` },\n  });\n  const json = await resp.json();\n  return String(json?.email || '');\n}\n\nfunction GoogleBackupBar({ userId }: { userId?: string }) {\n  const [loading, setLoading] = React.useState<'link' | 'backup' | 'restore' | null>(null);\n  const [message, setMessage] = React.useState<string>('');\n\n  async function linkGoogle() {\n    setLoading('link');\n    setMessage('');\n    try {\n      const clientId = String((import.meta as any)?.env?.VITE_GOOGLE_OAUTH_CLIENT_ID || '').trim();\n      const redirectUri = window.location.origin + '/oauth2/callback';\n      const scope = encodeURIComponent('https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.email');\n      const url = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&response_type=code&access_type=offline&prompt=consent&scope=${scope}&redirect_uri=${encodeURIComponent(redirectUri)}`;\n      const popup = window.open(url, '_blank', 'width=500,height=600');\n      if (!popup) throw new Error('    ');\n      const code = await waitForOAuthCode(popup);\n      const token = await exchangeCodeForRefreshToken(code, clientId, redirectUri);\n      const email = await fetchGoogleEmail(token.access_token);\n      const ok = await saveGoogleBackupToken(userId || 'current', email, token.refresh_token);\n      setMessage(ok ? '   ' : '   ');\n    } catch (e: any) {\n      setMessage(e?.message || '  ');\n    } finally {\n      setLoading(null);\n    }\n  }\n\n  async function backup() {\n    setLoading('backup');\n    setMessage('');\n    const res = await backupToGoogleDrive(userId || 'current');\n    setMessage(res.ok ? '   ' : (res.error || ' '));\n    setLoading(null);\n  }\n\n  async function restore() {\n    setLoading('restore');\n    setMessage('');\n    const res = await restoreFromGoogleDrive(userId || 'current');\n    setMessage(res.ok ? '  ' : (res.error || ' '));\n    setLoading(null);\n  }\n\n  //             \n  return null;\n}\n\ninterface Transaction {\n  id: string;\n  type: 'send' | 'receive' | 'withdraw';\n  senderPhone: string;\n  receiverPhone: string;\n  amount: number;\n  status: 'pending' | 'completed' | 'failed';\n  createdAt: Date;\n  provider?: string;\n  withdrawnAmount?: number; //  \n  sentAmount?: number; //  \n  fromWallet?: string; //   \n  //    \n  senderNumber?: string; //  \n  senderName?: string; //    \n  shopName?: string; //  \n  transferredAmount?: number; //  \n  receiverNumber?: string; //  \n  withdrawnAmountDetailed?: number; //   \n  merchantShopName?: string; //        \n  transactionReference?: string; //  \n  commission?: number; // \n  fee?: number; //   \n  notes?: string; //  \n  commissionMode?: 'add' | 'deduct';\n  totalCharged?: number;\n}\n\ninterface DailyStats {\n  date: string;\n  totalTransactions: number;\n  totalAmount: number;\n  totalWithdrawn: number;\n  totalSent: number;\n}\n\ninterface MonthlyStats {\n  month: string;\n  totalTransactions: number;\n  totalAmount: number;\n  totalWithdrawn: number;\n  totalSent: number;\n}\n\ninterface Debt {\n  id: string;\n  debtorName: string;\n  customerId?: string;\n  mobile?: string;\n  amount: number;\n  reason: string;\n  status: 'pending' | 'paid';\n  createdAt: Date;\n  paidAmount?: number;\n  partialPayments?: { amount: number; paidAt: Date }[];\n  lastUpdated?: Date;\n  type?: 'debtor' | 'creditor'; // 'creditor' = User is Creditor (Receivable), 'debtor' = User is Debtor (Payable)\n}\n\ninterface Customer {\n  id: string;\n  name: string;\n  mobile: string;\n  createdAt: Date;\n}\n\ninterface ShopExpense {\n  id: string;\n  name: string;\n  amount: number;\n  notes?: string;\n  source: 'cash' | 'wallet' | 'fawry';\n  walletId?: string;\n  createdAt: Date;\n}\n\ninterface DeficiencyItem {\n  id: string;\n  name: string;\n  quantity: number;\n  status: 'pending' | 'purchased';\n  createdAt: Date;\n}\n\nconst UserDashboardPage = () => {\n  console.log(' UserDashboardPage component is loading...');\n  const { signOut, user, profile } = useFirebaseAuth();\n  const isVodafoneCashUser = ((user?.email || '').toLowerCase() === 'vodafonecash00@gmail.com');\n  const location = useLocation();\n  const navigate = useNavigate();\n  const params = useParams();\n  const { isShiftActive, shiftUser } = useShift();\n  const { shopId: shopIdCtx, shopName } = useShop();\n  const queryClientHook = useQueryClient();\n  const isMobile = useIsMobile();\n\n  const { toast } = useToast();\n  const formRef = useRef<HTMLDivElement | null>(null);\n  const [formTranslateY, setFormTranslateY] = useState(0);\n  const [isProfileSettingsOpen, setIsProfileSettingsOpen] = useState(false);\n  const [isWalletPrinterDialogOpen, setIsWalletPrinterDialogOpen] = useState(false);\n\n  const [wallets, setWallets] = useState<Array<{ id: string, name: string, phone: string, isDefault: boolean, monthlyWithdrawalLimit?: number, monthlyTransferLimit?: number, defaultTransferCommission?: number | null, defaultWithdrawCommission?: number | null }>>(() => {\n    try {\n      const anyWalletKey = Object.keys(localStorage).find(k => k.startsWith('wallets_'));\n      const savedWalletsStr = anyWalletKey ? localStorage.getItem(anyWalletKey) : null;\n      if (savedWalletsStr) {\n        const parsedWallets = JSON.parse(savedWalletsStr);\n        if (Array.isArray(parsedWallets)) {\n          return parsedWallets;\n        }\n      }\n    } catch { }\n    return [];\n  });\n\n\n\n  useEffect(() => {\n    if (location.state?.openProfileSettings) {\n       setIsProfileSettingsOpen(true);\n       window.history.replaceState({}, document.title);\n    }\n  }, [location.state]);\n\n  //    \n  const handleOpenMobileScreen = async () => {\n    //     \n    const deviceId = selectedAdbDeviceId;\n    \n    if (!deviceId) {\n      toast({ \n        title: '', \n        description: '      ( )', \n        variant: 'destructive' \n      });\n      return;\n    }\n\n    try {\n      const api = (window as any).electronAPI;\n      if (api && api.openScrcpy) {\n        toast({ title: ' ', description: '    ...' });\n        const result = await api.openScrcpy(deviceId);\n        if (!result.success) {\n          toast({ \n            title: '  ', \n            description: `   : ${result.error}`, \n            variant: 'destructive' \n          });\n        }\n      } else {\n        toast({ \n          title: ' ', \n          description: '       ', \n          variant: 'destructive' \n        });\n      }\n    } catch (e: any) {\n      console.error('Scrcpy error:', e);\n      toast({ \n        title: '  ', \n        description: e.message || '      ', \n        variant: 'destructive' \n      });\n    }\n  };\n\n  //     API\n  const submitTopUp = async () => {\n    const allowedEmail = 'alkaptin678678@gmail.com';\n    const userEmail = auth.currentUser?.email?.toLowerCase();\n    if (!userEmail || userEmail !== allowedEmail) {\n      toast({ title: ' ', description: '    .' });\n      return;\n    }\n    if (!topupPhone || !topupOperator || !topupAmount) {\n      toast({ title: ' ', description: '    ', variant: 'destructive' });\n      return;\n    }\n    try {\n      setTopupLoading(true);\n      const idToken = await auth.currentUser?.getIdToken();\n      const resp = await fetch('/api/topup', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(idToken ? { Authorization: `Bearer ${idToken}` } : {}),\n        },\n        body: JSON.stringify({\n          phone: topupPhone,\n          countryCode: 'EG',\n          operator: topupOperator,\n          amount: Number(topupAmount),\n          useLocalAmount: true,\n        })\n      });\n      const data: any = await resp.json().catch(() => ({}));\n      if (resp.ok && data?.success) {\n        toast({ title: ' ', description: data?.message || '    ' });\n        setIsTopUpOpen(false);\n        setTopupPhone('');\n        setTopupOperator('');\n        setTopupAmount('');\n      } else {\n        toast({ title: ' ', description: data?.message || '    ', variant: 'destructive' });\n      }\n    } catch (err) {\n      console.error('Topup request error:', err);\n      toast({ title: '  ', description: '   .  .', variant: 'destructive' });\n    } finally {\n      setTopupLoading(false);\n    }\n  };\n\n  //     (Electron)\n  const isDesktopApp = (() => {\n    try {\n      return Boolean((window as any).electronAPI) ||\n        (typeof navigator !== 'undefined' && navigator.userAgent.toLowerCase().includes('electron')) ||\n        (typeof window !== 'undefined' && window.location && window.location.protocol === 'file:');\n    } catch {\n      return false;\n    }\n  })();\n  const [isCashierModalOpen, setIsCashierModalOpen] = useState(false);\n  const [isShiftProfileOpen, setIsShiftProfileOpen] = useState(false);\n  const [isChangeLogOpen, setIsChangeLogOpen] = useState(false);\n  const [isDeveloperInfoOpen, setIsDeveloperInfoOpen] = useState(false);\n  const [branchDialogOpen, setBranchDialogOpen] = useState(false);\n  const [branchRequestOpen, setBranchRequestOpen] = useState(false);\n  const [branches, setBranches] = useState<any[]>([]);\n  const [managerNameInput, setManagerNameInput] = useState('');\n  const [branchNameInput, setBranchNameInput] = useState('');\n  const [branchEmailInput, setBranchEmailInput] = useState('');\n  const [loginPasswordInput, setLoginPasswordInput] = useState('');\n  const [branchLoading, setBranchLoading] = useState(false);\n  const [branchLoginOpen, setBranchLoginOpen] = useState(false);\n  const [branchLoginTarget, setBranchLoginTarget] = useState<any | null>(null);\n  const [branchLoginUsername, setBranchLoginUsername] = useState('');\n  const [branchLoginPassword, setBranchLoginPassword] = useState('');\n  const [branchAuthLoading, setBranchAuthLoading] = useState(false);\n  const [branchDetailsOpen, setBranchDetailsOpen] = useState(false);\n  const [branchDetailsLoading, setBranchDetailsLoading] = useState(false);\n  const [selectedBranchDetails, setSelectedBranchDetails] = useState<any>(null);\n  const [showAddBranchForm, setShowAddBranchForm] = useState(false);\n  const [branchesLoaded, setBranchesLoaded] = useState(false);\n  const [appDownloads, setAppDownloads] = useState<AppDownloads | null>(null);\n\n  // Load App Version Logic\n  useEffect(() => {\n    getAppDownloads().then(setAppDownloads).catch(() => {});\n  }, []);\n  const [runtimeDesktopVersion, setRuntimeDesktopVersion] = useState<string | undefined>(undefined);\n  useEffect(() => {\n    try {\n      const api: any = (window as any).electronAPI;\n      if (api && typeof api.appVersion === 'function') {\n        api.appVersion().then((v: any) => {\n          if (typeof v === 'string' && !v.startsWith('err:')) setRuntimeDesktopVersion(v);\n        }).catch(() => {});\n      }\n    } catch {}\n  }, []);\n  const appVersion = (() => {\n    const localVersion = (import.meta as any)?.env?.VITE_APP_VERSION as string | undefined;\n    const isElectronEnv = typeof window !== 'undefined' && ((window as any).electronAPI || window.location.protocol === 'file:' || (typeof navigator !== 'undefined' && navigator.userAgent.toLowerCase().includes('electron')));\n    if (isElectronEnv && (profile as any)?.desktopInstalledVersion) return (profile as any)?.desktopInstalledVersion;\n    if (isElectronEnv && runtimeDesktopVersion) return runtimeDesktopVersion;\n    if (localVersion) return localVersion;\n    if (!appDownloads && !profile) return undefined;\n    if (isMobile) return (profile as any)?.androidInstalledVersion || (profile as any)?.lastAckAndroidVersion || appDownloads?.androidVersion || appDownloads?.pcVersion;\n    if (isElectronEnv) return appDownloads?.pcVersion || appDownloads?.androidVersion;\n    return appDownloads?.pcVersion || appDownloads?.androidVersion;\n  })();\n\n  // Load branches when dialog opens\n  useEffect(() => {\n    if (branchDialogOpen && user?.uid && !branchesLoaded) {\n      const loadBranches = async () => {\n        setBranchLoading(true);\n        try {\n          let subBranches: any[] = [];\n          let rootBranches: any[] = [];\n\n          // 1. Fetch from subcollection (New Standard)\n          try {\n            const branchesRef = collection(db, 'users', user.uid, 'branches');\n            const snapshotSub = await getDocs(branchesRef);\n            subBranches = snapshotSub.docs.map(doc => ({ id: doc.id, ...doc.data(), source: 'sub' }));\n          } catch (e) {\n            console.warn('Failed to fetch subcollection branches:', e);\n          }\n\n          // 2. Fetch from root collection (Legacy/Backup)\n          try {\n            const qRoot = fsQuery(collection(db, 'branches'), where('ownerId', '==', user.uid));\n            const snapshotRoot = await getDocs(qRoot);\n            rootBranches = snapshotRoot.docs.map(doc => ({ id: doc.id, ...doc.data(), source: 'root' }));\n          } catch (e) {\n             console.warn('Failed to fetch root branches:', e);\n          }\n\n          // 3. Merge and deduplicate based on branchUserId\n          const allBranches = [...subBranches, ...rootBranches];\n          // Prefer 'sub' source if duplicates exist\n          const uniqueBranchesMap = new Map();\n          allBranches.forEach(item => {\n             const key = item['branchUserId'] || item.id;\n             if (!uniqueBranchesMap.has(key) || item.source === 'sub') {\n                 uniqueBranchesMap.set(key, item);\n             }\n          });\n          const uniqueBranches = Array.from(uniqueBranchesMap.values());\n          \n          console.log('Loaded branches:', uniqueBranches);\n          setBranches(uniqueBranches);\n          setBranchesLoaded(true);\n        } catch (error) {\n          console.error('Error in branch loading process:', error);\n          toast({\n             title: '',\n             description: '    ',\n             variant: 'destructive'\n          });\n        } finally {\n          setBranchLoading(false);\n        }\n      };\n      loadBranches();\n    }\n  }, [branchDialogOpen, user?.uid, branchesLoaded]);\n\n  // Reset add branch form visibility when dialog closes\n  useEffect(() => {\n    if (!branchDialogOpen) {\n      setShowAddBranchForm(false);\n    }\n  }, [branchDialogOpen]);\n\n  const [branchEditOpen, setBranchEditOpen] = useState(false);\n  const [selectedBranchToEdit, setSelectedBranchToEdit] = useState<any>(null);\n  const [editBranchName, setEditBranchName] = useState('');\n  const [editManagerName, setEditManagerName] = useState('');\n  const [editBranchEmail, setEditBranchEmail] = useState('');\n  const [editBranchLoading, setEditBranchLoading] = useState(false);\n\n  const openEditBranchDialog = (branch: any) => {\n    setSelectedBranchToEdit(branch);\n    setEditBranchName(branch.branchName || '');\n    setEditManagerName(branch.managerName || '');\n    // Try multiple possible keys for the email/username\n    setEditBranchEmail(branch.loginUsername || branch.email || branch.username || '');\n    setBranchEditOpen(true);\n  };\n\n  const handleUpdateBranch = async () => {\n    if (!selectedBranchToEdit || !editBranchName || !editManagerName) return;\n    setEditBranchLoading(true);\n    try {\n        const updates = {\n            branchName: editBranchName,\n            managerName: editManagerName,\n            updatedAt: new Date()\n        };\n\n        // 1. Update in subcollection\n        if (selectedBranchToEdit.branchUserId) {\n             try { \n                 await setDoc(doc(db, 'users', user?.uid || '', 'branches', String(selectedBranchToEdit.branchUserId)), updates, { merge: true });\n                 \n                 // Update the actual branch user document if needed (optional, but good for consistency)\n                 // We might not have permission to write to other users root doc unless admin, but usually creator has some rights or we skip it.\n                 // Actually, usually we can't update another user's root doc directly from client unless rules allow.\n                 // We will try, but catch error.\n                 try {\n                     await updateDoc(doc(db, 'users', selectedBranchToEdit.branchUserId), {\n                         displayName: editBranchName, // Assuming branchName maps to displayName\n                         managerName: editManagerName\n                     });\n                 } catch (e) { console.warn('Could not update branch root user doc', e); }\n\n             } catch (e) { console.warn('Sub branch update failed:', e); }\n        }\n        \n        // 2. Update in root collection (Legacy)\n        try { await updateDoc(doc(db, 'branches', selectedBranchToEdit.id), updates); } catch (e) { }\n\n        // Update local state\n        setBranches(prev => prev.map(b => {\n            if (b.id === selectedBranchToEdit.id) {\n                return { ...b, ...updates };\n            }\n            return b;\n        }));\n        \n        toast({ title: '    ' });\n        setBranchEditOpen(false);\n    } catch (e: any) {\n        console.error('Error updating branch:', e);\n        toast({ title: '  ', description: e.message, variant: 'destructive' });\n    } finally {\n        setEditBranchLoading(false);\n    }\n  };\n\n  const fetchBranchDetails = async (branch: any) => {\n    if (!branch?.branchUserId) {\n      toast({ title: '', description: '   ', variant: 'destructive' });\n      return;\n    }\n    setBranchDetailsLoading(true);\n    setBranchDetailsOpen(true);\n    try {\n      const uid = branch.branchUserId;\n\n      // Self-healing: Ensure branch link exists for security rules\n      // Optimization: Only sync/wait if strictly necessary (legacy branches or missing source)\n      if (user?.uid && branch.branchUserId && branch.source !== 'sub') {\n         try {\n             // Ensure the branch document exists in the subcollection so isBranchOwner rule passes\n             // Only save necessary fields to avoid 'undefined' errors or large payloads\n             await setDoc(doc(db, 'users', user.uid, 'branches', branch.branchUserId), {\n                 branchUserId: branch.branchUserId,\n                 branchName: branch.branchName || 'Unknown Branch',\n                 managerName: branch.managerName || '',\n                 active: true,\n                 lastSynced: serverTimestamp()\n             }, { merge: true });\n             console.log(' Branch link synced successfully');\n             // Wait a moment for Firestore rules to propagate the new document existence\n             await new Promise(resolve => setTimeout(resolve, 500));\n         } catch (e) {\n             console.error(' Failed to sync branch link:', e);\n             // Don't throw, try to proceed, but it will likely fail\n         }\n      }\n\n      // Parallel Fetching of all required data\n      const [userDocSnap, walletsSnap, debtsSnap, salesSnap] = await Promise.all([\n        // 1. Fetch User Profile\n        getDoc(doc(db, 'users', uid)),\n        \n        // 2. Fetch Wallets\n        (async () => {\n          try {\n            // Priority 1: Merchant Wallets (New System)\n            const qMerchant = fsQuery(collection(db, 'merchantWallets'), where('merchantUserId', '==', uid));\n            const snapMerchant = await getDocs(qMerchant);\n            if (!snapMerchant.empty) return snapMerchant;\n\n            // Priority 2: User Subcollection\n            const snapSub = await getDocs(collection(db, 'users', uid, 'wallets'));\n            if (!snapSub.empty) return snapSub;\n\n            // Priority 3: Legacy Wallets\n            return await getDocs(fsQuery(collection(db, 'wallets'), where('userId', '==', uid)));\n          } catch (e) {\n            console.error(\"Error fetching wallets\", e);\n            // Fallback to legacy query if merchantWallets fails (e.g. permission)\n            try {\n              return await getDocs(fsQuery(collection(db, 'wallets'), where('userId', '==', uid)));\n            } catch { return { docs: [] } as any; }\n          }\n        })(),\n\n        // 3. Fetch Debts\n        (async () => {\n          try {\n            return await getDocs(fsQuery(collection(db, 'debts'), where('userId', '==', uid)));\n          } catch {\n            return await getDocs(collection(db, 'users', uid, 'debts'));\n          }\n        })(),\n\n        // 4. Fetch Sales\n        (async () => {\n          try {\n            const q = fsQuery(collection(db, 'dailySales'), where('userId', '==', uid));\n            const s = await getDocs(q);\n            if (!s.empty) return s;\n            return await getDocs(collection(db, 'users', uid, 'dailySales'));\n          } catch (e) {\n            console.error(\"Error fetching sales\", e);\n            return await getDocs(collection(db, 'users', uid, 'dailySales'));\n          }\n        })()\n      ]);\n\n      // Process Data\n      const userData = userDocSnap.exists() ? userDocSnap.data() : {};\n      const cashBalance = Number(userData.cashBalance || 0);\n      const reportsData = (userData.reportsData || {}) as any;\n      const reportsDailyProfit = Number(reportsData.dailyProfit || 0);\n      const reportsMonthlyProfit = Number(reportsData.monthlyProfit || 0);\n\n      // Calculate Wallets Total from User Profile (Primary Source)\n      const walletBalancesMap = (userData.walletBalances || {}) as Record<string, number>;\n      let walletsTotal = Object.values(walletBalancesMap).reduce((sum, val) => sum + Number(val || 0), 0);\n\n      // Fallback/Legacy: If map is empty, try summing from documents\n      if (walletsTotal === 0 && !walletsSnap.empty) {\n        walletsTotal = walletsSnap.docs.reduce((sum, d) => sum + Number(d.data().balance || d.data().amount || 0), 0);\n      }\n\n      let debtsTotal = 0;\n      debtsSnap.forEach(d => {\n        const data = d.data();\n        // Calculate outstanding debt (amount - paid)\n        if (data.type !== 'debtor') {\n            const paid = Number(data.paidAmount || 0);\n            const outstanding = Math.max(0, Number(data.amount || 0) - paid);\n            debtsTotal += outstanding;\n        }\n      });\n\n      const now = new Date();\n      const todayStr = now.toISOString().split('T')[0];\n      const monthStr = todayStr.slice(0, 7); // YYYY-MM\n\n      let todaySales = 0;\n      let monthSales = 0;\n      let todayProfit = reportsDailyProfit;\n      let monthProfit = reportsMonthlyProfit;\n      let totalSalesSection = 0;\n\n      console.log(`Branch Details - UID: ${uid}, Wallets: ${walletsSnap.size}, Sales: ${salesSnap.size}, ReportsDaily: ${reportsDailyProfit}`);\n\n      salesSnap.forEach(d => {\n        const data = d.data();\n        const date = String(data.date || '');\n        const amount = Number(data.sellingPrice || 0) * Number(data.quantity || 1);\n        const profit = Number(data.profit || 0);\n        \n        totalSalesSection += amount;\n        \n        if (date === todayStr) {\n            todaySales += amount;\n            todayProfit += profit;\n        }\n        if (date.startsWith(monthStr)) {\n            monthSales += amount;\n            monthProfit += profit;\n        }\n      });\n\n      setSelectedBranchDetails({\n        branchName: branch.branchName,\n        managerName: branch.managerName,\n        todaySales,\n        monthSales,\n        todayProfit,\n        monthProfit,\n        walletsTotal,\n        cashBalance,\n        totalSalesSection,\n        debtsTotal\n      });\n\n    } catch (e: any) {\n      console.error('Error fetching branch details:', e);\n      toast({ title: '   ', description: e.message, variant: 'destructive' });\n      setBranchDetailsOpen(false);\n    } finally {\n      setBranchDetailsLoading(false);\n    }\n  };\n\n  const [selectedWallet, setSelectedWallet] = useState<string>('');\n  useEffect(() => {\n    const sid = (params as any)?.shopId;\n    if (sid && user?.uid) {\n      try {\n        const key = `selectedShopId_${user.uid}`;\n        localStorage.setItem(key, String(sid));\n        window.dispatchEvent(new Event('selectedShopIdChanged'));\n      } catch { }\n    }\n  }, [(params as any)?.shopId, user?.uid]);\n  //   ADB      \n  const [adbDevices, setAdbDevices] = useState<Array<{ id: string; model?: string; name?: string; type?: string }>>([]);\n  const [selectedAdbDeviceId, setSelectedAdbDeviceId] = useState<string | null>(() => {\n    try { return localStorage.getItem('cashySelectedDevice') || null; } catch { return null; }\n  });\n\n  // Request SMS Permissions on Mount\n  useEffect(() => {\n    //      SMS      \n    //          .\n  }, []);\n\n  // Sync selected wallet to Capacitor Preferences for Native Receiver\n  useEffect(() => {\n    const syncWalletToNative = async () => {\n      if (selectedWallet) {\n        try {\n          await Preferences.set({ key: 'selected_wallet_id', value: selectedWallet });\n          console.log(' Synced selected_wallet_id to Native:', selectedWallet);\n        } catch (e) {\n          console.error('Failed to sync wallet to native:', e);\n        }\n      } else {\n        await Preferences.remove({ key: 'selected_wallet_id' });\n      }\n    };\n    syncWalletToNative();\n  }, [selectedWallet]);\n\n  // Sync shopId to Capacitor Preferences for Native Receiver\n  useEffect(() => {\n    const syncShopIdToNative = async () => {\n      if (shopIdCtx) {\n        try {\n          await Preferences.set({ key: 'shopId', value: shopIdCtx });\n          console.log(' Synced shopId to Native:', shopIdCtx);\n        } catch (e) {\n          console.error('Failed to sync shopId to native:', e);\n        }\n      }\n    };\n    syncShopIdToNative();\n  }, [shopIdCtx]);\n\n  const isDeviceConnected = (id?: string) => !!(id && adbDevices.some(d => d.id === id));\n\n  async function ensureDeviceReadyBeforeSend(): Promise<string | null> {\n    const api: any = (window as any).electronAPI;\n    const sel = selectedAdbDeviceId || '';\n    if (!api || typeof api.sendUssd !== 'function') return null;\n    try { /*        */ } catch { }\n    if (!sel) {\n      toast({ title: '  ', description: '       ', variant: 'destructive' });\n      return null;\n    }\n    if (isDeviceConnected(sel)) return sel;\n    \n    //   USB   \n    try {\n      const usb = adbDevices.find((d: any) => d && d.id && !String(d.id).includes(':'));\n      if (usb && usb.id) { setSelectedAdbDeviceId(usb.id); return usb.id; }\n    } catch { }\n\n    const ip = sel.includes(':') ? sel.split(':').slice(0, 2).join(':') : '';\n    if (ip && typeof api.connectWifi === 'function') {\n      try { \n        const res = await api.connectWifi(ip); \n        //             \n        if (typeof res === 'string' && (res.includes('') || res.toLowerCase().includes('connected'))) {\n           return sel;\n        }\n      } catch { }\n      \n      //    \n      if (typeof api.refreshAdbDevices === 'function') {\n        try { await api.refreshAdbDevices(); } catch {}\n      }\n      \n      await new Promise(r => setTimeout(r, 250));\n      //        sel.      \n    }\n\n    const base = sel.split(':')[0];\n    const wifiCandidate = adbDevices.find(d => (d.id.startsWith(base) || d.id.includes(base)) && d.id.includes(':'));\n    if (wifiCandidate?.id) {\n      const wifiIp = wifiCandidate.id.split(':').slice(0, 2).join(':');\n      if (!isDeviceConnected(wifiCandidate.id) && typeof api.connectWifi === 'function') {\n        try { \n            const res = await api.connectWifi(wifiIp); \n            if (typeof res === 'string' && (res.includes('') || res.toLowerCase().includes('connected'))) {\n                setSelectedAdbDeviceId(wifiCandidate.id);\n                return wifiCandidate.id;\n            }\n        } catch { }\n        await new Promise(r => setTimeout(r, 250));\n      }\n      if (isDeviceConnected(wifiCandidate.id)) {\n        setSelectedAdbDeviceId(wifiCandidate.id);\n        return wifiCandidate.id;\n      }\n    }\n\n    //  :    IP      (     ) \n    if (sel && ip) {\n       return sel;\n    }\n\n    toast({ title: '  ', description: ' Wireless debugging    WiFi   ', variant: 'destructive' });\n    return null;\n  }\n\n  useEffect(() => {\n    const api: any = (window as any).electronAPI;\n    if (api && typeof api.onAdbDevices === 'function') {\n      api.onAdbDevices((devices: Array<{ id: string; model?: string; name?: string; type?: string }>) => {\n        const list = Array.isArray(devices) ? devices : [];\n        setAdbDevices(list);\n        \n        //               \n        //        \n        const saved = (() => { try { return localStorage.getItem('cashySelectedDevice') || ''; } catch { return ''; } })();\n        \n        if (saved) {\n           //          \n           setSelectedAdbDeviceId(saved);\n        } else if (list[0]?.id) {\n           //       \n           setSelectedAdbDeviceId((prev) => prev || list[0].id);\n        } else {\n           setSelectedAdbDeviceId(null);\n        }\n      });\n    }\n  }, []);\n\n  //         \n  function sendTransfer(receiverPhone: string, amount: number) {\n    try {\n      const sw = getSelectedWalletObj?.();\n      const senderPhone = sw?.phone || '';\n      if (!senderPhone) {\n        toast({ title: '  ', description: '   ', variant: 'destructive' });\n        return;\n      }\n      sendTransferFromWalletDeepLink(senderPhone, receiverPhone, amount);\n      toast({ title: '   ', description: '     ' });\n      setIsPostConfirmPopupOpen(false);\n      setIsPinModalOpen(false);\n    } catch (err: any) {\n      const msg = err?.message || '      ';\n      toast({ title: ' ', description: msg, variant: 'destructive' });\n      throw err;\n    }\n  }\n\n  //       (0  1)\n  const [selectedSimSlotForTransfer, setSelectedSimSlotForTransfer] = useState<number | null>(null);\n\n  //           \n  const triggerSendTransferCode = async () => {\n    if (!lastUSSDTransfer || !lastUSSDTransfer.receiver || !lastUSSDTransfer.amount) {\n      toast({\n        title: '  ',\n        description: '       ',\n        variant: 'destructive',\n      });\n      return;\n    }\n    const receiver = String(lastUSSDTransfer.receiver);\n    const amount = Math.round(Number(lastUSSDTransfer.amount));\n    setUssdLoading(true);\n    //     :      \n    try {\n      //    (Android)     USSD  \n      if (Capacitor?.isNativePlatform && Capacitor.getPlatform() === 'android') {\n        const sw = getSelectedWalletObj?.();\n        const senderPhone = sw?.phone || '';\n        if (!senderPhone) {\n          toast({ title: '  ', description: '   ', variant: 'destructive' });\n          setUssdLoading(false);\n          return;\n        }\n        const code = getUssdCodeBySender(senderPhone, receiver, amount);\n        if (!code) {\n          toast({ title: '  ', description: '    010/011/012/015', variant: 'destructive' });\n          setUssdLoading(false);\n          return;\n        }\n        openUssdDeepLink(code);\n        toast({ title: '   ', description: '     ' });\n        setIsPostConfirmPopupOpen(false);\n        setIsPinModalOpen(false);\n        return;\n      }\n\n      //      ADB    \n      const api: any = (window as any).electronAPI;\n      if (api && typeof api.sendUssd === 'function' && selectedAdbDeviceId) {\n        const sw = getSelectedWalletObj?.();\n        const senderPhone = sw?.phone || '';\n        if (!senderPhone) {\n          toast({ title: '  ', description: '   ', variant: 'destructive' });\n          setUssdLoading(false);\n          return;\n        }\n        const readyId = await ensureDeviceReadyBeforeSend();\n        if (!readyId) { setUssdLoading(false); return; }\n        const code = getUssdCodeBySender(senderPhone, receiver, amount);\n        if (!code) {\n          toast({ title: '  ', description: '    010/011/012/015', variant: 'destructive' });\n          setUssdLoading(false);\n          return;\n        }\n        try {\n          //       \n          let decoratedId = '';\n          if (selectedSimSlotForTransfer !== null) {\n            decoratedId = `${readyId}:sim${selectedSimSlotForTransfer}`;\n          } else {\n            //    \n            const pick = typeof api.pickSimAutomatically === 'function'\n              ? await api.pickSimAutomatically(readyId, senderPhone)\n              : { deviceId: readyId, slot: 0 };\n            decoratedId = `${pick.deviceId}:sim${pick.slot}`;\n          }\n\n          setLastDecoratedDeviceId(decoratedId);\n          await api.sendUssd(decoratedId, code);\n        } catch (e1: any) {\n          try {\n            await api.sendUssd(readyId, code);\n          } catch (e2: any) {\n            const maybeIp = readyId.includes(':') ? readyId.split(':').slice(0, 2).join(':') : '';\n            if (maybeIp && typeof api.connectWifi === 'function') {\n              await api.connectWifi(maybeIp);\n              await api.sendUssd(readyId, code);\n            } else {\n              throw e2;\n            }\n          }\n        }\n\n        toast({ title: '   ', description: '  ' });\n        setIsPostConfirmPopupOpen(false);\n        setIsPinModalOpen(true);\n      } else {\n        //           \n        //               \n        sendTransfer(receiver, amount);\n      }\n    } catch (e: any) {\n      const msg = (e && e.message) ? e.message : '     ';\n      const dev = (lastDecoratedDeviceId || selectedAdbDeviceId || ' ');\n      toast({ title: '  ', description: `: ${dev}  ${msg}`, variant: 'destructive' });\n    } finally {\n      setUssdLoading(false);\n    }\n  };\n\n\n  //   USSD   ADB   electronAPI\n  const handleSendUssd = async () => {\n    //        :   \n    await triggerSendTransferCode();\n  };\n\n  //         \n  const handlePinSubmit = async (deviceId: string, pin: string) => {\n    const api: any = (window as any).electronAPI;\n    try {\n      if (api && typeof api.enterPin === 'function' && deviceId) {\n        await api.enterPin(deviceId, pin);\n        setIsPinModalOpen(false);\n        return;\n      }\n\n      //   ADB:  PIN       \n      const rawLink = String((profile as any)?.bridgeLink || '').trim();\n      const devId = String((profile as any)?.bridgeDeviceId || '').trim() || undefined;\n      if (!rawLink) {\n        toast({ title: '  ', description: '   ', variant: 'destructive' });\n        return;\n      }\n      const receiverDigits = String((lastUSSDTransfer?.receiver || receiverPhone || '')).replace(/\\D/g, '');\n      const amountInt = Math.max(1, Math.round(Number(lastUSSDTransfer?.amount || amount || 0)) || 0);\n      const pinDigits = String(pin || '').replace(/\\D/g, '');\n      const normalizeLink = (url: string) => {\n        let u = (url || '').trim();\n        u = u.replace(/\\/+$/, '');\n        if (!/^https?:\\/\\//i.test(u)) u = `https://${u}`;\n        return u;\n      };\n      const baseUrl = normalizeLink(rawLink);\n      //        PIN    \n      setIsPinModalOpen(false);\n    } catch (err: any) {\n      const msg = err?.message || '     ';\n      toast({ title: ' ', description: msg, variant: 'destructive' });\n    }\n  };\n\n  console.log(' UserDashboardPage - user:', user ? 'exists' : 'null');\n\n  //    -   \n  const [isUserActive, setIsUserActive] = useState<boolean>(true);\n  const [isCheckingActivation, setIsCheckingActivation] = useState<boolean>(true);\n\n  //   \n  const [isShopExpensesDialogOpen, setIsShopExpensesDialogOpen] = useState(false);\n  const [isShopExpensesPinDialogOpen, setIsShopExpensesPinDialogOpen] = useState(false);\n  const [expenseName, setExpenseName] = useState('');\n  const [expenseAmount, setExpenseAmount] = useState('');\n  const [expenseNotes, setExpenseNotes] = useState('');\n  const [expenses, setExpenses] = useState<ShopExpense[]>([]);\n  const [isExpenseDeductionChoiceOpen, setIsExpenseDeductionChoiceOpen] = useState(false);\n  const [expenseDeductionSource, setExpenseDeductionSource] = useState<'cash' | 'wallet' | 'fawry' | null>(null);\n  const [selectedWalletForExpense, setSelectedWalletForExpense] = useState('');\n  const [isReceiptsOpen, setIsReceiptsOpen] = useState(false);\n  const [isReceiptsDialogOpen, setIsReceiptsDialogOpen] = useState(false);\n  const [showActivationModal, setShowActivationModal] = useState<boolean>(false);\n\n  //  \n  const [isDeficienciesDialogOpen, setIsDeficienciesDialogOpen] = useState(false);\n  const [deficiencyName, setDeficiencyName] = useState('');\n  const [deficiencyQuantity, setDeficiencyQuantity] = useState('');\n  const [deficiencies, setDeficiencies] = useState<DeficiencyItem[]>([]);\n\n  //   \n  const [isOnFreeTrial, setIsOnFreeTrial] = useState<boolean>(false);\n  const [freeTrialHoursRemaining, setFreeTrialHoursRemaining] = useState<number>(0);\n  const [hasUsedFreeTrial, setHasUsedFreeTrial] = useState<boolean>(false);\n\n  //  \n  const [userSubscription, setUserSubscription] = useState<SubscriptionData | null>(null);\n  const [branchPackage, setBranchPackage] = useState<any>(null); // New local state for branch package\n  const [isRefreshingSubscription, setIsRefreshingSubscription] = useState<boolean>(false);\n\n\n\n  //   useState\n  const [senderPhone, setSenderPhone] = useState<string>('');\n  const [receiverPhone, setReceiverPhone] = useState('');\n  const [amount, setAmount] = useState('');\n  const [withdrawNote, setWithdrawNote] = useState('');\n  const [withdrawSenderName, setWithdrawSenderName] = useState('');\n  //      \n  const [isQuickDebtOpen, setIsQuickDebtOpen] = useState(false);\n  const [quickDebtName, setQuickDebtName] = useState('');\n  const [quickDebtAmount, setQuickDebtAmount] = useState('');\n  const [quickDebtNotes, setQuickDebtNotes] = useState('');\n  const [quickDebtCustomerId, setQuickDebtCustomerId] = useState<string>('');\n  const [quickDebtInfo, setQuickDebtInfo] = useState<{\n    debtorName: string;\n    amount: number;\n    notes?: string;\n    customerId?: string;\n    mobile?: string;\n  } | null>(null);\n  const [didCreateQuickDebt, setDidCreateQuickDebt] = useState<boolean>(false);\n  const [isWalletsDialogOpen, setIsWalletsDialogOpen] = useState<boolean>(false);\n  const [isWalletsPinDialogOpen, setIsWalletsPinDialogOpen] = useState<boolean>(false);\n  // PIN gating for changing selected wallet\n  const [isWalletSelectionPinDialogOpen, setIsWalletSelectionPinDialogOpen] = useState<boolean>(false);\n  const [pendingSelectedWalletId, setPendingSelectedWalletId] = useState<string | null>(null);\n  const [manualCommission, setManualCommission] = useState(''); //    \n  const [transferCommission, setTransferCommission] = useState(''); //    \n  const [transferExtraFee, setTransferExtraFee] = useState(''); //      (010011)\n  const [isMonthlyLimitWarnOpen, setIsMonthlyLimitWarnOpen] = useState(false);\n  const [selectedQuickIcon, setSelectedQuickIcon] = useState<string | null>(null);\n  const [monthlyLimitWarnData, setMonthlyLimitWarnData] = useState<{ type: 'withdraw' | 'transfer'; used: number; limit: number; walletName: string } | null>(null);\n  const [isWithdrawSenderNameInputEnabled, setIsWithdrawSenderNameInputEnabled] = useState<boolean>(false);\n  useEffect(() => {\n    const loadSetting = async () => {\n      try {\n        const key = user?.uid ? `withdrawSenderNameInputEnabled_${user?.uid}` : 'withdrawSenderNameInputEnabled';\n        let v: string | null = null;\n        try { v = localStorage.getItem(key) ?? localStorage.getItem('withdrawSenderNameInputEnabled'); } catch {}\n        if (user?.uid) {\n          try {\n            const data = await withRetry(() => userDataService.getUserData(user.uid));\n            const remote: any = (data as any)?.withdrawSenderNameInputEnabled;\n            if (typeof remote === 'boolean') {\n              setIsWithdrawSenderNameInputEnabled(remote);\n              try { localStorage.setItem(key, remote ? 'true' : 'false'); } catch {}\n              return;\n            }\n          } catch {}\n        }\n        setIsWithdrawSenderNameInputEnabled(v === 'true' ? true : false);\n      } catch {\n        setIsWithdrawSenderNameInputEnabled(false);\n      }\n    };\n    loadSetting();\n  }, [user?.uid]);\n  // Helper: normalize Arabic/Persian digits to ASCII\n  const normalizeDigits = (s: string) => {\n    const arabicIndic = '';\n    const easternIndic = '';\n    return (s || '').split('').map(ch => {\n      const ai = arabicIndic.indexOf(ch);\n      if (ai > -1) return String(ai);\n      const ei = easternIndic.indexOf(ch);\n      if (ei > -1) return String(ei);\n      return ch;\n    }).join('');\n  };\n\n  // Prefill latest pending SMS into withdraw form\n  const normalizeToLocalMsisdn = (input: string): string => {\n    const digits = normalizeDigits(input || '').replace(/\\D/g, '');\n    if (!digits) return '';\n    // Handle common Egypt formats: 201XXXXXXXXX, +201XXXXXXXXX, 010XXXXXXXXX, 011, 012, 015\n    if (digits.startsWith('201') && digits.length === 12) {\n      // 2010XXXXXXXX -> 010XXXXXXXX\n      return '0' + digits.slice(2);\n    }\n    if (digits.startsWith('00201') && digits.length === 14) {\n      return '0' + digits.slice(4);\n    }\n    if (digits.startsWith('01') && digits.length === 11) {\n      return digits;\n    }\n    // Fallback: return original digits; matching will be by digits only\n    return digits;\n  };\n\n  const prefillFromLatest = async () => {\n    try {\n      const res = await fetch('/api/pending_sms');\n      if (!res.ok) throw new Error('   /api/pending_sms');\n      const data = await res.json();\n      if (!Array.isArray(data) || data.length === 0) {\n        toast({ title: '  ', description: '  SMS  ' });\n        return;\n      }\n      const s = data[0] || {};\n      const rawMsisdn = (s.msisdn || s.address || '') as string;\n      const localMsisdn = normalizeToLocalMsisdn(rawMsisdn);\n\n      // Try to select wallet by msisdn\n      if (localMsisdn) {\n        const targetDigits = localMsisdn.replace(/\\D/g, '');\n        const found = wallets.find(w => normalizeDigits(w.phone || '').replace(/\\D/g, '') === targetDigits);\n        if (found) {\n          setWalletSelection(found.id, 'prefillFromLatest');\n        }\n      }\n\n      // Fill amount\n      const rawAmount = (s.amount ?? s.value ?? s.amountEgp ?? '') as any;\n      let nextAmount = '';\n      if (typeof rawAmount === 'number') {\n        nextAmount = String(rawAmount);\n      } else if (typeof rawAmount === 'string' && rawAmount.trim() !== '') {\n        const parsed = parseFloat(normalizeDigits(rawAmount).replace(/[^0-9.]/g, ''));\n        if (!Number.isNaN(parsed)) nextAmount = String(parsed);\n      } else if ((s.message || s.body)) {\n        const msg = normalizeDigits(String(s.message || s.body));\n        const m = msg.match(/([0-9]+(?:\\.[0-9]+)?)/);\n        if (m) nextAmount = m[1];\n      }\n      setAmount(nextAmount || '');\n      setTransactionType('withdraw');\n      toast({ title: '  ', description: '       SMS' });\n    } catch (err: any) {\n      toast({ title: '  ', description: err?.message || '  ', variant: 'destructive' });\n    }\n  };\n\n  const [isCommissionAddMode, setIsCommissionAddMode] = useState<boolean>(() => {\n    try {\n      const v = localStorage.getItem('commissionMode') || localStorage.getItem('commissionMode_default');\n      return v ? v === 'add' : true; // :  \n    } catch { return true; }\n  });\n  const [transactionType, setTransactionType] = useState<'transfer' | 'withdraw'>('transfer');\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\n  const [activeTab, setActiveTab] = useState('all');\n  const [debts, setDebts] = useState<Debt[]>([]);\n  const localTransactionsBuffer = useRef<any[]>([]);\n\n  const recentTransactionsQuery = useQuery({\n    enabled: !!user?.uid,\n    queryKey: ['recentTransactions', user?.uid, (shopIdCtx || 'main')],\n    queryFn: async () => {\n      const { collection, query, where, orderBy, limit, getDocs } = await import('firebase/firestore');\n      const { db } = await import('@/firebase');\n      const q = query(\n        collection(db, 'userTransactions'),\n        where('userId', '==', String(user?.uid || '')),\n        orderBy('createdAt', 'desc'),\n        limit(100)\n      );\n      const snap = await getDocs(q);\n      const items = snap.docs.map((d) => {\n        const data: any = d.data();\n        const created = data.createdAt?.toDate ? data.createdAt.toDate() : new Date(data.createdAt);\n        const rawType = String(data.transactionType || data.txnType || data.type || '').toLowerCase();\n        const type = rawType === 'withdraw' || rawType === 'receive' ? 'withdraw' : 'send';\n        const status = data.status === 'confirmed' ? 'completed' : (data.status || 'completed');\n        const senderPhone = data.senderMsisdn || data.senderPhone || '';\n        const receiverPhone = data.receiverMsisdn || data.receiverPhone || '';\n        const amount = Number(data.amount ?? data.transferredAmount ?? data.withdrawnAmount ?? 0);\n        return { id: d.id, ...data, type, status, senderPhone, receiverPhone, amount, createdAt: created };\n      });\n      const filtered = items.filter((t: any) => !(t?.type === 'report' || String((t as any)?.title || '').includes('  ')));\n      const deletedIds = new Set<string>((deletedTransactions || []).map((dt: any) => String(dt.id || dt.originalTransactionId || '')));\n      const active = filtered.filter((t: any) => !deletedIds.has(String(t.id || '')));\n      const getKey = (t: any) => String(\n        (t as any).transactionId || t.id || (t as any).reference || ((t as any).receipt?.reference) || `${new Date(t.createdAt).getTime()}`\n      );\n      const seen = new Set<string>();\n      const distinct: any[] = [];\n      for (const t of active) {\n        const key = getKey(t);\n        if (!seen.has(key)) { seen.add(key); distinct.push(t); }\n      }\n      return distinct;\n    },\n    staleTime: 60_000,\n    gcTime: 300_000,\n    refetchOnWindowFocus: false,\n    refetchOnReconnect: true,\n  });\n\n  useEffect(() => {\n    const handleTransactionCreated = () => {\n      try {\n        recentTransactionsQuery.refetch();\n      } catch {}\n    };\n    window.addEventListener('transaction-created', handleTransactionCreated);\n    return () => {\n      window.removeEventListener('transaction-created', handleTransactionCreated);\n    };\n  }, [recentTransactionsQuery]);\n\n  useEffect(() => {\n    const data = recentTransactionsQuery.data as any[] | undefined;\n    if (data && Array.isArray(data)) {\n      // Merge with local buffer to prevent data reversion\n      const buffer = localTransactionsBuffer.current;\n      const now = Date.now();\n      // Remove items from buffer that are in data OR older than 5 minutes OR have matching reference in data\n      const activeBuffer = buffer.filter(bt => {\n          const existsById = data.some(dt => dt.id === bt.id);\n          const existsByRef = bt.reference ? data.some(dt => dt.reference === bt.reference) : false;\n          const isOld = (now - new Date(bt.createdAt).getTime()) > 300000; // 5 mins\n          return !existsById && !existsByRef && !isOld;\n      });\n      localTransactionsBuffer.current = activeBuffer;\n      \n      const merged = [...activeBuffer, ...data].sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n      \n      // Deduplicate by ID\n      const seen = new Set();\n      const distinct: any[] = [];\n      for (const t of merged) {\n          if (!seen.has(t.id)) {\n              seen.add(t.id);\n              distinct.push(t);\n          }\n      }\n      setTransactions(distinct);\n    }\n  }, [recentTransactionsQuery.data]);\n\n  useEffect(() => {\n    try {\n      //        \n      localStorage.setItem('commissionMode', isCommissionAddMode ? 'add' : 'deduct');\n      if (user?.uid) {\n        const key = `commissionMode_${user.uid}`;\n        localStorage.setItem(key, isCommissionAddMode ? 'add' : 'deduct');\n      }\n    } catch { }\n  }, [isCommissionAddMode, user?.uid]);\n\n  //     \"\"    :          \"\"\n  useEffect(() => {\n    try {\n      const completedDebtIds = new Set<string>(\n        (transactions || [])\n          .filter((t: any) => String(t?.status || '') === 'completed' && t?.linkedDebtId)\n          .map((t: any) => String(t.linkedDebtId))\n      );\n      if (completedDebtIds.size === 0) return;\n      const updated = debts.map((d) => {\n        if (completedDebtIds.has(String(d.id))) {\n          const amt = Number(d.amount || 0);\n          const paid = Number(d.paidAmount || 0);\n          if (d.status !== 'paid' || paid < amt) {\n            return { ...d, status: 'paid' as const, paidAmount: amt };\n          }\n        }\n        return d;\n      });\n      const changed = updated.some((d, i) => d !== debts[i]);\n      if (changed) {\n        setDebts(updated);\n        (async () => { await saveDebtsToStorage(updated); })();\n        try {\n          if (user?.uid) {\n            const newlyPaid = updated.filter((d, i) => d !== debts[i] && d.status === 'paid');\n            newlyPaid.forEach((dp) => { try { telegramNotifier.send(user.uid!, `     ${dp.debtorName}:  ${Number(dp.paidAmount || dp.amount || 0)} `); } catch {} });\n          }\n        } catch {}\n      }\n    } catch { }\n  }, [transactions, debts, user?.uid]);\n\n  useEffect(() => {\n    try {\n      const userVal = user?.uid ? localStorage.getItem(`commissionMode_${user.uid}`) : null;\n      const globalVal = localStorage.getItem('commissionMode');\n      const defVal = localStorage.getItem('commissionMode_default');\n      const v = userVal ?? globalVal ?? defVal;\n      if (v) setIsCommissionAddMode(v === 'add');\n    } catch { }\n  }, [user?.uid]);\n\n  //    \n  const [isSalesDataOpen, setIsSalesDataOpen] = useState(false);\n  const [pendingBarcode, setPendingBarcode] = useState<string | null>(null);\n  const barcodeBufferRef = React.useRef<string>('');\n  const lastKeyTimeRef = React.useRef<number>(0);\n\n  //        \n  useEffect(() => {\n    const handler = (e: KeyboardEvent) => {\n      if (isSalesDataOpen) return;\n      //   Enter      /\n      try {\n        const active = document.activeElement as HTMLElement | null;\n        if (active) {\n          const tag = active.tagName?.toLowerCase();\n          const isTyping = (\n            tag === 'input' ||\n            tag === 'textarea' ||\n            tag === 'select' ||\n            tag === 'button' ||\n            active.isContentEditable === true\n          );\n          if (isTyping) return;\n        }\n      } catch { }\n      const now = Date.now();\n      if (e.key === 'Enter') {\n        const code = (barcodeBufferRef.current || '').trim();\n        barcodeBufferRef.current = '';\n        if (code) {\n          setPendingBarcode(code);\n          setIsSalesDataOpen(true);\n        }\n        return;\n      }\n      if (e.key.length === 1) {\n        if (now - (lastKeyTimeRef.current || 0) > 100) {\n          barcodeBufferRef.current = '';\n        }\n        barcodeBufferRef.current += e.key;\n        lastKeyTimeRef.current = now;\n      }\n    };\n    window.addEventListener('keydown', handler as unknown as EventListener);\n    return () => window.removeEventListener('keydown', handler as unknown as EventListener);\n  }, [isSalesDataOpen]);\n  const [isWalletManagementOpen, setIsWalletManagementOpen] = useState(false);\n  const [isWalletsListOpen, setIsWalletsListOpen] = useState(false);\n  const [editingWalletForDropdown, setEditingWalletForDropdown] = useState<any | null>(null);\n\n  //        (/)\n  useEffect(() => {\n    if (!isQuickDebtOpen) return;\n    const sw = getSelectedWalletObj();\n    const baseAmount = parseFloat(amount || '0') || 0;\n    let commissionCalc = 0;\n\n    if (transactionType === 'transfer') {\n      if (sw?.defaultTransferCommission != null) {\n        const ratePerThousand = Number(sw.defaultTransferCommission) || 0;\n        commissionCalc = Math.round(((ratePerThousand * baseAmount) / 1000) * 100) / 100;\n      } else {\n        const manual = transferCommission && transferCommission.trim() !== '' ? parseFloat(transferCommission) : 0;\n        commissionCalc = Math.max(0, manual);\n      }\n      const debtAmount = baseAmount + commissionCalc; // :   \n      setQuickDebtAmount((debtAmount || 0).toString());\n    } else {\n      // \n      if (sw?.defaultWithdrawCommission != null) {\n        const ratePerThousand = Number(sw.defaultWithdrawCommission) || 0;\n        commissionCalc = Math.round(((ratePerThousand * baseAmount) / 1000) * 100) / 100;\n      } else {\n        const manual = manualCommission && manualCommission.trim() !== '' ? parseFloat(manualCommission) : Math.round((baseAmount * 0.01) * 100) / 100;\n        commissionCalc = Math.max(0, manual);\n      }\n      const debtAmount = isCommissionAddMode\n        ? baseAmount\n        : Math.max(0, Math.round((baseAmount - commissionCalc) * 100) / 100);\n      setQuickDebtAmount((debtAmount || 0).toString());\n    }\n  }, [isQuickDebtOpen, amount, transferCommission, manualCommission, selectedWallet, isCommissionAddMode, transactionType]);\n\n  //        fallback   \n  const getSelectedWalletObj = () => {\n    let sw = wallets.find((w: any) => w.id === selectedWallet);\n    if (!sw) {\n      try {\n        const savedWalletsStr = localStorage.getItem(getWalletsKey());\n        if (savedWalletsStr) {\n          const parsedWallets = JSON.parse(savedWalletsStr);\n          if (Array.isArray(parsedWallets) && parsedWallets.length > 0) {\n            const savedSelected = localStorage.getItem(getSelectedWalletKey());\n            const candidateId = savedSelected || parsedWallets.find((w: any) => w.isDefault)?.id || parsedWallets[0]?.id;\n            sw = parsedWallets.find((w: any) => w.id === candidateId);\n          }\n        }\n      } catch (e) {\n        //        \n      }\n    }\n    return sw;\n  };\n  //             \n  useLayoutEffect(() => {\n    try {\n      //          user\n      const preferredKey = `wallets_${user?.uid || 'default'}`;\n      let savedWalletsStr = localStorage.getItem(preferredKey);\n      if (!savedWalletsStr) {\n        const anyWalletKey = Object.keys(localStorage).find(k => k.startsWith('wallets_'));\n        if (anyWalletKey) {\n          savedWalletsStr = localStorage.getItem(anyWalletKey) || null;\n        }\n      }\n      if (savedWalletsStr) {\n        const parsedWallets = JSON.parse(savedWalletsStr);\n        if (Array.isArray(parsedWallets) && parsedWallets.length > 0) {\n          //        \n          setWallets(parsedWallets);\n          const savedSelected = localStorage.getItem(getSelectedWalletKey());\n          const walletToSelect =\n            (savedSelected && parsedWallets.find((w: any) => w.id === savedSelected)) ||\n            parsedWallets.find((w: any) => w.isDefault) ||\n            parsedWallets[0];\n          if (walletToSelect) {\n            setSelectedWallet(walletToSelect.id);\n            setSenderPhone(walletToSelect.phone);\n          }\n        }\n      }\n    } catch (e) {\n      console.error('      :', e);\n    }\n    //       \n  }, []);\n\n  // Add logging for selectedWallet state changes\n  useEffect(() => {\n    console.log(' selectedWallet state changed to:', selectedWallet);\n  }, [selectedWallet]);\n\n  //           \n  useEffect(() => {\n    loadExpensesFromStorage();\n  }, [user?.uid]);\n\n  //     \n  useEffect(() => {\n    loadDeficienciesFromStorage();\n  }, []);\n\n  const walletsQuery = useQuery({\n    enabled: !!user?.uid,\n    queryKey: ['wallets', user?.uid],\n    queryFn: async () => {\n      const { merchantWalletService } = await import('@/integrations/firebase/services');\n      const list: any[] = await merchantWalletService.getByMerchantId(String(user?.uid || ''));\n      const actives = (Array.isArray(list) ? list : []).filter((w: any) => (w as any).isActive === true);\n      return actives.map((w: any) => ({\n        id: w.id,\n        name: w.label || '  ',\n        phone: w.msisdn,\n        isDefault: !!(w as any).isDefault,\n        monthlyWithdrawalLimit: (w.monthlyWithdrawalLimit ?? w.withdrawLimit ?? 200000),\n        monthlyTransferLimit: (w.monthlyTransferLimit ?? w.transferLimit ?? 200000),\n        defaultTransferCommission: (w.defaultTransferCommission != null ? Number(w.defaultTransferCommission) : null),\n        defaultWithdrawCommission: (w.defaultWithdrawCommission != null ? Number(w.defaultWithdrawCommission) : null)\n      }));\n    },\n    staleTime: 60_000,\n    gcTime: 300_000,\n    refetchOnReconnect: true,\n  });\n\n  useEffect(() => {\n    const data = walletsQuery.data as any[] | undefined;\n    if (data && Array.isArray(data)) {\n      setWallets(data as any);\n      const savedSelectedWallet = localStorage.getItem(getSelectedWalletKey());\n      const hasCurrent = !!(selectedWallet && data.find((w: any) => w.id === selectedWallet));\n      if (!hasCurrent) {\n        const candidateId = (savedSelectedWallet && data.find((w: any) => w.id === savedSelectedWallet)) ? savedSelectedWallet : (data[0]?.id || '');\n        if (candidateId) {\n          setSelectedWallet(candidateId);\n          const obj = data.find((w: any) => w.id === candidateId);\n          setSenderPhone(String(obj?.phone || ''));\n        }\n      }\n    }\n  }, [walletsQuery.data]);\n\n  // Listen for external updates (e.g. from popup transactions) to update balances immediately\n  useEffect(() => {\n    const handleExternalUpdate = (event: any) => {\n      const { cashBalance: newCash, walletBalances: newWallets, newTransaction, limitUpdate, delta } = event.detail || {};\n      \n      // Handle Delta Update (Preferred for optimistic updates to avoid zeroing)\n      if (delta) {\n          const { amount, type, walletId, commission } = delta;\n          const amt = Number(amount || 0);\n          const comm = Number(commission || 0);\n          \n          setCashBalance(prev => {\n              let change = 0;\n              if (type === 'withdraw') {\n                  // Merchant gives cash, keeps commission (net cash out = amount - commission)\n                  change = -amt + comm;\n              } else if (type === 'send' || type === 'transfer') {\n                  // Merchant receives cash + commission\n                  change = amt + comm;\n              }\n              const newVal = prev + change;\n              \n              try {\n                const cashKey = getCashBalanceKey();\n                localStorage.setItem(cashKey, String(newVal));\n                const now = new Date().toISOString();\n                localStorage.setItem(cashKey + '_lastUpdated', now);\n                \n                // Update main userData object for sync\n                if (user?.uid) {\n                  const localDataKey = `userData_${user.uid}`;\n                  const existing = localStorage.getItem(localDataKey);\n                  const parsed = existing ? JSON.parse(existing) : {};\n                  const updated = { ...parsed, cashBalance: newVal, lastUpdated: now };\n                  localStorage.setItem(localDataKey, JSON.stringify(updated));\n                  setHasLocalDataToSync(true);\n                }\n              } catch {}\n              return newVal;\n          });\n          \n          if (walletId) {\n              setWalletBalances(prev => {\n                  const currentVal = Number(prev[walletId] || 0);\n                  let change = 0;\n                  if (type === 'withdraw') {\n                      // Merchant receives e-money\n                      change = amt;\n                  } else if (type === 'send' || type === 'transfer') {\n                      // Merchant sends e-money\n                      change = -amt;\n                  }\n                  const newVal = currentVal + change;\n                  const updatedWallets = { ...prev, [walletId]: newVal };\n                  \n                  try {\n                    const walletKey = getWalletBalancesKey();\n                    localStorage.setItem(walletKey, JSON.stringify(updatedWallets));\n                    const now = new Date().toISOString();\n                    localStorage.setItem(walletKey + '_lastUpdated', now);\n\n                    // Update main userData object for sync\n                    if (user?.uid) {\n                      const localDataKey = `userData_${user.uid}`;\n                      const existing = localStorage.getItem(localDataKey);\n                      const parsed = existing ? JSON.parse(existing) : {};\n                      const updated = { ...parsed, walletBalances: updatedWallets, lastUpdated: now };\n                      localStorage.setItem(localDataKey, JSON.stringify(updated));\n                      setHasLocalDataToSync(true);\n                    }\n                  } catch {}\n                  return updatedWallets;\n              });\n          }\n      }\n\n      if (typeof newCash === 'number') {\n        setCashBalance(newCash);\n        try {\n          const cashKey = getCashBalanceKey();\n          localStorage.setItem(cashKey, String(newCash));\n          const now = new Date().toISOString();\n          localStorage.setItem(cashKey + '_lastUpdated', now);\n\n          // Update main userData object for sync\n          if (user?.uid) {\n            const localDataKey = `userData_${user.uid}`;\n            const existing = localStorage.getItem(localDataKey);\n            const parsed = existing ? JSON.parse(existing) : {};\n            const updated = { ...parsed, cashBalance: newCash, lastUpdated: now };\n            localStorage.setItem(localDataKey, JSON.stringify(updated));\n            setHasLocalDataToSync(true);\n          }\n        } catch {}\n      }\n      \n      if (newWallets && typeof newWallets === 'object') {\n        setWalletBalances(newWallets);\n        try {\n          const walletKey = getWalletBalancesKey();\n          localStorage.setItem(walletKey, JSON.stringify(newWallets));\n          const now = new Date().toISOString();\n          localStorage.setItem(walletKey + '_lastUpdated', now);\n\n          // Update main userData object for sync\n          if (user?.uid) {\n            const localDataKey = `userData_${user.uid}`;\n            const existing = localStorage.getItem(localDataKey);\n            const parsed = existing ? JSON.parse(existing) : {};\n            const updated = { ...parsed, walletBalances: newWallets, lastUpdated: now };\n            localStorage.setItem(localDataKey, JSON.stringify(updated));\n            setHasLocalDataToSync(true);\n          }\n        } catch {}\n      }\n\n      if (limitUpdate && limitUpdate.walletId === selectedWallet) {\n          setSelectedWalletLimits(prev => {\n              if (!prev) return prev;\n              const amount = Number(limitUpdate.amount || 0);\n              const isTransfer = limitUpdate.type === 'transfer';\n              const newLimits = { ...prev };\n              if (isTransfer) {\n                  newLimits.dailyTransferUsed = (newLimits.dailyTransferUsed || 0) + amount;\n                  newLimits.monthlyTransferUsed = (newLimits.monthlyTransferUsed || 0) + amount;\n              } else {\n                  newLimits.dailyWithdrawUsed = (newLimits.dailyWithdrawUsed || 0) + amount;\n                  newLimits.monthlyWithdrawUsed = (newLimits.monthlyWithdrawUsed || 0) + amount;\n              }\n              return newLimits;\n          });\n      }\n      \n      if (newTransaction) {\n        // Add to local buffer to persist through refetches\n        try {\n            if (localTransactionsBuffer.current) {\n                if (!localTransactionsBuffer.current.some((t: any) => t.id === newTransaction.id)) {\n                    localTransactionsBuffer.current.push(newTransaction);\n                }\n            }\n        } catch {}\n\n        setTransactions((prev: any[]) => {\n          if (prev.some(t => t.id === newTransaction.id)) {\n            return prev;\n          }\n          return [newTransaction, ...prev];\n        });\n        \n        toast({\n          title: \"   \",\n          description: \"    \",\n        });\n        \n        // Trigger refetch of recent transactions to be safe\n        try { recentTransactionsQuery.refetch(); } catch {}\n      }\n    };\n\n    window.addEventListener('dashboard:external-update', handleExternalUpdate);\n    return () => window.removeEventListener('dashboard:external-update', handleExternalUpdate);\n  }, [selectedWallet]);\n\n\n  //       \n  const [walletSearch, setWalletSearch] = useState('');\n  const filteredWallets = (() => {\n    const query = walletSearch.replace(/\\D/g, '');\n    if (!query) return wallets;\n    return wallets.filter(w => (w.phone || '').replace(/\\D/g, '').includes(query));\n  })();\n  const [selectedTransaction, setSelectedTransaction] = useState<Transaction | null>(null);\n  const [isTransactionDetailsOpen, setIsTransactionDetailsOpen] = useState(false);\n  const [isReceiptOpen, setIsReceiptOpen] = useState(false);\n  const [receiptTransaction, setReceiptTransaction] = useState<any | null>(null);\n  const [dailyStats, setDailyStats] = useState<DailyStats[]>([]);\n  const [monthlyStatsArray, setMonthlyStatsArray] = useState<MonthlyStats[]>([]);\n\n  //  \n  const [isResetDialogOpen, setIsResetDialogOpen] = useState(false);\n  const [resetType, setResetType] = useState<'daily' | 'monthly'>('daily');\n\n  //  \n  const [deletedTransactions, setDeletedTransactions] = useState<Transaction[]>([]);\n  const [isRealtimeActive, setIsRealtimeActive] = useState(false);\n  const deletedEffectsAppliedRef = React.useRef<Set<string>>(new Set());\n  const limitsRollbackAppliedRef = React.useRef<Set<string>>(new Set());\n  const transactionsRef = React.useRef<Transaction[]>([]);\n  useEffect(() => { transactionsRef.current = transactions; }, [transactions]);\n\n  //          \n  const applyLocalDeleteEffects = async (tx: Transaction) => {\n    try {\n      if (!user) return;\n      //          \n      const cashKey = getCashBalanceKey();\n      const walletKey = getWalletBalancesKey();\n      const savedCash = localStorage.getItem(cashKey);\n      const savedWallets = localStorage.getItem(walletKey);\n      let newCashBalance = savedCash ? parseFloat(savedCash) : cashBalance;\n      let newWalletBalances: Record<string, number> = savedWallets ? JSON.parse(savedWallets) : { ...walletBalances };\n\n      const amountVal = Number((tx as any).withdrawnAmount ?? (tx as any).sentAmount ?? (tx as any).transferredAmount ?? tx.amount ?? 0);\n\n      if ((tx as any).type === 'send' && ((tx as any).fromWallet || selectedWallet)) {\n        // :      \n        newCashBalance -= amountVal;\n        const walletId = (tx as any).fromWallet || selectedWallet!;\n        newWalletBalances[walletId] = (newWalletBalances[walletId] || 0) + amountVal;\n      } else if ((tx as any).type === 'withdraw' && ((tx as any).fromWallet || selectedWallet)) {\n        // :      \n        newCashBalance += amountVal;\n        const walletId = (tx as any).fromWallet || selectedWallet!;\n        newWalletBalances[walletId] = Math.max(0, (newWalletBalances[walletId] || 0) - amountVal);\n      }\n\n      //    \n      setCashBalance(newCashBalance);\n      setWalletBalances(newWalletBalances);\n      const timestamp = new Date().toISOString();\n      localStorage.setItem(cashKey, newCashBalance.toString());\n      localStorage.setItem(cashKey + '_lastUpdated', timestamp);\n      localStorage.setItem(walletKey, JSON.stringify(newWalletBalances));\n      localStorage.setItem(walletKey + '_lastUpdated', timestamp);\n\n      //      Firebase ( )\n      const updateData = {\n        cashBalance: newCashBalance,\n        walletBalances: newWalletBalances,\n        lastUpdated: new Date().toISOString()\n      };\n      const localDataKey = `userData_${user?.uid}`;\n      localStorage.setItem(localDataKey, JSON.stringify(updateData));\n      try {\n        await userDataService.updateUserData(user.uid, updateData);\n        localStorage.removeItem(localDataKey);\n        setHasLocalDataToSync(false);\n      } catch (err) {\n        console.warn('    Firebase   ( ):', err);\n        setHasLocalDataToSync(true);\n      }\n\n      //    /\n      try {\n        const walletId = (tx as any).fromWallet || selectedWallet!;\n        const opType = (tx as any).type === 'send' ? 'transfer' : 'withdraw';\n        //  rollbackUsage        \n        await walletDailyLimitsService.rollbackUsage(walletId, amountVal, opType as any, tx.createdAt);\n      } catch (e) {\n        console.warn('      ():', e);\n      }\n\n      //     /\n      try {\n        reportsService.removeTransactionEffects(tx as any, user.uid);\n      } catch (e) {\n        console.warn('     ():', e);\n      }\n    } catch (e) {\n      console.warn('     :', e);\n    }\n  };\n\n  //         \n  const handleDeleteReceipt = async (transactionId: string) => {\n    try {\n      const tx = transactions.find(t => t.id === transactionId);\n      if (!tx || !user) return;\n      const idStr = String(transactionId);\n      const refStr = String((tx as any)?.transactionId || (tx as any)?.reference || '');\n      const alreadyApplied = deletedEffectsAppliedRef.current.has(idStr) || (refStr && deletedEffectsAppliedRef.current.has(refStr));\n\n      //        (   Firestore )\n      const updatedTransactions = transactions.filter(t => t.id !== transactionId);\n      setTransactions(updatedTransactions);\n\n      //    Firebase   \n      try {\n        await userDataService.removeUserTransaction(user.uid, transactionId);\n        await auditLogService.permanentlyDeleteTransaction(transactionId, user.uid);\n      } catch (e) {\n        console.warn('        :', e);\n      }\n      //      \n      if (!alreadyApplied) {\n        deletedEffectsAppliedRef.current.add(idStr);\n        if (refStr) deletedEffectsAppliedRef.current.add(refStr);\n        await applyLocalDeleteEffects(tx);\n        try { if (user?.uid) userDataService.removeLocalReceiptById(user.uid, transactionId); } catch { }\n      }\n\n      toast({\n        title: '  ',\n        description: '         .',\n      });\n\n      setIsReceiptOpen(false);\n    } catch (err) {\n      console.error('   :', err);\n      toast({\n        title: '   ',\n        description: '     .',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  //  :     \n  const handleCompleteReceipt = async (transactionId: string) => {\n    try {\n      const tx = transactions.find(t => t.id === transactionId);\n      if (!tx || !user) return;\n\n      //   : 5   /\n      try {\n        const plan = userSubscription?.planType;\n        if (plan === SubscriptionPlan.ZERO) {\n          const { dailyOperationCountService } = await import('@/utils/dailyOperationCountService');\n          const opType = (tx as any).type === 'send' ? 'transfer' : 'withdraw';\n          const res = await dailyOperationCountService.checkAndIncrement(user.uid, opType, 5);\n          if (!res.allowed) {\n            toast({\n              title: '    ',\n              description: '   5   /.     .',\n              variant: 'destructive',\n            });\n            return;\n          }\n        } else if (plan === SubscriptionPlan.TAHWEELA) {\n          const { dailyOperationCountService } = await import('@/utils/dailyOperationCountService');\n          const opType = (tx as any).type === 'send' ? 'transfer' : 'withdraw';\n          const res = await dailyOperationCountService.checkAndIncrementCombined(user.uid, opType, 40);\n          if (!res.allowed) {\n            toast({\n              title: '    ',\n              description: '     40  / .',\n              variant: 'destructive',\n            });\n            return;\n          }\n        }\n      } catch (limitErr) {\n        console.warn('     :', limitErr);\n      }\n\n      await updateDoc(doc(db, 'userTransactions', transactionId), {\n        status: 'completed',\n        confirmedAt: new Date()\n      });\n\n      setTransactions(prev => prev.map(t => t.id === transactionId ? { ...t, status: 'completed' } : t));\n\n      toast({\n        title: ' ',\n        description: '   .'\n      });\n\n      setIsReceiptOpen(false);\n    } catch (err) {\n      console.error('   :', err);\n      toast({\n        title: ' ',\n        description: '      .',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  //          \n  useEffect(() => {\n    if (!user) return;\n    const fetchDeletedTransactions = async () => {\n      try {\n        const q = fsQuery(collection(db, 'deletedTransactions'), where('userId', '==', user.uid), orderBy('createdAt', 'desc'), limit(50));\n        const snap = await getDocs(q);\n        \n        snap.docs.forEach((doc) => {\n          const data: any = doc.data();\n          const originalId = String(data?.originalTransactionId || '');\n          const txnId = String(data?.transactionId || '');\n          const refId = String(data?.reference || '');\n          const key = originalId || txnId || refId || String(doc.id);\n          \n          if (!key) return;\n          if (deletedEffectsAppliedRef.current.has(key)) return;\n          \n          deletedEffectsAppliedRef.current.add(key);\n          setTransactions((prev) => {\n            const tx = prev.find((t) => t.id === originalId);\n            if (!tx) return prev; \n            \n            //     \n            (async () => { await applyLocalDeleteEffects(tx); })();\n            \n            return prev.filter((t) => t.id !== originalId);\n          });\n        });\n      } catch (e) {\n        console.warn('   :', e);\n      }\n    };\n    \n    fetchDeletedTransactions();\n  }, [user?.uid]);\n\n  //        \n  //           \n  useEffect(() => {\n    if (!user) return;\n    const checkReportsData = async () => {\n      try {\n        const ref = doc(db, 'users', user.uid);\n        const snap = await getDoc(ref);\n        if (!snap.exists()) return;\n        const data = snap.data() as any;\n        if (!data?.reportsData) return;\n        \n        //        \n        try {\n          await reportsService.syncReportsDataFromFirebase(user.uid);\n          setDailyStats(calculateDailyStats());\n        } catch (e) {\n          console.warn('  reportsData  :', e);\n        }\n      } catch (e) {\n        console.warn('  users.reportsData:', e);\n      }\n    };\n    checkReportsData();\n  }, [user?.uid]);\n\n  //    \n  const [searchPhone, setSearchPhone] = useState('');\n  const debouncedSearchPhone = useDebouncedValue(searchPhone, 300);\n  const [selectedDate, setSelectedDate] = useState('');\n  const [selectedTime, setSelectedTime] = useState('');\n  //    \n  const [reportSearchPhone, setReportSearchPhone] = useState('');\n\n  //   \n  const [isTransferSuccess, setIsTransferSuccess] = useState(false);\n  const [isWithdrawSuccess, setIsWithdrawSuccess] = useState(false);\n  const [isPostConfirmPopupOpen, setIsPostConfirmPopupOpen] = useState(false);\n  const [postConfirmInfo, setPostConfirmInfo] = useState<{ type: 'transfer' | 'withdraw', amount: number } | null>(null);\n  const [lastUSSDTransfer, setLastUSSDTransfer] = useState<{ receiver: string; amount: number } | null>(null);\n  const [ussdLoading, setUssdLoading] = useState(false);\n  const [isPinModalOpen, setIsPinModalOpen] = useState(false);\n  const [lastDecoratedDeviceId, setLastDecoratedDeviceId] = useState<string>('');\n  //           \n\n  //   \n  const [isCalculatorOpen, setIsCalculatorOpen] = useState(false);\n  const showDesktopQuickIcons = false;\n  const [isInstallmentPinOpen, setIsInstallmentPinOpen] = useState(false);\n  const [isInstallmentModalOpen, setIsInstallmentModalOpen] = useState(false);\n\n\n  //    \n  const [isCreditCardsOpen, setIsCreditCardsOpen] = useState(false);\n  //   \n  const [isMaintenanceOpen, setIsMaintenanceOpen] = useState(false);\n  //    \n  const [isMachineDailyDialogOpen, setIsMachineDailyDialogOpen] = useState(false);\n\n  //          \n  const [isMonthlyLocked, setIsMonthlyLocked] = useState<boolean>(true);\n  const [areReportsCollapsed, setAreReportsCollapsed] = useState<boolean>(false);\n  const [isMonthlyPinDialogOpen, setIsMonthlyPinDialogOpen] = useState<boolean>(false);\n  const [isTelegramOpen, setIsTelegramOpen] = useState(false);\n  const [telegramChatId, setTelegramChatId] = useState('');\n  const [telegramDailyEnabled, setTelegramDailyEnabled] = useState(false);\n  const [isVipOpen, setIsVipOpen] = useState(false);\n\n  //      \n  const [isDailyLocked, setIsDailyLocked] = useState<boolean>(() => {\n    try {\n      const key = user?.uid ? `dailyReportsLockEnabled_${user?.uid}` : 'dailyReportsLockEnabled';\n      const v = localStorage.getItem(key) ?? localStorage.getItem('dailyReportsLockEnabled');\n      return v === 'true';\n    } catch {\n      return false;\n    }\n  });\n  const [isDailyPinDialogOpen, setIsDailyPinDialogOpen] = useState<boolean>(false);\n  useEffect(() => {\n    try {\n      const key = user?.uid ? `dailyReportsLockEnabled_${user?.uid}` : 'dailyReportsLockEnabled';\n      const v = localStorage.getItem(key) ?? localStorage.getItem('dailyReportsLockEnabled');\n      setIsDailyLocked(v === 'true');\n    } catch { }\n  }, [user?.uid]);\n\n  //   \n  const [isDebtsDialogOpen, setIsDebtsDialogOpen] = useState(false);\n  const [isDebtsPasswordDialogOpen, setIsDebtsPasswordDialogOpen] = useState(false);\n  const [isDebtsPinRequired, setIsDebtsPinRequired] = useState<boolean>(() => {\n    try {\n      const uid = user?.uid;\n      const key = uid ? `debtsPinRequired_${uid}` : 'debtsPinRequired';\n      const v = localStorage.getItem(key) ?? localStorage.getItem('debtsPinRequired');\n      return v === 'true';\n    } catch { return false; }\n  });\n  const [isDebtsPinToggleOpen, setIsDebtsPinToggleOpen] = useState(false);\n  const [pendingDebtsPinValue, setPendingDebtsPinValue] = useState<boolean | null>(null);\n  const [debtorName, setDebtorName] = useState('');\n  const [debtAmount, setDebtAmount] = useState('');\n  const [debtReason, setDebtReason] = useState('');\n  const [debtRole, setDebtRole] = useState<'debtor' | 'creditor' | null>(null);\n  const [selectedDebt, setSelectedDebt] = useState<Debt | null>(null);\n  const [isDebtReceiptOpen, setIsDebtReceiptOpen] = useState(false);\n  const [isDebtAdjustDialogOpen, setIsDebtAdjustDialogOpen] = useState<boolean>(false);\n  const [debtAdjustType, setDebtAdjustType] = useState<'increase' | 'decrease' | null>(null);\n  const [debtAdjustAmount, setDebtAdjustAmount] = useState<string>('');\n  const [pendingDebtAdjustment, setPendingDebtAdjustment] = useState<{ debtId: string; delta: number; type: 'increase' | 'decrease' } | null>(null);\n  //     \n  const [isDebtsPinDialogOpen, setIsDebtsPinDialogOpen] = useState(false);\n  //    \n  const [isPartialPaymentOpen, setIsPartialPaymentOpen] = useState(false);\n  const [partialPaymentAmount, setPartialPaymentAmount] = useState('');\n  //    \n  const [isDebtReceiptsListOpen, setIsDebtReceiptsListOpen] = useState(false);\n  const [debtsPage, setDebtsPage] = useState(1);\n  const DEBTS_PAGE_SIZE = isMobile ? 10 : 20;\n  const visibleDebts = React.useMemo(() => debts.slice(0, debtsPage * DEBTS_PAGE_SIZE), [debts, debtsPage]);\n  useEffect(() => {\n    if (isDebtReceiptsListOpen) {\n      setDebtsPage(1);\n    }\n  }, [isDebtReceiptsListOpen]);\n\n  const openDebts = async () => {\n    if (isZeroPlan) {\n      toast({ title: ' ', description: ' /     .  .', variant: 'destructive' });\n      return;\n    }\n    try {\n      const hasPin = await MasterPinService.hasMasterPin(user?.uid);\n      if (isDebtsPinRequired && hasPin) {\n        setIsDebtsPasswordDialogOpen(true);\n      } else {\n        setIsDebtsDialogOpen(true);\n      }\n    } catch {\n      setIsDebtsDialogOpen(true);\n    }\n  };\n\n  const handleDebtsPinToggle = (val: boolean) => {\n    setPendingDebtsPinValue(val);\n    setIsDebtsPinToggleOpen(true);\n  };\n\n  useEffect(() => {\n    try {\n      const uid = user?.uid;\n      const key = uid ? `debtsPinRequired_${uid}` : 'debtsPinRequired';\n      const v = localStorage.getItem(key) ?? localStorage.getItem('debtsPinRequired');\n      if (v === 'true' || v === 'false') setIsDebtsPinRequired(v === 'true');\n    } catch { }\n  }, [user?.uid]);\n\n  useEffect(() => {\n    const handler = () => { try { loadDebtsFromStorage(); } catch { } };\n    try { window.addEventListener('debtsUpdated', handler as EventListener); } catch { }\n    return () => { try { window.removeEventListener('debtsUpdated', handler as EventListener); } catch { } };\n  }, [user?.uid, shopIdCtx, profile?.shopId]);\n\n  //  \n  const [isAddCustomerDialogOpen, setIsAddCustomerDialogOpen] = useState(false);\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [newCustomerName, setNewCustomerName] = useState('');\n  const [newCustomerMobile, setNewCustomerMobile] = useState('');\n  const [selectedCustomerId, setSelectedCustomerId] = useState('');\n  const [customerDebtAmount, setCustomerDebtAmount] = useState('');\n  const [isEditCustomerDialogOpen, setIsEditCustomerDialogOpen] = useState(false);\n  const [editingCustomerId, setEditingCustomerId] = useState<string>('');\n  const [editingCustomerName, setEditingCustomerName] = useState<string>('');\n  const [editingCustomerMobile, setEditingCustomerMobile] = useState<string>('');\n  const [isDeleteCustomerConfirmOpen, setIsDeleteCustomerConfirmOpen] = useState(false);\n  const [customerToDeleteId, setCustomerToDeleteId] = useState<string>('');\n  const [customerToDeleteName, setCustomerToDeleteName] = useState<string>('');\n\n  //    \n  const [isDebtDeductionChoiceOpen, setIsDebtDeductionChoiceOpen] = useState(false);\n  const [pendingDebtToCreate, setPendingDebtToCreate] = useState<Debt | null>(null);\n  const [deductionSource, setDeductionSource] = useState<'cash' | 'wallet' | 'none' | null>(null);\n  const [selectedWalletForDeduction, setSelectedWalletForDeduction] = useState<string>('');\n  //      (  )\n  const [isPaymentCreditChoiceOpen, setIsPaymentCreditChoiceOpen] = useState(false);\n  const [paymentAmountPending, setPaymentAmountPending] = useState<number>(0);\n  const [paymentCreditSource, setPaymentCreditSource] = useState<'cash' | 'wallet' | 'fawry' | 'none' | null>(null);\n  const [selectedWalletForPaymentCredit, setSelectedWalletForPaymentCredit] = useState<string>('');\n  const [selectedWalletLimits, setSelectedWalletLimits] = useState<any | null>(null);\n  const [selectedWalletName, setSelectedWalletName] = useState<string>('');\n\n  //    \n  const saveDebtsToStorage = async (debtsToSave: Debt[]) => {\n    try {\n      //   localStorage        \n      const serialized = JSON.stringify(debtsToSave);\n      localStorage.setItem(getDebtsKey(), serialized);\n      try { localStorage.setItem(getDebtsDefaultKey(), serialized); } catch { }\n      //           \n      try { localStorage.setItem(getDebtsLastWriteKey(), Date.now().toString()); } catch { }\n\n      if (user?.uid) {\n        // Mark as unsynced BEFORE starting sync\n        try { localStorage.setItem(`debts_unsynced_${user.uid}`, 'true'); } catch { }\n\n        const promises = [];\n\n        // 1. Update User Document\n        promises.push(userDataService.updateUserData(user.uid, { \n          debts: debtsToSave,\n          debtsDeletedAt: null // Clear deleted flag when saving new debts\n        }));\n\n        // 2. Sync all debts to collection (Background) - DISABLED\n        //               \n        /*\n        if (debtsToSave.length < 100) {\n            const batchPromises = debtsToSave.map(d => {\n                if (!d.id) return Promise.resolve();\n                const ref = doc(db, 'debts', d.id);\n                const p: any = { \n                    ...d, \n                    userId: user.uid, \n                    shopId: shopIdCtx || profile?.shopId || null,\n                    lastUpdated: new Date().toISOString()\n                };\n                Object.keys(p).forEach(key => p[key] === undefined && delete p[key]);\n                return setDoc(ref, p, { merge: true });\n            });\n            promises.push(Promise.all(batchPromises));\n        }\n        */\n\n        Promise.all(promises)\n          .then(() => {\n            try { localStorage.removeItem(`debts_unsynced_${user.uid}`); } catch { }\n          })\n          .catch((err) => {\n            console.error('  :', err);\n            setHasLocalDataToSync(true);\n            // Flag remains true\n          });\n      }\n    } catch (error) {\n      console.error('   :', error);\n    }\n  };\n\n  const loadDebtsFromStorage = async () => {\n    try {\n      // 1)           \n      const localUserKey = getDebtsKey();\n      const localDefaultKey = getDebtsDefaultKey();\n      const localLastWriteKey = getDebtsLastWriteKey();\n      const localByUser = localStorage.getItem(localUserKey);\n      const localByDefault = localStorage.getItem(localDefaultKey);\n      const lastWriteStr = localStorage.getItem(localLastWriteKey);\n      const lastWriteMs = lastWriteStr ? Number(lastWriteStr) : 0;\n\n      const parseDebts = (listStr: string | null) => {\n        if (!listStr) return null;\n        try {\n          const raw = JSON.parse(listStr);\n          return Array.isArray(raw)\n            ? raw.map((debt: any) => ({\n              ...debt,\n              createdAt: debt.createdAt?.toDate ? debt.createdAt.toDate() : new Date(debt.createdAt),\n              partialPayments: Array.isArray(debt.partialPayments)\n                ? debt.partialPayments.map((p: any) => ({\n                  amount: Number(p.amount) || 0,\n                  paidAt: p.paidAt?.toDate ? p.paidAt.toDate() : new Date(p.paidAt)\n                }))\n                : []\n            }))\n            : [];\n        } catch (e) {\n          console.warn('    localStorage:', e);\n          return null;\n        }\n      };\n\n      let localDebts: Debt[] | null = parseDebts(localByUser);\n      if (!localDebts || localDebts.length === 0) {\n        const migrated = parseDebts(localByDefault);\n        if (migrated && migrated.length > 0) {\n          localDebts = migrated;\n          setDebts(migrated);\n          //          Firebase    \n          try {\n            localStorage.setItem(getDebtsKey(), JSON.stringify(migrated));\n            localStorage.removeItem(localDefaultKey);\n          } catch (e) {\n            console.warn('      :', e);\n          }\n        }\n      }\n\n      if (localDebts && localDebts.length > 0) {\n        setDebts(localDebts);\n      }\n\n      // 2)   Firebase           \n      if (user?.uid) {\n        try {\n          const debtsUnsyncedKey = `debts_unsynced_${user.uid}`;\n          const hasDebtsUnsynced = localStorage.getItem(debtsUnsyncedKey) === 'true';\n          const userDocSnap = await getDoc(doc(db, 'users', user.uid));\n\n          //     (/)    \n          const collectionDebts: Debt[] = [];\n          try {\n             const q = query(collection(db, 'debts'), where('userId', '==', user.uid));\n             const snap = await getDocs(q);\n             snap.forEach(d => {\n                 const data = d.data();\n                 collectionDebts.push({\n                     id: d.id,\n                     ...data,\n                     amount: Number(data.amount || 0),\n                     paidAmount: Number(data.paidAmount || 0),\n                     createdAt: data.createdAt?.toDate ? data.createdAt.toDate() : new Date(data.createdAt || Date.now()),\n                     partialPayments: Array.isArray(data.partialPayments) ? data.partialPayments : []\n                 } as Debt);\n             });\n          } catch (e) { console.warn('Failed to fetch from debts collection:', e); } \n\n          if (userDocSnap.exists()) {\n            const userData = userDocSnap.data();\n            let fbDebts: Debt[] = userData.debts && Array.isArray(userData.debts)\n              ? userData.debts.map((debt: any) => ({\n                ...debt,\n                amount: Number(debt.amount || 0),\n                paidAmount: Number(debt.paidAmount || 0),\n                createdAt: debt.createdAt?.toDate ? debt.createdAt.toDate() : new Date(debt.createdAt),\n                partialPayments: Array.isArray(debt.partialPayments)\n                  ? debt.partialPayments.map((p: any) => ({\n                    amount: Number(p.amount) || 0,\n                    paidAt: p.paidAt?.toDate ? p.paidAt.toDate() : new Date(p.paidAt)\n                  }))\n                  : []\n              }))\n              : [];\n\n            //              \n            const debtsDeletedAt = userData.debtsDeletedAt;\n            const remoteMarkedDeleted = !!debtsDeletedAt;\n\n            if (remoteMarkedDeleted) {\n              setDebts([]);\n              try {\n                localStorage.setItem(localUserKey, JSON.stringify([]));\n                localStorage.setItem(localDefaultKey, JSON.stringify([]));\n              } catch {}\n              return; //   \n            }\n\n            //  :        \n            //         (debts_unsynced)\n            if ((fbDebts?.length || 0) > 0) {\n              if (hasDebtsUnsynced) {\n                console.log('               .');\n              } else {\n                setDebts(fbDebts);\n                try { localStorage.setItem(localUserKey, JSON.stringify(fbDebts)); } catch {}\n              }\n            } else {\n              //  :      \n              //         \n            }\n          } else if (collectionDebts.length > 0) {\n             // User doc missing but debts collection has data\n             setDebts(collectionDebts);\n             try { localStorage.setItem(localUserKey, JSON.stringify(collectionDebts)); } catch {}\n          } else if (localDebts && localDebts.length > 0) {\n            //       \n            //             \n            //           \n          }\n        } catch (e) {\n          console.warn('    Firebase   :', e);\n        }\n      }\n    } catch (error) {\n      console.error('   :', error);\n    }\n  };\n\n  //           UI\n  useEffect(() => {\n    try {\n      (window as any).exportDebts = () => {\n        try { return JSON.stringify(debts || []); } catch { return '[]'; }\n      };\n      (window as any).importDebts = async (json: string) => {\n        try {\n          const arr = JSON.parse(json);\n          if (!Array.isArray(arr)) throw new Error('       ');\n          await saveDebtsToStorage(arr);\n          return { ok: true, count: arr.length };\n        } catch (e) {\n          console.error('  :', e);\n          return { ok: false, error: String(e) };\n        }\n      };\n      (window as any).fixWalletsForCurrentUser = async (msisdns: string[]) => {\n        try {\n          if (!user?.uid) throw new Error('   ');\n          const svc = (await import('@/integrations/firebase/services')).merchantWalletService;\n          return await svc.reassignByMsisdns(msisdns, user.uid);\n        } catch (e) {\n          console.error('    :', e);\n          return { updated: 0, failed: (msisdns?.length || 0), error: String(e) };\n        }\n      };\n    } catch (e) {\n      //     window\n    }\n  }, [debts, user?.uid]);\n\n  //       \n  useEffect(() => {\n    if (user?.uid) {\n        loadDebtsFromStorage();\n    }\n  }, [user?.uid]);\n\n\n\n  //       (Real-time Listener)\n  useEffect(() => {\n    if (!user?.uid) return;\n\n    const unsubscribe = onSnapshot(doc(db, 'users', user.uid), async (snapshot) => {\n      if (snapshot.exists()) {\n        const userData = snapshot.data();\n        const isActive = userData.isActive === true;\n        \n        //     \n        if (userData.subscription) {\n           setUserSubscription(userData.subscription);\n        }\n        \n        // Update branch package info (real-time)\n        setBranchPackage(userData.branchPackage || null);\n\n        //     (         )\n        // :            Snapshot\n        //     \"isActive\"    \n        const trialValidity = await FreeTrialService.checkTrialValidity(user.uid);\n        const isOnTrial = trialValidity.isValid && !trialValidity.isExpired;\n\n        //    \n        setIsUserActive(isActive || isOnTrial);\n        setIsOnFreeTrial(isOnTrial);\n        setFreeTrialHoursRemaining(trialValidity.hoursRemaining);\n        setHasUsedFreeTrial(trialValidity.hasUsedTrial);\n        \n        //    :\n        //       ()     \n        const shouldShowModal = !isActive && !isOnTrial;\n        setShowActivationModal(shouldShowModal);\n\n        if (shouldShowModal) {\n           console.log(' User not active, redirecting to pending approval...');\n           navigate('/user/pending-approval', { replace: true });\n        }\n\n        console.log('     (Real-time):', { \n            isActive, \n            isOnTrial, \n            plan: userData.subscription?.planType,\n            showModal: shouldShowModal \n        });\n      }\n    });\n\n    return () => unsubscribe();\n  }, [user?.uid]);\n\n  //     \n  const recheckUserStatus = async () => {\n    if (!user?.uid) return;\n\n    console.log('    ...');\n\n    try {\n      //          \n      await new Promise(resolve => setTimeout(resolve, 500));\n\n      const userDoc = await getDoc(doc(db, 'users', user.uid));\n      if (userDoc.exists()) {\n        const userData = userDoc.data();\n        const isActive = userData.isActive === true;\n\n        //    \n        const trialValidity = await FreeTrialService.checkTrialValidity(user.uid);\n        const isOnTrial = trialValidity.isValid && !trialValidity.isExpired;\n\n        console.log('  :', {\n          isActive,\n          isOnTrial,\n          hoursRemaining: trialValidity.hoursRemaining\n        });\n\n        setIsUserActive(isActive || isOnTrial);\n        setIsOnFreeTrial(isOnTrial);\n        setFreeTrialHoursRemaining(trialValidity.hoursRemaining);\n        setHasUsedFreeTrial(trialValidity.hasUsedTrial);\n        setShowActivationModal(!isActive && !isOnTrial);\n\n        console.log('     :', {\n          userIsActive: isActive || isOnTrial,\n          isOnFreeTrial: isOnTrial\n        });\n      }\n    } catch (error) {\n      console.error('     :', error);\n    }\n  };\n\n  //      \n  const handleTrialStarted = async () => {\n    console.log('        ...');\n    await recheckUserStatus();\n    //      \n  };\n\n  //    \n  const fetchSubscriptionData = async () => {\n    if (!user?.uid) return;\n\n    try {\n      setIsRefreshingSubscription(true);\n      const subscriptionData = await getUserSubscription(user.uid);\n      setUserSubscription(subscriptionData);\n    } catch (error) {\n      console.error('    :', error);\n    } finally {\n      setIsRefreshingSubscription(false);\n    }\n  };\n\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  const [isDatePickerOpen, setIsDatePickerOpen] = useState(false);\n\n  //   \n  const MONTHLY_WITHDRAWAL_LIMIT = 200000; //   \n  const MONTHLY_TRANSFER_LIMIT = 200000; //   \n\n  //   \n  const [cashBalance, setCashBalance] = useState(0); //    \n  const [walletBalances, setWalletBalances] = useState<{ [key: string]: number }>({}); //  \n\n  //   \n  const [isEditCashDialogOpen, setIsEditCashDialogOpen] = useState(false);\n  const [isEditWalletDialogOpen, setIsEditWalletDialogOpen] = useState(false);\n  const [isAddToWalletDialogOpen, setIsAddToWalletDialogOpen] = useState(false);\n  //     \n  const [isResetSelectedWalletDialogOpen, setIsResetSelectedWalletDialogOpen] = useState(false);\n  const [resetSelectedWalletPinInput, setResetSelectedWalletPinInput] = useState('');\n  //    \n  const [isResetRecentDialogOpen, setIsResetRecentDialogOpen] = useState(false);\n\n  //     \n  const [isCashAmountDialogOpen, setIsCashAmountDialogOpen] = useState(false);\n  const [cashAmountInput, setCashAmountInput] = useState('');\n\n  //       \n  const [isTopUpOpen, setIsTopUpOpen] = useState(false);\n  const [topupPhone, setTopupPhone] = useState('');\n  const [topupOperator, setTopupOperator] = useState('');\n  const [topupAmount, setTopupAmount] = useState<number | ''>('');\n  const [topupLoading, setTopupLoading] = useState(false);\n  const [isYourReportsOpen, setIsYourReportsOpen] = useState(false);\n  const [isReportsPinOpen, setIsReportsPinOpen] = useState(false);\n  const [reportArchives, setReportArchives] = useState<any[]>([]);\n  useEffect(() => {\n    (async () => {\n      try {\n        if (!user?.uid || !isYourReportsOpen) return;\n        try { await dailyReportsArchiveService.trimToMaxCount(user.uid, 30); } catch { }\n        const data = await dailyReportsArchiveService.getByUser(user.uid, 30);\n        setReportArchives(data);\n      } catch { }\n    })();\n  }, [user?.uid, isYourReportsOpen]);\n\n  //     localStorage  \n  const getWalletBalancesKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `walletBalances_${user?.uid || 'default'}_${sid}`;\n  };\n  const getCashBalanceKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `cashBalance_${user?.uid || 'default'}_${sid}`;\n  };\n  const getDebtsKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `debts_${user?.uid || 'default'}_${sid}`;\n  };\n  const getCustomersKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `customers_${user?.uid || 'default'}_${sid}`;\n  };\n  //         uid  \n  const getDebtsDefaultKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `debts_default_${sid}`;\n  };\n  //        \n  const getDebtsLastWriteKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `debts_last_write_${user?.uid || 'default'}_${sid}`;\n  };\n\n  // /  \n  const getExpensesKey = () => `shopExpenses_${(shopIdCtx || profile?.shopId || user?.uid || 'default')}`;\n  const loadExpensesFromStorage = () => {\n    try {\n      const saved = localStorage.getItem(getExpensesKey());\n      if (saved) {\n        const parsed = JSON.parse(saved) as ShopExpense[];\n        setExpenses(parsed.map(e => ({ ...e, createdAt: new Date(e.createdAt) })));\n      }\n    } catch (e) {\n      console.error('      :', e);\n    }\n  };\n  const saveExpensesToStorage = async (list: ShopExpense[]) => {\n    try {\n      localStorage.setItem(getExpensesKey(), JSON.stringify(list));\n      setExpenses(list);\n    } catch (e) {\n      console.error('      :', e);\n    }\n  };\n\n  //     (    )\n  const permanentlyDeleteExpense = async (expenseId: string) => {\n    try {\n      const remaining = expenses.filter(e => e.id !== expenseId);\n      await saveExpensesToStorage(remaining);\n\n      //   Firestore       \n      try {\n        if (user?.uid && expenseId) {\n          const { doc, deleteDoc } = await import('firebase/firestore');\n          const { db } = await import('@/firebase');\n          const ref = doc(db, 'shop_expenses', expenseId);\n          await deleteDoc(ref);\n        }\n      } catch (cloudErr) {\n        console.warn('             :', cloudErr);\n      }\n\n      toast({ title: ' ', description: '    .' });\n    } catch (err) {\n      console.error('     :', err);\n      toast({ title: ' ', description: '  .   .', variant: 'destructive' });\n    }\n  };\n\n  //      Firestore (          )\n  React.useEffect(() => {\n    let unsubscribe: (() => void) | undefined;\n    (async () => {\n      try {\n        if (!user?.uid) {\n          //            \n          loadExpensesFromStorage();\n          return;\n        }\n        const { collection, query, where, getDocs } = await import('firebase/firestore');\n        const { db } = await import('@/firebase');\n        const shopId = shopIdCtx || profile?.shopId;\n        //  shopId       userId     \n        const q = shopId\n          ? query(collection(db, 'shop_expenses'), where('shopId', '==', shopId))\n          : query(collection(db, 'shop_expenses'), where('userId', '==', user.uid));\n        \n        const snap = await getDocs(q);\n        const cloudItems: ShopExpense[] = snap.docs.map((d) => {\n          const data: any = d.data();\n          const created = data.createdAt?.toDate\n            ? data.createdAt.toDate()\n            : (data.createdAt ? new Date(data.createdAt) : new Date());\n          return {\n            id: d.id,\n            name: String(data.name || ''),\n            amount: Number(data.amount || 0),\n            notes: data.notes ? String(data.notes) : undefined,\n            source: (data.source === 'wallet') ? 'wallet' : 'cash',\n            walletId: data.walletId ? String(data.walletId) : undefined,\n            createdAt: created,\n          };\n        });\n        //    createdAt        \n        const finalList: ShopExpense[] = cloudItems.sort((a, b) => {\n          const timeA = a.createdAt instanceof Date ? a.createdAt.getTime() : 0;\n          const timeB = b.createdAt instanceof Date ? b.createdAt.getTime() : 0;\n          return timeB - timeA;\n        });\n        setExpenses(finalList);\n        //       \n        try { localStorage.setItem(getExpensesKey(), JSON.stringify(finalList)); } catch { }\n      } catch (e) {\n        console.error('      Firestore:', e);\n      }\n    })();\n\n    return () => unsubscribe?.();\n  }, [user?.uid, profile?.shopId, shopIdCtx]);\n\n  // / \n  const getDeficienciesKey = () => `deficiencies_${(shopIdCtx || profile?.shopId || user?.uid || 'default-shop')}`;\n  const loadDeficienciesFromStorage = () => {\n    try {\n      //        \n      const newKey = getDeficienciesKey();\n      const oldKey = `deficiencies_${(user?.uid || 'default')}`;\n      if (oldKey !== newKey) {\n        const oldRaw = localStorage.getItem(oldKey);\n        const newRaw = localStorage.getItem(newKey);\n        if (oldRaw) {\n          try {\n            const oldList = JSON.parse(oldRaw) || [];\n            const newList = newRaw ? JSON.parse(newRaw) : [];\n            const merged = Array.isArray(newList) ? [...newList] : [];\n            const has = (arr: any[], item: any) => arr.some((d) => (d?.id && item?.id && String(d.id) === String(item.id)) || (String(d?.name || '') === String(item?.name || '') && String(d?.status || 'pending') === String(item?.status || 'pending')));\n            if (Array.isArray(oldList)) {\n              for (const it of oldList) { if (!has(merged, it)) merged.push(it); }\n            }\n            localStorage.setItem(newKey, JSON.stringify(merged));\n            try { localStorage.removeItem(oldKey); } catch { }\n          } catch { }\n        }\n      }\n\n      const saved = localStorage.getItem(newKey);\n      if (saved) {\n        const parsed = JSON.parse(saved) as DeficiencyItem[];\n        setDeficiencies(parsed.map(d => ({ ...d, createdAt: new Date(d.createdAt) })));\n      }\n    } catch (e) {\n      console.error('     :', e);\n    }\n  };\n  const saveDeficienciesToStorage = async (list: DeficiencyItem[]) => {\n    try {\n      localStorage.setItem(getDeficienciesKey(), JSON.stringify(list));\n      setDeficiencies(list);\n    } catch (e) {\n      console.error('     :', e);\n    }\n  };\n\n  //   (  )\n  React.useEffect(() => {\n    const fetchDeficiencies = async () => {\n      try {\n        if (!user?.uid) return;\n        const { collection, query, where, orderBy, getDocs } = await import('firebase/firestore');\n        const { db } = await import('@/firebase');\n        const currentShopId = (shopIdCtx || profile?.shopId || user.uid || 'default-shop');\n        const q = query(collection(db, 'deficiencies'), where('shopId', '==', currentShopId), orderBy('createdAt', 'desc'));\n        \n        const snap = await getDocs(q);\n        const items: DeficiencyItem[] = snap.docs.map((d) => {\n          const data: any = d.data();\n          const created = data.createdAt?.toDate ? data.createdAt.toDate() : (data.createdAt ? new Date(data.createdAt) : new Date());\n          return {\n            id: d.id,\n            name: String(data.name || ''),\n            quantity: Number(data.quantity || 1),\n            status: (data.status === 'purchased') ? 'purchased' : 'pending',\n            createdAt: created,\n          };\n        });\n        setDeficiencies(items);\n        try { localStorage.setItem(getDeficienciesKey(), JSON.stringify(items)); } catch { }\n      } catch (e) {\n        console.warn('    Firestore:', e);\n      }\n    };\n    fetchDeficiencies();\n  }, [user?.uid, profile?.shopId, shopIdCtx]);\n\n  // / \n  const saveCustomersToStorage = async (list: Customer[]) => {\n    try {\n      localStorage.setItem(getCustomersKey(), JSON.stringify(list));\n      setCustomers(list);\n      if (user?.uid) {\n        await userDataService.updateUserData(user.uid, { customers: list });\n      }\n    } catch (e) {\n      console.error('     :', e);\n    }\n  };\n  const loadCustomersFromStorage = async () => {\n    try {\n      if (user?.uid) {\n        const userDoc = await getDoc(doc(db, 'users', user.uid));\n        if (userDoc.exists()) {\n          const userData = userDoc.data();\n          if (userData.customers && Array.isArray(userData.customers)) {\n            const firebaseCustomers = userData.customers.map((c: any) => ({\n              ...c,\n              createdAt: c.createdAt?.toDate ? c.createdAt.toDate() : new Date(c.createdAt)\n            }));\n            setCustomers(firebaseCustomers);\n            return;\n          }\n        }\n      }\n      //      Firestore       \n      setCustomers([]);\n    } catch (e) {\n      console.error('     Firestore:', e);\n      //           \n    }\n  };\n  const getTransactionsKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `transactions_${user?.uid || 'default'}_${sid}`;\n  };\n  const getDeletedTransactionsKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `deletedTransactions_${user?.uid || 'default'}_${sid}`;\n  };\n  const getWalletsKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `wallets_${user?.uid || 'default'}_${sid}`;\n  };\n  const getSelectedWalletKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `selectedWallet_${user?.uid || 'default'}_${sid}`;\n  };\n  const getTransactionKey = (t: any) => {\n    const id = String((t as any)?.transactionId || (t as any)?.id || '');\n    const ref = String((t as any)?.reference || (t as any)?.transactionReference || (t as any)?.receipt?.reference || '');\n    const createdAtMs = new Date(((t as any)?.createdAt || 0)).getTime();\n    return id || ref || `${ref || 'ref'}-${createdAtMs}`;\n  };\n\n  const loadWalletsFromLocalWithMigration = (): any[] | null => {\n    try {\n      const currentKey = getWalletsKey();\n      const current = localStorage.getItem(currentKey);\n      if (current) {\n        const parsed = JSON.parse(current);\n        if (Array.isArray(parsed) && parsed.length > 0) return parsed;\n      }\n    } catch (e) {\n      console.warn('loadWalletsFromLocalWithMigration failed:', e);\n    }\n    return null;\n  };\n\n  //  React Query     \n  const { data: transactionsData, refetch: refetchTransactions } = useQuery({\n    queryKey: ['userTransactions', user?.uid],\n    queryFn: async () => {\n      if (!user?.uid) return [];\n      const { collection, query, where, orderBy, limit, getDocs } = await import('firebase/firestore');\n      const { db } = await import('@/firebase');\n      const q = query(\n        collection(db, 'userTransactions'),\n        where('userId', '==', user.uid),\n        orderBy('createdAt', 'desc'),\n        limit(100)\n      );\n      const snap = await getDocs(q);\n      return snap.docs.map((d) => {\n        const data: any = d.data();\n        const created = data.createdAt?.toDate ? data.createdAt.toDate() : new Date(data.createdAt);\n        const type = data.txnType === 'send' ? 'send' : (data.txnType === 'receive' ? 'withdraw' : (data.type || 'withdraw'));\n        const status = data.status === 'confirmed' ? 'completed' : (data.status || 'completed');\n        const senderPhone = data.senderMsisdn || data.senderPhone || '';\n        const receiverPhone = data.receiverMsisdn || data.receiverPhone || '';\n        const amount = Number(data.amount ?? data.transferredAmount ?? data.withdrawnAmount ?? 0);\n        return { id: d.id, ...data, type, status, senderPhone, receiverPhone, amount, createdAt: created, provider: data.provider || undefined };\n      });\n    },\n    enabled: !!user?.uid,\n    staleTime: 1000 * 60 * 5, // 5 minutes\n    gcTime: 1000 * 60 * 10, // 10 minutes\n  });\n\n  useEffect(() => {\n    if (transactionsData) {\n      const items = transactionsData;\n      const filtered = items.filter((t: any) => !(t?.type === 'report' || String((t as any)?.title || '').includes('  ')));\n      const deletedIds = new Set<string>((deletedTransactions || []).map((dt: any) => String(dt.id || dt.originalTransactionId || '')));\n      const active = filtered.filter((t: any) => !deletedIds.has(String(t.id || '')));\n      const seen = new Set<string>();\n      const distinct: any[] = [];\n      for (const t of active) {\n        const key = getTransactionKey(t);\n        if (!seen.has(key)) {\n          seen.add(key);\n          distinct.push(t);\n        }\n      }\n      setTransactions(distinct);\n    }\n  }, [transactionsData, deletedTransactions]);\n\n  //          \n  useEffect(() => {\n    if (!user?.uid) return;\n    let isActive = true;\n\n    const fetchDeletedTransactions = async () => {\n      try {\n        const { collection, query, where, getDocs, orderBy, limit } = await import('firebase/firestore');\n        const { db } = await import('@/firebase');\n        const q = query(collection(db, 'deletedTransactions'), where('userId', '==', user.uid), orderBy('createdAt', 'desc'), limit(50));\n        \n        //      onSnapshot\n        const snap = await getDocs(q);\n        \n        if (!isActive) return;\n\n        snap.docs.forEach((doc) => {\n          const data: any = doc.data();\n          const originalId = String(data?.originalTransactionId || '');\n          const txnId = String(data?.transactionId || '');\n          const refId = String(data?.reference || '');\n          const key = originalId || txnId || refId || String(doc.id);\n          \n          if (!key) return;\n          if (deletedEffectsAppliedRef.current.has(key)) return;\n          \n          deletedEffectsAppliedRef.current.add(key);\n          setTransactions((prev) => {\n            const tx = prev.find((t) => t.id === originalId);\n            if (!tx) return prev; \n            \n            //     \n            (async () => { await applyLocalDeleteEffects(tx); })();\n            \n            return prev.filter((t) => t.id !== originalId);\n          });\n        });\n      } catch (e) {\n        console.warn('   :', e);\n      }\n    };\n    \n    fetchDeletedTransactions();\n    \n    return () => { isActive = false; };\n  }, [user?.uid]);\n\n\n\n  const migrateSelectedWalletKeyIfNeeded = (walletsList: any[]) => {\n    try {\n      const currentSelectedKey = getSelectedWalletKey();\n      const currentSelected = localStorage.getItem(currentSelectedKey);\n      if (currentSelected && walletsList.find((w: any) => w.id === currentSelected)) {\n        return currentSelected;\n      }\n    } catch { }\n    return null;\n  };\n\n  const [cashPinInput, setCashPinInput] = useState('');\n  const [editingWalletId, setEditingWalletId] = useState<string>('');\n\n  //   /   \n  const isShiftHandoverAllowed = React.useMemo(() => {\n    const sub = userSubscription; //      \n    if (!sub) return false;\n    const valid = isSubscriptionValid(sub);\n    //      enum   \"plan\"  \n    const rawPlan: any = (sub as any).planType ?? (sub as any).plan ?? null;\n    const planStr = typeof rawPlan === 'string' ? rawPlan.toLowerCase() : null;\n    //        \n    const allowedPlan =\n      (planStr === 'monthly' || planStr === 'quarterly' || planStr === 'yearly' || planStr === 'lifetime') ||\n      (rawPlan === SubscriptionPlan.MONTHLY || rawPlan === SubscriptionPlan.QUARTERLY || rawPlan === SubscriptionPlan.YEARLY || rawPlan === SubscriptionPlan.LIFETIME);\n    return valid && allowedPlan;\n  }, [userSubscription]);\n\n  //        \n  const isZeroPlan = React.useMemo(() => {\n    const sub = userSubscription;\n    if (!sub) return false;\n    const rawPlan: any = (sub as any).subscription?.planType ?? (sub as any).subscription?.plan ?? (sub as any).planType ?? (sub as any).plan ?? null;\n    const planStr = typeof rawPlan === 'string' ? rawPlan.toLowerCase() : null;\n    return rawPlan === SubscriptionPlan.ZERO || planStr === 'zero';\n  }, [userSubscription]);\n\n  const isTahweelaPlan = React.useMemo(() => {\n    const sub = userSubscription;\n    if (!sub) return false;\n    const rawPlan: any = (sub as any).subscription?.planType ?? (sub as any).subscription?.plan ?? (sub as any).planType ?? (sub as any).plan ?? null;\n    const planStr = typeof rawPlan === 'string' ? String(rawPlan).trim().toLowerCase() : null;\n    return rawPlan === SubscriptionPlan.TAHWEELA || planStr === 'tahweela' || planStr === '';\n  }, [userSubscription]);\n\n  const handleOpenShiftProfile = () => {\n    if (!isShiftHandoverAllowed) {\n      toast({\n        title: ' ',\n        description: '   :      .   .',\n        variant: 'destructive'\n      });\n      return;\n    }\n    setIsCashierModalOpen(true);\n  };\n  const [isEditCashBalanceOpen, setIsEditCashBalanceOpen] = useState(false);\n  const [isChangePinDialogOpen, setIsChangePinDialogOpen] = useState(false);\n  const [isChangeCashPinDialogOpen, setIsChangeCashPinDialogOpen] = useState(false);\n  const [isChangeWalletTotalPinDialogOpen, setIsChangeWalletTotalPinDialogOpen] = useState(false);\n\n  //     \n  const [isAddCashDialogOpen, setIsAddCashDialogOpen] = useState(false);\n  const [addCashAmountInput, setAddCashAmountInput] = useState('');\n  const [addCashPinInput, setAddCashPinInput] = useState('');\n  const [isAddingCash, setIsAddingCash] = useState(false);\n  const [addCashNoteEnabled, setAddCashNoteEnabled] = useState<'yes' | 'no' | null>(null);\n  const [addCashNoteText, setAddCashNoteText] = useState('');\n\n  //      PIN\n  const [isCashSummaryOpen, setIsCashSummaryOpen] = useState(false);\n  const [isCashSummaryPinDialogOpen, setIsCashSummaryPinDialogOpen] = useState(false);\n\n  //      \n  const [isAddWalletTotalDialogOpen, setIsAddWalletTotalDialogOpen] = useState(false);\n  const [addWalletTotalAmountInput, setAddWalletTotalAmountInput] = useState('');\n  const [addWalletTotalPinInput, setAddWalletTotalPinInput] = useState('');\n  const [isAddingWalletTotal, setIsAddingWalletTotal] = useState(false);\n\n\n\n\n\n\n  useEffect(() => {\n    const handleNavigation = (e: CustomEvent) => {\n      const action = e.detail?.action;\n      const payload = e.detail?.payload || {};\n\n      console.log(' Dashboard Navigation Action:', action, payload);\n\n      if (action === 'profile-settings') {\n        setIsProfileSettingsOpen(true);\n      } else if (action === 'debts') {\n        openDebts();\n      } else if (action === 'sales') {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n        } else {\n          setIsSalesDataOpen(true);\n        }\n      } else if (action === 'maintenance') {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '     .  .', variant: 'destructive' });\n        } else {\n          setIsMaintenanceOpen(true);\n        }\n      } else if (action === 'credit-cards') {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n        } else {\n          setIsCreditCardsOpen(true);\n        }\n      } else if (action === 'shop-expenses') {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n        } else {\n          if (MasterPinService.hasMasterPin()) {\n            setIsShopExpensesPinDialogOpen(true);\n          } else {\n            setIsShopExpensesDialogOpen(true);\n          }\n        }\n      } else if (action === 'deficiencies') {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '     .  .', variant: 'destructive' });\n        } else {\n          setIsDeficienciesDialogOpen(true);\n        }\n      } else if (action === 'installment') {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '      .', variant: 'destructive' });\n        } else {\n          setIsInstallmentPinOpen(true);\n        }\n      } else if (action === 'cashier-shift') {\n        if (!isShiftHandoverAllowed || isTahweelaPlan) {\n          toast({ title: ' ', description: '   :      .', variant: 'destructive' });\n        } else {\n          setIsCashierModalOpen(true);\n        }\n      } else if (action === 'machine-daily') {\n        if (!isShiftHandoverAllowed || isTahweelaPlan) {\n          toast({ title: ' ', description: '   :      .', variant: 'destructive' });\n        } else {\n          setIsMachineDailyDialogOpen(true);\n        }\n      } else if (action === 'branch-management') {\n        if (branchPackage?.status === 'active') {\n          setBranchDialogOpen(true);\n        } else {\n          setBranchRequestOpen(true);\n        }\n      } else if (action === 'transaction-section') {\n        // Scroll to transaction section\n        const transactionSection = document.getElementById('transaction-section');\n        if (transactionSection) {\n          // If skipAnimation is true, use 'auto' for instant jump, otherwise 'smooth'\n          const behavior = payload.skipAnimation ? 'auto' : 'smooth';\n          transactionSection.scrollIntoView({ behavior });\n        }\n        \n        if (payload.transactionType) {\n          setTransactionType(payload.transactionType);\n        }\n\n        if (payload.startNewTransaction) {\n          setReceiverPhone('');\n          setAmount('');\n          setManualCommission('');\n          setTransferCommission('');\n          console.log(' Starting new transaction via event');\n        }\n      }\n    };\n    window.addEventListener('dashboard-navigation-action', handleNavigation as any);\n    return () => window.removeEventListener('dashboard-navigation-action', handleNavigation as any);\n  }, [wallets, isTahweelaPlan, branchPackage, isZeroPlan, isShiftHandoverAllowed]);\n\n  //      Firebase\n  const syncLocalDataWithFirebase = async () => {\n    if (!user?.uid) return;\n\n    try {\n      const localDataKey = `userData_${user.uid}`;\n      const localDataStr = localStorage.getItem(localDataKey);\n      const debtsUnsyncedKey = `debts_unsynced_${user.uid}`;\n      const localDebtsStr = localStorage.getItem(getDebtsKey());\n      const hasDebtsUnsynced = localStorage.getItem(debtsUnsyncedKey) === 'true';\n\n      if (localDataStr) {\n        const localData = JSON.parse(localDataStr);\n        console.log('     Firebase...', localData);\n\n        //     undefined   Firestore\n        const payload: any = { lastSynced: new Date().toISOString() };\n        if (typeof localData.cashBalance === 'number') {\n          payload.cashBalance = localData.cashBalance;\n        }\n        if (localData.walletBalances && typeof localData.walletBalances === 'object') {\n          payload.walletBalances = localData.walletBalances;\n        }\n\n        //     Firebase  \n        await userDataService.updateUserData(user.uid, payload);\n\n        //      \n        localStorage.removeItem(localDataKey);\n        setHasLocalDataToSync(false);\n        console.log('      ');\n\n        //        \n      } else {\n        //          \n        console.log('     ');\n      }\n\n      //        \n      if (hasDebtsUnsynced && localDebtsStr) {\n        try {\n          const localDebtsRaw = JSON.parse(localDebtsStr) || [];\n          const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : (v ? new Date(String(v)) : new Date());\n          const normalize = (arr: any[]) => (Array.isArray(arr) ? arr : []).map((d: any) => ({\n            ...d,\n            amount: Number(d.amount || 0),\n            paidAmount: Number(d.paidAmount || 0),\n            createdAt: toJsDate(d.createdAt),\n            partialPayments: Array.isArray(d.partialPayments)\n              ? d.partialPayments.map((p: any) => ({ amount: Number(p.amount || 0), paidAt: toJsDate(p.paidAt) }))\n              : []\n          }));\n          const snap = await getDoc(doc(db, 'users', user.uid));\n          const remoteDebtsRaw = snap.exists() ? (((snap.data() as any)?.debts) || []) : [];\n          const remoteDebts = normalize(remoteDebtsRaw);\n          const localDebts = normalize(localDebtsRaw);\n          const byIdRemote: Record<string, any> = {};\n          for (const r of remoteDebts) { byIdRemote[String(r.id || '')] = r; }\n          const merged: any[] = [];\n          const used = new Set<string>();\n          for (const ld of localDebts) {\n            const id = String(ld.id || '');\n            const rd = byIdRemote[id];\n            if (rd) {\n              const rdPaid = Number(rd.paidAmount || 0) + (Array.isArray(rd.partialPayments) ? rd.partialPayments.reduce((s: number, p: any) => s + Number(p.amount || 0), 0) : 0);\n              const ldPaid = Number(ld.paidAmount || 0) + (Array.isArray(ld.partialPayments) ? ld.partialPayments.reduce((s: number, p: any) => s + Number(p.amount || 0), 0) : 0);\n              const rdStatus = String(rd.status || 'pending');\n              const ldStatus = String(ld.status || 'pending');\n              const take = (rdStatus === 'paid' || rdPaid >= Number(rd.amount || 0))\n                ? rd\n                : (ldStatus === 'paid'\n                  ? { ...rd, paidAmount: Number(ld.paidAmount || 0), partialPayments: ld.partialPayments, status: 'paid' }\n                  : (ldPaid > rdPaid\n                    ? { ...rd, paidAmount: Number(ld.paidAmount || 0), partialPayments: ld.partialPayments, status: (ldPaid >= Number(rd.amount || 0) ? 'paid' : 'pending') }\n                    : rd));\n              merged.push(take);\n              used.add(id);\n            } else {\n              merged.push(ld);\n              used.add(id);\n            }\n          }\n          for (const rd of remoteDebts) {\n            const id = String(rd.id || '');\n            if (!used.has(id)) merged.push(rd);\n          }\n          await userDataService.updateUserData(user.uid, { debts: merged });\n          try { localStorage.removeItem(debtsUnsyncedKey); } catch { }\n          setHasLocalDataToSync(false);\n        } catch (e) {\n          setHasLocalDataToSync(true);\n        }\n      }\n    } catch (error) {\n      console.error('    :', error);\n      toast({\n        title: \"  \",\n        description: \"      \",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  //      \n  const checkForLocalData = () => {\n    if (!user?.uid) return;\n\n    const localDataKey = `userData_${user.uid}`;\n    const localDataStr = localStorage.getItem(localDataKey);\n    setHasLocalDataToSync(!!localDataStr);\n  };\n\n  //   \n  const refreshTransactions = async () => {\n    if (!user?.uid) return;\n\n    setIsRefreshing(true);\n    try {\n      await loadUserData();\n      toast({\n        title: \" \",\n        description: \"   \",\n        variant: \"default\",\n      });\n    } catch (error) {\n      console.error('   :', error);\n      toast({\n        title: \" \",\n        description: \"    \",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsRefreshing(false);\n    }\n  };\n\n  //        +      N  \n  const [recentResetConfig, setRecentResetConfig] = useState<{ keepLastCount: number; intervalDays: number; lastResetAt: Date | null }>({ keepLastCount: 30, intervalDays: 7, lastResetAt: null });\n  useEffect(() => {\n    const initWeeklyReset = async () => {\n      if (!user?.uid) return;\n      try {\n        const data = await userDataService.getUserData(user.uid);\n        const raw = (data?.recentReset || {}) as any;\n        const keep = Number(raw?.keepLastCount) > 0 ? Number(raw.keepLastCount) : 30;\n        const interval = Number(raw?.intervalDays) > 0 ? Number(raw.intervalDays) : 7;\n        const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : (v ? new Date(String(v)) : null);\n        const last: Date | null = raw?.lastResetAt ? toJsDate(raw.lastResetAt) : null;\n        const now = new Date();\n        const needReset = !last || (now.getTime() - last.getTime()) >= interval * 24 * 60 * 60 * 1000;\n        if (needReset) {\n          await userDataService.updateUserData(user.uid, { recentReset: { keepLastCount: keep, intervalDays: interval, lastResetAt: now } });\n          setRecentResetConfig({ keepLastCount: keep, intervalDays: interval, lastResetAt: now });\n        } else {\n          setRecentResetConfig({ keepLastCount: keep, intervalDays: interval, lastResetAt: last });\n        }\n      } catch {\n        setRecentResetConfig({ keepLastCount: 30, intervalDays: 7, lastResetAt: null });\n      }\n    };\n    initWeeklyReset();\n  }, [user?.uid]);\n\n  const effectiveTransactions = React.useMemo(() => {\n    const base = transactions || [];\n    const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : new Date(String(v));\n    const now = new Date();\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n    const nextMonthStart = new Date(now.getFullYear(), now.getMonth() + 1, 1);\n    const sorted = [...base].sort((a: any, b: any) => toJsDate(b.createdAt).getTime() - toJsDate(a.createdAt).getTime());\n    return sorted.filter((t: any) => {\n      const d = toJsDate(t.createdAt);\n      return d >= monthStart && d < nextMonthStart;\n    });\n  }, [transactions]);\n  const hiddenCount = React.useMemo(() => {\n    const base = transactions || [];\n    const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : new Date(String(v));\n    const now = new Date();\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n    const nextMonthStart = new Date(now.getFullYear(), now.getMonth() + 1, 1);\n    const visibleMonthly = base.filter((t: any) => {\n      const d = toJsDate(t.createdAt);\n      return d >= monthStart && d < nextMonthStart;\n    }).length;\n    return Math.max(0, (transactions?.length || 0) - visibleMonthly);\n  }, [transactions?.length]);\n\n  const vipTop10 = React.useMemo(() => {\n    const now = new Date();\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n    const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 1);\n    const items: Record<string, { phone: string; count: number; total: number }> = {};\n    for (const t of transactions) {\n      const d = new Date((t as any).createdAt || 0);\n      if (!(d >= monthStart && d < monthEnd)) continue;\n      const type = String((t as any).type || (t as any).txnType || '').toLowerCase();\n      if (!(type === 'send' || type === 'withdraw' || type === 'transfer')) continue;\n      const phoneRaw = String((t as any).receiverPhone || (t as any).senderPhone || '').trim();\n      if (!phoneRaw) continue;\n      const phone = formatNumberEnglish(phoneRaw);\n      const amount = Number((t as any).amount || (t as any).withdrawnAmount || (t as any).sentAmount || 0) || 0;\n      if (!items[phone]) items[phone] = { phone, count: 0, total: 0 };\n      items[phone].count += 1;\n      items[phone].total += amount;\n    }\n    const arr = Object.values(items).sort((a, b) => {\n      if (b.count !== a.count) return b.count - a.count;\n      return b.total - a.total;\n    });\n    return arr.slice(0, 10);\n  }, [transactions]);\n\n  const toWaNumber = (p: string) => {\n    const s = formatNumberEnglish(String(p));\n    if (s.startsWith('+20')) return '20' + s.slice(3);\n    if (s.startsWith('0')) return '20' + s.slice(1);\n    return s.replace(/[^0-9]/g, '');\n  };\n\n  const sendVipWhatsApp = (item: { phone: string; count: number; total: number }) => {\n    const num = toWaNumber(item.phone);\n    const msg = ` VIP  \\n : ${item.count}\\n: ${item.total} `;\n    const url = `https://wa.me/${num}?text=${encodeURIComponent(msg)}`;\n    try { window.open(url, '_blank'); } catch { }\n  };\n\n  useEffect(() => {\n    (async () => {\n      try {\n        if (!user?.uid) return;\n        const tag = `${new Date().getFullYear()}-${new Date().getMonth() + 1}`;\n        await userDataService.updateUserData(user.uid, { vipTop10, vipMonthTag: tag });\n      } catch { }\n    })();\n  }, [user?.uid, vipTop10]);\n\n  async function composeTelegramDailySummary(): Promise<string> {\n    const now = new Date();\n    const dateStr = new Intl.DateTimeFormat('ar-EG', { timeZone: 'Africa/Cairo', year: 'numeric', month: '2-digit', day: '2-digit' }).format(now);\n    const start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0, 0);\n    const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999);\n    const txToday = (transactions || []).filter((t: any) => {\n      const d = new Date(t.createdAt || 0);\n      return d >= start && d <= end;\n    });\n    const totalOps = txToday.length;\n    const totalWithdrawn = txToday\n      .filter((t: any) => String(t.type || t.txnType || '').toLowerCase() === 'withdraw' || String(t.type || '').toLowerCase() === 'receive')\n      .reduce((s: number, t: any) => s + (t.withdrawnAmount != null ? Number(t.withdrawnAmount) : Number(t.amount || 0)), 0);\n    const totalSent = txToday\n      .filter((t: any) => String(t.type || t.txnType || '').toLowerCase() === 'send' || String(t.type || '').toLowerCase() === 'transfer')\n      .reduce((s: number, t: any) => s + (t.sentAmount != null ? Number(t.sentAmount) : Number(t.amount || 0)), 0);\n    let profit = 0;\n    try { profit = txToday.reduce((sum: number, t: any) => sum + reportsService.calculateTransactionProfit(t), 0); } catch { }\n    let accessoriesSales = 0;\n    try {\n      const cairoDate = new Intl.DateTimeFormat('en-CA', { timeZone: 'Africa/Cairo' }).format(now);\n      const byUser = fsQuery(collection(db, 'dailySales'), where('userId', '==', user?.uid || ''));\n      const snap = await getDocs(byUser);\n      const list = snap.docs.map(d => d.data() as any).filter(v => String(v.date || cairoDate) === cairoDate);\n      accessoriesSales = list.reduce((s, v) => s + Number(v.sellingPrice || v.price || 0) * Number(v.quantity || 1), 0);\n    } catch { }\n    let totalDebts = 0;\n    try {\n      const ds = debts || [];\n      totalDebts = ds.filter(d => String(d.status || '') === 'pending').reduce((s, d: any) => {\n        const paid = Number(d.paidAmount || 0) + ((Array.isArray(d.partialPayments) ? d.partialPayments : []).reduce((pp: number, p: any) => pp + Number(p.amount || 0), 0));\n        return s + Math.max(0, Number(d.amount || 0) - paid);\n      }, 0);\n    } catch { }\n    let deficienciesText = '';\n    try {\n      const sid = shopIdCtx || (profile as any)?.shopId || null;\n      const q = sid ? fsQuery(collection(db, 'deficiencies'), where('shopId', '==', sid)) : fsQuery(collection(db, 'deficiencies'), where('userId', '==', user?.uid || ''));\n      const snap = await getDocs(q);\n      const items = snap.docs.map(d => d.data() as any).filter(v => String(v.status || 'pending') === 'pending');\n      const top = items.slice(0, 10);\n      deficienciesText = top.map((v: any, i: number) => `${i + 1}- ${String(v.name || v.productName || '')}  ${Number(v.quantity || v.qty || 0)}`).join('\\n');\n    } catch { }\n    const lines = [\n      `  - ${dateStr}`,\n      ` : ${totalOps}`,\n      ` : ${totalWithdrawn} `,\n      ` : ${totalSent} `,\n      `: ${profit} `,\n      `  : ${accessoriesSales} `,\n      ` : ${totalDebts} `,\n      ` :`,\n      deficienciesText || '   '\n    ];\n    return lines.join('\\n');\n  }\n\n  const getFilteredTransactions = React.useCallback(() => {\n    let filtered = effectiveTransactions;\n\n    const phoneQuery = debouncedSearchPhone.trim();\n    if (phoneQuery) {\n      filtered = filtered.filter(transaction => {\n        const t: any = transaction as any;\n        const isCashAdd = (String(t.type || '').toLowerCase() === 'cash_addition') ||\n          (String(t.txnType || '').toLowerCase() === 'cash_addition') ||\n          (String(t.title || '').includes('  '));\n        if (isCashAdd) return true;\n        return (\n          (transaction.senderPhone && transaction.senderPhone.includes(phoneQuery)) ||\n          (transaction.receiverPhone && transaction.receiverPhone.includes(phoneQuery))\n        );\n      });\n    }\n\n    //     \n    if (selectedDate) {\n      const selectedDateObj = new Date(selectedDate);\n      filtered = filtered.filter(transaction => {\n        const transactionDate = new Date(transaction.createdAt);\n\n        if (selectedTime) {\n          //         \n          const [hours, minutes] = selectedTime.split(':');\n          const filterDateTime = new Date(selectedDateObj);\n          filterDateTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);\n          const nextHour = new Date(filterDateTime);\n          nextHour.setHours(nextHour.getHours() + 1);\n\n          return transactionDate >= filterDateTime && transactionDate < nextHour;\n        } else {\n          //         \n          return transactionDate.toDateString() === selectedDateObj.toDateString();\n        }\n      });\n    }\n\n    //          \n    try {\n      filtered = [...filtered].sort((a: any, b: any) => {\n        const ad = new Date(a.createdAt || 0).getTime();\n        const bd = new Date(b.createdAt || 0).getTime();\n        return bd - ad;\n      });\n    } catch { }\n\n    return filtered;\n  }, [effectiveTransactions, debouncedSearchPhone, selectedDate, selectedTime]);\n\n  //     \n  const exportDailyReport = () => {\n    if (!selectedDate) {\n      toast({\n        title: \"  \",\n        description: \"    \",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const filteredTransactions = getFilteredTransactions();\n    const totalAmount = filteredTransactions.reduce((sum, tx) => sum + tx.amount, 0);\n    const totalWithdrawn = filteredTransactions\n      .filter(tx => tx.type === 'withdraw' || tx.type === 'withdrawal' || tx.type === 'receive' || (tx as any).txnType === 'receive')\n      .reduce((sum, tx) => sum + (((tx as any).withdrawnAmount !== undefined ? (tx as any).withdrawnAmount : tx.amount) || 0), 0);\n    const totalSent = filteredTransactions\n      .filter(tx => tx.type === 'send' || tx.type === 'transfer' || (tx as any).txnType === 'send')\n      .reduce((sum, tx) => sum + (((tx as any).sentAmount !== undefined ? (tx as any).sentAmount : tx.amount) || 0), 0);\n    const totalReceived = filteredTransactions.filter(tx => tx.type === 'receive').reduce((sum, tx) => sum + tx.amount, 0);\n\n    const reportData = {\n      date: selectedDate,\n      totalTransactions: filteredTransactions.length,\n      totalAmount,\n      totalWithdrawn,\n      totalSent,\n      totalReceived,\n      transactions: filteredTransactions\n    };\n\n    //      \n    const reportText = `\n  - ${selectedDate}\n====================\n : ${reportData.totalTransactions}\n : ${reportData.totalAmount} \n : ${reportData.totalWithdrawn} \n : ${reportData.totalSent} \n : ${reportData.totalReceived} \n\n :\n${filteredTransactions.map(tx =>\n      `${tx.createdAt.toLocaleString('ar-EG')} - ${tx.type === 'withdraw' ? '' : tx.senderPhone + '  ' + tx.receiverPhone} - ${tx.amount}  - ${tx.status}`\n    ).join('\\n')}\n    `;\n\n    //    \n    const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = `_${selectedDate}.txt`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n\n    toast({\n      title: \"  \",\n      description: `   ${selectedDate} `,\n      variant: \"default\",\n    });\n  };\n\n  const handleSendTelegramDailyReport = async () => {\n    if (isZeroPlan || isTahweelaPlan) {\n      toast({ title: ' ', description: '      .', variant: 'destructive' });\n      return;\n    }\n    if (!user?.uid) {\n      toast({ title: '  ', description: '   ', variant: 'destructive' });\n      return;\n    }\n    try {\n      const text = await composeTelegramDailySummary();\n      const key = user?.uid ? `tg_daily_report_last_${user.uid}` : 'tg_daily_report_last';\n      const now = Date.now();\n      let canSend = true;\n      try {\n        const raw = localStorage.getItem(key);\n        if (raw) {\n          const prev = JSON.parse(raw);\n          const prevAt = Number(prev?.at || 0);\n          if (now - prevAt < 30000) canSend = false;\n        }\n      } catch {}\n      if (canSend) {\n        await telegramNotifier.send(user.uid!, text);\n        try { localStorage.setItem(key, JSON.stringify({ at: now })); } catch {}\n      }\n      toast({ title: ' ', description: '     ', variant: 'default' });\n    } catch {\n      toast({ title: ' ', description: '     ', variant: 'destructive' });\n    }\n  };\n  //     \n  const [isResetWalletTotalDialogOpen, setIsResetWalletTotalDialogOpen] = useState(false);\n  const [resetWalletTotalPinInput, setResetWalletTotalPinInput] = useState('');\n\n  //     \n  const [isResetCashDialogOpen, setIsResetCashDialogOpen] = useState(false);\n  const [resetCashPinInput, setResetCashPinInput] = useState('');\n\n  //      \n  const [hasLocalDataToSync, setHasLocalDataToSync] = useState(false);\n  const [isTelegramReportPinOpen, setIsTelegramReportPinOpen] = useState(false);\n\n  const withRetry = async <T,>(fn: () => Promise<T>, retries = 2, delayMs = 700): Promise<T> => {\n    let lastErr: any;\n    for (let i = 0; i <= retries; i++) {\n      try {\n        return await fn();\n      } catch (e) {\n        lastErr = e;\n        if (i === retries) break;\n        await new Promise((r) => setTimeout(r, delayMs * Math.pow(2, i)));\n      }\n    }\n    throw lastErr;\n  };\n\n  // Calculate total wallet balance\n  const totalWalletBalance = wallets.reduce((total, wallet) => {\n    return total + (walletBalances[wallet.id] || 0);\n  }, 0);\n\n  //        -     ( )\n  const verifyWalletTotalPin = async (inputPin: string): Promise<boolean> => {\n    return await MasterPinService.verifyMasterPin(inputPin, user?.uid);\n  };\n\n  //        ( )\n  const verifyCashDrawerPin = async (inputPin: string): Promise<boolean> => {\n    //    \n    return await MasterPinService.verifyMasterPin(inputPin, user?.uid);\n  };\n\n  //       \n  const verifyLoginPassword = async (inputPassword: string): Promise<boolean> => {\n    try {\n      const currentUser = auth.currentUser;\n      if (!currentUser || !currentUser.email) return false;\n      const credential = EmailAuthProvider.credential(currentUser.email, inputPassword);\n      await reauthenticateWithCredential(currentUser, credential);\n      return true;\n    } catch (e) {\n      console.error('    :', e);\n      return false;\n    }\n  };\n\n\n\n  //      (  )   \n  useEffect(() => {\n    if (!user?.uid) return;\n    try {\n      const wbKeyNew = getWalletBalancesKey();\n      const wbKeyOld = `walletBalances_${user.uid}`;\n      const savedWalletBalances = localStorage.getItem(wbKeyNew) ?? localStorage.getItem(wbKeyOld);\n      if (savedWalletBalances) {\n        const parsed = JSON.parse(savedWalletBalances);\n        setWalletBalances(parsed && typeof parsed === 'object' ? parsed : {});\n        try { localStorage.setItem(wbKeyNew, JSON.stringify(parsed || {})); } catch { }\n      }\n    } catch { }\n    try {\n      const cbKeyNew = getCashBalanceKey();\n      const cbKeyOld = `cashBalance_${user.uid}`;\n      const legacyKey = `userCashBalance_${user.uid}`;\n      let savedCashBalance = localStorage.getItem(cbKeyNew) ?? localStorage.getItem(cbKeyOld) ?? localStorage.getItem(legacyKey);\n      if (savedCashBalance != null) {\n        const v = parseFloat(savedCashBalance);\n        setCashBalance(Number.isFinite(v) ? v : 0);\n        try {\n          localStorage.setItem(cbKeyNew, String(Number.isFinite(v) ? v : 0));\n          localStorage.removeItem(cbKeyOld);\n          localStorage.removeItem(legacyKey);\n        } catch { }\n      }\n    } catch { }\n  }, [user?.uid, shopIdCtx, profile?.shopId]);\n\n  //            \n  useEffect(() => {\n    const handler = (e: any) => {\n      try {\n        const v = Number(e?.detail?.value);\n        if (Number.isFinite(v)) {\n          setCashBalance(v);\n        } else {\n          const saved = localStorage.getItem(getCashBalanceKey());\n          if (saved != null) setCashBalance(parseFloat(saved) || 0);\n        }\n      } catch {\n        const saved = localStorage.getItem(getCashBalanceKey());\n        if (saved != null) setCashBalance(parseFloat(saved) || 0);\n      }\n    };\n    window.addEventListener('cashBalanceChanged', handler as EventListener);\n    return () => window.removeEventListener('cashBalanceChanged', handler as EventListener);\n  }, [user?.uid, shopIdCtx, profile?.shopId]);\n\n  //     React Query   \n  const { data: dashboardData } = useQuery({\n    queryKey: ['dashboardData', shopIdCtx || profile?.shopId],\n    queryFn: async () => {\n      const sid = (shopIdCtx || profile?.shopId);\n      if (!sid) return null;\n      const ref = doc(db, 'dashboardData', sid);\n      const snap = await getDoc(ref);\n      return snap.exists() ? snap.data() : null;\n    },\n    enabled: !!(user?.uid && (shopIdCtx || profile?.shopId)),\n    staleTime: 1000 * 60 * 5, // 5 \n    refetchInterval: 1000 * 60 * 5, //   5 \n  });\n\n  useEffect(() => {\n    if (dashboardData) {\n      const d: any = dashboardData;\n      const cb = Number(d?.cashBalance || 0);\n      const wbs = (d?.walletBalances && typeof d.walletBalances === 'object') ? d.walletBalances : {};\n      try {\n        const serverTime = d?.lastUpdated ? new Date(d.lastUpdated).getTime() : 0;\n        const localCashTime = localStorage.getItem(getCashBalanceKey() + '_lastUpdated');\n        const localTime = localCashTime ? new Date(localCashTime).getTime() : 0;\n\n        if (serverTime >= localTime) {\n          setCashBalance(cb);\n          setWalletBalances(wbs);\n          localStorage.setItem(getCashBalanceKey(), String(cb));\n          localStorage.setItem(getWalletBalancesKey(), JSON.stringify(wbs));\n          if (d?.lastUpdated) {\n            localStorage.setItem(getCashBalanceKey() + '_lastUpdated', d.lastUpdated);\n            localStorage.setItem(getWalletBalancesKey() + '_lastUpdated', d.lastUpdated);\n          }\n        }\n      } catch { }\n    }\n  }, [dashboardData]);\n\n  const getWalletLimitsCacheKey = (wid?: string) => `walletLimits_${user?.uid || 'default'}_${wid || 'none'}`;\n  \n  //       React Query\n  const { data: walletLimitsData } = useQuery({\n    queryKey: ['walletLimits', selectedWallet],\n    queryFn: async () => {\n      if (!selectedWallet) return null;\n      const ref = doc(db, 'walletLimits', String(selectedWallet));\n      const snap = await getDoc(ref);\n      return snap.exists() ? snap.data() : null;\n    },\n    enabled: !!selectedWallet,\n    staleTime: 1000 * 60 * 5,\n  });\n\n  useEffect(() => {\n    if (!selectedWallet) return;\n    try {\n      // Load from cache first\n      const k = getWalletLimitsCacheKey(selectedWallet);\n      const s = localStorage.getItem(k);\n      if (s && !walletLimitsData) {\n        const parsed = JSON.parse(s);\n        setSelectedWalletLimits(parsed);\n      }\n      \n      if (walletLimitsData) {\n        const d: any = walletLimitsData;\n        const limitsObj = {\n          walletId: selectedWallet,\n          dailyTransferLimit: d.dailyTransferLimit ?? 60000,\n          dailyWithdrawLimit: d.dailyWithdrawLimit ?? 100000,\n          dailyTransferUsed: d.dailyTransferUsed ?? 0,\n          dailyWithdrawUsed: d.dailyWithdrawUsed ?? 0,\n          monthlyTransferLimit: d.monthlyTransferLimit ?? 200000,\n          monthlyWithdrawLimit: d.monthlyWithdrawLimit ?? 200000,\n          monthlyTransferUsed: d.monthlyTransferUsed ?? 0,\n          monthlyWithdrawUsed: d.monthlyWithdrawUsed ?? 0\n        };\n        setSelectedWalletLimits(limitsObj);\n        try { localStorage.setItem(getWalletLimitsCacheKey(selectedWallet), JSON.stringify(limitsObj)); } catch { }\n      }\n    } catch { }\n  }, [selectedWallet, walletLimitsData]);\n\n  useEffect(() => {\n    if (!selectedWallet) return;\n    const w = wallets.find((x: any) => x.id === selectedWallet);\n    if (w?.name) {\n      setSelectedWalletName(String(w.name));\n      try { localStorage.setItem(`walletName_${user?.uid || 'default'}_${selectedWallet}`, String(w.name)); } catch { }\n      return;\n    }\n    try {\n      const s = localStorage.getItem(`walletName_${user?.uid || 'default'}_${selectedWallet}`);\n      if (s) setSelectedWalletName(String(s));\n    } catch { }\n  }, [selectedWallet, wallets]);\n\n\n\n  //      \n  const refreshSelectedWalletLimits = async () => {\n    try {\n      if (!selectedWallet) return;\n      const limits = await walletDailyLimitsService.autoResetLimitsIfNeeded(selectedWallet);\n      setSelectedWalletLimits(limits);\n    } catch (error) {\n      console.error('     :', error);\n    }\n  };\n\n  //       /   \n  useEffect(() => {\n    refreshSelectedWalletLimits();\n  }, [selectedWallet]);\n\n  //          \n  useEffect(() => {\n    const handler = (e: any) => {\n      if (!e?.detail?.walletId) return;\n      if (e.detail.walletId === selectedWallet) {\n        refreshSelectedWalletLimits();\n      }\n    };\n    window.addEventListener('walletLimitsUpdated', handler as EventListener);\n    return () => window.removeEventListener('walletLimitsUpdated', handler as EventListener);\n  }, [selectedWallet]);\n\n  useEffect(() => {\n    const handler = (e: any) => {\n      try {\n        const wid = String(e?.detail?.walletId || '');\n        if (wid) {\n          setWalletSelection(wid, 'sms:auto');\n        }\n      } catch {}\n    };\n    window.addEventListener('walletSelection:update', handler as EventListener);\n    return () => window.removeEventListener('walletSelection:update', handler as EventListener);\n  }, [wallets]);\n\n  // Handle navigation state for opening specific dialogs\n  useEffect(() => {\n    if (location.state) {\n      console.log('Location state:', location.state); //   \n\n      if (location.state.openDebtDialog) {\n        openDebts();\n        window.history.replaceState({}, document.title);\n      }\n      if (location.state.openSalesDialog) {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n        } else {\n          setIsSalesDataOpen(true);\n        }\n        // Clear the state to prevent reopening on subsequent navigations\n        window.history.replaceState({}, document.title);\n      }\n      //       ()\n      if (location.state.openMaintenanceDialog) {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '     .  .', variant: 'destructive' });\n        } else {\n          setIsMaintenanceOpen(true);\n        }\n        //     \n        window.history.replaceState({}, document.title);\n      }\n      if (location.state.openCreditCardsDialog) {\n        console.log('Opening credit cards dialog'); //   \n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n        } else {\n          setIsCreditCardsOpen(true);\n        }\n        // Clear the state to prevent reopening on subsequent navigations\n        window.history.replaceState({}, document.title);\n      }\n      //        ()\n      if (location.state.openShopExpensesDialog) {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n        } else {\n          if (MasterPinService.hasMasterPin()) {\n            setIsShopExpensesPinDialogOpen(true);\n          } else {\n            setIsShopExpensesDialogOpen(true);\n          }\n        }\n        //     \n        window.history.replaceState({}, document.title);\n      }\n      //       ()\n      if (location.state.openDeficienciesDialog) {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '     .  .', variant: 'destructive' });\n        } else {\n          setIsDeficienciesDialogOpen(true);\n        }\n        window.history.replaceState({}, document.title);\n      }\n      if ((location.state as any).openInstallment) {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '      .', variant: 'destructive' });\n        } else {\n          setIsInstallmentPinOpen(true);\n        }\n        window.history.replaceState({}, document.title);\n      }\n      if (location.state.openTransactionSection) {\n        // Scroll to transaction section or set active tab\n        const transactionSection = document.getElementById('transaction-section');\n        if (transactionSection) {\n          transactionSection.scrollIntoView({ behavior: 'smooth' });\n        }\n\n        // Set transaction type if specified\n        if (location.state.transactionType) {\n          setTransactionType(location.state.transactionType);\n        }\n\n        // Start new transaction if specified\n        if (location.state.startNewTransaction) {\n          // Clear all form fields to start fresh\n          setReceiverPhone('');\n          setAmount('');\n          setManualCommission('');\n          setTransferCommission('');\n\n          //  REMOVED: Auto-select default wallet for withdraw transactions\n          // This was causing the wallet to reset when switching to withdraw\n          // The user's wallet selection should persist across all transaction types\n          console.log(' Starting new transaction without changing wallet selection');\n        }\n\n        // Focus on wallet selection if specified (legacy support)\n        if (location.state.focusWalletSelection) {\n          setTimeout(() => {\n            const walletSelect = document.querySelector('[data-testid=\"wallet-select\"]');\n            if (walletSelect) {\n              walletSelect.focus();\n            }\n          }, 500);\n        }\n\n        // Clear the state after handling transaction section\n        window.history.replaceState({}, document.title);\n      }\n      //        ()\n      if (location.state.openCashierShiftModal) {\n        if (!isShiftHandoverAllowed || isTahweelaPlan) {\n          toast({ title: ' ', description: '   :      .', variant: 'destructive' });\n        } else {\n          setIsCashierModalOpen(true);\n        }\n        //     \n        window.history.replaceState({}, document.title);\n      }\n      //       \n      if (location.state.openMachineDailyDialog) {\n        if (!isShiftHandoverAllowed || isTahweelaPlan) {\n          toast({ title: ' ', description: '   :      .', variant: 'destructive' });\n        } else {\n          setIsMachineDailyDialogOpen(true);\n        }\n        //     \n        window.history.replaceState({}, document.title);\n      }\n      \n      //        ()\n      if (location.state.openBranchManagement) {\n        if (branchPackage?.status === 'active') {\n          setBranchDialogOpen(true);\n        } else {\n          setBranchRequestOpen(true);\n        }\n        window.history.replaceState({}, document.title);\n      }\n    }\n  }, [location.state, wallets, isTahweelaPlan, branchPackage]);\n\n  //     localStorage:      Firebase\n  //  useEffect       \n  useEffect(() => {\n    //       \n    if (location.pathname === '/user/dashboard') {\n      const previousPath = sessionStorage.getItem('previousPath');\n      if (previousPath === '/user/add-wallet') {\n        console.log(' Returned from wallet addition page - reloading wallets');\n        loadWalletsFromFirebase();\n        sessionStorage.removeItem('previousPath'); //   \n      }\n    }\n\n    //   \n    sessionStorage.setItem('previousPath', location.pathname);\n  }, [location.pathname, user?.uid]);\n\n\n\n  // Load data from Firebase on component mount\n  //          +   \n  useEffect(() => {\n    if (!user?.uid) return;\n    \n    //     \n    const checkUserStatus = async () => {\n        try {\n            const userDocRef = doc(db, 'users', user.uid);\n            const docSnapshot = await getDoc(userDocRef);\n            if (docSnapshot.exists()) {\n                const userData = docSnapshot.data();\n                const isActive = userData.isActive === true;\n                \n                if (isActive && !isUserActive) {\n                    setIsUserActive(true);\n                    setShowActivationModal(false);\n                    setIsCheckingActivation(false);\n                } else if (!isActive && isUserActive) {\n                    setIsUserActive(false);\n                    setShowActivationModal(true);\n                }\n            }\n        } catch (e) {\n            console.error('Check user status error', e);\n        }\n    };\n    \n    checkUserStatus();\n  }, [user?.uid]);\n\n  //    \n  useEffect(() => {\n    if (!user?.uid) return;\n\n    const handleSubscriptionActivated = (event: CustomEvent) => {\n      const { userId } = event.detail;\n      if (userId === user.uid) {\n        console.log(' Subscription activation event received for current user!');\n        setIsUserActive(true);\n        setShowActivationModal(false);\n        setIsCheckingActivation(false);\n\n        //       \n        setTimeout(() => {\n          //        \n          console.log(' User activation completed - data updated');\n        }, 1000);\n      }\n    };\n\n    const handleUserSubscriptionUpdated = (event: CustomEvent) => {\n      const { userId, isActive } = event.detail;\n      if (userId === user.uid) {\n        console.log(' User subscription update event received:', { userId, isActive });\n        if (isActive && !isUserActive) {\n          setIsUserActive(true);\n          setShowActivationModal(false);\n          setIsCheckingActivation(false);\n\n          //       \n          setTimeout(() => {\n            //        \n            console.log(' User subscription updated - data refreshed');\n          }, 1000);\n        }\n      }\n    };\n\n    window.addEventListener('subscriptionActivated', handleSubscriptionActivated as EventListener);\n    window.addEventListener('userSubscriptionUpdated', handleUserSubscriptionUpdated as EventListener);\n\n    return () => {\n      window.removeEventListener('subscriptionActivated', handleSubscriptionActivated as EventListener);\n      window.removeEventListener('userSubscriptionUpdated', handleUserSubscriptionUpdated as EventListener);\n    };\n  }, [user?.uid, isUserActive]);\n\n  //      (1-9)\n  useEffect(() => {\n    const handleGlobalShortcuts = (e: KeyboardEvent) => {\n      const target = e.target as HTMLElement | null;\n      const tag = target?.tagName?.toLowerCase();\n      const isTyping = tag === 'input' || tag === 'textarea' || tag === 'select' || (target?.isContentEditable ?? false);\n      if (isTyping) return;\n      if (e.ctrlKey || e.altKey || e.metaKey) return;\n      if (e.repeat) return;\n\n      if ((isZeroPlan || isTahweelaPlan) && e.key >= '1' && e.key <= '9') {\n        e.preventDefault();\n        return;\n      }\n\n      switch (e.key) {\n        case '1':\n          break;\n        case '2':\n          setIsCalculatorOpen(true);\n          break;\n        case '3':\n          if (isZeroPlan || isTahweelaPlan) {\n            toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n          } else {\n            setIsCreditCardsOpen(true);\n          }\n          break;\n        case '4':\n          if (!isShiftHandoverAllowed) {\n            toast({ title: ' ', description: '   :      .', variant: 'destructive' });\n          } else {\n            setIsCashierModalOpen(true);\n          }\n          break;\n        case '5':\n          if (isZeroPlan || isTahweelaPlan) {\n            toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n          } else {\n            setIsSalesDataOpen(true);\n          }\n          break;\n        case '6':\n          openDebts();\n          break;\n        case '7':\n          if (isZeroPlan || isTahweelaPlan) {\n            toast({ title: ' ', description: '     .  .', variant: 'destructive' });\n          } else {\n            setIsMaintenanceOpen(true);\n          }\n          break;\n        case '8':\n          if (!isShiftHandoverAllowed) {\n            toast({ title: ' ', description: '   :      .', variant: 'destructive' });\n          } else {\n            setIsMachineDailyDialogOpen(true);\n          }\n          break;\n        case '9':\n          if (isZeroPlan || isTahweelaPlan) {\n            toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n          } else {\n            if (MasterPinService.hasMasterPin()) {\n              setIsShopExpensesPinDialogOpen(true);\n            } else {\n              setIsShopExpensesDialogOpen(true);\n            }\n          }\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleGlobalShortcuts);\n    return () => window.removeEventListener('keydown', handleGlobalShortcuts);\n  }, [isZeroPlan, isTahweelaPlan, isShiftHandoverAllowed]);\n\n  useEffect(() => {\n    console.log(' useEffect loadUserData started', { user: user?.uid, isCheckingActivation });\n\n    const loadUserData = async () => {\n      try {\n        //     \n        if (!user?.uid) {\n          console.log(' No user UID, setting isCheckingActivation to false');\n          setIsCheckingActivation(false);\n          return;\n        }\n\n        //      localStorage:    Firebase \n\n        try {\n          const userDoc = await getDoc(doc(db, 'users', user.uid));\n          if (userDoc.exists()) {\n            const userData = userDoc.data();\n            const isActive = userData.isActive === true;\n\n            //    \n            const trialValidity = await FreeTrialService.checkTrialValidity(user.uid);\n            const isOnTrial = trialValidity.isValid && !trialValidity.isExpired;\n\n            setIsUserActive(isActive || isOnTrial);\n            setIsOnFreeTrial(isOnTrial);\n            setFreeTrialHoursRemaining(trialValidity.hoursRemaining);\n            setHasUsedFreeTrial(trialValidity.hasUsedTrial);\n            setShowActivationModal(!isActive && !isOnTrial);\n\n            console.log('  :', {\n              isActive,\n              isOnTrial,\n              hoursRemaining: trialValidity.hoursRemaining,\n              hasUsedTrial: trialValidity.hasUsedTrial\n            });\n          } else {\n            //           \n            setIsUserActive(false);\n            setShowActivationModal(true);\n          }\n        } catch (error) {\n          console.error('     :', error);\n          setIsUserActive(false);\n          setShowActivationModal(true);\n        } finally {\n          setIsCheckingActivation(false);\n        }\n\n        //     Firebase     \n        console.log('      Firebase...', { userId: user?.uid });\n\n        //      \n        //     :    Firebase \n\n        //   Firebase            \n        if (user?.uid) {\n          const userData = await withRetry(() => userDataService.getUserData(user.uid));\n\n          const localDataKey = `userData_${user?.uid}`;\n          let localData: any = null;\n          try {\n            const raw = localStorage.getItem(localDataKey);\n            if (raw) localData = JSON.parse(raw);\n          } catch {}\n\n          if (userData) {\n            let remoteBalances: Record<string, number> = userData?.walletBalances || {};\n            let remoteCash = userData?.cashBalance;\n            const remoteTs = userData.lastUpdated ? new Date(userData.lastUpdated).getTime() : 0;\n\n            if (localData) {\n               const localTs = localData.lastUpdated ? new Date(localData.lastUpdated).getTime() : 0;\n               if (localTs >= remoteTs) {\n                  if (localData.walletBalances) remoteBalances = localData.walletBalances;\n                  if (localData.cashBalance !== undefined) remoteCash = localData.cashBalance;\n               }\n            }\n\n            // Fallback: Check individual transaction keys if they are newer than remote\n            // This handles cases where userData_${uid} wasn't updated but individual keys were\n            try {\n              const cashKey = getCashBalanceKey();\n              const walletKey = getWalletBalancesKey();\n              const localCashTsStr = localStorage.getItem(cashKey + '_lastUpdated');\n              const localWalletsTsStr = localStorage.getItem(walletKey + '_lastUpdated');\n              \n              const localCashTs = localCashTsStr ? new Date(localCashTsStr).getTime() : 0;\n              const localWalletsTs = localWalletsTsStr ? new Date(localWalletsTsStr).getTime() : 0;\n\n              if (localCashTs > remoteTs) {\n                  const val = localStorage.getItem(cashKey);\n                  if (val !== null) remoteCash = parseFloat(val);\n              }\n              \n              if (localWalletsTs > remoteTs) {\n                  const val = localStorage.getItem(walletKey);\n                  if (val !== null) {\n                      try { remoteBalances = JSON.parse(val); } catch {}\n                  }\n              }\n            } catch (e) {\n              console.error('Error checking individual keys fallback:', e);\n            }\n\n            setWalletBalances(remoteBalances);\n\n            if (remoteCash !== undefined) {\n              setCashBalance(remoteCash);\n            }\n\n            try {\n              const firebaseDeletedTransactions = user?.uid\n                ? await withRetry(() => auditLogService.getDeletedTransactionsByUser(user.uid))\n                : [];\n              setDeletedTransactions(firebaseDeletedTransactions || []);\n            } catch (error) {\n              setDeletedTransactions([]);\n            }\n          } else {\n            setWalletBalances({});\n            try {\n              const firebaseDeletedTransactions = user?.uid\n                ? await auditLogService.getDeletedTransactionsByUser(user.uid)\n                : [];\n              setDeletedTransactions(firebaseDeletedTransactions || []);\n            } catch {\n              setDeletedTransactions([]);\n            }\n          }\n        }\n\n        //    Firebase  merchantWalletService ( )\n        console.log('     Firebase...');\n        try {\n          const firebaseWallets = await withRetry(() => merchantWalletService.getByMerchantId(user?.uid || ''));\n          if (firebaseWallets && firebaseWallets.length > 0) {\n            console.log('      Firebase:', firebaseWallets.length);\n\n            //    Firebase   \n            const activeOnly = firebaseWallets.filter(w => (w as any).isActive === true);\n            const formattedWallets = activeOnly.map(w => ({\n              id: w.id,\n              name: w.label || '  ',\n              phone: w.msisdn,\n              isDefault: false, //     \n              monthlyWithdrawalLimit: (w.monthlyWithdrawalLimit ?? w.withdrawLimit ?? 200000),\n              monthlyTransferLimit: (w.monthlyTransferLimit ?? w.transferLimit ?? 200000),\n              //      \n              defaultTransferCommission: (w.defaultTransferCommission != null ? Number(w.defaultTransferCommission) : null),\n              defaultWithdrawCommission: (w.defaultWithdrawCommission != null ? Number(w.defaultWithdrawCommission) : null)\n            }));\n\n            setWallets(formattedWallets);\n\n            // Set default wallet as selected if available\n            //       localStorage\n            const savedSelectedWallet = localStorage.getItem(getSelectedWalletKey());\n            let walletToSelect = null;\n\n            if (savedSelectedWallet && formattedWallets.find(w => w.id === savedSelectedWallet)) {\n              //      \n              walletToSelect = formattedWallets.find(w => w.id === savedSelectedWallet);\n            } else {\n              //     \n              walletToSelect = formattedWallets[0];\n            }\n\n            if (walletToSelect) {\n              setSelectedWallet(walletToSelect.id);\n              setSenderPhone(walletToSelect.phone);\n            }\n\n            console.log('     Firebase   localStorage');\n          } else {\n            console.log('     Firebase.        .');\n            setWallets([]);\n          }\n        } catch (error) {\n          console.error('     Firebase:', error);\n          //   :      localStorage\n          setWallets([]);\n        }\n\n        //    Firebase     \n        const userTransactions = user?.uid\n          ? await withRetry(() => userDataService.getUserTransactions(user.uid))\n          : [];\n        if (userTransactions && userTransactions.length > 0) {\n          console.log('     Firebase:', userTransactions.length);\n\n          //      Firebase format  Local format\n          const transactionsWithDates = userTransactions.map((tx: any) => ({\n            ...tx,\n            createdAt: new Date(tx.createdAt),\n            //    Firebase format  Local format\n            senderPhone: tx.senderMsisdn || tx.senderPhone || '',\n            receiverPhone: tx.receiverMsisdn || tx.receiverPhone || '',\n            type: tx.txnType === 'send' ? 'send' :\n              tx.txnType === 'receive' ? 'withdraw' :\n                tx.type || 'withdraw',\n            status: tx.status === 'confirmed' ? 'completed' : tx.status || 'completed'\n          }));\n\n          //     \n          const deletedTransactionIds = deletedTransactions.map(dt => dt.id || dt.originalTransactionId);\n\n          //          \n          let permanentDeletedKeys: string[] = [];\n          try {\n            const permQ = fsQuery(\n              collection(db, 'deletedTransactions'),\n              where('userId', '==', user?.uid || ''),\n              where('permanent', '==', true)\n            );\n            const permSnap = await getDocs(permQ);\n            permanentDeletedKeys = permSnap.docs.map(d => {\n              const data: any = d.data();\n              const tombId = String(data.originalTransactionId || data.transactionId || d.id || '');\n              return tombId;\n            }).filter(Boolean);\n          } catch { }\n\n          const permSet = new Set(permanentDeletedKeys);\n          const activeTransactions = transactionsWithDates.filter(tx => {\n            const txId = String(tx.id || '');\n            const txTxnId = String((tx as any).transactionId || '');\n            const txRef = String((tx as any).reference || (tx as any).transactionReference || (tx as any).receipt?.reference || '');\n            const inDeleted = deletedTransactionIds.includes(txId);\n            const blockedByPerm = permSet.has(txId) || (txTxnId && permSet.has(txTxnId));\n            return !inDeleted && !blockedByPerm;\n          });\n\n          console.log('    :', {\n            total: userTransactions.length,\n            deleted: deletedTransactionIds.length,\n            active: activeTransactions.length\n          });\n          //           \n          //             id\n          {\n            const seen = new Set<string>();\n            const distinct: any[] = [];\n            for (const t of activeTransactions) {\n              const key = getTransactionKey(t);\n              if (!seen.has(key)) {\n                seen.add(key);\n                distinct.push(t);\n              }\n            }\n            if (!isRealtimeActive) setTransactions(distinct);\n\n          }\n        }\n\n        //     Firebase   \n        await syncLocalDataWithFirebase();\n\n      } catch (error) {\n        console.error('      Firebase:', error);\n        //   :       localStorage     \n      }\n    };\n\n    loadUserData().then(async () => {\n      await autoMonthlyDbCleanup();\n      await autoResetLimits();\n      await autoResetReports();\n    });\n\n    //          \n    const autoResetLimits = async () => {\n      try {\n        if (!user?.uid) return;\n        //          \n        const wallets = await merchantWalletService.getByMerchantId(user.uid);\n        await Promise.all(\n          wallets.map((w: any) => walletLimitsService.autoResetLimitsIfNeeded(w.id))\n        );\n      } catch (error) {\n        console.error('    :', error);\n      }\n    };\n\n    //      \n    const autoResetReports = async () => {\n      try {\n        //     Firebase      \n        await reportsService.syncReportsDataFromFirebase(user?.uid);\n        const data = reportsService.getReportsData(user?.uid);\n        const shouldArchiveDaily = data.lastDailyResetDate ? reportsService.shouldResetDailyReports(data.lastDailyResetDate) : false;\n        if (shouldArchiveDaily && user?.uid && data.lastDailyResetDate) {\n          const dayDate = new Date(data.lastDailyResetDate);\n          const baseDateStr = dayDate.toDateString();\n          //                \n          const dayTransactions = transactions.filter(tx =>\n            new Date(tx.createdAt).toDateString() === baseDateStr && tx.status === 'completed'\n          );\n          const totalTransactions = dayTransactions.length;\n          const totalAmount = dayTransactions.reduce((sum, tx) => sum + tx.amount, 0);\n          const totalWithdrawn = dayTransactions\n            .filter(isWithdrawTx)\n            .reduce((sum, tx) => {\n              const amount = (tx as any).withdrawnAmount !== undefined ? (tx as any).withdrawnAmount : tx.amount;\n              return sum + amount;\n            }, 0);\n          const totalSent = dayTransactions\n            .filter(isSendTx)\n            .reduce((sum, tx) => {\n              const amount = (tx as any).sentAmount !== undefined ? (tx as any).sentAmount : tx.amount;\n              return sum + amount;\n            }, 0);\n          const profit = dayTransactions.reduce((sum, tx) => sum + reportsService.calculateTransactionProfit(tx), 0);\n\n          const reportDateStr = new Date(dayDate).toISOString().slice(0, 10);\n          await dailyReportsArchiveService.add({\n            userId: user.uid,\n            reportDate: reportDateStr,\n            totalTransactions,\n            totalAmount: Number(totalAmount.toFixed(2)),\n            totalWithdrawn: Number(totalWithdrawn.toFixed(2)),\n            totalSent: Number(totalSent.toFixed(2)),\n            profit: Number(profit.toFixed(2)),\n            walletId: null\n          });\n        }\n\n        const resetResult = reportsService.autoResetReportsIfNeeded(user?.uid);\n        if (resetResult.dailyReset || resetResult.monthlyReset) {\n          console.log('  :', resetResult);\n          //             \n        }\n      } catch (error) {\n        console.error('    :', error);\n      }\n    };\n\n    //      1    (     Firebase )\n    const autoMonthlyDbCleanup = async () => {\n      try {\n        if (!user?.uid) return;\n        const today = new Date();\n        if (today.getDate() !== 1) return; //    1\n        const tag = `${today.getFullYear()}-${today.getMonth() + 1}`;\n        const key = `lastMonthlyDbCleanup:${user.uid}`;\n        const last = localStorage.getItem(key);\n        if (last === tag) return; //     \n\n        const monthStart = new Date(today.getFullYear(), today.getMonth(), 1, 0, 0, 0, 0);\n        const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : new Date(String(v));\n\n        // userTransactions\n        let utDocs: any[] = [];\n        try {\n          const q1 = fsQuery(\n            collection(db, 'userTransactions'),\n            where('userId', '==', user.uid),\n            where('createdAt', '<', monthStart)\n          );\n          const snap1 = await getDocs(q1);\n          utDocs = snap1.docs;\n        } catch {\n          const q1fb = fsQuery(\n            collection(db, 'userTransactions'),\n            where('userId', '==', user.uid)\n          );\n          const snap1fb = await getDocs(q1fb);\n          utDocs = snap1fb.docs.filter(d => toJsDate(d.data()?.createdAt) < monthStart);\n        }\n        await Promise.allSettled(utDocs.map(d => deleteDoc(d.ref)));\n\n        // transactions ( )\n        let gDocs: any[] = [];\n        try {\n          const q2 = fsQuery(\n            collection(db, 'transactions'),\n            where('userId', '==', user.uid),\n            where('createdAt', '<', monthStart)\n          );\n          const snap2 = await getDocs(q2);\n          gDocs = snap2.docs;\n        } catch {\n          const q2fb = fsQuery(\n            collection(db, 'transactions'),\n            where('userId', '==', user.uid)\n          );\n          const snap2fb = await getDocs(q2fb);\n          gDocs = snap2fb.docs.filter(d => toJsDate(d.data()?.createdAt) < monthStart);\n        }\n        await Promise.allSettled(gDocs.map(d => deleteDoc(d.ref)));\n\n        try { localStorage.setItem(key, tag); } catch { }\n        console.log('      (Firebase ):', {\n          userTransactionsDeleted: utDocs.length,\n          globalTransactionsDeleted: gDocs.length,\n          monthStart\n        });\n      } catch (e) {\n        console.error('     :', e);\n      }\n    };\n\n    //   \n    fetchSubscriptionData();\n\n    //  \n    loadDebtsFromStorage();\n    //  \n    loadCustomersFromStorage();\n\n    console.log(' useEffect loadUserData completed');\n  }, [user?.uid]);\n\n  //      Firebase\n  const loadWalletsFromFirebase = async () => {\n    if (!user?.uid) return;\n\n    try {\n      const firebaseWallets = await withRetry(() => merchantWalletService.getByMerchantId(user.uid));\n      if (firebaseWallets && firebaseWallets.length > 0) {\n        //    Firebase   \n        const activeOnly = firebaseWallets.filter(w => (w as any).isActive === true);\n        const formattedWallets = activeOnly.map(w => ({\n          id: w.id,\n          name: w.label || '  ',\n          phone: w.msisdn,\n          isDefault: false, //     \n          monthlyWithdrawalLimit: (w.monthlyWithdrawalLimit ?? w.withdrawLimit ?? 200000),\n          monthlyTransferLimit: (w.monthlyTransferLimit ?? w.transferLimit ?? 200000),\n          //         null  undefined\n          defaultTransferCommission: (w.defaultTransferCommission != null ? Number(w.defaultTransferCommission) : undefined),\n          defaultWithdrawCommission: (w.defaultWithdrawCommission != null ? Number(w.defaultWithdrawCommission) : undefined)\n        }));\n\n        setWallets(formattedWallets);\n\n        //         \n\n        //             \n        if (user?.uid) {\n          const savedWallet = localStorage.getItem(getSelectedWalletKey());\n          const isCurrentValid = !!(selectedWallet && formattedWallets.find(w => w.id === selectedWallet));\n          if (!isCurrentValid) {\n            const validSaved = savedWallet && formattedWallets.find(w => w.id === savedWallet) ? savedWallet : null;\n            const newWalletId = validSaved || formattedWallets[0]?.id;\n            if (newWalletId) {\n              console.log(' Fixing invalid wallet selection:', newWalletId);\n              setWalletSelection(newWalletId);\n            }\n          } else {\n            console.log(' Preserving current wallet selection:', selectedWallet);\n          }\n        }\n\n        console.log('     Firebase:', formattedWallets.length);\n      }\n    } catch (error) {\n      console.error('     Firebase:', error);\n    }\n  };\n\n  // useEffect         \n  useEffect(() => {\n    const currentPath = location.pathname;\n    const previousPath = sessionStorage.getItem('previousPath');\n\n    //           \n    if (previousPath === '/user/add-wallet' && currentPath === '/user/dashboard') {\n      queryClientHook.invalidateQueries({ queryKey: ['wallets', user?.uid] });\n      try { walletsQuery.refetch(); } catch {}\n      sessionStorage.removeItem('previousPath');\n    }\n\n    //   \n    sessionStorage.setItem('previousPath', currentPath);\n  }, [location.pathname, user?.uid]);\n\n  // useEffect      \n  useEffect(() => {\n    const handleWindowFocus = () => {\n      const currentSelectedWallet = selectedWallet;\n      queryClientHook.invalidateQueries({ queryKey: ['wallets', user?.uid] });\n      try { walletsQuery.refetch(); } catch {}\n    };\n\n    //     \n    window.addEventListener('focus', handleWindowFocus);\n\n    //      \n    return () => {\n      window.removeEventListener('focus', handleWindowFocus);\n    };\n  }, [user?.uid, selectedWallet, wallets]);\n\n  // Centralized wallet selection management\n  const setWalletSelection = async (walletId: string, source: string = 'unknown') => {\n    console.log(` setWalletSelection called from ${source} with walletId:`, walletId);\n    console.log(' Previous selectedWallet:', selectedWallet);\n\n    setSelectedWallet(walletId);\n    const wallet = wallets.find(w => w.id === walletId);\n    if (wallet) {\n      setSenderPhone(wallet.phone);\n      console.log(' Wallet set successfully:', walletId, 'Phone:', wallet.phone);\n    }\n\n    //     localStorage\n    if (user?.uid) {\n      localStorage.setItem(getSelectedWalletKey(), walletId);\n      console.log(' Saved wallet to localStorage:', walletId);\n\n      // Save to Capacitor Preferences for native access (SmsReceiver)\n      try {\n        await Preferences.set({\n          key: 'selected_wallet_id',\n          value: walletId\n        });\n        await Preferences.set({\n          key: 'current_user_id',\n          value: user.uid\n        });\n        console.log(' Saved wallet and user ID to Capacitor Preferences:', walletId, user.uid);\n      } catch (err) {\n        console.error(' Failed to save to Capacitor Preferences:', err);\n      }\n    }\n  };\n\n  useEffect(() => {\n    const handler = () => {\n      loadWalletsFromFirebase();\n    };\n    try {\n      window.addEventListener('wallets:activation-updated' as any, handler as unknown as EventListener);\n    } catch { }\n    return () => {\n      try {\n        window.removeEventListener('wallets:activation-updated' as any, handler as unknown as EventListener);\n      } catch { }\n    };\n  }, [user?.uid]);\n\n  // Update sender phone when wallet selection changes\n  const handleWalletChange = (walletId: string) => {\n    //      \n    if (walletId === '__add_wallet') {\n      navigate('/user/add-wallet');\n      return;\n    }\n    if (walletId === '__view_wallets') {\n      setIsWalletsPinDialogOpen(true);\n      return;\n    }\n\n    // Gate changing selected wallet behind master PIN verification (configurable)\n    const requirePin = walletSelectionPinService.isEnabled(user?.uid);\n    if (requirePin) {\n      setPendingSelectedWalletId(walletId);\n      setIsWalletSelectionPinDialogOpen(true);\n    } else {\n      setWalletSelection(walletId, 'walletSelectionNoPin');\n    }\n  };\n\n  // Handle transaction type changes\n  const handleTransactionTypeChange = (type: 'transfer' | 'withdraw') => {\n    console.log(' handleTransactionTypeChange called with type:', type);\n    console.log(' Current selectedWallet before change:', selectedWallet);\n    console.log(' Available wallets count:', wallets.length);\n\n    setTransactionType(type);\n    // Clear receiver phone when switching transaction types\n    setReceiverPhone('');\n    // Clear amount when switching transaction types\n    setAmount('');\n    // Clear commission fields when switching transaction types\n    setManualCommission('');\n    setTransferCommission('');\n\n    // NEVER change the selected wallet when switching transaction types\n    // The user's wallet selection should persist across all transaction types\n    console.log(' Transaction type changed to:', type, '- Wallet selection preserved:', selectedWallet);\n\n    // Scroll to transaction section to show confirm button after a short delay\n    setTimeout(() => {\n      const transactionSection = document.getElementById('transaction-section');\n      if (transactionSection) {\n        transactionSection.scrollIntoView({\n          behavior: 'smooth',\n          block: 'start',\n          inline: 'nearest'\n        });\n      }\n    }, 100);\n  };\n\n  // Keyboard controls: Left/Right to toggle type, Enter to confirm\n  useEffect(() => {\n    const onKeyDown = (e: KeyboardEvent) => {\n      const target = e.target as HTMLElement | null;\n      const isEditable = !!target && (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.tagName === 'SELECT' || target.isContentEditable);\n\n      // Toggle type with arrows only when not editing an input\n      if (!isEditable) {\n        if (e.key === 'ArrowLeft') {\n          e.preventDefault();\n          handleTransactionTypeChange('withdraw');\n        } else if (e.key === 'ArrowRight') {\n          e.preventDefault();\n          handleTransactionTypeChange('transfer');\n        }\n      }\n\n      // Confirm current action with Enter\n      if (e.key === 'Enter') {\n        const id = transactionType === 'transfer' ? 'transferSubmitButton' : 'withdrawSubmitButton';\n        const btn = document.getElementById(id) as HTMLButtonElement | null;\n        if (btn && !btn.disabled) {\n          e.preventDefault();\n          btn.click();\n        }\n      }\n    };\n\n    window.addEventListener('keydown', onKeyDown);\n    return () => window.removeEventListener('keydown', onKeyDown);\n  }, [transactionType]);\n\n  // Handle transaction click to show details\n  const handleTransactionClick = (transaction: Transaction) => {\n    //        \n    const mapToReceiptTransaction = (t: Transaction) => ({\n      id: t.id,\n      type: t.type === 'send' ? 'transfer' : 'withdraw',\n      sender_msisdn: t.senderPhone,\n      receiver_msisdn: t.receiverPhone,\n      amount: t.amount,\n      commission: t.commission || 0,\n      fee: (t as any)?.fee ?? 0,\n      status: t.status === 'failed' ? 'failed' : (t.status === 'completed' ? 'completed' : 'pending'),\n      createdAt: new Date(t.createdAt).toISOString(),\n      updatedAt: new Date(t.createdAt).toISOString(),\n      shopName: shopName ?? profile?.shopName ?? user?.displayName ?? '',\n      //          \n      cashierName: (t as any)?.cashierName ?? null,\n      commissionMode: (t as any)?.commissionMode ?? (t.type === 'send' ? 'add' : (isCommissionAddMode ? 'add' : 'deduct')),\n      totalCharged: (t as any)?.totalCharged ?? (\n        t.type === 'send'\n          ? (Number(t.amount || 0) + Number(t.commission || 0) + Number((t as any)?.fee || 0))\n          : (isCommissionAddMode ? (Number(t.amount || 0) + Number(t.commission || 0)) : Number(t.amount || 0))\n      ),\n      note: (t as any)?.note ?? (t as any)?.notes ?? undefined,\n      senderName: (t as any)?.senderName ?? undefined,\n      provider: (t as any)?.provider ?? undefined,\n      title: (() => {\n        const p = String((t as any)?.provider || '').toLowerCase();\n        const short = p.includes('vodafone') ? 'vf-cash' : (p.includes('instapay') ? 'instapay' : '');\n        const base = t.type === 'send' ? '' : '';\n        return (t.type === 'withdraw' && short) ? `${base} ${short}` : base;\n      })()\n    });\n\n    setReceiptTransaction(mapToReceiptTransaction(transaction));\n    setIsReceiptOpen(true);\n  };\n\n  // Handle transaction deletion\n  const handleDeleteTransaction = async (transactionId: string) => {\n    //     \n    if (!user?.uid) {\n      toast({\n        title: \"  \",\n        description: \"     \",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    //     \n    const transactionToDelete = transactions.find(t => t.id === transactionId);\n\n    if (!transactionToDelete) {\n      toast({\n        title: \"  \",\n        description: \"      \",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const txKey = String(transactionId);\n    const refKey = String((transactionToDelete as any)?.transactionId || (transactionToDelete as any)?.reference || '');\n    deletedEffectsAppliedRef.current.add(txKey);\n    if (refKey) deletedEffectsAppliedRef.current.add(refKey);\n\n    try {\n      console.log('    :', transactionId);\n\n      // :     Firebase    \n      console.log('     Firebase...', {\n        transactionId: transactionToDelete.id,\n        userId: user.uid,\n        transactionData: transactionToDelete\n      });\n\n      //      userTransactions  Firebase\n      await userDataService.removeUserTransaction(user.uid, transactionToDelete.id);\n      console.log('      Firebase userTransactions');\n\n      //       \n      try {\n        await auditLogService.saveDeletedTransaction({\n          ...transactionToDelete,\n          userId: user.uid,\n          originalTransactionId: transactionToDelete.id,\n          transactionId: (transactionToDelete as any).transactionId || transactionToDelete.id,\n          reference: (transactionToDelete as any).reference || (transactionToDelete as any).transactionReference || (transactionToDelete as any).receipt?.reference,\n          deletedAt: new Date().toISOString(),\n          permanent: true\n        });\n        console.log('         ');\n      } catch (saveError) {\n        console.warn('           Firebase :', saveError);\n        //        \n      }\n\n      //          \n      try {\n        await auditLogService.permanentlyDeleteTransaction(transactionToDelete.id, user.uid);\n      } catch (e) {\n        console.warn('       :', e);\n      }\n\n      // :        Firebase\n      const updatedDeletedTransactions = [...deletedTransactions, transactionToDelete];\n      const updatedTransactions = transactions.filter(t => t.id !== transactionId);\n\n      setDeletedTransactions(updatedDeletedTransactions);\n      setTransactions(updatedTransactions);\n      setIsTransactionDetailsOpen(false);\n\n      console.log('       Firebase (  )');\n\n      //   /   Firebase\n      try {\n        const fromWalletId = (transactionToDelete as any).fromWallet;\n        if (fromWalletId) {\n          const { walletDailyLimitsService } = await import('@/utils/walletDailyLimitsService');\n          const limits = await walletDailyLimitsService.getWalletLimits(fromWalletId);\n          if (limits) {\n            const isTransfer = transactionToDelete.type === 'send';\n            const update: any = { updatedAt: (await import('firebase/firestore')).serverTimestamp() };\n            if (isTransfer) {\n              update.dailyTransferUsed = Math.max(0, (limits.dailyTransferUsed || 0) - transactionToDelete.amount);\n              update.monthlyTransferUsed = Math.max(0, (limits.monthlyTransferUsed || 0) - transactionToDelete.amount);\n            } else {\n              update.dailyWithdrawUsed = Math.max(0, (limits.dailyWithdrawUsed || 0) - transactionToDelete.amount);\n              update.monthlyWithdrawUsed = Math.max(0, (limits.monthlyWithdrawUsed || 0) - transactionToDelete.amount);\n            }\n            const { doc, setDoc } = await import('firebase/firestore');\n            const { db } = await import('@/firebase');\n            const ref = doc(db, 'walletLimits', fromWalletId);\n            await setDoc(ref, update, { merge: true });\n          }\n        }\n      } catch (e) {\n        console.warn('     :', e);\n      }\n\n      //       \n      try {\n        const { ProfitService } = await import('@/utils/profitService');\n        const { ReportsService } = await import('@/utils/reportsService');\n        const txnType = transactionToDelete.type === 'send' ? 'send' : 'receive';\n        const transactionData: any = {\n          txnType,\n          amount: transactionToDelete.amount,\n          commission: transactionToDelete.commission || 0,\n          createdAt: transactionToDelete.createdAt,\n          status: 'confirmed'\n        };\n        const profit = ProfitService.calculateProfitFromTransaction(transactionData);\n        if (profit > 0) {\n          ProfitService.addProfit(-profit, user.uid);\n        }\n        try {\n          ReportsService.removeTransactionEffects(transactionToDelete, user.uid);\n        } catch { }\n      } catch (e) {\n        console.warn('  /  :', e);\n      }\n\n      //   \n      toast({\n        title: \"   \",\n        description: \"     .      \",\n      });\n\n    } catch (error) {\n      console.error('      Firebase:', error);\n\n      //      Firebase    \n      let errorMessage = \"     .    \";\n\n      //       \n      if (error instanceof Error) {\n        if (error.message.includes('network') || error.message.includes('offline')) {\n          errorMessage = \"   .      \";\n        } else if (error.message.includes('permission') || error.message.includes('unauthorized')) {\n          errorMessage = \"     \";\n        } else if (error.message.includes('not-found')) {\n          errorMessage = \"      \";\n        }\n      }\n\n      toast({\n        title: \"  \",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Calculate withdrawal commission (no default commission - user must enter manually)\n  const calculateWithdrawalCommission = (amount: number) => {\n    return 0; // No default commission - user must enter manually\n  };\n\n  // Calculate transfer commission (5 per 1000)\n  const calculateTransferCommission = (amount: number) => {\n    return Math.ceil((amount / 1000) * 5);\n  };\n\n  const getWithdrawalTotal = () => {\n    const amountNum = parseFloat(amount) || 0;\n    //     -    \n    const commission = (manualCommission && manualCommission.trim() !== '') ? parseFloat(manualCommission) : 0;\n    return amountNum + commission;\n  };\n\n  const getTransferTotal = () => {\n    const amountNum = parseFloat(amount) || 0;\n    const commission = (transferCommission && transferCommission.trim() !== '') ? parseFloat(transferCommission) : 0;\n    return amountNum + commission;\n  };\n\n  //      \n  const isWithdrawTx = (tx: any) => {\n    const t = tx.type;\n    const xn = (tx as any).txnType;\n    return t === 'withdraw' || t === 'withdrawal' || t === 'receive' || xn === 'receive';\n  };\n  const isSendTx = (tx: any) => {\n    const t = tx.type;\n    const xn = (tx as any).txnType;\n    return t === 'send' || t === 'transfer' || xn === 'send';\n  };\n\n  //      \n  const calculateDailyStats = (walletId?: string, dateOverride?: Date) => {\n    const baseDateStr = (dateOverride ?? new Date()).toDateString();\n    let dayTransactions = transactions.filter(tx => {\n      const sameDay = new Date(tx.createdAt).toDateString() === baseDateStr;\n      const status = String(tx.status || '').toLowerCase();\n      return sameDay && (status === 'completed' || status === 'confirmed' || status === 'pending');\n    });\n\n    //         \n    if (walletId) {\n      dayTransactions = dayTransactions.filter(tx => tx.fromWallet === walletId);\n    }\n\n    //        \n    if (reportSearchPhone && reportSearchPhone.trim() !== '') {\n      dayTransactions = dayTransactions.filter(tx =>\n        (tx.senderPhone && tx.senderPhone.includes(reportSearchPhone)) ||\n        (tx.receiverPhone && tx.receiverPhone.includes(reportSearchPhone))\n      );\n    }\n\n    //      \n    const visibleTransactions = reportsService.filterVisibleTransactions(dayTransactions, 'daily', user?.uid);\n\n    const totalTransactions = visibleTransactions.length;\n    //        ( )\n    const totalAmount = visibleTransactions.reduce((sum, tx) => sum + tx.amount, 0);\n\n    //     \n    const totalWithdrawn = visibleTransactions\n      .filter(isWithdrawTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).withdrawnAmount !== undefined ? (tx as any).withdrawnAmount : tx.amount;\n        return sum + amount;\n      }, 0);\n\n    const totalSent = visibleTransactions\n      .filter(isSendTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).sentAmount !== undefined ? (tx as any).sentAmount : tx.amount;\n        return sum + amount;\n      }, 0);\n\n    return { totalTransactions, totalAmount, totalWithdrawn, totalSent };\n  };\n\n  const calculateMonthlyStats = (walletId?: string) => {\n    const currentMonth = new Date().getMonth();\n    const currentYear = new Date().getFullYear();\n\n    let monthlyTransactions = transactions.filter(tx => {\n      const txDate = new Date(tx.createdAt);\n      return txDate.getMonth() === currentMonth &&\n        txDate.getFullYear() === currentYear &&\n        tx.status === 'completed';\n    });\n\n    //         \n    if (walletId) {\n      monthlyTransactions = monthlyTransactions.filter(tx => tx.fromWallet === walletId);\n    }\n\n    //        \n    if (reportSearchPhone && reportSearchPhone.trim() !== '') {\n      monthlyTransactions = monthlyTransactions.filter(tx =>\n        (tx.senderPhone && tx.senderPhone.includes(reportSearchPhone)) ||\n        (tx.receiverPhone && tx.receiverPhone.includes(reportSearchPhone))\n      );\n    }\n\n    //      \n    const visibleMonthlyTransactions = reportsService.filterVisibleTransactions(monthlyTransactions, 'monthly', user?.uid);\n\n    const totalTransactions = visibleMonthlyTransactions.length;\n    //        ( )\n    const totalAmount = visibleMonthlyTransactions.reduce((sum, tx) => sum + tx.amount, 0);\n\n    //       \n    const totalWithdrawn = visibleMonthlyTransactions\n      .filter(isWithdrawTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).withdrawnAmount !== undefined ? (tx as any).withdrawnAmount : tx.amount;\n        return sum + amount;\n      }, 0);\n\n    const totalSent = visibleMonthlyTransactions\n      .filter(isSendTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).sentAmount !== undefined ? (tx as any).sentAmount : tx.amount;\n        return sum + amount;\n      }, 0);\n\n    return { totalTransactions, totalAmount, totalWithdrawn, totalSent };\n  };\n\n  //     \n  const calculateWalletMonthlyUsage = (walletId: string) => {\n    const currentMonth = new Date().getMonth();\n    const currentYear = new Date().getFullYear();\n\n    const walletTransactions = transactions.filter(tx => {\n      const txDate = new Date(tx.createdAt);\n      return txDate.getMonth() === currentMonth &&\n        txDate.getFullYear() === currentYear &&\n        tx.status === 'completed' &&\n        tx.fromWallet === walletId;\n    });\n\n    const totalWithdrawn = walletTransactions\n      .filter(isWithdrawTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).withdrawnAmount || tx.amount;\n        return sum + amount;\n      }, 0);\n\n    const totalTransferred = walletTransactions\n      .filter(isSendTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).sentAmount || tx.amount;\n        return sum + amount;\n      }, 0);\n\n    return { totalWithdrawn, totalTransferred };\n  };\n\n  //     \n  const calculateWalletDailyUsage = (walletId: string) => {\n    const today = new Date();\n    const currentDay = today.getDate();\n    const currentMonth = today.getMonth();\n    const currentYear = today.getFullYear();\n\n    const walletTransactions = transactions.filter(tx => {\n      const txDate = new Date(tx.createdAt);\n      return txDate.getDate() === currentDay &&\n        txDate.getMonth() === currentMonth &&\n        txDate.getFullYear() === currentYear &&\n        tx.status === 'completed' &&\n        tx.fromWallet === walletId;\n    });\n\n    const totalWithdrawn = walletTransactions\n      .filter(isWithdrawTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).withdrawnAmount || tx.amount;\n        return sum + amount;\n      }, 0);\n\n    const totalTransferred = walletTransactions\n      .filter(isSendTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).sentAmount || tx.amount;\n        return sum + amount;\n      }, 0);\n\n    return { totalWithdrawn, totalTransferred };\n  };\n\n  //       (   )\n  const currentMonthlyStats = React.useMemo(() => calculateMonthlyStats(), [transactions, selectedWallet, reportSearchPhone]);\n  \n  //    (   )\n  const currentDailyStats = React.useMemo(() => calculateDailyStats(), [transactions, selectedWallet, reportSearchPhone, user?.uid]);\n  const monthlyWithdrawn = currentMonthlyStats.totalWithdrawn;\n  const monthlyTransferred = currentMonthlyStats.totalSent;\n\n  //        \n  const walletMonthlyUsageMemo = React.useMemo(\n    () => calculateWalletMonthlyUsage(selectedWallet),\n    [transactions, selectedWallet]\n  );\n\n  //        \n  const walletDailyUsageMemo = React.useMemo(\n    () => calculateWalletDailyUsage(selectedWallet),\n    [transactions, selectedWallet]\n  );\n\n  const cachedLocalWallets = React.useMemo(() => {\n    try {\n      return JSON.parse(localStorage.getItem(getWalletsKey()) || '[]');\n    } catch {\n      return [];\n    }\n  }, [user?.uid]);\n\n\n  //           ( 85%)\n  useEffect(() => {\n    try {\n      if (!selectedWallet || wallets.length === 0) return;\n      const selectedWalletObj = wallets.find(w => w.id === selectedWallet);\n      if (!selectedWalletObj) return;\n      const monthlyWithdrawalLimit = selectedWalletLimits?.monthlyWithdrawLimit ?? selectedWalletObj?.monthlyWithdrawalLimit ?? 200000;\n      const monthlyTransferLimit = selectedWalletLimits?.monthlyTransferLimit ?? selectedWalletObj?.monthlyTransferLimit ?? 200000;\n      const amountNum = parseFloat(amount || '0') || 0;\n      const monthlyWithdrawUsed = (walletMonthlyUsageMemo as any)?.totalWithdrawn ?? selectedWalletLimits?.monthlyWithdrawUsed ?? 0;\n      const monthlyTransferUsed = (walletMonthlyUsageMemo as any)?.totalTransferred ?? selectedWalletLimits?.monthlyTransferUsed ?? 0;\n      const predictedMonthlyWithdrawUsed = monthlyWithdrawUsed + (transactionType === 'withdraw' ? amountNum : 0);\n      const predictedMonthlyTransferUsed = monthlyTransferUsed + (transactionType === 'transfer' ? amountNum : 0);\n\n      const percent = 0.85;\n      const withdrawThreshold = Math.floor(Math.max(monthlyWithdrawalLimit, 1) * percent);\n      const transferThreshold = Math.floor(Math.max(monthlyTransferLimit, 1) * percent);\n      const monthKey = (() => {\n        const d = new Date();\n        return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;\n      })();\n      const warnKeyBase = `monthlyLimitWarnShown:${selectedWallet}:${monthKey}`;\n\n      if (predictedMonthlyWithdrawUsed >= withdrawThreshold) {\n        const key = `${warnKeyBase}:withdraw`;\n        const shown = localStorage.getItem(key) === 'true';\n        if (!shown) {\n          setMonthlyLimitWarnData({ type: 'withdraw', used: predictedMonthlyWithdrawUsed, limit: monthlyWithdrawalLimit, walletName: selectedWalletObj.name });\n          setIsMonthlyLimitWarnOpen(true);\n          try { localStorage.setItem(key, 'true'); } catch { }\n          return;\n        }\n      }\n\n      if (predictedMonthlyTransferUsed >= transferThreshold) {\n        const key = `${warnKeyBase}:transfer`;\n        const shown = localStorage.getItem(key) === 'true';\n        if (!shown) {\n          setMonthlyLimitWarnData({ type: 'transfer', used: predictedMonthlyTransferUsed, limit: monthlyTransferLimit, walletName: selectedWalletObj.name });\n          setIsMonthlyLimitWarnOpen(true);\n          try { localStorage.setItem(key, 'true'); } catch { }\n          return;\n        }\n      }\n    } catch { }\n  }, [selectedWallet, wallets, selectedWalletLimits, walletMonthlyUsageMemo, transactionType, amount]);\n\n  //      localStorage:    Firebase \n\n  //      localStorage:     \n\n  const handleTransaction = async () => {\n    //    ()     \n    playVodafoneShakshan();\n    console.log('   /');\n    console.log('  :', {\n      senderPhone,\n      receiverPhone,\n      amount,\n      transactionType\n    });\n\n    //      (Optimistic UI)\n    const setSuccessOptimistic = () => {\n      if (transactionType === 'transfer') {\n        setIsTransferSuccess(true);\n      } else {\n        setIsWithdrawSuccess(true);\n      }\n    };\n    const revertSuccess = () => {\n      if (transactionType === 'transfer') {\n        setIsTransferSuccess(false);\n      } else {\n        setIsWithdrawSuccess(false);\n      }\n    };\n    setSuccessOptimistic();\n\n    if (!senderPhone || !amount) {\n      console.log(' :  ');\n      toast({\n        title: \"  \",\n        description: \"    \",\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n\n    if (transactionType === 'transfer' && !receiverPhone && !isVodafoneCashUser) {\n      console.log(' :   ');\n      toast({\n        title: \"  \",\n        description: \"   \",\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n\n    //    :       \n    //    /      \n    if (transactionType === 'transfer' && !isVodafoneCashUser) {\n      const onlyDigits = String(receiverPhone || '').replace(/[^0-9-]/g, '');\n      const hasLettersOrText = /[^0-9-\\s]/.test(String(receiverPhone || ''));\n      if (!hasLettersOrText) {\n        if (!strictValidateMsisdn(receiverPhone)) {\n          toast({\n            title: \"   \",\n            description: \"     11    015  010  012  011\",\n            variant: \"destructive\",\n          });\n          revertSuccess();\n          return;\n        }\n      }\n    }\n\n    const amountNum = parseFloat(amount);\n    console.log('  :', amountNum);\n\n    if (amountNum <= 0) {\n      console.log(' :   ');\n      toast({\n        title: \"  \",\n        description: \"   \",\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n\n    //      : 10  \n    if (isZeroPlan) {\n      try {\n        const today = new Date();\n        const yyyy = today.getFullYear();\n        const mm = String(today.getMonth() + 1).padStart(2, '0');\n        const dd = String(today.getDate()).padStart(2, '0');\n        const dailyKey = `zeroPlanDailyConfirmCount:${user?.uid || 'default'}:${yyyy}-${mm}-${dd}`;\n        const usedCountRaw = localStorage.getItem(dailyKey);\n        const usedCount = usedCountRaw ? parseInt(usedCountRaw, 10) || 0 : 0;\n        if (usedCount >= 10) {\n          toast({\n            title: '  ',\n            description: '    10  /  .',\n            variant: 'destructive',\n          });\n          revertSuccess();\n          return;\n        }\n      } catch (e) {\n        console.warn('        :', e);\n      }\n    }\n\n    //      \n    const selectedWalletObj = wallets.find(w => w.id === selectedWallet);\n    if (!selectedWalletObj) {\n      toast({\n        title: \"  \",\n        description: \"   \",\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n\n    const walletUsage = walletMonthlyUsageMemo;\n    console.log('     ');\n    console.log('   :', {\n      walletId: selectedWallet,\n      walletName: selectedWalletObj.name,\n      currentWithdrawn: walletUsage.totalWithdrawn,\n      currentTransferred: walletUsage.totalTransferred,\n      withdrawalLimit: selectedWalletObj.monthlyWithdrawalLimit,\n      transferLimit: selectedWalletObj.monthlyTransferLimit\n    });\n\n    if (transactionType === 'withdraw') {\n      console.log('     ');\n      console.log(`    : ${walletUsage.totalWithdrawn},  : ${amountNum},  : ${selectedWalletObj.monthlyWithdrawalLimit}`);\n\n      if (walletUsage.totalWithdrawn + amountNum > selectedWalletObj.monthlyWithdrawalLimit) {\n        console.log('     ');\n        toast({\n          title: \"   \",\n          description: `     ${selectedWalletObj.monthlyWithdrawalLimit}     ${selectedWalletObj.name}`,\n          variant: \"destructive\",\n        });\n        revertSuccess();\n        return;\n      }\n    } else {\n      console.log('     ');\n      console.log(`    : ${walletUsage.totalTransferred},  : ${amountNum},  : ${selectedWalletObj.monthlyTransferLimit}`);\n\n      if (walletUsage.totalTransferred + amountNum > selectedWalletObj.monthlyTransferLimit) {\n        console.log('     ');\n        toast({\n          title: \"   \",\n          description: `     ${selectedWalletObj.monthlyTransferLimit}     ${selectedWalletObj.name}`,\n          variant: \"destructive\",\n        });\n        revertSuccess();\n        return;\n      }\n    }\n\n    //        (    )\n    const merchantShopName = profile?.shopName || user?.displayName || '  ';\n\n    const newTransaction: Transaction = {\n      id: Date.now().toString(),\n      type: transactionType === 'transfer' ? 'send' : transactionType === 'deposit' ? 'deposit' : 'withdraw',\n      senderPhone,\n      receiverPhone: transactionType === 'transfer' ? receiverPhone : senderPhone,\n      amount: amountNum,\n      status: 'completed',\n      createdAt: new Date(),\n      withdrawnAmount: transactionType === 'withdraw' ? amountNum : undefined,\n      sentAmount: transactionType === 'transfer' ? amountNum : undefined,\n      depositedAmount: undefined,\n      fromWallet: selectedWallet,\n      //    \n      senderNumber: senderPhone,\n      senderName: transactionType === 'withdraw' && withdrawSenderName.trim() !== '' ? withdrawSenderName.trim() : undefined,\n      shopName: selectedWalletObj?.name || ' ',\n      transferredAmount: transactionType === 'transfer' ? amountNum : undefined,\n      receiverNumber: transactionType === 'transfer' ? receiverPhone : undefined,\n      withdrawnAmountDetailed: transactionType === 'withdraw' ? amountNum : undefined,\n      depositedAmountDetailed: undefined,\n      merchantShopName: merchantShopName,\n      transactionReference: `TXN-${Date.now()}`,\n      commission: 0, //       \n      notes: transactionType === 'transfer'\n        ? undefined\n        : (withdrawNote && withdrawNote.trim() !== '' ? withdrawNote.trim() : undefined)\n    };\n\n    //               \n    if (isShiftActive && (shiftUser?.name || shiftUser?.username)) {\n      (newTransaction as any).cashierName = shiftUser?.name || shiftUser?.username;\n    }\n\n    //       \n    const validation = WalletCashService.validateTransaction(\n      amountNum,\n      transactionType,\n      cashBalance,\n      walletBalances\n    );\n\n    if (!validation.isValid) {\n      toast({\n        title: \"  \",\n        description: validation.error,\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n\n    //      \n    if (validation.warning) {\n      toast({\n        title: \"\",\n        description: validation.warning,\n        variant: \"destructive\",\n      });\n    }\n\n    //  :\n    // -      ( )    .\n    // -          .\n    // -       :    (1%  ).\n    let commissionAmount: number;\n    if (transactionType === 'transfer') {\n      if (selectedWalletObj?.defaultTransferCommission != null) {\n        const rate = Number(selectedWalletObj.defaultTransferCommission) || 0;\n        commissionAmount = Math.round(((rate * amountNum) / 1000) * 100) / 100;\n      } else if (transferCommission && transferCommission.trim() !== '') {\n        commissionAmount = Math.max(0, parseFloat(transferCommission));\n      } else {\n        commissionAmount = 0;\n      }\n    } else { // withdraw\n      if (selectedWalletObj?.defaultWithdrawCommission != null) {\n        const rate = Number(selectedWalletObj.defaultWithdrawCommission) || 0;\n        commissionAmount = Math.round(((rate * amountNum) / 1000) * 100) / 100;\n      } else if (manualCommission && manualCommission.trim() !== '') {\n        commissionAmount = Math.max(0, parseFloat(manualCommission));\n      } else {\n        //   : 1%  \n        commissionAmount = Math.round((amountNum * 0.01) * 100) / 100;\n      }\n    }\n\n    //        /\n    newTransaction.commission = commissionAmount;\n\n    //        (/)\n    if (transactionType !== 'transfer' && !isCommissionAddMode && commissionAmount >= amountNum) {\n      toast({\n        title: \"  \",\n        description: \"      \",\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n    const effectiveAmount = transactionType === 'transfer'\n      ? amountNum\n      : (isCommissionAddMode ? amountNum : Math.round((amountNum - commissionAmount) * 100) / 100);\n    //          \n    newTransaction.amount = effectiveAmount;\n    newTransaction.withdrawnAmount = transactionType === 'withdraw' ? effectiveAmount : undefined;\n    newTransaction.sentAmount = transactionType === 'transfer' ? effectiveAmount : undefined;\n    newTransaction.transferredAmount = transactionType === 'transfer' ? effectiveAmount : undefined;\n    newTransaction.withdrawnAmountDetailed = transactionType === 'withdraw' ? effectiveAmount : undefined;\n\n    //     \n    let result;\n    //         (  )\n    const isDeferredTransfer = transactionType === 'transfer' && !!quickDebtInfo;\n    const isDeferredWithdraw = transactionType === 'withdraw' && !!quickDebtInfo;\n    const skipProcess = isDeferredTransfer || isDeferredWithdraw;\n    let linkedDebtId: string | null = null;\n\n    //     010011   \n    const sDigits = normalizeDigits(senderPhone || '').replace(/\\D/g, '');\n    const rDigits = normalizeDigits(receiverPhone || '').replace(/\\D/g, '');\n    const is010To011 = transactionType === 'transfer' && ((sDigits.startsWith('010') && (rDigits.startsWith('011') || rDigits.startsWith('012') || rDigits.startsWith('015'))) || (sDigits.startsWith('012') && rDigits.startsWith('010')) || (sDigits.startsWith('011') && rDigits.startsWith('010')) || (sDigits.startsWith('015') && rDigits.startsWith('010')));\n    const extraFee = Math.max(0, parseFloat(transferExtraFee || '0'));\n    const fullCommission = Math.round((commissionAmount * 100)) / 100;\n    newTransaction.commission = fullCommission;\n    (newTransaction as any).fee = extraFee;\n    (newTransaction as any).totalCharged = transactionType === 'transfer'\n      ? (Number(effectiveAmount) + Number(fullCommission) + Number(extraFee))\n      : (isCommissionAddMode ? (Number(effectiveAmount) + Number(fullCommission)) : Number(effectiveAmount));\n\n    //       \n    if (is010To011 && !skipProcess && extraFee <= 0) {\n      toast({\n        title: \"\",\n        description: \"    010  011/012/015  012  010  011  010  015  010\",\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n\n    //        (  )\n    if (transactionType === 'transfer' && !skipProcess) {\n      const currentWalletBalance = Number(walletBalances[selectedWallet] || 0);\n      const totalDebit = Number(effectiveAmount) + Number(extraFee);\n      if (currentWalletBalance < totalDebit) {\n        toast({\n          title: \"   \",\n          description: `  ${currentWalletBalance}    ${totalDebit}`,\n          variant: \"destructive\",\n        });\n        revertSuccess();\n        return;\n      }\n    }\n\n    if (skipProcess) {\n      //  \n      if (isDeferredTransfer) {\n        const check = WalletCashService.validateTransaction(\n          effectiveAmount,\n          'transfer',\n          cashBalance,\n          walletBalances\n        );\n        if (!check.isValid) {\n          result = {\n            success: false,\n            newCashBalance: cashBalance,\n            newWalletBalances: walletBalances,\n            message: check.error || '    ',\n            error: 'INSUFFICIENT_WALLET_BALANCE'\n          } as any;\n        } else {\n          const effectiveSelectedWalletId = selectedWallet || (wallets.find((w: any) => w.isDefault)?.id) || (wallets[0]?.id);\n          const limitsSrc = selectedWalletLimits ?? await walletDailyLimitsService.getWalletLimits(effectiveSelectedWalletId!);\n          const todayStr = new Date().toDateString();\n          const pendingToday = transactions\n            .filter(tx => tx.type === 'send' && String(tx.status || '').toLowerCase() === 'pending' && (tx.fromWallet === effectiveSelectedWalletId) && new Date(tx.createdAt).toDateString() === todayStr)\n            .reduce((sum, tx) => sum + Number((tx as any).sentAmount ?? (tx as any).transferredAmount ?? tx.amount ?? 0), 0);\n          const dailyLimit = Number((limitsSrc as any)?.dailyTransferLimit ?? 60000);\n          const dailyUsed = Number((limitsSrc as any)?.dailyTransferUsed ?? 0);\n          if (dailyUsed + pendingToday + Number(effectiveAmount) > dailyLimit) {\n            toast({ title: '   ', description: ` : ${(dailyLimit - dailyUsed - pendingToday).toLocaleString()} .`, variant: 'destructive' });\n            revertSuccess();\n            return;\n          }\n\n          const now = new Date();\n          const pendingMonth = transactions\n            .filter(tx => tx.type === 'send' && String(tx.status || '').toLowerCase() === 'pending' && (tx.fromWallet === effectiveSelectedWalletId) && new Date(tx.createdAt).getMonth() === now.getMonth() && new Date(tx.createdAt).getFullYear() === now.getFullYear())\n            .reduce((sum, tx) => sum + Number((tx as any).sentAmount ?? (tx as any).transferredAmount ?? tx.amount ?? 0), 0);\n          const monthlyLimit = Number((limitsSrc as any)?.monthlyTransferLimit ?? 200000);\n          const monthlyUsed = Number((limitsSrc as any)?.monthlyTransferUsed ?? 0);\n          if (monthlyUsed + pendingMonth + Number(effectiveAmount) > monthlyLimit) {\n            toast({ title: '   ', description: `  : ${(monthlyLimit - monthlyUsed - pendingMonth).toLocaleString()} .`, variant: 'destructive' });\n            revertSuccess();\n            return;\n          }\n\n          result = { success: true, newCashBalance: cashBalance, newWalletBalances: walletBalances } as any;\n        }\n      } else {\n        const effectiveSelectedWalletId = selectedWallet || (wallets.find((w: any) => w.isDefault)?.id) || (wallets[0]?.id);\n        const limitsSrc = selectedWalletLimits ?? await walletDailyLimitsService.getWalletLimits(effectiveSelectedWalletId!);\n        const todayStr = new Date().toDateString();\n        const pendingToday = transactions\n          .filter(tx => tx.type === 'withdraw' && String(tx.status || '').toLowerCase() === 'pending' && (tx.fromWallet === effectiveSelectedWalletId) && new Date(tx.createdAt).toDateString() === todayStr)\n          .reduce((sum, tx) => sum + Number((tx as any).withdrawnAmount ?? tx.amount ?? 0), 0);\n        const dailyLimit = Number((limitsSrc as any)?.dailyWithdrawLimit ?? 100000);\n        const dailyUsed = Number((limitsSrc as any)?.dailyWithdrawUsed ?? 0);\n        if (dailyUsed + pendingToday + Number(effectiveAmount) > dailyLimit) {\n          toast({ title: '   ', description: ` : ${(dailyLimit - dailyUsed - pendingToday).toLocaleString()} .`, variant: 'destructive' });\n          revertSuccess();\n          return;\n        }\n\n        const now = new Date();\n        const pendingMonth = transactions\n          .filter(tx => tx.type === 'withdraw' && String(tx.status || '').toLowerCase() === 'pending' && (tx.fromWallet === effectiveSelectedWalletId) && new Date(tx.createdAt).getMonth() === now.getMonth() && new Date(tx.createdAt).getFullYear() === now.getFullYear())\n          .reduce((sum, tx) => sum + Number((tx as any).withdrawnAmount ?? tx.amount ?? 0), 0);\n        const monthlyLimit = Number((limitsSrc as any)?.monthlyWithdrawLimit ?? 200000);\n        const monthlyUsed = Number((limitsSrc as any)?.monthlyWithdrawUsed ?? 0);\n        if (monthlyUsed + pendingMonth + Number(effectiveAmount) > monthlyLimit) {\n          toast({ title: '   ', description: `  : ${(monthlyLimit - monthlyUsed - pendingMonth).toLocaleString()} .`, variant: 'destructive' });\n          revertSuccess();\n          return;\n        }\n\n        const newCash = Math.round((Number(cashBalance) - Number(effectiveAmount)) * 100) / 100;\n        result = { success: true, newCashBalance: newCash, newWalletBalances: walletBalances } as any;\n      }\n    } else if (transactionType === 'transfer') {\n      // :      \n      result = await WalletCashService.processTransfer({\n        amount: effectiveAmount,\n        currentCashBalance: cashBalance,\n        currentWalletBalances: walletBalances,\n        wallets: wallets,\n        selectedWalletId: selectedWallet,\n        //     /\n        skipRemoteLimitsCheck: false,\n        nonBlockingUsageUpdate: true\n      });\n    } else {\n      // :      \n      result = await WalletCashService.processWithdraw({\n        amount: effectiveAmount,\n        currentCashBalance: cashBalance,\n        currentWalletBalances: walletBalances,\n        wallets: wallets,\n        selectedWalletId: selectedWallet,\n        //     /\n        skipRemoteLimitsCheck: false,\n        nonBlockingUsageUpdate: true\n      });\n    }\n\n    if (!result.success) {\n      toast({\n        title: \"  \",\n        description: result.error || result.message,\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n\n    //       \n    let newCashBalance = skipProcess ? (isDeferredWithdraw ? result.newCashBalance : cashBalance) : result.newCashBalance;\n    let newWalletBalances = skipProcess ? walletBalances : result.newWalletBalances;\n    //          \n    if (!skipProcess && transactionType === 'transfer' && extraFee > 0) {\n      const prevBalance = Number(newWalletBalances[selectedWallet] || 0);\n      newWalletBalances = {\n        ...newWalletBalances,\n        [selectedWallet]: Math.round((prevBalance - Number(extraFee)) * 100) / 100,\n      };\n    }\n    //          \n    //       \n\n    //              \n    if (skipProcess && isDeferredTransfer) {\n      const walletObj =\n        wallets.find((w: any) => w.id === selectedWallet) ??\n        wallets.find((w: any) => w.isDefault) ??\n        wallets[0];\n      const effectiveSelectedWalletId = walletObj?.id || selectedWallet;\n\n      if (effectiveSelectedWalletId !== selectedWallet) {\n        try {\n          setWalletSelection(effectiveSelectedWalletId);\n        } catch { }\n      }\n\n      const previousBalance = Number(walletBalances[effectiveSelectedWalletId] || 0);\n      newWalletBalances = {\n        ...walletBalances,\n        [effectiveSelectedWalletId]: Math.round((previousBalance - Number(effectiveAmount) - Number(extraFee)) * 100) / 100\n      };\n    }\n\n    //     (  )       \n    if ((isDeferredTransfer || isDeferredWithdraw) && quickDebtInfo && !didCreateQuickDebt) {\n      const newDebt: Debt = {\n        id: `DEBT-${Date.now()}`,\n        debtorName: quickDebtInfo.debtorName,\n        amount: quickDebtInfo.amount,\n        reason: quickDebtInfo.notes || '',\n        customerId: quickDebtInfo.customerId,\n        mobile: quickDebtInfo.mobile,\n        status: 'pending',\n        createdAt: new Date(),\n      };\n      linkedDebtId = newDebt.id;\n      //        \n      (newTransaction as any).linkedDebtId = linkedDebtId;\n      const updatedDebts = [newDebt, ...debts];\n      setDebts(updatedDebts);\n      try {\n        await saveDebtsToStorage(updatedDebts);\n        // Explicit sync for new deferred debt to debts collection - RE-ENABLED\n        if (user?.uid) {\n           const debtRef = doc(db, 'debts', newDebt.id);\n           const p: any = { \n               ...newDebt, \n               userId: user.uid, \n               shopId: shopIdCtx || profile?.shopId || null, \n               lastUpdated: new Date().toISOString() \n           };\n           Object.keys(p).forEach(key => p[key] === undefined && delete p[key]);\n           await setDoc(debtRef, p, { merge: true });\n        }\n      } catch (e) {\n        console.error('       :', e);\n      }\n      toast({ title: '  ', description: '      ', variant: 'default' });\n    }\n\n    //      ( )\n    //          \n    if (!skipProcess) {\n      const addToCash = Math.max(0, Number(commissionAmount)) + Math.max(0, Number(extraFee));\n      if (addToCash > 0) {\n        newCashBalance = Math.round((newCashBalance + addToCash) * 100) / 100;\n        console.log(`   / ${addToCash}   `);\n      }\n    }\n\n    //          startTransition\n    console.log('       startTransition...');\n    \n    //      \n    const tempTransactionId = 'temp_' + Date.now() + '_' + Math.random().toString(36).substring(7);\n    const transactionDataCreateOptimistic = {\n      shopId: (shopIdCtx || profile?.shopId || user?.uid || 'default-shop'),\n      lineId: selectedWallet || 'default-line',\n      walletId: selectedWallet || undefined,\n      merchantUserId: user?.uid || null,\n      provider: 'vodafone_cash' as const,\n      txnType: transactionType === 'transfer' ? 'send' as const : 'receive' as const,\n      originType: transactionType === 'transfer' ? 'transfer' as const : 'withdraw' as const,\n      amount: effectiveAmount,\n      commission: fullCommission,\n      fee: extraFee,\n      profit: 0,\n      senderMsisdn: senderPhone,\n      receiverMsisdn: transactionType === 'transfer' ? receiverPhone : senderPhone,\n      note: transactionType === 'transfer' ? undefined : (withdrawNote && withdrawNote.trim() !== '' ? withdrawNote.trim() : undefined),\n      status: (skipProcess ? 'pending' as const : 'confirmed' as const),\n      linkedDebtId: linkedDebtId || undefined,\n      createdBy: user?.uid || null,\n      walletEffectAppliedOnCreation: false,\n      cashEffectAppliedOnCreation: !!(skipProcess && isDeferredWithdraw),\n      limitsReservedOnCreation: !!(skipProcess),\n      limitReservedType: (transactionType === 'transfer' ? 'transfer' as const : 'withdraw' as const),\n      profitAddedOnCreation: false\n    };\n\n    const optimisticTransaction = {\n      ...transactionDataCreateOptimistic,\n      id: tempTransactionId,\n      status: (skipProcess ? 'pending' as const : 'completed' as const),\n      commissionMode: transactionType === 'transfer' ? 'add' : (isCommissionAddMode ? 'add' : 'deduct'),\n      totalCharged: transactionType === 'transfer' ? (effectiveAmount + fullCommission + extraFee) : (isCommissionAddMode ? (effectiveAmount + commissionAmount) : effectiveAmount),\n      walletEffectAppliedOnCreation: false,\n      cashEffectAppliedOnCreation: !!(skipProcess && isDeferredWithdraw),\n      limitsReservedOnCreation: !!(skipProcess),\n      limitReservedType: (transactionType === 'transfer' ? 'transfer' as const : 'withdraw' as const),\n      sentAmount: transactionType === 'transfer' ? effectiveAmount : undefined,\n      transferredAmount: transactionType === 'transfer' ? effectiveAmount : undefined,\n      withdrawnAmount: transactionType === 'withdraw' ? effectiveAmount : undefined,\n      senderName: transactionType === 'withdraw' && withdrawSenderName.trim() !== '' ? withdrawSenderName.trim() : undefined,\n      createdAt: new Date(),\n      // Ensure compatibility with display logic\n      type: transactionType === 'transfer' ? 'send' : 'withdraw',\n      senderPhone: senderPhone || '',\n      receiverPhone: receiverPhone || '',\n    };\n\n    //     \n    try {\n        //    \n        localTransactionsBuffer.current = [optimisticTransaction, ...localTransactionsBuffer.current];\n        \n        //   React Query \n        queryClientHook.setQueryData(\n          ['recentTransactions', user?.uid, (shopIdCtx || 'main')],\n          (oldData: any) => {\n             if (!oldData || !Array.isArray(oldData)) return [optimisticTransaction];\n             return [optimisticTransaction, ...oldData];\n          }\n        );\n    } catch (e) { console.error('Error in optimistic update:', e); }\n\n    //    ()\n    if (selectedWallet && selectedWalletLimits) {\n        try {\n            const isTransfer = transactionType === 'transfer';\n            const newLimits = { ...selectedWalletLimits };\n            if (isTransfer) {\n                newLimits.dailyTransferUsed = (newLimits.dailyTransferUsed || 0) + effectiveAmount;\n                newLimits.monthlyTransferUsed = (newLimits.monthlyTransferUsed || 0) + effectiveAmount;\n            } else {\n                newLimits.dailyWithdrawUsed = (newLimits.dailyWithdrawUsed || 0) + effectiveAmount;\n                newLimits.monthlyWithdrawUsed = (newLimits.monthlyWithdrawUsed || 0) + effectiveAmount;\n            }\n            setSelectedWalletLimits(newLimits);\n            // Do NOT dispatch event here as it triggers a re-fetch of old data from Firestore\n            // before the update is committed. We only update the local state optimistically.\n            // try { window.dispatchEvent(new CustomEvent('walletLimitsUpdated', { detail: { walletId: selectedWallet } })); } catch { }\n        } catch (e) { console.error('Error in optimistic limit update:', e); }\n    }\n\n    const updatedTransactionsList = [optimisticTransaction, ...transactions];\n    \n    //   \n    React.startTransition(() => {\n      setCashBalance(newCashBalance);\n      setWalletBalances(newWalletBalances);\n      if (skipProcess) {\n        (newTransaction as any).status = 'pending';\n      }\n      setTransactions(updatedTransactionsList);\n    });\n    \n    try {\n      setTimeout(() => {\n        try {\n          localStorage.setItem(getTransactionsKey(), JSON.stringify(updatedTransactionsList));\n        } catch { }\n      }, 0);\n    } catch { }\n\n    //       \n    if (isZeroPlan) {\n      try {\n        const today = new Date();\n        const yyyy = today.getFullYear();\n        const mm = String(today.getMonth() + 1).padStart(2, '0');\n        const dd = String(today.getDate()).padStart(2, '0');\n        const dailyKey = `zeroPlanDailyConfirmCount:${user?.uid || 'default'}:${yyyy}-${mm}-${dd}`;\n        const usedCountRaw = localStorage.getItem(dailyKey);\n        const usedCount = usedCountRaw ? parseInt(usedCountRaw, 10) || 0 : 0;\n        localStorage.setItem(dailyKey, String(usedCount + 1));\n      } catch { }\n    }\n\n    //     localStorage      \n    setTimeout(() => {\n      try {\n        const timestamp = new Date().toISOString();\n        localStorage.setItem(getCashBalanceKey(), newCashBalance.toString());\n        localStorage.setItem(getCashBalanceKey() + '_lastUpdated', timestamp);\n        localStorage.setItem(getWalletBalancesKey(), JSON.stringify(newWalletBalances));\n        localStorage.setItem(getWalletBalancesKey() + '_lastUpdated', timestamp);\n      } catch { }\n    }, 0);\n\n    try {\n      if (user?.uid) {\n        const walletObj =\n          wallets.find((w: any) => w.id === selectedWallet) ??\n          wallets.find((w: any) => w.isDefault) ??\n          wallets[0];\n        const effectiveWalletId = walletObj?.id || selectedWallet;\n        const remainingWalletBalance = Number((newWalletBalances as any)[effectiveWalletId] || 0);\n        const srcPhone = String(walletObj?.phone || senderPhone || '').trim();\n        const dstPhone = String(receiverPhone || '').trim();\n        const hasFee = Number(extraFee) > 0;\n        const mark = transactionType === 'transfer' ? '' : '';\n        const commissionPart = Number(fullCommission) > 0 ? `${Number(fullCommission)} ` : '0 ';\n        const feePart = hasFee ? `   ${Number(extraFee)} ` : '';\n        const msg = transactionType === 'transfer'\n          ? `${mark}    ${Number(effectiveAmount)}     ${srcPhone}    ${dstPhone}    ${commissionPart}${feePart}.    : ${remainingWalletBalance} .   : ${Number(newCashBalance)} .`\n          : `${mark}    ${Number(effectiveAmount)}       ${srcPhone}    ${commissionPart}${feePart}.    : ${remainingWalletBalance} .   : ${Number(newCashBalance)} .`;\n        const key = user?.uid ? `tg_last_msg_${user.uid}` : 'tg_last_msg';\n        const now = Date.now();\n        let shouldSend = true;\n        try {\n          const raw = localStorage.getItem(key);\n          if (raw) {\n            const prev = JSON.parse(raw);\n            const prevMsg = String(prev?.text || '');\n            const prevAt = Number(prev?.at || 0);\n            if (prevMsg === msg && now - prevAt < 5000) shouldSend = false;\n          }\n        } catch {}\n        if (shouldSend) {\n          Promise.resolve(telegramNotifier.send(user.uid, msg)).catch(() => {});\n          try { localStorage.setItem(key, JSON.stringify({ text: msg, at: now })); } catch {}\n        }\n      }\n    } catch {}\n\n    //     - \n    // toast({\n    //   title: transactionType === 'transfer' ? \"  \" : \"  \",\n    //   description: \"       ...\",\n    // });\n\n    //      Firebase  \n    (async () => {\n      try {\n        console.log('     Firebase  ...');\n\n        //       \n        const transactionDataCreate = { ...transactionDataCreateOptimistic };\n        \n        //          \n        \n        const transactionDataForUser = {\n            ...optimisticTransaction,\n            //    ID \n        };\n\n        //        \n        const { ProfitService } = await import('@/utils/profitService');\n        const profit = ProfitService.calculateProfitFromTransaction({ ...transactionDataForUser, status: 'confirmed' });\n        if (profit > 0) {\n          ProfitService.addProfit(profit, user?.uid);\n          (transactionDataCreate as any).profitAddedOnCreation = true;\n          (transactionDataForUser as any).profitAddedOnCreation = true;\n          console.log('   :', profit, '');\n        }\n\n        //           \n        const createdTransactionId = await transactionService.create(transactionDataCreate);\n\n        if (selectedWallet) {\n          try {\n            //      \n            const updatedLimits = await walletDailyLimitsService.updateUsage(selectedWallet, effectiveAmount, transactionType === 'transfer' ? 'transfer' : 'withdraw');\n            \n            //        \n            if (updatedLimits) {\n              setSelectedWalletLimits(updatedLimits);\n            }\n\n            try { window.dispatchEvent(new CustomEvent('walletLimitsUpdated', { detail: { walletId: selectedWallet } })); } catch { }\n          } catch (e) { }\n        }\n\n        await Promise.all([\n          ...(user?.uid ? [userDataService.updateUserData(user.uid, {\n            cashBalance: newCashBalance,\n            walletBalances: newWalletBalances,\n            lastUpdated: new Date().toISOString()\n          })] : []),\n          ...(user?.uid ? [userDataService.saveUserTransaction(user.uid, {\n            ...transactionDataForUser,\n            transactionId: createdTransactionId, //   \n            transactionType,\n            fromWallet: selectedWallet,\n            toWallet: transactionType === 'transfer' ? (isDeferredTransfer ? null : 'cash') : null,\n            cashierName: isShiftActive ? (shiftUser?.name || shiftUser?.username || ' ') : ' ',\n            linkedDebtId: linkedDebtId || undefined,\n            description: `${transactionType === 'transfer' ? '' : ''} ${effectiveAmount}  ${selectedWallet} ${transactionType === 'transfer' ? (isDeferredTransfer ? '' : '  ') : ''}  : ${commissionAmount} (${transactionType === 'transfer' ? '' : (isCommissionAddMode ? '' : '')})${extraFee > 0 ? `  : ${extraFee}` : ''}${skipProcess ? '    ( )' : ''}`\n          })] : [])\n        ]);\n\n\n\n        console.log('      Firebase ');\n        \n        //        \n        try {\n          //       \n          const realTransaction = { ...optimisticTransaction, id: createdTransactionId };\n          \n          //   \n          localTransactionsBuffer.current = localTransactionsBuffer.current.map(t => \n             t.id === tempTransactionId ? realTransaction : t\n          );\n          \n          queryClientHook.setQueryData(\n            ['recentTransactions', user?.uid, (shopIdCtx || 'main')],\n            (oldData: any) => {\n               if (!oldData || !Array.isArray(oldData)) return [realTransaction];\n               //         \n               return oldData.map((t: any) => t.id === tempTransactionId ? realTransaction : t);\n            }\n          );\n          \n          //      \n          React.startTransition(() => {\n             setTransactions(prev => prev.map(t => (t as any).id === tempTransactionId ? realTransaction : t));\n          });\n          \n        } catch (e) { console.error('Error updating query cache with real ID:', e); }\n\n        //            \n        setTimeout(() => {\n           try { \n             console.log('    (10 )   ...');\n             \n             // 1.   \n             queryClientHook.invalidateQueries({ queryKey: ['recentTransactions', user?.uid, (shopIdCtx || 'main')] });\n             \n             // 2.     (  +  )\n             queryClientHook.invalidateQueries({ queryKey: ['dashboardData', shopIdCtx || profile?.shopId] });\n             \n             // 3.    \n             if (selectedWallet) {\n                queryClientHook.invalidateQueries({ queryKey: ['walletLimits', selectedWallet] });\n                //           \n                refreshSelectedWalletLimits();\n             }\n           } catch (e) { console.error('Error in delayed refresh:', e); }\n        }, 10000);\n\n        //       \n        const localDataKey = `userData_${user?.uid}`;\n        const localData = {\n          cashBalance: newCashBalance,\n          walletBalances: newWalletBalances,\n          lastUpdated: new Date().toISOString()\n        };\n        localStorage.setItem(localDataKey, JSON.stringify(localData));\n\n      } catch (error) {\n        console.error('      Firebase ( ):', error);\n\n        //      Firebase    \n        //     \n        try {\n          if (user?.uid) {\n            userDataService.saveLocalReceipt(user.uid, {\n              ...transactionDataForUser,\n              transactionType,\n              fromWallet: selectedWallet,\n              toWallet: transactionType === 'transfer' ? (isDeferredTransfer ? null : 'cash') : null,\n              cashierName: isShiftActive ? (shiftUser?.name || shiftUser?.username || ' ') : ' ',\n              linkedDebtId: linkedDebtId || undefined,\n              description: `${transactionType === 'transfer' ? '' : ''} ${effectiveAmount}  ${selectedWallet} ${transactionType === 'transfer' ? (isDeferredTransfer ? '' : '  ') : ''}  : ${commissionAmount} (${transactionType === 'transfer' ? '' : (isCommissionAddMode ? '' : '')})${extraFee > 0 ? `  : ${extraFee}` : ''}${skipProcess ? '    ( )' : ''}`\n            });\n          }\n        } catch { }\n        toast({ title: \"\", description: \"        .     .\", variant: \"destructive\" });\n      }\n    })();\n\n    //       +    \n    if (transactionType === 'transfer') {\n      setIsTransferSuccess(true);\n      //        ( )\n      const amountToReceive = Number(amountNum) + Number(commissionAmount) + Math.max(0, Number(extraFee));\n      setPostConfirmInfo({ type: 'transfer', amount: Math.max(0, Math.round(amountToReceive * 100) / 100) });\n      //      USSD \n      setLastUSSDTransfer({ receiver: receiverPhone, amount: amountNum });\n      //        \n      setSelectedSimSlotForTransfer(null);\n      setIsPostConfirmPopupOpen(true);\n      //      \n      setTimeout(() => {\n        setIsTransferSuccess(false);\n      }, 2000);\n    } else {\n      setIsWithdrawSuccess(true);\n      //      \n      const amountToDeliver = isCommissionAddMode\n        ? Number(amountNum)\n        : Math.max(0, Math.round((Number(amountNum) - Number(commissionAmount)) * 100) / 100);\n      setPostConfirmInfo({ type: 'withdraw', amount: Math.max(0, Math.round(amountToDeliver * 100) / 100) });\n      setIsPostConfirmPopupOpen(true);\n      //      \n      setTimeout(() => {\n        setIsWithdrawSuccess(false);\n      }, 2000);\n    }\n\n    // Clear form\n    setReceiverPhone('');\n    setAmount('');\n    setWithdrawNote('');\n    setWithdrawSenderName('');\n    setQuickDebtInfo(null);\n    setQuickDebtName('');\n    setQuickDebtAmount('');\n    setQuickDebtNotes('');\n    setDidCreateQuickDebt(false);\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'completed':\n        return <CheckCircle className=\"h-2.5 w-2.5 text-green-500\" />;\n      case 'pending':\n        return <Clock className=\"h-2.5 w-2.5 text-yellow-500\" />;\n      case 'failed':\n        return <XCircle className=\"h-2.5 w-2.5 text-red-500\" />;\n      default:\n        return <Clock className=\"h-2.5 w-2.5 text-gray-500\" />;\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case 'completed':\n        return '';\n      case 'pending':\n        return ' ';\n      case 'failed':\n        return '';\n      default:\n        return ' ';\n    }\n  };\n\n  const dateFormatter = React.useMemo(() => new Intl.DateTimeFormat('ar-EG'), []);\n  const timeFormatter = React.useMemo(() => new Intl.DateTimeFormat('ar-EG', { hour: '2-digit', minute: '2-digit' }), []);\n  const totalOutstandingDebts = React.useMemo(() => {\n    try {\n      return debts.reduce((sum, d) => {\n        // 'debtor' type means I owe them (Payable), so exclude from \"Outstanding Debts\" (Receivable)\n        if (d.type === 'debtor') return sum;\n        const paid = Number(d.paidAmount || 0);\n        const outstanding = Math.max(0, Number(d.amount || 0) - paid);\n        return sum + outstanding;\n      }, 0);\n    } catch {\n      return 0;\n    }\n  }, [debts]);\n  const filteredTransactions = React.useMemo(() => {\n    const base = getFilteredTransactions();\n    return base.filter(transaction => {\n      if (activeTab === 'all') return true;\n      if (activeTab === 'send') return transaction.type === 'send';\n      if (activeTab === 'receive') return transaction.type === 'receive';\n      if (activeTab === 'withdraw') return transaction.type === 'withdraw';\n      if (activeTab === 'deleted') return false; //    \n      return true;\n    });\n  }, [getFilteredTransactions, activeTab]);\n\n  //    \n  const restoreTransaction = (transactionId: string) => {\n    const transactionToRestore = deletedTransactions.find(t => t.id === transactionId);\n\n    if (transactionToRestore) {\n      //     \n      const updatedTransactions = [transactionToRestore, ...transactions];\n      setTransactions(updatedTransactions);\n\n      //     \n      const updatedDeletedTransactions = deletedTransactions.filter(t => t.id !== transactionId);\n      setDeletedTransactions(updatedDeletedTransactions);\n      localStorage.setItem(getDeletedTransactionsKey(), JSON.stringify(updatedDeletedTransactions));\n\n      toast({\n        title: \"  \",\n        description: \"      \",\n      });\n    }\n  };\n\n  //    \n  const permanentlyDeleteTransaction = async (transactionId: string) => {\n    //     \n    if (!user?.uid) {\n      toast({\n        title: \"  \",\n        description: \"     \",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      //      \n      const updatedDeletedTransactions = deletedTransactions.filter(t => t.id !== transactionId);\n      setDeletedTransactions(updatedDeletedTransactions);\n      localStorage.setItem(getDeletedTransactionsKey(), JSON.stringify(updatedDeletedTransactions));\n\n      //    Firebase (deletedTransactions + userTransactions + transactions)\n      await auditLogService.permanentlyDeleteTransaction(transactionId, user.uid);\n      await userDataService.removeUserTransaction(user.uid, transactionId);\n\n      toast({\n        title: \"   \",\n        description: \"      \",\n      });\n    } catch (error) {\n      console.error('   :', error);\n      toast({\n        title: \"   \",\n        description: \"     .    \",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  //  \n  const handleResetDaily = () => {\n    setResetType('daily');\n    setIsResetDialogOpen(true);\n  };\n\n  const handleResetMonthly = () => {\n    setResetType('monthly');\n    setIsResetDialogOpen(true);\n  };\n\n  const handleResetSuccess = () => {\n    if (resetType === 'daily') {\n      //    \n      const hiddenIds = reportsService.resetReportsManually('daily', transactions, user?.uid);\n\n      //   \n      setIsResetDialogOpen(false);\n\n      //    \n      toast({\n        title: \"   \",\n        description: `  ${hiddenIds.length}     (  )`,\n      });\n    } else {\n      //    \n      const hiddenIds = reportsService.resetReportsManually('monthly', transactions, user?.uid);\n\n      //   \n      setIsResetDialogOpen(false);\n\n      //    \n      toast({\n        title: \"   \",\n        description: `  ${hiddenIds.length}     (  )`,\n      });\n    }\n  };\n\n  const getResetDialogTitle = () => {\n    return resetType === 'daily' ? '  ' : '  ';\n  };\n\n  const getResetDialogDescription = () => {\n    return resetType === 'daily'\n      ? '       '\n      : '       ';\n  };\n\n  //   \n  const handleEditCashBalance = () => {\n    setIsEditCashDialogOpen(true);\n  };\n\n  const handleEditWalletBalance = (walletId: string) => {\n    setEditingWalletId(walletId);\n    setIsAddToWalletDialogOpen(true);\n  };\n\n  const handleEditCashSuccess = (newBalance: number) => {\n    const previousBalance = cashBalance;\n    const delta = Number(newBalance) - Number(previousBalance);\n    setCashBalance(newBalance);\n    const timestamp = new Date().toISOString();\n    localStorage.setItem(getCashBalanceKey(), newBalance.toString());\n    localStorage.setItem(getCashBalanceKey() + '_lastUpdated', timestamp);\n    setIsEditCashDialogOpen(false);\n\n    const updateData = { cashBalance: newBalance, lastUpdated: timestamp };\n    const localDataKey = `userData_${user?.uid}`;\n    try { localStorage.setItem(localDataKey, JSON.stringify(updateData)); } catch { }\n\n    const ops: Array<Promise<any>> = [];\n    if (user?.uid) {\n      ops.push(userDataService.updateUserData(user.uid, updateData).then(() => { try { localStorage.removeItem(localDataKey); } catch { }; }).catch(() => { }));\n      const receiptRef = `${delta > 0 ? 'CASHADD' : 'CASHDEDUCT'}-${user?.uid || 'anon'}-${Date.now()}`;\n      const txToCloud: any = delta > 0\n        ? { txnType: 'cash_addition', type: 'cash_addition', amount: delta, status: 'confirmed', senderMsisdn: ' ', receiverMsisdn: '', reference: receiptRef, title: '  ', merchantUserId: user.uid, createdBy: user.uid, shopId: (profile as any)?.shopId || undefined }\n        : (delta < 0\n          ? { amount: Math.abs(delta), status: 'completed', title: '    ', merchantUserId: user.uid, createdBy: user.uid, shopId: (profile as any)?.shopId || undefined }\n          : null);\n      if (txToCloud) { ops.push(userDataService.saveUserTransaction(user.uid, txToCloud)); }\n      const shopId = (profile as any)?.shopId;\n      if (shopId) {\n        const dataRef = doc(db, 'dashboardData', shopId);\n        ops.push(updateDoc(dataRef, { cashBalance: newBalance }));\n      }\n    }\n    Promise.allSettled(ops).then(() => { }).catch(() => { });\n\n    toast({\n      title: delta > 0 ? '  ' : (delta < 0 ? '  ' : '   '),\n      description: delta !== 0 ? `: ${Math.abs(delta)}   : ${newBalance} ` : `     ${newBalance} `,\n    });\n  };\n\n  //        \n  const handleEditWalletBalanceSuccess = async (newBalance: number) => {\n    if (!editingWalletId) {\n      console.warn('      ');\n      return;\n    }\n\n    const updatedBalances = {\n      ...walletBalances,\n      [editingWalletId]: newBalance,\n    };\n\n    //   \n    setWalletBalances(updatedBalances);\n\n    //     \n    const timestamp = new Date().toISOString();\n    const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp };\n    const localDataKey = `userData_${user?.uid}`;\n    try {\n      localStorage.setItem(localDataKey, JSON.stringify(updateData));\n      localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n      localStorage.setItem(getWalletBalancesKey() + '_lastUpdated', timestamp);\n      localStorage.setItem(`walletBalances_backup_${timestamp}`, JSON.stringify(updatedBalances));\n    } catch { }\n\n    try {\n      if (user?.uid) {\n        await userDataService.updateUserData(user.uid, updateData);\n      }\n    } catch (e) {\n      console.error('      Firebase:', e);\n    }\n\n    setIsEditWalletDialogOpen(false);\n    const walletName = wallets.find(w => w.id === editingWalletId)?.name || '';\n    toast({\n      title: '   ',\n      description: `   ${walletName}  ${newBalance.toLocaleString()} `,\n    });\n  };\n\n  const handleAddToWalletSuccess = async (addedAmount: number) => {\n    console.log('    ');\n    console.log('   :', editingWalletId);\n    console.log('  /:', addedAmount);\n\n    if (editingWalletId) {\n      const currentBalance = walletBalances[editingWalletId] || 0;\n      console.log('  :', currentBalance);\n\n      const newBalance = currentBalance + addedAmount;\n      console.log('  :', newBalance);\n\n      const updatedBalances = {\n        ...walletBalances,\n        [editingWalletId]: newBalance\n      };\n\n      console.log('  :', updatedBalances);\n\n      //    \n      setWalletBalances(updatedBalances);\n\n      //        \n      const timestamp = new Date().toISOString();\n      const updateData = {\n        walletBalances: updatedBalances,\n        lastUpdated: timestamp\n      };\n\n      //  :   localStorage   \n      const localDataKey = `userData_${user?.uid}`;\n      localStorage.setItem(localDataKey, JSON.stringify(updateData));\n\n      //  :    \n      localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n\n      //  :    \n      localStorage.setItem(`walletBalances_backup_${timestamp}`, JSON.stringify(updatedBalances));\n\n      try {\n\n        //    Firebase\n        if (user?.uid) {\n          console.log('    Firebase...');\n          try {\n            await userDataService.updateUserData(user.uid, updateData);\n            console.log('     Firebase ');\n\n            //          \n            setTimeout(() => {\n              localStorage.removeItem(localDataKey);\n              console.log('        ');\n            }, 60000); //    \n\n          } catch (error) {\n            console.error('      Firebase:', error);\n            //       Firebase\n            setHasLocalDataToSync(true);\n          }\n        } else {\n          //         localStorage  \n          console.log('       localStorage');\n          localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n        }\n\n        const walletName = wallets.find(w => w.id === editingWalletId)?.name || '';\n        const operationType = addedAmount > 0 ? '' : '';\n        const operationAmount = Math.abs(addedAmount);\n\n        toast({\n          title: ` ${operationType}  ${operationType === '' ? '' : ''}  `,\n          description: ` ${operationType} ${operationAmount}  ${operationType === '' ? '' : ''}  ${walletName}.  : ${newBalance.toLocaleString()} `,\n        });\n      } catch (error) {\n        console.error('      Firebase:', error);\n\n        //     Firebase   localStorage  \n        localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n\n        //    \n        if (user?.uid) {\n          const localDataKey = `userData_${user.uid}`;\n          const localData = {\n            walletBalances: updatedBalances,\n            lastUpdated: new Date().toISOString()\n          };\n          localStorage.setItem(localDataKey, JSON.stringify(localData));\n          setHasLocalDataToSync(true);\n        }\n\n        toast({\n          title: \"   \",\n          description: \"        \",\n          variant: \"default\",\n        });\n      }\n    } else {\n      console.log('     ');\n    }\n\n    //     (  5  )\n    setTimeout(() => {\n      const allKeys = Object.keys(localStorage);\n      const backupKeys = allKeys.filter(key => key.startsWith('walletBalances_backup_')).sort();\n\n      if (backupKeys.length > 5) {\n        const keysToDelete = backupKeys.slice(0, backupKeys.length - 5);\n        keysToDelete.forEach(key => {\n          localStorage.removeItem(key);\n          console.log('    :', key);\n        });\n      }\n    }, 5000); //   5 \n\n    setIsAddToWalletDialogOpen(false);\n    setEditingWalletId('');\n  };\n\n  console.log(' UserDashboardPage - Render conditions:', {\n    isCheckingActivation,\n    isUserActive,\n    showActivationModal\n  });\n\n  //   :        (  )\n\n  //           \n  if (isCheckingActivation) {\n    console.log(' UserDashboardPage - Showing loading screen');\n    return <LogoLoader />;\n  }\n\n  console.log(' UserDashboardPage - Rendering main dashboard');\n\n  return (\n    <div id=\"dashboard-content-container\" className=\"user-dashboard h-[100dvh] overflow-y-auto px-2 sm:px-4 pt-2 sm:py-4 relative bg-gray-100 bg-[radial-gradient(140%_140%_at_10%_10%,#e5e7eb_0%,#d1d5db_45%,#9ca3af_100%)] no-scrollbar\">\n      <GoogleBackupBar userId={user?.uid} />\n      {/*       */}\n      {/*               */}\n\n      <div className=\"max-w-screen-2xl mx-auto grid grid-cols-1 xl:grid-cols-3 gap-4 xl:gap-6 relative z-10\">\n        {/* Statistics and Transactions */}\n        <div className=\"lg:col-span-2 space-y-2 sm:space-y-3\">\n\n          {/* Detailed Reports Section */}\n          <div className=\"grid grid-cols-2 gap-2 sm:grid-cols-2 sm:gap-3 fade-in-up\">\n            {/*           */}\n            {/*   */}\n            {!areReportsCollapsed && (\n              <Card className=\"bg-gray-100 border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 relative overflow-hidden\">\n                <CardHeader className=\"pb-2 px-3 pt-3 relative z-10\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-xs font-bold text-gray-900 flex items-center gap-1.5\">\n                      <div className=\"p-1 rounded-md bg-gradient-to-br from-gray-100 to-gray-200\">\n                        <CalendarDays className=\"h-3.5 w-3.5 text-gray-700\" />\n                      </div>\n                      <span className=\"text-xs\"></span>\n                    </CardTitle>\n                    <div className=\"flex items-center gap-1\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => {\n                          setResetType('monthly');\n                          setIsResetDialogOpen(true);\n                        }}\n                        className=\"h-7 w-7 p-0 bg-transparent hover:bg-red-50 text-red-600 hover:text-red-700 rounded-full transition-colors duration-200\"\n                        title=\"  \"\n                      >\n                        <Trash2 className=\"h-3 w-3\" />\n                      </Button>\n                      <div className=\"p-1 bg-green-50 rounded-full border border-green-100\">\n                        <ArrowUpDown className=\"h-3 w-3 text-green-600\" />\n                      </div>\n                    </div>\n                  </div>\n                </CardHeader>\n                {!areReportsCollapsed && (\n                  <CardContent className=\"pt-0 px-2 pb-2\">\n                    <div className=\"grid grid-cols-2 gap-0 rounded-lg overflow-hidden border border-gray-200 divide-x divide-y divide-gray-200 bg-white\">\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-blue-600\"> </span>\n                        <span className=\"text-sm sm:text-lg font-bold text-blue-800 mt-0.5 sm:mt-0\">{currentMonthlyStats.totalTransactions}</span>\n                      </div>\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-gray-600\"> </span>\n                        <span className=\"text-sm sm:text-lg font-bold text-gray-900 mt-0.5 sm:mt-0\">{currentMonthlyStats.totalAmount.toFixed(2)}</span>\n                      </div>\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-red-600\"></span>\n                        <span className=\"text-sm sm:text-lg font-bold text-red-800 mt-0.5 sm:mt-0\">{currentMonthlyStats.totalWithdrawn.toFixed(2)}</span>\n                      </div>\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-green-600\"></span>\n                        <span className=\"text-sm sm:text-lg font-bold text-green-800 mt-0.5 sm:mt-0\">{currentMonthlyStats.totalSent.toFixed(2)}</span>\n                      </div>\n                    </div>\n                    <div className=\"mt-2 rounded-lg border border-gray-100 bg-white px-2 py-1.5 flex items-center justify-between\">\n                      <span className=\"text-[12px] font-bold text-yellow-600\"></span>\n                      <MonthlyProfitEyeButton userId={user?.uid} transactions={transactions} />\n                    </div>\n                  </CardContent>\n                )}\n                {isMonthlyLocked && (\n                  <div className=\"absolute inset-0 z-20 backdrop-blur-sm bg-amber-50/60 flex items-center justify-center p-0 pointer-events-auto\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={async () => {\n                        if (isZeroPlan) {\n                          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n                          return;\n                        }\n                        setIsMonthlyPinDialogOpen(true);\n                      }}\n                      className=\"px-4 py-2 rounded-full bg-white border border-gray-100 text-gray-900 shadow-sm hover:bg-gray-50 hover:shadow-md transition-all duration-200 flex items-center gap-2 text-xs font-medium\"\n                      title=\"   (  )\"\n                    >\n                      <span>  </span>\n                      <Eye className=\"h-3.5 w-3.5 text-gray-600\" />\n                    </Button>\n                  </div>\n                )}\n              </Card>\n            )}\n\n            {/*       */}\n            <MasterPinDialog\n              open={isMonthlyPinDialogOpen}\n              onOpenChange={setIsMonthlyPinDialogOpen}\n              mode=\"verify\"\n              title=\"    \"\n              description=\"          \"\n              onSuccess={() => {\n                if (isZeroPlan) {\n                  toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n                  setIsMonthlyPinDialogOpen(false);\n                  setIsMonthlyLocked(true);\n                  return;\n                }\n                setIsMonthlyLocked(false);\n                setIsMonthlyPinDialogOpen(false);\n              }}\n              userId={user?.uid}\n            />\n\n            {/*   */}\n            {userSubscription?.planType !== SubscriptionPlan.TAHWEELA && (\n              <Card className=\"bg-gray-50 border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 relative overflow-hidden\">\n                <CardHeader className=\"pb-2 px-3 pt-3 relative z-10\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-sm font-bold text-gray-900 flex items-center gap-2\">\n                      <div className=\"p-1 rounded-md bg-gradient-to-br from-gray-100 to-gray-200\">\n                        <CalendarDays className=\"h-4 w-4 text-gray-700\" />\n                      </div>\n                      <span className=\"text-sm\"></span>\n                    </CardTitle>\n                    <div className=\"flex items-center gap-1.5\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => {\n                          setResetType('daily');\n                          setIsResetDialogOpen(true);\n                        }}\n                        className=\"h-8 w-8 p-0 bg-transparent hover:bg-red-50 text-red-600 hover:text-red-700 rounded-full transition-colors duration-200\"\n                        title=\"  \"\n                      >\n                        <Trash2 className=\"h-3.5 w-3.5\" />\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => setAreReportsCollapsed(prev => !prev)}\n                        className=\"h-8 w-8 p-0 bg-transparent hover:bg-gray-100 text-gray-600 hover:text-blue-600 rounded-full transition-colors duration-200\"\n                        title={areReportsCollapsed ? '  ' : '  '}\n                      >\n                        {areReportsCollapsed ? (\n                          <ChevronDown className=\"h-3.5 w-3.5\" />\n                        ) : (\n                          <ChevronUp className=\"h-3.5 w-3.5\" />\n                        )}\n                      </Button>\n                      <div className=\"p-2 bg-green-50 rounded-full border border-green-100\">\n                        <ArrowUpDown className=\"h-3.5 w-3.5 text-green-600\" />\n                      </div>\n                    </div>\n                  </div>\n                </CardHeader>\n                {!areReportsCollapsed && (\n                  <CardContent className=\"pt-0 px-2 pb-2\">\n                    <div className=\"grid grid-cols-2 gap-0 rounded-lg overflow-hidden border border-gray-200 divide-x divide-y divide-gray-200 bg-white\">\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-blue-600\"> </span>\n                        <span className=\"text-sm sm:text-lg font-bold text-blue-800 mt-0.5 sm:mt-0\">{currentDailyStats.totalTransactions}</span>\n                      </div>\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-gray-600\"> </span>\n                        <span className=\"text-sm sm:text-lg font-bold text-gray-900 mt-0.5 sm:mt-0\">{currentDailyStats.totalAmount.toFixed(2)}</span>\n                      </div>\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-red-600\"></span>\n                        <span className=\"text-sm sm:text-lg font-bold text-red-800 mt-0.5 sm:mt-0\">{currentDailyStats.totalWithdrawn.toFixed(2)}</span>\n                      </div>\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-green-600\"></span>\n                        <span className=\"text-sm sm:text-lg font-bold text-green-800 mt-0.5 sm:mt-0\">{currentDailyStats.totalSent.toFixed(2)}</span>\n                      </div>\n                    </div>\n                    <div className=\"mt-2 rounded-lg border border-gray-100 bg-white px-2 py-1.5 flex items-center justify-between\">\n                      <span className=\"text-[12px] font-bold text-yellow-600\"></span>\n                      <DailyProfitEyeButton userId={user?.uid} transactions={transactions} />\n                    </div>\n                  </CardContent>\n                )}\n                {isDailyLocked && (\n                  <div className=\"absolute inset-0 z-20 backdrop-blur-sm bg-white/60 flex items-center justify-center p-0 pointer-events-auto\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={() => setIsDailyPinDialogOpen(true)}\n                      className=\"px-4 py-2 rounded-full bg-white border border-gray-100 text-gray-900 shadow-sm hover:bg-gray-50 hover:shadow-md transition-all duration-200 flex items-center gap-2 text-xs font-medium\"\n                      title=\"   (  )\"\n                    >\n                      <span>  </span>\n                      <Eye className=\"h-3.5 w-3.5 text-gray-600\" />\n                    </Button>\n                  </div>\n                )}\n              </Card>\n            )}\n            {/*           */}\n            {/*       */}\n            <MasterPinDialog\n              open={isDailyPinDialogOpen}\n              onOpenChange={setIsDailyPinDialogOpen}\n              mode=\"verify\"\n              title=\"    \"\n              description=\"          \"\n              onSuccess={() => {\n                setIsDailyLocked(false);\n                setIsDailyPinDialogOpen(false);\n              }}\n              userId={user?.uid}\n            />\n          </div>\n\n          {/* Balance Bar */}\n          <Card className=\"balance-bar bg-gray-200 border-2 border-gray-200/50 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 group relative overflow-hidden   transform fade-in-up mb-6\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-emerald-500/5 via-blue-500/5 to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"></div>\n            <div className=\"absolute top-0 left-0 w-40 h-40 bg-gradient-to-br from-emerald-300/10 to-transparent rounded-full -translate-y-20 -translate-x-20 group-hover:scale-150 transition-transform duration-200\"></div>\n            <div className=\"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-blue-300/10 to-transparent rounded-full translate-y-20 translate-x-20 group-hover:scale-150 transition-transform duration-200\"></div>\n            <CardContent className=\"p-2 relative z-10\">\n              <div className=\"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-2\">\n                <div className=\"bg-white border border-gray-200 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/cash relative overflow-hidden\">\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-emerald-500/10 to-transparent opacity-0 group-hover/cash:opacity-100 transition-opacity duration-300\"></div>\n                  <div className=\"flex flex-col relative z-10 w-full\">\n                    <div className=\"flex items-center justify-between w-full\">\n                      <div className=\"flex items-center gap-0.5\">\n                        <div className=\"p-0.5 bg-gradient-to-r from-emerald-100 to-emerald-200 rounded-lg shadow-sm\">\n                          <DollarSign className=\"h-1.5 w-1.5 text-emerald-600\" />\n                        </div>\n                        <span className=\"text-[11px] font-extrabold text-emerald-800\"> </span>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-green-600 hover:bg-green-50 transition-colors\"\n                          onClick={() => setIsAddCashDialogOpen(true)}\n                        >\n                          <Plus className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-emerald-600 hover:bg-emerald-50 transition-colors\"\n                          onClick={() => setIsCashSummaryOpen(true)}\n                          title=\"  \"\n                        >\n                          <Banknote className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-red-600 hover:bg-red-50 transition-colors\"\n                          onClick={() => setIsResetCashDialogOpen(true)}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                    <div className=\"mt-0.5\">\n                      <span className=\"text-[14px] sm:text-xl font-bold text-emerald-800 bg-gradient-to-r from-emerald-100 to-emerald-200 px-1 py-0.5 rounded-lg shadow-sm block w-fit\">\n                        {cashBalance.toLocaleString('en-US')} \n                      </span>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"bg-white border border-gray-200 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/wallet relative overflow-hidden\">\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/10 to-transparent opacity-0 group-hover/wallet:opacity-100 transition-opacity duration-300\"></div>\n                  <div className=\"flex flex-col relative z-10 w-full\">\n                    <div className=\"flex items-center justify-between w-full\">\n                      <div className=\"flex items-center gap-0.5\">\n                        <div className=\"p-0.5 bg-gradient-to-r from-blue-100 to-blue-200 rounded-lg shadow-sm\">\n                          <Wallet className=\"h-1.5 w-1.5 text-blue-600\" />\n                        </div>\n                        <span className=\"text-[11px] font-extrabold text-blue-800\">  </span>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-green-600 hover:bg-green-50 transition-colors\"\n                          onClick={() => setIsAddWalletTotalDialogOpen(true)}\n                          title=\"   \"\n                        >\n                          <Plus className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-blue-600 hover:bg-blue-50 transition-colors\"\n                          onClick={() => setIsWalletsListOpen(true)}\n                          title=\" \"\n                        >\n                          <Wallet className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-red-600 hover:bg-red-50 transition-colors\"\n                          onClick={() => {\n                            setIsResetWalletTotalDialogOpen(true);\n                            setResetWalletTotalPinInput('');\n                          }}\n                          title=\"  \"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                    <div className=\"mt-0.5\">\n                      <span className=\"text-[14px] sm:text-xl font-bold text-blue-800 bg-gradient-to-r from-blue-100 to-blue-200 px-1 py-0.5 rounded-lg shadow-sm block w-fit\">\n                        {Object.values(walletBalances).reduce((sum, balance) => sum + balance, 0).toLocaleString('en-US')} \n                      </span>\n                    </div>\n                  </div>\n                </div>\n                {/*     */}\n                <div className=\"col-span-2 sm:col-span-1 bg-white border border-gray-200 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/selwallet relative overflow-hidden\">\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-transparent opacity-0 group-hover/selwallet:opacity-100 transition-opacity duration-300\"></div>\n                  <div className=\"flex flex-col relative z-10 w-full\">\n                    <div className=\"flex items-center justify-between w-full\">\n                      <div className=\"flex items-center gap-0.5\">\n                        <div className=\"p-0.5 bg-gradient-to-r from-indigo-100 to-indigo-200 rounded-lg shadow-sm\">\n                          <Wallet className=\"h-1.5 w-1.5 text-indigo-600\" />\n                        </div>\n                        <span className=\"text-[11px] font-extrabold text-indigo-800\"> </span>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-green-600 hover:bg-green-50 transition-colors\"\n                          onClick={() => {\n                            if (!selectedWallet) {\n                              toast({\n                                title: ' ',\n                                description: '       ',\n                                variant: 'destructive',\n                              });\n                              return;\n                            }\n                            handleEditWalletBalance(selectedWallet);\n                          }}\n                          title=\"/    \"\n                        >\n                          <Plus className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-red-600 hover:bg-red-50 transition-colors\"\n                          onClick={() => {\n                            if (!selectedWallet) {\n                              toast({\n                                title: ' ',\n                                description: '     ',\n                                variant: 'destructive',\n                              });\n                              return;\n                            }\n                            //        \n                            setIsResetSelectedWalletDialogOpen(true);\n                          }}\n                          title=\"   \"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                    <div className=\"mt-0.5\">\n                      <span className=\"text-[14px] sm:text-xl font-bold text-indigo-800 bg-gradient-to-r from-indigo-100 to-indigo-200 px-1 py-0.5 rounded-lg shadow-sm block w-fit\">\n                        {(selectedWallet ? (walletBalances[selectedWallet] || 0) : 0).toLocaleString('en-US')} \n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Recent Transactions Section */}\n          <Card className=\"bg-gray-100 border border-gray-200 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 group relative overflow-hidden fade-in-up\">\n            <CardHeader className={`pb-2 px-4 pt-4 relative z-10 ${isMobile ? 'sticky top-0 z-20 bg-white/90 backdrop-blur supports-[backdrop-filter]:bg-white/60' : ''}`}>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-sm font-bold flex items-center gap-2 text-gray-900\">\n                  {!isMobile && (\n                    <div className=\"p-1.5 sm:p-2 bg-gray-100 rounded-lg\">\n                      <ArrowUpDown className=\"h-3 w-3 sm:h-3.5 sm:w-3.5 text-gray-700\" />\n                    </div>\n                  )}\n                  <span className=\"text-gray-900\">\n                     \n                  </span>\n                </CardTitle>\n                {/*       */}\n                <div className=\"flex items-center gap-2\">\n                  {/*    */}\n                  {!isMobile && (\n                    <div className=\"flex items-center gap-0.5 bg-gray-100 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]\">\n                      <Search className=\"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors\" />\n                      <Input\n                        placeholder=\"...\"\n                        value={searchPhone}\n                        onChange={(e) => setSearchPhone(e.target.value)}\n                        className=\"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400\"\n                      />\n                    </div>\n                  )}\n                  {/*     (    ) */}\n                  {!isMobile && (\n                    <div className=\"flex items-center gap-2\">\n                      {/*  -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({ title: ' ', description: '      .', variant: 'destructive' });\n                              return;\n                            }\n                            setIsInstallmentPinOpen(true);\n                          }}\n                          title=\" \"\n                        >\n                          <BadgePercent className=\"h-5 w-5 text-purple-600\" />\n                        </Button>\n                      </div>\n                      {/*   -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-green-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-green-100 text-green-600 hover:bg-green-200 border border-green-200 ring-3 ring-green-300 transition-all duration-200 hover:scale-105 active:bg-green-600 active:text-white active:border-green-600\"\n                          onClick={() => {\n                            toast({ title: ' ', description: '    .' });\n                          }}\n                          title=\" \"\n                        >\n                          <CreditCard className=\"h-5 w-5 text-green-600\" />\n                        </Button>\n                      </div>\n                      {/*   -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\n                          onClick={() => setIsCalculatorOpen(true)}\n                          title=\" \"\n                        >\n                          <Calculator className=\"h-5 w-5 text-purple-600\" />\n                        </Button>\n                      </div>\n                      {/*   -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({\n                                title: ' ',\n                                description: '      .',\n                                variant: 'destructive'\n                              });\n                            } else {\n                              setIsCreditCardsOpen(true);\n                            }\n                          }}\n                          title=\" \"\n                        >\n                          <CreditCard className=\"h-5 w-5 text-purple-600\" />\n                        </Button>\n                      </div>\n                      {/*  -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-blue-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({ title: ' ', description: '      .', variant: 'destructive' });\n                              return;\n                            }\n                            setIsReportsPinOpen(true);\n                          }}\n                          title=\"\"\n                        >\n                          <Notebook className=\"h-5 w-5 text-blue-600\" />\n                        </Button>\n                      </div>\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-sky-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-sky-100 text-sky-600 hover:bg-sky-200 border border-sky-200 ring-3 ring-sky-300 transition-all duration-200 hover:scale-105 active:bg-sky-600 active:text-white active:border-sky-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({ title: ' ', description: '      .', variant: 'destructive' });\n                            } else {\n                              if (MasterPinService.hasMasterPin()) {\n                                setIsTelegramReportPinOpen(true);\n                              } else {\n                                handleSendTelegramDailyReport();\n                              }\n                            }\n                          }}\n                          title=\"    \"\n                        >\n                          <Send className=\"h-5 w-5 text-sky-600\" />\n                        </Button>\n                      </div>\n                      {/*   /   -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-blue-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600\"\n                          onClick={handleOpenShiftProfile}\n                          title={isShiftActive && (shiftUser?.name || shiftUser?.username) ? ` : ${shiftUser?.name || shiftUser?.username}` : ' '}\n                        >\n                          <User className=\"h-5 w-5 text-blue-600\" />\n                        </Button>\n                      </div>\n                      {/*   -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({\n                                title: ' ',\n                                description: '      .',\n                                variant: 'destructive'\n                              });\n                            } else {\n                              setIsSalesDataOpen(true);\n                            }\n                          }}\n                          title=\" \"\n                        >\n                          <BarChart className=\"h-5 w-5 text-purple-600\" />\n                        </Button>\n                      </div>\n\n                      {/*  -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <span className=\"text-[10px] font-semibold text-purple-600\"></span>\n                          {debts.filter(d => d.status === 'pending').length > 0 && (\n                            <span className=\"h-4 w-4 rounded-full bg-red-600 text-white text-[10px] flex items-center justify-center ring-2 ring-white\">\n                              {debts.filter(d => d.status === 'pending').length}\n                            </span>\n                          )}\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\n                          onClick={() => { openDebts(); }}\n                          title=\"\"\n                        >\n                          <FileText className=\"h-5 w-5 text-purple-600\" />\n                        </Button>\n                      </div>\n                      {/*  -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-amber-700 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-amber-100 text-amber-700 hover:bg-amber-200 border border-amber-200 ring-3 ring-amber-300 transition-all duration-200 hover:scale-105 active:bg-amber-600 active:text-white active:border-amber-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({\n                                title: ' ',\n                                description: '      .',\n                                variant: 'destructive'\n                              });\n                            } else {\n                              setIsMaintenanceOpen(true);\n                            }\n                          }}\n                          title=\"\"\n                        >\n                          <Wrench className=\"h-5 w-5 text-amber-700\" />\n                        </Button>\n                      </div>\n                      {/*   -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-yellow-500 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-violet-100 text-violet-700 hover:bg-violet-200 border border-violet-200 ring-3 ring-violet-300 transition-all duration-200 hover:scale-105 active:bg-violet-700 active:text-white active:border-violet-700\"\n                          onClick={() => {\n                            if (!isShiftHandoverAllowed || isTahweelaPlan) {\n                              toast({\n                                title: ' ',\n                                description: '      .',\n                                variant: 'destructive'\n                              });\n                            } else {\n                              setIsMachineDailyDialogOpen(true);\n                            }\n                          }}\n                          title=\" \"\n                        >\n                          <FawryMachineIcon className=\"h-5 w-5 text-yellow-500\" />\n                        </Button>\n                      </div>\n                      {/*   -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-orange-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-orange-100 text-orange-600 hover:bg-orange-200 border border-orange-200 ring-3 ring-orange-300 transition-all duration-200 hover:scale-105 active:bg-orange-600 active:text-white active:border-orange-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({\n                                title: ' ',\n                                description: '      .',\n                                variant: 'destructive'\n                              });\n                            } else {\n                              if (MasterPinService.hasMasterPin()) {\n                                setIsShopExpensesPinDialogOpen(true);\n                              } else {\n                                setIsShopExpensesDialogOpen(true);\n                              }\n                            }\n                          }}\n                          title=\" \"\n                        >\n                          <Receipt className=\"h-5 w-5 text-orange-600\" />\n                        </Button>\n                      </div>\n\n                      {/*  -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-rose-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-rose-100 text-rose-600 hover:bg-rose-200 border border-rose-200 ring-3 ring-rose-300 transition-all duration-200 hover:scale-105 active:bg-rose-600 active:text-white active:border-rose-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({\n                                title: ' ',\n                                description: '      .',\n                                variant: 'destructive'\n                              });\n                            } else {\n                              setIsDeficienciesDialogOpen(true);\n                            }\n                          }}\n                          title=\"\"\n                        >\n                          <AlertTriangle className=\"h-5 w-5 text-rose-600\" />\n                        </Button>\n                      </div>\n\n                    </div>\n                  )}\n                </div>\n\n              </div>\n\n              {/*         */}\n              {/*    :  /  /  */}\n              {!isMobile && (\n                <div className=\"mt-2 w-full\">\n                  <div className=\"filters-bar flex items-center justify-center gap-3 bg-gray-100 rounded-md p-3 border border-gray-200\">\n                    <Button\n                      variant={'ghost'}\n                      size=\"sm\"\n                      className={`btn-filter-send h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${activeTab === 'send' ? 'bg-green-600 text-white border-green-600' : 'text-green-700 border-green-300 hover:bg-green-100'}`}\n                      onClick={() => setActiveTab('send')}\n                      title=\" \"\n                    >\n                      \n                    </Button>\n                    <Button\n                      variant={'ghost'}\n                      size=\"sm\"\n                      className={`btn-filter-withdraw h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${activeTab === 'withdraw' ? 'bg-red-600 text-white border-red-600' : 'text-red-700 border-red-300 hover:bg-red-100'}`}\n                      onClick={() => setActiveTab('withdraw')}\n                      title=\" \"\n                    >\n                      \n                    </Button>\n                    <Button\n                      variant={'ghost'}\n                      size=\"sm\"\n                      className={`btn-filter-all h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${activeTab === 'all' ? 'bg-green-600 text-white border-green-600' : 'text-green-700 border-green-300 hover:bg-green-100'}`}\n                      onClick={() => setActiveTab('all')}\n                      title=\" \"\n                    >\n                      \n                    </Button>\n\n                    {/*       */}\n                    <div className=\"relative ml-1\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-auto px-2 py-1 text-xs text-red-600 hover:bg-red-50 rounded-md font-medium\"\n                        onClick={() => setIsResetRecentDialogOpen(true)}\n                        title=\"  \"\n                      >\n                        <Trash2 className=\"h-3 w-3 mr-1\" />\n                        \n                      </Button>\n                      {hiddenCount > 0 && (\n                        <span className=\"absolute -top-0.5 -right-0.5 h-2 w-2 rounded-full bg-red-500 ring-2 ring-white\" />\n                      )}\n                    </div>\n                  </div>\n                </div>\n              )}\n            </CardHeader>\n            {/*       */}\n            <MasterPinDialog\n              open={isInstallmentPinOpen}\n              onOpenChange={setIsInstallmentPinOpen}\n              mode=\"verify\"\n              title=\"  \"\n              description=\"       \"\n              onSuccess={() => {\n                setIsInstallmentPinOpen(false);\n                setIsInstallmentModalOpen(true);\n              }}\n            />\n            <InstallmentModal\n              open={isInstallmentModalOpen}\n              onOpenChange={setIsInstallmentModalOpen}\n            />\n            <MasterPinDialog\n              open={isTelegramReportPinOpen}\n              onOpenChange={setIsTelegramReportPinOpen}\n              mode=\"verify\"\n              title=\"    \"\n              description=\"        \"\n              onSuccess={() => {\n                setIsTelegramReportPinOpen(false);\n                handleSendTelegramDailyReport();\n              }}\n            />\n            {/*          */}\n            {showDesktopQuickIcons && (\n              <div className=\"px-4 mt-4 mb-1 flex flex-wrap items-center justify-center gap-3\">\n                {/*   -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-green-600 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-green-100 text-green-600 hover:bg-green-200 border border-green-200 ring-3 ring-green-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'charge' ? ' bg-green-600 text-white border-green-600' : ''}`}\n                    onClick={() => {\n                      toast({ title: ' ', description: '    .' });\n                      setSelectedQuickIcon('charge');\n                    }}\n                    title=\" \"\n                  >\n                    <CreditCard className=\"h-5 w-5 text-green-600\" />\n                  </Button>\n                </div>\n                {/*   -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'calculator' ? ' bg-purple-600 text-white border-purple-600' : ''}`}\n                    onClick={() => setIsCalculatorOpen(true)}\n                    title=\" \"\n                  >\n                    <Calculator className=\"h-5 w-5 text-purple-600\" />\n                  </Button>\n                </div>\n                {/*   -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'creditcards' ? ' bg-purple-600 text-white border-purple-600' : ''}`}\n                    onClick={() => {\n                      if (isZeroPlan) {\n                        toast({\n                          title: ' ',\n                          description: '      .  .',\n                          variant: 'destructive'\n                        });\n                      } else {\n                        setIsCreditCardsOpen(true);\n                        setSelectedQuickIcon('creditcards');\n                      }\n                    }}\n                    title=\" \"\n                  >\n                    <CreditCard className=\"h-5 w-5 text-purple-600\" />\n                  </Button>\n                </div>\n                {/*   /   -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-blue-600 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'shift' ? ' bg-blue-600 text-white border-blue-600' : ''}`}\n                    onClick={handleOpenShiftProfile}\n                    title={isShiftActive && (shiftUser?.name || shiftUser?.username) ? ` : ${shiftUser?.name || shiftUser?.username}` : ' '}\n                  >\n                    <User className=\"h-5 w-5 text-blue-600\" />\n                  </Button>\n                </div>\n                {/*   -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'sales' ? ' bg-purple-600 text-white border-purple-600' : ''}`}\n                    onClick={() => {\n                      if (isZeroPlan) {\n                        toast({\n                          title: ' ',\n                          description: '      .  .',\n                          variant: 'destructive'\n                        });\n                      } else {\n                        setIsSalesDataOpen(true);\n                        setSelectedQuickIcon('sales');\n                      }\n                    }}\n                    title=\" \"\n                  >\n                    <BarChart className=\"h-5 w-5 text-purple-600\" />\n                  </Button>\n                </div>\n                {/*  -    */}\n                <div className=\"flex flex-col items-center\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <span className=\"text-[10px] font-semibold text-purple-600\"></span>\n                    {debts.filter(d => d.status === 'pending').length > 0 && (\n                      <span className=\"h-4 w-4 rounded-full bg-red-600 text-white text-[10px] flex items-center justify-center ring-2 ring-white\">\n                        {debts.filter(d => d.status === 'pending').length}\n                      </span>\n                    )}\n                  </div>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'debts' ? ' bg-purple-600 text-white border-purple-600' : ''}`}\n                    onClick={() => { openDebts(); }}\n                    title=\"\"\n                  >\n                    <FileText className=\"h-5 w-5 text-purple-600\" />\n                  </Button>\n                </div>\n                {/*  -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-amber-700 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-amber-100 text-amber-700 hover:bg-amber-200 border border-amber-200 ring-3 ring-amber-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'maintenance' ? ' bg-amber-600 text-white border-amber-600' : ''}`}\n                    onClick={() => {\n                      if (isZeroPlan) {\n                        toast({\n                          title: ' ',\n                          description: '     .  .',\n                          variant: 'destructive'\n                        });\n                      } else {\n                        setIsMaintenanceOpen(true);\n                        setSelectedQuickIcon('maintenance');\n                      }\n                    }}\n                    title=\"\"\n                  >\n                    <Wrench className=\"h-5 w-5 text-amber-700\" />\n                  </Button>\n                </div>\n                {/*   -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-yellow-500 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-violet-100 text-violet-700 hover:bg-violet-200 border border-violet-200 ring-3 ring-violet-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'machine' ? ' bg-violet-700 text-white border-violet-700' : ''}`}\n                    onClick={() => {\n                      if (!isShiftHandoverAllowed) {\n                        toast({\n                          title: ' ',\n                          description: '   :      .',\n                          variant: 'destructive'\n                        });\n                      } else {\n                        setIsMachineDailyDialogOpen(true);\n                        setSelectedQuickIcon('machine');\n                      }\n                    }}\n                    title=\" \"\n                  >\n                    <FawryMachineIcon className=\"h-5 w-5 text-yellow-500\" />\n                  </Button>\n                </div>\n                {/*   -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-orange-600 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-orange-100 text-orange-600 hover:bg-orange-200 border border-orange-200 ring-3 ring-orange-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'expenses' ? ' bg-orange-600 text-white border-orange-600' : ''}`}\n                    onClick={() => {\n                      if (isZeroPlan) {\n                        toast({\n                          title: ' ',\n                          description: '      .  .',\n                          variant: 'destructive'\n                        });\n                      } else {\n                        if (MasterPinService.hasMasterPin()) {\n                          setIsShopExpensesPinDialogOpen(true);\n                        } else {\n                          setIsShopExpensesDialogOpen(true);\n                        }\n                        setSelectedQuickIcon('expenses');\n                      }\n                    }}\n                    title=\" \"\n                  >\n                    <Receipt className=\"h-5 w-5 text-orange-600\" />\n                  </Button>\n                </div>\n                {/*  -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-rose-600 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-rose-100 text-rose-600 hover:bg-rose-200 border border-rose-200 ring-3 ring-rose-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'deficiencies' ? ' bg-rose-600 text-white border-rose-600' : ''}`}\n                    onClick={() => {\n                      if (isZeroPlan) {\n                        toast({\n                          title: ' ',\n                          description: '     .  .',\n                          variant: 'destructive'\n                        });\n                      } else {\n                        setIsDeficienciesDialogOpen(true);\n                        setSelectedQuickIcon('deficiencies');\n                      }\n                    }}\n                    title=\"\"\n                  >\n                    <AlertTriangle className=\"h-5 w-5 text-rose-600\" />\n                  </Button>\n                </div>\n              </div>\n            )}\n            <CardContent className=\"space-y-2 pt-0 px-4 pb-4 relative z-10\">\n              {filteredTransactions.length === 0 ? (\n                <div className=\"text-center py-8 text-gray-500\">\n                  <ArrowUpDown className=\"h-12 w-12 mx-auto mb-2 text-gray-300\" />\n                  <p className=\"text-sm\">    </p>\n                </div>\n              ) : (\n                isMobile ? (\n                  <div className={`overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors max-h-[310px]`}>\n                    <div className=\"space-y-2 pr-2\">\n                      {filteredTransactions.map((transaction) => (\n                        <div\n                          key={transaction.id}\n                          className=\"relative flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer\"\n                          onClick={() => handleTransactionClick(transaction)}\n                        >\n                          {/* Icon Column */}\n                          <div className={`h-10 w-10 rounded-full flex items-center justify-center shrink-0 ${\n                             transaction.type === 'withdraw' ? 'bg-red-100' : 'bg-green-100'\n                          }`}>\n                             {(() => {\n                               const t: any = transaction as any;\n                               const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\n                               const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.type || '').toLowerCase() === 'add') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\n                               \n                               if (isShiftReceipt) return <Receipt className=\"h-5 w-5 text-gray-600\" />;\n                               if (isCashAddReceipt) return <Plus className=\"h-5 w-5 text-green-600\" />;\n                               return transaction.type === 'withdraw' ? (\n                                  <ArrowDownLeft className=\"h-5 w-5 text-red-600\" />\n                               ) : (\n                                  <ArrowUpRight className=\"h-5 w-5 text-green-600\" />\n                               );\n                             })()}\n                          </div>\n\n                          {/* Content Column */}\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center justify-between mb-1\">\n                              <h4 className=\"text-base font-bold truncate\">\n                                {(() => {\n                                   const t: any = transaction as any;\n                                   const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\n                                   const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.type || '').toLowerCase() === 'add') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\n                                   \n                                   if (isShiftReceipt) return <span className=\"text-foreground\"> </span>;\n                                   if (isCashAddReceipt) return <span className=\"text-foreground\"> </span>;\n                                   return transaction.type === 'send' ? <span className=\"text-green-600\"> </span> : <span className=\"text-red-600\"> </span>;\n                                })()}\n                              </h4>\n                              <span className={`text-base font-bold whitespace-nowrap ${\n                                 transaction.type === 'withdraw' ? 'text-red-600' : 'text-green-600'\n                              }`}>\n                                {(transaction.type === 'withdraw' || transaction.type === 'cash_addition' || (transaction as any).txnType === 'cash_addition') ? '+' : '-'} {formatNumberEnglish(transaction.amount)} .\n                              </span>\n                            </div>\n\n                            <div className=\"flex items-center justify-between\">\n                               <div className=\"flex flex-col gap-0.5\">\n                                  <p className=\"text-sm text-muted-foreground truncate\">\n                                     {(() => {\n                                         const t: any = transaction as any;\n                                         const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\n                                         const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.type || '').toLowerCase() === 'add') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\n                                         const noteText = (t?.note || t?.notes || '');\n                                         \n                                         if (isShiftReceipt) return `: ${transaction.receiverPhone}`;\n                                         if (isCashAddReceipt) return noteText || ' ';\n                                         \n                                         return transaction.type === 'send' ? (\n                                            <span dir=\"ltr\">{transaction.receiverPhone}</span>\n                                         ) : (\n                                            <span dir=\"ltr\">{transaction.senderPhone}</span>\n                                         );\n                                     })()}\n                                  </p>\n                                  <p className=\"text-sm font-medium text-gray-500 mt-0.5\">\n                                     {dateFormatter.format(transaction.createdAt instanceof Date ? transaction.createdAt : new Date(transaction.createdAt))} - {timeFormatter.format(transaction.createdAt instanceof Date ? transaction.createdAt : new Date(transaction.createdAt))}\n                                  </p>\n                               </div>\n\n                               <div className={`px-2 py-0.5 rounded-full text-[10px] font-medium flex items-center gap-1 ${\n                                  transaction.status === 'completed' \n                                    ? (transaction.type === 'withdraw' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700')\n                                    : transaction.status === 'pending'\n                                    ? 'bg-yellow-100 text-yellow-700'\n                                    : 'bg-red-100 text-red-700'\n                               }`}>\n                                  {transaction.status === 'completed' && <Check className=\"h-3 w-3\" />}\n                                  {transaction.status === 'pending' && <Clock className=\"h-3 w-3\" />}\n                                  {transaction.status === 'failed' && <X className=\"h-3 w-3\" />}\n                                  <span>\n                                     {transaction.status === 'completed' ? '' : transaction.status === 'pending' ? '' : ''}\n                                  </span>\n                               </div>\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                ) : (\n                  <div className={`overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors max-h-[calc(100dvh-300px)]`}>\n                    <div className=\"space-y-2 pr-2\">\n                      {filteredTransactions.map((transaction) => (\n                        <div\n                          key={transaction.id}\n                          className=\"relative flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer\"\n                          onClick={() => handleTransactionClick(transaction)}\n                        >\n                          {/* Icon Column */}\n                          <div className={`h-10 w-10 rounded-full flex items-center justify-center shrink-0 ${\n                             transaction.type === 'withdraw' ? 'bg-red-100' : 'bg-green-100'\n                          }`}>\n                             {(() => {\n                               const t: any = transaction as any;\n                               const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\n                               const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.type || '').toLowerCase() === 'add') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\n                               \n                               if (isShiftReceipt) return <Receipt className=\"h-5 w-5 text-gray-600\" />;\n                               if (isCashAddReceipt) return <Plus className=\"h-5 w-5 text-green-600\" />;\n                               return transaction.type === 'withdraw' ? (\n                                  <ArrowDownLeft className=\"h-5 w-5 text-red-600\" />\n                               ) : (\n                                  <ArrowUpRight className=\"h-5 w-5 text-green-600\" />\n                               );\n                             })()}\n                          </div>\n\n                          {/* Content Column */}\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center justify-between mb-1\">\n                              <h4 className=\"text-base font-bold truncate\">\n                                {(() => {\n                                   const t: any = transaction as any;\n                                   const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\n                                   const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.type || '').toLowerCase() === 'add') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\n                                   \n                                   if (isShiftReceipt) return <span className=\"text-foreground\"> </span>;\n                                   if (isCashAddReceipt) return <span className=\"text-foreground\"> </span>;\n                                   return transaction.type === 'send' ? <span className=\"text-green-600\"> </span> : <span className=\"text-red-600\"> </span>;\n                                })()}\n                              </h4>\n                              <span className={`text-base font-bold whitespace-nowrap ${\n                                 transaction.type === 'withdraw' ? 'text-red-600' : 'text-green-600'\n                              }`}>\n                                {(transaction.type === 'withdraw' || transaction.type === 'cash_addition' || (transaction as any).txnType === 'cash_addition') ? '+' : '-'} {formatNumberEnglish(transaction.amount)} .\n                              </span>\n                            </div>\n\n                            <div className=\"flex items-center justify-between\">\n                               <div className=\"flex flex-col gap-0.5\">\n                                  <p className=\"text-sm text-muted-foreground truncate\">\n                                     {(() => {\n                                         const t: any = transaction as any;\n                                         const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\n                                         const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.type || '').toLowerCase() === 'add') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\n                                         const noteText = (t?.note || t?.notes || '');\n                                         \n                                         if (isShiftReceipt) return `: ${transaction.receiverPhone}`;\n                                         if (isCashAddReceipt) return noteText || ' ';\n                                         \n                                         return transaction.type === 'send' ? (\n                                            <span dir=\"ltr\">{transaction.receiverPhone}</span>\n                                         ) : (\n                                            <span dir=\"ltr\">{transaction.senderPhone}</span>\n                                         );\n                                     })()}\n                                  </p>\n                                  <p className=\"text-sm font-medium text-gray-500 mt-0.5\">\n                                     {dateFormatter.format(transaction.createdAt instanceof Date ? transaction.createdAt : new Date(transaction.createdAt))} - {timeFormatter.format(transaction.createdAt instanceof Date ? transaction.createdAt : new Date(transaction.createdAt))}\n                                  </p>\n                               </div>\n\n                               <div className={`px-2 py-0.5 rounded-full text-[10px] font-medium flex items-center gap-1 ${\n                                  transaction.status === 'completed' \n                                    ? (transaction.type === 'withdraw' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700')\n                                    : transaction.status === 'pending'\n                                    ? 'bg-yellow-100 text-yellow-700'\n                                    : 'bg-red-100 text-red-700'\n                               }`}>\n                                  {transaction.status === 'completed' && <Check className=\"h-3 w-3\" />}\n                                  {transaction.status === 'pending' && <Clock className=\"h-3 w-3\" />}\n                                  {transaction.status === 'failed' && <X className=\"h-3 w-3\" />}\n                                  <span>\n                                     {transaction.status === 'completed' ? '' : transaction.status === 'pending' ? '' : ''}\n                                  </span>\n                               </div>\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )\n              )}\n              {/*         */}\n              {isMobile && (\n                <div className=\"mt-2 flex justify-end\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"h-7 px-2 text-[11px] rounded-full border bg-red-100 text-red-700 border-red-300 hover:bg-red-200\"\n                    onClick={() => setIsResetRecentDialogOpen(true)}\n                    title=\"  \"\n                  >\n                    <Trash2 className=\"h-3 w-3 mr-1\" />\n                    \n                  </Button>\n                  {user?.uid && localStorage.getItem(`recentTransactionsResetAt:${user.uid}`) && (\n                    <span className=\"inline-block h-1.5 w-1.5 rounded-full bg-red-500 ml-1 align-middle\" />\n                  )}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n        </div>\n\n        {/* Receipt Modal for desktop view */}\n        <ReceiptModal\n          isOpen={isReceiptOpen}\n          onClose={() => setIsReceiptOpen(false)}\n          transaction={receiptTransaction}\n          onPrint={() => window.print()}\n          onDelete={handleDeleteReceipt}\n          onComplete={handleCompleteReceipt}\n        />\n\n        <Dialog open={isDeveloperInfoOpen} onOpenChange={setIsDeveloperInfoOpen}>\n          <DialogContent className=\"sm:max-w-md\">\n            <DialogHeader>\n              <DialogTitle> </DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 py-4\">\n              <div className=\"flex flex-col items-center gap-4 bg-gradient-to-br from-indigo-50 to-blue-50 p-6 rounded-xl border border-blue-100 text-center\">\n                <div className=\"h-16 w-16 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 shadow-sm\">\n                  <Code className=\"h-8 w-8\" />\n                </div>\n                <div className=\"space-y-3 w-full\">\n                  <h3 className=\"text-xl font-bold text-gray-900 mb-2\"> </h3>\n                  <p className=\"text-lg font-bold bg-gradient-to-r from-blue-700 to-indigo-700 bg-clip-text text-transparent leading-relaxed\">\n                          /   \n                  </p>\n                  \n                  <div className=\"flex flex-col items-center gap-1 mt-4\">\n                     <p className=\"text-base font-semibold text-gray-800\">\n                           \n                     </p>\n                     <a href=\"tel:01000392539\" className=\"text-2xl font-black text-blue-600 tracking-wider hover:underline\" dir=\"ltr\">\n                       01000392539\n                     </a>\n                  </div>\n\n                  <p className=\"text-sm text-red-600 font-bold bg-red-50 py-1 px-3 rounded-full inline-block mt-2\">\n                         \n                  </p>\n                </div>\n              </div>\n              <div className=\"text-center text-xs text-gray-400 mt-2\">\n                {appVersion ? `v${appVersion}` : 'v1.0.0'}\n              </div>\n            </div>\n            <DialogFooter>\n              <Button onClick={() => setIsDeveloperInfoOpen(false)}></Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        {/* Transaction Form */}\n        <div className=\"space-y-1 fade-in-right w-full\">\n          <Card id=\"transaction-section\" className={`bg-gray-100 border border-blue-200/40 rounded-lg shadow-lg hover:shadow-lg transition-all duration-200 group relative overflow-hidden`}>\n            {/* Animated background elements */}\n            <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/5 via-indigo-500/3 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"></div>\n            <div className=\"absolute top-0 right-0 w-32 h-32 sm:w-28 sm:h-28 lg:w-20 lg:h-20 bg-gradient-to-bl from-blue-400/10 to-transparent rounded-full  \"></div>\n            <div className=\"absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-indigo-400/10 to-transparent rounded-full  \" style={{ animationDelay: '1s' }}></div>\n\n            <CardHeader className=\"sticky top-0 z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 pb-0.5 px-3 pt-1 lg:pt-0.5 lg:pb-0.5 lg:px-2\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-sm font-bold flex items-center gap-2 text-gray-800\">\n                  <div className=\"relative\">\n                    <CheckCircle className=\"h-1 w-1 text-emerald-500 \" />\n                    <div className=\"absolute inset-0 h-1 w-1 bg-emerald-400 rounded-full opacity-20 \"></div>\n                  </div>\n                  <span className=\"bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent\">\n                      \n                  </span>\n                </CardTitle>\n\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"top-icons-bar hidden md:flex items-center gap-2 bg-gradient-to-r from-gray-50 to-slate-50 hover:from-gray-100 hover:to-slate-100 border border-gray-200 transition-all duration-300 hover:scale-105 h-9 px-3 rounded-xl shadow-sm\">\n                    <NotificationBell />\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" title=\"VIP\" onClick={() => setIsVipOpen(true)}>\n                      <Crown className=\"h-5 w-5 text-yellow-500\" />\n                    </Button>\n                    {/* Telegram button removed */}\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" title=\" \" onClick={() => branchPackage?.status === 'active' ? setBranchDialogOpen(true) : setBranchRequestOpen(true)}>\n                      <Store className=\"h-5 w-5\" />\n                    </Button>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" title=\" \" onClick={() => setIsDeveloperInfoOpen(true)}>\n                      <Wrench className=\"h-5 w-5 text-gray-600\" />\n                    </Button>\n                    <ProfileIcon />\n                  </div>\n                </div>\n                {hasLocalDataToSync && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"hidden flex items-center gap-1.5 sm:gap-2 bg-gradient-to-r from-cyan-50 to-blue-50 hover:from-cyan-100 hover:to-blue-100 border-cyan-200 text-cyan-800 text-xs sm:text-sm transition-all duration-300 hover:scale-105 hover:shadow-lg h-10 sm:h-12 px-4 sm:px-5 rounded-xl min-w-[44px] touch-manipulation\"\n                    onClick={syncLocalDataWithFirebase}\n                    title=\"     \"\n                  >\n                    <RefreshCw className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 animate-spin\" />\n                    <span className=\"text-xs sm:text-sm font-semibold whitespace-nowrap\"></span>\n                  </Button>\n                )}\n\n              </div>\n            </CardHeader>\n            <Dialog open={isVipOpen} onOpenChange={setIsVipOpen}>\n              <DialogContent className=\"sm:max-w-md\">\n                <DialogHeader>\n                  <DialogTitle> 10   </DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-2\">\n                  {vipTop10.length === 0 ? (\n                    <div className=\"text-sm text-gray-600\">    </div>\n                  ) : (\n                    vipTop10.map((item, idx) => (\n                      <div\n                        key={item.phone + idx}\n                        className={`flex items-center justify-between border rounded-md px-3 py-2 bg-white ${idx === 0 ? 'bg-yellow-50 border-yellow-300' : ''}`}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          <Badge\n                            variant=\"outline\"\n                            className={`min-w-[28px] justify-center ${idx === 0 ? 'border-yellow-300 text-yellow-700 bg-yellow-50' : ''}`}\n                          >\n                            {idx + 1}\n                          </Badge>\n                          <span className={`font-semibold ${idx === 0 ? 'text-yellow-700' : ''}`}>{item.phone}</span>\n                        </div>\n                        <div className=\"text-sm text-gray-700 flex items-center gap-3\">\n                          <span>: {item.count}</span>\n                          <span>: {item.total}</span>\n                          <Button variant=\"outline\" size=\"sm\" className=\"h-8\" onClick={() => sendVipWhatsApp(item)} title=\" \">\n                            <MessageCircle className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    ))\n                  )}\n                </div>\n                <DialogFooter>\n                  <Button onClick={() => setIsVipOpen(false)}></Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n\n            <Dialog open={isTelegramOpen} onOpenChange={setIsTelegramOpen}>\n              <DialogContent className=\"sm:max-w-md\">\n                <DialogHeader>\n                  <DialogTitle>  </DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-3\">\n                  <div className=\"space-y-1\">\n                    <Label>Telegram Chat ID</Label>\n                    <Input value={telegramChatId} onChange={(e) => setTelegramChatId(e.target.value)} placeholder=\"  \" />\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <Label>  12 </Label>\n                    <Switch checked={telegramDailyEnabled} onCheckedChange={(v) => setTelegramDailyEnabled(!!v)} />\n                  </div>\n                </div>\n                <DialogFooter>\n                  <Button variant=\"outline\" onClick={() => setIsTelegramOpen(false)}></Button>\n                  <Button onClick={async () => {\n                    if (!user?.uid) return;\n                    await userDataService.updateUserData(user.uid, { telegramChatId, telegramDailyEnabled });\n                    toast({ title: ' ' });\n                  }}></Button>\n                  <Button onClick={async () => {\n                    if (!user?.uid || !telegramChatId) { toast({ title: ' Chat ID' }); return; }\n                    const text = await composeTelegramDailySummary();\n                    try {\n                      const { sendTelegramMessage } = await import('@/integrations/firebase/functions');\n                      await sendTelegramMessage({ chatId: telegramChatId, text });\n                      toast({ title: ' ' });\n                    } catch (e) {\n                      toast({ title: ' ', description: '   ', variant: 'destructive' });\n                    }\n                  }}> </Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n\n            <Dialog open={branchDialogOpen} onOpenChange={setBranchDialogOpen}>\n              <DialogContent className=\"sm:max-w-2xl bg-gray-50/80 backdrop-blur-sm\">\n                <DialogHeader className=\"border-b pb-4 mb-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"p-2 bg-indigo-100 rounded-lg\">\n                        <Store className=\"w-6 h-6 text-indigo-600\" />\n                      </div>\n                      <div>\n                        <DialogTitle className=\"text-xl font-bold text-gray-900\"> </DialogTitle>\n                        <DialogDescription className=\"text-gray-500 mt-1\">\n                                 \n                        </DialogDescription>\n                      </div>\n                    </div>\n                    \n                    <Button\n                      size=\"icon\"\n                      variant={showAddBranchForm ? \"destructive\" : \"default\"}\n                      className={`rounded-full transition-all duration-300 ${showAddBranchForm ? 'bg-red-50 text-red-600 hover:bg-red-100 border border-red-200' : 'bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg hover:shadow-indigo-200'}`}\n                      onClick={() => setShowAddBranchForm(!showAddBranchForm)}\n                      title={showAddBranchForm ? \" \" : \"  \"}\n                    >\n                      {showAddBranchForm ? <Minus className=\"w-6 h-6\" /> : <Plus className=\"w-6 h-6\" />}\n                    </Button>\n                  </div>\n                </DialogHeader>\n\n                <div className=\"space-y-6\">\n                  {/*     */}\n                  {showAddBranchForm && (\n                  <div className=\"bg-white p-5 rounded-xl border shadow-sm space-y-4 animate-in slide-in-from-top-4 fade-in duration-300\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <div className=\"flex items-center gap-2 text-indigo-700 font-semibold\">\n                        <Plus className=\"w-5 h-5\" />\n                        <h3>  </h3>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button \n                          onClick={() => checkSubscriptionStatus(true).then(() => toast({ title: '  ' }))} \n                          variant=\"ghost\" \n                          size=\"icon\" \n                          title=\"  \"\n                        >\n                          <RefreshCw className=\"w-4 h-4 text-gray-500\" />\n                        </Button>\n                        <Button onClick={() => setBranchRequestOpen(true)} variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                          <PlusCircle className=\"w-4 h-4\" />\n                            \n                        </Button>\n                      </div>\n                    </div>\n                    \n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div className=\"space-y-2\">\n                        <Label className=\"text-gray-700\"> </Label>\n                        <div className=\"relative\">\n                          <User className=\"absolute right-3 top-2.5 h-4 w-4 text-gray-400\" />\n                          <Input \n                            className=\"pr-9\" \n                            value={managerNameInput} \n                            onChange={e => setManagerNameInput(e.target.value)} \n                            placeholder=\":  \" \n                          />\n                        </div>\n                      </div>\n                      \n                      <div className=\"space-y-2\">\n                        <Label className=\"text-gray-700\"> </Label>\n                        <div className=\"relative\">\n                          <Store className=\"absolute right-3 top-2.5 h-4 w-4 text-gray-400\" />\n                          <Input \n                            className=\"pr-9\" \n                            value={branchNameInput} \n                            onChange={e => setBranchNameInput(e.target.value)} \n                            placeholder=\":   \" \n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label className=\"text-gray-700\">  </Label>\n                        <div className=\"relative\">\n                          <MessageCircle className=\"absolute right-3 top-2.5 h-4 w-4 text-gray-400\" />\n                          <Input \n                            className=\"pr-9\" \n                            value={branchEmailInput} \n                            onChange={e => setBranchEmailInput(e.target.value)} \n                            placeholder=\"branch@example.com\" \n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label className=\"text-gray-700\"> </Label>\n                        <div className=\"relative\">\n                          <div className=\"absolute right-3 top-2.5 h-4 w-4 text-gray-400\"></div>\n                          <Input \n                            type=\"password\" \n                            className=\"pr-9\" \n                            value={loginPasswordInput} \n                            onChange={e => setLoginPasswordInput(e.target.value)} \n                            placeholder=\"\" \n                          />\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center justify-end gap-3 pt-2\">\n                      <Button \n                        variant=\"ghost\" \n                        onClick={() => { setManagerNameInput(''); setBranchNameInput(''); setBranchEmailInput(''); setLoginPasswordInput(''); }}\n                        className=\"text-gray-500 hover:text-gray-700\"\n                      >\n                         \n                      </Button>\n                      <Button \n                        className=\"bg-indigo-600 hover:bg-indigo-700 text-white min-w-[120px]\" \n                        disabled={branchLoading} \n                        onClick={async () => {\n                      if (!user?.uid) return;\n                      const manager = managerNameInput.trim();\n                      const bname = branchNameInput.trim();\n                      const email = branchEmailInput.trim();\n                      const pw = loginPasswordInput.trim();\n                      \n                      if (!manager || !bname || !email || !pw) { \n                        toast({ title: '    ' }); \n                        return; \n                      }\n\n                      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n                      if (!emailRegex.test(email)) {\n                         toast({ title: '   ', variant: 'destructive' });\n                         return;\n                      }\n\n                      if (pw.length < 6) {\n                         toast({ title: '     6   ', variant: 'destructive' });\n                         return;\n                      }\n\n                      const limit = branchPackage?.limit || 0;\n                      if (branches.length >= limit) {\n                        toast({\n                          title: '',\n                          description: `      (${limit} )`,\n                          variant: 'destructive'\n                        });\n                        return;\n                      }\n\n                      try {\n                        setBranchLoading(true);\n\n                        let newUserId = '';\n                        let shopIdNew = '';\n                        const tempAppName = `tempApp_${Date.now()}`;\n                        const tempApp = initializeApp(firebaseConfig, tempAppName);\n                        const tempAuth = getAuth(tempApp);\n                        const tempDb = getFirestore(tempApp);\n                        \n                        try {\n                            const userCred = await createUserWithEmailAndPassword(tempAuth, email, pw);\n                            newUserId = userCred.user.uid;\n\n                            // Create User Document for Branch User\n                            try {\n                                await setDoc(doc(tempDb, 'users', newUserId), {\n                                    email: email,\n                                    isActive: true,\n                                    isBranch: true,\n                                    ownerId: user.uid,\n                                    createdAt: serverTimestamp(),\n                                    updatedAt: serverTimestamp(),\n                                    role: 'branch',\n                                    // Subscription starts as INACTIVE (Pending Admin Activation)\n                                    isActive: false, \n                                    subscription: {\n                                        isActive: false,\n                                        planType: null,\n                                        startDate: null,\n                                        endDate: null\n                                    }\n                                });\n                            } catch (e) {\n                                console.error('Error creating branch user document:', e);\n                                // Continue, as the auth user is created, but they might get stuck in pending approval\n                            }\n\n                            // Create the shop AS the new user to ensure ownership permissions\n                            try {\n                                const shopRef = await addDoc(collection(tempDb, 'shops'), { \n                                    name: bname, \n                                    ownerId: newUserId, \n                                    managerName: manager, \n                                    createdAt: serverTimestamp(), \n                                    updatedAt: serverTimestamp(), \n                                    isActive: true \n                                });\n                                shopIdNew = shopRef.id;\n                            } catch (shopError: any) {\n                                console.error('Error creating shop as new user:', shopError);\n                                // If root creation fails (e.g. strict rules), try user subcollection\n                                try {\n                                    const shopRef2 = await addDoc(collection(tempDb, 'users', newUserId, 'shops'), { \n                                        name: bname, \n                                        ownerId: newUserId, \n                                        managerName: manager, \n                                        createdAt: serverTimestamp(), \n                                        updatedAt: serverTimestamp(), \n                                        isActive: true \n                                    });\n                                    shopIdNew = shopRef2.id;\n                                } catch (subError) {\n                                    console.error('Error creating shop in subcollection:', subError);\n                                    throw shopError; // Throw the original error\n                                }\n                            }\n\n                            await firebaseSignOut(tempAuth);\n                        } catch (error: any) {\n                            console.error('Registration/Shop Creation Error:', error);\n                            \n                            let msg = '    ';\n                            if (error.code === 'auth/email-already-in-use') msg = '   ';\n                            if (error.code === 'auth/invalid-email') msg = '   ';\n                            if (error.code === 'auth/weak-password') msg = '  ';\n                            if (error.code === 'permission-denied') msg = '      ';\n                            \n                            toast({ title: msg, description: error.message, variant: 'destructive' });\n                            try { await deleteApp(tempApp); } catch {}\n                            return;\n                        } finally {\n                            try { await deleteApp(tempApp); } catch (e) { console.warn('Error deleting temp app:', e); }\n                        }\n\n                        if (!newUserId || !shopIdNew) return;\n\n                        // Now link the branch in the Admin's account (using main db)\n                        const safeEncode = (s: string) => {\n                          try { return btoa(unescape(encodeURIComponent(s))); } catch { return btoa(s); }\n                        };\n                        \n                        try {\n                          // 1. Create in subcollection with ID = branchUserId (Critical for Security Rules)\n                          const branchData = { \n                            ownerId: user.uid, \n                            shopId: shopIdNew, \n                            branchUserId: newUserId,\n                            branchName: bname, \n                            managerName: manager, \n                            loginUsername: email, \n                            passwordEncoded: safeEncode(pw), \n                            createdAt: serverTimestamp() \n                          };\n                          \n                          await fsSetDoc(fsDoc(db, 'users', user.uid, 'branches', newUserId), branchData);\n\n                          // 2. Create in root collection (Optional/Legacy)\n                          try {\n                            await addDoc(collection(db, 'branches'), branchData);\n                          } catch (e) {\n                             console.warn('Branch ref creation error in root collection (non-fatal):', e);\n                          }\n\n                          // Optimistic Update: Add new branch to UI immediately\n                          const newBranch = { \n                              id: newUserId, \n                              branchUserId: newUserId,\n                              branchName: bname, \n                              managerName: manager, \n                              source: 'sub',\n                              ...branchData \n                          };\n                          setBranches(prev => [...prev, newBranch]);\n                          // Removed setBranchesLoaded(false) to prevent immediate re-fetch which might bring back deleted branches if propagation is slow\n                          // setBranchesLoaded(false); \n\n                        } catch (e) {\n                           console.error('Branch ref creation error:', e);\n                           toast({ title: '    ', description: '      ', variant: 'destructive' });\n                           // We might want to not throw here to avoid confusing the user since the user auth is created\n                        }\n\n                        setManagerNameInput(''); \n                        setBranchNameInput(''); \n                        setBranchEmailInput(''); \n                        setLoginPasswordInput('');\n                        toast({ title: '     ' });\n                      } catch (e: any) {\n                        console.error('General Error adding branch:', e);\n                        toast({ title: '  ', description: e.message || '   ' });\n                      } finally { setBranchLoading(false); }\n                    }}>\n                        {branchLoading ? ' ...' : ' '}\n                      </Button>\n                    </div>\n                  </div>\n                  )}\n\n                  {/*   */}\n                  <div className=\"space-y-3\">\n                    <h4 className=\"text-lg font-semibold text-gray-800 flex items-center gap-2\">\n                      <div className=\"w-1.5 h-6 bg-indigo-500 rounded-full\"></div>\n                       \n                      <Badge variant=\"secondary\" className=\"mr-auto\">{branches.length} / {branchPackage?.limit || 0}</Badge>\n                    </h4>\n                    \n                    {branchLoading && branches.length === 0 ? (\n                      <div className=\"flex flex-col items-center justify-center py-8 text-gray-500\">\n                        <RefreshCw className=\"w-8 h-8 animate-spin mb-2 text-indigo-400\" />\n                        <p>  ...</p>\n                      </div>\n                    ) : branches.length === 0 ? (\n                      <div className=\"text-center py-8 border-2 border-dashed rounded-xl bg-gray-50\">\n                        <Store className=\"w-12 h-12 text-gray-300 mx-auto mb-2\" />\n                        <p className=\"text-gray-500\">    </p>\n                      </div>\n                    ) : (\n                      <div className=\"grid grid-cols-1 gap-3\">\n                        {branches.map((b) => (\n                          <div key={b.id} className=\"group relative bg-white border rounded-xl p-4 shadow-sm hover:shadow-md transition-all duration-200\">\n                            <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n                              <div className=\"flex items-center gap-4\">\n                                <div className=\"w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold text-lg\">\n                                  {b.branchName?.charAt(0) || 'B'}\n                                </div>\n                                <div>\n                                  <h5 className=\"font-bold text-gray-900 text-lg\">{b.branchName}</h5>\n                                  <div className=\"flex items-center gap-2 text-sm text-gray-500\">\n                                    <User className=\"w-3 h-3\" />\n                                    <span>: {b.managerName}</span>\n                                  </div>\n                                </div>\n                              </div>\n                              \n                              <div className=\"flex items-center gap-2 w-full sm:w-auto mt-2 sm:mt-0\">\n                                <Button \n                                  className=\"flex-1 sm:flex-none bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200\"\n                                  onClick={() => fetchBranchDetails(b)}\n                                >\n                                  <BarChart className=\"w-4 h-4 ml-2\" />\n                                   \n                                </Button>\n                                <Button \n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  className=\"text-blue-500 hover:text-blue-700 hover:bg-blue-50\"\n                                  title=\"  \"\n                                  onClick={() => openEditBranchDialog(b)}\n                                >\n                                  <Edit className=\"w-4 h-4\" />\n                                </Button>\n\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n            <Dialog open={branchLoginOpen} onOpenChange={setBranchLoginOpen}>\n              <DialogContent className=\"sm:max-w-md\">\n                <DialogHeader>\n                  <DialogTitle> </DialogTitle>\n                  <DialogDescription>    </DialogDescription>\n                </DialogHeader>\n                <div className=\"space-y-3\">\n                  <div>\n                    <Label>  ( )</Label>\n                    <Input value={branchLoginUsername} onChange={e => setBranchLoginUsername(e.target.value)} placeholder=\"example@email.com\" />\n                  </div>\n                  <div>\n                    <Label> </Label>\n                    <Input type=\"password\" value={branchLoginPassword} onChange={e => setBranchLoginPassword(e.target.value)} placeholder=\"\" />\n                  </div>\n                  <div className=\"flex items-center justify-end gap-2\">\n                    <Button variant=\"outline\" onClick={() => { setBranchLoginUsername(''); setBranchLoginPassword(''); }}></Button>\n                    <Button className=\"bg-blue-600 hover:bg-blue-700\" disabled={branchAuthLoading} onClick={async () => {\n                      const b = branchLoginTarget;\n                      if (!b) { setBranchLoginOpen(false); return; }\n                      const expectedUser = String(b.loginUsername || '');\n                      let expectedPw = '';\n                      try {\n                        const enc = String(b.passwordEncoded || '');\n                        expectedPw = enc ? decodeURIComponent(escape(atob(enc))) : '';\n                      } catch {\n                        try { expectedPw = b.passwordEncoded ? atob(String(b.passwordEncoded)) : ''; } catch { expectedPw = ''; }\n                      }\n                      const u = branchLoginUsername.trim();\n                      const p = branchLoginPassword.trim();\n                      if (!u || !p) { toast({ title: '     ' }); return; }\n                      if (u !== expectedUser || p !== expectedPw) { toast({ title: '   ', variant: 'destructive' }); return; }\n                      try {\n                        setBranchAuthLoading(true);\n                        const key = user?.uid ? `selectedShopId_${user.uid}` : 'selectedShopId';\n                        localStorage.setItem(key, String(b.shopId));\n                        toast({ title: '   ', description: String(b.branchName || '') });\n                        setBranchLoginOpen(false);\n                        setBranchDialogOpen(false);\n                        navigate('/user/dashboard');\n                      } catch { }\n                      setBranchAuthLoading(false);\n                    }}></Button>\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n            <Dialog open={branchDetailsOpen} onOpenChange={setBranchDetailsOpen}>\n              <DialogContent className=\"sm:max-w-2xl\">\n                <DialogHeader>\n                  <DialogTitle>  {selectedBranchDetails?.branchName}</DialogTitle>\n                  <DialogDescription> : {selectedBranchDetails?.managerName}</DialogDescription>\n                </DialogHeader>\n                {branchDetailsLoading ? (\n                  <div className=\"py-8 flex justify-center\">\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                  </div>\n                ) : selectedBranchDetails ? (\n                  <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 py-4\">\n                    <div className=\"p-4 border rounded-xl bg-green-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\"> </div>\n                      <div className=\"text-xl font-bold text-green-700\">{formatNumberEnglish(selectedBranchDetails.todaySales)} .</div>\n                    </div>\n                    <div className=\"p-4 border rounded-xl bg-blue-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\"> </div>\n                      <div className=\"text-xl font-bold text-blue-700\">{formatNumberEnglish(selectedBranchDetails.monthSales)} .</div>\n                    </div>\n                    <div className=\"p-4 border rounded-xl bg-emerald-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\"> </div>\n                      <div className=\"text-xl font-bold text-emerald-700\">{formatNumberEnglish(selectedBranchDetails.todayProfit)} .</div>\n                    </div>\n                    <div className=\"p-4 border rounded-xl bg-cyan-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\"> </div>\n                      <div className=\"text-xl font-bold text-cyan-700\">{formatNumberEnglish(selectedBranchDetails.monthProfit)} .</div>\n                    </div>\n                    <div className=\"p-4 border rounded-xl bg-purple-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\"> </div>\n                      <div className=\"text-xl font-bold text-purple-700\">{formatNumberEnglish(selectedBranchDetails.walletsTotal)} .</div>\n                    </div>\n                    <div className=\"p-4 border rounded-xl bg-yellow-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\"> </div>\n                      <div className=\"text-xl font-bold text-yellow-700\">{formatNumberEnglish(selectedBranchDetails.cashBalance)} .</div>\n                    </div>\n                    <div className=\"p-4 border rounded-xl bg-indigo-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\">  </div>\n                      <div className=\"text-xl font-bold text-indigo-700\">{formatNumberEnglish(selectedBranchDetails.totalSalesSection)} .</div>\n                    </div>\n                    <div className=\"p-4 border rounded-xl bg-red-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\"> </div>\n                      <div className=\"text-xl font-bold text-red-700\">{formatNumberEnglish(selectedBranchDetails.debtsTotal)} .</div>\n                    </div>\n                  </div>\n                ) : null}\n                <DialogFooter>\n                    <Button onClick={() => setBranchDetailsOpen(false)}></Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n\n            <Dialog open={branchEditOpen} onOpenChange={setBranchEditOpen}>\n              <DialogContent className=\"sm:max-w-md\">\n                <DialogHeader>\n                  <DialogTitle>  </DialogTitle>\n                  <DialogDescription>\n                        \n                  </DialogDescription>\n                </DialogHeader>\n                <div className=\"space-y-4 py-2\">\n                  <div className=\"space-y-2\">\n                    <Label>  ( )</Label>\n                    <Input \n                      value={editBranchEmail} \n                      readOnly\n                      disabled\n                      placeholder=\"   \"\n                      className=\"bg-gray-100 text-black opacity-100 font-medium\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label> </Label>\n                    <Input \n                      value={editBranchName} \n                      onChange={(e) => setEditBranchName(e.target.value)} \n                      placeholder=\":  \"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label> </Label>\n                    <Input \n                      value={editManagerName} \n                      onChange={(e) => setEditManagerName(e.target.value)} \n                      placeholder=\":  \"\n                    />\n                  </div>\n                </div>\n                <DialogFooter>\n                  <Button variant=\"outline\" onClick={() => setBranchEditOpen(false)}></Button>\n                  <Button onClick={handleUpdateBranch} disabled={editBranchLoading}>\n                    {editBranchLoading ? ' ...' : ' '}\n                  </Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n            <CardContent\n              ref={formRef}\n              className=\"space-y-1 px-2 pb-2 relative z-10 transition-transform duration-200 ease-out will-change-transform\"\n              style={{ transform: formTranslateY ? `translateY(${formTranslateY}px)` : undefined }}\n              onFocusCapture={(e) => {\n                const target = e.target as HTMLElement | null;\n                const isTransferFee = target?.id === 'transferExtraFeeInput';\n                if (!isTransferFee) {\n                  setFormTranslateY(0);\n                  return;\n                }\n                const btn = document.getElementById('transferSubmitButton') as HTMLButtonElement | null;\n                if (btn) {\n                  const rect = btn.getBoundingClientRect();\n                  const viewBottom = window.innerHeight;\n                  if (rect.bottom > viewBottom) {\n                    const needed = rect.bottom - viewBottom;\n                    const offset = Math.min(needed, 220);\n                    setFormTranslateY(-offset);\n                  } else {\n                    setFormTranslateY(0);\n                  }\n                } else {\n                  setFormTranslateY(0);\n                }\n              }}\n              onBlurCapture={(e) => {\n                if (!e.currentTarget.contains(e.relatedTarget as Node)) {\n                  setFormTranslateY(0);\n                }\n              }}\n            >\n              <div className=\"transaction-type-tabs flex w-full rounded-full border border-gray-300 overflow-hidden bg-surface\">\n                <button\n                  type=\"button\"\n                  onClick={() => handleTransactionTypeChange('transfer')}\n                  className={`flex-1 h-10 text-sm font-medium transition-colors duration-200 flex items-center justify-center gap-2 ${transactionType === 'transfer'\n                    ? 'bg-blue-100 text-blue-900'\n                    : 'bg-transparent text-gray-600 hover:bg-gray-50'\n                    }`}\n                >\n                  {transactionType === 'transfer' && <Check className=\"h-4 w-4\" />}\n                  <ArrowUpDown className=\"h-4 w-4\" />\n                  \n                </button>\n                <div className=\"w-[1px] bg-gray-300\"></div>\n                <button\n                  type=\"button\"\n                  onClick={() => handleTransactionTypeChange('withdraw')}\n                  className={`flex-1 h-10 text-sm font-medium transition-colors duration-200 flex items-center justify-center gap-2 ${transactionType === 'withdraw'\n                    ? 'bg-red-100 text-red-900'\n                    : 'bg-transparent text-gray-600 hover:bg-gray-50'\n                    }`}\n                >\n                  {transactionType === 'withdraw' && <Check className=\"h-4 w-4\" />}\n                  <ArrowDownLeft className=\"h-4 w-4\" />\n                  \n                </button>\n              </div>\n\n              {/* Wallet Selection */}\n              <div>\n                <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-3\">\n                  <label className=\"text-sm font-semibold text-gray-700 flex items-center gap-2 whitespace-nowrap\">\n                    <Wallet className=\"h-4 w-4 text-blue-600\" />\n                     \n                  </label>\n                  <div className=\"flex items-center gap-1 justify-end overflow-x-auto scrollbar-hide\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"h-7 rounded-md px-2 text-[10px] font-medium bg-emerald-50 text-emerald-700 hover:bg-emerald-100 border-emerald-200 shadow-sm whitespace-nowrap\"\n                      onClick={() => navigate('/user/add-wallet')}\n                      title=\" \"\n                    >\n                      <Plus className=\"h-3 w-3 mr-1\" />\n                       \n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"h-7 rounded-md px-2 text-[10px] font-medium bg-orange-50 text-orange-700 hover:bg-orange-100 border-orange-200 shadow-sm whitespace-nowrap\"\n                      onClick={() => setIsWalletPrinterDialogOpen(true)}\n                      title=\" \"\n                    >\n                      <Printer className=\"h-3 w-3 mr-1\" />\n                      \n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"h-7 rounded-md px-2 text-[10px] font-medium bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border-indigo-200 shadow-sm whitespace-nowrap\"\n                      onClick={() => {\n                        //          \n                        setIsWalletsPinDialogOpen(true);\n                      }}\n                      title=\"\"\n                    >\n                      <Wallet className=\"h-3 w-3 mr-1\" />\n                      \n                    </Button>\n                  </div>\n                </div>\n                {wallets.length > 0 ? (\n                  <Select value={selectedWallet} onValueChange={handleWalletChange}>\n                    <SelectTrigger data-testid=\"wallet-select\" className={`w-full h-14 text-base bg-surface border border-gray-400 hover:border-gray-800 focus:border-primary rounded-xl transition-colors duration-200 flex items-center`}>\n                      <SelectValue placeholder=\"  \" className=\"text-gray-700\" />\n                    </SelectTrigger>\n                    <SelectContent className=\"rounded-xl border border-gray-200 shadow-md z-[9999] bg-white dark:bg-gray-900\">\n                      {/* Search Bar */}\n                      <div data-fixed-header=\"true\" className=\"sticky top-0 z-10 bg-white dark:bg-gray-900 p-2 border-b border-gray-100 dark:border-gray-800\">\n                        <Input\n                          value={walletSearch}\n                          onChange={(e) => setWalletSearch(e.target.value)}\n                          placeholder=\"  \"\n                          className=\"h-10 text-sm border-gray-300 rounded-lg\"\n                        />\n                      </div>\n                      <div className=\"p-1\">\n                        {filteredWallets.length === 0 ? (\n                          <div className=\"text-sm text-gray-500 p-3 text-center\">   </div>\n                        ) : (\n                          filteredWallets.map((wallet) => (\n                            <SelectItem key={wallet.id} value={wallet.id} className=\"rounded-lg my-1 cursor-pointer hover:bg-gray-100 focus:bg-blue-50 transition-colors duration-200\">\n                              <div className=\"flex items-center gap-3 py-2 w-full\">\n                                <Wallet className=\"h-5 w-5 text-gray-500\" />\n                                <div className=\"flex items-center gap-2 text-right\">\n                                  <span className=\"text-base font-medium text-gray-900\">{wallet.name}</span>\n                                  <span className=\"text-sm font-bold text-red-600\">{wallet.phone}</span>\n                                </div>\n                                {wallet.isDefault && (\n                                  <span className=\"mr-auto text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full border border-gray-200\"></span>\n                                )}\n                              </div>\n                            </SelectItem>\n                          ))\n                        )}\n                      </div>\n                    </SelectContent>\n                  </Select>\n                ) : (\n                  <div className=\"rounded-xl border-2 border-dashed border-gray-200 bg-gray-50 px-3 py-3 text-xs text-gray-600\">\n                        .      .\n                  </div>\n                )}\n              </div>\n\n              {/* Wallets View Dialog */}\n              <Dialog open={isWalletsDialogOpen} onOpenChange={setIsWalletsDialogOpen}>\n                <DialogContent className=\"sm:max-w-3xl w-[95vw] sm:w-auto max-h-[80vh] overflow-y-auto\">\n                  <DialogHeader>\n                    <DialogTitle> </DialogTitle>\n                  </DialogHeader>\n                  <div className=\"mt-2\">\n                    <WalletsManagement\n                      showAddButton={false}\n                      showUsageBars={false}\n                      showLimitCards={false}\n                      showEditButton={true}\n                    />\n                  </div>\n                </DialogContent>\n              </Dialog>\n\n              {/*       */}\n              <MasterPinDialog\n                open={isWalletsPinDialogOpen}\n                onOpenChange={setIsWalletsPinDialogOpen}\n                mode=\"verify\"\n                title=\"   \"\n                description=\"      \"\n                onSuccess={() => {\n                  setIsWalletsPinDialogOpen(false);\n                  setIsWalletsDialogOpen(true);\n                }}\n                userId={user?.uid}\n              />\n\n              {/* Wallet Printer Dialog */}\n              <WalletPrinterDialog \n                isOpen={isWalletPrinterDialogOpen} \n                onClose={() => setIsWalletPrinterDialogOpen(false)}\n                wallets={wallets}\n              />\n\n              {/*       */}\n              <MasterPinDialog\n                open={isWalletSelectionPinDialogOpen}\n                onOpenChange={(open) => {\n                  setIsWalletSelectionPinDialogOpen(open);\n                  if (!open) {\n                    setPendingSelectedWalletId(null);\n                  }\n                }}\n                mode=\"verify\"\n                title=\"  \"\n                description=\"      \"\n                onSuccess={() => {\n                  if (pendingSelectedWalletId) {\n                    setWalletSelection(pendingSelectedWalletId, 'walletSelectionPin');\n                    setPendingSelectedWalletId(null);\n                  }\n                  setIsWalletSelectionPinDialogOpen(false);\n                }}\n                userId={user?.uid}\n              />\n\n              {/*      */}\n              {/* Monthly Limit Warning Dialog Removed - Converted to Inline Row */}\n\n\n              {/* Combined Progress Bar for Monthly and Daily Limits - Per Wallet */}\n              {selectedWallet && wallets.length > 0 && (() => {\n                const selectedWalletObj = wallets.find(w => w.id === selectedWallet);\n                const walletMonthlyUsage = walletMonthlyUsageMemo;\n                const walletDailyUsage = walletDailyUsageMemo;\n\n                //      (    / )\n                const monthlyWithdrawalLimit = selectedWalletLimits?.monthlyWithdrawLimit ?? selectedWalletObj?.monthlyWithdrawalLimit ?? 200000;\n                const monthlyTransferLimit = selectedWalletLimits?.monthlyTransferLimit ?? selectedWalletObj?.monthlyTransferLimit ?? 200000;\n                const monthlyWithdrawUsed = selectedWalletLimits?.monthlyWithdrawUsed ?? walletMonthlyUsage.totalWithdrawn ?? 0;\n                const monthlyTransferUsed = selectedWalletLimits?.monthlyTransferUsed ?? walletMonthlyUsage.totalTransferred ?? 0;\n\n                const isTahweelaPlan = userSubscription?.subscription?.planType === SubscriptionPlan.TAHWEELA;\n                const dailyWithdrawalLimit = isTahweelaPlan ? 0 : (selectedWalletLimits?.dailyWithdrawLimit ?? 100000);\n                const dailyTransferLimit = isTahweelaPlan ? 0 : (selectedWalletLimits?.dailyTransferLimit ?? 60000);\n                const dailyWithdrawUsed = isTahweelaPlan ? 0 : (selectedWalletLimits?.dailyWithdrawUsed ?? walletDailyUsage.totalWithdrawn ?? 0);\n                const dailyTransferUsed = isTahweelaPlan ? 0 : (selectedWalletLimits?.dailyTransferUsed ?? walletDailyUsage.totalTransferred ?? 0);\n\n                //        \n                const amountNum = parseFloat(amount || '0') || 0;\n                const predictedMonthlyWithdrawUsed = monthlyWithdrawUsed + (transactionType === 'withdraw' ? amountNum : 0);\n                const predictedMonthlyTransferUsed = monthlyTransferUsed + (transactionType === 'transfer' ? amountNum : 0);\n                const predictedDailyWithdrawUsed = dailyWithdrawUsed + (transactionType === 'withdraw' ? amountNum : 0);\n                const predictedDailyTransferUsed = dailyTransferUsed + (transactionType === 'transfer' ? amountNum : 0);\n\n                if (!selectedWalletObj) return null;\n\n                return (\n                  <div className=\"mb-2 space-y-2 p-2 bg-gray-50 rounded-xl border border-gray-200 shadow-sm\">\n                    {/* Monthly Limits - Side-by-Side Split */}\n                    <div className=\"space-y-1\">\n                      <div className=\"flex items-center justify-between border-b border-gray-200 pb-1\">\n                        <span className=\"text-sm font-bold text-gray-800\"> </span>\n                        <span className=\"text-xs font-medium text-gray-500 bg-white px-2 py-0.5 rounded-full border border-gray-200\">{selectedWalletName || selectedWalletObj?.name}</span>\n                      </div>\n                      \n                      <div className=\"flex gap-4\">\n                        {/* Withdraw Progress (Right Side) */}\n                        <div className=\"flex-1\">\n                          <div className=\"flex justify-between text-xs mb-1 font-medium\">\n                            <span className=\"text-gray-700\"> </span>\n                            <span className=\"text-gray-600 dir-ltr\">{Math.max(monthlyWithdrawalLimit - predictedMonthlyWithdrawUsed, 0).toLocaleString('en-US', { maximumFractionDigits: 0 })} </span>\n                          </div>\n                          <div className=\"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50\">\n                            <div \n                              className=\"h-full bg-gradient-to-l from-red-500 to-red-600 rounded-full transition-all duration-500 ease-out shadow-sm\"\n                              style={{ width: `${Math.min(((predictedMonthlyWithdrawUsed / Math.max(monthlyWithdrawalLimit, 1)) * 100), 100)}%` }}\n                            />\n                          </div>\n                          <div className=\"flex justify-between mt-0.5\">\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {predictedMonthlyWithdrawUsed.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {monthlyWithdrawalLimit.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                          </div>\n                        </div>\n\n                        {/* Divider Line */}\n                        <div className=\"w-[1px] bg-gray-200 self-stretch\"></div>\n\n                        {/* Transfer Progress (Left Side) */}\n                        <div className=\"flex-1\">\n                          <div className=\"flex justify-between text-xs mb-1 font-medium\">\n                            <span className=\"text-gray-700\"> </span>\n                            <span className=\"text-gray-600 dir-ltr\">{Math.max(monthlyTransferLimit - predictedMonthlyTransferUsed, 0).toLocaleString('en-US', { maximumFractionDigits: 0 })} </span>\n                          </div>\n                          <div className=\"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50\">\n                            <div \n                              className=\"h-full bg-gradient-to-l from-blue-500 to-blue-600 rounded-full transition-all duration-500 ease-out shadow-sm\"\n                              style={{ width: `${Math.min(((predictedMonthlyTransferUsed / Math.max(monthlyTransferLimit, 1)) * 100), 100)}%` }}\n                            />\n                          </div>\n                          <div className=\"flex justify-between mt-0.5\">\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {predictedMonthlyTransferUsed.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {monthlyTransferLimit.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* Daily Limits */}\n                    <div className=\"space-y-1 pt-1.5 border-t border-gray-200\">\n                      <div className=\"flex items-center justify-between mb-0.5\">\n                         <span className=\"text-sm font-bold text-gray-800\"> </span>\n                      </div>\n                      \n                      <div className=\"flex gap-4\">\n                        {/* Withdraw Progress (Right Side) */}\n                        <div className=\"flex-1\">\n                          <div className=\"flex justify-between text-xs mb-1 font-medium\">\n                            <span className=\"text-gray-700\"> </span>\n                            <span className=\"text-gray-600 dir-ltr\">{Math.max(dailyWithdrawalLimit - predictedDailyWithdrawUsed, 0).toLocaleString('en-US', { maximumFractionDigits: 0 })} </span>\n                          </div>\n                          <div className=\"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50\">\n                            <div \n                              className=\"h-full bg-gradient-to-l from-orange-400 to-orange-500 rounded-full transition-all duration-500 ease-out\"\n                              style={{ width: `${Math.min(((predictedDailyWithdrawUsed / Math.max(dailyWithdrawalLimit, 1)) * 100), 100)}%` }}\n                            />\n                          </div>\n                          <div className=\"flex justify-between mt-0.5\">\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {predictedDailyWithdrawUsed.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {dailyWithdrawalLimit.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                          </div>\n                        </div>\n\n                        {/* Divider Line */}\n                        <div className=\"w-[1px] bg-gray-200 self-stretch\"></div>\n\n                        {/* Transfer Progress (Left Side) */}\n                        <div className=\"flex-1\">\n                          <div className=\"flex justify-between text-xs mb-1 font-medium\">\n                            <span className=\"text-gray-700\"> </span>\n                            <span className=\"text-gray-600 dir-ltr\">{Math.max(dailyTransferLimit - predictedDailyTransferUsed, 0).toLocaleString('en-US', { maximumFractionDigits: 0 })} </span>\n                          </div>\n                          <div className=\"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50\">\n                            <div \n                              className=\"h-full bg-gradient-to-l from-green-500 to-green-600 rounded-full transition-all duration-500 ease-out\"\n                              style={{ width: `${Math.min(((predictedDailyTransferUsed / Math.max(dailyTransferLimit, 1)) * 100), 100)}%` }}\n                            />\n                          </div>\n                          <div className=\"flex justify-between mt-0.5\">\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {predictedDailyTransferUsed.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {dailyTransferLimit.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })()}\n\n              {transactionType === 'transfer' ? (\n                <>\n                  <div>\n                    <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                       \n                    </label>\n                    <div className=\"relative group\">\n                      <Phone className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-green-600 group-focus-within:text-green-700\" />\n                      <Input\n                        value={senderPhone}\n                        onChange={(e) => setSenderPhone(e.target.value)}\n                        onKeyDown={(e) => {\n                          if (e.key === 'Enter') {\n                            const dest = document.getElementById('receiverPhoneInput') as HTMLInputElement | null;\n                            if (dest) {\n                              dest.focus();\n                            } else {\n                              const amountEl = document.getElementById('amountInput') as HTMLInputElement | null;\n                              amountEl?.focus();\n                            }\n                          }\n                        }}\n                        placeholder=\"01030302038\"\n                        className=\"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-blue-600 focus:ring-1 focus:ring-blue-600\"\n                      />\n                    </div>\n                  </div>\n\n                  {!isVodafoneCashUser && (\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                         \n                      </label>\n                      <div className=\"relative group\">\n                        <Phone className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-green-600 group-focus-within:text-green-700\" />\n                        <Input\n                          id=\"receiverPhoneInput\"\n                          value={receiverPhone}\n                          onChange={(e) => {\n                            setReceiverPhone(e.target.value);\n                            if (isTransferSuccess) {\n                              setIsTransferSuccess(false);\n                            }\n                          }}\n                          onKeyDown={(e) => {\n                            if (e.key === 'Enter') {\n                              const next = document.getElementById('amountInput') as HTMLInputElement | null;\n                              next?.focus();\n                            }\n                          }}\n                          inputMode=\"numeric\"\n                          maxLength={11}\n                          placeholder=\"  \"\n                          className=\"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-blue-600 focus:ring-1 focus:ring-blue-600\"\n                        />\n                      </div>\n                    </div>\n                  )}\n                </>\n              ) : (\n                <div>\n                  <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                     \n                  </label>\n                  <div className=\"relative\">\n                    <Phone className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400\" />\n                    <Input\n                      value={selectedWallet ? wallets.find(w => w.id === selectedWallet)?.phone || '' : ''}\n                      readOnly\n                      placeholder=\"  \"\n                      className=\"pl-10 h-10 text-sm lg:text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl\"\n                    />\n                  </div>\n                </div>\n              )}\n\n              {transactionType === 'transfer' ? (\n                <>\n                  <div>\n                    <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                       ()\n                    </label>\n                    <div className=\"relative flex items-center gap-2 group\">\n                      <DollarSign className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-yellow-600 group-focus-within:text-yellow-700\" />\n                      <Input\n                        id=\"amountInput\"\n                        value={amount}\n                        onChange={(e) => {\n                          setAmount(e.target.value);\n                          if (isTransferSuccess) {\n                            setIsTransferSuccess(false);\n                          }\n                        }}\n                        onKeyDown={(e) => {\n                          if (e.key === 'Enter') {\n                            const commissionEl = document.getElementById('transferCommissionInput') as HTMLInputElement | null;\n                            if (commissionEl) {\n                              commissionEl.focus();\n                            } else {\n                              const quickBtn = document.getElementById('quickDebtButton') as HTMLButtonElement | null;\n                              quickBtn?.focus();\n                            }\n                          }\n                        }}\n                        placeholder=\" \"\n                        type=\"number\"\n                        className=\"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-blue-600 focus:ring-1 focus:ring-blue-600\"\n                      />\n\n                    </div>\n                    {quickDebtInfo ? (\n                      <div className=\"mt-2 text-xs text-green-700 bg-green-50 border border-green-200 rounded px-2 py-1 flex items-center gap-2\">\n                        <span>     {quickDebtInfo.debtorName}  {quickDebtInfo.amount} </span>\n                        <Button type=\"button\" variant=\"ghost\" size=\"sm\" className=\"h-6 px-2\" onClick={() => setQuickDebtInfo(null)}></Button>\n                      </div>\n                    ) : null}\n                  </div>\n\n                  {(() => {\n                    if (isVodafoneCashUser) return null;\n                    const sw = getSelectedWalletObj();\n                    const hasDefault = sw && sw.defaultTransferCommission != null;\n                    if (hasDefault) {\n                      return (\n                        <div>\n                          <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                              ()\n                          </label>\n                          <div className=\"text-xs text-gray-500 mt-1\">\n                                  : {sw?.defaultTransferCommission}   \n                          </div>\n                          <div className=\"mt-2 flex items-center gap-2\">\n                            <Button\n                              id=\"quickDebtButton\"\n                              type=\"button\"\n                              variant=\"destructive\"\n                              size=\"sm\"\n                              className=\"bg-red-600 hover:bg-red-700 text-white font-medium\"\n                              onClick={() => {\n                                const swInner = getSelectedWalletObj();\n                                const commissionPerThousand = swInner?.defaultTransferCommission != null\n                                  ? Number(swInner.defaultTransferCommission)\n                                  : 0;\n                                const baseAmount = parseFloat(amount || '0') || 0;\n                                const commissionCalc = Math.round((((commissionPerThousand || 0) * baseAmount) / 1000) * 100) / 100;\n                                const debtVal = baseAmount + commissionCalc;\n                                setQuickDebtAmount((debtVal || 0).toString());\n                                if (isZeroPlan) {\n                                  toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n                                } else {\n                                  setIsQuickDebtOpen(true);\n                                }\n                              }}\n                            >\n                              \n                            </Button>\n                            <Button\n                              type=\"button\"\n                              variant=\"outline\"\n                              size=\"icon\"\n                              className=\"hidden\"\n                              title={isCommissionAddMode ? ' ' : ' '}\n                            >\n                              {isCommissionAddMode ? <Plus className=\"h-4 w-4 text-green-600\" /> : <Minus className=\"h-4 w-4 text-red-600\" />}\n                            </Button>\n                            <span className=\"hidden\">\n                              {isCommissionAddMode ? ' ' : ' '}\n                            </span>\n                          </div>\n                        </div>\n                      );\n                    }\n                    return (\n                      <div>\n                        <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                              ()\n                        </label>\n                        <div className=\"flex items-center gap-2\">\n                          <div className=\"relative flex-1 group\">\n                            <DollarSign className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-yellow-600 group-focus-within:text-yellow-700\" />\n                            <Input\n                              id=\"transferCommissionInput\"\n                              value={transferCommission}\n                              onChange={(e) => setTransferCommission(e.target.value)\n                              }\n                              placeholder=\"  \"\n                              type=\"number\"\n                              className=\"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-orange-500 focus:ring-1 focus:ring-orange-500\"\n                            />\n                          </div>\n                          <Button\n                            type=\"button\"\n                            variant=\"destructive\"\n                            size=\"sm\"\n                            className=\"bg-red-600 hover:bg-red-700 text-white font-medium\"\n                            onClick={() => {\n                              const swInner = getSelectedWalletObj();\n                              const baseAmount = parseFloat(amount || '0') || 0;\n                              let commissionCalc = 0;\n                              if (swInner?.defaultTransferCommission != null) {\n                                const rate = Number(swInner.defaultTransferCommission) || 0;\n                                commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\n                              } else {\n                                const manualFixed = transferCommission && transferCommission.trim() !== '' ? parseFloat(transferCommission) : 0;\n                                commissionCalc = Math.max(0, manualFixed);\n                              }\n                              const debtVal = baseAmount + commissionCalc;\n                              setQuickDebtAmount((debtVal || 0).toString());\n                              if (isZeroPlan) {\n                                toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n                              } else {\n                                setIsQuickDebtOpen(true);\n                              }\n                            }}\n                          >\n                            \n                          </Button>\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            size=\"icon\"\n                            className=\"hidden\"\n                            title={isCommissionAddMode ? ' ' : ' '}\n                          >\n                            {isCommissionAddMode ? <Plus className=\"h-4 w-4 text-green-600\" /> : <Minus className=\"h-4 w-4 text-red-600\" />}\n                          </Button>\n                          <span className=\"hidden\">\n                            {isCommissionAddMode ? ' ' : ' '}\n                          </span>\n                        </div>\n                        <div className=\"text-xs text-gray-500 mt-1\">\n                               ()\n                        </div>\n                      </div>\n                    );\n                  })()}\n\n                  {(() => {\n                    const s = normalizeDigits(senderPhone || '').replace(/\\D/g, '');\n                    const r = normalizeDigits(receiverPhone || '').replace(/\\D/g, '');\n                    const showFee = transactionType === 'transfer' && (\n  (s.startsWith('010') && r.startsWith('010')) ||\n  (s.startsWith('010') && (r.startsWith('011') || r.startsWith('012') || r.startsWith('015'))) ||\n  (s.startsWith('012') && r.startsWith('010')) ||\n  (s.startsWith('011') && r.startsWith('010')) ||\n  (s.startsWith('015') && r.startsWith('010'))\n);\n                    if (!showFee) return null;\n                    return (\n                      <div>\n                        <label className=\"text-sm font-medium text-gray-700 mb-1 block\">  ()</label>\n                        <div className=\"relative\">\n                          <DollarSign className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-yellow-600\" />\n                          <Input\n                            id=\"transferExtraFeeInput\"\n                            value={transferExtraFee}\n                            onChange={(e) => setTransferExtraFee(e.target.value)}\n                            placeholder=\"  \"\n                            type=\"number\"\n                            className=\"pl-10 h-10 text-sm lg:text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white hover:border-blue-400 focus:border-blue-500\"\n                          />\n                        </div>\n                        <div className=\"hidden\">\n                                 010  011/012/015  012  010  011  010  015  010\n                        </div>\n                      </div>\n                    );\n                  })()}\n\n                  <div className=\"sticky bottom-0 z-20 pt-2 pb-2 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 backdrop-blur supports-[backdrop-filter]:bg-white/90 dark:supports-[backdrop-filter]:bg-gray-900/90\">\n                    <Button\n                      id=\"transferSubmitButton\"\n                      onClick={handleTransaction}\n                      className=\"w-full h-12 text-base font-medium rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-none hover:shadow-md\"\n                    >\n                      {isTransferSuccess ? \"  \" : \" \"}\n                    </Button>\n                    {/* Warning Row */}\n                    {isMonthlyLimitWarnOpen && (\n                      <div className=\"flex items-start gap-2 mt-2 px-1\">\n                        <AlertTriangle className=\"h-4 w-4 text-amber-500 shrink-0 mt-0.5\" />\n                        <p className=\"text-xs text-gray-500 leading-tight\">\n                             85%     {monthlyLimitWarnData?.walletName}\n                        </p>\n                      </div>\n                    )}\n                  </div>\n                </>\n              ) : (\n                <>\n                  <div>\n                    <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                        ()\n                    </label>\n                    <div className=\"relative group\">\n                      <ArrowDownLeft className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-primary\" />\n                      <Input\n                        id=\"amountInput\"\n                        value={amount}\n                        onChange={(e) => {\n                          setAmount(e.target.value);\n                          if (isWithdrawSuccess) {\n                            setIsWithdrawSuccess(false);\n                          }\n                        }}\n                        onKeyDown={(e) => {\n                          if (e.key === 'Enter') {\n                            const manualEl = document.getElementById('manualWithdrawCommissionInput') as HTMLInputElement | null;\n                            if (manualEl) {\n                              manualEl.focus();\n                            } else {\n                              const submitBtn = document.getElementById('withdrawSubmitButton') as HTMLButtonElement | null;\n                              submitBtn?.focus();\n                            }\n                          }\n                        }}\n                        placeholder=\"  \"\n                        type=\"number\"\n                        className=\"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-primary focus:ring-1 focus:ring-primary\"\n                      />\n                    </div>\n                  </div>\n\n                {isWithdrawSenderNameInputEnabled && (\n                  <div>\n                    <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                        ()\n                    </label>\n                    <div className=\"relative\">\n                      <User className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-500\" />\n                      <Input\n                        id=\"withdrawSenderNameInput\"\n                        value={withdrawSenderName}\n                        onChange={(e) => setWithdrawSenderName(e.target.value)}\n                        onKeyDown={(e) => {\n                          if (e.key === 'Enter') {\n                            const manualEl = document.getElementById('manualWithdrawCommissionInput') as HTMLInputElement | null;\n                            manualEl?.focus();\n                          }\n                        }}\n                        placeholder=\"    \"\n                        className=\"pl-10 h-10 text-sm lg:text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white hover:border-blue-400 focus:border-blue-500\"\n                        type=\"text\"\n                      />\n                    </div>\n                  </div>\n                )}\n\n                  {(() => {\n                    const sw = getSelectedWalletObj();\n                    const hasDefault = sw && sw.defaultWithdrawCommission != null;\n                    if (hasDefault) {\n                      return (\n                        <div>\n                          <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                              ()\n                          </label>\n                          <div className=\"text-xs text-gray-500 mt-1\">\n                                  : {sw?.defaultWithdrawCommission}   \n                          </div>\n                          <div className=\"mt-2 flex items-center gap-2\">\n                            <Button\n                            type=\"button\"\n                            variant=\"destructive\"\n                            size=\"sm\"\n                            className=\"bg-red-600 hover:bg-red-700 text-white font-medium\"\n                              onClick={() => {\n                                const swInner = getSelectedWalletObj();\n                                const baseAmount = parseFloat(amount || '0') || 0;\n                                const rate = swInner?.defaultWithdrawCommission != null ? Number(swInner.defaultWithdrawCommission) || 0 : 0;\n                                const commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\n                                const debtVal = isCommissionAddMode ? (baseAmount + commissionCalc) : baseAmount;\n                                setQuickDebtAmount((debtVal || 0).toString());\n                                if (isZeroPlan) {\n                                  toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n                                } else {\n                                  setIsQuickDebtOpen(true);\n                                }\n                              }}\n                            >\n                              \n                            </Button>\n                            <Button\n                              type=\"button\"\n                              variant=\"outline\"\n                              size=\"icon\"\n                              className=\"h-8 w-8\"\n                              onClick={() => setIsCommissionAddMode((prev) => !prev)}\n                              title={isCommissionAddMode ? '   ' : '   '}\n                            >\n                              {isCommissionAddMode ? (\n                                <Plus className=\"h-4 w-4\" />\n                              ) : (\n                                <Minus className=\"h-4 w-4\" />\n                              )}\n                            </Button>\n                            <span className=\"text-xs text-gray-600\">\n                              {isCommissionAddMode ? ' ' : ' '}\n                            </span>\n                          </div>\n                        </div>\n                      );\n                    }\n                    return (\n                      <div>\n                        <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                              ()\n                        </label>\n                        <div className=\"relative\">\n                          <DollarSign className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-yellow-600\" />\n                          <Input\n                            id=\"manualWithdrawCommissionInput\"\n                            value={manualCommission}\n                            onChange={(e) => setManualCommission(e.target.value)}\n                            onKeyDown={(e) => {\n                              if (e.key === 'Enter') {\n                                const submitBtn = document.getElementById('withdrawSubmitButton') as HTMLButtonElement | null;\n                                submitBtn?.focus();\n                              }\n                            }}\n                            placeholder=\"  \"\n                            type=\"number\"\n                            className=\"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white hover:border-blue-400 focus:border-blue-500\"\n                          />\n                        </div>\n                        <div className=\"text-xs text-gray-500 mt-1\">\n                               \n                        </div>\n                        <div className=\"mt-2 flex items-center gap-2\">\n                          <Button\n                            type=\"button\"\n                            variant=\"destructive\"\n                            size=\"sm\"\n                            className=\"bg-red-600 hover:bg-red-700 text-white font-medium\"\n                            onClick={() => {\n                              const swInner = getSelectedWalletObj();\n                              const baseAmount = parseFloat(amount || '0') || 0;\n                              let commissionCalc = 0;\n                              if (swInner?.defaultWithdrawCommission != null) {\n                                const rate = Number(swInner.defaultWithdrawCommission) || 0;\n                                commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\n                              } else {\n                                const manualFixed = manualCommission && manualCommission.trim() !== ''\n                                  ? parseFloat(manualCommission)\n                                  : Math.round((baseAmount * 0.01) * 100) / 100;\n                                commissionCalc = Math.max(0, manualFixed);\n                              }\n                              const debtVal = isCommissionAddMode ? (baseAmount + commissionCalc) : baseAmount;\n                              setQuickDebtAmount((debtVal || 0).toString());\n                              if (isZeroPlan) {\n                                toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n                              } else {\n                                setIsQuickDebtOpen(true);\n                              }\n                            }}\n                          >\n                            \n                          </Button>\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            size=\"icon\"\n                            title={isCommissionAddMode ? ' ' : ' '}\n                            onClick={() => setIsCommissionAddMode(prev => !prev)}\n                          >\n                            {isCommissionAddMode ? <Plus className=\"h-4 w-4 text-green-600\" /> : <Minus className=\"h-4 w-4 text-red-600\" />}\n                          </Button>\n                          <span className=\"text-xs text-gray-600\">\n                            {isCommissionAddMode ? ' ' : ' '}\n                          </span>\n                        </div>\n                      </div>\n                    );\n                  })()}\n\n                  {/*    */}\n                  {profile?.showWithdrawNote && (\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                          ()\n                      </label>\n                      <div className=\"relative group\">\n                        <MessageCircle className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-primary\" />\n                        <Input\n                          id=\"withdrawNoteInput\"\n                          value={withdrawNote}\n                          onChange={(e) => setWithdrawNote(e.target.value)}\n                          onKeyDown={(e) => {\n                            if (e.key === 'Enter') {\n                              const submitBtn = document.getElementById('withdrawSubmitButton') as HTMLButtonElement | null;\n                              submitBtn?.focus();\n                            }\n                          }}\n                          placeholder=\"   ()\"\n                          className=\"pl-10 h-10 text-base border-gray-400 rounded-xl focus:border-primary focus:ring-1 focus:ring-primary\"\n                        />\n                      </div>\n                    </div>\n                  )}\n\n                  <div className=\"sticky bottom-0 z-20 pt-2 pb-2 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 backdrop-blur supports-[backdrop-filter]:bg-white/90 dark:supports-[backdrop-filter]:bg-gray-900/90\">\n                    <Button\n                      id=\"withdrawSubmitButton\"\n                      onClick={handleTransaction}\n                      className=\"w-full font-medium h-11 lg:h-12 text-sm lg:text-base bg-green-600 hover:bg-green-700 text-white\"\n                    >\n                      {isWithdrawSuccess ? \"  \" : \" \"}\n                    </Button>\n                  </div>\n                </>\n              )}\n\n              {/*      */}\n              <Dialog open={isQuickDebtOpen} onOpenChange={setIsQuickDebtOpen}>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle> </DialogTitle>\n                    <DialogDescription>        </DialogDescription>\n                  </DialogHeader>\n                  <div className=\"space-y-3\">\n                    {customers && customers.length > 0 ? (\n                      <div>\n                        <Label> </Label>\n                        <Select value={quickDebtCustomerId} onValueChange={(val) => {\n                          setQuickDebtCustomerId(val);\n                          const selected = customers.find(c => c.id === val);\n                          if (selected) {\n                            setQuickDebtName(selected.name);\n                          }\n                        }}>\n                          <SelectTrigger className=\"w-full\">\n                            <SelectValue placeholder=\" \" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {customers.map(c => (\n                              <SelectItem key={c.id} value={c.id}>{c.name}{c.mobile ? `  ${c.mobile}` : ''}</SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    ) : (\n                      <div className=\"text-xs text-gray-500\">    .      .</div>\n                    )}\n                    <div>\n                      <Label htmlFor=\"quickDebtName\">  </Label>\n                      <Input id=\"quickDebtName\" value={quickDebtName} onChange={(e) => setQuickDebtName(e.target.value)} placeholder=\" \" />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"quickDebtAmount\"> ( )</Label>\n                      <Input id=\"quickDebtAmount\" type=\"number\" value={quickDebtAmount} readOnly placeholder=\" +  \" />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"quickDebtCommission\"> ( )</Label>\n                      <Input\n                        id=\"quickDebtCommission\"\n                        type=\"number\"\n                        value={(function () {\n                          const sw = getSelectedWalletObj();\n                          const baseAmount = parseFloat((amount || '0').toString()) || 0;\n                          let commissionCalc = 0;\n                          if (transactionType === 'transfer') {\n                            if (sw?.defaultTransferCommission != null) {\n                              const rate = Number(sw.defaultTransferCommission) || 0;\n                              commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\n                            } else {\n                              const manualFixed = transferCommission && transferCommission.trim() !== '' ? parseFloat(transferCommission) : 0;\n                              commissionCalc = Math.max(0, manualFixed);\n                            }\n                          } else {\n                            if (sw?.defaultWithdrawCommission != null) {\n                              const rate = Number(sw.defaultWithdrawCommission) || 0;\n                              commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\n                            } else {\n                              const manualFixed = manualCommission && manualCommission.trim() !== '' ? parseFloat(manualCommission) : Math.round((baseAmount * 0.01) * 100) / 100;\n                              commissionCalc = Math.max(0, manualFixed);\n                            }\n                          }\n                          return String(commissionCalc || 0);\n                        })()}\n                        readOnly\n                        placeholder=\" \"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"quickDebtNotes\"></Label>\n                      <Input id=\"quickDebtNotes\" value={quickDebtNotes} onChange={(e) => setQuickDebtNotes(e.target.value)} placeholder=\"  ()\" />\n                    </div>\n                  </div>\n                  <DialogFooter>\n                    <Button\n                      type=\"button\"\n                      variant=\"default\"\n                      className=\"bg-green-600 text-white hover:bg-green-700\"\n                      onClick={() => {\n                        const sw = getSelectedWalletObj();\n                        const baseAmount = parseFloat((amount || '').toString()) || 0;\n                        let commissionCalc = 0;\n                        if (transactionType === 'transfer') {\n                          if (sw?.defaultTransferCommission != null) {\n                            const rate = Number(sw.defaultTransferCommission) || 0;\n                            commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\n                          } else {\n                            const manualFixed = transferCommission && transferCommission.trim() !== '' ? parseFloat(transferCommission) : 0;\n                            commissionCalc = Math.max(0, manualFixed);\n                          }\n                        } else {\n                          if (sw?.defaultWithdrawCommission != null) {\n                            const rate = Number(sw.defaultWithdrawCommission) || 0;\n                            commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\n                          } else {\n                            const manualFixed = manualCommission && manualCommission.trim() !== '' ? parseFloat(manualCommission) : Math.round((baseAmount * 0.01) * 100) / 100;\n                            commissionCalc = Math.max(0, manualFixed);\n                          }\n                        }\n                        let amountToSave = 0;\n                        if (transactionType === 'withdraw') {\n                          amountToSave = isCommissionAddMode\n                            ? baseAmount\n                            : Math.max(0, Math.round((baseAmount - commissionCalc) * 100) / 100);\n                        } else {\n                          //       \n                          amountToSave = Math.max(0, Math.round((baseAmount + commissionCalc) * 100) / 100);\n                        }\n                        if (!quickDebtName || isNaN(amountToSave) || amountToSave <= 0) {\n                          toast({ title: '   ', description: '     ', variant: 'destructive' });\n                          return;\n                        }\n                        const selectedCustomer = customers.find(c => c.id === quickDebtCustomerId);\n                        //              \n                        setQuickDebtInfo({ debtorName: quickDebtName, amount: amountToSave, notes: quickDebtNotes, customerId: quickDebtCustomerId || undefined, mobile: selectedCustomer?.mobile });\n                        setDidCreateQuickDebt(false);\n                        setIsQuickDebtOpen(false);\n                        toast({ title: '   ', description: '     ', variant: 'default' });\n                      }}\n                    >\n                      \n                    </Button>\n                  </DialogFooter>\n                </DialogContent>\n              </Dialog>\n            </CardContent>\n          </Card>\n\n          {/* Quick Actions */}\n          <Card className=\"bg-gradient-to-br from-red-50 to-red-100 border-red-200 fade-in-up card-float\">\n            <CardContent className=\"p-3 text-center\">\n              <div className=\"text-red-600 font-medium text-[10px] mb-1\">\n                   \n              </div>\n              <div className=\"text-[10px] text-red-700\">\n                         \n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n\n      </div>\n\n      {/* Wallet Management Modal */}\n      <WalletManagement\n        isOpen={isWalletManagementOpen}\n        onClose={() => setIsWalletManagementOpen(false)}\n        initialEditingWallet={editingWalletForDropdown}\n        onWalletUpdate={async () => {\n          try {\n            await loadWalletsFromFirebase();\n          } catch (error) {\n            console.error('Error reloading wallets after update:', error);\n          }\n        }}\n      />\n\n      {/* Transaction Details Modal */}\n      <TransactionDetailsModal\n        isOpen={isTransactionDetailsOpen}\n        onClose={() => setIsTransactionDetailsOpen(false)}\n        transaction={selectedTransaction}\n        onDelete={handleDeleteTransaction}\n      />\n\n      {/* Master PIN Dialog for Reset */}\n      <MasterPinDialog\n        open={isResetDialogOpen}\n        onOpenChange={setIsResetDialogOpen}\n        onSuccess={handleResetSuccess}\n        title={getResetDialogTitle()}\n        description={getResetDialogDescription()}\n        mode=\"verify\"\n      />\n\n\n\n\n      {/* Edit Cash Balance Dialog */}\n      <EditBalanceDialog\n        open={isEditCashDialogOpen}\n        onOpenChange={setIsEditCashDialogOpen}\n        onSuccess={handleEditCashSuccess}\n        title=\"    \"\n        description=\"         \"\n        currentBalance={cashBalance}\n        balanceLabel=\" \"\n        userId={user?.uid}\n      />\n\n      {/* Edit Wallet Balance Dialog */}\n      <EditBalanceDialog\n        open={isEditWalletDialogOpen}\n        onOpenChange={setIsEditWalletDialogOpen}\n        onSuccess={handleEditWalletBalanceSuccess}\n        title=\"  \"\n        description=\"       \"\n        currentBalance={editingWalletId ? (walletBalances[editingWalletId] || 0) : 0}\n        balanceLabel={` ${wallets.find(w => w.id === editingWalletId)?.name || ''}`}\n        userId={user?.uid}\n      />\n\n      {/* Add To Wallet Dialog */}\n      <AddToWalletDialog\n        open={isAddToWalletDialogOpen}\n        onOpenChange={setIsAddToWalletDialogOpen}\n        onSuccess={handleAddToWalletSuccess}\n        title=\"      \"\n        description=\"          \"\n        currentBalance={editingWalletId ? (walletBalances[editingWalletId] || 0) : 0}\n        balanceLabel={` ${wallets.find(w => w.id === editingWalletId)?.name || ''}`}\n        userId={user?.uid}\n      />\n\n      {/* Change Pin Dialog */}\n      <ChangePinDialog\n        open={isChangePinDialogOpen}\n        onOpenChange={setIsChangePinDialogOpen}\n        userId={user?.uid}\n      />\n\n      {/* Change Cash Pin Dialog */}\n      <ChangeCashPinDialog\n        open={isChangeCashPinDialogOpen}\n        onOpenChange={setIsChangeCashPinDialogOpen}\n        userId={user?.uid}\n      />\n\n      {/* Change Wallet Total Pin Dialog */}\n      <ChangeWalletTotalPinDialog\n        open={isChangeWalletTotalPinDialogOpen}\n        onOpenChange={setIsChangeWalletTotalPinDialogOpen}\n      />\n\n      {/* Cash Amount Dialog */}\n      <Dialog open={isCashAmountDialogOpen} onOpenChange={setIsCashAmountDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\">  </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-1 py-4\">\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"amount\" className=\"text-right block\">\n                \n              </Label>\n              <div className=\"flex gap-2 items-center\">\n                <Input\n                  id=\"amount\"\n                  type=\"number\"\n                  placeholder=\" \"\n                  value={cashAmountInput}\n                  onChange={(e) => setCashAmountInput(e.target.value)}\n                  className=\"text-right flex-1\"\n                  dir=\"rtl\"\n                  min=\"0\"\n                />\n                <div className=\"flex gap-1\">\n                  <Button\n                    type=\"button\"\n                    size=\"sm\"\n                    className=\"bg-green-600 hover:bg-green-700 text-white px-3 py-2\"\n                    onClick={async () => {\n                      //    \n                      if (!(await verifyCashDrawerPin(cashPinInput))) {\n                        toast({\n                          title: \"\",\n                          description: \"   \",\n                          variant: \"destructive\",\n                        });\n                        return;\n                      }\n\n                      //    \n                      const amount = parseFloat(cashAmountInput);\n                      if (isNaN(amount) || amount <= 0) {\n                        toast({\n                          title: \"\",\n                          description: \"   \",\n                          variant: \"destructive\",\n                        });\n                        return;\n                      }\n\n                      //  \n                      const newBalance = cashBalance + amount;\n                      setCashBalance(newBalance);\n\n                      //    Firebase  timestamp\n                      const updateData = {\n                        cashBalance: newBalance,\n                        lastUpdated: new Date().toISOString()\n                      };\n\n                      //       \n                      const localDataKey = `userData_${user?.uid}`;\n                      localStorage.setItem(localDataKey, JSON.stringify(updateData));\n\n                      //   Firebase   \n                      if (user?.uid) {\n                        userDataService.updateUserData(user.uid, updateData)\n                          .then(() => {\n                            console.log('       Firebase ');\n                            //      \n                            localStorage.removeItem(localDataKey);\n                            setHasLocalDataToSync(false);\n                          })\n                          .catch(error => {\n                            console.error('      Firebase:', error);\n                            setHasLocalDataToSync(true);\n                            //       Firebase\n                          });\n                      } else {\n                        setHasLocalDataToSync(true);\n                      }\n\n                      toast({\n                        title: \" \",\n                        description: `  ${amount}       `,\n                      });\n\n                      setIsCashAmountDialogOpen(false);\n                      setCashAmountInput('');\n                      setCashPinInput('');\n                    }}\n                  >\n                    <Plus className=\"h-1 w-1 mr-1\" />\n                    \n                  </Button>\n                  <Button\n                    type=\"button\"\n                    size=\"sm\"\n                    className=\"bg-red-600 hover:bg-red-700 text-white px-3 py-2\"\n                    onClick={async () => {\n                      //    \n                      if (!(await verifyCashDrawerPin(cashPinInput))) {\n                        toast({\n                          title: \"\",\n                          description: \"   \",\n                          variant: \"destructive\",\n                        });\n                        return;\n                      }\n\n                      //    \n                      const amount = parseFloat(cashAmountInput);\n                      if (isNaN(amount) || amount <= 0) {\n                        toast({\n                          title: \"\",\n                          description: \"   \",\n                          variant: \"destructive\",\n                        });\n                        return;\n                      }\n\n                      //  \n                      const newBalance = cashBalance - amount;\n                      setCashBalance(newBalance);\n\n                      //    Firebase  timestamp\n                      const updateData = {\n                        cashBalance: newBalance,\n                        lastUpdated: new Date().toISOString()\n                      };\n\n                      //       \n                      const localDataKey = `userData_${user?.uid}`;\n                      localStorage.setItem(localDataKey, JSON.stringify(updateData));\n\n                      //   Firebase  \n                      if (user?.uid) {\n                        userDataService.updateUserData(user.uid, updateData)\n                          .then(() => {\n                            console.log('       Firebase ');\n                            localStorage.removeItem(localDataKey);\n                            setHasLocalDataToSync(false);\n                          })\n                          .catch(error => {\n                            console.error('      Firebase:', error);\n                            setHasLocalDataToSync(true);\n                          });\n                      } else {\n                        setHasLocalDataToSync(true);\n                      }\n\n                      toast({\n                        title: \" \",\n                        description: `  ${amount}       `,\n                      });\n\n                      setIsCashAmountDialogOpen(false);\n                      setCashAmountInput('');\n                      setCashPinInput('');\n                    }}\n                  >\n                    <Minus className=\"h-1 w-1 mr-1\" />\n                    \n                  </Button>\n                </div>\n              </div>\n              <p className=\"text-[10px] text-gray-500 text-right\">\n                 : {cashBalance.toLocaleString()} \n              </p>\n            </div>\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"pin\" className=\"text-right block\">\n                 \n              </Label>\n              <Input\n                id=\"pin\"\n                type=\"password\"\n                placeholder=\"  \"\n                value={cashPinInput}\n                onChange={(e) => setCashPinInput(e.target.value)}\n                className=\"text-right\"\n                dir=\"rtl\"\n              />\n            </div>\n          </div>\n          <DialogFooter className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsCashAmountDialogOpen(false);\n                setCashAmountInput('');\n                setCashPinInput('');\n              }}\n            >\n              \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n\n\n      {/* Reset Wallet Total Dialog */}\n      <Dialog open={isResetWalletTotalDialogOpen} onOpenChange={setIsResetWalletTotalDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right text-red-600\">  </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-1 py-4\">\n            <div className=\"text-center p-4 bg-red-50 rounded-lg border border-red-200\">\n              <p className=\"text-red-800 font-medium mb-2\">!</p>\n              <p className=\"text-red-700 text-sm\">\n                      .      .\n              </p>\n              <p className=\"text-red-600 text-sm mt-2\">\n                 : {Object.values(walletBalances).reduce((sum, balance) => sum + balance, 0).toLocaleString()} \n              </p>\n            </div>\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"resetWalletTotalPin\" className=\"text-right block\">\n                  \n              </Label>\n              <Input\n                id=\"resetWalletTotalPin\"\n                type=\"password\"\n                placeholder=\"   \"\n                value={resetWalletTotalPinInput}\n                onChange={(e) => setResetWalletTotalPinInput(e.target.value)}\n                className=\"text-right\"\n                dir=\"rtl\"\n              />\n            </div>\n          </div>\n          <DialogFooter className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsResetWalletTotalDialogOpen(false);\n                setResetWalletTotalPinInput('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={async () => {\n                //     \n                const isValid = await MasterPinService.verifyMasterPin(resetWalletTotalPinInput, user?.uid);\n                if (!isValid) {\n                  toast({\n                    title: \"\",\n                    description: \"   \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                try {\n                  //    \n                  const updatedBalances: { [key: string]: number } = {};\n                  Object.keys(walletBalances).forEach(walletId => {\n                    updatedBalances[walletId] = 0;\n                  });\n\n                  //     \n                  setWalletBalances(updatedBalances);\n                  localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n\n                  //     \n                  setIsResetWalletTotalDialogOpen(false);\n                  setResetWalletTotalPinInput('');\n\n                  //    \n                  // toast({\n                  //   title: \"  \",\n                  //   description: \"      \",\n                  // });\n\n                  //   Firebase     \n                  const timestamp = new Date().toISOString();\n                  const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp } as any;\n                  const localDataKey = `userData_${user?.uid}`;\n                  localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                  if (user?.uid) {\n                    userDataService.updateUserData(user.uid, updateData)\n                      .then(() => {\n                        localStorage.removeItem(localDataKey);\n                        setHasLocalDataToSync(false);\n                      })\n                      .catch(error => {\n                        console.error('      Firebase:', error);\n                        setHasLocalDataToSync(true);\n                        toast({\n                          title: \"\",\n                          description: \"       \",\n                          variant: \"default\",\n                        });\n                      });\n                  } else {\n                    setHasLocalDataToSync(true);\n                  }\n\n                  //    \n                  setTimeout(() => {\n                    setWalletBalances({ ...updatedBalances });\n                  }, 100);\n\n                } catch (error) {\n                  console.error('    :', error);\n                  toast({\n                    title: \"\",\n                    description: \"    \",\n                    variant: \"destructive\",\n                  });\n                }\n              }}\n            >\n               \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Reset Selected Wallet Dialog */}\n      <Dialog open={isResetSelectedWalletDialogOpen} onOpenChange={setIsResetSelectedWalletDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right text-red-600\">   </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-1 py-4\">\n            <div className=\"text-center p-4 bg-red-50 rounded-lg border border-red-200\">\n              <p className=\"text-red-800 font-medium mb-2\">!</p>\n              <p className=\"text-red-700 text-sm\">\n                      .      .\n              </p>\n              <p className=\"text-red-600 text-sm mt-2\">\n                : {wallets.find(w => w.id === selectedWallet)?.name || selectedWallet}\n              </p>\n              <p className=\"text-red-600 text-sm\">\n                 : {(selectedWallet && walletBalances[selectedWallet] ? walletBalances[selectedWallet] : 0).toLocaleString()} \n              </p>\n            </div>\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"resetSelectedWalletPin\" className=\"text-right block\">\n                  \n              </Label>\n              <Input\n                id=\"resetSelectedWalletPin\"\n                type=\"password\"\n                autoComplete=\"off\"\n                placeholder=\"   \"\n                value={resetSelectedWalletPinInput}\n                onChange={(e) => setResetSelectedWalletPinInput(e.target.value)}\n                className=\"text-right\"\n                dir=\"rtl\"\n              />\n            </div>\n          </div>\n          <DialogFooter className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsResetSelectedWalletDialogOpen(false);\n                setResetSelectedWalletPinInput('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={async () => {\n                if (!selectedWallet) {\n                  toast({ title: ' ', description: '   ', variant: 'destructive' });\n                  return;\n                }\n                //     \n                const isValid = await MasterPinService.verifyMasterPin(resetSelectedWalletPinInput, user?.uid);\n                if (!isValid) {\n                  toast({\n                    title: '',\n                    description: '   ',\n                    variant: 'destructive',\n                  });\n                  return;\n                }\n\n                try {\n                  //    \n                  const updatedBalances: { [key: string]: number } = { ...walletBalances };\n                  updatedBalances[selectedWallet] = 0;\n\n                  //    \n                  setWalletBalances(updatedBalances);\n                  localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n\n                  //     \n                  setIsResetSelectedWalletDialogOpen(false);\n                  setResetSelectedWalletPinInput('');\n\n                  //   Firebase     \n                  const timestamp = new Date().toISOString();\n                  const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp } as any;\n                  const localDataKey = `userData_${user?.uid}`;\n                  localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                  if (user?.uid) {\n                    userDataService.updateUserData(user.uid, updateData)\n                      .then(() => {\n                        localStorage.removeItem(localDataKey);\n                        setHasLocalDataToSync(false);\n                      })\n                      .catch(error => {\n                        console.error('      Firebase:', error);\n                        setHasLocalDataToSync(true);\n                        toast({\n                          title: '',\n                          description: '       ',\n                          variant: 'default',\n                        });\n                      });\n                  } else {\n                    setHasLocalDataToSync(true);\n                  }\n\n                  toast({\n                    title: '  ',\n                    description: `    ${wallets.find(w => w.id === selectedWallet)?.name || selectedWallet}`,\n                  });\n                } catch (error) {\n                  console.error('     :', error);\n                  toast({\n                    title: '',\n                    description: '      ',\n                    variant: 'destructive',\n                  });\n                }\n              }}\n            >\n               \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <WalletPrinterDialog \n        isOpen={isWalletPrinterDialogOpen} \n        onClose={() => setIsWalletPrinterDialogOpen(false)}\n        wallets={wallets}\n      />\n\n      {/*      */}\n      <Dialog open={isAddWalletTotalDialogOpen} onOpenChange={setIsAddWalletTotalDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right text-green-600 flex items-center gap-2 justify-end\">\n              <Plus className=\"h-4 w-4\" />\n                 \n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"text-center p-4 bg-green-50 rounded-lg border border-green-200\">\n              <p className=\"text-green-800 font-medium mb-2\"> </p>\n              <p className=\"text-green-700 text-sm\">\n                           .\n              </p>\n              <p className=\"text-green-600 text-sm mt-2\">\n                 : {Object.values(walletBalances).reduce((sum, balance) => sum + balance, 0).toLocaleString()} \n              </p>\n            </div>\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"addWalletTotalAmount\" className=\"text-right block\">\n                    \n                </Label>\n                <Input\n                  id=\"addWalletTotalAmount\"\n                  type=\"number\"\n                  placeholder=\" \"\n                  value={addWalletTotalAmountInput}\n                  onChange={(e) => setAddWalletTotalAmountInput(e.target.value)}\n                  className=\"text-right\"\n                  dir=\"rtl\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"addWalletTotalPin\" className=\"text-right block\">\n                    \n                </Label>\n                <Input\n                  id=\"addWalletTotalPin\"\n                  type=\"password\"\n                  autoComplete=\"off\"\n                  placeholder=\"  \"\n                  value={addWalletTotalPinInput}\n                  onChange={(e) => setAddWalletTotalPinInput(e.target.value)}\n                  className=\"text-right\"\n                  dir=\"rtl\"\n                />\n              </div>\n            </div>\n          </div>\n          <DialogFooter className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsAddWalletTotalDialogOpen(false);\n                setAddWalletTotalAmountInput('');\n                setAddWalletTotalPinInput('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              variant=\"default\"\n              className=\"bg-green-600 hover:bg-green-700\"\n              disabled={isAddingWalletTotal}\n              onClick={async () => {\n                //    \n                const amount = parseFloat(addWalletTotalAmountInput);\n                if (!amount || amount <= 0) {\n                  toast({\n                    title: \"\",\n                    description: \"   \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                //    \n                if (!(await verifyWalletTotalPin(addWalletTotalPinInput))) {\n                  toast({\n                    title: \"\",\n                    description: \"   \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                setIsAddingWalletTotal(true);\n\n                try {\n                  //    \n                  const currentTotal = Object.values(walletBalances).reduce((sum, balance) => sum + balance, 0);\n\n                  //        \n                  if (currentTotal === 0) {\n                    const walletIds = Object.keys(walletBalances);\n                    const amountPerWallet = amount / walletIds.length;\n                    const updatedBalances: { [key: string]: number } = {};\n\n                    walletIds.forEach(walletId => {\n                      updatedBalances[walletId] = amountPerWallet;\n                    });\n\n                    //     localStorage\n                    setWalletBalances(updatedBalances);\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n\n                    //   Firebase  \n                    if (user?.uid) {\n                      await userDataService.updateUserData(user.uid, { walletBalances: updatedBalances, lastUpdated: new Date().toISOString() });\n                    } else {\n                      setHasLocalDataToSync(true);\n                    }\n                  } else {\n                    //      \n                    const updatedBalances: { [key: string]: number } = {};\n\n                    Object.entries(walletBalances).forEach(([walletId, balance]) => {\n                      const ratio = balance / currentTotal;\n                      const additionalAmount = amount * ratio;\n                      updatedBalances[walletId] = balance + additionalAmount;\n                    });\n\n                    //     localStorage\n                    setWalletBalances(updatedBalances);\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n\n                    //   Firebase  \n                    if (user?.uid) {\n                      await userDataService.updateUserData(user.uid, { walletBalances: updatedBalances, lastUpdated: new Date().toISOString() });\n                    } else {\n                      setHasLocalDataToSync(true);\n                    }\n                  }\n\n                  //    \n                  setTimeout(() => {\n                    setWalletBalances(prev => ({ ...prev }));\n                  }, 100);\n\n                  // toast({\n                  //   title: \"   \",\n                  //   description: `  ${amount.toLocaleString()}    `,\n                  // });\n\n                  //    \n                  setIsAddWalletTotalDialogOpen(false);\n                  setAddWalletTotalAmountInput('');\n                  setAddWalletTotalPinInput('');\n                } catch (error) {\n                  console.error('      Firebase:', error);\n                  toast({\n                    title: \"\",\n                    description: \"    \",\n                    variant: \"destructive\",\n                  });\n                } finally {\n                  setIsAddingWalletTotal(false);\n                }\n              }}\n            >\n              {isAddingWalletTotal ? \" ...\" : \" \"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*     */}\n      <Dialog open={isResetCashDialogOpen} onOpenChange={setIsResetCashDialogOpen}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-red-600 flex items-center gap-2\">\n              <Trash2 className=\"h-1 w-1\" />\n                \n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-1\">\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\n              <p className=\"text-sm text-red-700\">\n                 :        .      .\n              </p>\n            </div>\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"resetCashPin\">  </Label>\n              <Input\n                id=\"resetCashPin\"\n                type=\"password\"\n                autoComplete=\"off\"\n                placeholder=\"   \"\n                value={resetCashPinInput}\n                onChange={(e) => setResetCashPinInput(e.target.value)}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsResetCashDialogOpen(false);\n                setResetCashPinInput('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={async () => {\n                if (!resetCashPinInput) {\n                  toast({\n                    title: \"\",\n                    description: \"   \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                const isValid = await MasterPinService.verifyMasterPin(resetCashPinInput, user?.uid);\n                if (!isValid) {\n                  toast({\n                    title: \"\",\n                    description: \"   \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                try {\n                  //    \n                  setCashBalance(0);\n\n                  //     \n                  setIsResetCashDialogOpen(false);\n                  setResetCashPinInput('');\n\n                  //    \n                  // toast({\n                  //   title: \"  \",\n                  //   description: \"       \",\n                  // });\n\n                  //     \n                  const updateData = { cashBalance: 0, lastUpdated: new Date().toISOString() };\n                  localStorage.setItem(getCashBalanceKey(), '0');\n                  localStorage.setItem(getCashBalanceKey() + '_lastUpdated', updateData.lastUpdated);\n                  const localDataKey = `userData_${user?.uid}`;\n                  localStorage.setItem(localDataKey, JSON.stringify(updateData));\n\n                  //   Firebase    fallback\n                  if (user?.uid) {\n                    userDataService.updateUserData(user.uid, updateData)\n                      .then(() => {\n                        localStorage.removeItem(localDataKey);\n                        setHasLocalDataToSync(false);\n                      })\n                      .catch(error => {\n                        console.error('     Firebase:', error);\n                        setHasLocalDataToSync(true);\n                        toast({\n                          title: \"\",\n                          description: \"       \",\n                          variant: \"default\",\n                        });\n                      });\n                  } else {\n                    setHasLocalDataToSync(true);\n                  }\n\n                } catch (error) {\n                  console.error('    :', error);\n                  toast({\n                    title: \"\",\n                    description: \"     \",\n                    variant: \"destructive\",\n                  });\n                }\n              }}\n            >\n               \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Cash Summary Dialog */}\n      <CashSummaryDialog\n        open={isCashSummaryOpen}\n        onOpenChange={setIsCashSummaryOpen}\n        userId={user?.uid}\n        cashBalance={cashBalance}\n        walletBalances={walletBalances}\n        transactions={transactions}\n      />\n\n      {/*     */}\n      <Dialog open={isAddCashDialogOpen} onOpenChange={setIsAddCashDialogOpen}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-green-600 flex items-center gap-2\">\n              <Plus className=\"h-4 w-4\" />\n                \n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"bg-green-50 border border-green-200 rounded-lg p-3\">\n              <p className=\"text-sm text-green-700\">\n                         \n              </p>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"addCashAmount\">  </Label>\n              <Input\n                id=\"addCashAmount\"\n                type=\"number\"\n                placeholder=\" \"\n                value={addCashAmountInput}\n                onChange={(e) => setAddCashAmountInput(e.target.value)}\n                min=\"0\"\n                step=\"0.01\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label className=\"text-right\">   </Label>\n              <div className=\"flex gap-2\">\n                <Button type=\"button\" variant={addCashNoteEnabled === 'yes' ? 'default' : 'outline'} onClick={() => setAddCashNoteEnabled('yes')} className=\"flex-1\"></Button>\n                <Button\n                  type=\"button\"\n                  variant={addCashNoteEnabled === 'no' ? 'default' : 'outline'}\n                  onClick={async () => {\n                    setAddCashNoteEnabled('no');\n                    if (!addCashAmountInput || parseFloat(addCashAmountInput) <= 0) {\n                      toast({ title: '', description: '      ', variant: 'destructive' });\n                      return;\n                    }\n                    if (!addCashPinInput) {\n                      toast({ title: '', description: '   ', variant: 'destructive' });\n                      return;\n                    }\n                    if (!(await verifyCashDrawerPin(addCashPinInput))) {\n                      toast({ title: '', description: '   ', variant: 'destructive' });\n                      return;\n                    }\n                    setIsAddingCash(true);\n                    try {\n                      const amountToAdd = parseFloat(addCashAmountInput);\n                      const newCashBalance = cashBalance + amountToAdd;\n                      setCashBalance(newCashBalance);\n                      const timestamp = new Date().toISOString();\n                      localStorage.setItem(getCashBalanceKey(), newCashBalance.toString());\n                      localStorage.setItem(getCashBalanceKey() + '_lastUpdated', timestamp);\n                      const updateData = { cashBalance: newCashBalance, lastUpdated: timestamp };\n                      const localDataKey = `userData_${user?.uid}`;\n                      localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                      const receiptRef = `CASHADD-${user?.uid || 'anon'}-${Date.now()}`;\n                      setIsAddCashDialogOpen(false);\n                      setAddCashAmountInput('');\n                      setAddCashPinInput('');\n                      setAddCashNoteEnabled(null);\n                      setAddCashNoteText('');\n                      const ops: Array<Promise<any>> = [];\n                      if (user?.uid) {\n                        ops.push(userDataService.updateUserData(user.uid, updateData).then(() => { localStorage.removeItem(localDataKey); setHasLocalDataToSync(false); }).catch(() => { setHasLocalDataToSync(true); }));\n                        const txToCloud: any = { txnType: 'cash_addition', type: 'cash_addition', amount: amountToAdd, status: 'confirmed', senderMsisdn: ' ', receiverMsisdn: '', reference: receiptRef, title: '  ', merchantUserId: user.uid, createdBy: user.uid, shopId: (profile as any)?.shopId || undefined };\n                        ops.push(userDataService.saveUserTransaction(user.uid, txToCloud));\n                        const shopId = (profile as any)?.shopId;\n                        if (shopId) {\n                          const dataRef = doc(db, 'dashboardData', shopId);\n                          ops.push(updateDoc(dataRef, { cashBalance: newCashBalance }));\n                        }\n                      }\n                      Promise.allSettled(ops).then(() => { }).catch(() => { });\n                    } catch (error) {\n                      setCashBalance(cashBalance);\n                      localStorage.setItem('cashBalance', cashBalance.toString());\n                      toast({ title: '', description: '        ', variant: 'destructive' });\n                    } finally {\n                      setIsAddingCash(false);\n                    }\n                  }}\n                  className=\"flex-1\"\n                >\n                  \n                </Button>\n              </div>\n            </div>\n            {addCashNoteEnabled === 'yes' && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"addCashNote\"></Label>\n                <Input id=\"addCashNote\" type=\"text\" placeholder=\" \" value={addCashNoteText} onChange={(e) => setAddCashNoteText(e.target.value)} />\n              </div>\n            )}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"addCashPin\">   </Label>\n              <Input\n                id=\"addCashPin\"\n                type=\"password\"\n                placeholder=\"  \"\n                value={addCashPinInput}\n                onChange={(e) => setAddCashPinInput(e.target.value)}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsAddCashDialogOpen(false);\n                setAddCashAmountInput('');\n                setAddCashPinInput('');\n                setAddCashNoteEnabled(null);\n                setAddCashNoteText('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              variant=\"default\"\n              className=\"bg-green-600 hover:bg-green-700\"\n              disabled={isAddingCash}\n              onClick={async () => {\n                //    \n                if (!addCashAmountInput || parseFloat(addCashAmountInput) <= 0) {\n                  toast({\n                    title: \"\",\n                    description: \"      \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                if (!addCashPinInput) {\n                  toast({\n                    title: \"\",\n                    description: \"   \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                if (!(await verifyCashDrawerPin(addCashPinInput))) {\n                  toast({\n                    title: \"\",\n                    description: \"   \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                if (addCashNoteEnabled === 'yes' && addCashNoteText.trim().length === 0) {\n                  toast({ title: '', description: '    ', variant: 'destructive' });\n                  return;\n                }\n\n                setIsAddingCash(true);\n                try {\n                  const amountToAdd = parseFloat(addCashAmountInput);\n                  const newCashBalance = cashBalance + amountToAdd;\n                  setCashBalance(newCashBalance);\n                  const timestamp = new Date().toISOString();\n                  localStorage.setItem(getCashBalanceKey(), newCashBalance.toString());\n                  localStorage.setItem(getCashBalanceKey() + '_lastUpdated', timestamp);\n                  const updateData = { cashBalance: newCashBalance, lastUpdated: timestamp };\n                  const localDataKey = `userData_${user?.uid}`;\n                  localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                  const receiptRef = `CASHADD-${user?.uid || 'anon'}-${Date.now()}`;\n                  setIsAddCashDialogOpen(false);\n                  setAddCashAmountInput('');\n                  setAddCashPinInput('');\n                  setAddCashNoteEnabled(null);\n                  setAddCashNoteText('');\n                  const ops: Array<Promise<any>> = [];\n                  if (user?.uid) {\n                    ops.push(userDataService.updateUserData(user.uid, updateData).then(() => { localStorage.removeItem(localDataKey); setHasLocalDataToSync(false); }).catch(() => { setHasLocalDataToSync(true); }));\n                    const txToCloud: any = { txnType: 'cash_addition', type: 'cash_addition', amount: amountToAdd, status: 'confirmed', senderMsisdn: ' ', receiverMsisdn: '', reference: receiptRef, note: addCashNoteEnabled === 'yes' ? addCashNoteText.trim() : undefined, title: '  ', merchantUserId: user.uid, createdBy: user.uid, shopId: (profile as any)?.shopId || undefined };\n                    ops.push(userDataService.saveUserTransaction(user.uid, txToCloud));\n                    const shopId = (profile as any)?.shopId;\n                    if (shopId) {\n                      const dataRef = doc(db, 'dashboardData', shopId);\n                      ops.push(updateDoc(dataRef, { cashBalance: newCashBalance }));\n                    }\n                  }\n                  Promise.allSettled(ops).then(() => { }).catch(() => { });\n                } catch (error) {\n                  setCashBalance(cashBalance);\n                  localStorage.setItem('cashBalance', cashBalance.toString());\n                  toast({ title: '', description: '        ', variant: 'destructive' });\n                } finally {\n                  setIsAddingCash(false);\n                }\n              }}\n            >\n              {isAddingCash ? \" ...\" : \" \"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*     */}\n      <Dialog open={isDatePickerOpen} onOpenChange={setIsDatePickerOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\">   </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-1 py-4\">\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"search-date\" className=\"text-right block\"></Label>\n              <Input\n                id=\"search-date\"\n                type=\"date\"\n                value={selectedDate}\n                onChange={(e) => setSelectedDate(e.target.value)}\n                className=\"text-right\"\n              />\n            </div>\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"search-time\" className=\"text-right block\"> ()</Label>\n              <Input\n                id=\"search-time\"\n                type=\"time\"\n                value={selectedTime}\n                onChange={(e) => setSelectedTime(e.target.value)}\n                className=\"text-right\"\n                placeholder=\"     \"\n              />\n              <p className=\"text-[10px] text-gray-500 text-right\">\n                         \n              </p>\n            </div>\n          </div>\n          <DialogFooter className=\"flex justify-between\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setSelectedDate('');\n                setSelectedTime('');\n                setIsDatePickerOpen(false);\n              }}\n            >\n              \n            </Button>\n            <Button onClick={() => setIsDatePickerOpen(false)}>\n              \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n\n\n      {/*       */}\n\n      {/*   */}\n      <CalculatorDialog\n        isOpen={isCalculatorOpen}\n        onClose={() => setIsCalculatorOpen(false)}\n      />\n\n      {/*    */}\n      <SalesDataDialog\n        isOpen={isSalesDataOpen}\n        onClose={() => setIsSalesDataOpen(false)}\n        initialBarcode={pendingBarcode}\n      />\n\n      {/*    */}\n      <CreditCardsDialog\n        isOpen={isCreditCardsOpen}\n        onClose={() => setIsCreditCardsOpen(false)}\n      />\n\n      {/*   */}\n      <MaintenanceDialog\n        open={isMaintenanceOpen}\n        onOpenChange={setIsMaintenanceOpen}\n      />\n\n      {/*    */}\n      <MachineDailyDialog\n        open={isMachineDailyDialogOpen}\n        onOpenChange={(open) => {\n          if (open && !isShiftHandoverAllowed) {\n            toast({\n              title: ' ',\n              description: '   :      .',\n              variant: 'destructive'\n            });\n            return;\n          }\n          setIsMachineDailyDialogOpen(open);\n        }}\n      />\n\n      {/*    */}\n      <CashierShiftModal\n        open={isCashierModalOpen}\n        onOpenChange={(open) => {\n          if (open && !isShiftHandoverAllowed) {\n            toast({\n              title: ' ',\n              description: '   :      .   .',\n              variant: 'destructive'\n            });\n            return;\n          }\n          setIsCashierModalOpen(open);\n        }}\n      />\n\n      {/*    */}\n      <ShiftProfileDialog\n        open={isShiftProfileOpen}\n        onOpenChange={(open) => {\n          if (open && !isShiftHandoverAllowed) {\n            toast({\n              title: ' ',\n              description: '   :      .   .',\n              variant: 'destructive'\n            });\n            return;\n          }\n          setIsShiftProfileOpen(open);\n        }}\n      />\n\n      {/*  -      */}\n      <MasterPinDialog\n        open={isReportsPinOpen}\n        onOpenChange={setIsReportsPinOpen}\n        onSuccess={() => setIsYourReportsOpen(true)}\n        title=\"\"\n        description=\"      \"\n        mode=\"verify\"\n      />\n\n      <Dialog open={isYourReportsOpen} onOpenChange={setIsYourReportsOpen}>\n        <DialogContent className=\"sm:max-w-xl\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <BarChart className=\"h-4 w-4 text-blue-600\" />\n               \n            </DialogTitle>\n            <DialogDescription>\n                   30     \n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {(() => {\n              const todayStr = new Date().toDateString();\n              const todayTx = transactions.filter((t: any) => {\n                const dt = new Date(t.createdAt).toDateString();\n                const st = String(t.status || 'completed').toLowerCase();\n                return dt === todayStr && (st === 'completed' || st === 'confirmed');\n              });\n              const totalTransactions = todayTx.length;\n              const totalAmount = todayTx.reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\n              const totalWithdrawn = todayTx.filter((t: any) => t.type === 'withdraw').reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\n              const totalSent = todayTx.filter((t: any) => t.type === 'send').reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\n              const profit = todayTx.reduce((s: number, t: any) => s + Number(reportsService.calculateTransactionProfit(t) || 0), 0);\n              return (\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div className=\"rounded-lg p-3 bg-gradient-to-r from-blue-50 to-slate-100 border\">\n                    <div className=\"text-xs text-blue-700\"> </div>\n                    <div className=\"text-lg font-bold text-blue-800\">{totalTransactions}</div>\n                  </div>\n                  <div className=\"rounded-lg p-3 bg-gradient-to-r from-indigo-50 to-slate-100 border\">\n                    <div className=\"text-xs text-indigo-700\"> </div>\n                    <div className=\"text-lg font-bold text-indigo-800\">{Number(totalAmount).toFixed(2)}</div>\n                  </div>\n                  <div className=\"rounded-lg p-3 bg-gradient-to-r from-red-50 to-slate-100 border\">\n                    <div className=\"text-xs text-red-700\"> </div>\n                    <div className=\"text-lg font-bold text-red-800\">{Number(totalWithdrawn).toFixed(2)}</div>\n                  </div>\n                  <div className=\"rounded-lg p-3 bg-gradient-to-r from-green-50 to-slate-100 border\">\n                    <div className=\"text-xs text-green-700\"> </div>\n                    <div className=\"text-lg font-bold text-green-800\">{Number(totalSent).toFixed(2)}</div>\n                  </div>\n                  <div className=\"col-span-2 rounded-lg p-3 bg-gradient-to-r from-amber-50 to-slate-100 border\">\n                    <div className=\"text-xs text-amber-700\"></div>\n                    <div className=\"text-lg font-bold text-amber-800\">{Number(profit).toFixed(2)}</div>\n                  </div>\n                </div>\n              );\n            })()}\n            <div className=\"flex items-center justify-between\">\n              <Button\n                variant=\"default\"\n                onClick={async () => {\n                  try {\n                    if (!user?.uid) return;\n                    const today = new Date();\n                    const yyyy = today.getFullYear();\n                    const mm = String(today.getMonth() + 1).padStart(2, '0');\n                    const dd = String(today.getDate()).padStart(2, '0');\n                    const reportDate = `${yyyy}-${mm}-${dd}`;\n                    const todayStr = today.toDateString();\n                    const todayTx = transactions.filter((t: any) => {\n                      const dt = new Date(t.createdAt).toDateString();\n                      const st = String(t.status || 'completed').toLowerCase();\n                      return dt === todayStr && (st === 'completed' || st === 'confirmed');\n                    });\n                    const totalTransactions = todayTx.length;\n                    const totalAmount = todayTx.reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\n                    const totalWithdrawn = todayTx.filter((t: any) => t.type === 'withdraw').reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\n                    const totalSent = todayTx.filter((t: any) => t.type === 'send').reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\n                    const profit = todayTx.reduce((s: number, t: any) => s + Number(reportsService.calculateTransactionProfit(t) || 0), 0);\n                    await dailyReportsArchiveService.add({\n                      userId: user.uid,\n                      reportDate,\n                      totalTransactions,\n                      totalAmount: Number(totalAmount.toFixed(2)),\n                      totalWithdrawn: Number(totalWithdrawn.toFixed(2)),\n                      totalSent: Number(totalSent.toFixed(2)),\n                      profit: Number(profit.toFixed(2)),\n                      walletId: null\n                    });\n                    try { await dailyReportsArchiveService.trimToMaxCount(user.uid, 30); } catch { }\n                    toast({ title: ' ', description: `   ${reportDate}` });\n                  } catch (e) {\n                    toast({ title: ' ', description: '  ', variant: 'destructive' });\n                  }\n                }}\n              >\n                 \n              </Button>\n              <Button variant=\"outline\" onClick={() => setIsYourReportsOpen(false)}></Button>\n            </div>\n            <div className=\"mt-2 border-t pt-2\">\n              <div className=\"space-y-2 max-h-[40vh] overflow-auto\">\n                {reportArchives.length === 0 ? (\n                  <div className=\"text-xs text-muted-foreground\">   </div>\n                ) : (\n                  reportArchives.map((a) => (\n                    <div key={a.id || `${a.userId}-${a.reportDate}`} className=\"border rounded-md p-2 bg-gradient-to-r from-white/80 to-blue-50/70\">\n                      <div className=\"flex justify-between items-center\">\n                        <div className=\"font-bold text-blue-800\">{a.reportDate}</div>\n                        <div className=\"text-xs text-blue-700\"> : {a.totalTransactions}</div>\n                      </div>\n                      <div className=\"grid grid-cols-2 gap-2 mt-1\">\n                        <div className=\"text-xs text-blue-800\"> : <span className=\"font-semibold\">{Number(a.totalAmount).toFixed(2)}</span></div>\n                        <div className=\"text-xs text-blue-800\">: <span className=\"font-semibold\">{Number(a.totalWithdrawn).toFixed(2)}</span></div>\n                        <div className=\"text-xs text-blue-800\">: <span className=\"font-semibold\">{Number(a.totalSent).toFixed(2)}</span></div>\n                        <div className=\"text-xs text-blue-800\">: <span className=\"font-semibold\">{Number(a.profit ?? 0).toFixed(2)}</span></div>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/*    -   */}\n      <Dialog open={isTopUpOpen} onOpenChange={(open) => {\n        if (open) {\n          toast({ title: ' ', description: '    .' });\n          return;\n        }\n        setIsTopUpOpen(false);\n      }}>\n        <DialogContent dir=\"rtl\" className=\"sm:max-w-md w-[95vw] sm:w-auto rounded-2xl border border-emerald-200 shadow-xl bg-gradient-to-br from-white via-green-50 to-emerald-50 backdrop-blur-md data-[state=open]:animate-in data-[state=open]:fade-in-0 data-[state=open]:zoom-in-90 data-[state=open]:slide-in-from-bottom-8 duration-300\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right text-green-700\">  </DialogTitle>\n            <DialogDescription className=\"text-right text-gray-600\">    </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-3\">\n            <div>\n              <Label htmlFor=\"topupPhone\" className=\"text-right block\"> </Label>\n              <Input id=\"topupPhone\" value={topupPhone} onChange={(e) => setTopupPhone(e.target.value)} placeholder=\"010xxxxxxx\" className=\"text-right\" />\n            </div>\n\n            <div>\n              <Label className=\"text-right block\"> </Label>\n              <Select value={topupOperator} onValueChange={setTopupOperator}>\n                <SelectTrigger className=\"text-right\">\n                  <SelectValue placeholder=\" \" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"vodafone\"></SelectItem>\n                  <SelectItem value=\"orange\"></SelectItem>\n                  <SelectItem value=\"etisalat\"></SelectItem>\n                  <SelectItem value=\"we\">WE</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <Label htmlFor=\"topupAmount\" className=\"text-right block\"> </Label>\n              <Input id=\"topupAmount\" type=\"number\" value={topupAmount as number | ''} onChange={(e) => setTopupAmount(e.target.value ? Number(e.target.value) : '')} placeholder=\"50\" className=\"text-right\" />\n            </div>\n          </div>\n\n          <DialogFooter className=\"flex gap-2 justify-between\">\n            <Button variant=\"outline\" onClick={() => setIsTopUpOpen(false)} className=\"border-gray-300\"></Button>\n            <Button onClick={submitTopUp} disabled={topupLoading || !topupPhone || !topupOperator || !topupAmount} className=\"bg-emerald-600 hover:bg-emerald-700 text-white\">\n              {topupLoading ? ' ...' : ' '}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*       */}\n      <MasterPinDialog\n        open={isDebtsPasswordDialogOpen}\n        onOpenChange={setIsDebtsPasswordDialogOpen}\n        mode=\"verify\"\n        title=\"    \"\n        description=\"      \"\n        onSuccess={() => {\n          setIsDebtsPasswordDialogOpen(false);\n          setIsDebtsDialogOpen(true);\n        }}\n      />\n\n      <MasterPinDialog\n        open={isDebtsPinToggleOpen}\n        onOpenChange={setIsDebtsPinToggleOpen}\n        mode=\"verify\"\n        title=\"     \"\n        description=\"            \"\n        onSuccess={async () => {\n          if (pendingDebtsPinValue !== null) {\n            const nextVal = pendingDebtsPinValue;\n            setIsDebtsPinRequired(nextVal);\n            try {\n              const uid = user?.uid;\n              const key = uid ? `debtsPinRequired_${uid}` : 'debtsPinRequired';\n              localStorage.setItem(key, String(nextVal));\n              if (uid) await userDataService.updateUserData(uid, { debtsPinRequired: nextVal });\n            } catch { }\n            toast({\n              title: nextVal ? '     ' : '     ',\n              description: nextVal ? '       .' : '       .',\n            });\n          }\n          setPendingDebtsPinValue(null);\n          setIsDebtsPinToggleOpen(false);\n        }}\n      />\n\n      {/*       */}\n      <PasswordConfirmDialog\n        open={isResetRecentDialogOpen}\n        onOpenChange={setIsResetRecentDialogOpen}\n        title=\"     \"\n        description=\"        Firebase.\"\n        onSuccess={async () => {\n          try {\n            if (!user?.uid) {\n              setIsResetRecentDialogOpen(false);\n              return;\n            }\n            const resetAt = new Date();\n            const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : new Date(String(v));\n\n            //        (   )\n            const toDelete = transactions.filter(t => toJsDate((t as any).createdAt) < resetAt);\n\n            //          .\n            //           .\n\n            //      Firestore    \n            await userDataService.updateUserData(user.uid, {\n              recentReset: {\n                keepLastCount: recentResetConfig.keepLastCount ?? 30,\n                intervalDays: recentResetConfig.intervalDays ?? 7,\n                lastResetAt: resetAt\n              }\n            });\n            setRecentResetConfig(cfg => ({ ...cfg, lastResetAt: resetAt }));\n\n            toast({ title: '   ', description: '              /  .' });\n          } catch (e) {\n            console.error('   :', e);\n            toast({ title: ' ', description: '     .', variant: 'destructive' });\n          } finally {\n            setIsResetRecentDialogOpen(false);\n          }\n        }}\n      />\n\n      {/*       */}\n      <MasterPinDialog\n        open={isShopExpensesPinDialogOpen}\n        onOpenChange={setIsShopExpensesPinDialogOpen}\n        mode=\"verify\"\n        title=\"    \"\n        description=\"       \"\n        onSuccess={() => {\n          setIsShopExpensesPinDialogOpen(false);\n          setIsShopExpensesDialogOpen(true);\n        }}\n      />\n\n      {/*    */}\n      <Dialog open={isDebtsDialogOpen} onOpenChange={setIsDebtsDialogOpen}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader className=\"flex items-center justify-between\">\n            <DialogTitle className=\"text-right\"> </DialogTitle>\n            <div className=\"flex items-center gap-1 text-orange-700\">\n              <Banknote className=\"h-4 w-4\" />\n              <span className=\"text-xs font-bold\">{totalOutstandingDebts} </span>\n            </div>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"flex items-center justify-center gap-2\">\n              <Button variant={debtRole === 'debtor' ? 'default' : 'outline'} onClick={() => setDebtRole('debtor')}></Button>\n              <Button variant={debtRole === 'creditor' ? 'default' : 'outline'} onClick={() => setDebtRole('creditor')}></Button>\n            </div>\n            {(debtRole === 'creditor' || debtRole === 'debtor') && (\n              <div className=\"grid grid-cols-4 items-center gap-4\">\n                <Label htmlFor=\"debtorName\" className=\"text-right col-span-1\">\n                  {debtRole === 'creditor' ? ' ' : ' '}\n                </Label>\n                <Input \n                  id=\"debtorName\" \n                  value={debtorName} \n                  onChange={(e) => setDebtorName(e.target.value)} \n                  className=\"col-span-3 text-right\" \n                  placeholder={debtRole === 'creditor' ? \"  \" : \"  \"} \n                />\n              </div>\n            )}\n            {debtRole && (\n              <>\n                <div className=\"grid grid-cols-4 items-center gap-4\">\n                  <Label htmlFor=\"debtAmount\" className=\"text-right col-span-1\"></Label>\n                  <Input id=\"debtAmount\" type=\"number\" value={debtAmount} onChange={(e) => setDebtAmount(e.target.value)} className=\"col-span-3 text-right\" placeholder=\" \" />\n                </div>\n                <div className=\"grid grid-cols-4 items-center gap-4\">\n                  <Label htmlFor=\"debtReason\" className=\"text-right col-span-1\"> </Label>\n                  <Input id=\"debtReason\" value={debtReason} onChange={(e) => setDebtReason(e.target.value)} className=\"col-span-3 text-right\" placeholder=\"  \" />\n                </div>\n              </>\n            )}\n          </div>\n          <DialogFooter>\n            <Button\n              onClick={() => {\n                const isDebtor = debtRole === 'debtor';\n                const isCreditor = debtRole === 'creditor';\n                if (!isDebtor && !isCreditor) {\n                  toast({ title: '  ', description: '     ', variant: 'destructive' });\n                  return;\n                }\n                if (!debtAmount || !debtReason || !debtorName) {\n                  toast({ title: '  ', description: '    ', variant: 'destructive' });\n                  return;\n                }\n                const newDebt: Debt = {\n                  id: Date.now().toString(),\n                  debtorName: debtorName,\n                  amount: parseFloat(debtAmount),\n                  reason: debtReason,\n                  status: 'pending',\n                  createdAt: new Date(),\n                  paidAmount: 0,\n                  partialPayments: [],\n                  type: debtRole || 'creditor' // Default to 'creditor' (Receivable) if not set\n                };\n                setPendingDebtToCreate(newDebt);\n                setIsDebtDeductionChoiceOpen(true);\n              }}\n              className=\"bg-orange-500 hover:bg-orange-600\"\n            >\n              \n            </Button>\n          </DialogFooter>\n\n          {/*         */}\n          <div className=\"mt-2\">\n            <Button\n              variant=\"outline\"\n              className=\"w-full\"\n              onClick={() => setIsDebtReceiptsListOpen(true)}\n            >\n               \n            </Button>\n          </div>\n          {/*        */}\n          <div className=\"mt-2\">\n            <Button\n              variant=\"outline\"\n              className=\"w-full\"\n              onClick={() => setIsAddCustomerDialogOpen(true)}\n            >\n               \n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/*     */}\n      <Dialog open={isDebtReceiptsListOpen} onOpenChange={setIsDebtReceiptsListOpen}>\n        <DialogContent className=\"w-[95vw] sm:w-auto sm:max-w-[520px] rounded-2xl\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\"> </DialogTitle>\n            <DialogDescription className=\"text-right\">\n                  \n            </DialogDescription>\n          </DialogHeader>\n          {debts.length > 0 ? (\n            <div\n              className=\"max-h-[70vh] overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 space-y-2 px-1 -mx-1 sm:mx-0 sm:px-0\"\n              style={{ contain: 'layout paint' }}\n              onScroll={(e) => {\n                const target = e.currentTarget;\n                if (visibleDebts.length < debts.length) {\n                  if (target.scrollTop + target.clientHeight >= target.scrollHeight - 50) {\n                    setDebtsPage((p) => p + 1);\n                  }\n                }\n              }}\n            >\n              {visibleDebts.map((debt) => (\n                <div\n                  key={debt.id}\n                  onClick={() => {\n                    setSelectedDebt(debt);\n                    setIsDebtReceiptOpen(true);\n                    //         \n                    setIsDebtReceiptsListOpen(false);\n                    //        \n                    setIsDebtsDialogOpen(false);\n                  }}\n                  className={`p-4 sm:p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors min-h-[64px] ${debt.type === 'debtor' ? 'border-r-4 border-r-red-500 bg-red-50/10' : 'border-r-4 border-r-emerald-500'}`}\n                >\n                  <div className=\"flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center\">\n                    <div className=\"text-right space-y-0.5\">\n                      <div className=\"flex items-center gap-2\">\n                         <p className=\"font-medium text-[14px] sm:text-sm\">{debt.debtorName}</p>\n                         {debt.type === 'debtor' && <Badge variant=\"destructive\" className=\"h-5 text-[10px] px-1\"></Badge>}\n                         {(!debt.type || debt.type === 'creditor') && <Badge variant=\"outline\" className=\"h-5 text-[10px] px-1 text-emerald-700 border-emerald-200 bg-emerald-50\"></Badge>}\n                      </div>\n                      <p className=\"text-[13px] sm:text-sm text-gray-600\">{debt.reason}</p>\n                      <p className=\"text-[12px] sm:text-sm text-gray-500\">\n                        {dateFormatter.format(debt.createdAt instanceof Date ? debt.createdAt : new Date(debt.createdAt))}\n                      </p>\n                    </div>\n                    <div className=\"text-left\">\n                      <p className=\"font-bold text-xl sm:text-lg\">{debt.amount} </p>\n                      <Badge\n                        variant={debt.status === 'paid' ? 'default' : 'secondary'}\n                        className={`${debt.status === 'paid' ? 'bg-green-500' : 'bg-yellow-500'} text-[12px] sm:text-xs`}\n                      >\n                        {debt.status === 'paid' ? '' : ' '}\n                      </Badge>\n                    </div>\n                  </div>\n                </div>\n              ))}\n              {visibleDebts.length < debts.length && (\n                <div className=\"flex justify-center pt-1\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setDebtsPage(p => p + 1)}\n                  >\n                     \n                  </Button>\n                </div>\n              )}\n            </div>\n          ) : (\n            <div className=\"text-center text-sm text-gray-500\">   </div>\n          )}\n\n          {/*       */}\n          <DialogFooter className=\"flex justify-between mt-3\">\n            <Button\n              variant=\"destructive\"\n              onClick={async () => {\n                try {\n                  if (!debts || debts.length === 0) {\n                    toast({ title: '  ', description: '  .' });\n                    return;\n                  }\n                  const confirmed = window.confirm('           .');\n                  if (!confirmed) return;\n                  const cleared: Debt[] = [];\n                  \n                  // Delete all debts from Firestore collection explicitly - DISABLED\n                  /*\n                  if (user?.uid && debts.length > 0) {\n                     debts.forEach(d => {\n                         if (d.id) {\n                             deleteDoc(doc(db, 'debts', d.id)).catch(e => console.error('Failed to delete debt doc:', d.id, e));\n                         }\n                     });\n                  }\n                  */\n\n                  setDebts(cleared);\n                  setSelectedDebt(null);\n                  //      Firebase  \n                  await saveDebtsToStorage(cleared);\n                  if (user?.uid) {\n                    try {\n                      await userDataService.updateUserData(user.uid, { debts: [], debtsDeletedAt: serverTimestamp() });\n                      try { localStorage.removeItem(`debts_unsynced_${user.uid}`); } catch { }\n                    } catch (e) {\n                      console.error('    Firebase:', e);\n                      toast({ title: '   ', description: '    Firebase   .', variant: 'destructive' });\n                      return;\n                    }\n                  }\n                  toast({ title: '    ', description: '   .' });\n                  setIsDebtReceiptsListOpen(false);\n                } catch (e) {\n                  console.error('    :', e);\n                  toast({ title: ' ', description: '      .', variant: 'destructive' });\n                }\n              }}\n            >\n                \n            </Button>\n            <Button variant=\"outline\" onClick={() => setIsDebtReceiptsListOpen(false)}>\n              \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*         -   */}\n      <Dialog open={isAddCustomerDialogOpen} onOpenChange={setIsAddCustomerDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px] w-full max-h-[90vh] overflow-hidden flex flex-col p-0 gap-0 bg-gray-50/50\">\n          <div className=\"p-4 border-b bg-white\">\n            <DialogHeader>\n              <DialogTitle className=\"text-right flex items-center justify-end gap-2\">\n                <User className=\"w-5 h-5 text-primary\" />\n                  \n              </DialogTitle>\n              <DialogDescription className=\"text-right\">\n                    \n              </DialogDescription>\n            </DialogHeader>\n          </div>\n\n          <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n            {/*     */}\n            <Card className=\"border shadow-sm bg-white\">\n              <CardHeader className=\"pb-2 pt-4 px-4\">\n                <CardTitle className=\"text-sm font-medium text-right text-gray-700 flex items-center justify-end gap-2\">\n                  <Plus className=\"w-4 h-4\" />\n                    \n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4 pt-2 space-y-3\">\n                <div className=\"space-y-1\">\n                  <Label className=\"text-right block text-xs text-gray-500\"> </Label>\n                  <Input\n                    value={newCustomerName}\n                    onChange={(e) => setNewCustomerName(e.target.value)}\n                    className=\"text-right h-9\"\n                    placeholder=\"  \"\n                  />\n                </div>\n                <div className=\"space-y-1\">\n                  <Label className=\"text-right block text-xs text-gray-500\"> </Label>\n                  <Input\n                    value={newCustomerMobile}\n                    onChange={(e) => setNewCustomerMobile(e.target.value)}\n                    className=\"text-right h-9\"\n                    placeholder=\"  \"\n                  />\n                </div>\n                <Button\n                  className=\"w-full bg-emerald-600 hover:bg-emerald-700 text-white h-9 mt-2\"\n                  onClick={async () => {\n                    if (!newCustomerName || !newCustomerMobile) {\n                      toast({ title: '  ', description: '     ', variant: 'destructive' });\n                      return;\n                    }\n                    const newCustomer: Customer = {\n                      id: Date.now().toString(),\n                      name: newCustomerName.trim(),\n                      mobile: newCustomerMobile.trim(),\n                      createdAt: new Date(),\n                    };\n                    const updated = [newCustomer, ...customers];\n                    await saveCustomersToStorage(updated);\n                    setNewCustomerName('');\n                    setNewCustomerMobile('');\n                    toast({ title: '  ', description: `  ${newCustomer.name}` });\n                  }}\n                >\n                  <Plus className=\"w-4 h-4 mr-2\" />\n                   \n                </Button>\n              </CardContent>\n            </Card>\n\n            {/*    (     ) */}\n            <Card className=\"border shadow-sm bg-white\">\n              <CardHeader className=\"pb-2 pt-4 px-4\">\n                <CardTitle className=\"text-sm font-medium text-right text-gray-700 flex items-center justify-end gap-2\">\n                  <DollarSign className=\"w-4 h-4 text-orange-600\" />\n                    \n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4 pt-2 space-y-3\">\n                {customers.length > 0 ? (\n                  <>\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-right block text-xs text-gray-500\"> </Label>\n                      <Select value={selectedCustomerId} onValueChange={setSelectedCustomerId}>\n                        <SelectTrigger className=\"w-full h-9 text-right\" dir=\"rtl\">\n                          <SelectValue placeholder=\" \" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {customers.map(c => (\n                            <SelectItem key={c.id} value={c.id} className=\"text-right justify-end\">{c.name}  {c.mobile}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      {selectedCustomerId && (() => {\n                        const totalDebt = debts\n                          .filter(d => d.customerId === selectedCustomerId && d.status === 'pending')\n                          .reduce((sum, d) => sum + (d.amount - (d.paidAmount || 0)), 0);\n                        \n                        if (totalDebt > 0) {\n                          return (\n                            <div className=\"text-xs text-red-600 font-semibold mt-1 text-right\">\n                                : {totalDebt.toFixed(2)} \n                            </div>\n                          );\n                        }\n                        return null;\n                      })()}\n                    </div>\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-right block text-xs text-gray-500\"></Label>\n                      <Input\n                        type=\"number\"\n                        value={customerDebtAmount}\n                        onChange={(e) => setCustomerDebtAmount(e.target.value)}\n                        className=\"text-right h-9\"\n                        placeholder=\"0.00\"\n                      />\n                    </div>\n                    <Button\n                      className=\"w-full bg-orange-600 hover:bg-orange-700 text-white h-9 mt-2\"\n                      onClick={async () => {\n                        const amt = parseFloat(customerDebtAmount);\n                        if (!selectedCustomerId) {\n                          toast({ title: ' ', description: '   ', variant: 'destructive' });\n                          return;\n                        }\n                        if (isNaN(amt) || amt <= 0) {\n                          toast({ title: '  ', description: '   ', variant: 'destructive' });\n                          return;\n                        }\n                        const customer = customers.find(c => c.id === selectedCustomerId);\n                        if (!customer) return;\n                        const newDebt: Debt = {\n                          id: Date.now().toString(),\n                          debtorName: customer.name,\n                          customerId: customer.id,\n                          mobile: customer.mobile,\n                          amount: Number(amt.toFixed(2)),\n                          reason: ' ',\n                          status: 'pending',\n                          createdAt: new Date(),\n                          paidAmount: 0,\n                          partialPayments: []\n                        };\n                        setPendingDebtToCreate(newDebt);\n                        setIsDebtDeductionChoiceOpen(true);\n                      }}\n                    >\n                        \n                    </Button>\n                  </>\n                ) : (\n                  <div className=\"text-center py-4 text-gray-500 text-sm bg-gray-50 rounded border border-dashed\">\n                       .   .\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/*    */}\n            <Card className=\"border shadow-sm bg-white\">\n              <CardHeader className=\"pb-2 pt-4 px-4\">\n                <CardTitle className=\"text-sm font-medium text-right text-gray-700 flex items-center justify-end gap-2\">\n                  <Notebook className=\"w-4 h-4\" />\n                    ({customers.length})\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4 pt-2\">\n                {customers.length > 0 ? (\n                  <div className=\"space-y-2\">\n                    {customers.map((c) => (\n                      <div key={c.id} className=\"p-3 border rounded-lg flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors\">\n                        <div className=\"flex gap-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"h-8 w-8 text-blue-600 hover:text-blue-700 hover:bg-blue-50\"\n                            onClick={() => {\n                              setEditingCustomerId(c.id);\n                              setEditingCustomerName(c.name || '');\n                              setEditingCustomerMobile(c.mobile || '');\n                              setIsEditCustomerDialogOpen(true);\n                            }}\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50\"\n                            onClick={() => {\n                              setCustomerToDeleteId(c.id);\n                              setCustomerToDeleteName(c.name || '');\n                              setIsDeleteCustomerConfirmOpen(true);\n                            }}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                        <div className=\"text-right\">\n                          <div className=\"font-medium text-sm text-gray-900\">{c.name}</div>\n                          <div className=\"text-xs text-gray-500 font-mono\">{c.mobile}</div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-4 text-gray-400 text-sm\">\n                       \n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n\n          <DialogFooter className=\"p-4 border-t bg-white\">\n            <Button variant=\"outline\" className=\"w-full sm:w-auto\" onClick={() => setIsAddCustomerDialogOpen(false)}></Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isDeleteCustomerConfirmOpen} onOpenChange={setIsDeleteCustomerConfirmOpen}>\n        <DialogContent hideClose className=\"sm:max-w-[420px] rounded-2xl bg-gradient-to-br from-white via-rose-50 to-red-50 shadow-2xl border border-red-100 text-center\">\n          <DialogHeader>\n            <DialogTitle className=\"text-center text-xl font-bold text-red-700\">  </DialogTitle>\n            <DialogDescription className=\"text-center text-gray-600\">   : {customerToDeleteName}</DialogDescription>\n          </DialogHeader>\n          <div className=\"py-2 text-sm text-gray-700\">     .</div>\n          <DialogFooter className=\"flex justify-center gap-3\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsDeleteCustomerConfirmOpen(false);\n                setCustomerToDeleteId('');\n                setCustomerToDeleteName('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              variant=\"destructive\"\n              className=\"bg-red-600 hover:bg-red-700\"\n              onClick={async () => {\n                const id = customerToDeleteId;\n                const updated = customers.filter(x => x.id !== id);\n                await saveCustomersToStorage(updated);\n                if (selectedCustomerId === id) setSelectedCustomerId('');\n                setIsDeleteCustomerConfirmOpen(false);\n                setCustomerToDeleteId('');\n                setCustomerToDeleteName('');\n                toast({ title: '  ', description: customerToDeleteName });\n              }}\n            >\n               \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isEditCustomerDialogOpen} onOpenChange={setIsEditCustomerDialogOpen}>\n        <DialogContent className=\"sm:max-w-[420px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\">  </DialogTitle>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"editCustomerName\" className=\"text-right col-span-1\"></Label>\n              <Input id=\"editCustomerName\" value={editingCustomerName} onChange={(e) => setEditingCustomerName(e.target.value)} className=\"col-span-3 text-right\" />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"editCustomerMobile\" className=\"text-right col-span-1\"></Label>\n              <Input id=\"editCustomerMobile\" value={editingCustomerMobile} onChange={(e) => setEditingCustomerMobile(e.target.value)} className=\"col-span-3 text-right\" />\n            </div>\n          </div>\n          <DialogFooter className=\"flex justify-between\">\n            <Button variant=\"outline\" onClick={() => setIsEditCustomerDialogOpen(false)}></Button>\n            <Button\n              className=\"bg-green-600 hover:bg-green-700\"\n              onClick={async () => {\n                const id = editingCustomerId;\n                const name = editingCustomerName.trim();\n                const mobile = editingCustomerMobile.trim();\n                if (!id || !name || !mobile) {\n                  toast({ title: '  ', description: '   ', variant: 'destructive' });\n                  return;\n                }\n                const updated = customers.map(c => c.id === id ? { ...c, name, mobile } : c);\n                await saveCustomersToStorage(updated);\n                const updatedDebts = debts.map(d => d.customerId === id ? { ...d, debtorName: name, mobile } : d);\n                if (updatedDebts !== debts) {\n                  setDebts(updatedDebts);\n                  await saveDebtsToStorage(updatedDebts);\n                  \n                  // Sync updated debts to collection - DISABLED\n                  /*\n                  if (user?.uid) {\n                      updatedDebts.forEach(d => {\n                          if (d.customerId === id && d.id) {\n                              const debtRef = doc(db, 'debts', d.id);\n                              const p: any = { \n                                  ...d, \n                                  userId: user.uid, \n                                  shopId: shopIdCtx || profile?.shopId || null, \n                                  lastUpdated: new Date().toISOString() \n                              };\n                              Object.keys(p).forEach(key => p[key] === undefined && delete p[key]);\n                              setDoc(debtRef, p, { merge: true }).catch(e => console.error('Failed to update debt doc:', d.id, e));\n                          }\n                      });\n                  }\n                  */\n                }\n                setIsEditCustomerDialogOpen(false);\n                setEditingCustomerId('');\n                setEditingCustomerName('');\n                setEditingCustomerMobile('');\n                toast({ title: '  ', description: name });\n              }}\n            >\n              \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*    */}\n      <Dialog open={isShopExpensesDialogOpen} onOpenChange={setIsShopExpensesDialogOpen}>\n        <DialogContent className=\"sm:max-w-[520px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\"> </DialogTitle>\n            <DialogDescription className=\"text-right\">\n                    .\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"expenseName\" className=\"text-right col-span-1\">\n                 \n              </Label>\n              <Input\n                id=\"expenseName\"\n                value={expenseName}\n                onChange={(e) => setExpenseName(e.target.value)}\n                className=\"col-span-3 text-right\"\n                placeholder=\":   \"\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"expenseAmount\" className=\"text-right col-span-1\">\n                 \n              </Label>\n              <Input\n                id=\"expenseAmount\"\n                type=\"number\"\n                value={expenseAmount}\n                onChange={(e) => setExpenseAmount(e.target.value)}\n                className=\"col-span-3 text-right\"\n                placeholder=\"0.00\"\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"expenseNotes\" className=\"text-right col-span-1\">\n                \n              </Label>\n              <Input\n                id=\"expenseNotes\"\n                value={expenseNotes}\n                onChange={(e) => setExpenseNotes(e.target.value)}\n                className=\"col-span-3 text-right\"\n                placeholder=\"   \"\n              />\n            </div>\n          </div>\n          <DialogFooter className=\"flex justify-between\">\n            <Button\n              className=\"bg-orange-600 hover:bg-orange-700\"\n              onClick={() => {\n                if (!expenseName || !expenseAmount) {\n                  toast({ title: '  ', description: '    ', variant: 'destructive' });\n                  return;\n                }\n                setIsExpenseDeductionChoiceOpen(true);\n              }}\n            >\n               \n            </Button>\n            {/*        */}\n            <Button variant=\"outline\" onClick={() => setIsReceiptsDialogOpen(true)}> </Button>\n          </DialogFooter>\n\n\n        </DialogContent>\n      </Dialog>\n\n      {/*     */}\n      <Dialog open={isReceiptsDialogOpen} onOpenChange={setIsReceiptsDialogOpen}>\n        <DialogContent className=\"sm:max-w-[420px]\" dir=\"rtl\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\"> </DialogTitle>\n            <DialogDescription className=\"text-right\">  </DialogDescription>\n          </DialogHeader>\n          {expenses.length > 0 ? (\n            <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n              {expenses.map((ex) => (\n                <div key={ex.id} className=\"p-2 border rounded-lg bg-white hover:bg-gray-50 transition-colors\">\n                  <div className=\"flex justify-between items-start\">\n                    <div className=\"text-right\">\n                      <p className=\"font-medium text-sm\">{ex.name}</p>\n                      <p className=\"text-[11px] text-gray-600\">{ex.notes || ' '}</p>\n                      <p className=\"text-[10px] text-gray-500\">{new Date(ex.createdAt).toLocaleString('ar-EG')}</p>\n                    </div>\n                    <div className=\"text-left flex items-start gap-2\">\n                      <div className=\"text-left\">\n                        <p className=\"font-bold text-sm\">{ex.amount} </p>\n                        <Badge variant=\"secondary\" className={ex.source === 'cash' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'}>\n                          {ex.source === 'cash' ? ' ' : ` ${ex.walletId ? ` (${ex.walletId})` : ''}`}\n                        </Badge>\n                      </div>\n                      <Button\n                        variant=\"destructive\"\n                        size=\"sm\"\n                        className=\"shrink-0\"\n                        onClick={() => permanentlyDeleteExpense(ex.id)}\n                        title=\" \"\n                      >\n                        <Trash2 className=\"w-4 h-4 ml-1\" />\n                        \n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <p className=\"text-sm text-gray-500 text-center\">    </p>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/*      */}\n      <Dialog open={isExpenseDeductionChoiceOpen} onOpenChange={setIsExpenseDeductionChoiceOpen}>\n        <DialogContent className=\"sm:max-w-[480px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\">   </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <p className=\"text-sm text-gray-600 text-right\">\n                            .\n            </p>\n            <div className=\"grid grid-cols-3 gap-3\">\n              <Button\n                variant={expenseDeductionSource === 'cash' ? 'default' : 'outline'}\n                className={expenseDeductionSource === 'cash' ? 'bg-blue-600 hover:bg-blue-700 text-white' : ''}\n                onClick={() => setExpenseDeductionSource('cash')}\n              >\n                 \n              </Button>\n              <Button\n                variant={expenseDeductionSource === 'wallet' ? 'default' : 'outline'}\n                className={expenseDeductionSource === 'wallet' ? 'bg-purple-600 hover:bg-purple-700 text-white' : ''}\n                onClick={() => setExpenseDeductionSource('wallet')}\n              >\n                 \n              </Button>\n              <Button\n                variant={expenseDeductionSource === 'fawry' ? 'default' : 'outline'}\n                className={expenseDeductionSource === 'fawry' ? 'bg-amber-600 hover:bg-amber-700 text-white' : ''}\n                onClick={() => setExpenseDeductionSource('fawry')}\n              >\n                \n              </Button>\n            </div>\n\n            {expenseDeductionSource === 'wallet' && (\n              <div className=\"space-y-2\">\n                <Label className=\"text-right block\">  </Label>\n                <Select value={selectedWalletForExpense} onValueChange={setSelectedWalletForExpense}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\" \" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {wallets.map(w => (\n                      <SelectItem key={w.id} value={w.id}>{w.phone || w.name || w.id}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n          </div>\n          <DialogFooter className=\"flex justify-between\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsExpenseDeductionChoiceOpen(false);\n                setExpenseDeductionSource(null);\n                setSelectedWalletForExpense('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              className=\"bg-green-600 hover:bg-green-700\"\n              onClick={async () => {\n                const amt = Number(expenseAmount);\n                if (isNaN(amt) || amt <= 0) {\n                  toast({ title: '  ', description: '   ', variant: 'destructive' });\n                  return;\n                }\n                if (!expenseDeductionSource) {\n                  toast({ title: '  ', description: '    ', variant: 'destructive' });\n                  return;\n                }\n                try {\n                  if (expenseDeductionSource === 'cash') {\n                    const newCash = Number((cashBalance - amt).toFixed(2));\n                    setCashBalance(newCash);\n                    localStorage.setItem(getCashBalanceKey(), newCash.toString());\n                    const updateData = { cashBalance: newCash, lastUpdated: new Date().toISOString() };\n                    const localDataKey = `userData_${user?.uid}`;\n                    localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                    if (user?.uid) {\n                      await userDataService.updateUserData(user.uid, updateData);\n                      localStorage.removeItem(localDataKey);\n                      setHasLocalDataToSync(false);\n                    } else {\n                      setHasLocalDataToSync(true);\n                    }\n                  } else if (expenseDeductionSource === 'wallet') {\n                    if (!selectedWalletForExpense) {\n                      toast({ title: ' ', description: '   ', variant: 'destructive' });\n                      return;\n                    }\n                    const current = walletBalances[selectedWalletForExpense] || 0;\n                    const newBalance = Number((current - amt).toFixed(2));\n                    const updatedBalances = { ...walletBalances, [selectedWalletForExpense]: newBalance };\n                    setWalletBalances(updatedBalances);\n                    const timestamp = new Date().toISOString();\n                    const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp } as any;\n                    const localDataKey = `userData_${user?.uid}`;\n                    localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n                    localStorage.setItem(`walletBalances_backup_${timestamp}`, JSON.stringify(updatedBalances));\n                    if (user?.uid) {\n                      userDataService.updateUserData(user.uid, updateData).catch(() => {});\n                    }\n                  } else if (expenseDeductionSource === 'fawry') {\n                    //            \"\"\n                  }\n                } catch (e) {\n                  console.error('      :', e);\n                }\n\n                //    Firestore     \n                let newExpenseId = Date.now().toString();\n                try {\n                  if (user?.uid) {\n                    const { addDoc, collection, serverTimestamp } = await import('firebase/firestore');\n                    const { db } = await import('@/firebase');\n                    const docRef = await addDoc(collection(db, 'shop_expenses'), {\n                      userId: user.uid,\n                      shopId: (shopIdCtx || profile?.shopId || user.uid || 'default-shop'),\n                      name: expenseName,\n                      amount: amt,\n                      notes: expenseNotes || '',\n                      source: expenseDeductionSource,\n                      walletId: expenseDeductionSource === 'wallet' ? selectedWalletForExpense : null,\n                      createdAt: serverTimestamp(),\n                    });\n                    newExpenseId = docRef.id;\n                  }\n                } catch (e) {\n                  console.error('     Firestore:', e);\n                }\n\n                //          \n                const newExpense: ShopExpense = {\n                  id: newExpenseId,\n                  name: expenseName,\n                  amount: amt,\n                  notes: expenseNotes,\n                  source: expenseDeductionSource,\n                  walletId: expenseDeductionSource === 'wallet' ? selectedWalletForExpense : undefined,\n                  createdAt: new Date(),\n                };\n                const updatedExpenses = [...expenses, newExpense];\n                await saveExpensesToStorage(updatedExpenses);\n\n                //  \n                setExpenseName('');\n                setExpenseAmount('');\n                setExpenseNotes('');\n                setExpenseDeductionSource(null);\n                setSelectedWalletForExpense('');\n                //         \n                setIsExpenseDeductionChoiceOpen(false);\n                setIsShopExpensesDialogOpen(true);\n\n                //       \n                setIsReceiptsDialogOpen(true);\n\n                toast({\n                  title: '  ',\n                  description:\n                    expenseDeductionSource === 'cash'\n                      ? '   '\n                      : expenseDeductionSource === 'wallet'\n                        ? '    '\n                        : '    ',\n                });\n              }}\n            >\n               \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*   */}\n      <Dialog open={isDeficienciesDialogOpen} onOpenChange={setIsDeficienciesDialogOpen}>\n        <DialogContent className=\"sm:max-w-[520px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\"></DialogTitle>\n            <DialogDescription className=\"text-right\">\n                     .\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"deficiencyName\" className=\"text-right col-span-1\">\n                 \n              </Label>\n              <Input\n                id=\"deficiencyName\"\n                value={deficiencyName}\n                onChange={(e) => setDeficiencyName(e.target.value)}\n                className=\"col-span-3 text-right\"\n                placeholder=\":   \"\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"deficiencyQuantity\" className=\"text-right col-span-1\">\n                \n              </Label>\n              <Input\n                id=\"deficiencyQuantity\"\n                type=\"number\"\n                value={deficiencyQuantity}\n                onChange={(e) => setDeficiencyQuantity(e.target.value)}\n                className=\"col-span-3 text-right\"\n                placeholder=\"1\"\n              />\n            </div>\n            <div className=\"flex justify-end\">\n              <Button\n                className=\"bg-rose-600 hover:bg-rose-700\"\n                onClick={() => {\n                  if (isZeroPlan) {\n                    toast({ title: ' ', description: '     .  .', variant: 'destructive' });\n                    return;\n                  }\n                  const qty = parseInt(deficiencyQuantity || '1', 10);\n                  if (!deficiencyName) {\n                    toast({ title: '  ', description: '   ', variant: 'destructive' });\n                    return;\n                  }\n                  if (isNaN(qty) || qty <= 0) {\n                    toast({ title: '  ', description: '   ', variant: 'destructive' });\n                    return;\n                  }\n                  (async () => {\n                    //  :   Firestore     \n                    if (user?.uid) {\n                      try {\n                        const { collection, addDoc, serverTimestamp } = await import('firebase/firestore');\n                        const { db } = await import('@/firebase');\n                        const docRef = await addDoc(collection(db, 'deficiencies'), {\n                          userId: user.uid,\n                          shopId: (shopIdCtx || profile?.shopId || user.uid || 'default-shop'),\n                          name: deficiencyName,\n                          quantity: qty,\n                          status: 'pending',\n                          createdAt: serverTimestamp(),\n                        });\n                        //          /\n                        try {\n                          const key = getDeficienciesKey();\n                          const raw = localStorage.getItem(key);\n                          const list = raw ? JSON.parse(raw) : [];\n                          const safeList = Array.isArray(list) ? list : [];\n                          const exists = safeList.some((d: any) => String(d?.id || '') === docRef.id);\n                          const optimisticItem = {\n                            id: docRef.id,\n                            name: deficiencyName,\n                            quantity: qty,\n                            status: 'pending',\n                            createdAt: new Date().toISOString(),\n                          };\n                          const updatedOptimistic = exists ? safeList : [...safeList, optimisticItem];\n                          localStorage.setItem(key, JSON.stringify(updatedOptimistic));\n                        } catch { }\n                        setDeficiencyName('');\n                        setDeficiencyQuantity('');\n                        toast({ title: ' ', description: '     ' });\n                        return;\n                      } catch (e) {\n                        console.warn('    Firestore   :', e);\n                      }\n                    }\n                    // :          Firestore\n                    const newItem: DeficiencyItem = {\n                      id: Date.now().toString(),\n                      name: deficiencyName,\n                      quantity: qty,\n                      status: 'pending',\n                      createdAt: new Date(),\n                    };\n                    setDeficiencies(prev => {\n                      const updated = [...prev, newItem];\n                      saveDeficienciesToStorage(updated);\n                      return updated;\n                    });\n                    setDeficiencyName('');\n                    setDeficiencyQuantity('');\n                    toast({ title: ' ', description: '     ' });\n                  })();\n                }}\n              >\n                 \n              </Button>\n            </div>\n\n            {/*   */}\n            {deficiencies.length > 0 ? (\n              <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n                {deficiencies.map((d) => (\n                  <div key={d.id} className=\"p-2 border rounded-lg bg-white hover:bg-gray-50 transition-colors\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"text-right\">\n                        <p className=\"font-medium text-sm\">{d.name}</p>\n                        <p className=\"text-[11px] text-gray-600\">: {d.quantity}</p>\n                        <p className=\"text-[10px] text-gray-500\">{new Date(d.createdAt).toLocaleString('ar-EG')}</p>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant=\"secondary\" className={d.status === 'pending' ? 'bg-rose-100 text-rose-700' : 'bg-green-100 text-green-700'}>\n                          {d.status === 'pending' ? ' ' : ' '}\n                        </Badge>\n                        <Button\n                          variant=\"outline\"\n                          className={d.status === 'pending' ? 'text-green-700 border-green-300 hover:bg-green-50' : 'text-rose-700 border-rose-300 hover:bg-rose-50'}\n                          onClick={() => {\n                            (async () => {\n                              const next = d.status === 'pending' ? 'purchased' : 'pending';\n                              if (user?.uid) {\n                                try {\n                                  const { doc, updateDoc, serverTimestamp } = await import('firebase/firestore');\n                                  const { db } = await import('@/firebase');\n                                  await updateDoc(doc(db, 'deficiencies', d.id), { status: next, updatedAt: serverTimestamp() });\n                                  return;\n                                } catch (e) {\n                                  console.warn('     Firestore   :', e);\n                                }\n                              }\n                              setDeficiencies(prev => {\n                                const updated = prev.map(item => item.id === d.id ? { ...item, status: next } : item);\n                                saveDeficienciesToStorage(updated);\n                                return updated;\n                              });\n                            })();\n                          }}\n                          title={d.status === 'pending' ? ' ' : ' '}\n                        >\n                          {d.status === 'pending' ? ' ' : ' '}\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          className=\"text-red-700 border-red-300 hover:bg-red-50\"\n                          onClick={() => {\n                            (async () => {\n                              if (user?.uid) {\n                                try {\n                                  const { doc, deleteDoc } = await import('firebase/firestore');\n                                  const { db } = await import('@/firebase');\n                                  await deleteDoc(doc(db, 'deficiencies', d.id));\n                                  return;\n                                } catch (e) {\n                                  console.warn('     Firestore   :', e);\n                                }\n                              }\n                              setDeficiencies(prev => {\n                                const updated = prev.filter(item => item.id !== d.id);\n                                saveDeficienciesToStorage(updated);\n                                return updated;\n                              });\n                            })();\n                          }}\n                          title=\"\"\n                        >\n                          \n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-sm text-gray-500 text-center\">     </p>\n            )}\n          </div>\n\n          <DialogFooter className=\"flex justify-end\">\n            <Button variant=\"outline\" onClick={() => setIsDeficienciesDialogOpen(false)}></Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*      */}\n      <Dialog open={isDebtDeductionChoiceOpen} onOpenChange={setIsDebtDeductionChoiceOpen}>\n        <DialogContent className=\"sm:max-w-[480px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\">\n              {pendingDebtAdjustment?.type === 'decrease' ? '    ' : '   '}\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <p className=\"text-sm text-gray-600 text-right\">\n              {pendingDebtAdjustment?.type === 'decrease'\n                ? '                .'\n                : '                  .'}\n            </p>\n            <div className=\"grid grid-cols-3 gap-3\">\n              <Button\n                variant={deductionSource === 'cash' ? 'default' : 'outline'}\n                className={deductionSource === 'cash' ? 'bg-blue-600 hover:bg-blue-700 text-white' : ''}\n                onClick={() => setDeductionSource('cash')}\n              >\n                 \n              </Button>\n              <Button\n                variant={deductionSource === 'wallet' ? 'default' : 'outline'}\n                className={deductionSource === 'wallet' ? 'bg-purple-600 hover:bg-purple-700 text-white' : ''}\n                onClick={() => setDeductionSource('wallet')}\n              >\n                 \n              </Button>\n              <Button\n                variant={deductionSource === 'none' ? 'default' : 'outline'}\n                className={deductionSource === 'none' ? 'bg-gray-600 hover:bg-gray-700 text-white' : ''}\n                onClick={() => setDeductionSource('none')}\n              >\n                {pendingDebtAdjustment?.type === 'decrease' ? ' ' : ' '}\n              </Button>\n            </div>\n\n            {deductionSource === 'wallet' && (\n              <div className=\"space-y-2\">\n                <Label className=\"text-right block\">\n                  {pendingDebtAdjustment?.type === 'decrease' ? '  ' : '  '}\n                </Label>\n                <Select value={selectedWalletForDeduction} onValueChange={setSelectedWalletForDeduction}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\" \" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {wallets.map(w => (\n                      <SelectItem key={w.id} value={w.id}>{w.phone || w.name || w.id}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n          </div>\n          <DialogFooter className=\"flex justify-between\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsDebtDeductionChoiceOpen(false);\n                setPendingDebtToCreate(null);\n                setDeductionSource(null);\n                setSelectedWalletForDeduction('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              className=\"bg-green-600 hover:bg-green-700\"\n              onClick={async () => {\n                const isAdjustment = !!pendingDebtAdjustment;\n                const isDecrease = isAdjustment && pendingDebtAdjustment?.type === 'decrease';\n                const amt = isAdjustment ? Number(pendingDebtAdjustment!.delta) : Number(pendingDebtToCreate?.amount || 0);\n                if (!deductionSource) {\n                  toast({ \n                    title: isDecrease ? '  ' : '  ', \n                    description: '    ', \n                    variant: 'destructive' \n                  });\n                  return;\n                }\n\n                //        \n                const timestamp = new Date().toISOString();\n                // REPLACEMENT_START\n                // --- NEW CONSOLIDATED LOGIC START ---\n                let newCashBalanceValue = cashBalance;\n                let newWalletBalancesValue = walletBalances;\n                let didUpdateCash = false;\n                let didUpdateWallet = false;\n\n                // 1. Calculate Balance Changes\n                try {\n                  if (deductionSource === 'cash') {\n                     newCashBalanceValue = isDecrease\n                      ? Number((cashBalance + amt).toFixed(2))\n                      : Number((cashBalance - amt).toFixed(2));\n                     didUpdateCash = true;\n                  } else if (deductionSource === 'wallet') {\n                     if (!selectedWalletForDeduction) {\n                        toast({ \n                          title: ' ', \n                          description: isDecrease ? '   ' : '   ', \n                          variant: 'destructive' \n                        });\n                        return;\n                     }\n                     const current = walletBalances[selectedWalletForDeduction] || 0;\n                     const newBalance = isDecrease\n                      ? Number((current + amt).toFixed(2))\n                      : Number((current - amt).toFixed(2));\n                     newWalletBalancesValue = { ...walletBalances, [selectedWalletForDeduction]: newBalance };\n                     didUpdateWallet = true;\n                  }\n                } catch (e) {\n                   console.error('Error calculating balances:', e);\n                   return;\n                }\n\n                // 2. Calculate Debt Changes\n                let updatedDebts = [...debts];\n                let finalSelectedDebt = selectedDebt;\n                let didUpdateDebts = false;\n\n                if (isAdjustment) {\n                   if (!selectedDebt) return;\n                   const currentAmount = Number(selectedDebt.amount || 0);\n                   const paid = Number(selectedDebt.paidAmount || 0);\n                   const delta = Number(pendingDebtAdjustment!.delta || 0);\n\n                   if (pendingDebtAdjustment!.type === 'decrease') {\n                      const newAmount = Number((currentAmount - delta).toFixed(2));\n                      const becamePaid = paid >= newAmount;\n                      const updated: Debt = {\n                        ...selectedDebt,\n                        amount: newAmount,\n                        status: becamePaid ? 'paid' : 'pending',\n                      };\n                      updatedDebts = debts.map(d => d.id === selectedDebt.id ? updated : d);\n                      finalSelectedDebt = updated;\n                      didUpdateDebts = true;\n                      \n                      if (becamePaid && user?.uid) {\n                        (async () => {\n                          try {\n                            const [q1, q2, q3] = [\n                              fsQuery(collection(db, 'userTransactions'), where('userId', '==', user.uid), where('linkedDebtId', '==', selectedDebt.id), where('status', '==', 'pending')),\n                              fsQuery(collection(db, 'transactions'), where('userId', '==', user.uid), where('linkedDebtId', '==', selectedDebt.id), where('status', '==', 'pending')),\n                              fsQuery(collection(db, 'transactions'), where('merchantUserId', '==', user.uid), where('linkedDebtId', '==', selectedDebt.id), where('status', '==', 'pending'))\n                            ];\n\n                            const [snap1, snap2, snap3] = await Promise.all([getDocs(q1), getDocs(q2), getDocs(q3)]);\n                            const batch = writeBatch(db);\n                            let batchCount = 0;\n\n                            const processSnap = (snap: any) => {\n                              snap.docs.forEach((docSnap: any) => {\n                                batch.update(docSnap.ref, { status: 'completed', confirmedAt: new Date() });\n                                batchCount++;\n                              });\n                            };\n\n                            processSnap(snap1);\n                            processSnap(snap2);\n                            processSnap(snap3);\n\n                            if (batchCount > 0) {\n                              await batch.commit();\n                            }\n\n                            if (user?.uid) {\n                              const ids = [\n                                ...snap1.docs.map((d: any) => String((d.data() as any)?.transactionId || '')),\n                                ...snap2.docs.map((d: any) => String(d.id || (d.data() as any)?.transactionId || '')),\n                                ...snap3.docs.map((d: any) => String(d.id || (d.data() as any)?.transactionId || ''))\n                              ].filter(Boolean);\n                              \n                              ids.forEach(id => userDataService.removeLocalReceiptById(user.uid!, id));\n                            }\n                          } catch (e) {\n                            console.error('Batch update failed for linked transactions:', e);\n                          }\n                        })().catch((e) => {\n                          console.error('Transaction update error:', e);\n                        });\n                      }\n                      \n                      // Create Receipt for Repayment\n                      if (user?.uid && deductionSource !== 'none') {\n                        try {\n                           const newTxnId = doc(collection(db, 'dummy_collection')).id; \n                           const txnData = {\n                              transactionId: newTxnId,\n                              amount: delta,\n                              transactionType: 'cash_addition', \n                              type: 'cash_addition',\n                              status: 'completed',\n                              createdAt: new Date(),\n                              senderName: selectedDebt.debtorName,\n                              receiverName: '',\n                              description: `    ${selectedDebt.debtorName}`,\n                              paymentMethod: deductionSource,\n                              walletId: deductionSource === 'wallet' ? selectedWalletForDeduction : null,\n                              linkedDebtId: selectedDebt.id,\n                              isDebtRepayment: true\n                           };\n                           await userDataService.saveUserTransaction(user.uid, txnData as any);\n                           try { queryClientHook.invalidateQueries({ queryKey: ['recentTransactions', user?.uid] }); } catch {}\n                        } catch (e) {\n                           console.error('Failed to create repayment receipt:', e);\n                        }\n                      }\n\n                      toast({ title: '  ', description: ` : ${newAmount} ` });\n                   } else {\n                      const newAmount = currentAmount + delta;\n                      const stillPaid = paid >= newAmount;\n                      const updated: Debt = {\n                        ...selectedDebt,\n                        amount: Number(newAmount.toFixed(2)),\n                        status: stillPaid ? 'paid' : 'pending',\n                      };\n                      updatedDebts = debts.map(d => d.id === selectedDebt.id ? updated : d);\n                      finalSelectedDebt = updated;\n                      didUpdateDebts = true;\n                      toast({ title: '  ', description: ` : ${newAmount} ` });\n                      \n                      // Create Receipt for Debt Increase (Cash Deduction)\n                      //           \n                      /*\n                      if (user?.uid && deductionSource !== 'none') {\n                        try {\n                           const newTxnId = doc(collection(db, 'dummy_collection')).id; \n                           const txnData = {\n                              transactionId: newTxnId,\n                              amount: delta,\n                              transactionType: 'cash_subtraction', \n                              type: 'cash_subtraction',\n                              status: 'completed',\n                              createdAt: new Date(),\n                              senderName: '',\n                              receiverName: selectedDebt.debtorName,\n                              description: `    ${selectedDebt.debtorName}`,\n                              paymentMethod: deductionSource,\n                              walletId: deductionSource === 'wallet' ? selectedWalletForDeduction : null,\n                              linkedDebtId: selectedDebt.id,\n                              isDebtCreation: true\n                           };\n                           userDataService.saveUserTransaction(user.uid, txnData as any)\n                               .then(() => {\n                                   try { queryClientHook.invalidateQueries({ queryKey: ['recentTransactions', user?.uid] }); } catch {}\n                               })\n                               .catch(e => console.error('Failed to create increase receipt:', e));\n                        } catch (e) {\n                           console.error('Failed to prepare increase receipt:', e);\n                        }\n                      }\n                      */\n                   }\n                } else if (pendingDebtToCreate) {\n                   // Ensure userId and shopId are present in the local object too for robustness\n                   const enhancedDebt = { \n                       ...pendingDebtToCreate, \n                       userId: user?.uid,\n                       shopId: shopIdCtx || profile?.shopId || null \n                   };\n                   updatedDebts = [enhancedDebt, ...debts];\n                   didUpdateDebts = true;\n                   try { if (user?.uid) { telegramNotifier.send(user.uid, `    ${pendingDebtToCreate.debtorName}  ${pendingDebtToCreate.amount} `).catch(() => {}); } } catch {}\n                   \n                   // Create Receipt for New Debt (Cash Deduction)\n                   //           \n                   /*\n                   if (user?.uid && deductionSource !== 'none') {\n                        try {\n                           const newTxnId = doc(collection(db, 'dummy_collection')).id; \n                           const txnData = {\n                              transactionId: newTxnId,\n                              amount: pendingDebtToCreate.amount,\n                              transactionType: 'cash_subtraction', \n                              type: 'cash_subtraction',\n                              status: 'completed',\n                              createdAt: new Date(),\n                              senderName: '',\n                              receiverName: pendingDebtToCreate.debtorName,\n                              description: `     ${pendingDebtToCreate.debtorName}`,\n                              paymentMethod: deductionSource,\n                              walletId: deductionSource === 'wallet' ? selectedWalletForDeduction : null,\n                              linkedDebtId: pendingDebtToCreate.id,\n                              isDebtCreation: true\n                           };\n                           userDataService.saveUserTransaction(user.uid, txnData as any)\n                               .then(() => {\n                                   try { queryClientHook.invalidateQueries({ queryKey: ['recentTransactions', user?.uid] }); } catch {}\n                               })\n                               .catch(e => console.error('Failed to create new debt receipt:', e));\n                        } catch (e) {\n                           console.error('Failed to prepare new debt receipt:', e);\n                        }\n                   }\n                   */\n                }\n\n                // 3. Update React State\n                if (didUpdateCash) setCashBalance(newCashBalanceValue);\n                if (didUpdateWallet) setWalletBalances(newWalletBalancesValue);\n                if (didUpdateDebts) {\n                    setDebts(updatedDebts);\n                    if (isAdjustment) setSelectedDebt(finalSelectedDebt);\n                }\n\n                // Reset UI State\n                setDebtorName('');\n                setDebtAmount('');\n                setDebtReason('');\n                setIsDebtsDialogOpen(false);\n                setIsDebtDeductionChoiceOpen(false);\n\n                // Open receipts list immediately if it was a new debt creation\n                if (!isAdjustment && didUpdateDebts) {\n                   setIsDebtReceiptsListOpen(true);\n                }\n\n                setPendingDebtToCreate(null);\n                setPendingDebtAdjustment(null);\n                setDeductionSource(null);\n                setSelectedWalletForDeduction('');\n\n                toast({\n                  title: isAdjustment ? '  ' : '  ',\n                  description: deductionSource === 'none'\n                    ? '   '\n                    : deductionSource === 'cash'\n                      ? (isDecrease ? `  ${amt}   ` : `  ${amt}   `)\n                      : (isDecrease ? `  ${amt}   ` : `  ${amt}   `),\n                });\n\n                // 4. Update Local Storage & Firebase (Consolidated)\n                const updatePayload: any = { lastUpdated: timestamp };\n                if (didUpdateCash) updatePayload.cashBalance = newCashBalanceValue;\n                if (didUpdateWallet) updatePayload.walletBalances = newWalletBalancesValue;\n                if (didUpdateDebts) {\n                  updatePayload.debts = updatedDebts;\n                  updatePayload.debtsDeletedAt = null; // Clear deleted flag\n                }\n\n                // Local Storage\n                if (didUpdateCash) {\n                    localStorage.setItem(getCashBalanceKey(), newCashBalanceValue.toString());\n                    localStorage.setItem(getCashBalanceKey() + '_lastUpdated', timestamp);\n                }\n                if (didUpdateWallet) {\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(newWalletBalancesValue));\n                    localStorage.setItem(getWalletBalancesKey() + '_lastUpdated', timestamp);\n                }\n                if (didUpdateDebts) {\n                    localStorage.setItem(getDebtsKey(), JSON.stringify(updatedDebts));\n                    try { localStorage.setItem(getDebtsDefaultKey(), JSON.stringify(updatedDebts)); } catch { }\n                    try { localStorage.setItem(getDebtsLastWriteKey(), Date.now().toString()); } catch { }\n                }\n                \n                const localDataKey = `userData_${user?.uid}`;\n                localStorage.setItem(localDataKey, JSON.stringify(updatePayload));\n\n                // Firebase\n                if (user?.uid) {\n                    // Mark as unsynced BEFORE starting sync to protect local data on refresh\n                    if (didUpdateDebts) {\n                        try { localStorage.setItem(`debts_unsynced_${user.uid}`, 'true'); } catch { }\n                    }\n\n                    const syncPromises = [];\n\n                    // Explicit sync to 'debts' collection for the specific changed debt - DISABLED\n                    /*\n                    if (didUpdateDebts) {\n                        const debtToSync = isAdjustment ? finalSelectedDebt : pendingDebtToCreate;\n                        if (debtToSync) {\n                             syncPromises.push(\n                                 (async () => {\n                                     try {\n                                        const debtRef = doc(db, 'debts', debtToSync.id);\n                                        const p: any = { \n                                            ...debtToSync, \n                                            userId: user.uid, \n                                            shopId: shopIdCtx || profile?.shopId || null, \n                                            lastUpdated: new Date().toISOString() \n                                        };\n                                        Object.keys(p).forEach(key => p[key] === undefined && delete p[key]);\n                                        await setDoc(debtRef, p, { merge: true });\n                                     } catch (e) {\n                                         console.error('Failed to sync debt to collection:', e);\n                                     }\n                                 })()\n                             );\n                        }\n                    }\n                    */\n\n                    // 1. Update userData (Main Sync)\n                    syncPromises.push(\n                        userDataService.updateUserData(user.uid, updatePayload)\n                            .then(() => {\n                                if (didUpdateCash || didUpdateWallet) {\n                                    localStorage.removeItem(localDataKey);\n                                    setHasLocalDataToSync(false);\n                                }\n                                // We don't clear debts_unsynced here yet, wait for all\n                            })\n                    );\n\n                    // 2. Parallel Update to dashboardData (for Shop view)\n                    const sid = (shopIdCtx || profile?.shopId);\n                    if (sid && (didUpdateCash || didUpdateWallet)) {\n                         const dashPayload: any = { lastUpdated: timestamp };\n                         if (didUpdateCash) dashPayload.cashBalance = newCashBalanceValue;\n                         if (didUpdateWallet) dashPayload.walletBalances = newWalletBalancesValue;\n                         syncPromises.push(\n                            setDoc(doc(db, 'dashboardData', sid), dashPayload, { merge: true })\n                                .catch(e => console.error('Failed to sync to dashboardData', e))\n                         );\n                    }\n\n                    // 3. Parallel Update to debts collection (Robust Persistence) - DISABLED\n                    /*\n                    if (didUpdateDebts || isAdjustment) {\n                        const debtsToSync = [];\n                        if (isAdjustment && finalSelectedDebt) {\n                            debtsToSync.push(finalSelectedDebt);\n                        } else if (pendingDebtToCreate) {\n                            debtsToSync.push(pendingDebtToCreate);\n                        }\n                        \n                        // Sync specific debts\n                        const debtPromises = debtsToSync.map(debtItem => {\n                             if (!debtItem.id) return Promise.resolve();\n                             const debtRef = doc(db, 'debts', debtItem.id);\n                             const debtPayload: any = {\n                                 ...debtItem,\n                                 userId: user.uid,\n                                 shopId: shopIdCtx || profile?.shopId || null,\n                                 lastUpdated: timestamp,\n                                 amount: Number(debtItem.amount || 0),\n                                 paidAmount: Number(debtItem.paidAmount || 0),\n                                 createdAt: debtItem.createdAt || new Date(),\n                                 partialPayments: debtItem.partialPayments || []\n                             };\n                             Object.keys(debtPayload).forEach(key => {\n                                 if (debtPayload[key] === undefined) delete debtPayload[key];\n                             });\n                             return setDoc(debtRef, debtPayload, { merge: true });\n                        });\n                        syncPromises.push(...debtPromises);\n                    }\n                    */\n\n                    // Handle completion of all syncs\n                    Promise.all(syncPromises)\n                        .then(() => {\n                            // All syncs success\n                            if (didUpdateDebts) {\n                                try { localStorage.removeItem(`debts_unsynced_${user.uid}`); } catch { }\n                            }\n                        })\n                        .catch(err => {\n                            console.error('Sync error:', err);\n                            setHasLocalDataToSync(true);\n                            // Flag remains true (already set at start)\n                        });\n                }\n                }}\n                // --- NEW CONSOLIDATED LOGIC END ---\n\n\n            >\n              {pendingDebtAdjustment?.type === 'decrease' ? ' ' : ' '}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*    */}\n      <Dialog open={isDebtReceiptOpen} onOpenChange={setIsDebtReceiptOpen}>\n        <DialogContent className=\"w-[95vw] sm:w-auto sm:max-w-[425px] rounded-2xl\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\"> </DialogTitle>\n          </DialogHeader>\n          {selectedDebt && (\n            <div className=\"grid gap-4 py-4\">\n              <div className=\"text-center border-b pb-4\">\n                <h2 className=\"text-xl font-bold\"> </h2>\n                <p className=\"text-sm text-gray-500\">\n                  {dateFormatter.format(selectedDebt.createdAt instanceof Date ? selectedDebt.createdAt : new Date(selectedDebt.createdAt))}\n                </p>\n              </div>\n\n              <div className=\"space-y-3\">\n                <div className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                  <span className=\"font-medium\"> :</span>\n                  <span>{selectedDebt.debtorName}</span>\n                </div>\n                <div className=\"flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center\">\n                  <span className=\"font-medium\">:</span>\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      className=\"h-10 w-10 sm:h-8 sm:w-8 p-0\"\n                      aria-label=\" \"\n                      onClick={() => {\n                        setDebtAdjustType('decrease');\n                        setDebtAdjustAmount('');\n                        //          \n                        setIsDebtReceiptOpen(false);\n                        setIsDebtAdjustDialogOpen(true);\n                      }}\n                    >\n                      \n                    </Button>\n                    <span className=\"font-bold text-xl sm:text-lg\">{selectedDebt.amount} </span>\n                    <Button\n                      variant=\"outline\"\n                      className=\"h-10 w-10 sm:h-8 sm:w-8 p-0\"\n                      aria-label=\" \"\n                      onClick={() => {\n                        setDebtAdjustType('increase');\n                        setDebtAdjustAmount('');\n                        //          \n                        setIsDebtReceiptOpen(false);\n                        setIsDebtAdjustDialogOpen(true);\n                      }}\n                    >\n                      +\n                    </Button>\n                  </div>\n                </div>\n                {(() => {\n                  try {\n                    const profit = (transactions || []).filter((t: any) => String(t?.linkedDebtId || '') === String(selectedDebt.id))\n                      .reduce((sum: number, t: any) => sum + Math.max(0, Number(t?.commission || 0)), 0);\n                    return profit > 0 ? (\n                      <div className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                        <span className=\"font-medium\">:</span>\n                        <span className=\"text-green-700 font-semibold\">{profit} </span>\n                      </div>\n                    ) : null;\n                  } catch {\n                    return null;\n                  }\n                })()}\n                <div className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                  <span className=\"font-medium\"> :</span>\n                  <span>{selectedDebt.reason}</span>\n                </div>\n                <div className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                  <span className=\"font-medium\">:</span>\n                  <Badge\n                    variant={selectedDebt.status === 'paid' ? 'default' : 'secondary'}\n                    className={`${selectedDebt.status === 'paid' ? 'bg-green-500' : 'bg-yellow-500'} w-fit text-[12px] sm:text-xs`}\n                  >\n                    {selectedDebt.status === 'paid' ? '' : ''}\n                  </Badge>\n                </div>\n                {/*      */}\n                {(() => {\n                  try {\n                    const related = (transactions || []).filter((t: any) => String(t?.linkedDebtId || '') === String(selectedDebt.id));\n                    const profit = related.reduce((sum: number, t: any) => sum + Math.max(0, Number(t?.commission || 0)), 0);\n                    const principal = related.reduce((sum: number, t: any) => sum + Math.max(0, Number((t?.sentAmount ?? t?.transferredAmount ?? t?.withdrawnAmount ?? t?.amount) || 0)), 0);\n                    const base = Number(selectedDebt.amount || 0);\n                    const paid = Number(selectedDebt.paidAmount || 0);\n                    const shouldIncludeProfit = base < (principal + profit);\n                    const totalDue = shouldIncludeProfit ? (base + profit) : base;\n                    const remaining = Math.max(0, Number(totalDue) - paid);\n                    return (\n                      <div className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                        <span className=\"font-medium\"> :</span>\n                        <span className=\"font-bold text-xl sm:text-lg\">{remaining} </span>\n                      </div>\n                    );\n                  } catch {\n                    return (\n                      <div className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                        <span className=\"font-medium\"> :</span>\n                        <span className=\"font-bold text-xl sm:text-lg\">{Number(selectedDebt.amount || 0) - Number(selectedDebt.paidAmount || 0)} </span>\n                      </div>\n                    );\n                  }\n                })()}\n                {selectedDebt.paidAmount ? (\n                  <div className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                    <span className=\"font-medium\"> :</span>\n                    <span className=\"text-green-700\">{selectedDebt.paidAmount} </span>\n                  </div>\n                ) : null}\n                <div className=\"mt-3 p-4 border rounded-xl bg-gray-50\">\n                  {!isPartialPaymentOpen ? (\n                    <Button\n                      variant=\"outline\"\n                      className=\"w-full\"\n                      onClick={() => setIsPartialPaymentOpen(true)}\n                    >\n                       \n                    </Button>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"partialAmount\" className=\"text-right block\">  </Label>\n                      <Input\n                        id=\"partialAmount\"\n                        type=\"number\"\n                        value={partialPaymentAmount}\n                        onChange={(e) => setPartialPaymentAmount(e.target.value)}\n                        className=\"text-right\"\n                        placeholder=\" \"\n                      />\n                      <div className=\"flex gap-2\">\n                        <Button\n                          variant=\"outline\"\n                          onClick={() => {\n                            setIsPartialPaymentOpen(false);\n                            setPartialPaymentAmount('');\n                          }}\n                        >\n                          \n                        </Button>\n                        <Button\n                          className=\"bg-blue-600 hover:bg-blue-700\"\n                          onClick={async () => {\n                            const amt = parseFloat(partialPaymentAmount);\n                            if (!selectedDebt || isNaN(amt) || amt <= 0) {\n                              toast({\n                                title: '',\n                                description: '   ',\n                                variant: 'destructive',\n                              });\n                              return;\n                            }\n                            const remainingBefore = Math.max(0, Number(selectedDebt.amount || 0) - Number(selectedDebt.paidAmount || 0));\n                            if (amt > remainingBefore) {\n                              toast({\n                                title: ' ',\n                                description: '    ',\n                                variant: 'destructive',\n                              });\n                              return;\n                            }\n\n                            const newPaidTotal = Number(((selectedDebt.paidAmount || 0) + amt).toFixed(2));\n                            const isFullyPaid = newPaidTotal >= Number(selectedDebt.amount || 0);\n                            const updated: Debt = {\n                              ...selectedDebt,\n                              amount: Number(selectedDebt.amount || 0),\n                              paidAmount: newPaidTotal,\n                              status: isFullyPaid ? 'paid' : 'pending',\n                              partialPayments: [\n                                ...(selectedDebt.partialPayments || []),\n                                { amount: amt, paidAt: new Date() }\n                              ]\n                            };\n\n                            const updatedDebts = debts.map(d => d.id === selectedDebt.id ? updated : d);\n                            setDebts(updatedDebts);\n                            setSelectedDebt(updated);\n                            await saveDebtsToStorage(updatedDebts);\n                            try { if (user?.uid) { const remaining = Math.max(0, Number(updated.amount || 0) - Number(updated.paidAmount || 0)); await telegramNotifier.send(user.uid, `     ${updated.debtorName}:  ${amt}   ${remaining} `); } } catch {}\n                            //              \n                            try {\n                              if (updated.status === 'paid' && user?.uid) {\n                                (async () => {\n                                  const q = fsQuery(\n                                    collection(db, 'userTransactions'),\n                                    where('userId', '==', user.uid),\n                                    where('linkedDebtId', '==', selectedDebt.id),\n                                    where('status', '==', 'pending')\n                                  );\n                                  const snap = await getDocs(q);\n                                  await Promise.allSettled(\n                                    snap.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\n                                  );\n                                  try {\n                                    const ids = snap.docs.map(d => String((d.data() as any)?.transactionId || ''));\n                                    if (user?.uid) ids.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\n                                  } catch { }\n                                  const q2 = fsQuery(\n                                    collection(db, 'transactions'),\n                                    where('userId', '==', user.uid),\n                                    where('linkedDebtId', '==', selectedDebt.id),\n                                    where('status', '==', 'pending')\n                                  );\n                                  const snap2 = await getDocs(q2);\n                                  await Promise.allSettled(\n                                    snap2.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\n                                  );\n                                  try {\n                                    const ids2 = snap2.docs.map(d => String(d.id || (d.data() as any)?.transactionId || ''));\n                                    if (user?.uid) ids2.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\n                                  } catch { }\n                                  const q3 = fsQuery(\n                                    collection(db, 'transactions'),\n                                    where('merchantUserId', '==', user.uid),\n                                    where('linkedDebtId', '==', selectedDebt.id),\n                                    where('status', '==', 'pending')\n                                  );\n                                  const snap3 = await getDocs(q3);\n                                  await Promise.allSettled(\n                                    snap3.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\n                                  );\n                                  try {\n                                    const ids3 = snap3.docs.map(d => String(d.id || (d.data() as any)?.transactionId || ''));\n                                    if (user?.uid) ids3.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\n                                  } catch { }\n                                })().catch((e) => {\n                                  console.error('     :', e);\n                                  toast({ title: '   ', description: '     ', variant: 'destructive' });\n                                });\n                              }\n                            } catch (e) {\n                              console.error('     :', e);\n                            }\n                            try {\n                              const localKey = getTransactionsKey();\n                              const raw = localStorage.getItem(localKey);\n                              if (raw) {\n                                const arr = JSON.parse(raw) || [];\n                                const updatedArr = arr.map((t: any) =>\n                                  (t?.linkedDebtId === selectedDebt.id && t?.status === 'pending')\n                                    ? { ...t, status: 'completed', confirmedAt: new Date() }\n                                    : t\n                                );\n                                localStorage.setItem(localKey, JSON.stringify(updatedArr));\n                                setTransactions(prev => prev.map((t: any) =>\n                                  (t?.linkedDebtId === selectedDebt.id && t?.status === 'pending')\n                                    ? { ...t, status: 'completed', confirmedAt: new Date() }\n                                    : t\n                                ));\n                              }\n                            } catch (err) {\n                              console.warn('        :', err);\n                            }\n                            //          \n                            setPaymentAmountPending(amt);\n                            setPaymentCreditSource('none');\n                            setIsPaymentCreditChoiceOpen(true);\n                            setIsPartialPaymentOpen(false);\n                            setPartialPaymentAmount('');\n                            toast({\n                              title: '   ',\n                              description: `  ${amt}   ${new Date().toLocaleString('ar-EG')}`,\n                            });\n                          }}\n                        >\n                          \n                        </Button>\n                      </div>\n                    </div>\n                  )}\n                  {selectedDebt.partialPayments && selectedDebt.partialPayments.length > 0 && (\n                    <div className=\"mt-3 text-[12px] sm:text-xs text-gray-600\">\n                      <p className=\"font-medium mb-1\">  :</p>\n                      <div className=\"space-y-1 max-h-[30vh] sm:max-h-24 overflow-y-auto\">\n                        {selectedDebt.partialPayments.map((p, idx) => (\n                          <div key={idx} className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                            <span>: {p.amount} </span>\n                            <span>{new Date(p.paidAt).toLocaleString('ar-EG')}</span>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n          <DialogFooter className=\"flex gap-2 justify-center\">\n            <Button\n              onClick={async () => {\n                if (selectedDebt) {\n                  const updatedDebts = debts.map(debt =>\n                    debt.id === selectedDebt.id\n                      ? { ...debt, status: 'pending' as const }\n                      : debt\n                  );\n                  setDebts(updatedDebts);\n\n                  //    \n                  await saveDebtsToStorage(updatedDebts);\n                  try { if (user?.uid) { const payAmount = computedRemaining; await telegramNotifier.send(user.uid, `     ${selectedDebt.debtorName}:  ${payAmount} `); } } catch {}\n\n                  setIsDebtReceiptOpen(false);\n                  toast({\n                    title: \"   \",\n                    description: \"   \",\n                  });\n                }\n              }}\n              variant=\"outline\"\n              className=\"bg-yellow-500 hover:bg-yellow-600 text-white\"\n            >\n              \n            </Button>\n            <Button\n              onClick={async () => {\n                if (selectedDebt) {\n                  const base = Number(selectedDebt.amount || 0);\n                  const paid = Number(selectedDebt.paidAmount || 0);\n                  let computedRemaining = Math.max(0, base - paid);\n                  try {\n                    const related = (transactions || []).filter((t: any) => String(t?.linkedDebtId || '') === String(selectedDebt.id));\n                    const profit = related.reduce((sum: number, t: any) => sum + Math.max(0, Number(t?.commission || 0)), 0);\n                    const principal = related.reduce((sum: number, t: any) => sum + Math.max(0, Number((t?.sentAmount ?? t?.transferredAmount ?? t?.withdrawnAmount ?? t?.amount) || 0)), 0);\n                    const shouldIncludeProfit = base < (principal + profit);\n                    const totalDue = shouldIncludeProfit ? (base + profit) : base;\n                    computedRemaining = Math.max(0, Number(totalDue) - paid);\n                  } catch { }\n                  const payAmount = computedRemaining;\n                  const updatedDebts = debts.map(debt => {\n                    if (debt.id !== selectedDebt.id) return debt;\n                    const baseAmt = Number(debt.amount || 0);\n                    const prevPaid = Number(debt.paidAmount || 0);\n                    const newPaidTotal = Number((prevPaid + payAmount).toFixed(2));\n                    const isFullyPaid = newPaidTotal >= baseAmt;\n                    return {\n                      ...debt,\n                      amount: baseAmt,\n                      paidAmount: isFullyPaid ? baseAmt : newPaidTotal,\n                      status: 'paid' as const,\n                      partialPayments: [\n                        ...(debt.partialPayments || []),\n                        ...(payAmount > 0 ? [{ amount: payAmount, paidAt: new Date() }] : [])\n                      ]\n                    };\n                  });\n                  setDebts(updatedDebts);\n                  try { setSelectedDebt(updatedDebts.find(d => d.id === selectedDebt.id) || null); } catch {}\n\n                  setPaymentAmountPending(payAmount);\n                  setPaymentCreditSource('none');\n                  setIsPaymentCreditChoiceOpen(true);\n\n                  //    \n                  await saveDebtsToStorage(updatedDebts);\n\n                  // Explicit sync to 'debts' collection - DISABLED\n                  /*\n                  try {\n                    const updatedDebt = updatedDebts.find(d => d.id === selectedDebt.id);\n                    if (user?.uid && updatedDebt?.id) {\n                        const debtRef = doc(db, 'debts', updatedDebt.id);\n                        const p: any = { \n                            ...updatedDebt, \n                            userId: user.uid, \n                            shopId: shopIdCtx || profile?.shopId || null, \n                            lastUpdated: new Date().toISOString() \n                        };\n                        Object.keys(p).forEach(key => p[key] === undefined && delete p[key]);\n                        await setDoc(debtRef, p, { merge: true });\n                    }\n                  } catch (e) {\n                    console.error('Failed to sync debt payment to collection:', e);\n                  }\n                  */\n\n                  //       \n                  try {\n                    if (user?.uid && selectedDebt?.id) {\n                      (async () => {\n                        const q = fsQuery(\n                          collection(db, 'userTransactions'),\n                          where('userId', '==', user.uid),\n                          where('linkedDebtId', '==', selectedDebt.id),\n                          where('status', '==', 'pending')\n                        );\n                        const snap = await getDocs(q);\n                        await Promise.allSettled(\n                          snap.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\n                        );\n                        try {\n                          const ids = snap.docs.map(d => String((d.data() as any)?.transactionId || ''));\n                          if (user?.uid) ids.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\n                        } catch { }\n                        const q2 = fsQuery(\n                          collection(db, 'transactions'),\n                          where('userId', '==', user.uid),\n                          where('linkedDebtId', '==', selectedDebt.id),\n                          where('status', '==', 'pending')\n                        );\n                        const snap2 = await getDocs(q2);\n                        await Promise.allSettled(\n                          snap2.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\n                        );\n                        try {\n                          const ids2 = snap2.docs.map(d => String(d.id || (d.data() as any)?.transactionId || ''));\n                          if (user?.uid) ids2.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\n                        } catch { }\n                        const q3 = fsQuery(\n                          collection(db, 'transactions'),\n                          where('merchantUserId', '==', user.uid),\n                          where('linkedDebtId', '==', selectedDebt.id),\n                          where('status', '==', 'pending')\n                        );\n                        const snap3 = await getDocs(q3);\n                        await Promise.allSettled(\n                          snap3.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\n                        );\n                        try {\n                          const ids3 = snap3.docs.map(d => String(d.id || (d.data() as any)?.transactionId || ''));\n                          if (user?.uid) ids3.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\n                        } catch { }\n                      })().catch((e) => {\n                        console.error('     :', e);\n                        toast({ title: '   ', description: '     ', variant: 'destructive' });\n                      });\n                    }\n                  } catch (e) {\n                    console.error('     :', e);\n                  }\n\n                  try {\n                    const localKey = getTransactionsKey();\n                    const raw = localStorage.getItem(localKey);\n                    if (raw) {\n                      const arr = JSON.parse(raw) || [];\n                      const updatedArr = arr.map((t: any) =>\n                        (t?.linkedDebtId === selectedDebt.id && t?.status === 'pending')\n                          ? { ...t, status: 'completed', confirmedAt: new Date() }\n                          : t\n                      );\n                      localStorage.setItem(localKey, JSON.stringify(updatedArr));\n                      setTransactions(prev => prev.map((t: any) =>\n                        (t?.linkedDebtId === selectedDebt.id && t?.status === 'pending')\n                          ? { ...t, status: 'completed', confirmedAt: new Date() }\n                          : t\n                      ));\n                    }\n                  } catch (err) {\n                    console.warn('        :', err);\n                  }\n\n                  setIsDebtReceiptOpen(false);\n                  toast({\n                    title: \"   \",\n                    description: \"   \",\n                  });\n                }\n              }}\n              className=\"bg-green-500 hover:bg-green-600\"\n            >\n              \n            </Button>\n            <Button\n              onClick={async () => {\n                if (selectedDebt) {\n                  const updatedDebts = debts.filter(debt => debt.id !== selectedDebt.id);\n                  setDebts(updatedDebts);\n\n                  // Delete from Firestore 'debts' collection explicitly - DISABLED\n                  /*\n                  try {\n                    if (user?.uid && selectedDebt.id) {\n                      await deleteDoc(doc(db, 'debts', selectedDebt.id));\n                    }\n                  } catch (e) {\n                    console.error('Failed to delete debt doc:', e);\n                  }\n                  */\n\n                  //    \n                  await saveDebtsToStorage(updatedDebts);\n\n                  setIsDebtReceiptOpen(false);\n                  toast({\n                    title: \"  \",\n                    description: \"   \",\n                  });\n                }\n              }}\n              variant=\"destructive\"\n            >\n              \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*       */}\n      <Dialog open={isDebtAdjustDialogOpen} onOpenChange={setIsDebtAdjustDialogOpen}>\n        <DialogContent className=\"sm:max-w-md rounded-2xl shadow-elegant border border-gray-200\">\n          <DialogHeader>\n            <DialogTitle className={`text-right ${debtAdjustType === 'decrease' ? 'text-red-600' : 'text-green-600'}`}>\n              {debtAdjustType === 'decrease' ? '  ' : debtAdjustType === 'increase' ? '  ' : '  '}\n            </DialogTitle>\n            <DialogDescription className=\"text-right\">\n                    {debtAdjustType === 'decrease' ? '' : ''}.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-2\">\n            <Label htmlFor=\"debtAdjustAmount\" className=\"text-right\"> ()</Label>\n            <Input id=\"debtAdjustAmount\" type=\"number\" placeholder=\"0.00\" value={debtAdjustAmount}\n              onChange={(e) => setDebtAdjustAmount(e.target.value)} />\n            {selectedDebt && (\n              <div className=\"text-right text-sm text-muted-foreground\">\n                 : <span className=\"font-semibold\">{Number(selectedDebt.amount || 0).toFixed(2)}</span> \n              </div>\n            )}\n          </div>\n          <DialogFooter className=\"flex gap-2\">\n            <Button variant=\"secondary\" onClick={() => { setIsDebtAdjustDialogOpen(false); setIsDebtReceiptOpen(true); }}></Button>\n            <Button\n              className={debtAdjustType === 'decrease' ? 'bg-red-600 hover:bg-red-700' : 'bg-green-600 hover:bg-green-700'}\n              onClick={async () => {\n                try {\n                  if (!selectedDebt || !debtAdjustType) return;\n                  const delta = Number(parseFloat(debtAdjustAmount || '0').toFixed(2));\n                  if (!delta || isNaN(delta) || delta <= 0) {\n                    toast({ title: '  ', description: '     ', variant: 'destructive' });\n                    return;\n                  }\n                  setPendingDebtToCreate(null);\n                  setPendingDebtAdjustment({ debtId: selectedDebt.id, delta, type: debtAdjustType });\n                  setIsDebtAdjustDialogOpen(false);\n                  setIsDebtDeductionChoiceOpen(true);\n                } catch (e) {\n                  console.error('    :', e);\n                  toast({ title: '', description: '    ', variant: 'destructive' });\n                }\n              }}\n            >\n              \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*          */}\n      <Dialog open={isPaymentCreditChoiceOpen} onOpenChange={setIsPaymentCreditChoiceOpen}>\n        <DialogContent className=\"sm:max-w-[480px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\">    </DialogTitle>\n            <DialogDescription className=\"text-right\">\n                         \n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-3\">\n            <div className=\"flex flex-wrap gap-2 justify-center\">\n              <Button\n                variant={paymentCreditSource === 'cash' ? 'default' : 'outline'}\n                className={paymentCreditSource === 'cash' ? 'bg-blue-600 text-white' : ''}\n                size=\"sm\"\n                onClick={() => setPaymentCreditSource('cash')}\n              >\n                 \n              </Button>\n              <Button\n                variant={paymentCreditSource === 'wallet' ? 'default' : 'outline'}\n                className={paymentCreditSource === 'wallet' ? 'bg-blue-600 text-white' : ''}\n                size=\"sm\"\n                onClick={() => setPaymentCreditSource('wallet')}\n              >\n                 \n              </Button>\n              <Button\n                variant={paymentCreditSource === 'fawry' ? 'default' : 'outline'}\n                className={paymentCreditSource === 'fawry' ? 'bg-amber-600 text-white' : ''}\n                size=\"sm\"\n                onClick={() => setPaymentCreditSource('fawry')}\n              >\n                \n              </Button>\n              <Button\n                variant={paymentCreditSource === 'none' ? 'default' : 'outline'}\n                className={paymentCreditSource === 'none' ? 'bg-gray-600 text-white' : ''}\n                size=\"sm\"\n                onClick={() => setPaymentCreditSource('none')}\n              >\n                 \n              </Button>\n            </div>\n            {paymentCreditSource === 'wallet' && (\n              <div className=\"space-y-2\">\n                <label className=\"block text-right\">  </label>\n                <select\n                  className=\"w-full border rounded p-2 text-right\"\n                  value={selectedWalletForPaymentCredit}\n                  onChange={(e) => setSelectedWalletForPaymentCredit(e.target.value)}\n                >\n                  <option value=\"\">   </option>\n                  {(wallets && wallets.length > 0\n                    ? wallets.map((w) => (\n                      <option key={w.id} value={w.id}>\n                        {w.phone || w.name || w.id}\n                      </option>\n                    ))\n                    : Object.keys(walletBalances || {}).map((wid) => (\n                      <option key={wid} value={wid}>\n                        {wallets.find(w => w.id === wid)?.phone\n                          || (cachedLocalWallets?.find((w: any) => w.id === wid)?.phone)\n                          || (cachedLocalWallets?.find((w: any) => w.id === wid)?.name)\n                          || (wallets.find(w => w.id === wid)?.name)\n                          || wid}\n                      </option>\n                    ))\n                  )}\n                </select>\n              </div>\n            )}\n            <div className=\"text-right text-sm text-gray-600\">\n                : <span className=\"font-bold\">{paymentAmountPending} </span>\n            </div>\n          </div>\n          <DialogFooter className=\"flex flex-wrap justify-between gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsPaymentCreditChoiceOpen(false);\n                setPaymentAmountPending(0);\n                setPaymentCreditSource(null);\n                setSelectedWalletForPaymentCredit('');\n              }}\n            >\n              \n            </Button>\n              <Button\n                onClick={async () => {\n                  try {\n                    const amt = paymentAmountPending;\n                    if (!amt || amt <= 0) {\n                      setIsPaymentCreditChoiceOpen(false);\n                      return;\n                    }\n                    \n                    // Create Receipt Logic reused for all types except 'none' if needed\n                    const createReceipt = async (method: string, walletId?: string | null) => {\n                         if (user?.uid && selectedDebt) {\n                             try {\n                                const newTxnId = doc(collection(db, 'dummy_collection')).id; \n                                const txnData = {\n                                   transactionId: newTxnId,\n                                   amount: amt,\n                                   transactionType: 'cash_addition', \n                                   type: 'cash_addition',\n                                   status: 'completed',\n                                   createdAt: new Date(),\n                                   senderName: selectedDebt.debtorName,\n                                   receiverName: '',\n                                   description: `    ${selectedDebt.debtorName}`,\n                                   paymentMethod: method,\n                                   walletId: walletId || null,\n                                   linkedDebtId: selectedDebt.id,\n                                   isDebtRepayment: true\n                                };\n                                await userDataService.saveUserTransaction(user.uid, txnData as any);\n                                try { queryClientHook.invalidateQueries({ queryKey: ['recentTransactions', user?.uid] }); } catch {}\n                             } catch (e) {\n                                console.error('Failed to create repayment receipt:', e);\n                             }\n                         }\n                    };\n\n                    if (paymentCreditSource === 'cash') {\n                    const newCashBalance = cashBalance + amt;\n                    setCashBalance(newCashBalance);\n                    localStorage.setItem(getCashBalanceKey(), newCashBalance.toString());\n                    const updateData = { cashBalance: newCashBalance, lastUpdated: new Date().toISOString() };\n                    const localDataKey = `userData_${user?.uid}`;\n                    localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                    if (user?.uid) {\n                      userDataService.updateUserData(user.uid, updateData).catch(() => setHasLocalDataToSync(true));\n                      localStorage.removeItem(localDataKey);\n                      setHasLocalDataToSync(false);\n                    } else {\n                      setHasLocalDataToSync(true);\n                    }\n                      toast({\n                        title: '   ',\n                        description: `  ${amt}    `,\n                      });\n                      await createReceipt('cash');\n                      try {\n                        if (selectedDebt) {\n                          const updatedDebts = debts.map(d => d.id === selectedDebt.id ? { ...d, status: 'paid' as const, paidAmount: Math.max(Number(d.paidAmount || 0), Number(d.amount || 0)) } : d);\n                          setDebts(updatedDebts);\n                          try { setSelectedDebt(updatedDebts.find(d => d.id === selectedDebt.id) || null); } catch {}\n                          try { await saveDebtsToStorage(updatedDebts); } catch {}\n                          \n                          // Explicit sync to collection - DISABLED\n                          /*\n                          try {\n                             if (user?.uid && selectedDebt.id) {\n                                 const d = updatedDebts.find(x => x.id === selectedDebt.id);\n                                 if (d) {\n                                     const debtRef = doc(db, 'debts', d.id);\n                                     const p: any = { \n                                         ...d, \n                                         userId: user.uid, \n                                         shopId: shopIdCtx || profile?.shopId || null, \n                                         lastUpdated: new Date().toISOString() \n                                     };\n                                     Object.keys(p).forEach(key => p[key] === undefined && delete p[key]);\n                                     await setDoc(debtRef, p, { merge: true });\n                                 }\n                             }\n                          } catch (e) { console.error('Failed to sync final payment to collection (none):', e); }\n                          */\n                        }\n                      } catch {}\n                    } else if (paymentCreditSource === 'wallet') {\n                    if (!selectedWalletForPaymentCredit) {\n                      toast({\n                        title: '  ',\n                        description: '      ',\n                        variant: 'destructive',\n                      });\n                      return;\n                    }\n                    const updatedBalances = {\n                      ...walletBalances,\n                      [selectedWalletForPaymentCredit]: (walletBalances[selectedWalletForPaymentCredit] || 0) + amt,\n                    };\n                    setWalletBalances(updatedBalances);\n\n                    const timestamp = new Date().toISOString();\n                    const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp };\n                    const localDataKey = `userData_${user?.uid}`;\n                    localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n                    localStorage.setItem(`walletBalances_backup_${timestamp}`, JSON.stringify(updatedBalances));\n                    if (user?.uid) {\n                      userDataService.updateUserData(user.uid, updateData).catch(() => setHasLocalDataToSync(true));\n                      try { localStorage.removeItem(localDataKey); } catch { }\n                      setHasLocalDataToSync(false);\n                    } else {\n                      setHasLocalDataToSync(true);\n                    }\n                      toast({\n                        title: '   ',\n                        description: `  ${amt}    ${(wallets.find(w => w.id === selectedWalletForPaymentCredit)?.phone || wallets.find(w => w.id === selectedWalletForPaymentCredit)?.name || selectedWalletForPaymentCredit)}`,\n                      });\n                      await createReceipt('wallet', selectedWalletForPaymentCredit);\n                      try {\n                        if (selectedDebt) {\n                          const updatedDebts = debts.map(d => d.id === selectedDebt.id ? { ...d, status: 'paid' as const, paidAmount: Math.max(Number(d.paidAmount || 0), Number(d.amount || 0)) } : d);\n                          setDebts(updatedDebts);\n                          try { setSelectedDebt(updatedDebts.find(d => d.id === selectedDebt.id) || null); } catch {}\n                          try { await saveDebtsToStorage(updatedDebts); } catch {}\n                        }\n                      } catch {}\n                    } else if (paymentCreditSource === 'none') {\n                      toast({\n                        title: '  ',\n                        description: `  ${amt}    `,\n                      });\n                      try {\n                        if (selectedDebt) {\n                          const updatedDebts = debts.map(d => d.id === selectedDebt.id ? { ...d, status: 'paid' as const, paidAmount: Math.max(Number(d.paidAmount || 0), Number(d.amount || 0)) } : d);\n                          setDebts(updatedDebts);\n                          try { setSelectedDebt(updatedDebts.find(d => d.id === selectedDebt.id) || null); } catch {}\n                          try { await saveDebtsToStorage(updatedDebts); } catch {}\n                          \n                          // Explicit sync to collection (None) - DISABLED\n                          /*\n                          try {\n                             if (user?.uid && selectedDebt.id) {\n                                 const d = updatedDebts.find(x => x.id === selectedDebt.id);\n                                 if (d) {\n                                     const debtRef = doc(db, 'debts', d.id);\n                                     const p: any = { \n                                         ...d, \n                                         userId: user.uid, \n                                         shopId: shopIdCtx || profile?.shopId || null, \n                                         lastUpdated: new Date().toISOString() \n                                     };\n                                     Object.keys(p).forEach(key => p[key] === undefined && delete p[key]);\n                                     await setDoc(debtRef, p, { merge: true });\n                                 }\n                             }\n                          } catch (e) { console.error('Failed to sync final payment to collection (none):', e); }\n                          */\n                        }\n                      } catch {}\n                    } else if (paymentCreditSource === 'fawry') {\n                    //        \n                    toast({\n                      title: '    ',\n                      description: `  ${amt}       `,\n                      });\n                      await createReceipt('fawry');\n                    } else {\n                    toast({\n                      title: '  ',\n                      description: '       ',\n                      variant: 'destructive',\n                    });\n                    return;\n                    }\n\n                    try {\n                      const sentAmt = amt > 0 ? amt : Number(selectedDebt?.amount || 0);\n                      if (user?.uid && selectedDebt) {\n                        await telegramNotifier.send(user.uid, `     ${selectedDebt.debtorName}:  ${sentAmt} `);\n                      }\n                    } catch {}\n                  } catch (e) {\n                    console.error('    :', e);\n                    toast({\n                      title: ' ',\n                      description: '      ',\n                    variant: 'destructive',\n                  });\n                } finally {\n                  setIsPaymentCreditChoiceOpen(false);\n                  setPaymentAmountPending(0);\n                  setPaymentCreditSource(null);\n                  setSelectedWalletForPaymentCredit('');\n                  try { setIsDebtReceiptsListOpen(true); } catch {}\n                }\n              }}\n              className=\"bg-green-600 hover:bg-green-700\"\n            >\n               \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*     / */}\n      <Dialog open={isPostConfirmPopupOpen} onOpenChange={setIsPostConfirmPopupOpen}>\n        <DialogContent hideClose className=\"post-confirm-card sm:max-w-[420px] w-[90vw] rounded-2xl bg-gradient-to-br from-white via-indigo-50 to-blue-50 shadow-2xl border border-indigo-100\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right text-2xl font-bold\">\n              {postConfirmInfo?.type === 'transfer' ? '  ' : '  '}\n            </DialogTitle>\n            <DialogDescription className=\"text-right text-gray-600\">\n              {postConfirmInfo?.type === 'transfer'\n                ? '        .'\n                : '       .'}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-3 flex flex-col items-center gap-1.5\">\n            <div className=\"text-xl sm:text-2xl font-bold text-blue-700 tracking-wide\">{formatNumberEnglish(postConfirmInfo?.amount || 0)} </div>\n            <div className=\"text-sm text-gray-500 text-right w-full\">\n              {postConfirmInfo?.type === 'transfer'\n                ? '    .'\n                : (isCommissionAddMode\n                  ? '      .'\n                  : '     .')}\n            </div>\n          </div>\n          <DialogFooter className=\"flex justify-end gap-2\">\n            {postConfirmInfo?.type === 'transfer' && (\n              <Button\n                variant=\"outline\"\n                id=\"sendCodeBtn\"\n                onClick={triggerSendTransferCode}\n                disabled={ussdLoading}\n                className=\"btn-transfer-confirm\"\n              >\n                {ussdLoading ? ' ...' : '  '}\n              </Button>\n            )}\n            <Button\n              onClick={() => {\n                setIsPostConfirmPopupOpen(false);\n                setPostConfirmInfo(null);\n              }}\n              className=\"bg-green-600 hover:bg-green-700 text-white\"\n            >\n              {postConfirmInfo?.type === 'transfer' ? ' ' : ' '}\n            </Button>\n          </DialogFooter>\n          {postConfirmInfo?.type === 'transfer' && (\n             <div className=\"mt-4 border-t pt-4 w-full\">\n               <div className=\"flex justify-center gap-4\">\n                  <Button \n                    variant={selectedSimSlotForTransfer === 0 ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setSelectedSimSlotForTransfer(0)}\n                    className={`flex-1 h-10 ${selectedSimSlotForTransfer === 0 ? \"bg-blue-600 hover:bg-blue-700 text-white\" : \"border-blue-200 text-blue-700 hover:bg-blue-50\"}`}\n                  >\n                    SIM 1\n                  </Button>\n                  <Button \n                    variant={selectedSimSlotForTransfer === 1 ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setSelectedSimSlotForTransfer(1)}\n                    className={`flex-1 h-10 ${selectedSimSlotForTransfer === 1 ? \"bg-blue-600 hover:bg-blue-700 text-white\" : \"border-blue-200 text-blue-700 hover:bg-blue-50\"}`}\n                  >\n                    SIM 2\n                  </Button>\n               </div>\n             </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/*   PIN     */}\n      <PinModal\n        open={isPinModalOpen}\n        onClose={() => setIsPinModalOpen(false)}\n        onSubmit={handlePinSubmit}\n        deviceId={(lastDecoratedDeviceId || selectedAdbDeviceId || '')}\n        recipientMsisdn={String(\n          transactionType === 'transfer'\n            //            \n            ? (lastUSSDTransfer?.receiver || receiverPhone || '')\n            //         \n            : ((wallets.find(w => w.id === selectedWallet)?.phone) || '')\n        ).replace(/\\D/g, '')}\n      />\n\n      {/*     :       */}\n\n      <WalletsListDialog\n        isOpen={isWalletsListOpen}\n        onClose={() => setIsWalletsListOpen(false)}\n        wallets={wallets}\n        walletBalances={walletBalances}\n        onSelectWallet={(id) => {\n            setSelectedWallet(id);\n            const w = wallets.find(x => x.id === id);\n            if (w) {\n                setSenderPhone(w.phone);\n                try { localStorage.setItem(getSelectedWalletKey(), id); } catch {}\n            }\n            setIsWalletsListOpen(false);\n        }}\n        selectedWalletId={selectedWallet || undefined}\n      />\n\n      {/* Change Log Dialog */}\n      <ChangeLogDialog open={isChangeLogOpen} onOpenChange={setIsChangeLogOpen} />\n      \n      <BranchRequestDialog open={branchRequestOpen} onOpenChange={setBranchRequestOpen} />\n\n      {/*          */}\n      {showDesktopQuickIcons && <ChangeLogFloatingButton onClick={() => setIsChangeLogOpen(true)} />}\n\n      {/* Profile Settings Overlay */}\n      {isProfileSettingsOpen && (\n        <div className=\"fixed inset-0 z-[100] bg-white dark:bg-slate-950 overflow-y-auto\">\n          <ProfileSettingsPage onBack={() => setIsProfileSettingsOpen(false)} />\n        </div>\n      )}\n\n    </div>\n  );\n};\n\nexport default UserDashboardPage;\n"],"file":"assets/UserDashboardPage-Dfq0JLZl.js"}