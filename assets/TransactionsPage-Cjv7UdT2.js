const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dailyOperationCountService-DUs9kD6v.js","./index-5OsgE1a1.js","./index-C_Vc4bCD.css","./walletDailyLimitsService-DIs8vIey.js","./profitService-B71hwvHL.js"])))=>i.map(i=>d[i]);
import{O as Et,r as u,a9 as Ps,j as t,a3 as ks,a5 as Is,a6 as Oe,a7 as $e,aR as Es,W as Ye,u as Ot,B as A,w as Dt,Y as Pe,Z as ke,_ as Ie,$ as Ee,C as Xe,S as G,av as Ve,aS as N,a as Os,R as me,aT as Ls,ag as _s,y as K,i as I,z as ee,q as $,h as V,ar as M,aw as B,k as ae,aU as Ms,o as Ws,aV as ue,a1 as Bs,af as Ge,P as re,I as qe,aW as Fs,au as At,aX as Us,aY as zs,f as He,aD as $s,aZ as St,ae as q,Q as Ae}from"./index-5OsgE1a1.js";import{C as Vs,a as Gs,b as qs,d as Hs}from"./card-VG_EFcFK.js";import{u as Xs,S as Ks,a as Ys,b as Zs,c as Js,d as Se}from"./select-CyMPOmWC.js";import{B as Re}from"./badge-DXhAwLDt.js";import{c as Lt,R as Qs,I as ea}from"./index-B_RWudPl.js";import{A as Rt,a as Pt,C as ta,b as sa,f as F,M as aa,c as ra,R as na,I as ia}from"./MaintenanceDialog-BlLBUATp.js";import{M as Ke,P as oa}from"./MasterPinDialog-DvKB3JmP.js";import{r as kt,P as pe}from"./profitService-B71hwvHL.js";import{D as la}from"./dollar-sign-BQpRpLiN.js";import{C as _t}from"./calendar-DghfHu4V.js";import{A as ca}from"./arrow-left-BYNwv2Sh.js";import{S as da}from"./separator-Cy1lvQYF.js";import{T as It}from"./progress-BesIvueM.js";import{C as ma}from"./circle-x-DnwdY5sU.js";import{C as ua}from"./circle-check-big-CsFLgkpA.js";import"./index-BCZLaB78.js";import"./whatsappService-bWk4PDnM.js";import"./download-vQ6_C5D1.js";import"./label-CiKO8Eg3.js";import"./circle-alert-Be956GlJ.js";import"./shield-CXN8M3ci.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=Et("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=Et("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);var Le="Tabs",[xa]=ks(Le,[Lt]),Mt=Lt(),[fa,Ze]=xa(Le),Wt=u.forwardRef((j,s)=>{const{__scopeTabs:g,value:x,onValueChange:k,defaultValue:E,orientation:S="horizontal",dir:U,activationMode:L="automatic",...R}=j,T=Xs(U),[D,W]=Ps({prop:x,onChange:k,defaultProp:E??"",caller:Le});return t.jsx(fa,{scope:g,baseId:Is(),value:D,onValueChange:W,orientation:S,dir:T,activationMode:L,children:t.jsx(Oe.div,{dir:T,"data-orientation":S,...R,ref:s})})});Wt.displayName=Le;var Bt="TabsList",Ft=u.forwardRef((j,s)=>{const{__scopeTabs:g,loop:x=!0,...k}=j,E=Ze(Bt,g),S=Mt(g);return t.jsx(Qs,{asChild:!0,...S,orientation:E.orientation,dir:E.dir,loop:x,children:t.jsx(Oe.div,{role:"tablist","aria-orientation":E.orientation,...k,ref:s})})});Ft.displayName=Bt;var Ut="TabsTrigger",zt=u.forwardRef((j,s)=>{const{__scopeTabs:g,value:x,disabled:k=!1,...E}=j,S=Ze(Ut,g),U=Mt(g),L=Gt(S.baseId,x),R=qt(S.baseId,x),T=x===S.value;return t.jsx(ea,{asChild:!0,...U,focusable:!k,active:T,children:t.jsx(Oe.button,{type:"button",role:"tab","aria-selected":T,"aria-controls":R,"data-state":T?"active":"inactive","data-disabled":k?"":void 0,disabled:k,id:L,...E,ref:s,onMouseDown:$e(j.onMouseDown,D=>{!k&&D.button===0&&D.ctrlKey===!1?S.onValueChange(x):D.preventDefault()}),onKeyDown:$e(j.onKeyDown,D=>{[" ","Enter"].includes(D.key)&&S.onValueChange(x)}),onFocus:$e(j.onFocus,()=>{const D=S.activationMode!=="manual";!T&&!k&&D&&S.onValueChange(x)})})})});zt.displayName=Ut;var $t="TabsContent",Vt=u.forwardRef((j,s)=>{const{__scopeTabs:g,value:x,forceMount:k,children:E,...S}=j,U=Ze($t,g),L=Gt(U.baseId,x),R=qt(U.baseId,x),T=x===U.value,D=u.useRef(T);return u.useEffect(()=>{const W=requestAnimationFrame(()=>D.current=!1);return()=>cancelAnimationFrame(W)},[]),t.jsx(Es,{present:k||T,children:({present:W})=>t.jsx(Oe.div,{"data-state":T?"active":"inactive","data-orientation":U.orientation,role:"tabpanel","aria-labelledby":L,hidden:!W,id:R,tabIndex:0,...S,ref:s,style:{...j.style,animationDuration:D.current?"0s":void 0},children:W&&E})})});Vt.displayName=$t;function Gt(j,s){return`${j}-trigger-${s}`}function qt(j,s){return`${j}-content-${s}`}var ga=Wt,Ht=Ft,Xt=zt,Kt=Vt;const ba=ga,Yt=u.forwardRef(({className:j,...s},g)=>t.jsx(Ht,{ref:g,className:Ye("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",j),...s}));Yt.displayName=Ht.displayName;const he=u.forwardRef(({className:j,...s},g)=>t.jsx(Xt,{ref:g,className:Ye("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",j),...s}));he.displayName=Xt.displayName;const xe=u.forwardRef(({className:j,...s},g)=>t.jsx(Kt,{ref:g,className:Ye("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",j),...s}));xe.displayName=Kt.displayName;const ya=({userId:j,transactions:s=[]})=>{const[g,x]=u.useState(!1),[k,E]=u.useState(!1),[S,U]=u.useState(!1),[L,R]=u.useState({dailyWithdraw:0,dailyTransfer:0,monthlyWithdraw:0,monthlyTransfer:0,lastUpdated:new Date}),{userSubscription:T}=Ot();u.useEffect(()=>{j&&g&&S&&_e()},[j,g,S]);const D=w=>`${w.toFixed(2)} ج.م`,W=async()=>{try{const w=(T==null?void 0:T.subscription)||null,f=(w==null?void 0:w.planType)??(w==null?void 0:w.plan)??null,C=typeof f=="string"?f.toLowerCase():null;if(f===G.ZERO||C==="zero"||C==="0"||f===0)return!0}catch{}try{if(j){const w=await Ve(j),f=(w==null?void 0:w.planType)??(w==null?void 0:w.plan)??null,C=typeof f=="string"?f.toLowerCase():null;if(f===G.ZERO||C==="zero"||C==="0"||f===0)return!0}}catch{}return!1},ne=async()=>{try{const w=await(async()=>{try{const f=(T==null?void 0:T.subscription)||null,C=(f==null?void 0:f.planType)??(f==null?void 0:f.plan)??null,z=typeof C=="string"?C.toLowerCase():null;if(C===G.TAHWEELA||z==="tahweela")return!0}catch{}try{if(j){const f=await Ve(j),C=(f==null?void 0:f.planType)??(f==null?void 0:f.plan)??null,z=typeof C=="string"?C.toLowerCase():null;if(C===G.TAHWEELA||z==="tahweela")return!0}}catch{}return!1})();if(await W()||w){N({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"});return}}catch{}E(!0)},te=async()=>{try{const w=await(async()=>{try{const f=(T==null?void 0:T.subscription)||null,C=(f==null?void 0:f.planType)??(f==null?void 0:f.plan)??null,z=typeof C=="string"?C.toLowerCase():null;if(C===G.TAHWEELA||z==="tahweela")return!0}catch{}try{if(j){const f=await Ve(j),C=(f==null?void 0:f.planType)??(f==null?void 0:f.plan)??null,z=typeof C=="string"?C.toLowerCase():null;if(C===G.TAHWEELA||z==="tahweela")return!0}}catch{}return!1})();if(await W()||w){N({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"}),E(!1);return}}catch{}U(!0),x(!0),E(!1)},_e=async()=>{if(j)try{if(Array.isArray(s)&&s.length>0){const f=new Date,C=f.getMonth(),z=f.getFullYear(),Me=kt.filterVisibleTransactions(s,"daily",j),Y=kt.filterVisibleTransactions(s,"monthly",j);let ie=0,H=0,fe=0,X=0;Me.forEach(_=>{const oe=new Date(_.createdAt),Z=String(_.status||"confirmed").toLowerCase();if(oe.toDateString()!==f.toDateString()||Z!=="completed"&&Z!=="confirmed")return;const J=(_.type||_.txnType||"").toLowerCase(),O={type:J==="withdrawal"?"withdraw":J,amount:Number(_.amount||0),commission:_.commission};O.type==="withdraw"?ie+=pe.calculateProfitFromTransaction(O):(O.type==="send"||O.type==="receive"||O.type==="transfer")&&(H+=pe.calculateProfitFromTransaction(O))}),Y.forEach(_=>{const oe=new Date(_.createdAt),Z=String(_.status||"confirmed").toLowerCase();if(oe.getMonth()!==C||oe.getFullYear()!==z||Z!=="completed"&&Z!=="confirmed")return;const J=(_.type||_.txnType||"").toLowerCase(),O={type:J==="withdrawal"?"withdraw":J,amount:Number(_.amount||0),commission:_.commission};O.type==="withdraw"?fe+=pe.calculateProfitFromTransaction(O):(O.type==="send"||O.type==="receive"||O.type==="transfer")&&(X+=pe.calculateProfitFromTransaction(O))}),R({dailyWithdraw:Math.round(ie*100)/100,dailyTransfer:Math.round(H*100)/100,monthlyWithdraw:Math.round(fe*100)/100,monthlyTransfer:Math.round(X*100)/100,lastUpdated:new Date});return}const w=pe.getWithdrawTransferProfits(j);R({dailyWithdraw:w.dailyWithdrawProfit||0,dailyTransfer:w.dailyTransferProfit||0,monthlyWithdraw:w.monthlyWithdrawProfit||0,monthlyTransfer:w.monthlyTransferProfit||0,lastUpdated:new Date})}catch(w){console.error("Error loading total profits:",w)}};return t.jsxs(t.Fragment,{children:[t.jsx(A,{size:"sm",variant:"ghost",onClick:ne,className:"h-2 w-2 p-0 bg-gradient-to-r from-blue-100 to-purple-200 text-purple-700 hover:from-blue-200 hover:to-purple-300 hover:text-purple-800 rounded transition-all duration-300 hover:scale-110 shadow-sm hover:shadow-md",title:"عرض إجمالي الأرباح",children:t.jsx(Dt,{className:"h-1.5 w-1.5"})}),t.jsx(Pe,{open:g,onOpenChange:x,children:t.jsxs(ke,{className:"max-w-[240px] mx-auto bg-white border border-gray-200 shadow-md rounded sm:max-w-[220px] sm:bg-gradient-to-br sm:from-purple-50 sm:to-white sm:border-2 sm:border-purple-200 sm:shadow-2xl sm:rounded-2xl",children:[t.jsx(Ie,{className:"text-center pb-0 border-b-0 sm:pb-2 sm:border-b sm:border-purple-200",children:t.jsxs(Ee,{className:"text-xs font-bold text-purple-800 flex items-center justify-center gap-1 mb-0 leading-tight tracking-tight sm:text-xs sm:gap-1 sm:mb-0 sm:leading-normal sm:tracking-normal",children:[t.jsx(la,{className:"h-2 w-2 text-purple-600 sm:h-3 sm:w-3"}),"إجمالي الأرباح (فوري)"]})}),t.jsxs("div",{className:"space-y-1 py-1 sm:space-y-2 sm:py-2",children:[t.jsxs("div",{className:"bg-blue-50 p-1 rounded border border-blue-200 sm:bg-gradient-to-r sm:from-blue-50 sm:to-blue-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Xe,{className:"h-2 w-2 text-blue-600"}),t.jsx("span",{className:"text-[10px] font-semibold text-blue-800",children:"يومي"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-900",children:D((L.dailyWithdraw??0)+(L.dailyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 p-0.5 rounded border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Rt,{className:"h-2 w-2 text-red-600"}),t.jsx("span",{className:"text-[10px] text-red-800",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700",children:D(L.dailyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-green-50 p-0.5 rounded border border-green-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Pt,{className:"h-2 w-2 text-green-600"}),t.jsx("span",{className:"text-[10px] text-green-800",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-green-700",children:D(L.dailyTransfer)})]})]})]}),t.jsxs("div",{className:"bg-purple-50 p-1 rounded border border-purple-200 sm:bg-gradient-to-r sm:from-purple-50 sm:to-purple-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(_t,{className:"h-2 w-2 text-purple-600"}),t.jsx("span",{className:"text-[10px] font-semibold text-purple-800",children:"شهري"})]}),t.jsx("span",{className:"text-[10px] font-bold text-purple-900",children:D((L.monthlyWithdraw??0)+(L.monthlyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 p-0.5 rounded border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Rt,{className:"h-2 w-2 text-red-600"}),t.jsx("span",{className:"text-[10px] text-red-800",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700",children:D(L.monthlyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-0.5 rounded border border-blue-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Pt,{className:"h-2 w-2 text-blue-600"}),t.jsx("span",{className:"text-[10px] text-blue-800",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-700",children:D(L.monthlyTransfer)})]})]})]})]}),!S&&t.jsx("div",{className:"absolute inset-0 bg-yellow-200/70 backdrop-blur-sm flex items-center justify-center rounded sm:rounded-2xl border border-yellow-300 pointer-events-auto",children:t.jsx(A,{size:"sm",variant:"ghost",onClick:()=>E(!0),className:"p-2 bg-yellow-300/80 text-yellow-900 hover:bg-yellow-400/90 rounded-full shadow-sm hover:shadow-md transition-all duration-300",title:"إدخال الرقم السري الرئيسي",children:t.jsx(Dt,{className:"h-4 w-4"})})}),t.jsx("div",{className:"flex justify-center pt-1 border-t-0 sm:pt-2 sm:border-t sm:border-purple-200",children:t.jsx(A,{onClick:()=>x(!1),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-1 rounded-xl text-xs sm:bg-gradient-to-r sm:from-purple-600 sm:to-purple-700 sm:hover:from-purple-700 sm:hover:to-purple-800 sm:px-4 sm:py-1 sm:rounded-xl sm:shadow-lg sm:hover:shadow-xl sm:transition-all sm:duration-300",children:"إغلاق"})})]})}),t.jsx(Ke,{open:k,onOpenChange:E,onSuccess:te,description:"لا يمكن الاطلاع على إجمالي الأرباح إلا بإدخال الرقم السري الرئيسي"})]})},va=j=>t.jsx(ya,{...j}),qa=()=>{var gt,bt,yt,vt,jt,wt,Nt,Tt,Ct;const j=Os(),{user:s,profile:g,userSubscription:x}=Ot(),k=me.useMemo(()=>{var r,i,n,a;const e=((r=x==null?void 0:x.subscription)==null?void 0:r.planType)??((i=x==null?void 0:x.subscription)==null?void 0:i.plan)??((n=g==null?void 0:g.subscription)==null?void 0:n.planType)??((a=g==null?void 0:g.subscription)==null?void 0:a.plan)??null;return e===G.ZERO||String(e).toLowerCase()==="zero"},[(gt=x==null?void 0:x.subscription)==null?void 0:gt.planType,(bt=x==null?void 0:x.subscription)==null?void 0:bt.plan,(yt=g==null?void 0:g.subscription)==null?void 0:yt.planType,(vt=g==null?void 0:g.subscription)==null?void 0:vt.plan]),E=me.useMemo(()=>{var r,i,n,a;const e=((r=x==null?void 0:x.subscription)==null?void 0:r.planType)??((i=x==null?void 0:x.subscription)==null?void 0:i.plan)??((n=g==null?void 0:g.subscription)==null?void 0:n.planType)??((a=g==null?void 0:g.subscription)==null?void 0:a.plan)??null;return e===G.TAHWEELA||String(e).toLowerCase()==="tahweela"},[(jt=x==null?void 0:x.subscription)==null?void 0:jt.planType,(wt=x==null?void 0:x.subscription)==null?void 0:wt.plan,(Nt=g==null?void 0:g.subscription)==null?void 0:Nt.planType,(Tt=g==null?void 0:g.subscription)==null?void 0:Tt.plan]),{shopName:S}=Ls(),{isShiftActive:U,shiftUser:L}=_s(),[R,T]=u.useState([]),[D,W]=u.useState([]),[ne,te]=u.useState(new Set),[_e,w]=u.useState(!1),[f,C]=u.useState(null),[z,Me]=u.useState("all"),[Y,ie]=u.useState(""),[H,fe]=u.useState(""),[X,_]=u.useState(""),[oe,Z]=u.useState(!1),[J,O]=u.useState(!1),[Zt,Je]=u.useState(!1),[Jt,Qe]=u.useState(!1),[et,tt]=u.useState(""),[Qt,st]=u.useState("شرح التطبيق"),[ja,at]=u.useState(null),[le,es]=u.useState(null),[ts,ge]=u.useState(!1);me.useEffect(()=>{var r;((r=x==null?void 0:x.subscription)==null?void 0:r.planType)===G.TAHWEELA&&(N({title:"غير متاح لاشتراكك",description:"صفحة المعاملات غير متاحة في باقة تحويله. استخدم لوحة المستخدم للتحويل/السحب فقط.",variant:"destructive"}),j("/user/dashboard"))},[(Ct=x==null?void 0:x.subscription)==null?void 0:Ct.planType]);const[wa,ss]=u.useState(!1),[Na,as]=u.useState(!1),[Ta,rs]=u.useState(!1),[ns,We]=u.useState(!1),[is,rt]=u.useState(!1),[os,nt]=u.useState(!1),[ls,Be]=u.useState(!1),[cs,ds]=u.useState(null),[ms,be]=u.useState(!1),[se,ye]=u.useState({keepLastCount:30,intervalDays:7,lastResetAt:null});u.useEffect(()=>{(async()=>{if(s!=null&&s.uid)try{const r=await B.getUserData(s.uid),i=(r==null?void 0:r.recentReset)||{},n=Number(i==null?void 0:i.keepLastCount)>0?Number(i.keepLastCount):30,a=Number(i==null?void 0:i.intervalDays)>0?Number(i.intervalDays):7,c=m=>m instanceof Date?m:typeof(m==null?void 0:m.toDate)=="function"?m.toDate():m?new Date(String(m)):null,d=i!=null&&i.lastResetAt?c(i.lastResetAt):null,p=new Date;!d||p.getTime()-d.getTime()>=a*24*60*60*1e3?(await B.updateUserData(s.uid,{recentReset:{keepLastCount:n,intervalDays:a,lastResetAt:p}}),ye({keepLastCount:n,intervalDays:a,lastResetAt:p})):ye({keepLastCount:n,intervalDays:a,lastResetAt:d})}catch{ye({keepLastCount:30,intervalDays:7,lastResetAt:null})}})()},[s==null?void 0:s.uid]),u.useEffect(()=>{if(!(s!=null&&s.uid))return;const e=K(I,"users",s.uid),r=ee(e,i=>{try{const n=i.exists()?i.data():{},a=n==null?void 0:n.tutorialSeenAt,c=a!=null&&a.toDate?a.toDate():a?new Date(a):null;es(c)}catch{}});return()=>r()},[s==null?void 0:s.uid]),u.useEffect(()=>{const e=ee(K(I,"app_guides","latest"),r=>{try{const i=r.exists()?r.data():null;if(!i){tt(""),st(""),at(null),ge(!1);return}const n=String(i.url||""),a=String(i.title||"شرح التطبيق"),c=i.publishedAt,d=c!=null&&c.toDate?c.toDate():c?new Date(c):new Date;tt(n),st(a),at(d),ge(d?!le||d.getTime()>((le==null?void 0:le.getTime())||0):!1)}catch{ge(!1)}},r=>{console.warn("فشل الاشتراك في دليل التطبيق:",r)});return()=>e()},[le]);const us=e=>{try{const r=new URL(e);let i="";return r.hostname.includes("youtube.com")?r.pathname==="/watch"?i=r.searchParams.get("v")||"":(r.pathname.startsWith("/embed/")||r.pathname.startsWith("/shorts/"))&&(i=r.pathname.split("/").pop()||""):r.hostname==="youtu.be"&&(i=r.pathname.replace(/^\//,"")),i?`https://www.youtube.com/embed/${i}?autoplay=1&rel=0`:e}catch{return e}},ps=async()=>{Qe(!0);try{s!=null&&s.uid&&await B.updateUserData(s.uid,{tutorialSeenAt:new Date}),ge(!1)}catch{}},[hs,ve]=u.useState(!1),[je,it]=u.useState(""),[ce,ot]=u.useState(""),[we,lt]=u.useState(""),[ct,dt]=u.useState(!1),[mt,Ne]=u.useState(0);u.useEffect(()=>{if(!(s!=null&&s.uid)){Ne(0);return}const e=K(I,"users",s.uid),r=ee(e,i=>{try{const n=i.exists()?i.data():{},c=(Array.isArray(n==null?void 0:n.debts)?n.debts:[]).filter(d=>(d==null?void 0:d.status)==="pending"&&(Number(d==null?void 0:d.amount)||0)>0).length;Ne(c)}catch{Ne(0)}},i=>{console.warn("فشل الاشتراك في ديون المستخدم من Firestore:",i),Ne(0)});return()=>r()},[s==null?void 0:s.uid]),u.useEffect(()=>{xs(),fs()},[s]),u.useEffect(()=>{if(!(s!=null&&s.uid))return;let e=null,r=null;try{const i=$(V(I,"deletedTransactions"),M("userId","==",s.uid));e=ee(i,n=>{try{const a=[];n.docChanges().forEach(c=>{const d=c.doc.data(),p=[d.originalTransactionId,d.transactionId,d.reference,c.doc.id].filter(Boolean).map(h=>String(h));a.push(...p)}),a.length>0&&(te(c=>{const d=new Set(c);return a.forEach(p=>d.add(p)),d}),T(c=>c.filter(d=>{const p=String(d.id||""),h=String(d.transactionId||""),m=String(d.reference||"");return!(a.includes(p)||a.includes(h)||a.includes(m))})))}catch(a){console.warn("deletedTransactions snapshot handling failed:",a)}},n=>{console.warn("deletedTransactions subscription error:",n)});try{r=B.subscribeDeletedTransactionsLocalSync(s.uid)}catch{}}catch{}return()=>{try{e&&e()}catch{}try{r&&r()}catch{}}},[s==null?void 0:s.uid]),u.useEffect(()=>{(async()=>{try{if(!(s!=null&&s.uid)){te(new Set);return}const e=$(V(I,"deletedTransactions"),M("userId","==",s.uid),M("permanent","==",!0)),i=(await ae(e)).docs.flatMap(n=>{const a=n.data();return[a.originalTransactionId,a.transactionId,a.reference,n.id].filter(Boolean).map(String)});te(new Set(i))}catch{te(new Set)}})()},[s==null?void 0:s.uid]),u.useEffect(()=>{(async()=>{try{if(!(s!=null&&s.uid))return;const r=new Date;if(r.getDate()!==1)return;const i=`${r.getFullYear()}-${r.getMonth()+1}`,n=`lastMonthlyDbCleanup:${s.uid}`;if(localStorage.getItem(n)===i)return;const c=new Date(r.getFullYear(),r.getMonth(),1,0,0,0,0),d=m=>m instanceof Date?m:typeof(m==null?void 0:m.toDate)=="function"?m.toDate():new Date(String(m));let p=[];try{const m=$(V(I,"userTransactions"),M("userId","==",s.uid),M("createdAt","<",c));p=(await ae(m)).docs}catch{const m=$(V(I,"userTransactions"),M("userId","==",s.uid));p=(await ae(m)).docs.filter(v=>{var o;return d((o=v.data())==null?void 0:o.createdAt)<c})}await Promise.allSettled(p.map(m=>St(m.ref)));let h=[];try{const m=$(V(I,"transactions"),M("userId","==",s.uid),M("createdAt","<",c));h=(await ae(m)).docs}catch{const m=$(V(I,"transactions"),M("userId","==",s.uid));h=(await ae(m)).docs.filter(v=>{var o;return d((o=v.data())==null?void 0:o.createdAt)<c})}await Promise.allSettled(h.map(m=>St(m.ref)));try{localStorage.setItem(n,i)}catch{}console.log("✅ تنظيف شهري (TransactionsPage):",{userTransactionsDeleted:p.length,globalTransactionsDeleted:h.length,monthStart:c})}catch(r){console.error("فشل التنظيف الشهري التلقائي (TransactionsPage):",r)}})()},[s==null?void 0:s.uid]),u.useEffect(()=>{if(!(s!=null&&s.uid))return;let e=null,r=!1;const i=a=>{const d=a.map(o=>{const l=o.data(),b=l==null?void 0:l.createdAt,P=b!=null&&b.toDate?b.toDate():b instanceof Date?b:new Date(b);return{id:o.id,...l,createdAt:P}}).filter(o=>(o==null?void 0:o.status)!=="cancelled"&&!(o!=null&&o.isDeleted)).filter(o=>!((o==null?void 0:o.type)==="report"||((o==null?void 0:o.title)||"").includes("إيصال تسليم وردية"))).sort((o,l)=>{const b=o.createdAt?new Date(o.createdAt).getTime():0;return(l.createdAt?new Date(l.createdAt).getTime():0)-b}).filter(o=>{const l=String(o.id||""),b=String(o.transactionId||""),P=String(o.reference||o.transactionReference||"");return!ne.has(l)&&(!b||!ne.has(b))&&(!P||!ne.has(P))}),p=s!=null&&s.uid?B.getLocalReceipts(s.uid):[],h=[...d,...Array.isArray(p)?p:[]],m=o=>{var l;return String((o==null?void 0:o.transactionId)||(o==null?void 0:o.id)||(o==null?void 0:o.reference)||(o==null?void 0:o.transactionReference)||((l=o==null?void 0:o.receipt)==null?void 0:l.reference)||`${new Date((o==null?void 0:o.createdAt)||Date.now()).getTime()}`)},y=new Set,v=h.filter(o=>{const l=m(o);return y.has(l)?!1:(y.add(l),!0)});T(v.map(Ue))},n=()=>{const a=$(V(I,"userTransactions"),M("userId","==",s.uid));e=ee(a,c=>{try{i(c.docs)}catch(d){console.error("خطأ في معالجة بيانات الاشتراك الاحتياطي:",d)}},c=>{console.error("خطأ في الاشتراك الاحتياطي لمعاملات المستخدم:",c)})};(async()=>{try{const a=$(V(I,"userTransactions"),M("userId","==",s.uid)),c=await Ms(a);if(c&&c.docs&&c.docs.length>0)try{i(c.docs)}catch{}}catch{}})();try{let a=$(V(I,"userTransactions"),M("userId","==",s.uid),Ws("createdAt","desc"),limit(200));try{e=ee(a,{includeMetadataChanges:!0},c=>{try{i(c.docs)}catch(d){console.error("خطأ في معالجة بيانات الاشتراك:",d)}},c=>{if(console.error("خطأ في الاشتراك لمعاملات المستخدم:",c),!r){r=!0;try{e&&e()}catch{}n()}})}catch{const d=$(V(I,"userTransactions"),M("userId","==",s.uid));e=ee(d,p=>{try{i(p.docs)}catch{}},p=>{console.error("خطأ في الاشتراك البسيط لمعاملات المستخدم:",p),r||(r=!0,n())})}}catch(a){console.error("فشل إعداد الاشتراك الفوري لمعاملات المستخدم، بدء السقوط الاحتياطي:",a),n()}return()=>{try{e&&e()}catch{}}},[s==null?void 0:s.uid]);const xs=async()=>{try{if(!s)return;const e=$(V(I,"deletedTransactions"),M("userId","==",s.uid),M("permanent","==",!0)),[r,i,n]=await Promise.all([B.getUserTransactions(s.uid).catch(()=>[]),B.getByUserId(s.uid).catch(()=>[]),ae(e).then(l=>l.docs.flatMap(b=>{const P=b.data();return[P.originalTransactionId,P.transactionId,P.reference,b.id].filter(Boolean).map(String)})).catch(()=>[])]),a=Array.isArray(r)&&r.length>0?r:Array.isArray(i)?i:[],c=new Set(n),p=(a||[]).map(l=>({...l,createdAt:l.createdAt instanceof Date?l.createdAt:new Date(l.createdAt)})).filter(l=>!((l==null?void 0:l.type)==="report"||((l==null?void 0:l.title)||"").includes("إيصال تسليم وردية"))).filter(l=>{const b=String(l.id||""),P=String(l.transactionId||""),Q=String(l.reference||l.transactionReference||"");return!c.has(b)&&(!P||!c.has(P))&&(!Q||!c.has(Q))}),h=s!=null&&s.uid?B.getLocalReceipts(s.uid):[],m=[...p,...Array.isArray(h)?h:[]],y=l=>{var b;return String((l==null?void 0:l.transactionId)||(l==null?void 0:l.id)||(l==null?void 0:l.reference)||(l==null?void 0:l.transactionReference)||((b=l==null?void 0:l.receipt)==null?void 0:b.reference)||`${new Date((l==null?void 0:l.createdAt)||Date.now()).getTime()}`)},v=new Set,o=m.filter(l=>{const b=y(l);return v.has(b)?!1:(v.add(b),!0)});T(o.map(Ue))}catch(e){console.error("خطأ في تحميل معاملات المستخدم من Firestore:",e),N({title:"فشل جلب معاملات المستخدم",description:"قد تكون المشكلة صلاحيات Firestore أو اتصال الشبكة. سيتم عرض المتاح محليًا إن وُجد. جرّب تسجيل الدخول مجددًا أو افتح صفحة اختبار المصادقة.",variant:"destructive"})}},fs=async()=>{try{if(!s)return;const r=(await ue.getDeletedTransactionsByUser(s.uid)).map(i=>({...i,createdAt:i.createdAt instanceof Date?i.createdAt:new Date(i.createdAt)}));W(r.map(Ue))}catch(e){console.error("خطأ في تحميل المعاملات المحذوفة من Firestore:",e),N({title:"فشل جلب المعاملات المحذوفة",description:"تحقق من الصلاحيات والاتصال. يمكن مراجعة صفحة اختبار المصادقة للتشخيص.",variant:"destructive"})}},de=me.useMemo(()=>{const e=se.keepLastCount??30;return[...R].sort((i,n)=>n.createdAt.getTime()-i.createdAt.getTime()).slice(0,e)},[R,se.keepLastCount]),gs=me.useMemo(()=>Math.max(0,((R==null?void 0:R.length)||0)-(se.keepLastCount||30)),[R==null?void 0:R.length,se.keepLastCount]),ut=de.filter(e=>{const r=!Y||e.senderPhone.includes(Y)||e.receiverPhone.includes(Y),i=!H||e.createdAt.toDateString()===new Date(H).toDateString(),n=!X||e.createdAt.toTimeString().startsWith(X);return r&&i&&n}),Te=(e,r)=>{switch(e){case"completed":return t.jsx(ua,{className:`h-4 w-4 ${r==="withdraw"?"text-red-500":"text-green-500"}`});case"pending":return t.jsx(Xe,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return t.jsx(ma,{className:"h-4 w-4 text-red-500"});default:return t.jsx(Xe,{className:"h-4 w-4 text-gray-500"})}},Fe=e=>{switch(e){case"completed":return"مكتمل";case"pending":return"قيد المراجعة";case"cancelled":return"ملغي";default:return"غير معروف"}},Ue=e=>{const r=((e==null?void 0:e.status)??"").toString().toLowerCase(),i=r==="confirmed"||r==="success"||r==="completed"?"completed":r==="failed"||r==="error"||r==="cancelled"||r==="canceled"?"cancelled":"pending",a=((e==null?void 0:e.type)??(e==null?void 0:e.txnType)??"").toString().toLowerCase()==="withdraw"?"withdraw":"send",c=(e==null?void 0:e.senderPhone)??(e==null?void 0:e.senderMsisdn)??(e==null?void 0:e.sender_msisdn)??(e==null?void 0:e.sender)??(e==null?void 0:e.from)??"",d=(e==null?void 0:e.receiverPhone)??(e==null?void 0:e.receiverMsisdn)??(e==null?void 0:e.receiver_msisdn)??(e==null?void 0:e.receiver)??(e==null?void 0:e.to)??"",p=e==null?void 0:e.createdAt,h=p instanceof Date?p:p!=null&&p.toDate?p.toDate():new Date(p);return{id:e==null?void 0:e.id,senderPhone:c||"غير معروف",receiverPhone:d||"غير معروف",amount:Number((e==null?void 0:e.amount)??0),status:i,type:a,createdAt:h,commission:(e==null?void 0:e.commission)??void 0,withdrawnAmount:(e==null?void 0:e.withdrawnAmount)??void 0,sentAmount:(e==null?void 0:e.sentAmount)??void 0,fromWallet:(e==null?void 0:e.fromWallet)??(e==null?void 0:e.walletId)??void 0,cashierName:(e==null?void 0:e.cashierName)??(e==null?void 0:e.createdByName)??(e==null?void 0:e.cashier)??void 0,commissionMode:(e==null?void 0:e.commissionMode)??(e==null?void 0:e.commission_mode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,walletEffectAppliedOnCreation:(e==null?void 0:e.walletEffectAppliedOnCreation)??(e==null?void 0:e.effectsAppliedOnCreation)??(e==null?void 0:e.effectAppliedOnCreation)??!1,fee:(e==null?void 0:e.fee)??void 0}},bs=e=>({id:e.id,type:e.type==="send"?"transfer":"withdraw",sender_msisdn:e.senderPhone,receiver_msisdn:e.receiverPhone,amount:e.amount,commission:e.commission||0,status:e.status==="cancelled"?"failed":e.status,createdAt:e.createdAt.toISOString(),updatedAt:e.createdAt.toISOString(),shopName:S??(g==null?void 0:g.shopName)??(s==null?void 0:s.displayName)??"المحل",cashierName:(e==null?void 0:e.cashierName)??null,commissionMode:(e==null?void 0:e.commissionMode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,fee:(e==null?void 0:e.fee)??void 0,note:(e==null?void 0:e.note)??(e==null?void 0:e.notes)??void 0}),ze=e=>{const r=bs(e);ds(r),Be(!0)},ys=e=>{C(e),w(!0)},vs=async()=>{f&&(await js(f.id),w(!1),C(null))},js=async e=>{try{const r=D.find(a=>a.id===e);if(!r||!s)return;const i=await B.saveUserTransaction(s.uid,{...r,userId:s.uid,status:"completed",cashierName:r.cashierName??"الحساب الرئيسي"});await ue.permanentlyDeleteTransaction(e,s.uid);const n={...r,id:i};T(a=>[...a,n]),W(a=>a.filter(c=>c.id!==e)),N({title:"تم الاسترجاع",description:"تم استرجاع الإيصال إلى حسابك."})}catch(r){console.error("خطأ في استرجاع المعاملة من Firestore:",r),N({title:"فشل الاسترجاع",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},ws=async e=>{try{if(!s)return;W(r=>r.filter(i=>i.id!==e)),await ue.permanentlyDeleteTransaction(e,s.uid),await B.removeUserTransaction(s.uid,e),N({title:"تم الحذف نهائيًا",description:"الإيصال لن يعود بعد التحديث."})}catch(r){console.error("فشل الحذف النهائي للمعاملة:",r),N({title:"خطأ في الحذف النهائي",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},pt=async e=>{var r,i,n;try{const a=R.find(y=>y.id===e);if(!a||!s)return;try{const y=(r=x==null?void 0:x.subscription)==null?void 0:r.planType;if(y===G.ZERO){const{dailyOperationCountService:v}=await q(async()=>{const{dailyOperationCountService:b}=await import("./dailyOperationCountService-DUs9kD6v.js");return{dailyOperationCountService:b}},__vite__mapDeps([0,1,2]),import.meta.url),o=a.type==="send"?"transfer":"withdraw";if(!(await v.checkAndIncrement(s.uid,o,5)).allowed){N({title:"تم بلوغ حد باقة الزيرو",description:"مسموح بحد أقصى 5 تأكيدات يوميًا للتحويل/السحب. جرّب غدًا أو قم بالترقية.",variant:"destructive"});return}}else if(y===G.TAHWEELA){const{dailyOperationCountService:v}=await q(async()=>{const{dailyOperationCountService:b}=await import("./dailyOperationCountService-DUs9kD6v.js");return{dailyOperationCountService:b}},__vite__mapDeps([0,1,2]),import.meta.url),o=a.type==="send"?"transfer":"withdraw";if(!(await v.checkAndIncrementCombined(s.uid,o,40)).allowed){N({title:"تم بلوغ حد باقة تحويله",description:"هذه الباقة تسمح بحد أقصى 40 عملية تحويل/سحب يومياً.",variant:"destructive"});return}}}catch(y){console.warn("تعذر التحقق من حد التأكيد اليومي:",y)}const c=await Ge.getById(s.uid);if(!(c!=null&&c.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const d=K(I,"dashboardData",c.shopId),p=await re(d);let h=p.exists()?Number(((i=p.data())==null?void 0:i.cashBalance)||0):0,m=p.exists()?((n=p.data())==null?void 0:n.walletBalances)||{}:{};if(a.type==="withdraw"){const y=a.fromWallet||Object.keys(m)[0],v=Number(a.withdrawnAmount??a.amount??0),o=Number(a.commission??0);if(!!!(a!=null&&a.walletEffectAppliedOnCreation)&&y&&v>0){const b=m[y]||0;m[y]=b+v}h=h-v+o,await Ae(d,{cashBalance:h,walletBalances:m})}else if(a.type==="send"){const y=Number(a.commission??0),v=Number((a==null?void 0:a.fee)??0),o=Math.max(0,y)+Math.max(0,v);o>0&&(h=h+o,await Ae(d,{cashBalance:h}))}await Ae(K(I,"userTransactions",e),{status:"completed",confirmedAt:new Date});try{const y=a.fromWallet||Object.keys(m)[0],v=Number(a.withdrawnAmount??a.sentAmount??a.amount??0);if(y&&v>0){const{walletDailyLimitsService:o}=await q(async()=>{const{walletDailyLimitsService:l}=await import("./walletDailyLimitsService-DIs8vIey.js");return{walletDailyLimitsService:l}},__vite__mapDeps([3,1,2]),import.meta.url);await o.updateUsage(y,v,a.type==="send"?"transfer":"withdraw")}}catch{}T(y=>y.map(v=>v.id===e?{...v,status:"completed"}:v)),N({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),Be(!1)}catch(a){console.error("خطأ في إكمال المعاملة:",a),N({title:"فشل الإكمال",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},ht=async e=>{var r,i;try{const n=R.find(a=>a.id===e);if(!n||!s)return;T(a=>a.filter(c=>c.id!==e)),W(a=>[{...n},...a]);try{let a={};try{const h=await re(K(I,"userTransactions",e));a=h.exists()?h.data():{}}catch{}const c=e,d=String((a==null?void 0:a.transactionId)||(n==null?void 0:n.transactionId)||c),p=String((a==null?void 0:a.reference)||(a==null?void 0:a.transactionReference)||(n==null?void 0:n.reference)||(n==null?void 0:n.transactionReference)||"");await B.removeUserTransaction(s.uid,e),await ue.saveDeletedTransaction({...n,userId:s.uid,originalTransactionId:e,transactionId:d,reference:p||void 0,permanent:!0});try{await ue.permanentlyDeleteTransaction(e,s.uid)}catch{}}catch(a){console.warn("تعذر الحذف النهائي من قواعد البيانات في هذه الخطوة، سيتم الحذف من لائحة المحذوفات عند التنفيذ اليدوي للحذف النهائي:",a)}try{const a=await Ge.getById(s.uid);if(!(a!=null&&a.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const c=K(I,"dashboardData",a.shopId),d=await re(c);let p=d.exists()?Number(((r=d.data())==null?void 0:r.cashBalance)||0):0,h=d.exists()?((i=d.data())==null?void 0:i.walletBalances)||{}:{};const m=Number(n.withdrawnAmount??n.amount??0),y=Number(n.commission??0),v=n.fromWallet||Object.keys(h)[0],o=!!(n!=null&&n.walletEffectAppliedOnCreation);if(n.type==="send"){const l=Number(n.fee??0),b=Number((n==null?void 0:n.sentAmount)??(n==null?void 0:n.transferredAmount)??n.amount??0);if(n.status==="completed"&&(p=p-(b+y+l)),v&&b>0){const P=h[v]||0;h[v]=P+b}}else if(n.type==="withdraw"){if(n.status==="completed"){if(p=p+m-y,v&&m>0){const l=h[v]||0;h[v]=l-m}}else if(v&&o&&m>0){const l=h[v]||0;h[v]=l-m}}await Ae(c,{cashBalance:p,walletBalances:h})}catch(a){console.warn("فشل عكس تأثير الأرصدة محليًا:",a)}try{const a=n.fromWallet;if(a){const{walletDailyLimitsService:c}=await q(async()=>{const{walletDailyLimitsService:p}=await import("./walletDailyLimitsService-DIs8vIey.js");return{walletDailyLimitsService:p}},__vite__mapDeps([3,1,2]),import.meta.url),d=await c.getWalletLimits(a);if(d){const p=n.type==="send",h={updatedAt:(await q(async()=>{const{serverTimestamp:l}=await import("./index-5OsgE1a1.js").then(b=>b.bK);return{serverTimestamp:l}},__vite__mapDeps([1,2]),import.meta.url)).serverTimestamp()};p?(h.dailyTransferUsed=Math.max(0,(d.dailyTransferUsed||0)-n.amount),h.monthlyTransferUsed=Math.max(0,(d.monthlyTransferUsed||0)-n.amount)):(h.dailyWithdrawUsed=Math.max(0,(d.dailyWithdrawUsed||0)-n.amount),h.monthlyWithdrawUsed=Math.max(0,(d.monthlyWithdrawUsed||0)-n.amount));const{doc:m,setDoc:y}=await q(async()=>{const{doc:l,setDoc:b}=await import("./index-5OsgE1a1.js").then(P=>P.bK);return{doc:l,setDoc:b}},__vite__mapDeps([1,2]),import.meta.url),{db:v}=await q(async()=>{const{db:l}=await import("./index-5OsgE1a1.js").then(b=>b.bL);return{db:l}},__vite__mapDeps([1,2]),import.meta.url),o=m(v,"walletLimits",a);await y(o,h,{merge:!0})}}}catch(a){console.warn("فشل استرجاع حدود المحفظة:",a)}try{const{ProfitService:a}=await q(async()=>{const{ProfitService:m}=await import("./profitService-B71hwvHL.js").then(y=>y.p);return{ProfitService:m}},__vite__mapDeps([4,1,2]),import.meta.url),{ReportsService:c}=await q(async()=>{const{ReportsService:m}=await import("./profitService-B71hwvHL.js").then(y=>y.a);return{ReportsService:m}},__vite__mapDeps([4,1,2]),import.meta.url),p={txnType:n.type==="send"?"send":"receive",amount:n.amount,commission:n.commission||0,createdAt:n.createdAt,status:"confirmed"},h=a.calculateProfitFromTransaction(p);h>0&&a.addProfit(-h,s.uid);try{c.removeTransactionEffects(n,s.uid)}catch{}}catch(a){console.warn("فشل تحديث التقارير/الأرباح بعد الحذف:",a)}}catch(n){console.error("خطأ أثناء حذف الإيصال:",n)}},xt=u.useRef(!1),ft=Bs();u.useEffect(()=>{!(new URLSearchParams(ft.search).get("autoTestBalances")==="1")||xt.current||(xt.current=!0,(async()=>{var i,n,a,c,d,p;try{if(!s)return;const h=await Ge.getById(s.uid);if(!(h!=null&&h.shopId)){console.warn("autoTest: لا يوجد shopId للمستخدم، سيتم إيقاف الاختبار.");return}const m=K(I,"dashboardData",h.shopId),y=await re(m),v=y.exists()?Number(((i=y.data())==null?void 0:i.cashBalance)||0):0,o=y.exists()?((n=y.data())==null?void 0:n.walletBalances)||{}:{},l=Object.keys(o)[0]||void 0,b=100,P=5,Q=await B.saveUserTransaction(s.uid,{senderPhone:"auto-test-sender",receiverPhone:"auto-test-receiver",amount:b,status:"pending",type:"withdraw",createdAt:new Date,reference:`AUTO-${Date.now()}`,commission:P,withdrawnAmount:b,fromWallet:l,cashierName:"AutoTest",commissionMode:"add",totalCharged:b+P,walletEffectAppliedOnCreation:!1});console.log("autoTest: تم إنشاء إيصال سحب تجريبي:",Q),await pt(Q);const Ce=await re(m),Ts=Ce.exists()?Number(((a=Ce.data())==null?void 0:a.cashBalance)||0):0,Cs=Ce.exists()?((c=Ce.data())==null?void 0:c.walletBalances)||{}:{},Ds=v-b+P,As=l?Number(o[l]||0)+b:void 0;console.log("autoTest: توقع الدرج بعد الإكمال:",Ds,"فعلي:",Ts),l&&console.log("autoTest: توقع المحفظة بعد الإكمال:",As,"فعلي:",Cs[l]),await ht(Q);const De=await re(m),Ss=De.exists()?Number(((d=De.data())==null?void 0:d.cashBalance)||0):0,Rs=De.exists()?((p=De.data())==null?void 0:p.walletBalances)||{}:{};console.log("autoTest: تحقق نهائي — الدرج قبل/بعد الحذف:",v,Ss),l&&console.log("autoTest: تحقق نهائي — المحفظة قبل/بعد الحذف:",o[l]||0,Rs[l]||0),N({title:"اختبار الأرصدة (Firestore فقط)",description:"تم إنشاء/إكمال/حذف إيصال تجريبي والتحقق من الأرصدة.",variant:"default"})}catch(h){console.error("autoTest: فشل اختبار الأرصدة:",h),N({title:"فشل اختبار الأرصدة",description:"تحقق من الاتصال ووجود shopId والمحافظ في Firestore.",variant:"destructive"})}})())},[ft.search,s]);const Ns=async()=>{var i,n,a;const e="alkaptin678678@gmail.com",r=(n=(i=He.currentUser)==null?void 0:i.email)==null?void 0:n.toLowerCase();if(!r||r!==e){N({title:"قيد الإنشاء",description:"ميزة الشحن متاحة لهذا الحساب فقط حالياً."});return}if(!je||!ce||!we){N({title:"بيانات ناقصة",description:"يرجى إدخال رقم وشركة والمبلغ",variant:"destructive"});return}dt(!0);try{const d={vodafone_eg:"Vodafone",orange_eg:"Orange",etisalat_eg:"Etisalat",we_eg:"WE"}[ce]??ce,p=new AbortController,h=setTimeout(()=>p.abort(),15e3),m=await((a=He.currentUser)==null?void 0:a.getIdToken()),y=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...m?{Authorization:`Bearer ${m}`}:{}},body:JSON.stringify({phone:je,countryCode:"EG",operator:d,amount:Number(we),useLocalAmount:!0}),signal:p.signal});clearTimeout(h);const v=await y.text();let o;try{o=JSON.parse(v)}catch{o={success:!1,message:v||"فشل قراءة استجابة الخادم"}}y.ok&&(o!=null&&o.success)?(N({title:"تم الشحن",description:(o==null?void 0:o.message)||"تم تنفيذ عملية الشحن بنجاح"}),ve(!1),it(""),ot(""),lt("")):N({title:"فشل الشحن",description:(o==null?void 0:o.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(c){console.error("Topup request error:",c),(c==null?void 0:c.name)==="AbortError"?N({title:"انتهت المهلة",description:"الخادم لم يستجب في الوقت المحدد. تأكد أن السيرفر يعمل.",variant:"destructive"}):N({title:"خطأ في الاتصال",description:"تعذر الاتصال بالخادم. حاول لاحقاً.",variant:"destructive"})}finally{dt(!1)}};return t.jsxs("div",{className:"fixed inset-0 overscroll-y-none overflow-y-auto bg-background p-4",children:[t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs(A,{variant:"ghost",size:"sm",onClick:()=>j("/user/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800",children:[t.jsx(ca,{className:"h-4 w-4"}),"العودة"]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"المعاملات"})]}),t.jsxs(Vs,{className:"card-modern fade-in-up",children:[t.jsxs(Gs,{className:"pb-2 px-3 pt-3",children:[t.jsx(qs,{className:"text-sm font-bold",children:"المعاملات الأخيرة"}),t.jsxs("div",{className:"flex items-center gap-0.5 mt-1 relative",children:[t.jsxs("div",{className:"flex items-center gap-0.5 flex-1 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[t.jsx(da,{className:"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors"}),t.jsx(qe,{placeholder:"بحث...",value:Y,onChange:e=>ie(e.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400"})]}),t.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:ps,title:"شرح التطبيق",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(ha,{className:"h-2.5 w-2.5"}),ts&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-600 rounded-full"})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شرح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 hover:border-purple-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(k||E){N({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"});return}O(!0)},title:"إدارة التقسيط",children:t.jsx(Fs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تقسيط"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(va,{userId:s==null?void 0:s.uid,transactions:R}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"أرباح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border border-emerald-200 hover:border-emerald-300 transition-all duration-200 hover:scale-105",onClick:()=>{N({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."})},title:"نافذة شحن سريعة",children:t.jsx(At,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شحن"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:scale-105",onClick:()=>Z(!0),title:"آلة حاسبة",children:t.jsx(ta,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"حاسبة"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 hover:border-green-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(k){N({title:"الخطة الحالية لا تسمح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية."});return}ss(!0)},title:"بيانات المبيعات",children:t.jsx(sa,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مبيعات"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(A,{variant:"ghost",size:"sm",className:`h-5 w-5 p-0 rounded border transition-all duration-200 hover:scale-105 ${H||X?"bg-purple-100 text-purple-600 border-purple-300":"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200 hover:border-purple-300"}`,onClick:()=>as(!0),title:"اختيار التاريخ",children:[t.jsx(_t,{className:"h-2.5 w-2.5"}),(H||X)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-purple-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تاريخ"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 hover:border-orange-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(k){N({title:"الخطة الحالية لا تسمح",description:"إدارة الديون غير متاحة في خطة زيرو. قم بالترقية."});return}We(!0)},title:"إدارة الديون",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(Us,{className:"h-2.5 w-2.5"}),mt>0&&t.jsx("div",{className:"absolute -top-1 -right-1 z-10 min-w-[12px] h-[12px] px-[2px] bg-red-600 text-white rounded-full text-[8px] leading-[12px] flex items-center justify-center pointer-events-none ring-1 ring-white",children:mt})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"ديون"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(k){N({title:"الخطة الحالية لا تسمح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية."});return}nt(!0)},title:"الصيانة",children:t.jsx(zs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"صيانه"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-violet-50 text-violet-600 hover:bg-violet-100 border border-violet-200 hover:border-violet-300 transition-all duration-200 hover:scale-105",onClick:()=>{j("/user/dashboard",{state:{openCashierShiftModal:!0}})},title:"يومية المكنة",children:t.jsx(pa,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"المكنة"})]}),t.jsxs("div",{className:"hidden sm:flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(k){N({title:"الخطة الحالية لا تسمح",description:"الفيز الائتمانية غير متاحة في خطة زيرو. قم بالترقية."});return}rt(!0)},title:"الفيز الائتمانية",children:t.jsx(At,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"فيز"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105 relative",onClick:()=>{be(!0)},title:"تصفير المعاملات الأخيرة",children:[t.jsx(It,{className:"h-2.5 w-2.5"}),gs>0&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تصفير"})]}),(Y||H||X)&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:()=>{ie(""),fe(""),_("")},title:"مسح",children:t.jsx("span",{className:"text-[10px] font-bold",children:"×"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مسح"})]})]})]})]}),t.jsx(Hs,{className:"px-3 pb-3",children:t.jsxs(ba,{value:z,onValueChange:Me,className:"w-full",children:[t.jsxs(Yt,{className:"hidden sm:grid w-full grid-cols-4 h-10 text-sm bg-gradient-to-r from-gray-50 via-blue-50/30 to-purple-50/30 border border-gray-200/60 rounded-md p-1 shadow-sm relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 opacity-0 hover:opacity-100 transition-all duration-200"}),t.jsxs(he,{value:"all",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-blue-200/50 hover:bg-blue-50/80 hover:text-blue-700 group",children:[t.jsx("span",{className:"relative z-10",children:"الكل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(he,{value:"send",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-green-200/50 hover:bg-green-50/80 hover:text-green-700 group",children:[t.jsx("span",{className:"relative z-10",children:"مرسل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(he,{value:"withdraw",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-orange-200/50 hover:bg-orange-50/80 hover:text-orange-700 group",children:[t.jsx("span",{className:"relative z-10",children:"سحب"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-orange-500/10 to-amber-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(he,{value:"deleted",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-rose-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-red-200/50 hover:bg-red-50/80 hover:text-red-700 group",children:[t.jsx("span",{className:"relative z-10",children:"محذوف"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-500/10 to-rose-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]})]}),t.jsx(xe,{value:"all",className:"mt-2 receipts-list",children:ut.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ut.map((e,r)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>ze(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[Te(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:`font-medium text-sm ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[F(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-red-600",children:["عمولة: ",F(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:`text-[10px] ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:`text-sm ${e.type==="withdraw"?"text-red-500":"text-green-600"}`,children:e.createdAt.toLocaleString("en-GB")})]})]}),t.jsxs("div",{className:"text-right",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-green-700",children:[F(e.amount)," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",F(e.withdrawnAmount)," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",F(e.sentAmount)," جنيه"]}),t.jsx(Re,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?e.type==="withdraw"?"bg-red-100 text-red-800 border-red-300":e.type==="send"?"bg-green-100 text-green-800 border-green-300":"":e.type==="withdraw"?"bg-red-100 text-red-800":""}`,children:e.type==="withdraw"?"سحب":Fe(e.status)})]})]},e.id))})}),t.jsx(xe,{value:"send",className:"mt-2 receipts-list",children:de.filter(e=>e.type==="send").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات إرسال محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:de.filter(e=>e.type==="send").map((e,r)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-all duration-200",onClick:()=>ze(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[Te(e.status,e.type),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-sm text-green-700",children:[e.senderPhone," → ",e.receiverPhone]}),t.jsxs("p",{className:"text-[10px] text-green-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-green-600",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm text-green-700",children:[F(e.amount)," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",F(e.sentAmount)," جنيه"]}),t.jsx(Re,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?"bg-green-100 text-green-800 border-green-300":""}`,children:Fe(e.status)})]})]},e.id))})}),t.jsx(xe,{value:"withdraw",className:"mt-2 receipts-list",children:de.filter(e=>e.type==="withdraw").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات سحب محفوظة بعد"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:de.filter(e=>e.type==="withdraw").map((e,r)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border cursor-pointer",onClick:()=>ze(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[Te(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.receiverPhone}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[F(e.amount)," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",F(e.withdrawnAmount)," جنيه"]}),t.jsx(Re,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?"bg-red-100 text-red-800 border-red-300":"bg-red-100 text-red-800"}`,children:Fe(e.status)})]})]},e.id))})}),t.jsx(xe,{value:"deleted",className:"mt-2",children:D.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محذوفة"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:D.map((e,r)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[Te(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[F(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-500",children:["عمولة: ",F(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"text-right mr-2",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[F(e.amount)," جنيه"]}),t.jsx(Re,{variant:"secondary",className:"text-[10px] bg-red-100 text-red-800",children:"محذوف"})]}),t.jsx(A,{variant:"ghost",size:"sm",className:"text-green-600 hover:bg-green-100 h-10 sm:h-12 px-4 sm:px-5 min-w-[44px] touch-manipulation",onClick:()=>ys(e),children:t.jsx("span",{className:"text-xs sm:text-sm",children:"استرجاع"})}),t.jsx(A,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 h-10 sm:h-12 px-3 sm:px-4 min-w-[44px] touch-manipulation",onClick:()=>ws(e.id),children:t.jsx(It,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})]},e.id))})})]})})]}),t.jsx(Pe,{open:Jt,onOpenChange:Qe,children:t.jsxs(ke,{className:"dialog-modern max-w-3xl w-full p-0 overflow-hidden border-0 shadow-2xl",children:[t.jsx(Ie,{className:"px-4 pt-4",children:t.jsx(Ee,{className:"text-lg font-bold",children:Qt||"شرح التطبيق"})}),t.jsx("div",{className:"aspect-video w-full bg-black",children:et?t.jsx("iframe",{src:us(et),title:"Application Guide",className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0}):t.jsx("div",{className:"flex items-center justify-center h-full text-white/80",children:"لا يوجد فيديو متاح حالياً"})})]})}),t.jsx(aa,{open:os,onOpenChange:nt})]}),t.jsx(ra,{isOpen:is,onClose:()=>rt(!1)}),t.jsx(Ke,{open:ns,onOpenChange:We,mode:"verify",title:"الرقم السري الرئيسي لفتح الديون",description:"أدخل الرقم السري الرئيسي لفتح صفحة الديون",onSuccess:()=>{We(!1),rs(!0)}}),t.jsx(oa,{open:ms,onOpenChange:be,title:"تأكيد كلمة المرور لتصفير المعاملات الأخيرة",description:"سيتم حذف كل المعاملات السابقة نهائيًا من حسابك وFirebase.",onSuccess:async()=>{try{if(!(s!=null&&s.uid)){be(!1);return}const e=new Date,r=i=>i instanceof Date?i:typeof(i==null?void 0:i.toDate)=="function"?i.toDate():new Date(String(i));await B.updateUserData(s.uid,{recentReset:{keepLastCount:se.keepLastCount??30,intervalDays:se.intervalDays??7,lastResetAt:e}}),ye(i=>({...i,lastResetAt:e})),N({title:"تم إخفاء المعاملات السابقة",description:"تم إخفاء كل الإيصالات الأقدم من وقت التصفير من العرض بدون التأثير على التقارير اليومية/الشهرية أو الحدود."})}catch(e){console.error("فشل تنفيذ التصفير النهائي:",e),N({title:"فشل التصفير",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}finally{be(!1)}}}),t.jsx(Pe,{open:hs,onOpenChange:e=>{var r,i;if(e){const n="alkaptin678678@gmail.com",a=(i=(r=He.currentUser)==null?void 0:r.email)==null?void 0:i.toLowerCase();if(!a||a!==n){N({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."});return}ve(!0)}else ve(!1)},children:t.jsxs(ke,{dir:"rtl",className:"sm:max-w-md",children:[t.jsx(Ie,{children:t.jsx(Ee,{children:"شحن رصيد الموبايل"})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"رقم الموبايل"}),t.jsx(qe,{value:je,onChange:e=>it(e.target.value),placeholder:"01XXXXXXXXX",dir:"ltr"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"الشركة"}),t.jsxs(Ks,{value:ce,onValueChange:ot,children:[t.jsx(Ys,{className:"w-full",children:t.jsx(Zs,{placeholder:"اختر الشركة"})}),t.jsxs(Js,{children:[t.jsx(Se,{value:"vodafone_eg",children:"فودافون"}),t.jsx(Se,{value:"orange_eg",children:"أورنج"}),t.jsx(Se,{value:"etisalat_eg",children:"اتصالات"}),t.jsx(Se,{value:"we_eg",children:"WE"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"المبلغ بالجنيه"}),t.jsx(qe,{type:"number",min:1,value:we,onChange:e=>lt(e.target.value?Number(e.target.value):""),placeholder:"50"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-2",children:[t.jsx(A,{variant:"outline",onClick:()=>ve(!1),children:"إلغاء"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(A,{variant:"secondary",onClick:()=>j("/topup"),children:"صفحة الشحن الكاملة"}),t.jsx(A,{onClick:Ns,disabled:ct||!je||!ce||!we,children:ct?"جارٍ التنفيذ...":"تأكيد الشحن"})]})]})]})]})}),t.jsx(Pe,{open:_e,onOpenChange:w,children:t.jsxs(ke,{className:"sm:max-w-[460px]",children:[t.jsxs(Ie,{children:[t.jsx(Ee,{children:"تأكيد استرجاع الإيصال"}),t.jsx($s,{children:"سيتم إعادة الإيصال إلى قائمة المعاملات الحالية."})]}),f&&t.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"المبلغ"}),t.jsxs("span",{className:"font-bold",children:[f.amount," جنيه"]})]}),f.type==="withdraw"?t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"العميل"}),t.jsx("span",{className:"font-medium",children:f.receiverPhone})]}):t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"من → إلى"}),t.jsxs("span",{className:"font-medium",children:[f.senderPhone," → ",f.receiverPhone]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"الكاشير"}),t.jsx("span",{className:"font-medium",children:f.cashierName??"الحساب الرئيسي"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"التاريخ"}),t.jsx("span",{className:"font-medium",children:f.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3",children:[t.jsx(A,{variant:"outline",onClick:()=>{w(!1),C(null)},children:"إلغاء"}),t.jsx(A,{onClick:vs,children:"تأكيد الاسترجاع"})]})]})}),t.jsx(na,{isOpen:ls,onClose:()=>Be(!1),transaction:cs,onPrint:()=>window.print(),onDelete:ht,onComplete:pt}),t.jsx(Ke,{open:J,onOpenChange:O,mode:"verify",title:"فتح إدارة التقسيط",description:"أدخل الرقم السري الرئيسي للوصول إلى إدارة التقسيط",onSuccess:()=>{O(!1),Je(!0)}}),t.jsx(ia,{open:Zt,onOpenChange:Je})]})};export{qa as default};
