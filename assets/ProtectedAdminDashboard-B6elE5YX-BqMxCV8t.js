const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-BsVRzvOf.js","./index-Bpuv6Nub.css","./freeTrialService-BwabY7bi-CphYVBZa.js"])))=>i.map(i=>d[i]);
import{C as va,W as Na,S as l,z as Ne,R as oe,G as Y,L as We,I as e,s as wa,A as ka,Z as I,_ as L,ab as Ea,ac as Sa,a1 as ve,b as G,ad as Ta,a5 as It,O as Ge,Q as _a,ae as yt,c as fe,af as Aa,ag as Ze,Y as re,a9 as g,ah as Da,a0 as Ca,v as je,U as vt,E as Ia,l as Lt,V as La,N as Nt,T as wt,a as X,o as Ua,g as Ra,ai as Te,aj as Ss,f as He,F as kt,ak as Fa,a8 as Va,al as Ma,d as Oa,t as Pa,P as $a,m as Ba}from"./index-BsVRzvOf.js";import{m as Et,w as Ha,y as qa,f as Ya}from"./contentService-Cxdf08Uc-BHd63AoT.js";import{l as za,m as js,w as St,x as Wa,p as Ga}from"./brandingService-C3FKjfeb-B084ml0j.js";import{I as Tt,L as Za}from"./ProfileIcon-DCyirBaq-gWw1xk4p.js";import{o as qe,l as Ye,c as ys,i as vs,n as Qa}from"./card-SlwaggFS-BswsJdJN.js";import{u as _t}from"./label-_mnIMROJ-DudSd8Mh.js";import{l as me,n as Ka}from"./textarea-DK4Tmvmm-BQX2-U1-.js";import{J as Ns,O as Xa}from"./switch-CNGODERG-eTw8K7Ad.js";import{n as Ja,c as er}from"./alert-NHJmLZVr-DvNOgEIS.js";import{d as Qe}from"./badge-Cq-GDK1F-DqoYRGyo.js";import{S as $e,P as sr,x as tr}from"./separator-Dk6MyxBB-Dcj4B0Mo.js";import{w as Ut,D as Rt,M as ar}from"./whatsappService-D7s14JCG-CtNQG8BW.js";import{r as rr}from"./circle-alert-BbiXZQj6-CJFrf0QN.js";import{e as Ft}from"./phone-fkjnGVtI-DdQgMhKa.js";import{t as de}from"./save-DZtCbiME-lsHcxc3J.js";import{c as ws,y as ye,t as lr}from"./users-D_RD5-UM-mcNEuowl.js";import{w as ir,B as nr}from"./broadcastService-DGqqg97J-ssfrjid5.js";import{a as se}from"./calendar-DYpYXkMW-DdYk4Ijy.js";import{o as cr,$ as dr,r as or,Z as mr,Q as ce}from"./select-QKdc2TYn-4nnF_b5r.js";import{o as Ts}from"./zap-CQJoEO-g-Clhsfytt.js";import{e as ze}from"./crown-Bkdmlc37-DgP56dVa.js";import{c as xr}from"./shield-DSoskD-c-BzN5L-qY.js";import{a as ks}from"./download-DFIibxe--CsopZRn5.js";import{t as Es}from"./circle-check-big-DcMEd0KV-CypIUhpt.js";import{r as ur}from"./circle-x-CAZlwHZs-PgSdbLi6.js";import"./dropdown-menu-MkPhHRIa-C3szlXVH.js";import"./index-CS8iiUxP-o3s-AvoK.js";import"./MasterPinDialog-CDin1iyv-BfIYYvfI.js";const A=(n,c=A,b=c.f||(c.f=["./index-tnWDkOuX.js","./index-Bpuv6Nub.css","./freeTrialService-BwabY7bi.js"]))=>n.map(u=>b[u]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=G("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const At=G("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Dt=G("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const pr=G("Infinity",[["path",{d:"M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",key:"1z0uae"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const gr=G("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Be=G("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Ct=G("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const br=G("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const fr=G("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const jr=G("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const yr=G("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),vr=()=>{const{settings:n,loading:c,error:b,updateSettings:u,refreshSettings:j}=ar(),{toast:v}=Oa(),[d,T]=l.useState({phoneNumber:"",defaultMessage:"",isEnabled:!0}),[x,w]=l.useState(!1),[U,Z]=l.useState(!1),[_,f]=l.useState(""),[h,m]=l.useState({});l.useEffect(()=>{n&&T({phoneNumber:n.phoneNumber,defaultMessage:n.defaultMessage,isEnabled:n.isEnabled})},[n]);const Q=()=>{var R,F;const V={};return(R=d.phoneNumber)!=null&&R.trim()?Ut(d.phoneNumber)||(V.phoneNumber="رقم الواتساب غير صحيح (يجب أن يحتوي على 10-15 رقم)"):V.phoneNumber="رقم الواتساب مطلوب",(F=d.defaultMessage)!=null&&F.trim()?d.defaultMessage.length<10&&(V.defaultMessage="الرسالة يجب أن تحتوي على 10 أحرف على الأقل"):V.defaultMessage="الرسالة الافتراضية مطلوبة",m(V),Object.keys(V).length===0},$=async()=>{if(!Q()){v({title:"خطأ في البيانات",description:"يرجى تصحيح الأخطاء قبل الحفظ",variant:"destructive"});return}w(!0);try{if(await u(d))v({title:"تم الحفظ بنجاح",description:"تم تحديث إعدادات الواتساب بنجاح",variant:"default"});else throw new Error("فشل في الحفظ")}catch{v({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ الإعدادات",variant:"destructive"})}finally{w(!1)}},p=()=>{if(d.phoneNumber&&d.defaultMessage)try{const R=Rt(d.phoneNumber,d.defaultMessage);f(R),Z(!0)}catch{v({title:"خطأ في المعاينة",description:"تأكد من صحة رقم الواتساب",variant:"destructive"})}},B=async()=>{try{await navigator.clipboard.writeText(_),v({title:"تم النسخ",description:"تم نسخ الرابط إلى الحافظة",variant:"default"})}catch{v({title:"خطأ في النسخ",description:"فشل في نسخ الرابط",variant:"destructive"})}},xe=R=>{const F=R.replace(/[^\d+]/g,"");T(V=>({...V,phoneNumber:F})),h.phoneNumber&&m(V=>({...V,phoneNumber:""}))};return c?e.jsxs(qe,{children:[e.jsx(ys,{children:e.jsxs(vs,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5"}),"إدارة الواتساب"]})}),e.jsx(Ye,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Ns,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"mr-2",children:"جاري التحميل..."})]})})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(qe,{children:[e.jsxs(ys,{children:[e.jsxs(vs,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5"}),"إدارة الواتساب"]}),e.jsx(Qa,{children:"إدارة رقم الواتساب والرسائل الافتراضية المعروضة في جميع أنحاء الموقع"})]}),e.jsxs(Ye,{className:"space-y-6",children:[b&&e.jsxs(Ja,{variant:"destructive",children:[e.jsx(rr,{className:"h-4 w-4"}),e.jsx(er,{children:b})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${d.isEnabled?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"حالة خدمة الواتساب"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d.isEnabled?"مفعلة":"معطلة"})]})]}),e.jsx(Xa,{checked:d.isEnabled,onCheckedChange:R=>T(F=>({...F,isEnabled:R}))})]}),e.jsx(tr,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_t,{htmlFor:"phoneNumber",className:"flex items-center gap-2",children:[e.jsx(Ft,{className:"h-4 w-4"}),"رقم الواتساب"]}),e.jsx(Pa,{id:"phoneNumber",type:"tel",placeholder:"مثال: 201000392539",value:d.phoneNumber,onChange:R=>xe(R.target.value),className:h.phoneNumber?"border-red-500":"",dir:"ltr"}),h.phoneNumber&&e.jsx("p",{className:"text-sm text-red-500",children:h.phoneNumber}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"أدخل رقم الواتساب مع رمز الدولة (مثال: 201000392539 لمصر)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_t,{htmlFor:"defaultMessage",children:"الرسالة الافتراضية"}),e.jsx(Ka,{id:"defaultMessage",placeholder:"مرحباً، أريد الاستفسار عن خدماتكم",value:d.defaultMessage,onChange:R=>{T(F=>({...F,defaultMessage:R.target.value})),h.defaultMessage&&m(F=>({...F,defaultMessage:""}))},className:h.defaultMessage?"border-red-500":"",rows:4}),h.defaultMessage&&e.jsx("p",{className:"text-sm text-red-500",children:h.defaultMessage}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"هذه الرسالة ستظهر افتراضياً عند النقر على أزرار الواتساب"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(X,{onClick:$,disabled:x,className:"flex items-center gap-2",children:[x?e.jsx(Ns,{className:"h-4 w-4 animate-spin"}):e.jsx(de,{className:"h-4 w-4"}),x?"جاري الحفظ...":"حفظ التغييرات"]}),e.jsxs(X,{variant:"outline",onClick:p,disabled:!d.phoneNumber||!d.defaultMessage,className:"flex items-center gap-2",children:[U?e.jsx($a,{className:"h-4 w-4"}):e.jsx(Ba,{className:"h-4 w-4"}),"معاينة الرابط"]}),e.jsxs(X,{variant:"outline",onClick:j,className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"h-4 w-4"}),"تحديث"]})]}),U&&_&&e.jsxs(qe,{className:"bg-muted/50",children:[e.jsx(ys,{children:e.jsx(vs,{className:"text-lg",children:"معاينة رابط الواتساب"})}),e.jsxs(Ye,{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-background rounded border font-mono text-sm break-all",children:_}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{variant:"outline",size:"sm",onClick:B,className:"flex items-center gap-2",children:[e.jsx(lr,{className:"h-4 w-4"}),"نسخ الرابط"]}),e.jsxs(X,{variant:"outline",size:"sm",onClick:()=>window.open(_,"_blank"),className:"flex items-center gap-2",children:[e.jsx(nr,{className:"h-4 w-4"}),"فتح في الواتساب"]})]})]})]}),n&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"معلومات الإعدادات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"آخر تحديث:"}),e.jsxs(Qe,{variant:"outline",className:"mr-2",children:[n.lastUpdated.toLocaleDateString("ar-EG")," - ",n.lastUpdated.toLocaleTimeString("ar-EG")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),e.jsx(Qe,{variant:n.isEnabled?"default":"secondary",className:"mr-2",children:n.isEnabled?"مفعل":"معطل"})]})]})]})]})]})})},Ke={enableVisualAlerts:!0,enableAudioAlerts:!0,criticalDays:1,warningDays:3,infoDays:7},Nr=n=>{const c=new Date,b=new Date(n).getTime()-c.getTime();return Math.ceil(b/(1e3*60*60*24))},wr=(n,c=Ke)=>n<0?"expired":n<=c.criticalDays?"critical":n<=c.warningDays?"warning":(n<=c.infoDays,"info"),kr=(n,c,b)=>{const u=Er(b);return c<0?`انتهت صلاحية اشتراك ${u} للمستخدم ${n}`:c===0?`ينتهي اشتراك ${u} للمستخدم ${n} اليوم!`:c===1?`ينتهي اشتراك ${u} للمستخدم ${n} غداً`:`ينتهي اشتراك ${u} للمستخدم ${n} خلال ${c} أيام`},Er=n=>{switch(n){case g.MONTHLY:return"الشهري";case g.YEARLY:return"السنوي";case g.LIFETIME:return"مدى الحياة";default:return"غير محدد"}},Sr=async()=>{try{const n=oe(Y,"users"),c=Ne(n,Ss("subscription","!=",null)),b=await He(c),u=[];return b.forEach(j=>{var v,d,T,x;const w=j.data();w.subscription&&(w.subscription.planType||w.subscription.plan)&&u.push({id:j.id,...w,subscription:{...w.subscription,startDate:((d=(v=w.subscription.startDate)==null?void 0:v.toDate)==null?void 0:d.call(v))||new Date(w.subscription.startDate),endDate:((x=(T=w.subscription.endDate)==null?void 0:T.toDate)==null?void 0:x.call(T))||new Date(w.subscription.endDate),planType:w.subscription.planType||w.subscription.plan}})}),u}catch(n){return console.error("خطأ في جلب الاشتراكات النشطة:",n),[]}},Tr=async(n=Ke)=>{try{const c=await Sr(),b=[];return c.forEach(u=>{if(!u.subscription||!u.subscription.endDate)return;const j=Nr(u.subscription.endDate),v=wr(j,n);if(j<=n.infoDays||j<0){const d={id:`${u.id}_${Date.now()}`,userId:u.id,userName:u.displayName||u.email||"مستخدم غير معروف",userEmail:u.email||"",subscriptionPlan:u.subscription.planType,expiryDate:u.subscription.endDate,daysRemaining:j,type:v,message:kr(u.displayName||u.email||"مستخدم غير معروف",j,u.subscription.planType),isRead:!1,createdAt:new Date};b.push(d)}}),b.sort((u,j)=>{const v={expired:0,critical:1,warning:2,info:3};return v[u.type]!==v[j.type]?v[u.type]-v[j.type]:u.daysRemaining-j.daysRemaining}),b}catch(c){return console.error("خطأ في إنشاء إشعارات الاشتراك:",c),[]}},_r=(n,c)=>c?n.filter(b=>b.type===c):n,Ar=n=>{localStorage.setItem("notificationSettings",JSON.stringify(n))},Dr=()=>{try{const n=localStorage.getItem("notificationSettings");if(n)return{...Ke,...JSON.parse(n)}}catch(n){console.error("خطأ في تحميل إعدادات الإشعارات:",n)}return Ke},Cr=({isOpen:n,onClose:c})=>{const[b,u]=l.useState([]),[j,v]=l.useState([]),[d,T]=l.useState("all"),[x,w]=l.useState(!0),[U,Z]=l.useState(Dr());l.useEffect(()=>{n&&_()},[n]),l.useEffect(()=>{v(d==="all"?b:_r(b,d))},[b,d]);const _=async()=>{w(!0);try{const p=await Tr(U);u(p)}catch(p){console.error("خطأ في تحميل الإشعارات:",p)}finally{w(!1)}},f=p=>{switch(p){case"urgent":return e.jsx(Ze,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(re,{className:"w-5 h-5 text-yellow-500"});case"info":return e.jsx(me,{className:"w-5 h-5 text-blue-500"});default:return e.jsx(me,{className:"w-5 h-5 text-gray-500"})}},h=p=>{switch(p){case"urgent":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}},m=p=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(p),Q=p=>{switch(p){case"all":return"جميع الإشعارات";case"urgent":return"عاجل (يوم واحد)";case"warning":return"تحذير (3 أيام)";case"info":return"معلومات (7 أيام)";default:return"غير محدد"}},$=p=>{const B={...U,[p]:!U[p]};Z(B),Ar(B)};return n?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-xl font-bold",children:"مركز الإشعارات"}),b.length>0&&e.jsx("span",{className:"bg-white text-blue-600 px-2 py-1 rounded-full text-sm font-medium",children:b.length})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(ve,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hr,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"تصفية حسب:"})]}),["all","urgent","warning","info"].map(p=>e.jsx("button",{onClick:()=>T(p),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${d===p?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:Q(p)},p))]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"الإعدادات:"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:U.visualAlerts,onChange:()=>$("visualAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات المرئية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:U.soundAlerts,onChange:()=>$("soundAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات الصوتية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:U.autoRefresh,onChange:()=>$("autoRefresh"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التحديث التلقائي"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-96",children:x?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"جاري تحميل الإشعارات..."})]}):j.length===0?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(me,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"لا توجد إشعارات"}),e.jsx("p",{className:"text-gray-500",children:d==="all"?"لا توجد إشعارات حاليًا":`لا توجد إشعارات من نوع "${Q(d)}"`})]}):e.jsx("div",{className:"p-4 space-y-3",children:j.map(p=>e.jsx("div",{className:`p-4 rounded-lg border-r-4 ${h(p.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[f(p.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:p.message}),e.jsx("span",{className:"text-xs text-gray-500",children:m(p.createdAt)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"المستخدم:"})," ",p.userName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"تاريخ الانتهاء:"})," ",m(p.expiryDate)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",p.daysRemaining]})]})]})]})]})},p.id))})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["آخر تحديث: ",m(new Date)]}),e.jsx("button",{onClick:_,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"تحديث الإشعارات"})]})})]})}):null},Ir=({notification:n,onClose:c,soundEnabled:b,onToggleSound:u})=>{const[j,v]=l.useState(!1),[d,T]=l.useState(null);l.useEffect(()=>{if(n&&(v(!0),b&&x(n.type),n.type!=="urgent")){const f=setTimeout(()=>{w()},1e4);return()=>clearTimeout(f)}},[n,b]),l.useEffect(()=>{typeof window<"u"&&window.AudioContext&&T(new AudioContext)},[]);const x=f=>{if(!(!d||!b))try{const h=d.createOscillator(),m=d.createGain();switch(h.connect(m),m.connect(d.destination),f){case"urgent":h.frequency.setValueAtTime(800,d.currentTime),h.frequency.setValueAtTime(1e3,d.currentTime+.1),h.frequency.setValueAtTime(800,d.currentTime+.2),m.gain.setValueAtTime(.3,d.currentTime),m.gain.exponentialRampToValueAtTime(.01,d.currentTime+.5),h.start(d.currentTime),h.stop(d.currentTime+.5);break;case"warning":h.frequency.setValueAtTime(600,d.currentTime),h.frequency.setValueAtTime(700,d.currentTime+.15),m.gain.setValueAtTime(.2,d.currentTime),m.gain.exponentialRampToValueAtTime(.01,d.currentTime+.3),h.start(d.currentTime),h.stop(d.currentTime+.3);break;case"info":h.frequency.setValueAtTime(400,d.currentTime),m.gain.setValueAtTime(.1,d.currentTime),m.gain.exponentialRampToValueAtTime(.01,d.currentTime+.2),h.start(d.currentTime),h.stop(d.currentTime+.2);break}}catch(h){console.error("خطأ في تشغيل الصوت:",h)}},w=()=>{v(!1),setTimeout(()=>{c()},300)},U=f=>{switch(f){case"urgent":return{bg:"bg-red-500",border:"border-red-600",text:"text-white",icon:e.jsx(Ze,{className:"w-6 h-6"}),pulse:"animate-pulse"};case"warning":return{bg:"bg-yellow-500",border:"border-yellow-600",text:"text-white",icon:e.jsx(re,{className:"w-6 h-6"}),pulse:""};case"info":return{bg:"bg-blue-500",border:"border-blue-600",text:"text-white",icon:e.jsx(me,{className:"w-6 h-6"}),pulse:""};default:return{bg:"bg-gray-500",border:"border-gray-600",text:"text-white",icon:e.jsx(me,{className:"w-6 h-6"}),pulse:""}}},Z=f=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric"}).format(f);if(!n)return null;const _=U(n.type);return e.jsxs("div",{className:"fixed top-4 right-4 z-[9999]",children:[e.jsxs("div",{className:`
          transform transition-all duration-300 ease-in-out
          ${j?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
          ${_.bg} ${_.border} ${_.text} ${_.pulse}
          border-2 rounded-lg shadow-2xl max-w-md min-w-80
          backdrop-blur-sm
        `,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white border-opacity-20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[_.icon,e.jsxs("h3",{className:"font-bold text-lg",children:[n.type==="urgent"&&"تنبيه عاجل!",n.type==="warning"&&"تحذير",n.type==="info"&&"إشعار"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:u,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",title:b?"إيقاف الصوت":"تشغيل الصوت",children:b?e.jsx(jr,{className:"w-4 h-4"}):e.jsx(yr,{className:"w-4 h-4"})}),e.jsx("button",{onClick:w,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",children:e.jsx(ve,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-lg font-medium mb-3",children:n.message}),e.jsxs("div",{className:"space-y-2 text-sm opacity-90",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"المستخدم:"})," ",n.userName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"تاريخ انتهاء الاشتراك:"})," ",Z(n.expiryDate)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",n.daysRemaining," يوم"]})]})]}),n.type==="urgent"&&e.jsx("div",{className:"h-1 bg-white bg-opacity-20",children:e.jsx("div",{className:"h-full bg-white animate-pulse",style:{animation:"progress 10s linear forwards"}})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes progress {
          from { width: 100%; }
          to { width: 0%; }
        }
      `})]})},Lr=({user:n,onActivateSubscription:c,onDeactivateSubscription:b,onDeleteUser:u})=>{const[j,v]=l.useState(g.MONTHLY),[d,T]=l.useState(!1),x=Ia(),w=f=>{const h=f==null?void 0:f.displayName;if(typeof h=="string"&&h.trim())return h.trim();if(h&&typeof h=="object"){const m=h.full_name||h.name||h.ar||h.en;if(typeof m=="string"&&m.trim())return m.trim()}return typeof(f==null?void 0:f.email)=="string"&&f.email.includes("@")?f.email.split("@")[0]:"غير محدد"},U=f=>{switch(f){case g.LIFETIME:return e.jsx(ze,{className:"w-4 h-4 text-yellow-500"});case g.YEARLY:return e.jsx(ye,{className:"w-4 h-4 text-blue-500"});case g.QUARTERLY:return e.jsx(se,{className:"w-4 h-4 text-purple-500"});case g.MONTHLY:return e.jsx(Ts,{className:"w-4 h-4 text-green-500"});case g.FIVE_MINUTES:return e.jsx(re,{className:"w-4 h-4 text-orange-500"});case g.ZERO:return e.jsx(Nt,{className:"w-4 h-4 text-gray-500"});case g.TAHWEELA:return e.jsx(wt,{className:"w-4 h-4 text-blue-600"});default:return null}},Z=f=>{switch(f){case g.MONTHLY:return"شهرية";case g.QUARTERLY:return"ربع سنوية";case g.YEARLY:return"سنوية";case g.LIFETIME:return"مدى الحياة";case g.FIVE_MINUTES:return"5 دقايق";case g.ZERO:return"زيرو";case g.TAHWEELA:return"تحويله";default:return"غير محدد"}},_=f=>f?(f.toDate?f.toDate():new Date(f)).toLocaleDateString("ar-EG"):"غير محدد";return e.jsx(qe,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(Ye,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Lt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:w(n)}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(La,{className:"w-3 h-3 ml-1"}),n.email]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[e.jsx(Ft,{className:"w-3 h-3 ml-1"}),n.phone||"غير محدد"]})]})]}),e.jsx(Qe,{variant:n.isActive?"default":"secondary",children:n.isActive?"نشط":"غير نشط"})]}),n.subscription&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[U(n.subscription.planType),e.jsx("span",{className:"text-sm font-medium",children:Z(n.subscription.planType)})]}),e.jsx(Qe,{variant:n.subscription.isActive?"default":"destructive",children:n.subscription.isActive?"مفعل":"منتهي"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(se,{className:"w-3 h-3 ml-1"}),"البداية: ",_(n.subscription.startDate)]}),n.subscription.endDate&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"w-3 h-3 ml-1"}),"النهاية: ",_(n.subscription.endDate)]})]})]}),e.jsxs("div",{className:"space-y-3",children:[c&&d&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"اختر نوع الباقة:"}),x?e.jsxs("select",{className:"w-full h-10 border border-input bg-background rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring",value:j,onChange:f=>v(f.target.value),children:[e.jsx("option",{value:g.MONTHLY,children:"شهرية"}),e.jsx("option",{value:g.QUARTERLY,children:"ربع سنوية"}),e.jsx("option",{value:g.YEARLY,children:"سنوية"}),e.jsx("option",{value:g.LIFETIME,children:"مدى الحياة"}),e.jsx("option",{value:g.FIVE_MINUTES,children:"5 دقايق"}),e.jsx("option",{value:g.ZERO,children:"زيرو"}),e.jsx("option",{value:g.TAHWEELA,children:"تحويله"})]}):e.jsxs(cr,{value:j,onValueChange:f=>v(f),children:[e.jsx(dr,{className:"w-full",children:e.jsx(or,{placeholder:"اختر نوع الباقة"})}),e.jsxs(mr,{children:[e.jsx(ce,{value:g.MONTHLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"شهرية"})]})}),e.jsx(ce,{value:g.QUARTERLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:"ربع سنوية"})]})}),e.jsx(ce,{value:g.YEARLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:"سنوية"})]})}),e.jsx(ce,{value:g.LIFETIME,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(pr,{className:"w-4 h-4"}),e.jsx("span",{children:"مدى الحياة"})]})}),e.jsx(ce,{value:g.FIVE_MINUTES,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"5 دقايق"})]})}),e.jsx(ce,{value:g.ZERO,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Nt,{className:"w-4 h-4"}),e.jsx("span",{children:"زيرو"})]})}),e.jsx(ce,{value:g.TAHWEELA,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(wt,{className:"w-4 h-4"}),e.jsx("span",{children:"تحويله"})]})})]})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx(X,{size:"sm",onClick:()=>{c(n.id,j),T(!1)},className:"flex-1",children:"تأكيد التفعيل"}),e.jsx(X,{size:"sm",variant:"outline",onClick:()=>T(!1),className:"flex-1",children:"إلغاء"})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[c&&!d&&e.jsx(X,{size:"sm",variant:"outline",onClick:()=>T(!0),className:"flex-1",children:"تفعيل الاشتراك"}),b&&e.jsx(X,{size:"sm",variant:"outline",onClick:()=>b(n.id),className:"flex-1",children:"إلغاء الاشتراك"}),u&&e.jsx(X,{size:"sm",variant:"destructive",onClick:()=>u(n.id),children:e.jsx(It,{className:"w-4 h-4"})})]})]})]})})},Ur={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_VERSION:"0.0.0",VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"false",VITE_FIREBASE_API_KEY:"AIzaSyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s",VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_AUTH_EMULATOR_URL:"http://localhost:9099",VITE_FIREBASE_FIRESTORE_EMULATOR_HOST:"localhost:8080",VITE_FIREBASE_FUNCTIONS_EMULATOR_HOST:"localhost:5001",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.appspot.com",VITE_FORCE_HASH_ROUTER:"true",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"محل كاشي لينك التجريبي",VITE_SHOW_ENV_BANNER:"true",VITE_USE_EMULATORS:"false",VITE_USE_FIREBASE_EMULATOR:"false"},Rr=({navigate:n,auth:c,devMode:b,setDevMode:u,error:j,setError:v,authLoading:d,setAuthLoading:T,activeTab:x,setActiveTab:w,setNotificationCenterOpen:U,setNotificationSettings:Z,setNotifications:_,notificationCount:f,setNotificationCount:h,users:m,setUsers:Q,filteredUsers:$,setFilteredUsers:p,loading:B,setLoading:xe,setEditingPlan:R,isSavingContent:F,setIsSavingContent:V,lastUpdateInfo:le,loadContentFromFirebase:_e,saveContentToFirebase:Ae})=>{var De;const[K,we]=l.useState(!0),[M,N]=l.useState(""),[D,P]=l.useState(null),[J,O]=l.useState({}),[Xe,ue]=l.useState(!1),[te,_s]=l.useState(null),[ae,ee]=l.useState({name:"",price:"",period:"",description:"",features:[]}),[Vt,As]=l.useState(!1),[Fr,Vr]=l.useState(!1),[Mr,Or]=l.useState(null),[Pr,$r]=l.useState(!1),[Mt,Ot]=l.useState({sound:!0}),[Pt,Br]=l.useState(!1),[$t,Bt]=l.useState(null),[Ce,Ht]=l.useState([]),[Ds,Je]=l.useState(!1),[Cs,Ie]=l.useState(void 0),[es,Le]=l.useState(""),[ss,qt]=l.useState(null),[Is,Ls]=l.useState(!1),Us=Ce.filter(s=>!((s==null?void 0:s.contacted)===!0||(s==null?void 0:s.status)==="contacted")),Ue=Ce.filter(s=>(s==null?void 0:s.contacted)===!0||(s==null?void 0:s.status)==="contacted"),[Hr,qr]=l.useState(""),[Yr,zr]=l.useState(""),[Wr,Gr]=l.useState(""),[Zr,Qr]=l.useState(""),[Kr,Xr]=l.useState(!1),[Jr,el]=l.useState(!1),Yt=async s=>{try{await Ca(je(Y,"waiting_list",s),{contacted:!0,status:"contacted",contactedAt:vt()})}catch(t){console.error("Failed to mark waiting item as contacted",t),alert("حدث خطأ أثناء تحديث الحالة إلى تم التواصل.")}},[E,ie]=l.useState({}),[ts,zt]=l.useState(null),[as,Wt]=l.useState(null),[rs,Gt]=l.useState(null),[Rs,Fs]=l.useState(!1),[Vs,Ms]=l.useState(!1),[Os,Ps]=l.useState(!1),[he,$s]=l.useState(""),[ke,Zt]=l.useState(""),[Ee,Qt]=l.useState(""),[Kt,ls]=l.useState(0),[Xt,is]=l.useState(0),[Jt,ns]=l.useState(0),[Re,cs]=l.useState(""),[ds,Bs]=l.useState(""),[os,Hs]=l.useState(""),[qs,Ys]=l.useState(""),[zs,Ws]=l.useState(""),[Gs,Zs]=l.useState(""),[Fe,Qs]=l.useState(""),[Ks,Xs]=l.useState(""),[Js,et]=l.useState(!1);l.useEffect(()=>{(async()=>{try{const{systemSettingsService:s}=await I(async()=>{const{systemSettingsService:a}=await L(()=>import("./index-BsVRzvOf.js").then(r=>r.c3),__vite__mapDeps([0,1]),import.meta.url).then(r=>r.c4);return{systemSettingsService:a}},A([0,1]),import.meta.url),t=await s.getTelegramWorkerUrl();t&&Xs(t)}catch{}})()},[]);const[st,ea]=l.useState(!1),[Ve,ne]=l.useState("idle"),[tt,pe]=l.useState(""),[ms,at]=l.useState(""),[xs,rt]=l.useState(!1),[us,ge]=l.useState("idle"),[sa,Se]=l.useState("");l.useEffect(()=>{const s=Ea(t=>{Ys(String((t==null?void 0:t.version)||"")),Ws(String((t==null?void 0:t.downloadURL_64)||"")),Zs(String((t==null?void 0:t.downloadURL_32)||"")),Qs(String((t==null?void 0:t.notes)||""))});return()=>{try{s()}catch{}}},[]),l.useEffect(()=>{const s=Sa(t=>{$s(String((t==null?void 0:t.version)||"")),cs(String((t==null?void 0:t.url)||"")),at(String((t==null?void 0:t.notes)||"")),rt(!!(t!=null&&t.force))});return()=>{try{s()}catch{}}},[]);const ta=async()=>{var s;if(pe(""),!(c!=null&&c.currentUser)){ne("error"),pe("يرجى تسجيل الدخول كأدمن قبل النشر");try{alert("يرجى تسجيل الدخول كأدمن قبل النشر")}catch{}return}const t=qs.trim(),a=zs.trim(),r=Gs.trim();if(!t){ne("error"),pe("رقم الإصدار مطلوب");return}try{new URL(a)}catch{ne("error"),pe("رابط 64-بت غير صالح (يجب أن يكون https://)");return}try{new URL(r)}catch{ne("error"),pe("رابط 32-بت غير صالح (يجب أن يكون https://)");return}try{ne("publishing");const i=typeof window<"u"&&(window.electronAPI||typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("electron"));let o="";if(await Ma({version:t,downloadURL_64:a,downloadURL_32:r,notes:Fe.trim()},c.currentUser.uid),i&&(s=window.electronAPI)!=null&&s.publishDesktopVersion){const y=await c.currentUser.getIdToken(),S={version:t,updateUrl64:a,updateUrli32:r,notes:Fe.trim(),force:!!st};o=await window.electronAPI.publishDesktopVersion(y,S)}else o="";ne("done");try{localStorage.setItem("desktop_update_cache",JSON.stringify({version:t,downloadURL_64:a,downloadURL_32:r,notes:Fe.trim()}))}catch{}}catch(i){ne("error");const o=(i==null?void 0:i.message)||"فشل النشر: تأكد من الصلاحيات وحالة الاتصال";pe(o);try{alert(o)}catch{}}},Me=s=>{const t=s==null?void 0:s.displayName;let a="";typeof t=="string"?a=t:t&&typeof t=="object"&&(a=(t.ar||t.en||"").toString()),!a&&typeof(s==null?void 0:s.email)=="string"&&(a=s.email);const r=String(a).trim().charAt(0);return r?r.toUpperCase():"؟"},be=s=>{const t=s==null?void 0:s.displayName;if(typeof t=="string"&&t.trim())return t.trim();if(t&&typeof t=="object"){const a=t.full_name||t.name||t.ar||t.en;if(typeof a=="string"&&a.trim())return a.trim()}return typeof(s==null?void 0:s.email)=="string"&&s.email.includes("@")?s.email.split("@")[0]:"غير محدد"},[hs,lt]=l.useState(""),[ps,it]=l.useState(""),[nt,ct]=l.useState(""),[gs,dt]=l.useState(""),[ot,mt]=l.useState(!1),[Oe,xt]=l.useState(""),[H,ut]=l.useState(24),[ht,pt]=l.useState("24"),[gt,bt]=l.useState(!1),[sl,ft]=l.useState(!1);l.useEffect(()=>{x==="trials"&&(async()=>{try{ft(!0);const{FreeTrialService:s}=await I(async()=>{const{FreeTrialService:a}=await L(()=>import("./freeTrialService-BwabY7bi-CphYVBZa.js"),__vite__mapDeps([2,0,1]),import.meta.url);return{FreeTrialService:a}},A([2,0,1]),import.meta.url),t=await s.getTrialDurationHours();ut(t),pt(String(t))}catch(s){console.error("Failed to load trial duration",s)}finally{ft(!1)}})()},[x]),l.useEffect(()=>{x==="branding"&&(async()=>{try{const s=await za();Ie(s.logoUrl),Le(s.logoUrl||"")}catch(s){console.error("Failed to load branding config",s)}})()},[x]),l.useEffect(()=>{x==="application"&&(async()=>{try{const{getAppDownloads:s}=await I(async()=>{const{getAppDownloads:a}=await L(()=>import("./index-BsVRzvOf.js").then(r=>r.c3),__vite__mapDeps([0,1]),import.meta.url).then(r=>r.c6);return{getAppDownloads:a}},A([0,1]),import.meta.url),t=await s();ie(t||{}),cs((t==null?void 0:t.androidUrl)||""),Bs((t==null?void 0:t.pcUrl)||""),Hs((t==null?void 0:t.pc32Url)||"")}catch(s){console.error("Failed to load app downloads",s)}})()},[x]),l.useEffect(()=>{if(x==="waitingList"){Je(!0);try{const s=Ne(oe(Y,"waiting_list")),t=We(s,a=>{const r=a.docs.map(i=>({id:i.id,...i.data()})).sort((i,o)=>{var y,S,C,k,z,q;const W=((S=(y=i==null?void 0:i.createdAt)==null?void 0:y.toMillis)==null?void 0:S.call(y))??((C=i==null?void 0:i.createdAt)==null?void 0:C.seconds)*1e3??0;return(((z=(k=o==null?void 0:o.createdAt)==null?void 0:k.toMillis)==null?void 0:z.call(k))??((q=o==null?void 0:o.createdAt)==null?void 0:q.seconds)*1e3??0)-W});Ht(r),Je(!1)});return()=>t()}catch(s){console.error("Failed to subscribe to waiting_list:",s),Je(!1)}}},[x]);const aa=async()=>{var s;if(!hs.trim()||!ps.trim()){alert("يرجى كتابة عنوان ورسالة الإشعار");return}try{mt(!0);const t=gs.trim()?`user:${gs.trim()}`:"global";await ir({title:hs.trim(),message:ps.trim(),audienceKey:t,createdBy:(s=c==null?void 0:c.currentUser)==null?void 0:s.uid,linkUrl:nt.trim()||void 0}),lt(""),it(""),ct(""),dt(""),alert("تم إرسال الإشعار بنجاح!")}catch(t){console.error("خطأ في إرسال الإشعار:",t),alert("حدث خطأ أثناء إرسال الإشعار")}finally{mt(!1)}};l.useEffect(()=>{if(!M.trim())p(m);else{const s=m.filter(t=>t.email&&typeof t.email=="string"&&t.email.toLowerCase().includes(M.toLowerCase())||t.displayName&&typeof t.displayName=="string"&&t.displayName.toLowerCase().includes(M.toLowerCase())||t.name&&typeof t.name=="string"&&t.name.toLowerCase().includes(M.toLowerCase()));p(s)}},[m,M,p]);const ra=()=>{c!=null&&c.signOut&&c.signOut(),n("/admin/login")},la=()=>{const[s,t]=l.useState(""),[a,r]=l.useState("شرح التطبيق"),[i,o]=l.useState(!1),[y,S]=l.useState(null);l.useEffect(()=>{const k=We(je(Y,"app_guides","latest"),z=>{S(z.exists()?z.data():null)});return()=>k()},[]);const C=async()=>{try{o(!0);const k=s.trim();try{new URL(k)}catch{alert("رابط غير صالح، يرجى إدخال رابط https صالح"),o(!1);return}await kt(je(Y,"app_guides","latest"),{url:k,title:a.trim()||"شرح التطبيق",publishedAt:vt()},{merge:!0}),alert("تم نشر الرابط لجميع المستخدمين")}catch(k){console.error("Failed to publish guide:",k),alert("حدث خطأ أثناء النشر")}finally{o(!1)}};return e.jsxs("div",{className:"space-y-3",children:[y&&e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"الرابط الحالي:"}),e.jsx("a",{href:y.url,target:"_blank",rel:"noreferrer",className:"text-blue-600 text-sm hover:underline break-all",children:y.url})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-700",children:"عنوان الفيديو"}),e.jsx("input",{value:a,onChange:k=>r(k.target.value),className:"mt-1 w-full border rounded px-3 py-2",placeholder:"مثال: مقدمة Cashy Link"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"text-sm text-gray-700",children:"رابط يوتيوب"}),e.jsx("input",{value:s,onChange:k=>t(k.target.value),className:"mt-1 w-full border rounded px-3 py-2",placeholder:"https://www.youtube.com/watch?v=... أو https://youtu.be/..."})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:C,disabled:i,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50",children:i?"جاري النشر...":"نشر الرابط"})})]})},ia=async(s,t,a=null)=>{var r;try{console.log("Activating subscription for user:",s,"with plan:",t,"and variant:",a);const i=((r=c==null?void 0:c.currentUser)==null?void 0:r.uid)||"admin-user-id";await Va(s,t,i,a),console.log("✅ تم تفعيل الاشتراك بنجاح")}catch(i){console.error("❌ خطأ في تفعيل الاشتراك:",i),alert("حدث خطأ في تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},jt=async s=>{try{console.log("Deactivating subscription for user:",s),await Fa(s),console.log("✅ تم إلغاء تفعيل الاشتراك بنجاح")}catch(t){console.error("❌ خطأ في إلغاء تفعيل الاشتراك:",t),alert("حدث خطأ في إلغاء تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},na=async s=>{var t;try{if(!window.confirm(`هل أنت متأكد من حذف هذا المستخدم نهائياً؟

سيتم حذف:
- حساب المستخدم
- جميع بياناته
- اشتراكه
- معاملاته
- محادثاته

هذا الإجراء لا يمكن التراجع عنه!`))return;console.log("بدء حذف المستخدم:",s);const a=((t=c==null?void 0:c.currentUser)==null?void 0:t.uid)||"unknown-admin";try{const r=await Ua(Ra,"deleteUserPermanently")({userId:s});console.log("استجابة دالة الحذف النهائي:",r),Q(i=>i.filter(o=>o.id!==s)),p(i=>i.filter(o=>o.id!==s)),alert("تم حذف المستخدم نهائياً مع جميع بياناته وحساب المصادقة.");return}catch(r){console.warn("تعذر تنفيذ الحذف النهائي عبر Cloud Functions، سيتم استخدام الحذف المحلي المؤقت:",(r==null?void 0:r.message)||r)}{const r=[];try{await Te(je(Y,"profiles",s)),console.log("تم حذف الملف الشخصي")}catch(i){console.error("خطأ في حذف الملف الشخصي:",i),r.push(`الملف الشخصي: ${(i==null?void 0:i.message)||i}`)}try{await Te(je(Y,"users",s)),console.log("تم حذف وثيقة المستخدم من مجموعة users")}catch(i){console.error("خطأ في حذف وثيقة المستخدم من مجموعة users:",i),r.push(`users: ${(i==null?void 0:i.message)||i}`)}try{const i=Ne(oe(Y,"transactions"),Ss("userId","==",s)),o=await He(i),y=o.docs.map(k=>Te(k.ref)),S=await Promise.allSettled(y),C=S.filter(k=>k.status==="rejected");C.length?(console.warn("فشل حذف بعض المعاملات:",C.length),r.push(`المعاملات: فشل حذف ${C.length} من أصل ${S.length}`)):console.log(`تم حذف ${o.size} معاملة`)}catch(i){console.error("خطأ في جلب/حذف المعاملات:",i),r.push(`المعاملات: ${(i==null?void 0:i.message)||i}`)}try{const i=Ne(oe(Y,"chatRooms"),Ss("participants","array-contains",s)),o=await He(i),y=o.docs.map(async S=>{try{const C=(await He(oe(S.ref,"messages"))).docs.map(k=>Te(k.ref));await Promise.allSettled(C),await Te(S.ref)}catch(C){console.error("فشل حذف محادثة/رسائل:",C),r.push(`المحادثات: ${S.id}`)}});await Promise.all(y),console.log(`تم إنهاء معالجة ${o.size} محادثة`)}catch(i){console.error("خطأ في جلب/حذف المحادثات:",i),r.push(`المحادثات: ${(i==null?void 0:i.message)||i}`)}try{await kt(je(Y,"deletedUsers",s),{deletedAt:new Date,deletedBy:a,reason:"حذف نهائي من لوحة الإدارة"})}catch(i){console.error("خطأ في تسجيل المستخدم كمحذوف:",i),r.push(`deletedUsers: ${(i==null?void 0:i.message)||i}`)}Q(i=>i.filter(o=>o.id!==s)),p(i=>i.filter(o=>o.id!==s)),r.length===0?alert("تم حذف بيانات المستخدم محلياً بنجاح. ملاحظة: حساب المصادقة لم يُحذف."):alert(`تم حذف المستخدم مع ملاحظات:
- ${r.join(`
- `)}

بعض الموارد قد لم تُحذف بالكامل. يمكنك إعادة المحاولة لاحقًا.`)}}catch(a){console.error("❌ خطأ في حذف المستخدم:",a),alert(`حدث خطأ في حذف المستخدم: ${a.message||"خطأ غير معروف"}`)}};l.useEffect(()=>{(async()=>{try{if(typeof _e=="function"){const s=await _e();s&&(s.monthly||s.yearly||s.lifetime)&&O(s)}}catch(s){console.warn("Failed to load content data:",s)}})()},[]);const ca=async()=>{var s;try{if(typeof Ae!="function")return;V(!0);const t=((s=c==null?void 0:c.currentUser)==null?void 0:s.uid)||"admin-user-id";await Ae(J,t),alert("تم حفظ جميع التغييرات بنجاح")}catch(t){console.error("❌ خطأ في حفظ المحتوى:",t),alert(`فشل في حفظ المحتوى: ${(t==null?void 0:t.message)||"خطأ غير معروف"}`)}finally{V(!1)}},Pe=(s,t,a)=>{O(r=>({...r,[s]:{...(r==null?void 0:r[s])||{},[t]:a}}))},da=s=>{O(t=>{var a;return{...t,[s]:{...(t==null?void 0:t[s])||{},features:[...((a=t==null?void 0:t[s])==null?void 0:a.features)||[],""]}}})},oa=(s,t,a)=>{O(r=>{var i;const o=[...((i=r==null?void 0:r[s])==null?void 0:i.features)||[]];return o[t]=a,{...r,[s]:{...(r==null?void 0:r[s])||{},features:o}}})},ma=(s,t)=>{O(a=>{var r;const i=[...((r=a==null?void 0:a[s])==null?void 0:r.features)||[]];return i.splice(t,1),{...a,[s]:{...(a==null?void 0:a[s])||{},features:i}}})},xa=()=>{Ot(s=>({...s,sound:!s.sound}))},ua=()=>{Bt(null)},ha=async()=>{try{const s=Number(ht);if(isNaN(s)||s<1){alert("يرجى إدخال مدة صحيحة بالساعات");return}bt(!0);const{FreeTrialService:t}=await I(async()=>{const{FreeTrialService:r}=await L(()=>import("./freeTrialService-BwabY7bi-CphYVBZa.js"),__vite__mapDeps([2,0,1]),import.meta.url);return{FreeTrialService:r}},A([2,0,1]),import.meta.url),a=await t.updateTrialDurationHours(s);a.success?(ut(s),alert(a.message)):alert(a.message||"فشل تحديث مدة التجربة")}catch(s){console.error("Error updating trial duration:",s),alert("حدث خطأ أثناء تحديث مدة التجربة")}finally{bt(!1)}},pa=async s=>{try{const{FreeTrialService:t}=await I(async()=>{const{FreeTrialService:r}=await L(()=>import("./freeTrialService-BwabY7bi-CphYVBZa.js"),__vite__mapDeps([2,0,1]),import.meta.url);return{FreeTrialService:r}},A([2,0,1]),import.meta.url),a=await t.startFreeTrialFromAdmin(s);alert(a.message||`تم تفعيل التجربة المجانية لمدة ${H} ${H>=3&&H<=10?"ساعات":H===2?"ساعتين":"ساعة"}`)}catch(t){console.error("Error activating free trial:",t),alert("حدث خطأ أثناء تفعيل التجربة المجانية. يرجى المحاولة مرة أخرى.")}},ga=async s=>{try{const{FreeTrialService:t}=await I(async()=>{const{FreeTrialService:r}=await L(()=>import("./freeTrialService-BwabY7bi-CphYVBZa.js"),__vite__mapDeps([2,0,1]),import.meta.url);return{FreeTrialService:r}},A([2,0,1]),import.meta.url),a=await t.cancelActiveFreeTrial(s)}catch(t){console.error("Error cancelling free trial:",t)}},ba=async s=>{try{const{FreeTrialService:t}=await I(async()=>{const{FreeTrialService:r}=await L(()=>import("./freeTrialService-BwabY7bi-CphYVBZa.js"),__vite__mapDeps([2,0,1]),import.meta.url);return{FreeTrialService:r}},A([2,0,1]),import.meta.url),a=await t.resetActiveTrialToCurrentDuration(s);alert(a.message)}catch(t){console.error("Error resetting user trial end:",t),alert("حدث خطأ أثناء تحديث نهاية التجربة.")}},fa=(s,t)=>{console.log("Toggling user status:",s,t)},bs=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleDateString("ar-EG",{year:"numeric",month:"2-digit",day:"2-digit"}):"غير محدد",ja=[{id:"users",label:"المستخدمين",icon:ws},{id:"subscriptions",label:"مواعيد الاشتراكات",icon:se},{id:"trials",label:"إدارة التجارب المجانية",icon:ye},{id:"content",label:"إدارة المحتوى",icon:Ta},{id:"guide",label:"شرح",icon:fr},{id:"branding",label:"العلامة التجارية",icon:It},{id:"application",label:"التطبيق",icon:js},{id:"whatsapp",label:"إدارة الواتساب",icon:Ge},{id:"branches",label:"باقات الفروع",icon:At},{id:"analytics",label:"الإحصائيات",icon:Tt},{id:"externalNotifications",label:"إشعارات خارجية",icon:me}];return d?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري التحقق من المصادقة..."}),!1]})}):j?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"حدث خطأ في لوحة التحكم"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700 text-sm font-medium",children:j})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{v(null),n("/admin/login")},className:"w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"🔑 العودة لتسجيل الدخول"}),!1,e.jsx("button",{onClick:()=>{console.log("🔍 Current error details:",j),console.log("🔍 Auth state:",c.currentUser),console.log("🔍 Dev mode:",b),console.log("🔍 Environment:",Ur)},className:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:"🐛 طباعة تفاصيل الخطأ في وحدة التحكم"})]})]})}):!b&&!c.currentUser?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"لوحة تحكم المدير"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"يجب تسجيل الدخول للوصول إلى لوحة التحكم"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>n("/admin/login"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"🔑 تسجيل الدخول"}),!1]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col md:flex-row overflow-x-hidden",children:[e.jsxs("div",{className:`bg-white shadow-lg transition-all duration-300 flex flex-col z-40 ${K?"translate-x-0 w-64 md:w-64":"translate-x-full w-64 md:w-16 md:translate-x-0"} fixed inset-y-0 right-0 md:static md:inset-auto`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[K&&e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(xr,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"لوحة الإدارة"}),e.jsx("p",{className:"text-sm text-gray-500",children:"نظام التحكم"})]})]}),e.jsx("button",{onClick:()=>we(!K),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:K?e.jsx(ve,{className:"w-5 h-5"}):e.jsx(gr,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4",children:e.jsx("ul",{className:"space-y-2",children:ja.map(s=>{const t=s.icon;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>{if(s.id==="externalNotifications"){n("/admin/notifications");return}w(s.id)},className:`w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg transition-colors ${x===s.id?"bg-gradient-to-r from-purple-600 to-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(t,{className:"w-5 h-5"}),K&&e.jsx("span",{className:"font-medium",children:s.label})]})},s.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:ra,className:"w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(_a,{className:"w-5 h-5"}),K&&e.jsx("span",{className:"font-medium",children:"تسجيل الخروج"})]})})]}),K&&e.jsx("div",{className:"fixed inset-0 bg-black/30 md:hidden",onClick:()=>we(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[!K&&e.jsx("button",{className:"md:hidden p-2 rounded-lg hover:bg-gray-100",onClick:()=>we(!0),"aria-label":"فتح القائمة",children:e.jsx(yt,{className:"w-5 h-5"})}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[x==="users"&&"إدارة المستخدمين",x==="waitingList"&&"قائمة الانتظار",x==="subscriptions"&&"مواعيد الاشتراكات",x==="trials"&&"إدارة التجارب المجانية",x==="branding"&&"إعدادات العلامة التجارية",x==="guide"&&"شرح التطبيق",x==="application"&&"إدارة التطبيق",x==="analytics"&&"الإحصائيات",x==="branches"&&"باقات الفروع"]}),b&&e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full",children:"🔧 وضع التطوير"})]}),e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["مرحباً، ",b?"المطور":"المدير"]}),e.jsx(Za,{})]})]})}),e.jsxs("main",{className:"flex-1 p-3 sm:p-4 md:p-6 max-w-full overflow-x-hidden",children:[x==="waitingList"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"طلبات قائمة الانتظار"}),e.jsx("div",{className:"text-sm text-gray-500 flex items-center gap-3",children:Ds?"جاري التحميل...":e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["إجمالي: ",Ce.length]}),e.jsxs("span",{className:"text-red-600",children:["قيد الانتظار: ",Us.length]}),e.jsxs("span",{className:"text-green-600",children:["تم التواصل: ",Ue.length]})]})})]}),e.jsx("div",{className:"overflow-x-auto",children:Ds?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل الطلبات..."})]}):Ce.length===0?e.jsx("div",{className:"p-8 text-center text-gray-600",children:"لا توجد طلبات في قائمة الانتظار حالياً"}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الاسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"المعرف"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"سبب الطلب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"رقم الواتساب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الإجراء"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ الإنشاء"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Us.map(s=>{var t;const a=(s.phone||"").toString(),r=a.replace(/\D/g,"");let i=null;const o="مرحباً، طلبت التحدث معنا. كيف نساعدك؟";try{Ut(a)&&(i=Rt(a,o))}catch{i=null}const y=(t=s.createdAt)!=null&&t.toDate?s.createdAt.toDate():s.createdAt?new Date(s.createdAt):null;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800",children:s.name||"غير محدد"}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500",children:s.userId||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:s.reason||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:r||"—"}),e.jsxs("td",{className:"px-4 py-3 flex items-center gap-2",children:[i?e.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",children:e.jsx("button",{className:"px-3 py-1.5 rounded-md bg-green-600 text-white text-sm hover:bg-green-700",children:"واتساب"})}):e.jsx("span",{className:"text-xs text-gray-400",children:"لا يوجد رقم"}),e.jsx("button",{className:"px-3 py-1.5 rounded-md bg-indigo-600 text-white text-sm hover:bg-indigo-700",onClick:()=>Yt(s.id),title:"تمييز كتم التواصل",children:"تم التواصل"})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:y?y.toLocaleString("ar-EG"):"غير محدد"})]},s.id)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"تم التواصل"}),e.jsx("div",{className:"text-sm text-gray-500",children:Ue.length})]}),e.jsx("div",{className:"overflow-x-auto",children:Ue.length===0?e.jsx("div",{className:"p-8 text-center text-gray-600",children:"لا يوجد عناصر في قسم تم التواصل"}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الاسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"المعرف"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"سبب الطلب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"رقم الواتساب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الحالة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ التواصل"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ue.map(s=>{var t;const a=(s.phone||"").toString().replace(/\D/g,""),r=(t=s.contactedAt)!=null&&t.toDate?s.contactedAt.toDate():s.contactedAt?new Date(s.contactedAt):null;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800",children:s.name||"غير محدد"}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500",children:s.userId||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:s.reason||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:a||"—"}),e.jsx("td",{className:"px-4 py-3 text-xs",children:e.jsx("span",{className:"px-2 py-1 rounded-full bg-green-100 text-green-700",children:"تم التواصل"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:r?r.toLocaleString("ar-EG"):"غير محدد"})]},s.id)})})]})})]})]}),x==="users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي المستخدمين"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:m.length})]}),e.jsx(ws,{className:"w-8 h-8 text-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"معرف المستخدم (اختياري)"}),e.jsx("input",{type:"text",value:gs,onChange:s=>dt(s.target.value),placeholder:"ضع uid الخاص بالمستخدم لاستهداف إشعار شخصي",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اتركه فارغًا للإرسال العام؛ إن وضعته سيتم إرسال الإشعار لهذا المستخدم فقط."})]})]}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>s.isActive).length})]}),e.jsx(Ct,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المعطلين"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.filter(s=>!s.isActive).length})]}),e.jsx(br,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قائمة المستخدمين"}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن مستخدم...",value:M,onChange:s=>N(s.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),M&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",$.length," من أصل ",m.length," مستخدم",M&&e.jsx("button",{onClick:()=>N(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:B?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):$.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:M?"لا توجد نتائج للبحث":"لا توجد بيانات مستخدمين"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:$.map(s=>e.jsx(Lr,{user:s,onActivateSubscription:ia,onToggleUserStatus:fa,onDeactivateSubscription:jt,onDeleteUser:na},s.id))})})]})]}),x==="application"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(js,{className:"w-5 h-5 text-green-600"})," إدارة تطبيق الأندرويد"]}),(E==null?void 0:E.androidUrl)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["الرابط الحالي: ",e.jsx("a",{href:fe(E.androidUrl),className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:"تنزيل"}),E.androidVersion?` | الإصدار: ${E.androidVersion}`:""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملف APK"}),e.jsx("input",{type:"file",accept:".apk",onChange:s=>{var t;return zt(((t=s.target.files)==null?void 0:t[0])||null)},className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:he,onChange:s=>$s(s.target.value),placeholder:"مثال: 1.0.3",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:async()=>{var s;if(ts)try{Fs(!0),ls(0);const{uploadAppBinaryResumable:t}=await I(async()=>{const{uploadAppBinaryResumable:r}=await L(()=>import("./index-BsVRzvOf.js").then(i=>i.c3),__vite__mapDeps([0,1]),import.meta.url).then(i=>i.c6);return{uploadAppBinaryResumable:r}},A([0,1]),import.meta.url),a=await t(ts,"android",((s=c==null?void 0:c.currentUser)==null?void 0:s.uid)||"admin",he||void 0,r=>ls(r),3e5);ie(r=>({...r,androidUrl:a,androidVersion:he||r.androidVersion}))}catch(t){console.error("Android upload failed",t),alert(t!=null&&t.message?`فشل رفع تطبيق الأندرويد: ${t.message}`:"فشل رفع تطبيق الأندرويد")}finally{Fs(!1),ls(0)}},disabled:Rs||!ts,className:"w-full sm:w-auto flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50",children:[e.jsx(Be,{className:"w-4 h-4"}),Rs?`جاري الرفع... ${Kt}%`:"رفع تطبيق الأندرويد"]}),(E==null?void 0:E.androidUrl)&&e.jsxs("a",{href:fe(E.androidUrl),className:"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(ks,{className:"w-4 h-4"})," تنزيل الحالي"]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط مباشر لتطبيق الأندرويد (APK)"}),e.jsx("input",{type:"url",value:Re,onChange:s=>cs(s.target.value),placeholder:"https://example.com/app-release.apk",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:e.jsxs("button",{onClick:async()=>{var s;try{const{setAppDownloadLinks:t}=await I(async()=>{const{setAppDownloadLinks:a}=await L(()=>import("./index-BsVRzvOf.js").then(r=>r.c3),__vite__mapDeps([0,1]),import.meta.url).then(r=>r.c6);return{setAppDownloadLinks:a}},A([0,1]),import.meta.url);await t({androidUrl:Re||void 0,androidVersion:he||void 0},((s=c==null?void 0:c.currentUser)==null?void 0:s.uid)||"admin"),ie(a=>({...a,androidUrl:Re||void 0,androidVersion:he||(a==null?void 0:a.androidVersion)})),alert("تم حفظ رابط الأندرويد بنجاح")}catch(t){console.error("Failed to save android link",t),alert(t!=null&&t.message?`فشل حفظ الرابط: ${t.message}`:"فشل حفظ الرابط")}},className:"w-full sm:w-auto flex items-center gap-2 bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700",children:[e.jsx(de,{className:"w-4 h-4"})," حفظ الرابط"]})})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملاحظات الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:ms,onChange:s=>at(s.target.value),placeholder:"مثال: إصلاحات وتحسينات",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:xs,onChange:s=>rt(s.target.checked)}),"تحديث إجباري"]})})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("button",{onClick:async()=>{if(Se(""),!(c!=null&&c.currentUser)){ge("error"),Se("يرجى تسجيل الدخول كأدمن قبل النشر");try{alert("يرجى تسجيل الدخول كأدمن قبل النشر")}catch{}return}const s=he.trim(),t=Re.trim();if(!s){ge("error"),Se("رقم الإصدار مطلوب");return}try{new URL(t)}catch{ge("error"),Se("رابط APK غير صالح (يجب أن يكون https://)");return}try{ge("publishing"),await Aa({version:s,url:t,notes:ms.trim(),force:!!xs},c.currentUser.uid),ge("done");try{localStorage.setItem("android_update_cache",JSON.stringify({version:s,url:t,notes:ms.trim(),force:!!xs}))}catch{}alert("تم حفظ تحديث الأندرويد في قاعدة البيانات")}catch(a){ge("error");const r=(a==null?void 0:a.message)||"فشل النشر: تأكد من الصلاحيات وحالة الاتصال";Se(r);try{alert(r)}catch{}}},className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"نشر تحديث الأندرويد"}),us==="publishing"&&e.jsx("span",{className:"text-sm text-gray-600",children:"جاري النشر..."}),us==="error"&&e.jsx("span",{className:"text-sm text-red-600",children:sa}),us==="done"&&e.jsx("span",{className:"text-sm text-green-600",children:"تم النشر"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(St,{className:"w-5 h-5 text-indigo-600"})," إدارة تطبيق الكمبيوتر (Windows) — 64 بت"]}),(E==null?void 0:E.pcUrl)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["الرابط الحالي: ",e.jsx("a",{href:fe(E.pcUrl),className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:"تنزيل"}),E.pcVersion?` | الإصدار: ${E.pcVersion}`:""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملف التطبيق (EXE/ZIP)"}),e.jsx("input",{type:"file",accept:".exe,.zip",onChange:s=>{var t;return Wt(((t=s.target.files)==null?void 0:t[0])||null)},className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:ke,onChange:s=>Zt(s.target.value),placeholder:"مثال: 2.1.0",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:async()=>{var s;if(as)try{Ms(!0),is(0);const{uploadAppBinaryResumable:t}=await I(async()=>{const{uploadAppBinaryResumable:r}=await L(()=>import("./index-BsVRzvOf.js").then(i=>i.c3),__vite__mapDeps([0,1]),import.meta.url).then(i=>i.c6);return{uploadAppBinaryResumable:r}},A([0,1]),import.meta.url),a=await t(as,"pc",((s=c==null?void 0:c.currentUser)==null?void 0:s.uid)||"admin",ke||void 0,r=>is(r),3e5);ie(r=>({...r,pcUrl:a,pcVersion:ke||r.pcVersion}))}catch(t){console.error("PC upload failed",t),alert(t!=null&&t.message?`فشل رفع تطبيق الكمبيوتر: ${t.message}`:"فشل رفع تطبيق الكمبيوتر")}finally{Ms(!1),is(0)}},disabled:Vs||!as,className:"w-full sm:w-auto flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:[e.jsx(Be,{className:"w-4 h-4"}),Vs?`جاري الرفع... ${Xt}%`:"رفع تطبيق الكمبيوتر"]}),(E==null?void 0:E.pcUrl)&&e.jsxs("a",{href:fe(E.pcUrl),className:"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(ks,{className:"w-4 h-4"})," تنزيل نسخة 64 بت"]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط مباشر لتطبيق الكمبيوتر (EXE/ZIP)"}),e.jsx("input",{type:"url",value:ds,onChange:s=>Bs(s.target.value),placeholder:"https://example.com/cashy-setup.exe",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:async()=>{var s;try{const{setAppDownloadLinks:t}=await I(async()=>{const{setAppDownloadLinks:a}=await L(()=>import("./index-BsVRzvOf.js").then(r=>r.c3),__vite__mapDeps([0,1]),import.meta.url).then(r=>r.c6);return{setAppDownloadLinks:a}},A([0,1]),import.meta.url);await t({pcUrl:ds||void 0,pcVersion:ke||void 0},((s=c==null?void 0:c.currentUser)==null?void 0:s.uid)||"admin"),ie(a=>({...a,pcUrl:ds||void 0,pcVersion:ke||(a==null?void 0:a.pcVersion)})),alert("تم حفظ رابط الكمبيوتر بنجاح")}catch(t){console.error("Failed to save pc link",t),alert(t!=null&&t.message?`فشل حفظ الرابط: ${t.message}`:"فشل حفظ الرابط")}},className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700",children:[e.jsx(de,{className:"w-4 h-4"})," حفظ الرابط"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(St,{className:"w-5 h-5 text-sky-600"})," إدارة تطبيق الكمبيوتر (Windows) — 32 بت"]}),(E==null?void 0:E.pc32Url)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["الرابط الحالي: ",e.jsx("a",{href:fe(E.pc32Url),className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:"تنزيل"}),E.pc32Version?` | الإصدار: ${E.pc32Version}`:""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملف التطبيق (EXE/ZIP)"}),e.jsx("input",{type:"file",accept:".exe,.zip",onChange:s=>{var t;return Gt(((t=s.target.files)==null?void 0:t[0])||null)},className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:Ee,onChange:s=>Qt(s.target.value),placeholder:"مثال: 2.1.0",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:async()=>{var s;if(rs)try{Ps(!0),ns(0);const{uploadAppBinaryResumable:t}=await I(async()=>{const{uploadAppBinaryResumable:r}=await L(()=>import("./index-BsVRzvOf.js").then(i=>i.c3),__vite__mapDeps([0,1]),import.meta.url).then(i=>i.c6);return{uploadAppBinaryResumable:r}},A([0,1]),import.meta.url),a=await t(rs,"pc32",((s=c==null?void 0:c.currentUser)==null?void 0:s.uid)||"admin",Ee||void 0,r=>ns(r),3e5);ie(r=>({...r,pc32Url:a,pc32Version:Ee||r.pc32Version}))}catch(t){console.error("PC32 upload failed",t),alert(t!=null&&t.message?`فشل رفع تطبيق 32 بت: ${t.message}`:"فشل رفع تطبيق 32 بت")}finally{Ps(!1),ns(0)}},disabled:Os||!rs,className:"w-full sm:w-auto flex items-center gap-2 bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700 disabled:opacity-50",children:[e.jsx(Be,{className:"w-4 h-4"}),Os?`جاري الرفع... ${Jt}%`:"رفع تطبيق 32 بت"]}),(E==null?void 0:E.pc32Url)&&e.jsxs("a",{href:fe(E.pc32Url),className:"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(ks,{className:"w-4 h-4"})," تنزيل نسخة 32 بت"]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط مباشر لتطبيق الكمبيوتر نسخة 32 بت (EXE/ZIP)"}),e.jsx("input",{type:"url",value:os,onChange:s=>Hs(s.target.value),placeholder:"https://example.com/cashy-setup-ia32.exe",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:async()=>{var s;try{const{setAppDownloadLinks:t}=await I(async()=>{const{setAppDownloadLinks:a}=await L(()=>import("./index-BsVRzvOf.js").then(r=>r.c3),__vite__mapDeps([0,1]),import.meta.url).then(r=>r.c6);return{setAppDownloadLinks:a}},A([0,1]),import.meta.url);await t({pc32Url:os||void 0,pc32Version:Ee||void 0},((s=c==null?void 0:c.currentUser)==null?void 0:s.uid)||"admin"),ie(a=>({...a,pc32Url:os||void 0,pc32Version:Ee||(a==null?void 0:a.pc32Version)})),alert("تم حفظ رابط 32 بت بنجاح")}catch(t){console.error("Failed to save pc32 link",t),alert(t!=null&&t.message?`فشل حفظ الرابط: ${t.message}`:"فشل حفظ الرابط")}},className:"flex items-center gap-2 bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700",children:[e.jsx(de,{className:"w-4 h-4"})," حفظ الرابط"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Dt,{className:"w-5 h-5 text-indigo-600"})," إدارة تحديثات برنامج الكمبيوتر"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"إصدار موحّد مع روابط 64-بت و32-بت، وملاحظات وخيار التحديث الإجباري."})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار"}),e.jsx("input",{type:"text",value:qs,onChange:s=>Ys(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"مثال: 1.4.0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط نسخة 64-بت"}),e.jsx("input",{type:"text",value:zs,onChange:s=>Ws(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"رابط المثبّت x64"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط نسخة 32-بت"}),e.jsx("input",{type:"text",value:Gs,onChange:s=>Zs(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"رابط المثبّت ia32"})]}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملاحظات التحديث"}),e.jsx("textarea",{value:Fe,onChange:s=>Qs(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",rows:4,placeholder:"نص الملاحظات"})]}),e.jsx("div",{children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:st,onChange:s=>ea(s.target.checked)}),"تحديث إجباري (لن يفتح التطبيق إلا بعد التحديث)"]})})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("button",{onClick:ta,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-60",disabled:Ve==="publishing",children:"نشر التحديث"}),Ve==="publishing"&&e.jsx("span",{className:"text-sm text-gray-600",children:"جاري النشر..."}),Ve==="done"&&e.jsx("span",{className:"text-sm text-green-600",children:"تم النشر بنجاح"}),Ve==="error"&&e.jsx("span",{className:"text-sm text-red-600",children:"فشل النشر"}),tt&&e.jsx("span",{className:"text-sm text-red-600",children:tt})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(js,{className:"w-5 h-5 text-emerald-600"})," إعداد إشعار تحديث تطبيق الأندرويد (Firestore)"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"يقرأه تطبيق الأندرويد عند الفتح ويعرض نافذة داخلية للتنزيل."})]})}),e.jsx("div",{className:"text-sm text-gray-600",children:"تم إلغاء إدارة تحديث تطبيق الموبايل من لوحة الأدمن."})]})]}),x==="guide"&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"نشر شرح التطبيق (YouTube)"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'أدخل رابط فيديو يوتيوب وسيصل لجميع المستخدمين عبر أيقونة "شرح" في صفحة المعاملات على وضع الكمبيوتر.'}),e.jsx(la,{})]})}),x==="branches"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"طلبات باقات الفروع (بانتظار التفعيل)"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:m.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.status)==="pending"||((a=s.branchPackage)==null?void 0:a.requested)}).length})]}),e.jsx(At,{className:"w-8 h-8 text-purple-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"باقات الفروع المفعّلة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>{var t;return((t=s.branchPackage)==null?void 0:t.status)==="active"}).length})]}),e.jsx(Es,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي حسابات باقات الفروع"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:m.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).length})]}),e.jsx(ws,{className:"w-8 h-8 text-blue-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قسم باقات الفروع"}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن حساب باقات الفروع...",value:M,onChange:s=>N(s.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),M&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",$.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).length," من أصل ",m.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).length," حساب",M&&e.jsx("button",{onClick:()=>N(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:B?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4",children:(M?$:m).filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).map(s=>{var t,a,r;const i=((t=s.branchPackage)==null?void 0:t.status)||((a=s.branchPackage)!=null&&a.requested?"pending":"none");return e.jsxs("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-purple-600 font-semibold",children:Me(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:be(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),((r=s.branchPackage)==null?void 0:r.requestedAt)&&e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ الطلب: ",bs(s.branchPackage.requestedAt)]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${i==="active"?"bg-green-100 text-green-700":i==="pending"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:i==="active"?"مفعّل":i==="pending"?"بانتظار التفعيل":"غير محدد"}),i==="active"&&e.jsx("button",{title:"إلغاء باقة الفروع",onClick:async()=>{var o;if(window.confirm("هل تريد إلغاء تفعيل باقة الفروع لهذا الحساب؟"))try{const{doc:y,updateDoc:S}=await I(async()=>{const{doc:z,updateDoc:q}=await L(()=>import("./index-BsVRzvOf.js").then(W=>W.c3),__vite__mapDeps([0,1]),import.meta.url).then(W=>W.c2);return{doc:z,updateDoc:q}},A([0,1]),import.meta.url),{db:C}=await I(async()=>{const{db:z}=await L(()=>import("./index-BsVRzvOf.js").then(q=>q.c3),__vite__mapDeps([0,1]),import.meta.url).then(q=>q.c3);return{db:z}},A([0,1]),import.meta.url),k=((o=c==null?void 0:c.currentUser)==null?void 0:o.uid)||"admin-user-id";await S(y(C,"users",s.id),{branchPackage:{requested:!0,status:"canceled",canceledAt:new Date,canceledBy:k},updatedAt:new Date}),alert("تم إلغاء باقة الفروع لهذا الحساب")}catch(y){console.error("فشل في إلغاء باقة الفروع:",y),alert("حدث خطأ أثناء الإلغاء، حاول مرة أخرى")}},className:"p-1 rounded-md text-red-600 hover:bg-red-50",children:e.jsx(ur,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:i!=="active"&&e.jsx("button",{onClick:async()=>{var o;try{const{doc:y,updateDoc:S,setDoc:C}=await I(async()=>{const{doc:q,updateDoc:W,setDoc:ya}=await L(()=>import("./index-BsVRzvOf.js").then(fs=>fs.c3),__vite__mapDeps([0,1]),import.meta.url).then(fs=>fs.c2);return{doc:q,updateDoc:W,setDoc:ya}},A([0,1]),import.meta.url),{db:k}=await I(async()=>{const{db:q}=await L(()=>import("./index-BsVRzvOf.js").then(W=>W.c3),__vite__mapDeps([0,1]),import.meta.url).then(W=>W.c3);return{db:q}},A([0,1]),import.meta.url),z=((o=c==null?void 0:c.currentUser)==null?void 0:o.uid)||"admin-user-id";await S(y(k,"users",s.id),{branchPackage:{requested:!0,status:"active",activatedAt:new Date,activatedBy:z},isActive:!0,approved:!0,role:"merchant",updatedAt:new Date}),await C(y(k,"profiles",s.id),{role:"merchant",approved:!0,updatedAt:new Date},{merge:!0}),alert("تم تفعيل باقة الفروع لهذا الحساب")}catch(y){console.error("فشل في تفعيل باقة الفروع:",y),alert("حدث خطأ أثناء التفعيل، حاول مرة أخرى")}},className:"px-3 py-1 text-sm rounded-md bg-purple-600 text-white hover:bg-purple-700",children:"تفعيل باقة الفروع"})})]})]},s.id)})})})]})]}),x==="subscriptions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي الاشتراكات النشطة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>{var t;return(t=s.subscription)==null?void 0:t.isActive}).length})]}),e.jsx(Es,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"تنتهي خلال 7 أيام"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:m.filter(s=>{var t,a;if(!((t=s.subscription)!=null&&t.endDate)||!((a=s.subscription)!=null&&a.isActive))return!1;const r=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),i=new Date,o=r.getTime()-i.getTime(),y=Math.ceil(o/(1e3*60*60*24));return y<=7&&y>0}).length})]}),e.jsx(Ze,{className:"w-8 h-8 text-orange-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"منتهية الصلاحية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.filter(s=>{var t;return(t=s.subscription)!=null&&t.endDate?(s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate))<new Date:!1}).length})]}),e.jsx(re,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"اشتراكات مدى الحياة"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:m.filter(s=>{var t;return((t=s.subscription)==null?void 0:t.planType)===g.LIFETIME}).length})]}),e.jsx(ze,{className:"w-8 h-8 text-yellow-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"جدول مواعيد الاشتراكات"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"عرض جميع الاشتراكات مع تواريخ البداية والانتهاء"})]}),e.jsx("div",{className:"overflow-x-auto",children:B?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"نوع الاشتراك"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ البداية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الأيام المتبقية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"إجراء"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.filter(s=>{var t;return(t=s.subscription)==null?void 0:t.planType}).sort((s,t)=>{var a,r;if(!((a=s.subscription)!=null&&a.endDate)||!((r=t.subscription)!=null&&r.endDate))return 0;const i=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),o=t.subscription.endDate.toDate?t.subscription.endDate.toDate():new Date(t.subscription.endDate);return i.getTime()-o.getTime()}).map(s=>{const t=s.subscription;if(!t)return null;const a=t.startDate?t.startDate.toDate?t.startDate.toDate():new Date(t.startDate):null,r=t.endDate?t.endDate.toDate?t.endDate.toDate():new Date(t.endDate):null;let i=null,o="غير محدد";const y=(t==null?void 0:t.isActive)===!1||(s==null?void 0:s.isActive)===!1;if(y)o="ملغي";else if(t.planType===g.LIFETIME)o="مدى الحياة";else if(r){const S=new Date,C=r.getTime()-S.getTime();i=Math.ceil(C/(1e3*60*60*24)),i<0?o="منتهي":i<=7?o="ينتهي قريباً":o="نشط"}return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-medium text-sm",children:Me(s)})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:be(s)}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[t.planType===g.LIFETIME&&e.jsx(ze,{className:"w-4 h-4 text-yellow-500 ml-2"}),t.planType===g.YEARLY&&e.jsx(ye,{className:"w-4 h-4 text-blue-500 ml-2"}),t.planType===g.QUARTERLY&&e.jsx(se,{className:"w-4 h-4 text-purple-500 ml-2"}),t.planType===g.MONTHLY&&e.jsx(Ts,{className:"w-4 h-4 text-green-500 ml-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Da(t.planType)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:a?a.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.planType===g.LIFETIME?"مدى الحياة":r?r.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${o==="نشط"?"bg-green-100 text-green-800":o==="ينتهي قريباً"?"bg-orange-100 text-orange-800":o==="منتهي"||o==="ملغي"?"bg-red-100 text-red-800":o==="مدى الحياة"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:o})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:y?"ملغي":t.planType===g.LIFETIME?"∞":i!==null?i<0?"منتهي":`${i} يوم`:"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:async()=>{if(window.confirm("هل تريد إلغاء اشتراك المستخدم وحسابه؟"))try{await jt(s.id),alert("تم إلغاء اشتراك المستخدم وحسابه")}catch(S){console.error("فشل في إلغاء الاشتراك:",S),alert("حدث خطأ أثناء الإلغاء")}},className:"px-3 py-1 text-sm rounded-md bg-red-600 text-white hover:bg-red-700",children:"الغاء"})})]},s.id)}).filter(Boolean)})]})})]})]}),x==="content"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة محتوى خطط الاشتراك"}),le&&le.lastUpdated&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["آخر تحديث: ",new Date(le.lastUpdated).toLocaleString("ar-SA"),le.updatedBy&&` بواسطة: ${le.updatedBy}`]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>{As(!0),ee({name:"الباقة الربع سنوية",price:"250 جنيه",period:"كل 3 أشهر",description:"حل وسط بين الشهرية والسنوية",features:["إدارة محافظ متعددة","تقارير ربع سنوية"]}),_s("quarterly"),ue(!0)},className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:[e.jsx(yt,{className:"w-4 h-4"}),"إضافة باقة جديدة"]}),e.jsxs("button",{onClick:ca,disabled:F,className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(de,{className:"w-4 h-4"}),F?"جاري الحفظ...":"حفظ جميع التغييرات"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:Object.entries(J).map(([s,t])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[s==="monthly"&&e.jsx(Ts,{className:"w-4 h-4 text-green-500"}),s==="quarterly"&&e.jsx(se,{className:"w-4 h-4 text-purple-500"}),s==="yearly"&&e.jsx(ye,{className:"w-4 h-4 text-blue-500"}),s==="lifetime"&&e.jsx(ze,{className:"w-4 h-4 text-yellow-500"}),t.name]}),e.jsx("button",{onClick:()=>{P(D===s?null:s),As(!1),_s(s),ee({...t,features:[...t.features||[]]}),ue(!0)},className:"text-purple-600 hover:text-purple-800",children:e.jsx(sr,{className:"w-4 h-4"})})]}),D===s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:t.name,onChange:a=>Pe(s,"name",a.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:t.price,onChange:a=>Pe(s,"price",a.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:t.period,onChange:a=>Pe(s,"period",a.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{value:t.description,onChange:a=>Pe(s,"description",a.target.value),rows:3,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>da(s),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:t.features.map((a,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:a,onChange:i=>oa(s,r,i.target.value),className:"flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"}),e.jsx("button",{onClick:()=>ma(s,r),className:"text-red-500 hover:text-red-700",children:e.jsx(ve,{className:"w-4 h-4"})})]},r))})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:t.price}),e.jsx("div",{className:"text-sm text-gray-600",children:t.period}),e.jsx("div",{className:"text-sm text-gray-700",children:t.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"المميزات:"}),t.features.map((a,r)=>e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(Es,{className:"w-3 h-3 text-green-500"}),a]},r))]})]})]},s))})]}),Xe&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold",children:Vt?"إضافة باقة جديدة":`تعديل ${te==="monthly"?"الباقة الشهرية":te==="yearly"?"الباقة السنوية":te==="lifetime"?"باقة مدى الحياة":"باقة ربع سنوية"}`}),e.jsx("button",{onClick:()=>ue(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:ae.name,onChange:s=>ee(t=>({...t,name:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:ae.price,onChange:s=>ee(t=>({...t,price:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:ae.period,onChange:s=>ee(t=>({...t,period:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{rows:3,value:ae.description,onChange:s=>ee(t=>({...t,description:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>ee(s=>({...s,features:[...s.features||[],""]})),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:(ae.features||[]).map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:a=>{const r=a.target.value;ee(i=>{const o=[...i.features||[]];return o[t]=r,{...i,features:o}})},className:"flex-1 p-2 border rounded-md text-sm"}),e.jsx("button",{onClick:()=>{ee(a=>{const r=[...a.features||[]];return r.splice(t,1),{...a,features:r}})},className:"text-red-500 hover:text-red-700",children:e.jsx(ve,{className:"w-4 h-4"})})]},t))})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>ue(!1),className:"px-4 py-2 rounded-md bg-gray-100 hover:bg-gray-200",children:"إلغاء"}),e.jsx("button",{onClick:()=>{te&&(O(s=>({...s,[te]:{...ae}})),ue(!1))},className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700",children:"حفظ داخل الصفحة"}),e.jsx("button",{onClick:async()=>{var s;if(te)try{const t=((s=c==null?void 0:c.currentUser)==null?void 0:s.uid)||"admin";await Ha(te,ae,t),O(a=>({...a,[te]:{...ae}})),ue(!1)}catch(t){console.error("Immediate save failed",t),alert("حدث خطأ أثناء الحفظ الفوري. حاول لاحقًا أو استخدم حفظ جميع التغييرات.")}},className:"px-4 py-2 rounded-md bg-purple-600 text-white hover:bg-purple-700",children:"حفظ فوري"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إرسال إشعار للمستخدمين"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"سيظهر الإشعار كمودال صغير في منتصف الشاشة مع ضباب خفيف."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"عنوان الإشعار"}),e.jsx("input",{type:"text",value:hs,onChange:s=>lt(s.target.value),placeholder:"أدخل عنوانًا قصيرًا وجذابًا",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"نص الإشعار"}),e.jsx("textarea",{value:ps,onChange:s=>it(s.target.value),placeholder:"اكتب محتوى الإشعار الذي سيظهر للمستخدمين",rows:4,className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رابط اختياري"}),e.jsx("input",{type:"text",value:nt,onChange:s=>ct(s.target.value),placeholder:"مثال: /user/dashboard أو https://example.com",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"إذا كان الرابط خارجيًا سيفتح في نافذة جديدة، وإذا كان داخليًا سيتم التوجيه داخل الموقع."})]}),e.jsx("div",{className:"flex items-center justify-end gap-3",children:e.jsx("button",{onClick:aa,disabled:ot,className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:ot?"جاري الإرسال...":"إرسال إشعار"})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Dt,{className:"w-5 h-5 text-slate-600"})," إعدادات النظام — Telegram/Cloudflare Worker"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"أدخل رابط الـ Worker المركزي. التوكن يبقى سر داخل Cloudflare Secrets."})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط Cloudflare Worker"}),e.jsx("input",{type:"url",value:Ks,onChange:s=>Xs(s.target.value),placeholder:"https://summer-cake-5149.alkaptin2030.workers.dev",className:"w-full p-2 border border-gray-300 rounded-md"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:'تأكد أن المسار يدعم POST عند "/notify" أو الجذر حسب إعدادك.'})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:async()=>{try{et(!0);const{systemSettingsService:s}=await I(async()=>{const{systemSettingsService:a}=await L(()=>import("./index-BsVRzvOf.js").then(r=>r.c3),__vite__mapDeps([0,1]),import.meta.url).then(r=>r.c4);return{systemSettingsService:a}},A([0,1]),import.meta.url),t=(Ks||"").trim();if(!t){alert("أدخل رابط صحيح");return}await s.setTelegramWorkerUrl(t),alert("تم حفظ رابط Cloudflare Worker بنجاح")}catch(s){console.error("Failed to save worker url",s),alert(s!=null&&s.message?`فشل حفظ الرابط: ${s.message}`:"فشل حفظ الرابط")}finally{et(!1)}},className:"flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded-lg hover:bg-slate-700 disabled:opacity-50",disabled:Js,children:[e.jsx(de,{className:"w-4 h-4"})," ",Js?"جاري الحفظ...":"حفظ الرابط"]})})]})]})]})]})]}),x==="branding"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"إعدادات الشعار"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"صورة الشعار الحالية"}),e.jsxs("div",{className:"flex items-center gap-4",children:[Cs?e.jsx("img",{src:Cs,alt:"Brand Logo",className:"h-16 w-16 object-contain rounded-lg border"}):e.jsx("div",{className:"h-16 w-16 rounded-lg border flex items-center justify-center text-gray-400",children:"لا يوجد شعار"}),e.jsx("button",{onClick:()=>{Ie(""),Le("")},className:"px-3 py-2 text-sm rounded-lg bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600",children:"مسح الشعار"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"رفع شعار جديد"}),e.jsx("input",{type:"file",accept:"image/*",onChange:s=>{var t;return qt(((t=s.target.files)==null?void 0:t[0])||null)},className:"block w-full text-sm"}),e.jsxs("button",{disabled:Is||!ss,onClick:async()=>{if(ss){Ls(!0);try{const s=await Wa(ss);Ie(s),Le("")}catch(s){console.error("Upload logo error",s)}finally{Ls(!1)}}},className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:opacity-90 disabled:opacity-50",children:[e.jsx(Be,{className:"w-4 h-4"}),Is?"جاري الرفع...":"رفع الشعار"]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"رابط صورة خارجي"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",placeholder:"https://example.com/logo.png",value:es,onChange:s=>Le(s.target.value),className:"w-full rounded-lg border px-3 py-2 bg-transparent"}),e.jsxs("button",{onClick:async()=>{try{await Ga({logoUrl:es.trim()}),Ie(es.trim())}catch(s){console.error("Save external logo url error",s)}},className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:opacity-90",children:[e.jsx(de,{className:"w-4 h-4"}),"حفظ الرابط"]})]})]})]}),x==="trials"&&e.jsxs("div",{className:"space-y-6",children:[console.log("🔍 Trials tab rendering - users data:",m),console.log("🔍 Users count:",(m==null?void 0:m.length)||0),console.log("🔍 Users on trial:",((De=m==null?void 0:m.filter(s=>s.isOnFreeTrial))==null?void 0:De.length)||0),B&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري تحميل بيانات المستخدمين..."})]})}),j&&!B&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Ze,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"خطأ في تحميل البيانات"}),e.jsx("p",{className:"text-red-600 mb-4",children:j}),e.jsx("p",{className:"text-sm text-red-500",children:"تأكد من اتصال الإنترنت وإعدادات Firebase"})]}),!B&&!j&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين في التجربة"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:m.filter(s=>s.isOnFreeTrial).length})]}),e.jsx(ye,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"التجارب المنتهية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).length})]}),e.jsx(re,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المؤهلين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length})]}),e.jsx(Ct,{className:"w-8 h-8 text-green-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إعداد مدة التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"يتم تطبيق التغيير فورياً على أي تفعيل جديد."})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"المدة بالساعات"}),e.jsx("input",{type:"number",min:1,max:336,value:ht,onChange:s=>pt(s.target.value),className:"w-full px-4 py-2 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm",placeholder:"اكتب عدد الساعات"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["المدة الحالية: ",H," ",H>=3&&H<=10?"ساعات":H===2?"ساعتين":"ساعة"]})]}),e.jsx("div",{className:"flex items-center md:justify-end",children:e.jsx("button",{onClick:ha,disabled:gt,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium disabled:opacity-50",children:gt?"جاري التحديث...":"تحديث المدة"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين المؤهلين للتجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين لم يستخدموا التجربة المجانية من قبل"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Oe,onChange:s=>xt(s.target.value),placeholder:"ابحث بالاسم أو البريد في المؤهلين للتجربة",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx($e,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[m.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).filter(s=>{const t=Oe.trim().toLowerCase();if(!t)return!0;const a=be(s).toLowerCase(),r=(s.email||"").toLowerCase();return a.includes(t)||r.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:Me(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:be(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ التسجيل: ",bs(s.createdAt)]})]})]}),e.jsx("div",{className:"flex items-center space-x-3 space-x-reverse",children:e.jsx("button",{onClick:()=>pa(s.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:`تفعيل التجربة ${H} ${H>=3&&H<=10?"ساعات":H===2?"ساعتين":"ساعة"}`})})]},s.id)),m.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ye,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد مستخدمين مؤهلين للتجربة المجانية حالياً"})]})]})})]}),m.filter(s=>s.isOnFreeTrial).length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين في التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين يستخدمون التجربة المجانية حالياً"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:Oe,onChange:s=>xt(s.target.value),placeholder:"ابحث بالاسم أو البريد في التجارب المجانية",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx($e,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:m.filter(s=>s.isOnFreeTrial).filter(s=>{const t=Oe.trim().toLowerCase();if(!t)return!0;const a=be(s).toLowerCase(),r=(s.email||"").toLowerCase();return a.includes(t)||r.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:Me(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:be(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-blue-600",children:["تنتهي في: ",s.freeTrialEndDate?bs(s.freeTrialEndDate):"غير محدد"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:"نشط"}),e.jsx("button",{onClick:()=>ba(s.id),className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-xs",children:"ضبط نهاية التجربة"}),e.jsx("button",{onClick:()=>ga(s.id),className:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 text-xs",children:"إلغاء التجربة"})]})]},s.id))})})]})]})]}),x==="whatsapp"&&e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Ge,{className:"w-6 h-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة الواتساب"})]}),e.jsx(vr,{})]}),x==="analytics"&&e.jsxs("div",{className:"bg-white rounded-lg p-8 shadow-sm border border-gray-200 text-center",children:[e.jsx(Tt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"الإحصائيات"}),e.jsx("p",{className:"text-gray-500",children:"سيتم إضافة الإحصائيات قريباً"})]})]})]}),e.jsx(Cr,{isOpen:Pt,onClose:()=>U(!1)}),e.jsx(Ir,{notification:$t,onClose:ua,soundEnabled:Mt.soundAlerts,onToggleSound:xa})]})},Dl=()=>{const n=va(),{user:c,loading:b}=Na(),[u,j]=l.useState(!1),[v,d]=l.useState(null),[T,x]=l.useState(!1),[w,U]=l.useState("users"),[Z,_]=l.useState(0),[f,h]=l.useState([]),[m,Q]=l.useState([]),[$,p]=l.useState(!1),[B,xe]=l.useState(null),[R,F]=l.useState([]),[V,le]=l.useState({});l.useEffect(()=>{const N=localStorage.getItem("admin_dev_mode")==="true";j(N)},[]),l.useEffect(()=>{if(!u&&!c)return;x(!0),d(null);const N=Ne(oe(Y,"users")),D=We(N,P=>{const J=P.docs.map(O=>({id:O.id,...O.data()}));F(J),x(!1),d(null)},P=>{console.error("Error loading users:",P),u?(F([]),x(!1),d(null)):(d("فشل في تحميل بيانات المستخدمين"),x(!1))});return()=>D()},[c,u]),l.useEffect(()=>{if(!u&&!c)return;const N=Ne(oe(Y,"profiles")),D=We(N,P=>{const J={};P.forEach(O=>{J[O.id]=O.data()}),le(J)},P=>{console.error("Error loading profiles:",P)});return()=>D()},[c,u]),l.useEffect(()=>{const N=R.map(D=>{const P=V[D.id]||{},J=typeof P.fullName=="string"?P.fullName:void 0,O=typeof P.phone=="string"?P.phone:void 0,Xe=typeof D.displayName=="string"&&D.displayName.trim()?D.displayName:J||D.displayName||void 0;return{...D,displayName:Xe,phone:D.phone??O??null}});h(N),Q(N)},[R,V]);const _e=N=>{console.log("Notification center:",N)},Ae=N=>{console.log("Notification settings:",N)},De=N=>{console.log("Notifications:",N)},K=N=>{console.log("Editing plan:",N)};l.useEffect(()=>{c&&(async()=>{try{const N=await Et();xe(N)}catch(N){console.warn("Failed to load last update info:",N),xe(null)}})()},[c]);const we=async()=>{try{return await Ya()}catch(N){return console.error("Error loading content:",N),{}}},M=async N=>{try{p(!0),await qa(N,(c==null?void 0:c.uid)||"admin");const D=await Et();return xe(D),!0}catch(D){return console.error("Error saving content:",D),!1}finally{p(!1)}};return b?e.jsx(wa,{}):e.jsx(Rr,{navigate:n,auth:ka,devMode:u,setDevMode:j,error:v,setError:d,authLoading:b,setAuthLoading:()=>{},activeTab:w,setActiveTab:U,setNotificationCenterOpen:_e,setNotificationSettings:Ae,setNotifications:De,notificationCount:Z,setNotificationCount:_,users:f,setUsers:h,filteredUsers:m,setFilteredUsers:Q,loading:T,setLoading:x,setEditingPlan:K,isSavingContent:$,setIsSavingContent:p,lastUpdateInfo:B,loadContentFromFirebase:we,saveContentToFirebase:M})};export{Dl as default};
//# sourceMappingURL=ProtectedAdminDashboard-B6elE5YX-BqMxCV8t.js.map
