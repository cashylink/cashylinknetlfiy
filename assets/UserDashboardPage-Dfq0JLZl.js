const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-bCWIXU_s.js","./index-D5_0Es3j.css","./WalletManagement-SWSqiXRe.js","./badge-D2_MGYyu.js","./select-C3fHD4AR.js","./MasterPinDialog-A5-_nbFS.js","./circle-alert-BxhCUO6U.js","./wallet-BSujvrVP.js","./star-ByCqd1zs.js","./square-pen-C3YmbHnp.js","./trash-2-BWgB-yFB.js","./phone-CgMYIHl6.js","./arrow-left-s_QvAc0w.js","./progress-x9HwvYAT.js","./separator-DNaXqfAL.js","./calendar-xPArWQ6D.js","./chart-column-BFjwul5o.js","./trending-down-aBL_5Ila.js","./dollar-sign-Bao60D_X.js","./activity-ykVa_qpc.js","./circle-x-Cbud-81g.js","./circle-check-big-DiwZPFwf.js","./TransactionDetailsModal-Brl8NR8E.js","./formatters-Czs80nJy.js","./printer-BDVabvNO.js","./ReceiptModal-Cv6QcDz4.js","./whatsappService-Qba8l8zM.js","./html2canvas.esm-BfYXEYrK.js","./download-BfniqE5C.js","./EditBalanceDialog-Cu1xoA8h.js","./ChangePinDialog-B57xZYPQ.js","./ChangeCashPinDialog-CjWfATmi.js","./ChangeWalletTotalPinDialog-ChJSXZyz.js","./AddToWalletDialog-Bh8D9jRb.js","./CalculatorDialog-BW1MBUvd.js","./SalesDataDialog-BSBXlo0a.js","./table-jNeCcDzH.js","./tabs-DUowV67c.js","./index-BPkmrWHC.js","./refresh-cw-B5gRT73I.js","./search-BPzTPEA8.js","./package-DqMHyEHk.js","./CashSummaryDialog-7i3tqesS.js","./CreditCardsDialog-9OklCdBm.js","./pen-line-BxC7Ywxy.js","./InstallmentModal-CAmVQMeQ.js","./MaintenanceDialog-CgVez11i.js","./profitService-RoVQsoFR.js","./MachineDailyDialog-CMRrSK5A.js","./ProfileSettingsPage-CoIa9boy.js","./switch-BQgZRSUu.js","./textarea-D3m_oYND.js","./users-Cpto-nm8.js","./crown-A4Ihvi0Y.js","./ProfileIcon--gxl92Z4.js","./dropdown-menu-h4nY-sSB.js","./freeTrialService-CWJcN19o.js","./broadcastService-Brab-pCG.js","./bell-CJI7aseZ.js","./arrow-down-left-vpQKucY4.js","./WalletsManagement-CTvhIuFw.js","./WalletPrinterDialog-gKIzZGi9.js","./WalletsListDialog-DfCwfkfk.js","./CashierShiftModal-hEg5Xax2.js","./functions-5D5Jrxio.js","./ShiftProfileDialog-BrAb_Xzt.js","./ChangeLogDialog-CkcgGZ-J.js","./sparkles-DOxWWbiK.js","./dailyOperationCountService-Drxu6Okj.js"])))=>i.map(i=>d[i]);
import{X as Ys,aN as Qn,K as ge,o as W,W as At,z as et,m as ns,c5 as wa,Y as kt,q as ve,n as ne,as as Q,t as fe,u as _i,a1 as ec,r as c,j as e,bw as Wm,B as w,aD as Hn,R as $,a2 as st,F as os,a5 as oe,a6 as le,a7 as ce,a8 as de,b8 as Ol,aO as Ct,aP as tc,i as ac,D as Ll,v as q,I as U,E as Wl,aQ as ja,a as Rm,c6 as Mm,ay as Bm,a4 as Um,c4 as Fm,aC as $m,k as Vm,at as ba,a3 as K,aA as F,J as zm,c7 as $s,O as qm,au as Rl,c8 as Vs,aI as Km,C as zt,b as va,c as Na,aF as zs,e as qt,ap as Xe,ba as Jm,ao as Ml,U as qs,bb as Qm,ar as Bl,ai as ji,bB as Ul,ax as Kn,_ as Fl,aj as $l,az as be,S as Jn,M as Si,aS as at,aw as Za,bC as Ym,bD as Hm,bE as Gm,bF as Zm,bG as Xm,y as Di,Q as eu,bH as Vl,ah as It,c9 as tu,p as au,s as su,b9 as Ks,bs as nu,ca as zl,bQ as ru,cb as iu}from"./index-bCWIXU_s.js";import{C as ou,P as lu,a as cu,w as du}from"./ProfileSettingsPage-CoIa9boy.js";import{B as ia}from"./badge-D2_MGYyu.js";import{C as mu,f as uu,S as Xa,a as es,b as ts,c as as,d as Kt}from"./select-C3fHD4AR.js";import{S as hu}from"./switch-BQgZRSUu.js";import{P as pu}from"./ProfileIcon--gxl92Z4.js";import{E as fu,a as gu}from"./broadcastService-Brab-pCG.js";import{D as xu,a as yu,b as wu,c as bu,d as vu}from"./dropdown-menu-h4nY-sSB.js";import{B as Ii}from"./bell-CJI7aseZ.js";import{C as Yn}from"./circle-check-big-DiwZPFwf.js";import{ProfitService as la}from"./profitService-RoVQsoFR.js";import{a as Nu,M as xt}from"./MasterPinDialog-A5-_nbFS.js";import{C as ju}from"./calendar-xPArWQ6D.js";import{A as rs}from"./arrow-down-left-vpQKucY4.js";import{A as sc,u as Js,f as Nt,C as Su,a as Ci,b as ql}from"./formatters-Czs80nJy.js";import{D as Jt}from"./dollar-sign-Bao60D_X.js";import{C as Du}from"./circle-alert-BxhCUO6U.js";import{FreeTrialService as Kl}from"./freeTrialService-CWJcN19o.js";import{T as Wt}from"./trash-2-BWgB-yFB.js";import{W as ss}from"./wallet-BSujvrVP.js";import{S as Iu}from"./search-BPzTPEA8.js";import{C as Cu}from"./crown-A4Ihvi0Y.js";import{R as Ai}from"./refresh-cw-B5gRT73I.js";import{a as Jl}from"./square-pen-C3YmbHnp.js";import{P as Au}from"./printer-BDVabvNO.js";import{P as Ti}from"./phone-CgMYIHl6.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tu=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],Ql=Ys("banknote",Tu);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _u=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],Yl=Ys("calendar-days",_u);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eu=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],ku=Ys("circle-plus",Eu);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pu=[["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["path",{d:"M16 2v20",key:"rotuqe"}]],Hl=Ys("notebook",Pu);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ou=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Lu=Ys("send",Ou),Gl={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_VERSION:"0.0.0",VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"false",VITE_FIREBASE_API_KEY:["AI","za","SyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s"].join(""),VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_AUTH_EMULATOR_URL:"http://localhost:9099",VITE_FIREBASE_FIRESTORE_EMULATOR_HOST:"localhost:8080",VITE_FIREBASE_FUNCTIONS_EMULATOR_HOST:"localhost:5001",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.appspot.com",VITE_FORCE_HASH_ROUTER:"true",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"Ù…Ø­Ù„ ÙƒØ§Ø´ÙŠ Ù„ÙŠÙ†Ùƒ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ",VITE_SHOW_ENV_BANNER:"true",VITE_USE_EMULATORS:"false",VITE_USE_FIREBASE_EMULATOR:"false"},oa=b=>typeof b=="string"&&b.trim().length>0,Wu={getCurrentMonthId(){const b=new Date;return`${b.getFullYear()}-${String(b.getMonth()+1).padStart(2,"0")}`},async getWalletUsage(b){var a;try{if(!oa(b))return console.error("Error getting wallet usage: invalid walletId",b),null;const h=ge(W,"walletLimits",b),I=await kt(h);if(I.exists()){const T=I.data();return{walletId:b,used_transfer:T.monthlyTransferUsed??T.used_transfer??0,used_withdraw:T.monthlyWithdrawUsed??T.used_withdraw??0,monthly_limit:T.monthlyLimit??T.monthlyTransferLimit??T.monthlyWithdrawLimit??2e5,last_reset:T.lastMonthlyReset??T.last_reset??null,updatedAt:T.updatedAt||wa.now()}}const j={walletId:b,used_transfer:0,used_withdraw:0,monthly_limit:2e5,last_reset:null,updatedAt:wa.now()};return await At(h,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,monthlyTransferLimit:2e5,monthlyWithdrawLimit:2e5,lastMonthlyReset:null,updatedAt:et(),ownerId:(a=ns.currentUser)==null?void 0:a.uid}),j}catch(h){return console.error("Error getting wallet usage:",h),{walletId:b,used_transfer:0,used_withdraw:0,monthly_limit:2e5,last_reset:null,updatedAt:wa.now()}}},shouldResetLimits(b){const a=new Date,h=a.getDate();if(!b)return h===1;if(h===1){const I=b.toDate(),j=a.getMonth(),T=a.getFullYear();return I.getMonth()!==j||I.getFullYear()!==T}return!1},async autoResetLimitsIfNeeded(b){try{if(!oa(b))return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµÙÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø­Ø¯ÙˆØ¯: walletId ØºÙŠØ± ØµØ§Ù„Ø­",b),!1;typeof import.meta<"u";const a=await this.getWalletUsage(b);return a&&this.shouldResetLimits(a.last_reset)?(console.log(`ğŸ”„ ØªØµÙÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø­Ø¯ÙˆØ¯ Ù„Ù„Ù…Ø­ÙØ¸Ø© ${b} - Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„ Ù…Ù† Ø§Ù„Ø´Ù‡Ø±`),await this.resetWalletUsage(b)):!1}catch(a){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµÙÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø­Ø¯ÙˆØ¯:",a),!1}},async resetWalletUsage(b){try{if(!oa(b))return console.error("Ø®Ø·Ø£ ÙÙŠ ØªØµÙÙŠØ± Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©: walletId ØºÙŠØ± ØµØ§Ù„Ø­",b),!1;const a=ge(W,"walletLimits",b);return await At(a,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:et(),updatedAt:et()},{merge:!0}),console.log(`ğŸ”„ ØªÙ… ØªØµÙÙŠØ± Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© ${b} Ø¨Ù†Ø¬Ø§Ø­`),!0}catch(a){return console.error("Ø®Ø·Ø£ ÙÙŠ ØªØµÙÙŠØ± Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©:",a),!1}},async calculateUsageFromTransactions(b){var a,h;try{if(!oa(b))return console.error("Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª: walletId ØºÙŠØ± ØµØ§Ù„Ø­",b),{used_transfer:0,used_withdraw:0};const I=ge(W,"walletLimits",b),j=new Date;let T=wa.fromDate(new Date(j.getFullYear(),j.getMonth(),1));try{const B=await kt(I);T=B.exists()?((a=B.data())==null?void 0:a.lastMonthlyReset)??((h=B.data())==null?void 0:h.last_reset)??T:T}catch{}const M=ve(ne(W,"tx"),Q("uid","==",b),...T?[Q("createdAt",">=",T)]:[]),J=await fe(M);let A=0,_=0;return J.forEach(B=>{const me=B.data();me.status==="completed"&&(me.type==="transfer"?A+=me.amount:me.type==="withdraw"&&(_+=me.amount))}),{used_transfer:A,used_withdraw:_}}catch(I){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª:",I),{used_transfer:0,used_withdraw:0}}},async getWalletUsageWithRefresh(b){var a,h;try{if(!oa(b))return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«: walletId ØºÙŠØ± ØµØ§Ù„Ø­",b),null;typeof import.meta<"u";const I=await this.getWalletUsage(b);if(!I){const T=await this.calculateUsageFromTransactions(b),M=ge(W,"walletLimits",b);try{await At(M,{monthlyTransferUsed:T.used_transfer,monthlyWithdrawUsed:T.used_withdraw,updatedAt:et(),ownerId:(a=ns.currentUser)==null?void 0:a.uid},{merge:!0})}catch{}return{walletId:b,used_transfer:T.used_transfer,used_withdraw:T.used_withdraw,monthly_limit:2e5,last_reset:null,updatedAt:wa.now()}}const j=await this.calculateUsageFromTransactions(b);if(I.used_transfer!==j.used_transfer||I.used_withdraw!==j.used_withdraw){const T=ge(W,"walletLimits",b);try{await At(T,{monthlyTransferUsed:j.used_transfer,monthlyWithdrawUsed:j.used_withdraw,updatedAt:et(),ownerId:(h=ns.currentUser)==null?void 0:h.uid},{merge:!0})}catch{}return await this.getWalletUsage(b)}return I}catch(I){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«:",I),{walletId:b,used_transfer:0,used_withdraw:0,monthly_limit:2e5,last_reset:null,updatedAt:wa.now()}}},calculateRemaining(b){return{remainingTransfer:Math.max(0,b.monthly_limit-b.used_transfer),remainingWithdraw:Math.max(0,b.monthly_limit-b.used_withdraw)}},async canPerformOperation(b,a,h){try{if(!oa(b))return console.error("Error checking operation limits: invalid walletId",b),{canPerform:!1,message:"walletId ØºÙŠØ± ØµØ§Ù„Ø­"};const I=await this.getWalletUsageWithRefresh(b);if(!I)return{canPerform:!1,message:"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ù„Ù…Ø­ÙØ¸Ø©"};const j=this.calculateRemaining(I);return h==="transfer"&&a>j.remainingTransfer?{canPerform:!1,message:`ØªØ¬Ø§ÙˆØ² Ø­Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø³Ù…ÙˆØ­. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${j.remainingTransfer.toLocaleString()} Ø¬.Ù… Ù…Ù† Ø£ØµÙ„ ${I.monthly_limit.toLocaleString()} Ø¬.Ù…`,remaining:j.remainingTransfer}:h==="withdraw"&&a>j.remainingWithdraw?{canPerform:!1,message:`ØªØ¬Ø§ÙˆØ² Ø­Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ø³Ù…ÙˆØ­. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${j.remainingWithdraw.toLocaleString()} Ø¬.Ù… Ù…Ù† Ø£ØµÙ„ ${I.monthly_limit.toLocaleString()} Ø¬.Ù…`,remaining:j.remainingWithdraw}:{canPerform:!0}}catch(I){return console.error("Error checking operation limits:",I),{canPerform:!1,message:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯"}}},async updateUsage(b,a,h){var I;try{if(!oa(b))throw new Error("walletId ØºÙŠØ± ØµØ§Ù„Ø­");const j=await this.getWalletUsageWithRefresh(b);if(!j)throw new Error("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ù„Ù…Ø­ÙØ¸Ø©");const T=await this.canPerformOperation(b,a,h);if(!T.canPerform)throw new Error(T.message||"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©");const M=h==="transfer"?j.used_transfer+a:j.used_transfer,J=h==="withdraw"?j.used_withdraw+a:j.used_withdraw,A=ge(W,"walletLimits",j.walletId);try{await At(A,{monthlyTransferUsed:M,monthlyWithdrawUsed:J,updatedAt:et(),ownerId:(I=ns.currentUser)==null?void 0:I.uid},{merge:!0})}catch{}let _=await this.getWalletUsageWithRefresh(b);return _||(_={walletId:b,used_transfer:M,used_withdraw:J,monthly_limit:j.monthly_limit,last_reset:j.last_reset,updatedAt:wa.now()}),_}catch(j){throw console.error("Error updating wallet usage:",j),j}},async resetWalletUsageManually(b){try{if(!oa(b))throw new Error("walletId ØºÙŠØ± ØµØ§Ù„Ø­");const a=ge(W,"walletLimits",b),h={walletId:b,used_transfer:0,used_withdraw:0,monthly_limit:0,last_reset:null,updatedAt:new Date};return At(a,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:et(),updatedAt:et()},{merge:!0}).catch(I=>{console.error("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ ØªØµÙÙŠØ± Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Firebase:",I)}),console.log(`âœ… ØªÙ… ØªØµÙÙŠØ± Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© ${b} Ø¨Ù†Ø¬Ø§Ø­`),h}catch(a){throw console.error("Error resetting wallet usage:",a),a}},async getAllWalletsUsage(b){try{const h=(await Qn.getByMerchantId(b)).map(j=>this.getWalletUsageWithRefresh(j.id));return(await Promise.all(h)).filter(j=>j!==null)}catch(a){return console.error("Error getting all wallets usage:",a),[]}}};function Ru(b){return b?`readBroadcastIds_${b}`:"readBroadcastIds_guest"}function Mu({className:b}){const{user:a,profile:h,isSubscriptionActive:I}=_i(),j=ec(),[T,M]=c.useState([]),[J,A]=c.useState(new Set),[_,B]=c.useState(!1),[me,ye]=c.useState(""),[f,Ue]=c.useState(!1),[dt,ae]=c.useState(null),[Le,_e]=c.useState("none"),[Ce,mt]=c.useState(null),[O,De]=c.useState(!1),ut=c.useRef(new Set);c.useRef(!1);const nt=c.useRef(!0),qe=c.useRef(null),Qt=c.useRef(null),jt=c.useRef(null),[Gn,Zn]=c.useState({position:"fixed",top:0,left:0,zIndex:1e4}),Hs=c.useMemo(()=>{const V=["global"];return a!=null&&a.uid&&V.push(`user:${a.uid}`),h!=null&&h.shopId&&V.push(`shop:${h.shopId}`),V},[a==null?void 0:a.uid,h==null?void 0:h.shopId]),Yt=Ru(a==null?void 0:a.uid),Rt=c.useMemo(()=>{var Z;const V=(Z=j==null?void 0:j.pathname)==null?void 0:Z.includes("/user/pending-approval");return!!(a!=null&&a.uid)&&!V},[a==null?void 0:a.uid,j==null?void 0:j.pathname]);c.useEffect(()=>{try{const V=localStorage.getItem(Yt);if(V){const X=JSON.parse(V);Array.isArray(X)&&A(new Set(X.filter(Boolean)))}else A(new Set)}catch(V){console.warn("Failed to load read ids",V),A(new Set)}},[Yt]),c.useEffect(()=>{if(!Rt){M([]);return}nt.current=!0;const V=()=>{gu(Hs,Z=>{if(nt.current){const Ee=Date.now(),We=60*1e3,Tt=Z.filter(ke=>{var Zt,Bt;const St=(Zt=ke.createdAt)!=null&&Zt.toMillis?ke.createdAt.toMillis():(Bt=ke.createdAt)!=null&&Bt.seconds?ke.createdAt.seconds*1e3:0;return!(Ee-St<We)}).map(ke=>ke.id).filter(Boolean);ut.current=new Set(Tt),nt.current=!1}M(Z)})};V();const X=Z=>{console.log("ğŸ”” OneSignal Notification received",Z);try{const Ee=Z.notification||Z;if(Ee&&(Ee.title||Ee.body)){const We={id:`temp_${Date.now()}`,title:Ee.title||"Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯",message:Ee.body||Ee.message||"",audienceKey:"global",active:!0,createdAt:{toMillis:()=>Date.now(),seconds:Math.floor(Date.now()/1e3),nanoseconds:0}};mt(We),De(!0),qe.current&&clearTimeout(qe.current),qe.current=window.setTimeout(()=>{De(!1),mt(null)},5e3)}}catch(Ee){console.error("Error parsing OneSignal event for instant alert",Ee)}V()};try{const Z=window.OneSignal;Z&&Z.Notifications&&Z.Notifications.addEventListener&&Z.Notifications.addEventListener("foregroundWillDisplay",X)}catch(Z){console.error("Failed to add OneSignal listener",Z)}return()=>{try{const Z=window.OneSignal;Z&&Z.Notifications&&Z.Notifications.removeEventListener&&Z.Notifications.removeEventListener("foregroundWillDisplay",X)}catch{}}},[Hs,Rt]),c.useEffect(()=>{const V=new Set(T.map(Z=>Z.id).filter(Boolean)),X=T.filter(Z=>Z.id&&!ut.current.has(Z.id));X.length>0&&(mt(X[0]),De(!0),qe.current&&clearTimeout(qe.current),qe.current=window.setTimeout(()=>{De(!1),mt(null)},5e3)),ut.current=V},[T]),c.useEffect(()=>()=>{qe.current&&clearTimeout(qe.current)},[]);const Mt=T.reduce((V,X)=>V+(X.id&&!J.has(X.id)?1:0),0),Gs=V=>{if(!V||J.has(V))return;const X=new Set(J);X.add(V),A(X);try{localStorage.setItem(Yt,JSON.stringify(Array.from(X)))}catch{}},Ht=()=>{const V=T.map(Z=>Z.id).filter(Boolean),X=new Set(J);V.forEach(Z=>X.add(Z)),A(X);try{localStorage.setItem(Yt,JSON.stringify(Array.from(X)))}catch{}},Gt=(V,X)=>{var Z;if(V)try{const Ee=((Z=Hn)==null?void 0:Z.isNativePlatform)&&Hn.getPlatform()==="android",We=/\.apk(\?|$)/i.test(V);if(Ee&&We){const Tt=`cashy://update?url=${encodeURIComponent(V)}`;window.location.href=Tt}else window.open(V,"_blank")}catch{try{window.open(V,"_blank")}catch{}}X&&Gs(X)},Sa=()=>{if(!Qt.current||!jt.current)return;const V=Qt.current.getBoundingClientRect(),X=8,Z=jt.current.offsetWidth||320,Ee=V.bottom+X;let We=V.right-Z;const Tt=window.innerWidth;We=Math.min(Math.max(We,X),Tt-Z-X),Zn(ke=>({...ke,top:Ee,left:We}))};return c.useEffect(()=>{if(!O)return;Sa();const V=()=>Sa();return window.addEventListener("resize",V),window.addEventListener("scroll",V,!0),()=>{window.removeEventListener("resize",V),window.removeEventListener("scroll",V,!0)}},[O]),c.useEffect(()=>{if(!(a!=null&&a.uid)){_e("none");return}(async()=>{try{const X=ve(ne(W,"waiting_list"),Q("userId","==",a.uid)),Ee=(await fe(X)).docs.map(ke=>({id:ke.id,...ke.data()})).sort((ke,St)=>{var Bt,Ia,Zs,ls,cs,ds;const Da=((Ia=(Bt=ke==null?void 0:ke.createdAt)==null?void 0:Bt.toMillis)==null?void 0:Ia.call(Bt))??((Zs=ke==null?void 0:ke.createdAt)==null?void 0:Zs.seconds)*1e3??0;return(((cs=(ls=St==null?void 0:St.createdAt)==null?void 0:ls.toMillis)==null?void 0:cs.call(ls))??((ds=St==null?void 0:St.createdAt)==null?void 0:ds.seconds)*1e3??0)-Da});if(Ee.length===0){_e("none");return}const We=Ee[0],Tt=(We==null?void 0:We.contacted)===!0||(We==null?void 0:We.status)==="contacted";_e(Tt?"contacted":"pending")}catch(X){console.warn("âš ï¸ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© waiting_list:",X),_e("none")}})()},[a==null?void 0:a.uid]),Rt?e.jsxs("div",{className:`relative inline-flex items-center gap-2 ${b||""}`,ref:Qt,children:[e.jsxs(xu,{onOpenChange:V=>{V&&Mt>0&&Ht()},children:[e.jsx(yu,{asChild:!0,children:e.jsx(w,{variant:"ghost",className:"relative h-8 w-8 rounded-full p-0 hover:bg-transparent focus:ring-1 focus:ring-primary focus:ring-offset-1 transition-all",title:"Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",children:e.jsxs("div",{className:"relative h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center border border-border shadow-sm hover:shadow-md",children:[e.jsx(Ii,{className:"h-4 w-4 text-primary"}),Mt>0&&e.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-red-500 text-white text-[10px] font-bold flex items-center justify-center shadow",children:Mt})]})})}),e.jsxs(wu,{className:"w-80",align:"end",forceMount:!0,children:[e.jsxs(bu,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª"}),T.length>0&&e.jsxs(w,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:Ht,children:[e.jsx(Yn,{className:"h-3 w-3 mr-1"}),"ØªÙ…ÙŠÙŠØ² Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡"]})]}),e.jsx(vu,{}),T.length===0?e.jsx("div",{className:"p-3 text-sm text-muted-foreground",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹"}):e.jsx("div",{className:"max-h-64 overflow-y-auto pr-1",children:T.map(V=>{const X=V.id?!J.has(V.id):!1;return e.jsx("div",{className:`px-2 py-2 rounded-md ${X?"bg-primary/5":""}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ii,{className:`h-4 w-4 ${X?"text-primary":"text-muted-foreground"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:V.title||"Ø¥Ø´Ø¹Ø§Ø±"}),e.jsx("div",{className:"text-xs text-muted-foreground whitespace-pre-line",children:V.message}),V.linkUrl&&e.jsxs(w,{variant:"link",className:"px-0 h-6 text-xs",onClick:()=>Gt(V.linkUrl,V.id),children:["ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· ",e.jsx(fu,{className:"h-3 w-3 ml-1"})]})]}),X?e.jsx(w,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>Gs(V.id),title:"ØªÙ…ÙŠÙŠØ² ÙƒÙ…Ù‚Ø±ÙˆØ¡",children:e.jsx(Yn,{className:"h-4 w-4 text-primary"})}):e.jsx(w,{variant:"ghost",size:"icon",className:"h-6 w-6",disabled:!0,title:"Ù…Ù‚Ø±ÙˆØ¡",children:e.jsx(Yn,{className:"h-4 w-4 text-muted-foreground"})})]})},V.id)})})]})]}),Ce&&Wm.createPortal(e.jsx("div",{ref:jt,style:Gn,className:`pointer-events-auto transition-all duration-300 ${O?"opacity-100 translate-y-0":"opacity-0 -translate-y-3"}`,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-gray-200 p-4 w-80 max-w-[calc(100vw-16px)] flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Ii,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-semibold",children:Ce.title||"Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯"}),e.jsx("div",{className:"text-xs text-muted-foreground whitespace-pre-line",children:Ce.message}),Ce.linkUrl&&e.jsx(w,{variant:"link",className:"px-0 h-6 text-xs",onClick:()=>Gt(Ce.linkUrl,Ce.id),children:"ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·"})]})]})}),document.body)]}):null}function Bu({size:b=24,className:a,...h}){return e.jsxs("svg",{width:b,height:b,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,...h,children:[e.jsx("rect",{x:"5",y:"2.5",width:"14",height:"19",rx:"2.5",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("rect",{x:"7",y:"4.5",width:"10",height:"5.5",rx:"1",stroke:"currentColor",strokeWidth:"1.2"}),e.jsx("path",{d:"M9.5 11.5h5",stroke:"currentColor",strokeWidth:"1.4",strokeLinecap:"round"}),e.jsx("circle",{cx:"8.5",cy:"14",r:"0.9",stroke:"currentColor",strokeWidth:"1"}),e.jsx("circle",{cx:"12",cy:"14",r:"0.9",stroke:"currentColor",strokeWidth:"1"}),e.jsx("circle",{cx:"15.5",cy:"14",r:"0.9",stroke:"currentColor",strokeWidth:"1"}),e.jsx("circle",{cx:"8.5",cy:"17",r:"0.9",stroke:"currentColor",strokeWidth:"1"}),e.jsx("circle",{cx:"12",cy:"17",r:"0.9",stroke:"currentColor",strokeWidth:"1"}),e.jsx("circle",{cx:"15.5",cy:"17",r:"0.9",stroke:"currentColor",strokeWidth:"1"}),e.jsx("rect",{x:"8",y:"19",width:"9",height:"1.8",rx:"0.6",stroke:"currentColor",strokeWidth:"1"})]})}function Uu(b,a=300){const[h,I]=$.useState(b);return $.useEffect(()=>{const j=setTimeout(()=>I(b),a);return()=>clearTimeout(j)},[b,a]),h}const Fu=({userId:b,transactions:a})=>{const[h,I]=c.useState(!1),[j,T]=c.useState(!1),[M,J]=c.useState(!1),[A,_]=c.useState({monthlyWithdrawalProfit:0,monthlyTransferProfit:0,lastUpdated:new Date}),{userSubscription:B}=_i();c.useEffect(()=>{b&&h&&M&&me()},[b,h,M]);const me=async()=>{if(b)try{if(Array.isArray(a)&&a.length>0){const Le=new Date,_e=Le.getMonth(),Ce=Le.getFullYear(),mt=st.filterVisibleTransactions(a,"monthly",b);let O=0,De=0;mt.forEach(ut=>{const nt=new Date(ut.createdAt),qe=String(ut.status||"confirmed").toLowerCase();if(nt.getMonth()!==_e||nt.getFullYear()!==Ce||qe!=="completed"&&qe!=="confirmed")return;const Qt=(ut.type||ut.txnType||"").toLowerCase(),jt={type:Qt==="withdrawal"?"withdraw":Qt,amount:Number(ut.amount||0),commission:ut.commission};jt.type==="withdraw"?O+=la.calculateProfitFromTransaction(jt):(jt.type==="send"||jt.type==="receive"||jt.type==="transfer")&&(De+=la.calculateProfitFromTransaction(jt))}),_({monthlyWithdrawalProfit:Math.round(O*100)/100,monthlyTransferProfit:Math.round(De*100)/100,lastUpdated:new Date});return}const ae=la.getWithdrawTransferProfits(b);_({monthlyWithdrawalProfit:ae.monthlyWithdrawProfit||0,monthlyTransferProfit:ae.monthlyTransferProfit||0,lastUpdated:new Date})}catch(ae){console.error("Error loading profit data:",ae)}},ye=ae=>`${ae.toFixed(2)} Ø¬.Ù…`,f=async()=>{try{const ae=(B==null?void 0:B.subscription)||null,Le=(ae==null?void 0:ae.planType)??(ae==null?void 0:ae.plan)??null,_e=typeof Le=="string"?Le.toLowerCase():null;if(Le===Ct.ZERO||_e==="zero"||_e==="0"||Le===0)return!0}catch{}try{if(b){const ae=await tc(b),Le=(ae==null?void 0:ae.planType)??(ae==null?void 0:ae.plan)??null,_e=typeof Le=="string"?Le.toLowerCase():null;if(Le===Ct.ZERO||_e==="zero"||_e==="0"||Le===0)return!0}}catch{}return!1},Ue=async()=>{try{if(await f()){Ol({title:"Ø§Ù„Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ",description:"Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© ØºÙŠØ± Ù…ØªØ§Ø­ ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±.",variant:"destructive"});return}}catch{}T(!0)},dt=async()=>{try{if(await f()){Ol({title:"Ø§Ù„Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ",description:"Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© ØºÙŠØ± Ù…ØªØ§Ø­ ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±.",variant:"destructive"}),T(!1);return}}catch{}J(!0),I(!0),T(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(w,{size:"sm",variant:"ghost",onClick:Ue,className:"h-6 w-6 p-0 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded-full transition-colors duration-200",title:"Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©",children:e.jsx(os,{className:"h-4 w-4"})}),e.jsx(oe,{open:h,onOpenChange:I,children:e.jsxs(le,{className:"max-w-[280px] sm:max-w-[320px] mx-auto bg-white border border-gray-200 shadow-xl rounded-xl p-0 overflow-hidden",children:[e.jsx(ce,{className:"bg-gray-50 px-4 py-3 border-b border-gray-100",children:e.jsxs(de,{className:"text-sm font-bold text-gray-900 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white rounded-full border border-gray-200",children:e.jsx(ju,{className:"h-4 w-4 text-purple-600"})}),"Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±"]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-red-50 rounded-md",children:e.jsx(rs,{className:"h-3.5 w-3.5 text-red-600"})}),e.jsx("span",{className:"font-medium text-gray-700 text-sm",children:"Ø³Ø­Ø¨"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900",children:ye(A.monthlyWithdrawalProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-green-50 rounded-md",children:e.jsx(sc,{className:"h-3.5 w-3.5 text-green-600"})}),e.jsx("span",{className:"font-medium text-gray-700 text-sm",children:"ØªØ­ÙˆÙŠÙ„"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900",children:ye(A.monthlyTransferProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg border border-purple-100 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white rounded-md shadow-sm",children:e.jsx(Jt,{className:"h-3.5 w-3.5 text-purple-600"})}),e.jsx("span",{className:"font-bold text-purple-900 text-sm",children:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ"})]}),e.jsx("span",{className:"font-bold text-base text-purple-700",children:ye(A.monthlyWithdrawalProfit+A.monthlyTransferProfit)})]})]}),e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-100 flex justify-center",children:e.jsx(w,{onClick:()=>I(!1),className:"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 hover:text-gray-900 w-full sm:w-auto px-8 rounded-lg text-sm font-medium shadow-sm",children:"Ø¥ØºÙ„Ø§Ù‚"})})]})}),e.jsx(Nu,{open:j,onOpenChange:T,onSuccess:dt,description:"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ø¥Ù„Ø§ Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ"})]})},$u=b=>e.jsx(Fu,{...b});function Vu({open:b,onOpenChange:a,onSuccess:h,userId:I}){const[j,T]=c.useState(""),[M,J]=c.useState(""),[A,_]=c.useState(!1),[B,me]=c.useState(!1),[ye,f]=c.useState(""),[Ue,dt]=c.useState(!1),[ae,Le]=c.useState(!1),{toast:_e}=ac();c.useEffect(()=>{let O=!0;return(async()=>{const De=await xt.hasMasterPin(I);O&&Le(De)})(),()=>{O=!1}},[I,b]);const Ce=()=>{T(""),J(""),f(""),_(!1),me(!1),a(!1)},mt=async O=>{O.preventDefault(),f(""),dt(!0);try{if(ae){if(!await xt.verifyMasterPin(j,I)){f("Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­"),dt(!1);return}}else{if(j.length<4){f("ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ 4 Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"),dt(!1);return}if(j!==M){f("Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚"),dt(!1);return}if(!await xt.createMasterPin(j,I)){f("ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ"),dt(!1);return}}_e({title:"Ù†Ø¬Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©",description:ae?"ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¨Ù†Ø¬Ø§Ø­":"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¨Ù†Ø¬Ø§Ø­"}),h(),Ce()}catch{f("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ")}finally{dt(!1)}};return e.jsx(oe,{open:b,onOpenChange:a,children:e.jsxs(le,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(ce,{children:e.jsxs(de,{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(Ll,{className:"h-5 w-5 text-green-600"}),ae?"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ":"Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ"]})}),e.jsxs("form",{onSubmit:mt,className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 bg-blue-50 p-3 rounded-lg",children:ae?"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø±Ø¨Ø§Ø­":"Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø±Ø¨Ø§Ø­. ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø±ÙˆÙÙŠÙ„."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"pin",children:ae?"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ":"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{id:"pin",type:A?"text":"password",value:j,onChange:O=>T(O.target.value),placeholder:ae?"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ":"Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø³Ø±ÙŠ Ø¬Ø¯ÙŠØ¯ (4 Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)",className:"pr-10",dir:"ltr",autoComplete:"off",required:!0}),e.jsx(w,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>_(!A),children:A?e.jsx(Wl,{className:"h-4 w-4"}):e.jsx(os,{className:"h-4 w-4"})})]})]}),!ae&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"confirmPin",children:"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{id:"confirmPin",type:B?"text":"password",value:M,onChange:O=>J(O.target.value),placeholder:"Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ",className:"pr-10",dir:"ltr",autoComplete:"off",required:!0}),e.jsx(w,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>me(!B),children:B?e.jsx(Wl,{className:"h-4 w-4"}):e.jsx(os,{className:"h-4 w-4"})})]})]}),ye&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Du,{className:"h-4 w-4"}),ye]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(w,{type:"submit",disabled:Ue,className:"flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx(Ll,{className:"h-4 w-4 mr-2"}),Ue?"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...":ae?"Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­":"Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­"]}),e.jsx(w,{type:"button",variant:"outline",onClick:Ce,disabled:Ue,children:"Ø¥Ù„ØºØ§Ø¡"})]})]})]})})}const zu=({userId:b,transactions:a})=>{const[h,I]=c.useState(!1),[j,T]=c.useState(!1),[M,J]=c.useState(!1),[A,_]=c.useState({dailyWithdrawalProfit:0,dailyTransferProfit:0,lastUpdated:new Date});c.useEffect(()=>{b&&h&&M&&B()},[b,h,M,a]);const B=async()=>{if(b)try{if(Array.isArray(a)&&a.length>0){const dt=new Date,ae=st.filterVisibleTransactions(a,"daily",b);let Le=0,_e=0;ae.forEach(Ce=>{const mt=new Date(Ce.createdAt),O=String(Ce.status||"confirmed").toLowerCase();if(mt.toDateString()!==dt.toDateString())return;const De=(Ce.type||Ce.txnType||"").toLowerCase(),ut=String(Ce.title||"");if(De==="cash_addition"||ut.includes("Ø¥ÙŠØµØ§Ù„ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©"))return;const nt={type:De==="withdrawal"?"withdraw":De,amount:Number(Ce.amount||0),commission:Ce.commission};nt.type==="withdraw"?Le+=la.calculateProfitFromTransaction(nt):(nt.type==="send"||nt.type==="receive"||nt.type==="transfer")&&(_e+=la.calculateProfitFromTransaction(nt))}),_({dailyWithdrawalProfit:Math.round(Le*100)/100,dailyTransferProfit:Math.round(_e*100)/100,lastUpdated:new Date});try{la.updateProfitsFromTransactions(a,b)}catch{}return}const Ue=la.getWithdrawTransferProfits(b);_({dailyWithdrawalProfit:Ue.dailyWithdrawProfit||0,dailyTransferProfit:Ue.dailyTransferProfit||0,lastUpdated:new Date})}catch(Ue){console.error("Error loading profit data:",Ue)}},me=Ue=>`${Ue.toFixed(2)} Ø¬.Ù…`,ye=()=>{la.hasProfitPin(b),T(!0)},f=()=>{J(!0),I(!0),T(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(w,{size:"sm",variant:"ghost",onClick:ye,className:"h-6 w-6 p-0 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-colors duration-200",title:"Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©",children:e.jsx(os,{className:"h-4 w-4"})}),e.jsx(oe,{open:h,onOpenChange:I,children:e.jsxs(le,{className:"max-w-[280px] sm:max-w-[320px] mx-auto bg-white border border-gray-200 shadow-xl rounded-xl p-0 overflow-hidden",children:[e.jsx(ce,{className:"bg-gray-50 px-4 py-3 border-b border-gray-100",children:e.jsxs(de,{className:"text-sm font-bold text-gray-900 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white rounded-full border border-gray-200",children:e.jsx(Jt,{className:"h-4 w-4 text-blue-600"})}),"Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…"]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-red-50 rounded-md",children:e.jsx(rs,{className:"h-3.5 w-3.5 text-red-600"})}),e.jsx("span",{className:"font-medium text-gray-700 text-sm",children:"Ø³Ø­Ø¨"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900",children:me(A.dailyWithdrawalProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-green-50 rounded-md",children:e.jsx(sc,{className:"h-3.5 w-3.5 text-green-600"})}),e.jsx("span",{className:"font-medium text-gray-700 text-sm",children:"ØªØ­ÙˆÙŠÙ„"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900",children:me(A.dailyTransferProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-100 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white rounded-md shadow-sm",children:e.jsx(Jt,{className:"h-3.5 w-3.5 text-blue-600"})}),e.jsx("span",{className:"font-bold text-blue-900 text-sm",children:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ"})]}),e.jsx("span",{className:"font-bold text-base text-blue-700",children:me(A.dailyWithdrawalProfit+A.dailyTransferProfit)})]})]}),e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-100 flex justify-center",children:e.jsx(w,{onClick:()=>I(!1),className:"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 hover:text-gray-900 w-full sm:w-auto px-8 rounded-lg text-sm font-medium shadow-sm",children:"Ø¥ØºÙ„Ø§Ù‚"})})]})}),e.jsx(Vu,{open:j,onOpenChange:T,onSuccess:f,userId:b})]})},qu=b=>e.jsx(zu,{...b});class is{static async processTransfer(a){const{amount:h,currentCashBalance:I,currentWalletBalances:j,wallets:T,selectedWalletId:M}=a;if(h<=0)return{success:!1,newCashBalance:I,newWalletBalances:j,message:"Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±",error:"INVALID_AMOUNT"};if(M&&!a.skipRemoteLimitsCheck)try{const B=await ja.canPerformOperation(M,h,"transfer");if(!B.canPerform)return{success:!1,newCashBalance:I,newWalletBalances:j,message:B.message||"ØªÙ… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰",error:"LIMIT_EXCEEDED"}}catch(B){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¯ÙˆØ¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„:",B),{success:!1,newCashBalance:I,newWalletBalances:j,message:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¯ÙˆØ¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„",error:"LIMIT_CHECK_ERROR"}}if(h<=0)return{success:!1,newCashBalance:I,newWalletBalances:j,message:"Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±",error:"INVALID_AMOUNT"};if(M){const B=Math.max(j[M]||0,0);if(B<h){const me=T.find(ye=>ye.id===M);return{success:!1,newCashBalance:I,newWalletBalances:j,message:`Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ ÙÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø©${me?` ${me.name}`:""}. Ø§Ù„Ù…ØªØ§Ø­: ${B} Ø¬Ù†ÙŠÙ‡ØŒ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${h} Ø¬Ù†ÙŠÙ‡`,error:"INSUFFICIENT_WALLET_BALANCE"}}}else{const B=is.calculateTotalWalletBalance(j);if(B<h)return{success:!1,newCashBalance:I,newWalletBalances:j,message:`Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸. Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­: ${B} Ø¬Ù†ÙŠÙ‡ØŒ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${h} Ø¬Ù†ÙŠÙ‡`,error:"INSUFFICIENT_WALLET_BALANCE"}}const J={...j};if(M){const B=J[M]||0;J[M]=B-h}else{let B=h;for(const me of T){if(B<=0)break;const ye=Math.max(J[me.id]||0,0),f=Math.min(ye,B);f>0&&(J[me.id]=(J[me.id]||0)-f,B-=f)}}const A=I+h;let _="ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­";if(M){const B=J[M]||0;B<0&&(_=`ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¹ ØªØ­Ø°ÙŠØ±: Ø±ØµÙŠØ¯ Ù…Ø­ÙØ¸Ø© ${M} Ø£ØµØ¨Ø­ ${B} Ø¬Ù†ÙŠÙ‡.`)}return{success:!0,newCashBalance:A,newWalletBalances:J,message:_}}static processDeposit(a){const{amount:h,currentCashBalance:I,currentWalletBalances:j,wallets:T}=a;if(h<=0)return{success:!1,newCashBalance:I,newWalletBalances:j,message:"Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±",error:"INVALID_AMOUNT"};const M=this.calculateTotalWalletBalance(j);if(M<h)return{success:!1,newCashBalance:I,newWalletBalances:j,message:`Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸. Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­: ${M} Ø¬Ù†ÙŠÙ‡ØŒ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${h} Ø¬Ù†ÙŠÙ‡`,error:"INSUFFICIENT_WALLET_BALANCE"};const J=I+h,A={...j};let _=h;const B=T.find(ye=>ye.isDefault);if(B&&A[B.id]>=_)A[B.id]-=_,_=0;else for(const ye of T){if(_<=0)break;const f=A[ye.id]||0;if(f>0){const Ue=Math.min(f,_);A[ye.id]=f-Ue,_-=Ue}}const me=_>0?`ØªÙ… Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø¬Ø²Ø¦ÙŠØ§Ù‹. ØªÙ… Ø¥ÙŠØ¯Ø§Ø¹ ${h-_} Ø¬Ù†ÙŠÙ‡ ÙÙŠ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©`:`ØªÙ… Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­. ØªÙ… Ø¥Ø¶Ø§ÙØ© ${h} Ø¬Ù†ÙŠÙ‡ Ø¥Ù„Ù‰ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©`;return{success:!0,newCashBalance:J,newWalletBalances:A,message:me}}static async processWithdraw(a){const{amount:h,currentCashBalance:I,currentWalletBalances:j,wallets:T,selectedWalletId:M}=a;if(h<=0)return{success:!1,newCashBalance:I,newWalletBalances:j,message:"Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±",error:"INVALID_AMOUNT"};if(M&&!a.skipRemoteLimitsCheck)try{const B=await ja.canPerformOperation(M,h,"withdraw");if(!B.canPerform)return{success:!1,newCashBalance:I,newWalletBalances:j,message:B.message||"ØªÙ… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰",error:"LIMIT_EXCEEDED"}}catch(B){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø³Ø­Ø¨:",B),{success:!1,newCashBalance:I,newWalletBalances:j,message:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø³Ø­Ø¨",error:"LIMIT_CHECK_ERROR"}}if(I<h)return{success:!1,newCashBalance:I,newWalletBalances:j,message:`Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ ÙÙŠ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©. Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­: ${I} Ø¬Ù†ÙŠÙ‡ØŒ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${h} Ø¬Ù†ÙŠÙ‡`,error:"INSUFFICIENT_CASH_BALANCE"};const J=I-h,A={...j},_=M?T.find(B=>B.id===M):T.find(B=>B.isDefault)||T[0];if(_){const B=A[_.id]||0;A[_.id]=B+h}else return{success:!1,newCashBalance:I,newWalletBalances:j,message:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙØ¸ Ù…ØªØ§Ø­Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¨Ù„Øº Ø¥Ù„ÙŠÙ‡Ø§",error:"NO_WALLETS_AVAILABLE"};return{success:!0,newCashBalance:J,newWalletBalances:A,message:`ØªÙ… Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­. ØªÙ… Ø¥Ø¶Ø§ÙØ© ${h} Ø¬Ù†ÙŠÙ‡ Ø¥Ù„Ù‰ Ù…Ø­ÙØ¸Ø© ${(_==null?void 0:_.name)||""}`}}static validateOperation(a,h){return a<=0?{valid:!1,error:"Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±"}:!h||h.length===0?{valid:!1,error:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙØ¸ Ù…ØªØ§Ø­Ø©"}:{valid:!0}}static calculateTotalWalletBalance(a){return Object.values(a).reduce((h,I)=>h+Math.max(I,0),0)}static deductFromWalletsAddToCash(a,h,I,j){return this.processTransfer({amount:a,currentCashBalance:h,currentWalletBalances:I,wallets:j})}static deductFromWalletsAddToCashDeposit(a,h,I,j){return this.processDeposit({amount:a,currentCashBalance:h,currentWalletBalances:I,wallets:j})}static deductFromCashAddToWallets(a,h,I,j){return this.processWithdraw({amount:a,currentCashBalance:h,currentWalletBalances:I,wallets:j})}static applyTransactionResult(a,h,I){a.success&&(h(a.newCashBalance),I(a.newWalletBalances))}static validateTransaction(a,h,I,j){if(a<=0)return{isValid:!1,error:"Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±"};if(h==="transfer"){const T=this.calculateTotalWalletBalance(j);if(T<a)return{isValid:!1,error:`Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­ ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸ (${T} Ø¬Ù†ÙŠÙ‡) ØºÙŠØ± ÙƒØ§ÙÙŠ Ù„Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (${a} Ø¬Ù†ÙŠÙ‡)`}}else if(h==="withdraw"){if(I<a)return{isValid:!1,error:`Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­ ÙÙŠ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© (${I} Ø¬Ù†ÙŠÙ‡) ØºÙŠØ± ÙƒØ§ÙÙŠ Ù„Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (${a} Ø¬Ù†ÙŠÙ‡)`}}else if(h==="deposit"){const T=this.calculateTotalWalletBalance(j);if(T<a)return{isValid:!1,error:`Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­ ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸ (${T} Ø¬Ù†ÙŠÙ‡) ØºÙŠØ± ÙƒØ§ÙÙŠ Ù„Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (${a} Ø¬Ù†ÙŠÙ‡)`}}return{isValid:!0}}static getDeductionPreview(a,h,I){const j=[];let T=a;for(const M of I){if(T<=0)break;const J=h[M.id]||0,A=Math.min(Math.max(J,0),T);A>0&&(j.push({walletId:M.id,walletName:M.name,currentBalance:J,deductedAmount:A,newBalance:J-A}),T-=A)}return j}}let Qs=null;function Ku(){const b=window;if(!Qs){const a=b.AudioContext||b.webkitAudioContext;Qs=new a}return Qs.state==="suspended"&&Qs.resume(),Qs}function Ju(b,a,h){const I=h/1e3,j=Math.floor(b.sampleRate*I),T=b.createBuffer(1,j,b.sampleRate),M=T.getChannelData(0);for(let B=0;B<j;B++)M[B]=(Math.random()*2-1)*.6;const J=b.createBufferSource();J.buffer=T;const A=b.createBiquadFilter();A.type="highpass",A.frequency.value=1500,A.Q.value=.7;const _=b.createGain();_.gain.setValueAtTime(1e-4,a),_.gain.exponentialRampToValueAtTime(.4,a+.015),_.gain.exponentialRampToValueAtTime(1e-4,a+I),J.connect(A),A.connect(_),_.connect(b.destination),J.start(a),J.stop(a+I+.01)}function Qu(b,a,h,I,j,T="triangle"){const M=b.createOscillator(),J=b.createGain();M.type=T;const A=j/1e3;M.frequency.setValueAtTime(h,a),M.frequency.linearRampToValueAtTime(I,a+A),J.gain.setValueAtTime(1e-4,a),J.gain.exponentialRampToValueAtTime(.25,a+.02),J.gain.exponentialRampToValueAtTime(1e-4,a+A),M.connect(J),J.connect(b.destination),M.start(a),M.stop(a+A+.02)}function Yu(){try{const b=Ku(),a=b.currentTime;Ju(b,a,90),Qu(b,a+.12,1900,1100,180,"sawtooth")}catch{}}function Hu(b){if(!b)return!1;const h=b.replace(/[^0-9Ù -Ù©]/g,"").replace(/[Ù -Ù©]/g,I=>"0123456789"["Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©".indexOf(I)]);return/^(010|011|012|015)[0-9]{8}$/.test(h)}const Gu=$.lazy(()=>F(()=>import("./index-bCWIXU_s.js").then(b=>b.co),__vite__mapDeps([0,1]),import.meta.url).then(b=>({default:b.BranchRequestDialog}))),Zu=$.lazy(()=>F(()=>import("./WalletManagement-SWSqiXRe.js"),__vite__mapDeps([2,0,1,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]),import.meta.url)),Xu=$.lazy(()=>F(()=>import("./TransactionDetailsModal-Brl8NR8E.js"),__vite__mapDeps([22,0,1,23,3,11,18,15,24,10,20,21]),import.meta.url)),eh=$.lazy(()=>F(()=>import("./ReceiptModal-Cv6QcDz4.js"),__vite__mapDeps([25,0,1,23,14,3,5,6,26,27,10,21,24,28]),import.meta.url)),Zl=$.lazy(()=>F(()=>import("./EditBalanceDialog-Cu1xoA8h.js"),__vite__mapDeps([29,0,1,5,6,18]),import.meta.url).then(b=>({default:b.EditBalanceDialog}))),th=$.lazy(()=>F(()=>import("./ChangePinDialog-B57xZYPQ.js"),__vite__mapDeps([30,0,1,6]),import.meta.url).then(b=>({default:b.ChangePinDialog}))),ah=$.lazy(()=>F(()=>import("./ChangeCashPinDialog-CjWfATmi.js"),__vite__mapDeps([31,0,1,18,6]),import.meta.url).then(b=>({default:b.ChangeCashPinDialog}))),sh=$.lazy(()=>F(()=>import("./ChangeWalletTotalPinDialog-ChJSXZyz.js"),__vite__mapDeps([32,0,1,7,6]),import.meta.url).then(b=>({default:b.ChangeWalletTotalPinDialog}))),nh=$.lazy(()=>F(()=>import("./MasterPinDialog-A5-_nbFS.js").then(b=>b.b),__vite__mapDeps([5,0,1,6]),import.meta.url)),Et=$.lazy(()=>F(()=>import("./MasterPinDialog-A5-_nbFS.js").then(b=>b.c),__vite__mapDeps([5,0,1,6]),import.meta.url).then(b=>({default:b.MasterPinDialog}))),rh=$.lazy(()=>F(()=>import("./AddToWalletDialog-Bh8D9jRb.js"),__vite__mapDeps([33,0,1,5,6]),import.meta.url).then(b=>({default:b.AddToWalletDialog}))),ih=$.lazy(()=>F(()=>import("./CalculatorDialog-BW1MBUvd.js"),__vite__mapDeps([34,0,1,23]),import.meta.url).then(b=>({default:b.CalculatorDialog}))),oh=$.lazy(()=>F(()=>import("./SalesDataDialog-BSBXlo0a.js"),__vite__mapDeps([35,0,1,36,3,37,38,4,14,5,6,16,39,18,15,40,24,41,10,17,20,12]),import.meta.url).then(b=>({default:b.SalesDataDialog}))),lh=$.lazy(()=>F(()=>import("./CashSummaryDialog-7i3tqesS.js"),__vite__mapDeps([42,0,1,5,6,18,41,23]),import.meta.url).then(b=>({default:b.CashSummaryDialog}))),ch=$.lazy(()=>F(()=>import("./CreditCardsDialog-9OklCdBm.js"),__vite__mapDeps([43,0,1,13,21,44,10,6,15]),import.meta.url)),dh=$.lazy(()=>F(()=>import("./InstallmentModal-CAmVQMeQ.js"),__vite__mapDeps([45,0,1,3,15]),import.meta.url)),mh=$.lazy(()=>F(()=>import("./MaintenanceDialog-CgVez11i.js"),__vite__mapDeps([46,0,1,3,14,47,5,6,39,10,21]),import.meta.url)),uh=$.lazy(()=>F(()=>import("./MachineDailyDialog-CMRrSK5A.js"),__vite__mapDeps([48,0,1,3,14,4,10,15,49,50,5,6,9,51,18,52,20,21,53,39,12,54,55,38,56,57,58,47,59,23,7,40,24,11]),import.meta.url)),hh=$.lazy(()=>F(()=>import("./WalletsManagement-CTvhIuFw.js"),__vite__mapDeps([60,0,1,3,13,4,61,51,27,24,7,12,9,28,10]),import.meta.url).then(b=>({default:b.WalletsManagement}))),ph=$.lazy(()=>F(()=>import("./WalletsListDialog-DfCwfkfk.js"),__vite__mapDeps([62,0,1,4,7,11]),import.meta.url).then(b=>({default:b.WalletsListDialog}))),Xl=$.lazy(()=>F(()=>import("./WalletPrinterDialog-gKIzZGi9.js"),__vite__mapDeps([61,0,1,51,27,24,7,12,9,28]),import.meta.url)),fh=$.lazy(()=>F(()=>import("./CashierShiftModal-hEg5Xax2.js"),__vite__mapDeps([63,0,1,64]),import.meta.url)),gh=$.lazy(()=>F(()=>import("./ShiftProfileDialog-BrAb_Xzt.js"),__vite__mapDeps([65,0,1]),import.meta.url)),xh=$.lazy(()=>F(()=>import("./ChangeLogDialog-CkcgGZ-J.js"),__vite__mapDeps([66,0,1,67]),import.meta.url));function yh({userId:b}){const[a,h]=$.useState(null),[I,j]=$.useState("");return null}const wh=()=>{var Tl,_l,El,kl,Pl;console.log("ğŸ”¥ UserDashboardPage component is loading...");const{signOut:b,user:a,profile:h}=_i(),I=((a==null?void 0:a.email)||"").toLowerCase()==="vodafonecash00@gmail.com",j=ec(),T=Rm(),M=Mm(),{isShiftActive:J,shiftUser:A}=Bm(),{shopId:_,shopName:B}=Um(),me=Fm(),ye=$m(),{toast:f}=ac(),Ue=c.useRef(null),[dt,ae]=c.useState(0),[Le,_e]=c.useState(!1),[Ce,mt]=c.useState(!1),[O,De]=c.useState(()=>{try{const t=Object.keys(localStorage).find(n=>n.startsWith("wallets_")),s=t?localStorage.getItem(t):null;if(s){const n=JSON.parse(s);if(Array.isArray(n))return n}}catch{}return[]});c.useEffect(()=>{var t;(t=j.state)!=null&&t.openProfileSettings&&(_e(!0),window.history.replaceState({},document.title))},[j.state]);const ut=async()=>{var n,r,i;const t="alkaptin678678@gmail.com",s=(r=(n=ns.currentUser)==null?void 0:n.email)==null?void 0:r.toLowerCase();if(!s||s!==t){f({title:"Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹."});return}if(!In||!Cn||!An){f({title:"Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©",description:"Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ØŒ Ø§Ù„Ø´Ø±ÙƒØ© ÙˆØ§Ù„Ù…Ø¨Ù„Øº",variant:"destructive"});return}try{sl(!0);const o=await((i=ns.currentUser)==null?void 0:i.getIdToken()),l=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}},body:JSON.stringify({phone:In,countryCode:"EG",operator:Cn,amount:Number(An),useLocalAmount:!0})}),d=await l.json().catch(()=>({}));l.ok&&(d!=null&&d.success)?(f({title:"ØªÙ… Ø§Ù„Ø´Ø­Ù†",description:(d==null?void 0:d.message)||"ØªÙ… ØªÙ†ÙÙŠØ° Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø­Ù† Ø¨Ù†Ø¬Ø§Ø­"}),ai(!1),Xo(""),el(""),tl("")):f({title:"ÙØ´Ù„ Ø§Ù„Ø´Ø­Ù†",description:(d==null?void 0:d.message)||"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø­Ù†",variant:"destructive"})}catch(o){console.error("Topup request error:",o),f({title:"Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹",description:"ØªØ¹Ø°Ù‘Ø± ØªÙ†ÙÙŠØ° Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø­Ù†. Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹.",variant:"destructive"})}finally{sl(!1)}};(()=>{try{return!!window.electronAPI||typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("electron")||typeof window<"u"&&window.location&&window.location.protocol==="file:"}catch{return!1}})();const[nt,qe]=c.useState(!1),[Qt,jt]=c.useState(!1),[Gn,Zn]=c.useState(!1),[Hs,Yt]=c.useState(!1),[Rt,Mt]=c.useState(!1),[Gs,Ht]=c.useState(!1),[Gt,Sa]=c.useState([]),[V,X]=c.useState(""),[Z,Ee]=c.useState(""),[We,Tt]=c.useState(""),[ke,St]=c.useState(""),[Da,Zt]=c.useState(!1),[Bt,Ia]=c.useState(!1),[Zs,ls]=c.useState(null),[cs,ds]=c.useState(""),[Ei,ki]=c.useState(""),[nc,Pi]=c.useState(!1),[rc,Xs]=c.useState(!1),[ic,Oi]=c.useState(!1),[rt,oc]=c.useState(null),[Ca,Li]=c.useState(!1),[Wi,lc]=c.useState(!1),[Re,cc]=c.useState(null);c.useEffect(()=>{Vm().then(cc).catch(()=>{})},[]);const[Ri,dc]=c.useState(void 0);c.useEffect(()=>{try{const t=window.electronAPI;t&&typeof t.appVersion=="function"&&t.appVersion().then(s=>{typeof s=="string"&&!s.startsWith("err:")&&dc(s)}).catch(()=>{})}catch{}},[]);const Mi=(()=>{var n,r;const t=(r=(n=import.meta)==null?void 0:n.env)==null?void 0:r.VITE_APP_VERSION,s=typeof window<"u"&&(window.electronAPI||window.location.protocol==="file:"||typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("electron"));if(s&&(h!=null&&h.desktopInstalledVersion))return h==null?void 0:h.desktopInstalledVersion;if(s&&Ri)return Ri;if(t)return t;if(!(!Re&&!h))return ye?(h==null?void 0:h.androidInstalledVersion)||(h==null?void 0:h.lastAckAndroidVersion)||(Re==null?void 0:Re.androidVersion)||(Re==null?void 0:Re.pcVersion):(Re==null?void 0:Re.pcVersion)||(Re==null?void 0:Re.androidVersion)})();c.useEffect(()=>{Rt&&(a!=null&&a.uid)&&!Wi&&(async()=>{Zt(!0);try{let s=[],n=[];try{const l=ne(W,"users",a.uid,"branches");s=(await fe(l)).docs.map(p=>({id:p.id,...p.data(),source:"sub"}))}catch(l){console.warn("Failed to fetch subcollection branches:",l)}try{const l=ve(ne(W,"branches"),Q("ownerId","==",a.uid));n=(await fe(l)).docs.map(p=>({id:p.id,...p.data(),source:"root"}))}catch(l){console.warn("Failed to fetch root branches:",l)}const r=[...s,...n],i=new Map;r.forEach(l=>{const d=l.branchUserId||l.id;(!i.has(d)||l.source==="sub")&&i.set(d,l)});const o=Array.from(i.values());console.log("Loaded branches:",o),Sa(o),lc(!0)}catch(s){console.error("Error in branch loading process:",s),f({title:"ØªÙ†Ø¨ÙŠÙ‡",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©",variant:"destructive"})}finally{Zt(!1)}})()},[Rt,a==null?void 0:a.uid,Wi]),c.useEffect(()=>{Rt||Li(!1)},[Rt]);const[mc,en]=c.useState(!1),[Aa,uc]=c.useState(null),[tn,Bi]=c.useState(""),[an,Ui]=c.useState(""),[hc,pc]=c.useState(""),[Fi,$i]=c.useState(!1),fc=t=>{uc(t),Bi(t.branchName||""),Ui(t.managerName||""),pc(t.loginUsername||t.email||t.username||""),en(!0)},gc=async()=>{if(!(!Aa||!tn||!an)){$i(!0);try{const t={branchName:tn,managerName:an,updatedAt:new Date};if(Aa.branchUserId)try{await At(ge(W,"users",(a==null?void 0:a.uid)||"","branches",String(Aa.branchUserId)),t,{merge:!0});try{await It(ge(W,"users",Aa.branchUserId),{displayName:tn,managerName:an})}catch(s){console.warn("Could not update branch root user doc",s)}}catch(s){console.warn("Sub branch update failed:",s)}try{await It(ge(W,"branches",Aa.id),t)}catch{}Sa(s=>s.map(n=>n.id===Aa.id?{...n,...t}:n)),f({title:"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±Ø¹ Ø¨Ù†Ø¬Ø§Ø­"}),en(!1)}catch(t){console.error("Error updating branch:",t),f({title:"ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",description:t.message,variant:"destructive"})}finally{$i(!1)}}},xc=async t=>{if(!(t!=null&&t.branchUserId)){f({title:"Ø®Ø·Ø£",description:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±Ø¹ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©",variant:"destructive"});return}Oi(!0),Xs(!0);try{const s=t.branchUserId;if(a!=null&&a.uid&&t.branchUserId&&t.source!=="sub")try{await At(ge(W,"users",a.uid,"branches",t.branchUserId),{branchUserId:t.branchUserId,branchName:t.branchName||"Unknown Branch",managerName:t.managerName||"",active:!0,lastSynced:et()},{merge:!0}),console.log("âœ… Branch link synced successfully"),await new Promise(re=>setTimeout(re,500))}catch(re){console.error("âŒ Failed to sync branch link:",re)}const[n,r,i,o]=await Promise.all([kt(ge(W,"users",s)),(async()=>{try{const re=ve(ne(W,"merchantWallets"),Q("merchantUserId","==",s)),pe=await fe(re);if(!pe.empty)return pe;const Be=await fe(ne(W,"users",s,"wallets"));return Be.empty?await fe(ve(ne(W,"wallets"),Q("userId","==",s))):Be}catch(re){console.error("Error fetching wallets",re);try{return await fe(ve(ne(W,"wallets"),Q("userId","==",s)))}catch{return{docs:[]}}}})(),(async()=>{try{return await fe(ve(ne(W,"debts"),Q("userId","==",s)))}catch{return await fe(ne(W,"users",s,"debts"))}})(),(async()=>{try{const re=ve(ne(W,"dailySales"),Q("userId","==",s)),pe=await fe(re);return pe.empty?await fe(ne(W,"users",s,"dailySales")):pe}catch(re){return console.error("Error fetching sales",re),await fe(ne(W,"users",s,"dailySales"))}})()]),l=n.exists()?n.data():{},d=Number(l.cashBalance||0),p=l.reportsData||{},m=Number(p.dailyProfit||0),u=Number(p.monthlyProfit||0),g=l.walletBalances||{};let x=Object.values(g).reduce((re,pe)=>re+Number(pe||0),0);x===0&&!r.empty&&(x=r.docs.reduce((re,pe)=>re+Number(pe.data().balance||pe.data().amount||0),0));let y=0;i.forEach(re=>{const pe=re.data();if(pe.type!=="debtor"){const Be=Number(pe.paidAmount||0),Ve=Math.max(0,Number(pe.amount||0)-Be);y+=Ve}});const E=new Date().toISOString().split("T")[0],v=E.slice(0,7);let S=0,P=0,z=m,Ne=u,$e=0;console.log(`Branch Details - UID: ${s}, Wallets: ${r.size}, Sales: ${o.size}, ReportsDaily: ${m}`),o.forEach(re=>{const pe=re.data(),Be=String(pe.date||""),Ve=Number(pe.sellingPrice||0)*Number(pe.quantity||1),ra=Number(pe.profit||0);$e+=Ve,Be===E&&(S+=Ve,z+=ra),Be.startsWith(v)&&(P+=Ve,Ne+=ra)}),oc({branchName:t.branchName,managerName:t.managerName,todaySales:S,monthSales:P,todayProfit:z,monthProfit:Ne,walletsTotal:x,cashBalance:d,totalSalesSection:$e,debtsTotal:y})}catch(s){console.error("Error fetching branch details:",s),f({title:"ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±Ø¹",description:s.message,variant:"destructive"}),Xs(!1)}finally{Oi(!1)}},[D,ms]=c.useState("");c.useEffect(()=>{const t=M==null?void 0:M.shopId;if(t&&(a!=null&&a.uid))try{const s=`selectedShopId_${a.uid}`;localStorage.setItem(s,String(t)),window.dispatchEvent(new Event("selectedShopIdChanged"))}catch{}},[M==null?void 0:M.shopId,a==null?void 0:a.uid]);const[Xn,yc]=c.useState([]),[sn,Ta]=c.useState(()=>{try{return localStorage.getItem("cashySelectedDevice")||null}catch{return null}});c.useEffect(()=>{},[]),c.useEffect(()=>{(async()=>{if(D)try{await Vs.set({key:"selected_wallet_id",value:D}),console.log("ğŸ“± Synced selected_wallet_id to Native:",D)}catch(s){console.error("Failed to sync wallet to native:",s)}else await Vs.remove({key:"selected_wallet_id"})})()},[D]),c.useEffect(()=>{(async()=>{if(_)try{await Vs.set({key:"shopId",value:_}),console.log("ğŸ“± Synced shopId to Native:",_)}catch(s){console.error("Failed to sync shopId to native:",s)}})()},[_]);const er=t=>!!(t&&Xn.some(s=>s.id===t));async function wc(){const t=window.electronAPI,s=sn||"";if(!t||typeof t.sendUssd!="function")return null;if(!s)return f({title:"Ø§Ù„Ø¬Ù‡Ø§Ø² ØºÙŠØ± Ù…Ø­Ø¯Ø¯",description:"Ø§ØªØµÙ„ Ø¨Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©",variant:"destructive"}),null;if(er(s))return s;try{const o=Xn.find(l=>l&&l.id&&!String(l.id).includes(":"));if(o&&o.id)return Ta(o.id),o.id}catch{}const n=s.includes(":")?s.split(":").slice(0,2).join(":"):"";if(n&&typeof t.connectWifi=="function"){try{const o=await t.connectWifi(n);if(typeof o=="string"&&(o.includes("âœ…")||o.toLowerCase().includes("connected")))return s}catch{}if(typeof t.refreshAdbDevices=="function")try{await t.refreshAdbDevices()}catch{}await new Promise(o=>setTimeout(o,250))}const r=s.split(":")[0],i=Xn.find(o=>(o.id.startsWith(r)||o.id.includes(r))&&o.id.includes(":"));if(i!=null&&i.id){const o=i.id.split(":").slice(0,2).join(":");if(!er(i.id)&&typeof t.connectWifi=="function"){try{const l=await t.connectWifi(o);if(typeof l=="string"&&(l.includes("âœ…")||l.toLowerCase().includes("connected")))return Ta(i.id),i.id}catch{}await new Promise(l=>setTimeout(l,250))}if(er(i.id))return Ta(i.id),i.id}return s&&n?s:(f({title:"Ø§Ù„Ø¬Ù‡Ø§Ø² ØºÙŠØ± Ù…ØªØµÙ„",description:"ÙØ¹Ù‘Ù„ Wireless debugging Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§ØªØµØ§Ù„ Wiâ€‘Fi Ø«Ù… Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©",variant:"destructive"}),null)}c.useEffect(()=>{const t=window.electronAPI;t&&typeof t.onAdbDevices=="function"&&t.onAdbDevices(s=>{var i;const n=Array.isArray(s)?s:[];yc(n);const r=(()=>{try{return localStorage.getItem("cashySelectedDevice")||""}catch{return""}})();r?Ta(r):(i=n[0])!=null&&i.id?Ta(o=>o||n[0].id):Ta(null)})},[]);function bc(t,s){try{const n=Fe==null?void 0:Fe(),r=(n==null?void 0:n.phone)||"";if(!r){f({title:"ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙØ¸Ø©",description:"Ø§Ø®ØªØ± Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…ÙØ±Ø³Ù„ Ø£ÙˆÙ„Ø§Ù‹",variant:"destructive"});return}iu(r,t,s),f({title:"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„",description:"ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ"}),ua(!1),Ba(!1)}catch(n){const r=(n==null?void 0:n.message)||"ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ â€” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";throw f({title:"ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„",description:r,variant:"destructive"}),n}}const[_a,tr]=c.useState(null),vc=async()=>{var n;if(!pt||!pt.receiver||!pt.amount){f({title:"Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©",description:"ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ ÙˆØ§Ù„Ù…Ø¨Ù„Øº Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„",variant:"destructive"});return}const t=String(pt.receiver),s=Math.round(Number(pt.amount));ha(!0);try{if((n=Hn)!=null&&n.isNativePlatform&&Hn.getPlatform()==="android"){const i=Fe==null?void 0:Fe(),o=(i==null?void 0:i.phone)||"";if(!o){f({title:"ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙØ¸Ø©",description:"Ø§Ø®ØªØ± Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…ÙØ±Ø³Ù„ Ø£ÙˆÙ„Ø§Ù‹",variant:"destructive"}),ha(!1);return}const l=zl(o,t,s);if(!l){f({title:"Ø±Ù‚Ù… ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…",description:"ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø±Ù‚Ù… 010/011/012/015",variant:"destructive"}),ha(!1);return}ru(l),f({title:"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„",description:"ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ"}),ua(!1),Ba(!1);return}const r=window.electronAPI;if(r&&typeof r.sendUssd=="function"&&sn){const i=Fe==null?void 0:Fe(),o=(i==null?void 0:i.phone)||"";if(!o){f({title:"ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙØ¸Ø©",description:"Ø§Ø®ØªØ± Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…ÙØ±Ø³Ù„ Ø£ÙˆÙ„Ø§Ù‹",variant:"destructive"}),ha(!1);return}const l=await wc();if(!l){ha(!1);return}const d=zl(o,t,s);if(!d){f({title:"Ø±Ù‚Ù… ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…",description:"ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø±Ù‚Ù… 010/011/012/015",variant:"destructive"}),ha(!1);return}try{let p="";if(_a!==null)p=`${l}:sim${_a}`;else{const m=typeof r.pickSimAutomatically=="function"?await r.pickSimAutomatically(l,o):{deviceId:l,slot:0};p=`${m.deviceId}:sim${m.slot}`}od(p),await r.sendUssd(p,d)}catch{try{await r.sendUssd(l,d)}catch(m){const u=l.includes(":")?l.split(":").slice(0,2).join(":"):"";if(u&&typeof r.connectWifi=="function")await r.connectWifi(u),await r.sendUssd(l,d);else throw m}}f({title:"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„",description:"ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨Ù†Ø¬Ø§Ø­"}),ua(!1),Ba(!0)}else bc(t,s)}catch(r){const i=r&&r.message?r.message:"Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";f({title:"Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„",description:`Ø§Ù„Ø¬Ù‡Ø§Ø²: ${vo||sn||"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"} â€” ${i}`,variant:"destructive"})}finally{ha(!1)}},Nc=async(t,s)=>{const n=window.electronAPI;try{if(n&&typeof n.enterPin=="function"&&t){await n.enterPin(t,s),Ba(!1);return}const r=String((h==null?void 0:h.bridgeLink)||"").trim(),i=String((h==null?void 0:h.bridgeDeviceId)||"").trim()||void 0;if(!r){f({title:"Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± Ù…ÙØ¹Ø¯Ù‘",description:"Ø§Ø­ÙØ¸ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø³Ø± Ø£ÙˆÙ„Ø§Ù‹",variant:"destructive"});return}const o=String((pt==null?void 0:pt.receiver)||ht||"").replace(/\D/g,""),l=Math.max(1,Math.round(Number((pt==null?void 0:pt.amount)||Qe||0))||0),d=String(s||"").replace(/\D/g,""),m=(u=>{let g=(u||"").trim();return g=g.replace(/\/+$/,""),/^https?:\/\//i.test(g)||(g=`https://${g}`),g})(r);Ba(!1)}catch(r){const i=(r==null?void 0:r.message)||"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ";f({title:"ÙØ´Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„",description:i,variant:"destructive"})}};console.log("ğŸ”¥ UserDashboardPage - user:",a?"exists":"null");const[us,Xt]=c.useState(!0),[ar,hs]=c.useState(!0),[jc,ca]=c.useState(!1),[Sc,Ea]=c.useState(!1),[nn,Vi]=c.useState(""),[sr,zi]=c.useState(""),[nr,qi]=c.useState(""),[rn,rr]=c.useState([]),[Dc,on]=c.useState(!1),[Ke,ps]=c.useState(null),[ka,ir]=c.useState(""),[bh,vh]=c.useState(!1),[Ic,or]=c.useState(!1),[Cc,ea]=c.useState(!1),[Ac,fs]=c.useState(!1),[gs,lr]=c.useState(""),[Ki,cr]=c.useState(""),[Ji,Pa]=c.useState([]),[Nh,Qi]=c.useState(!1),[jh,Yi]=c.useState(0),[Sh,Hi]=c.useState(!1),[it,Gi]=c.useState(null),[Je,Tc]=c.useState(null),[Dh,Zi]=c.useState(!1),[Ut,Oa]=c.useState(""),[ht,xs]=c.useState(""),[Qe,La]=c.useState(""),[da,Xi]=c.useState(""),[ys,eo]=c.useState(""),[dr,Wa]=c.useState(!1),[mr,ur]=c.useState(""),[_c,ma]=c.useState(""),[to,ao]=c.useState(""),[hr,Ec]=c.useState(""),[_t,pr]=c.useState(null),[kc,so]=c.useState(!1),[Pc,no]=c.useState(!1),[Oc,ln]=c.useState(!1),[Lc,fr]=c.useState(!1),[ro,gr]=c.useState(null),[Ye,cn]=c.useState(""),[He,dn]=c.useState(""),[io,Wc]=c.useState(""),[Rc,oo]=c.useState(!1),[Ih,Ch]=c.useState(null),[xr,lo]=c.useState(null),[Mc,yr]=c.useState(!1);c.useEffect(()=>{(async()=>{try{const s=a!=null&&a.uid?`withdrawSenderNameInputEnabled_${a==null?void 0:a.uid}`:"withdrawSenderNameInputEnabled";let n=null;try{n=localStorage.getItem(s)??localStorage.getItem("withdrawSenderNameInputEnabled")}catch{}if(a!=null&&a.uid)try{const r=await qa(()=>K.getUserData(a.uid)),i=r==null?void 0:r.withdrawSenderNameInputEnabled;if(typeof i=="boolean"){yr(i);try{localStorage.setItem(s,i?"true":"false")}catch{}return}}catch{}yr(n==="true")}catch{yr(!1)}})()},[a==null?void 0:a.uid]);const mn=t=>{const s="Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©",n="Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹";return(t||"").split("").map(r=>{const i=s.indexOf(r);if(i>-1)return String(i);const o=n.indexOf(r);return o>-1?String(o):r}).join("")},[xe,wr]=c.useState(()=>{try{const t=localStorage.getItem("commissionMode")||localStorage.getItem("commissionMode_default");return t?t==="add":!0}catch{return!0}}),[L,br]=c.useState("transfer"),[Y,yt]=c.useState([]),[Ft,vr]=c.useState("all"),[he,Ge]=c.useState([]),$t=c.useRef([]),ws=Js({enabled:!!(a!=null&&a.uid),queryKey:["recentTransactions",a==null?void 0:a.uid,_||"main"],queryFn:async()=>{const{collection:t,query:s,where:n,orderBy:r,limit:i,getDocs:o}=await F(async()=>{const{collection:v,query:S,where:P,orderBy:z,limit:Ne,getDocs:$e}=await import("./index-bCWIXU_s.js").then(re=>re.ck);return{collection:v,query:S,where:P,orderBy:z,limit:Ne,getDocs:$e}},__vite__mapDeps([0,1]),import.meta.url),{db:l}=await F(async()=>{const{db:v}=await import("./index-bCWIXU_s.js").then(S=>S.cl);return{db:v}},__vite__mapDeps([0,1]),import.meta.url),d=s(t(l,"userTransactions"),n("userId","==",String((a==null?void 0:a.uid)||"")),r("createdAt","desc"),i(100)),u=(await o(d)).docs.map(v=>{var Ve;const S=v.data(),P=(Ve=S.createdAt)!=null&&Ve.toDate?S.createdAt.toDate():new Date(S.createdAt),z=String(S.transactionType||S.txnType||S.type||"").toLowerCase(),Ne=z==="withdraw"||z==="receive"?"withdraw":"send",$e=S.status==="confirmed"?"completed":S.status||"completed",re=S.senderMsisdn||S.senderPhone||"",pe=S.receiverMsisdn||S.receiverPhone||"",Be=Number(S.amount??S.transferredAmount??S.withdrawnAmount??0);return{id:v.id,...S,type:Ne,status:$e,senderPhone:re,receiverPhone:pe,amount:Be,createdAt:P}}).filter(v=>!((v==null?void 0:v.type)==="report"||String((v==null?void 0:v.title)||"").includes("Ø¥ÙŠØµØ§Ù„ ØªØ³Ù„ÙŠÙ… ÙˆØ±Ø¯ÙŠØ©"))),g=new Set((vs||[]).map(v=>String(v.id||v.originalTransactionId||""))),x=u.filter(v=>!g.has(String(v.id||""))),y=v=>{var S;return String(v.transactionId||v.id||v.reference||((S=v.receipt)==null?void 0:S.reference)||`${new Date(v.createdAt).getTime()}`)},N=new Set,E=[];for(const v of x){const S=y(v);N.has(S)||(N.add(S),E.push(v))}return E},staleTime:6e4,gcTime:3e5,refetchOnWindowFocus:!1,refetchOnReconnect:!0});c.useEffect(()=>{const t=()=>{try{ws.refetch()}catch{}};return window.addEventListener("transaction-created",t),()=>{window.removeEventListener("transaction-created",t)}},[ws]),c.useEffect(()=>{const t=ws.data;if(t&&Array.isArray(t)){const s=$t.current,n=Date.now(),r=s.filter(d=>{const p=t.some(g=>g.id===d.id),m=d.reference?t.some(g=>g.reference===d.reference):!1,u=n-new Date(d.createdAt).getTime()>3e5;return!p&&!m&&!u});$t.current=r;const i=[...r,...t].sort((d,p)=>new Date(p.createdAt).getTime()-new Date(d.createdAt).getTime()),o=new Set,l=[];for(const d of i)o.has(d.id)||(o.add(d.id),l.push(d));yt(l)}},[ws.data]),c.useEffect(()=>{try{if(localStorage.setItem("commissionMode",xe?"add":"deduct"),a!=null&&a.uid){const t=`commissionMode_${a.uid}`;localStorage.setItem(t,xe?"add":"deduct")}}catch{}},[xe,a==null?void 0:a.uid]),c.useEffect(()=>{try{const t=new Set((Y||[]).filter(r=>String((r==null?void 0:r.status)||"")==="completed"&&(r==null?void 0:r.linkedDebtId)).map(r=>String(r.linkedDebtId)));if(t.size===0)return;const s=he.map(r=>{if(t.has(String(r.id))){const i=Number(r.amount||0),o=Number(r.paidAmount||0);if(r.status!=="paid"||o<i)return{...r,status:"paid",paidAmount:i}}return r});if(s.some((r,i)=>r!==he[i])){Ge(s),(async()=>await Dt(s))();try{a!=null&&a.uid&&s.filter((i,o)=>i!==he[o]&&i.status==="paid").forEach(i=>{try{ba.send(a.uid,`ØªÙ… Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙ† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø¹Ù…ÙŠÙ„ ${i.debtorName}: Ø§Ù„Ù…Ø¯ÙÙˆØ¹ ${Number(i.paidAmount||i.amount||0)} Ø¬Ù†ÙŠÙ‡`)}catch{}})}catch{}}}catch{}},[Y,he,a==null?void 0:a.uid]),c.useEffect(()=>{try{const t=a!=null&&a.uid?localStorage.getItem(`commissionMode_${a.uid}`):null,s=localStorage.getItem("commissionMode"),n=localStorage.getItem("commissionMode_default"),r=t??s??n;r&&wr(r==="add")}catch{}},[a==null?void 0:a.uid]);const[Nr,Ra]=c.useState(!1),[Bc,Uc]=c.useState(null),un=$.useRef(""),co=$.useRef(0);c.useEffect(()=>{const t=s=>{var r;if(Nr)return;try{const i=document.activeElement;if(i){const o=(r=i.tagName)==null?void 0:r.toLowerCase();if(o==="input"||o==="textarea"||o==="select"||o==="button"||i.isContentEditable===!0)return}}catch{}const n=Date.now();if(s.key==="Enter"){const i=(un.current||"").trim();un.current="",i&&(Uc(i),Ra(!0));return}s.key.length===1&&(n-(co.current||0)>100&&(un.current=""),un.current+=s.key,co.current=n)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[Nr]);const[Fc,$c]=c.useState(!1),[Vc,jr]=c.useState(!1),[zc,Ah]=c.useState(null);c.useEffect(()=>{if(!dr)return;const t=Fe(),s=parseFloat(Qe||"0")||0;let n=0;if(L==="transfer"){if((t==null?void 0:t.defaultTransferCommission)!=null){const i=Number(t.defaultTransferCommission)||0;n=Math.round(i*s/1e3*100)/100}else{const i=He&&He.trim()!==""?parseFloat(He):0;n=Math.max(0,i)}const r=s+n;ma((r||0).toString())}else{if((t==null?void 0:t.defaultWithdrawCommission)!=null){const i=Number(t.defaultWithdrawCommission)||0;n=Math.round(i*s/1e3*100)/100}else{const i=Ye&&Ye.trim()!==""?parseFloat(Ye):Math.round(s*.01*100)/100;n=Math.max(0,i)}const r=xe?s:Math.max(0,Math.round((s-n)*100)/100);ma((r||0).toString())}},[dr,Qe,He,Ye,D,xe,L]);const Fe=()=>{var s,n;let t=O.find(r=>r.id===D);if(!t)try{const r=localStorage.getItem(ll());if(r){const i=JSON.parse(r);if(Array.isArray(i)&&i.length>0){const l=localStorage.getItem(xa())||((s=i.find(d=>d.isDefault))==null?void 0:s.id)||((n=i[0])==null?void 0:n.id);t=i.find(d=>d.id===l)}}}catch{}return t};c.useLayoutEffect(()=>{try{const t=`wallets_${(a==null?void 0:a.uid)||"default"}`;let s=localStorage.getItem(t);if(!s){const n=Object.keys(localStorage).find(r=>r.startsWith("wallets_"));n&&(s=localStorage.getItem(n)||null)}if(s){const n=JSON.parse(s);if(Array.isArray(n)&&n.length>0){De(n);const r=localStorage.getItem(xa()),i=r&&n.find(o=>o.id===r)||n.find(o=>o.isDefault)||n[0];i&&(ms(i.id),Oa(i.phone))}}}catch(t){console.error("ØªÙ‡ÙŠØ¦Ø© ÙÙˆØ±ÙŠØ© Ù„Ù„Ù…Ø­Ø§ÙØ¸ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ ÙØ´Ù„Øª:",t)}},[]),c.useEffect(()=>{console.log("ğŸ” selectedWallet state changed to:",D)},[D]),c.useEffect(()=>{il()},[a==null?void 0:a.uid]),c.useEffect(()=>{em()},[]);const hn=Js({enabled:!!(a!=null&&a.uid),queryKey:["wallets",a==null?void 0:a.uid],queryFn:async()=>{const{merchantWalletService:t}=await F(async()=>{const{merchantWalletService:r}=await import("./index-bCWIXU_s.js").then(i=>i.cm);return{merchantWalletService:r}},__vite__mapDeps([0,1]),import.meta.url),s=await t.getByMerchantId(String((a==null?void 0:a.uid)||""));return(Array.isArray(s)?s:[]).filter(r=>r.isActive===!0).map(r=>({id:r.id,name:r.label||"Ù…Ø­ÙØ¸Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…",phone:r.msisdn,isDefault:!!r.isDefault,monthlyWithdrawalLimit:r.monthlyWithdrawalLimit??r.withdrawLimit??2e5,monthlyTransferLimit:r.monthlyTransferLimit??r.transferLimit??2e5,defaultTransferCommission:r.defaultTransferCommission!=null?Number(r.defaultTransferCommission):null,defaultWithdrawCommission:r.defaultWithdrawCommission!=null?Number(r.defaultWithdrawCommission):null}))},staleTime:6e4,gcTime:3e5,refetchOnReconnect:!0});c.useEffect(()=>{var s;const t=hn.data;if(t&&Array.isArray(t)){De(t);const n=localStorage.getItem(xa());if(!!!(D&&t.find(i=>i.id===D))){const i=n&&t.find(o=>o.id===n)?n:((s=t[0])==null?void 0:s.id)||"";if(i){ms(i);const o=t.find(l=>l.id===i);Oa(String((o==null?void 0:o.phone)||""))}}}},[hn.data]),c.useEffect(()=>{const t=s=>{const{cashBalance:n,walletBalances:r,newTransaction:i,limitUpdate:o,delta:l}=s.detail||{};if(l){const{amount:d,type:p,walletId:m,commission:u}=l,g=Number(d||0),x=Number(u||0);Oe(y=>{let N=0;p==="withdraw"?N=-g+x:(p==="send"||p==="transfer")&&(N=g+x);const E=y+N;try{const v=je();localStorage.setItem(v,String(E));const S=new Date().toISOString();if(localStorage.setItem(v+"_lastUpdated",S),a!=null&&a.uid){const P=`userData_${a.uid}`,z=localStorage.getItem(P),$e={...z?JSON.parse(z):{},cashBalance:E,lastUpdated:S};localStorage.setItem(P,JSON.stringify($e)),H(!0)}}catch{}return E}),m&&Me(y=>{const N=Number(y[m]||0);let E=0;p==="withdraw"?E=g:(p==="send"||p==="transfer")&&(E=-g);const v=N+E,S={...y,[m]:v};try{const P=Te();localStorage.setItem(P,JSON.stringify(S));const z=new Date().toISOString();if(localStorage.setItem(P+"_lastUpdated",z),a!=null&&a.uid){const Ne=`userData_${a.uid}`,$e=localStorage.getItem(Ne),pe={...$e?JSON.parse($e):{},walletBalances:S,lastUpdated:z};localStorage.setItem(Ne,JSON.stringify(pe)),H(!0)}}catch{}return S})}if(typeof n=="number"){Oe(n);try{const d=je();localStorage.setItem(d,String(n));const p=new Date().toISOString();if(localStorage.setItem(d+"_lastUpdated",p),a!=null&&a.uid){const m=`userData_${a.uid}`,u=localStorage.getItem(m),x={...u?JSON.parse(u):{},cashBalance:n,lastUpdated:p};localStorage.setItem(m,JSON.stringify(x)),H(!0)}}catch{}}if(r&&typeof r=="object"){Me(r);try{const d=Te();localStorage.setItem(d,JSON.stringify(r));const p=new Date().toISOString();if(localStorage.setItem(d+"_lastUpdated",p),a!=null&&a.uid){const m=`userData_${a.uid}`,u=localStorage.getItem(m),x={...u?JSON.parse(u):{},walletBalances:r,lastUpdated:p};localStorage.setItem(m,JSON.stringify(x)),H(!0)}}catch{}}if(o&&o.walletId===D&&za(d=>{if(!d)return d;const p=Number(o.amount||0),m=o.type==="transfer",u={...d};return m?(u.dailyTransferUsed=(u.dailyTransferUsed||0)+p,u.monthlyTransferUsed=(u.monthlyTransferUsed||0)+p):(u.dailyWithdrawUsed=(u.dailyWithdrawUsed||0)+p,u.monthlyWithdrawUsed=(u.monthlyWithdrawUsed||0)+p),u}),i){try{$t.current&&($t.current.some(d=>d.id===i.id)||$t.current.push(i))}catch{}yt(d=>d.some(p=>p.id===i.id)?d:[i,...d]),f({title:"ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø®Ø§Ø±Ø¬ÙŠØ©",description:"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±ØµØ¯Ø© ÙˆØ§Ù„Ø³Ø¬Ù„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­"});try{ws.refetch()}catch{}}};return window.addEventListener("dashboard:external-update",t),()=>window.removeEventListener("dashboard:external-update",t)},[D]);const[mo,qc]=c.useState(""),uo=(()=>{const t=mo.replace(/\D/g,"");return t?O.filter(s=>(s.phone||"").replace(/\D/g,"").includes(t)):O})(),[Kc,Th]=c.useState(null),[Jc,ho]=c.useState(!1),[Qc,pn]=c.useState(!1),[Yc,Hc]=c.useState(null),[_h,Gc]=c.useState([]),[Eh,kh]=c.useState([]),[Zc,bs]=c.useState(!1),[Sr,po]=c.useState("daily"),[vs,Ns]=c.useState([]),[Xc,Ph]=c.useState(!1),Pt=$.useRef(new Set);$.useRef(new Set);const ed=$.useRef([]);c.useEffect(()=>{ed.current=Y},[Y]);const Dr=async t=>{try{if(!a)return;const s=je(),n=Te(),r=localStorage.getItem(s),i=localStorage.getItem(n);let o=r?parseFloat(r):we,l=i?JSON.parse(i):{...ee};const d=Number(t.withdrawnAmount??t.sentAmount??t.transferredAmount??t.amount??0);if(t.type==="send"&&(t.fromWallet||D)){o-=d;const g=t.fromWallet||D;l[g]=(l[g]||0)+d}else if(t.type==="withdraw"&&(t.fromWallet||D)){o+=d;const g=t.fromWallet||D;l[g]=Math.max(0,(l[g]||0)-d)}Oe(o),Me(l);const p=new Date().toISOString();localStorage.setItem(s,o.toString()),localStorage.setItem(s+"_lastUpdated",p),localStorage.setItem(n,JSON.stringify(l)),localStorage.setItem(n+"_lastUpdated",p);const m={cashBalance:o,walletBalances:l,lastUpdated:new Date().toISOString()},u=`userData_${a==null?void 0:a.uid}`;localStorage.setItem(u,JSON.stringify(m));try{await K.updateUserData(a.uid,m),localStorage.removeItem(u),H(!1)}catch(g){console.warn("ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ø£Ø±ØµØ¯Ø© ÙÙŠ Firebase Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù (Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©):",g),H(!0)}try{const g=t.fromWallet||D,x=t.type==="send"?"transfer":"withdraw";await ja.rollbackUsage(g,d,x,t.createdAt)}catch(g){console.warn("ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù (Ù…Ø²Ø§Ù…Ù†Ø©):",g)}try{st.removeTransactionEffects(t,a.uid)}catch(g){console.warn("ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù (Ù…Ø²Ø§Ù…Ù†Ø©):",g)}}catch(s){console.warn("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø°Ù Ù…Ø­Ù„ÙŠÙ‹Ø§:",s)}},td=async t=>{try{const s=Y.find(l=>l.id===t);if(!s||!a)return;const n=String(t),r=String((s==null?void 0:s.transactionId)||(s==null?void 0:s.reference)||""),i=Pt.current.has(n)||r&&Pt.current.has(r),o=Y.filter(l=>l.id!==t);yt(o);try{await K.removeUserTransaction(a.uid,t),await Ks.permanentlyDeleteTransaction(t,a.uid)}catch(l){console.warn("ØªØ¹Ø°Ø± Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø¥ÙŠØµØ§Ù„:",l)}if(!i){Pt.current.add(n),r&&Pt.current.add(r),await Dr(s);try{a!=null&&a.uid&&K.removeLocalReceiptById(a.uid,t)}catch{}}f({title:"ØªÙ… Ø§Ù„Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§",description:"ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ ÙˆØ¹ÙƒØ³ ØªØ£Ø«ÙŠØ±Ø§ØªÙ‡ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±ØµØ¯Ø© ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯ ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±."}),pn(!1)}catch(s){console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø¥ÙŠØµØ§Ù„:",s),f({title:"Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¥ÙŠØµØ§Ù„",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù.",variant:"destructive"})}},ad=async t=>{try{const s=Y.find(n=>n.id===t);if(!s||!a)return;try{const n=it==null?void 0:it.planType;if(n===Ct.ZERO){const{dailyOperationCountService:r}=await F(async()=>{const{dailyOperationCountService:l}=await import("./dailyOperationCountService-Drxu6Okj.js");return{dailyOperationCountService:l}},__vite__mapDeps([68,0,1]),import.meta.url),i=s.type==="send"?"transfer":"withdraw";if(!(await r.checkAndIncrement(a.uid,i,5)).allowed){f({title:"ØªÙ… Ø¨Ù„ÙˆØº Ø­Ø¯ Ø¨Ø§Ù‚Ø© Ø§Ù„Ø²ÙŠØ±Ùˆ",description:"Ù…Ø³Ù…ÙˆØ­ Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5 ØªØ£ÙƒÙŠØ¯Ø§Øª ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ù„Ù„ØªØ­ÙˆÙŠÙ„/Ø§Ù„Ø³Ø­Ø¨. Ø¬Ø±Ù‘Ø¨ ØºØ¯Ù‹Ø§ Ø£Ùˆ Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"});return}}else if(n===Ct.TAHWEELA){const{dailyOperationCountService:r}=await F(async()=>{const{dailyOperationCountService:l}=await import("./dailyOperationCountService-Drxu6Okj.js");return{dailyOperationCountService:l}},__vite__mapDeps([68,0,1]),import.meta.url),i=s.type==="send"?"transfer":"withdraw";if(!(await r.checkAndIncrementCombined(a.uid,i,40)).allowed){f({title:"ØªÙ… Ø¨Ù„ÙˆØº Ø­Ø¯ Ø¨Ø§Ù‚Ø© ØªØ­ÙˆÙŠÙ„Ù‡",description:"Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø§Ù‚Ø© ØªØ³Ù…Ø­ Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 40 Ø¹Ù…Ù„ÙŠØ© ØªØ­ÙˆÙŠÙ„/Ø³Ø­Ø¨ ÙŠÙˆÙ…ÙŠØ§Ù‹.",variant:"destructive"});return}}}catch(n){console.warn("ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ:",n)}await It(ge(W,"userTransactions",t),{status:"completed",confirmedAt:new Date}),yt(n=>n.map(r=>r.id===t?{...r,status:"completed"}:r)),f({title:"ØªÙ… Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„",description:"ØªÙ… ÙˆØ³Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ÙƒÙ…ÙƒØªÙ…Ù„Ø©."}),pn(!1)}catch(s){console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¥ÙŠØµØ§Ù„:",s),f({title:"ÙØ´Ù„ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©.",variant:"destructive"})}};c.useEffect(()=>{if(!a)return;(async()=>{try{const s=ve(ne(W,"deletedTransactions"),Q("userId","==",a.uid),au("createdAt","desc"),su(50));(await fe(s)).docs.forEach(r=>{const i=r.data(),o=String((i==null?void 0:i.originalTransactionId)||""),l=String((i==null?void 0:i.transactionId)||""),d=String((i==null?void 0:i.reference)||""),p=o||l||d||String(r.id);p&&(Pt.current.has(p)||(Pt.current.add(p),yt(m=>{const u=m.find(g=>g.id===o);return u?((async()=>await Dr(u))(),m.filter(g=>g.id!==o)):m})))})}catch(s){console.warn("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©:",s)}})()},[a==null?void 0:a.uid]),c.useEffect(()=>{if(!a)return;(async()=>{try{const s=ge(W,"users",a.uid),n=await kt(s);if(!n.exists())return;const r=n.data();if(!(r!=null&&r.reportsData))return;try{await st.syncReportsDataFromFirebase(a.uid),Gc(Il())}catch(i){console.warn("ØªØ¹Ø°Ø± Ù…Ø²Ø§Ù…Ù†Ø© reportsData Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©:",i)}}catch(s){console.warn("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ users.reportsData:",s)}})()},[a==null?void 0:a.uid]);const[fo,sd]=c.useState(""),go=Uu(fo,300),[fn,xo]=c.useState(""),[gn,yo]=c.useState(""),[Ot,Oh]=c.useState(""),[Ir,Ma]=c.useState(!1),[wo,js]=c.useState(!1),[nd,ua]=c.useState(!1),[Pe,Cr]=c.useState(null),[pt,rd]=c.useState(null),[bo,ha]=c.useState(!1),[id,Ba]=c.useState(!1),[vo,od]=c.useState(""),[ld,Ar]=c.useState(!1),No=!1,[cd,Ss]=c.useState(!1),[dd,jo]=c.useState(!1),[md,Ds]=c.useState(!1),[ud,Is]=c.useState(!1),[hd,Cs]=c.useState(!1),[pd,So]=c.useState(!0),[As,fd]=c.useState(!1),[gd,xn]=c.useState(!1),[xd,Do]=c.useState(!1),[yn,yd]=c.useState(""),[Io,wd]=c.useState(!1),[bd,Tr]=c.useState(!1),[vd,Co]=c.useState(()=>{try{const t=a!=null&&a.uid?`dailyReportsLockEnabled_${a==null?void 0:a.uid}`:"dailyReportsLockEnabled";return(localStorage.getItem(t)??localStorage.getItem("dailyReportsLockEnabled"))==="true"}catch{return!1}}),[Nd,_r]=c.useState(!1);c.useEffect(()=>{try{const t=a!=null&&a.uid?`dailyReportsLockEnabled_${a==null?void 0:a.uid}`:"dailyReportsLockEnabled",s=localStorage.getItem(t)??localStorage.getItem("dailyReportsLockEnabled");Co(s==="true")}catch{}},[a==null?void 0:a.uid]);const[jd,Ua]=c.useState(!1),[Sd,Er]=c.useState(!1),[Dd,Ao]=c.useState(()=>{try{const t=a==null?void 0:a.uid,s=t?`debtsPinRequired_${t}`:"debtsPinRequired";return(localStorage.getItem(s)??localStorage.getItem("debtsPinRequired"))==="true"}catch{return!1}}),[Id,To]=c.useState(!1),[_o,Cd]=c.useState(null),[kr,Eo]=c.useState(""),[Pr,ko]=c.useState(""),[Or,Po]=c.useState(""),[Lt,Oo]=c.useState(null),[C,ta]=c.useState(null),[Ad,aa]=c.useState(!1),[Td,Ts]=c.useState(!1),[pa,Lo]=c.useState(null),[Wo,Lr]=c.useState(""),[Ae,Ro]=c.useState(null),[Lh,Wh]=c.useState(!1),[_d,Wr]=c.useState(!1),[Mo,Rr]=c.useState(""),[Mr,fa]=c.useState(!1),[Bo,Br]=c.useState(1),Ed=ye?10:20,Ur=$.useMemo(()=>he.slice(0,Bo*Ed),[he,Bo]);c.useEffect(()=>{Mr&&Br(1)},[Mr]);const wn=async()=>{if(se){f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†/Ø§Ù„Ø£Ø¬Ù„ ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"});return}try{const t=await xt.hasMasterPin(a==null?void 0:a.uid);Dd&&t?Er(!0):Ua(!0)}catch{Ua(!0)}};c.useEffect(()=>{try{const t=a==null?void 0:a.uid,s=t?`debtsPinRequired_${t}`:"debtsPinRequired",n=localStorage.getItem(s)??localStorage.getItem("debtsPinRequired");(n==="true"||n==="false")&&Ao(n==="true")}catch{}},[a==null?void 0:a.uid]),c.useEffect(()=>{const t=()=>{try{Gr()}catch{}};try{window.addEventListener("debtsUpdated",t)}catch{}return()=>{try{window.removeEventListener("debtsUpdated",t)}catch{}}},[a==null?void 0:a.uid,_,h==null?void 0:h.shopId]);const[kd,Fr]=c.useState(!1),[ft,$r]=c.useState([]),[Vr,Uo]=c.useState(""),[zr,Fo]=c.useState(""),[Fa,$o]=c.useState(""),[Vo,Pd]=c.useState(""),[Od,bn]=c.useState(!1),[Ld,zo]=c.useState(""),[qo,qr]=c.useState(""),[Ko,Kr]=c.useState(""),[Wd,vn]=c.useState(!1),[Rd,Jr]=c.useState(""),[Jo,Qr]=c.useState(""),[Md,$a]=c.useState(!1),[ga,_s]=c.useState(null),[ot,Es]=c.useState(null),[ks,Yr]=c.useState(""),[Bd,Va]=c.useState(!1),[Qo,Nn]=c.useState(0),[wt,sa]=c.useState(null),[na,Hr]=c.useState(""),[G,za]=c.useState(null),[Ud,Yo]=c.useState(""),Dt=async t=>{try{const s=JSON.stringify(t);localStorage.setItem(Os(),s);try{localStorage.setItem(ri(),s)}catch{}try{localStorage.setItem(ii(),Date.now().toString())}catch{}if(a!=null&&a.uid){try{localStorage.setItem(`debts_unsynced_${a.uid}`,"true")}catch{}const n=[];n.push(K.updateUserData(a.uid,{debts:t,debtsDeletedAt:null})),Promise.all(n).then(()=>{try{localStorage.removeItem(`debts_unsynced_${a.uid}`)}catch{}}).catch(r=>{console.error("ÙØ´Ù„ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†:",r),H(!0)})}}catch(s){console.error("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙˆÙ†:",s)}},Gr=async()=>{try{const t=Os(),s=ri(),n=ii(),r=localStorage.getItem(t),i=localStorage.getItem(s),o=localStorage.getItem(n),l=o?Number(o):0,d=m=>{if(!m)return null;try{const u=JSON.parse(m);return Array.isArray(u)?u.map(g=>{var x;return{...g,createdAt:(x=g.createdAt)!=null&&x.toDate?g.createdAt.toDate():new Date(g.createdAt),partialPayments:Array.isArray(g.partialPayments)?g.partialPayments.map(y=>{var N;return{amount:Number(y.amount)||0,paidAt:(N=y.paidAt)!=null&&N.toDate?y.paidAt.toDate():new Date(y.paidAt)}}):[]}}):[]}catch(u){return console.warn("ÙØ´Ù„ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø¯ÙŠÙˆÙ† localStorage:",u),null}};let p=d(r);if(!p||p.length===0){const m=d(i);if(m&&m.length>0){p=m,Ge(m);try{localStorage.setItem(Os(),JSON.stringify(m)),localStorage.removeItem(s)}catch(u){console.warn("ØªØ¹Ø°Ø± ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ† Ù…Ø­Ù„ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ:",u)}}}if(p&&p.length>0&&Ge(p),a!=null&&a.uid)try{const m=`debts_unsynced_${a.uid}`,u=localStorage.getItem(m)==="true",g=await kt(ge(W,"users",a.uid)),x=[];try{const y=query(ne(W,"debts"),Q("userId","==",a.uid));(await fe(y)).forEach(E=>{var S;const v=E.data();x.push({id:E.id,...v,amount:Number(v.amount||0),paidAmount:Number(v.paidAmount||0),createdAt:(S=v.createdAt)!=null&&S.toDate?v.createdAt.toDate():new Date(v.createdAt||Date.now()),partialPayments:Array.isArray(v.partialPayments)?v.partialPayments:[]})})}catch(y){console.warn("Failed to fetch from debts collection:",y)}if(g.exists()){const y=g.data();let N=y.debts&&Array.isArray(y.debts)?y.debts.map(S=>{var P;return{...S,amount:Number(S.amount||0),paidAmount:Number(S.paidAmount||0),createdAt:(P=S.createdAt)!=null&&P.toDate?S.createdAt.toDate():new Date(S.createdAt),partialPayments:Array.isArray(S.partialPayments)?S.partialPayments.map(z=>{var Ne;return{amount:Number(z.amount)||0,paidAt:(Ne=z.paidAt)!=null&&Ne.toDate?z.paidAt.toDate():new Date(z.paidAt)}}):[]}}):[];if(!!y.debtsDeletedAt){Ge([]);try{localStorage.setItem(t,JSON.stringify([])),localStorage.setItem(s,JSON.stringify([]))}catch{}return}if(((N==null?void 0:N.length)||0)>0)if(u)console.log("âš ï¸ ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø¯ÙŠÙˆÙ† ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ØŒ Ø³ÙŠØªÙ… ØªØ¬Ø§Ù‡Ù„ Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø­Ø§Ø¨Ø© Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.");else{Ge(N);try{localStorage.setItem(t,JSON.stringify(N))}catch{}}}else if(x.length>0){Ge(x);try{localStorage.setItem(t,JSON.stringify(x))}catch{}}else p&&p.length>0}catch(m){console.warn("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ† Ù…Ù† FirebaseØŒ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ù„ÙŠ:",m)}}catch(t){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ†:",t)}};c.useEffect(()=>{try{window.exportDebts=()=>{try{return JSON.stringify(he||[])}catch{return"[]"}},window.importDebts=async t=>{try{const s=JSON.parse(t);if(!Array.isArray(s))throw new Error("ØµÙŠØºØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø© â€” ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…ØµÙÙˆÙØ©");return await Dt(s),{ok:!0,count:s.length}}catch(s){return console.error("ÙØ´Ù„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙˆÙ†:",s),{ok:!1,error:String(s)}}},window.fixWalletsForCurrentUser=async t=>{try{if(!(a!=null&&a.uid))throw new Error("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");return await(await F(async()=>{const{merchantWalletService:n}=await import("./index-bCWIXU_s.js").then(r=>r.cm);return{merchantWalletService:n}},__vite__mapDeps([0,1]),import.meta.url)).merchantWalletService.reassignByMsisdns(t,a.uid)}catch(s){return console.error("ÙØ´Ù„ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ:",s),{updated:0,failed:(t==null?void 0:t.length)||0,error:String(s)}}}}catch{}},[he,a==null?void 0:a.uid]),c.useEffect(()=>{a!=null&&a.uid&&Gr()},[a==null?void 0:a.uid]),c.useEffect(()=>{if(!(a!=null&&a.uid))return;const t=zm(ge(W,"users",a.uid),async s=>{var n;if(s.exists()){const r=s.data(),i=r.isActive===!0;r.subscription&&Gi(r.subscription),Tc(r.branchPackage||null);const o=await Kl.checkTrialValidity(a.uid),l=o.isValid&&!o.isExpired;Xt(i||l),Qi(l),Yi(o.hoursRemaining),Hi(o.hasUsedTrial);const d=!i&&!l;ea(d),d&&(console.log("â›” User not active, redirecting to pending approval..."),T("/user/pending-approval",{replace:!0})),console.log("ğŸ”„ ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Real-time):",{isActive:i,isOnTrial:l,plan:(n=r.subscription)==null?void 0:n.planType,showModal:d})}});return()=>t()},[a==null?void 0:a.uid]);const Fd=async()=>{if(a!=null&&a.uid)try{Zi(!0);const t=await tc(a.uid);Gi(t)}catch(t){console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:",t)}finally{Zi(!1)}},[Rh,Mh]=c.useState(!1),[$d,Zr]=c.useState(!1),[we,Oe]=c.useState(0),[ee,Me]=c.useState({}),[Vd,Ho]=c.useState(!1),[zd,Go]=c.useState(!1),[qd,Xr]=c.useState(!1),[Kd,jn]=c.useState(!1),[Zo,ei]=c.useState(""),[Jd,Ps]=c.useState(!1),[Qd,Sn]=c.useState(!1),[ti,Dn]=c.useState(""),[Yd,ai]=c.useState(!1),[In,Xo]=c.useState(""),[Cn,el]=c.useState(""),[An,tl]=c.useState(""),[al,sl]=c.useState(!1),[si,ni]=c.useState(!1),[Hd,nl]=c.useState(!1),[rl,Gd]=c.useState([]);c.useEffect(()=>{(async()=>{try{if(!(a!=null&&a.uid)||!si)return;try{await $s.trimToMaxCount(a.uid,30)}catch{}const t=await $s.getByUser(a.uid,30);Gd(t)}catch{}})()},[a==null?void 0:a.uid,si]);const Te=()=>{const t=_||(h==null?void 0:h.shopId)||"main";return`walletBalances_${(a==null?void 0:a.uid)||"default"}_${t}`},je=()=>{const t=_||(h==null?void 0:h.shopId)||"main";return`cashBalance_${(a==null?void 0:a.uid)||"default"}_${t}`},Os=()=>{const t=_||(h==null?void 0:h.shopId)||"main";return`debts_${(a==null?void 0:a.uid)||"default"}_${t}`},Zd=()=>{const t=_||(h==null?void 0:h.shopId)||"main";return`customers_${(a==null?void 0:a.uid)||"default"}_${t}`},ri=()=>`debts_default_${_||(h==null?void 0:h.shopId)||"main"}`,ii=()=>{const t=_||(h==null?void 0:h.shopId)||"main";return`debts_last_write_${(a==null?void 0:a.uid)||"default"}_${t}`},oi=()=>`shopExpenses_${_||(h==null?void 0:h.shopId)||(a==null?void 0:a.uid)||"default"}`,il=()=>{try{const t=localStorage.getItem(oi());if(t){const s=JSON.parse(t);rr(s.map(n=>({...n,createdAt:new Date(n.createdAt)})))}}catch(t){console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø­Ù„ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†:",t)}},ol=async t=>{try{localStorage.setItem(oi(),JSON.stringify(t)),rr(t)}catch(s){console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø­Ù„ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ†:",s)}},Xd=async t=>{try{const s=rn.filter(n=>n.id!==t);await ol(s);try{if(a!=null&&a.uid&&t){const{doc:n,deleteDoc:r}=await F(async()=>{const{doc:l,deleteDoc:d}=await import("./index-bCWIXU_s.js").then(p=>p.ck);return{doc:l,deleteDoc:d}},__vite__mapDeps([0,1]),import.meta.url),{db:i}=await F(async()=>{const{db:l}=await import("./index-bCWIXU_s.js").then(d=>d.cl);return{db:l}},__vite__mapDeps([0,1]),import.meta.url),o=n(i,"shop_expenses",t);await r(o)}}catch(n){console.warn("ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø© Ø§Ù„Ø¢Ù†ØŒ ØªÙ… Ø§Ù„Ø­Ø°Ù Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØ³ÙŠØ¨Ù‚Ù‰ Ù…Ø®Ø²Ù‘Ù†Ù‹Ø§ Ø¯ÙˆÙ† Ù‡Ø°Ø§ Ø§Ù„Ø¥ÙŠØµØ§Ù„:",n)}f({title:"ØªÙ… Ø§Ù„Ø­Ø°Ù",description:"ØªÙ… Ø­Ø°Ù Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ù…ØµØ±ÙˆÙ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§."})}catch(s){console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ù…ØµØ±ÙˆÙ:",s),f({title:"ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù",description:"ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ø¥ÙŠØµØ§Ù„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",variant:"destructive"})}};$.useEffect(()=>{let t;return(async()=>{try{if(!(a!=null&&a.uid)){il();return}const{collection:s,query:n,where:r,getDocs:i}=await F(async()=>{const{collection:g,query:x,where:y,getDocs:N}=await import("./index-bCWIXU_s.js").then(E=>E.ck);return{collection:g,query:x,where:y,getDocs:N}},__vite__mapDeps([0,1]),import.meta.url),{db:o}=await F(async()=>{const{db:g}=await import("./index-bCWIXU_s.js").then(x=>x.cl);return{db:g}},__vite__mapDeps([0,1]),import.meta.url),l=_||(h==null?void 0:h.shopId),d=l?n(s(o,"shop_expenses"),r("shopId","==",l)):n(s(o,"shop_expenses"),r("userId","==",a.uid)),u=(await i(d)).docs.map(g=>{var N;const x=g.data(),y=(N=x.createdAt)!=null&&N.toDate?x.createdAt.toDate():x.createdAt?new Date(x.createdAt):new Date;return{id:g.id,name:String(x.name||""),amount:Number(x.amount||0),notes:x.notes?String(x.notes):void 0,source:x.source==="wallet"?"wallet":"cash",walletId:x.walletId?String(x.walletId):void 0,createdAt:y}}).sort((g,x)=>{const y=g.createdAt instanceof Date?g.createdAt.getTime():0;return(x.createdAt instanceof Date?x.createdAt.getTime():0)-y});rr(u);try{localStorage.setItem(oi(),JSON.stringify(u))}catch{}}catch(s){console.error("Ø®Ø·Ø£ ÙÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø­Ù„ Ù…Ù† Firestore:",s)}})(),()=>t==null?void 0:t()},[a==null?void 0:a.uid,h==null?void 0:h.shopId,_]);const Tn=()=>`deficiencies_${_||(h==null?void 0:h.shopId)||(a==null?void 0:a.uid)||"default-shop"}`,em=()=>{try{const t=Tn(),s=`deficiencies_${(a==null?void 0:a.uid)||"default"}`;if(s!==t){const r=localStorage.getItem(s),i=localStorage.getItem(t);if(r)try{const o=JSON.parse(r)||[],l=i?JSON.parse(i):[],d=Array.isArray(l)?[...l]:[],p=(m,u)=>m.some(g=>(g==null?void 0:g.id)&&(u==null?void 0:u.id)&&String(g.id)===String(u.id)||String((g==null?void 0:g.name)||"")===String((u==null?void 0:u.name)||"")&&String((g==null?void 0:g.status)||"pending")===String((u==null?void 0:u.status)||"pending"));if(Array.isArray(o))for(const m of o)p(d,m)||d.push(m);localStorage.setItem(t,JSON.stringify(d));try{localStorage.removeItem(s)}catch{}}catch{}}const n=localStorage.getItem(t);if(n){const r=JSON.parse(n);Pa(r.map(i=>({...i,createdAt:new Date(i.createdAt)})))}}catch(t){console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ÙˆØ§Ù‚Øµ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†:",t)}},li=async t=>{try{localStorage.setItem(Tn(),JSON.stringify(t)),Pa(t)}catch(s){console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù†ÙˆØ§Ù‚Øµ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ†:",s)}};$.useEffect(()=>{(async()=>{try{if(!(a!=null&&a.uid))return;const{collection:s,query:n,where:r,orderBy:i,getDocs:o}=await F(async()=>{const{collection:g,query:x,where:y,orderBy:N,getDocs:E}=await import("./index-bCWIXU_s.js").then(v=>v.ck);return{collection:g,query:x,where:y,orderBy:N,getDocs:E}},__vite__mapDeps([0,1]),import.meta.url),{db:l}=await F(async()=>{const{db:g}=await import("./index-bCWIXU_s.js").then(x=>x.cl);return{db:g}},__vite__mapDeps([0,1]),import.meta.url),d=_||(h==null?void 0:h.shopId)||a.uid||"default-shop",p=n(s(l,"deficiencies"),r("shopId","==",d),i("createdAt","desc")),u=(await o(p)).docs.map(g=>{var N;const x=g.data(),y=(N=x.createdAt)!=null&&N.toDate?x.createdAt.toDate():x.createdAt?new Date(x.createdAt):new Date;return{id:g.id,name:String(x.name||""),quantity:Number(x.quantity||1),status:x.status==="purchased"?"purchased":"pending",createdAt:y}});Pa(u);try{localStorage.setItem(Tn(),JSON.stringify(u))}catch{}}catch(s){console.warn("ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ù†ÙˆØ§Ù‚Øµ Ù…Ù† Firestore:",s)}})()},[a==null?void 0:a.uid,h==null?void 0:h.shopId,_]);const ci=async t=>{try{localStorage.setItem(Zd(),JSON.stringify(t)),$r(t),a!=null&&a.uid&&await K.updateUserData(a.uid,{customers:t})}catch(s){console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ†:",s)}},tm=async()=>{try{if(a!=null&&a.uid){const t=await kt(ge(W,"users",a.uid));if(t.exists()){const s=t.data();if(s.customers&&Array.isArray(s.customers)){const n=s.customers.map(r=>{var i;return{...r,createdAt:(i=r.createdAt)!=null&&i.toDate?r.createdAt.toDate():new Date(r.createdAt)}});$r(n);return}}}$r([])}catch(t){console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† Firestore:",t)}},di=()=>{const t=_||(h==null?void 0:h.shopId)||"main";return`transactions_${(a==null?void 0:a.uid)||"default"}_${t}`},ll=()=>{const t=_||(h==null?void 0:h.shopId)||"main";return`wallets_${(a==null?void 0:a.uid)||"default"}_${t}`},xa=()=>{const t=_||(h==null?void 0:h.shopId)||"main";return`selectedWallet_${(a==null?void 0:a.uid)||"default"}_${t}`},cl=t=>{var i;const s=String((t==null?void 0:t.transactionId)||(t==null?void 0:t.id)||""),n=String((t==null?void 0:t.reference)||(t==null?void 0:t.transactionReference)||((i=t==null?void 0:t.receipt)==null?void 0:i.reference)||""),r=new Date((t==null?void 0:t.createdAt)||0).getTime();return s||n||`${n||"ref"}-${r}`},{data:mi,refetch:Bh}=Js({queryKey:["userTransactions",a==null?void 0:a.uid],queryFn:async()=>{if(!(a!=null&&a.uid))return[];const{collection:t,query:s,where:n,orderBy:r,limit:i,getDocs:o}=await F(async()=>{const{collection:m,query:u,where:g,orderBy:x,limit:y,getDocs:N}=await import("./index-bCWIXU_s.js").then(E=>E.ck);return{collection:m,query:u,where:g,orderBy:x,limit:y,getDocs:N}},__vite__mapDeps([0,1]),import.meta.url),{db:l}=await F(async()=>{const{db:m}=await import("./index-bCWIXU_s.js").then(u=>u.cl);return{db:m}},__vite__mapDeps([0,1]),import.meta.url),d=s(t(l,"userTransactions"),n("userId","==",a.uid),r("createdAt","desc"),i(100));return(await o(d)).docs.map(m=>{var S;const u=m.data(),g=(S=u.createdAt)!=null&&S.toDate?u.createdAt.toDate():new Date(u.createdAt),x=u.txnType==="send"?"send":u.txnType==="receive"?"withdraw":u.type||"withdraw",y=u.status==="confirmed"?"completed":u.status||"completed",N=u.senderMsisdn||u.senderPhone||"",E=u.receiverMsisdn||u.receiverPhone||"",v=Number(u.amount??u.transferredAmount??u.withdrawnAmount??0);return{id:m.id,...u,type:x,status:y,senderPhone:N,receiverPhone:E,amount:v,createdAt:g,provider:u.provider||void 0}})},enabled:!!(a!=null&&a.uid),staleTime:1e3*60*5,gcTime:1e3*60*10});c.useEffect(()=>{if(mi){const s=mi.filter(l=>!((l==null?void 0:l.type)==="report"||String((l==null?void 0:l.title)||"").includes("Ø¥ÙŠØµØ§Ù„ ØªØ³Ù„ÙŠÙ… ÙˆØ±Ø¯ÙŠØ©"))),n=new Set((vs||[]).map(l=>String(l.id||l.originalTransactionId||""))),r=s.filter(l=>!n.has(String(l.id||""))),i=new Set,o=[];for(const l of r){const d=cl(l);i.has(d)||(i.add(d),o.push(l))}yt(o)}},[mi,vs]),c.useEffect(()=>{if(!(a!=null&&a.uid))return;let t=!0;return(async()=>{try{const{collection:n,query:r,where:i,getDocs:o,orderBy:l,limit:d}=await F(async()=>{const{collection:g,query:x,where:y,getDocs:N,orderBy:E,limit:v}=await import("./index-bCWIXU_s.js").then(S=>S.ck);return{collection:g,query:x,where:y,getDocs:N,orderBy:E,limit:v}},__vite__mapDeps([0,1]),import.meta.url),{db:p}=await F(async()=>{const{db:g}=await import("./index-bCWIXU_s.js").then(x=>x.cl);return{db:g}},__vite__mapDeps([0,1]),import.meta.url),m=r(n(p,"deletedTransactions"),i("userId","==",a.uid),l("createdAt","desc"),d(50)),u=await o(m);if(!t)return;u.docs.forEach(g=>{const x=g.data(),y=String((x==null?void 0:x.originalTransactionId)||""),N=String((x==null?void 0:x.transactionId)||""),E=String((x==null?void 0:x.reference)||""),v=y||N||E||String(g.id);v&&(Pt.current.has(v)||(Pt.current.add(v),yt(S=>{const P=S.find(z=>z.id===y);return P?((async()=>await Dr(P))(),S.filter(z=>z.id!==y)):S})))})}catch(n){console.warn("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©:",n)}})(),()=>{t=!1}},[a==null?void 0:a.uid]);const[ui,_n]=c.useState(""),[gt,dl]=c.useState(""),bt=$.useMemo(()=>{const t=it;if(!t)return!1;const s=qm(t),n=t.planType??t.plan??null,r=typeof n=="string"?n.toLowerCase():null,i=r==="monthly"||r==="quarterly"||r==="yearly"||r==="lifetime"||n===Ct.MONTHLY||n===Ct.QUARTERLY||n===Ct.YEARLY||n===Ct.LIFETIME;return s&&i},[it]),se=$.useMemo(()=>{var r,i;const t=it;if(!t)return!1;const s=((r=t.subscription)==null?void 0:r.planType)??((i=t.subscription)==null?void 0:i.plan)??t.planType??t.plan??null,n=typeof s=="string"?s.toLowerCase():null;return s===Ct.ZERO||n==="zero"},[it]),ue=$.useMemo(()=>{var r,i;const t=it;if(!t)return!1;const s=((r=t.subscription)==null?void 0:r.planType)??((i=t.subscription)==null?void 0:i.plan)??t.planType??t.plan??null,n=typeof s=="string"?String(s).trim().toLowerCase():null;return s===Ct.TAHWEELA||n==="tahweela"||n==="ØªØ­ÙˆÙŠÙ„Ù‡"},[it]),am=()=>{if(!bt){f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª: Ø´Ù‡Ø±ÙŠØŒ Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØŒ Ø³Ù†ÙˆÙŠØŒ ÙˆÙ…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©. ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§ÙƒÙƒ.",variant:"destructive"});return}qe(!0)},[Uh,Fh]=c.useState(!1),[sm,nm]=c.useState(!1),[rm,im]=c.useState(!1),[om,lm]=c.useState(!1),[cm,Ls]=c.useState(!1),[ya,En]=c.useState(""),[Ws,kn]=c.useState(""),[ml,Pn]=c.useState(!1),[Rs,Ms]=c.useState(null),[hi,On]=c.useState(""),[dm,ul]=c.useState(!1),[$h,Vh]=c.useState(!1),[mm,Ln]=c.useState(!1),[hl,pi]=c.useState(""),[pl,fi]=c.useState(""),[fl,gl]=c.useState(!1);c.useEffect(()=>{const t=s=>{var i,o;const n=(i=s.detail)==null?void 0:i.action,r=((o=s.detail)==null?void 0:o.payload)||{};if(console.log("ğŸ”” Dashboard Navigation Action:",n,r),n==="profile-settings")_e(!0);else if(n==="debts")wn();else if(n==="sales")se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):Ra(!0);else if(n==="maintenance")se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø§Ù„ØµÙŠØ§Ù†Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):Is(!0);else if(n==="credit-cards")se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"ÙƒØ±ÙˆØª Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù† ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):Ds(!0);else if(n==="shop-expenses")se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø­Ù„ ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):xt.hasMasterPin()?Ea(!0):ca(!0);else if(n==="deficiencies")se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø§Ù„Ù†ÙˆØ§Ù‚Øµ ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):fs(!0);else if(n==="installment")se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø³ÙŠØ· ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©.",variant:"destructive"}):Ss(!0);else if(n==="cashier-shift")!bt||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"ÙˆØ±Ø¯ÙŠØ© Ø§Ù„ÙƒØ§Ø´ÙŠØ± Ù…ØªØ§Ø­Ø© Ù„Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª: Ø´Ù‡Ø±ÙŠØŒ Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØŒ Ø³Ù†ÙˆÙŠØŒ ÙˆÙ…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©.",variant:"destructive"}):qe(!0);else if(n==="machine-daily")!bt||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ù…ÙƒÙ†Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª: Ø´Ù‡Ø±ÙŠØŒ Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØŒ Ø³Ù†ÙˆÙŠØŒ ÙˆÙ…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©.",variant:"destructive"}):Cs(!0);else if(n==="branch-management")(Je==null?void 0:Je.status)==="active"?Mt(!0):Ht(!0);else if(n==="transaction-section"){const l=document.getElementById("transaction-section");if(l){const d=r.skipAnimation?"auto":"smooth";l.scrollIntoView({behavior:d})}r.transactionType&&br(r.transactionType),r.startNewTransaction&&(xs(""),La(""),cn(""),dn(""),console.log("ğŸ”’ Starting new transaction via event"))}};return window.addEventListener("dashboard-navigation-action",t),()=>window.removeEventListener("dashboard-navigation-action",t)},[O,ue,Je,se,bt]);const xl=async()=>{var t;if(a!=null&&a.uid)try{const s=`userData_${a.uid}`,n=localStorage.getItem(s),r=`debts_unsynced_${a.uid}`,i=localStorage.getItem(Os()),o=localStorage.getItem(r)==="true";if(n){const l=JSON.parse(n);console.log("ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ù…Ø¹ Firebase...",l);const d={lastSynced:new Date().toISOString()};typeof l.cashBalance=="number"&&(d.cashBalance=l.cashBalance),l.walletBalances&&typeof l.walletBalances=="object"&&(d.walletBalances=l.walletBalances),await K.updateUserData(a.uid,d),localStorage.removeItem(s),H(!1),console.log("âœ… ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©")}else console.log("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ© ØªØ­ØªØ§Ø¬ Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©");if(o&&i)try{const l=JSON.parse(i)||[],d=v=>v instanceof Date?v:typeof(v==null?void 0:v.toDate)=="function"?v.toDate():v?new Date(String(v)):new Date,p=v=>(Array.isArray(v)?v:[]).map(S=>({...S,amount:Number(S.amount||0),paidAmount:Number(S.paidAmount||0),createdAt:d(S.createdAt),partialPayments:Array.isArray(S.partialPayments)?S.partialPayments.map(P=>({amount:Number(P.amount||0),paidAt:d(P.paidAt)})):[]})),m=await kt(ge(W,"users",a.uid)),u=m.exists()?((t=m.data())==null?void 0:t.debts)||[]:[],g=p(u),x=p(l),y={};for(const v of g)y[String(v.id||"")]=v;const N=[],E=new Set;for(const v of x){const S=String(v.id||""),P=y[S];if(P){const z=Number(P.paidAmount||0)+(Array.isArray(P.partialPayments)?P.partialPayments.reduce((Be,Ve)=>Be+Number(Ve.amount||0),0):0),Ne=Number(v.paidAmount||0)+(Array.isArray(v.partialPayments)?v.partialPayments.reduce((Be,Ve)=>Be+Number(Ve.amount||0),0):0),$e=String(P.status||"pending"),re=String(v.status||"pending"),pe=$e==="paid"||z>=Number(P.amount||0)?P:re==="paid"?{...P,paidAmount:Number(v.paidAmount||0),partialPayments:v.partialPayments,status:"paid"}:Ne>z?{...P,paidAmount:Number(v.paidAmount||0),partialPayments:v.partialPayments,status:Ne>=Number(P.amount||0)?"paid":"pending"}:P;N.push(pe),E.add(S)}else N.push(v),E.add(S)}for(const v of g){const S=String(v.id||"");E.has(S)||N.push(v)}await K.updateUserData(a.uid,{debts:N});try{localStorage.removeItem(r)}catch{}H(!1)}catch{H(!0)}}catch(s){console.error("âŒ ÙØ´Ù„ ÙÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:",s),f({title:"ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…",variant:"destructive"})}},[yl,Wn]=c.useState({keepLastCount:30,intervalDays:7,lastResetAt:null});c.useEffect(()=>{(async()=>{if(a!=null&&a.uid)try{const s=await K.getUserData(a.uid),n=(s==null?void 0:s.recentReset)||{},r=Number(n==null?void 0:n.keepLastCount)>0?Number(n.keepLastCount):30,i=Number(n==null?void 0:n.intervalDays)>0?Number(n.intervalDays):7,o=m=>m instanceof Date?m:typeof(m==null?void 0:m.toDate)=="function"?m.toDate():m?new Date(String(m)):null,l=n!=null&&n.lastResetAt?o(n.lastResetAt):null,d=new Date;!l||d.getTime()-l.getTime()>=i*24*60*60*1e3?(await K.updateUserData(a.uid,{recentReset:{keepLastCount:r,intervalDays:i,lastResetAt:d}}),Wn({keepLastCount:r,intervalDays:i,lastResetAt:d})):Wn({keepLastCount:r,intervalDays:i,lastResetAt:l})}catch{Wn({keepLastCount:30,intervalDays:7,lastResetAt:null})}})()},[a==null?void 0:a.uid]);const wl=$.useMemo(()=>{const t=Y||[],s=l=>l instanceof Date?l:typeof(l==null?void 0:l.toDate)=="function"?l.toDate():new Date(String(l)),n=new Date,r=new Date(n.getFullYear(),n.getMonth(),1),i=new Date(n.getFullYear(),n.getMonth()+1,1);return[...t].sort((l,d)=>s(d.createdAt).getTime()-s(l.createdAt).getTime()).filter(l=>{const d=s(l.createdAt);return d>=r&&d<i})},[Y]),um=$.useMemo(()=>{const t=Y||[],s=l=>l instanceof Date?l:typeof(l==null?void 0:l.toDate)=="function"?l.toDate():new Date(String(l)),n=new Date,r=new Date(n.getFullYear(),n.getMonth(),1),i=new Date(n.getFullYear(),n.getMonth()+1,1),o=t.filter(l=>{const d=s(l.createdAt);return d>=r&&d<i}).length;return Math.max(0,((Y==null?void 0:Y.length)||0)-o)},[Y==null?void 0:Y.length]),Rn=$.useMemo(()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1),n=new Date(t.getFullYear(),t.getMonth()+1,1),r={};for(const o of Y){const l=new Date(o.createdAt||0);if(!(l>=s&&l<n))continue;const d=String(o.type||o.txnType||"").toLowerCase();if(!(d==="send"||d==="withdraw"||d==="transfer"))continue;const p=String(o.receiverPhone||o.senderPhone||"").trim();if(!p)continue;const m=Nt(p),u=Number(o.amount||o.withdrawnAmount||o.sentAmount||0)||0;r[m]||(r[m]={phone:m,count:0,total:0}),r[m].count+=1,r[m].total+=u}return Object.values(r).sort((o,l)=>l.count!==o.count?l.count-o.count:l.total-o.total).slice(0,10)},[Y]),hm=t=>{const s=Nt(String(t));return s.startsWith("+20")?"20"+s.slice(3):s.startsWith("0")?"20"+s.slice(1):s.replace(/[^0-9]/g,"")},pm=t=>{const s=hm(t.phone),n=`Ø¹Ù…ÙŠÙ„ VIP Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±
Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª: ${t.count}
Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${t.total} Ø¬Ù†ÙŠÙ‡`,r=`https://wa.me/${s}?text=${encodeURIComponent(n)}`;try{window.open(r,"_blank")}catch{}};c.useEffect(()=>{(async()=>{try{if(!(a!=null&&a.uid))return;const t=`${new Date().getFullYear()}-${new Date().getMonth()+1}`;await K.updateUserData(a.uid,{vipTop10:Rn,vipMonthTag:t})}catch{}})()},[a==null?void 0:a.uid,Rn]);async function bl(){const t=new Date,s=new Intl.DateTimeFormat("ar-EG",{timeZone:"Africa/Cairo",year:"numeric",month:"2-digit",day:"2-digit"}).format(t),n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59,999),i=(Y||[]).filter(y=>{const N=new Date(y.createdAt||0);return N>=n&&N<=r}),o=i.length,l=i.filter(y=>String(y.type||y.txnType||"").toLowerCase()==="withdraw"||String(y.type||"").toLowerCase()==="receive").reduce((y,N)=>y+(N.withdrawnAmount!=null?Number(N.withdrawnAmount):Number(N.amount||0)),0),d=i.filter(y=>String(y.type||y.txnType||"").toLowerCase()==="send"||String(y.type||"").toLowerCase()==="transfer").reduce((y,N)=>y+(N.sentAmount!=null?Number(N.sentAmount):Number(N.amount||0)),0);let p=0;try{p=i.reduce((y,N)=>y+st.calculateTransactionProfit(N),0)}catch{}let m=0;try{const y=new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Cairo"}).format(t),N=ve(ne(W,"dailySales"),Q("userId","==",(a==null?void 0:a.uid)||""));m=(await fe(N)).docs.map(S=>S.data()).filter(S=>String(S.date||y)===y).reduce((S,P)=>S+Number(P.sellingPrice||P.price||0)*Number(P.quantity||1),0)}catch{}let u=0;try{u=(he||[]).filter(N=>String(N.status||"")==="pending").reduce((N,E)=>{const v=Number(E.paidAmount||0)+(Array.isArray(E.partialPayments)?E.partialPayments:[]).reduce((S,P)=>S+Number(P.amount||0),0);return N+Math.max(0,Number(E.amount||0)-v)},0)}catch{}let g="";try{const y=_||(h==null?void 0:h.shopId)||null,N=y?ve(ne(W,"deficiencies"),Q("shopId","==",y)):ve(ne(W,"deficiencies"),Q("userId","==",(a==null?void 0:a.uid)||""));g=(await fe(N)).docs.map(P=>P.data()).filter(P=>String(P.status||"pending")==="pending").slice(0,10).map((P,z)=>`${z+1}- ${String(P.name||P.productName||"Ø¹Ù†ØµØ±")} Ã— ${Number(P.quantity||P.qty||0)}`).join(`
`)}catch{}return[`ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ - ${s}`,`Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª: ${o}`,`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø§Øª: ${l} Ø¬Ù†ÙŠÙ‡`,`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${d} Ø¬Ù†ÙŠÙ‡`,`Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: ${p} Ø¬Ù†ÙŠÙ‡`,`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø§ÙƒØ³Ø³ÙˆØ§Ø±: ${m} Ø¬Ù†ÙŠÙ‡`,`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†: ${u} Ø¬Ù†ÙŠÙ‡`,"Ù†ÙˆØ§Ù‚Øµ Ø§Ù„Ø§ÙƒØ³Ø³ÙˆØ§Ø±:",g||"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù…Ø³Ø¬Ù„Ø©"].join(`
`)}const vl=$.useCallback(()=>{let t=wl;const s=go.trim();if(s&&(t=t.filter(n=>{const r=n;return String(r.type||"").toLowerCase()==="cash_addition"||String(r.txnType||"").toLowerCase()==="cash_addition"||String(r.title||"").includes("Ø¥ÙŠØµØ§Ù„ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©")?!0:n.senderPhone&&n.senderPhone.includes(s)||n.receiverPhone&&n.receiverPhone.includes(s)})),fn){const n=new Date(fn);t=t.filter(r=>{const i=new Date(r.createdAt);if(gn){const[o,l]=gn.split(":"),d=new Date(n);d.setHours(parseInt(o),parseInt(l),0,0);const p=new Date(d);return p.setHours(p.getHours()+1),i>=d&&i<p}else return i.toDateString()===n.toDateString()})}try{t=[...t].sort((n,r)=>{const i=new Date(n.createdAt||0).getTime();return new Date(r.createdAt||0).getTime()-i})}catch{}return t},[wl,go,fn,gn]),Nl=async()=>{if(se||ue){f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©.",variant:"destructive"});return}if(!(a!=null&&a.uid)){f({title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©",description:"ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹",variant:"destructive"});return}try{const t=await bl(),s=a!=null&&a.uid?`tg_daily_report_last_${a.uid}`:"tg_daily_report_last",n=Date.now();let r=!0;try{const i=localStorage.getItem(s);if(i){const o=JSON.parse(i),l=Number((o==null?void 0:o.at)||0);n-l<3e4&&(r=!1)}}catch{}if(r){await ba.send(a.uid,t);try{localStorage.setItem(s,JSON.stringify({at:n}))}catch{}}f({title:"ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„",description:"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…",variant:"default"})}catch{f({title:"ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„",description:"ØªØ¹Ø°Ù‘Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…",variant:"destructive"})}},[fm,Mn]=c.useState(!1),[jl,Bn]=c.useState(""),[gm,Un]=c.useState(!1),[gi,xi]=c.useState(""),[xm,H]=c.useState(!1),[ym,yi]=c.useState(!1),qa=async(t,s=2,n=700)=>{let r;for(let i=0;i<=s;i++)try{return await t()}catch(o){if(r=o,i===s)break;await new Promise(l=>setTimeout(l,n*Math.pow(2,i)))}throw r};O.reduce((t,s)=>t+(ee[s.id]||0),0);const wm=async t=>await xt.verifyMasterPin(t,a==null?void 0:a.uid),Fn=async t=>await xt.verifyMasterPin(t,a==null?void 0:a.uid);c.useEffect(()=>{if(a!=null&&a.uid){try{const t=Te(),s=`walletBalances_${a.uid}`,n=localStorage.getItem(t)??localStorage.getItem(s);if(n){const r=JSON.parse(n);Me(r&&typeof r=="object"?r:{});try{localStorage.setItem(t,JSON.stringify(r||{}))}catch{}}}catch{}try{const t=je(),s=`cashBalance_${a.uid}`,n=`userCashBalance_${a.uid}`;let r=localStorage.getItem(t)??localStorage.getItem(s)??localStorage.getItem(n);if(r!=null){const i=parseFloat(r);Oe(Number.isFinite(i)?i:0);try{localStorage.setItem(t,String(Number.isFinite(i)?i:0)),localStorage.removeItem(s),localStorage.removeItem(n)}catch{}}}catch{}}},[a==null?void 0:a.uid,_,h==null?void 0:h.shopId]),c.useEffect(()=>{const t=s=>{var n;try{const r=Number((n=s==null?void 0:s.detail)==null?void 0:n.value);if(Number.isFinite(r))Oe(r);else{const i=localStorage.getItem(je());i!=null&&Oe(parseFloat(i)||0)}}catch{const r=localStorage.getItem(je());r!=null&&Oe(parseFloat(r)||0)}};return window.addEventListener("cashBalanceChanged",t),()=>window.removeEventListener("cashBalanceChanged",t)},[a==null?void 0:a.uid,_,h==null?void 0:h.shopId]);const{data:wi}=Js({queryKey:["dashboardData",_||(h==null?void 0:h.shopId)],queryFn:async()=>{const t=_||(h==null?void 0:h.shopId);if(!t)return null;const s=ge(W,"dashboardData",t),n=await kt(s);return n.exists()?n.data():null},enabled:!!(a!=null&&a.uid&&(_||h!=null&&h.shopId)),staleTime:1e3*60*5,refetchInterval:1e3*60*5});c.useEffect(()=>{if(wi){const t=wi,s=Number((t==null?void 0:t.cashBalance)||0),n=t!=null&&t.walletBalances&&typeof t.walletBalances=="object"?t.walletBalances:{};try{const r=t!=null&&t.lastUpdated?new Date(t.lastUpdated).getTime():0,i=localStorage.getItem(je()+"_lastUpdated"),o=i?new Date(i).getTime():0;r>=o&&(Oe(s),Me(n),localStorage.setItem(je(),String(s)),localStorage.setItem(Te(),JSON.stringify(n)),t!=null&&t.lastUpdated&&(localStorage.setItem(je()+"_lastUpdated",t.lastUpdated),localStorage.setItem(Te()+"_lastUpdated",t.lastUpdated)))}catch{}}},[wi]);const Sl=t=>`walletLimits_${(a==null?void 0:a.uid)||"default"}_${t||"none"}`,{data:$n}=Js({queryKey:["walletLimits",D],queryFn:async()=>{if(!D)return null;const t=ge(W,"walletLimits",String(D)),s=await kt(t);return s.exists()?s.data():null},enabled:!!D,staleTime:1e3*60*5});c.useEffect(()=>{if(D)try{const t=Sl(D),s=localStorage.getItem(t);if(s&&!$n){const n=JSON.parse(s);za(n)}if($n){const n=$n,r={walletId:D,dailyTransferLimit:n.dailyTransferLimit??6e4,dailyWithdrawLimit:n.dailyWithdrawLimit??1e5,dailyTransferUsed:n.dailyTransferUsed??0,dailyWithdrawUsed:n.dailyWithdrawUsed??0,monthlyTransferLimit:n.monthlyTransferLimit??2e5,monthlyWithdrawLimit:n.monthlyWithdrawLimit??2e5,monthlyTransferUsed:n.monthlyTransferUsed??0,monthlyWithdrawUsed:n.monthlyWithdrawUsed??0};za(r);try{localStorage.setItem(Sl(D),JSON.stringify(r))}catch{}}}catch{}},[D,$n]),c.useEffect(()=>{if(!D)return;const t=O.find(s=>s.id===D);if(t!=null&&t.name){Yo(String(t.name));try{localStorage.setItem(`walletName_${(a==null?void 0:a.uid)||"default"}_${D}`,String(t.name))}catch{}return}try{const s=localStorage.getItem(`walletName_${(a==null?void 0:a.uid)||"default"}_${D}`);s&&Yo(String(s))}catch{}},[D,O]);const bi=async()=>{try{if(!D)return;const t=await ja.autoResetLimitsIfNeeded(D);za(t)}catch(t){console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:",t)}};c.useEffect(()=>{bi()},[D]),c.useEffect(()=>{const t=s=>{var n;(n=s==null?void 0:s.detail)!=null&&n.walletId&&s.detail.walletId===D&&bi()};return window.addEventListener("walletLimitsUpdated",t),()=>window.removeEventListener("walletLimitsUpdated",t)},[D]),c.useEffect(()=>{const t=s=>{var n;try{const r=String(((n=s==null?void 0:s.detail)==null?void 0:n.walletId)||"");r&&Bs(r,"sms:auto")}catch{}};return window.addEventListener("walletSelection:update",t),()=>window.removeEventListener("walletSelection:update",t)},[O]),c.useEffect(()=>{if(j.state){if(console.log("Location state:",j.state),j.state.openDebtDialog&&(wn(),window.history.replaceState({},document.title)),j.state.openSalesDialog&&(se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):Ra(!0),window.history.replaceState({},document.title)),j.state.openMaintenanceDialog&&(se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø§Ù„ØµÙŠØ§Ù†Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):Is(!0),window.history.replaceState({},document.title)),j.state.openCreditCardsDialog&&(console.log("Opening credit cards dialog"),se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"ÙƒØ±ÙˆØª Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù† ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):Ds(!0),window.history.replaceState({},document.title)),j.state.openShopExpensesDialog&&(se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø­Ù„ ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):xt.hasMasterPin()?Ea(!0):ca(!0),window.history.replaceState({},document.title)),j.state.openDeficienciesDialog&&(se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø§Ù„Ù†ÙˆØ§Ù‚Øµ ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):fs(!0),window.history.replaceState({},document.title)),j.state.openInstallment&&(se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø³ÙŠØ· ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©.",variant:"destructive"}):Ss(!0),window.history.replaceState({},document.title)),j.state.openTransactionSection){const t=document.getElementById("transaction-section");t&&t.scrollIntoView({behavior:"smooth"}),j.state.transactionType&&br(j.state.transactionType),j.state.startNewTransaction&&(xs(""),La(""),cn(""),dn(""),console.log("ğŸ”’ Starting new transaction without changing wallet selection")),j.state.focusWalletSelection&&setTimeout(()=>{const s=document.querySelector('[data-testid="wallet-select"]');s&&s.focus()},500),window.history.replaceState({},document.title)}j.state.openCashierShiftModal&&(!bt||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"ÙˆØ±Ø¯ÙŠØ© Ø§Ù„ÙƒØ§Ø´ÙŠØ± Ù…ØªØ§Ø­Ø© Ù„Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª: Ø´Ù‡Ø±ÙŠØŒ Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØŒ Ø³Ù†ÙˆÙŠØŒ ÙˆÙ…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©.",variant:"destructive"}):qe(!0),window.history.replaceState({},document.title)),j.state.openMachineDailyDialog&&(!bt||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ù…ÙƒÙ†Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª: Ø´Ù‡Ø±ÙŠØŒ Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØŒ Ø³Ù†ÙˆÙŠØŒ ÙˆÙ…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©.",variant:"destructive"}):Cs(!0),window.history.replaceState({},document.title)),j.state.openBranchManagement&&((Je==null?void 0:Je.status)==="active"?Mt(!0):Ht(!0),window.history.replaceState({},document.title))}},[j.state,O,ue,Je]),c.useEffect(()=>{j.pathname==="/user/dashboard"&&sessionStorage.getItem("previousPath")==="/user/add-wallet"&&(console.log("ğŸ”„ Returned from wallet addition page - reloading wallets"),vi(),sessionStorage.removeItem("previousPath")),sessionStorage.setItem("previousPath",j.pathname)},[j.pathname,a==null?void 0:a.uid]),c.useEffect(()=>{if(!(a!=null&&a.uid))return;(async()=>{try{const s=ge(W,"users",a.uid),n=await kt(s);if(n.exists()){const i=n.data().isActive===!0;i&&!us?(Xt(!0),ea(!1),hs(!1)):!i&&us&&(Xt(!1),ea(!0))}}catch(s){console.error("Check user status error",s)}})()},[a==null?void 0:a.uid]),c.useEffect(()=>{if(!(a!=null&&a.uid))return;const t=n=>{const{userId:r}=n.detail;r===a.uid&&(console.log("ğŸ‰ Subscription activation event received for current user!"),Xt(!0),ea(!1),hs(!1),setTimeout(()=>{console.log("âœ… User activation completed - data updated")},1e3))},s=n=>{const{userId:r,isActive:i}=n.detail;r===a.uid&&(console.log("ğŸ”„ User subscription update event received:",{userId:r,isActive:i}),i&&!us&&(Xt(!0),ea(!1),hs(!1),setTimeout(()=>{console.log("âœ… User subscription updated - data refreshed")},1e3)))};return window.addEventListener("subscriptionActivated",t),window.addEventListener("userSubscriptionUpdated",s),()=>{window.removeEventListener("subscriptionActivated",t),window.removeEventListener("userSubscriptionUpdated",s)}},[a==null?void 0:a.uid,us]),c.useEffect(()=>{const t=s=>{var o;const n=s.target,r=(o=n==null?void 0:n.tagName)==null?void 0:o.toLowerCase();if(!(r==="input"||r==="textarea"||r==="select"||((n==null?void 0:n.isContentEditable)??!1))&&!(s.ctrlKey||s.altKey||s.metaKey)&&!s.repeat){if((se||ue)&&s.key>="1"&&s.key<="9"){s.preventDefault();return}switch(s.key){case"1":break;case"2":Ar(!0);break;case"3":se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"ÙƒØ±ÙˆØª Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù† ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):Ds(!0);break;case"4":bt?qe(!0):f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"ÙˆØ±Ø¯ÙŠØ© Ø§Ù„ÙƒØ§Ø´ÙŠØ± Ù…ØªØ§Ø­Ø© Ù„Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª: Ø´Ù‡Ø±ÙŠØŒ Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØŒ Ø³Ù†ÙˆÙŠØŒ ÙˆÙ…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©.",variant:"destructive"});break;case"5":se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):Ra(!0);break;case"6":wn();break;case"7":se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø§Ù„ØµÙŠØ§Ù†Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):Is(!0);break;case"8":bt?Cs(!0):f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ù…ÙƒÙ†Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª: Ø´Ù‡Ø±ÙŠØŒ Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØŒ Ø³Ù†ÙˆÙŠØŒ ÙˆÙ…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©.",variant:"destructive"});break;case"9":se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø­Ù„ ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):xt.hasMasterPin()?Ea(!0):ca(!0);break}}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[se,ue,bt]),c.useEffect(()=>{console.log("ğŸ”¥ useEffect loadUserData started",{user:a==null?void 0:a.uid,isCheckingActivation:ar}),(async()=>{try{if(!(a!=null&&a.uid)){console.log("ğŸ”¥ No user UID, setting isCheckingActivation to false"),hs(!1);return}try{const o=await kt(ge(W,"users",a.uid));if(o.exists()){const d=o.data().isActive===!0,p=await Kl.checkTrialValidity(a.uid),m=p.isValid&&!p.isExpired;Xt(d||m),Qi(m),Yi(p.hoursRemaining),Hi(p.hasUsedTrial),ea(!d&&!m),console.log("ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:",{isActive:d,isOnTrial:m,hoursRemaining:p.hoursRemaining,hasUsedTrial:p.hasUsedTrial})}else Xt(!1),ea(!0)}catch(o){console.error("Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø­Ø§Ù„Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:",o),Xt(!1),ea(!0)}finally{hs(!1)}if(console.log("ğŸ”„ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firebase...",{userId:a==null?void 0:a.uid}),a!=null&&a.uid){const o=await qa(()=>K.getUserData(a.uid)),l=`userData_${a==null?void 0:a.uid}`;let d=null;try{const p=localStorage.getItem(l);p&&(d=JSON.parse(p))}catch{}if(o){let p=(o==null?void 0:o.walletBalances)||{},m=o==null?void 0:o.cashBalance;const u=o.lastUpdated?new Date(o.lastUpdated).getTime():0;d&&(d.lastUpdated?new Date(d.lastUpdated).getTime():0)>=u&&(d.walletBalances&&(p=d.walletBalances),d.cashBalance!==void 0&&(m=d.cashBalance));try{const g=je(),x=Te(),y=localStorage.getItem(g+"_lastUpdated"),N=localStorage.getItem(x+"_lastUpdated"),E=y?new Date(y).getTime():0,v=N?new Date(N).getTime():0;if(E>u){const S=localStorage.getItem(g);S!==null&&(m=parseFloat(S))}if(v>u){const S=localStorage.getItem(x);if(S!==null)try{p=JSON.parse(S)}catch{}}}catch(g){console.error("Error checking individual keys fallback:",g)}Me(p),m!==void 0&&Oe(m);try{const g=a!=null&&a.uid?await qa(()=>Ks.getDeletedTransactionsByUser(a.uid)):[];Ns(g||[])}catch{Ns([])}}else{Me({});try{const p=a!=null&&a.uid?await Ks.getDeletedTransactionsByUser(a.uid):[];Ns(p||[])}catch{Ns([])}}}console.log("ğŸ”„ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ù…Ù† Firebase...");try{const o=await qa(()=>Qn.getByMerchantId((a==null?void 0:a.uid)||""));if(o&&o.length>0){console.log("âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø­Ø§ÙØ¸ ÙÙŠ Firebase:",o.length);const d=o.filter(u=>u.isActive===!0).map(u=>({id:u.id,name:u.label||"Ù…Ø­ÙØ¸Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…",phone:u.msisdn,isDefault:!1,monthlyWithdrawalLimit:u.monthlyWithdrawalLimit??u.withdrawLimit??2e5,monthlyTransferLimit:u.monthlyTransferLimit??u.transferLimit??2e5,defaultTransferCommission:u.defaultTransferCommission!=null?Number(u.defaultTransferCommission):null,defaultWithdrawCommission:u.defaultWithdrawCommission!=null?Number(u.defaultWithdrawCommission):null}));De(d);const p=localStorage.getItem(xa());let m=null;p&&d.find(u=>u.id===p)?m=d.find(u=>u.id===p):m=d[0],m&&(ms(m.id),Oa(m.phone)),console.log("ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ù…Ù† Firebase ÙˆØ­ÙØ¸Ù‡Ø§ ÙÙŠ localStorage")}else console.log("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙØ¸ ÙÙŠ Firebase. Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ© Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù…Ø­Ù„ÙŠ."),De([])}catch(o){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ù…Ù† Firebase:",o),De([])}const i=a!=null&&a.uid?await qa(()=>K.getUserTransactions(a.uid)):[];if(i&&i.length>0){console.log("ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù…Ù† Firebase:",i.length);const o=i.map(u=>({...u,createdAt:new Date(u.createdAt),senderPhone:u.senderMsisdn||u.senderPhone||"",receiverPhone:u.receiverMsisdn||u.receiverPhone||"",type:u.txnType==="send"?"send":u.txnType==="receive"?"withdraw":u.type||"withdraw",status:u.status==="confirmed"?"completed":u.status||"completed"})),l=vs.map(u=>u.id||u.originalTransactionId);let d=[];try{const u=ve(ne(W,"deletedTransactions"),Q("userId","==",(a==null?void 0:a.uid)||""),Q("permanent","==",!0));d=(await fe(u)).docs.map(x=>{const y=x.data();return String(y.originalTransactionId||y.transactionId||x.id||"")}).filter(Boolean)}catch{}const p=new Set(d),m=o.filter(u=>{var v;const g=String(u.id||""),x=String(u.transactionId||""),y=String(u.reference||u.transactionReference||((v=u.receipt)==null?void 0:v.reference)||""),N=l.includes(g),E=p.has(g)||x&&p.has(x);return!N&&!E});console.log("âœ… ØªÙ… ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©:",{total:i.length,deleted:l.length,active:m.length});{const u=new Set,g=[];for(const x of m){const y=cl(x);u.has(y)||(u.add(y),g.push(x))}Xc||yt(g)}}await xl()}catch(i){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firebase:",i)}})().then(async()=>{await r(),await s(),await n()});const s=async()=>{try{if(!(a!=null&&a.uid))return;const i=await Qn.getByMerchantId(a.uid);await Promise.all(i.map(o=>Wu.autoResetLimitsIfNeeded(o.id)))}catch(i){console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµÙÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø­Ø¯ÙˆØ¯:",i)}},n=async()=>{try{await st.syncReportsDataFromFirebase(a==null?void 0:a.uid);const i=st.getReportsData(a==null?void 0:a.uid);if((i.lastDailyResetDate?st.shouldResetDailyReports(i.lastDailyResetDate):!1)&&(a!=null&&a.uid)&&i.lastDailyResetDate){const d=new Date(i.lastDailyResetDate),p=d.toDateString(),m=Y.filter(v=>new Date(v.createdAt).toDateString()===p&&v.status==="completed"),u=m.length,g=m.reduce((v,S)=>v+S.amount,0),x=m.filter(Us).reduce((v,S)=>{const P=S.withdrawnAmount!==void 0?S.withdrawnAmount:S.amount;return v+P},0),y=m.filter(Fs).reduce((v,S)=>{const P=S.sentAmount!==void 0?S.sentAmount:S.amount;return v+P},0),N=m.reduce((v,S)=>v+st.calculateTransactionProfit(S),0),E=new Date(d).toISOString().slice(0,10);await $s.add({userId:a.uid,reportDate:E,totalTransactions:u,totalAmount:Number(g.toFixed(2)),totalWithdrawn:Number(x.toFixed(2)),totalSent:Number(y.toFixed(2)),profit:Number(N.toFixed(2)),walletId:null})}const l=st.autoResetReportsIfNeeded(a==null?void 0:a.uid);(l.dailyReset||l.monthlyReset)&&console.log("ØªÙ… Ø§Ù„ØªØµÙÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:",l)}catch(i){console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµÙÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ±:",i)}},r=async()=>{try{if(!(a!=null&&a.uid))return;const i=new Date;if(i.getDate()!==1)return;const o=`${i.getFullYear()}-${i.getMonth()+1}`,l=`lastMonthlyDbCleanup:${a.uid}`;if(localStorage.getItem(l)===o)return;const p=new Date(i.getFullYear(),i.getMonth(),1,0,0,0,0),m=x=>x instanceof Date?x:typeof(x==null?void 0:x.toDate)=="function"?x.toDate():new Date(String(x));let u=[];try{const x=ve(ne(W,"userTransactions"),Q("userId","==",a.uid),Q("createdAt","<",p));u=(await fe(x)).docs}catch{const x=ve(ne(W,"userTransactions"),Q("userId","==",a.uid));u=(await fe(x)).docs.filter(N=>{var E;return m((E=N.data())==null?void 0:E.createdAt)<p})}await Promise.allSettled(u.map(x=>Rl(x.ref)));let g=[];try{const x=ve(ne(W,"transactions"),Q("userId","==",a.uid),Q("createdAt","<",p));g=(await fe(x)).docs}catch{const x=ve(ne(W,"transactions"),Q("userId","==",a.uid));g=(await fe(x)).docs.filter(N=>{var E;return m((E=N.data())==null?void 0:E.createdAt)<p})}await Promise.allSettled(g.map(x=>Rl(x.ref)));try{localStorage.setItem(l,o)}catch{}console.log("âœ… ØªÙ… ØªÙ†Ø¸ÙŠÙ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ù‡Ø±ÙŠÙ‹Ø§ (Firebase ÙÙ‚Ø·):",{userTransactionsDeleted:u.length,globalTransactionsDeleted:g.length,monthStart:p})}catch(i){console.error("ÙØ´Ù„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:",i)}};Fd(),Gr(),tm(),console.log("ğŸ”¥ useEffect loadUserData completed")},[a==null?void 0:a.uid]);const vi=async()=>{var t;if(a!=null&&a.uid)try{const s=await qa(()=>Qn.getByMerchantId(a.uid));if(s&&s.length>0){const r=s.filter(i=>i.isActive===!0).map(i=>({id:i.id,name:i.label||"Ù…Ø­ÙØ¸Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…",phone:i.msisdn,isDefault:!1,monthlyWithdrawalLimit:i.monthlyWithdrawalLimit??i.withdrawLimit??2e5,monthlyTransferLimit:i.monthlyTransferLimit??i.transferLimit??2e5,defaultTransferCommission:i.defaultTransferCommission!=null?Number(i.defaultTransferCommission):void 0,defaultWithdrawCommission:i.defaultWithdrawCommission!=null?Number(i.defaultWithdrawCommission):void 0}));if(De(r),a!=null&&a.uid){const i=localStorage.getItem(xa());if(!!(D&&r.find(l=>l.id===D)))console.log("ğŸ”’ Preserving current wallet selection:",D);else{const d=(i&&r.find(p=>p.id===i)?i:null)||((t=r[0])==null?void 0:t.id);d&&(console.log("ğŸ”„ Fixing invalid wallet selection:",d),Bs(d))}}console.log("ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ù…Ù† Firebase:",r.length)}}catch(s){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ù…Ù† Firebase:",s)}};c.useEffect(()=>{const t=j.pathname;if(sessionStorage.getItem("previousPath")==="/user/add-wallet"&&t==="/user/dashboard"){me.invalidateQueries({queryKey:["wallets",a==null?void 0:a.uid]});try{hn.refetch()}catch{}sessionStorage.removeItem("previousPath")}sessionStorage.setItem("previousPath",t)},[j.pathname,a==null?void 0:a.uid]),c.useEffect(()=>{const t=()=>{me.invalidateQueries({queryKey:["wallets",a==null?void 0:a.uid]});try{hn.refetch()}catch{}};return window.addEventListener("focus",t),()=>{window.removeEventListener("focus",t)}},[a==null?void 0:a.uid,D,O]);const Bs=async(t,s="unknown")=>{console.log(`ğŸ¯ setWalletSelection called from ${s} with walletId:`,t),console.log("ğŸ” Previous selectedWallet:",D),ms(t);const n=O.find(r=>r.id===t);if(n&&(Oa(n.phone),console.log("âœ… Wallet set successfully:",t,"Phone:",n.phone)),a!=null&&a.uid){localStorage.setItem(xa(),t),console.log("ğŸ’¾ Saved wallet to localStorage:",t);try{await Vs.set({key:"selected_wallet_id",value:t}),await Vs.set({key:"current_user_id",value:a.uid}),console.log("ğŸ“± Saved wallet and user ID to Capacitor Preferences:",t,a.uid)}catch(r){console.error("âŒ Failed to save to Capacitor Preferences:",r)}}};c.useEffect(()=>{const t=()=>{vi()};try{window.addEventListener("wallets:activation-updated",t)}catch{}return()=>{try{window.removeEventListener("wallets:activation-updated",t)}catch{}}},[a==null?void 0:a.uid]);const bm=t=>{if(t==="__add_wallet"){T("/user/add-wallet");return}if(t==="__view_wallets"){ln(!0);return}du.isEnabled(a==null?void 0:a.uid)?(gr(t),fr(!0)):Bs(t,"walletSelectionNoPin")},Vn=t=>{console.log("ğŸ”„ handleTransactionTypeChange called with type:",t),console.log("ğŸ” Current selectedWallet before change:",D),console.log("ğŸ” Available wallets count:",O.length),br(t),xs(""),La(""),cn(""),dn(""),console.log("âœ… Transaction type changed to:",t,"- Wallet selection preserved:",D),setTimeout(()=>{const s=document.getElementById("transaction-section");s&&s.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)};c.useEffect(()=>{const t=s=>{const n=s.target;if(!!n&&(n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.tagName==="SELECT"||n.isContentEditable)||(s.key==="ArrowLeft"?(s.preventDefault(),Vn("withdraw")):s.key==="ArrowRight"&&(s.preventDefault(),Vn("transfer"))),s.key==="Enter"){const i=L==="transfer"?"transferSubmitButton":"withdrawSubmitButton",o=document.getElementById(i);o&&!o.disabled&&(s.preventDefault(),o.click())}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[L]);const Dl=t=>{Hc((n=>({id:n.id,type:n.type==="send"?"transfer":"withdraw",sender_msisdn:n.senderPhone,receiver_msisdn:n.receiverPhone,amount:n.amount,commission:n.commission||0,fee:(n==null?void 0:n.fee)??0,status:n.status==="failed"?"failed":n.status==="completed"?"completed":"pending",createdAt:new Date(n.createdAt).toISOString(),updatedAt:new Date(n.createdAt).toISOString(),shopName:B??(h==null?void 0:h.shopName)??(a==null?void 0:a.displayName)??"Ø§Ù„Ù…Ø­Ù„",cashierName:(n==null?void 0:n.cashierName)??null,commissionMode:(n==null?void 0:n.commissionMode)??(n.type==="send"||xe?"add":"deduct"),totalCharged:(n==null?void 0:n.totalCharged)??(n.type==="send"?Number(n.amount||0)+Number(n.commission||0)+Number((n==null?void 0:n.fee)||0):xe?Number(n.amount||0)+Number(n.commission||0):Number(n.amount||0)),note:(n==null?void 0:n.note)??(n==null?void 0:n.notes)??void 0,senderName:(n==null?void 0:n.senderName)??void 0,provider:(n==null?void 0:n.provider)??void 0,title:(()=>{const r=String((n==null?void 0:n.provider)||"").toLowerCase(),i=r.includes("vodafone")?"vf-cash":r.includes("instapay")?"instapay":"",o=n.type==="send"?"ØªØ­ÙˆÙŠÙ„":"Ø³Ø­Ø¨";return n.type==="withdraw"&&i?`${o} ${i}`:o})()}))(t)),pn(!0)},vm=async t=>{var i;if(!(a!=null&&a.uid)){f({title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©",description:"ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª",variant:"destructive"});return}const s=Y.find(o=>o.id===t);if(!s){f({title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù",description:"Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø­Ø°ÙÙ‡Ø§",variant:"destructive"});return}const n=String(t),r=String((s==null?void 0:s.transactionId)||(s==null?void 0:s.reference)||"");Pt.current.add(n),r&&Pt.current.add(r);try{console.log("ğŸ—‘ï¸ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©:",t),console.log("ğŸ”„ Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Firebase...",{transactionId:s.id,userId:a.uid,transactionData:s}),await K.removeUserTransaction(a.uid,s.id),console.log("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Firebase userTransactions");try{await Ks.saveDeletedTransaction({...s,userId:a.uid,originalTransactionId:s.id,transactionId:s.transactionId||s.id,reference:s.reference||s.transactionReference||((i=s.receipt)==null?void 0:i.reference),deletedAt:new Date().toISOString(),permanent:!0}),console.log("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª Ù…Ø¹ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø°Ù")}catch(d){console.warn("âš ï¸ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§ØªØŒ Ù„ÙƒÙ† Ø§Ù„Ø­Ø°Ù Ù…Ù† Firebase Ù†Ø¬Ø­:",d)}try{await Ks.permanentlyDeleteTransaction(s.id,a.uid)}catch(d){console.warn("âš ï¸ ÙØ´Ù„ ÙˆØ³Ù… Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø£Ùˆ Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ:",d)}const o=[...vs,s],l=Y.filter(d=>d.id!==t);Ns(o),yt(l),ho(!1),console.log("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù Ù…Ù† Firebase (Ø¨Ø¯ÙˆÙ† Ù†Ø³Ø® Ù…Ø­Ù„ÙŠØ©)");try{const d=s.fromWallet;if(d){const{walletDailyLimitsService:p}=await F(async()=>{const{walletDailyLimitsService:u}=await import("./index-bCWIXU_s.js").then(g=>g.cr);return{walletDailyLimitsService:u}},__vite__mapDeps([0,1]),import.meta.url),m=await p.getWalletLimits(d);if(m){const u=s.type==="send",g={updatedAt:(await F(async()=>{const{serverTimestamp:v}=await import("./index-bCWIXU_s.js").then(S=>S.ck);return{serverTimestamp:v}},__vite__mapDeps([0,1]),import.meta.url)).serverTimestamp()};u?(g.dailyTransferUsed=Math.max(0,(m.dailyTransferUsed||0)-s.amount),g.monthlyTransferUsed=Math.max(0,(m.monthlyTransferUsed||0)-s.amount)):(g.dailyWithdrawUsed=Math.max(0,(m.dailyWithdrawUsed||0)-s.amount),g.monthlyWithdrawUsed=Math.max(0,(m.monthlyWithdrawUsed||0)-s.amount));const{doc:x,setDoc:y}=await F(async()=>{const{doc:v,setDoc:S}=await import("./index-bCWIXU_s.js").then(P=>P.ck);return{doc:v,setDoc:S}},__vite__mapDeps([0,1]),import.meta.url),{db:N}=await F(async()=>{const{db:v}=await import("./index-bCWIXU_s.js").then(S=>S.cl);return{db:v}},__vite__mapDeps([0,1]),import.meta.url),E=x(N,"walletLimits",d);await y(E,g,{merge:!0})}}}catch(d){console.warn("ÙØ´Ù„ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù:",d)}try{const{ProfitService:d}=await F(async()=>{const{ProfitService:x}=await import("./profitService-RoVQsoFR.js");return{ProfitService:x}},__vite__mapDeps([47,0,1]),import.meta.url),{ReportsService:p}=await F(async()=>{const{ReportsService:x}=await import("./index-bCWIXU_s.js").then(y=>y.cq);return{ReportsService:x}},__vite__mapDeps([0,1]),import.meta.url),u={txnType:s.type==="send"?"send":"receive",amount:s.amount,commission:s.commission||0,createdAt:s.createdAt,status:"confirmed"},g=d.calculateProfitFromTransaction(u);g>0&&d.addProfit(-g,a.uid);try{p.removeTransactionEffects(s,a.uid)}catch{}}catch(d){console.warn("ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ø¨Ø§Ø­/Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù:",d)}f({title:"ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹",description:"ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡Ø§ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª"})}catch(o){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ù…Ù† Firebase:",o);let l="ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";o instanceof Error&&(o.message.includes("network")||o.message.includes("offline")?l="Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰":o.message.includes("permission")||o.message.includes("unauthorized")?l="Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©":o.message.includes("not-found")&&(l="Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© Ø£Ùˆ ØªÙ… Ø­Ø°ÙÙ‡Ø§ Ù…Ø³Ø¨Ù‚Ø§Ù‹")),f({title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù",description:l,variant:"destructive"})}},Us=t=>{const s=t.type,n=t.txnType;return s==="withdraw"||s==="withdrawal"||s==="receive"||n==="receive"},Fs=t=>{const s=t.type,n=t.txnType;return s==="send"||s==="transfer"||n==="send"},Il=(t,s)=>{const n=new Date().toDateString();let r=Y.filter(m=>{const u=new Date(m.createdAt).toDateString()===n,g=String(m.status||"").toLowerCase();return u&&(g==="completed"||g==="confirmed"||g==="pending")});Ot&&Ot.trim()!==""&&(r=r.filter(m=>m.senderPhone&&m.senderPhone.includes(Ot)||m.receiverPhone&&m.receiverPhone.includes(Ot)));const i=st.filterVisibleTransactions(r,"daily",a==null?void 0:a.uid),o=i.length,l=i.reduce((m,u)=>m+u.amount,0),d=i.filter(Us).reduce((m,u)=>{const g=u.withdrawnAmount!==void 0?u.withdrawnAmount:u.amount;return m+g},0),p=i.filter(Fs).reduce((m,u)=>{const g=u.sentAmount!==void 0?u.sentAmount:u.amount;return m+g},0);return{totalTransactions:o,totalAmount:l,totalWithdrawn:d,totalSent:p}},Nm=t=>{const s=new Date().getMonth(),n=new Date().getFullYear();let r=Y.filter(m=>{const u=new Date(m.createdAt);return u.getMonth()===s&&u.getFullYear()===n&&m.status==="completed"});Ot&&Ot.trim()!==""&&(r=r.filter(m=>m.senderPhone&&m.senderPhone.includes(Ot)||m.receiverPhone&&m.receiverPhone.includes(Ot)));const i=st.filterVisibleTransactions(r,"monthly",a==null?void 0:a.uid),o=i.length,l=i.reduce((m,u)=>m+u.amount,0),d=i.filter(Us).reduce((m,u)=>{const g=u.withdrawnAmount!==void 0?u.withdrawnAmount:u.amount;return m+g},0),p=i.filter(Fs).reduce((m,u)=>{const g=u.sentAmount!==void 0?u.sentAmount:u.amount;return m+g},0);return{totalTransactions:o,totalAmount:l,totalWithdrawn:d,totalSent:p}},jm=t=>{const s=new Date().getMonth(),n=new Date().getFullYear(),r=Y.filter(l=>{const d=new Date(l.createdAt);return d.getMonth()===s&&d.getFullYear()===n&&l.status==="completed"&&l.fromWallet===t}),i=r.filter(Us).reduce((l,d)=>{const p=d.withdrawnAmount||d.amount;return l+p},0),o=r.filter(Fs).reduce((l,d)=>{const p=d.sentAmount||d.amount;return l+p},0);return{totalWithdrawn:i,totalTransferred:o}},Sm=t=>{const s=new Date,n=s.getDate(),r=s.getMonth(),i=s.getFullYear(),o=Y.filter(p=>{const m=new Date(p.createdAt);return m.getDate()===n&&m.getMonth()===r&&m.getFullYear()===i&&p.status==="completed"&&p.fromWallet===t}),l=o.filter(Us).reduce((p,m)=>{const u=m.withdrawnAmount||m.amount;return p+u},0),d=o.filter(Fs).reduce((p,m)=>{const u=m.sentAmount||m.amount;return p+u},0);return{totalWithdrawn:l,totalTransferred:d}},Ka=$.useMemo(()=>Nm(),[Y,D,Ot]),zn=$.useMemo(()=>Il(),[Y,D,Ot,a==null?void 0:a.uid]);Ka.totalWithdrawn,Ka.totalSent;const Vt=$.useMemo(()=>jm(D),[Y,D]),Dm=$.useMemo(()=>Sm(D),[Y,D]),Ja=$.useMemo(()=>{try{return JSON.parse(localStorage.getItem(ll())||"[]")}catch{return[]}},[a==null?void 0:a.uid]);c.useEffect(()=>{try{if(!D||O.length===0)return;const t=O.find(y=>y.id===D);if(!t)return;const s=(G==null?void 0:G.monthlyWithdrawLimit)??(t==null?void 0:t.monthlyWithdrawalLimit)??2e5,n=(G==null?void 0:G.monthlyTransferLimit)??(t==null?void 0:t.monthlyTransferLimit)??2e5,r=parseFloat(Qe||"0")||0,i=(Vt==null?void 0:Vt.totalWithdrawn)??(G==null?void 0:G.monthlyWithdrawUsed)??0,o=(Vt==null?void 0:Vt.totalTransferred)??(G==null?void 0:G.monthlyTransferUsed)??0,l=i+(L==="withdraw"?r:0),d=o+(L==="transfer"?r:0),p=.85,m=Math.floor(Math.max(s,1)*p),u=Math.floor(Math.max(n,1)*p),g=(()=>{const y=new Date;return`${y.getFullYear()}-${String(y.getMonth()+1).padStart(2,"0")}`})(),x=`monthlyLimitWarnShown:${D}:${g}`;if(l>=m){const y=`${x}:withdraw`;if(!(localStorage.getItem(y)==="true")){lo({type:"withdraw",used:l,limit:s,walletName:t.name}),oo(!0);try{localStorage.setItem(y,"true")}catch{}return}}if(d>=u){const y=`${x}:transfer`;if(!(localStorage.getItem(y)==="true")){lo({type:"transfer",used:d,limit:n,walletName:t.name}),oo(!0);try{localStorage.setItem(y,"true")}catch{}return}}}catch{}},[D,O,G,Vt,L,Qe]);const Cl=async()=>{var Be,Ve,ra,Qa;Yu(),console.log("ğŸ”„ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„/Ø§Ù„Ø³Ø­Ø¨"),console.log("ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©:",{senderPhone:Ut,receiverPhone:ht,amount:Qe,transactionType:L});const t=()=>{L==="transfer"?Ma(!0):js(!0)},s=()=>{L==="transfer"?Ma(!1):js(!1)};if(t(),!Ut||!Qe){console.log("âŒ Ø®Ø·Ø£: Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©"),f({title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",description:"ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©",variant:"destructive"}),s();return}if(L==="transfer"&&!ht&&!I){console.log("âŒ Ø®Ø·Ø£: Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ù…ÙÙ‚ÙˆØ¯"),f({title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„",variant:"destructive"}),s();return}if(L==="transfer"&&!I&&(String(ht||"").replace(/[^0-9Ù -Ù©]/g,""),!/[^0-9Ù -Ù©\s]/.test(String(ht||""))&&!Hu(ht))){f({title:"Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ ØºÙŠØ± ØµØ§Ù„Ø­",description:"Ø§ÙƒØªØ¨ Ø±Ù‚Ù… ØµØ­ÙŠØ­ Ù…ÙƒÙˆÙ† Ù…Ù† 11 Ø±Ù‚Ù… ÙˆÙŠØ¨Ø¯Ø£ Ø¨Ù€ 015 Ø£Ùˆ 010 Ø£Ùˆ 012 Ø£Ùˆ 011",variant:"destructive"}),s();return}const n=parseFloat(Qe);if(console.log("ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø­ÙˆÙ„:",n),n<=0){console.log("âŒ Ø®Ø·Ø£: Ù…Ø¨Ù„Øº ØºÙŠØ± ØµØ­ÙŠØ­"),f({title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¨Ù„Øº",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­",variant:"destructive"}),s();return}if(se)try{const k=new Date,R=k.getFullYear(),te=String(k.getMonth()+1).padStart(2,"0"),Se=String(k.getDate()).padStart(2,"0"),ze=`zeroPlanDailyConfirmCount:${(a==null?void 0:a.uid)||"default"}:${R}-${te}-${Se}`,lt=localStorage.getItem(ze);if((lt&&parseInt(lt,10)||0)>=10){f({title:"Ø­Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ",description:"Ø¨Ø§Ù‚Ø© Ø²ÙŠØ±Ùˆ ØªØ³Ù…Ø­ Ø¨Ù€ 10 ØªØ£ÙƒÙŠØ¯Ø§Øª ØªØ­ÙˆÙŠÙ„/Ø³Ø­Ø¨ ÙŠÙˆÙ…ÙŠØ§Ù‹ ÙÙ‚Ø·.",variant:"destructive"}),s();return}}catch(k){console.warn("ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø§Ø¯ ØªØ£ÙƒÙŠØ¯Ø§Øª Ø¨Ø§Ù‚Ø© Ø²ÙŠØ±Ùˆ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ:",k)}const r=O.find(k=>k.id===D);if(!r){f({title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø©",description:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙØ¸Ø© ØµØ­ÙŠØ­Ø©",variant:"destructive"}),s();return}const i=Vt;if(console.log("ğŸ“ˆ ÙØ­Øµ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ù„Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©"),console.log("ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ù„Ù„Ù…Ø­ÙØ¸Ø©:",{walletId:D,walletName:r.name,currentWithdrawn:i.totalWithdrawn,currentTransferred:i.totalTransferred,withdrawalLimit:r.monthlyWithdrawalLimit,transferLimit:r.monthlyTransferLimit}),L==="withdraw"){if(console.log("ğŸ§ ÙØ­Øµ Ø­Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„Ù…Ø­ÙØ¸Ø©"),console.log(`ğŸ’¸ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨ Ø­Ø§Ù„ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©: ${i.totalWithdrawn}, Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${n}, Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: ${r.monthlyWithdrawalLimit}`),i.totalWithdrawn+n>r.monthlyWithdrawalLimit){console.log("âŒ ØªØ¬Ø§ÙˆØ² Ø­Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„Ù…Ø­ÙØ¸Ø©"),f({title:"ØªØ¬Ø§ÙˆØ² Ø­Ø¯ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ",description:`Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø³Ø­Ø¨ Ø£ÙƒØ«Ø± Ù…Ù† ${r.monthlyWithdrawalLimit} Ø¬Ù†ÙŠÙ‡ Ø´Ù‡Ø±ÙŠØ§Ù‹ Ù…Ù† Ù…Ø­ÙØ¸Ø© ${r.name}`,variant:"destructive"}),s();return}}else if(console.log("ğŸ’¸ ÙØ­Øµ Ø­Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„Ù…Ø­ÙØ¸Ø©"),console.log(`ğŸ“¤ Ø§Ù„Ù…Ø­ÙˆÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©: ${i.totalTransferred}, Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${n}, Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: ${r.monthlyTransferLimit}`),i.totalTransferred+n>r.monthlyTransferLimit){console.log("âŒ ØªØ¬Ø§ÙˆØ² Ø­Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„Ù…Ø­ÙØ¸Ø©"),f({title:"ØªØ¬Ø§ÙˆØ² Ø­Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø´Ù‡Ø±ÙŠ",description:`Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­ÙˆÙŠÙ„ Ø£ÙƒØ«Ø± Ù…Ù† ${r.monthlyTransferLimit} Ø¬Ù†ÙŠÙ‡ Ø´Ù‡Ø±ÙŠØ§Ù‹ Ù…Ù† Ù…Ø­ÙØ¸Ø© ${r.name}`,variant:"destructive"}),s();return}h!=null&&h.shopName||a!=null&&a.displayName,Date.now().toString(),L==="withdraw"&&ys.trim()!==""&&ys.trim(),r!=null&&r.name,L==="transfer"||da&&da.trim()!==""&&da.trim(),J&&(A!=null&&A.name||A!=null&&A.username)&&(A!=null&&A.name||(A==null||A.username));const o=is.validateTransaction(n,L,we,ee);if(!o.isValid){f({title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©",description:o.error,variant:"destructive"}),s();return}o.warning&&f({title:"ØªØ­Ø°ÙŠØ±",description:o.warning,variant:"destructive"});let l;if(L==="transfer")if((r==null?void 0:r.defaultTransferCommission)!=null){const k=Number(r.defaultTransferCommission)||0;l=Math.round(k*n/1e3*100)/100}else He&&He.trim()!==""?l=Math.max(0,parseFloat(He)):l=0;else if((r==null?void 0:r.defaultWithdrawCommission)!=null){const k=Number(r.defaultWithdrawCommission)||0;l=Math.round(k*n/1e3*100)/100}else Ye&&Ye.trim()!==""?l=Math.max(0,parseFloat(Ye)):l=Math.round(n*.01*100)/100;if(L!=="transfer"&&!xe&&l>=n){f({title:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©",description:"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© Ø£ÙƒØ¨Ø± Ù…Ù† Ø£Ùˆ ØªØ³Ø§ÙˆÙŠ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯Ø®Ù„",variant:"destructive"}),s();return}const d=L==="transfer"||xe?n:Math.round((n-l)*100)/100;let p;const m=L==="transfer"&&!!_t,u=L==="withdraw"&&!!_t,g=m||u;let x=null;const y=mn(Ut||"").replace(/\D/g,""),N=mn(ht||"").replace(/\D/g,""),E=L==="transfer"&&(y.startsWith("010")&&(N.startsWith("011")||N.startsWith("012")||N.startsWith("015"))||y.startsWith("012")&&N.startsWith("010")||y.startsWith("011")&&N.startsWith("010")||y.startsWith("015")&&N.startsWith("010")),v=Math.max(0,parseFloat(io||"0")),S=Math.round(l*100)/100;if(E&&!g&&v<=0){f({title:"Ø®Ø·Ø£",description:"Ø£Ø¯Ø®Ù„ Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ø¹Ù…Ù„ÙŠØ§Øª 010 â†’ 011/012/015 Ø£Ùˆ 012 â†’ 010 Ø£Ùˆ 011 â†’ 010 Ø£Ùˆ 015 â†’ 010",variant:"destructive"}),s();return}if(L==="transfer"&&!g){const k=Number(ee[D]||0),R=Number(d)+Number(v);if(k<R){f({title:"Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© ØºÙŠØ± ÙƒØ§ÙÙ",description:`Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ ${k} Ù„Ø§ ÙŠÙƒÙÙŠ Ù„Ø®ØµÙ… ${R}`,variant:"destructive"}),s();return}}if(g)if(m){const k=is.validateTransaction(d,"transfer",we,ee);if(!k.isValid)p={success:!1,newCashBalance:we,newWalletBalances:ee,message:k.error||"Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ Ù„Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¤Ø¬Ù„",error:"INSUFFICIENT_WALLET_BALANCE"};else{const R=D||((Be=O.find(ie=>ie.isDefault))==null?void 0:Be.id)||((Ve=O[0])==null?void 0:Ve.id),te=G??await ja.getWalletLimits(R),Se=new Date().toDateString(),ze=Y.filter(ie=>ie.type==="send"&&String(ie.status||"").toLowerCase()==="pending"&&ie.fromWallet===R&&new Date(ie.createdAt).toDateString()===Se).reduce((ie,tt)=>ie+Number(tt.sentAmount??tt.transferredAmount??tt.amount??0),0),lt=Number((te==null?void 0:te.dailyTransferLimit)??6e4),vt=Number((te==null?void 0:te.dailyTransferUsed)??0);if(vt+ze+Number(d)>lt){f({title:"ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„ØªØ­ÙˆÙŠÙ„",description:`Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„ÙŠÙˆÙ…: ${(lt-vt-ze).toLocaleString()} Ø¬.Ù…`,variant:"destructive"}),s();return}const Ie=new Date,Ze=Y.filter(ie=>ie.type==="send"&&String(ie.status||"").toLowerCase()==="pending"&&ie.fromWallet===R&&new Date(ie.createdAt).getMonth()===Ie.getMonth()&&new Date(ie.createdAt).getFullYear()===Ie.getFullYear()).reduce((ie,tt)=>ie+Number(tt.sentAmount??tt.transferredAmount??tt.amount??0),0),ct=Number((te==null?void 0:te.monthlyTransferLimit)??2e5),Ya=Number((te==null?void 0:te.monthlyTransferUsed)??0);if(Ya+Ze+Number(d)>ct){f({title:"ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„ØªØ­ÙˆÙŠÙ„",description:`Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±: ${(ct-Ya-Ze).toLocaleString()} Ø¬.Ù…`,variant:"destructive"}),s();return}p={success:!0,newCashBalance:we,newWalletBalances:ee}}}else{const k=D||((ra=O.find(ie=>ie.isDefault))==null?void 0:ra.id)||((Qa=O[0])==null?void 0:Qa.id),R=G??await ja.getWalletLimits(k),te=new Date().toDateString(),Se=Y.filter(ie=>ie.type==="withdraw"&&String(ie.status||"").toLowerCase()==="pending"&&ie.fromWallet===k&&new Date(ie.createdAt).toDateString()===te).reduce((ie,tt)=>ie+Number(tt.withdrawnAmount??tt.amount??0),0),ze=Number((R==null?void 0:R.dailyWithdrawLimit)??1e5),lt=Number((R==null?void 0:R.dailyWithdrawUsed)??0);if(lt+Se+Number(d)>ze){f({title:"ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„Ø³Ø­Ø¨",description:`Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„ÙŠÙˆÙ…: ${(ze-lt-Se).toLocaleString()} Ø¬.Ù…`,variant:"destructive"}),s();return}const vt=new Date,Ie=Y.filter(ie=>ie.type==="withdraw"&&String(ie.status||"").toLowerCase()==="pending"&&ie.fromWallet===k&&new Date(ie.createdAt).getMonth()===vt.getMonth()&&new Date(ie.createdAt).getFullYear()===vt.getFullYear()).reduce((ie,tt)=>ie+Number(tt.withdrawnAmount??tt.amount??0),0),Ze=Number((R==null?void 0:R.monthlyWithdrawLimit)??2e5),ct=Number((R==null?void 0:R.monthlyWithdrawUsed)??0);if(ct+Ie+Number(d)>Ze){f({title:"ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„Ø³Ø­Ø¨",description:`Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±: ${(Ze-ct-Ie).toLocaleString()} Ø¬.Ù…`,variant:"destructive"}),s();return}p={success:!0,newCashBalance:Math.round((Number(we)-Number(d))*100)/100,newWalletBalances:ee}}else L==="transfer"?p=await is.processTransfer({amount:d,currentCashBalance:we,currentWalletBalances:ee,wallets:O,selectedWalletId:D,skipRemoteLimitsCheck:!1,nonBlockingUsageUpdate:!0}):p=await is.processWithdraw({amount:d,currentCashBalance:we,currentWalletBalances:ee,wallets:O,selectedWalletId:D,skipRemoteLimitsCheck:!1,nonBlockingUsageUpdate:!0});if(!p.success){f({title:"ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©",description:p.error||p.message,variant:"destructive"}),s();return}let P=g?u?p.newCashBalance:we:p.newCashBalance,z=g?ee:p.newWalletBalances;if(!g&&L==="transfer"&&v>0){const k=Number(z[D]||0);z={...z,[D]:Math.round((k-Number(v))*100)/100}}if(g&&m){const k=O.find(Se=>Se.id===D)??O.find(Se=>Se.isDefault)??O[0],R=(k==null?void 0:k.id)||D;if(R!==D)try{Bs(R)}catch{}const te=Number(ee[R]||0);z={...ee,[R]:Math.round((te-Number(d)-Number(v))*100)/100}}if((m||u)&&_t&&!kc){const k={id:`DEBT-${Date.now()}`,debtorName:_t.debtorName,amount:_t.amount,reason:_t.notes||"",customerId:_t.customerId,mobile:_t.mobile,status:"pending",createdAt:new Date};x=k.id;const R=[k,...he];Ge(R);try{if(await Dt(R),a!=null&&a.uid){const te=ge(W,"debts",k.id),Se={...k,userId:a.uid,shopId:_||(h==null?void 0:h.shopId)||null,lastUpdated:new Date().toISOString()};Object.keys(Se).forEach(ze=>Se[ze]===void 0&&delete Se[ze]),await At(te,Se,{merge:!0})}}catch(te){console.error("âš ï¸ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ù…Ø¤Ø¬Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø£Ùˆ Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹:",te)}f({title:"ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙŠÙ†",description:"Ø£Ø¶ÙŠÙ Ø¥Ù„Ù‰ Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ø¯ÙŠÙˆÙ† Ø­ØªÙ‰ ÙŠØªÙ… Ø§Ù„Ø³Ø¯Ø§Ø¯",variant:"default"})}if(!g){const k=Math.max(0,Number(l))+Math.max(0,Number(v));k>0&&(P=Math.round((P+k)*100)/100,console.log(`ğŸ’° ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆÙ„Ø©/Ø±Ø³ÙˆÙ… ${k} Ø¬Ù†ÙŠÙ‡ Ù„Ø¯Ø±Ø¬ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©`))}console.log("âš¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹ Ø¨Ø¯ÙˆÙ† Ø­Ø¬Ø¨ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… startTransition...");const Ne="temp_"+Date.now()+"_"+Math.random().toString(36).substring(7),$e={shopId:_||(h==null?void 0:h.shopId)||(a==null?void 0:a.uid)||"default-shop",lineId:D||"default-line",walletId:D||void 0,merchantUserId:(a==null?void 0:a.uid)||null,provider:"vodafone_cash",txnType:L==="transfer"?"send":"receive",originType:L==="transfer"?"transfer":"withdraw",amount:d,commission:S,fee:v,profit:0,senderMsisdn:Ut,receiverMsisdn:L==="transfer"?ht:Ut,note:L==="transfer"?void 0:da&&da.trim()!==""?da.trim():void 0,status:g?"pending":"confirmed",linkedDebtId:x||void 0,createdBy:(a==null?void 0:a.uid)||null,walletEffectAppliedOnCreation:!1,cashEffectAppliedOnCreation:!!(g&&u),limitsReservedOnCreation:!!g,limitReservedType:L==="transfer"?"transfer":"withdraw",profitAddedOnCreation:!1},re={...$e,id:Ne,status:g?"pending":"completed",commissionMode:L==="transfer"||xe?"add":"deduct",totalCharged:L==="transfer"?d+S+v:xe?d+l:d,walletEffectAppliedOnCreation:!1,cashEffectAppliedOnCreation:!!(g&&u),limitsReservedOnCreation:!!g,limitReservedType:L==="transfer"?"transfer":"withdraw",sentAmount:L==="transfer"?d:void 0,transferredAmount:L==="transfer"?d:void 0,withdrawnAmount:L==="withdraw"?d:void 0,senderName:L==="withdraw"&&ys.trim()!==""?ys.trim():void 0,createdAt:new Date,type:L==="transfer"?"send":"withdraw",senderPhone:Ut||"",receiverPhone:ht||""};try{$t.current=[re,...$t.current],me.setQueryData(["recentTransactions",a==null?void 0:a.uid,_||"main"],k=>!k||!Array.isArray(k)?[re]:[re,...k])}catch(k){console.error("Error in optimistic update:",k)}if(D&&G)try{const k=L==="transfer",R={...G};k?(R.dailyTransferUsed=(R.dailyTransferUsed||0)+d,R.monthlyTransferUsed=(R.monthlyTransferUsed||0)+d):(R.dailyWithdrawUsed=(R.dailyWithdrawUsed||0)+d,R.monthlyWithdrawUsed=(R.monthlyWithdrawUsed||0)+d),za(R)}catch(k){console.error("Error in optimistic limit update:",k)}const pe=[re,...Y];$.startTransition(()=>{Oe(P),Me(z),yt(pe)});try{setTimeout(()=>{try{localStorage.setItem(di(),JSON.stringify(pe))}catch{}},0)}catch{}if(se)try{const k=new Date,R=k.getFullYear(),te=String(k.getMonth()+1).padStart(2,"0"),Se=String(k.getDate()).padStart(2,"0"),ze=`zeroPlanDailyConfirmCount:${(a==null?void 0:a.uid)||"default"}:${R}-${te}-${Se}`,lt=localStorage.getItem(ze),vt=lt&&parseInt(lt,10)||0;localStorage.setItem(ze,String(vt+1))}catch{}setTimeout(()=>{try{const k=new Date().toISOString();localStorage.setItem(je(),P.toString()),localStorage.setItem(je()+"_lastUpdated",k),localStorage.setItem(Te(),JSON.stringify(z)),localStorage.setItem(Te()+"_lastUpdated",k)}catch{}},0);try{if(a!=null&&a.uid){const k=O.find(Ha=>Ha.id===D)??O.find(Ha=>Ha.isDefault)??O[0],R=(k==null?void 0:k.id)||D,te=Number(z[R]||0),Se=String((k==null?void 0:k.phone)||Ut||"").trim(),ze=String(ht||"").trim(),lt=Number(v)>0,vt=L==="transfer"?"ğŸŸ¢":"ğŸ”´",Ie=Number(S)>0?`${Number(S)} Ø¬Ù†ÙŠÙ‡`:"0 Ø¬Ù†ÙŠÙ‡",Ze=lt?` Ùˆ Ø±Ø³ÙˆÙ… ${Number(v)} Ø¬Ù†ÙŠÙ‡`:"",ct=L==="transfer"?`${vt} ØªÙ… ØªØ­ÙˆÙŠÙ„ Ù…Ø¨Ù„Øº ${Number(d)} Ø¬Ù†ÙŠÙ‡ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© ${Se} Ø¥Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© ${ze} ÙˆØªÙ… Ø£Ø®Ø° Ø¹Ù…ÙˆÙ„Ø© ${Ie}${Ze}. Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ ÙÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø©: ${te} Ø¬Ù†ÙŠÙ‡. Ø§Ù„ÙÙ„ÙˆØ³ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${Number(P)} Ø¬Ù†ÙŠÙ‡.`:`${vt} ØªÙ… Ø§Ù„Ø³Ø­Ø¨ Ù…Ø¨Ù„Øº ${Number(d)} Ø¬Ù†ÙŠÙ‡ Ù…Ù† Ø§Ù„Ø¯Ø±Ø¬ Ø¥Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© ${Se} ÙˆØªÙ… Ø£Ø®Ø° Ø¹Ù…ÙˆÙ„Ø© ${Ie}${Ze}. Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ ÙÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø©: ${te} Ø¬Ù†ÙŠÙ‡. Ø§Ù„ÙÙ„ÙˆØ³ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${Number(P)} Ø¬Ù†ÙŠÙ‡.`,Ya=a!=null&&a.uid?`tg_last_msg_${a.uid}`:"tg_last_msg",ie=Date.now();let tt=!0;try{const Ha=localStorage.getItem(Ya);if(Ha){const Ga=JSON.parse(Ha),Om=String((Ga==null?void 0:Ga.text)||""),Lm=Number((Ga==null?void 0:Ga.at)||0);Om===ct&&ie-Lm<5e3&&(tt=!1)}}catch{}if(tt){Promise.resolve(ba.send(a.uid,ct)).catch(()=>{});try{localStorage.setItem(Ya,JSON.stringify({text:ct,at:ie}))}catch{}}}}catch{}if((async()=>{try{console.log("ğŸ”„ Ø¨Ø¯Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ÙÙŠ Firebase ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©...");const k={...$e},R={...re},{ProfitService:te}=await F(async()=>{const{ProfitService:Ie}=await import("./profitService-RoVQsoFR.js");return{ProfitService:Ie}},__vite__mapDeps([47,0,1]),import.meta.url),Se=te.calculateProfitFromTransaction({...R,status:"confirmed"});Se>0&&(te.addProfit(Se,a==null?void 0:a.uid),k.profitAddedOnCreation=!0,R.profitAddedOnCreation=!0,console.log("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø¨Ø­:",Se,"Ø¬Ù†ÙŠÙ‡"));const ze=await nu.create(k);if(D)try{const Ie=await ja.updateUsage(D,d,L==="transfer"?"transfer":"withdraw");Ie&&za(Ie);try{window.dispatchEvent(new CustomEvent("walletLimitsUpdated",{detail:{walletId:D}}))}catch{}}catch{}await Promise.all([...a!=null&&a.uid?[K.updateUserData(a.uid,{cashBalance:P,walletBalances:z,lastUpdated:new Date().toISOString()})]:[],...a!=null&&a.uid?[K.saveUserTransaction(a.uid,{...R,transactionId:ze,transactionType:L,fromWallet:D,toWallet:L==="transfer"?m?null:"cash":null,cashierName:J&&((A==null?void 0:A.name)||(A==null?void 0:A.username))||"Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",linkedDebtId:x||void 0,description:`${L==="transfer"?"ØªØ­ÙˆÙŠÙ„":"Ø³Ø­Ø¨"} ${d} Ù…Ù† ${D} ${L==="transfer"?m?"":"Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¬ Ø§Ù„Ù†Ù‚Ø¯ÙŠ":""} â€” Ø¹Ù…ÙˆÙ„Ø©: ${l} (${L==="transfer"||xe?"Ù…Ø¶Ø§ÙØ©":"Ù…Ø®ØµÙˆÙ…Ø©"})${v>0?` â€” Ø±Ø³ÙˆÙ…: ${v}`:""}${g?" â€” Ø¯ÙŠÙ† Ù…Ø¤Ø¬Ù„ (Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©)":""}`})]:[]]),console.log("âœ… ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase Ø¨Ù†Ø¬Ø§Ø­");try{const Ie={...re,id:ze};$t.current=$t.current.map(Ze=>Ze.id===Ne?Ie:Ze),me.setQueryData(["recentTransactions",a==null?void 0:a.uid,_||"main"],Ze=>!Ze||!Array.isArray(Ze)?[Ie]:Ze.map(ct=>ct.id===Ne?Ie:ct)),$.startTransition(()=>{yt(Ze=>Ze.map(ct=>ct.id===Ne?Ie:ct))})}catch(Ie){console.error("Error updating query cache with real ID:",Ie)}setTimeout(()=>{try{console.log("ğŸ”„ ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ø¬Ù„ (10 Ø«ÙˆØ§Ù†ÙŠ) Ù„Ø¶Ù…Ø§Ù† ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..."),me.invalidateQueries({queryKey:["recentTransactions",a==null?void 0:a.uid,_||"main"]}),me.invalidateQueries({queryKey:["dashboardData",_||(h==null?void 0:h.shopId)]}),D&&(me.invalidateQueries({queryKey:["walletLimits",D]}),bi())}catch(Ie){console.error("Error in delayed refresh:",Ie)}},1e4);const lt=`userData_${a==null?void 0:a.uid}`,vt={cashBalance:P,walletBalances:z,lastUpdated:new Date().toISOString()};localStorage.setItem(lt,JSON.stringify(vt))}catch(k){console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ÙÙŠ Firebase (ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©):",k);try{a!=null&&a.uid&&K.saveLocalReceipt(a.uid,{...transactionDataForUser,transactionType:L,fromWallet:D,toWallet:L==="transfer"?m?null:"cash":null,cashierName:J&&((A==null?void 0:A.name)||(A==null?void 0:A.username))||"Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",linkedDebtId:x||void 0,description:`${L==="transfer"?"ØªØ­ÙˆÙŠÙ„":"Ø³Ø­Ø¨"} ${d} Ù…Ù† ${D} ${L==="transfer"?m?"":"Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¬ Ø§Ù„Ù†Ù‚Ø¯ÙŠ":""} â€” Ø¹Ù…ÙˆÙ„Ø©: ${l} (${L==="transfer"||xe?"Ù…Ø¶Ø§ÙØ©":"Ù…Ø®ØµÙˆÙ…Ø©"})${v>0?` â€” Ø±Ø³ÙˆÙ…: ${v}`:""}${g?" â€” Ø¯ÙŠÙ† Ù…Ø¤Ø¬Ù„ (Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©)":""}`})}catch{}f({title:"ØªØ­Ø°ÙŠØ±",description:"ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ø­Ù„ÙŠØ§Ù‹ØŒ Ù„ÙƒÙ† ÙØ´Ù„Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…. Ø³ØªØªÙ… Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.",variant:"destructive"})}})(),L==="transfer"){Ma(!0);const k=Number(n)+Number(l)+Math.max(0,Number(v));Cr({type:"transfer",amount:Math.max(0,Math.round(k*100)/100)}),rd({receiver:ht,amount:n}),tr(null),ua(!0),setTimeout(()=>{Ma(!1)},2e3)}else{js(!0);const k=xe?Number(n):Math.max(0,Math.round((Number(n)-Number(l))*100)/100);Cr({type:"withdraw",amount:Math.max(0,Math.round(k*100)/100)}),ua(!0),setTimeout(()=>{js(!1)},2e3)}xs(""),La(""),Xi(""),eo(""),pr(null),ur(""),ma(""),ao(""),so(!1)},qn=$.useMemo(()=>new Intl.DateTimeFormat("ar-EG"),[]),Al=$.useMemo(()=>new Intl.DateTimeFormat("ar-EG",{hour:"2-digit",minute:"2-digit"}),[]),Im=$.useMemo(()=>{try{return he.reduce((t,s)=>{if(s.type==="debtor")return t;const n=Number(s.paidAmount||0),r=Math.max(0,Number(s.amount||0)-n);return t+r},0)}catch{return 0}},[he]),Ni=$.useMemo(()=>vl().filter(s=>Ft==="all"?!0:Ft==="send"?s.type==="send":Ft==="receive"?s.type==="receive":Ft==="withdraw"?s.type==="withdraw":Ft!=="deleted"),[vl,Ft]),Cm=()=>{if(Sr==="daily"){const t=st.resetReportsManually("daily",Y,a==null?void 0:a.uid);bs(!1),f({title:"ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©",description:`ØªÙ… Ø¥Ø®ÙØ§Ø¡ ${t.length} Ù…Ø¹Ø§Ù…Ù„Ø© Ù…Ù† ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ… (Ø§Ù„Ø­Ø¯ÙˆØ¯ Ù„Ù… ØªØªØ£Ø«Ø±)`})}else{const t=st.resetReportsManually("monthly",Y,a==null?void 0:a.uid);bs(!1),f({title:"ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©",description:`ØªÙ… Ø¥Ø®ÙØ§Ø¡ ${t.length} Ù…Ø¹Ø§Ù…Ù„Ø© Ù…Ù† ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø± (Ø§Ù„Ø­Ø¯ÙˆØ¯ Ù„Ù… ØªØªØ£Ø«Ø±)`})}},Am=()=>Sr==="daily"?"ØªØµÙÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©":"ØªØµÙÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©",Tm=()=>Sr==="daily"?"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…":"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø´Ù‡Ø±",_m=t=>{dl(t),Xr(!0)},Em=t=>{const s=we,n=Number(t)-Number(s);Oe(t);const r=new Date().toISOString();localStorage.setItem(je(),t.toString()),localStorage.setItem(je()+"_lastUpdated",r),Ho(!1);const i={cashBalance:t,lastUpdated:r},o=`userData_${a==null?void 0:a.uid}`;try{localStorage.setItem(o,JSON.stringify(i))}catch{}const l=[];if(a!=null&&a.uid){l.push(K.updateUserData(a.uid,i).then(()=>{try{localStorage.removeItem(o)}catch{}}).catch(()=>{}));const d=`${n>0?"CASHADD":"CASHDEDUCT"}-${(a==null?void 0:a.uid)||"anon"}-${Date.now()}`,p=n>0?{txnType:"cash_addition",type:"cash_addition",amount:n,status:"confirmed",senderMsisdn:"Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©",receiverMsisdn:"",reference:d,title:"Ø¥ÙŠØµØ§Ù„ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©",merchantUserId:a.uid,createdBy:a.uid,shopId:(h==null?void 0:h.shopId)||void 0}:n<0?{amount:Math.abs(n),status:"completed",title:"Ø§ÙŠØµØ§Ù„ Ø®ØµÙ… Ù…Ù† Ø§Ù„ÙÙ„ÙˆØ³ Ø§Ù„Ù†Ù‚Ø¯ÙŠÙ‡",merchantUserId:a.uid,createdBy:a.uid,shopId:(h==null?void 0:h.shopId)||void 0}:null;p&&l.push(K.saveUserTransaction(a.uid,p));const m=h==null?void 0:h.shopId;if(m){const u=ge(W,"dashboardData",m);l.push(It(u,{cashBalance:t}))}}Promise.allSettled(l).then(()=>{}).catch(()=>{}),f({title:n>0?"ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©":n<0?"ØªÙ… Ø®ØµÙ… Ù†Ù‚Ø¯ÙŠØ©":"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ",description:n!==0?`Ø§Ù„ØªØºÙŠÙŠØ±: ${Math.abs(n)} Ø¬Ù†ÙŠÙ‡ØŒ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${t} Ø¬Ù†ÙŠÙ‡`:`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ Ø¥Ù„Ù‰ ${t} Ø¬Ù†ÙŠÙ‡`})},km=async t=>{var l;if(!gt){console.warn("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ù…Ø­ÙØ¸Ø© Ù…Ø­Ø¯Ø¯ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯");return}const s={...ee,[gt]:t};Me(s);const n=new Date().toISOString(),r={walletBalances:s,lastUpdated:n},i=`userData_${a==null?void 0:a.uid}`;try{localStorage.setItem(i,JSON.stringify(r)),localStorage.setItem(Te(),JSON.stringify(s)),localStorage.setItem(Te()+"_lastUpdated",n),localStorage.setItem(`walletBalances_backup_${n}`,JSON.stringify(s))}catch{}try{a!=null&&a.uid&&await K.updateUserData(a.uid,r)}catch(d){console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© ÙÙŠ Firebase:",d)}Go(!1);const o=((l=O.find(d=>d.id===gt))==null?void 0:l.name)||"Ø§Ù„Ù…Ø­ÙØ¸Ø©";f({title:"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©",description:`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ ${o} Ø¥Ù„Ù‰ ${t.toLocaleString()} Ø¬Ù†ÙŠÙ‡`})},Pm=async t=>{var s;if(console.log("ğŸ’° Ø¨Ø¯Ø¡ ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©"),console.log("ğŸ“Š Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø­Ø±Ø±Ø©:",gt),console.log("ğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¶Ø§Ù/Ø§Ù„Ù…Ø®ØµÙˆÙ…:",t),gt){const n=ee[gt]||0;console.log("ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ:",n);const r=n+t;console.log("ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯:",r);const i={...ee,[gt]:r};console.log("ğŸ“Š Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©:",i),Me(i);const o=new Date().toISOString(),l={walletBalances:i,lastUpdated:o},d=`userData_${a==null?void 0:a.uid}`;localStorage.setItem(d,JSON.stringify(l)),localStorage.setItem(Te(),JSON.stringify(i)),localStorage.setItem(`walletBalances_backup_${o}`,JSON.stringify(i));try{if(a!=null&&a.uid){console.log("ğŸ”„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase...");try{await K.updateUserData(a.uid,l),console.log("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø£Ø±ØµØ¯Ø© ÙÙŠ Firebase Ø¨Ù†Ø¬Ø§Ø­"),setTimeout(()=>{localStorage.removeItem(d),console.log("ğŸ§¹ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ø¨Ø¹Ø¯ Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©")},6e4)}catch(g){console.error("âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase:",g),H(!0)}}else console.log("âš ï¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ØŒ Ø­ÙØ¸ ÙÙŠ localStorage"),localStorage.setItem(Te(),JSON.stringify(i));const p=((s=O.find(g=>g.id===gt))==null?void 0:s.name)||"Ø§Ù„Ù…Ø­ÙØ¸Ø©",m=t>0?"Ø¥Ø¶Ø§ÙØ©":"Ø®ØµÙ…",u=Math.abs(t);f({title:`ØªÙ… ${m} Ù…Ø¨Ù„Øº ${m==="Ø¥Ø¶Ø§ÙØ©"?"Ø¥Ù„Ù‰":"Ù…Ù†"} Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©`,description:`ØªÙ… ${m} ${u} Ø¬Ù†ÙŠÙ‡ ${m==="Ø¥Ø¶Ø§ÙØ©"?"Ø¥Ù„Ù‰":"Ù…Ù†"} Ø±ØµÙŠØ¯ ${p}. Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${r.toLocaleString()} Ø¬Ù†ÙŠÙ‡`})}catch(p){if(console.error("âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase:",p),localStorage.setItem(Te(),JSON.stringify(i)),a!=null&&a.uid){const m=`userData_${a.uid}`,u={walletBalances:i,lastUpdated:new Date().toISOString()};localStorage.setItem(m,JSON.stringify(u)),H(!0)}f({title:"ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹",description:"ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ ÙˆØ³ÙŠØªÙ… Ù…Ø²Ø§Ù…Ù†ØªÙ‡Ø§ Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ø§Ø­Ù‚Ø§Ù‹",variant:"default"})}}else console.log("âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ù…Ø­ÙØ¸Ø© Ù„Ù„ØªØ­Ø±ÙŠØ±");setTimeout(()=>{const r=Object.keys(localStorage).filter(i=>i.startsWith("walletBalances_backup_")).sort();r.length>5&&r.slice(0,r.length-5).forEach(o=>{localStorage.removeItem(o),console.log("ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©:",o)})},5e3),Xr(!1),dl("")};return console.log("ğŸ”¥ UserDashboardPage - Render conditions:",{isCheckingActivation:ar,isUserActive:us,showActivationModal:Cc}),ar?(console.log("ğŸ”¥ UserDashboardPage - Showing loading screen"),e.jsx(Km,{})):(console.log("ğŸ”¥ UserDashboardPage - Rendering main dashboard"),e.jsxs("div",{id:"dashboard-content-container",className:"user-dashboard h-[100dvh] overflow-y-auto px-2 sm:px-4 pt-2 sm:py-4 relative bg-gray-100 bg-[radial-gradient(140%_140%_at_10%_10%,#e5e7eb_0%,#d1d5db_45%,#9ca3af_100%)] no-scrollbar",children:[e.jsx(yh,{userId:a==null?void 0:a.uid}),e.jsxs("div",{className:"max-w-screen-2xl mx-auto grid grid-cols-1 xl:grid-cols-3 gap-4 xl:gap-6 relative z-10",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-2 sm:gap-3 fade-in-up",children:[!As&&e.jsxs(zt,{className:"bg-gray-100 border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 relative overflow-hidden",children:[e.jsx(va,{className:"pb-2 px-3 pt-3 relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Na,{className:"text-xs font-bold text-gray-900 flex items-center gap-1.5",children:[e.jsx("div",{className:"p-1 rounded-md bg-gradient-to-br from-gray-100 to-gray-200",children:e.jsx(Yl,{className:"h-3.5 w-3.5 text-gray-700"})}),e.jsx("span",{className:"text-xs",children:"Ø§Ù„Ø´Ù‡Ø±"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>{po("monthly"),bs(!0)},className:"h-7 w-7 p-0 bg-transparent hover:bg-red-50 text-red-600 hover:text-red-700 rounded-full transition-colors duration-200",title:"ØªØµÙÙŠØ± Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø´Ù‡Ø±",children:e.jsx(Wt,{className:"h-3 w-3"})}),e.jsx("div",{className:"p-1 bg-green-50 rounded-full border border-green-100",children:e.jsx(zs,{className:"h-3 w-3 text-green-600"})})]})]})}),!As&&e.jsxs(qt,{className:"pt-0 px-2 pb-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-0 rounded-lg overflow-hidden border border-gray-200 divide-x divide-y divide-gray-200 bg-white",children:[e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-blue-600",children:"Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-blue-800 mt-0.5 sm:mt-0",children:Ka.totalTransactions})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-gray-600",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-gray-900 mt-0.5 sm:mt-0",children:Ka.totalAmount.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-red-600",children:"Ø§Ù„Ù…Ø³Ø­ÙˆØ¨"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-red-800 mt-0.5 sm:mt-0",children:Ka.totalWithdrawn.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-green-600",children:"Ø§Ù„Ù…Ø±Ø³Ù„"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-green-800 mt-0.5 sm:mt-0",children:Ka.totalSent.toFixed(2)})]})]}),e.jsxs("div",{className:"mt-2 rounded-lg border border-gray-100 bg-white px-2 py-1.5 flex items-center justify-between",children:[e.jsx("span",{className:"text-[12px] font-bold text-yellow-600",children:"Ø§Ù„Ø£Ø±Ø¨Ø§Ø­"}),e.jsx($u,{userId:a==null?void 0:a.uid,transactions:Y})]})]}),pd&&e.jsx("div",{className:"absolute inset-0 z-20 backdrop-blur-sm bg-amber-50/60 flex items-center justify-center p-0 pointer-events-auto",children:e.jsxs(w,{size:"sm",variant:"ghost",onClick:async()=>{if(se){f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø± ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"});return}xn(!0)},className:"px-4 py-2 rounded-full bg-white border border-gray-100 text-gray-900 shadow-sm hover:bg-gray-50 hover:shadow-md transition-all duration-200 flex items-center gap-2 text-xs font-medium",title:"Ø¹Ø±Ø¶ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø± (ÙŠØªØ·Ù„Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ)",children:[e.jsx("span",{children:"Ø¹Ø±Ø¶ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±"}),e.jsx(os,{className:"h-3.5 w-3.5 text-gray-600"})]})})]}),e.jsx(Et,{open:gd,onOpenChange:xn,mode:"verify",title:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„ÙØªØ­ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±",description:"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ù‡Ø± Ø¥Ù„Ø§ Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",onSuccess:()=>{if(se){f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø± ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}),xn(!1),So(!0);return}So(!1),xn(!1)},userId:a==null?void 0:a.uid}),(it==null?void 0:it.planType)!==Ct.TAHWEELA&&e.jsxs(zt,{className:"bg-gray-50 border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 relative overflow-hidden",children:[e.jsx(va,{className:"pb-2 px-3 pt-3 relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Na,{className:"text-sm font-bold text-gray-900 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 rounded-md bg-gradient-to-br from-gray-100 to-gray-200",children:e.jsx(Yl,{className:"h-4 w-4 text-gray-700"})}),e.jsx("span",{className:"text-sm",children:"Ø§Ù„ÙŠÙˆÙ…"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>{po("daily"),bs(!0)},className:"h-8 w-8 p-0 bg-transparent hover:bg-red-50 text-red-600 hover:text-red-700 rounded-full transition-colors duration-200",title:"ØªØµÙÙŠØ± Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…",children:e.jsx(Wt,{className:"h-3.5 w-3.5"})}),e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>fd(t=>!t),className:"h-8 w-8 p-0 bg-transparent hover:bg-gray-100 text-gray-600 hover:text-blue-600 rounded-full transition-colors duration-200",title:As?"ØªÙˆØ³ÙŠØ¹ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ø´Ù‡Ø±":"Ø·ÙŠ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ø´Ù‡Ø±",children:As?e.jsx(mu,{className:"h-3.5 w-3.5"}):e.jsx(uu,{className:"h-3.5 w-3.5"})}),e.jsx("div",{className:"p-2 bg-green-50 rounded-full border border-green-100",children:e.jsx(zs,{className:"h-3.5 w-3.5 text-green-600"})})]})]})}),!As&&e.jsxs(qt,{className:"pt-0 px-2 pb-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-0 rounded-lg overflow-hidden border border-gray-200 divide-x divide-y divide-gray-200 bg-white",children:[e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-blue-600",children:"Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-blue-800 mt-0.5 sm:mt-0",children:zn.totalTransactions})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-gray-600",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-gray-900 mt-0.5 sm:mt-0",children:zn.totalAmount.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-red-600",children:"Ø§Ù„Ù…Ø³Ø­ÙˆØ¨"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-red-800 mt-0.5 sm:mt-0",children:zn.totalWithdrawn.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-green-600",children:"Ø§Ù„Ù…Ø±Ø³Ù„"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-green-800 mt-0.5 sm:mt-0",children:zn.totalSent.toFixed(2)})]})]}),e.jsxs("div",{className:"mt-2 rounded-lg border border-gray-100 bg-white px-2 py-1.5 flex items-center justify-between",children:[e.jsx("span",{className:"text-[12px] font-bold text-yellow-600",children:"Ø§Ù„Ø£Ø±Ø¨Ø§Ø­"}),e.jsx(qu,{userId:a==null?void 0:a.uid,transactions:Y})]})]}),vd&&e.jsx("div",{className:"absolute inset-0 z-20 backdrop-blur-sm bg-white/60 flex items-center justify-center p-0 pointer-events-auto",children:e.jsxs(w,{size:"sm",variant:"ghost",onClick:()=>_r(!0),className:"px-4 py-2 rounded-full bg-white border border-gray-100 text-gray-900 shadow-sm hover:bg-gray-50 hover:shadow-md transition-all duration-200 flex items-center gap-2 text-xs font-medium",title:"Ø¹Ø±Ø¶ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ… (ÙŠØªØ·Ù„Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ)",children:[e.jsx("span",{children:"Ø¹Ø±Ø¶ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…"}),e.jsx(os,{className:"h-3.5 w-3.5 text-gray-600"})]})})]}),e.jsx(Et,{open:Nd,onOpenChange:_r,mode:"verify",title:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„ÙØªØ­ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…",description:"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ… Ø¥Ù„Ø§ Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",onSuccess:()=>{Co(!1),_r(!1)},userId:a==null?void 0:a.uid})]}),e.jsxs(zt,{className:"balance-bar bg-gray-200 border-2 border-gray-200/50 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 group relative overflow-hidden   transform fade-in-up mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-500/5 via-blue-500/5 to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),e.jsx("div",{className:"absolute top-0 left-0 w-40 h-40 bg-gradient-to-br from-emerald-300/10 to-transparent rounded-full -translate-y-20 -translate-x-20 group-hover:scale-150 transition-transform duration-200"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-blue-300/10 to-transparent rounded-full translate-y-20 translate-x-20 group-hover:scale-150 transition-transform duration-200"}),e.jsx(qt,{className:"p-2 relative z-10",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:[e.jsxs("div",{className:"bg-white border border-gray-200 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/cash relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-500/10 to-transparent opacity-0 group-hover/cash:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex flex-col relative z-10 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-emerald-100 to-emerald-200 rounded-lg shadow-sm",children:e.jsx(Jt,{className:"h-1.5 w-1.5 text-emerald-600"})}),e.jsx("span",{className:"text-[11px] font-extrabold text-emerald-800",children:"Ø§Ù„ÙÙ„ÙˆØ³ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-green-600 hover:bg-green-50 transition-colors",onClick:()=>Ls(!0),children:e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-emerald-600 hover:bg-emerald-50 transition-colors",onClick:()=>ul(!0),title:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙÙ„ÙˆØ³ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©",children:e.jsx(Ql,{className:"h-4 w-4"})}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-red-600 hover:bg-red-50 transition-colors",onClick:()=>Un(!0),children:e.jsx(Wt,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-0.5",children:e.jsxs("span",{className:"text-[14px] sm:text-xl font-bold text-emerald-800 bg-gradient-to-r from-emerald-100 to-emerald-200 px-1 py-0.5 rounded-lg shadow-sm block w-fit",children:[we.toLocaleString("en-US")," Ø¬Ù†ÙŠÙ‡"]})})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/wallet relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/10 to-transparent opacity-0 group-hover/wallet:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex flex-col relative z-10 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-blue-100 to-blue-200 rounded-lg shadow-sm",children:e.jsx(ss,{className:"h-1.5 w-1.5 text-blue-600"})}),e.jsx("span",{className:"text-[11px] font-extrabold text-blue-800",children:"Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø¹Ù„ÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-green-600 hover:bg-green-50 transition-colors",onClick:()=>Ln(!0),title:"Ø¥Ø¶Ø§ÙØ© Ø£Ù…ÙˆØ§Ù„ Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø©",children:e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-blue-600 hover:bg-blue-50 transition-colors",onClick:()=>jr(!0),title:"Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø§ÙØ¸",children:e.jsx(ss,{className:"h-4 w-4"})}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-red-600 hover:bg-red-50 transition-colors",onClick:()=>{Mn(!0),Bn("")},title:"ØªØµÙÙŠØ± Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø©",children:e.jsx(Wt,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-0.5",children:e.jsxs("span",{className:"text-[14px] sm:text-xl font-bold text-blue-800 bg-gradient-to-r from-blue-100 to-blue-200 px-1 py-0.5 rounded-lg shadow-sm block w-fit",children:[Object.values(ee).reduce((t,s)=>t+s,0).toLocaleString("en-US")," Ø¬Ù†ÙŠÙ‡"]})})]})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1 bg-white border border-gray-200 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/selwallet relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-transparent opacity-0 group-hover/selwallet:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex flex-col relative z-10 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-indigo-100 to-indigo-200 rounded-lg shadow-sm",children:e.jsx(ss,{className:"h-1.5 w-1.5 text-indigo-600"})}),e.jsx("span",{className:"text-[11px] font-extrabold text-indigo-800",children:"Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ù‡"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-green-600 hover:bg-green-50 transition-colors",onClick:()=>{if(!D){f({title:"Ø§Ø®ØªØ± Ù…Ø­ÙØ¸Ø©",description:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙØ¸Ø© Ù…Ù† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø£ÙˆÙ„Ø§Ù‹",variant:"destructive"});return}_m(D)},title:"Ø¥Ø¶Ø§ÙØ©/Ø®ØµÙ… Ø¥Ù„Ù‰ Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©",children:e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-red-600 hover:bg-red-50 transition-colors",onClick:()=>{if(!D){f({title:"Ø§Ø®ØªØ± Ù…Ø­ÙØ¸Ø©",description:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙØ¸Ø© Ù„ØªØµÙÙŠØ± Ø±ØµÙŠØ¯Ù‡Ø§ ÙÙ‚Ø·",variant:"destructive"});return}jn(!0)},title:"ØªØµÙÙŠØ± Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©",children:e.jsx(Wt,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-0.5",children:e.jsxs("span",{className:"text-[14px] sm:text-xl font-bold text-indigo-800 bg-gradient-to-r from-indigo-100 to-indigo-200 px-1 py-0.5 rounded-lg shadow-sm block w-fit",children:[(D&&ee[D]||0).toLocaleString("en-US")," Ø¬Ù†ÙŠÙ‡"]})})]})]})]})})]}),e.jsxs(zt,{className:"bg-gray-100 border border-gray-200 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 group relative overflow-hidden fade-in-up",children:[e.jsxs(va,{className:`pb-2 px-4 pt-4 relative z-10 ${ye?"sticky top-0 z-20 bg-white/90 backdrop-blur supports-[backdrop-filter]:bg-white/60":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Na,{className:"text-sm font-bold flex items-center gap-2 text-gray-900",children:[!ye&&e.jsx("div",{className:"p-1.5 sm:p-2 bg-gray-100 rounded-lg",children:e.jsx(zs,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5 text-gray-700"})}),e.jsx("span",{className:"text-gray-900",children:"Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!ye&&e.jsxs("div",{className:"flex items-center gap-0.5 bg-gray-100 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[e.jsx(Iu,{className:"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors"}),e.jsx(U,{placeholder:"Ø¨Ø­Ø«...",value:fo,onChange:t=>sd(t.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400"})]}),!ye&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"ØªÙ‚Ø³ÙŠØ·"}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>{if(se||ue){f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø³ÙŠØ· ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©.",variant:"destructive"});return}Ss(!0)},title:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø³ÙŠØ·",children:e.jsx(Jm,{className:"h-5 w-5 text-purple-600"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-green-600 mb-1",children:"Ø´Ø­Ù†"}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-green-100 text-green-600 hover:bg-green-200 border border-green-200 ring-3 ring-green-300 transition-all duration-200 hover:scale-105 active:bg-green-600 active:text-white active:border-green-600",onClick:()=>{f({title:"Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹."})},title:"Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯",children:e.jsx(Ml,{className:"h-5 w-5 text-green-600"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"Ø­Ø§Ø³Ø¨Ø©"}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>Ar(!0),title:"Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø©",children:e.jsx(Su,{className:"h-5 w-5 text-purple-600"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"ÙƒØ±ÙˆØª"}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>{se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©.",variant:"destructive"}):Ds(!0)},title:"ÙƒØ±ÙˆØª Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†",children:e.jsx(Ml,{className:"h-5 w-5 text-purple-600"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 mb-1",children:"ØªÙ‚Ø§Ø±ÙŠØ±Ùƒ"}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600",onClick:()=>{if(se||ue){f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©.",variant:"destructive"});return}nl(!0)},title:"ØªÙ‚Ø§Ø±ÙŠØ±Ùƒ",children:e.jsx(Hl,{className:"h-5 w-5 text-blue-600"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-sky-600 mb-1",children:"ØªÙ„Ø¬Ø±Ø§Ù…"}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-sky-100 text-sky-600 hover:bg-sky-200 border border-sky-200 ring-3 ring-sky-300 transition-all duration-200 hover:scale-105 active:bg-sky-600 active:text-white active:border-sky-600",onClick:()=>{se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©.",variant:"destructive"}):xt.hasMasterPin()?yi(!0):Nl()},title:"Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…",children:e.jsx(Lu,{className:"h-5 w-5 text-sky-600"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 mb-1",children:"Ø§Ù„ÙˆØ±Ø¯ÙŠØ©"}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600",onClick:am,title:J&&(A!=null&&A.name||A!=null&&A.username)?`Ø¨Ø±ÙˆÙÙŠÙ„ Ø§Ù„ÙˆØ±Ø¯ÙŠØ©: ${(A==null?void 0:A.name)||(A==null?void 0:A.username)}`:"ÙˆØ±Ø¯ÙŠØ© Ø§Ù„ÙƒØ§Ø´ÙŠØ±",children:e.jsx(qs,{className:"h-5 w-5 text-blue-600"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª"}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>{se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©.",variant:"destructive"}):Ra(!0)},title:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª",children:e.jsx(Ci,{className:"h-5 w-5 text-purple-600"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600",children:"Ø§Ù„Ø¯ÙŠÙˆÙ†"}),he.filter(t=>t.status==="pending").length>0&&e.jsx("span",{className:"h-4 w-4 rounded-full bg-red-600 text-white text-[10px] flex items-center justify-center ring-2 ring-white",children:he.filter(t=>t.status==="pending").length})]}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>{wn()},title:"Ø§Ù„Ø¯ÙŠÙˆÙ†",children:e.jsx(Qm,{className:"h-5 w-5 text-purple-600"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-amber-700 mb-1",children:"Ø§Ù„ØµÙŠØ§Ù†Ø©"}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-amber-100 text-amber-700 hover:bg-amber-200 border border-amber-200 ring-3 ring-amber-300 transition-all duration-200 hover:scale-105 active:bg-amber-600 active:text-white active:border-amber-600",onClick:()=>{se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©.",variant:"destructive"}):Is(!0)},title:"Ø§Ù„ØµÙŠØ§Ù†Ø©",children:e.jsx(Bl,{className:"h-5 w-5 text-amber-700"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-yellow-500 mb-1",children:"Ø§Ù„Ù…ÙƒÙ†Ø©"}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-violet-100 text-violet-700 hover:bg-violet-200 border border-violet-200 ring-3 ring-violet-300 transition-all duration-200 hover:scale-105 active:bg-violet-700 active:text-white active:border-violet-700",onClick:()=>{!bt||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©.",variant:"destructive"}):Cs(!0)},title:"ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ù…ÙƒÙ†Ø©",children:e.jsx(Bu,{className:"h-5 w-5 text-yellow-500"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-orange-600 mb-1",children:"Ù…ØµØ±ÙˆÙØ§Øª"}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-orange-100 text-orange-600 hover:bg-orange-200 border border-orange-200 ring-3 ring-orange-300 transition-all duration-200 hover:scale-105 active:bg-orange-600 active:text-white active:border-orange-600",onClick:()=>{se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©.",variant:"destructive"}):xt.hasMasterPin()?Ea(!0):ca(!0)},title:"Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø­Ù„",children:e.jsx(ji,{className:"h-5 w-5 text-orange-600"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-rose-600 mb-1",children:"Ø§Ù„Ù†ÙˆØ§Ù‚Øµ"}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-rose-100 text-rose-600 hover:bg-rose-200 border border-rose-200 ring-3 ring-rose-300 transition-all duration-200 hover:scale-105 active:bg-rose-600 active:text-white active:border-rose-600",onClick:()=>{se||ue?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·Ø©.",variant:"destructive"}):fs(!0)},title:"Ø§Ù„Ù†ÙˆØ§Ù‚Øµ",children:e.jsx(Ul,{className:"h-5 w-5 text-rose-600"})})]})]})]})]}),!ye&&e.jsx("div",{className:"mt-2 w-full",children:e.jsxs("div",{className:"filters-bar flex items-center justify-center gap-3 bg-gray-100 rounded-md p-3 border border-gray-200",children:[e.jsx(w,{variant:"ghost",size:"sm",className:`btn-filter-send h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${Ft==="send"?"bg-green-600 text-white border-green-600":"text-green-700 border-green-300 hover:bg-green-100"}`,onClick:()=>vr("send"),title:"ØªØµÙÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„",children:"Ø§Ù„ØªØ­ÙˆÙŠÙ„"}),e.jsx(w,{variant:"ghost",size:"sm",className:`btn-filter-withdraw h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${Ft==="withdraw"?"bg-red-600 text-white border-red-600":"text-red-700 border-red-300 hover:bg-red-100"}`,onClick:()=>vr("withdraw"),title:"ØªØµÙÙŠØ© Ø§Ù„Ø³Ø­Ø¨",children:"Ø§Ù„Ø³Ø­Ø¨"}),e.jsx(w,{variant:"ghost",size:"sm",className:`btn-filter-all h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${Ft==="all"?"bg-green-600 text-white border-green-600":"text-green-700 border-green-300 hover:bg-green-100"}`,onClick:()=>vr("all"),title:"Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„",children:"Ø§Ù„ÙƒÙ„"}),e.jsxs("div",{className:"relative ml-1",children:[e.jsxs(w,{variant:"ghost",size:"sm",className:"h-auto px-2 py-1 text-xs text-red-600 hover:bg-red-50 rounded-md font-medium",onClick:()=>Ps(!0),title:"ØªØµÙÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©",children:[e.jsx(Wt,{className:"h-3 w-3 mr-1"}),"ØªØµÙÙŠØ±"]}),um>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"})]})]})})]}),e.jsx(Et,{open:cd,onOpenChange:Ss,mode:"verify",title:"ÙØªØ­ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø³ÙŠØ·",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø³ÙŠØ·",onSuccess:()=>{Ss(!1),jo(!0)}}),e.jsx(dh,{open:dd,onOpenChange:jo}),e.jsx(Et,{open:ym,onOpenChange:yi,mode:"verify",title:"Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…",onSuccess:()=>{yi(!1),Nl()}}),No,e.jsxs(qt,{className:"space-y-2 pt-0 px-4 pb-4 relative z-10",children:[Ni.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(zs,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†"})]}):ye?e.jsx("div",{className:"overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors max-h-[310px]",children:e.jsx("div",{className:"space-y-2 pr-2",children:Ni.map(t=>e.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>Dl(t),children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center shrink-0 ${t.type==="withdraw"?"bg-red-100":"bg-green-100"}`,children:(()=>{const s=t,n=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("Ø¥ÙŠØµØ§Ù„ ØªØ³Ù„ÙŠÙ… ÙˆØ±Ø¯ÙŠØ©"),r=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("Ø¥ÙŠØµØ§Ù„ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©");return n?e.jsx(ji,{className:"h-5 w-5 text-gray-600"}):r?e.jsx(Xe,{className:"h-5 w-5 text-green-600"}):t.type==="withdraw"?e.jsx(rs,{className:"h-5 w-5 text-red-600"}):e.jsx(ql,{className:"h-5 w-5 text-green-600"})})()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"text-base font-bold truncate",children:(()=>{const s=t,n=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("Ø¥ÙŠØµØ§Ù„ ØªØ³Ù„ÙŠÙ… ÙˆØ±Ø¯ÙŠØ©"),r=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("Ø¥ÙŠØµØ§Ù„ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©");return n?e.jsx("span",{className:"text-foreground",children:"ØªØ³Ù„ÙŠÙ… ÙˆØ±Ø¯ÙŠØ©"}):r?e.jsx("span",{className:"text-foreground",children:"Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©"}):t.type==="send"?e.jsx("span",{className:"text-green-600",children:"ØªØ­ÙˆÙŠÙ„ Ø£Ù…ÙˆØ§Ù„"}):e.jsx("span",{className:"text-red-600",children:"Ø³Ø­Ø¨ Ù†Ù‚Ø¯ÙŠ"})})()}),e.jsxs("span",{className:`text-base font-bold whitespace-nowrap ${t.type==="withdraw"?"text-red-600":"text-green-600"}`,children:[t.type==="withdraw"||t.type==="cash_addition"||t.txnType==="cash_addition"?"+":"-"," ",Nt(t.amount)," Ø¬.Ù…"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:(()=>{const s=t,n=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("Ø¥ÙŠØµØ§Ù„ ØªØ³Ù„ÙŠÙ… ÙˆØ±Ø¯ÙŠØ©"),r=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("Ø¥ÙŠØµØ§Ù„ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©"),i=(s==null?void 0:s.note)||(s==null?void 0:s.notes)||"";return n?`Ø¥Ù„Ù‰: ${t.receiverPhone}`:r?i||"Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠØ©":t.type==="send"?e.jsx("span",{dir:"ltr",children:t.receiverPhone}):e.jsx("span",{dir:"ltr",children:t.senderPhone})})()}),e.jsxs("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:[qn.format(t.createdAt instanceof Date?t.createdAt:new Date(t.createdAt))," - ",Al.format(t.createdAt instanceof Date?t.createdAt:new Date(t.createdAt))]})]}),e.jsxs("div",{className:`px-2 py-0.5 rounded-full text-[10px] font-medium flex items-center gap-1 ${t.status==="completed"?t.type==="withdraw"?"bg-red-100 text-red-700":"bg-green-100 text-green-700":t.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[t.status==="completed"&&e.jsx(Kn,{className:"h-3 w-3"}),t.status==="pending"&&e.jsx(Fl,{className:"h-3 w-3"}),t.status==="failed"&&e.jsx($l,{className:"h-3 w-3"}),e.jsx("span",{children:t.status==="completed"?"Ù†Ø§Ø¬Ø­Ø©":t.status==="pending"?"Ù…Ø¹Ø§Ù„Ø¬Ø©":"ÙØ´Ù„Øª"})]})]})]})]},t.id))})}):e.jsx("div",{className:"overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors max-h-[calc(100dvh-300px)]",children:e.jsx("div",{className:"space-y-2 pr-2",children:Ni.map(t=>e.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>Dl(t),children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center shrink-0 ${t.type==="withdraw"?"bg-red-100":"bg-green-100"}`,children:(()=>{const s=t,n=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("Ø¥ÙŠØµØ§Ù„ ØªØ³Ù„ÙŠÙ… ÙˆØ±Ø¯ÙŠØ©"),r=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("Ø¥ÙŠØµØ§Ù„ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©");return n?e.jsx(ji,{className:"h-5 w-5 text-gray-600"}):r?e.jsx(Xe,{className:"h-5 w-5 text-green-600"}):t.type==="withdraw"?e.jsx(rs,{className:"h-5 w-5 text-red-600"}):e.jsx(ql,{className:"h-5 w-5 text-green-600"})})()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"text-base font-bold truncate",children:(()=>{const s=t,n=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("Ø¥ÙŠØµØ§Ù„ ØªØ³Ù„ÙŠÙ… ÙˆØ±Ø¯ÙŠØ©"),r=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("Ø¥ÙŠØµØ§Ù„ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©");return n?e.jsx("span",{className:"text-foreground",children:"ØªØ³Ù„ÙŠÙ… ÙˆØ±Ø¯ÙŠØ©"}):r?e.jsx("span",{className:"text-foreground",children:"Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©"}):t.type==="send"?e.jsx("span",{className:"text-green-600",children:"ØªØ­ÙˆÙŠÙ„ Ø£Ù…ÙˆØ§Ù„"}):e.jsx("span",{className:"text-red-600",children:"Ø³Ø­Ø¨ Ù†Ù‚Ø¯ÙŠ"})})()}),e.jsxs("span",{className:`text-base font-bold whitespace-nowrap ${t.type==="withdraw"?"text-red-600":"text-green-600"}`,children:[t.type==="withdraw"||t.type==="cash_addition"||t.txnType==="cash_addition"?"+":"-"," ",Nt(t.amount)," Ø¬.Ù…"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:(()=>{const s=t,n=(s==null?void 0:s.type)==="report"||String((s==null?void 0:s.title)||"").includes("Ø¥ÙŠØµØ§Ù„ ØªØ³Ù„ÙŠÙ… ÙˆØ±Ø¯ÙŠØ©"),r=String((s==null?void 0:s.type)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.type)||"").toLowerCase()==="add"||String((s==null?void 0:s.txnType)||"").toLowerCase()==="cash_addition"||String((s==null?void 0:s.title)||"").includes("Ø¥ÙŠØµØ§Ù„ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©"),i=(s==null?void 0:s.note)||(s==null?void 0:s.notes)||"";return n?`Ø¥Ù„Ù‰: ${t.receiverPhone}`:r?i||"Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠØ©":t.type==="send"?e.jsx("span",{dir:"ltr",children:t.receiverPhone}):e.jsx("span",{dir:"ltr",children:t.senderPhone})})()}),e.jsxs("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:[qn.format(t.createdAt instanceof Date?t.createdAt:new Date(t.createdAt))," - ",Al.format(t.createdAt instanceof Date?t.createdAt:new Date(t.createdAt))]})]}),e.jsxs("div",{className:`px-2 py-0.5 rounded-full text-[10px] font-medium flex items-center gap-1 ${t.status==="completed"?t.type==="withdraw"?"bg-red-100 text-red-700":"bg-green-100 text-green-700":t.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[t.status==="completed"&&e.jsx(Kn,{className:"h-3 w-3"}),t.status==="pending"&&e.jsx(Fl,{className:"h-3 w-3"}),t.status==="failed"&&e.jsx($l,{className:"h-3 w-3"}),e.jsx("span",{children:t.status==="completed"?"Ù†Ø§Ø¬Ø­Ø©":t.status==="pending"?"Ù…Ø¹Ø§Ù„Ø¬Ø©":"ÙØ´Ù„Øª"})]})]})]})]},t.id))})}),ye&&e.jsxs("div",{className:"mt-2 flex justify-end",children:[e.jsxs(w,{variant:"ghost",size:"sm",className:"h-7 px-2 text-[11px] rounded-full border bg-red-100 text-red-700 border-red-300 hover:bg-red-200",onClick:()=>Ps(!0),title:"ØªØµÙÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©",children:[e.jsx(Wt,{className:"h-3 w-3 mr-1"}),"ØªØµÙÙŠØ±"]}),(a==null?void 0:a.uid)&&localStorage.getItem(`recentTransactionsResetAt:${a.uid}`)&&e.jsx("span",{className:"inline-block h-1.5 w-1.5 rounded-full bg-red-500 ml-1 align-middle"})]})]})]})]}),e.jsx(eh,{isOpen:Qc,onClose:()=>pn(!1),transaction:Yc,onPrint:()=>window.print(),onDelete:td,onComplete:ad}),e.jsx(oe,{open:Hs,onOpenChange:Yt,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsx(ce,{children:e.jsx(de,{children:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ±"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4 bg-gradient-to-br from-indigo-50 to-blue-50 p-6 rounded-xl border border-blue-100 text-center",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 shadow-sm",children:e.jsx(ou,{className:"h-8 w-8"})}),e.jsxs("div",{className:"space-y-3 w-full",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ·ÙˆÙŠØ±"}),e.jsx("p",{className:"text-lg font-bold bg-gradient-to-r from-blue-700 to-indigo-700 bg-clip-text text-transparent leading-relaxed",children:"ØªÙ… ØªØ·ÙˆÙŠØ± Ø§Ù„Ø§Ø¨Ù„ÙƒÙŠØ´Ù† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…/Ø£Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­ÙŠÙ… Ù…Ø­Ù…Ø¯"}),e.jsxs("div",{className:"flex flex-col items-center gap-1 mt-4",children:[e.jsx("p",{className:"text-base font-semibold text-gray-800",children:"Ø±Ù‚Ù… Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„ÙˆØ­ÙŠØ¯ Ù„Ù†Ø§"}),e.jsx("a",{href:"tel:01000392539",className:"text-2xl font-black text-blue-600 tracking-wider hover:underline",dir:"ltr",children:"01000392539"})]}),e.jsx("p",{className:"text-sm text-red-600 font-bold bg-red-50 py-1 px-3 rounded-full inline-block mt-2",children:"Ù„ÙŠØ³ Ù„Ù†Ø§ Ø§ÙŠ Ø§Ø±Ù‚Ø§Ù… Ø§Ø®Ø±ÙŠ"})]})]}),e.jsx("div",{className:"text-center text-xs text-gray-400 mt-2",children:Mi?`v${Mi}`:"v1.0.0"})]}),e.jsx(be,{children:e.jsx(w,{onClick:()=>Yt(!1),children:"Ø¥ØºÙ„Ø§Ù‚"})})]})}),e.jsxs("div",{className:"space-y-1 fade-in-right w-full",children:[e.jsxs(zt,{id:"transaction-section",className:"bg-gray-100 border border-blue-200/40 rounded-lg shadow-lg hover:shadow-lg transition-all duration-200 group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/5 via-indigo-500/3 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-28 sm:h-28 lg:w-20 lg:h-20 bg-gradient-to-bl from-blue-400/10 to-transparent rounded-full  "}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-indigo-400/10 to-transparent rounded-full  ",style:{animationDelay:"1s"}}),e.jsx(va,{className:"sticky top-0 z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 pb-0.5 px-3 pt-1 lg:pt-0.5 lg:pb-0.5 lg:px-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Na,{className:"text-sm font-bold flex items-center gap-2 text-gray-800",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Yn,{className:"h-1 w-1 text-emerald-500 "}),e.jsx("div",{className:"absolute inset-0 h-1 w-1 bg-emerald-400 rounded-full opacity-20 "})]}),e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"Ø¥Ø¬Ø±Ø§Ø¡ Ù…Ø¹Ø§Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"top-icons-bar hidden md:flex items-center gap-2 bg-gradient-to-r from-gray-50 to-slate-50 hover:from-gray-100 hover:to-slate-100 border border-gray-200 transition-all duration-300 hover:scale-105 h-9 px-3 rounded-xl shadow-sm",children:[e.jsx(Mu,{}),e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"VIP",onClick:()=>Tr(!0),children:e.jsx(Cu,{className:"h-5 w-5 text-yellow-500"})}),e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ±ÙˆØ¹",onClick:()=>(Je==null?void 0:Je.status)==="active"?Mt(!0):Ht(!0),children:e.jsx(Jn,{className:"h-5 w-5"})}),e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ±",onClick:()=>Yt(!0),children:e.jsx(Bl,{className:"h-5 w-5 text-gray-600"})}),e.jsx(pu,{})]})}),xm&&e.jsxs(w,{variant:"outline",size:"sm",className:"hidden flex items-center gap-1.5 sm:gap-2 bg-gradient-to-r from-cyan-50 to-blue-50 hover:from-cyan-100 hover:to-blue-100 border-cyan-200 text-cyan-800 text-xs sm:text-sm transition-all duration-300 hover:scale-105 hover:shadow-lg h-10 sm:h-12 px-4 sm:px-5 rounded-xl min-w-[44px] touch-manipulation",onClick:xl,title:"Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…",children:[e.jsx(Ai,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 animate-spin"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold whitespace-nowrap",children:"Ù…Ø²Ø§Ù…Ù†Ø©"})]})]})}),e.jsx(oe,{open:bd,onOpenChange:Tr,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsx(ce,{children:e.jsx(de,{children:"Ø£ÙØ¶Ù„ 10 Ø¹Ù…Ù„Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±"})}),e.jsx("div",{className:"space-y-2",children:Rn.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±"}):Rn.map((t,s)=>e.jsxs("div",{className:`flex items-center justify-between border rounded-md px-3 py-2 bg-white ${s===0?"bg-yellow-50 border-yellow-300":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ia,{variant:"outline",className:`min-w-[28px] justify-center ${s===0?"border-yellow-300 text-yellow-700 bg-yellow-50":""}`,children:s+1}),e.jsx("span",{className:`font-semibold ${s===0?"text-yellow-700":""}`,children:t.phone})]}),e.jsxs("div",{className:"text-sm text-gray-700 flex items-center gap-3",children:[e.jsxs("span",{children:["Ø¹Ø¯Ø¯: ",t.count]}),e.jsxs("span",{children:["Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ",t.total]}),e.jsx(w,{variant:"outline",size:"sm",className:"h-8",onClick:()=>pm(t),title:"Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨",children:e.jsx(Si,{className:"h-4 w-4"})})]})]},t.phone+s))}),e.jsx(be,{children:e.jsx(w,{onClick:()=>Tr(!1),children:"Ø¥ØºÙ„Ø§Ù‚"})})]})}),e.jsx(oe,{open:xd,onOpenChange:Do,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsx(ce,{children:e.jsx(de,{children:"Ø±Ø¨Ø· Ø¨ÙˆØª Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù…"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{children:"Telegram Chat ID"}),e.jsx(U,{value:yn,onChange:t=>yd(t.target.value),placeholder:"Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(q,{children:"Ø¥Ø±Ø³Ø§Ù„ ÙŠÙˆÙ…ÙŠ 12 ØµØ¨Ø§Ø­Ø§Ù‹"}),e.jsx(hu,{checked:Io,onCheckedChange:t=>wd(!!t)})]})]}),e.jsxs(be,{children:[e.jsx(w,{variant:"outline",onClick:()=>Do(!1),children:"Ø¥ØºÙ„Ø§Ù‚"}),e.jsx(w,{onClick:async()=>{a!=null&&a.uid&&(await K.updateUserData(a.uid,{telegramChatId:yn,telegramDailyEnabled:Io}),f({title:"ØªÙ… Ø§Ù„Ø­ÙØ¸"}))},children:"Ø­ÙØ¸"}),e.jsx(w,{onClick:async()=>{if(!(a!=null&&a.uid)||!yn){f({title:"Ø£Ø¯Ø®Ù„ Chat ID"});return}const t=await bl();try{const{sendTelegramMessage:s}=await F(async()=>{const{sendTelegramMessage:n}=await import("./functions-5D5Jrxio.js");return{sendTelegramMessage:n}},__vite__mapDeps([64,0,1]),import.meta.url);await s({chatId:yn,text:t}),f({title:"ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„"})}catch{f({title:"ØªØ¹Ø°Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„",description:"ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ø¨Ø· Ø§Ù„Ø¨ÙˆØª",variant:"destructive"})}},children:"Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¢Ù†"})]})]})}),e.jsx(oe,{open:Rt,onOpenChange:Mt,children:e.jsxs(le,{className:"sm:max-w-2xl bg-gray-50/80 backdrop-blur-sm",children:[e.jsx(ce,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg",children:e.jsx(Jn,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx(de,{className:"text-xl font-bold text-gray-900",children:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ±ÙˆØ¹"}),e.jsx(at,{className:"text-gray-500 mt-1",children:"Ø£Ø¶Ù ÙØ±ÙˆØ¹Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªØ§Ø¨Ø¹ Ø£Ø¯Ø§Ø¡ ÙƒÙ„ ÙØ±Ø¹ Ø¨Ø³Ù‡ÙˆÙ„Ø©"})]})]}),e.jsx(w,{size:"icon",variant:Ca?"destructive":"default",className:`rounded-full transition-all duration-300 ${Ca?"bg-red-50 text-red-600 hover:bg-red-100 border border-red-200":"bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg hover:shadow-indigo-200"}`,onClick:()=>Li(!Ca),title:Ca?"Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙØ©":"Ø¥Ø¶Ø§ÙØ© ÙØ±Ø¹ Ø¬Ø¯ÙŠØ¯",children:Ca?e.jsx(Za,{className:"w-6 h-6"}):e.jsx(Xe,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"space-y-6",children:[Ca&&e.jsxs("div",{className:"bg-white p-5 rounded-xl border shadow-sm space-y-4 animate-in slide-in-from-top-4 fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-700 font-semibold",children:[e.jsx(Xe,{className:"w-5 h-5"}),e.jsx("h3",{children:"Ø¥Ø¶Ø§ÙØ© ÙØ±Ø¹ Ø¬Ø¯ÙŠØ¯"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{onClick:()=>checkSubscriptionStatus(!0).then(()=>f({title:"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"})),variant:"ghost",size:"icon",title:"ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ",children:e.jsx(Ai,{className:"w-4 h-4 text-gray-500"})}),e.jsxs(w,{onClick:()=>Ht(!0),variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(ku,{className:"w-4 h-4"}),"Ø·Ù„Ø¨ Ø²ÙŠØ§Ø¯Ø© ÙØ±Ø¹"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"text-gray-700",children:"Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±"}),e.jsxs("div",{className:"relative",children:[e.jsx(qs,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(U,{className:"pr-9",value:V,onChange:t=>X(t.target.value),placeholder:"Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"text-gray-700",children:"Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹"}),e.jsxs("div",{className:"relative",children:[e.jsx(Jn,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(U,{className:"pr-9",value:Z,onChange:t=>Ee(t.target.value),placeholder:"Ù…Ø«Ø§Ù„: ÙØ±Ø¹ ÙˆØ³Ø· Ø§Ù„Ø¨Ù„Ø¯"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"text-gray-700",children:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ø¯Ø®ÙˆÙ„"}),e.jsxs("div",{className:"relative",children:[e.jsx(Si,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(U,{className:"pr-9",value:We,onChange:t=>Tt(t.target.value),placeholder:"branch@example.com"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"text-gray-700",children:"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400",children:"ğŸ”’"}),e.jsx(U,{type:"password",className:"pr-9",value:ke,onChange:t=>St(t.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-2",children:[e.jsx(w,{variant:"ghost",onClick:()=>{X(""),Ee(""),Tt(""),St("")},className:"text-gray-500 hover:text-gray-700",children:"Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„"}),e.jsx(w,{className:"bg-indigo-600 hover:bg-indigo-700 text-white min-w-[120px]",disabled:Da,onClick:async()=>{if(!(a!=null&&a.uid))return;const t=V.trim(),s=Z.trim(),n=We.trim(),r=ke.trim();if(!t||!s||!n||!r){f({title:"ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)){f({title:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­",variant:"destructive"});return}if(r.length<6){f({title:"ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„",variant:"destructive"});return}const o=(Je==null?void 0:Je.limit)||0;if(Gt.length>=o){f({title:"Ø¹ÙÙˆØ§Ù‹",description:`Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„ÙØ±ÙˆØ¹ (${o} ÙØ±ÙˆØ¹)`,variant:"destructive"});return}try{Zt(!0);let l="",d="";const p=`tempApp_${Date.now()}`,m=Ym(Hm,p),u=Gm(m),g=Zm(m);try{l=(await Xm(u,n,r)).user.uid;try{await At(ge(g,"users",l),{email:n,isActive:!0,isBranch:!0,ownerId:a.uid,createdAt:et(),updatedAt:et(),role:"branch",isActive:!1,subscription:{isActive:!1,planType:null,startDate:null,endDate:null}})}catch(N){console.error("Error creating branch user document:",N)}try{d=(await Di(ne(g,"shops"),{name:s,ownerId:l,managerName:t,createdAt:et(),updatedAt:et(),isActive:!0})).id}catch(N){console.error("Error creating shop as new user:",N);try{d=(await Di(ne(g,"users",l,"shops"),{name:s,ownerId:l,managerName:t,createdAt:et(),updatedAt:et(),isActive:!0})).id}catch(E){throw console.error("Error creating shop in subcollection:",E),N}}await eu(u)}catch(y){console.error("Registration/Shop Creation Error:",y);let N="ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ù…ØªØ¬Ø±";y.code==="auth/email-already-in-use"&&(N="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„"),y.code==="auth/invalid-email"&&(N="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­"),y.code==="auth/weak-password"&&(N="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ©"),y.code==="permission-denied"&&(N="Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…ØªØ¬Ø± Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"),f({title:N,description:y.message,variant:"destructive"});try{await Vl(m)}catch{}return}finally{try{await Vl(m)}catch(y){console.warn("Error deleting temp app:",y)}}if(!l||!d)return;const x=y=>{try{return btoa(unescape(encodeURIComponent(y)))}catch{return btoa(y)}};try{const y={ownerId:a.uid,shopId:d,branchUserId:l,branchName:s,managerName:t,loginUsername:n,passwordEncoded:x(r),createdAt:et()};await At(ge(W,"users",a.uid,"branches",l),y);try{await Di(ne(W,"branches"),y)}catch(E){console.warn("Branch ref creation error in root collection (non-fatal):",E)}const N={id:l,branchUserId:l,branchName:s,managerName:t,source:"sub",...y};Sa(E=>[...E,N])}catch(y){console.error("Branch ref creation error:",y),f({title:"Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±Ø¹",description:"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙ„ÙƒÙ† ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",variant:"destructive"})}X(""),Ee(""),Tt(""),St(""),f({title:"ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ±Ø¹ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­"})}catch(l){console.error("General Error adding branch:",l),f({title:"ØªØ¹Ø°Ù‘Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ±Ø¹",description:l.message||"Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹"})}finally{Zt(!1)}},children:Da?"Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø¶Ø§ÙØ©...":"Ø¥Ø¶Ø§ÙØ© ÙØ±Ø¹"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-6 bg-indigo-500 rounded-full"}),"Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠØ©",e.jsxs(ia,{variant:"secondary",className:"mr-auto",children:[Gt.length," / ",(Je==null?void 0:Je.limit)||0]})]}),Da&&Gt.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:[e.jsx(Ai,{className:"w-8 h-8 animate-spin mb-2 text-indigo-400"}),e.jsx("p",{children:"Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ±ÙˆØ¹..."})]}):Gt.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed rounded-xl bg-gray-50",children:[e.jsx(Jn,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±ÙˆØ¹ Ù…Ø¶Ø§ÙØ© Ø­Ø§Ù„ÙŠØ§Ù‹"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-3",children:Gt.map(t=>{var s;return e.jsx("div",{className:"group relative bg-white border rounded-xl p-4 shadow-sm hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold text-lg",children:((s=t.branchName)==null?void 0:s.charAt(0))||"B"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-gray-900 text-lg",children:t.branchName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(qs,{className:"w-3 h-3"}),e.jsxs("span",{children:["Ø§Ù„Ù…Ø¯ÙŠØ±: ",t.managerName]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto mt-2 sm:mt-0",children:[e.jsxs(w,{className:"flex-1 sm:flex-none bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200",onClick:()=>xc(t),children:[e.jsx(Ci,{className:"w-4 h-4 ml-2"}),"Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"]}),e.jsx(w,{variant:"ghost",size:"icon",className:"text-blue-500 hover:text-blue-700 hover:bg-blue-50",title:"ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±Ø¹",onClick:()=>fc(t),children:e.jsx(Jl,{className:"w-4 h-4"})})]})]})},t.id)})})]})]})]})}),e.jsx(oe,{open:Bt,onOpenChange:Ia,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙØ±Ø¹"}),e.jsx(at,{children:"Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙØ±Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(q,{children:"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ)"}),e.jsx(U,{value:cs,onChange:t=>ds(t.target.value),placeholder:"example@email.com"})]}),e.jsxs("div",{children:[e.jsx(q,{children:"ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±"}),e.jsx(U,{type:"password",value:Ei,onChange:t=>ki(t.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(w,{variant:"outline",onClick:()=>{ds(""),ki("")},children:"Ù…Ø³Ø­"}),e.jsx(w,{className:"bg-blue-600 hover:bg-blue-700",disabled:nc,onClick:async()=>{const t=Zs;if(!t){Ia(!1);return}const s=String(t.loginUsername||"");let n="";try{const o=String(t.passwordEncoded||"");n=o?decodeURIComponent(escape(atob(o))):""}catch{try{n=t.passwordEncoded?atob(String(t.passwordEncoded)):""}catch{n=""}}const r=cs.trim(),i=Ei.trim();if(!r||!i){f({title:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±"});return}if(r!==s||i!==n){f({title:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©",variant:"destructive"});return}try{Pi(!0);const o=a!=null&&a.uid?`selectedShopId_${a.uid}`:"selectedShopId";localStorage.setItem(o,String(t.shopId)),f({title:"ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙØ±Ø¹",description:String(t.branchName||"")}),Ia(!1),Mt(!1),T("/user/dashboard")}catch{}Pi(!1)},children:"Ø¯Ø®ÙˆÙ„"})]})]})]})}),e.jsx(oe,{open:rc,onOpenChange:Xs,children:e.jsxs(le,{className:"sm:max-w-2xl",children:[e.jsxs(ce,{children:[e.jsxs(de,{children:["Ø¨ÙŠØ§Ù†Ø§Øª ÙØ±Ø¹ ",rt==null?void 0:rt.branchName]}),e.jsxs(at,{children:["Ù…Ø¯ÙŠØ± Ø§Ù„ÙØ±Ø¹: ",rt==null?void 0:rt.managerName]})]}),ic?e.jsx("div",{className:"py-8 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):rt?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 py-4",children:[e.jsxs("div",{className:"p-4 border rounded-xl bg-green-50",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…"}),e.jsxs("div",{className:"text-xl font-bold text-green-700",children:[Nt(rt.todaySales)," Ø¬.Ù…"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-blue-50",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±"}),e.jsxs("div",{className:"text-xl font-bold text-blue-700",children:[Nt(rt.monthSales)," Ø¬.Ù…"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-emerald-50",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Ø§Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…"}),e.jsxs("div",{className:"text-xl font-bold text-emerald-700",children:[Nt(rt.todayProfit)," Ø¬.Ù…"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-cyan-50",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Ø§Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±"}),e.jsxs("div",{className:"text-xl font-bold text-cyan-700",children:[Nt(rt.monthProfit)," Ø¬.Ù…"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-purple-50",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸"}),e.jsxs("div",{className:"text-xl font-bold text-purple-700",children:[Nt(rt.walletsTotal)," Ø¬.Ù…"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-yellow-50",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Ù†Ù‚Ø¯ÙŠØ© Ø§Ù„Ø¯Ø±Ø¬"}),e.jsxs("div",{className:"text-xl font-bold text-yellow-700",children:[Nt(rt.cashBalance)," Ø¬.Ù…"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-indigo-50",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Ù…Ø¨ÙŠØ¹Ø§Øª Ù‚Ø³Ù… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª"}),e.jsxs("div",{className:"text-xl font-bold text-indigo-700",children:[Nt(rt.totalSalesSection)," Ø¬.Ù…"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-red-50",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ†"}),e.jsxs("div",{className:"text-xl font-bold text-red-700",children:[Nt(rt.debtsTotal)," Ø¬.Ù…"]})]})]}):null,e.jsx(be,{children:e.jsx(w,{onClick:()=>Xs(!1),children:"Ø¥ØºÙ„Ø§Ù‚"})})]})}),e.jsx(oe,{open:mc,onOpenChange:en,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsxs(ce,{children:[e.jsx(de,{children:"ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±Ø¹"}),e.jsx(at,{children:"ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹ ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±"})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)"}),e.jsx(U,{value:hc,readOnly:!0,disabled:!0,placeholder:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù„",className:"bg-gray-100 text-black opacity-100 font-medium"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹"}),e.jsx(U,{value:tn,onChange:t=>Bi(t.target.value),placeholder:"Ù…Ø«Ø§Ù„: ÙØ±Ø¹ Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±"}),e.jsx(U,{value:an,onChange:t=>Ui(t.target.value),placeholder:"Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯"})]})]}),e.jsxs(be,{children:[e.jsx(w,{variant:"outline",onClick:()=>en(!1),children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(w,{onClick:gc,disabled:Fi,children:Fi?"Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸...":"Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª"})]})]})}),e.jsxs(qt,{ref:Ue,className:"space-y-1 px-2 pb-2 relative z-10 transition-transform duration-200 ease-out will-change-transform",style:{transform:dt?`translateY(${dt}px)`:void 0},onFocusCapture:t=>{const s=t.target;if(!((s==null?void 0:s.id)==="transferExtraFeeInput")){ae(0);return}const r=document.getElementById("transferSubmitButton");if(r){const i=r.getBoundingClientRect(),o=window.innerHeight;if(i.bottom>o){const l=i.bottom-o,d=Math.min(l,220);ae(-d)}else ae(0)}else ae(0)},onBlurCapture:t=>{t.currentTarget.contains(t.relatedTarget)||ae(0)},children:[e.jsxs("div",{className:"transaction-type-tabs flex w-full rounded-full border border-gray-300 overflow-hidden bg-surface",children:[e.jsxs("button",{type:"button",onClick:()=>Vn("transfer"),className:`flex-1 h-10 text-sm font-medium transition-colors duration-200 flex items-center justify-center gap-2 ${L==="transfer"?"bg-blue-100 text-blue-900":"bg-transparent text-gray-600 hover:bg-gray-50"}`,children:[L==="transfer"&&e.jsx(Kn,{className:"h-4 w-4"}),e.jsx(zs,{className:"h-4 w-4"}),"ØªØ­ÙˆÙŠÙ„"]}),e.jsx("div",{className:"w-[1px] bg-gray-300"}),e.jsxs("button",{type:"button",onClick:()=>Vn("withdraw"),className:`flex-1 h-10 text-sm font-medium transition-colors duration-200 flex items-center justify-center gap-2 ${L==="withdraw"?"bg-red-100 text-red-900":"bg-transparent text-gray-600 hover:bg-gray-50"}`,children:[L==="withdraw"&&e.jsx(Kn,{className:"h-4 w-4"}),e.jsx(rs,{className:"h-4 w-4"}),"Ø³Ø­Ø¨"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-3",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 flex items-center gap-2 whitespace-nowrap",children:[e.jsx(ss,{className:"h-4 w-4 text-blue-600"}),"Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­ÙØ¸Ø©"]}),e.jsxs("div",{className:"flex items-center gap-1 justify-end overflow-x-auto scrollbar-hide",children:[e.jsxs(w,{variant:"outline",size:"sm",className:"h-7 rounded-md px-2 text-[10px] font-medium bg-emerald-50 text-emerald-700 hover:bg-emerald-100 border-emerald-200 shadow-sm whitespace-nowrap",onClick:()=>T("/user/add-wallet"),title:"Ø¥Ø¶Ø§ÙØ© Ù…Ø­ÙØ¸Ø©",children:[e.jsx(Xe,{className:"h-3 w-3 mr-1"}),"Ø¥Ø¶Ø§ÙØ© Ù…Ø­ÙØ¸Ø©"]}),e.jsxs(w,{variant:"outline",size:"sm",className:"h-7 rounded-md px-2 text-[10px] font-medium bg-orange-50 text-orange-700 hover:bg-orange-100 border-orange-200 shadow-sm whitespace-nowrap",onClick:()=>mt(!0),title:"Ø·Ø¨Ø§Ø¹Ø© Ù…Ø­ÙØ¸Ø©",children:[e.jsx(Au,{className:"h-3 w-3 mr-1"}),"Ø·Ø¨Ø§Ø¹Ø©"]}),e.jsxs(w,{variant:"outline",size:"sm",className:"h-7 rounded-md px-2 text-[10px] font-medium bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border-indigo-200 shadow-sm whitespace-nowrap",onClick:()=>{ln(!0)},title:"Ø§Ù„Ù…Ø­Ø§ÙØ¸",children:[e.jsx(ss,{className:"h-3 w-3 mr-1"}),"Ø§Ù„Ù…Ø­Ø§ÙØ¸"]})]})]}),O.length>0?e.jsxs(Xa,{value:D,onValueChange:bm,children:[e.jsx(es,{"data-testid":"wallet-select",className:"w-full h-14 text-base bg-surface border border-gray-400 hover:border-gray-800 focus:border-primary rounded-xl transition-colors duration-200 flex items-center",children:e.jsx(ts,{placeholder:"Ø§Ø®ØªØ± Ù…Ø­ÙØ¸Ø© Ù„Ù„Ù…Ø¹Ø§Ù…Ù„Ø©",className:"text-gray-700"})}),e.jsxs(as,{className:"rounded-xl border border-gray-200 shadow-md z-[9999] bg-white dark:bg-gray-900",children:[e.jsx("div",{"data-fixed-header":"true",className:"sticky top-0 z-10 bg-white dark:bg-gray-900 p-2 border-b border-gray-100 dark:border-gray-800",children:e.jsx(U,{value:mo,onChange:t=>qc(t.target.value),placeholder:"Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©",className:"h-10 text-sm border-gray-300 rounded-lg"})}),e.jsx("div",{className:"p-1",children:uo.length===0?e.jsx("div",{className:"text-sm text-gray-500 p-3 text-center",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©"}):uo.map(t=>e.jsx(Kt,{value:t.id,className:"rounded-lg my-1 cursor-pointer hover:bg-gray-100 focus:bg-blue-50 transition-colors duration-200",children:e.jsxs("div",{className:"flex items-center gap-3 py-2 w-full",children:[e.jsx(ss,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{className:"flex items-center gap-2 text-right",children:[e.jsx("span",{className:"text-base font-medium text-gray-900",children:t.name}),e.jsx("span",{className:"text-sm font-bold text-red-600",children:t.phone})]}),t.isDefault&&e.jsx("span",{className:"mr-auto text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full border border-gray-200",children:"Ø§ÙØªØ±Ø§Ø¶ÙŠ"})]})},t.id))})]})]}):e.jsx("div",{className:"rounded-xl border-2 border-dashed border-gray-200 bg-gray-50 px-3 py-3 text-xs text-gray-600",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙØ¸ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†. Ø§Ø¶ØºØ· â€œØ¥Ø¶Ø§ÙØ© Ù…Ø­ÙØ¸Ø©â€ Ù„Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ù…Ø­ÙØ¸Ø©."})]}),e.jsx(oe,{open:Pc,onOpenChange:no,children:e.jsxs(le,{className:"sm:max-w-3xl w-[95vw] sm:w-auto max-h-[80vh] overflow-y-auto",children:[e.jsx(ce,{children:e.jsx(de,{children:"Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø§ÙØ¸"})}),e.jsx("div",{className:"mt-2",children:e.jsx(hh,{showAddButton:!1,showUsageBars:!1,showLimitCards:!1,showEditButton:!0})})]})}),e.jsx(Et,{open:Oc,onOpenChange:ln,mode:"verify",title:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„ÙØªØ­ Ø§Ù„Ù…Ø­Ø§ÙØ¸",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸",onSuccess:()=>{ln(!1),no(!0)},userId:a==null?void 0:a.uid}),e.jsx(Xl,{isOpen:Ce,onClose:()=>mt(!1),wallets:O}),e.jsx(Et,{open:Lc,onOpenChange:t=>{fr(t),t||gr(null)},mode:"verify",title:"ØªØ£ÙƒÙŠØ¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø­ÙØ¸Ø©",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©",onSuccess:()=>{ro&&(Bs(ro,"walletSelectionPin"),gr(null)),fr(!1)},userId:a==null?void 0:a.uid}),D&&O.length>0&&(()=>{var S;const t=O.find(P=>P.id===D),s=Vt,n=Dm,r=(G==null?void 0:G.monthlyWithdrawLimit)??(t==null?void 0:t.monthlyWithdrawalLimit)??2e5,i=(G==null?void 0:G.monthlyTransferLimit)??(t==null?void 0:t.monthlyTransferLimit)??2e5,o=(G==null?void 0:G.monthlyWithdrawUsed)??s.totalWithdrawn??0,l=(G==null?void 0:G.monthlyTransferUsed)??s.totalTransferred??0,d=((S=it==null?void 0:it.subscription)==null?void 0:S.planType)===Ct.TAHWEELA,p=d?0:(G==null?void 0:G.dailyWithdrawLimit)??1e5,m=d?0:(G==null?void 0:G.dailyTransferLimit)??6e4,u=d?0:(G==null?void 0:G.dailyWithdrawUsed)??n.totalWithdrawn??0,g=d?0:(G==null?void 0:G.dailyTransferUsed)??n.totalTransferred??0,x=parseFloat(Qe||"0")||0,y=o+(L==="withdraw"?x:0),N=l+(L==="transfer"?x:0),E=u+(L==="withdraw"?x:0),v=g+(L==="transfer"?x:0);return t?e.jsxs("div",{className:"mb-2 space-y-2 p-2 bg-gray-50 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 pb-1",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800",children:"Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©"}),e.jsx("span",{className:"text-xs font-medium text-gray-500 bg-white px-2 py-0.5 rounded-full border border-gray-200",children:Ud||(t==null?void 0:t.name)})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700",children:"Ø³Ø­Ø¨ Ø´Ù‡Ø±ÙŠ"}),e.jsxs("span",{className:"text-gray-600 dir-ltr",children:[Math.max(r-y,0).toLocaleString("en-US",{maximumFractionDigits:0})," Ù…ØªØ¨Ù‚ÙŠ"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-red-500 to-red-600 rounded-full transition-all duration-500 ease-out shadow-sm",style:{width:`${Math.min(y/Math.max(r,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 font-medium",children:["Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ",y.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 font-medium",children:["Ø§Ù„Ø­Ø¯: ",r.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]}),e.jsx("div",{className:"w-[1px] bg-gray-200 self-stretch"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700",children:"ØªØ­ÙˆÙŠÙ„ Ø´Ù‡Ø±ÙŠ"}),e.jsxs("span",{className:"text-gray-600 dir-ltr",children:[Math.max(i-N,0).toLocaleString("en-US",{maximumFractionDigits:0})," Ù…ØªØ¨Ù‚ÙŠ"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-blue-500 to-blue-600 rounded-full transition-all duration-500 ease-out shadow-sm",style:{width:`${Math.min(N/Math.max(i,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 font-medium",children:["Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ",N.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 font-medium",children:["Ø§Ù„Ø­Ø¯: ",i.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]})]})]}),e.jsxs("div",{className:"space-y-1 pt-1.5 border-t border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-0.5",children:e.jsx("span",{className:"text-sm font-bold text-gray-800",children:"Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700",children:"Ø³Ø­Ø¨ ÙŠÙˆÙ…ÙŠ"}),e.jsxs("span",{className:"text-gray-600 dir-ltr",children:[Math.max(p-E,0).toLocaleString("en-US",{maximumFractionDigits:0})," Ù…ØªØ¨Ù‚ÙŠ"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-orange-400 to-orange-500 rounded-full transition-all duration-500 ease-out",style:{width:`${Math.min(E/Math.max(p,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 font-medium",children:["Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ",E.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 font-medium",children:["Ø§Ù„Ø­Ø¯: ",p.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]}),e.jsx("div",{className:"w-[1px] bg-gray-200 self-stretch"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700",children:"ØªØ­ÙˆÙŠÙ„ ÙŠÙˆÙ…ÙŠ"}),e.jsxs("span",{className:"text-gray-600 dir-ltr",children:[Math.max(m-v,0).toLocaleString("en-US",{maximumFractionDigits:0})," Ù…ØªØ¨Ù‚ÙŠ"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-green-500 to-green-600 rounded-full transition-all duration-500 ease-out",style:{width:`${Math.min(v/Math.max(m,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 font-medium",children:["Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ",v.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 font-medium",children:["Ø§Ù„Ø­Ø¯: ",m.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]})]})]})]}):null})(),L==="transfer"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø³Ù„"}),e.jsxs("div",{className:"relative group",children:[e.jsx(Ti,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-green-600 group-focus-within:text-green-700"}),e.jsx(U,{value:Ut,onChange:t=>Oa(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const s=document.getElementById("receiverPhoneInput");if(s)s.focus();else{const n=document.getElementById("amountInput");n==null||n.focus()}}},placeholder:"01030302038",className:"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-blue-600 focus:ring-1 focus:ring-blue-600"})]})]}),!I&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„"}),e.jsxs("div",{className:"relative group",children:[e.jsx(Ti,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-green-600 group-focus-within:text-green-700"}),e.jsx(U,{id:"receiverPhoneInput",value:ht,onChange:t=>{xs(t.target.value),Ir&&Ma(!1)},onKeyDown:t=>{if(t.key==="Enter"){const s=document.getElementById("amountInput");s==null||s.focus()}},inputMode:"numeric",maxLength:11,placeholder:"Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„",className:"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-blue-600 focus:ring-1 focus:ring-blue-600"})]})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ti,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400"}),e.jsx(U,{value:D&&((Tl=O.find(t=>t.id===D))==null?void 0:Tl.phone)||"",readOnly:!0,placeholder:"Ø§Ø®ØªØ± Ù…Ø­ÙØ¸Ø© Ø£ÙˆÙ„Ø§Ù‹",className:"pl-10 h-10 text-sm lg:text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl"})]})]}),L==="transfer"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Ø§Ù„Ù…Ø¨Ù„Øº (Ø¬Ù†ÙŠÙ‡)"}),e.jsxs("div",{className:"relative flex items-center gap-2 group",children:[e.jsx(Jt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-yellow-600 group-focus-within:text-yellow-700"}),e.jsx(U,{id:"amountInput",value:Qe,onChange:t=>{La(t.target.value),Ir&&Ma(!1)},onKeyDown:t=>{if(t.key==="Enter"){const s=document.getElementById("transferCommissionInput");if(s)s.focus();else{const n=document.getElementById("quickDebtButton");n==null||n.focus()}}},placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº",type:"number",className:"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-blue-600 focus:ring-1 focus:ring-blue-600"})]}),_t?e.jsxs("div",{className:"mt-2 text-xs text-green-700 bg-green-50 border border-green-200 rounded px-2 py-1 flex items-center gap-2",children:[e.jsxs("span",{children:["ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø¬Ù„ Ù„Ù€ ",_t.debtorName," Ø¨Ù…Ø¨Ù„Øº ",_t.amount," Ø¬Ù†ÙŠÙ‡"]}),e.jsx(w,{type:"button",variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>pr(null),children:"Ø¥Ù„ØºØ§Ø¡"})]}):null]}),(()=>{if(I)return null;const t=Fe();return t&&t.defaultTransferCommission!=null?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ (ØªÙ„Ù‚Ø§Ø¦ÙŠØ©)"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„ÙƒÙ„ Ø£Ù„Ù: ",t==null?void 0:t.defaultTransferCommission," Ø¬Ù†ÙŠÙ‡ Ù„ÙƒÙ„ Ø£Ù„Ù"]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(w,{id:"quickDebtButton",type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium",onClick:()=>{const n=Fe(),r=(n==null?void 0:n.defaultTransferCommission)!=null?Number(n.defaultTransferCommission):0,i=parseFloat(Qe||"0")||0,o=Math.round((r||0)*i/1e3*100)/100,l=i+o;ma((l||0).toString()),se?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø§Ù„Ø£Ø¬Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹ ØºÙŠØ± Ù…ØªØ§Ø­ ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):Wa(!0)},children:"Ø£Ø¬Ù„"}),e.jsx(w,{type:"button",variant:"outline",size:"icon",className:"hidden",title:xe?"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ¶Ø§Ù":"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ®ØµÙ…",children:xe?e.jsx(Xe,{className:"h-4 w-4 text-green-600"}):e.jsx(Za,{className:"h-4 w-4 text-red-600"})}),e.jsx("span",{className:"hidden",children:xe?"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ¶Ø§Ù":"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ®ØµÙ…"})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ø¬Ù†ÙŠÙ‡)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(Jt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-yellow-600 group-focus-within:text-yellow-700"}),e.jsx(U,{id:"transferCommissionInput",value:He,onChange:n=>dn(n.target.value),placeholder:"Ø£Ø¯Ø®Ù„ Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„",type:"number",className:"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-orange-500 focus:ring-1 focus:ring-orange-500"})]}),e.jsx(w,{type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium",onClick:()=>{const n=Fe(),r=parseFloat(Qe||"0")||0;let i=0;if((n==null?void 0:n.defaultTransferCommission)!=null){const l=Number(n.defaultTransferCommission)||0;i=Math.round(l*r/1e3*100)/100}else{const l=He&&He.trim()!==""?parseFloat(He):0;i=Math.max(0,l)}const o=r+i;ma((o||0).toString()),se?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø§Ù„Ø£Ø¬Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹ ØºÙŠØ± Ù…ØªØ§Ø­ ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):Wa(!0)},children:"Ø£Ø¬Ù„"}),e.jsx(w,{type:"button",variant:"outline",size:"icon",className:"hidden",title:xe?"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ¶Ø§Ù":"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ®ØµÙ…",children:xe?e.jsx(Xe,{className:"h-4 w-4 text-green-600"}):e.jsx(Za,{className:"h-4 w-4 text-red-600"})}),e.jsx("span",{className:"hidden",children:xe?"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ¶Ø§Ù":"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ®ØµÙ…"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"})]})})(),(()=>{const t=mn(Ut||"").replace(/\D/g,""),s=mn(ht||"").replace(/\D/g,"");return L==="transfer"&&(t.startsWith("010")&&s.startsWith("010")||t.startsWith("010")&&(s.startsWith("011")||s.startsWith("012")||s.startsWith("015"))||t.startsWith("012")&&s.startsWith("010")||t.startsWith("011")&&s.startsWith("010")||t.startsWith("015")&&s.startsWith("010"))?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ (Ø¬Ù†ÙŠÙ‡)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Jt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-yellow-600"}),e.jsx(U,{id:"transferExtraFeeInput",value:io,onChange:r=>Wc(r.target.value),placeholder:"Ø£Ø¯Ø®Ù„ Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„",type:"number",className:"pl-10 h-10 text-sm lg:text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white hover:border-blue-400 focus:border-blue-500"})]}),e.jsx("div",{className:"hidden",children:"ØªÙØ®ØµÙ… Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© ÙˆØªØ¶Ø§Ù Ù„Ù„Ø¯Ø±Ø¬ â€” Ù„Ø¹Ù…Ù„ÙŠØ§Øª 010 â†’ 011/012/015 Ø£Ùˆ 012 â†’ 010 Ø£Ùˆ 011 â†’ 010 Ø£Ùˆ 015 â†’ 010"})]}):null})(),e.jsxs("div",{className:"sticky bottom-0 z-20 pt-2 pb-2 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 backdrop-blur supports-[backdrop-filter]:bg-white/90 dark:supports-[backdrop-filter]:bg-gray-900/90",children:[e.jsx(w,{id:"transferSubmitButton",onClick:Cl,className:"w-full h-12 text-base font-medium rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-none hover:shadow-md",children:Ir?"ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­":"ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„"}),Rc&&e.jsxs("div",{className:"flex items-start gap-2 mt-2 px-1",children:[e.jsx(Ul,{className:"h-4 w-4 text-amber-500 shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-gray-500 leading-tight",children:["ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ 85% Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„Ù…Ø­ÙØ¸Ø© ",xr==null?void 0:xr.walletName]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø­Ø¨ (Ø¬Ù†ÙŠÙ‡)"}),e.jsxs("div",{className:"relative group",children:[e.jsx(rs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-primary"}),e.jsx(U,{id:"amountInput",value:Qe,onChange:t=>{La(t.target.value),wo&&js(!1)},onKeyDown:t=>{if(t.key==="Enter"){const s=document.getElementById("manualWithdrawCommissionInput");if(s)s.focus();else{const n=document.getElementById("withdrawSubmitButton");n==null||n.focus()}}},placeholder:"Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø­Ø¨",type:"number",className:"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-primary focus:ring-1 focus:ring-primary"})]})]}),Mc&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Ø§Ø³Ù… Ø§Ù„Ø±Ø§Ø³Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"}),e.jsxs("div",{className:"relative",children:[e.jsx(qs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-500"}),e.jsx(U,{id:"withdrawSenderNameInput",value:ys,onChange:t=>eo(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const s=document.getElementById("manualWithdrawCommissionInput");s==null||s.focus()}},placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø±Ø§Ø³Ù„ Ø¥Ù† ÙˆØ¬Ø¯",className:"pl-10 h-10 text-sm lg:text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white hover:border-blue-400 focus:border-blue-500",type:"text"})]})]}),(()=>{const t=Fe();return t&&t.defaultWithdrawCommission!=null?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ø³Ø­Ø¨ (ØªÙ„Ù‚Ø§Ø¦ÙŠØ©)"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„ÙƒÙ„ Ø£Ù„Ù: ",t==null?void 0:t.defaultWithdrawCommission," Ø¬Ù†ÙŠÙ‡ Ù„ÙƒÙ„ Ø£Ù„Ù"]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(w,{type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium",onClick:()=>{const n=Fe(),r=parseFloat(Qe||"0")||0,i=(n==null?void 0:n.defaultWithdrawCommission)!=null&&Number(n.defaultWithdrawCommission)||0,o=Math.round(i*r/1e3*100)/100,l=xe?r+o:r;ma((l||0).toString()),se?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø§Ù„Ø£Ø¬Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹ ØºÙŠØ± Ù…ØªØ§Ø­ ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):Wa(!0)},children:"Ø£Ø¬Ù„"}),e.jsx(w,{type:"button",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>wr(n=>!n),title:xe?"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ¶Ø§Ù Ø¥Ù„Ù‰ Ø§Ù„Ø¯ÙŠÙ†":"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ®ØµÙ… Ù…Ù† Ø§Ù„Ø¯ÙŠÙ†",children:xe?e.jsx(Xe,{className:"h-4 w-4"}):e.jsx(Za,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-xs text-gray-600",children:xe?"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ¶Ø§Ù":"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ®ØµÙ…"})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ø³Ø­Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ø¬Ù†ÙŠÙ‡)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Jt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-yellow-600"}),e.jsx(U,{id:"manualWithdrawCommissionInput",value:Ye,onChange:n=>cn(n.target.value),onKeyDown:n=>{if(n.key==="Enter"){const r=document.getElementById("withdrawSubmitButton");r==null||r.focus()}},placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©",type:"number",className:"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white hover:border-blue-400 focus:border-blue-500"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø³Ø­Ø¨"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(w,{type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium",onClick:()=>{const n=Fe(),r=parseFloat(Qe||"0")||0;let i=0;if((n==null?void 0:n.defaultWithdrawCommission)!=null){const l=Number(n.defaultWithdrawCommission)||0;i=Math.round(l*r/1e3*100)/100}else{const l=Ye&&Ye.trim()!==""?parseFloat(Ye):Math.round(r*.01*100)/100;i=Math.max(0,l)}const o=xe?r+i:r;ma((o||0).toString()),se?f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø§Ù„Ø£Ø¬Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹ ØºÙŠØ± Ù…ØªØ§Ø­ ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"}):Wa(!0)},children:"Ø£Ø¬Ù„"}),e.jsx(w,{type:"button",variant:"outline",size:"icon",title:xe?"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ¶Ø§Ù":"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ®ØµÙ…",onClick:()=>wr(n=>!n),children:xe?e.jsx(Xe,{className:"h-4 w-4 text-green-600"}):e.jsx(Za,{className:"h-4 w-4 text-red-600"})}),e.jsx("span",{className:"text-xs text-gray-600",children:xe?"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ¶Ø§Ù":"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ØªÙØ®ØµÙ…"})]})]})})(),(h==null?void 0:h.showWithdrawNote)&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø³Ø­Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"}),e.jsxs("div",{className:"relative group",children:[e.jsx(Si,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-primary"}),e.jsx(U,{id:"withdrawNoteInput",value:da,onChange:t=>Xi(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const s=document.getElementById("withdrawSubmitButton");s==null||s.focus()}},placeholder:"Ø£Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù„Ø³Ø­Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",className:"pl-10 h-10 text-base border-gray-400 rounded-xl focus:border-primary focus:ring-1 focus:ring-primary"})]})]}),e.jsx("div",{className:"sticky bottom-0 z-20 pt-2 pb-2 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 backdrop-blur supports-[backdrop-filter]:bg-white/90 dark:supports-[backdrop-filter]:bg-gray-900/90",children:e.jsx(w,{id:"withdrawSubmitButton",onClick:Cl,className:"w-full font-medium h-11 lg:h-12 text-sm lg:text-base bg-green-600 hover:bg-green-700 text-white",children:wo?"ØªÙ… Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­":"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø³Ø­Ø¨"})})]}),e.jsx(oe,{open:dr,onOpenChange:Wa,children:e.jsxs(le,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"ØªØ­ÙˆÙŠÙ„ Ù…Ø¤Ø¬Ù„"}),e.jsx(at,{children:"Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ø­Ø¨ Ø§Ù„Ø¯ÙŠÙ† ÙˆØ§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø«Ù… Ø§Ø¶ØºØ· Ø­ÙØ¸"})]}),e.jsxs("div",{className:"space-y-3",children:[ft&&ft.length>0?e.jsxs("div",{children:[e.jsx(q,{children:"Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„"}),e.jsxs(Xa,{value:hr,onValueChange:t=>{Ec(t);const s=ft.find(n=>n.id===t);s&&ur(s.name)},children:[e.jsx(es,{className:"w-full",children:e.jsx(ts,{placeholder:"Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„"})}),e.jsx(as,{children:ft.map(t=>e.jsxs(Kt,{value:t.id,children:[t.name,t.mobile?` â€” ${t.mobile}`:""]},t.id))})]})]}):e.jsx("div",{className:"text-xs text-gray-500",children:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ Ù…ÙØ³Ø¬Ù„ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ù…Ù† Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†."}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"quickDebtName",children:"Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø¯ÙŠÙ†"}),e.jsx(U,{id:"quickDebtName",value:mr,onChange:t=>ur(t.target.value),placeholder:"Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…"})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"quickDebtAmount",children:"Ø§Ù„Ù…Ø¨Ù„Øº (Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)"}),e.jsx(U,{id:"quickDebtAmount",type:"number",value:_c,readOnly:!0,placeholder:"Ø§Ù„Ù…Ø¨Ù„Øº + Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„"})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"quickDebtCommission",children:"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© (Ù…Ø­Ø³ÙˆØ¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)"}),e.jsx(U,{id:"quickDebtCommission",type:"number",value:function(){const t=Fe(),s=parseFloat((Qe||"0").toString())||0;let n=0;if(L==="transfer")if((t==null?void 0:t.defaultTransferCommission)!=null){const r=Number(t.defaultTransferCommission)||0;n=Math.round(r*s/1e3*100)/100}else{const r=He&&He.trim()!==""?parseFloat(He):0;n=Math.max(0,r)}else if((t==null?void 0:t.defaultWithdrawCommission)!=null){const r=Number(t.defaultWithdrawCommission)||0;n=Math.round(r*s/1e3*100)/100}else{const r=Ye&&Ye.trim()!==""?parseFloat(Ye):Math.round(s*.01*100)/100;n=Math.max(0,r)}return String(n||0)}(),readOnly:!0,placeholder:"Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©"})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"quickDebtNotes",children:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª"}),e.jsx(U,{id:"quickDebtNotes",value:to,onChange:t=>ao(t.target.value),placeholder:"Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"})]})]}),e.jsx(be,{children:e.jsx(w,{type:"button",variant:"default",className:"bg-green-600 text-white hover:bg-green-700",onClick:()=>{const t=Fe(),s=parseFloat((Qe||"").toString())||0;let n=0;if(L==="transfer")if((t==null?void 0:t.defaultTransferCommission)!=null){const o=Number(t.defaultTransferCommission)||0;n=Math.round(o*s/1e3*100)/100}else{const o=He&&He.trim()!==""?parseFloat(He):0;n=Math.max(0,o)}else if((t==null?void 0:t.defaultWithdrawCommission)!=null){const o=Number(t.defaultWithdrawCommission)||0;n=Math.round(o*s/1e3*100)/100}else{const o=Ye&&Ye.trim()!==""?parseFloat(Ye):Math.round(s*.01*100)/100;n=Math.max(0,o)}let r=0;if(L==="withdraw"?r=xe?s:Math.max(0,Math.round((s-n)*100)/100):r=Math.max(0,Math.round((s+n)*100)/100),!mr||isNaN(r)||r<=0){f({title:"Ø®Ø·Ø£ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¬Ù„",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ø¨Ù„Øº Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­",variant:"destructive"});return}const i=ft.find(o=>o.id===hr);pr({debtorName:mr,amount:r,notes:to,customerId:hr||void 0,mobile:i==null?void 0:i.mobile}),so(!1),Wa(!1),f({title:"ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¬Ù„",description:"Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙŠÙ† Ø¹Ù†Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©",variant:"default"})},children:"Ø­ÙØ¸"})})]})})]})]}),e.jsx(zt,{className:"bg-gradient-to-br from-red-50 to-red-100 border-red-200 fade-in-up card-float",children:e.jsxs(qt,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-red-600 font-medium text-[10px] mb-1",children:"âš ï¸ ØªØ­Ø°ÙŠØ± Ù…Ù† Ø§Ù„ØªØ­ÙˆÙŠÙ„"}),e.jsx("div",{className:"text-[10px] text-red-700",children:"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ù„ØºØ§Ø¡ Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ© Ø¨Ø¹Ø¯ ØªØ£ÙƒÙŠØ¯Ù‡Ø§ Ù„Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù…Ø§Ù†"})]})})]})]}),e.jsx(Zu,{isOpen:Fc,onClose:()=>$c(!1),initialEditingWallet:zc,onWalletUpdate:async()=>{try{await vi()}catch(t){console.error("Error reloading wallets after update:",t)}}}),e.jsx(Xu,{isOpen:Jc,onClose:()=>ho(!1),transaction:Kc,onDelete:vm}),e.jsx(Et,{open:Zc,onOpenChange:bs,onSuccess:Cm,title:Am(),description:Tm(),mode:"verify"}),e.jsx(Zl,{open:Vd,onOpenChange:Ho,onSuccess:Em,title:"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ ÙÙŠ Ø§Ù„Ø¯Ø±Ø¬",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ÙˆØ§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ ÙÙŠ Ø§Ù„Ø¯Ø±Ø¬",currentBalance:we,balanceLabel:"Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ",userId:a==null?void 0:a.uid}),e.jsx(Zl,{open:zd,onOpenChange:Go,onSuccess:km,title:"ØªØ¹Ø¯ÙŠÙ„ Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ÙˆØ§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©",currentBalance:gt&&ee[gt]||0,balanceLabel:`Ø±ØµÙŠØ¯ ${((_l=O.find(t=>t.id===gt))==null?void 0:_l.name)||"Ø§Ù„Ù…Ø­ÙØ¸Ø©"}`,userId:a==null?void 0:a.uid}),e.jsx(rh,{open:qd,onOpenChange:Xr,onSuccess:Pm,title:"Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ Ø®ØµÙ… Ù…Ø¨Ù„Øº Ù…Ù† Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ÙˆØ§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø¶Ø§ÙØªÙ‡ Ø£Ùˆ Ø®ØµÙ…Ù‡ Ù…Ù† Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©",currentBalance:gt&&ee[gt]||0,balanceLabel:`Ø±ØµÙŠØ¯ ${((El=O.find(t=>t.id===gt))==null?void 0:El.name)||"Ø§Ù„Ù…Ø­ÙØ¸Ø©"}`,userId:a==null?void 0:a.uid}),e.jsx(th,{open:sm,onOpenChange:nm,userId:a==null?void 0:a.uid}),e.jsx(ah,{open:rm,onOpenChange:im,userId:a==null?void 0:a.uid}),e.jsx(sh,{open:om,onOpenChange:lm}),e.jsx(oe,{open:Qd,onOpenChange:Sn,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsx(ce,{children:e.jsx(de,{className:"text-right",children:"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¬ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{htmlFor:"amount",className:"text-right block",children:"Ø§Ù„Ù…Ø¨Ù„Øº"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(U,{id:"amount",type:"number",placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº",value:ti,onChange:t=>Dn(t.target.value),className:"text-right flex-1",dir:"rtl",min:"0"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(w,{type:"button",size:"sm",className:"bg-green-600 hover:bg-green-700 text-white px-3 py-2",onClick:async()=>{if(!await Fn(ui)){f({title:"Ø®Ø·Ø£",description:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­",variant:"destructive"});return}const t=parseFloat(ti);if(isNaN(t)||t<=0){f({title:"Ø®Ø·Ø£",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­",variant:"destructive"});return}const s=we+t;Oe(s);const n={cashBalance:s,lastUpdated:new Date().toISOString()},r=`userData_${a==null?void 0:a.uid}`;localStorage.setItem(r,JSON.stringify(n)),a!=null&&a.uid?K.updateUserData(a.uid,n).then(()=>{console.log("âœ… ØªÙ… Ø­ÙØ¸ Ø±ØµÙŠØ¯ Ø§Ù„Ø¯Ø±Ø¬ Ø§Ù„Ù†Ù‚Ø¯ÙŠ ÙÙŠ Firebase Ø¨Ù†Ø¬Ø§Ø­"),localStorage.removeItem(r),H(!1)}).catch(i=>{console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø±ØµÙŠØ¯ ÙÙŠ Firebase:",i),H(!0)}):H(!0),f({title:"ØªÙ… Ø¨Ù†Ø¬Ø§Ø­",description:`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${t} Ø¬Ù†ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¬ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©`}),Sn(!1),Dn(""),_n("")},children:[e.jsx(Xe,{className:"h-1 w-1 mr-1"}),"Ø¥Ø¶Ø§ÙØ©"]}),e.jsxs(w,{type:"button",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white px-3 py-2",onClick:async()=>{if(!await Fn(ui)){f({title:"Ø®Ø·Ø£",description:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­",variant:"destructive"});return}const t=parseFloat(ti);if(isNaN(t)||t<=0){f({title:"Ø®Ø·Ø£",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­",variant:"destructive"});return}const s=we-t;Oe(s);const n={cashBalance:s,lastUpdated:new Date().toISOString()},r=`userData_${a==null?void 0:a.uid}`;localStorage.setItem(r,JSON.stringify(n)),a!=null&&a.uid?K.updateUserData(a.uid,n).then(()=>{console.log("âœ… ØªÙ… Ø­ÙØ¸ Ø±ØµÙŠØ¯ Ø§Ù„Ø¯Ø±Ø¬ Ø§Ù„Ù†Ù‚Ø¯ÙŠ ÙÙŠ Firebase Ø¨Ù†Ø¬Ø§Ø­"),localStorage.removeItem(r),H(!1)}).catch(i=>{console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø±ØµÙŠØ¯ ÙÙŠ Firebase:",i),H(!0)}):H(!0),f({title:"ØªÙ… Ø¨Ù†Ø¬Ø§Ø­",description:`ØªÙ… Ø®ØµÙ… ${t} Ø¬Ù†ÙŠÙ‡ Ù…Ù† Ø§Ù„Ø¯Ø±Ø¬ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©`}),Sn(!1),Dn(""),_n("")},children:[e.jsx(Za,{className:"h-1 w-1 mr-1"}),"Ø®ØµÙ…"]})]})]}),e.jsxs("p",{className:"text-[10px] text-gray-500 text-right",children:["Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ: ",we.toLocaleString()," Ø¬Ù†ÙŠÙ‡"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{htmlFor:"pin",className:"text-right block",children:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ"}),e.jsx(U,{id:"pin",type:"password",placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ",value:ui,onChange:t=>_n(t.target.value),className:"text-right",dir:"rtl"})]})]}),e.jsx(be,{className:"flex gap-2",children:e.jsx(w,{variant:"outline",onClick:()=>{Sn(!1),Dn(""),_n("")},children:"Ø¥Ù„ØºØ§Ø¡"})})]})}),e.jsx(oe,{open:fm,onOpenChange:Mn,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsx(ce,{children:e.jsx(de,{className:"text-right text-red-600",children:"ØªØµÙÙŠØ± Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø©"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-red-800 font-medium mb-2",children:"ØªØ­Ø°ÙŠØ±!"}),e.jsx("p",{className:"text-red-700 text-sm",children:"Ø³ÙŠØªÙ… ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø¥Ù„Ù‰ ØµÙØ±. Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡."}),e.jsxs("p",{className:"text-red-600 text-sm mt-2",children:["Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ: ",Object.values(ee).reduce((t,s)=>t+s,0).toLocaleString()," Ø¬Ù†ÙŠÙ‡"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{htmlFor:"resetWalletTotalPin",className:"text-right block",children:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ"}),e.jsx(U,{id:"resetWalletTotalPin",type:"password",placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",value:jl,onChange:t=>Bn(t.target.value),className:"text-right",dir:"rtl"})]})]}),e.jsxs(be,{className:"flex gap-2",children:[e.jsx(w,{variant:"outline",onClick:()=>{Mn(!1),Bn("")},children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(w,{variant:"destructive",onClick:async()=>{if(!await xt.verifyMasterPin(jl,a==null?void 0:a.uid)){f({title:"Ø®Ø·Ø£",description:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­",variant:"destructive"});return}try{const s={};Object.keys(ee).forEach(o=>{s[o]=0}),Me(s),localStorage.setItem(Te(),JSON.stringify(s)),Mn(!1),Bn("");const n=new Date().toISOString(),r={walletBalances:s,lastUpdated:n},i=`userData_${a==null?void 0:a.uid}`;localStorage.setItem(i,JSON.stringify(r)),a!=null&&a.uid?K.updateUserData(a.uid,r).then(()=>{localStorage.removeItem(i),H(!1)}).catch(o=>{console.error("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ ÙÙŠ Firebase:",o),H(!0),f({title:"ØªÙ†Ø¨ÙŠÙ‡",description:"ØªÙ… Ø§Ù„ØªØµÙÙŠØ± Ù…Ø­Ù„ÙŠØ§Ù‹ØŒ Ø³ÙŠØªÙ… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù… Ù‚Ø±ÙŠØ¨Ø§Ù‹",variant:"default"})}):H(!0),setTimeout(()=>{Me({...s})},100)}catch(s){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØµÙÙŠØ± Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸:",s),f({title:"Ø®Ø·Ø£",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØµÙÙŠØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸",variant:"destructive"})}},children:"ØªØµÙÙŠØ± Ø§Ù„Ù…Ø­ÙØ¸Ø©"})]})]})}),e.jsx(oe,{open:Kd,onOpenChange:jn,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsx(ce,{children:e.jsx(de,{className:"text-right text-red-600",children:"ØªØµÙÙŠØ± Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-red-800 font-medium mb-2",children:"ØªØ­Ø°ÙŠØ±!"}),e.jsx("p",{className:"text-red-700 text-sm",children:"Ø³ÙŠØªÙ… ØªØµÙÙŠØ± Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø¥Ù„Ù‰ ØµÙØ±. Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡."}),e.jsxs("p",{className:"text-red-600 text-sm mt-2",children:["Ø§Ù„Ù…Ø­ÙØ¸Ø©: ",((kl=O.find(t=>t.id===D))==null?void 0:kl.name)||D]}),e.jsxs("p",{className:"text-red-600 text-sm",children:["Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ: ",(D&&ee[D]?ee[D]:0).toLocaleString()," Ø¬Ù†ÙŠÙ‡"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{htmlFor:"resetSelectedWalletPin",className:"text-right block",children:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ"}),e.jsx(U,{id:"resetSelectedWalletPin",type:"password",autoComplete:"off",placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",value:Zo,onChange:t=>ei(t.target.value),className:"text-right",dir:"rtl"})]})]}),e.jsxs(be,{className:"flex gap-2",children:[e.jsx(w,{variant:"outline",onClick:()=>{jn(!1),ei("")},children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(w,{variant:"destructive",onClick:async()=>{var s;if(!D){f({title:"Ø§Ø®ØªØ± Ù…Ø­ÙØ¸Ø©",description:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙØ¸Ø© Ø£ÙˆÙ„Ø§Ù‹",variant:"destructive"});return}if(!await xt.verifyMasterPin(Zo,a==null?void 0:a.uid)){f({title:"Ø®Ø·Ø£",description:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­",variant:"destructive"});return}try{const n={...ee};n[D]=0,Me(n),localStorage.setItem(Te(),JSON.stringify(n)),jn(!1),ei("");const r=new Date().toISOString(),i={walletBalances:n,lastUpdated:r},o=`userData_${a==null?void 0:a.uid}`;localStorage.setItem(o,JSON.stringify(i)),a!=null&&a.uid?K.updateUserData(a.uid,i).then(()=>{localStorage.removeItem(o),H(!1)}).catch(l=>{console.error("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ ÙÙŠ Firebase:",l),H(!0),f({title:"ØªÙ†Ø¨ÙŠÙ‡",description:"ØªÙ… Ø§Ù„ØªØµÙÙŠØ± Ù…Ø­Ù„ÙŠØ§Ù‹ØŒ Ø³ÙŠØªÙ… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù… Ù‚Ø±ÙŠØ¨Ø§Ù‹",variant:"default"})}):H(!0),f({title:"ØªÙ… Ø§Ù„ØªØµÙÙŠØ± Ø¨Ù†Ø¬Ø§Ø­",description:`ØªÙ… ØªØµÙÙŠØ± Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© ${((s=O.find(l=>l.id===D))==null?void 0:s.name)||D}`})}catch(n){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØµÙÙŠØ± Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:",n),f({title:"Ø®Ø·Ø£",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØµÙÙŠØ± Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©",variant:"destructive"})}},children:"ØªØµÙÙŠØ± Ø§Ù„Ù…Ø­ÙØ¸Ø©"})]})]})}),e.jsx(Xl,{isOpen:Ce,onClose:()=>mt(!1),wallets:O}),e.jsx(oe,{open:mm,onOpenChange:Ln,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsx(ce,{children:e.jsxs(de,{className:"text-right text-green-600 flex items-center gap-2 justify-end",children:[e.jsx(Xe,{className:"h-4 w-4"}),"Ø¥Ø¶Ø§ÙØ© Ø£Ù…ÙˆØ§Ù„ Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø©"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-green-800 font-medium mb-2",children:"Ø¥Ø¶Ø§ÙØ© Ø£Ù…ÙˆØ§Ù„"}),e.jsx("p",{className:"text-green-700 text-sm",children:"Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø¥Ù„Ù‰ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø¨Ø´ÙƒÙ„ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸."}),e.jsxs("p",{className:"text-green-600 text-sm mt-2",children:["Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ: ",Object.values(ee).reduce((t,s)=>t+s,0).toLocaleString()," Ø¬Ù†ÙŠÙ‡"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"addWalletTotalAmount",className:"text-right block",children:"Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø¶Ø§ÙØªÙ‡"}),e.jsx(U,{id:"addWalletTotalAmount",type:"number",placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº",value:hl,onChange:t=>pi(t.target.value),className:"text-right",dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"addWalletTotalPin",className:"text-right block",children:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„ØªØ£ÙƒÙŠØ¯"}),e.jsx(U,{id:"addWalletTotalPin",type:"password",autoComplete:"off",placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ",value:pl,onChange:t=>fi(t.target.value),className:"text-right",dir:"rtl"})]})]})]}),e.jsxs(be,{className:"flex gap-2",children:[e.jsx(w,{variant:"outline",onClick:()=>{Ln(!1),pi(""),fi("")},children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(w,{variant:"default",className:"bg-green-600 hover:bg-green-700",disabled:fl,onClick:async()=>{const t=parseFloat(hl);if(!t||t<=0){f({title:"Ø®Ø·Ø£",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­",variant:"destructive"});return}if(!await wm(pl)){f({title:"Ø®Ø·Ø£",description:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­",variant:"destructive"});return}gl(!0);try{const s=Object.values(ee).reduce((n,r)=>n+r,0);if(s===0){const n=Object.keys(ee),r=t/n.length,i={};n.forEach(o=>{i[o]=r}),Me(i),localStorage.setItem(Te(),JSON.stringify(i)),a!=null&&a.uid?await K.updateUserData(a.uid,{walletBalances:i,lastUpdated:new Date().toISOString()}):H(!0)}else{const n={};Object.entries(ee).forEach(([r,i])=>{const o=i/s,l=t*o;n[r]=i+l}),Me(n),localStorage.setItem(Te(),JSON.stringify(n)),a!=null&&a.uid?await K.updateUserData(a.uid,{walletBalances:n,lastUpdated:new Date().toISOString()}):H(!0)}setTimeout(()=>{Me(n=>({...n}))},100),Ln(!1),pi(""),fi("")}catch(s){console.error("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ ÙÙŠ Firebase:",s),f({title:"Ø®Ø·Ø£",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",variant:"destructive"})}finally{gl(!1)}},children:fl?"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...":"Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù…ÙˆØ§Ù„"})]})]})}),e.jsx(oe,{open:gm,onOpenChange:Un,children:e.jsxs(le,{className:"sm:max-w-[425px]",children:[e.jsx(ce,{children:e.jsxs(de,{className:"text-red-600 flex items-center gap-2",children:[e.jsx(Wt,{className:"h-1 w-1"}),"ØªØµÙÙŠØ± Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ"]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-700",children:"âš ï¸ ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ ÙÙŠ Ø§Ù„Ø¯Ø±Ø¬ Ø¥Ù„Ù‰ ØµÙØ±. Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡."})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{htmlFor:"resetCashPin",children:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ"}),e.jsx(U,{id:"resetCashPin",type:"password",autoComplete:"off",placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",value:gi,onChange:t=>xi(t.target.value)})]})]}),e.jsxs(be,{children:[e.jsx(w,{variant:"outline",onClick:()=>{Un(!1),xi("")},children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(w,{variant:"destructive",onClick:async()=>{if(!gi){f({title:"Ø®Ø·Ø£",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ",variant:"destructive"});return}if(!await xt.verifyMasterPin(gi,a==null?void 0:a.uid)){f({title:"Ø®Ø·Ø£",description:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­",variant:"destructive"});return}try{Oe(0),Un(!1),xi("");const s={cashBalance:0,lastUpdated:new Date().toISOString()};localStorage.setItem(je(),"0"),localStorage.setItem(je()+"_lastUpdated",s.lastUpdated);const n=`userData_${a==null?void 0:a.uid}`;localStorage.setItem(n,JSON.stringify(s)),a!=null&&a.uid?K.updateUserData(a.uid,s).then(()=>{localStorage.removeItem(n),H(!1)}).catch(r=>{console.error("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø±ØµÙŠØ¯ ÙÙŠ Firebase:",r),H(!0),f({title:"ØªÙ†Ø¨ÙŠÙ‡",description:"ØªÙ… Ø§Ù„ØªØµÙÙŠØ± Ù…Ø­Ù„ÙŠØ§Ù‹ØŒ Ø³ÙŠØªÙ… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù… Ù‚Ø±ÙŠØ¨Ø§Ù‹",variant:"default"})}):H(!0)}catch(s){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØµÙÙŠØ± Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ:",s),f({title:"Ø®Ø·Ø£",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØµÙÙŠØ± Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ",variant:"destructive"})}},children:"ØªØµÙÙŠØ± Ø§Ù„Ø±ØµÙŠØ¯"})]})]})}),e.jsx(lh,{open:dm,onOpenChange:ul,userId:a==null?void 0:a.uid,cashBalance:we,walletBalances:ee,transactions:Y}),e.jsx(oe,{open:cm,onOpenChange:Ls,children:e.jsxs(le,{className:"sm:max-w-[425px]",children:[e.jsx(ce,{children:e.jsxs(de,{className:"text-green-600 flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4"}),"Ø¥Ø¶Ø§ÙØ© Ø£Ù…ÙˆØ§Ù„ Ù„Ù„Ø¯Ø±Ø¬"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-green-700",children:"ğŸ’° Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ ÙÙŠ Ø§Ù„Ø¯Ø±Ø¬"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"addCashAmount",children:"Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø¶Ø§ÙØªÙ‡"}),e.jsx(U,{id:"addCashAmount",type:"number",placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº",value:ya,onChange:t=>En(t.target.value),min:"0",step:"0.01"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"text-right",children:"Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{type:"button",variant:Rs==="yes"?"default":"outline",onClick:()=>Ms("yes"),className:"flex-1",children:"Ù†Ø¹Ù…"}),e.jsx(w,{type:"button",variant:Rs==="no"?"default":"outline",onClick:async()=>{if(Ms("no"),!ya||parseFloat(ya)<=0){f({title:"Ø®Ø·Ø£",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­ Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±",variant:"destructive"});return}if(!Ws){f({title:"Ø®Ø·Ø£",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ",variant:"destructive"});return}if(!await Fn(Ws)){f({title:"Ø®Ø·Ø£",description:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­",variant:"destructive"});return}Pn(!0);try{const t=parseFloat(ya),s=we+t;Oe(s);const n=new Date().toISOString();localStorage.setItem(je(),s.toString()),localStorage.setItem(je()+"_lastUpdated",n);const r={cashBalance:s,lastUpdated:n},i=`userData_${a==null?void 0:a.uid}`;localStorage.setItem(i,JSON.stringify(r));const o=`CASHADD-${(a==null?void 0:a.uid)||"anon"}-${Date.now()}`;Ls(!1),En(""),kn(""),Ms(null),On("");const l=[];if(a!=null&&a.uid){l.push(K.updateUserData(a.uid,r).then(()=>{localStorage.removeItem(i),H(!1)}).catch(()=>{H(!0)}));const d={txnType:"cash_addition",type:"cash_addition",amount:t,status:"confirmed",senderMsisdn:"Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©",receiverMsisdn:"",reference:o,title:"Ø¥ÙŠØµØ§Ù„ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©",merchantUserId:a.uid,createdBy:a.uid,shopId:(h==null?void 0:h.shopId)||void 0};l.push(K.saveUserTransaction(a.uid,d));const p=h==null?void 0:h.shopId;if(p){const m=ge(W,"dashboardData",p);l.push(It(m,{cashBalance:s}))}}Promise.allSettled(l).then(()=>{}).catch(()=>{})}catch{Oe(we),localStorage.setItem("cashBalance",we.toString()),f({title:"Ø®Ø·Ø£",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰",variant:"destructive"})}finally{Pn(!1)}},className:"flex-1",children:"Ù„Ø§"})]})]}),Rs==="yes"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"addCashNote",children:"Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©"}),e.jsx(U,{id:"addCashNote",type:"text",placeholder:"Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©",value:hi,onChange:t=>On(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"addCashPin",children:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„Ø¯Ø±Ø¬ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©"}),e.jsx(U,{id:"addCashPin",type:"password",placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ",value:Ws,onChange:t=>kn(t.target.value)})]})]}),e.jsxs(be,{children:[e.jsx(w,{variant:"outline",onClick:()=>{Ls(!1),En(""),kn(""),Ms(null),On("")},children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(w,{variant:"default",className:"bg-green-600 hover:bg-green-700",disabled:ml,onClick:async()=>{if(!ya||parseFloat(ya)<=0){f({title:"Ø®Ø·Ø£",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­ Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±",variant:"destructive"});return}if(!Ws){f({title:"Ø®Ø·Ø£",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ",variant:"destructive"});return}if(!await Fn(Ws)){f({title:"Ø®Ø·Ø£",description:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­",variant:"destructive"});return}if(Rs==="yes"&&hi.trim().length===0){f({title:"ØªÙ†Ø¨ÙŠÙ‡",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ùˆ Ø§Ø®ØªØ± Ù„Ø§",variant:"destructive"});return}Pn(!0);try{const t=parseFloat(ya),s=we+t;Oe(s);const n=new Date().toISOString();localStorage.setItem(je(),s.toString()),localStorage.setItem(je()+"_lastUpdated",n);const r={cashBalance:s,lastUpdated:n},i=`userData_${a==null?void 0:a.uid}`;localStorage.setItem(i,JSON.stringify(r));const o=`CASHADD-${(a==null?void 0:a.uid)||"anon"}-${Date.now()}`;Ls(!1),En(""),kn(""),Ms(null),On("");const l=[];if(a!=null&&a.uid){l.push(K.updateUserData(a.uid,r).then(()=>{localStorage.removeItem(i),H(!1)}).catch(()=>{H(!0)}));const d={txnType:"cash_addition",type:"cash_addition",amount:t,status:"confirmed",senderMsisdn:"Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©",receiverMsisdn:"",reference:o,note:Rs==="yes"?hi.trim():void 0,title:"Ø¥ÙŠØµØ§Ù„ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø¯ÙŠØ©",merchantUserId:a.uid,createdBy:a.uid,shopId:(h==null?void 0:h.shopId)||void 0};l.push(K.saveUserTransaction(a.uid,d));const p=h==null?void 0:h.shopId;if(p){const m=ge(W,"dashboardData",p);l.push(It(m,{cashBalance:s}))}}Promise.allSettled(l).then(()=>{}).catch(()=>{})}catch{Oe(we),localStorage.setItem("cashBalance",we.toString()),f({title:"Ø®Ø·Ø£",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰",variant:"destructive"})}finally{Pn(!1)}},children:ml?"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...":"Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù…ÙˆØ§Ù„"})]})]})}),e.jsx(oe,{open:$d,onOpenChange:Zr,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsx(ce,{children:e.jsx(de,{className:"text-right",children:"Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ù„Ù„Ø¨Ø­Ø«"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{htmlFor:"search-date",className:"text-right block",children:"Ø§Ù„ØªØ§Ø±ÙŠØ®"}),e.jsx(U,{id:"search-date",type:"date",value:fn,onChange:t=>xo(t.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{htmlFor:"search-time",className:"text-right block",children:"Ø§Ù„ÙˆÙ‚Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"}),e.jsx(U,{id:"search-time",type:"time",value:gn,onChange:t=>yo(t.target.value),className:"text-right",placeholder:"Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª Ù„Ù„Ø¨Ø­Ø« ÙÙŠ Ø³Ø§Ø¹Ø© Ù…Ø­Ø¯Ø¯Ø©"}),e.jsx("p",{className:"text-[10px] text-gray-500 text-right",children:"Ø¥Ø°Ø§ Ù„Ù… ØªØ®ØªØ± ÙˆÙ‚ØªØ§Ù‹ Ù…Ø­Ø¯Ø¯Ø§Ù‹ØŒ Ø³ÙŠØªÙ… Ø§Ù„Ø¨Ø­Ø« ÙÙŠ ÙƒØ§Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…"})]})]}),e.jsxs(be,{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>{xo(""),yo(""),Zr(!1)},children:"Ù…Ø³Ø­"}),e.jsx(w,{onClick:()=>Zr(!1),children:"ØªØ·Ø¨ÙŠÙ‚"})]})]})}),e.jsx(ih,{isOpen:ld,onClose:()=>Ar(!1)}),e.jsx(oh,{isOpen:Nr,onClose:()=>Ra(!1),initialBarcode:Bc}),e.jsx(ch,{isOpen:md,onClose:()=>Ds(!1)}),e.jsx(mh,{open:ud,onOpenChange:Is}),e.jsx(uh,{open:hd,onOpenChange:t=>{if(t&&!bt){f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ù…ÙƒÙ†Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª: Ø´Ù‡Ø±ÙŠØŒ Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØŒ Ø³Ù†ÙˆÙŠØŒ ÙˆÙ…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©.",variant:"destructive"});return}Cs(t)}}),e.jsx(fh,{open:nt,onOpenChange:t=>{if(t&&!bt){f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª: Ø´Ù‡Ø±ÙŠØŒ Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØŒ Ø³Ù†ÙˆÙŠØŒ ÙˆÙ…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©. ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§ÙƒÙƒ.",variant:"destructive"});return}qe(t)}}),e.jsx(gh,{open:Qt,onOpenChange:t=>{if(t&&!bt){f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª: Ø´Ù‡Ø±ÙŠØŒ Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØŒ Ø³Ù†ÙˆÙŠØŒ ÙˆÙ…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©. ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§ÙƒÙƒ.",variant:"destructive"});return}jt(t)}}),e.jsx(Et,{open:Hd,onOpenChange:nl,onSuccess:()=>ni(!0),title:"ØªÙ‚Ø§Ø±ÙŠØ±Ùƒ",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ ØªÙ‚Ø§Ø±ÙŠØ±Ùƒ",mode:"verify"}),e.jsx(oe,{open:si,onOpenChange:ni,children:e.jsxs(le,{className:"sm:max-w-xl",children:[e.jsxs(ce,{children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(Ci,{className:"h-4 w-4 text-blue-600"}),"ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…"]}),e.jsx(at,{children:"Ù…Ù„Ø®Øµ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ù…Ø­ÙÙˆØ¸ Ù„Ø¢Ø®Ø± 30 ÙŠÙˆÙ…Ù‹Ø§ Ù…Ø¹ Ø£Ø±Ø´ÙØ© ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©"})]}),e.jsxs("div",{className:"space-y-4",children:[(()=>{const t=new Date().toDateString(),s=Y.filter(d=>{const p=new Date(d.createdAt).toDateString(),m=String(d.status||"completed").toLowerCase();return p===t&&(m==="completed"||m==="confirmed")}),n=s.length,r=s.reduce((d,p)=>d+Number(p.amount||0),0),i=s.filter(d=>d.type==="withdraw").reduce((d,p)=>d+Number(p.amount||0),0),o=s.filter(d=>d.type==="send").reduce((d,p)=>d+Number(p.amount||0),0),l=s.reduce((d,p)=>d+Number(st.calculateTransactionProfit(p)||0),0);return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-blue-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-blue-700",children:"Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª"}),e.jsx("div",{className:"text-lg font-bold text-blue-800",children:n})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-indigo-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-indigo-700",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº"}),e.jsx("div",{className:"text-lg font-bold text-indigo-800",children:Number(r).toFixed(2)})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-red-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-red-700",children:"Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø©"}),e.jsx("div",{className:"text-lg font-bold text-red-800",children:Number(i).toFixed(2)})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-green-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-green-700",children:"Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø±Ø³Ù„Ø©"}),e.jsx("div",{className:"text-lg font-bold text-green-800",children:Number(o).toFixed(2)})]}),e.jsxs("div",{className:"col-span-2 rounded-lg p-3 bg-gradient-to-r from-amber-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-amber-700",children:"Ø§Ù„Ø£Ø±Ø¨Ø§Ø­"}),e.jsx("div",{className:"text-lg font-bold text-amber-800",children:Number(l).toFixed(2)})]})]})})(),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(w,{variant:"default",onClick:async()=>{try{if(!(a!=null&&a.uid))return;const t=new Date,s=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),i=`${s}-${n}-${r}`,o=t.toDateString(),l=Y.filter(x=>{const y=new Date(x.createdAt).toDateString(),N=String(x.status||"completed").toLowerCase();return y===o&&(N==="completed"||N==="confirmed")}),d=l.length,p=l.reduce((x,y)=>x+Number(y.amount||0),0),m=l.filter(x=>x.type==="withdraw").reduce((x,y)=>x+Number(y.amount||0),0),u=l.filter(x=>x.type==="send").reduce((x,y)=>x+Number(y.amount||0),0),g=l.reduce((x,y)=>x+Number(st.calculateTransactionProfit(y)||0),0);await $s.add({userId:a.uid,reportDate:i,totalTransactions:d,totalAmount:Number(p.toFixed(2)),totalWithdrawn:Number(m.toFixed(2)),totalSent:Number(u.toFixed(2)),profit:Number(g.toFixed(2)),walletId:null});try{await $s.trimToMaxCount(a.uid,30)}catch{}f({title:"ØªÙ… Ø§Ù„Ø£Ø±Ø´ÙØ©",description:`ØªÙ… Ø­ÙØ¸ ØªÙ‚Ø±ÙŠØ± ${i}`})}catch{f({title:"ÙØ´Ù„ Ø§Ù„Ø£Ø±Ø´ÙØ©",description:"ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±",variant:"destructive"})}},children:"Ø£Ø±Ø´ÙØ© Ø§Ù„ÙŠÙˆÙ…"}),e.jsx(w,{variant:"outline",onClick:()=>ni(!1),children:"Ø¥ØºÙ„Ø§Ù‚"})]}),e.jsx("div",{className:"mt-2 border-t pt-2",children:e.jsx("div",{className:"space-y-2 max-h-[40vh] overflow-auto",children:rl.length===0?e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø­ÙÙˆØ¸Ø©"}):rl.map(t=>e.jsxs("div",{className:"border rounded-md p-2 bg-gradient-to-r from-white/80 to-blue-50/70",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-bold text-blue-800",children:t.reportDate}),e.jsxs("div",{className:"text-xs text-blue-700",children:["Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª: ",t.totalTransactions]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[e.jsxs("div",{className:"text-xs text-blue-800",children:["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº: ",e.jsx("span",{className:"font-semibold",children:Number(t.totalAmount).toFixed(2)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["Ø§Ù„Ù…Ø³Ø­ÙˆØ¨: ",e.jsx("span",{className:"font-semibold",children:Number(t.totalWithdrawn).toFixed(2)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["Ø§Ù„Ù…Ø±Ø³Ù„: ",e.jsx("span",{className:"font-semibold",children:Number(t.totalSent).toFixed(2)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["Ø§Ù„Ø±Ø¨Ø­: ",e.jsx("span",{className:"font-semibold",children:Number(t.profit??0).toFixed(2)})]})]})]},t.id||`${t.userId}-${t.reportDate}`))})})]})]})}),e.jsx(oe,{open:Yd,onOpenChange:t=>{if(t){f({title:"Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±",description:"Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹."});return}ai(!1)},children:e.jsxs(le,{dir:"rtl",className:"sm:max-w-md w-[95vw] sm:w-auto rounded-2xl border border-emerald-200 shadow-xl bg-gradient-to-br from-white via-green-50 to-emerald-50 backdrop-blur-md data-[state=open]:animate-in data-[state=open]:fade-in-0 data-[state=open]:zoom-in-90 data-[state=open]:slide-in-from-bottom-8 duration-300",children:[e.jsxs(ce,{children:[e.jsx(de,{className:"text-right text-green-700",children:"Ø´Ø­Ù† Ø±ØµÙŠØ¯ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„"}),e.jsx(at,{className:"text-right text-gray-600",children:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ù… Ø§Ø¶ØºØ· ØªØ£ÙƒÙŠØ¯"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"topupPhone",className:"text-right block",children:"Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„"}),e.jsx(U,{id:"topupPhone",value:In,onChange:t=>Xo(t.target.value),placeholder:"010xxxxxxx",className:"text-right"})]}),e.jsxs("div",{children:[e.jsx(q,{className:"text-right block",children:"Ø´Ø±ÙƒØ© Ø§Ù„ØªØ´ØºÙŠÙ„"}),e.jsxs(Xa,{value:Cn,onValueChange:el,children:[e.jsx(es,{className:"text-right",children:e.jsx(ts,{placeholder:"Ø§Ø®ØªØ± Ø§Ù„Ø´Ø±ÙƒØ©"})}),e.jsxs(as,{children:[e.jsx(Kt,{value:"vodafone",children:"ÙÙˆØ¯Ø§ÙÙˆÙ†"}),e.jsx(Kt,{value:"orange",children:"Ø£ÙˆØ±Ù†Ø¬"}),e.jsx(Kt,{value:"etisalat",children:"Ø§ØªØµØ§Ù„Ø§Øª"}),e.jsx(Kt,{value:"we",children:"WE"})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"topupAmount",className:"text-right block",children:"Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¬Ù†ÙŠÙ‡"}),e.jsx(U,{id:"topupAmount",type:"number",value:An,onChange:t=>tl(t.target.value?Number(t.target.value):""),placeholder:"50",className:"text-right"})]})]}),e.jsxs(be,{className:"flex gap-2 justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>ai(!1),className:"border-gray-300",children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(w,{onClick:ut,disabled:al||!In||!Cn||!An,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:al?"Ø¬Ø§Ø±Ù Ø§Ù„ØªÙ†ÙÙŠØ°...":"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø­Ù†"})]})]})}),e.jsx(Et,{open:Sd,onOpenChange:Er,mode:"verify",title:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ÙØªØ­ Ø§Ù„Ø¯ÙŠÙˆÙ†",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†",onSuccess:()=>{Er(!1),Ua(!0)}}),e.jsx(Et,{open:Id,onOpenChange:To,mode:"verify",title:"ØªØ£ÙƒÙŠØ¯ ØªØºÙŠÙŠØ± Ø·Ù„Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ø¯ÙŠÙˆÙ†",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ØªÙØ¹ÙŠÙ„ Ø£Ùˆ Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ø¯ÙŠÙˆÙ†",onSuccess:async()=>{if(_o!==null){const t=_o;Ao(t);try{const s=a==null?void 0:a.uid,n=s?`debtsPinRequired_${s}`:"debtsPinRequired";localStorage.setItem(n,String(t)),s&&await K.updateUserData(s,{debtsPinRequired:t})}catch{}f({title:t?"ØªÙ… ØªÙØ¹ÙŠÙ„ Ø·Ù„Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ø¯ÙŠÙˆÙ†":"ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ø¯ÙŠÙˆÙ†",description:t?"Ø³ÙŠÙØ·Ù„Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†.":"ÙŠÙ…ÙƒÙ† ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙŠÙˆÙ† Ø¨Ø¯ÙˆÙ† Ø·Ù„Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ."})}Cd(null),To(!1)}}),e.jsx(nh,{open:Jd,onOpenChange:Ps,title:"ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ØªØµÙÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©",description:"Ø³ÙŠØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ø­Ø³Ø§Ø¨Ùƒ ÙˆFirebase.",onSuccess:async()=>{try{if(!(a!=null&&a.uid)){Ps(!1);return}const t=new Date,s=r=>r instanceof Date?r:typeof(r==null?void 0:r.toDate)=="function"?r.toDate():new Date(String(r)),n=Y.filter(r=>s(r.createdAt)<t);await K.updateUserData(a.uid,{recentReset:{keepLastCount:yl.keepLastCount??30,intervalDays:yl.intervalDays??7,lastResetAt:t}}),Wn(r=>({...r,lastResetAt:t})),f({title:"ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©",description:"ØªÙ… Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ø£Ù‚Ø¯Ù… Ù…Ù† ÙˆÙ‚Øª Ø§Ù„ØªØµÙÙŠØ± Ù…Ù† Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø¯ÙˆÙ† Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…/Ø§Ù„Ø´Ù‡Ø± Ø£Ùˆ Ø§Ù„Ø­Ø¯ÙˆØ¯."})}catch(t){console.error("ÙØ´Ù„ ØªÙ†ÙÙŠØ° Ø§Ù„ØªØµÙÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:",t),f({title:"ÙØ´Ù„ Ø§Ù„ØªØµÙÙŠØ±",description:"ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø«Ù… Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.",variant:"destructive"})}finally{Ps(!1)}}}),e.jsx(Et,{open:Sc,onOpenChange:Ea,mode:"verify",title:"Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„ÙØªØ­ Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø­Ù„",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ÙØªØ­ Ù†Ø§ÙØ°Ø© Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø­Ù„",onSuccess:()=>{Ea(!1),ca(!0)}}),e.jsx(oe,{open:jd,onOpenChange:Ua,children:e.jsxs(le,{className:"sm:max-w-[425px]",children:[e.jsxs(ce,{className:"flex items-center justify-between",children:[e.jsx(de,{className:"text-right",children:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†"}),e.jsxs("div",{className:"flex items-center gap-1 text-orange-700",children:[e.jsx(Ql,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-xs font-bold",children:[Im," Ø¬Ù†ÙŠÙ‡"]})]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(w,{variant:Lt==="debtor"?"default":"outline",onClick:()=>Oo("debtor"),children:"Ù…Ø¯ÙŠÙ†"}),e.jsx(w,{variant:Lt==="creditor"?"default":"outline",onClick:()=>Oo("creditor"),children:"Ø¯Ø§Ø¦Ù†"})]}),(Lt==="creditor"||Lt==="debtor")&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"debtorName",className:"text-right col-span-1",children:Lt==="creditor"?"Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†":"Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø¦Ù†"}),e.jsx(U,{id:"debtorName",value:kr,onChange:t=>Eo(t.target.value),className:"col-span-3 text-right",placeholder:Lt==="creditor"?"Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†":"Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø¦Ù†"})]}),Lt&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"debtAmount",className:"text-right col-span-1",children:"Ø§Ù„Ù…Ø¨Ù„Øº"}),e.jsx(U,{id:"debtAmount",type:"number",value:Pr,onChange:t=>ko(t.target.value),className:"col-span-3 text-right",placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"debtReason",className:"text-right col-span-1",children:"Ø³Ø¨Ø¨ Ø§Ù„Ø¯ÙŠÙ†"}),e.jsx(U,{id:"debtReason",value:Or,onChange:t=>Po(t.target.value),className:"col-span-3 text-right",placeholder:"Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø¯ÙŠÙ†"})]})]})]}),e.jsx(be,{children:e.jsx(w,{onClick:()=>{if(!(Lt==="debtor")&&!(Lt==="creditor")){f({title:"Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙŠÙ†",description:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¯ÙŠÙ† Ø£Ùˆ Ø¯Ø§Ø¦Ù† Ø£ÙˆÙ„Ø§Ù‹",variant:"destructive"});return}if(!Pr||!Or||!kr){f({title:"Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„Ø³Ø¨Ø¨",variant:"destructive"});return}const n={id:Date.now().toString(),debtorName:kr,amount:parseFloat(Pr),reason:Or,status:"pending",createdAt:new Date,paidAmount:0,partialPayments:[],type:Lt||"creditor"};_s(n),$a(!0)},className:"bg-orange-500 hover:bg-orange-600",children:"Ø­ÙØ¸"})}),e.jsx("div",{className:"mt-2",children:e.jsx(w,{variant:"outline",className:"w-full",onClick:()=>fa(!0),children:"Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ø¯ÙŠÙˆÙ†"})}),e.jsx("div",{className:"mt-2",children:e.jsx(w,{variant:"outline",className:"w-full",onClick:()=>Fr(!0),children:"Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„"})})]})}),e.jsx(oe,{open:Mr,onOpenChange:fa,children:e.jsxs(le,{className:"w-[95vw] sm:w-auto sm:max-w-[520px] rounded-2xl",children:[e.jsxs(ce,{children:[e.jsx(de,{className:"text-right",children:"Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ø¯ÙŠÙˆÙ†"}),e.jsx(at,{className:"text-right",children:"Ø§Ø®ØªØ± Ø¯ÙŠÙ†Ù‹Ø§ Ù„Ø¹Ø±Ø¶ Ø¥ÙŠØµØ§Ù„Ù‡ Ø¨Ø§Ù„ØªÙØµÙŠÙ„"})]}),he.length>0?e.jsxs("div",{className:"max-h-[70vh] overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 space-y-2 px-1 -mx-1 sm:mx-0 sm:px-0",style:{contain:"layout paint"},onScroll:t=>{const s=t.currentTarget;Ur.length<he.length&&s.scrollTop+s.clientHeight>=s.scrollHeight-50&&Br(n=>n+1)},children:[Ur.map(t=>e.jsx("div",{onClick:()=>{ta(t),aa(!0),fa(!1),Ua(!1)},className:`p-4 sm:p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors min-h-[64px] ${t.type==="debtor"?"border-r-4 border-r-red-500 bg-red-50/10":"border-r-4 border-r-emerald-500"}`,children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center",children:[e.jsxs("div",{className:"text-right space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-[14px] sm:text-sm",children:t.debtorName}),t.type==="debtor"&&e.jsx(ia,{variant:"destructive",className:"h-5 text-[10px] px-1",children:"Ø¹Ù„ÙŠÙ†Ø§"}),(!t.type||t.type==="creditor")&&e.jsx(ia,{variant:"outline",className:"h-5 text-[10px] px-1 text-emerald-700 border-emerald-200 bg-emerald-50",children:"Ù„Ù†Ø§"})]}),e.jsx("p",{className:"text-[13px] sm:text-sm text-gray-600",children:t.reason}),e.jsx("p",{className:"text-[12px] sm:text-sm text-gray-500",children:qn.format(t.createdAt instanceof Date?t.createdAt:new Date(t.createdAt))})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-bold text-xl sm:text-lg",children:[t.amount," Ø¬Ù†ÙŠÙ‡"]}),e.jsx(ia,{variant:t.status==="paid"?"default":"secondary",className:`${t.status==="paid"?"bg-green-500":"bg-yellow-500"} text-[12px] sm:text-xs`,children:t.status==="paid"?"Ù…Ø¯ÙÙˆØ¹":"Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"})]})]})},t.id)),Ur.length<he.length&&e.jsx("div",{className:"flex justify-center pt-1",children:e.jsx(w,{variant:"outline",size:"sm",onClick:()=>Br(t=>t+1),children:"ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯"})})]}):e.jsx("div",{className:"text-center text-sm text-gray-500",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙŠÙˆÙ† Ù…Ø³Ø¬Ù„Ø©"}),e.jsxs(be,{className:"flex justify-between mt-3",children:[e.jsx(w,{variant:"destructive",onClick:async()=>{try{if(!he||he.length===0){f({title:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙŠÙˆÙ†",description:"Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ© Ø¨Ø§Ù„ÙØ¹Ù„."});return}if(!window.confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙƒÙ„ Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ø¯ÙŠÙˆÙ†ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡."))return;const s=[];if(Ge(s),ta(null),await Dt(s),a!=null&&a.uid)try{await K.updateUserData(a.uid,{debts:[],debtsDeletedAt:et()});try{localStorage.removeItem(`debts_unsynced_${a.uid}`)}catch{}}catch(n){console.error("ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ø¯ÙŠÙˆÙ† Ù…Ù† Firebase:",n),f({title:"ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©",description:"ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª Ù…Ù† FirebaseØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",variant:"destructive"});return}f({title:"ØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ø¯ÙŠÙˆÙ†",description:"ØªÙ… ØªÙØ±ÙŠØº Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„."}),fa(!1)}catch(t){console.error("ØªØ¹Ø°Ø± Ø­Ø°Ù ÙƒÙ„ Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ø¯ÙŠÙˆÙ†:",t),f({title:"ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù",description:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°ÙØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",variant:"destructive"})}},children:"Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª"}),e.jsx(w,{variant:"outline",onClick:()=>fa(!1),children:"Ø¥ØºÙ„Ø§Ù‚"})]})]})}),e.jsx(oe,{open:kd,onOpenChange:Fr,children:e.jsxs(le,{className:"sm:max-w-[500px] w-full max-h-[90vh] overflow-hidden flex flex-col p-0 gap-0 bg-gray-50/50",children:[e.jsx("div",{className:"p-4 border-b bg-white",children:e.jsxs(ce,{children:[e.jsxs(de,{className:"text-right flex items-center justify-end gap-2",children:[e.jsx(qs,{className:"w-5 h-5 text-primary"}),"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø¯ÙŠÙˆÙ†"]}),e.jsx(at,{className:"text-right",children:"Ø³Ø¬Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ø¯ÙŠÙˆÙ† Ø¨Ø³Ù‡ÙˆÙ„Ø©"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs(zt,{className:"border shadow-sm bg-white",children:[e.jsx(va,{className:"pb-2 pt-4 px-4",children:e.jsxs(Na,{className:"text-sm font-medium text-right text-gray-700 flex items-center justify-end gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯"]})}),e.jsxs(qt,{className:"p-4 pt-2 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{className:"text-right block text-xs text-gray-500",children:"Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"}),e.jsx(U,{value:Vr,onChange:t=>Uo(t.target.value),className:"text-right h-9",placeholder:"Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{className:"text-right block text-xs text-gray-500",children:"Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„"}),e.jsx(U,{value:zr,onChange:t=>Fo(t.target.value),className:"text-right h-9",placeholder:"Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„"})]}),e.jsxs(w,{className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white h-9 mt-2",onClick:async()=>{if(!Vr||!zr){f({title:"Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„",variant:"destructive"});return}const t={id:Date.now().toString(),name:Vr.trim(),mobile:zr.trim(),createdAt:new Date},s=[t,...ft];await ci(s),Uo(""),Fo(""),f({title:"ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„",description:`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${t.name}`})},children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„"]})]})]}),e.jsxs(zt,{className:"border shadow-sm bg-white",children:[e.jsx(va,{className:"pb-2 pt-4 px-4",children:e.jsxs(Na,{className:"text-sm font-medium text-right text-gray-700 flex items-center justify-end gap-2",children:[e.jsx(Jt,{className:"w-4 h-4 text-orange-600"}),"ØªØ³Ø¬ÙŠÙ„ Ù…Ø¨Ù„Øº Ø¯ÙŠÙ†"]})}),e.jsx(qt,{className:"p-4 pt-2 space-y-3",children:ft.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{className:"text-right block text-xs text-gray-500",children:"Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„"}),e.jsxs(Xa,{value:Fa,onValueChange:$o,children:[e.jsx(es,{className:"w-full h-9 text-right",dir:"rtl",children:e.jsx(ts,{placeholder:"Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„"})}),e.jsx(as,{children:ft.map(t=>e.jsxs(Kt,{value:t.id,className:"text-right justify-end",children:[t.name," â€” ",t.mobile]},t.id))})]}),Fa&&(()=>{const t=he.filter(s=>s.customerId===Fa&&s.status==="pending").reduce((s,n)=>s+(n.amount-(n.paidAmount||0)),0);return t>0?e.jsxs("div",{className:"text-xs text-red-600 font-semibold mt-1 text-right",children:["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ",t.toFixed(2)," Ø¬Ù†ÙŠÙ‡"]}):null})()]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(q,{className:"text-right block text-xs text-gray-500",children:"Ø§Ù„Ù…Ø¨Ù„Øº"}),e.jsx(U,{type:"number",value:Vo,onChange:t=>Pd(t.target.value),className:"text-right h-9",placeholder:"0.00"})]}),e.jsx(w,{className:"w-full bg-orange-600 hover:bg-orange-700 text-white h-9 mt-2",onClick:async()=>{const t=parseFloat(Vo);if(!Fa){f({title:"Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„",description:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹",variant:"destructive"});return}if(isNaN(t)||t<=0){f({title:"Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­",variant:"destructive"});return}const s=ft.find(r=>r.id===Fa);if(!s)return;const n={id:Date.now().toString(),debtorName:s.name,customerId:s.id,mobile:s.mobile,amount:Number(t.toFixed(2)),reason:"Ø¯ÙŠÙ† Ø¹Ù…ÙŠÙ„",status:"pending",createdAt:new Date,paidAmount:0,partialPayments:[]};_s(n),$a(!0)},children:"Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¨Ù„Øº"})]}):e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm bg-gray-50 rounded border border-dashed",children:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø³Ø¬Ù„ÙŠÙ†. Ø£Ø¶Ù Ø¹Ù…ÙŠÙ„Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹."})})]}),e.jsxs(zt,{className:"border shadow-sm bg-white",children:[e.jsx(va,{className:"pb-2 pt-4 px-4",children:e.jsxs(Na,{className:"text-sm font-medium text-right text-gray-700 flex items-center justify-end gap-2",children:[e.jsx(Hl,{className:"w-4 h-4"}),"Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† (",ft.length,")"]})}),e.jsx(qt,{className:"p-4 pt-2",children:ft.length>0?e.jsx("div",{className:"space-y-2",children:ft.map(t=>e.jsxs("div",{className:"p-3 border rounded-lg flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>{zo(t.id),qr(t.name||""),Kr(t.mobile||""),bn(!0)},children:e.jsx(Jl,{className:"h-4 w-4"})}),e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>{Jr(t.id),Qr(t.name||""),vn(!0)},children:e.jsx(Wt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:t.mobile})]})]},t.id))}):e.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§"})})]})]}),e.jsx(be,{className:"p-4 border-t bg-white",children:e.jsx(w,{variant:"outline",className:"w-full sm:w-auto",onClick:()=>Fr(!1),children:"Ø¥ØºÙ„Ø§Ù‚"})})]})}),e.jsx(oe,{open:Wd,onOpenChange:vn,children:e.jsxs(le,{hideClose:!0,className:"sm:max-w-[420px] rounded-2xl bg-gradient-to-br from-white via-rose-50 to-red-50 shadow-2xl border border-red-100 text-center",children:[e.jsxs(ce,{children:[e.jsx(de,{className:"text-center text-xl font-bold text-red-700",children:"ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„"}),e.jsxs(at,{className:"text-center text-gray-600",children:["Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§: ",Jo]})]}),e.jsx("div",{className:"py-2 text-sm text-gray-700",children:"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡."}),e.jsxs(be,{className:"flex justify-center gap-3",children:[e.jsx(w,{variant:"outline",onClick:()=>{vn(!1),Jr(""),Qr("")},children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(w,{variant:"destructive",className:"bg-red-600 hover:bg-red-700",onClick:async()=>{const t=Rd,s=ft.filter(n=>n.id!==t);await ci(s),Fa===t&&$o(""),vn(!1),Jr(""),Qr(""),f({title:"ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„",description:Jo})},children:"Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ"})]})]})}),e.jsx(oe,{open:Od,onOpenChange:bn,children:e.jsxs(le,{className:"sm:max-w-[420px]",children:[e.jsx(ce,{children:e.jsx(de,{className:"text-right",children:"ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"editCustomerName",className:"text-right col-span-1",children:"Ø§Ù„Ø§Ø³Ù…"}),e.jsx(U,{id:"editCustomerName",value:qo,onChange:t=>qr(t.target.value),className:"col-span-3 text-right"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"editCustomerMobile",className:"text-right col-span-1",children:"Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„"}),e.jsx(U,{id:"editCustomerMobile",value:Ko,onChange:t=>Kr(t.target.value),className:"col-span-3 text-right"})]})]}),e.jsxs(be,{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>bn(!1),children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(w,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{const t=Ld,s=qo.trim(),n=Ko.trim();if(!t||!s||!n){f({title:"Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©",description:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„",variant:"destructive"});return}const r=ft.map(o=>o.id===t?{...o,name:s,mobile:n}:o);await ci(r);const i=he.map(o=>o.customerId===t?{...o,debtorName:s,mobile:n}:o);i!==he&&(Ge(i),await Dt(i)),bn(!1),zo(""),qr(""),Kr(""),f({title:"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…ÙŠÙ„",description:s})},children:"Ø­ÙØ¸"})]})]})}),e.jsx(oe,{open:jc,onOpenChange:ca,children:e.jsxs(le,{className:"sm:max-w-[520px]",children:[e.jsxs(ce,{children:[e.jsx(de,{className:"text-right",children:"Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ù…Ø­Ù„"}),e.jsx(at,{className:"text-right",children:"Ø£Ø¯Ø®Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø«Ù… Ø§Ø®ØªØ± Ù…ØµØ¯Ø± Ø§Ù„Ø®ØµÙ…."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"expenseName",className:"text-right col-span-1",children:"Ø§Ø³Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ"}),e.jsx(U,{id:"expenseName",value:nn,onChange:t=>Vi(t.target.value),className:"col-span-3 text-right",placeholder:"Ù…Ø«Ø§Ù„: ÙƒÙ‡Ø±Ø¨Ø§Ø¡ØŒ ØµÙŠØ§Ù†Ø©ØŒ Ù…Ø´ØªØ±ÙŠØ§Øª"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"expenseAmount",className:"text-right col-span-1",children:"ØªÙ…Ù† Ø§Ù„Ù…ØµØ±ÙˆÙ"}),e.jsx(U,{id:"expenseAmount",type:"number",value:sr,onChange:t=>zi(t.target.value),className:"col-span-3 text-right",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"expenseNotes",className:"text-right col-span-1",children:"Ù…Ù„Ø§Ø­Ø¸Ø§Øª"}),e.jsx(U,{id:"expenseNotes",value:nr,onChange:t=>qi(t.target.value),className:"col-span-3 text-right",placeholder:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¥Ù† ÙˆØ¬Ø¯Øª"})]})]}),e.jsxs(be,{className:"flex justify-between",children:[e.jsx(w,{className:"bg-orange-600 hover:bg-orange-700",onClick:()=>{if(!nn||!sr){f({title:"Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ ÙˆÙ‚ÙŠÙ…ØªÙ‡",variant:"destructive"});return}on(!0)},children:"Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ"}),e.jsx(w,{variant:"outline",onClick:()=>or(!0),children:"Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ"})]})]})}),e.jsx(oe,{open:Ic,onOpenChange:or,children:e.jsxs(le,{className:"sm:max-w-[420px]",dir:"rtl",children:[e.jsxs(ce,{children:[e.jsx(de,{className:"text-right",children:"Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ"}),e.jsx(at,{className:"text-right",children:"Ø¢Ø®Ø± Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©"})]}),rn.length>0?e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:rn.map(t=>e.jsx("div",{className:"p-2 border rounded-lg bg-white hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-sm",children:t.name}),e.jsx("p",{className:"text-[11px] text-gray-600",children:t.notes||"Ø¨Ø¯ÙˆÙ† Ù…Ù„Ø§Ø­Ø¸Ø§Øª"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:new Date(t.createdAt).toLocaleString("ar-EG")})]}),e.jsxs("div",{className:"text-left flex items-start gap-2",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-bold text-sm",children:[t.amount," Ø¬Ù†ÙŠÙ‡"]}),e.jsx(ia,{variant:"secondary",className:t.source==="cash"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700",children:t.source==="cash"?"Ù…Ù† Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©":`Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©${t.walletId?` (${t.walletId})`:""}`})]}),e.jsxs(w,{variant:"destructive",size:"sm",className:"shrink-0",onClick:()=>Xd(t.id),title:"Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ",children:[e.jsx(Wt,{className:"w-4 h-4 ml-1"}),"Ø­Ø°Ù"]})]})]})},t.id))}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ§Ø±ÙŠÙ Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯"})]})}),e.jsx(oe,{open:Dc,onOpenChange:on,children:e.jsxs(le,{className:"sm:max-w-[480px]",children:[e.jsx(ce,{children:e.jsx(de,{className:"text-right",children:"Ø§Ø®ØªÙŠØ§Ø± Ù…ØµØ¯Ø± Ø®ØµÙ… Ø§Ù„Ù…ØµØ±ÙˆÙ"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 text-right",children:"Ø§Ø®ØªØ± Ù‡Ù„ ØªØ±ÙŠØ¯ Ø®ØµÙ… Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØµØ±ÙˆÙ Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ ÙÙŠ Ø§Ù„Ø¯Ø±Ø¬ Ø£Ù… Ù…Ù† Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø­Ø§ÙØ¸."}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(w,{variant:Ke==="cash"?"default":"outline",className:Ke==="cash"?"bg-blue-600 hover:bg-blue-700 text-white":"",onClick:()=>ps("cash"),children:"Ø§Ù„ÙÙ„ÙˆØ³ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©"}),e.jsx(w,{variant:Ke==="wallet"?"default":"outline",className:Ke==="wallet"?"bg-purple-600 hover:bg-purple-700 text-white":"",onClick:()=>ps("wallet"),children:"Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸"}),e.jsx(w,{variant:Ke==="fawry"?"default":"outline",className:Ke==="fawry"?"bg-amber-600 hover:bg-amber-700 text-white":"",onClick:()=>ps("fawry"),children:"ÙÙˆØ±ÙŠ"})]}),Ke==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"text-right block",children:"Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù„Ù„Ø®ØµÙ…"}),e.jsxs(Xa,{value:ka,onValueChange:ir,children:[e.jsx(es,{className:"w-full",children:e.jsx(ts,{placeholder:"Ø§Ø®ØªØ± Ù…Ø­ÙØ¸Ø©"})}),e.jsx(as,{children:O.map(t=>e.jsx(Kt,{value:t.id,children:t.phone||t.name||t.id},t.id))})]})]})]}),e.jsxs(be,{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>{on(!1),ps(null),ir("")},children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(w,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{const t=Number(sr);if(isNaN(t)||t<=0){f({title:"Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­",variant:"destructive"});return}if(!Ke){f({title:"Ø§Ø®ØªØ± Ù…ØµØ¯Ø± Ø§Ù„Ø®ØµÙ…",description:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø£Ùˆ Ø§Ù„Ù…Ø­ÙØ¸Ø©",variant:"destructive"});return}try{if(Ke==="cash"){const i=Number((we-t).toFixed(2));Oe(i),localStorage.setItem(je(),i.toString());const o={cashBalance:i,lastUpdated:new Date().toISOString()},l=`userData_${a==null?void 0:a.uid}`;localStorage.setItem(l,JSON.stringify(o)),a!=null&&a.uid?(await K.updateUserData(a.uid,o),localStorage.removeItem(l),H(!1)):H(!0)}else if(Ke==="wallet"){if(!ka){f({title:"Ø§Ø®ØªØ± Ù…Ø­ÙØ¸Ø©",description:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙØ¸Ø© Ù„Ù„Ø®ØµÙ…",variant:"destructive"});return}const i=ee[ka]||0,o=Number((i-t).toFixed(2)),l={...ee,[ka]:o};Me(l);const d=new Date().toISOString(),p={walletBalances:l,lastUpdated:d},m=`userData_${a==null?void 0:a.uid}`;localStorage.setItem(m,JSON.stringify(p)),localStorage.setItem(Te(),JSON.stringify(l)),localStorage.setItem(`walletBalances_backup_${d}`,JSON.stringify(l)),a!=null&&a.uid&&K.updateUserData(a.uid,p).catch(()=>{})}}catch(i){console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø¹Ù†Ø¯ Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ:",i)}let s=Date.now().toString();try{if(a!=null&&a.uid){const{addDoc:i,collection:o,serverTimestamp:l}=await F(async()=>{const{addDoc:m,collection:u,serverTimestamp:g}=await import("./index-bCWIXU_s.js").then(x=>x.ck);return{addDoc:m,collection:u,serverTimestamp:g}},__vite__mapDeps([0,1]),import.meta.url),{db:d}=await F(async()=>{const{db:m}=await import("./index-bCWIXU_s.js").then(u=>u.cl);return{db:m}},__vite__mapDeps([0,1]),import.meta.url);s=(await i(o(d,"shop_expenses"),{userId:a.uid,shopId:_||(h==null?void 0:h.shopId)||a.uid||"default-shop",name:nn,amount:t,notes:nr||"",source:Ke,walletId:Ke==="wallet"?ka:null,createdAt:l()})).id}}catch(i){console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ ÙÙŠ Firestore:",i)}const n={id:s,name:nn,amount:t,notes:nr,source:Ke,walletId:Ke==="wallet"?ka:void 0,createdAt:new Date},r=[...rn,n];await ol(r),Vi(""),zi(""),qi(""),ps(null),ir(""),on(!1),ca(!0),or(!0),f({title:"ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ±ÙˆÙ",description:Ke==="cash"?"ØªÙ… Ø§Ù„Ø®ØµÙ… Ù…Ù† Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©":Ke==="wallet"?"ØªÙ… Ø§Ù„Ø®ØµÙ… Ù…Ù† Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸":"ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ÙÙˆØ±ÙŠ"})},children:"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø®ØµÙ…"})]})]})}),e.jsx(oe,{open:Ac,onOpenChange:fs,children:e.jsxs(le,{className:"sm:max-w-[520px]",children:[e.jsxs(ce,{children:[e.jsx(de,{className:"text-right",children:"Ø§Ù„Ù†ÙˆØ§Ù‚Øµ"}),e.jsx(at,{className:"text-right",children:"Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ø§Ù‚ØµØ© Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ø´Ø±Ø§Ø¡ ÙˆØªØ§Ø¨Ø¹ Ø­Ø§Ù„ØªÙ‡Ø§."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"deficiencyName",className:"text-right col-span-1",children:"Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±"}),e.jsx(U,{id:"deficiencyName",value:gs,onChange:t=>lr(t.target.value),className:"col-span-3 text-right",placeholder:"Ù…Ø«Ø§Ù„: Ø³ÙƒØ±ØŒ Ø²ÙŠØªØŒ Ù…Ù†Ø§Ø¯ÙŠÙ„"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(q,{htmlFor:"deficiencyQuantity",className:"text-right col-span-1",children:"Ø§Ù„ÙƒÙ…ÙŠØ©"}),e.jsx(U,{id:"deficiencyQuantity",type:"number",value:Ki,onChange:t=>cr(t.target.value),className:"col-span-3 text-right",placeholder:"1"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(w,{className:"bg-rose-600 hover:bg-rose-700",onClick:()=>{if(se){f({title:"ØºÙŠØ± Ù…ØªØ§Ø­",description:"Ø§Ù„Ù†ÙˆØ§Ù‚Øµ ØºÙŠØ± Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·Ø© Ø²ÙŠØ±Ùˆ. Ù‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ©.",variant:"destructive"});return}const t=parseInt(Ki||"1",10);if(!gs){f({title:"Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±",variant:"destructive"});return}if(isNaN(t)||t<=0){f({title:"ÙƒÙ…ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©",variant:"destructive"});return}(async()=>{if(a!=null&&a.uid)try{const{collection:n,addDoc:r,serverTimestamp:i}=await F(async()=>{const{collection:d,addDoc:p,serverTimestamp:m}=await import("./index-bCWIXU_s.js").then(u=>u.ck);return{collection:d,addDoc:p,serverTimestamp:m}},__vite__mapDeps([0,1]),import.meta.url),{db:o}=await F(async()=>{const{db:d}=await import("./index-bCWIXU_s.js").then(p=>p.cl);return{db:d}},__vite__mapDeps([0,1]),import.meta.url),l=await r(n(o,"deficiencies"),{userId:a.uid,shopId:_||(h==null?void 0:h.shopId)||a.uid||"default-shop",name:gs,quantity:t,status:"pending",createdAt:i()});try{const d=Tn(),p=localStorage.getItem(d),m=p?JSON.parse(p):[],u=Array.isArray(m)?m:[],g=u.some(N=>String((N==null?void 0:N.id)||"")===l.id),x={id:l.id,name:gs,quantity:t,status:"pending",createdAt:new Date().toISOString()},y=g?u:[...u,x];localStorage.setItem(d,JSON.stringify(y))}catch{}lr(""),cr(""),f({title:"ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©",description:"ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ÙˆØ§Ù‚Øµ"});return}catch(n){console.warn("ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ù†ÙˆØ§Ù‚Øµ Ø¥Ù„Ù‰ FirestoreØŒ Ø³ÙŠÙØ³ØªØ®Ø¯Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ:",n)}const s={id:Date.now().toString(),name:gs,quantity:t,status:"pending",createdAt:new Date};Pa(n=>{const r=[...n,s];return li(r),r}),lr(""),cr(""),f({title:"ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©",description:"ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ÙˆØ§Ù‚Øµ"})})()},children:"Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù†ÙˆØ§Ù‚Øµ"})}),Ji.length>0?e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Ji.map(t=>e.jsx("div",{className:"p-2 border rounded-lg bg-white hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-sm",children:t.name}),e.jsxs("p",{className:"text-[11px] text-gray-600",children:["Ø§Ù„ÙƒÙ…ÙŠØ©: ",t.quantity]}),e.jsx("p",{className:"text-[10px] text-gray-500",children:new Date(t.createdAt).toLocaleString("ar-EG")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ia,{variant:"secondary",className:t.status==="pending"?"bg-rose-100 text-rose-700":"bg-green-100 text-green-700",children:t.status==="pending"?"Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø±Ø§Ø¡":"ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡"}),e.jsx(w,{variant:"outline",className:t.status==="pending"?"text-green-700 border-green-300 hover:bg-green-50":"text-rose-700 border-rose-300 hover:bg-rose-50",onClick:()=>{(async()=>{const s=t.status==="pending"?"purchased":"pending";if(a!=null&&a.uid)try{const{doc:n,updateDoc:r,serverTimestamp:i}=await F(async()=>{const{doc:l,updateDoc:d,serverTimestamp:p}=await import("./index-bCWIXU_s.js").then(m=>m.ck);return{doc:l,updateDoc:d,serverTimestamp:p}},__vite__mapDeps([0,1]),import.meta.url),{db:o}=await F(async()=>{const{db:l}=await import("./index-bCWIXU_s.js").then(d=>d.cl);return{db:l}},__vite__mapDeps([0,1]),import.meta.url);await r(n(o,"deficiencies",t.id),{status:s,updatedAt:i()});return}catch(n){console.warn("ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙˆØ§Ù‚Øµ Ø¹Ù„Ù‰ FirestoreØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ:",n)}Pa(n=>{const r=n.map(i=>i.id===t.id?{...i,status:s}:i);return li(r),r})})()},title:t.status==="pending"?"ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡":"Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø´Ø±Ø§Ø¡",children:t.status==="pending"?"ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡":"Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø´Ø±Ø§Ø¡"}),e.jsx(w,{variant:"outline",className:"text-red-700 border-red-300 hover:bg-red-50",onClick:()=>{(async()=>{if(a!=null&&a.uid)try{const{doc:s,deleteDoc:n}=await F(async()=>{const{doc:i,deleteDoc:o}=await import("./index-bCWIXU_s.js").then(l=>l.ck);return{doc:i,deleteDoc:o}},__vite__mapDeps([0,1]),import.meta.url),{db:r}=await F(async()=>{const{db:i}=await import("./index-bCWIXU_s.js").then(o=>o.cl);return{db:i}},__vite__mapDeps([0,1]),import.meta.url);await n(s(r,"deficiencies",t.id));return}catch(s){console.warn("ÙØ´Ù„ Ø­Ø°Ù Ø¹Ù†ØµØ± Ø§Ù„Ù†ÙˆØ§Ù‚Øµ Ù…Ù† FirestoreØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ:",s)}Pa(s=>{const n=s.filter(r=>r.id!==t.id);return li(n),n})})()},title:"Ø­Ø°Ù",children:"Ø­Ø°Ù"})]})]})},t.id))}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ø§Ù„Ù†ÙˆØ§Ù‚Øµ"})]}),e.jsx(be,{className:"flex justify-end",children:e.jsx(w,{variant:"outline",onClick:()=>fs(!1),children:"Ø¥ØºÙ„Ø§Ù‚"})})]})}),e.jsx(oe,{open:Md,onOpenChange:$a,children:e.jsxs(le,{className:"sm:max-w-[480px]",children:[e.jsx(ce,{children:e.jsx(de,{className:"text-right",children:(Ae==null?void 0:Ae.type)==="decrease"?"Ø§Ø®ØªÙŠØ§Ø± Ù…ÙƒØ§Ù† Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯":"Ø§Ø®ØªÙŠØ§Ø± Ù…ØµØ¯Ø± Ø®ØµÙ… Ø§Ù„Ø¯ÙŠÙ†"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 text-right",children:(Ae==null?void 0:Ae.type)==="decrease"?"Ø§Ø®ØªØ± Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ Ø£Ù… Ø¥Ù„Ù‰ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø£Ùˆ ØªØ³Ø¬ÙŠÙ„Ù‡ Ø¨Ø¯ÙˆÙ† Ø®ØµÙ….":"Ø§Ø®ØªØ± Ù‡Ù„ ØªØ±ÙŠØ¯ Ø®ØµÙ… Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙŠÙ† Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ ÙÙŠ Ø§Ù„Ø¯Ø±Ø¬ Ø£Ù… Ù…Ù† Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø£Ùˆ ØªØ³Ø¬ÙŠÙ„Ù‡ Ø¨Ø¯ÙˆÙ† Ø®ØµÙ…."}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(w,{variant:ot==="cash"?"default":"outline",className:ot==="cash"?"bg-blue-600 hover:bg-blue-700 text-white":"",onClick:()=>Es("cash"),children:"Ø§Ù„ÙÙ„ÙˆØ³ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©"}),e.jsx(w,{variant:ot==="wallet"?"default":"outline",className:ot==="wallet"?"bg-purple-600 hover:bg-purple-700 text-white":"",onClick:()=>Es("wallet"),children:"Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸"}),e.jsx(w,{variant:ot==="none"?"default":"outline",className:ot==="none"?"bg-gray-600 hover:bg-gray-700 text-white":"",onClick:()=>Es("none"),children:(Ae==null?void 0:Ae.type)==="decrease"?"Ø¨Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØ©":"Ø¨Ø¯ÙˆÙ† Ø®ØµÙ…"})]}),ot==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"text-right block",children:(Ae==null?void 0:Ae.type)==="decrease"?"Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù„Ù„Ø¥Ø¶Ø§ÙØ©":"Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù„Ù„Ø®ØµÙ…"}),e.jsxs(Xa,{value:ks,onValueChange:Yr,children:[e.jsx(es,{className:"w-full",children:e.jsx(ts,{placeholder:"Ø§Ø®ØªØ± Ù…Ø­ÙØ¸Ø©"})}),e.jsx(as,{children:O.map(t=>e.jsx(Kt,{value:t.id,children:t.phone||t.name||t.id},t.id))})]})]})]}),e.jsxs(be,{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",onClick:()=>{$a(!1),_s(null),Es(null),Yr("")},children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(w,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{const t=!!Ae,s=t&&(Ae==null?void 0:Ae.type)==="decrease",n=Number(t?Ae.delta:(ga==null?void 0:ga.amount)||0);if(!ot){f({title:s?"Ø§Ø®ØªØ± Ù…ÙƒØ§Ù† Ø§Ù„Ø¥Ø¶Ø§ÙØ©":"Ø§Ø®ØªØ± Ù…ØµØ¯Ø± Ø§Ù„Ø®ØµÙ…",description:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø£Ùˆ Ø§Ù„Ù…Ø­ÙØ¸Ø©",variant:"destructive"});return}const r=new Date().toISOString();let i=we,o=ee,l=!1,d=!1;try{if(ot==="cash")i=Number(s?(we+n).toFixed(2):(we-n).toFixed(2)),l=!0;else if(ot==="wallet"){if(!ks){f({title:"Ø§Ø®ØªØ± Ù…Ø­ÙØ¸Ø©",description:s?"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙØ¸Ø© Ù„Ù„Ø¥Ø¶Ø§ÙØ©":"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙØ¸Ø© Ù„Ù„Ø®ØµÙ…",variant:"destructive"});return}const y=ee[ks]||0,N=Number(s?(y+n).toFixed(2):(y-n).toFixed(2));o={...ee,[ks]:N},d=!0}}catch(y){console.error("Error calculating balances:",y);return}let p=[...he],m=C,u=!1;if(t){if(!C)return;const y=Number(C.amount||0),N=Number(C.paidAmount||0),E=Number(Ae.delta||0);if(Ae.type==="decrease"){const v=Number((y-E).toFixed(2)),S=N>=v,P={...C,amount:v,status:S?"paid":"pending"};if(p=he.map(z=>z.id===C.id?P:z),m=P,u=!0,S&&(a!=null&&a.uid)&&(async()=>{try{const[z,Ne,$e]=[ve(ne(W,"userTransactions"),Q("userId","==",a.uid),Q("linkedDebtId","==",C.id),Q("status","==","pending")),ve(ne(W,"transactions"),Q("userId","==",a.uid),Q("linkedDebtId","==",C.id),Q("status","==","pending")),ve(ne(W,"transactions"),Q("merchantUserId","==",a.uid),Q("linkedDebtId","==",C.id),Q("status","==","pending"))],[re,pe,Be]=await Promise.all([fe(z),fe(Ne),fe($e)]),Ve=tu(W);let ra=0;const Qa=k=>{k.docs.forEach(R=>{Ve.update(R.ref,{status:"completed",confirmedAt:new Date}),ra++})};Qa(re),Qa(pe),Qa(Be),ra>0&&await Ve.commit(),a!=null&&a.uid&&[...re.docs.map(R=>{var te;return String(((te=R.data())==null?void 0:te.transactionId)||"")}),...pe.docs.map(R=>{var te;return String(R.id||((te=R.data())==null?void 0:te.transactionId)||"")}),...Be.docs.map(R=>{var te;return String(R.id||((te=R.data())==null?void 0:te.transactionId)||"")})].filter(Boolean).forEach(R=>K.removeLocalReceiptById(a.uid,R))}catch(z){console.error("Batch update failed for linked transactions:",z)}})().catch(z=>{console.error("Transaction update error:",z)}),a!=null&&a.uid&&ot!=="none")try{const Ne={transactionId:ge(ne(W,"dummy_collection")).id,amount:E,transactionType:"cash_addition",type:"cash_addition",status:"completed",createdAt:new Date,senderName:C.debtorName,receiverName:"Ø§Ù„Ù…Ø­Ù„",description:`Ø³Ø¯Ø§Ø¯ Ø¯ÙŠÙ† Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ ${C.debtorName}`,paymentMethod:ot,walletId:ot==="wallet"?ks:null,linkedDebtId:C.id,isDebtRepayment:!0};await K.saveUserTransaction(a.uid,Ne);try{me.invalidateQueries({queryKey:["recentTransactions",a==null?void 0:a.uid]})}catch{}}catch(z){console.error("Failed to create repayment receipt:",z)}f({title:"ØªÙ… Ø¥Ù†Ù‚Ø§Øµ Ø§Ù„Ù…Ø¨Ù„Øº",description:`Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${v} Ø¬Ù†ÙŠÙ‡`})}else{const v=y+E,S=N>=v,P={...C,amount:Number(v.toFixed(2)),status:S?"paid":"pending"};p=he.map(z=>z.id===C.id?P:z),m=P,u=!0,f({title:"ØªÙ… Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¨Ù„Øº",description:`Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${v} Ø¬Ù†ÙŠÙ‡`})}}else if(ga){p=[{...ga,userId:a==null?void 0:a.uid,shopId:_||(h==null?void 0:h.shopId)||null},...he],u=!0;try{a!=null&&a.uid&&ba.send(a.uid,`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† Ø¹Ù„Ù‰ ${ga.debtorName} Ø¨Ù…Ø¨Ù„Øº ${ga.amount} Ø¬Ù†ÙŠÙ‡`).catch(()=>{})}catch{}}l&&Oe(i),d&&Me(o),u&&(Ge(p),t&&ta(m)),Eo(""),ko(""),Po(""),Ua(!1),$a(!1),!t&&u&&fa(!0),_s(null),Ro(null),Es(null),Yr(""),f({title:t?"ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ†":"ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙ†",description:ot==="none"?"Ù„Ù… ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø±ØµØ¯Ø©":ot==="cash"?s?`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${n} Ø¥Ù„Ù‰ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ`:`ØªÙ… Ø®ØµÙ… ${n} Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ`:s?`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${n} Ø¥Ù„Ù‰ Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©`:`ØªÙ… Ø®ØµÙ… ${n} Ù…Ù† Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©`});const g={lastUpdated:r};if(l&&(g.cashBalance=i),d&&(g.walletBalances=o),u&&(g.debts=p,g.debtsDeletedAt=null),l&&(localStorage.setItem(je(),i.toString()),localStorage.setItem(je()+"_lastUpdated",r)),d&&(localStorage.setItem(Te(),JSON.stringify(o)),localStorage.setItem(Te()+"_lastUpdated",r)),u){localStorage.setItem(Os(),JSON.stringify(p));try{localStorage.setItem(ri(),JSON.stringify(p))}catch{}try{localStorage.setItem(ii(),Date.now().toString())}catch{}}const x=`userData_${a==null?void 0:a.uid}`;if(localStorage.setItem(x,JSON.stringify(g)),a!=null&&a.uid){if(u)try{localStorage.setItem(`debts_unsynced_${a.uid}`,"true")}catch{}const y=[];y.push(K.updateUserData(a.uid,g).then(()=>{(l||d)&&(localStorage.removeItem(x),H(!1))}));const N=_||(h==null?void 0:h.shopId);if(N&&(l||d)){const E={lastUpdated:r};l&&(E.cashBalance=i),d&&(E.walletBalances=o),y.push(At(ge(W,"dashboardData",N),E,{merge:!0}).catch(v=>console.error("Failed to sync to dashboardData",v)))}Promise.all(y).then(()=>{if(u)try{localStorage.removeItem(`debts_unsynced_${a.uid}`)}catch{}}).catch(E=>{console.error("Sync error:",E),H(!0)})}},children:(Ae==null?void 0:Ae.type)==="decrease"?"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©":"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø®ØµÙ…"})]})]})}),e.jsx(oe,{open:Ad,onOpenChange:aa,children:e.jsxs(le,{className:"w-[95vw] sm:w-auto sm:max-w-[425px] rounded-2xl",children:[e.jsx(ce,{children:e.jsx(de,{className:"text-right",children:"Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙŠÙ†"})}),C&&e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"text-center border-b pb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Ø¥ÙŠØµØ§Ù„ Ø¯ÙŠÙ†"}),e.jsx("p",{className:"text-sm text-gray-500",children:qn.format(C.createdAt instanceof Date?C.createdAt:new Date(C.createdAt))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†:"}),e.jsx("span",{children:C.debtorName})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center",children:[e.jsx("span",{className:"font-medium",children:"Ø§Ù„Ù…Ø¨Ù„Øº:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{variant:"outline",className:"h-10 w-10 sm:h-8 sm:w-8 p-0","aria-label":"Ø¥Ù†Ù‚Ø§Øµ Ø§Ù„Ø¯ÙŠÙ†",onClick:()=>{Lo("decrease"),Lr(""),aa(!1),Ts(!0)},children:"âˆ’"}),e.jsxs("span",{className:"font-bold text-xl sm:text-lg",children:[C.amount," Ø¬Ù†ÙŠÙ‡"]}),e.jsx(w,{variant:"outline",className:"h-10 w-10 sm:h-8 sm:w-8 p-0","aria-label":"Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¯ÙŠÙ†",onClick:()=>{Lo("increase"),Lr(""),aa(!1),Ts(!0)},children:"+"})]})]}),(()=>{try{const t=(Y||[]).filter(s=>String((s==null?void 0:s.linkedDebtId)||"")===String(C.id)).reduce((s,n)=>s+Math.max(0,Number((n==null?void 0:n.commission)||0)),0);return t>0?e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"Ø§Ù„Ø±Ø¨Ø­:"}),e.jsxs("span",{className:"text-green-700 font-semibold",children:[t," Ø¬Ù†ÙŠÙ‡"]})]}):null}catch{return null}})(),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"Ø³Ø¨Ø¨ Ø§Ù„Ø¯ÙŠÙ†:"}),e.jsx("span",{children:C.reason})]}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"Ø§Ù„Ø­Ø§Ù„Ø©:"}),e.jsx(ia,{variant:C.status==="paid"?"default":"secondary",className:`${C.status==="paid"?"bg-green-500":"bg-yellow-500"} w-fit text-[12px] sm:text-xs`,children:C.status==="paid"?"Ù…Ø¯ÙÙˆØ¹":"Ù…Ø¤Ø¬Ù„"})]}),(()=>{try{const t=(Y||[]).filter(p=>String((p==null?void 0:p.linkedDebtId)||"")===String(C.id)),s=t.reduce((p,m)=>p+Math.max(0,Number((m==null?void 0:m.commission)||0)),0),n=t.reduce((p,m)=>p+Math.max(0,Number(((m==null?void 0:m.sentAmount)??(m==null?void 0:m.transferredAmount)??(m==null?void 0:m.withdrawnAmount)??(m==null?void 0:m.amount))||0)),0),r=Number(C.amount||0),i=Number(C.paidAmount||0),l=r<n+s?r+s:r,d=Math.max(0,Number(l)-i);return e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:"}),e.jsxs("span",{className:"font-bold text-xl sm:text-lg",children:[d," Ø¬Ù†ÙŠÙ‡"]})]})}catch{return e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:"}),e.jsxs("span",{className:"font-bold text-xl sm:text-lg",children:[Number(C.amount||0)-Number(C.paidAmount||0)," Ø¬Ù†ÙŠÙ‡"]})]})}})(),C.paidAmount?e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹:"}),e.jsxs("span",{className:"text-green-700",children:[C.paidAmount," Ø¬Ù†ÙŠÙ‡"]})]}):null,e.jsxs("div",{className:"mt-3 p-4 border rounded-xl bg-gray-50",children:[_d?e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"partialAmount",className:"text-right block",children:"Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¯ÙØ¹Ù‡"}),e.jsx(U,{id:"partialAmount",type:"number",value:Mo,onChange:t=>Rr(t.target.value),className:"text-right",placeholder:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{variant:"outline",onClick:()=>{Wr(!1),Rr("")},children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(w,{className:"bg-blue-600 hover:bg-blue-700",onClick:async()=>{const t=parseFloat(Mo);if(!C||isNaN(t)||t<=0){f({title:"Ø®Ø·Ø£",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­",variant:"destructive"});return}const s=Math.max(0,Number(C.amount||0)-Number(C.paidAmount||0));if(t>s){f({title:"Ù…Ø¨Ù„Øº Ø²Ø§Ø¦Ø¯",description:"Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ",variant:"destructive"});return}const n=Number(((C.paidAmount||0)+t).toFixed(2)),r=n>=Number(C.amount||0),i={...C,amount:Number(C.amount||0),paidAmount:n,status:r?"paid":"pending",partialPayments:[...C.partialPayments||[],{amount:t,paidAt:new Date}]},o=he.map(l=>l.id===C.id?i:l);Ge(o),ta(i),await Dt(o);try{if(a!=null&&a.uid){const l=Math.max(0,Number(i.amount||0)-Number(i.paidAmount||0));await ba.send(a.uid,`ØªÙ… Ø³Ø¯Ø§Ø¯ Ø¬Ø²Ø¡ Ù…Ù† Ø¯ÙŠÙ† ${i.debtorName}: Ø§Ù„Ù…Ø¯ÙÙˆØ¹ ${t} Ø¬Ù†ÙŠÙ‡ØŒ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ ${l} Ø¬Ù†ÙŠÙ‡`)}}catch{}try{i.status==="paid"&&(a!=null&&a.uid)&&(async()=>{const l=ve(ne(W,"userTransactions"),Q("userId","==",a.uid),Q("linkedDebtId","==",C.id),Q("status","==","pending")),d=await fe(l);await Promise.allSettled(d.docs.map(x=>It(x.ref,{status:"completed",confirmedAt:new Date})));try{const x=d.docs.map(y=>{var N;return String(((N=y.data())==null?void 0:N.transactionId)||"")});a!=null&&a.uid&&x.forEach(y=>y&&K.removeLocalReceiptById(a.uid,y))}catch{}const p=ve(ne(W,"transactions"),Q("userId","==",a.uid),Q("linkedDebtId","==",C.id),Q("status","==","pending")),m=await fe(p);await Promise.allSettled(m.docs.map(x=>It(x.ref,{status:"completed",confirmedAt:new Date})));try{const x=m.docs.map(y=>{var N;return String(y.id||((N=y.data())==null?void 0:N.transactionId)||"")});a!=null&&a.uid&&x.forEach(y=>y&&K.removeLocalReceiptById(a.uid,y))}catch{}const u=ve(ne(W,"transactions"),Q("merchantUserId","==",a.uid),Q("linkedDebtId","==",C.id),Q("status","==","pending")),g=await fe(u);await Promise.allSettled(g.docs.map(x=>It(x.ref,{status:"completed",confirmedAt:new Date})));try{const x=g.docs.map(y=>{var N;return String(y.id||((N=y.data())==null?void 0:N.transactionId)||"")});a!=null&&a.uid&&x.forEach(y=>y&&K.removeLocalReceiptById(a.uid,y))}catch{}})().catch(l=>{console.error("ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¯ÙŠÙ†:",l),f({title:"ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©",description:"ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¯ÙŠÙ†",variant:"destructive"})})}catch(l){console.error("ØªØ¹Ø°Ø± ØªØ¬Ù‡ÙŠØ² ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©:",l)}try{const l=di(),d=localStorage.getItem(l);if(d){const m=(JSON.parse(d)||[]).map(u=>(u==null?void 0:u.linkedDebtId)===C.id&&(u==null?void 0:u.status)==="pending"?{...u,status:"completed",confirmedAt:new Date}:u);localStorage.setItem(l,JSON.stringify(m)),yt(u=>u.map(g=>(g==null?void 0:g.linkedDebtId)===C.id&&(g==null?void 0:g.status)==="pending"?{...g,status:"completed",confirmedAt:new Date}:g))}}catch(l){console.warn("ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙ†:",l)}Nn(t),sa("none"),Va(!0),Wr(!1),Rr(""),f({title:"ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹ Ø¬Ø²Ø¡",description:`ØªÙ… Ø¯ÙØ¹ ${t} Ø¬Ù†ÙŠÙ‡ Ø¨ØªØ§Ø±ÙŠØ® ${new Date().toLocaleString("ar-EG")}`})},children:"Ø¯ÙØ¹"})]})]}):e.jsx(w,{variant:"outline",className:"w-full",onClick:()=>Wr(!0),children:"Ø¯ÙØ¹ Ø¬Ø²Ø¡"}),C.partialPayments&&C.partialPayments.length>0&&e.jsxs("div",{className:"mt-3 text-[12px] sm:text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium mb-1",children:"Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©:"}),e.jsx("div",{className:"space-y-1 max-h-[30vh] sm:max-h-24 overflow-y-auto",children:C.partialPayments.map((t,s)=>e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsxs("span",{children:["Ø¯ÙØ¹: ",t.amount," Ø¬Ù†ÙŠÙ‡"]}),e.jsx("span",{children:new Date(t.paidAt).toLocaleString("ar-EG")})]},s))})]})]})]})]}),e.jsxs(be,{className:"flex gap-2 justify-center",children:[e.jsx(w,{onClick:async()=>{if(C){const t=he.map(s=>s.id===C.id?{...s,status:"pending"}:s);Ge(t),await Dt(t);try{if(a!=null&&a.uid){const s=computedRemaining;await ba.send(a.uid,`ØªÙ… Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙ† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø¹Ù…ÙŠÙ„ ${C.debtorName}: Ø§Ù„Ù…Ø¯ÙÙˆØ¹ ${s} Ø¬Ù†ÙŠÙ‡`)}}catch{}aa(!1),f({title:"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙŠÙ†",description:"ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¯ÙŠÙ† ÙƒÙ…Ø¤Ø¬Ù„"})}},variant:"outline",className:"bg-yellow-500 hover:bg-yellow-600 text-white",children:"Ù…Ø¤Ø¬Ù„"}),e.jsx(w,{onClick:async()=>{if(C){const t=Number(C.amount||0),s=Number(C.paidAmount||0);let n=Math.max(0,t-s);try{const o=(Y||[]).filter(u=>String((u==null?void 0:u.linkedDebtId)||"")===String(C.id)),l=o.reduce((u,g)=>u+Math.max(0,Number((g==null?void 0:g.commission)||0)),0),d=o.reduce((u,g)=>u+Math.max(0,Number(((g==null?void 0:g.sentAmount)??(g==null?void 0:g.transferredAmount)??(g==null?void 0:g.withdrawnAmount)??(g==null?void 0:g.amount))||0)),0),m=t<d+l?t+l:t;n=Math.max(0,Number(m)-s)}catch{}const r=n,i=he.map(o=>{if(o.id!==C.id)return o;const l=Number(o.amount||0),d=Number(o.paidAmount||0),p=Number((d+r).toFixed(2)),m=p>=l;return{...o,amount:l,paidAmount:m?l:p,status:"paid",partialPayments:[...o.partialPayments||[],...r>0?[{amount:r,paidAt:new Date}]:[]]}});Ge(i);try{ta(i.find(o=>o.id===C.id)||null)}catch{}Nn(r),sa("none"),Va(!0),await Dt(i);try{a!=null&&a.uid&&(C!=null&&C.id)&&(async()=>{const o=ve(ne(W,"userTransactions"),Q("userId","==",a.uid),Q("linkedDebtId","==",C.id),Q("status","==","pending")),l=await fe(o);await Promise.allSettled(l.docs.map(g=>It(g.ref,{status:"completed",confirmedAt:new Date})));try{const g=l.docs.map(x=>{var y;return String(((y=x.data())==null?void 0:y.transactionId)||"")});a!=null&&a.uid&&g.forEach(x=>x&&K.removeLocalReceiptById(a.uid,x))}catch{}const d=ve(ne(W,"transactions"),Q("userId","==",a.uid),Q("linkedDebtId","==",C.id),Q("status","==","pending")),p=await fe(d);await Promise.allSettled(p.docs.map(g=>It(g.ref,{status:"completed",confirmedAt:new Date})));try{const g=p.docs.map(x=>{var y;return String(x.id||((y=x.data())==null?void 0:y.transactionId)||"")});a!=null&&a.uid&&g.forEach(x=>x&&K.removeLocalReceiptById(a.uid,x))}catch{}const m=ve(ne(W,"transactions"),Q("merchantUserId","==",a.uid),Q("linkedDebtId","==",C.id),Q("status","==","pending")),u=await fe(m);await Promise.allSettled(u.docs.map(g=>It(g.ref,{status:"completed",confirmedAt:new Date})));try{const g=u.docs.map(x=>{var y;return String(x.id||((y=x.data())==null?void 0:y.transactionId)||"")});a!=null&&a.uid&&g.forEach(x=>x&&K.removeLocalReceiptById(a.uid,x))}catch{}})().catch(o=>{console.error("ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¯ÙŠÙ†:",o),f({title:"ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©",description:"ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¯ÙŠÙ†",variant:"destructive"})})}catch(o){console.error("ØªØ¹Ø°Ø± ØªØ¬Ù‡ÙŠØ² ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©:",o)}try{const o=di(),l=localStorage.getItem(o);if(l){const p=(JSON.parse(l)||[]).map(m=>(m==null?void 0:m.linkedDebtId)===C.id&&(m==null?void 0:m.status)==="pending"?{...m,status:"completed",confirmedAt:new Date}:m);localStorage.setItem(o,JSON.stringify(p)),yt(m=>m.map(u=>(u==null?void 0:u.linkedDebtId)===C.id&&(u==null?void 0:u.status)==="pending"?{...u,status:"completed",confirmedAt:new Date}:u))}}catch(o){console.warn("ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙ†:",o)}aa(!1),f({title:"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙŠÙ†",description:"ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¯ÙŠÙ† ÙƒÙ…Ø¯ÙÙˆØ¹"})}},className:"bg-green-500 hover:bg-green-600",children:"Ù…Ø¯ÙÙˆØ¹"}),e.jsx(w,{onClick:async()=>{if(C){const t=he.filter(s=>s.id!==C.id);Ge(t),await Dt(t),aa(!1),f({title:"ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙŠÙ†",description:"ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­"})}},variant:"destructive",children:"Ø­Ø°Ù"})]})]})}),e.jsx(oe,{open:Td,onOpenChange:Ts,children:e.jsxs(le,{className:"sm:max-w-md rounded-2xl shadow-elegant border border-gray-200",children:[e.jsxs(ce,{children:[e.jsx(de,{className:`text-right ${pa==="decrease"?"text-red-600":"text-green-600"}`,children:pa==="decrease"?"Ø¥Ù†Ù‚Ø§Øµ Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙŠÙ†":pa==="increase"?"Ø²ÙŠØ§Ø¯Ø© Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙŠÙ†":"ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙŠÙ†"}),e.jsxs(at,{className:"text-right",children:["Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø«Ù… Ø§Ø¶ØºØ· ØªØ£ÙƒÙŠØ¯ Ù„Ø¥ØªÙ…Ø§Ù… ",pa==="decrease"?"Ø§Ù„Ø¥Ù†Ù‚Ø§Øµ":"Ø§Ù„Ø²ÙŠØ§Ø¯Ø©","."]})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsx(q,{htmlFor:"debtAdjustAmount",className:"text-right",children:"Ø§Ù„Ù…Ø¨Ù„Øº (Ø¬Ù†ÙŠÙ‡)"}),e.jsx(U,{id:"debtAdjustAmount",type:"number",placeholder:"0.00",value:Wo,onChange:t=>Lr(t.target.value)}),C&&e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:["Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø­Ø§Ù„ÙŠ: ",e.jsx("span",{className:"font-semibold",children:Number(C.amount||0).toFixed(2)})," Ø¬Ù†ÙŠÙ‡"]})]}),e.jsxs(be,{className:"flex gap-2",children:[e.jsx(w,{variant:"secondary",onClick:()=>{Ts(!1),aa(!0)},children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(w,{className:pa==="decrease"?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700",onClick:async()=>{try{if(!C||!pa)return;const t=Number(parseFloat(Wo||"0").toFixed(2));if(!t||isNaN(t)||t<=0){f({title:"Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©",description:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±",variant:"destructive"});return}_s(null),Ro({debtId:C.id,delta:t,type:pa}),Ts(!1),$a(!0)}catch(t){console.error("ÙØ´Ù„ ØªØ¬Ù‡ÙŠØ² ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙŠÙ†:",t),f({title:"Ø®Ø·Ø£",description:"ØªØ¹Ø°Ù‘Ø± ØªØ¬Ù‡ÙŠØ² ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙŠÙ†",variant:"destructive"})}},children:"ØªØ£ÙƒÙŠØ¯"})]})]})}),e.jsx(oe,{open:Bd,onOpenChange:Va,children:e.jsxs(le,{className:"sm:max-w-[480px]",children:[e.jsxs(ce,{children:[e.jsx(de,{className:"text-right",children:"Ø§Ø®ØªÙŠØ§Ø± Ù…ÙƒØ§Ù† Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯"}),e.jsx(at,{className:"text-right",children:"Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø¥Ù„Ù‰ Ø§Ù„ÙÙ„ÙˆØ³ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø£Ù… Ø¥Ù„Ù‰ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù…Ø­Ø§ÙØ¸ØŸ"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsx(w,{variant:wt==="cash"?"default":"outline",className:wt==="cash"?"bg-blue-600 text-white":"",size:"sm",onClick:()=>sa("cash"),children:"Ø§Ù„ÙÙ„ÙˆØ³ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©"}),e.jsx(w,{variant:wt==="wallet"?"default":"outline",className:wt==="wallet"?"bg-blue-600 text-white":"",size:"sm",onClick:()=>sa("wallet"),children:"Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸"}),e.jsx(w,{variant:wt==="fawry"?"default":"outline",className:wt==="fawry"?"bg-amber-600 text-white":"",size:"sm",onClick:()=>sa("fawry"),children:"ÙÙˆØ±ÙŠ"}),e.jsx(w,{variant:wt==="none"?"default":"outline",className:wt==="none"?"bg-gray-600 text-white":"",size:"sm",onClick:()=>sa("none"),children:"Ø¨Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØ©"})]}),wt==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-right",children:"Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù„Ù„Ø¥Ø¶Ø§ÙØ©"}),e.jsxs("select",{className:"w-full border rounded p-2 text-right",value:na,onChange:t=>Hr(t.target.value),children:[e.jsx("option",{value:"",children:"â€” Ø§Ø®ØªØ± Ù…Ø­ÙØ¸Ø© â€”"}),O&&O.length>0?O.map(t=>e.jsx("option",{value:t.id,children:t.phone||t.name||t.id},t.id)):Object.keys(ee||{}).map(t=>{var s,n,r,i;return e.jsx("option",{value:t,children:((s=O.find(o=>o.id===t))==null?void 0:s.phone)||((n=Ja==null?void 0:Ja.find(o=>o.id===t))==null?void 0:n.phone)||((r=Ja==null?void 0:Ja.find(o=>o.id===t))==null?void 0:r.name)||((i=O.find(o=>o.id===t))==null?void 0:i.name)||t},t)})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:["Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø¶Ø§ÙØªÙ‡: ",e.jsxs("span",{className:"font-bold",children:[Qo," Ø¬Ù†ÙŠÙ‡"]})]})]}),e.jsxs(be,{className:"flex flex-wrap justify-between gap-2",children:[e.jsx(w,{variant:"outline",onClick:()=>{Va(!1),Nn(0),sa(null),Hr("")},children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(w,{onClick:async()=>{var t,s;try{const n=Qo;if(!n||n<=0){Va(!1);return}const r=async(i,o)=>{if(a!=null&&a.uid&&C)try{const d={transactionId:ge(ne(W,"dummy_collection")).id,amount:n,transactionType:"cash_addition",type:"cash_addition",status:"completed",createdAt:new Date,senderName:C.debtorName,receiverName:"Ø§Ù„Ù…Ø­Ù„",description:`Ø³Ø¯Ø§Ø¯ Ø¯ÙŠÙ† Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ ${C.debtorName}`,paymentMethod:i,walletId:o||null,linkedDebtId:C.id,isDebtRepayment:!0};await K.saveUserTransaction(a.uid,d);try{me.invalidateQueries({queryKey:["recentTransactions",a==null?void 0:a.uid]})}catch{}}catch(l){console.error("Failed to create repayment receipt:",l)}};if(wt==="cash"){const i=we+n;Oe(i),localStorage.setItem(je(),i.toString());const o={cashBalance:i,lastUpdated:new Date().toISOString()},l=`userData_${a==null?void 0:a.uid}`;localStorage.setItem(l,JSON.stringify(o)),a!=null&&a.uid?(K.updateUserData(a.uid,o).catch(()=>H(!0)),localStorage.removeItem(l),H(!1)):H(!0),f({title:"ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯",description:`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${n} Ø¬Ù†ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„ÙÙ„ÙˆØ³ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©`}),await r("cash");try{if(C){const d=he.map(p=>p.id===C.id?{...p,status:"paid",paidAmount:Math.max(Number(p.paidAmount||0),Number(p.amount||0))}:p);Ge(d);try{ta(d.find(p=>p.id===C.id)||null)}catch{}try{await Dt(d)}catch{}}}catch{}}else if(wt==="wallet"){if(!na){f({title:"Ø§Ø®ØªØ± Ù…Ø­ÙØ¸Ø© Ø£ÙˆÙ„Ø§Ù‹",description:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø¥Ù„ÙŠÙ‡Ø§",variant:"destructive"});return}const i={...ee,[na]:(ee[na]||0)+n};Me(i);const o=new Date().toISOString(),l={walletBalances:i,lastUpdated:o},d=`userData_${a==null?void 0:a.uid}`;if(localStorage.setItem(d,JSON.stringify(l)),localStorage.setItem(Te(),JSON.stringify(i)),localStorage.setItem(`walletBalances_backup_${o}`,JSON.stringify(i)),a!=null&&a.uid){K.updateUserData(a.uid,l).catch(()=>H(!0));try{localStorage.removeItem(d)}catch{}H(!1)}else H(!0);f({title:"ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯",description:`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${n} Ø¬Ù†ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­ÙØ¸Ø© ${((t=O.find(p=>p.id===na))==null?void 0:t.phone)||((s=O.find(p=>p.id===na))==null?void 0:s.name)||na}`}),await r("wallet",na);try{if(C){const p=he.map(m=>m.id===C.id?{...m,status:"paid",paidAmount:Math.max(Number(m.paidAmount||0),Number(m.amount||0))}:m);Ge(p);try{ta(p.find(m=>m.id===C.id)||null)}catch{}try{await Dt(p)}catch{}}}catch{}}else if(wt==="none"){f({title:"ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø¯Ø§Ø¯",description:`ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${n} Ø¬Ù†ÙŠÙ‡ Ø¨Ø¯ÙˆÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø±ØµØ¯Ø©`});try{if(C){const i=he.map(o=>o.id===C.id?{...o,status:"paid",paidAmount:Math.max(Number(o.paidAmount||0),Number(o.amount||0))}:o);Ge(i);try{ta(i.find(o=>o.id===C.id)||null)}catch{}try{await Dt(i)}catch{}}}catch{}}else if(wt==="fawry")f({title:"ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø³Ø¯Ø§Ø¯ Ø¹Ø¨Ø± ÙÙˆØ±ÙŠ",description:`ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${n} Ø¬Ù†ÙŠÙ‡ ÙƒØ³Ø¯Ø§Ø¯ Ø¹Ø¨Ø± ÙÙˆØ±ÙŠ Ø¨Ø¯ÙˆÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø±ØµØ¯Ø©`}),await r("fawry");else{f({title:"Ø§Ø®ØªØ± Ù…ØµØ¯Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ©",description:"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¨Ù„Øº Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø£Ùˆ Ø§Ù„Ù…Ø­ÙØ¸Ø©",variant:"destructive"});return}try{const i=n>0?n:Number((C==null?void 0:C.amount)||0);a!=null&&a.uid&&C&&await ba.send(a.uid,`ØªÙ… Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙ† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø¹Ù…ÙŠÙ„ ${C.debtorName}: Ø§Ù„Ù…Ø¯ÙÙˆØ¹ ${i} Ø¬Ù†ÙŠÙ‡`)}catch{}}catch(n){console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯:",n),f({title:"Ø­Ø¯Ø« Ø®Ø·Ø£",description:"ØªØ¹Ø°Ø± Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰",variant:"destructive"})}finally{Va(!1),Nn(0),sa(null),Hr("");try{fa(!0)}catch{}}},className:"bg-green-600 hover:bg-green-700",children:"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©"})]})]})}),e.jsx(oe,{open:nd,onOpenChange:ua,children:e.jsxs(le,{hideClose:!0,className:"post-confirm-card sm:max-w-[420px] w-[90vw] rounded-2xl bg-gradient-to-br from-white via-indigo-50 to-blue-50 shadow-2xl border border-indigo-100",children:[e.jsxs(ce,{children:[e.jsx(de,{className:"text-right text-2xl font-bold",children:(Pe==null?void 0:Pe.type)==="transfer"?"Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø§Ø³ØªÙ„Ø§Ù…Ù‡":"Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ ØªØ³Ù„ÙŠÙ…Ù‡"}),e.jsx(at,{className:"text-right text-gray-600",children:(Pe==null?void 0:Pe.type)==="transfer"?"Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø§Ø³ØªÙ„Ø§Ù…Ù‡ Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯.":"Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙˆØ§Ø¬Ø¨ ØªØ³Ù„ÙŠÙ…Ù‡ Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯."})]}),e.jsxs("div",{className:"py-3 flex flex-col items-center gap-1.5",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-blue-700 tracking-wide",children:[Nt((Pe==null?void 0:Pe.amount)||0)," Ø¬Ù†ÙŠÙ‡"]}),e.jsx("div",{className:"text-sm text-gray-500 text-right w-full",children:(Pe==null?void 0:Pe.type)==="transfer"?"Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ Ø´Ø§Ù…Ù„ Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„.":xe?"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© Ù…Ø¶Ø§ÙØ© ÙˆÙ„Ø§ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ….":"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© Ù…Ø®ØµÙˆÙ…Ø© Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³Ù„Ù‘Ù… Ù„Ù„Ø¹Ù…ÙŠÙ„."})]}),e.jsxs(be,{className:"flex justify-end gap-2",children:[(Pe==null?void 0:Pe.type)==="transfer"&&e.jsx(w,{variant:"outline",id:"sendCodeBtn",onClick:vc,disabled:bo,className:"btn-transfer-confirm",children:bo?"Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...":"Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„"}),e.jsx(w,{onClick:()=>{ua(!1),Cr(null)},className:"bg-green-600 hover:bg-green-700 text-white",children:(Pe==null?void 0:Pe.type)==="transfer"?"ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…":"ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…"})]}),(Pe==null?void 0:Pe.type)==="transfer"&&e.jsx("div",{className:"mt-4 border-t pt-4 w-full",children:e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(w,{variant:_a===0?"default":"outline",size:"sm",onClick:()=>tr(0),className:`flex-1 h-10 ${_a===0?"bg-blue-600 hover:bg-blue-700 text-white":"border-blue-200 text-blue-700 hover:bg-blue-50"}`,children:"SIM 1"}),e.jsx(w,{variant:_a===1?"default":"outline",size:"sm",onClick:()=>tr(1),className:`flex-1 h-10 ${_a===1?"bg-blue-600 hover:bg-blue-700 text-white":"border-blue-200 text-blue-700 hover:bg-blue-50"}`,children:"SIM 2"})]})})]})}),e.jsx(lu,{open:id,onClose:()=>Ba(!1),onSubmit:Nc,deviceId:vo||sn||"",recipientMsisdn:String(L==="transfer"?(pt==null?void 0:pt.receiver)||ht||"":((Pl=O.find(t=>t.id===D))==null?void 0:Pl.phone)||"").replace(/\D/g,"")}),e.jsx(ph,{isOpen:Vc,onClose:()=>jr(!1),wallets:O,walletBalances:ee,onSelectWallet:t=>{ms(t);const s=O.find(n=>n.id===t);if(s){Oa(s.phone);try{localStorage.setItem(xa(),t)}catch{}}jr(!1)},selectedWalletId:D||void 0}),e.jsx(xh,{open:Gn,onOpenChange:Zn}),e.jsx(Gu,{open:Gs,onOpenChange:Ht}),No,Le&&e.jsx("div",{className:"fixed inset-0 z-[100] bg-white dark:bg-slate-950 overflow-y-auto",children:e.jsx(cu,{onBack:()=>_e(!1)})})]}))},gp=Object.freeze(Object.defineProperty({__proto__:null,default:wh},Symbol.toStringTag,{value:"Module"}));export{Bu as F,gp as U};
//# sourceMappingURL=UserDashboardPage-Dfq0JLZl.js.map
