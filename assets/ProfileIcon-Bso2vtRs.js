import{$ as Me,r as o,j as e,bd as Oe,aq as Fe,bI as ee,a9 as se,u as ie,m as ce,af as le,ag as de,ah as ue,ai as fe,aJ as Te,y as Y,I as z,B as _,J,K as X,aS as Ve,aH as $e,c2 as Ge,c3 as Ke,c4 as Be,a as He,aN as We,c5 as qe,c6 as Ye,aF as ze,X as Je,aY as Xe}from"./index-F79wE54_.js";import{D as Qe,a as Ze,b as es,c as ss,d as ae,e as Q}from"./dropdown-menu-D3KVhV5i.js";import{L as ts,g as rs}from"./switch-Cph24ldD.js";import{FreeTrialService as ns}from"./freeTrialService-WPlIusyQ.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]],os=Me("cloud-download",as);function is(n,s=[]){let t=[];function l(i,m){const d=o.createContext(m);d.displayName=i+"Context";const w=t.length;t=[...t,m];const u=N=>{var j;const{scope:E,children:O,...P}=N,D=((j=E==null?void 0:E[n])==null?void 0:j[w])||d,U=o.useMemo(()=>P,Object.values(P));return e.jsx(D.Provider,{value:U,children:O})};u.displayName=i+"Provider";function L(N,E){var D;const O=((D=E==null?void 0:E[n])==null?void 0:D[w])||d,P=o.useContext(O);if(P)return P;if(m!==void 0)return m;throw new Error(`\`${N}\` must be used within \`${i}\``)}return[u,L]}const c=()=>{const i=t.map(m=>o.createContext(m));return function(d){const w=(d==null?void 0:d[n])||i;return o.useMemo(()=>({[`__scope${n}`]:{...d,[n]:w}}),[d,w])}};return c.scopeName=n,[l,cs(c,...s)]}function cs(...n){const s=n[0];if(n.length===1)return s;const t=()=>{const l=n.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(i){const m=l.reduce((d,{useScope:w,scopeName:u})=>{const N=w(i)[`__scope${u}`];return{...d,...N}},{});return o.useMemo(()=>({[`__scope${s.scopeName}`]:m}),[m])}};return t.scopeName=s.scopeName,t}var ls=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],te=ls.reduce((n,s)=>{const t=Oe(`Primitive.${s}`),l=o.forwardRef((c,i)=>{const{asChild:m,...d}=c,w=m?t:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(w,{...d,ref:i})});return l.displayName=`Primitive.${s}`,{...n,[s]:l}},{}),me={exports:{}},he={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $=o;function ds(n,s){return n===s&&(n!==0||1/n===1/s)||n!==n&&s!==s}var us=typeof Object.is=="function"?Object.is:ds,fs=$.useState,ms=$.useEffect,hs=$.useLayoutEffect,ws=$.useDebugValue;function ps(n,s){var t=s(),l=fs({inst:{value:t,getSnapshot:s}}),c=l[0].inst,i=l[1];return hs(function(){c.value=t,c.getSnapshot=s,Z(c)&&i({inst:c})},[n,t,s]),ms(function(){return Z(c)&&i({inst:c}),n(function(){Z(c)&&i({inst:c})})},[n]),ws(t),t}function Z(n){var s=n.getSnapshot;n=n.value;try{var t=s();return!us(n,t)}catch{return!0}}function gs(n,s){return s()}var xs=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?gs:ps;he.useSyncExternalStore=$.useSyncExternalStore!==void 0?$.useSyncExternalStore:xs;me.exports=he;var vs=me.exports;function Ss(){return vs.useSyncExternalStore(js,()=>!0,()=>!1)}function js(){return()=>{}}var re="Avatar",[bs]=is(re),[Ns,we]=bs(re),pe=o.forwardRef((n,s)=>{const{__scopeAvatar:t,...l}=n,[c,i]=o.useState("idle");return e.jsx(Ns,{scope:t,imageLoadingStatus:c,onImageLoadingStatusChange:i,children:e.jsx(te.span,{...l,ref:s})})});pe.displayName=re;var ge="AvatarImage",xe=o.forwardRef((n,s)=>{const{__scopeAvatar:t,src:l,onLoadingStatusChange:c=()=>{},...i}=n,m=we(ge,t),d=Ps(l,i),w=Fe(u=>{c(u),m.onImageLoadingStatusChange(u)});return ee(()=>{d!=="idle"&&w(d)},[d,w]),d==="loaded"?e.jsx(te.img,{...i,ref:s,src:l}):null});xe.displayName=ge;var ve="AvatarFallback",Se=o.forwardRef((n,s)=>{const{__scopeAvatar:t,delayMs:l,...c}=n,i=we(ve,t),[m,d]=o.useState(l===void 0);return o.useEffect(()=>{if(l!==void 0){const w=window.setTimeout(()=>d(!0),l);return()=>window.clearTimeout(w)}},[l]),m&&i.imageLoadingStatus!=="loaded"?e.jsx(te.span,{...c,ref:s}):null});Se.displayName=ve;function oe(n,s){return n?s?(n.src!==s&&(n.src=s),n.complete&&n.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Ps(n,{referrerPolicy:s,crossOrigin:t}){const l=Ss(),c=o.useRef(null),i=l?(c.current||(c.current=new window.Image),c.current):null,[m,d]=o.useState(()=>oe(i,n));return ee(()=>{d(oe(i,n))},[i,n]),ee(()=>{const w=N=>()=>{d(N)};if(!i)return;const u=w("loaded"),L=w("error");return i.addEventListener("load",u),i.addEventListener("error",L),s&&(i.referrerPolicy=s),typeof t=="string"&&(i.crossOrigin=t),()=>{i.removeEventListener("load",u),i.removeEventListener("error",L)}},[i,t,s]),m}var je=pe,be=xe,Ne=Se;const Pe=o.forwardRef(({className:n,...s},t)=>e.jsx(je,{ref:t,className:se("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",n),...s}));Pe.displayName=je.displayName;const ye=o.forwardRef(({className:n,...s},t)=>e.jsx(be,{ref:t,className:se("aspect-square h-full w-full",n),...s}));ye.displayName=be.displayName;const Ce=o.forwardRef(({className:n,...s},t)=>e.jsx(Ne,{ref:t,className:se("flex h-full w-full items-center justify-center rounded-full bg-muted",n),...s}));Ce.displayName=Ne.displayName;function ys({open:n,onOpenChange:s}){const{user:t,profile:l}=ie(),{toast:c}=ce(),[i,m]=o.useState(!1),[d,w]=o.useState(!1),[u,L]=o.useState(!1),[N,E]=o.useState(!1),[O,P]=o.useState(!1),[D,U]=o.useState(!1),[j,f]=o.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[p,C]=o.useState({currentPassword:"",newPassword:"",confirmPassword:""}),k=()=>{const h={currentPassword:"",newPassword:"",confirmPassword:""};return j.currentPassword||(h.currentPassword="كلمة المرور الحالية مطلوبة"),j.newPassword?j.newPassword.length<6&&(h.newPassword="كلمة المرور يجب أن تكون 6 أحرف على الأقل"):h.newPassword="كلمة المرور الجديدة مطلوبة",j.confirmPassword?j.newPassword!==j.confirmPassword&&(h.confirmPassword="كلمات المرور غير متطابقة"):h.confirmPassword="تأكيد كلمة المرور مطلوب",C(h),!Object.values(h).some(x=>x!=="")},H=async h=>{if(h.preventDefault(),!(!k()||!t||!t.email)){m(!0);try{const x=Ge.credential(t.email,j.currentPassword);await Ke(t,x),U(!0),P(!0),c({title:"تأكيد الهوية",description:"أدخل الرقم السري الرئيسي لتأكيد تغيير كلمة المرور"})}catch(x){console.error("خطأ في تغيير كلمة المرور:",x);let b="حدث خطأ أثناء تغيير كلمة المرور";if(x.code==="auth/wrong-password"){C(T=>({...T,currentPassword:"كلمة المرور الحالية غير صحيحة"}));return}else if(x.code==="auth/weak-password"){C(T=>({...T,newPassword:"كلمة المرور ضعيفة جداً"}));return}else x.code==="auth/requires-recent-login"&&(b="يجب تسجيل الدخول مرة أخرى لتغيير كلمة المرور");c({title:"خطأ في تغيير كلمة المرور",description:b,variant:"destructive"})}finally{m(!1)}}},A=async()=>{if(t){m(!0);try{await Be(t,j.newPassword),c({title:"تم تغيير كلمة المرور بنجاح",description:"تم تحديث كلمة المرور الخاصة بك بنجاح"}),f({currentPassword:"",newPassword:"",confirmPassword:""}),C({currentPassword:"",newPassword:"",confirmPassword:""}),P(!1),U(!1),s(!1)}catch(h){console.error("خطأ في تحديث كلمة المرور:",h);let x="حدث خطأ أثناء تغيير كلمة المرور";h.code==="auth/requires-recent-login"&&(x="انتهت جلسة المصادقة. يرجى إعادة إدخال كلمة المرور الحالية"),c({title:"خطأ في تغيير كلمة المرور",description:x,variant:"destructive"})}finally{m(!1)}}},v=h=>x=>{f(b=>({...b,[h]:x.target.value})),p[h]&&C(b=>({...b,[h]:""}))},F=()=>{f({currentPassword:"",newPassword:"",confirmPassword:""}),C({currentPassword:"",newPassword:"",confirmPassword:""}),P(!1),U(!1),s(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(le,{open:n,onOpenChange:F,children:e.jsxs(de,{className:"sm:max-w-[425px]",children:[e.jsxs(ue,{children:[e.jsx(fe,{children:"تغيير كلمة المرور"}),e.jsx(Te,{children:"أدخل كلمة المرور الحالية وكلمة المرور الجديدة لتحديث حسابك"})]}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"currentPassword",children:"كلمة المرور الحالية"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{id:"currentPassword",type:d?"text":"password",value:j.currentPassword,onChange:v("currentPassword"),className:p.currentPassword?"border-red-500":"",autoComplete:"off",disabled:i}),e.jsx(_,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>w(!d),disabled:i,children:d?e.jsx(J,{className:"h-4 w-4"}):e.jsx(X,{className:"h-4 w-4"})})]}),p.currentPassword&&e.jsx("p",{className:"text-sm text-red-500",children:p.currentPassword})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"newPassword",children:"كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{id:"newPassword",type:u?"text":"password",value:j.newPassword,onChange:v("newPassword"),className:p.newPassword?"border-red-500":"",autoComplete:"new-password",disabled:i}),e.jsx(_,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>L(!u),disabled:i,children:u?e.jsx(J,{className:"h-4 w-4"}):e.jsx(X,{className:"h-4 w-4"})})]}),p.newPassword&&e.jsx("p",{className:"text-sm text-red-500",children:p.newPassword})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"confirmPassword",children:"تأكيد كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{id:"confirmPassword",type:N?"text":"password",value:j.confirmPassword,onChange:v("confirmPassword"),className:p.confirmPassword?"border-red-500":"",autoComplete:"new-password",disabled:i}),e.jsx(_,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>E(!N),disabled:i,children:N?e.jsx(J,{className:"h-4 w-4"}):e.jsx(X,{className:"h-4 w-4"})})]}),p.confirmPassword&&e.jsx("p",{className:"text-sm text-red-500",children:p.confirmPassword})]}),e.jsxs(Ve,{children:[e.jsx(_,{type:"button",variant:"outline",onClick:F,disabled:i,children:"إلغاء"}),e.jsxs(_,{type:"submit",disabled:i,children:[i&&e.jsx(ts,{className:"mr-2 h-4 w-4 animate-spin"}),"تغيير كلمة المرور"]})]})]})]})}),e.jsx($e,{open:O&&D,onOpenChange:h=>{P(h),h||U(!1)},mode:"verify",title:"التحقق من الرقم السري الرئيسي",description:"لا يمكن تغيير كلمة المرور إلا بعد التحقق من الرقم السري الرئيسي",userId:t==null?void 0:t.uid,userRole:l==null?void 0:l.role,onSuccess:A,onCancel:()=>{P(!1),U(!1)}})]})}const Cs="cashy.google.accessToken",ks="cashy.google.email",Es="cashy.google.expiresAt";function Is(){try{const n=localStorage.getItem(Cs),s=localStorage.getItem(ks),t=localStorage.getItem(Es),l=t?Number(t):null;return{token:n,email:s,expiresAt:l}}catch{return{token:null,email:null,expiresAt:null}}}async function _s(n,s,t){try{const l=await fetch("/user/google-backup-token",{method:"POST",headers:{"Content-Type":"application/json","X-USER-ID":n},body:JSON.stringify({email:s,refresh_token:t})}),c=await l.json().catch(()=>({}));return!!(l.ok&&(c!=null&&c.ok))}catch{return!1}}function Os({className:n}){const{user:s,profile:t,signOut:l,updateUserProfile:c}=ie(),i=He(),[m,d]=o.useState(!1),{isShiftActive:w}=We(),{toast:u}=ce(),[L,N]=o.useState(!1),[E,O]=o.useState(!1),[P,D]=o.useState(!1),[{token:U},j]=o.useState(()=>Is()),f=typeof window<"u"?window.electronAPI:void 0,p=!!f,[C,k]=o.useState(!1),[H,A]=o.useState(!1),[v,F]=o.useState(""),[h,x]=o.useState(""),[b,T]=o.useState(!1),[R,W]=o.useState(0),[q,G]=o.useState(!1),[ke,Ee]=o.useState(""),[I,Ie]=o.useState(""),[As,Ls]=o.useState(!1),[K,_e]=o.useState(0),[Ae,Le]=o.useState(!1);o.useEffect(()=>{(async()=>{if(!(s!=null&&s.uid))return;const a=await ns.checkTrialValidity(s.uid);Le(a.isValid&&!a.isExpired),_e(a.hoursRemaining)})()},[s==null?void 0:s.uid]);const M=(r,a)=>{const g=String(r||"").split(".").map(S=>parseInt(S,10)||0),y=String(a||"").split(".").map(S=>parseInt(S,10)||0);for(let S=0;S<Math.max(g.length,y.length);S++){const V=g[S]||0,B=y[S]||0;if(V>B)return 1;if(V<B)return-1}return 0};o.useEffect(()=>{if(!(!p||!f))try{f.onUpdateAvailable(r=>{var g,y,S;const a=String(((g=r==null?void 0:r.info)==null?void 0:g.version)||"");F(a),x(String(((y=r==null?void 0:r.info)==null?void 0:y.notes)||"")),T(!!((S=r==null?void 0:r.info)!=null&&S.force)),M(a,I)>0?k(!0):k(!1)}),f.onUpdateDownloaded(r=>{var g,y;const a=String(((g=r==null?void 0:r.info)==null?void 0:g.version)||"");F(a),x(String(((y=r==null?void 0:r.info)==null?void 0:y.notes)||"")),G(!1),W(100),M(a,I)>0?k(!0):k(!1);try{p&&(s!=null&&s.uid)&&a&&(c==null||c({lastAckDesktopVersion:a}))}catch{}}),f.onUpdateError(r=>{try{u({title:"فشل التحديث",description:String((r==null?void 0:r.message)||(r==null?void 0:r.code)||"تعذر التحميل"),variant:"destructive"})}catch{}}),typeof f.onUpdateProgress=="function"&&f.onUpdateProgress(r=>{const a=(r==null?void 0:r.percent)==null?0:Number(r.percent);G(!0),W(Math.max(0,Math.min(100,isNaN(a)?0:a)))}),typeof f.appVersion=="function"&&f.appVersion().then(r=>{typeof r=="string"&&Ie(r);try{p&&(s!=null&&s.uid)&&typeof r=="string"&&r&&(c==null||c({desktopInstalledVersion:r}))}catch{}}).catch(()=>{})}catch{}},[p,f]),o.useEffect(()=>{p&&R>=100&&A(!0)},[p,R]),o.useEffect(()=>{const r=qe(a=>{const g=String((a==null?void 0:a.version)||""),S=`desktop_update_seen_${String((s==null?void 0:s.uid)||"anon")}`;let V="";try{V=localStorage.getItem(S)||""}catch{}if(g&&g!==v){M(g,I)>0?(k(!0),V===g&&!(a!=null&&a.force)?A(!1):A(!0)):k(!1),F(g),x(String((a==null?void 0:a.notes)||"")),T((a==null?void 0:a.force)||!1);const B=Ye({downloadURL_64:a==null?void 0:a.downloadURL_64,downloadURL_32:a==null?void 0:a.downloadURL_32})||"";Ee(B)}});return()=>{try{r()}catch{}}},[v,I,s==null?void 0:s.uid]);const Ue=async()=>{var r;try{if(f){try{await f.checkUpdate()}catch{}A(!0),G(!0),W(0);const a=await((r=f.downloadUpdate)==null?void 0:r.call(f,ke))??await f.downloadUpdate();if(typeof a=="string"&&a.startsWith("err:")){try{u({title:"فشل التحديث",description:a.slice(4),variant:"destructive"})}catch{}G(!1)}else if(a==="noop")try{u({title:"لا يوجد تحديث",description:"لا تتوفر نسخة أحدث حالياً."})}catch{}else if(a==="manual")try{u({title:"جارٍ تنزيل التحديث",description:"سيتم تطبيق التحديث تلقائيًا بعد اكتمال التنزيل."})}catch{}else if(a==="autoUpdater")try{u({title:"تنزيل تلقائي",description:"سيتم تطبيق التحديث تلقائياً بواسطة النظام."})}catch{}}}catch(a){try{u({title:"فشل التحديث",description:(a==null?void 0:a.message)||"حدث خطأ أثناء التنزيل",variant:"destructive"})}catch{}}},De=()=>t!=null&&t.fullName?t==null?void 0:t.fullName.split(" ").map(r=>r.charAt(0)).join("").toUpperCase().slice(0,2):s.email?s.email.charAt(0).toUpperCase():"U",ne=t!=null&&t.avatarId?rs(t.avatarId):null;if(o.useEffect(()=>{console.log("Profile updated in ProfileIcon:",t==null?void 0:t.avatarId)},[t==null?void 0:t.avatarId]),o.useEffect(()=>{const r=async a=>{try{if(!(a!=null&&a.data)||typeof a.data!="object"||a.origin!=="https://cashy.link")return;const{type:g,email:y,refresh_token:S}=a.data||{};g==="cashy_oauth_token"&&(s!=null&&s.uid)&&y&&S&&await _s(s.uid,String(y),String(S))&&u({title:"تم ربط جوجل",description:"تم حفظ توكن النسخ الاحتياطي عبر الخادم."})}catch{}};return window.addEventListener("message",r),()=>window.removeEventListener("message",r)},[s==null?void 0:s.uid]),!s)return null;const Re=async()=>{try{await l()}catch(r){console.error("خطأ في تسجيل الخروج:",r)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p&&e.jsxs(_,{type:"button",onClick:()=>{A(!0),M(v,I)>0&&k(!0)},title:"تحديث التطبيق",className:"relative inline-flex items-center justify-center w-9 h-9 rounded-md bg-transparent text-blue-600 hover:bg-blue-500/10 focus:outline-none dark:text-blue-400 dark:hover:bg-blue-400/10",variant:"ghost",children:[e.jsx(os,{className:"w-5 h-5"}),C&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 inline-block w-2 h-2 rounded-full bg-red-500"})]}),e.jsxs(Qe,{children:[e.jsx(Ze,{asChild:!0,children:e.jsx(_,{variant:"ghost",className:`relative h-8 w-8 rounded-full p-0 hover:bg-transparent focus:ring-1 focus:ring-primary focus:ring-offset-1 transition-all duration-200 ${n}`,children:e.jsx(Pe,{className:"h-8 w-8 border border-border shadow-sm hover:shadow-md transition-all duration-200 hover:scale-105 bg-white",children:ne?e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-white dark:bg-neutral-900/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"w-full h-full flex items-center justify-center scale-[2.5]",children:ne.component})}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{src:s.photoURL||void 0,alt:(t==null?void 0:t.fullName)||s.email||"المستخدم",className:"object-cover"}),e.jsx(Ce,{className:"bg-gradient-to-br from-indigo-500 via-sky-500 to-emerald-400 text-white font-semibold text-sm tracking-wide uppercase border border-white/70 shadow-md",children:De()})]})})})}),e.jsxs(es,{className:"w-64",align:"end",forceMount:!0,children:[e.jsx(ss,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:(t==null?void 0:t.fullName)||"المستخدم"}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:s.email}),(t==null?void 0:t.role)&&e.jsxs("p",{className:"text-xs leading-none text-muted-foreground",children:["الدور: ",t.role==="staff"?"مدير":t.role==="merchant"?"تاجر":"مستخدم"]}),Ae&&e.jsx("div",{className:"mt-2 flex items-center justify-center gap-1 bg-emerald-50 border border-emerald-200 text-emerald-800 text-xs rounded-md py-1",children:e.jsxs("span",{className:"font-semibold",children:["تجربة: ",K," ",K>=3&&K<=10?"ساعات":K===2?"ساعتين":"ساعة"]})})]})}),e.jsx(ae,{}),e.jsxs(Q,{onClick:()=>{var r;if(w&&((r=shiftUser==null?void 0:shiftUser.permissions)==null?void 0:r.settings)===!1){u({title:"تم رفض الوصول",description:"ليس لديك صلاحية للوصول إلى هذا القسم. يرجى مراجعة المسؤول.",variant:"destructive"});return}i("/profile-settings")},className:"cursor-pointer",children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"إعدادات البروفيل"})]}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="staff")&&e.jsxs(Q,{onClick:()=>i("/admin"),className:"cursor-pointer",children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"لوحة الإدارة"})]}),e.jsx(ae,{}),e.jsxs(Q,{onClick:Re,className:"cursor-pointer text-red-600 focus:text-red-600",children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"تسجيل الخروج"})]})]})]})]}),p&&e.jsx(le,{open:H,onOpenChange:r=>{if(!(!r&&b&&C&&M(v,I)>0)&&(A(r),!r&&R<100)){const g=`desktop_update_seen_${String((s==null?void 0:s.uid)||"anon")}`;try{v&&localStorage.setItem(g,v)}catch{}k(!1)}},children:e.jsxs(de,{className:"sm:max-w-md",hideClose:b,disableOutsideClose:b,disableEscClose:b,children:[e.jsx(ue,{children:e.jsx(fe,{children:b?"تحديث إجباري مطلوب":"يوجد تحديث جديد للبرنامج"})}),e.jsx("div",{className:"text-sm",children:q?"جارٍ تنزيل التحديث...":C&&M(v,I)>0?"هل ترغب في تنزيله الآن؟":"التطبيق مُحدَّث لآخر إصدار"}),v&&e.jsxs("div",{className:"mt-2 text-xs",children:["الإصدار الجديد: ",e.jsxs("span",{className:"font-semibold",children:["v",v]})]}),I&&e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["إصدار التطبيق لديك: ",e.jsxs("span",{className:"font-semibold",children:["v",I]})]}),h&&e.jsx("div",{className:"mt-2 text-xs text-muted-foreground whitespace-pre-line",children:h}),q&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded",children:e.jsx("div",{className:"h-2 bg-blue-600 rounded",style:{width:`${R}%`}})}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[Math.round(R),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3",children:[!b&&e.jsx(_,{variant:"outline",onClick:()=>{const a=`desktop_update_seen_${String((s==null?void 0:s.uid)||"anon")}`;try{v&&localStorage.setItem(a,v)}catch{}k(!1),A(!1)},children:"إلغاء"}),!q&&R<100&&C&&M(v,I)>0&&e.jsx(_,{className:"bg-blue-600 hover:bg-blue-700",onClick:Ue,children:b?"تحديث الآن (إجباري)":"بدء التنزيل"}),R>=100&&e.jsx(_,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{try{if(f!=null&&f.applyUpdate){u({title:"جاري التحديث",description:"سيتم إغلاق التطبيق وتثبيت التحديث فوراً..."});const r=await f.applyUpdate();typeof r=="string"&&r.startsWith("err:")&&u({title:"فشل التحديث",description:r.slice(4),variant:"destructive"})}else if(f!=null&&f.openUpdateFolder){const r=await f.openUpdateFolder();typeof r=="string"&&r.startsWith("err:")?u({title:"تعذر فتح مجلد التحديث",description:r.slice(4),variant:"destructive"}):u({title:"افتح ملف التثبيت",description:"تم فتح مجلد التحديث — اضغط على الملف لتثبيت."})}}catch(r){u({title:"فشل التحديث",description:(r==null?void 0:r.message)||"حدث خطأ غير متوقع",variant:"destructive"})}},children:"تحديث الآن"})]})]})}),e.jsx(ys,{open:m,onOpenChange:d})]})}export{Os as P};
//# sourceMappingURL=ProfileIcon-Bso2vtRs.js.map
