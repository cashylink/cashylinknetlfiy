{"version":3,"file":"EditBalanceDialog-BEXZtmH-.js","sources":["../../src/components/EditBalanceDialog.tsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Lock, Eye, EyeOff, AlertCircle, DollarSign } from 'lucide-react';\r\nimport { MasterPinService } from '@/utils/masterPinService';\r\n\r\ninterface EditBalanceDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  onSuccess: (newAmount: number) => void;\r\n  title: string;\r\n  description: string;\r\n  currentBalance: number;\r\n  balanceLabel: string;\r\n  userId?: string;\r\n}\r\n\r\nexport function EditBalanceDialog({ \r\n  open, \r\n  onOpenChange, \r\n  onSuccess, \r\n  title, \r\n  description,\r\n  currentBalance,\r\n  balanceLabel,\r\n  userId\r\n}: EditBalanceDialogProps) {\r\n  const [pin, setPin] = useState('');\r\n  const [newAmount, setNewAmount] = useState(currentBalance.toString());\r\n  const [showPin, setShowPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  // سيتم التحقق من وجود الرقم السري بشكل غير متزامن داخل الإرسال\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      // التحقق من صحة المبلغ\r\n      const amount = parseFloat(newAmount);\r\n      if (isNaN(amount) || amount < 0) {\r\n        setError('يرجى إدخال مبلغ صحيح');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      const hasSecretPin = await MasterPinService.hasMasterPin(userId);\r\n      if (hasSecretPin) {\r\n        // التحقق من الرقم السري الموجود\r\n        const isValid = await MasterPinService.verifyMasterPin(pin, userId);\r\n        if (isValid) {\r\n          onSuccess(amount);\r\n          onOpenChange(false);\r\n          setPin('');\r\n          setNewAmount('');\r\n        } else {\r\n          setError('الرقم السري غير صحيح');\r\n        }\r\n      } else {\r\n        setError('لم يتم تعيين رقم سري رئيسي. يرجى تعيين رقم سري رئيسي أولاً من إعدادات التطبيق');\r\n      }\r\n    } catch (error) {\r\n      setError('حدث خطأ أثناء التحقق من الرقم السري');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setPin('');\r\n    setNewAmount(currentBalance.toString());\r\n    setError('');\r\n    onOpenChange(false);\r\n  };\r\n\r\n  // تحديث المبلغ عند تغيير الرصيد الحالي\r\n  React.useEffect(() => {\r\n    if (open) {\r\n      setNewAmount(currentBalance.toString());\r\n    }\r\n  }, [currentBalance, open]);\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            <DollarSign className=\"h-5 w-5\" />\r\n            {title}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-muted-foreground text-right\">\r\n            {description}\r\n          </div>\r\n\r\n          {/* عرض الرصيد الحالي */}\r\n          <div className=\"bg-gray-50 p-3 rounded-lg\">\r\n            <Label className=\"text-sm font-medium text-gray-700\">\r\n              {balanceLabel} الحالي\r\n            </Label>\r\n            <div className=\"text-lg font-bold text-gray-900 mt-1\">\r\n              {currentBalance.toLocaleString()} جنيه\r\n            </div>\r\n          </div>\r\n\r\n          {/* إدخال المبلغ الجديد */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"newAmount\" className=\"text-right\">\r\n              المبلغ الجديد\r\n            </Label>\r\n            <Input\r\n              id=\"newAmount\"\r\n              type=\"number\"\r\n              step=\"0.01\"\r\n              min=\"0\"\r\n              value={newAmount}\r\n              onChange={(e) => setNewAmount(e.target.value)}\r\n              placeholder=\"أدخل المبلغ الجديد\"\r\n              className=\"text-right\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          {/* إدخال الرقم السري */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"pin\" className=\"text-right\">\r\n              الرقم السري\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"pin\"\r\n                type={showPin ? 'text' : 'password'}\r\n                value={pin}\r\n                onChange={(e) => setPin(e.target.value)}\r\n                placeholder=\"أدخل الرقم السري\"\r\n                className=\"text-right pr-10\"\r\n                required\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowPin(!showPin)}\r\n              >\r\n                {showPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-sm text-red-600 bg-red-50 p-2 rounded\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              className=\"flex-1\"\r\n            >\r\n              إلغاء\r\n            </Button>\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading || !pin || !newAmount}\r\n              className=\"flex-1\"\r\n            >\r\n              {isLoading ? (\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n                  جاري التحديث...\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <Lock className=\"h-4 w-4 mr-2\" />\r\n                  تحديث الرصيد\r\n                </>\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}"],"names":["EditBalanceDialog","open","onOpenChange","onSuccess","title","description","currentBalance","balanceLabel","userId","pin","setPin","useState","newAmount","setNewAmount","showPin","setShowPin","error","setError","isLoading","setIsLoading","handleSubmit","e","amount","MasterPinService","handleClose","React","jsx","Dialog","DialogContent","DialogHeader","jsxs","DialogTitle","DollarSign","Label","Input","Button","EyeOff","Eye","AlertCircle","Fragment","Lock"],"mappings":"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"}