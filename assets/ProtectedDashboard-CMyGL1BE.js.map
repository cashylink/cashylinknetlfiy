{"version":3,"file":"ProtectedDashboard-CMyGL1BE.js","sources":["../../src/components/AutoTransactionDialog.tsx","../../src/pages/DashboardPage.tsx","../../src/components/ProtectedDashboard.tsx"],"sourcesContent":["import React from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { CheckCircle2, ArrowDownLeft, ArrowUpRight, Wallet } from 'lucide-react';\nimport { Transaction } from '@/types/Transaction'; // Adjust import path if needed\n\ninterface AutoTransactionDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  transaction: any; // Using any for flexibility with Transaction type\n  walletName?: string;\n}\n\nexport function AutoTransactionDialog({ \n  open, \n  onOpenChange, \n  transaction,\n  walletName \n}: AutoTransactionDialogProps) {\n  if (!transaction) return null;\n\n  const isReceive = transaction.type === 'receive' || transaction.type === 'withdraw'; // withdraw in system usually means receive from perspective of wallet? Wait, 'withdraw' in Dashboard is usually adding to system/withdraw from wallet. \n  // Let's check dashboard logic: withdraw = red icon (ArrowDownLeft), send = green icon (ArrowUpRight).\n  // But for \"Receive Money\" (SMS receive), it increases balance.\n  // In DashboardPage: \n  // transaction.type === 'withdraw' ? 'bg-red-50' (ArrowDownLeft)\n  // transaction.type === 'send' ? 'bg-green-50' (ArrowUpRight)\n  // User says: \"receive transaction... received amount X\".\n  // In SmsReceiver: txnType=\"receive\" -> increases totalWithdrawn? Wait.\n  // SmsReceiver: if (txnType.equals(\"send\")) { statsUpdates.put(\"totalSent\"...) } else { statsUpdates.put(\"totalWithdrawn\"...) }\n  // This naming is confusing. \"Withdraw\" usually means taking money OUT of the wallet? Or OUT of the system?\n  // In `DashboardPage`: 'withdraw' -> '+' (Add to system/cash), 'send' -> '-' (Remove from system/cash).\n  // So 'receive' SMS (money comes into wallet) -> likely maps to 'withdraw' (add to system/cash balance if we track wallet balance as system cash? No).\n  // Let's stick to the visual cues:\n  // If we RECEIVED money (SMS), it should be Positive.\n  // In DashboardPage: `transaction.type === 'send' ? '-' : '+'`.\n  // So 'withdraw' means Positive (Receive).\n  \n  const isIncoming = transaction.type === 'withdraw' || transaction.type === 'receive';\n  const amount = Math.abs(transaction.amount || 0);\n  \n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-md border-0 shadow-2xl overflow-hidden p-0 gap-0\">\n        {/* Header Background */}\n        <div className={`h-32 w-full flex flex-col items-center justify-center ${\n          isIncoming ? 'bg-emerald-600' : 'bg-blue-600'\n        }`}>\n          <div className=\"bg-white/20 p-3 rounded-full mb-2 backdrop-blur-sm\">\n            <CheckCircle2 className=\"w-10 h-10 text-white\" />\n          </div>\n          <h2 className=\"text-white text-xl font-bold\">\n            {isIncoming ? 'تم استلام مبلغ بنجاح' : 'تم التحويل بنجاح'}\n          </h2>\n        </div>\n\n        <div className=\"p-6 space-y-6\">\n          {/* Amount */}\n          <div className=\"text-center\">\n            <p className=\"text-sm text-gray-500 font-medium mb-1\">المبلغ</p>\n            <div className={`text-4xl font-bold ${isIncoming ? 'text-emerald-600' : 'text-blue-600'}`}>\n              {amount.toLocaleString()} <span className=\"text-xl text-gray-400 font-normal\">ج.م</span>\n            </div>\n          </div>\n\n          {/* Details Card */}\n          <div className=\"bg-gray-50 rounded-xl p-4 space-y-3 border border-gray-100\">\n            {/* Sender/Receiver */}\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-sm text-gray-500\">\n                {isIncoming ? 'من' : 'إلى'}\n              </span>\n              <span className=\"font-semibold text-gray-900\" dir=\"ltr\">\n                {isIncoming ? (transaction.senderName || transaction.senderPhone || transaction.senderMsisdn) : (transaction.receiverName || transaction.receiverPhone || transaction.receiverMsisdn)}\n              </span>\n            </div>\n\n            <div className=\"h-px bg-gray-200 w-full\" />\n\n            {/* Wallet */}\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-sm text-gray-500 flex items-center gap-1\">\n                <Wallet className=\"w-3 h-3\" />\n                المحفظة\n              </span>\n              <span className=\"font-semibold text-gray-900\">\n                {walletName || transaction.shopName || 'غير محدد'}\n              </span>\n            </div>\n\n            <div className=\"h-px bg-gray-200 w-full\" />\n\n            {/* Reference */}\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-sm text-gray-500\">رقم العملية</span>\n              <span className=\"font-mono text-xs text-gray-600 bg-gray-200 px-2 py-1 rounded\">\n                {transaction.reference || transaction.id}\n              </span>\n            </div>\n          </div>\n\n          <Button \n            onClick={() => onOpenChange(false)} \n            className={`w-full py-6 text-lg shadow-lg hover:shadow-xl transition-all ${\n              isIncoming ? 'bg-emerald-600 hover:bg-emerald-700' : 'bg-blue-600 hover:bg-blue-700'\n            }`}\n          >\n            تم\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","import React, { useState, useEffect } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { ArrowUpDown, Plus, CheckCircle, Clock, XCircle, Phone, DollarSign, Wallet, ArrowDownLeft, Trash2, Edit, LogOut, Settings, Eye } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\nimport WalletManagement from '@/components/WalletManagement';\nimport TransactionDetailsModal from '@/components/TransactionDetailsModal';\nimport { SecretPinDialog } from '@/components/SecretPinDialog';\nimport { EditBalanceDialog } from '@/components/EditBalanceDialog';\nimport { ChangePinDialog } from '@/components/ChangePinDialog';\nimport { AddToWalletDialog } from '@/components/AddToWalletDialog';\nimport { transactionService, profileService, merchantWalletService } from '@/integrations/firebase/services';\nimport { AutoTransactionDialog } from '@/components/AutoTransactionDialog';\nimport { doc, updateDoc, getDoc, setDoc, getDocFromCache, collection, query, where, orderBy, limit, onSnapshot } from 'firebase/firestore';\nimport { db } from '@/firebase';\nimport { useShift } from '@/contexts/ShiftContext';\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { Capacitor } from '@capacitor/core';\nimport { calculateCommission } from '@/utils/commissionCalculator';\nimport { ProfitService } from '@/utils/profitService';\n\ninterface Transaction {\n  id: string;\n  type: 'send' | 'receive' | 'withdraw';\n  senderPhone: string;\n  receiverPhone: string;\n  amount: number;\n  status: 'pending' | 'completed' | 'failed';\n  createdAt: Date;\n  withdrawnAmount?: number;\n  sentAmount?: number;\n  merchantShopName?: string;\n  shopName?: string;\n  commission?: number;\n  fee?: number;\n  fromWallet?: string;\n  provider?: string;\n  senderName?: string;\n  cashierName?: string;\n}\n\ninterface DailyStats {\n  date: string;\n  totalTransactions: number;\n  totalAmount: number;\n  totalWithdrawn: number;\n  totalSent: number;\n}\n\ninterface MonthlyStats {\n  month: string;\n  totalTransactions: number;\n  totalAmount: number;\n  totalWithdrawn: number;\n  totalSent: number;\n}\n\nconst DashboardPage = () => {\n  const location = useLocation();\n  const { toast } = useToast();\n  const { signOut, user, profile } = useFirebaseAuth();\n  const { isShiftActive, shiftUser } = useShift();\n  const isMobile = useIsMobile();\n  const platform = (typeof Capacitor !== 'undefined' && typeof Capacitor.getPlatform === 'function') ? Capacitor.getPlatform() : 'web';\n  const isAndroid = platform === 'android' || /Android/i.test(typeof navigator !== 'undefined' ? navigator.userAgent : '');\n  // تفعيل تخطيط الموبايل/الأندرويد: عرض آخر 3 فقط والباقي في قسم قابل للتمرير\n  const showAndroidMobileLayout = isAndroid || isMobile;\n  const [senderPhone, setSenderPhone] = useState('01030302038');\n  const [senderName, setSenderName] = useState('');\n  const [receiverPhone, setReceiverPhone] = useState('');\n  const [amount, setAmount] = useState('');\n  const [transactionType, setTransactionType] = useState<'transfer' | 'withdraw'>('transfer');\n  const [senderProvider, setSenderProvider] = useState<'vodafone_cash' | 'etisalat_cash' | 'orange_cash' | 'instapay'>('vodafone_cash');\n  const [receiverProvider, setReceiverProvider] = useState<'vodafone_cash' | 'etisalat_cash' | 'orange_cash' | 'instapay'>('vodafone_cash');\n  const [transferFee, setTransferFee] = useState('');\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\n  const [activeTab, setActiveTab] = useState('all');\n  const [isWalletManagementOpen, setIsWalletManagementOpen] = useState(false);\n  const [selectedWallet, setSelectedWallet] = useState<string>('');\n  const [wallets, setWallets] = useState<Array<{id: string, name: string, phone: string, isDefault: boolean}>>([]);\n  const [selectedTransaction, setSelectedTransaction] = useState<Transaction | null>(null);\n  const [isTransactionDetailsOpen, setIsTransactionDetailsOpen] = useState(false);\n  const [dailyStats, setDailyStats] = useState<DailyStats[]>([]);\n  const [monthlyStats, setMonthlyStats] = useState<MonthlyStats[]>([]);\n  const [isResetDialogOpen, setIsResetDialogOpen] = useState(false);\n  const [resetType, setResetType] = useState<'daily' | 'monthly'>('daily');\n  const [deletedTransactions, setDeletedTransactions] = useState<Transaction[]>([]);\n  const MONTHLY_WITHDRAWAL_LIMIT = 200000;\n  const MONTHLY_TRANSFER_LIMIT = 200000;\n  const [cashBalance, setCashBalance] = useState(0);\n  const [walletBalances, setWalletBalances] = useState<{[key: string]: number}>({});\n  const [isEditCashDialogOpen, setIsEditCashDialogOpen] = useState(false);\n  const [isReceiverPhoneInputEnabled, setIsReceiverPhoneInputEnabled] = useState<boolean>(true);\n\n  useEffect(() => {\n    try {\n      const key = user?.uid ? `receiverPhoneInputEnabled_${user.uid}` : 'receiverPhoneInputEnabled';\n      const v = localStorage.getItem(key) ?? localStorage.getItem('receiverPhoneInputEnabled');\n      setIsReceiverPhoneInputEnabled(v === null ? true : v === 'true');\n    } catch {\n      setIsReceiverPhoneInputEnabled(true);\n    }\n  }, [user?.uid]);\n  const [isEditWalletDialogOpen, setIsEditWalletDialogOpen] = useState(false);\n  const [isAddToWalletDialogOpen, setIsAddToWalletDialogOpen] = useState(false);\n  const [isAddToWalletTotalDialogOpen, setIsAddToWalletTotalDialogOpen] = useState(false);\n  const [isEditWalletTotalDialogOpen, setIsEditWalletTotalDialogOpen] = useState(false);\n  const [editingWalletId, setEditingWalletId] = useState<string>('');\n  const [isChangePinDialogOpen, setIsChangePinDialogOpen] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [isDailyLocked, setIsDailyLocked] = useState<boolean>(() => {\n    try {\n      const key = user?.uid ? `dailyReportsLockEnabled_${user?.uid}` : 'dailyReportsLockEnabled';\n      const v = localStorage.getItem(key) ?? localStorage.getItem('dailyReportsLockEnabled');\n      return v === 'true';\n    } catch {\n      return false;\n    }\n  });\n  const [isDailyPinDialogOpen, setIsDailyPinDialogOpen] = useState<boolean>(false);\n  const [isTransactionPinned, setIsTransactionPinned] = useState(false);\n  const [autoTransaction, setAutoTransaction] = useState<Transaction | null>(null);\n  const lastTxIdRef = React.useRef<string>('');\n\n  // Load Wallets for Name Resolution\n  useEffect(() => {\n    if (!user?.uid) return;\n    const fetchWallets = async () => {\n      try {\n        const ws = await merchantWalletService.getByMerchantId(user.uid);\n        if (ws) {\n          const normalized = ws.map((w: any) => ({\n            id: w.id,\n            name: w.label || w.alias || 'محفظة',\n            phone: w.msisdn || '',\n            isDefault: false\n          }));\n          setWallets(normalized);\n        }\n      } catch (e) { console.error('Failed to load wallets', e); }\n    };\n    fetchWallets();\n  }, [user?.uid]);\n\n  // Real-time listener for Desktop Notifications & Auto-Updates\n  useEffect(() => {\n    if (!user || isMobile || isAndroid) return;\n    \n    let unsub = () => {};\n    \n    const setupListener = async () => {\n      const p = await profileService.getById(user.uid);\n      if (p?.shopId) {\n        const dataRef = doc(db, 'dashboardData', p.shopId);\n        unsub = onSnapshot(dataRef, (snap) => {\n          if (snap.exists()) {\n            const data = snap.data();\n            const txs = (data.transactions || []) as Transaction[];\n            \n            // Check for new Auto Transaction\n            if (txs.length > 0) {\n              const latest = txs[0];\n              // Initialize ref if empty\n              if (!lastTxIdRef.current) {\n                lastTxIdRef.current = latest.id;\n              } else if (lastTxIdRef.current !== latest.id) {\n                // New transaction detected\n                // Check if it's likely an Auto/SMS transaction\n                // (has provider set, or comes from background sync)\n                const isAuto = (latest as any).provider || \n                               (latest as any).originType === 'transfer' || \n                               (latest as any).originType === 'withdraw' ||\n                               (latest as any).originType === 'sms' ||\n                               (latest as any).originType === 'auto' ||\n                               latest.reference?.startsWith('VF-');\n                \n                if (isAuto) {\n                  setAutoTransaction(latest);\n                }\n                lastTxIdRef.current = latest.id;\n              }\n            }\n            \n            // Update Dashboard Data Real-time (restore functionality)\n            setTransactions(txs);\n            \n            // Fix Balance Flicker: Only update if valid numbers, fallback to existing or localStorage\n            // This prevents momentary 0 balance when Firestore returns partial/empty snapshots during sync\n            const newCash = data.cashBalance;\n            if (typeof newCash === 'number') {\n               setCashBalance(newCash);\n               try { localStorage.setItem('lastKnownCashBalance', String(newCash)); } catch {}\n            }\n            \n            const newWallets = data.walletBalances;\n            if (newWallets && Object.keys(newWallets).length > 0) {\n               setWalletBalances(newWallets);\n               try { localStorage.setItem('lastKnownWalletBalances', JSON.stringify(newWallets)); } catch {}\n            }\n            \n            setDeletedTransactions(data.deletedTransactions || []);\n          }\n        });\n      }\n    };\n    \n    setupListener();\n    return () => unsub();\n  }, [user, isMobile, isAndroid]);\n\n  // Initial Local Storage Load to prevent 0 flicker on mount\n  useEffect(() => {\n     try {\n       const cachedCash = localStorage.getItem('lastKnownCashBalance');\n       if (cachedCash && !isNaN(Number(cachedCash))) {\n          setCashBalance(Number(cachedCash));\n       }\n       const cachedWallets = localStorage.getItem('lastKnownWalletBalances');\n       if (cachedWallets) {\n          setWalletBalances(JSON.parse(cachedWallets));\n       }\n     } catch {}\n  }, []);\n\n  // كشف الشركة تلقائيًا من مقدمة الرقم\n  // Helper: normalize Arabic/Persian digits to ASCII\n  const normalizeDigits = (s: string) => {\n    const arabicIndic = '٠١٢٣٤٥٦٧٨٩';\n    const easternIndic = '۰۱۲۳۴۵۶۷۸۹';\n    return (s || '').split('').map(ch => {\n      const ai = arabicIndic.indexOf(ch);\n      if (ai > -1) return String(ai);\n      const ei = easternIndic.indexOf(ch);\n      if (ei > -1) return String(ei);\n      return ch;\n    }).join('');\n  };\n\n  const detectProvider = (phone: string): 'vodafone_cash' | 'etisalat_cash' | 'orange_cash' | 'instapay' | null => {\n    const digits = normalizeDigits(phone).replace(/\\D/g, '');\n    if (digits.startsWith('010')) return 'vodafone_cash';\n    if (digits.startsWith('011')) return 'etisalat_cash';\n    if (digits.startsWith('012')) return 'orange_cash';\n    // مبدئيًا لا ندعم 015 (WE) هنا؛ تظل القيمة كما هي أو يُستخدم الاختيار اليدوي\n    return null;\n  };\n\n  useEffect(() => {\n    const p = detectProvider(senderPhone);\n    if (p && p !== senderProvider) setSenderProvider(p);\n  }, [senderPhone]);\n\n  useEffect(() => {\n    const p = detectProvider(receiverPhone);\n    if (p && p !== receiverProvider) setReceiverProvider(p);\n  }, [receiverPhone]);\n\n  useEffect(() => {\n    try {\n      const key = user?.uid ? `dailyReportsLockEnabled_${user?.uid}` : 'dailyReportsLockEnabled';\n      const v = localStorage.getItem(key) ?? localStorage.getItem('dailyReportsLockEnabled');\n      setIsDailyLocked(v === 'true');\n    } catch {}\n  }, [user?.uid]);\n\n  // تفعيل نموذج المعاملة ووضع التثبيت عند القدوم من أزرار أسفل الموبايل\n  useEffect(() => {\n    const state: any = location.state || {};\n    if (state?.openTransactionSection) {\n      if (state?.transactionType === 'withdraw' || state?.transactionType === 'transfer') {\n        setTransactionType(state.transactionType);\n      }\n      setIsTransactionPinned(true);\n      if (state?.startNewTransaction) {\n        setSenderPhone('01030302038');\n        setReceiverPhone('');\n        setAmount('');\n        setTransferFee('');\n      }\n      // تأكد من ظهور النموذج أعلى الصفحة في الموبايل\n      setTimeout(() => {\n        window.scrollTo({ top: 0, behavior: 'smooth' });\n      }, 50);\n    }\n  }, [location.state]);\n\n  // دالة لحفظ البيانات في Firebase\n  const saveDataToFirebase = async (data: any) => {\n    if (!user) return;\n    \n    try {\n      const userProfile = await profileService.getById(user.uid);\n      if (userProfile?.shopId) {\n        // 1. Update Dashboard Data (Primary for Desktop)\n        const dataRef = doc(db, 'dashboardData', userProfile.shopId);\n        // Enforce integer values for cashBalance\n        if (data.cashBalance !== undefined) {\n          data.cashBalance = Math.round(data.cashBalance);\n        }\n        await updateDoc(dataRef, data);\n\n        // 2. Sync balances to Users Collection (Primary for Android Native/Sync)\n        // This fixes the issue where Desktop manual transactions don't reflect on Android\n        const updates: any = {};\n        if (data.walletBalances) updates.walletBalances = data.walletBalances;\n        if (data.cashBalance !== undefined) {\n          updates.cashBalance = Math.round(data.cashBalance);\n        }\n        \n        if (Object.keys(updates).length > 0) {\n           const userRef = doc(db, 'users', user.uid);\n           await updateDoc(userRef, updates);\n        }\n      }\n    } catch (error) {\n      console.error('Error saving to Firebase:', error);\n      toast({\n        title: \"خطأ في الحفظ\",\n        description: \"حدث خطأ أثناء حفظ البيانات في Firebase\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  useEffect(() => {\n    if (!user) return;\n    \n    const loadDataFromFirebase = async () => {\n      setIsLoading(true);\n      try {\n        const userProfile = await profileService.getById(user.uid);\n        if (userProfile?.shopId) {\n          // تحميل الأرصدة من Firebase\n          const dataRef = doc(db, 'dashboardData', userProfile.shopId);\n          // أولاً: محاولة قراءة سريعة من الكاش لعرض البيانات فورًا\n          try {\n            const cachedSnap = await getDocFromCache(dataRef);\n            if (cachedSnap.exists()) {\n              const cached = cachedSnap.data() as any;\n              setCashBalance(cached.cashBalance || 0);\n              setWalletBalances(cached.walletBalances || {});\n              setDeletedTransactions(cached.deletedTransactions || []);\n              // بما أن لدينا بيانات معروضة من الكاش، ننهي حالة التحميل مبكرًا\n              setIsLoading(false);\n            }\n          } catch {\n            // الكاش غير متوفر أو غير مفعّل، نتابع لجلب الشبكة\n          }\n          const dataSnap = await getDoc(dataRef);\n          \n          if (dataSnap.exists()) {\n            const data = dataSnap.data();\n            \n            // تحسين معالجة الأرصدة لتجنب التصفير الخاطئ\n            const fbCash = data.cashBalance;\n            if (typeof fbCash === 'number') {\n              setCashBalance(fbCash);\n              try { localStorage.setItem('lastKnownCashBalance', String(fbCash)); } catch {}\n            } else {\n               // إذا كانت القيمة غير موجودة في المستند، نحاول استرجاع آخر قيمة معروفة\n               const lastKnown = localStorage.getItem('lastKnownCashBalance');\n               if (lastKnown && !isNaN(Number(lastKnown))) {\n                 setCashBalance(Number(lastKnown));\n               } else {\n                 setCashBalance(0);\n               }\n            }\n\n            const fbWallets = data.walletBalances;\n            if (fbWallets && typeof fbWallets === 'object') {\n              setWalletBalances(fbWallets);\n              try { localStorage.setItem('lastKnownWalletBalances', JSON.stringify(fbWallets)); } catch {}\n            } else {\n               const lastKnown = localStorage.getItem('lastKnownWalletBalances');\n               if (lastKnown) {\n                 setWalletBalances(JSON.parse(lastKnown));\n               } else {\n                 setWalletBalances({});\n               }\n            }\n            \n            setDeletedTransactions(data.deletedTransactions || []);\n          } else {\n            const defaultData = {\n              walletBalances: {},\n              deletedTransactions: []\n            };\n            await setDoc(dataRef, defaultData);\n            setCashBalance(0);\n            setWalletBalances(defaultData.walletBalances);\n            setDeletedTransactions(defaultData.deletedTransactions);\n          }\n        }\n      } catch (error) {\n        console.error('Error loading data from Firebase:', error);\n        \n        // في حالة الخطأ، نحاول استرجاع آخر قيم معروفة بدلاً من التصفير\n        let recovered = false;\n        try {\n          const lastCash = localStorage.getItem('lastKnownCashBalance');\n          const lastWallets = localStorage.getItem('lastKnownWalletBalances');\n          \n          if (lastCash !== null && !isNaN(Number(lastCash))) {\n            setCashBalance(Number(lastCash));\n            recovered = true;\n          }\n          \n          if (lastWallets) {\n            setWalletBalances(JSON.parse(lastWallets));\n            recovered = true;\n          }\n        } catch {}\n\n        if (!recovered) {\n          setCashBalance(0);\n          setWalletBalances({});\n        }\n        \n        setDeletedTransactions([]);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadDataFromFirebase();\n  }, [user]);\n\n  useEffect(() => {\n    const handleExternalUpdate = (event: any) => {\n      const { cashBalance: newCash, walletBalances: newWallets, newTransaction, delta } = event.detail || {};\n      \n      // Handle Delta Update (Optimistic)\n      if (delta) {\n          const { amount, type, walletId, commission, totalDeducted } = delta;\n          const amt = Number(amount || 0);\n          const comm = Number(commission || 0);\n          const totalDed = Number(totalDeducted || (amt + comm));\n          \n          setCashBalance(prev => {\n              let change = 0;\n              if (type === 'withdraw') {\n                  change = -amt + comm;\n              } else if (type === 'send' || type === 'transfer') {\n                  change = amt + comm;\n              } else if (type === 'atm_withdraw') {\n                  change = amt;\n              }\n              return prev + change;\n          });\n          \n          if (walletId) {\n              setWalletBalances(prev => {\n                  const currentVal = Number(prev[walletId] || 0);\n                  let change = 0;\n                  if (type === 'withdraw') {\n                      change = amt;\n                  } else if (type === 'send' || type === 'transfer') {\n                      change = -amt;\n                  } else if (type === 'atm_withdraw') {\n                      change = -totalDed;\n                  }\n                  return { ...prev, [walletId]: currentVal + change };\n              });\n          }\n      }\n\n      if (typeof newCash === 'number') {\n        setCashBalance(newCash);\n      }\n      \n      if (newWallets && typeof newWallets === 'object') {\n        setWalletBalances(newWallets);\n      }\n      \n      if (newTransaction) {\n        setTransactions(prev => {\n          // Check if transaction already exists to avoid duplicates\n          if (prev.some(t => t.id === newTransaction.id)) {\n            return prev;\n          }\n          return [newTransaction, ...prev];\n        });\n        \n        // Also update daily stats if needed, but primarily transactions list\n        toast({\n          title: \"تم تسجيل عملية خارجية\",\n          description: \"تم تحديث الأرصدة والسجلات بنجاح\",\n        });\n      }\n    };\n\n    window.addEventListener('dashboard:external-update', handleExternalUpdate);\n    return () => window.removeEventListener('dashboard:external-update', handleExternalUpdate);\n  }, []);\n\n  // استبدال الاشتراك اللحظي بآلية التحديث اليدوي لتقليل القراءات\n  const refreshDashboardData = async () => {\n    if (!user) return;\n    setIsLoading(true);\n    try {\n      const userProfile = await profileService.getById(user.uid);\n      if (userProfile?.shopId) {\n        const dataRef = doc(db, 'dashboardData', userProfile.shopId);\n        // تجاهل الكاش هنا لضمان الحصول على أحدث البيانات عند الطلب اليدوي\n        const dataSnap = await getDoc(dataRef);\n        \n        if (dataSnap.exists()) {\n          const data: any = dataSnap.data();\n          setCashBalance(data.cashBalance || 0);\n          setWalletBalances(data.walletBalances || {});\n          setDeletedTransactions(data.deletedTransactions || []);\n          toast({\n            title: \"تم تحديث البيانات\",\n            description: \"تم تحميل أحدث البيانات من السيرفر بنجاح\",\n          });\n        }\n      }\n    } catch (e) {\n      console.error('Error refreshing dashboard data:', e);\n      toast({\n        title: \"فشل التحديث\",\n        description: \"حدث خطأ أثناء تحديث البيانات\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // تمت إزالة الاشتراك اللحظي (onSnapshot) لتقليل تكاليف Firebase Reads\n  // الاعتماد الآن على:\n  // 1. التحميل الأولي (loadDataFromFirebase)\n  // 2. التحديث المحلي المتفائل عند إجراء عمليات (optimistic UI updates)\n  // 3. التحديث اليدوي عند الحاجة\n\n\n  // تمت إزالة مزامنة التخزين المحلي: العرض والعمليات تعتمد على Firestore فقط\n\n  // باقي الكود يبقى كما هو...\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (transactionType === 'transfer') {\n      // Transfer logic\n      if (!senderPhone || !amount || (isReceiverPhoneInputEnabled && !receiverPhone)) {\n        toast({\n          title: \"خطأ\",\n          description: \"يرجى ملء جميع الحقول المطلوبة\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      // تحديد اسم المحل من بروفايل المستخدم، مع بدائل آمنة\n      const merchantShopName = profile?.shopName || user?.displayName || 'محل كاشي لينك';\n\n      // محاولة تحديد اسم المحفظة المختارة أو الافتراضية\n      const selectedWalletObj = wallets.find(w => w.id === selectedWallet) || wallets.find(w => w.isDefault);\n\n      // تحقق من الرسوم بناءً على بادئات الأرقام (شرط 010 → 011)\n      const fee = (transferFee && transferFee.trim() !== '') ? parseFloat(transferFee) : 0;\n\n      // تحقق من توفر المحفظة والرصيد الكافي\n      if (!selectedWalletObj) {\n        toast({ title: \"لا توجد محفظة\", description: \"يرجى اختيار محفظة لإتمام التحويل\", variant: \"destructive\" });\n        return;\n      }\n      const parsedAmount = Math.round(parseFloat(amount));\n      const totalDebit = parsedAmount + fee;\n      const currentWalletBalance = walletBalances[selectedWalletObj.id] || 0;\n      if (currentWalletBalance < totalDebit) {\n        toast({ title: \"رصيد المحفظة غير كافٍ\", description: `الرصيد الحالي ${currentWalletBalance} لا يكفي لخصم ${totalDebit}`, variant: \"destructive\" });\n        return;\n      }\n\n      const transferCommission = calculateCommission(parsedAmount, 'send');\n      const newTransaction: Transaction = {\n        id: Date.now().toString(),\n        type: 'send',\n        senderPhone,\n        receiverPhone,\n        amount: parsedAmount,\n        status: 'pending',\n        createdAt: new Date(),\n        withdrawnAmount: 0,\n        sentAmount: parsedAmount,\n        merchantShopName,\n        shopName: selectedWalletObj?.name || 'المحفظة الرئيسية',\n        commission: transferCommission,\n        fee: fee,\n        fromWallet: selectedWalletObj.id,\n      };\n\n      // لا نضيف اسم الكاشير في معاملات الحساب الرئيسي حتى لو كانت وردية نشطة\n\n      const updatedTransactions = [newTransaction, ...transactions];\n      setTransactions(updatedTransactions);\n\n      // تحديث رصيد المحفظة (خصم مبلغ التحويل + الرسوم)\n      const totalDebit2 = parsedAmount + fee;\n      const walletId = selectedWalletObj?.id;\n      const currentWalletBalance2 = walletId ? (walletBalances[walletId] || 0) : 0;\n      const newWalletBalances = walletId ? { ...walletBalances, [walletId]: currentWalletBalance2 - totalDebit2 } : walletBalances;\n      setWalletBalances(newWalletBalances);\n\n      // لا نضيف الرسوم إلى الدرج عند الإنشاء — الإضافة تتم عند الإكمال فقط\n\n      // حفظ في Firebase بدون تعديل الدرج الآن\n      await saveDataToFirebase({ transactions: updatedTransactions, walletBalances: newWalletBalances });\n\n      toast({\n        title: \"تم إرسال التحويل\",\n        description: \"جاري معالجة التحويل...\",\n      });\n\n      setTimeout(async () => {\n        const completedTransaction = { ...newTransaction, status: 'completed' as const };\n        const finalTransactions = [completedTransaction, ...transactions];\n        setTransactions(finalTransactions);\n        \n        // عند الإكمال: إضافة الرسوم إلى الدرج ثم حفظ\n        const completedFee = fee;\n        const toAdd = Math.max(0, transferCommission) + (Number.isFinite(completedFee) ? completedFee : 0);\n        const newCashBalanceOnComplete = cashBalance + toAdd;\n        setCashBalance(newCashBalanceOnComplete);\n        await saveDataToFirebase({ transactions: finalTransactions, cashBalance: newCashBalanceOnComplete });\n\n        ProfitService.addProfit(toAdd);\n\n        // toast({\n        //   title: \"تم التحويل بنجاح\",\n        //   description: `تم تحويل ${amount} جنيه إلى ${receiverPhone} وخصم عمولة ${commission} جنيه من الدرج`,\n        // });\n      }, 2000);\n\n      setSenderPhone('01030302038');\n      setReceiverPhone('');\n      setAmount('');\n      setTransferFee('');\n    } else if (transactionType === 'withdraw') {\n      if (!senderPhone || !amount) {\n        toast({\n          title: \"خطأ\",\n          description: \"يرجى ملء جميع الحقول المطلوبة\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      const merchantShopName = profile?.shopName || user?.displayName || 'محل كاشي لينك';\n      const selectedWalletObj = wallets.find(w => w.id === selectedWallet) || wallets.find(w => w.isDefault);\n      if (!selectedWalletObj) {\n        toast({ title: \"لا توجد محفظة\", description: \"يرجى اختيار محفظة لإتمام السحب\", variant: \"destructive\" });\n        return;\n      }\n\n      const parsedAmount = Math.round(parseFloat(amount));\n      if (!Number.isFinite(parsedAmount) || parsedAmount <= 0) {\n        toast({ title: \"خطأ\", description: \"أدخل مبلغًا صحيحًا للسحب\", variant: \"destructive\" });\n        return;\n      }\n\n      const withdrawCommission = calculateCommission(parsedAmount, 'receive');\n      const newTransaction: Transaction = {\n        id: Date.now().toString(),\n        type: 'withdraw',\n        senderPhone,\n        receiverPhone: '',\n        amount: parsedAmount,\n        status: 'pending',\n        createdAt: new Date(),\n        withdrawnAmount: parsedAmount,\n        sentAmount: 0,\n        merchantShopName,\n        shopName: selectedWalletObj?.name || 'المحفظة الرئيسية',\n        commission: withdrawCommission,\n        fromWallet: selectedWalletObj.id,\n        senderName: senderName || undefined,\n      };\n\n      const updatedTransactions = [newTransaction, ...transactions];\n      setTransactions(updatedTransactions);\n\n      await saveDataToFirebase({ transactions: updatedTransactions });\n\n      toast({\n        title: \"تم إنشاء عملية السحب\",\n        description: \"جاري معالجة السحب...\",\n      });\n\n      setTimeout(async () => {\n        const completedTransaction = { ...newTransaction, status: 'completed' as const };\n        const finalTransactions = [completedTransaction, ...transactions];\n        setTransactions(finalTransactions);\n\n        const fromWalletId = selectedWalletObj.id;\n        const currentWalletBalance = walletBalances[fromWalletId] || 0;\n        const newWalletBalances = { ...walletBalances, [fromWalletId]: currentWalletBalance + parsedAmount };\n        setWalletBalances(newWalletBalances);\n\n        const newCashBalanceOnComplete = cashBalance - parsedAmount + Math.max(0, withdrawCommission);\n        setCashBalance(newCashBalanceOnComplete);\n\n        await saveDataToFirebase({ transactions: finalTransactions, walletBalances: newWalletBalances, cashBalance: newCashBalanceOnComplete });\n\n        ProfitService.addProfit(Math.max(0, withdrawCommission));\n      }, 2000);\n\n      setSenderPhone('01030302038');\n      setAmount('');\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background p-4\">\n      <AutoTransactionDialog \n        open={!!autoTransaction} \n        onOpenChange={(open) => !open && setAutoTransaction(null)} \n        transaction={autoTransaction}\n        walletName={wallets.find(w => w.id === autoTransaction?.fromWallet)?.name}\n      />\n      {isLoading && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white p-6 rounded-lg\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\n            <p className=\"mt-2 text-center\">جاري تحميل البيانات...</p>\n          </div>\n        </div>\n      )}\n      \n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        {/* Header */}\n        <div className=\"flex justify-between items-center\">\n          <h1 className=\"text-3xl font-bold text-gray-900\">لوحة تحكم الإدارة</h1>\n          <div className=\"flex items-center gap-2\">\n            <Button onClick={refreshDashboardData} variant=\"outline\" className=\"flex items-center gap-2\">\n              <RefreshCcw className=\"h-4 w-4\" />\n              تحديث\n            </Button>\n            <Button onClick={signOut} variant=\"outline\" className=\"flex items-center gap-2\">\n              <LogOut className=\"h-4 w-4\" />\n              تسجيل الخروج\n            </Button>\n          </div>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">الرصيد النقدي</CardTitle>\n              <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{cashBalance.toLocaleString('en-US', { maximumFractionDigits: 0 })} جنيه</div>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">أرصدة المحافظ</CardTitle>\n              <Wallet className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">\n                {Object.values(walletBalances).reduce((sum, balance) => sum + balance, 0).toLocaleString('en-US', { maximumFractionDigits: 0 })} جنيه\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"relative\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">المعاملات اليوم</CardTitle>\n              <ArrowUpDown className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent className={isDailyLocked ? \"filter blur-sm pointer-events-none\" : \"\"}>\n              <div className=\"text-2xl font-bold\">{transactions.length}</div>\n            </CardContent>\n            {isDailyLocked && (\n              <div className=\"absolute inset-0 flex items-center justify-center rounded-lg bg-yellow-100/60\">\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={() => setIsDailyPinDialogOpen(true)}\n                  className=\"flex items-center gap-2 bg-yellow-200/70 hover:bg-yellow-300 text-yellow-900 px-3 py-2 rounded-xl shadow-md hover:shadow-lg transition-all\"\n                  title=\"عرض تقارير اليوم\"\n                >\n                  <Eye className=\"h-5 w-5\" />\n                  <span className=\"text-xs\">عرض تقارير اليوم</span>\n                </Button>\n              </div>\n            )}\n          </Card>\n          \n          <Card className=\"relative\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">إجمالي اليوم</CardTitle>\n              <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent className={isDailyLocked ? \"filter blur-sm pointer-events-none\" : \"\"}>\n              <div className=\"text-2xl font-bold\">\n                {transactions.reduce((sum, t) => sum + t.amount, 0).toLocaleString()} جنيه\n              </div>\n            </CardContent>\n            {isDailyLocked && (\n              <div className=\"absolute inset-0 flex items-center justify-center rounded-lg bg-yellow-100/60\">\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={() => setIsDailyPinDialogOpen(true)}\n                  className=\"flex items-center gap-2 bg-yellow-200/70 hover:bg-yellow-300 text-yellow-900 px-3 py-2 rounded-xl shadow-md hover:shadow-lg transition-all\"\n                  title=\"عرض تقارير اليوم\"\n                >\n                  <Eye className=\"h-5 w-5\" />\n                  <span className=\"text-xs\">عرض تقارير اليوم</span>\n                </Button>\n              </div>\n            )}\n          </Card>\n\n          {/* Dialog to verify master PIN and unlock daily reports */}\n          <MasterPinDialog\n            open={isDailyPinDialogOpen}\n            onOpenChange={setIsDailyPinDialogOpen}\n            mode=\"verify\"\n            title=\"قفل تقارير اليوم\"\n            description=\"لا يمكن الاطلاع على تقارير اليوم إلا بإدخال الرقم السري الرئيسي\"\n            userId={user?.uid}\n            userRole={profile?.role}\n            onSuccess={() => {\n              setIsDailyLocked(false);\n              setIsDailyPinDialogOpen(false);\n            }}\n          />\n        </div>\n\n        {/* Transaction Form */}\n        <Card className={isMobile && isTransactionPinned ? 'sticky top-0 z-40 shadow-lg bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/70' : ''}>\n          <CardHeader>\n            <CardTitle>إجراء معاملة جديدة</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">نوع المعاملة</label>\n                  <Select value={transactionType} onValueChange={(value: 'transfer' | 'withdraw') => setTransactionType(value)}>\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"transfer\">تحويل</SelectItem>\n                      <SelectItem value=\"withdraw\">سحب</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">رقم المرسل</label>\n                  <Input\n                    type=\"tel\"\n                    value={senderPhone}\n                    onChange={(e) => setSenderPhone(e.target.value)}\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter') {\n                        const dest = document.getElementById('receiverPhoneInput') as HTMLInputElement | null;\n                        if (dest) {\n                          dest.focus();\n                        } else {\n                          const amountEl = document.getElementById('amountInput') as HTMLInputElement | null;\n                          amountEl?.focus();\n                        }\n                      }\n                    }}\n                    placeholder=\"01xxxxxxxxx\"\n                  />\n                </div>\n                \n                {transactionType === 'transfer' && isReceiverPhoneInputEnabled && (\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">رقم المستقبل</label>\n                    <Input\n                      id=\"receiverPhoneInput\"\n                      type=\"tel\"\n                      value={receiverPhone}\n                      onChange={(e) => setReceiverPhone(e.target.value)}\n                      onKeyDown={(e) => {\n                        if (e.key === 'Enter') {\n                          const next = document.getElementById('amountInput') as HTMLInputElement | null;\n                          next?.focus();\n                        }\n                      }}\n                      placeholder=\"01xxxxxxxxx\"\n                    />\n                  </div>\n                )}\n                {transactionType === 'withdraw' && (\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">اسم الراسل (اختياري)</label>\n                    <Input\n                      id=\"senderNameInput\"\n                      type=\"text\"\n                      value={senderName}\n                      onChange={(e) => setSenderName(e.target.value)}\n                      placeholder=\"مثال: أحمد عبد الرحمن\"\n                    />\n                  </div>\n                )}\n                \n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">شركة المرسل</label>\n                  <Select value={senderProvider} onValueChange={(v) => setSenderProvider(v as any)}>\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"vodafone_cash\">فودافون</SelectItem>\n                      <SelectItem value=\"etisalat_cash\">اتصالات</SelectItem>\n                      <SelectItem value=\"orange_cash\">أورانج</SelectItem>\n                      <SelectItem value=\"instapay\">إنستاباي</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">شركة المستقبل</label>\n                  <Select value={receiverProvider} onValueChange={(v) => setReceiverProvider(v as any)}>\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"vodafone_cash\">فودافون</SelectItem>\n                      <SelectItem value=\"etisalat_cash\">اتصالات</SelectItem>\n                      <SelectItem value=\"orange_cash\">أورانج</SelectItem>\n                      <SelectItem value=\"instapay\">إنستاباي</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">المبلغ</label>\n                  <Input\n                    id=\"amountInput\"\n                    type=\"number\"\n                    value={amount}\n                    onChange={(e) => setAmount(e.target.value)}\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter') {\n                        const submitBtn = document.getElementById('txSubmitButton') as HTMLButtonElement | null;\n                        submitBtn?.focus();\n                      }\n                    }}\n                    placeholder=\"0.00\"\n                  />\n                </div>\n                {transactionType === 'withdraw' && (\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">اسم الراسل (اختياري)</label>\n                    <Input\n                      id=\"senderNameInput\"\n                      type=\"text\"\n                      value={senderName}\n                      onChange={(e) => setSenderName(e.target.value)}\n                      placeholder=\"مثال: أحمد عبد الرحمن\"\n                    />\n                  </div>\n                )}\n                {transactionType === 'transfer' && ((normalizeDigits(senderPhone || '').replace(/\\D/g, '').startsWith('010') && normalizeDigits(receiverPhone || '').replace(/\\D/g, '').startsWith('010')) || (normalizeDigits(senderPhone || '').replace(/\\D/g, '').startsWith('010') && (normalizeDigits(receiverPhone || '').replace(/\\D/g, '').startsWith('011') || normalizeDigits(receiverPhone || '').replace(/\\D/g, '').startsWith('012') || normalizeDigits(receiverPhone || '').replace(/\\D/g, '').startsWith('015'))) || (normalizeDigits(senderPhone || '').replace(/\\D/g, '').startsWith('012') && normalizeDigits(receiverPhone || '').replace(/\\D/g, '').startsWith('010')) || (normalizeDigits(senderPhone || '').replace(/\\D/g, '').startsWith('011') && normalizeDigits(receiverPhone || '').replace(/\\D/g, '').startsWith('010')) || (normalizeDigits(senderPhone || '').replace(/\\D/g, '').startsWith('015') && normalizeDigits(receiverPhone || '').replace(/\\D/g, '').startsWith('010'))) && (\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">رسوم التحويل</label>\n                    <Input\n                      type=\"number\"\n                      value={transferFee}\n                      onChange={(e) => setTransferFee(e.target.value)}\n                      placeholder=\"0.00\"\n                    />\n                    <p className=\"text-xs text-gray-500 mt-1\">تُخصم من المحفظة وتضاف للدرج</p>\n                  </div>\n                )}\n              </div>\n              \n              <Button id=\"txSubmitButton\" type=\"submit\" className={`w-full ${transactionType === 'transfer' ? 'btn-transfer-confirm' : 'btn-withdraw-confirm'}`}>\n                {transactionType === 'transfer' ? 'إرسال التحويل' : 'تنفيذ السحب'}\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n\n        {/* Transactions List */}\n        <Card>\n          <CardHeader>\n            <CardTitle>المعاملات الأخيرة</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {transactions.length === 0 ? (\n              <p className=\"text-sm text-gray-500\">لا توجد معاملات حديثة.</p>\n            ) : (\n              <div className={(isMobile || isAndroid) ? \"receipts-list space-y-3 max-h-[310px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400\" : \"receipts-list space-y-3\"}>\n                {transactions.map((transaction) => (\n                  <div \n                    key={transaction.id} \n                    className=\"relative flex items-center gap-4 p-4 rounded-xl bg-card border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200\"\n                  >\n                    {/* Icon Column */}\n                    <div className={`h-12 w-12 rounded-full flex items-center justify-center shrink-0 ${\n                       transaction.type === 'withdraw' ? 'bg-red-50' : 'bg-green-50'\n                    }`}>\n                       {transaction.type === 'withdraw' ? (\n                          <ArrowDownLeft className=\"h-6 w-6 text-red-600\" />\n                       ) : (\n                          <ArrowUpRight className=\"h-6 w-6 text-green-600\" />\n                       )}\n                    </div>\n\n                    {/* Content Column */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center justify-between mb-1\">\n                        <h4 className=\"text-base font-bold text-foreground truncate\">\n                          {transaction.type === 'send' ? 'تحويل أموال' : 'سحب نقدي'}\n                        </h4>\n                        <span className={`text-base font-bold whitespace-nowrap ${\n                          transaction.type === 'send' ? 'text-green-600' : 'text-red-600'\n                        }`}>\n                          {transaction.type === 'send' ? '-' : '+'} {transaction.amount.toLocaleString()} ج.م\n                        </span>\n                      </div>\n\n                      <div className=\"flex items-center justify-between\">\n                         <div className=\"flex flex-col gap-0.5\">\n                            <p className=\"text-sm text-muted-foreground truncate\">\n                               {transaction.type === 'send' ? (\n                                  <span dir=\"ltr\">{transaction.receiverPhone}</span>\n                               ) : (\n                                  <span dir=\"ltr\">{transaction.senderPhone}</span>\n                               )}\n                            </p>\n                            <p className=\"text-sm font-medium text-gray-500 mt-0.5\">\n                               {transaction.createdAt instanceof Date ? transaction.createdAt.toLocaleString('ar-EG', { day: 'numeric', month: 'short', hour: 'numeric', minute: 'numeric', hour12: true }) : new Date((transaction.createdAt as any).seconds * 1000).toLocaleString('ar-EG', { day: 'numeric', month: 'short', hour: 'numeric', minute: 'numeric', hour12: true })}\n                            </p>\n                            {(transaction.fromWallet || transaction.shopName || transaction.provider) && (\n                              <p className=\"text-xs text-blue-600 mt-1 flex items-center gap-1\">\n                                <Wallet className=\"w-3 h-3\" />\n                                {wallets.find(w => w.id === transaction.fromWallet)?.name || \n                                 (transaction.provider === 'vodafone_cash' ? 'فودافون كاش' : \n                                  transaction.provider === 'etisalat_cash' ? 'اتصالات كاش' : \n                                  transaction.provider === 'orange_cash' ? 'أورانج كاش' : \n                                  transaction.provider === 'instapay' ? 'إنستاباي' : \n                                  transaction.shopName || 'المحفظة')}\n                              </p>\n                            )}\n                         </div>\n\n                         <div className={`px-2.5 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${\n                            transaction.status === 'completed' \n                              ? 'bg-green-50 text-green-700' \n                              : transaction.status === 'pending'\n                              ? 'bg-yellow-50 text-yellow-700'\n                              : 'bg-red-50 text-red-700'\n                         }`}>\n                            {transaction.status === 'completed' && <Check className=\"h-3 w-3\" />}\n                            {transaction.status === 'pending' && <Clock className=\"h-3 w-3\" />}\n                            {transaction.status === 'failed' && <X className=\"h-3 w-3\" />}\n                            <span>\n                               {transaction.status === 'completed' ? 'ناجحة' : transaction.status === 'pending' ? 'معالجة' : 'فشلت'}\n                            </span>\n                         </div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n        \n        <AutoTransactionDialog \n          open={!!autoTransaction} \n          onOpenChange={(open) => !open && setAutoTransaction(null)} \n          transaction={autoTransaction}\n          walletName={wallets.find(w => w.id === autoTransaction?.fromWallet)?.name || \n            (autoTransaction?.provider === 'vodafone_cash' ? 'فودافون كاش' : \n             autoTransaction?.provider === 'etisalat_cash' ? 'اتصالات كاش' : \n             autoTransaction?.provider === 'orange_cash' ? 'أورانج كاش' : \n             autoTransaction?.provider === 'instapay' ? 'إنستاباي' : \n             autoTransaction?.shopName)}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default DashboardPage;\n\n// كشف الشركة تلقائيًا من مقدمة الرقم\nconst detectProvider = (phone: string): 'vodafone_cash' | 'etisalat_cash' | 'orange_cash' | 'instapay' | null => {\n  const digits = normalizeDigits(phone).replace(/\\D/g, '');\n  if (digits.startsWith('010')) return 'vodafone_cash';\n  if (digits.startsWith('011')) return 'etisalat_cash';\n  if (digits.startsWith('012')) return 'orange_cash';\n  // مبدئيًا لا ندعم 015 (WE) هنا؛ تظل القيمة كما هي أو يُستخدم الاختيار اليدوي\n  return null;\n};\n","import React, { useEffect, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport DashboardPage from '../pages/DashboardPage';\r\nimport LogoLoader from '@/components/LogoLoader';\r\n\r\nconst ProtectedDashboard = () => {\r\n  const navigate = useNavigate();\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // التحقق من حالة تسجيل الدخول\r\n    const checkAuth = () => {\r\n      const authStatus = localStorage.getItem('dashboardAuth');\r\n      const userData = localStorage.getItem('dashboardUser');\r\n      \r\n      if (authStatus === 'true' && userData) {\r\n        try {\r\n          const user = JSON.parse(userData);\r\n          const loginTime = new Date(user.loginTime);\r\n          const now = new Date();\r\n          const hoursDiff = (now.getTime() - loginTime.getTime()) / (1000 * 60 * 60);\r\n          \r\n          // انتهاء صلاحية الجلسة بعد 24 ساعة\r\n          if (hoursDiff < 24) {\r\n            setIsAuthenticated(true);\r\n          } else {\r\n            // انتهت صلاحية الجلسة\r\n            localStorage.removeItem('dashboardAuth');\r\n            localStorage.removeItem('dashboardUser');\r\n            navigate('/dashboard/login');\r\n          }\r\n        } catch (error) {\r\n          console.error('Error parsing user data:', error);\r\n          navigate('/dashboard/login');\r\n        }\r\n      } else {\r\n        navigate('/dashboard/login');\r\n      }\r\n      \r\n      setIsLoading(false);\r\n    };\r\n\r\n    checkAuth();\r\n  }, [navigate]);\r\n\r\n  if (isLoading) {\r\n    return <LogoLoader />;\r\n  }\r\n\r\n  if (!isAuthenticated) {\r\n    return <LogoLoader />;\r\n  }\r\n\r\n  return <DashboardPage />;\r\n};\r\n\r\nexport default ProtectedDashboard;"],"names":["AutoTransactionDialog","open","onOpenChange","transaction","walletName","isIncoming","amount","Dialog","jsxs","DialogContent","jsx","CheckCircle2","Wallet","Button","DashboardPage","location","useLocation","toast","useToast","signOut","user","profile","useFirebaseAuth","isShiftActive","shiftUser","useShift","isMobile","useIsMobile","isAndroid","Capacitor","senderPhone","setSenderPhone","useState","senderName","setSenderName","receiverPhone","setReceiverPhone","setAmount","transactionType","setTransactionType","senderProvider","setSenderProvider","receiverProvider","setReceiverProvider","transferFee","setTransferFee","transactions","setTransactions","activeTab","setActiveTab","isWalletManagementOpen","setIsWalletManagementOpen","selectedWallet","setSelectedWallet","wallets","setWallets","selectedTransaction","setSelectedTransaction","isTransactionDetailsOpen","setIsTransactionDetailsOpen","dailyStats","setDailyStats","monthlyStats","setMonthlyStats","isResetDialogOpen","setIsResetDialogOpen","resetType","setResetType","deletedTransactions","setDeletedTransactions","cashBalance","setCashBalance","walletBalances","setWalletBalances","isEditCashDialogOpen","setIsEditCashDialogOpen","isReceiverPhoneInputEnabled","setIsReceiverPhoneInputEnabled","useEffect","key","v","isEditWalletDialogOpen","setIsEditWalletDialogOpen","isAddToWalletDialogOpen","setIsAddToWalletDialogOpen","isAddToWalletTotalDialogOpen","setIsAddToWalletTotalDialogOpen","isEditWalletTotalDialogOpen","setIsEditWalletTotalDialogOpen","editingWalletId","setEditingWalletId","isChangePinDialogOpen","setIsChangePinDialogOpen","isLoading","setIsLoading","isDailyLocked","setIsDailyLocked","isDailyPinDialogOpen","setIsDailyPinDialogOpen","isTransactionPinned","setIsTransactionPinned","autoTransaction","setAutoTransaction","lastTxIdRef","React","ws","merchantWalletService","normalized","w","e","unsub","p","profileService","dataRef","doc","db","onSnapshot","snap","data","txs","latest","_a","newCash","newWallets","cachedCash","cachedWallets","normalizeDigits","s","arabicIndic","easternIndic","ch","ai","ei","detectProvider","phone","digits","state","saveDataToFirebase","userProfile","updateDoc","updates","userRef","error","cachedSnap","getDocFromCache","cached","dataSnap","getDoc","fbCash","lastKnown","fbWallets","defaultData","setDoc","recovered","lastCash","lastWallets","handleExternalUpdate","event","newTransaction","delta","type","walletId","commission","totalDeducted","amt","comm","totalDed","prev","change","currentVal","t","refreshDashboardData","handleSubmit","merchantShopName","selectedWalletObj","fee","parsedAmount","totalDebit","currentWalletBalance","transferCommission","calculateCommission","updatedTransactions","totalDebit2","currentWalletBalance2","newWalletBalances","finalTransactions","completedFee","toAdd","newCashBalanceOnComplete","ProfitService","withdrawCommission","fromWalletId","LogOut","Card","CardHeader","CardTitle","DollarSign","CardContent","sum","balance","ArrowUpDown","Eye","MasterPinDialog","Select","value","SelectTrigger","SelectValue","SelectContent","SelectItem","Input","dest","amountEl","next","submitBtn","ArrowDownLeft","Clock","_b","ProtectedDashboard","navigate","useNavigate","isAuthenticated","setIsAuthenticated","authStatus","userData","loginTime","LogoLoader"],"mappings":"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"}