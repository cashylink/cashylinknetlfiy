import{b as k,a as L,r as c,g as P,u as I,c as $,j as t,N as q,d as z,I as u,B as x,L as A,e as p}from"./index-DKHjTn06.js";import{C as B,a as F,b as _,d as M}from"./card-CdZ89wHA.js";import{B as R}from"./BrandLogo-ChQW6zrK.js";import{S as T,M as j}from"./brandingService-RKVqdubw.js";import{D as v}from"./download-C6bsx04M.js";const H=m=>{const h=m.replace(/\D/g,"");return/^01(0|1|2|5)\d{8}$/.test(h)};function Q(){const[m]=k(),h=L(),y=m.get("mode")||"signin",[n,N]=c.useState(y==="signup"),[f,w]=c.useState(!1),[e,b]=c.useState(P()),[a,d]=c.useState({email:"",password:"",fullName:"",phone:""}),{signIn:C,signUp:E,user:U}=I();c.useEffect(()=>{try{const r=typeof window<"u"?window.localStorage.getItem("cashy:lastEmail"):null;r&&d(s=>({...s,email:r,password:""}))}catch{}},[]);const{toast:i}=$();if(U)return t.jsx(q,{to:"/dashboard-redirect",replace:!0});c.useEffect(()=>{(async()=>{try{const r=await z();b(r||{})}catch(r){console.error("Failed to load app downloads",r)}})()},[]);const S=async r=>{if(r.preventDefault(),f){i({title:"جارٍ التنفيذ",description:"يرجى الانتظار حتى تكتمل العملية"});return}if(typeof navigator<"u"&&navigator.onLine===!1){i({title:"لا يوجد اتصال",description:"تحقق من اتصال الإنترنت ثم أعد المحاولة",variant:"destructive"});return}w(!0);try{if(n){const s=(a.email||"").trim().toLowerCase(),g=(a.password||"").trim();if(!H(a.phone))throw i({title:"رقم غير صالح",description:"يجب أن يكون رقم مصري 11 رقم ويبدأ بـ 010/011/012/015",variant:"destructive"}),new Error("رقم الهاتف غير صالح");const{error:l}=await E(s,g,a.fullName,a.phone);if(l)throw l;i({title:"تم إنشاء الحساب بنجاح!",description:"تحقق من بريدك الإلكتروني لتفعيل الحساب"});const o=a.fullName||"التاجر الجديد";h(`/user/account-setup?user_name=${encodeURIComponent(o)}`)}else{const s=(a.email||"").trim().toLowerCase(),g=(a.password||"").trim();if(!/^\S+@\S+\.\S+$/.test(s))throw new Error("صيغة البريد الإلكتروني غير صحيحة");const{error:l}=await C(s,g);if(l){const o=l==null?void 0:l.code;throw o==="auth/invalid-email"?new Error("صيغة البريد الإلكتروني غير صحيحة"):o==="auth/user-not-found"?new Error("لا يوجد حساب بهذا البريد الإلكتروني"):o==="auth/wrong-password"?new Error("كلمة المرور غير صحيحة"):o==="auth/invalid-credential"?new Error("البريد الإلكتروني أو كلمة المرور غير صحيحة"):o==="auth/too-many-requests"?new Error("تم تجاوز عدد المحاولات المسموح، حاول لاحقاً"):l}i({title:"مرحباً بك!",description:"تم تسجيل الدخول بنجاح، جاري إعداد حسابك..."})}}catch(s){i({title:"خطأ",description:(s==null?void 0:s.message)||"حدث خطأ أثناء المعالجة",variant:"destructive"})}finally{w(!1)}};return t.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:t.jsxs(B,{className:"w-full max-w-md",children:[t.jsxs(F,{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[t.jsx(R,{size:32}),t.jsx("span",{className:"text-xl font-bold",children:"CashyLink"})]}),t.jsx(_,{children:n?"إنشاء حساب جديد":"تسجيل الدخول"})]}),t.jsxs(M,{children:[t.jsxs("form",{onSubmit:S,className:"space-y-4",children:[n&&t.jsxs(t.Fragment,{children:[t.jsx(u,{placeholder:"الاسم الكامل",value:a.fullName,onChange:r=>d({...a,fullName:r.target.value}),required:!0}),t.jsx(u,{placeholder:"رقم مصري (11 رقم يبدأ بـ 010/011/012/015)",value:a.phone,onChange:r=>d({...a,phone:r.target.value}),dir:"ltr",inputMode:"numeric",required:!0})]}),t.jsx(u,{type:"email",placeholder:"البريد الإلكتروني",value:a.email,onChange:r=>{const s=r.target.value;d({...a,email:s});try{window.localStorage.setItem("cashy:lastEmail",s)}catch{}},required:!0}),t.jsx(u,{type:"password",placeholder:"كلمة المرور",value:a.password,onChange:r=>d({...a,password:r.target.value}),autoComplete:n?"new-password":"off",required:!0}),t.jsx(x,{type:"submit",className:"w-full btn-primary",onClick:r=>{if(f){r.preventDefault(),r.stopPropagation(),i({title:"جارٍ التنفيذ",description:"يرجى الانتظار حتى تكتمل العملية"});return}typeof navigator<"u"&&navigator.onLine===!1&&(r.preventDefault(),r.stopPropagation(),i({title:"لا يوجد اتصال",description:"تحقق من اتصال الإنترنت ثم أعد المحاولة",variant:"destructive"}))},children:f?"جاري المعالجة...":n?"إنشاء الحساب":"تسجيل الدخول"})]}),t.jsxs("div",{className:"text-center mt-6",children:[t.jsx("span",{className:"text-muted-foreground",children:n?"لديك حساب؟":"ليس لديك حساب؟"}),t.jsx(x,{variant:"link",onClick:()=>N(!n),className:"text-primary",children:n?"تسجيل الدخول":"إنشاء حساب"})]}),t.jsx("div",{className:"text-center mt-4",children:t.jsx(A,{to:"/",children:t.jsx(x,{variant:"ghost",className:"text-muted-foreground",children:"العودة للصفحة الرئيسية"})})}),t.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3 justify-center items-center",children:[t.jsxs("a",{href:p(e==null?void 0:e.androidUrl)||"#",onClick:r=>{e!=null&&e.androidUrl||r.preventDefault()},className:`flex items-center gap-3 px-4 py-2 rounded-lg shadow-elegant transform hover:scale-105 transition-all duration-300 ${e!=null&&e.androidUrl?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,"aria-disabled":!(e!=null&&e.androidUrl),target:"_blank",rel:"noopener noreferrer",children:[t.jsx(T,{className:"h-5 w-5"}),"تحميل للأندرويد",t.jsx(v,{className:"h-4 w-4"})]}),t.jsxs("a",{href:p(e==null?void 0:e.pcUrl)||"#",onClick:r=>{e!=null&&e.pcUrl||r.preventDefault()},className:`flex items-center gap-3 px-4 py-2 rounded-lg shadow-elegant transform hover:scale-105 transition-all duration-300 ${e!=null&&e.pcUrl?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,"aria-disabled":!(e!=null&&e.pcUrl),target:"_blank",rel:"noopener noreferrer",children:[t.jsx(j,{className:"h-5 w-5"}),"تحميل تطبيق الكمبيوتر نسخة 64 بت",t.jsx(v,{className:"h-4 w-4"})]}),t.jsxs("a",{href:p(e==null?void 0:e.pc32Url)||"#",onClick:r=>{e!=null&&e.pc32Url||r.preventDefault()},className:`flex items-center gap-3 px-4 py-2 rounded-lg shadow-elegant transform hover:scale-105 transition-all duration-300 ${e!=null&&e.pc32Url?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,"aria-disabled":!(e!=null&&e.pc32Url),target:"_blank",rel:"noopener noreferrer",children:[t.jsx(j,{className:"h-5 w-5"}),"تحميل تطبيق الكمبيوتر نسخة 32 بت",t.jsx(v,{className:"h-4 w-4"})]})]})]})]})})}export{Q as default};
//# sourceMappingURL=AuthPage-DLYMxRW2.js.map
