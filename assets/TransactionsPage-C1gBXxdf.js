const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dailyOperationCountService-BDMlwDJn.js","./index-DhbnydJl.js","./index-DLaPizfT.css","./profitService-QTJQLMA0.js"])))=>i.map(i=>d[i]);
import{j as t,r as d,u as Pt,a7 as Dt,B as A,K as Ct,aa as Oe,ab as Re,ac as Pe,ad as Ee,C as pe,aG as He,aT as W,a_ as $e,aA as j,a as ps,R as ce,a9 as us,aM as hs,q as we,s as Te,t as M,aH as J,x as Ae,a8 as R,a$ as de,a6 as xs,aV as Ge,W as X,a1 as $,c as fs,d as gs,e as bs,I as Ve,S as ys,b0 as vs,b1 as js,b2 as Ns,aC as ws,ap as St,g as Ts,a3 as As,b3 as kt,aq as Ot,b4 as Ds,p as Xe,aI as Cs,aN as H,an as De}from"./index-DhbnydJl.js";import{S as Ss,a as ks,b as Os,c as Rs,d as Ce}from"./select-Bn8RCTk-.js";import{S as Ps,T as Es,a as Ls,b as Se,c as ke}from"./tabs-VyDQ-WsJ.js";import Is from"./ReceiptModal-Dqs_G1Fp.js";import _s from"./InstallmentModal-BmQdY6-Y.js";import Ms from"./CreditCardsDialog-CCiftUNp.js";import Ws from"./MaintenanceDialog-nfkRI82d.js";import{SimCardsDialog as Bs}from"./SimCardsDialog-BmPZk43L.js";import{a as Rt,u as zs,C as Us,b as Fs,f as U,c as $s,S as Gs}from"./SimCardsAccessDialog-Z5OgVyJn.js";import{ProfitService as me}from"./profitService-QTJQLMA0.js";import{D as Vs}from"./dollar-sign-AUKMnGdi.js";import{A as Ye}from"./arrow-down-left-DcYD3MrR.js";import{C as Et}from"./calendar-4dCWv1Gk.js";import{A as Xs}from"./arrow-left-DTf_k4UZ.js";import{C as Hs}from"./VideoModal-w5Ot-7KI.js";import{B as Ys}from"./battery-charging-BKlgE6-N.js";import{C as qs}from"./users-D9PlfCO2.js";import{C as Ks}from"./circle-check-big-Dtvck6_a.js";import"./index-xL9tDy8r.js";import"./separator-Cn84CDdZ.js";import"./html2canvas.esm-BfYXEYrK.js";import"./printer-DeiqlOce.js";import"./download-CAzB5lkL.js";import"./pen-line-DHrJReBO.js";import"./alert-dialog-BwXlZ7hY.js";import"./table-B1_nzBiE.js";import"./wifi-bFidCAXd.js";import"./save-DZuHrrpv.js";const Zs=({userId:D,transactions:a=[]})=>{const[x,b]=d.useState(!1),[se,Y]=d.useState(!1),[Q,q]=d.useState(!1),[B,ue]=d.useState({dailyWithdraw:0,dailyTransfer:0,monthlyWithdraw:0,monthlyTransfer:0,lastUpdated:new Date}),{userSubscription:z}=Pt();d.useEffect(()=>{D&&x&&Q&&ee()},[D,x,Q]);const K=w=>`${Math.round(w).toLocaleString("en-US")} ج.م`,O=async()=>{try{const w=(z==null?void 0:z.subscription)||null,m=(w==null?void 0:w.planType)??(w==null?void 0:w.plan)??null,T=typeof m=="string"?m.toLowerCase():null;if(m===W.ZERO||T==="zero"||T==="0"||m===0)return!0}catch{}try{if(D){const w=await $e(D),m=(w==null?void 0:w.planType)??(w==null?void 0:w.plan)??null,T=typeof m=="string"?m.toLowerCase():null;if(m===W.ZERO||T==="zero"||T==="0"||m===0)return!0}}catch{}return!1},G=async()=>{try{const w=await(async()=>{try{const m=(z==null?void 0:z.subscription)||null,T=(m==null?void 0:m.planType)??(m==null?void 0:m.plan)??null,P=typeof T=="string"?T.toLowerCase():null;if(T===W.TAHWEELA||P==="tahweela")return!0}catch{}try{if(D){const m=await $e(D),T=(m==null?void 0:m.planType)??(m==null?void 0:m.plan)??null,P=typeof T=="string"?T.toLowerCase():null;if(T===W.TAHWEELA||P==="tahweela")return!0}}catch{}return!1})();if(await O()||w){j({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"});return}}catch{}Y(!0)},ae=async()=>{try{const w=await(async()=>{try{const m=(z==null?void 0:z.subscription)||null,T=(m==null?void 0:m.planType)??(m==null?void 0:m.plan)??null,P=typeof T=="string"?T.toLowerCase():null;if(T===W.TAHWEELA||P==="tahweela")return!0}catch{}try{if(D){const m=await $e(D),T=(m==null?void 0:m.planType)??(m==null?void 0:m.plan)??null,P=typeof T=="string"?T.toLowerCase():null;if(T===W.TAHWEELA||P==="tahweela")return!0}}catch{}return!1})();if(await O()||w){j({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"}),Y(!1);return}}catch{}q(!0),b(!0),Y(!1)},ee=async()=>{if(D)try{if(Array.isArray(a)&&a.length>0){const m=new Date,T=m.getMonth(),P=m.getFullYear(),_=Dt.filterVisibleTransactions(a,"daily",D),re=Dt.filterVisibleTransactions(a,"monthly",D);let he=0,xe=0,V=0,ne=0;_.forEach(C=>{const te=new Date(C.createdAt),I=String(C.status||"confirmed").toLowerCase();if(te.toDateString()!==m.toDateString()||I!=="completed"&&I!=="confirmed"&&I!=="pending")return;const Z=(C.type||C.txnType||"").toLowerCase(),E={type:Z==="withdrawal"?"withdraw":Z,amount:Number(C.amount||0),commission:C.commission};E.type==="withdraw"?he+=me.calculateProfitFromTransaction(E):(E.type==="send"||E.type==="receive"||E.type==="transfer")&&(xe+=me.calculateProfitFromTransaction(E))}),re.forEach(C=>{const te=new Date(C.createdAt),I=String(C.status||"confirmed").toLowerCase();if(te.getMonth()!==T||te.getFullYear()!==P||I!=="completed"&&I!=="confirmed"&&I!=="pending")return;const Z=(C.type||C.txnType||"").toLowerCase(),E={type:Z==="withdrawal"?"withdraw":Z,amount:Number(C.amount||0),commission:C.commission};E.type==="withdraw"?V+=me.calculateProfitFromTransaction(E):(E.type==="send"||E.type==="receive"||E.type==="transfer")&&(ne+=me.calculateProfitFromTransaction(E))}),ue({dailyWithdraw:Math.round(he*100)/100,dailyTransfer:Math.round(xe*100)/100,monthlyWithdraw:Math.round(V*100)/100,monthlyTransfer:Math.round(ne*100)/100,lastUpdated:new Date});return}const w=me.getWithdrawTransferProfits(D);ue({dailyWithdraw:w.dailyWithdrawProfit||0,dailyTransfer:w.dailyTransferProfit||0,monthlyWithdraw:w.monthlyWithdrawProfit||0,monthlyTransfer:w.monthlyTransferProfit||0,lastUpdated:new Date})}catch(w){console.error("Error loading total profits:",w)}};return t.jsxs(t.Fragment,{children:[t.jsx(A,{size:"sm",variant:"ghost",onClick:G,className:"h-2 w-2 p-0 bg-gradient-to-r from-blue-100 to-purple-200 text-purple-700 hover:from-blue-200 hover:to-purple-300 hover:text-purple-800 rounded transition-all duration-300 hover:scale-110 shadow-sm hover:shadow-md",title:"عرض إجمالي الأرباح",children:t.jsx(Ct,{className:"h-1.5 w-1.5"})}),t.jsx(Oe,{open:x,onOpenChange:b,children:t.jsxs(Re,{className:"max-w-[240px] mx-auto bg-white dark:bg-[#0f172a] border border-gray-200 dark:border-slate-800 shadow-md rounded sm:max-w-[220px] sm:bg-gradient-to-br sm:from-purple-50 sm:to-white sm:dark:from-slate-900 sm:dark:to-slate-800 sm:border-2 sm:border-purple-200 sm:dark:border-slate-700 sm:shadow-2xl sm:rounded-2xl",children:[t.jsx(Pe,{className:"text-center pb-0 border-b-0 sm:pb-2 sm:border-b sm:border-purple-200 dark:border-slate-700",children:t.jsxs(Ee,{className:"text-xs font-bold text-purple-800 dark:text-purple-300 flex items-center justify-center gap-1 mb-0 leading-tight tracking-tight sm:text-xs sm:gap-1 sm:mb-0 sm:leading-normal sm:tracking-normal",children:[t.jsx(Vs,{className:"h-2 w-2 text-purple-600 dark:text-purple-400 sm:h-3 sm:w-3"}),"إجمالي الأرباح (فوري)"]})}),t.jsxs("div",{className:"space-y-1 py-1 sm:space-y-2 sm:py-2",children:[t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-1 rounded border border-blue-200 dark:border-blue-900/30 sm:bg-gradient-to-r sm:from-blue-50 sm:to-blue-100 sm:dark:from-blue-900/20 sm:dark:to-blue-900/10 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(pe,{className:"h-2 w-2 text-blue-600 dark:text-blue-400"}),t.jsx("span",{className:"text-[10px] font-semibold text-blue-800 dark:text-blue-300",children:"يومي"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-900 dark:text-blue-100",children:K((B.dailyWithdraw??0)+(B.dailyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 dark:bg-red-900/20 p-0.5 rounded border border-red-200 dark:border-red-900/30",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ye,{className:"h-2 w-2 text-red-600 dark:text-red-400"}),t.jsx("span",{className:"text-[10px] text-red-800 dark:text-red-300",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700 dark:text-red-200",children:K(B.dailyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-green-50 dark:bg-green-900/20 p-0.5 rounded border border-green-200 dark:border-green-900/30",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Rt,{className:"h-2 w-2 text-green-600 dark:text-green-400"}),t.jsx("span",{className:"text-[10px] text-green-800 dark:text-green-300",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-green-700 dark:text-green-200",children:K(B.dailyTransfer)})]})]})]}),t.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-1 rounded border border-purple-200 dark:border-purple-900/30 sm:bg-gradient-to-r sm:from-purple-50 sm:to-purple-100 sm:dark:from-purple-900/20 sm:dark:to-purple-900/10 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Et,{className:"h-2 w-2 text-purple-600 dark:text-purple-400"}),t.jsx("span",{className:"text-[10px] font-semibold text-purple-800 dark:text-purple-300",children:"شهري"})]}),t.jsx("span",{className:"text-[10px] font-bold text-purple-900 dark:text-purple-100",children:K((B.monthlyWithdraw??0)+(B.monthlyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 dark:bg-red-900/20 p-0.5 rounded border border-red-200 dark:border-red-900/30",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ye,{className:"h-2 w-2 text-red-600 dark:text-red-400"}),t.jsx("span",{className:"text-[10px] text-red-800 dark:text-red-300",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700 dark:text-red-200",children:K(B.monthlyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-blue-50 dark:bg-blue-900/20 p-0.5 rounded border border-blue-200 dark:border-blue-900/30",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Rt,{className:"h-2 w-2 text-blue-600 dark:text-blue-400"}),t.jsx("span",{className:"text-[10px] text-blue-800 dark:text-blue-300",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-700 dark:text-blue-200",children:K(B.monthlyTransfer)})]})]})]})]}),!Q&&t.jsx("div",{className:"absolute inset-0 bg-yellow-200/70 backdrop-blur-sm flex items-center justify-center rounded sm:rounded-2xl border border-yellow-300 pointer-events-auto",children:t.jsx(A,{size:"sm",variant:"ghost",onClick:()=>Y(!0),className:"p-2 bg-yellow-300/80 text-yellow-900 hover:bg-yellow-400/90 rounded-full shadow-sm hover:shadow-md transition-all duration-300",title:"إدخال الرقم السري الرئيسي",children:t.jsx(Ct,{className:"h-4 w-4"})})}),t.jsx("div",{className:"flex justify-center pt-1 border-t-0 sm:pt-2 sm:border-t sm:border-purple-200",children:t.jsx(A,{onClick:()=>b(!1),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-1 rounded-xl text-xs sm:bg-gradient-to-r sm:from-purple-600 sm:to-purple-700 sm:hover:from-purple-700 sm:hover:to-purple-800 sm:px-4 sm:py-1 sm:rounded-xl sm:shadow-lg sm:hover:shadow-xl sm:transition-all sm:duration-300",children:"إغلاق"})})]})}),t.jsx(He,{open:se,onOpenChange:Y,onSuccess:ae,description:"لا يمكن الاطلاع على إجمالي الأرباح إلا بإدخال الرقم السري الرئيسي"})]})},Js=D=>t.jsx(Zs,{...D}),La=()=>{var gt,bt,yt,vt,jt,Nt,wt,Tt,At;const D=ps(),{user:a,profile:x,userSubscription:b,userData:se}=Pt(),[Y,Q]=d.useState(!1),q=ce.useMemo(()=>{var n,l,r,s;const e=((n=b==null?void 0:b.subscription)==null?void 0:n.planType)??((l=b==null?void 0:b.subscription)==null?void 0:l.plan)??((r=x==null?void 0:x.subscription)==null?void 0:r.planType)??((s=x==null?void 0:x.subscription)==null?void 0:s.plan)??null;return e===W.ZERO||String(e).toLowerCase()==="zero"},[(gt=b==null?void 0:b.subscription)==null?void 0:gt.planType,(bt=b==null?void 0:b.subscription)==null?void 0:bt.plan,(yt=x==null?void 0:x.subscription)==null?void 0:yt.planType,(vt=x==null?void 0:x.subscription)==null?void 0:vt.plan]),B=ce.useMemo(()=>{var n,l,r,s;const e=((n=b==null?void 0:b.subscription)==null?void 0:n.planType)??((l=b==null?void 0:b.subscription)==null?void 0:l.plan)??((r=x==null?void 0:x.subscription)==null?void 0:r.planType)??((s=x==null?void 0:x.subscription)==null?void 0:s.plan)??null;return e===W.TAHWEELA||String(e).toLowerCase()==="tahweela"},[(jt=b==null?void 0:b.subscription)==null?void 0:jt.planType,(Nt=b==null?void 0:b.subscription)==null?void 0:Nt.plan,(wt=x==null?void 0:x.subscription)==null?void 0:wt.planType,(Tt=x==null?void 0:x.subscription)==null?void 0:Tt.plan]),{shopName:ue}=us(),{isShiftActive:z,shiftUser:K}=hs(),[O,G]=d.useState([]),[ae,ee]=d.useState([]),[w,m]=d.useState(new Set),[T,P]=d.useState(!1),[_,re]=d.useState(null),[he,xe]=d.useState("all"),[V,ne]=d.useState(""),[C,te]=d.useState(""),[I,Z]=d.useState(""),[E,Lt]=d.useState(!1),[It,Le]=d.useState(!1),[_t,qe]=d.useState(!1),[Mt,Ke]=d.useState(!1),[Ze,Je]=d.useState(""),[Wt,Qe]=d.useState("شرح التطبيق"),[Qs,et]=d.useState(null),[ie,Bt]=d.useState(null),[zt,fe]=d.useState(!1);ce.useEffect(()=>{var n;((n=b==null?void 0:b.subscription)==null?void 0:n.planType)===W.TAHWEELA&&(j({title:"غير متاح لاشتراكك",description:"صفحة المعاملات غير متاحة في باقة تحويله. استخدم لوحة المستخدم للتحويل/السحب فقط.",variant:"destructive"}),D("/user/dashboard"))},[(At=b==null?void 0:b.subscription)==null?void 0:At.planType]);const[ea,Ut]=d.useState(!1),[ta,Ft]=d.useState(!1),[sa,aa]=d.useState(!1),[$t,Ie]=d.useState(!1),[Gt,tt]=d.useState(!1),[Vt,st]=d.useState(!1),[Xt,_e]=d.useState(!1),[Ht,Yt]=d.useState(null),[qt,ge]=d.useState(!1),[Kt,at]=d.useState(!1),[rt,be]=d.useState({keepLastCount:30,intervalDays:7,lastResetAt:null});d.useEffect(()=>{(async()=>{if(a!=null&&a.uid)try{const n=await R.getUserData(a.uid),l=(n==null?void 0:n.recentReset)||{},r=Number(l==null?void 0:l.keepLastCount)>0?Number(l.keepLastCount):30,s=Number(l==null?void 0:l.intervalDays)>0?Number(l.intervalDays):7,o=h=>h instanceof Date?h:typeof(h==null?void 0:h.toDate)=="function"?h.toDate():h?new Date(String(h)):null,u=l!=null&&l.lastResetAt?o(l.lastResetAt):null,c=new Date;!u||c.getTime()-u.getTime()>=s*24*60*60*1e3?(await R.updateUserData(a.uid,{recentReset:{keepLastCount:r,intervalDays:s,lastResetAt:c}}),be({keepLastCount:r,intervalDays:s,lastResetAt:c})):be({keepLastCount:r,intervalDays:s,lastResetAt:u})}catch{be({keepLastCount:30,intervalDays:7,lastResetAt:null})}})()},[a==null?void 0:a.uid]),d.useEffect(()=>{if(!(a!=null&&a.uid))return;(async()=>{try{const n=X(M,"users",a.uid),l=await $(n),r=l.exists()?l.data():{},s=r==null?void 0:r.tutorialSeenAt,o=s!=null&&s.toDate?s.toDate():s?new Date(s):null;Bt(o)}catch{}})()},[a==null?void 0:a.uid]),d.useEffect(()=>{(async()=>{try{const n=await $(X(M,"app_guides","latest")),l=n.exists()?n.data():null;if(!l){Je(""),Qe(""),et(null),fe(!1);return}const r=String(l.url||""),s=String(l.title||"شرح التطبيق"),o=l.publishedAt,u=o!=null&&o.toDate?o.toDate():o?new Date(o):new Date;Je(r),Qe(s),et(u),fe(u?!ie||u.getTime()>((ie==null?void 0:ie.getTime())||0):!1)}catch{fe(!1)}})()},[ie]);const Zt=e=>{try{const n=new URL(e);let l="";return n.hostname.includes("youtube.com")?n.pathname==="/watch"?l=n.searchParams.get("v")||"":(n.pathname.startsWith("/embed/")||n.pathname.startsWith("/shorts/"))&&(l=n.pathname.split("/").pop()||""):n.hostname==="youtu.be"&&(l=n.pathname.replace(/^\//,"")),l?`https://www.youtube.com/embed/${l}?autoplay=1&rel=0`:e}catch{return e}},Jt=async()=>{Ke(!0);try{a!=null&&a.uid&&await R.updateUserData(a.uid,{tutorialSeenAt:new Date}),fe(!1)}catch{}},[Qt,ye]=d.useState(!1),[ve,nt]=d.useState(""),[oe,it]=d.useState(""),[je,ot]=d.useState(""),[lt,ct]=d.useState(!1),[dt,Me]=d.useState(0);d.useEffect(()=>{if(!(a!=null&&a.uid)){Me(0);return}(async()=>{try{const n=X(M,"users",a.uid),l=await $(n),r=l.exists()?l.data():{},u=(Array.isArray(r==null?void 0:r.debts)?r.debts:[]).filter(c=>(c==null?void 0:c.status)==="pending"&&(Number(c==null?void 0:c.amount)||0)>0).length;Me(u)}catch{Me(0)}})()},[a==null?void 0:a.uid]),d.useEffect(()=>{es(),ts()},[a]),d.useEffect(()=>{if(!(a!=null&&a.uid))return;(async()=>{try{const n=we(Te(M,"deletedTransactions"),J("userId","==",a.uid)),l=await Ae(n),r=[];l.docs.forEach(s=>{const o=s.data(),u=[o.originalTransactionId,o.transactionId,o.reference,s.id].filter(Boolean).map(c=>String(c));r.push(...u)}),r.length>0&&(m(s=>{const o=new Set(s);return r.forEach(u=>o.add(u)),o}),G(s=>s.filter(o=>{const u=String(o.id||""),c=String(o.transactionId||""),f=String(o.reference||"");return!(r.includes(u)||r.includes(c)||r.includes(f))})));try{R.subscribeDeletedTransactionsLocalSync(a.uid)}catch{}}catch(n){console.warn("deletedTransactions fetch failed:",n)}})()},[a==null?void 0:a.uid]),d.useEffect(()=>{(async()=>{try{if(!(a!=null&&a.uid)){m(new Set);return}const e=we(Te(M,"deletedTransactions"),J("userId","==",a.uid),J("permanent","==",!0)),l=(await Ae(e)).docs.flatMap(r=>{const s=r.data();return[s.originalTransactionId,s.transactionId,s.reference,r.id].filter(Boolean).map(String)});m(new Set(l))}catch{m(new Set)}})()},[a==null?void 0:a.uid]);const{data:We,refetch:ra,isFetching:na}=zs({queryKey:["userTransactions",a==null?void 0:a.uid],queryFn:async()=>{if(!(a!=null&&a.uid))return[];try{const e=we(Te(M,"deletedTransactions"),J("userId","==",a.uid),J("permanent","==",!0)),[n,l,r]=await Promise.all([R.getUserTransactions(a.uid).catch(()=>[]),R.getByUserId(a.uid).catch(()=>[]),Ae(e).then(i=>i.docs.flatMap(g=>{const p=g.data();return[p.originalTransactionId,p.transactionId,p.reference,g.id].filter(Boolean).map(String)})).catch(()=>[])]),s=Array.isArray(n)&&n.length>0?n:Array.isArray(l)?l:[],o=new Set(r),c=(s||[]).map(i=>({...i,createdAt:i.createdAt instanceof Date?i.createdAt:new Date(i.createdAt)})).filter(i=>!((i==null?void 0:i.type)==="report"||((i==null?void 0:i.title)||"").includes("إيصال تسليم وردية"))).filter(i=>{const g=String(i.id||""),p=String(i.transactionId||""),y=String(i.reference||i.transactionReference||"");return!o.has(g)&&(!p||!o.has(p))&&(!y||!o.has(y))}),f=a!=null&&a.uid?R.getLocalReceipts(a.uid):[],h=[...c,...Array.isArray(f)?f:[]],v=i=>{var g;return String((i==null?void 0:i.transactionId)||(i==null?void 0:i.id)||(i==null?void 0:i.reference)||(i==null?void 0:i.transactionReference)||((g=i==null?void 0:i.receipt)==null?void 0:g.reference)||`${new Date((i==null?void 0:i.createdAt)||Date.now()).getTime()}`)},S=new Set;return h.filter(i=>{const g=v(i);return S.has(g)?!1:(S.add(g),!0)}).map(ze)}catch(e){return console.error("Error fetching transactions:",e),[]}},enabled:!!(a!=null&&a.uid),staleTime:5*60*1e3});d.useEffect(()=>{We&&G(We)},[We]);const es=async()=>{try{if(!a)return;const e=we(Te(M,"deletedTransactions"),J("userId","==",a.uid),J("permanent","==",!0)),[n,l,r]=await Promise.all([R.getUserTransactions(a.uid).catch(()=>[]),R.getByUserId(a.uid).catch(()=>[]),Ae(e).then(i=>i.docs.flatMap(g=>{const p=g.data();return[p.originalTransactionId,p.transactionId,p.reference,g.id].filter(Boolean).map(String)})).catch(()=>[])]),s=Array.isArray(n)&&n.length>0?n:Array.isArray(l)?l:[],o=new Set(r),c=(s||[]).map(i=>({...i,createdAt:i.createdAt instanceof Date?i.createdAt:new Date(i.createdAt)})).filter(i=>{const g=String((i==null?void 0:i.type)||(i==null?void 0:i.txnType)||"").toLowerCase(),p=String((i==null?void 0:i.title)||"").trim();return!(g==="sales"||p.includes("إيصال مبيعات")||(i==null?void 0:i.type)==="report"||p.includes("إيصال تسليم وردية"))}).filter(i=>{const g=String(i.id||""),p=String(i.transactionId||""),y=String(i.reference||i.transactionReference||"");return!o.has(g)&&(!p||!o.has(p))&&(!y||!o.has(y))}),f=a!=null&&a.uid?R.getLocalReceipts(a.uid):[],h=[...c,...Array.isArray(f)?f:[]],v=i=>{var g;return String((i==null?void 0:i.transactionId)||(i==null?void 0:i.id)||(i==null?void 0:i.reference)||(i==null?void 0:i.transactionReference)||((g=i==null?void 0:i.receipt)==null?void 0:g.reference)||`${new Date((i==null?void 0:i.createdAt)||Date.now()).getTime()}`)},S=new Set,N=h.filter(i=>{const g=v(i);return S.has(g)?!1:(S.add(g),!0)});G(N.map(ze))}catch(e){console.error("خطأ في تحميل معاملات المستخدم من Firestore:",e),j({title:"فشل جلب معاملات المستخدم",description:"قد تكون المشكلة صلاحيات Firestore أو اتصال الشبكة. سيتم عرض المتاح محليًا إن وُجد. جرّب تسجيل الدخول مجددًا أو افتح صفحة اختبار المصادقة.",variant:"destructive"})}},ts=async()=>{try{if(!a)return;const n=(await de.getDeletedTransactionsByUser(a.uid)).map(l=>({...l,createdAt:l.createdAt instanceof Date?l.createdAt:new Date(l.createdAt)}));ee(n.map(ze))}catch(e){console.error("خطأ في تحميل المعاملات المحذوفة من Firestore:",e),j({title:"فشل جلب المعاملات المحذوفة",description:"تحقق من الصلاحيات والاتصال. يمكن مراجعة صفحة اختبار المصادقة للتشخيص.",variant:"destructive"})}},le=ce.useMemo(()=>{const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1),l=new Date(e.getFullYear(),e.getMonth()+1,1);return[...O].filter(s=>{const o=String(s.title||"").trim();return s.type!=="sales"&&!o.includes("إيصال مبيعات")}).sort((s,o)=>{const u=s.createdAt instanceof Date?s.createdAt.getTime():0;return(o.createdAt instanceof Date?o.createdAt.getTime():0)-u}).filter(s=>s.createdAt>=n&&s.createdAt<l)},[O]),ss=ce.useMemo(()=>{const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1),l=new Date(e.getFullYear(),e.getMonth()+1,1);return Math.max(0,((O==null?void 0:O.length)||0)-(O||[]).filter(r=>r.createdAt>=n&&r.createdAt<l).length)},[O==null?void 0:O.length]),mt=le.filter(e=>{const n=!V||e.senderPhone.includes(V)||e.receiverPhone.includes(V),l=!C||e.createdAt.toDateString()===new Date(C).toDateString(),r=!I||e.createdAt.toTimeString().startsWith(I);return n&&l&&r}),pt=(e,n)=>{switch(e){case"completed":return t.jsx(Ks,{className:`h-4 w-4 ${n==="withdraw"?"text-red-500":"text-green-500"}`});case"pending":return t.jsx(pe,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return t.jsx(qs,{className:"h-4 w-4 text-red-500"});default:return t.jsx(pe,{className:"h-4 w-4 text-gray-500"})}},Be=e=>{switch(e){case"completed":return"مكتمل";case"pending":return"قيد المراجعة";case"cancelled":return"ملغي";default:return"غير معروف"}},ze=e=>{const n=((e==null?void 0:e.status)??"").toString().toLowerCase(),l=n==="confirmed"||n==="success"||n==="completed"?"completed":n==="failed"||n==="error"||n==="cancelled"||n==="canceled"?"cancelled":"pending",r=((e==null?void 0:e.type)??(e==null?void 0:e.txnType)??"").toString().toLowerCase();let s="send";r==="withdraw"?s="withdraw":r==="cash_addition"||r==="add"?s="cash_addition":s="send";const o=(e==null?void 0:e.senderPhone)??(e==null?void 0:e.senderMsisdn)??(e==null?void 0:e.sender_msisdn)??(e==null?void 0:e.sender)??(e==null?void 0:e.from)??"",u=(e==null?void 0:e.receiverPhone)??(e==null?void 0:e.receiverMsisdn)??(e==null?void 0:e.receiver_msisdn)??(e==null?void 0:e.receiver)??(e==null?void 0:e.to)??"",c=e==null?void 0:e.createdAt,f=c instanceof Date?c:c!=null&&c.toDate?c.toDate():new Date(c);return{id:e==null?void 0:e.id,senderPhone:o||"غير معروف",receiverPhone:u||"غير معروف",amount:Number((e==null?void 0:e.amount)??0),status:l,type:s,createdAt:f,provider:(e==null?void 0:e.provider)??void 0,commission:(e==null?void 0:e.commission)??void 0,withdrawnAmount:(e==null?void 0:e.withdrawnAmount)??void 0,sentAmount:(e==null?void 0:e.sentAmount)??void 0,fromWallet:(e==null?void 0:e.fromWallet)??(e==null?void 0:e.walletId)??void 0,cashierName:(e==null?void 0:e.cashierName)??(e==null?void 0:e.createdByName)??(e==null?void 0:e.cashier)??void 0,commissionMode:(e==null?void 0:e.commissionMode)??(e==null?void 0:e.commission_mode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,walletEffectAppliedOnCreation:(e==null?void 0:e.walletEffectAppliedOnCreation)??(e==null?void 0:e.effectsAppliedOnCreation)??(e==null?void 0:e.effectAppliedOnCreation)??!1,cashEffectAppliedOnCreation:(e==null?void 0:e.cashEffectAppliedOnCreation)??!1,fee:(e==null?void 0:e.fee)??void 0,senderName:(e==null?void 0:e.senderName)??(e==null?void 0:e.customerName)??void 0,title:(e==null?void 0:e.title)??void 0,description:(e==null?void 0:e.description)??void 0}},as=e=>{const n=String((e==null?void 0:e.provider)||"").toLowerCase(),l=n.includes("vodafone")?"vf-cash":n.includes("instapay")?"instapay":"",r=String(e.description||""),s=String(e.title||""),o=r.includes("تحويل مكنه")||r.includes("تحويل مكينه")||r.includes("machine transfer")||s.includes("تحويل مكنه")||s.includes("تحويل مكينه"),u=e.type==="send"?"تحويل":"سحب";let c=e.type==="withdraw"&&l?`${u} ${l}`:u;return o?c="تحويل مكينه":e.title&&(c=e.title),{id:e.id,type:o||e.type==="send"?"transfer":"withdraw",sender_msisdn:e.senderPhone,receiver_msisdn:e.receiverPhone,amount:e.amount,commission:e.commission||0,status:e.status==="cancelled"?"failed":e.status,createdAt:e.createdAt.toISOString(),updatedAt:e.createdAt.toISOString(),shopName:ue??(x==null?void 0:x.shopName)??(a==null?void 0:a.displayName)??"المحل",cashierName:(e==null?void 0:e.cashierName)??null,commissionMode:(e==null?void 0:e.commissionMode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,fee:(e==null?void 0:e.fee)??void 0,note:(e==null?void 0:e.note)??(e==null?void 0:e.notes)??void 0,senderName:(e==null?void 0:e.senderName)??void 0,provider:(e==null?void 0:e.provider)??void 0,title:c,description:e.description}},Ue=e=>{const n=as(e);Yt(n),_e(!0)},rs=e=>{re(e),P(!0)},ns=async()=>{_&&(await is(_.id),P(!1),re(null))},is=async e=>{try{const n=ae.find(s=>s.id===e);if(!n||!a)return;const l=await R.saveUserTransaction(a.uid,{...n,userId:a.uid,status:"completed",cashierName:n.cashierName??"الحساب الرئيسي"});await de.permanentlyDeleteTransaction(e,a.uid);const r={...n,id:l};G(s=>[...s,r]),ee(s=>s.filter(o=>o.id!==e)),j({title:"تم الاسترجاع",description:"تم استرجاع الإيصال إلى حسابك."})}catch(n){console.error("خطأ في استرجاع المعاملة من Firestore:",n),j({title:"فشل الاسترجاع",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},os=async e=>{try{if(!a)return;ee(n=>n.filter(l=>l.id!==e)),await de.permanentlyDeleteTransaction(e,a.uid),await R.removeUserTransaction(a.uid,e),j({title:"تم الحذف نهائيًا",description:"الإيصال لن يعود بعد التحديث."})}catch(n){console.error("فشل الحذف النهائي للمعاملة:",n),j({title:"خطأ في الحذف النهائي",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},ut=async e=>{var n,l,r;try{const s=O.find(p=>p.id===e);if(!s||!a)return;try{const p=(n=b==null?void 0:b.subscription)==null?void 0:n.planType;if(p===W.ZERO){const{dailyOperationCountService:y}=await H(async()=>{const{dailyOperationCountService:F}=await import("./dailyOperationCountService-BDMlwDJn.js");return{dailyOperationCountService:F}},__vite__mapDeps([0,1,2]),import.meta.url),k=s.type==="send"?"transfer":"withdraw";if(!(await y.checkAndIncrement(a.uid,k,5)).allowed){j({title:"تم بلوغ حد باقة الزيرو",description:"مسموح بحد أقصى 5 تأكيدات يوميًا للتحويل/السحب. جرّب غدًا أو قم بالترقية.",variant:"destructive"});return}}else if(p===W.TAHWEELA){const{dailyOperationCountService:y}=await H(async()=>{const{dailyOperationCountService:F}=await import("./dailyOperationCountService-BDMlwDJn.js");return{dailyOperationCountService:F}},__vite__mapDeps([0,1,2]),import.meta.url),k=s.type==="send"?"transfer":"withdraw";if(!(await y.checkAndIncrementCombined(a.uid,k,40)).allowed){j({title:"تم بلوغ حد باقة تحويله",description:"هذه الباقة تسمح بحد أقصى 40 عملية تحويل/سحب يومياً.",variant:"destructive"});return}}}catch(p){console.warn("تعذر التحقق من حد التأكيد اليومي:",p)}const o=await Ge.getById(a.uid);if(!(o!=null&&o.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const u=X(M,"dashboardData",o.shopId),c=await $(u);let f=c.exists()?Number(((l=c.data())==null?void 0:l.cashBalance)||0):0;const h=c.exists()?((r=c.data())==null?void 0:r.walletBalances)||{}:{},v=s.fromWallet||Object.keys(h)[0],S=!!(s!=null&&s.limitsReservedOnCreation),N=Number(s.withdrawnAmount??s.sentAmount??s.amount??0),i=s.type==="send"?"transfer":"withdraw";try{const{walletDailyLimitsService:p}=await H(async()=>{const{walletDailyLimitsService:k}=await import("./index-DhbnydJl.js").then(L=>L.cY);return{walletDailyLimitsService:k}},__vite__mapDeps([1,2]),import.meta.url),y=await p.canPerformOperation(v,N,i);if(!S&&!y.canPerform){j({title:"تجاوز الحدود",description:String(y.message||"لا يمكن الإكمال لتجاوز الحد اليومي/الشهري"),variant:"destructive"});return}}catch{j({title:"فشل التحقق من الحدود",description:"حاول مجددًا بعد قليل",variant:"destructive"});return}let g=!1;if(s.type==="withdraw"){const p=s.fromWallet||Object.keys(h)[0],y=Number(s.withdrawnAmount??s.amount??0),k=Number(s.commission??0),L=!!(s!=null&&s.walletEffectAppliedOnCreation),F=!!(s!=null&&s.cashEffectAppliedOnCreation);if(!L&&p&&y>0){const Fe=h[p]||0;h[p]=Fe+y}F?f=Math.round(f+y):f=Math.round(f-y),g=!0,await De(u,{cashBalance:f,walletBalances:h})}else if(s.type==="send"){const p=Number(s.commission??0),y=Number((s==null?void 0:s.fee)??0),k=Number((s==null?void 0:s.sentAmount)??(s==null?void 0:s.transferredAmount)??s.amount??0),L=Math.max(0,k)+Math.max(0,y);L>0&&(f=Math.round(f+L),await De(u,{cashBalance:f}),g=!0)}await De(X(M,"userTransactions",e),{status:"completed",confirmedAt:new Date});try{const p=s.fromWallet||Object.keys(h)[0],y=Number(s.withdrawnAmount??s.sentAmount??s.amount??0);if(p&&y>0&&!S){const{walletDailyLimitsService:k}=await H(async()=>{const{walletDailyLimitsService:L}=await import("./index-DhbnydJl.js").then(F=>F.cY);return{walletDailyLimitsService:L}},__vite__mapDeps([1,2]),import.meta.url);await k.updateUsage(p,y,s.type==="send"?"transfer":"withdraw")}}catch{j({title:"فشل تحديث الحدود",description:"تجاوز حد اليوم/الشهر يمنع الإكمال",variant:"destructive"});return}try{const{ProfitService:p}=await H(async()=>{const{ProfitService:L}=await import("./profitService-QTJQLMA0.js");return{ProfitService:L}},__vite__mapDeps([3,1,2]),import.meta.url),y=p.calculateProfitFromTransaction({type:s.type==="send"?"transfer":"withdraw",amount:Number(s.amount||0),commission:Number(s.commission||0),fee:Number((s==null?void 0:s.fee)||0)});!!!(s!=null&&s.profitAddedOnCreation)&&y>0&&p.addProfit(y,a==null?void 0:a.uid)}catch{}G(p=>p.map(y=>y.id===e?{...y,status:"completed"}:y)),j({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),_e(!1)}catch(s){console.error("خطأ في إكمال المعاملة:",s),j({title:"فشل الإكمال",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},ht=async e=>{var n,l;try{const r=O.find(o=>o.id===e);if(!r||!a)return;G(o=>o.filter(u=>u.id!==e)),ee(o=>[{...r},...o]);let s=r.status;try{let o={};try{const h=await $(X(M,"userTransactions",e));if(o=h.exists()?h.data():{},o!=null&&o.status){const v=String(o.status).toLowerCase();v==="completed"||v==="confirmed"||v==="success"?s="completed":v==="pending"?s="pending":(v==="cancelled"||v==="failed")&&(s="cancelled")}}catch{}const u=e,c=String((o==null?void 0:o.transactionId)||(r==null?void 0:r.transactionId)||u),f=String((o==null?void 0:o.reference)||(o==null?void 0:o.transactionReference)||(r==null?void 0:r.reference)||(r==null?void 0:r.transactionReference)||"");await R.removeUserTransaction(a.uid,e),await de.saveDeletedTransaction({...r,userId:a.uid,originalTransactionId:e,transactionId:c,reference:f||void 0,permanent:!0});try{await de.permanentlyDeleteTransaction(e,a.uid)}catch{}}catch(o){console.warn("تعذر الحذف النهائي من قواعد البيانات في هذه الخطوة، سيتم الحذف من لائحة المحذوفات عند التنفيذ اليدوي للحذف النهائي:",o)}try{const o=await Ge.getById(a.uid);if(!(o!=null&&o.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const u=X(M,"dashboardData",o.shopId),c=await $(u);let f=c.exists()?Number(((n=c.data())==null?void 0:n.cashBalance)||0):0;const h=c.exists()?((l=c.data())==null?void 0:l.walletBalances)||{}:{},v=Number(r.withdrawnAmount??r.amount??0),S=Number(r.commission??0),N=r.fromWallet||Object.keys(h)[0],i=!!(r!=null&&r.walletEffectAppliedOnCreation);if(r.type==="send"){const g=Number(r.fee??0),p=Number((r==null?void 0:r.sentAmount)??(r==null?void 0:r.transferredAmount)??r.amount??0);if(s==="completed"&&(f=Math.round(f-(p+g))),N&&p>0){const y=h[N]||0;h[N]=y+p}}else if(r.type==="withdraw"){if(s==="completed"){if(f=Math.round(f+v),N&&v>0){const g=h[N]||0;h[N]=g-v}}else if(N&&i&&v>0){const g=h[N]||0;h[N]=g-v}}await De(u,{cashBalance:f,walletBalances:h})}catch(o){console.warn("فشل عكس تأثير الأرصدة محليًا:",o)}try{const o=r.fromWallet;if(o){const{walletDailyLimitsService:u}=await H(async()=>{const{walletDailyLimitsService:h}=await import("./index-DhbnydJl.js").then(v=>v.cY);return{walletDailyLimitsService:h}},__vite__mapDeps([1,2]),import.meta.url),c=Number(r.withdrawnAmount??r.sentAmount??r.amount??0),f=r.type==="send"?"transfer":"withdraw";await u.rollbackUsage(o,c,f,r.createdAt)}}catch(o){console.warn("فشل استرجاع حدود المحفظة:",o)}try{const{ProfitService:o}=await H(async()=>{const{ProfitService:v}=await import("./profitService-QTJQLMA0.js");return{ProfitService:v}},__vite__mapDeps([3,1,2]),import.meta.url),{ReportsService:u}=await H(async()=>{const{ReportsService:v}=await import("./index-DhbnydJl.js").then(S=>S.cX);return{ReportsService:v}},__vite__mapDeps([1,2]),import.meta.url),f={txnType:r.type==="send"?"send":"receive",amount:r.amount,commission:r.commission||0,createdAt:r.createdAt,status:"confirmed"},h=o.calculateProfitFromTransaction(f);h>0&&o.addProfit(-h,a.uid);try{u.removeTransactionEffects(r,a.uid)}catch{}}catch(o){console.warn("فشل تحديث التقارير/الأرباح بعد الحذف:",o)}}catch(r){console.error("خطأ أثناء حذف الإيصال:",r)}},xt=d.useRef(!1),ft=xs();d.useEffect(()=>{!(new URLSearchParams(ft.search).get("autoTestBalances")==="1")||xt.current||(xt.current=!0,(async()=>{var l,r,s,o,u,c;try{if(!a)return;const f=await Ge.getById(a.uid);if(!(f!=null&&f.shopId)){console.warn("autoTest: لا يوجد shopId للمستخدم، سيتم إيقاف الاختبار.");return}const h=X(M,"dashboardData",f.shopId),v=await $(h),S=v.exists()?Number(((l=v.data())==null?void 0:l.cashBalance)||0):0,N=v.exists()?((r=v.data())==null?void 0:r.walletBalances)||{}:{},i=Object.keys(N)[0]||void 0,g=100,p=5,y=await R.saveUserTransaction(a.uid,{senderPhone:"auto-test-sender",receiverPhone:"auto-test-receiver",amount:g,status:"pending",type:"withdraw",createdAt:new Date,reference:`AUTO-${Date.now()}`,commission:p,withdrawnAmount:g,fromWallet:i,cashierName:"AutoTest",commissionMode:"add",totalCharged:g+p,walletEffectAppliedOnCreation:!1});console.log("autoTest: تم إنشاء إيصال سحب تجريبي:",y),await ut(y);const k=await $(h),L=k.exists()?Number(((s=k.data())==null?void 0:s.cashBalance)||0):0,F=k.exists()?((o=k.data())==null?void 0:o.walletBalances)||{}:{},Fe=S-g+p,cs=i?Number(N[i]||0)+g:void 0;console.log("autoTest: توقع الدرج بعد الإكمال:",Fe,"فعلي:",L),i&&console.log("autoTest: توقع المحفظة بعد الإكمال:",cs,"فعلي:",F[i]),await ht(y);const Ne=await $(h),ds=Ne.exists()?Number(((u=Ne.data())==null?void 0:u.cashBalance)||0):0,ms=Ne.exists()?((c=Ne.data())==null?void 0:c.walletBalances)||{}:{};console.log("autoTest: تحقق نهائي — الدرج قبل/بعد الحذف:",S,ds),i&&console.log("autoTest: تحقق نهائي — المحفظة قبل/بعد الحذف:",N[i]||0,ms[i]||0),j({title:"اختبار الأرصدة (Firestore فقط)",description:"تم إنشاء/إكمال/حذف إيصال تجريبي والتحقق من الأرصدة.",variant:"default"})}catch(f){console.error("autoTest: فشل اختبار الأرصدة:",f),j({title:"فشل اختبار الأرصدة",description:"تحقق من الاتصال ووجود shopId والمحافظ في Firestore.",variant:"destructive"})}})())},[ft.search,a]);const ls=async()=>{var l,r,s;const e="alkaptin678678@gmail.com",n=(r=(l=Xe.currentUser)==null?void 0:l.email)==null?void 0:r.toLowerCase();if(!n||n!==e){j({title:"قيد الإنشاء",description:"ميزة الشحن متاحة لهذا الحساب فقط حالياً."});return}if(!ve||!oe||!je){j({title:"بيانات ناقصة",description:"يرجى إدخال رقم وشركة والمبلغ",variant:"destructive"});return}ct(!0);try{const u={vodafone_eg:"Vodafone",orange_eg:"Orange",etisalat_eg:"Etisalat",we_eg:"WE"}[oe]??oe,c=new AbortController,f=setTimeout(()=>c.abort(),15e3),h=await((s=Xe.currentUser)==null?void 0:s.getIdToken()),v=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...h?{Authorization:`Bearer ${h}`}:{}},body:JSON.stringify({phone:ve,countryCode:"EG",operator:u,amount:Number(je),useLocalAmount:!0}),signal:c.signal});clearTimeout(f);const S=await v.text();let N;try{N=JSON.parse(S)}catch{N={success:!1,message:S||"فشل قراءة استجابة الخادم"}}v.ok&&(N!=null&&N.success)?(j({title:"تم الشحن",description:(N==null?void 0:N.message)||"تم تنفيذ عملية الشحن بنجاح"}),ye(!1),nt(""),it(""),ot("")):j({title:"فشل الشحن",description:(N==null?void 0:N.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(o){console.error("Topup request error:",o),(o==null?void 0:o.name)==="AbortError"?j({title:"انتهت المهلة",description:"الخادم لم يستجب في الوقت المحدد. تأكد أن السيرفر يعمل.",variant:"destructive"}):j({title:"خطأ في الاتصال",description:"تعذر الاتصال بالخادم. حاول لاحقاً.",variant:"destructive"})}finally{ct(!1)}};return t.jsxs("div",{className:"fixed inset-0 overscroll-y-none overflow-y-auto bg-background p-4",children:[t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs(A,{variant:"ghost",size:"sm",onClick:()=>D("/user/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800",children:[t.jsx(Xs,{className:"h-4 w-4"}),"العودة"]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"المعاملات"})]}),t.jsxs(fs,{className:"card-modern fade-in-up",children:[t.jsxs(gs,{className:"pb-2 px-3 pt-3",children:[t.jsx(bs,{className:"text-sm font-bold",children:"المعاملات الأخيرة"}),t.jsxs("div",{className:"flex items-center gap-0.5 mt-1 relative",children:[t.jsxs("div",{className:"flex items-center gap-0.5 flex-1 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[t.jsx(Ps,{className:"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors"}),t.jsx(Ve,{placeholder:"بحث...",value:V,onChange:e=>ne(e.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400"})]}),t.jsxs("div",{className:"flex items-center gap-1 mx-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 hover:border-purple-300 transition-all duration-200 hover:scale-105",onClick:()=>{const e=(se==null?void 0:se.simSubscription)||(a==null?void 0:a.simSubscription);let n=!1;e!=null&&e.active&&(e!=null&&e.endsAt)&&(e.endsAt.seconds?new Date(e.endsAt.seconds*1e3):new Date(e.endsAt))>new Date&&(n=!0),n?at(!0):Q(!0)},title:"إدارة الخطوط",children:t.jsx(ys,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"hidden md:inline text-[10px] font-bold text-gray-700",children:"خطوط"})]}),t.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:Jt,title:"شرح التطبيق",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(Hs,{className:"h-2.5 w-2.5"}),zt&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-600 rounded-full"})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شرح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 hover:border-purple-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(q||B){j({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"});return}Le(!0)},title:"إدارة التقسيط",children:t.jsx(vs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تقسيط"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Js,{userId:a==null?void 0:a.uid,transactions:O}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"أرباح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:scale-105",onClick:()=>Lt(!0),title:"آلة حاسبة",children:t.jsx(Us,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"حاسبة"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 hover:border-green-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(q){j({title:"الخطة الحالية لا تسمح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية."});return}Ut(!0)},title:"بيانات المبيعات",children:t.jsx(Fs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مبيعات"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(A,{variant:"ghost",size:"sm",className:`h-5 w-5 p-0 rounded border transition-all duration-200 hover:scale-105 ${C||I?"bg-purple-100 text-purple-600 border-purple-300":"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200 hover:border-purple-300"}`,onClick:()=>Ft(!0),title:"اختيار التاريخ",children:[t.jsx(Et,{className:"h-2.5 w-2.5"}),(C||I)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-purple-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تاريخ"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 hover:border-orange-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(q){j({title:"الخطة الحالية لا تسمح",description:"إدارة الديون غير متاحة في خطة زيرو. قم بالترقية."});return}Ie(!0)},title:"إدارة الديون",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(js,{className:"h-2.5 w-2.5"}),dt>0&&t.jsx("div",{className:"absolute -top-1 -right-1 z-10 min-w-[12px] h-[12px] px-[2px] bg-red-600 text-white rounded-full text-[8px] leading-[12px] flex items-center justify-center pointer-events-none ring-1 ring-white",children:dt})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"ديون"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(q){j({title:"الخطة الحالية لا تسمح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية."});return}st(!0)},title:"الصيانة",children:t.jsx(Ns,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"صيانه"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-violet-50 text-violet-600 hover:bg-violet-100 border border-violet-200 hover:border-violet-300 transition-all duration-200 hover:scale-105",onClick:()=>{D("/user/dashboard",{state:{openCashierShiftModal:!0}})},title:"يومية المكنة",children:t.jsx(Ys,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"المكنة"})]}),t.jsxs("div",{className:"hidden sm:flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(q){j({title:"الخطة الحالية لا تسمح",description:"الفيز الائتمانية غير متاحة في خطة زيرو. قم بالترقية."});return}tt(!0)},title:"الفيز الائتمانية",children:t.jsx(ws,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"فيز"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105 relative",onClick:()=>{ge(!0)},title:"تصفير المعاملات الأخيرة",children:[t.jsx(St,{className:"h-2.5 w-2.5"}),ss>0&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تصفير"})]}),(V||C||I)&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:()=>{ne(""),te(""),Z("")},title:"مسح",children:t.jsx("span",{className:"text-[10px] font-bold",children:"×"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مسح"})]})]})]})]}),t.jsx(Ts,{className:"px-3 pb-3",children:t.jsxs(Es,{value:he,onValueChange:xe,className:"w-full",children:[t.jsxs(Ls,{className:"hidden sm:grid w-full grid-cols-4 h-10 text-sm bg-gradient-to-r from-gray-50 via-blue-50/30 to-purple-50/30 border border-gray-200/60 rounded-md p-1 shadow-sm relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 opacity-0 hover:opacity-100 transition-all duration-200"}),t.jsxs(Se,{value:"all",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-blue-200/50 hover:bg-blue-50/80 hover:text-blue-700 group",children:[t.jsx("span",{className:"relative z-10",children:"الكل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(Se,{value:"send",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-green-200/50 hover:bg-green-50/80 hover:text-green-700 group",children:[t.jsx("span",{className:"relative z-10",children:"مرسل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(Se,{value:"withdraw",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-orange-200/50 hover:bg-orange-50/80 hover:text-orange-700 group",children:[t.jsx("span",{className:"relative z-10",children:"سحب"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-orange-500/10 to-amber-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(Se,{value:"deleted",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-rose-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-red-200/50 hover:bg-red-50/80 hover:text-red-700 group",children:[t.jsx("span",{className:"relative z-10",children:"محذوف"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-500/10 to-rose-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]})]}),t.jsx(ke,{value:"all",className:"mt-2 receipts-list",children:mt.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:mt.map((e,n)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>Ue(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[pt(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:`font-medium text-sm ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[U(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-red-600",children:["عمولة: ",U(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:`text-[10px] ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:`text-sm ${e.type==="withdraw"?"text-red-500":"text-green-600"}`,children:e.createdAt.toLocaleString("en-GB")})]})]}),t.jsxs("div",{className:"text-right",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-green-700",children:[U(e.amount)," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",U(e.withdrawnAmount)," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",U(e.sentAmount)," جنيه"]}),t.jsx(As,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?e.type==="withdraw"?"bg-red-100 text-red-800 border-red-300":e.type==="send"?"bg-green-100 text-green-800 border-green-300":"":e.type==="withdraw"?"bg-red-100 text-red-800":""}`,children:e.type==="withdraw"?"سحب":Be(e.status)})]})]},e.id))})}),t.jsx(ke,{value:"send",className:"mt-2 receipts-list",children:le.filter(e=>e.type==="send").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات إرسال محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:le.filter(e=>e.type==="send").map((e,n)=>t.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-card border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>Ue(e),children:[t.jsx("div",{className:"h-12 w-12 rounded-full flex items-center justify-center shrink-0 bg-green-50",children:t.jsx($s,{className:"h-6 w-6 text-green-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h4",{className:"text-base font-bold text-foreground truncate",children:e.receiverPhone}),t.jsxs("span",{className:"text-base font-bold text-green-600 whitespace-nowrap",children:["- ",U(e.amount)," ج.م"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["إلى: ",e.receiverPhone]}),t.jsx("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:e.createdAt.toLocaleString("ar-EG",{day:"numeric",month:"short",hour:"numeric",minute:"numeric",hour12:!0})})]}),t.jsxs("div",{className:`px-2.5 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${e.status==="completed"?"bg-green-50 text-green-700":e.status==="pending"?"bg-yellow-50 text-yellow-700":"bg-red-50 text-red-700"}`,children:[e.status==="completed"&&t.jsx(kt,{className:"h-3 w-3"}),e.status==="pending"&&t.jsx(pe,{className:"h-3 w-3"}),e.status==="failed"&&t.jsx(Ot,{className:"h-3 w-3"}),t.jsx("span",{children:Be(e.status)})]})]})]})]},e.id))})}),t.jsx(ke,{value:"withdraw",className:"mt-2 receipts-list",children:le.filter(e=>e.type==="withdraw").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات سحب محفوظة بعد"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:le.filter(e=>e.type==="withdraw").map((e,n)=>t.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-card border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>Ue(e),children:[t.jsx("div",{className:"h-12 w-12 rounded-full flex items-center justify-center shrink-0 bg-red-50",children:t.jsx(Ye,{className:"h-6 w-6 text-red-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h4",{className:"text-base font-bold text-foreground truncate",children:e.receiverPhone}),t.jsxs("span",{className:"text-base font-bold text-red-600 whitespace-nowrap",children:["+ ",U(e.amount)," ج.م"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["من: ",e.senderPhone]}),t.jsx("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:e.createdAt.toLocaleString("ar-EG",{day:"numeric",month:"short",hour:"numeric",minute:"numeric",hour12:!0})})]}),t.jsxs("div",{className:`px-2.5 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${e.status==="completed"?"bg-red-50 text-red-700":e.status==="pending"?"bg-yellow-50 text-yellow-700":"bg-red-50 text-red-700"}`,children:[e.status==="completed"&&t.jsx(kt,{className:"h-3 w-3"}),e.status==="pending"&&t.jsx(pe,{className:"h-3 w-3"}),e.status==="failed"&&t.jsx(Ot,{className:"h-3 w-3"}),t.jsx("span",{children:Be(e.status)})]})]})]})]},e.id))})}),t.jsx(ke,{value:"deleted",className:"mt-2",children:ae.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محذوفة"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ae.map((e,n)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[pt(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[U(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-500",children:["عمولة: ",U(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"text-right mr-2",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[U(e.amount)," جنيه"]}),t.jsx(StatusChip,{variant:"error",text:"محذوف"})]}),t.jsx(A,{variant:"ghost",size:"sm",className:"text-green-600 hover:bg-green-100 h-10 sm:h-12 px-4 sm:px-5 min-w-[44px] touch-manipulation",onClick:()=>rs(e),children:t.jsx("span",{className:"text-xs sm:text-sm",children:"استرجاع"})}),t.jsx(A,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 h-10 sm:h-12 px-3 sm:px-4 min-w-[44px] touch-manipulation",onClick:()=>os(e.id),children:t.jsx(St,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})]},e.id))})})]})})]}),t.jsx(Oe,{open:Mt,onOpenChange:Ke,children:t.jsxs(Re,{className:"dialog-modern max-w-3xl w-full p-0 overflow-hidden border-0 shadow-2xl",children:[t.jsx(Pe,{className:"px-4 pt-4",children:t.jsx(Ee,{className:"text-lg font-bold",children:Wt||"شرح التطبيق"})}),t.jsx("div",{className:"aspect-video w-full bg-black",children:Ze?t.jsx("iframe",{src:Zt(Ze),title:"Application Guide",className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0}):t.jsx("div",{className:"flex items-center justify-center h-full text-white/80",children:"لا يوجد فيديو متاح حالياً"})})]})}),t.jsx(Ws,{open:Vt,onOpenChange:st})]}),t.jsx(Ms,{isOpen:Gt,onClose:()=>tt(!1)}),t.jsx(He,{open:$t,onOpenChange:Ie,mode:"verify",title:"الرقم السري الرئيسي لفتح الديون",description:"أدخل الرقم السري الرئيسي لفتح صفحة الديون",userId:a==null?void 0:a.uid,userRole:x==null?void 0:x.role,onSuccess:()=>{Ie(!1),D("/user",{state:{openDebtDialog:!0}})}}),t.jsx(Ds,{open:qt,onOpenChange:ge,title:"تأكيد كلمة المرور لإخفاء المعاملات السابقة من العرض",description:"سيتم إخفاء كل المعاملات السابقة من شاشة المعاملات والتقارير فقط، ولن تُحذف نهائيًا من حسابك أو من Firebase.",onSuccess:async()=>{try{if(!(a!=null&&a.uid)){ge(!1);return}const e=new Date,n=l=>l instanceof Date?l:typeof(l==null?void 0:l.toDate)=="function"?l.toDate():new Date(String(l));await R.updateUserData(a.uid,{recentReset:{keepLastCount:rt.keepLastCount??30,intervalDays:rt.intervalDays??7,lastResetAt:e}}),be(l=>({...l,lastResetAt:e})),j({title:"تم إخفاء المعاملات السابقة",description:"تم إخفاء كل الإيصالات الأقدم من وقت التصفير من العرض بدون التأثير على التقارير اليومية/الشهرية أو الحدود."})}catch(e){console.error("فشل تنفيذ التصفير النهائي:",e),j({title:"فشل التصفير",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}finally{ge(!1)}}}),t.jsx(Oe,{open:Qt,onOpenChange:e=>{var n,l;if(e){const r="alkaptin678678@gmail.com",s=(l=(n=Xe.currentUser)==null?void 0:n.email)==null?void 0:l.toLowerCase();if(!s||s!==r){j({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."});return}ye(!0)}else ye(!1)},children:t.jsxs(Re,{dir:"rtl",className:"sm:max-w-md",children:[t.jsx(Pe,{children:t.jsx(Ee,{children:"شحن رصيد الموبايل"})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"رقم الموبايل"}),t.jsx(Ve,{value:ve,onChange:e=>nt(e.target.value),placeholder:"01XXXXXXXXX",dir:"ltr"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"الشركة"}),t.jsxs(Ss,{value:oe,onValueChange:it,children:[t.jsx(ks,{className:"w-full",children:t.jsx(Os,{placeholder:"اختر الشركة"})}),t.jsxs(Rs,{children:[t.jsx(Ce,{value:"vodafone_eg",children:"فودافون"}),t.jsx(Ce,{value:"orange_eg",children:"أورنج"}),t.jsx(Ce,{value:"etisalat_eg",children:"اتصالات"}),t.jsx(Ce,{value:"we_eg",children:"WE"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"المبلغ بالجنيه"}),t.jsx(Ve,{type:"number",min:1,value:je,onChange:e=>ot(e.target.value?Number(e.target.value):""),placeholder:"50"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-2",children:[t.jsx(A,{variant:"outline",onClick:()=>ye(!1),children:"إلغاء"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(A,{variant:"secondary",onClick:()=>D("/topup"),children:"صفحة الشحن الكاملة"}),t.jsx(A,{onClick:ls,disabled:lt||!ve||!oe||!je,children:lt?"جارٍ التنفيذ...":"تأكيد الشحن"})]})]})]})]})}),t.jsx(Oe,{open:T,onOpenChange:P,children:t.jsxs(Re,{className:"sm:max-w-[460px]",children:[t.jsxs(Pe,{children:[t.jsx(Ee,{children:"تأكيد استرجاع الإيصال"}),t.jsx(Cs,{children:"سيتم إعادة الإيصال إلى قائمة المعاملات الحالية."})]}),_&&t.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"المبلغ"}),t.jsxs("span",{className:"font-bold",children:[_.amount," جنيه"]})]}),_.type==="withdraw"?t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"العميل"}),t.jsx("span",{className:"font-medium",children:_.receiverPhone})]}):t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"من → إلى"}),t.jsxs("span",{className:"font-medium",children:[_.senderPhone," → ",_.receiverPhone]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"الكاشير"}),t.jsx("span",{className:"font-medium",children:_.cashierName??"الحساب الرئيسي"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"التاريخ"}),t.jsx("span",{className:"font-medium",children:_.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3",children:[t.jsx(A,{variant:"outline",onClick:()=>{P(!1),re(null)},children:"إلغاء"}),t.jsx(A,{onClick:ns,children:"تأكيد الاسترجاع"})]})]})}),t.jsx(Is,{isOpen:Xt,onClose:()=>_e(!1),transaction:Ht,onPrint:()=>window.print(),onDelete:ht,onComplete:ut}),t.jsx(He,{open:It,onOpenChange:Le,mode:"verify",title:"فتح إدارة التقسيط",description:"أدخل الرقم السري الرئيسي للوصول إلى إدارة التقسيط",userId:a==null?void 0:a.uid,userRole:x==null?void 0:x.role,onSuccess:()=>{Le(!1),qe(!0)}}),t.jsx(_s,{open:_t,onOpenChange:qe}),t.jsx(Bs,{isOpen:Kt,onClose:()=>at(!1),shopId:x==null?void 0:x.shopId}),t.jsx(Gs,{isOpen:Y,onClose:()=>Q(!1),userId:(a==null?void 0:a.uid)||"",userEmail:(a==null?void 0:a.email)||""})]})};export{La as default};
//# sourceMappingURL=TransactionsPage-C1gBXxdf.js.map
