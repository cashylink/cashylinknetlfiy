import{$ as Me,r as o,j as e,bb as Oe,aq as Fe,bG as ee,a9 as te,u as ie,m as ce,af as le,ag as de,ah as ue,ai as fe,aH as Te,y as z,I as X,B as _,J as Y,K as J,aQ as Ve,aF as $e,b$ as Ge,c0 as Ke,c1 as Be,a as He,aL as We,c2 as qe,c3 as ze,aD as Xe,X as Ye,aW as Je}from"./index-B_gBGKq7.js";import{D as Qe,a as Ze,b as et,c as tt,d as ae,e as Q}from"./dropdown-menu-B2RzPa5I.js";import{L as st,g as rt}from"./switch-CVb20kPa.js";import{FreeTrialService as nt}from"./freeTrialService-C6i8U9PG.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]],ot=Me("cloud-download",at);function it(n,t=[]){let s=[];function l(i,m){const d=o.createContext(m);d.displayName=i+"Context";const p=s.length;s=[...s,m];const u=y=>{var j;const{scope:I,children:O,...P}=y,R=((j=I==null?void 0:I[n])==null?void 0:j[p])||d,U=o.useMemo(()=>P,Object.values(P));return e.jsx(R.Provider,{value:U,children:O})};u.displayName=i+"Provider";function L(y,I){var R;const O=((R=I==null?void 0:I[n])==null?void 0:R[p])||d,P=o.useContext(O);if(P)return P;if(m!==void 0)return m;throw new Error(`\`${y}\` must be used within \`${i}\``)}return[u,L]}const c=()=>{const i=s.map(m=>o.createContext(m));return function(d){const p=(d==null?void 0:d[n])||i;return o.useMemo(()=>({[`__scope${n}`]:{...d,[n]:p}}),[d,p])}};return c.scopeName=n,[l,ct(c,...t)]}function ct(...n){const t=n[0];if(n.length===1)return t;const s=()=>{const l=n.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(i){const m=l.reduce((d,{useScope:p,scopeName:u})=>{const y=p(i)[`__scope${u}`];return{...d,...y}},{});return o.useMemo(()=>({[`__scope${t.scopeName}`]:m}),[m])}};return s.scopeName=t.scopeName,s}var lt=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],se=lt.reduce((n,t)=>{const s=Oe(`Primitive.${t}`),l=o.forwardRef((c,i)=>{const{asChild:m,...d}=c,p=m?s:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(p,{...d,ref:i})});return l.displayName=`Primitive.${t}`,{...n,[t]:l}},{}),me={exports:{}},he={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $=o;function dt(n,t){return n===t&&(n!==0||1/n===1/t)||n!==n&&t!==t}var ut=typeof Object.is=="function"?Object.is:dt,ft=$.useState,mt=$.useEffect,ht=$.useLayoutEffect,pt=$.useDebugValue;function wt(n,t){var s=t(),l=ft({inst:{value:s,getSnapshot:t}}),c=l[0].inst,i=l[1];return ht(function(){c.value=s,c.getSnapshot=t,Z(c)&&i({inst:c})},[n,s,t]),mt(function(){return Z(c)&&i({inst:c}),n(function(){Z(c)&&i({inst:c})})},[n]),pt(s),s}function Z(n){var t=n.getSnapshot;n=n.value;try{var s=t();return!ut(n,s)}catch{return!0}}function gt(n,t){return t()}var xt=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?gt:wt;he.useSyncExternalStore=$.useSyncExternalStore!==void 0?$.useSyncExternalStore:xt;me.exports=he;var vt=me.exports;function St(){return vt.useSyncExternalStore(jt,()=>!0,()=>!1)}function jt(){return()=>{}}var re="Avatar",[bt]=it(re),[Nt,pe]=bt(re),we=o.forwardRef((n,t)=>{const{__scopeAvatar:s,...l}=n,[c,i]=o.useState("idle");return e.jsx(Nt,{scope:s,imageLoadingStatus:c,onImageLoadingStatusChange:i,children:e.jsx(se.span,{...l,ref:t})})});we.displayName=re;var ge="AvatarImage",xe=o.forwardRef((n,t)=>{const{__scopeAvatar:s,src:l,onLoadingStatusChange:c=()=>{},...i}=n,m=pe(ge,s),d=yt(l,i),p=Fe(u=>{c(u),m.onImageLoadingStatusChange(u)});return ee(()=>{d!=="idle"&&p(d)},[d,p]),d==="loaded"?e.jsx(se.img,{...i,ref:t,src:l}):null});xe.displayName=ge;var ve="AvatarFallback",Se=o.forwardRef((n,t)=>{const{__scopeAvatar:s,delayMs:l,...c}=n,i=pe(ve,s),[m,d]=o.useState(l===void 0);return o.useEffect(()=>{if(l!==void 0){const p=window.setTimeout(()=>d(!0),l);return()=>window.clearTimeout(p)}},[l]),m&&i.imageLoadingStatus!=="loaded"?e.jsx(se.span,{...c,ref:t}):null});Se.displayName=ve;function oe(n,t){return n?t?(n.src!==t&&(n.src=t),n.complete&&n.naturalWidth>0?"loaded":"loading"):"error":"idle"}function yt(n,{referrerPolicy:t,crossOrigin:s}){const l=St(),c=o.useRef(null),i=l?(c.current||(c.current=new window.Image),c.current):null,[m,d]=o.useState(()=>oe(i,n));return ee(()=>{d(oe(i,n))},[i,n]),ee(()=>{const p=y=>()=>{d(y)};if(!i)return;const u=p("loaded"),L=p("error");return i.addEventListener("load",u),i.addEventListener("error",L),t&&(i.referrerPolicy=t),typeof s=="string"&&(i.crossOrigin=s),()=>{i.removeEventListener("load",u),i.removeEventListener("error",L)}},[i,s,t]),m}var je=we,be=xe,Ne=Se;const ye=o.forwardRef(({className:n,...t},s)=>e.jsx(je,{ref:s,className:te("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",n),...t}));ye.displayName=je.displayName;const Pe=o.forwardRef(({className:n,...t},s)=>e.jsx(be,{ref:s,className:te("aspect-square h-full w-full",n),...t}));Pe.displayName=be.displayName;const ke=o.forwardRef(({className:n,...t},s)=>e.jsx(Ne,{ref:s,className:te("flex h-full w-full items-center justify-center rounded-full bg-muted",n),...t}));ke.displayName=Ne.displayName;function Pt({open:n,onOpenChange:t}){const{user:s,profile:l}=ie(),{toast:c}=ce(),[i,m]=o.useState(!1),[d,p]=o.useState(!1),[u,L]=o.useState(!1),[y,I]=o.useState(!1),[O,P]=o.useState(!1),[R,U]=o.useState(!1),[j,f]=o.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[g,b]=o.useState({currentPassword:"",newPassword:"",confirmPassword:""}),E=()=>{const h={currentPassword:"",newPassword:"",confirmPassword:""};return j.currentPassword||(h.currentPassword="كلمة المرور الحالية مطلوبة"),j.newPassword?j.newPassword.length<6&&(h.newPassword="كلمة المرور يجب أن تكون 6 أحرف على الأقل"):h.newPassword="كلمة المرور الجديدة مطلوبة",j.confirmPassword?j.newPassword!==j.confirmPassword&&(h.confirmPassword="كلمات المرور غير متطابقة"):h.confirmPassword="تأكيد كلمة المرور مطلوب",b(h),!Object.values(h).some(v=>v!=="")},H=async h=>{if(h.preventDefault(),!(!E()||!s||!s.email)){m(!0);try{const v=Ge.credential(s.email,j.currentPassword);await Ke(s,v),U(!0),P(!0),c({title:"تأكيد الهوية",description:"أدخل الرقم السري الرئيسي لتأكيد تغيير كلمة المرور"})}catch(v){console.error("خطأ في تغيير كلمة المرور:",v);let N="حدث خطأ أثناء تغيير كلمة المرور";if(v.code==="auth/wrong-password"){b(T=>({...T,currentPassword:"كلمة المرور الحالية غير صحيحة"}));return}else if(v.code==="auth/weak-password"){b(T=>({...T,newPassword:"كلمة المرور ضعيفة جداً"}));return}else v.code==="auth/requires-recent-login"&&(N="يجب تسجيل الدخول مرة أخرى لتغيير كلمة المرور");c({title:"خطأ في تغيير كلمة المرور",description:N,variant:"destructive"})}finally{m(!1)}}},A=async()=>{if(s){m(!0);try{await Be(s,j.newPassword),c({title:"تم تغيير كلمة المرور بنجاح",description:"تم تحديث كلمة المرور الخاصة بك بنجاح"}),f({currentPassword:"",newPassword:"",confirmPassword:""}),b({currentPassword:"",newPassword:"",confirmPassword:""}),P(!1),U(!1),t(!1)}catch(h){console.error("خطأ في تحديث كلمة المرور:",h);let v="حدث خطأ أثناء تغيير كلمة المرور";h.code==="auth/requires-recent-login"&&(v="انتهت جلسة المصادقة. يرجى إعادة إدخال كلمة المرور الحالية"),c({title:"خطأ في تغيير كلمة المرور",description:v,variant:"destructive"})}finally{m(!1)}}},x=h=>v=>{f(N=>({...N,[h]:v.target.value})),g[h]&&b(N=>({...N,[h]:""}))},F=()=>{f({currentPassword:"",newPassword:"",confirmPassword:""}),b({currentPassword:"",newPassword:"",confirmPassword:""}),P(!1),U(!1),t(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(le,{open:n,onOpenChange:F,children:e.jsxs(de,{className:"sm:max-w-[425px]",children:[e.jsxs(ue,{children:[e.jsx(fe,{children:"تغيير كلمة المرور"}),e.jsx(Te,{children:"أدخل كلمة المرور الحالية وكلمة المرور الجديدة لتحديث حسابك"})]}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"currentPassword",children:"كلمة المرور الحالية"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{id:"currentPassword",type:d?"text":"password",value:j.currentPassword,onChange:x("currentPassword"),className:g.currentPassword?"border-red-500":"",autoComplete:"off",disabled:i}),e.jsx(_,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>p(!d),disabled:i,children:d?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"})})]}),g.currentPassword&&e.jsx("p",{className:"text-sm text-red-500",children:g.currentPassword})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"newPassword",children:"كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{id:"newPassword",type:u?"text":"password",value:j.newPassword,onChange:x("newPassword"),className:g.newPassword?"border-red-500":"",autoComplete:"new-password",disabled:i}),e.jsx(_,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>L(!u),disabled:i,children:u?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"})})]}),g.newPassword&&e.jsx("p",{className:"text-sm text-red-500",children:g.newPassword})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"confirmPassword",children:"تأكيد كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{id:"confirmPassword",type:y?"text":"password",value:j.confirmPassword,onChange:x("confirmPassword"),className:g.confirmPassword?"border-red-500":"",autoComplete:"new-password",disabled:i}),e.jsx(_,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>I(!y),disabled:i,children:y?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"})})]}),g.confirmPassword&&e.jsx("p",{className:"text-sm text-red-500",children:g.confirmPassword})]}),e.jsxs(Ve,{children:[e.jsx(_,{type:"button",variant:"outline",onClick:F,disabled:i,children:"إلغاء"}),e.jsxs(_,{type:"submit",disabled:i,children:[i&&e.jsx(st,{className:"mr-2 h-4 w-4 animate-spin"}),"تغيير كلمة المرور"]})]})]})]})}),e.jsx($e,{open:O&&R,onOpenChange:h=>{P(h),h||U(!1)},mode:"verify",title:"التحقق من الرقم السري الرئيسي",description:"لا يمكن تغيير كلمة المرور إلا بعد التحقق من الرقم السري الرئيسي",userId:s==null?void 0:s.uid,userRole:l==null?void 0:l.role,onSuccess:A,onCancel:()=>{P(!1),U(!1)}})]})}const kt="cashy.google.accessToken",Ct="cashy.google.email",Et="cashy.google.expiresAt";function It(){try{const n=localStorage.getItem(kt),t=localStorage.getItem(Ct),s=localStorage.getItem(Et),l=s?Number(s):null;return{token:n,email:t,expiresAt:l}}catch{return{token:null,email:null,expiresAt:null}}}async function _t(n,t,s){try{const l=await fetch("/user/google-backup-token",{method:"POST",headers:{"Content-Type":"application/json","X-USER-ID":n},body:JSON.stringify({email:t,refresh_token:s})}),c=await l.json().catch(()=>({}));return!!(l.ok&&(c!=null&&c.ok))}catch{return!1}}function Ot({className:n}){const{user:t,profile:s,signOut:l,updateUserProfile:c}=ie(),i=He(),[m,d]=o.useState(!1),{isShiftActive:p}=We(),{toast:u}=ce(),[L,y]=o.useState(!1),[I,O]=o.useState(!1),[P,R]=o.useState(!1),[{token:U},j]=o.useState(()=>It()),f=typeof window<"u"?window.electronAPI:void 0,g=!!f,[b,E]=o.useState(!1),[H,A]=o.useState(!1),[x,F]=o.useState(""),[h,v]=o.useState(""),[N,T]=o.useState(!1),[M,W]=o.useState(0),[q,G]=o.useState(!1),[Ce,Ee]=o.useState(""),[k,Ie]=o.useState(""),[At,Dt]=o.useState(!1),[K,_e]=o.useState(0),[Ae,De]=o.useState(!1);o.useEffect(()=>{(async()=>{if(!(t!=null&&t.uid))return;const a=await nt.checkTrialValidity(t.uid);De(a.isValid&&!a.isExpired),_e(a.hoursRemaining)})()},[t==null?void 0:t.uid]);const D=(r,a)=>{const w=String(r||"").split(".").map(S=>parseInt(S,10)||0),C=String(a||"").split(".").map(S=>parseInt(S,10)||0);for(let S=0;S<Math.max(w.length,C.length);S++){const V=w[S]||0,B=C[S]||0;if(V>B)return 1;if(V<B)return-1}return 0};o.useEffect(()=>{if(!(!g||!f))try{f.onUpdateAvailable(r=>{var w,C,S;const a=String(((w=r==null?void 0:r.info)==null?void 0:w.version)||"");F(a),v(String(((C=r==null?void 0:r.info)==null?void 0:C.notes)||"")),T(!!((S=r==null?void 0:r.info)!=null&&S.force)),D(a,k)>0?E(!0):E(!1)}),f.onUpdateDownloaded(r=>{var w,C;const a=String(((w=r==null?void 0:r.info)==null?void 0:w.version)||"");F(a),v(String(((C=r==null?void 0:r.info)==null?void 0:C.notes)||"")),G(!1),W(100),D(a,k)>0?E(!0):E(!1);try{g&&(t!=null&&t.uid)&&a&&(c==null||c({lastAckDesktopVersion:a}))}catch{}}),f.onUpdateError(r=>{try{u({title:"فشل التحديث",description:String((r==null?void 0:r.message)||(r==null?void 0:r.code)||"تعذر التحميل"),variant:"destructive"})}catch{}}),typeof f.onUpdateProgress=="function"&&f.onUpdateProgress(r=>{const a=(r==null?void 0:r.percent)==null?0:Number(r.percent);G(!0),W(Math.max(0,Math.min(100,isNaN(a)?0:a)))}),typeof f.appVersion=="function"&&f.appVersion().then(r=>{typeof r=="string"&&Ie(r);try{g&&(t!=null&&t.uid)&&typeof r=="string"&&r&&(c==null||c({desktopInstalledVersion:r}))}catch{}}).catch(()=>{})}catch{}},[g,f]),o.useEffect(()=>{g&&M>=100&&A(!0)},[g,M]),o.useEffect(()=>{const r=qe(a=>{const w=String((a==null?void 0:a.version)||""),S=`desktop_update_seen_${String((t==null?void 0:t.uid)||"anon")}`;let V="";try{V=localStorage.getItem(S)||""}catch{}if(w&&w!==x){if(D(w,k)>0)if(E(!0),V===w&&!(a!=null&&a.force))A(!1);else{A(!0);try{localStorage.setItem(S,w)}catch{}}else E(!1);F(w),v(String((a==null?void 0:a.notes)||"")),T((a==null?void 0:a.force)||!1);const B=ze({downloadURL_64:a==null?void 0:a.downloadURL_64,downloadURL_32:a==null?void 0:a.downloadURL_32})||"";Ee(B)}});return()=>{try{r()}catch{}}},[x,k,t==null?void 0:t.uid]);const Le=async()=>{var r;try{if(f){try{await f.checkUpdate()}catch{}A(!0),G(!0),W(0);const a=await((r=f.downloadUpdate)==null?void 0:r.call(f,Ce))??await f.downloadUpdate();if(typeof a=="string"&&a.startsWith("err:")){try{u({title:"فشل التحديث",description:a.slice(4),variant:"destructive"})}catch{}G(!1)}else if(a==="noop")try{u({title:"لا يوجد تحديث",description:"لا تتوفر نسخة أحدث حالياً."})}catch{}else if(a==="manual")try{u({title:"جارٍ تنزيل التحديث",description:"سيتم تطبيق التحديث تلقائيًا بعد اكتمال التنزيل."})}catch{}else if(a==="autoUpdater")try{u({title:"تنزيل تلقائي",description:"سيتم تطبيق التحديث تلقائياً بواسطة النظام."})}catch{}}}catch(a){try{u({title:"فشل التحديث",description:(a==null?void 0:a.message)||"حدث خطأ أثناء التنزيل",variant:"destructive"})}catch{}}},Ue=()=>s!=null&&s.fullName?s==null?void 0:s.fullName.split(" ").map(r=>r.charAt(0)).join("").toUpperCase().slice(0,2):t.email?t.email.charAt(0).toUpperCase():"U",ne=s!=null&&s.avatarId?rt(s.avatarId):null;if(o.useEffect(()=>{console.log("Profile updated in ProfileIcon:",s==null?void 0:s.avatarId)},[s==null?void 0:s.avatarId]),o.useEffect(()=>{const r=async a=>{try{if(!(a!=null&&a.data)||typeof a.data!="object"||a.origin!=="https://cashy.link")return;const{type:w,email:C,refresh_token:S}=a.data||{};w==="cashy_oauth_token"&&(t!=null&&t.uid)&&C&&S&&await _t(t.uid,String(C),String(S))&&u({title:"تم ربط جوجل",description:"تم حفظ توكن النسخ الاحتياطي عبر الخادم."})}catch{}};return window.addEventListener("message",r),()=>window.removeEventListener("message",r)},[t==null?void 0:t.uid]),!t)return null;const Re=async()=>{try{await l()}catch(r){console.error("خطأ في تسجيل الخروج:",r)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[g&&e.jsxs(_,{type:"button",onClick:()=>{A(!0),D(x,k)>0&&E(!0)},title:"تحديث التطبيق",className:"relative inline-flex items-center justify-center w-9 h-9 rounded-md bg-transparent text-blue-600 hover:bg-blue-500/10 focus:outline-none dark:text-blue-400 dark:hover:bg-blue-400/10",variant:"ghost",children:[e.jsx(ot,{className:"w-5 h-5"}),b&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 inline-block w-2 h-2 rounded-full bg-red-500"})]}),e.jsxs(Qe,{children:[e.jsx(Ze,{asChild:!0,children:e.jsx(_,{variant:"ghost",className:`relative h-8 w-8 rounded-full p-0 hover:bg-transparent focus:ring-1 focus:ring-primary focus:ring-offset-1 transition-all duration-200 ${n}`,children:e.jsx(ye,{className:"h-8 w-8 border border-border shadow-sm hover:shadow-md transition-all duration-200 hover:scale-105 bg-white",children:ne?e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-white dark:bg-neutral-900/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"w-full h-full flex items-center justify-center scale-[2.5]",children:ne.component})}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{src:t.photoURL||void 0,alt:(s==null?void 0:s.fullName)||t.email||"المستخدم",className:"object-cover"}),e.jsx(ke,{className:"bg-gradient-to-br from-indigo-500 via-sky-500 to-emerald-400 text-white font-semibold text-sm tracking-wide uppercase border border-white/70 shadow-md",children:Ue()})]})})})}),e.jsxs(et,{className:"w-64",align:"end",forceMount:!0,children:[e.jsx(tt,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:(s==null?void 0:s.fullName)||"المستخدم"}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:t.email}),(s==null?void 0:s.role)&&e.jsxs("p",{className:"text-xs leading-none text-muted-foreground",children:["الدور: ",s.role==="staff"?"مدير":s.role==="merchant"?"تاجر":"مستخدم"]}),Ae&&e.jsx("div",{className:"mt-2 flex items-center justify-center gap-1 bg-emerald-50 border border-emerald-200 text-emerald-800 text-xs rounded-md py-1",children:e.jsxs("span",{className:"font-semibold",children:["تجربة: ",K," ",K>=3&&K<=10?"ساعات":K===2?"ساعتين":"ساعة"]})})]})}),e.jsx(ae,{}),e.jsxs(Q,{onClick:()=>{var r;if(p&&((r=shiftUser==null?void 0:shiftUser.permissions)==null?void 0:r.settings)===!1){u({title:"تم رفض الوصول",description:"ليس لديك صلاحية للوصول إلى هذا القسم. يرجى مراجعة المسؤول.",variant:"destructive"});return}i("/profile-settings")},className:"cursor-pointer",children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"إعدادات البروفيل"})]}),((s==null?void 0:s.role)==="admin"||(s==null?void 0:s.role)==="staff")&&e.jsxs(Q,{onClick:()=>i("/admin"),className:"cursor-pointer",children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"لوحة الإدارة"})]}),e.jsx(ae,{}),e.jsxs(Q,{onClick:Re,className:"cursor-pointer text-red-600 focus:text-red-600",children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"تسجيل الخروج"})]})]})]})]}),g&&e.jsx(le,{open:H,onOpenChange:r=>{if(!(!r&&N&&b&&D(x,k)>0)&&(A(r),!r&&M<100)){const w=`desktop_update_seen_${String((t==null?void 0:t.uid)||"anon")}`;try{x&&localStorage.setItem(w,x)}catch{}E(!1)}},children:e.jsxs(de,{className:"sm:max-w-md",onInteractOutside:r=>{N&&b&&D(x,k)>0&&r.preventDefault()},onEscapeKeyDown:r=>{N&&b&&D(x,k)>0&&r.preventDefault()},children:[e.jsx(ue,{children:e.jsx(fe,{children:N?"تحديث إجباري مطلوب":"يوجد تحديث جديد للبرنامج"})}),e.jsx("div",{className:"text-sm",children:q?"جارٍ تنزيل التحديث...":b&&D(x,k)>0?"هل ترغب في تنزيله الآن؟":"التطبيق مُحدَّث لآخر إصدار"}),x&&e.jsxs("div",{className:"mt-2 text-xs",children:["الإصدار الجديد: ",e.jsxs("span",{className:"font-semibold",children:["v",x]})]}),k&&e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["إصدار التطبيق لديك: ",e.jsxs("span",{className:"font-semibold",children:["v",k]})]}),h&&e.jsx("div",{className:"mt-2 text-xs text-muted-foreground whitespace-pre-line",children:h}),q&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded",children:e.jsx("div",{className:"h-2 bg-blue-600 rounded",style:{width:`${M}%`}})}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[Math.round(M),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3",children:[!N&&e.jsx(_,{variant:"outline",onClick:()=>{const a=`desktop_update_seen_${String((t==null?void 0:t.uid)||"anon")}`;try{x&&localStorage.setItem(a,x)}catch{}E(!1),A(!1)},children:"إلغاء"}),!q&&M<100&&b&&D(x,k)>0&&e.jsx(_,{className:"bg-blue-600 hover:bg-blue-700",onClick:Le,children:N?"تحديث الآن (إجباري)":"بدء التنزيل"}),M>=100&&e.jsx(_,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{try{if(f!=null&&f.applyUpdate){u({title:"جاري التحديث",description:"سيتم إغلاق التطبيق وتثبيت التحديث فوراً..."});const r=await f.applyUpdate();typeof r=="string"&&r.startsWith("err:")&&u({title:"فشل التحديث",description:r.slice(4),variant:"destructive"})}else if(f!=null&&f.openUpdateFolder){const r=await f.openUpdateFolder();typeof r=="string"&&r.startsWith("err:")?u({title:"تعذر فتح مجلد التحديث",description:r.slice(4),variant:"destructive"}):u({title:"افتح ملف التثبيت",description:"تم فتح مجلد التحديث — اضغط على الملف لتثبيت."})}}catch(r){u({title:"فشل التحديث",description:(r==null?void 0:r.message)||"حدث خطأ غير متوقع",variant:"destructive"})}},children:"تحديث الآن"})]})]})}),e.jsx(Pt,{open:m,onOpenChange:d})]})}export{Ot as P};
//# sourceMappingURL=ProfileIcon-DaTXZUV2.js.map
