var T=Object.defineProperty;var A=(a,s,t)=>s in a?T(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;var N=(a,s,t)=>A(a,typeof s!="symbol"?s+"":s,t);import{r as i,l as L,j as e,af as R,ag as z,ah as F,ai as Y,a_ as H,x as P,I as S,B as d,H as C,J as v,a3 as O,G as $}from"./index-CzMrJEuC.js";class m{static getSecretKey(s){return s?`${this.SECRET_KEY_BASE}_${s}`:this.SECRET_KEY_BASE}static setSecretPin(s,t){const r=btoa(s);this.secretCache.set(this.getSecretKey(t),r)}static hasSecretPin(s){return this.secretCache.has(this.getSecretKey(s))}static verifySecretPin(s,t){const r=this.secretCache.get(this.getSecretKey(t));if(!r)return!1;try{return atob(r)===s}catch{return!1}}static clearSecretPin(s){this.secretCache.delete(this.getSecretKey(s))}}N(m,"SECRET_KEY_BASE","dashboard_secret_pin"),N(m,"secretCache",new Map);function q({open:a,onOpenChange:s,userId:t}){const[r,x]=i.useState(""),[h,y]=i.useState(""),[w,b]=i.useState(""),[f,E]=i.useState(!1),[u,_]=i.useState(!1),[p,k]=i.useState(!1),[K,n]=i.useState(""),[g,o]=i.useState(!1),{toast:D}=L(),l=m.hasSecretPin(t),B=async c=>{c.preventDefault(),n(""),o(!0);try{if(!h||h.length<4){n("يجب أن يكون الرقم السري 4 أرقام على الأقل"),o(!1);return}if(h!==w){n("الرقم السري الجديد وتأكيده غير متطابقين"),o(!1);return}if(l){if(!r){n("يرجى إدخال الرقم السري الحالي"),o(!1);return}if(!m.verifySecretPin(r,t)){n("الرقم السري الحالي غير صحيح"),o(!1);return}}m.setSecretPin(h,t),D({title:l?"تم تغيير الرقم السري":"تم تعيين الرقم السري",description:l?"تم تغيير الرقم السري بنجاح":"تم تعيين الرقم السري بنجاح"}),j()}catch{n("حدث خطأ أثناء حفظ الرقم السري")}finally{o(!1)}},j=()=>{x(""),y(""),b(""),n(""),E(!1),_(!1),k(!1),s(!1)};return e.jsx(R,{open:a,onOpenChange:j,children:e.jsxs(z,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(F,{children:e.jsxs(Y,{className:"flex items-center gap-2 text-right",children:[e.jsx(H,{className:"h-5 w-5"}),l?"تغيير الرقم السري":"تعيين الرقم السري"]})}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground text-right",children:l?"أدخل الرقم السري الحالي والرقم السري الجديد لتغييره":"أدخل الرقم السري الجديد الذي تريد استخدامه في عمليات التعديل"}),l&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"currentPin",className:"text-right block",children:"الرقم السري الحالي"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{id:"currentPin",type:f?"text":"password",autoComplete:"off",value:r,onChange:c=>x(c.target.value),placeholder:"أدخل الرقم السري الحالي",className:"pr-10",dir:"ltr"}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>E(!f),children:f?e.jsx(C,{className:"h-4 w-4"}):e.jsx(v,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"newPin",className:"text-right block",children:"الرقم السري الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{id:"newPin",type:u?"text":"password",autoComplete:"off",value:h,onChange:c=>y(c.target.value),placeholder:"أدخل الرقم السري الجديد",className:"pr-10",dir:"ltr"}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>_(!u),children:u?e.jsx(C,{className:"h-4 w-4"}):e.jsx(v,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{htmlFor:"confirmPin",className:"text-right block",children:"تأكيد الرقم السري الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{id:"confirmPin",type:p?"text":"password",autoComplete:"off",value:w,onChange:c=>b(c.target.value),placeholder:"أعد إدخال الرقم السري الجديد",className:"pr-10",dir:"ltr"}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>k(!p),children:p?e.jsx(C,{className:"h-4 w-4"}):e.jsx(v,{className:"h-4 w-4"})})]})]}),K&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(O,{className:"h-4 w-4"}),K]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(d,{type:"submit",disabled:g,className:"flex-1",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),g?"جاري الحفظ...":l?"تغيير الرقم السري":"تعيين الرقم السري"]}),e.jsx(d,{type:"button",variant:"outline",onClick:j,disabled:g,children:"إلغاء"})]})]})]})})}export{q as ChangePinDialog};
//# sourceMappingURL=ChangePinDialog-CUjyQfB4.js.map
