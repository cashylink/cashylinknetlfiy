{"version":3,"mappings":";w+CAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,+FACH,IAAK,QACX,CACA,EACE,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,KAAM,IAAK,QAAQ,CAAE,CAC3D,EACMC,GAAaC,GAAiB,cAAeF,EAAU,ECKvDG,GAAoE,CAAC,CAAE,OAAAC,EAAQ,aAAAC,EAAe,MAAS,CAC3G,KAAM,CAACC,EAAQC,CAAS,EAAIC,WAAS,EAAK,EACpC,CAACC,EAAuBC,CAAwB,EAAIF,WAAS,EAAK,EAClE,CAACG,GAAiBC,EAAkB,EAAIJ,WAAS,EAAK,EACtD,CAACK,EAAQC,CAAS,EAAIN,WAAqB,CAC/C,cAAe,EACf,cAAe,EACf,gBAAiB,EACjB,gBAAiB,EACjB,gBAAiB,IAAK,CACvB,EACK,CAAE,iBAAAO,CAAA,EAAqBC,GAAA,EAE7BC,YAAU,IAAM,CACVb,GAAUE,GAAUK,IACtBO,GAAA,CAEJ,EAAG,CAACd,EAAQE,EAAQK,EAAe,CAAC,EAEpC,MAAMQ,EAAkBC,GAAmB,GAAGA,EAAO,QAAQ,CAAC,CAAC,OAEzDC,EAAa,SAA8B,CAC/C,GAAI,CACF,MAAMC,GAAiBP,GAAA,YAAAA,EAA0B,eAAgB,KAC3DQ,GAAgBD,GAAA,YAAAA,EAAU,YAAYA,GAAA,YAAAA,EAAU,OAAQ,KACxDE,EAAe,OAAOD,GAAa,SAAWA,EAAS,cAAgB,KAC7E,GAAIA,IAAaE,EAAiB,MAAQD,IAAiB,QAAUA,IAAiB,KAAOD,IAAa,EACxG,MAAO,EAEX,MAAQ,CAAC,CAET,GAAI,CACF,GAAInB,EAAQ,CACV,MAAMsB,EAAiB,MAAMC,GAAoBvB,CAAM,EACjDwB,GAAiBF,GAAA,YAAAA,EAAW,YAAYA,GAAA,YAAAA,EAAW,OAAQ,KAC3DG,EAAgB,OAAOD,GAAc,SAAWA,EAAU,cAAgB,KAChF,GAAIA,IAAcH,EAAiB,MAAQI,IAAkB,QAAUA,IAAkB,KAAOD,IAAc,EAC5G,MAAO,EAEX,CACF,MAAQ,CAAC,CAET,MAAO,EACT,EAEME,GAAiB,SAAY,CACjC,GAAI,CACF,MAAMC,EAAa,MAAO,SAAY,CACpC,GAAI,CACF,MAAMT,GAAiBP,GAAA,YAAAA,EAA0B,eAAgB,KAC3DQ,GAAgBD,GAAA,YAAAA,EAAU,YAAYA,GAAA,YAAAA,EAAU,OAAQ,KACxDE,EAAe,OAAOD,GAAa,SAAWA,EAAS,cAAgB,KAC7E,GAAIA,IAAaE,EAAiB,UAAYD,IAAiB,WAAY,MAAO,EACpF,MAAQ,CAAC,CACT,GAAI,CACF,GAAIpB,EAAQ,CACV,MAAMsB,EAAiB,MAAMC,GAAoBvB,CAAM,EACjDwB,GAAiBF,GAAA,YAAAA,EAAW,YAAYA,GAAA,YAAAA,EAAW,OAAQ,KAC3DG,EAAgB,OAAOD,GAAc,SAAWA,EAAU,cAAgB,KAChF,GAAIA,IAAcH,EAAiB,UAAYI,IAAkB,WAAY,MAAO,EACtF,CACF,MAAQ,CAAC,CACT,MAAO,EACT,KACA,GAAI,MAAMR,EAAA,GAAgBU,EAAY,CACpCC,EAAM,CACJ,MAAO,oBACP,YAAa,4CACb,QAAS,cACV,EACD,MACF,CACF,MAAQ,CAAC,CACTtB,EAAyB,EAAI,CAC/B,EAEMuB,GAAmB,SAAY,CACnC,GAAI,CACF,MAAMF,EAAa,MAAO,SAAY,CACpC,GAAI,CACF,MAAMT,GAAiBP,GAAA,YAAAA,EAA0B,eAAgB,KAC3DQ,GAAgBD,GAAA,YAAAA,EAAU,YAAYA,GAAA,YAAAA,EAAU,OAAQ,KACxDE,EAAe,OAAOD,GAAa,SAAWA,EAAS,cAAgB,KAC7E,GAAIA,IAAaE,EAAiB,UAAYD,IAAiB,WAAY,MAAO,EACpF,MAAQ,CAAC,CACT,GAAI,CACF,GAAIpB,EAAQ,CACV,MAAMsB,EAAiB,MAAMC,GAAoBvB,CAAM,EACjDwB,GAAiBF,GAAA,YAAAA,EAAW,YAAYA,GAAA,YAAAA,EAAW,OAAQ,KAC3DG,EAAgB,OAAOD,GAAc,SAAWA,EAAU,cAAgB,KAChF,GAAIA,IAAcH,EAAiB,UAAYI,IAAkB,WAAY,MAAO,EACtF,CACF,MAAQ,CAAC,CACT,MAAO,EACT,KACA,GAAI,MAAMR,EAAA,GAAgBU,EAAY,CACpCC,EAAM,CACJ,MAAO,oBACP,YAAa,4CACb,QAAS,cACV,EACDtB,EAAyB,EAAK,EAC9B,MACF,CACF,MAAQ,CAAC,CAETE,GAAmB,EAAI,EACvBL,EAAU,EAAI,EACdG,EAAyB,EAAK,CAChC,EAEMQ,GAAa,SAAY,CAC7B,GAAKd,EAEL,GAAI,CACF,GAAI,MAAM,QAAQC,CAAY,GAAKA,EAAa,OAAS,EAAG,CAC1D,MAAM6B,MAAY,KACZC,EAAeD,EAAM,WACrBE,EAAcF,EAAM,cAEpBG,GAAeC,GAAe,0BAA0BjC,EAAuB,QAASD,CAAM,EAC9FmC,EAAiBD,GAAe,0BAA0BjC,EAAuB,UAAWD,CAAM,EAExG,IAAIoC,GAAsB,EACtBC,EAAsB,EACtBC,GAAwB,EACxBC,EAAwB,EAE5BN,GAAa,QAASO,GAAY,CAChC,MAAMC,GAAS,IAAI,KAAKD,EAAG,SAAS,EAC9BE,EAAS,OAAOF,EAAG,QAAU,WAAW,EAAE,cAEhD,GADIC,GAAO,iBAAmBX,EAAM,gBAChCY,IAAW,aAAeA,IAAW,aAAeA,IAAW,UAAW,OAE9E,MAAMC,GAAKH,EAAG,MAAQA,EAAG,SAAW,IAAI,cAClCI,EAAY,CAChB,KAAMD,IAAM,aAAe,WAAaA,EACxC,OAAQ,OAAOH,EAAG,QAAU,CAAC,EAC7B,WAAYA,EAAG,YAGbI,EAAU,OAAS,WACrBR,IAAuBS,GAAc,+BAA+BD,CAAS,GACpEA,EAAU,OAAS,QAAUA,EAAU,OAAS,WAAaA,EAAU,OAAS,cACzFP,GAAuBQ,GAAc,+BAA+BD,CAAS,EAEjF,CAAC,EAEDT,EAAe,QAASK,GAAY,CAClC,MAAMC,GAAS,IAAI,KAAKD,EAAG,SAAS,EAC9BE,EAAS,OAAOF,EAAG,QAAU,WAAW,EAAE,cAEhD,GADIC,GAAO,aAAeV,GAAgBU,GAAO,gBAAkBT,GAC/DU,IAAW,aAAeA,IAAW,aAAeA,IAAW,UAAW,OAE9E,MAAMC,GAAKH,EAAG,MAAQA,EAAG,SAAW,IAAI,cAClCI,EAAY,CAChB,KAAMD,IAAM,aAAe,WAAaA,EACxC,OAAQ,OAAOH,EAAG,QAAU,CAAC,EAC7B,WAAYA,EAAG,YAGbI,EAAU,OAAS,WACrBN,IAAyBO,GAAc,+BAA+BD,CAAS,GACtEA,EAAU,OAAS,QAAUA,EAAU,OAAS,WAAaA,EAAU,OAAS,cACzFL,GAAyBM,GAAc,+BAA+BD,CAAS,EAEnF,CAAC,EAEDlC,EAAU,CACR,cAAe,KAAK,MAAM0B,GAAsB,GAAG,EAAI,IACvD,cAAe,KAAK,MAAMC,EAAsB,GAAG,EAAI,IACvD,gBAAiB,KAAK,MAAMC,GAAwB,GAAG,EAAI,IAC3D,gBAAiB,KAAK,MAAMC,EAAwB,GAAG,EAAI,IAC3D,gBAAiB,IAAK,CACvB,EACD,MACF,CAEA,MAAMO,EAAUD,GAAc,2BAA2B7C,CAAM,EAC/DU,EAAU,CACR,cAAeoC,EAAQ,qBAAuB,EAC9C,cAAeA,EAAQ,qBAAuB,EAC9C,gBAAiBA,EAAQ,uBAAyB,EAClD,gBAAiBA,EAAQ,uBAAyB,EAClD,gBAAiB,IAAK,CACvB,CACH,OAASC,EAAG,CACV,QAAQ,MAAM,+BAAgCA,CAAC,CACjD,CACF,EAEA,OACEC,OAAAC,WAAA,CACE,UAAAC,MAACC,EAAA,CACC,KAAK,KACL,QAAQ,QACR,QAASzB,GACT,UAAU,uNACV,MAAM,qBAEN,SAAAwB,MAACE,GAAA,CAAI,UAAU,cAAc,IAG/BF,MAACG,IAAO,KAAMnD,EAAQ,aAAcC,EAClC,SAAA6C,OAACM,GAAA,CAAc,UAAU,yTACvB,UAAAJ,MAACK,IAAa,UAAU,6FACtB,SAAAP,OAACQ,GAAA,CAAY,UAAU,mMACrB,UAAAN,MAACO,GAAA,CAAW,UAAU,6DAA6D,EAAE,yBAEvF,EACF,EAEAT,OAAC,OAAI,UAAU,sCAEb,UAAAA,OAAC,OAAI,UAAU,iOACb,UAAAA,OAAC,OAAI,UAAU,yCACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACQ,GAAA,CAAM,UAAU,2CAA2C,EAC5DR,MAAC,QAAK,UAAU,6DAA6D,gBAAI,GACnF,EACAA,MAAC,QAAK,UAAU,yDACb,SAAAnC,GAAgBN,EAAO,eAAiB,IAAMA,EAAO,eAAiB,EAAE,EAC3E,GACF,EACAuC,OAAC,OAAI,UAAU,yBACb,UAAAA,OAAC,OAAI,UAAU,4HACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACS,GAAA,CAAc,UAAU,yCAAyC,EAClET,MAAC,QAAK,UAAU,6CAA6C,eAAG,GAClE,QACC,QAAK,UAAU,uDAAwD,SAAAnC,EAAeN,EAAO,aAAa,EAAE,GAC/G,EACAuC,OAAC,OAAI,UAAU,oIACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACU,GAAA,CAAe,UAAU,6CAA6C,EACvEV,MAAC,QAAK,UAAU,iDAAiD,iBAAK,GACxE,QACC,QAAK,UAAU,2DAA4D,SAAAnC,EAAeN,EAAO,aAAa,EAAE,GACnH,GACF,GACF,EAGAuC,OAAC,OAAI,UAAU,iPACb,UAAAA,OAAC,OAAI,UAAU,yCACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACW,GAAA,CAAS,UAAU,+CAA+C,EACnEX,MAAC,QAAK,UAAU,iEAAiE,gBAAI,GACvF,EACAA,MAAC,QAAK,UAAU,6DACb,SAAAnC,GAAgBN,EAAO,iBAAmB,IAAMA,EAAO,iBAAmB,EAAE,EAC/E,GACF,EACAuC,OAAC,OAAI,UAAU,yBACb,UAAAA,OAAC,OAAI,UAAU,4HACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACS,GAAA,CAAc,UAAU,yCAAyC,EAClET,MAAC,QAAK,UAAU,6CAA6C,eAAG,GAClE,QACC,QAAK,UAAU,uDAAwD,SAAAnC,EAAeN,EAAO,eAAe,EAAE,GACjH,EACAuC,OAAC,OAAI,UAAU,gIACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACU,GAAA,CAAe,UAAU,2CAA2C,EACrEV,MAAC,QAAK,UAAU,+CAA+C,iBAAK,GACtE,QACC,QAAK,UAAU,yDAA0D,SAAAnC,EAAeN,EAAO,eAAe,EAAE,GACnH,GACF,GACF,GACF,EAEC,CAACF,IACA2C,MAAC,OAAI,UAAU,0JACb,SAAAA,MAACC,EAAA,CACC,KAAK,KACL,QAAQ,QACR,QAAS,IAAM7C,EAAyB,EAAI,EAC5C,UAAU,iIACV,MAAM,4BAEN,SAAA4C,MAACE,GAAA,CAAI,UAAU,UAAU,IAE7B,EAGFF,MAAC,OAAI,UAAU,+EACb,SAAAA,MAACC,EAAA,CACC,QAAS,IAAMhD,EAAU,EAAK,EAC9B,UAAU,oRACX,kBAED,CACF,GACF,EACF,EAEA+C,MAACY,GAAA,CACC,KAAMzD,EACN,aAAcC,EACd,UAAWuB,GACX,YAAY,qEACd,EACF,CAEJ,EAEakC,GAAiEC,GACrEd,MAACnD,GAAA,CAA0B,GAAGiE,CAAA,CAAO,EC/PxCC,GAA6B,IAAM,gCACvC,MAAMC,EAAWC,GAAA,EACX,CAAE,KAAAC,EAAM,QAAAC,EAAS,iBAAA1D,CAAA,EAAqBC,GAAA,EAEtCK,EAAaqD,GAAM,QAAQ,IAAM,aACrC,MAAMC,IAAUC,EAAA7D,GAAA,YAAAA,EAAkB,eAAlB,YAAA6D,EAAgC,aAC3CC,EAAA9D,GAAA,YAAAA,EAAkB,eAAlB,YAAA8D,EAAgC,SAC/BC,EAAAL,GAAA,YAAAA,EAAiB,eAAjB,YAAAK,EAA+B,aAC/BC,EAAAN,GAAA,YAAAA,EAAiB,eAAjB,YAAAM,EAA+B,OAChC,KACL,OAAOJ,IAAYlD,EAAiB,MAAQ,OAAOkD,CAAO,EAAE,gBAAkB,MAChF,EAAG,EACDC,GAAA7D,GAAA,YAAAA,EAAkB,eAAlB,YAAA6D,GAAgC,UAChCC,GAAA9D,GAAA,YAAAA,EAAkB,eAAlB,YAAA8D,GAAgC,MAC/BC,GAAAL,GAAA,YAAAA,EAAiB,eAAjB,YAAAK,GAA+B,UAC/BC,GAAAN,GAAA,YAAAA,EAAiB,eAAjB,YAAAM,GAA+B,KACjC,EACKC,EAAiBN,GAAM,QAAQ,IAAM,aACzC,MAAMC,IAAUC,EAAA7D,GAAA,YAAAA,EAAkB,eAAlB,YAAA6D,EAAgC,aAC3CC,EAAA9D,GAAA,YAAAA,EAAkB,eAAlB,YAAA8D,EAAgC,SAC/BC,EAAAL,GAAA,YAAAA,EAAiB,eAAjB,YAAAK,EAA+B,aAC/BC,EAAAN,GAAA,YAAAA,EAAiB,eAAjB,YAAAM,EAA+B,OAChC,KACL,OAAOJ,IAAYlD,EAAiB,UAAY,OAAOkD,CAAO,EAAE,gBAAkB,UACpF,EAAG,EACDM,GAAAlE,GAAA,YAAAA,EAAkB,eAAlB,YAAAkE,GAAgC,UAChCC,GAAAnE,GAAA,YAAAA,EAAkB,eAAlB,YAAAmE,GAAgC,MAC/BC,GAAAV,GAAA,YAAAA,EAAiB,eAAjB,YAAAU,GAA+B,UAC/BC,GAAAX,GAAA,YAAAA,EAAiB,eAAjB,YAAAW,GAA+B,KACjC,EACK,CAAE,SAAAC,EAAA,EAAaC,GAAA,EACf,CAAE,cAAAC,GAAe,UAAAC,CAAA,EAAcC,GAAA,EAC/B,CAACpF,EAAcqF,CAAe,EAAIlF,WAAwB,EAAE,EAC5D,CAACmF,EAAqBC,CAAsB,EAAIpF,WAAwB,EAAE,EAC1E,CAACqF,GAAgBC,EAAiB,EAAItF,WAAsB,IAAI,GAAK,EACrE,CAACuF,GAAsBC,CAAuB,EAAIxF,WAAS,EAAK,EAChE,CAACyF,EAAkBC,CAAmB,EAAI1F,WAA6B,IAAI,EAC3E,CAAC2F,EAAWC,EAAY,EAAI5F,WAAS,KAAK,EAC1C,CAAC6F,EAAaC,EAAc,EAAI9F,WAAS,EAAE,EAC3C,CAAC+F,EAAcC,EAAe,EAAIhG,WAAS,EAAE,EAC7C,CAACiG,EAAcC,CAAe,EAAIlG,WAAS,EAAE,EAC7C,CAACmG,GAAkBC,CAAmB,EAAIpG,WAAS,EAAK,EACxD,CAACqG,EAAsBC,CAAuB,EAAItG,WAAS,EAAK,EAChE,CAACuG,GAAwBC,EAAyB,EAAIxG,WAAS,EAAK,EACpE,CAACyG,GAAaC,EAAc,EAAI1G,WAAS,EAAK,EAC9C,CAAC2G,GAAUC,EAAW,EAAI5G,WAAiB,EAAE,EAC7C,CAAC6G,GAAYC,EAAa,EAAI9G,WAAiB,aAAa,EAC5D,CAAC+G,GAAkBC,EAAmB,EAAIhH,WAAsB,IAAI,EACpE,CAACiH,GAAoBC,EAAqB,EAAIlH,WAAsB,IAAI,EACxE,CAACmH,GAAaC,EAAc,EAAIpH,WAAkB,EAAK,EAE7DkE,GAAM,UAAU,IAAM,SACPE,EAAA7D,GAAA,YAAAA,EAAkB,eAAlB,YAAA6D,EAAgC,YAChCnD,EAAiB,WAC5BO,EAAM,CAAE,MAAO,oBAAqB,YAAa,mFAAqF,QAAS,cAAe,EAC9JsC,EAAS,iBAAiB,EAE9B,EAAG,EAACuD,GAAA9G,GAAA,YAAAA,EAAkB,eAAlB,YAAA8G,GAAgC,QAAQ,CAAC,EAC7C,KAAM,CAACC,GAAiBC,EAAkB,EAAIvH,WAAS,EAAK,EACtD,CAACwH,GAAkBC,EAAmB,EAAIzH,WAAS,EAAK,EACxD,CAAC0H,GAAmBC,EAAoB,EAAI3H,WAAS,EAAK,EAC5D,CAAC4H,GAA2BC,EAA4B,EAAI7H,WAAS,EAAK,EACxE,CAAC8H,GAAmBC,EAAoB,EAAI/H,WAAS,EAAK,EAC1D,CAACgI,GAAmBC,EAAoB,EAAIjI,WAAS,EAAK,EAC1D,CAACkI,GAAeC,EAAgB,EAAInI,WAAS,EAAK,EAClD,CAACoI,GAAoBC,EAAqB,EAAIrI,WAAqB,IAAI,EACvE,CAACsI,GAAyBC,EAA0B,EAAIvI,WAAS,EAAK,EAGtE,CAACwI,GAAmBC,EAAoB,EAAIzI,WAAoF,CAAE,cAAe,GAAI,aAAc,EAAG,YAAa,KAAM,EAC/LS,YAAU,IAAM,EACU,SAAY,CAClC,GAAKuD,GAAA,MAAAA,EAAM,IACX,GAAI,CACF,MAAM0E,EAAO,MAAMC,EAAgB,YAAY3E,EAAK,GAAG,EACjD4E,GAAOF,GAAA,YAAAA,EAAM,cAAe,GAC5BG,EAAO,OAAOD,GAAA,YAAAA,EAAK,aAAa,EAAI,EAAI,OAAOA,EAAI,aAAa,EAAI,GACpEE,EAAW,OAAOF,GAAA,YAAAA,EAAK,YAAY,EAAI,EAAI,OAAOA,EAAI,YAAY,EAAI,EACtEG,EAAYC,GAAYA,aAAa,KAAQA,EAAK,OAAOA,GAAA,YAAAA,EAAG,SAAW,WAAcA,EAAE,SAAYA,EAAI,IAAI,KAAK,OAAOA,CAAC,CAAC,EAAI,KAC7HC,EAAoBL,GAAA,MAAAA,EAAK,YAAcG,EAASH,EAAI,WAAW,EAAI,KACnEM,MAAU,KACE,CAACD,GAASC,EAAI,UAAYD,EAAK,WAAcH,EAAW,GAAK,GAAK,GAAK,KAEvF,MAAMH,EAAgB,eAAe3E,EAAK,IAAK,CAAE,YAAa,CAAE,cAAe6E,EAAM,aAAcC,EAAU,YAAaI,CAAA,EAAO,EACjIT,GAAqB,CAAE,cAAeI,EAAM,aAAcC,EAAU,YAAaI,EAAK,GAEtFT,GAAqB,CAAE,cAAeI,EAAM,aAAcC,EAAU,YAAaG,EAAM,CAE3F,MAAQ,CAENR,GAAqB,CAAE,cAAe,GAAI,aAAc,EAAG,YAAa,KAAM,CAChF,CACF,GACA,CACF,EAAG,CAACzE,GAAA,YAAAA,EAAM,GAAG,CAAC,EAGdvD,YAAU,IAAM,CACd,GAAI,EAACuD,GAAA,MAAAA,EAAM,KAAK,QACY,SAAY,CACtC,GAAI,CACF,MAAMmF,EAAUC,EAAIC,EAAI,QAASrF,EAAK,GAAG,EACnCsF,EAAO,MAAMC,EAAOJ,CAAO,EAC3BT,EAAYY,EAAK,SAAWA,EAAK,OAAS,GAC1CV,EAAMF,GAAA,YAAAA,EAAM,eACZc,EAAKZ,GAAA,MAAAA,EAAK,OAASA,EAAI,SAAYA,EAAM,IAAI,KAAKA,CAAG,EAAI,KAC/D1B,GAAsBsC,CAAE,CAC1B,MAAQ,CAAC,CACX,GACA,CACF,EAAG,CAACxF,GAAA,YAAAA,EAAM,GAAG,CAAC,EAGdvD,YAAU,IAAM,EACK,SAAY,CAC7B,GAAI,CACF,MAAM6I,EAAO,MAAMC,EAAOH,EAAIC,EAAI,aAAc,QAAQ,CAAC,EACnDX,EAAYY,EAAK,SAAWA,EAAK,OAAS,KAChD,GAAI,CAACZ,EAAM,CAAE9B,GAAY,EAAE,EAAGE,GAAc,EAAE,EAAGE,GAAoB,IAAI,EAAGI,GAAe,EAAK,EAAG,MAAQ,CAC3G,MAAMqC,EAAc,OAAOf,EAAK,KAAO,EAAE,EACnCgB,EAAgB,OAAOhB,EAAK,OAAS,aAAa,EAClDiB,EAASjB,EAAK,YACdkB,EAAmBD,GAAA,MAAAA,EAAQ,OAASA,EAAO,SAAYA,EAAS,IAAI,KAAKA,CAAM,EAAI,IAAI,KAC7F/C,GAAY6C,CAAG,EACf3C,GAAc4C,CAAK,EACnB1C,GAAoB4C,CAAG,EACvBxC,GAAewC,EAAO,CAAC3C,IAAuB2C,EAAI,YAAa3C,IAAA,YAAAA,GAAoB,YAAa,GAAO,EAAK,CAC9G,MAAY,CACVG,GAAe,EAAK,CACtB,CACF,GACA,CACF,EAAG,CAACH,EAAkB,CAAC,EAEvB,MAAM4C,GAAkBJ,GAAwB,CAC9C,GAAI,CACF,MAAMK,EAAI,IAAI,IAAIL,CAAG,EACrB,IAAIM,EAAK,GAQT,OAPID,EAAE,SAAS,SAAS,aAAa,EAC/BA,EAAE,WAAa,SAAUC,EAAKD,EAAE,aAAa,IAAI,GAAG,GAAK,IACpDA,EAAE,SAAS,WAAW,SAAS,GAC/BA,EAAE,SAAS,WAAW,UAAU,KAAGC,EAAKD,EAAE,SAAS,MAAM,GAAG,EAAE,OAAS,IACvEA,EAAE,WAAa,aACxBC,EAAKD,EAAE,SAAS,QAAQ,MAAO,EAAE,GAE9BC,EACE,iCAAiCA,CAAE,oBAD1BN,CAElB,MAAQ,CAAE,OAAOA,CAAK,CACxB,EAEMO,GAAY,SAAY,CAC5BtD,GAAe,EAAI,EACnB,GAAI,CACE1C,GAAA,MAAAA,EAAM,KACR,MAAM2E,EAAgB,eAAe3E,EAAK,IAAK,CAAE,eAAgB,IAAI,KAAQ,EAE/EoD,GAAe,EAAK,CACtB,MAAQ,CAAC,CACX,EAGM,CAAC6C,GAAaC,EAAc,EAAIlK,WAAS,EAAK,EAC9C,CAACmK,GAAYC,EAAa,EAAIpK,WAAS,EAAE,EACzC,CAACqK,GAAeC,EAAgB,EAAItK,WAAS,EAAE,EAC/C,CAACuK,GAAaC,EAAc,EAAIxK,WAAsB,EAAE,EACxD,CAACyK,GAAcC,EAAe,EAAI1K,WAAS,EAAK,EAEhD,CAAC2K,GAAmBC,EAAoB,EAAI5K,WAAS,CAAC,EAE5DS,YAAU,IAAM,CACd,GAAI,EAACuD,GAAA,MAAAA,EAAM,KAAK,CAAE4G,GAAqB,CAAC,EAAG,MAAQ,EAChC,SAAY,CAC7B,GAAI,CACF,MAAMzB,EAAUC,EAAIC,EAAI,QAASrF,EAAK,GAAG,EACnCsF,EAAO,MAAMC,EAAOJ,CAAO,EAE3BT,EAAYY,EAAK,SAAWA,EAAK,OAAS,GAM1CuB,GALa,MAAM,QAAQnC,GAAA,YAAAA,EAAM,KAAK,EAAIA,EAAK,MAAQ,IAKtC,OAAQ,IAAW,iBAAG,UAAW,YAAe,OAAO,iBAAG,MAAM,GAAK,GAAK,CAAE,EAAE,OACrGkC,GAAqBC,CAAK,CAC5B,MAAQ,CACND,GAAqB,CAAC,CACxB,CACF,GACA,CACF,EAAG,CAAC5G,GAAA,YAAAA,EAAM,GAAG,CAAC,EAEdvD,YAAU,IAAM,CACdqK,GAAA,EACAC,GAAA,CACF,EAAG,CAAC/G,CAAI,CAAC,EAGTvD,YAAU,IAAM,CACd,GAAI,EAACuD,GAAA,MAAAA,EAAM,KAAK,QACI,SAAY,CAC9B,GAAI,CACF,MAAMgH,EAAIC,GAAQC,GAAW7B,EAAI,qBAAqB,EAAG8B,EAAM,SAAU,KAAMnH,EAAK,GAAG,CAAC,EAClFsF,EAAO,MAAM8B,GAAQJ,CAAC,EACtBK,EAAiB,GACvB/B,EAAK,KAAK,QAASF,GAAQ,CACzB,MAAMkC,EAASlC,EAAI,OACbmC,EAAM,CAACD,EAAE,sBAAuBA,EAAE,cAAeA,EAAE,UAAWlC,EAAI,EAAE,EACvE,OAAO,OAAO,EACd,IAAKJ,GAAM,OAAOA,CAAC,CAAC,EACvBqC,EAAK,KAAK,GAAGE,CAAG,CAClB,CAAC,EAEGF,EAAK,OAAS,IAChB/F,GAAmBkG,GAAS,CAC1B,MAAMC,EAAO,IAAI,IAAID,CAAI,EACzB,OAAAH,EAAK,QAASK,GAAMD,EAAK,IAAIC,CAAC,CAAC,EACxBD,CACT,CAAC,EAEDvG,EAAiBsG,GAASA,EAAK,OAAQjJ,GAAM,CAC3C,MAAMwH,EAAK,OAAOxH,EAAE,IAAM,EAAE,EACtBoJ,EAAM,OAAQpJ,EAAU,eAAiB,EAAE,EAC3CqJ,EAAM,OAAQrJ,EAAU,WAAa,EAAE,EAC7C,MAAO,EAAE8I,EAAK,SAAStB,CAAE,GAAKsB,EAAK,SAASM,CAAG,GAAKN,EAAK,SAASO,CAAG,EACvE,CAAC,CAAC,GAIJ,GAAI,CAEAjD,EAAgB,sCAAsC3E,EAAK,GAAG,CAClE,MAAQ,CAAC,CACX,OAASrB,EAAG,CACV,QAAQ,KAAK,oCAAqCA,CAAC,CACrD,CACF,GACA,CACF,EAAG,CAACqB,GAAA,YAAAA,EAAM,GAAG,CAAC,EAEdvD,YAAU,IAAM,EACb,SAAY,CACX,GAAI,CACF,GAAI,EAACuD,GAAA,MAAAA,EAAM,KAAK,CAAEsB,GAAkB,IAAI,GAAK,EAAG,MAAQ,CACxD,MAAM0F,EAAIC,GACRC,GAAW7B,EAAI,qBAAqB,EACpC8B,EAAM,SAAU,KAAMnH,EAAK,GAAG,EAC9BmH,EAAM,YAAa,KAAM,EAAI,GAGzBE,GADO,MAAMD,GAAQJ,CAAC,GACA,KAAK,QAAQM,GAAK,CAC5C,MAAM5C,EAAY4C,EAAE,OAEpB,MADY,CAAC5C,EAAK,sBAAuBA,EAAK,cAAeA,EAAK,UAAW4C,EAAE,EAAE,EAAE,OAAO,OAAO,EAAE,IAAI,MAAM,CAE/G,CAAC,EACDhG,GAAkB,IAAI,IAAI+F,CAAI,CAAC,CACjC,MAAQ,CACN/F,GAAkB,IAAI,GAAK,CAC7B,CACF,IACF,EAAG,CAACtB,GAAA,YAAAA,EAAM,GAAG,CAAC,EAId,KAAM,CAAE,KAAM6H,GAAqB,QAASC,GAAqB,WAAAC,EAAA,EAAeC,GAAS,CACvF,SAAU,CAAC,mBAAoBhI,GAAA,YAAAA,EAAM,GAAG,EACxC,QAAS,SAAY,CACnB,GAAI,EAACA,GAAA,MAAAA,EAAM,KAAK,MAAO,GACvB,GAAI,CACF,MAAMgH,EAAIC,GACRC,GAAW7B,EAAI,qBAAqB,EACpC8B,EAAM,SAAU,KAAMnH,EAAK,GAAG,EAC9BmH,EAAM,YAAa,KAAM,EAAI,GAEzB,CAACc,EAASC,EAAKC,CAAW,EAAI,MAAM,QAAQ,IAAI,CACpDxD,EAAgB,oBAAoB3E,EAAK,GAAG,EAAE,MAAM,IAAM,EAAE,EAC3D2E,EAAwB,YAAY3E,EAAK,GAAG,EAAE,MAAM,IAAM,EAAE,EAC7DoH,GAAQJ,CAAC,EACN,KAAM1B,GAASA,EAAK,KAAK,QAAQgC,GAAK,CACrC,MAAM5C,EAAY4C,EAAE,OAEpB,MADY,CAAC5C,EAAK,sBAAuBA,EAAK,cAAeA,EAAK,UAAW4C,EAAE,EAAE,EAAE,OAAO,OAAO,EAAE,IAAI,MAAM,CAE/G,CAAC,CAAC,EACD,MAAM,IAAM,EAAE,EAClB,EACKc,EAAQ,MAAM,QAAQH,CAAO,GAAKA,EAAQ,OAAS,EAAKA,EAAW,MAAM,QAAQC,CAAG,EAAIA,EAAM,GAC9FG,EAAU,IAAI,IAAIF,CAAuB,EASzCG,GAPyBF,GAAQ,IACpC,IAAK7J,IAAY,CAChB,GAAGA,EACH,UAAWA,EAAE,qBAAqB,KAAOA,EAAE,UAAY,IAAI,KAAKA,EAAE,SAAS,GAC3E,EACD,OAAQA,GAAW,GAAEA,GAAA,YAAAA,EAAG,QAAS,YAAcA,GAAA,YAAAA,EAAG,QAAS,IAAI,SAAS,mBAAmB,EAAG,EAE1D,OAAQA,GAAW,CACxD,MAAMwH,EAAK,OAAOxH,EAAE,IAAM,EAAE,EACtBoJ,EAAM,OAAOpJ,EAAE,eAAiB,EAAE,EAClCqJ,EAAM,OAAOrJ,EAAE,WAAaA,EAAE,sBAAwB,EAAE,EAC9D,MAAO,CAAC8J,EAAQ,IAAItC,CAAE,IAAM,CAAC4B,GAAO,CAACU,EAAQ,IAAIV,CAAG,KAAO,CAACC,GAAO,CAACS,EAAQ,IAAIT,CAAG,EACrF,CAAC,EAEKW,EAASvI,GAAA,MAAAA,EAAM,IAAM2E,EAAgB,iBAAiB3E,EAAK,GAAG,EAAI,GAClEwI,EAAS,CAAC,GAAGF,EAAU,GAAI,MAAM,QAAQC,CAAM,EAAIA,EAAS,EAAG,EAC/DE,EAAUlK,UAAW,eACzBA,GAAA,YAAAA,EAAG,iBAAiBA,GAAA,YAAAA,EAAG,MAAMA,GAAA,YAAAA,EAAG,aAAaA,GAAA,YAAAA,EAAG,yBAAyB6B,EAAA7B,GAAA,YAAAA,EAAG,UAAH,YAAA6B,EAAY,YAAc,GAAG,IAAI,MAAK7B,GAAA,YAAAA,EAAG,YAAa,KAAK,KAAK,EAAE,SAAS,KAEhJmK,MAAW,IAOjB,OANiBF,EAAO,OAAQjK,GAAW,CACzC,MAAMmJ,EAAIe,EAAOlK,CAAC,EAClB,OAAImK,EAAK,IAAIhB,CAAC,EAAU,IACxBgB,EAAK,IAAIhB,CAAC,EACH,GACT,CAAC,EACe,IAAIiB,EAAoB,CAC1C,OAASC,EAAO,CACd,eAAQ,MAAM,+BAAgCA,CAAK,EAC5C,EACT,CACF,EACA,QAAS,CAAC,EAAC5I,GAAA,MAAAA,EAAM,KACjB,UAAW,EAAI,GAAK,IACrB,EAGDvD,YAAU,IAAM,CACVoL,IACF3G,EAAgB2G,EAAmB,CAEvC,EAAG,CAACA,EAAmB,CAAC,EAExB,MAAMf,GAAmB,SAAY,CACnC,GAAI,CACF,GAAI,CAAC9G,EAAM,OACX,MAAMgH,EAAIC,GACRC,GAAW7B,EAAI,qBAAqB,EACpC8B,EAAM,SAAU,KAAMnH,EAAK,GAAG,EAC9BmH,EAAM,YAAa,KAAM,EAAI,GAEzB,CAACc,EAASC,EAAKC,CAAW,EAAI,MAAM,QAAQ,IAAI,CACpDxD,EAAgB,oBAAoB3E,EAAK,GAAG,EAAE,MAAM,IAAM,EAAE,EAC3D2E,EAAwB,YAAY3E,EAAK,GAAG,EAAE,MAAM,IAAM,EAAE,EAC7DoH,GAAQJ,CAAC,EACN,KAAM1B,GAASA,EAAK,KAAK,QAAQgC,GAAK,CACrC,MAAM5C,EAAY4C,EAAE,OAEpB,MADY,CAAC5C,EAAK,sBAAuBA,EAAK,cAAeA,EAAK,UAAW4C,EAAE,EAAE,EAAE,OAAO,OAAO,EAAE,IAAI,MAAM,CAE/G,CAAC,CAAC,EACD,MAAM,IAAM,EAAE,EAClB,EACKc,EAAQ,MAAM,QAAQH,CAAO,GAAKA,EAAQ,OAAS,EAAKA,EAAW,MAAM,QAAQC,CAAG,EAAIA,EAAM,GAC9FG,EAAU,IAAI,IAAIF,CAAuB,EAQzCG,GAPyBF,GAAQ,IACpC,IAAK7J,IAAY,CAChB,GAAGA,EACH,UAAWA,EAAE,qBAAqB,KAAOA,EAAE,UAAY,IAAI,KAAKA,EAAE,SAAS,GAC3E,EAED,OAAQA,GAAW,GAAEA,GAAA,YAAAA,EAAG,QAAS,YAAcA,GAAA,YAAAA,EAAG,QAAS,IAAI,SAAS,mBAAmB,EAAG,EAC1D,OAAQA,GAAW,CACxD,MAAMwH,EAAK,OAAOxH,EAAE,IAAM,EAAE,EACtBoJ,EAAM,OAAOpJ,EAAE,eAAiB,EAAE,EAClCqJ,EAAM,OAAOrJ,EAAE,WAAaA,EAAE,sBAAwB,EAAE,EAC9D,MAAO,CAAC8J,EAAQ,IAAItC,CAAE,IAAM,CAAC4B,GAAO,CAACU,EAAQ,IAAIV,CAAG,KAAO,CAACC,GAAO,CAACS,EAAQ,IAAIT,CAAG,EACrF,CAAC,EACKW,EAASvI,GAAA,MAAAA,EAAM,IAAM2E,EAAgB,iBAAiB3E,EAAK,GAAG,EAAI,GAClEwI,EAAS,CAAC,GAAGF,EAAU,GAAI,MAAM,QAAQC,CAAM,EAAIA,EAAS,EAAG,EAC/DE,EAAUlK,UAAW,eACzBA,GAAA,YAAAA,EAAG,iBAAiBA,GAAA,YAAAA,EAAG,MAAMA,GAAA,YAAAA,EAAG,aAAaA,GAAA,YAAAA,EAAG,yBAAyB6B,EAAA7B,GAAA,YAAAA,EAAG,UAAH,YAAA6B,EAAY,YAAc,GAAG,IAAI,MAAK7B,GAAA,YAAAA,EAAG,YAAa,KAAK,KAAK,EAAE,SAAS,KAEhJmK,MAAW,IACXG,EAAWL,EAAO,OAAQjK,GAAW,CACzC,MAAMmJ,EAAIe,EAAOlK,CAAC,EAClB,OAAImK,EAAK,IAAIhB,CAAC,EAAU,IACxBgB,EAAK,IAAIhB,CAAC,EACH,GACT,CAAC,EACDxG,EAAgB2H,EAAS,IAAIF,EAAoB,CAAkB,CACrE,OAASC,EAAO,CACd,QAAQ,MAAM,8CAA+CA,CAAK,EAClEpL,EAAM,CACJ,MAAO,2BACP,YAAa,4IACb,QAAS,cACV,CACH,CACF,EAEMuJ,GAA0B,SAAY,CAC1C,GAAI,CACF,GAAI,CAAC/G,EAAM,OAEX,MAAM8I,GADU,MAAMC,GAAgB,6BAA6B/I,EAAK,GAAG,GAC1C,IAAKzB,IAAY,CAChD,GAAGA,EACH,UAAWA,EAAE,qBAAqB,KAAOA,EAAE,UAAY,IAAI,KAAKA,EAAE,SAAS,GAC3E,EACF6C,EAAuB0H,EAAiB,IAAIH,EAAoB,CAAkB,CACpF,OAASC,EAAO,CACd,QAAQ,MAAM,gDAAiDA,CAAK,EACpEpL,EAAM,CACJ,MAAO,6BACP,YAAa,wEACb,QAAS,cACV,CACH,CACF,EAEMwL,GAAwB9I,GAAM,QAAQ,IAAM,CAChD,MAAMgF,MAAU,KACV+D,EAAa,IAAI,KAAK/D,EAAI,cAAeA,EAAI,WAAY,CAAC,EAC1DgE,EAAiB,IAAI,KAAKhE,EAAI,cAAeA,EAAI,WAAa,EAAG,CAAC,EAMxE,MALe,CAAC,GAAGrJ,CAAY,EAAE,KAAK,CAACsN,EAAGC,IAAM,CAC9C,MAAMC,EAAQF,EAAE,qBAAqB,KAAOA,EAAE,UAAU,UAAY,EAEpE,OADcC,EAAE,qBAAqB,KAAOA,EAAE,UAAU,UAAY,GACrDC,CACjB,CAAC,EACa,OAAO9K,GAAKA,EAAE,WAAa0K,GAAc1K,EAAE,UAAY2K,CAAc,CACrF,EAAG,CAACrN,CAAY,CAAC,EACXyN,GAAcpJ,GAAM,QAAQ,IAAM,CACtC,MAAMgF,MAAU,KACV+D,EAAa,IAAI,KAAK/D,EAAI,cAAeA,EAAI,WAAY,CAAC,EAC1DgE,EAAiB,IAAI,KAAKhE,EAAI,cAAeA,EAAI,WAAa,EAAG,CAAC,EACxE,OAAO,KAAK,IAAI,IAAIrJ,GAAA,YAAAA,EAAc,SAAU,IAAMA,GAAgB,IAAI,OAAO0C,GAAKA,EAAE,WAAa0K,GAAc1K,EAAE,UAAY2K,CAAc,EAAE,MAAM,CACrJ,EAAG,CAACrN,GAAA,YAAAA,EAAc,MAAM,CAAC,EAEnB0N,GAAuBP,GAAsB,OAAOQ,GAAe,CACvE,MAAMC,EAAa,CAAC5H,GAClB2H,EAAY,YAAY,SAAS3H,CAAW,GAC5C2H,EAAY,cAAc,SAAS3H,CAAW,EAE1C6H,EAAY,CAAC3H,GACjByH,EAAY,UAAU,iBAAmB,IAAI,KAAKzH,CAAY,EAAE,eAE5D4H,EAAY,CAAC1H,GACjBuH,EAAY,UAAU,eAAe,WAAWvH,CAAY,EAE9D,OAAOwH,GAAcC,GAAaC,CACpC,CAAC,EAEKC,GAAgB,CAACtL,EAAgBuL,IAAkB,CACvD,OAAQvL,EAAA,CACN,IAAK,YACH,OAAOQ,MAACgL,IAAY,UAAW,WAAWD,IAAS,WAAa,eAAiB,gBAAgB,GAAI,EACvG,IAAK,UACH,OAAO/K,MAACQ,GAAA,CAAM,UAAU,0BAA0B,EACpD,IAAK,YACH,OAAOR,MAACiL,GAAA,CAAQ,UAAU,uBAAuB,EACnD,QACE,OAAOjL,MAACQ,GAAA,CAAM,UAAU,wBAAwB,EAEtD,EAEM0K,GAAiB1L,GAAmB,CACxC,OAAQA,EAAA,CACN,IAAK,YACH,MAAO,QACT,IAAK,UACH,MAAO,eACT,IAAK,YACH,MAAO,OACT,QACE,MAAO,YAEb,EAGMqK,GAAwB/D,GAA0B,CACtD,MAAMqF,IAAarF,GAAA,YAAAA,EAAK,SAAU,IAAI,WAAW,cAC3CsF,EACJD,IAAc,aAAeA,IAAc,WAAaA,IAAc,YAClE,YACAA,IAAc,UAAYA,IAAc,SAAWA,IAAc,aAAeA,IAAc,WAC9F,YACA,UAEAE,IAAWvF,GAAA,YAAAA,EAAK,QAAQA,GAAA,YAAAA,EAAK,UAAW,IAAI,WAAW,cAC7D,IAAIwF,EAAsC,OAEtCD,IAAY,WACdC,EAAiB,WACRD,IAAY,iBAAmBA,IAAY,MACpDC,EAAiB,gBAEjBA,EAAiB,OAGnB,MAAMC,GACJzF,GAAA,YAAAA,EAAK,eAAeA,GAAA,YAAAA,EAAK,gBAAgBA,GAAA,YAAAA,EAAK,iBAAiBA,GAAA,YAAAA,EAAK,UAAUA,GAAA,YAAAA,EAAK,OAAQ,GACvF0F,GACJ1F,GAAA,YAAAA,EAAK,iBAAiBA,GAAA,YAAAA,EAAK,kBAAkBA,GAAA,YAAAA,EAAK,mBAAmBA,GAAA,YAAAA,EAAK,YAAYA,GAAA,YAAAA,EAAK,KAAM,GAE7F2F,EAAe3F,GAAA,YAAAA,EAAK,UACpB4F,EACJD,aAAwB,KACpBA,EACAA,GAAA,MAAAA,EAAc,OACdA,EAAa,SACb,IAAI,KAAKA,CAAY,EAE3B,MAAO,CACL,GAAI3F,GAAA,YAAAA,EAAK,GACT,YAAayF,GAAU,YACvB,cAAeC,GAAY,YAC3B,OAAQ,QAAO1F,GAAA,YAAAA,EAAK,SAAU,CAAC,EAC/B,OAAQsF,EACR,KAAME,EACN,UAAAI,EACA,UAAU5F,GAAA,YAAAA,EAAK,WAAY,OAC3B,YAAYA,GAAA,YAAAA,EAAK,aAAc,OAC/B,iBAAiBA,GAAA,YAAAA,EAAK,kBAAmB,OACzC,YAAYA,GAAA,YAAAA,EAAK,aAAc,OAC/B,YAAYA,GAAA,YAAAA,EAAK,cAAcA,GAAA,YAAAA,EAAK,WAAY,OAChD,aAAaA,GAAA,YAAAA,EAAK,eAAeA,GAAA,YAAAA,EAAK,iBAAiBA,GAAA,YAAAA,EAAK,UAAW,OACvE,gBAAgBA,GAAA,YAAAA,EAAK,kBAAkBA,GAAA,YAAAA,EAAK,kBAAmB,OAC/D,cAAcA,GAAA,YAAAA,EAAK,eAAgB,OACnC,+BAA+BA,GAAA,YAAAA,EAAK,iCAAiCA,GAAA,YAAAA,EAAK,4BAA4BA,GAAA,YAAAA,EAAK,0BAA2B,GACtI,6BAA6BA,GAAA,YAAAA,EAAK,8BAA+B,GACjE,KAAKA,GAAA,YAAAA,EAAK,MAAO,OACjB,YAAYA,GAAA,YAAAA,EAAK,cAAcA,GAAA,YAAAA,EAAK,eAAgB,OACpD,OAAOA,GAAA,YAAAA,EAAK,QAAS,OACrB,aAAaA,GAAA,YAAAA,EAAK,cAAe,OAErC,EAEM6F,GAA2BlM,GAAmB,CAClD,MAAMmM,EAAI,QAAQnM,GAAA,YAAAA,EAAW,WAAY,EAAE,EAAE,cACvCoM,EAAQD,EAAE,SAAS,UAAU,EAAI,UAAaA,EAAE,SAAS,UAAU,EAAI,WAAa,GAGpFE,EAAO,OAAOrM,EAAE,aAAe,EAAE,EACjCsM,EAAW,OAAOtM,EAAE,OAAS,EAAE,EAC/BuM,EACJF,EAAK,SAAS,YAAY,GAC1BA,EAAK,SAAS,aAAa,GAC3BA,EAAK,SAAS,kBAAkB,GAChCC,EAAS,SAAS,YAAY,GAC9BA,EAAS,SAAS,aAAa,EAE3BE,EAAYxM,EAAE,OAAS,OAAS,QAAU,MAChD,IAAImH,EAASnH,EAAE,OAAS,YAAcoM,EAAS,GAAGI,CAAS,IAAIJ,CAAK,GAAKI,EAGzE,OAAID,EACFpF,EAAQ,cACCnH,EAAE,QAEXmH,EAAQnH,EAAE,OAGL,CACL,GAAIA,EAAE,GACN,KAAMuM,GAAkCvM,EAAE,OAAS,OAAzB,WAA+C,WACzE,cAAeA,EAAE,YACjB,gBAAiBA,EAAE,cACnB,OAAQA,EAAE,OACV,WAAYA,EAAE,YAAc,EAC5B,OAAQA,EAAE,SAAW,YAAc,SAAWA,EAAE,OAChD,UAAWA,EAAE,UAAU,cACvB,UAAWA,EAAE,UAAU,cACvB,SAAUsC,KAAYZ,GAAA,YAAAA,EAAS,YAAYD,GAAA,YAAAA,EAAM,cAAe,QAEhE,aAAczB,GAAA,YAAAA,EAAW,cAAe,KACxC,gBAAiBA,GAAA,YAAAA,EAAW,iBAAkB,OAC9C,cAAeA,GAAA,YAAAA,EAAW,eAAgB,OAC1C,KAAMA,GAAA,YAAAA,EAAW,MAAO,OACxB,MAAOA,GAAA,YAAAA,EAAW,QAASA,GAAA,YAAAA,EAAW,QAAS,OAC/C,YAAaA,GAAA,YAAAA,EAAW,aAAc,OACtC,UAAWA,GAAA,YAAAA,EAAW,WAAY,OAClC,MAAAmH,EACA,YAAanH,EAAE,YAEnB,EAEMyM,GAA0BxB,GAA6B,CAC3D,MAAMyB,EAAcR,GAAwBjB,CAAW,EACvDnF,GAAsB4G,CAAW,EACjC9G,GAAiB,EAAI,CACvB,EAEM+G,GAA2B9M,GAAoB,CACnDsD,EAAoBtD,CAAE,EACtBoD,EAAwB,EAAI,CAC9B,EAEM2J,GAAuB,SAAY,CAClC1J,IACL,MAAM2J,GAAmB3J,EAAiB,EAAE,EAC5CD,EAAwB,EAAK,EAC7BE,EAAoB,IAAI,EAC1B,EAEM0J,GAAqB,MAAOC,GAA0B,CAC1D,GAAI,CACF,MAAMC,EAAuBnK,EAAoB,KAAK5C,GAAKA,EAAE,KAAO8M,CAAa,EACjF,GAAI,CAACC,GAAwB,CAACtL,EAAM,OAGpC,MAAMuL,EAAQ,MAAM5G,EAAgB,oBAAoB3E,EAAK,IAAK,CAChE,GAAGsL,EACH,OAAQtL,EAAK,IACb,OAAQ,YACR,YAAasL,EAAqB,aAAe,iBAClD,EAGD,MAAMvC,GAAgB,6BAA6BsC,EAAerL,EAAK,GAAG,EAG1E,MAAMwL,EAAW,CAAE,GAAGF,EAAsB,GAAIC,CAAA,EAChDrK,EAAgBsG,GAAQ,CAAC,GAAGA,EAAMgE,CAAQ,CAAC,EAC3CpK,KAA+BoG,EAAK,UAAYjJ,EAAE,KAAO8M,CAAa,CAAC,EACvE7N,EAAM,CAAE,MAAO,eAAgB,YAAa,gCAAiC,CAC/E,OAASoL,EAAO,CACd,QAAQ,MAAM,wCAAyCA,CAAK,EAC5DpL,EAAM,CAAE,MAAO,gBAAiB,YAAa,mCAAoC,QAAS,cAAe,CAC3G,CACF,EAEMiO,GAA+B,MAAOJ,GAA0B,CACpE,GAAI,CACF,GAAI,CAACrL,EAAM,OAEXoB,KAA+BoG,EAAK,UAAYjJ,EAAE,KAAO8M,CAAa,CAAC,EAGvE,MAAMtC,GAAgB,6BAA6BsC,EAAerL,EAAK,GAAG,EAC1E,MAAM2E,EAAgB,sBAAsB3E,EAAK,IAAKqL,CAAa,EAEnE7N,EAAM,CAAE,MAAO,mBAAoB,YAAa,+BAAgC,CAClF,OAASoL,EAAO,CACd,QAAQ,MAAM,8BAA+BA,CAAK,EAClDpL,EAAM,CAAE,MAAO,uBAAwB,YAAa,mCAAoC,QAAS,cAAe,CAClH,CACF,EAGMkO,GAAwB,MAAOL,GAA0B,WAC7D,GAAI,CACF,MAAMjN,EAAKvC,EAAa,KAAK0C,GAAKA,EAAE,KAAO8M,CAAa,EACxD,GAAI,CAACjN,GAAM,CAAC4B,EAAM,OAGlB,GAAI,CACF,MAAM2L,GAAOvL,EAAA7D,GAAA,YAAAA,EAAkB,eAAlB,YAAA6D,EAAgC,SAC7C,GAAIuL,IAAS1O,EAAiB,KAAM,CAClC,KAAM,CAAE,2BAAA2O,CAAA,EAA+B,MAAAC,EAAA,2CAAAD,GAAA,KAAM,QAAO,0CAAoC,kFAClFE,EAAS1N,EAAG,OAAS,OAAS,WAAa,WAEjD,GAAI,EADQ,MAAMwN,EAA2B,kBAAkB5L,EAAK,IAAK8L,EAAQ,CAAC,GACzE,QAAS,CAChBtO,EAAM,CACJ,MAAO,yBACP,YAAa,2EACb,QAAS,cACV,EACD,MACF,CACF,SAAWmO,IAAS1O,EAAiB,SAAU,CAC7C,KAAM,CAAE,2BAAA2O,CAAA,EAA+B,MAAAC,EAAA,2CAAAD,GAAA,KAAM,QAAO,0CAAoC,kFAClFE,EAAS1N,EAAG,OAAS,OAAS,WAAa,WAEjD,GAAI,EADQ,MAAMwN,EAA2B,0BAA0B5L,EAAK,IAAK8L,EAAQ,EAAE,GAClF,QAAS,CAChBtO,EAAM,CACJ,MAAO,yBACP,YAAa,sDACb,QAAS,cACV,EACD,MACF,CACF,CACF,OAASuO,EAAU,CACjB,QAAQ,KAAK,oCAAqCA,CAAQ,CAC5D,CAGA,MAAMC,EAAc,MAAMC,GAAe,QAAQjM,EAAK,GAAG,EACzD,GAAI,EAACgM,GAAA,MAAAA,EAAa,QAChB,MAAM,IAAI,MAAM,6CAA6C,EAE/D,MAAME,EAAU9G,EAAIC,EAAI,gBAAiB2G,EAAY,MAAM,EACrDG,EAAW,MAAM5G,EAAO2G,CAAO,EACrC,IAAIE,EAAcD,EAAS,SAAW,SAAQ9L,EAAA8L,EAAS,SAAT,YAAA9L,EAAyB,cAAe,CAAC,EAAI,EAC3F,MAAMgM,EAAyCF,EAAS,WAAa7L,EAAA6L,EAAS,SAAT,YAAA7L,EAAyB,iBAAkB,GAAM,GAEhHgM,EAAwBlO,EAAG,YAAc,OAAO,KAAKiO,CAAc,EAAE,CAAC,EACtEE,EAAwB,GAASnO,GAAA,MAAAA,EAAY,0BAC7CoO,EAAW,OAAOpO,EAAG,iBAAmBA,EAAG,YAAcA,EAAG,QAAU,CAAC,EACvEqO,EAAYrO,EAAG,OAAS,OAAS,WAAa,WACpD,GAAI,CACF,KAAM,CAAE,yBAAAsO,CAAA,EAA6B,MAAAb,EAAA,yCAAAa,GAAA,KAAM,QAAO,qBAAkC,OAAAC,KAAA,gFAC9EC,EAAM,MAAMF,EAAyB,oBAAoBJ,EAAuBE,EAAUC,CAAS,EACzG,GAAI,CAACF,GAAyB,CAACK,EAAI,WAAY,CAC7CpP,EAAM,CAAE,MAAO,eAAgB,YAAa,OAAOoP,EAAI,SAAW,2CAA2C,EAAG,QAAS,cAAe,EACxI,MACF,CACF,MAAQ,CACNpP,EAAM,CAAE,MAAO,uBAAwB,YAAa,uBAAwB,QAAS,cAAe,EACpG,MACF,CAGA,IAAIqP,EAAgB,GACpB,GAAIzO,EAAG,OAAS,WAAY,CAC1B,MAAM0O,EAAe1O,EAAG,YAAc,OAAO,KAAKiO,CAAc,EAAE,CAAC,EAC7DzP,EAAS,OAAOwB,EAAG,iBAAmBA,EAAG,QAAU,CAAC,EACpD2O,EAAa,OAAO3O,EAAG,YAAc,CAAC,EAGtC4O,EAAiC,GAAS5O,GAAA,MAAAA,EAAY,+BACtD6O,EAA+B,GAAS7O,GAAA,MAAAA,EAAY,6BAE1D,GAAI,CAAC4O,GAAkCF,GAAgBlQ,EAAS,EAAG,CACjE,MAAMsQ,GAAUb,EAAeS,CAAY,GAAK,EAChDT,EAAeS,CAAY,EAAII,GAAUtQ,CAC3C,CAEIqQ,EACFb,EAAcA,EAAcxP,EAE5BwP,EAAcA,EAAcxP,EAE9BiQ,EAAgB,GAGhB,MAAMM,GAAUjB,EAAS,CAAE,YAAAE,EAAa,eAAAC,EAAgB,CAC1D,SAAWjO,EAAG,OAAS,OAAQ,CAC7B,MAAM2O,EAAa,OAAO3O,EAAG,YAAc,CAAC,EACtCgP,EAAM,QAAQhP,GAAA,YAAAA,EAAY,MAAO,CAAC,EAClCiP,EAAc,QAAQjP,GAAA,YAAAA,EAAY,cAAeA,GAAA,YAAAA,EAAY,oBAAqBA,EAAG,QAAU,CAAC,EAChGkP,EAAQ,KAAK,IAAI,EAAGD,CAAW,EAAI,KAAK,IAAI,EAAGD,CAAG,EACpDE,EAAQ,IACVlB,EAAcA,EAAckB,EAC5B,MAAMH,GAAUjB,EAAS,CAAE,YAAAE,EAAa,EACxCS,EAAgB,GAEpB,CAEA,MAAMM,GAAU/H,EAAIC,EAAI,mBAAoBgG,CAAa,EAAG,CAC1D,OAAQ,YACR,gBAAiB,IAAK,CACvB,EAED,GAAI,CACF,MAAMyB,EAAe1O,EAAG,YAAc,OAAO,KAAKiO,CAAc,EAAE,CAAC,EAC7DkB,EAAM,OAAOnP,EAAG,iBAAmBA,EAAG,YAAcA,EAAG,QAAU,CAAC,EACxE,GAAI0O,GAAgBS,EAAM,GAAK,CAAChB,EAAuB,CACrD,KAAM,CAAE,yBAAAG,CAAA,EAA6B,MAAAb,EAAA,yCAAAa,GAAA,KAAM,QAAO,qBAAkC,OAAAC,KAAA,gFACpF,MAAMD,EAAyB,YAAYI,EAAcS,EAAKnP,EAAG,OAAS,OAAS,WAAa,UAAU,CAC5G,CACF,MAAQ,CACNZ,EAAM,CAAE,MAAO,mBAAoB,YAAa,oCAAqC,QAAS,cAAe,EAC7G,MACF,CAEA,GAAI,CACF,KAAM,CAAE,cAAAiB,CAAA,EAAkB,MAAAoN,EAAA,8BAAApN,GAAA,KAAM,QAAO,6BAAuB,qEACxD+O,EAAS/O,EAAc,+BAA+B,CAC1D,KAAML,EAAG,OAAS,OAAS,WAAa,WACxC,OAAQ,OAAOA,EAAG,QAAU,CAAC,EAC7B,WAAY,OAAOA,EAAG,YAAc,CAAC,EACrC,IAAK,QAAQA,GAAA,YAAAA,EAAY,MAAO,CAAC,EAClC,EAEG,CADiB,GAASA,GAAA,MAAAA,EAAY,wBACrBoP,EAAS,GAC5B/O,EAAc,UAAU+O,EAAQxN,GAAA,YAAAA,EAAM,GAAG,CAE7C,MAAQ,CAAC,CAETkB,EAAgBsG,GAAQA,EAAK,IAAIjJ,GAAKA,EAAE,KAAO8M,EAAgB,CAAE,GAAG9M,EAAG,OAAQ,aAAgBA,CAAC,CAAC,EACjGf,EAAM,CAAE,MAAO,aAAc,YAAa,2BAA4B,EACtE2G,GAAiB,EAAK,CACxB,OAASyE,EAAO,CACd,QAAQ,MAAM,yBAA0BA,CAAK,EAC7CpL,EAAM,CAAE,MAAO,cAAe,YAAa,mCAAoC,QAAS,cAAe,CACzG,CACF,EAGMiQ,GAAsB,MAAOpC,GAA0B,SAC3D,GAAI,CACF,MAAMjN,EAAKvC,EAAa,KAAK0C,GAAKA,EAAE,KAAO8M,CAAa,EACxD,GAAI,CAACjN,GAAM,CAAC4B,EAAM,OAGlBkB,KAAwBsG,EAAK,UAAYjJ,EAAE,KAAO8M,CAAa,CAAC,EAChEjK,EAAuBoG,GAAQ,CAAC,CAAE,GAAGpJ,GAAM,GAAGoJ,CAAI,CAAC,EAGnD,IAAIkG,EAActP,EAAG,OACrB,GAAI,CAEF,IAAIuP,EAAa,GACjB,GAAI,CACF,MAAMrI,EAAO,MAAMC,EAAOH,EAAIC,EAAI,mBAAoBgG,CAAa,CAAC,EAIpE,GAHAsC,EAAQrI,EAAK,SAAYA,EAAK,OAAiB,GAG3CqI,GAAA,MAAAA,EAAO,OAAQ,CACjB,MAAMC,EAAI,OAAOD,EAAM,MAAM,EAAE,cAC3BC,IAAM,aAAeA,IAAM,aAAeA,IAAM,UAAWF,EAAc,YACpEE,IAAM,UAAWF,EAAc,WAC/BE,IAAM,aAAeA,IAAM,YAAUF,EAAc,YAC9D,CACF,MAAQ,CAAC,CACT,MAAMG,EAAaxC,EACbyC,EAAc,QAAOH,GAAA,YAAAA,EAAO,iBAAkBvP,GAAA,YAAAA,EAAY,gBAAiByP,CAAU,EACrFE,EAAY,QAChBJ,GAAA,YAAAA,EAAO,aAAaA,GAAA,YAAAA,EAAO,wBAC1BvP,GAAA,YAAAA,EAAY,aAAcA,GAAA,YAAAA,EAAY,uBAAwB,IAGjE,MAAMuG,EAAgB,sBAAsB3E,EAAK,IAAKqL,CAAa,EACnE,MAAMtC,GAAgB,uBAAuB,CAC3C,GAAG3K,EACH,OAAQ4B,EAAK,IACb,sBAAuBqL,EACvB,cAAeyC,EACf,UAAWC,GAAa,OACxB,UAAW,GACZ,EACD,GAAI,CACF,MAAMhF,GAAgB,6BAA6BsC,EAAerL,EAAK,GAAG,CAC5E,MAAQ,CAAC,CACX,OAASrB,EAAG,CACV,QAAQ,KAAK,sHAAuHA,CAAC,CACvI,CAGA,GAAI,CACF,MAAMqN,EAAc,MAAMC,GAAe,QAAQjM,EAAK,GAAG,EACzD,GAAI,EAACgM,GAAA,MAAAA,EAAa,QAChB,MAAM,IAAI,MAAM,6CAA6C,EAE/D,MAAME,EAAU9G,EAAIC,EAAI,gBAAiB2G,EAAY,MAAM,EACrDG,EAAW,MAAM5G,EAAO2G,CAAO,EACrC,IAAIE,EAAsBD,EAAS,SAAW,SAAQ/L,EAAA+L,EAAS,SAAT,YAAA/L,EAAyB,cAAe,CAAC,EAAI,EACnG,MAAMiM,EAAyCF,EAAS,WAAa9L,EAAA8L,EAAS,SAAT,YAAA9L,EAAyB,iBAAkB,GAAM,GAEhHzD,EAAS,OAAOwB,EAAG,iBAAmBA,EAAG,QAAU,CAAC,EACpD2O,EAAa,OAAO3O,EAAG,YAAc,CAAC,EACtC0O,EAAe1O,EAAG,YAAc,OAAO,KAAKiO,CAAc,EAAE,CAAC,EAG7D2B,EAAuB,GAAS5P,GAAA,MAAAA,EAAY,+BAGlD,GAAIA,EAAG,OAAS,OAAQ,CAGtB,MAAMgP,EAAM,OAAOhP,EAAG,KAAO,CAAC,EACxB6P,EAAa,QAAQ7P,GAAA,YAAAA,EAAY,cAAeA,GAAA,YAAAA,EAAY,oBAAqBA,EAAG,QAAU,CAAC,EAMrG,GAJIsP,IAAgB,cAElBtB,EAAcA,GAAe6B,EAAab,IAExCN,GAAgBmB,EAAa,EAAG,CAClC,MAAMf,EAAUb,EAAeS,CAAY,GAAK,EAChDT,EAAeS,CAAY,EAAII,EAAUe,CAC3C,CACF,SAAW7P,EAAG,OAAS,YACrB,GAAIsP,IAAgB,aAKlB,GAFAtB,EAAcA,EAAcxP,EAExBkQ,GAAgBlQ,EAAS,EAAG,CAC9B,MAAMsQ,EAAUb,EAAeS,CAAY,GAAK,EAChDT,EAAeS,CAAY,EAAII,EAAUtQ,CAC3C,UAGIkQ,GAAgBkB,GAAwBpR,EAAS,EAAG,CACtD,MAAMsQ,EAAUb,EAAeS,CAAY,GAAK,EAChDT,EAAeS,CAAY,EAAII,EAAUtQ,CAC3C,EAMJ,MAAMuQ,GAAUjB,EAAS,CAAE,YAAAE,EAAa,eAAAC,EAAgB,CAC1D,OAAS1N,EAAG,CACV,QAAQ,KAAK,gCAAiCA,CAAC,CACjD,CAGA,GAAI,CACF,MAAMmO,EAAe1O,EAAG,WACxB,GAAI0O,EAAc,CAChB,KAAM,CAAE,yBAAAJ,CAAA,EAA6B,MAAAb,EAAA,yCAAAa,GAAA,KAAM,QAAO,qBAAkC,OAAAC,KAAA,gFAE9EY,EAAM,OAAOnP,EAAG,iBAAmBA,EAAG,YAAcA,EAAG,QAAU,CAAC,EAClE0N,EAAS1N,EAAG,OAAS,OAAS,WAAa,WACjD,MAAMsO,EAAyB,cAAcI,EAAcS,EAAKzB,EAAQ1N,EAAG,SAAS,CACtF,CACF,OAASO,EAAG,CACV,QAAQ,KAAK,4BAA6BA,CAAC,CAC7C,CAGA,GAAI,CACF,KAAM,CAAE,cAAAF,CAAA,EAAkB,MAAAoN,EAAA,8BAAApN,GAAA,KAAM,QAAO,6BAAuB,qEACxD,CAAE,eAAAyP,CAAA,EAAmB,MAAArC,EAAA,+BAAAqC,GAAA,KAAM,QAAO,qBAAwB,OAAAvB,KAAA,sEAE1DwB,EAAuB,CAC3B,QAFc/P,EAAG,OAAS,OAAS,OAAS,UAG5C,OAAQA,EAAG,OACX,WAAYA,EAAG,YAAc,EAC7B,UAAWA,EAAG,UACd,OAAQ,aAGJoP,EAAS/O,EAAc,+BAA+B0P,CAAe,EACvEX,EAAS,GACX/O,EAAc,UAAU,CAAC+O,EAAQxN,EAAK,GAAG,EAG3C,GAAI,CACFkO,EAAe,yBAAyB9P,EAAI4B,EAAK,GAAG,CACtD,MAAQ,CAAC,CACX,OAASrB,EAAG,CACV,QAAQ,KAAK,wCAAyCA,CAAC,CACzD,CACF,OAASiK,EAAO,CACd,QAAQ,MAAM,yBAA0BA,CAAK,CAC/C,CACF,EAGMwF,GAAiBC,SAAO,EAAK,EAC7BC,GAAWC,GAAA,EACjB9R,YAAU,IAAM,CAGV,EAFW,IAAI,gBAAgB6R,GAAS,MAAM,EACzB,IAAI,kBAAkB,IAAM,MACnCF,GAAe,UACjCA,GAAe,QAAU,IAExB,SAAY,iBACX,GAAI,CACF,GAAI,CAACpO,EAAM,OACX,MAAMC,EAAU,MAAMgM,GAAe,QAAQjM,EAAK,GAAG,EACrD,GAAI,EAACC,WAAS,QAAQ,CACpB,QAAQ,KAAK,yDAAyD,EACtE,MACF,CAGA,MAAMiM,EAAU9G,EAAIC,EAAI,gBAAiBpF,EAAQ,MAAM,EACjDuO,EAAa,MAAMjJ,EAAO2G,CAAO,EACjCuC,EAAaD,EAAW,SAAW,SAAQpO,EAAAoO,EAAW,SAAX,YAAApO,EAA2B,cAAe,CAAC,EAAI,EAC1FsO,EAAwCF,EAAW,WAAanO,EAAAmO,EAAW,SAAX,YAAAnO,EAA2B,iBAAkB,GAAM,GACnHyM,EAAe,OAAO,KAAK4B,CAAa,EAAE,CAAC,GAAK,OAGhD9R,EAAS,IACTmQ,EAAa,EAGbxB,EAAQ,MAAM5G,EAAgB,oBAAoB3E,EAAK,IAAK,CAChE,YAAa,mBACb,cAAe,qBACf,OAAApD,EACA,OAAQ,UACR,KAAM,WACN,cAAe,KACf,UAAW,QAAQ,KAAK,KAAK,GAC7B,WAAAmQ,EACA,gBAAiBnQ,EACjB,WAAYkQ,EACZ,YAAa,WACb,eAAgB,MAChB,aAAclQ,EAASmQ,EACvB,8BAA+B,GAChC,EAED,QAAQ,IAAI,uCAAwCxB,CAAK,EAGzD,MAAMG,GAAsBH,CAAK,EAEjC,MAAMoD,EAAoB,MAAMpJ,EAAO2G,CAAO,EACxC0C,EAAoBD,EAAkB,SAAW,SAAQrO,EAAAqO,EAAkB,SAAlB,YAAArO,EAAkC,cAAe,CAAC,EAAI,EAC/GuO,EAA+CF,EAAkB,WAAapO,EAAAoO,EAAkB,SAAlB,YAAApO,EAAkC,iBAAkB,GAAM,GAGxIuO,GAAoBL,EAAa7R,EAASmQ,EAC1CgC,GAAsBjC,EAAgB,OAAO4B,EAAc5B,CAAY,GAAK,CAAC,EAAIlQ,EAAU,OACjG,QAAQ,IAAI,oCAAqCkS,GAAmB,QAASF,CAAiB,EAC1F9B,GACF,QAAQ,IAAI,sCAAuCiC,GAAqB,QAASF,EAAqB/B,CAAY,CAAC,EAIrH,MAAMW,GAAoBlC,CAAK,EAE/B,MAAMyD,GAAkB,MAAMzJ,EAAO2G,CAAO,EACtC+C,GAAkBD,GAAgB,SAAW,SAAQvO,EAAAuO,GAAgB,SAAhB,YAAAvO,EAAgC,cAAe,CAAC,EAAI,EACzGyO,GAA6CF,GAAgB,WAAatO,EAAAsO,GAAgB,SAAhB,YAAAtO,EAAgC,iBAAkB,GAAM,GAExI,QAAQ,IAAI,8CAA+C+N,EAAYQ,EAAe,EAClFnC,GACF,QAAQ,IAAI,gDAAiD4B,EAAc5B,CAAY,GAAK,EAAGoC,GAAmBpC,CAAY,GAAK,CAAC,EAGtItP,EAAM,CAAE,MAAO,iCAAkC,YAAa,sDAAuD,QAAS,UAAW,CAC3I,OAAS2R,EAAK,CACZ,QAAQ,MAAM,gCAAiCA,CAAG,EAClD3R,EAAM,CAAE,MAAO,qBAAsB,YAAa,sDAAuD,QAAS,cAAe,CACnI,CACF,KACF,EAAG,CAAC8Q,GAAS,OAAQtO,CAAI,CAAC,EAG1B,MAAMoP,GAAc,SAAY,WAE9B,MAAMC,EAAe,2BACfC,GAAYjP,GAAAD,EAAAmP,GAAK,cAAL,YAAAnP,EAAkB,QAAlB,YAAAC,EAAyB,cAC3C,GAAI,CAACiP,GAAaA,IAAcD,EAAc,CAC5C7R,EAAM,CAAE,MAAO,cAAe,YAAa,2CAA4C,EACvF,MACF,CACA,GAAI,CAAC2I,IAAc,CAACE,IAAiB,CAACE,GAAa,CACjD/I,EAAM,CAAE,MAAO,eAAgB,YAAa,+BAAgC,QAAS,cAAe,EACpG,MACF,CACAkJ,GAAgB,EAAI,EACpB,GAAI,CAQF,MAAM8I,EANgD,CACpD,YAAa,WACb,UAAW,SACX,YAAa,WACb,MAAO,MAEoCnJ,EAAa,GAAKA,GAGzDoJ,EAAa,IAAI,gBACjBC,EAAU,WAAW,IAAMD,EAAW,QAAS,IAAK,EAEpDE,EAAU,OAAMrP,EAAAiP,GAAK,cAAL,YAAAjP,EAAkB,cAClCsP,EAAO,MAAM,MAAM,aAAc,CACrC,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,GAAID,EAAU,CAAE,cAAe,UAAUA,CAAO,IAAO,EAAC,EAE1D,KAAM,KAAK,UAAU,CACnB,MAAOxJ,GACP,YAAa,KACb,SAAUqJ,EACV,OAAQ,OAAOjJ,EAAW,EAC1B,eAAgB,GACjB,EACD,OAAQkJ,EAAW,OACpB,EACD,aAAaC,CAAO,EAGpB,MAAMG,EAAU,MAAMD,EAAK,OAC3B,IAAIlL,EACJ,GAAI,CACFA,EAAO,KAAK,MAAMmL,CAAO,CAC3B,MAAQ,CACNnL,EAAO,CAAE,QAAS,GAAO,QAASmL,GAAW,2BAC/C,CACID,EAAK,KAAMlL,GAAA,MAAAA,EAAM,UACnBlH,EAAM,CAAE,MAAO,WAAY,aAAakH,GAAA,YAAAA,EAAM,UAAW,6BAA8B,EACvFwB,GAAe,EAAK,EACpBE,GAAc,EAAE,EAChBE,GAAiB,EAAE,EACnBE,GAAe,EAAE,GAEjBhJ,EAAM,CAAE,MAAO,YAAa,aAAakH,GAAA,YAAAA,EAAM,UAAW,0BAA2B,QAAS,cAAe,CAEjH,OAASyK,EAAU,CACjB,QAAQ,MAAM,uBAAwBA,CAAG,GACrCA,GAAA,YAAAA,EAAK,QAAS,aAChB3R,EAAM,CAAE,MAAO,eAAgB,YAAa,yDAA0D,QAAS,cAAe,EAE9HA,EAAM,CAAE,MAAO,iBAAkB,YAAa,qCAAsC,QAAS,cAAe,CAEhH,SACEkJ,GAAgB,EAAK,CACvB,CACF,EAEA,OACE9H,OAAC,OAAI,UAAU,oEACb,UAAAA,OAAC,OAAI,UAAU,oBAEb,UAAAA,OAAC,OAAI,UAAU,+BACb,UAAAA,OAACG,EAAA,CACC,QAAQ,QACR,KAAK,KACL,QAAS,IAAMe,EAAS,iBAAiB,EACzC,UAAU,4DAEV,UAAAhB,MAACgR,GAAA,CAAU,UAAU,UAAU,EAAE,YAGnChR,MAAC,MAAG,UAAU,mCAAmC,qBAAS,GAC5D,EAGAF,OAACmR,GAAA,CAAK,UAAU,yBACd,UAAAnR,OAACoR,GAAA,CAAW,UAAU,iBACpB,UAAAlR,MAACmR,GAAA,CAAU,UAAU,oBAAoB,6BAAiB,EAG1DrR,OAAC,OAAI,UAAU,0CAEb,UAAAA,OAAC,OAAI,UAAU,yMACb,UAAAE,MAACoR,GAAA,CAAO,UAAU,oEAAoE,EACtFpR,MAACqR,GAAA,CACC,YAAY,SACZ,MAAOtO,EACP,SAAW,GAAMC,GAAe,EAAE,OAAO,KAAK,EAC9C,UAAU,kHACZ,EACF,EAIAlD,OAAC,OAAI,UAAU,oCAEb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACC,EAAA,CACC,QAAQ,QACR,KAAK,KACL,UAAU,8JACV,QAASiH,GACT,MAAM,cAEN,SAAApH,OAAC,OAAI,UAAU,iEACb,UAAAE,MAACsR,GAAA,CAAW,UAAU,cAAc,EACnCjN,IACCrE,MAAC,OAAI,UAAU,+DAA+D,GAElF,IAEFA,MAAC,QAAK,UAAU,sCAAsC,eAAG,GAC3D,EAEAF,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACC,EAAA,CACC,QAAQ,QACR,KAAK,KACL,UAAU,oKACV,QAAS,IAAM,CACb,GAAIlC,GAAc2D,EAAgB,CAChChD,EAAM,CAAE,MAAO,WAAY,YAAa,wCAAyC,QAAS,cAAe,EACzG,MACF,CACA8E,EAAwB,EAAI,CAC9B,EACA,MAAM,gBAEN,SAAAxD,MAACuR,GAAA,CAAa,UAAU,cAAc,IAExCvR,MAAC,QAAK,UAAU,sCAAsC,iBAAK,GAC7D,EAGAF,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACa,GAAA,CAAqB,OAAQK,GAAA,YAAAA,EAAM,IAAK,aAAAnE,EAAqC,EAC9EiD,MAAC,QAAK,UAAU,sCAAsC,iBAAK,GAC7D,EAIAF,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACC,EAAA,CACC,QAAQ,QACR,KAAK,KACL,UAAU,0JACV,QAAS,IAAMqD,EAAoB,EAAI,EACvC,MAAM,YAEN,SAAAtD,MAACwR,GAAA,CAAW,UAAU,cAAc,IAEtCxR,MAAC,QAAK,UAAU,sCAAsC,iBAAK,GAC7D,EAGAF,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACC,EAAA,CACC,QAAQ,QACR,KAAK,KACL,UAAU,+JACV,QAAS,IAAM,CACb,GAAIlC,EAAY,CACdW,EAAM,CAAE,MAAO,wBAAyB,YAAa,sDAAuD,EAC5G,MACF,CACA+F,GAAmB,EAAI,CACzB,EACA,MAAM,kBAEN,SAAAzE,MAACyR,GAAA,CAAS,UAAU,cAAc,IAEpCzR,MAAC,QAAK,UAAU,sCAAsC,kBAAM,GAC9D,EAGAF,OAAC,OAAI,UAAU,0BACb,UAAAA,OAACG,EAAA,CACC,QAAQ,QACR,KAAK,KACL,UAAW,0EACTgD,GAAgBE,EACZ,kDACA,4FACN,GACA,QAAS,IAAMwB,GAAoB,EAAI,EACvC,MAAM,iBAEN,UAAA3E,MAACW,GAAA,CAAS,UAAU,cAAc,GAChCsC,GAAgBE,IAChBnD,MAAC,OAAI,UAAU,kEAAkE,KAGrFA,MAAC,QAAK,UAAU,sCAAsC,iBAAK,GAC7D,EAGAF,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACC,EAAA,CACC,QAAQ,QACR,KAAK,KACL,UAAU,6KACV,QAAS,IAAM,CACb,GAAIlC,EAAY,CACdW,EAAM,CAAE,MAAO,wBAAyB,YAAa,mDAAoD,EACzG,MACF,CACAqG,GAA6B,EAAI,CACnC,EACA,MAAM,eAEN,SAAAjF,OAAC,OAAI,UAAU,iEACb,UAAAE,MAAC0R,GAAA,CAAS,UAAU,cAAc,EACjC7J,GAAoB,GACnB7H,MAAC,OAAI,UAAU,mMACZ,SAAA6H,EAAA,CACH,GAEJ,IAGF7H,MAAC,QAAK,UAAU,sCAAsC,gBAAI,GAC5D,EAGAF,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACC,EAAA,CACC,QAAQ,QACR,KAAK,KACL,UAAU,+JACV,QAAS,IAAM,CACb,GAAIlC,EAAY,CACdW,EAAM,CAAE,MAAO,wBAAyB,YAAa,8CAA+C,EACpG,MACF,CACAyG,GAAqB,EAAI,CAC3B,EACA,MAAM,UAEN,SAAAnF,MAAC2R,GAAA,CAAO,UAAU,cAAc,IAElC3R,MAAC,QAAK,UAAU,sCAAsC,iBAAK,GAC7D,EAGAF,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACC,EAAA,CACC,QAAQ,QACR,KAAK,KACL,UAAU,oKACV,QAAS,IAAM,CACbe,EAAS,kBAAmB,CAAE,MAAO,CAAE,sBAAuB,IAAQ,CACxE,EACA,MAAM,eAEN,SAAAhB,MAAC4R,GAAA,CAAgB,UAAU,cAAc,IAE3C5R,MAAC,QAAK,UAAU,sCAAsC,kBAAM,GAC9D,EAGAF,OAAC,OAAI,UAAU,oCACb,UAAAE,MAACC,EAAA,CACC,QAAQ,QACR,KAAK,KACL,UAAU,oKACV,QAAS,IAAM,CACb,GAAIlC,EAAY,CACdW,EAAM,CAAE,MAAO,wBAAyB,YAAa,uDAAwD,EAC7G,MACF,CACAuG,GAAqB,EAAI,CAC3B,EACA,MAAM,mBAEN,SAAAjF,MAAC6R,GAAA,CAAW,UAAU,cAAc,IAEtC7R,MAAC,QAAK,UAAU,sCAAsC,eAAG,GAC3D,EAGAF,OAAC,OAAI,UAAU,0BACb,UAAAA,OAACG,EAAA,CACC,QAAQ,QACR,KAAK,KACL,UAAW,8JACX,QAAS,IAAM,CACbwF,GAA2B,EAAI,CACjC,EACA,MAAM,0BAEN,UAAAzF,MAAC8R,GAAA,CAAO,UAAU,cAAc,EAC/BtH,GAAc,GACbxK,MAAC,OAAI,UAAU,+DAA+D,KAGlFA,MAAC,QAAK,UAAU,sCAAsC,iBAAK,GAC7D,GAGE+C,GAAeE,GAAgBE,IAC/BrD,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACC,EAAA,CACC,QAAQ,QACR,KAAK,KACL,UAAU,qJACV,QAAS,IAAM,CACb+C,GAAe,EAAE,EACjBE,GAAgB,EAAE,EAClBE,EAAgB,EAAE,CACpB,EACA,MAAM,MAEN,SAAApD,MAAC,QAAK,UAAU,wBAAwB,aAAC,IAE3CA,MAAC,QAAK,UAAU,sCAAsC,eAAG,GAC3D,GAEJ,GACF,GACF,EACAA,MAAC+R,GAAA,CAAY,UAAU,YACrB,SAAAjS,OAACkS,GAAA,CAAK,MAAOnP,EAAW,cAAeC,GAAc,UAAU,SAC7D,UAAAhD,OAACmS,GAAA,CAAS,UAAU,0LAElB,UAAAjS,MAAC,OAAI,UAAU,2IAA2I,EAE1JF,OAACoS,GAAA,CACC,MAAM,MACN,UAAU,sTAEV,UAAAlS,MAAC,QAAK,UAAU,gBAAgB,gBAAI,EACpCA,MAAC,OAAI,UAAU,4IAA4I,KAG7JF,OAACoS,GAAA,CACC,MAAM,OACN,UAAU,6TAEV,UAAAlS,MAAC,QAAK,UAAU,gBAAgB,gBAAI,EACpCA,MAAC,OAAI,UAAU,8IAA8I,KAG/JF,OAACoS,GAAA,CACC,MAAM,WACN,UAAU,+TAEV,UAAAlS,MAAC,QAAK,UAAU,gBAAgB,eAAG,EACnCA,MAAC,OAAI,UAAU,6IAA6I,KAG9JF,OAACoS,GAAA,CACC,MAAM,UACN,UAAU,kTAEV,UAAAlS,MAAC,QAAK,UAAU,gBAAgB,iBAAK,EACrCA,MAAC,OAAI,UAAU,yIAAyI,IAC1J,EACF,EAEAA,MAACmS,IAAY,MAAM,MAAM,UAAU,qBAChC,SAAA1H,GAAqB,SAAW,EAC/BzK,MAAC,OAAI,UAAU,yEAAyE,sCAExF,EAEAA,MAAC,OAAI,UAAU,wKACZ,SAAAyK,GAAqB,IAAI,CAACC,EAAa0H,IACtCtS,OAAC,OAEC,UAAU,2IACV,QAAS,IAAMoM,GAAuBxB,CAAW,EAEjD,UAAA5K,OAAC,OAAI,UAAU,0BACZ,UAAAgL,GAAcJ,EAAY,OAAQA,EAAY,IAAI,SAClD,OACC,UAAA1K,MAAC,KAAE,UAAW,uBAAuB0K,EAAY,OAAS,WAAa,eAAiB,gBAAgB,GACrG,SAAAA,EAAY,OAAS,WAClBA,EAAY,cACZ,GAAGA,EAAY,WAAW,MAAMA,EAAY,aAAa,GAE/D,EACCA,EAAY,OAAS,YACpB5K,OAAAC,WAAA,CACE,UAAAD,OAAC,KAAE,UAAU,qCACV,UAAAuS,EAAoB3H,EAAY,MAAM,EAAE,SAC3C,EACA5K,OAAC,KAAE,UAAU,uBAAuB,oBAC1BuS,EAAoB3H,EAAY,YAAc,CAAC,EAAE,SAC3D,GACF,EAEF5K,OAAC,KAAE,UAAW,eAAe4K,EAAY,OAAS,WAAa,eAAiB,gBAAgB,GAAI,yBACrFA,EAAY,aAAe,kBAC1C,EACA1K,MAAC,KAAE,UAAW,WAAW0K,EAAY,OAAS,WAAa,eAAiB,gBAAgB,GACzF,SAAAA,EAAY,UAAU,eAAe,OAAO,EAC/C,GACF,GACF,EACA5K,OAAC,OAAI,UAAU,aACZ,UAAA4K,EAAY,OAAS,YACpB5K,OAAC,KAAE,UAAU,mCACV,UAAAuS,EAAoB3H,EAAY,MAAM,EAAE,SAC3C,EAEDA,EAAY,iBACX5K,OAAC,KAAE,UAAU,uBAAuB,oBAC1BuS,EAAoB3H,EAAY,eAAe,EAAE,SAC3D,EAEDA,EAAY,YACX5K,OAAC,KAAE,UAAU,yBAAyB,mBAC7BuS,EAAoB3H,EAAY,UAAU,EAAE,SACrD,EAEF1K,MAACsS,GAAA,CACC,QAAS5H,EAAY,SAAW,YAAc,UAAY,YAC1D,UAAW,WAAWA,EAAY,SAAW,YAAeA,EAAY,OAAS,WAAa,yCAA4CA,EAAY,OAAS,OAAS,+CAAiD,GAAQA,EAAY,OAAS,WAAa,0BAA4B,EAAG,GAEjS,WAAY,OAAS,WAAa,MAAQQ,GAAcR,EAAY,MAAM,GAC7E,EACF,IArDKA,EAAY,GAuDpB,EACH,EAEJ,EAEA1K,MAACmS,GAAA,CAAY,MAAM,OAAO,UAAU,qBACjC,SAAAjI,GAAsB,OAAOzK,GAAKA,EAAE,OAAS,MAAM,EAAE,SAAW,EAC/DO,MAAC,OAAI,UAAU,yEAAyE,4CAExF,EAEAA,MAAC,OAAI,UAAU,wKACZ,SAAAkK,GAAsB,OAAOzK,GAAKA,EAAE,OAAS,MAAM,EAAE,IAAI,CAACiL,EAAa0H,IACtEtS,OAAC,OAEC,UAAU,sJACV,QAAS,IAAMoM,GAAuBxB,CAAW,EAGjD,UAAA1K,MAAC,OAAI,UAAU,+EACZ,eAACuS,GAAA,CAAa,UAAU,yBAAyB,EACpD,EAGAzS,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,OAAI,UAAU,yCACb,UAAAE,MAAC,MAAG,UAAU,+CACV,SAAA0K,EAAY,cAChB,EACA5K,OAAC,QAAK,UAAU,uDAAuD,eAClEuS,EAAoB3H,EAAY,MAAM,EAAE,QAC7C,GACF,EAEA5K,OAAC,OAAI,UAAU,oCACZ,UAAAA,OAAC,OAAI,UAAU,wBACZ,UAAAA,OAAC,KAAE,UAAU,yCAAyC,kBAC7C4K,EAAY,eACrB,EACA1K,MAAC,KAAE,UAAU,2CACT,WAAY,UAAU,eAAe,QAAS,CAAE,IAAK,UAAW,MAAO,QAAS,KAAM,UAAW,OAAQ,UAAW,OAAQ,GAAM,EACtI,GACH,EAEAF,OAAC,OAAI,UAAW,wEACb4K,EAAY,SAAW,YACnB,6BACAA,EAAY,SAAW,UACvB,+BACA,wBACP,GACI,UAAAA,EAAY,SAAW,aAAe1K,MAACwS,GAAA,CAAM,UAAU,UAAU,EACjE9H,EAAY,SAAW,WAAa1K,MAACQ,GAAA,CAAM,UAAU,UAAU,EAC/DkK,EAAY,SAAW,UAAY1K,MAACyS,GAAA,CAAE,UAAU,UAAU,EAC3DzS,MAAC,QACG,SAAAkL,GAAcR,EAAY,MAAM,EACpC,GACH,GACH,GACF,IA7CKA,EAAY,GA+CpB,EACH,EAEJ,EAEA1K,MAACmS,GAAA,CAAY,MAAM,WAAW,UAAU,qBACrC,SAAAjI,GAAsB,OAAOzK,GAAKA,EAAE,OAAS,UAAU,EAAE,SAAW,EACnEO,MAAC,OAAI,UAAU,yEAAyE,0CAExF,EAEAA,MAAC,OAAI,UAAU,0IACZ,SAAAkK,GAAsB,OAAOzK,GAAKA,EAAE,OAAS,UAAU,EAAE,IAAI,CAACiL,EAAa0H,IAC1EtS,OAAC,OAEC,UAAU,sJACV,QAAS,IAAMoM,GAAuBxB,CAAW,EAGjD,UAAA1K,MAAC,OAAI,UAAU,6EACZ,eAACS,GAAA,CAAc,UAAU,uBAAuB,EACnD,EAGAX,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,OAAI,UAAU,yCACb,UAAAE,MAAC,MAAG,UAAU,+CACV,SAAA0K,EAAY,cAChB,EACA5K,OAAC,QAAK,UAAU,qDAAqD,eAChEuS,EAAoB3H,EAAY,MAAM,EAAE,QAC7C,GACF,EAEA5K,OAAC,OAAI,UAAU,oCACZ,UAAAA,OAAC,OAAI,UAAU,wBACZ,UAAAA,OAAC,KAAE,UAAU,yCAAyC,iBAC9C4K,EAAY,aACpB,EACA1K,MAAC,KAAE,UAAU,2CACT,WAAY,UAAU,eAAe,QAAS,CAAE,IAAK,UAAW,MAAO,QAAS,KAAM,UAAW,OAAQ,UAAW,OAAQ,GAAM,EACtI,GACH,EAEAF,OAAC,OAAI,UAAW,wEACb4K,EAAY,SAAW,YACnB,yBACAA,EAAY,SAAW,UACvB,+BACA,wBACP,GACI,UAAAA,EAAY,SAAW,aAAe1K,MAACwS,GAAA,CAAM,UAAU,UAAU,EACjE9H,EAAY,SAAW,WAAa1K,MAACQ,GAAA,CAAM,UAAU,UAAU,EAC/DkK,EAAY,SAAW,UAAY1K,MAACyS,GAAA,CAAE,UAAU,UAAU,EAC3DzS,MAAC,QACG,SAAAkL,GAAcR,EAAY,MAAM,EACpC,GACH,GACH,GACF,IA7CKA,EAAY,GA+CpB,EACH,EAEJ,EACA1K,MAACmS,IAAY,MAAM,UAAU,UAAU,OACpC,SAAA9P,EAAoB,SAAW,EAC9BrC,MAAC,OAAI,UAAU,yEAAyE,kCAExF,EAEAA,MAAC,OAAI,UAAU,0IACZ,SAAAqC,EAAoB,IAAI,CAACqI,EAAa0H,IACrCtS,OAAC,OAEC,UAAU,uEAEV,UAAAA,OAAC,OAAI,UAAU,0BACZ,UAAAgL,GAAcJ,EAAY,OAAQA,EAAY,IAAI,SAClD,OACC,UAAA1K,MAAC,KAAE,UAAU,mCACV,SAAA0K,EAAY,OAAS,WAClBA,EAAY,cACZ,GAAGA,EAAY,WAAW,MAAMA,EAAY,aAAa,GAE/D,EACCA,EAAY,OAAS,YACpB5K,OAAAC,WAAA,CACE,UAAAD,OAAC,KAAE,UAAU,qCACV,UAAAuS,EAAoB3H,EAAY,MAAM,EAAE,SAC3C,EACA5K,OAAC,KAAE,UAAU,0BAA0B,oBAC7BuS,EAAoB3H,EAAY,YAAc,CAAC,EAAE,SAC3D,GACF,EAEF5K,OAAC,KAAE,UAAU,2BAA2B,yBACzB4K,EAAY,aAAe,kBAC1C,EACA1K,MAAC,KAAE,UAAU,uBACV,WAAY,UAAU,eAAe,OAAO,EAC/C,GACF,GACF,EACAF,OAAC,OAAI,UAAU,0BACb,UAAAA,OAAC,OAAI,UAAU,kBACZ,UAAA4K,EAAY,OAAS,YACpB5K,OAAC,KAAE,UAAU,iCACV,UAAAuS,EAAoB3H,EAAY,MAAM,EAAE,SAC3C,EAEF1K,MAAC,YAAW,QAAQ,QAAQ,KAAK,QAAQ,GAC3C,EACAA,MAACC,EAAA,CACC,QAAQ,QACR,KAAK,KACL,UAAU,8FACV,QAAS,IAAMmM,GAAwB1B,CAAW,EAElD,SAAA1K,MAAC,QAAK,UAAU,qBAAqB,mBAAO,IAE9CA,MAACC,EAAA,CACC,QAAQ,QACR,KAAK,KACL,UAAU,0FACV,QAAS,IAAM0M,GAA6BjC,EAAY,EAAE,EAE1D,SAAA1K,MAAC8R,GAAA,CAAO,UAAU,wBAAwB,GAC5C,EACF,IAvDKpH,EAAY,GAyDpB,EACH,EAEJ,GACF,EACJ,GACD,EAGC1K,MAACG,IAAO,KAAMwD,GAAa,aAAcC,GACvC,SAAA9D,OAACM,GAAA,CAAc,UAAU,yEACvB,UAAAJ,MAACK,GAAA,CAAa,UAAU,YACtB,SAAAL,MAACM,IAAY,UAAU,oBAAqB,SAAAyD,IAAc,cAAc,EAC1E,EACA/D,MAAC,OAAI,UAAU,+BACZ,SAAA6D,GACC7D,MAAC,UACC,IAAK+G,GAAelD,EAAQ,EAC5B,MAAM,oBACN,UAAU,gBACV,MAAM,sGACN,gBAAe,KAGjB7D,MAAC,OAAI,UAAU,wDAAwD,qCAAyB,EAEpG,GACF,EACF,EAGAA,MAAC0S,GAAA,CAAkB,KAAMxN,GAAmB,aAAcC,EAAA,CAAsB,GAClF,EAGAnF,MAAC2S,GAAA,CACC,OAAQ3N,GACR,QAAS,IAAMC,GAAqB,EAAK,IAE3CjF,MAACY,GAAA,CACC,KAAMkE,GACN,aAAcC,GACd,KAAK,SACL,MAAM,kCACN,YAAY,4CACZ,UAAW,IAAM,CACfA,GAA6B,EAAK,EAElC/D,EAAS,QAAS,CAAE,MAAO,CAAE,eAAgB,IAAQ,CACvD,IAEFhB,MAAC4S,GAAA,CACC,KAAMpN,GACN,aAAcC,GACd,MAAM,sDACN,YAAY,8GACZ,UAAW,SAAY,CACrB,GAAI,CACF,GAAI,EAACvE,GAAA,MAAAA,EAAM,KAAK,CACduE,GAA2B,EAAK,EAChC,MACF,CACA,MAAMoN,MAAc,KACd5M,EAAYC,GAAYA,aAAa,KAAQA,EAAK,OAAOA,GAAA,YAAAA,EAAG,SAAW,WAAcA,EAAE,SAAW,IAAI,KAAK,OAAOA,CAAC,CAAC,EAK1H,MAAML,EAAgB,eAAe3E,EAAK,IAAK,CAC7C,YAAa,CACX,cAAewE,GAAkB,eAAiB,GAClD,aAAcA,GAAkB,cAAgB,EAChD,YAAamN,CAAA,CACf,CACD,EACDlN,OAA6B,CAAE,GAAGmN,EAAK,YAAaD,GAAU,EAE9DnU,EAAM,CAAE,MAAO,6BAA8B,YAAa,4GAA6G,CACzK,OAAS,EAAG,CACV,QAAQ,MAAM,6BAA8B,CAAC,EAC7CA,EAAM,CAAE,MAAO,cAAe,YAAa,mCAAoC,QAAS,cAAe,CACzG,SACE+G,GAA2B,EAAK,CAClC,CACF,UAIDtF,GAAA,CAAO,KAAMgH,GAAa,aAAe4L,GAAS,SACjD,GAAIA,EAAM,CACR,MAAMxC,EAAe,2BACfC,GAAYjP,GAAAD,EAAAmP,GAAK,cAAL,YAAAnP,EAAkB,QAAlB,YAAAC,EAAyB,cAC3C,GAAI,CAACiP,GAAaA,IAAcD,EAAc,CAC5C7R,EAAM,CAAE,MAAO,cAAe,YAAa,iCAAkC,EAC7E,MACF,CACA0I,GAAe,EAAI,CACrB,MACEA,GAAe,EAAK,CAExB,EACE,SAAAtH,OAACM,GAAA,CAAc,IAAI,MAAM,UAAU,cACjC,UAAAJ,MAACK,GAAA,CACC,SAAAL,MAACM,GAAA,CAAY,6BAAiB,EAChC,EAEAR,OAAC,OAAI,UAAU,YACb,UAAAA,OAAC,OACC,UAAAE,MAAC,SAAM,UAAU,wBAAwB,wBAAY,EACrDA,MAACqR,GAAA,CACC,MAAOhK,GACP,SAAW,GAAMC,GAAc,EAAE,OAAO,KAAK,EAC7C,YAAY,cACZ,IAAI,OACN,EACF,SAEC,OACC,UAAAtH,MAAC,SAAM,UAAU,wBAAwB,kBAAM,EAC/CF,OAACkT,GAAA,CAAO,MAAOzL,GAAe,cAAeC,GAC3C,UAAAxH,MAACiT,IAAc,UAAU,SACvB,eAACC,GAAA,CAAY,YAAY,cAAc,EACzC,SACCC,GAAA,CACC,UAAAnT,MAACoT,GAAA,CAAW,MAAM,cAAc,mBAAO,EACvCpT,MAACoT,GAAA,CAAW,MAAM,YAAY,iBAAK,EACnCpT,MAACoT,GAAA,CAAW,MAAM,cAAc,mBAAO,EACvCpT,MAACoT,GAAA,CAAW,MAAM,QAAQ,cAAE,GAC9B,GACF,GACF,SAEC,OACC,UAAApT,MAAC,SAAM,UAAU,wBAAwB,0BAAc,EACvDA,MAACqR,GAAA,CACC,KAAK,SACL,IAAK,EACL,MAAO5J,GACP,SAAW,GAAMC,GAAe,EAAE,OAAO,MAAQ,OAAO,EAAE,OAAO,KAAK,EAAI,EAAE,EAC5E,YAAY,MACd,EACF,EAEA5H,OAAC,OAAI,UAAU,+CACb,UAAAE,MAACC,EAAA,CAAO,QAAQ,UAAU,QAAS,IAAMmH,GAAe,EAAK,EAAG,iBAAK,EACrEtH,OAAC,OAAI,UAAU,0BACb,UAAAE,MAACC,EAAA,CAAO,QAAQ,YAAY,QAAS,IAAMe,EAAS,QAAQ,EAAG,8BAAkB,EACjFhB,MAACC,EAAA,CAAO,QAASqQ,GAAa,SAAU3I,IAAgB,CAACN,IAAc,CAACE,IAAiB,CAACE,GACvF,SAAAE,GAAe,kBAAoB,cACtC,GACF,GACF,GACF,GACF,EACF,EAGA3H,MAACG,IAAO,KAAMsC,GAAsB,aAAcC,EAChD,SAAA5C,OAACM,GAAA,CAAc,UAAU,mBACvB,UAAAN,OAACO,GAAA,CACC,UAAAL,MAACM,IAAY,iCAAqB,EAClCN,MAACqT,IAAkB,2DAEnB,GACF,EACC1Q,GACC7C,OAAC,OAAI,UAAU,yBACb,UAAAA,OAAC,OAAI,UAAU,oCACb,UAAAE,MAAC,QAAK,UAAU,gBAAgB,kBAAM,EACtCF,OAAC,QAAK,UAAU,YAAa,UAAA6C,EAAiB,OAAO,SAAK,GAC5D,EACCA,EAAiB,OAAS,WACzB7C,OAAC,OAAI,UAAU,oCACb,UAAAE,MAAC,QAAK,UAAU,gBAAgB,kBAAM,EACtCA,MAAC,QAAK,UAAU,cAAe,WAAiB,cAAc,GAChE,EAEAF,OAAC,OAAI,UAAU,oCACb,UAAAE,MAAC,QAAK,UAAU,gBAAgB,oBAAQ,EACxCF,OAAC,QAAK,UAAU,cAAe,UAAA6C,EAAiB,YAAY,MAAIA,EAAiB,eAAc,GACjG,EAEF7C,OAAC,OAAI,UAAU,oCACb,UAAAE,MAAC,QAAK,UAAU,gBAAgB,mBAAO,QACtC,QAAK,UAAU,cAAe,SAAA2C,EAAiB,aAAe,iBAAiB,GAClF,EACA7C,OAAC,OAAI,UAAU,oCACb,UAAAE,MAAC,QAAK,UAAU,gBAAgB,mBAAO,EACvCA,MAAC,QAAK,UAAU,cAAe,WAAiB,UAAU,eAAe,OAAO,EAAE,GACpF,GACF,EAEFF,OAAC,OAAI,UAAU,+CACb,UAAAE,MAACC,EAAA,CAAO,QAAQ,UAAU,QAAS,IAAM,CAAEyC,EAAwB,EAAK,EAAGE,EAAoB,IAAI,CAAG,EAAG,iBAAK,EAC9G5C,MAACC,EAAA,CAAO,QAASoM,GAAsB,2BAAe,GACxD,GACF,EACF,EAEArM,MAACsT,GAAA,CACC,OAAQlO,GACR,QAAS,IAAMC,GAAiB,EAAK,EACrC,YAAaC,GACb,QAAS,IAAM,OAAO,QACtB,SAAUqJ,GACV,WAAY/B,EAAA,GAGd5M,MAACY,GAAA,CACC,KAAM2C,EACN,aAAcC,EACd,KAAK,SACL,MAAM,oBACN,YAAY,oDACZ,UAAW,IAAM,CACfA,EAAwB,EAAK,EAC7BE,GAA0B,EAAI,CAChC,IAGF1D,MAACuT,GAAA,CACC,KAAM9P,GACN,aAAcC,EAAA,EAChB,EACF,CAEF","names":["__iconNode","CirclePlay","createLucideIcon","TotalProfitDisplayDialog","userId","transactions","isOpen","setIsOpen","useState","isMasterPinDialogOpen","setIsMasterPinDialogOpen","isAuthenticated","setIsAuthenticated","totals","setTotals","userSubscription","useFirebaseAuth","useEffect","loadTotals","formatCurrency","amount","isZeroPlan","localSub","rawLocal","planLocalStr","SubscriptionPlan","remoteSub","getUserSubscription","rawRemote","planRemoteStr","handleEyeClick","isTahweela","toast","handlePinSuccess","today","currentMonth","currentYear","visibleDaily","reportsService","visibleMonthly","dailyWithdrawProfit","dailyTransferProfit","monthlyWithdrawProfit","monthlyTransferProfit","tx","txDate","status","t","txForCalc","ProfitService","profits","e","jsxs","Fragment","jsx","Button","Eye","Dialog","DialogContent","DialogHeader","DialogTitle","DollarSign","Clock","ArrowDownLeft","ArrowRightLeft","Calendar","MasterPinDialog","TotalProfitEyeButton","props","TransactionsPage","navigate","useNavigate","user","profile","React","planRaw","_a","_b","_c","_d","isTahweelaPlan","_e","_f","_g","_h","shopName","useShop","isShiftActive","shiftUser","useShift","setTransactions","deletedTransactions","setDeletedTransactions","permDeletedSet","setPermDeletedSet","isRestoreConfirmOpen","setIsRestoreConfirmOpen","pendingRestoreTx","setPendingRestoreTx","activeTab","setActiveTab","searchPhone","setSearchPhone","selectedDate","setSelectedDate","selectedTime","setSelectedTime","isCalculatorOpen","setIsCalculatorOpen","isInstallmentPinOpen","setIsInstallmentPinOpen","isInstallmentModalOpen","setIsInstallmentModalOpen","isGuideOpen","setIsGuideOpen","guideUrl","setGuideUrl","guideTitle","setGuideTitle","guidePublishedAt","setGuidePublishedAt","lastTutorialSeenAt","setLastTutorialSeenAt","hasNewGuide","setHasNewGuide","_i","isSalesDataOpen","setIsSalesDataOpen","isDatePickerOpen","setIsDatePickerOpen","isDebtsDialogOpen","setIsDebtsDialogOpen","isDebtsPasswordDialogOpen","setIsDebtsPasswordDialogOpen","isCreditCardsOpen","setIsCreditCardsOpen","isMaintenanceOpen","setIsMaintenanceOpen","isReceiptOpen","setIsReceiptOpen","receiptTransaction","setReceiptTransaction","isResetRecentDialogOpen","setIsResetRecentDialogOpen","recentResetConfig","setRecentResetConfig","data","userDataService","raw","keep","interval","toJsDate","v","last","now","userRef","doc","db","snap","getDoc","dt","url","title","rawPub","pub","toYouTubeEmbed","u","id","openGuide","isTopUpOpen","setIsTopUpOpen","topupPhone","setTopupPhone","topupOperator","setTopupOperator","topupAmount","setTopupAmount","topupLoading","setTopupLoading","pendingDebtsCount","setPendingDebtsCount","count","loadTransactions","loadDeletedTransactions","q","fsQuery","collection","where","getDocs","keys","d","arr","prev","next","k","tid","ref","fetchedTransactions","refetchTransactions","isFetching","useQuery","primary","alt","permKeysRes","txns","permSet","filtered","locals","merged","getKey","seen","normalizeTransaction","error","distinct","deletedWithDates","auditLogService","effectiveTransactions","monthStart","nextMonthStart","a","b","timeA","hiddenCount","filteredTransactions","transaction","phoneMatch","dateMatch","timeMatch","getStatusIcon","type","CheckCircle","XCircle","getStatusText","statusRaw","normalizedStatus","typeRaw","normalizedType","sender","receiver","createdAtVal","createdAt","mapToReceiptTransaction","p","short","desc","rawTitle","isMachineTransfer","baseTitle","handleTransactionClick","receiptData","handleOpenRestoreDialog","handleConfirmRestore","restoreTransaction","transactionId","transactionToRestore","newId","restored","permanentlyDeleteTransaction","handleCompleteReceipt","plan","dailyOperationCountService","__vitePreload","opType","limitErr","userProfile","profileService","dataRef","dataSnap","cashBalance","walletBalances","fromWalletIdForLimits","alreadyReservedLimits","checkAmt","checkType","walletDailyLimitsService","n","can","didAddCashNow","fromWalletId","commission","alreadyAppliedOnCreationWallet","alreadyAppliedOnCreationCash","current","updateDoc","fee","amountToAdd","toAdd","amt","profit","handleDeleteReceipt","finalStatus","rawTx","s","originalId","linkedTxnId","linkedRef","wasAppliedOnCreation","sentAmount","ReportsService","transactionData","autoTestRanRef","useRef","location","useLocation","snapBefore","beforeCash","beforeWallets","snapAfterComplete","afterCashComplete","afterWalletsComplete","expectedCashAfter","expectedWalletAfter","snapAfterDelete","afterCashDelete","afterWalletsDelete","err","submitTopUp","allowedEmail","userEmail","auth","operatorToSend","controller","timeout","idToken","resp","rawText","ArrowLeft","Card","CardHeader","CardTitle","Search","Input","PlayCircle","BadgePercent","Calculator","BarChart","FileText","Wrench","BatteryCharging","CreditCard","Trash2","CardContent","Tabs","TabsList","TabsTrigger","TabsContent","index","formatNumberEnglish","Badge","ArrowUpRight","Check","X","MaintenanceDialog","CreditCardsDialog","PasswordConfirmDialog","resetAt","cfg","open","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","DialogDescription","ReceiptModal","InstallmentModal"],"ignoreList":[0],"sources":["../../node_modules/lucide-react/dist/esm/icons/circle-play.js","../../src/components/TotalProfitDisplayDialog.tsx","../../src/pages/TransactionsPage.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z\",\n      key: \"kmsa83\"\n    }\n  ],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }]\n];\nconst CirclePlay = createLucideIcon(\"circle-play\", __iconNode);\n\nexport { __iconNode, CirclePlay as default };\n//# sourceMappingURL=circle-play.js.map\n","import React, { useEffect, useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Eye, DollarSign, ArrowDownLeft, ArrowRightLeft, Calendar, Clock } from 'lucide-react';\r\nimport { ProfitService } from '@/utils/profitService';\r\nimport { reportsService } from '@/utils/reportsService';\r\nimport { MasterPinDialog } from './MasterPinDialog';\r\nimport { toast } from '@/hooks/use-toast';\r\nimport { getUserSubscription, SubscriptionPlan } from '@/utils/subscriptionService';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\n\r\ninterface TotalProfitDisplayDialogProps {\r\n  userId?: string;\r\n  transactions?: any[];\r\n}\r\n\r\ninterface TotalsData {\r\n  dailyWithdraw: number;\r\n  dailyTransfer: number;\r\n  monthlyWithdraw: number;\r\n  monthlyTransfer: number;\r\n  lastUpdated: Date;\r\n}\r\n\r\nconst TotalProfitDisplayDialog: React.FC<TotalProfitDisplayDialogProps> = ({ userId, transactions = [] }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isMasterPinDialogOpen, setIsMasterPinDialogOpen] = useState(false);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [totals, setTotals] = useState<TotalsData>({\r\n    dailyWithdraw: 0,\r\n    dailyTransfer: 0,\r\n    monthlyWithdraw: 0,\r\n    monthlyTransfer: 0,\r\n    lastUpdated: new Date(),\r\n  });\r\n  const { userSubscription } = useFirebaseAuth();\r\n\r\n  useEffect(() => {\r\n    if (userId && isOpen && isAuthenticated) {\r\n      loadTotals();\r\n    }\r\n  }, [userId, isOpen, isAuthenticated]);\r\n\r\n  const formatCurrency = (amount: number) => `${amount.toFixed(2)} .`;\r\n\r\n  const isZeroPlan = async (): Promise<boolean> => {\r\n    try {\r\n      const localSub: any = (userSubscription as any)?.subscription || null;\r\n      const rawLocal: any = localSub?.planType ?? localSub?.plan ?? null;\r\n      const planLocalStr = typeof rawLocal === 'string' ? rawLocal.toLowerCase() : null;\r\n      if (rawLocal === SubscriptionPlan.ZERO || planLocalStr === 'zero' || planLocalStr === '0' || rawLocal === 0) {\r\n        return true;\r\n      }\r\n    } catch {}\r\n\r\n    try {\r\n      if (userId) {\r\n        const remoteSub: any = await getUserSubscription(userId);\r\n        const rawRemote: any = remoteSub?.planType ?? remoteSub?.plan ?? null;\r\n        const planRemoteStr = typeof rawRemote === 'string' ? rawRemote.toLowerCase() : null;\r\n        if (rawRemote === SubscriptionPlan.ZERO || planRemoteStr === 'zero' || planRemoteStr === '0' || rawRemote === 0) {\r\n          return true;\r\n        }\r\n      }\r\n    } catch {}\r\n\r\n    return false;\r\n  };\r\n\r\n  const handleEyeClick = async () => {\r\n    try {\r\n      const isTahweela = await (async () => {\r\n        try {\r\n          const localSub: any = (userSubscription as any)?.subscription || null;\r\n          const rawLocal: any = localSub?.planType ?? localSub?.plan ?? null;\r\n          const planLocalStr = typeof rawLocal === 'string' ? rawLocal.toLowerCase() : null;\r\n          if (rawLocal === SubscriptionPlan.TAHWEELA || planLocalStr === 'tahweela') return true;\r\n        } catch {}\r\n        try {\r\n          if (userId) {\r\n            const remoteSub: any = await getUserSubscription(userId);\r\n            const rawRemote: any = remoteSub?.planType ?? remoteSub?.plan ?? null;\r\n            const planRemoteStr = typeof rawRemote === 'string' ? rawRemote.toLowerCase() : null;\r\n            if (rawRemote === SubscriptionPlan.TAHWEELA || planRemoteStr === 'tahweela') return true;\r\n          }\r\n        } catch {}\r\n        return false;\r\n      })();\r\n      if (await isZeroPlan() || isTahweela) {\r\n        toast({\r\n          title: '  ',\r\n          description: '       .',\r\n          variant: 'destructive',\r\n        });\r\n        return;\r\n      }\r\n    } catch {}\r\n    setIsMasterPinDialogOpen(true);\r\n  };\r\n\r\n  const handlePinSuccess = async () => {\r\n    try {\r\n      const isTahweela = await (async () => {\r\n        try {\r\n          const localSub: any = (userSubscription as any)?.subscription || null;\r\n          const rawLocal: any = localSub?.planType ?? localSub?.plan ?? null;\r\n          const planLocalStr = typeof rawLocal === 'string' ? rawLocal.toLowerCase() : null;\r\n          if (rawLocal === SubscriptionPlan.TAHWEELA || planLocalStr === 'tahweela') return true;\r\n        } catch {}\r\n        try {\r\n          if (userId) {\r\n            const remoteSub: any = await getUserSubscription(userId);\r\n            const rawRemote: any = remoteSub?.planType ?? remoteSub?.plan ?? null;\r\n            const planRemoteStr = typeof rawRemote === 'string' ? rawRemote.toLowerCase() : null;\r\n            if (rawRemote === SubscriptionPlan.TAHWEELA || planRemoteStr === 'tahweela') return true;\r\n          }\r\n        } catch {}\r\n        return false;\r\n      })();\r\n      if (await isZeroPlan() || isTahweela) {\r\n        toast({\r\n          title: '  ',\r\n          description: '       .',\r\n          variant: 'destructive',\r\n        });\r\n        setIsMasterPinDialogOpen(false);\r\n        return;\r\n      }\r\n    } catch {}\r\n\r\n    setIsAuthenticated(true);\r\n    setIsOpen(true);\r\n    setIsMasterPinDialogOpen(false);\r\n  };\r\n\r\n  const loadTotals = async () => {\r\n    if (!userId) return;\r\n\r\n    try {\r\n      if (Array.isArray(transactions) && transactions.length > 0) {\r\n        const today = new Date();\r\n        const currentMonth = today.getMonth();\r\n        const currentYear = today.getFullYear();\r\n\r\n        const visibleDaily = reportsService.filterVisibleTransactions(transactions as any[], 'daily', userId);\r\n        const visibleMonthly = reportsService.filterVisibleTransactions(transactions as any[], 'monthly', userId);\r\n\r\n        let dailyWithdrawProfit = 0;\r\n        let dailyTransferProfit = 0;\r\n        let monthlyWithdrawProfit = 0;\r\n        let monthlyTransferProfit = 0;\r\n\r\n        visibleDaily.forEach((tx: any) => {\r\n          const txDate = new Date(tx.createdAt);\r\n          const status = String(tx.status || 'confirmed').toLowerCase();\r\n          if (txDate.toDateString() !== today.toDateString()) return;\r\n          if (status !== 'completed' && status !== 'confirmed' && status !== 'pending') return;\r\n\r\n          const t = (tx.type || tx.txnType || '').toLowerCase();\r\n          const txForCalc = {\r\n            type: t === 'withdrawal' ? 'withdraw' : t,\r\n            amount: Number(tx.amount || 0),\r\n            commission: tx.commission,\r\n          };\r\n\r\n          if (txForCalc.type === 'withdraw') {\r\n            dailyWithdrawProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          } else if (txForCalc.type === 'send' || txForCalc.type === 'receive' || txForCalc.type === 'transfer') {\r\n            dailyTransferProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          }\r\n        });\r\n\r\n        visibleMonthly.forEach((tx: any) => {\r\n          const txDate = new Date(tx.createdAt);\r\n          const status = String(tx.status || 'confirmed').toLowerCase();\r\n          if (txDate.getMonth() !== currentMonth || txDate.getFullYear() !== currentYear) return;\r\n          if (status !== 'completed' && status !== 'confirmed' && status !== 'pending') return;\r\n\r\n          const t = (tx.type || tx.txnType || '').toLowerCase();\r\n          const txForCalc = {\r\n            type: t === 'withdrawal' ? 'withdraw' : t,\r\n            amount: Number(tx.amount || 0),\r\n            commission: tx.commission,\r\n          };\r\n\r\n          if (txForCalc.type === 'withdraw') {\r\n            monthlyWithdrawProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          } else if (txForCalc.type === 'send' || txForCalc.type === 'receive' || txForCalc.type === 'transfer') {\r\n            monthlyTransferProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          }\r\n        });\r\n\r\n        setTotals({\r\n          dailyWithdraw: Math.round(dailyWithdrawProfit * 100) / 100,\r\n          dailyTransfer: Math.round(dailyTransferProfit * 100) / 100,\r\n          monthlyWithdraw: Math.round(monthlyWithdrawProfit * 100) / 100,\r\n          monthlyTransfer: Math.round(monthlyTransferProfit * 100) / 100,\r\n          lastUpdated: new Date(),\r\n        });\r\n        return;\r\n      }\r\n\r\n      const profits = ProfitService.getWithdrawTransferProfits(userId);\r\n      setTotals({\r\n        dailyWithdraw: profits.dailyWithdrawProfit || 0,\r\n        dailyTransfer: profits.dailyTransferProfit || 0,\r\n        monthlyWithdraw: profits.monthlyWithdrawProfit || 0,\r\n        monthlyTransfer: profits.monthlyTransferProfit || 0,\r\n        lastUpdated: new Date(),\r\n      });\r\n    } catch (e) {\r\n      console.error('Error loading total profits:', e);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        size=\"sm\"\r\n        variant=\"ghost\"\r\n        onClick={handleEyeClick}\r\n        className=\"h-2 w-2 p-0 bg-gradient-to-r from-blue-100 to-purple-200 text-purple-700 hover:from-blue-200 hover:to-purple-300 hover:text-purple-800 rounded transition-all duration-300 hover:scale-110 shadow-sm hover:shadow-md\"\r\n        title=\"  \"\r\n      >\r\n        <Eye className=\"h-1.5 w-1.5\" />\r\n      </Button>\r\n\r\n      <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n        <DialogContent className=\"max-w-[240px] mx-auto bg-white dark:bg-[#0f172a] border border-gray-200 dark:border-slate-800 shadow-md rounded sm:max-w-[220px] sm:bg-gradient-to-br sm:from-purple-50 sm:to-white sm:dark:from-slate-900 sm:dark:to-slate-800 sm:border-2 sm:border-purple-200 sm:dark:border-slate-700 sm:shadow-2xl sm:rounded-2xl\">\r\n          <DialogHeader className=\"text-center pb-0 border-b-0 sm:pb-2 sm:border-b sm:border-purple-200 dark:border-slate-700\">\r\n            <DialogTitle className=\"text-xs font-bold text-purple-800 dark:text-purple-300 flex items-center justify-center gap-1 mb-0 leading-tight tracking-tight sm:text-xs sm:gap-1 sm:mb-0 sm:leading-normal sm:tracking-normal\">\r\n              <DollarSign className=\"h-2 w-2 text-purple-600 dark:text-purple-400 sm:h-3 sm:w-3\" />\r\n                ()\r\n            </DialogTitle>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-1 py-1 sm:space-y-2 sm:py-2\">\r\n            {/*   */}\r\n            <div className=\"bg-blue-50 dark:bg-blue-900/20 p-1 rounded border border-blue-200 dark:border-blue-900/30 sm:bg-gradient-to-r sm:from-blue-50 sm:to-blue-100 sm:dark:from-blue-900/20 sm:dark:to-blue-900/10 sm:p-2 sm:rounded-xl sm:shadow-sm\">\r\n              <div className=\"flex items-center justify-between mb-1\">\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Clock className=\"h-2 w-2 text-blue-600 dark:text-blue-400\" />\r\n                  <span className=\"text-[10px] font-semibold text-blue-800 dark:text-blue-300\"></span>\r\n                </div>\r\n                <span className=\"text-[10px] font-bold text-blue-900 dark:text-blue-100\">\r\n                  {formatCurrency((totals.dailyWithdraw ?? 0) + (totals.dailyTransfer ?? 0))}\r\n                </span>\r\n              </div>\r\n              <div className=\"grid grid-cols-2 gap-1\">\r\n                <div className=\"flex items-center justify-between bg-red-50 dark:bg-red-900/20 p-0.5 rounded border border-red-200 dark:border-red-900/30\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <ArrowDownLeft className=\"h-2 w-2 text-red-600 dark:text-red-400\" />\r\n                    <span className=\"text-[10px] text-red-800 dark:text-red-300\"></span>\r\n                  </div>\r\n                  <span className=\"text-[10px] font-bold text-red-700 dark:text-red-200\">{formatCurrency(totals.dailyWithdraw)}</span>\r\n                </div>\r\n                <div className=\"flex items-center justify-between bg-green-50 dark:bg-green-900/20 p-0.5 rounded border border-green-200 dark:border-green-900/30\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <ArrowRightLeft className=\"h-2 w-2 text-green-600 dark:text-green-400\" />\r\n                    <span className=\"text-[10px] text-green-800 dark:text-green-300\"></span>\r\n                  </div>\r\n                  <span className=\"text-[10px] font-bold text-green-700 dark:text-green-200\">{formatCurrency(totals.dailyTransfer)}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/*   */}\r\n            <div className=\"bg-purple-50 dark:bg-purple-900/20 p-1 rounded border border-purple-200 dark:border-purple-900/30 sm:bg-gradient-to-r sm:from-purple-50 sm:to-purple-100 sm:dark:from-purple-900/20 sm:dark:to-purple-900/10 sm:p-2 sm:rounded-xl sm:shadow-sm\">\r\n              <div className=\"flex items-center justify-between mb-1\">\r\n                <div className=\"flex items-center gap-1\">\r\n                  <Calendar className=\"h-2 w-2 text-purple-600 dark:text-purple-400\" />\r\n                  <span className=\"text-[10px] font-semibold text-purple-800 dark:text-purple-300\"></span>\r\n                </div>\r\n                <span className=\"text-[10px] font-bold text-purple-900 dark:text-purple-100\">\r\n                  {formatCurrency((totals.monthlyWithdraw ?? 0) + (totals.monthlyTransfer ?? 0))}\r\n                </span>\r\n              </div>\r\n              <div className=\"grid grid-cols-2 gap-1\">\r\n                <div className=\"flex items-center justify-between bg-red-50 dark:bg-red-900/20 p-0.5 rounded border border-red-200 dark:border-red-900/30\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <ArrowDownLeft className=\"h-2 w-2 text-red-600 dark:text-red-400\" />\r\n                    <span className=\"text-[10px] text-red-800 dark:text-red-300\"></span>\r\n                  </div>\r\n                  <span className=\"text-[10px] font-bold text-red-700 dark:text-red-200\">{formatCurrency(totals.monthlyWithdraw)}</span>\r\n                </div>\r\n                <div className=\"flex items-center justify-between bg-blue-50 dark:bg-blue-900/20 p-0.5 rounded border border-blue-200 dark:border-blue-900/30\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <ArrowRightLeft className=\"h-2 w-2 text-blue-600 dark:text-blue-400\" />\r\n                    <span className=\"text-[10px] text-blue-800 dark:text-blue-300\"></span>\r\n                  </div>\r\n                  <span className=\"text-[10px] font-bold text-blue-700 dark:text-blue-200\">{formatCurrency(totals.monthlyTransfer)}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {!isAuthenticated && (\r\n            <div className=\"absolute inset-0 bg-yellow-200/70 backdrop-blur-sm flex items-center justify-center rounded sm:rounded-2xl border border-yellow-300 pointer-events-auto\">\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                onClick={() => setIsMasterPinDialogOpen(true)}\r\n                className=\"p-2 bg-yellow-300/80 text-yellow-900 hover:bg-yellow-400/90 rounded-full shadow-sm hover:shadow-md transition-all duration-300\"\r\n                title=\"   \"\r\n              >\r\n                <Eye className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex justify-center pt-1 border-t-0 sm:pt-2 sm:border-t sm:border-purple-200\">\r\n            <Button\r\n              onClick={() => setIsOpen(false)}\r\n              className=\"bg-purple-600 hover:bg-purple-700 text-white px-4 py-1 rounded-xl text-xs sm:bg-gradient-to-r sm:from-purple-600 sm:to-purple-700 sm:hover:from-purple-700 sm:hover:to-purple-800 sm:px-4 sm:py-1 sm:rounded-xl sm:shadow-lg sm:hover:shadow-xl sm:transition-all sm:duration-300\"\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <MasterPinDialog\r\n        open={isMasterPinDialogOpen}\r\n        onOpenChange={setIsMasterPinDialogOpen}\r\n        onSuccess={handlePinSuccess}\r\n        description=\"          \"\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport const TotalProfitEyeButton: React.FC<TotalProfitDisplayDialogProps> = (props) => {\r\n  return <TotalProfitDisplayDialog {...props} />;\r\n};\r\n\r\nexport default TotalProfitDisplayDialog;\r\n","import React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport ReceiptModal from '@/components/ReceiptModal';\nimport InstallmentModal from '@/components/InstallmentModal';\nimport CreditCardsDialog from '@/components/CreditCardsDialog';\nimport MaintenanceDialog from '@/components/MaintenanceDialog';\nimport PasswordConfirmDialog from '@/components/PasswordConfirmDialog';\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\nimport { \n  ArrowLeft, \n  Search, \n  Calculator, \n  BarChart, \n  Calendar, \n  FileText, \n  Trash2,\n  CheckCircle,\n  Check,\n  Clock,\n  XCircle,\n  X,\n  Send,\n  ArrowDownLeft,\n  ArrowUpRight,\n  CreditCard,\n  Wrench,\n  BatteryCharging,\n  BadgePercent,\n  PlayCircle\n} from 'lucide-react';\nimport { TotalProfitEyeButton } from '@/components/TotalProfitDisplayDialog';\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\nimport { SubscriptionPlan } from '@/utils/subscriptionService';\nimport { useShift } from '@/contexts/ShiftContext';\nimport { useShop } from '@/hooks/useShop';\nimport { toast } from '@/hooks/use-toast';\nimport { userDataService, auditLogService } from '@/integrations/firebase/services';\nimport { db, auth } from '@/firebase';\nimport { collection, query as fsQuery, where, orderBy, doc, updateDoc, getDocs, deleteDoc, getDoc, getDocsFromCache, limit } from 'firebase/firestore';\nimport { formatAmount, formatNumberEnglish } from '@/utils/formatters';\nimport { profileService } from '@/integrations/firebase/services';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\n\ninterface Transaction {\n  id: string;\n  senderPhone: string;\n  receiverPhone: string;\n  amount: number;\n  status: 'pending' | 'completed' | 'cancelled';\n  type: 'send' | 'withdraw' | 'cash_addition';\n  createdAt: Date;\n  provider?: string;\n  reference?: string;\n  commission?: number;\n  fee?: number;\n  withdrawnAmount?: number;\n  sentAmount?: number;\n  fromWallet?: string;\n  cashierName?: string;\n  commissionMode?: 'add' | 'deduct';\n  totalCharged?: number;\n  walletEffectAppliedOnCreation?: boolean;\n  cashEffectAppliedOnCreation?: boolean;\n  limitsReservedOnCreation?: boolean;\n  limitReservedType?: 'transfer' | 'withdraw';\n  senderName?: string;\n  title?: string;\n  description?: string;\n}\n\nconst TransactionsPage: React.FC = () => {\n  const navigate = useNavigate();\n  const { user, profile, userSubscription } = useFirebaseAuth();\n\n  const isZeroPlan = React.useMemo(() => {\n    const planRaw = userSubscription?.subscription?.planType \n      ?? userSubscription?.subscription?.plan \n      ?? (profile as any)?.subscription?.planType \n      ?? (profile as any)?.subscription?.plan \n      ?? null;\n    return planRaw === SubscriptionPlan.ZERO || String(planRaw).toLowerCase() === 'zero';\n  }, [\n    userSubscription?.subscription?.planType,\n    userSubscription?.subscription?.plan,\n    (profile as any)?.subscription?.planType,\n    (profile as any)?.subscription?.plan\n  ]);\n  const isTahweelaPlan = React.useMemo(() => {\n    const planRaw = userSubscription?.subscription?.planType \n      ?? userSubscription?.subscription?.plan \n      ?? (profile as any)?.subscription?.planType \n      ?? (profile as any)?.subscription?.plan \n      ?? null;\n    return planRaw === SubscriptionPlan.TAHWEELA || String(planRaw).toLowerCase() === 'tahweela';\n  }, [\n    userSubscription?.subscription?.planType,\n    userSubscription?.subscription?.plan,\n    (profile as any)?.subscription?.planType,\n    (profile as any)?.subscription?.plan\n  ]);\n  const { shopName } = useShop();\n  const { isShiftActive, shiftUser } = useShift();\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\n  const [deletedTransactions, setDeletedTransactions] = useState<Transaction[]>([]);\n  const [permDeletedSet, setPermDeletedSet] = useState<Set<string>>(new Set());\n  const [isRestoreConfirmOpen, setIsRestoreConfirmOpen] = useState(false);\n  const [pendingRestoreTx, setPendingRestoreTx] = useState<Transaction | null>(null);\n  const [activeTab, setActiveTab] = useState('all');\n  const [searchPhone, setSearchPhone] = useState('');\n  const [selectedDate, setSelectedDate] = useState('');\n  const [selectedTime, setSelectedTime] = useState('');\n  const [isCalculatorOpen, setIsCalculatorOpen] = useState(false);\n  const [isInstallmentPinOpen, setIsInstallmentPinOpen] = useState(false);\n  const [isInstallmentModalOpen, setIsInstallmentModalOpen] = useState(false);\n  const [isGuideOpen, setIsGuideOpen] = useState(false);\n  const [guideUrl, setGuideUrl] = useState<string>('');\n  const [guideTitle, setGuideTitle] = useState<string>(' ');\n  const [guidePublishedAt, setGuidePublishedAt] = useState<Date | null>(null);\n  const [lastTutorialSeenAt, setLastTutorialSeenAt] = useState<Date | null>(null);\n  const [hasNewGuide, setHasNewGuide] = useState<boolean>(false);\n\n  React.useEffect(() => {\n    const plan = userSubscription?.subscription?.planType;\n    if (plan === SubscriptionPlan.TAHWEELA) {\n      toast({ title: '  ', description: '      .    / .' , variant: 'destructive' });\n      navigate('/user/dashboard');\n    }\n  }, [userSubscription?.subscription?.planType]);\n  const [isSalesDataOpen, setIsSalesDataOpen] = useState(false);\n  const [isDatePickerOpen, setIsDatePickerOpen] = useState(false);\n  const [isDebtsDialogOpen, setIsDebtsDialogOpen] = useState(false);\nconst [isDebtsPasswordDialogOpen, setIsDebtsPasswordDialogOpen] = useState(false);\n  const [isCreditCardsOpen, setIsCreditCardsOpen] = useState(false);\n  const [isMaintenanceOpen, setIsMaintenanceOpen] = useState(false);\n  const [isReceiptOpen, setIsReceiptOpen] = useState(false);\n  const [receiptTransaction, setReceiptTransaction] = useState<any | null>(null);\n  const [isResetRecentDialogOpen, setIsResetRecentDialogOpen] = useState(false);\n\n  //   :   Firestore   N  \n  const [recentResetConfig, setRecentResetConfig] = useState<{ keepLastCount: number; intervalDays: number; lastResetAt: Date | null }>({ keepLastCount: 30, intervalDays: 7, lastResetAt: null });\n  useEffect(() => {\n    const initWeeklyReset = async () => {\n      if (!user?.uid) return;\n      try {\n        const data = await userDataService.getUserData(user.uid);\n        const raw = (data?.recentReset || {}) as any;\n        const keep = Number(raw?.keepLastCount) > 0 ? Number(raw.keepLastCount) : 30;\n        const interval = Number(raw?.intervalDays) > 0 ? Number(raw.intervalDays) : 7;\n        const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : (v ? new Date(String(v)) : null);\n        const last: Date | null = raw?.lastResetAt ? toJsDate(raw.lastResetAt) : null;\n        const now = new Date();\n        const needReset = !last || (now.getTime() - last.getTime()) >= interval * 24 * 60 * 60 * 1000;\n        if (needReset) {\n          await userDataService.updateUserData(user.uid, { recentReset: { keepLastCount: keep, intervalDays: interval, lastResetAt: now } });\n          setRecentResetConfig({ keepLastCount: keep, intervalDays: interval, lastResetAt: now });\n        } else {\n          setRecentResetConfig({ keepLastCount: keep, intervalDays: interval, lastResetAt: last });\n        }\n      } catch {\n        //         \n        setRecentResetConfig({ keepLastCount: 30, intervalDays: 7, lastResetAt: null });\n      }\n    };\n    initWeeklyReset();\n  }, [user?.uid]);\n\n  //     ( )\n  useEffect(() => {\n    if (!user?.uid) return;\n    const fetchTutorialSeenAt = async () => {\n      try {\n        const userRef = doc(db, 'users', user.uid);\n        const snap = await getDoc(userRef);\n        const data: any = snap.exists() ? snap.data() : {};\n        const raw = data?.tutorialSeenAt;\n        const dt = raw?.toDate ? raw.toDate() : (raw ? new Date(raw) : null);\n        setLastTutorialSeenAt(dt);\n      } catch {}\n    };\n    fetchTutorialSeenAt();\n  }, [user?.uid]);\n\n  //    ( )\n  useEffect(() => {\n    const fetchGuide = async () => {\n      try {\n        const snap = await getDoc(doc(db, 'app_guides', 'latest'));\n        const data: any = snap.exists() ? snap.data() : null;\n        if (!data) { setGuideUrl(''); setGuideTitle(''); setGuidePublishedAt(null); setHasNewGuide(false); return; }\n        const url: string = String(data.url || '');\n        const title: string = String(data.title || ' ');\n        const rawPub = data.publishedAt;\n        const pub: Date | null = rawPub?.toDate ? rawPub.toDate() : (rawPub ? new Date(rawPub) : new Date());\n        setGuideUrl(url);\n        setGuideTitle(title);\n        setGuidePublishedAt(pub);\n        setHasNewGuide(pub ? (!lastTutorialSeenAt || (pub.getTime() > (lastTutorialSeenAt?.getTime() || 0))) : false);\n      } catch (e) {\n        setHasNewGuide(false);\n      }\n    };\n    fetchGuide();\n  }, [lastTutorialSeenAt]);\n\n  const toYouTubeEmbed = (url: string): string => {\n    try {\n      const u = new URL(url);\n      let id = '';\n      if (u.hostname.includes('youtube.com')) {\n        if (u.pathname === '/watch') id = u.searchParams.get('v') || '';\n        else if (u.pathname.startsWith('/embed/')) id = u.pathname.split('/').pop() || '';\n        else if (u.pathname.startsWith('/shorts/')) id = u.pathname.split('/').pop() || '';\n      } else if (u.hostname === 'youtu.be') {\n        id = u.pathname.replace(/^\\//, '');\n      }\n      if (!id) return url;\n      return `https://www.youtube.com/embed/${id}?autoplay=1&rel=0`;\n    } catch { return url; }\n  };\n\n  const openGuide = async () => {\n    setIsGuideOpen(true);\n    try {\n      if (user?.uid) {\n        await userDataService.updateUserData(user.uid, { tutorialSeenAt: new Date() });\n      }\n      setHasNewGuide(false);\n    } catch {}\n  };\n\n  // Top-up modal state\n  const [isTopUpOpen, setIsTopUpOpen] = useState(false);\n  const [topupPhone, setTopupPhone] = useState('');\n  const [topupOperator, setTopupOperator] = useState('');\n  const [topupAmount, setTopupAmount] = useState<number | ''>('');\n  const [topupLoading, setTopupLoading] = useState(false);\n\n  const [pendingDebtsCount, setPendingDebtsCount] = useState(0);\n  //    \n  useEffect(() => {\n    if (!user?.uid) { setPendingDebtsCount(0); return; }\n    const fetchDebts = async () => {\n      try {\n        const userRef = doc(db, 'users', user.uid);\n        const snap = await getDoc(userRef);\n        \n        const data: any = snap.exists() ? snap.data() : {};\n        const arrayDebts = Array.isArray(data?.debts) ? data.debts : [];\n        \n        //       (     )\n        const allDebts = arrayDebts;\n        \n        const count = allDebts.filter((d: any) => d?.status === 'pending' && ((Number(d?.amount) || 0) > 0)).length;\n        setPendingDebtsCount(count);\n      } catch {\n        setPendingDebtsCount(0);\n      }\n    };\n    fetchDebts();\n  }, [user?.uid]);\n\n  useEffect(() => {\n    loadTransactions();\n    loadDeletedTransactions();\n  }, [user]);\n\n  //     \n  useEffect(() => {\n    if (!user?.uid) return;\n    const syncDeleted = async () => {\n      try {\n        const q = fsQuery(collection(db, 'deletedTransactions'), where('userId', '==', user.uid));\n        const snap = await getDocs(q);\n        const keys: string[] = [];\n        snap.docs.forEach((doc) => {\n          const d: any = doc.data();\n          const arr = [d.originalTransactionId, d.transactionId, d.reference, doc.id]\n            .filter(Boolean)\n            .map((v) => String(v));\n          keys.push(...arr);\n        });\n        \n        if (keys.length > 0) {\n          setPermDeletedSet((prev) => {\n            const next = new Set(prev);\n            keys.forEach((k) => next.add(k));\n            return next;\n          });\n          \n          setTransactions((prev) => prev.filter((t) => {\n            const id = String(t.id || '');\n            const tid = String((t as any).transactionId || '');\n            const ref = String((t as any).reference || '');\n            return !(keys.includes(id) || keys.includes(tid) || keys.includes(ref));\n          }));\n        }\n\n        //    ( )\n        try { \n            //          \n            userDataService.subscribeDeletedTransactionsLocalSync(user.uid); \n        } catch {}\n      } catch (e) {\n        console.warn('deletedTransactions fetch failed:', e);\n      }\n    };\n    syncDeleted();\n  }, [user?.uid]);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        if (!user?.uid) { setPermDeletedSet(new Set()); return; }\n        const q = fsQuery(\n          collection(db, 'deletedTransactions'),\n          where('userId', '==', user.uid),\n          where('permanent', '==', true)\n        );\n        const snap = await getDocs(q);\n        const keys: string[] = snap.docs.flatMap(d => {\n          const data: any = d.data();\n          const arr = [data.originalTransactionId, data.transactionId, data.reference, d.id].filter(Boolean).map(String);\n          return arr;\n        });\n        setPermDeletedSet(new Set(keys));\n      } catch {\n        setPermDeletedSet(new Set());\n      }\n    })();\n  }, [user?.uid]);\n\n\n  //  React Query   (Cache-first strategy)\n  const { data: fetchedTransactions, refetch: refetchTransactions, isFetching } = useQuery({\n    queryKey: ['userTransactions', user?.uid],\n    queryFn: async () => {\n      if (!user?.uid) return [];\n      try {\n        const q = fsQuery(\n          collection(db, 'deletedTransactions'),\n          where('userId', '==', user.uid),\n          where('permanent', '==', true)\n        );\n        const [primary, alt, permKeysRes] = await Promise.all([\n          userDataService.getUserTransactions(user.uid).catch(() => []),\n          (userDataService as any).getByUserId(user.uid).catch(() => []),\n          getDocs(q)\n            .then((snap) => snap.docs.flatMap(d => {\n              const data: any = d.data();\n              const arr = [data.originalTransactionId, data.transactionId, data.reference, d.id].filter(Boolean).map(String);\n              return arr;\n            }))\n            .catch(() => [])\n        ]);\n        const txns = (Array.isArray(primary) && primary.length > 0) ? primary : (Array.isArray(alt) ? alt : []);\n        const permSet = new Set(permKeysRes as string[]);\n        \n        const transactionsWithDates = (txns || [])\n          .map((t: any) => ({\n            ...t,\n            createdAt: t.createdAt instanceof Date ? t.createdAt : new Date(t.createdAt)\n          }))\n          .filter((t: any) => !(t?.type === 'report' || ((t?.title || '').includes('  '))));\n\n        const filtered = transactionsWithDates.filter((t: any) => {\n          const id = String(t.id || '');\n          const tid = String(t.transactionId || '');\n          const ref = String(t.reference || t.transactionReference || '');\n          return !permSet.has(id) && (!tid || !permSet.has(tid)) && (!ref || !permSet.has(ref));\n        });\n\n        const locals = user?.uid ? userDataService.getLocalReceipts(user.uid) : [];\n        const merged = [...filtered, ...(Array.isArray(locals) ? locals : [])];\n        const getKey = (t: any) => String(\n          t?.transactionId || t?.id || t?.reference || t?.transactionReference || (t?.receipt?.reference) || `${new Date(t?.createdAt || Date.now()).getTime()}`\n        );\n        const seen = new Set<string>();\n        const distinct = merged.filter((t: any) => {\n          const k = getKey(t);\n          if (seen.has(k)) return false;\n          seen.add(k);\n          return true;\n        });\n        return distinct.map(normalizeTransaction) as Transaction[];\n      } catch (error) {\n        console.error('Error fetching transactions:', error);\n        return [];\n      }\n    },\n    enabled: !!user?.uid,\n    staleTime: 5 * 60 * 1000, // 5 \n  });\n\n  //         Query\n  useEffect(() => {\n    if (fetchedTransactions) {\n      setTransactions(fetchedTransactions);\n    }\n  }, [fetchedTransactions]);\n\n  const loadTransactions = async () => {\n    try {\n      if (!user) return;\n      const q = fsQuery(\n        collection(db, 'deletedTransactions'),\n        where('userId', '==', user.uid),\n        where('permanent', '==', true)\n      );\n      const [primary, alt, permKeysRes] = await Promise.all([\n        userDataService.getUserTransactions(user.uid).catch(() => []),\n        (userDataService as any).getByUserId(user.uid).catch(() => []),\n        getDocs(q)\n          .then((snap) => snap.docs.flatMap(d => {\n            const data: any = d.data();\n            const arr = [data.originalTransactionId, data.transactionId, data.reference, d.id].filter(Boolean).map(String);\n            return arr;\n          }))\n          .catch(() => [])\n      ]);\n      const txns = (Array.isArray(primary) && primary.length > 0) ? primary : (Array.isArray(alt) ? alt : []);\n      const permSet = new Set(permKeysRes as string[]);\n      const transactionsWithDates = (txns || [])\n        .map((t: any) => ({\n          ...t,\n          createdAt: t.createdAt instanceof Date ? t.createdAt : new Date(t.createdAt)\n        }))\n        //      \n        .filter((t: any) => !(t?.type === 'report' || ((t?.title || '').includes('  '))));\n      const filtered = transactionsWithDates.filter((t: any) => {\n        const id = String(t.id || '');\n        const tid = String(t.transactionId || '');\n        const ref = String(t.reference || t.transactionReference || '');\n        return !permSet.has(id) && (!tid || !permSet.has(tid)) && (!ref || !permSet.has(ref));\n      });\n      const locals = user?.uid ? userDataService.getLocalReceipts(user.uid) : [];\n      const merged = [...filtered, ...(Array.isArray(locals) ? locals : [])];\n      const getKey = (t: any) => String(\n        t?.transactionId || t?.id || t?.reference || t?.transactionReference || (t?.receipt?.reference) || `${new Date(t?.createdAt || Date.now()).getTime()}`\n      );\n      const seen = new Set<string>();\n      const distinct = merged.filter((t: any) => {\n        const k = getKey(t);\n        if (seen.has(k)) return false;\n        seen.add(k);\n        return true;\n      });\n      setTransactions(distinct.map(normalizeTransaction) as Transaction[]);\n    } catch (error) {\n      console.error('      Firestore:', error);\n      toast({\n        title: '   ',\n        description: '    Firestore   .      .         .',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  const loadDeletedTransactions = async () => {\n    try {\n      if (!user) return;\n      const deleted = await auditLogService.getDeletedTransactionsByUser(user.uid);\n      const deletedWithDates = deleted.map((t: any) => ({\n        ...t,\n        createdAt: t.createdAt instanceof Date ? t.createdAt : new Date(t.createdAt)\n      }));\n      setDeletedTransactions(deletedWithDates.map(normalizeTransaction) as Transaction[]);\n    } catch (error) {\n      console.error('      Firestore:', error);\n      toast({\n        title: '   ',\n        description: '   .      .',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  const effectiveTransactions = React.useMemo(() => {\n    const now = new Date();\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n    const nextMonthStart = new Date(now.getFullYear(), now.getMonth() + 1, 1);\n    const sorted = [...transactions].sort((a, b) => {\n      const timeA = a.createdAt instanceof Date ? a.createdAt.getTime() : 0;\n      const timeB = b.createdAt instanceof Date ? b.createdAt.getTime() : 0;\n      return timeB - timeA;\n    });\n    return sorted.filter(t => t.createdAt >= monthStart && t.createdAt < nextMonthStart);\n  }, [transactions]);\n  const hiddenCount = React.useMemo(() => {\n    const now = new Date();\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n    const nextMonthStart = new Date(now.getFullYear(), now.getMonth() + 1, 1);\n    return Math.max(0, (transactions?.length || 0) - (transactions || []).filter(t => t.createdAt >= monthStart && t.createdAt < nextMonthStart).length);\n  }, [transactions?.length]);\n\n  const filteredTransactions = effectiveTransactions.filter(transaction => {\n    const phoneMatch = !searchPhone || \n      transaction.senderPhone.includes(searchPhone) || \n      transaction.receiverPhone.includes(searchPhone);\n    \n    const dateMatch = !selectedDate || \n      transaction.createdAt.toDateString() === new Date(selectedDate).toDateString();\n    \n    const timeMatch = !selectedTime || \n      transaction.createdAt.toTimeString().startsWith(selectedTime);\n    \n    return phoneMatch && dateMatch && timeMatch;\n  });\n\n  const getStatusIcon = (status: string, type?: string) => {\n    switch (status) {\n      case 'completed':\n        return <CheckCircle className={`h-4 w-4 ${type === 'withdraw' ? 'text-red-500' : 'text-green-500'}`} />;\n      case 'pending':\n        return <Clock className=\"h-4 w-4 text-yellow-500\" />;\n      case 'cancelled':\n        return <XCircle className=\"h-4 w-4 text-red-500\" />;\n      default:\n        return <Clock className=\"h-4 w-4 text-gray-500\" />;\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case 'completed':\n        return '';\n      case 'pending':\n        return ' ';\n      case 'cancelled':\n        return '';\n      default:\n        return ' ';\n    }\n  };\n\n  //           \n  const normalizeTransaction = (raw: any): Transaction => {\n    const statusRaw = (raw?.status ?? '').toString().toLowerCase();\n    const normalizedStatus: Transaction['status'] =\n      statusRaw === 'confirmed' || statusRaw === 'success' || statusRaw === 'completed'\n        ? 'completed'\n        : statusRaw === 'failed' || statusRaw === 'error' || statusRaw === 'cancelled' || statusRaw === 'canceled'\n        ? 'cancelled'\n        : 'pending';\n\n    const typeRaw = (raw?.type ?? raw?.txnType ?? '').toString().toLowerCase();\n    let normalizedType: Transaction['type'] = 'send';\n    \n    if (typeRaw === 'withdraw') {\n      normalizedType = 'withdraw';\n    } else if (typeRaw === 'cash_addition' || typeRaw === 'add') {\n      normalizedType = 'cash_addition' as any;\n    } else {\n      normalizedType = 'send';\n    }\n\n    const sender =\n      raw?.senderPhone ?? raw?.senderMsisdn ?? raw?.sender_msisdn ?? raw?.sender ?? raw?.from ?? '';\n    const receiver =\n      raw?.receiverPhone ?? raw?.receiverMsisdn ?? raw?.receiver_msisdn ?? raw?.receiver ?? raw?.to ?? '';\n\n    const createdAtVal = raw?.createdAt;\n    const createdAt =\n      createdAtVal instanceof Date\n        ? createdAtVal\n        : createdAtVal?.toDate\n        ? createdAtVal.toDate()\n        : new Date(createdAtVal);\n\n    return {\n      id: raw?.id,\n      senderPhone: sender || ' ',\n      receiverPhone: receiver || ' ',\n      amount: Number(raw?.amount ?? 0),\n      status: normalizedStatus,\n      type: normalizedType,\n      createdAt,\n      provider: raw?.provider ?? undefined,\n      commission: raw?.commission ?? undefined,\n      withdrawnAmount: raw?.withdrawnAmount ?? undefined,\n      sentAmount: raw?.sentAmount ?? undefined,\n      fromWallet: raw?.fromWallet ?? raw?.walletId ?? undefined,\n      cashierName: raw?.cashierName ?? raw?.createdByName ?? raw?.cashier ?? undefined,\n      commissionMode: raw?.commissionMode ?? raw?.commission_mode ?? undefined,\n      totalCharged: raw?.totalCharged ?? undefined,\n      walletEffectAppliedOnCreation: raw?.walletEffectAppliedOnCreation ?? raw?.effectsAppliedOnCreation ?? raw?.effectAppliedOnCreation ?? false,\n      cashEffectAppliedOnCreation: raw?.cashEffectAppliedOnCreation ?? false,\n      fee: raw?.fee ?? undefined,\n      senderName: raw?.senderName ?? raw?.customerName ?? undefined,\n      title: raw?.title ?? undefined,\n      description: raw?.description ?? undefined,\n    };\n  };\n\n  const mapToReceiptTransaction = (t: Transaction) => {\n    const p = String((t as any)?.provider || '').toLowerCase();\n    const short = p.includes('vodafone') ? 'vf-cash' : (p.includes('instapay') ? 'instapay' : '');\n    \n    //    \n    const desc = String(t.description || '');\n    const rawTitle = String(t.title || '');\n    const isMachineTransfer = \n      desc.includes(' ') || \n      desc.includes(' ') || \n      desc.includes('machine transfer') ||\n      rawTitle.includes(' ') || \n      rawTitle.includes(' ');\n\n    const baseTitle = t.type === 'send' ? '' : '';\n    let title = (t.type === 'withdraw' && short) ? `${baseTitle} ${short}` : baseTitle;\n\n    //       \n    if (isMachineTransfer) {\n      title = ' ';\n    } else if (t.title) {\n      //       \n      title = t.title;\n    }\n\n    return {\n      id: t.id,\n      type: isMachineTransfer ? 'transfer' : (t.type === 'send' ? 'transfer' : 'withdraw'),\n      sender_msisdn: t.senderPhone,\n      receiver_msisdn: t.receiverPhone,\n      amount: t.amount,\n      commission: t.commission || 0,\n      status: t.status === 'cancelled' ? 'failed' : t.status,\n      createdAt: t.createdAt.toISOString(),\n      updatedAt: t.createdAt.toISOString(),\n      shopName: shopName ?? profile?.shopName ?? user?.displayName ?? '',\n      //          \n      cashierName: (t as any)?.cashierName ?? null,\n      commissionMode: (t as any)?.commissionMode ?? undefined,\n      totalCharged: (t as any)?.totalCharged ?? undefined,\n      fee: (t as any)?.fee ?? undefined,\n      note: (t as any)?.note ?? (t as any)?.notes ?? undefined,\n      senderName: (t as any)?.senderName ?? undefined,\n      provider: (t as any)?.provider ?? undefined,\n      title,\n      description: t.description //   \n    };\n  };\n\n  const handleTransactionClick = (transaction: Transaction) => {\n    const receiptData = mapToReceiptTransaction(transaction);\n    setReceiptTransaction(receiptData);\n    setIsReceiptOpen(true);\n  };\n\n  const handleOpenRestoreDialog = (tx: Transaction) => {\n    setPendingRestoreTx(tx);\n    setIsRestoreConfirmOpen(true);\n  };\n\n  const handleConfirmRestore = async () => {\n    if (!pendingRestoreTx) return;\n    await restoreTransaction(pendingRestoreTx.id);\n    setIsRestoreConfirmOpen(false);\n    setPendingRestoreTx(null);\n  };\n\n  const restoreTransaction = async (transactionId: string) => {\n    try {\n      const transactionToRestore = deletedTransactions.find(t => t.id === transactionId);\n      if (!transactionToRestore || !user) return;\n\n      //      Firestore  userTransactions\n      const newId = await userDataService.saveUserTransaction(user.uid, {\n        ...transactionToRestore,\n        userId: user.uid,\n        status: 'completed',\n        cashierName: transactionToRestore.cashierName ?? ' '\n      });\n\n      //      Firestore\n      await auditLogService.permanentlyDeleteTransaction(transactionId, user.uid);\n\n      //  \n      const restored = { ...transactionToRestore, id: newId } as Transaction;\n      setTransactions(prev => [...prev, restored]);\n      setDeletedTransactions(prev => prev.filter(t => t.id !== transactionId));\n      toast({ title: ' ', description: '    .' });\n    } catch (error) {\n      console.error('     Firestore:', error);\n      toast({ title: ' ', description: '     .', variant: 'destructive' });\n    }\n  };\n\n  const permanentlyDeleteTransaction = async (transactionId: string) => {\n    try {\n      if (!user) return;\n      //      \n      setDeletedTransactions(prev => prev.filter(t => t.id !== transactionId));\n\n      //    Firebase (deletedTransactions + userTransactions + transactions)\n      await auditLogService.permanentlyDeleteTransaction(transactionId, user.uid);\n      await userDataService.removeUserTransaction(user.uid, transactionId);\n\n      toast({ title: '  ', description: '    .' });\n    } catch (error) {\n      console.error('   :', error);\n      toast({ title: '   ', description: '     .', variant: 'destructive' });\n    }\n  };\n\n  //  :     \n  const handleCompleteReceipt = async (transactionId: string) => {\n    try {\n      const tx = transactions.find(t => t.id === transactionId);\n      if (!tx || !user) return;\n\n      //   : 5   /\n      try {\n        const plan = userSubscription?.subscription?.planType;\n        if (plan === SubscriptionPlan.ZERO) {\n          const { dailyOperationCountService } = await import('@/utils/dailyOperationCountService');\n          const opType = tx.type === 'send' ? 'transfer' : 'withdraw';\n          const res = await dailyOperationCountService.checkAndIncrement(user.uid, opType, 5);\n          if (!res.allowed) {\n            toast({\n              title: '    ',\n              description: '   5   /.     .',\n              variant: 'destructive',\n            });\n            return;\n          }\n        } else if (plan === SubscriptionPlan.TAHWEELA) {\n          const { dailyOperationCountService } = await import('@/utils/dailyOperationCountService');\n          const opType = tx.type === 'send' ? 'transfer' : 'withdraw';\n          const res = await dailyOperationCountService.checkAndIncrementCombined(user.uid, opType, 40);\n          if (!res.allowed) {\n            toast({\n              title: '    ',\n              description: '     40  / .',\n              variant: 'destructive',\n            });\n            return;\n          }\n        }\n      } catch (limitErr) {\n        console.warn('     :', limitErr);\n      }\n\n      //      Firebase    \n      const userProfile = await profileService.getById(user.uid);\n      if (!userProfile?.shopId) {\n        throw new Error('     (shopId) ');\n      }\n      const dataRef = doc(db, 'dashboardData', userProfile.shopId);\n      const dataSnap = await getDoc(dataRef);\n      let cashBalance = dataSnap.exists() ? Number((dataSnap.data() as any)?.cashBalance || 0) : 0;\n      const walletBalances: Record<string, number> = dataSnap.exists() ? ((dataSnap.data() as any)?.walletBalances || {}) : {};\n\n      const fromWalletIdForLimits = tx.fromWallet || Object.keys(walletBalances)[0];\n      const alreadyReservedLimits = Boolean((tx as any)?.limitsReservedOnCreation);\n      const checkAmt = Number(tx.withdrawnAmount ?? tx.sentAmount ?? tx.amount ?? 0);\n      const checkType = tx.type === 'send' ? 'transfer' : 'withdraw';\n      try {\n        const { walletDailyLimitsService } = await import('@/utils/walletDailyLimitsService');\n        const can = await walletDailyLimitsService.canPerformOperation(fromWalletIdForLimits, checkAmt, checkType);\n        if (!alreadyReservedLimits && !can.canPerform) {\n          toast({ title: ' ', description: String(can.message || '     /'), variant: 'destructive' });\n          return;\n        }\n      } catch {\n        toast({ title: '   ', description: '   ', variant: 'destructive' });\n        return;\n      }\n\n      //      \n      let didAddCashNow = false;\n      if (tx.type === 'withdraw') {\n        const fromWalletId = tx.fromWallet || Object.keys(walletBalances)[0];\n        const amount = Number(tx.withdrawnAmount ?? tx.amount ?? 0);\n        const commission = Number(tx.commission ?? 0);\n\n        //         \n        const alreadyAppliedOnCreationWallet = Boolean((tx as any)?.walletEffectAppliedOnCreation);\n        const alreadyAppliedOnCreationCash = Boolean((tx as any)?.cashEffectAppliedOnCreation);\n\n        if (!alreadyAppliedOnCreationWallet && fromWalletId && amount > 0) {\n          const current = walletBalances[fromWalletId] || 0;\n          walletBalances[fromWalletId] = current + amount; //        \n        }\n\n        if (alreadyAppliedOnCreationCash) {\n          cashBalance = cashBalance + amount; //    ()  \n        } else {\n          cashBalance = cashBalance - amount; //    ()  \n        }\n        didAddCashNow = true;\n\n        //      Firebase\n        await updateDoc(dataRef, { cashBalance, walletBalances });\n      } else if (tx.type === 'send') {\n        const commission = Number(tx.commission ?? 0);\n        const fee = Number((tx as any)?.fee ?? 0);\n        const amountToAdd = Number((tx as any)?.sentAmount ?? (tx as any)?.transferredAmount ?? tx.amount ?? 0);\n        const toAdd = Math.max(0, amountToAdd) + Math.max(0, fee); //   ()  \n        if (toAdd > 0) {\n          cashBalance = cashBalance + toAdd;\n          await updateDoc(dataRef, { cashBalance });\n          didAddCashNow = true;\n        }\n      }\n\n      await updateDoc(doc(db, 'userTransactions', transactionId), {\n        status: 'completed',\n        confirmedAt: new Date()\n      });\n\n      try {\n        const fromWalletId = tx.fromWallet || Object.keys(walletBalances)[0];\n        const amt = Number(tx.withdrawnAmount ?? tx.sentAmount ?? tx.amount ?? 0);\n        if (fromWalletId && amt > 0 && !alreadyReservedLimits) {\n          const { walletDailyLimitsService } = await import('@/utils/walletDailyLimitsService');\n          await walletDailyLimitsService.updateUsage(fromWalletId, amt, tx.type === 'send' ? 'transfer' : 'withdraw');\n        }\n      } catch {\n        toast({ title: '  ', description: '  /  ', variant: 'destructive' });\n        return;\n      }\n\n      try {\n        const { ProfitService } = await import('@/utils/profitService');\n        const profit = ProfitService.calculateProfitFromTransaction({\n          type: tx.type === 'send' ? 'transfer' : 'withdraw',\n          amount: Number(tx.amount || 0),\n          commission: Number(tx.commission || 0),\n          fee: Number((tx as any)?.fee || 0)\n        });\n        const alreadyAdded = Boolean((tx as any)?.profitAddedOnCreation);\n        if (!alreadyAdded && profit > 0) {\n          ProfitService.addProfit(profit, user?.uid);\n        }\n      } catch {}\n\n      setTransactions(prev => prev.map(t => t.id === transactionId ? { ...t, status: 'completed' } : t));\n      toast({ title: ' ', description: '   .' });\n      setIsReceiptOpen(false);\n    } catch (error) {\n      console.error('   :', error);\n      toast({ title: ' ', description: '     .', variant: 'destructive' });\n    }\n  };\n\n  //         \n  const handleDeleteReceipt = async (transactionId: string) => {\n    try {\n      const tx = transactions.find(t => t.id === transactionId);\n      if (!tx || !user) return;\n\n      //        \n      setTransactions(prev => prev.filter(t => t.id !== transactionId));\n      setDeletedTransactions(prev => [{ ...tx }, ...prev]);\n\n      //          +   \n      let finalStatus = tx.status;\n      try {\n        //       transactionId/reference    \n        let rawTx: any = {};\n        try {\n          const snap = await getDoc(doc(db, 'userTransactions', transactionId));\n          rawTx = snap.exists() ? (snap.data() as any) : {};\n\n          //            \n          if (rawTx?.status) {\n            const s = String(rawTx.status).toLowerCase();\n            if (s === 'completed' || s === 'confirmed' || s === 'success') finalStatus = 'completed';\n            else if (s === 'pending') finalStatus = 'pending';\n            else if (s === 'cancelled' || s === 'failed') finalStatus = 'cancelled';\n          }\n        } catch {}\n        const originalId = transactionId;\n        const linkedTxnId = String(rawTx?.transactionId || (tx as any)?.transactionId || originalId);\n        const linkedRef = String(\n          rawTx?.reference || rawTx?.transactionReference ||\n          (tx as any)?.reference || (tx as any)?.transactionReference || ''\n        );\n\n        await userDataService.removeUserTransaction(user.uid, transactionId);\n        await auditLogService.saveDeletedTransaction({\n          ...tx,\n          userId: user.uid,\n          originalTransactionId: transactionId,\n          transactionId: linkedTxnId,\n          reference: linkedRef || undefined,\n          permanent: true\n        });\n        try {\n          await auditLogService.permanentlyDeleteTransaction(transactionId, user.uid);\n        } catch {}\n      } catch (e) {\n        console.warn('                  :', e);\n      }\n\n      //       Firebase    \n      try {\n        const userProfile = await profileService.getById(user.uid);\n        if (!userProfile?.shopId) {\n          throw new Error('     (shopId) ');\n        }\n        const dataRef = doc(db, 'dashboardData', userProfile.shopId);\n        const dataSnap = await getDoc(dataRef);\n        let cashBalance: number = dataSnap.exists() ? Number((dataSnap.data() as any)?.cashBalance || 0) : 0;\n        const walletBalances: Record<string, number> = dataSnap.exists() ? ((dataSnap.data() as any)?.walletBalances || {}) : {};\n\n        const amount = Number(tx.withdrawnAmount ?? tx.amount ?? 0);\n        const commission = Number(tx.commission ?? 0);\n        const fromWalletId = tx.fromWallet || Object.keys(walletBalances)[0];\n\n        //          \n        const wasAppliedOnCreation = Boolean((tx as any)?.walletEffectAppliedOnCreation);\n\n        //   /\n        if (tx.type === 'send') {\n          //  :     +  ( )    .\n          //  :        .\n          const fee = Number(tx.fee ?? 0);\n          const sentAmount = Number((tx as any)?.sentAmount ?? (tx as any)?.transferredAmount ?? tx.amount ?? 0);\n          \n          if (finalStatus === 'completed') {\n            // :         .   +  .\n            cashBalance = cashBalance - (sentAmount + fee);\n          }\n          if (fromWalletId && sentAmount > 0) {\n            const current = walletBalances[fromWalletId] || 0;\n            walletBalances[fromWalletId] = current + sentAmount; //   \n          }\n        } else if (tx.type === 'withdraw') {\n          if (finalStatus === 'completed') {\n            //  :    .\n            //  :   .       .\n            cashBalance = cashBalance + amount; \n            \n            if (fromWalletId && amount > 0) {\n              const current = walletBalances[fromWalletId] || 0;\n              walletBalances[fromWalletId] = current - amount; //        \n            }\n          } else {\n            //    ( ):       \n            if (fromWalletId && wasAppliedOnCreation && amount > 0) {\n              const current = walletBalances[fromWalletId] || 0;\n              walletBalances[fromWalletId] = current - amount; //     \n            }\n            //          \n          }\n        }\n\n        //      Firebase\n        await updateDoc(dataRef, { cashBalance, walletBalances });\n      } catch (e) {\n        console.warn('    :', e);\n      }\n\n      //   / \n      try {\n        const fromWalletId = tx.fromWallet;\n        if (fromWalletId) {\n          const { walletDailyLimitsService } = await import('@/utils/walletDailyLimitsService');\n          //  rollbackUsage       DashboardPage\n          const amt = Number(tx.withdrawnAmount ?? tx.sentAmount ?? tx.amount ?? 0);\n          const opType = tx.type === 'send' ? 'transfer' : 'withdraw';\n          await walletDailyLimitsService.rollbackUsage(fromWalletId, amt, opType, tx.createdAt);\n        }\n      } catch (e) {\n        console.warn('   :', e);\n      }\n\n      //      \n      try {\n        const { ProfitService } = await import('@/utils/profitService');\n        const { ReportsService } = await import('@/utils/reportsService');\n        const txnType = tx.type === 'send' ? 'send' : 'receive';\n        const transactionData: any = {\n          txnType,\n          amount: tx.amount,\n          commission: tx.commission || 0,\n          createdAt: tx.createdAt,\n          status: 'confirmed'\n        };\n        //        \n        const profit = ProfitService.calculateProfitFromTransaction(transactionData);\n        if (profit > 0) {\n          ProfitService.addProfit(-profit, user.uid);\n        }\n        //    / (   )\n        try {\n          ReportsService.removeTransactionEffects(tx, user.uid);\n        } catch {}\n      } catch (e) {\n        console.warn('  /  :', e);\n      }\n    } catch (error) {\n      console.error('   :', error);\n    }\n  };\n\n  //   :            Firestore \n  const autoTestRanRef = useRef(false);\n  const location = useLocation();\n  useEffect(() => {\n    const params = new URLSearchParams(location.search);\n    const shouldRun = params.get('autoTestBalances') === '1';\n    if (!shouldRun || autoTestRanRef.current) return;\n    autoTestRanRef.current = true;\n\n    (async () => {\n      try {\n        if (!user) return;\n        const profile = await profileService.getById(user.uid);\n        if (!profile?.shopId) {\n          console.warn('autoTest:   shopId    .');\n          return;\n        }\n\n        //        \n        const dataRef = doc(db, 'dashboardData', profile.shopId);\n        const snapBefore = await getDoc(dataRef);\n        const beforeCash = snapBefore.exists() ? Number((snapBefore.data() as any)?.cashBalance || 0) : 0;\n        const beforeWallets: Record<string, number> = snapBefore.exists() ? ((snapBefore.data() as any)?.walletBalances || {}) : {};\n        const fromWalletId = Object.keys(beforeWallets)[0] || undefined;\n\n        //            \n        const amount = 100;\n        const commission = 5;\n\n        //      pending\n        const newId = await userDataService.saveUserTransaction(user.uid, {\n          senderPhone: 'auto-test-sender',\n          receiverPhone: 'auto-test-receiver',\n          amount,\n          status: 'pending',\n          type: 'withdraw',\n          createdAt: new Date(),\n          reference: `AUTO-${Date.now()}`,\n          commission,\n          withdrawnAmount: amount,\n          fromWallet: fromWalletId,\n          cashierName: 'AutoTest',\n          commissionMode: 'add',\n          totalCharged: amount + commission,\n          walletEffectAppliedOnCreation: false\n        });\n\n        console.log('autoTest:     :', newId);\n\n        //       Firestore\n        await handleCompleteReceipt(newId);\n\n        const snapAfterComplete = await getDoc(dataRef);\n        const afterCashComplete = snapAfterComplete.exists() ? Number((snapAfterComplete.data() as any)?.cashBalance || 0) : 0;\n        const afterWalletsComplete: Record<string, number> = snapAfterComplete.exists() ? ((snapAfterComplete.data() as any)?.walletBalances || {}) : {};\n\n        //    \n        const expectedCashAfter = beforeCash - amount + commission;\n        const expectedWalletAfter = fromWalletId ? (Number(beforeWallets[fromWalletId] || 0) + amount) : undefined;\n        console.log('autoTest:    :', expectedCashAfter, ':', afterCashComplete);\n        if (fromWalletId) {\n          console.log('autoTest:    :', expectedWalletAfter, ':', afterWalletsComplete[fromWalletId]);\n        }\n\n        //    \n        await handleDeleteReceipt(newId);\n\n        const snapAfterDelete = await getDoc(dataRef);\n        const afterCashDelete = snapAfterDelete.exists() ? Number((snapAfterDelete.data() as any)?.cashBalance || 0) : 0;\n        const afterWalletsDelete: Record<string, number> = snapAfterDelete.exists() ? ((snapAfterDelete.data() as any)?.walletBalances || {}) : {};\n\n        console.log('autoTest:     / :', beforeCash, afterCashDelete);\n        if (fromWalletId) {\n          console.log('autoTest:     / :', beforeWallets[fromWalletId] || 0, afterWalletsDelete[fromWalletId] || 0);\n        }\n\n        toast({ title: '  (Firestore )', description: ' //     .', variant: 'default' });\n      } catch (err) {\n        console.error('autoTest:   :', err);\n        toast({ title: '  ', description: '    shopId   Firestore.', variant: 'destructive' });\n      }\n    })();\n  }, [location.search, user]);\n\n  //     API\n  const submitTopUp = async () => {\n    //        \n    const allowedEmail = 'alkaptin678678@gmail.com';\n    const userEmail = auth.currentUser?.email?.toLowerCase();\n    if (!userEmail || userEmail !== allowedEmail) {\n      toast({ title: ' ', description: '      .' });\n      return;\n    }\n    if (!topupPhone || !topupOperator || !topupAmount) {\n      toast({ title: ' ', description: '    ', variant: 'destructive' });\n      return;\n    }\n    setTopupLoading(true);\n    try {\n      //       \n      const serverOperatorNameMap: Record<string, string> = {\n        vodafone_eg: 'Vodafone',\n        orange_eg: 'Orange',\n        etisalat_eg: 'Etisalat',\n        we_eg: 'WE',\n      };\n      const operatorToSend = serverOperatorNameMap[topupOperator] ?? topupOperator;\n\n      //      \n      const controller = new AbortController();\n      const timeout = setTimeout(() => controller.abort(), 15000);\n\n      const idToken = await auth.currentUser?.getIdToken();\n      const resp = await fetch('/api/topup', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(idToken ? { Authorization: `Bearer ${idToken}` } : {}),\n        },\n        body: JSON.stringify({\n          phone: topupPhone,\n          countryCode: 'EG',\n          operator: operatorToSend,\n          amount: Number(topupAmount),\n          useLocalAmount: true,\n        }),\n        signal: controller.signal,\n      });\n      clearTimeout(timeout);\n\n      //        JSON  \n      const rawText = await resp.text();\n      let data: any;\n      try {\n        data = JSON.parse(rawText);\n      } catch {\n        data = { success: false, message: rawText || '   ' };\n      }\n      if (resp.ok && data?.success) {\n        toast({ title: ' ', description: data?.message || '    ' });\n        setIsTopUpOpen(false);\n        setTopupPhone('');\n        setTopupOperator('');\n        setTopupAmount('');\n      } else {\n        toast({ title: ' ', description: data?.message || '    ', variant: 'destructive' });\n      }\n    } catch (err: any) {\n      console.error('Topup request error:', err);\n      if (err?.name === 'AbortError') {\n        toast({ title: ' ', description: '     .    .', variant: 'destructive' });\n      } else {\n        toast({ title: '  ', description: '  .  .', variant: 'destructive' });\n      }\n    } finally {\n      setTopupLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 overscroll-y-none overflow-y-auto bg-background p-4\">\n      <div className=\"max-w-4xl mx-auto\">\n        {/* Header */}\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => navigate('/user/dashboard')}\n            className=\"flex items-center gap-2 text-gray-600 hover:text-gray-800\"\n          >\n            <ArrowLeft className=\"h-4 w-4\" />\n            \n          </Button>\n          <h1 className=\"text-2xl font-bold text-gray-800\"></h1>\n        </div>\n\n        {/* Transactions List */}\n        <Card className=\"card-modern fade-in-up\">\n          <CardHeader className=\"pb-2 px-3 pt-3\">\n            <CardTitle className=\"text-sm font-bold\"> </CardTitle>\n            \n            {/*     */}\n            <div className=\"flex items-center gap-0.5 mt-1 relative\">\n              {/*    */}\n              <div className=\"flex items-center gap-0.5 flex-1 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]\">\n                <Search className=\"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors\" />\n                <Input\n                  placeholder=\"...\"\n                  value={searchPhone}\n                  onChange={(e) => setSearchPhone(e.target.value)}\n                  className=\"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400\"\n                />\n              </div>\n              \n              \n              {/*         */}\n              <div className=\"hidden md:flex items-center gap-1\">\n                {/*       */}\n                <div className=\"flex items-center gap-1\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"relative h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105\"\n                    onClick={openGuide}\n                    title=\" \"\n                  >\n                    <div className=\"relative inline-flex items-center justify-center h-full w-full\">\n                      <PlayCircle className=\"h-2.5 w-2.5\" />\n                      {hasNewGuide && (\n                        <div className=\"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-600 rounded-full\"></div>\n                      )}\n                    </div>\n                  </Button>\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\n                </div>\n                {/*      */}\n                <div className=\"flex items-center gap-1\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"h-5 w-5 p-0 rounded bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 hover:border-purple-300 transition-all duration-200 hover:scale-105\"\n                    onClick={() => {\n                      if (isZeroPlan || isTahweelaPlan) {\n                        toast({ title: ' ', description: '      .', variant: 'destructive' });\n                        return;\n                      }\n                      setIsInstallmentPinOpen(true);\n                    }}\n                    title=\" \"\n                  >\n                    <BadgePercent className=\"h-2.5 w-2.5\" />\n                  </Button>\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\n                </div>\n                \n                {/*   ( + ) */}\n                <div className=\"flex items-center gap-1\">\n                  <TotalProfitEyeButton userId={user?.uid} transactions={transactions as any[]} />\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\n                </div>\n\n\n                {/*   */}\n                <div className=\"flex items-center gap-1\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"h-5 w-5 p-0 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:scale-105\"\n                    onClick={() => setIsCalculatorOpen(true)}\n                    title=\" \"\n                  >\n                    <Calculator className=\"h-2.5 w-2.5\" />\n                  </Button>\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\n                </div>\n                \n                {/*   */}\n                <div className=\"flex items-center gap-1\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"h-5 w-5 p-0 rounded bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 hover:border-green-300 transition-all duration-200 hover:scale-105\"\n                    onClick={() => {\n                      if (isZeroPlan) {\n                        toast({ title: '   ', description: '      .  .' });\n                        return;\n                      }\n                      setIsSalesDataOpen(true);\n                    }}\n                    title=\" \"\n                  >\n                    <BarChart className=\"h-2.5 w-2.5\" />\n                  </Button>\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\n                </div>\n                \n                {/*   */}\n                <div className=\"flex items-center gap-1\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-5 w-5 p-0 rounded border transition-all duration-200 hover:scale-105 ${\n                      selectedDate || selectedTime \n                        ? 'bg-purple-100 text-purple-600 border-purple-300' \n                        : 'bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200 hover:border-purple-300'\n                    }`}\n                    onClick={() => setIsDatePickerOpen(true)}\n                    title=\" \"\n                  >\n                    <Calendar className=\"h-2.5 w-2.5\" />\n                    {(selectedDate || selectedTime) && (\n                      <div className=\"absolute -top-0.5 -right-0.5 h-1 w-1 bg-purple-500 rounded-full\"></div>\n                    )}\n                  </Button>\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\n                </div>\n                \n                {/*  */}\n                <div className=\"flex items-center gap-1\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"relative h-5 w-5 p-0 rounded bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 hover:border-orange-300 transition-all duration-200 hover:scale-105\"\n                    onClick={() => {\n                      if (isZeroPlan) {\n                        toast({ title: '   ', description: '      .  .' });\n                        return;\n                      }\n                      setIsDebtsPasswordDialogOpen(true);\n                    }}\n                    title=\" \"\n                  >\n                    <div className=\"relative inline-flex items-center justify-center h-full w-full\">\n                      <FileText className=\"h-2.5 w-2.5\" />\n                      {pendingDebtsCount > 0 && (\n                        <div className=\"absolute -top-1 -right-1 z-10 min-w-[12px] h-[12px] px-[2px] bg-red-600 text-white rounded-full text-[8px] leading-[12px] flex items-center justify-center pointer-events-none ring-1 ring-white\">\n                          {pendingDebtsCount}\n                        </div>\n                      )}\n                    </div>\n                  </Button\n                  >\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\n                </div>\n\n                {/*  */}\n                <div className=\"flex items-center gap-1\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"h-5 w-5 p-0 rounded bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:scale-105\"\n                    onClick={() => {\n                      if (isZeroPlan) {\n                        toast({ title: '   ', description: '     .  .' });\n                        return;\n                      }\n                      setIsMaintenanceOpen(true);\n                    }}\n                    title=\"\"\n                  >\n                    <Wrench className=\"h-2.5 w-2.5\" />\n                  </Button>\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\n                </div>\n                \n                {/*     */}\n                <div className=\"flex items-center gap-1\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"h-5 w-5 p-0 rounded bg-violet-50 text-violet-600 hover:bg-violet-100 border border-violet-200 hover:border-violet-300 transition-all duration-200 hover:scale-105\"\n                    onClick={() => {\n                      navigate('/user/dashboard', { state: { openCashierShiftModal: true } });\n                    }}\n                    title=\" \"\n                  >\n                    <BatteryCharging className=\"h-2.5 w-2.5\" />\n                  </Button>\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\n                </div>\n                \n                {/*   -      */}\n                <div className=\"hidden sm:flex items-center gap-1\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"h-5 w-5 p-0 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 transition-all duration-200 hover:scale-105\"\n                    onClick={() => {\n                      if (isZeroPlan) {\n                        toast({ title: '   ', description: '      .  .' });\n                        return;\n                      }\n                      setIsCreditCardsOpen(true);\n                    }}\n                    title=\" \"\n                  >\n                    <CreditCard className=\"h-2.5 w-2.5\" />\n                  </Button>\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\n                </div>\n\n                {/*    */}\n                <div className=\"flex items-center gap-1\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105 relative`}\n                    onClick={() => {\n                      setIsResetRecentDialogOpen(true);\n                    }}\n                    title=\"  \"\n                  >\n                    <Trash2 className=\"h-2.5 w-2.5\" />\n                    {hiddenCount > 0 && (\n                      <div className=\"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-500 rounded-full\"></div>\n                    )}\n                  </Button>\n                  <span className=\"text-[10px] font-bold text-gray-700\"></span>\n                </div>\n                \n                {/*    */}\n                {(searchPhone || selectedDate || selectedTime) && (\n                  <div className=\"flex items-center gap-1\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"h-5 w-5 p-0 rounded bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105\"\n                      onClick={() => {\n                        setSearchPhone('');\n                        setSelectedDate('');\n                        setSelectedTime('');\n                      }}\n                      title=\"\"\n                    >\n                      <span className=\"text-[10px] font-bold\"></span>\n                    </Button>\n                    <span className=\"text-[10px] font-bold text-gray-700\"></span>\n                  </div>\n                )}\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent className=\"px-3 pb-3\">\n            <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n              <TabsList className=\"hidden sm:grid w-full grid-cols-4 h-10 text-sm bg-gradient-to-r from-gray-50 via-blue-50/30 to-purple-50/30 border border-gray-200/60 rounded-md p-1 shadow-sm relative overflow-hidden\">\n                {/*    */}\n                <div className=\"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 opacity-0 hover:opacity-100 transition-all duration-200\"></div>\n                \n                <TabsTrigger \n                  value=\"all\" \n                  className=\"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-blue-200/50 hover:bg-blue-50/80 hover:text-blue-700 group\"\n                >\n                  <span className=\"relative z-10\"></span>\n                  <div className=\"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded\"></div>\n                </TabsTrigger>\n                \n                <TabsTrigger \n                  value=\"send\" \n                  className=\"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-green-200/50 hover:bg-green-50/80 hover:text-green-700 group\"\n                >\n                  <span className=\"relative z-10\"></span>\n                  <div className=\"absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded\"></div>\n                </TabsTrigger>\n                \n                <TabsTrigger \n                  value=\"withdraw\" \n                  className=\"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-orange-200/50 hover:bg-orange-50/80 hover:text-orange-700 group\"\n                >\n                  <span className=\"relative z-10\"></span>\n                  <div className=\"absolute inset-0 bg-gradient-to-r from-orange-500/10 to-amber-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded\"></div>\n                </TabsTrigger>\n                \n                <TabsTrigger \n                  value=\"deleted\" \n                  className=\"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-rose-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-red-200/50 hover:bg-red-50/80 hover:text-red-700 group\"\n                >\n                  <span className=\"relative z-10\"></span>\n                  <div className=\"absolute inset-0 bg-gradient-to-r from-red-500/10 to-rose-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded\"></div>\n                </TabsTrigger>\n              </TabsList>\n              \n              <TabsContent value=\"all\" className=\"mt-2 receipts-list\">\n                {filteredTransactions.length === 0 ? (\n                  <div className=\"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]\">\n                        \n                  </div>\n                ) : (\n                  <div className=\"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400\">\n                    {filteredTransactions.map((transaction, index) => (\n                      <div \n                        key={transaction.id} \n                        className=\"receipts-row flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200\"\n                        onClick={() => handleTransactionClick(transaction)}\n                      >\n                        <div className=\"flex items-center gap-1\">\n                          {getStatusIcon(transaction.status, transaction.type)}\n                          <div>\n                            <p className={`font-medium text-sm ${transaction.type === 'withdraw' ? 'text-red-700' : 'text-green-700'}`}>\n                              {transaction.type === 'withdraw' \n                                ? transaction.receiverPhone\n                                : `${transaction.senderPhone}  ${transaction.receiverPhone}`\n                              }\n                            </p>\n                            {transaction.type === 'withdraw' && (\n                              <>\n                                <p className=\"text-sm font-semibold text-red-600\">\n                                  {formatNumberEnglish(transaction.amount)} \n                                </p>\n                                <p className=\"text-xs text-red-600\">\n                                  : {formatNumberEnglish(transaction.commission || 0)} \n                                </p>\n                              </>\n                            )}\n                            <p className={`text-[10px] ${transaction.type === 'withdraw' ? 'text-red-700' : 'text-green-700'}`}>\n                               : {transaction.cashierName ?? ' '}\n                            </p>\n                            <p className={`text-sm ${transaction.type === 'withdraw' ? 'text-red-500' : 'text-green-600'}`}>\n                              {transaction.createdAt.toLocaleString('en-GB')}\n                            </p>\n                          </div>\n                        </div>\n                        <div className=\"text-right\">\n                          {transaction.type !== 'withdraw' && (\n                            <p className=\"font-bold text-sm text-green-700\">\n                              {formatNumberEnglish(transaction.amount)} \n                            </p>\n                          )}\n                          {transaction.withdrawnAmount && (\n                            <p className=\"text-sm text-red-600\">\n                              : {formatNumberEnglish(transaction.withdrawnAmount)} \n                            </p>\n                          )}\n                          {transaction.sentAmount && (\n                            <p className=\"text-sm text-green-600\">\n                              : {formatNumberEnglish(transaction.sentAmount)} \n                            </p>\n                          )}\n                          <Badge \n                            variant={transaction.status === 'completed' ? 'default' : 'secondary'} \n                            className={`text-sm ${transaction.status === 'completed' ? (transaction.type === 'withdraw' ? 'bg-red-100 text-red-800 border-red-300' : (transaction.type === 'send' ? 'bg-green-100 text-green-800 border-green-300' : '')) : (transaction.type === 'withdraw' ? 'bg-red-100 text-red-800' : '')}`}\n                          >\n                            {transaction.type === 'withdraw' ? '' : getStatusText(transaction.status)}\n                          </Badge>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"send\" className=\"mt-2 receipts-list\">\n                {effectiveTransactions.filter(t => t.type === 'send').length === 0 ? (\n                  <div className=\"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]\">\n                         \n                  </div>\n                ) : (\n                  <div className=\"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400\">\n                    {effectiveTransactions.filter(t => t.type === 'send').map((transaction, index) => (\n                      <div \n                        key={transaction.id} \n                        className=\"relative flex items-center gap-4 p-4 rounded-xl bg-card border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer\"\n                        onClick={() => handleTransactionClick(transaction)}\n                      >\n                        {/* Icon Column */}\n                        <div className=\"h-12 w-12 rounded-full flex items-center justify-center shrink-0 bg-green-50\">\n                           <ArrowUpRight className=\"h-6 w-6 text-green-600\" />\n                        </div>\n\n                        {/* Content Column */}\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center justify-between mb-1\">\n                            <h4 className=\"text-base font-bold text-foreground truncate\">\n                               {transaction.receiverPhone}\n                            </h4>\n                            <span className=\"text-base font-bold text-green-600 whitespace-nowrap\">\n                              - {formatNumberEnglish(transaction.amount)} .\n                            </span>\n                          </div>\n\n                          <div className=\"flex items-center justify-between\">\n                             <div className=\"flex flex-col gap-0.5\">\n                                <p className=\"text-sm text-muted-foreground truncate\">\n                                   : {transaction.receiverPhone}\n                                </p>\n                                <p className=\"text-sm font-medium text-gray-500 mt-0.5\">\n                                   {transaction.createdAt.toLocaleString('ar-EG', { day: 'numeric', month: 'short', hour: 'numeric', minute: 'numeric', hour12: true })}\n                                </p>\n                             </div>\n\n                             <div className={`px-2.5 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${\n                                transaction.status === 'completed' \n                                  ? 'bg-green-50 text-green-700' \n                                  : transaction.status === 'pending'\n                                  ? 'bg-yellow-50 text-yellow-700'\n                                  : 'bg-red-50 text-red-700'\n                             }`}>\n                                {transaction.status === 'completed' && <Check className=\"h-3 w-3\" />}\n                                {transaction.status === 'pending' && <Clock className=\"h-3 w-3\" />}\n                                {transaction.status === 'failed' && <X className=\"h-3 w-3\" />}\n                                <span>\n                                   {getStatusText(transaction.status)}\n                                </span>\n                             </div>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"withdraw\" className=\"mt-2 receipts-list\">\n                {effectiveTransactions.filter(t => t.type === 'withdraw').length === 0 ? (\n                  <div className=\"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]\">\n                         \n                  </div>\n                ) : (\n                  <div className=\"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400\">\n                    {effectiveTransactions.filter(t => t.type === 'withdraw').map((transaction, index) => (\n                      <div \n                        key={transaction.id} \n                        className=\"relative flex items-center gap-4 p-4 rounded-xl bg-card border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer\"\n                        onClick={() => handleTransactionClick(transaction)}\n                      >\n                        {/* Icon Column */}\n                        <div className=\"h-12 w-12 rounded-full flex items-center justify-center shrink-0 bg-red-50\">\n                           <ArrowDownLeft className=\"h-6 w-6 text-red-600\" />\n                        </div>\n\n                        {/* Content Column */}\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center justify-between mb-1\">\n                            <h4 className=\"text-base font-bold text-foreground truncate\">\n                               {transaction.receiverPhone}\n                            </h4>\n                            <span className=\"text-base font-bold text-red-600 whitespace-nowrap\">\n                              + {formatNumberEnglish(transaction.amount)} .\n                            </span>\n                          </div>\n\n                          <div className=\"flex items-center justify-between\">\n                             <div className=\"flex flex-col gap-0.5\">\n                                <p className=\"text-sm text-muted-foreground truncate\">\n                                   : {transaction.senderPhone}\n                                </p>\n                                <p className=\"text-sm font-medium text-gray-500 mt-0.5\">\n                                   {transaction.createdAt.toLocaleString('ar-EG', { day: 'numeric', month: 'short', hour: 'numeric', minute: 'numeric', hour12: true })}\n                                </p>\n                             </div>\n\n                             <div className={`px-2.5 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${\n                                transaction.status === 'completed' \n                                  ? 'bg-red-50 text-red-700' \n                                  : transaction.status === 'pending'\n                                  ? 'bg-yellow-50 text-yellow-700'\n                                  : 'bg-red-50 text-red-700'\n                             }`}>\n                                {transaction.status === 'completed' && <Check className=\"h-3 w-3\" />}\n                                {transaction.status === 'pending' && <Clock className=\"h-3 w-3\" />}\n                                {transaction.status === 'failed' && <X className=\"h-3 w-3\" />}\n                                <span>\n                                   {getStatusText(transaction.status)}\n                                </span>\n                             </div>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n              <TabsContent value=\"deleted\" className=\"mt-2\">\n                {deletedTransactions.length === 0 ? (\n                  <div className=\"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]\">\n                       \n                  </div>\n                ) : (\n                  <div className=\"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400\">\n                    {deletedTransactions.map((transaction, index) => (\n                      <div \n                        key={transaction.id} \n                        className=\"receipts-row flex items-center justify-between p-3 rounded-lg border\"\n                      >\n                        <div className=\"flex items-center gap-1\">\n                          {getStatusIcon(transaction.status, transaction.type)}\n                          <div>\n                            <p className=\"font-medium text-sm text-red-700\">\n                              {transaction.type === 'withdraw' \n                                ? transaction.receiverPhone\n                                : `${transaction.senderPhone}  ${transaction.receiverPhone}`\n                              }\n                            </p>\n                            {transaction.type === 'withdraw' && (\n                              <>\n                                <p className=\"text-sm font-semibold text-red-600\">\n                                  {formatNumberEnglish(transaction.amount)} \n                                </p>\n                                <p className=\"text-xs text-orange-500\">\n                                  : {formatNumberEnglish(transaction.commission || 0)} \n                                </p>\n                              </>\n                            )}\n                            <p className=\"text-[10px] text-red-700\">\n                               : {transaction.cashierName ?? ' '}\n                            </p>\n                            <p className=\"text-sm text-red-500\">\n                              {transaction.createdAt.toLocaleString('ar-EG')}\n                            </p>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <div className=\"text-right mr-2\">\n                            {transaction.type !== 'withdraw' && (\n                              <p className=\"font-bold text-sm text-red-700\">\n                                {formatNumberEnglish(transaction.amount)} \n                              </p>\n                            )}\n                            <StatusChip variant=\"error\" text=\"\" />\n                          </div>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"text-green-600 hover:bg-green-100 h-10 sm:h-12 px-4 sm:px-5 min-w-[44px] touch-manipulation\"\n                            onClick={() => handleOpenRestoreDialog(transaction)}\n                          >\n                            <span className=\"text-xs sm:text-sm\"></span>\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"text-red-600 hover:bg-red-100 h-10 sm:h-12 px-3 sm:px-4 min-w-[44px] touch-manipulation\"\n                            onClick={() => permanentlyDeleteTransaction(transaction.id)}\n                          >\n                            <Trash2 className=\"h-4 w-4 sm:h-5 sm:w-5\" />\n                          </Button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n            </Tabs>\n        </CardContent>\n       </Card>\n\n        {/*    */}\n        <Dialog open={isGuideOpen} onOpenChange={setIsGuideOpen}>\n          <DialogContent className=\"dialog-modern max-w-3xl w-full p-0 overflow-hidden border-0 shadow-2xl\">\n            <DialogHeader className=\"px-4 pt-4\">\n              <DialogTitle className=\"text-lg font-bold\">{guideTitle || ' '}</DialogTitle>\n            </DialogHeader>\n            <div className=\"aspect-video w-full bg-black\">\n              {guideUrl ? (\n                <iframe\n                  src={toYouTubeEmbed(guideUrl)}\n                  title=\"Application Guide\"\n                  className=\"w-full h-full\"\n                  allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\"\n                  allowFullScreen\n                />\n              ) : (\n                <div className=\"flex items-center justify-center h-full text-white/80\">    </div>\n              )}\n            </div>\n          </DialogContent>\n        </Dialog>\n\n        {/*   */}\n        <MaintenanceDialog open={isMaintenanceOpen} onOpenChange={setIsMaintenanceOpen} />\n      </div>\n      \n      {/* Credit Cards Dialog */}\n      <CreditCardsDialog\n        isOpen={isCreditCardsOpen}\n        onClose={() => setIsCreditCardsOpen(false)}\n      />\n      <MasterPinDialog\n        open={isDebtsPasswordDialogOpen}\n        onOpenChange={setIsDebtsPasswordDialogOpen}\n        mode=\"verify\"\n        title=\"    \"\n        description=\"      \"\n        onSuccess={() => {\n          setIsDebtsPasswordDialogOpen(false);\n          //       \n          navigate('/user', { state: { openDebtDialog: true } });\n        }}\n      />\n      <PasswordConfirmDialog\n        open={isResetRecentDialogOpen}\n        onOpenChange={setIsResetRecentDialogOpen}\n        title=\"       \"\n        description=\"                 Firebase.\"\n        onSuccess={async () => {\n          try {\n            if (!user?.uid) {\n              setIsResetRecentDialogOpen(false);\n              return;\n            }\n            const resetAt = new Date();\n            const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : new Date(String(v));\n            //           .\n            //          .\n\n            //      Firestore    \n            await userDataService.updateUserData(user.uid, {\n              recentReset: {\n                keepLastCount: recentResetConfig.keepLastCount ?? 30,\n                intervalDays: recentResetConfig.intervalDays ?? 7,\n                lastResetAt: resetAt\n              }\n            });\n            setRecentResetConfig(cfg => ({ ...cfg, lastResetAt: resetAt }));\n\n            toast({ title: '   ', description: '              /  .' });\n          } catch (e) {\n            console.error('   :', e);\n            toast({ title: ' ', description: '     .', variant: 'destructive' });\n          } finally {\n            setIsResetRecentDialogOpen(false);\n          }\n        }}\n      />\n\n      {/*    */}\n      <Dialog open={isTopUpOpen} onOpenChange={(open) => {\n        if (open) {\n          const allowedEmail = 'alkaptin678678@gmail.com';\n          const userEmail = auth.currentUser?.email?.toLowerCase();\n          if (!userEmail || userEmail !== allowedEmail) {\n            toast({ title: ' ', description: '    .' });\n            return; //   \n          }\n          setIsTopUpOpen(true);\n        } else {\n          setIsTopUpOpen(false);\n        }\n      }}>\n        <DialogContent dir=\"rtl\" className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>  </DialogTitle>\n          </DialogHeader>\n\n          <div className=\"space-y-3\">\n            <div>\n              <label className=\"block text-right mb-1\"> </label>\n              <Input\n                value={topupPhone}\n                onChange={(e) => setTopupPhone(e.target.value)}\n                placeholder=\"01XXXXXXXXX\"\n                dir=\"ltr\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-right mb-1\"></label>\n              <Select value={topupOperator} onValueChange={setTopupOperator}>\n                <SelectTrigger className=\"w-full\">\n                  <SelectValue placeholder=\" \" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"vodafone_eg\"></SelectItem>\n                  <SelectItem value=\"orange_eg\"></SelectItem>\n                  <SelectItem value=\"etisalat_eg\"></SelectItem>\n                  <SelectItem value=\"we_eg\">WE</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <label className=\"block text-right mb-1\"> </label>\n              <Input\n                type=\"number\"\n                min={1}\n                value={topupAmount as number | ''}\n                onChange={(e) => setTopupAmount(e.target.value ? Number(e.target.value) : '')}\n                placeholder=\"50\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between gap-2 pt-2\">\n              <Button variant=\"outline\" onClick={() => setIsTopUpOpen(false)}></Button>\n              <div className=\"flex items-center gap-2\">\n                <Button variant=\"secondary\" onClick={() => navigate('/topup')}>  </Button>\n                <Button onClick={submitTopUp} disabled={topupLoading || !topupPhone || !topupOperator || !topupAmount}>\n                  {topupLoading ? ' ...' : ' '}\n                </Button>\n              </div>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/*    */}\n      <Dialog open={isRestoreConfirmOpen} onOpenChange={setIsRestoreConfirmOpen}>\n        <DialogContent className=\"sm:max-w-[460px]\">\n          <DialogHeader>\n            <DialogTitle>  </DialogTitle>\n            <DialogDescription>\n                    .\n            </DialogDescription>\n          </DialogHeader>\n          {pendingRestoreTx && (\n            <div className=\"mt-2 space-y-2 text-sm\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-gray-600\"></span>\n                <span className=\"font-bold\">{pendingRestoreTx.amount} </span>\n              </div>\n              {pendingRestoreTx.type === 'withdraw' ? (\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-gray-600\"></span>\n                  <span className=\"font-medium\">{pendingRestoreTx.receiverPhone}</span>\n                </div>\n              ) : (\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-gray-600\">  </span>\n                  <span className=\"font-medium\">{pendingRestoreTx.senderPhone}  {pendingRestoreTx.receiverPhone}</span>\n                </div>\n              )}\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-gray-600\"></span>\n                <span className=\"font-medium\">{pendingRestoreTx.cashierName ?? ' '}</span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-gray-600\"></span>\n                <span className=\"font-medium\">{pendingRestoreTx.createdAt.toLocaleString('ar-EG')}</span>\n              </div>\n            </div>\n          )}\n          <div className=\"flex items-center justify-between gap-2 pt-3\">\n            <Button variant=\"outline\" onClick={() => { setIsRestoreConfirmOpen(false); setPendingRestoreTx(null); }}></Button>\n            <Button onClick={handleConfirmRestore}> </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <ReceiptModal\n        isOpen={isReceiptOpen}\n        onClose={() => setIsReceiptOpen(false)}\n        transaction={receiptTransaction}\n        onPrint={() => window.print()}\n        onDelete={handleDeleteReceipt}\n        onComplete={handleCompleteReceipt}\n      />\n\n      <MasterPinDialog\n        open={isInstallmentPinOpen}\n        onOpenChange={setIsInstallmentPinOpen}\n        mode=\"verify\"\n        title=\"  \"\n        description=\"       \"\n        onSuccess={() => {\n          setIsInstallmentPinOpen(false);\n          setIsInstallmentModalOpen(true);\n        }}\n      />\n\n      <InstallmentModal\n        open={isInstallmentModalOpen}\n        onOpenChange={setIsInstallmentModalOpen}\n      />\n    </div>\n  );\n  };\n\nexport default TransactionsPage;\n"],"file":"assets/TransactionsPage-vZbFUf7u.js"}