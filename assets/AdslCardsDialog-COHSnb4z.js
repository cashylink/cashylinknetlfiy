import{u as ze,l as Ue,r as l,q as ge,aF as he,p as O,s as f,Q as V,T as y,j as e,af as A,ag as P,ai as I,aG as E,B as g,au as qe,a8 as Z,I as p,a1 as Je,P as Ge,at as We,U as _e,aH as ee,M as Ke,ah as B,x as b,ar as M,D,A as ue,aI as Qe,aJ as Xe,$ as Ye}from"./index-CzMrJEuC.js";import{T as Ve}from"./textarea-DH9YvORw.js";import{T as Ze,a as es,b as fe,c as se,d as ss,e as ae}from"./table-B3xDson-.js";import{W as te,P as as,H as ts}from"./wifi--Er0opd2.js";import{B as H}from"./SimCardsAccessDialog-p84rP6ZI.js";import{S as pe}from"./tabs-CUOI6ynQ.js";import{S as rs}from"./save-C_zXO1pj.js";import"./select-DHMtOuee.js";import"./index-BBRmOonx.js";function hs({isOpen:z,onClose:re,shopId:be}){const{user:t}=ze(),{toast:m}=Ue(),[v,w]=l.useState([]),[je,$]=l.useState(!0),[T,Ne]=l.useState(""),[u,U]=l.useState("all"),[ve,F]=l.useState(!1),[q,ne]=l.useState(null),[J,ie]=l.useState(!1),[r,j]=l.useState({name:"",simNumber:"",lineNumber:"",agent:"",whatsappNumber:"",callsPackage:"",internetPackage:"",adslPackage:"",totalAmount:"",remainingAmount:"",nationalId:"",isPaid:!1,notes:""}),[ye,R]=l.useState(!1),[L,we]=l.useState(null),[G,le]=l.useState(""),[de,oe]=l.useState(""),[ke,S]=l.useState(!1),[W,ce]=l.useState(!1),[Ce,De]=l.useState([]),[_,Se]=l.useState(""),[K,Ae]=l.useState(()=>{const s=new Date,a=s.getFullYear(),i=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return`${a}-${i}-${n}`}),[k,me]=l.useState("day");l.useEffect(()=>{if(!(t!=null&&t.uid))return;const s=`adslCards_${t.uid}`;try{const n=localStorage.getItem(s);n&&(w(JSON.parse(n)),$(!1))}catch(n){console.warn("Error loading adsl cards from localStorage",n)}if(!z)return;$(!0);const a=ge(O(f,"adslCards"),he("userId","==",t.uid)),i=V(a,n=>{const o=n.docs.map(h=>({id:h.id,...h.data()})).sort((h,d)=>{var c,C;const x=((c=h.createdAt)==null?void 0:c.seconds)||0;return(((C=d.createdAt)==null?void 0:C.seconds)||0)-x});w(o);try{localStorage.setItem(s,JSON.stringify(o))}catch{}$(!1)},n=>{console.error("Error fetching ADSL cards:",n),m({title:"خطأ",description:"تعذّر تحميل البيانات. تأكد من الصلاحيات والاتصال.",variant:"destructive"}),$(!1)});return()=>i()},[t==null?void 0:t.uid,z]);const Q=s=>{s?(ne(s),j({name:s.name,simNumber:s.simNumber,lineNumber:s.lineNumber,agent:s.agent||"",whatsappNumber:s.whatsappNumber||"",callsPackage:s.callsPackage,internetPackage:s.internetPackage,adslPackage:s.adslPackage||"",totalAmount:s.totalAmount.toString(),remainingAmount:s.remainingAmount.toString(),nationalId:s.nationalId||"",isPaid:s.isPaid||!1,notes:s.notes||""})):(ne(null),j({name:"",simNumber:"",lineNumber:"",agent:"",whatsappNumber:"",callsPackage:"",internetPackage:"",adslPackage:"",totalAmount:"",remainingAmount:"",nationalId:"",isPaid:!1,notes:""})),F(!0)},Pe=async()=>{if(console.log("handleSave started"),!(t!=null&&t.uid)){const s="لم يتم العثور على بيانات المستخدم";m({title:"خطأ",description:s,variant:"destructive"}),alert(s);return}if(!r.name.trim()){const s="يرجى إدخال الاسم";m({title:"خطأ",description:s,variant:"destructive"}),alert(s);return}if(!r.lineNumber.trim()){const s="يرجى إدخال رقم الخط";m({title:"خطأ",description:s,variant:"destructive"}),alert(s);return}ie(!0);try{const s={name:r.name,simNumber:r.simNumber||"",lineNumber:r.lineNumber,agent:r.agent||"",whatsappNumber:r.whatsappNumber||"",callsPackage:r.callsPackage||"",internetPackage:r.internetPackage||"",adslPackage:r.adslPackage||"",totalAmount:parseFloat(r.totalAmount)||0,remainingAmount:parseFloat(r.remainingAmount)||0,nationalId:r.nationalId||"",isPaid:r.isPaid||!1,notes:r.notes,userId:t.uid,shopId:be||t.uid,updatedAt:D()};console.log("Saving card data:",s),q?(await M(y(f,"adslCards",q.id),s),m({title:"تم التحديث",description:"تم تحديث بيانات الاشتراك بنجاح"})):(await ue(O(f,"adslCards"),{...s,createdAt:D()}),m({title:"تم الإضافة",description:"تم إضافة الاشتراك الجديد بنجاح"})),F(!1)}catch(s){console.error("Error saving ADSL card:",s),m({title:"خطأ",description:`حدث خطأ أثناء الحفظ: ${s.message}`,variant:"destructive"}),alert(`حدث خطأ أثناء الحفظ: ${s.message}`)}finally{ie(!1)}},Ie=async s=>{if(confirm("هل أنت متأكد من حذف هذا الاشتراك؟"))try{await Qe(y(f,"adslCards",s)),m({title:"تم الحذف",description:"تم حذف الاشتراك بنجاح"})}catch(a){console.error(a),m({title:"خطأ",description:"فشل الحذف",variant:"destructive"})}},X=async(s,a)=>{w(i=>i.map(n=>n.id===s.id?{...n,isPaid:a,isDeferred:!1}:n));try{await M(y(f,"adslCards",s.id),{isPaid:a,isDeferred:!1,updatedAt:D()}),a&&await ue(O(f,"adslReceipts"),{cardId:s.id,cardName:s.name,amount:s.totalAmount,userId:t==null?void 0:t.uid,createdAt:D(),type:"payment"}),m({title:"تم التحديث",description:a?"تم تحديد الاشتراك كمدفوع وتم تسجيل إيصال":"تم تحديد الاشتراك كغير مدفوع"})}catch(i){w(n=>n.map(o=>o.id===s.id?{...o,isPaid:!a,isDeferred:s.isDeferred}:o)),console.error(i),m({title:"خطأ",description:"حدث خطأ أثناء تحديث الحالة",variant:"destructive"})}},$e=s=>{var a;we(s),le(s.name||""),oe(((a=s.totalAmount)==null?void 0:a.toString())||""),R(!0)},Te=async()=>{if(!(t!=null&&t.uid)||!L)return;if(!G.trim()){m({title:"خطأ",description:"يرجى إدخال اسم العميل",variant:"destructive"});return}const s=parseFloat(de);if(isNaN(s)||s<=0){m({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}try{const a=y(f,"users",t.uid),n=(await Ye(a)).data(),o=Array.isArray(n==null?void 0:n.debts)?n.debts:[],h={id:`DEBT-${Date.now()}`,debtorName:G,mobile:L.lineNumber,amount:s,reason:"تمن تسديد باقة ADSL",status:"pending",createdAt:new Date,paidAmount:0,partialPayments:[]};await M(a,{debts:[h,...o]}),w(d=>d.map(x=>x.id===L.id?{...x,isPaid:!1,isDeferred:!0,debtId:h.id}:x)),await M(y(f,"adslCards",L.id),{isPaid:!1,isDeferred:!0,debtId:h.id,updatedAt:D()}),m({title:"تم الإضافة",description:"تم إضافة الدين وتأجيل الاشتراك"}),R(!1)}catch(a){console.error(a),m({title:"خطأ",description:"حدث خطأ أثناء حفظ الدين",variant:"destructive"})}};l.useEffect(()=>{if(!(t!=null&&t.uid))return;const s=y(f,"users",t.uid),a=V(s,async i=>{if(i.exists()){const o=i.data().debts||[],h=v.filter(d=>d.isDeferred&&!d.isPaid);for(const d of h){let x=!1;if(d.debtId){const N=o.find(c=>c.id===d.debtId);N&&N.status==="paid"&&(x=!0)}else o.find(c=>c.status==="paid"&&c.reason==="تمن تسديد باقة ADSL"&&(c.mobile&&c.mobile===d.lineNumber||!c.mobile&&c.debtorName===d.name&&Math.abs(c.amount-d.totalAmount)<.1))&&(x=!0);x&&await X(d,!0)}}});return()=>a()},[t==null?void 0:t.uid,v]);const xe=v.filter(s=>{const a=s.name.toLowerCase().includes(T.toLowerCase())||s.lineNumber.includes(T)||s.simNumber.includes(T),i=u==="all"?!0:u==="paid"?s.isPaid:u==="unpaid"?!s.isPaid&&!s.isDeferred:u==="deferred"?s.isDeferred:!0;return a&&i}),Fe=v.filter(s=>s.isPaid).length,Re=v.filter(s=>!s.isPaid&&!s.isDeferred).length,Le=v.filter(s=>s.isDeferred).length,Oe=async()=>{S(!0)},Ee=async()=>{if(t!=null&&t.uid)try{const s=Xe(f);v.forEach(a=>{if(a.isPaid){const i=y(f,"adslCards",a.id);s.update(i,{isPaid:!1,updatedAt:D()})}}),await s.commit(),w(a=>a.map(i=>({...i,isPaid:!1}))),m({title:"تم التحديث",description:"تم تحويل جميع الاشتراكات إلى غير مدفوع بنجاح"}),S(!1)}catch(s){console.error("Error resetting cards:",s),m({title:"خطأ",description:"حدث خطأ أثناء تحديث الاشتراكات",variant:"destructive"}),S(!1)}};l.useEffect(()=>{if(!W||!(t!=null&&t.uid))return;const s=ge(O(f,"adslReceipts"),he("userId","==",t.uid)),a=V(s,i=>{const n=i.docs.map(o=>({id:o.id,...o.data()}));n.sort((o,h)=>{var N,c;const d=((N=o.createdAt)==null?void 0:N.seconds)||Math.floor(Date.now()/1e3);return(((c=h.createdAt)==null?void 0:c.seconds)||Math.floor(Date.now()/1e3))-d}),De(n)},i=>{console.error("Error fetching receipts:",i),m({title:"خطأ",description:"فشل تحميل السجل",variant:"destructive"})});return()=>a()},[W,t==null?void 0:t.uid]);const Y=Ce.filter(s=>{var N;if(_.trim()){const c=_.toLowerCase(),C=v.find(He=>He.id===s.cardId),Be=s.cardName.toLowerCase().includes(c),Me=C?C.lineNumber.includes(c)||C.simNumber.includes(c):!1;return Be||Me}const a=(N=s.createdAt)!=null&&N.seconds?s.createdAt.seconds*1e3:Date.now(),i=new Date(a),[n,o,h]=K.split("-").map(Number),d=new Date(n,o-1,h),x=new Date(n,o-1,h);return k==="day"?(d.setHours(0,0,0,0),x.setHours(23,59,59,999)):(d.setDate(1),d.setHours(0,0,0,0),x.setMonth(x.getMonth()+1),x.setDate(0),x.setHours(23,59,59,999)),i>=d&&i<=x});return e.jsxs(e.Fragment,{children:[e.jsx(A,{open:z,onOpenChange:s=>!s&&re(),children:e.jsxs(P,{className:"max-w-screen w-screen h-screen flex flex-col p-0 gap-0 bg-gray-50 dark:bg-gray-900 rounded-none border-0",children:[e.jsxs("div",{className:"p-3 border-b bg-white dark:bg-gray-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 dark:bg-blue-900/30 rounded-full text-blue-600",children:e.jsx(te,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"text-base font-bold",children:"إدارة ADSL"}),e.jsx(E,{className:"text-xs",children:"سجل ومتابعة اشتراكات ADSL"})]})]}),e.jsx(g,{onClick:()=>re(),variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(qe,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 p-2 bg-gray-50/50 dark:bg-gray-900/50 border-b",children:[e.jsxs("div",{onClick:()=>U(u==="paid"?"all":"paid"),className:`cursor-pointer rounded-md border py-1.5 px-2 flex flex-row items-center justify-center gap-2 transition-all hover:shadow-sm ${u==="paid"?"bg-green-100 border-green-300 ring-1 ring-green-500 ring-offset-1 dark:ring-offset-gray-900":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-green-300"}`,children:[e.jsx("div",{className:`p-1 rounded-full ${u==="paid"?"bg-green-200":"bg-green-100"} text-green-700`,children:e.jsx(H,{className:"h-3.5 w-3.5"})}),e.jsxs("div",{className:"flex items-center gap-1.5 leading-none",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-600 dark:text-gray-400",children:"المدفوعة"}),e.jsx("div",{className:"text-sm font-bold text-green-600",children:Fe})]})]}),e.jsxs("div",{onClick:()=>U(u==="unpaid"?"all":"unpaid"),className:`cursor-pointer rounded-md border py-1.5 px-2 flex flex-row items-center justify-center gap-2 transition-all hover:shadow-sm ${u==="unpaid"?"bg-red-100 border-red-300 ring-1 ring-red-500 ring-offset-1 dark:ring-offset-gray-900":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-red-300"}`,children:[e.jsx("div",{className:`p-1 rounded-full ${u==="unpaid"?"bg-red-200":"bg-red-100"} text-red-700`,children:e.jsx(Z,{className:"h-3.5 w-3.5"})}),e.jsxs("div",{className:"flex items-center gap-1.5 leading-none",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-600 dark:text-gray-400",children:"غير المدفوعة"}),e.jsx("div",{className:"text-sm font-bold text-red-600",children:Re})]})]}),e.jsxs("div",{onClick:()=>U(u==="deferred"?"all":"deferred"),className:`cursor-pointer rounded-md border py-1.5 px-2 flex flex-row items-center justify-center gap-2 transition-all hover:shadow-sm ${u==="deferred"?"bg-orange-100 border-orange-300 ring-1 ring-orange-500 ring-offset-1 dark:ring-offset-gray-900":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-orange-300"}`,children:[e.jsx("div",{className:`p-1 rounded-full ${u==="deferred"?"bg-orange-200":"bg-orange-100"} text-orange-700`,children:e.jsx(Z,{className:"h-3.5 w-3.5"})}),e.jsxs("div",{className:"flex items-center gap-1.5 leading-none",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-600 dark:text-gray-400",children:"مؤجلة الدفع"}),e.jsx("div",{className:"text-sm font-bold text-orange-600",children:Le})]})]})]}),e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 border-b flex flex-col md:flex-row gap-3 justify-between items-center",children:[e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(pe,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(p,{placeholder:"بحث بالاسم أو الرقم...",value:T,onChange:s=>Ne(s.target.value),className:"pr-9"})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs(g,{onClick:()=>ce(!0),variant:"outline",className:"flex-1 md:flex-none gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"سجل السداد"]}),e.jsxs(g,{onClick:()=>Q(),className:"flex-1 md:flex-none bg-blue-600 hover:bg-blue-700 text-white gap-2",children:[e.jsx(Je,{className:"h-4 w-4"}),"إضافة اشتراك جديد"]}),e.jsxs(g,{onClick:Oe,variant:"destructive",className:"flex-1 md:flex-none gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"تحويل الكل لغير مدفوع"]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:je?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):xe.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(te,{className:"h-12 w-12 mb-3 opacity-20"}),e.jsx("p",{children:"لا توجد اشتراكات مسجلة"}),e.jsx(g,{variant:"link",onClick:()=>Q(),className:"text-blue-600",children:"إضافة أول اشتراك"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:xe.map(s=>e.jsxs("div",{className:`rounded-xl shadow-sm border p-2 hover:shadow-md transition-shadow ${s.isDeferred?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800":s.isPaid?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`h-8 w-8 rounded-full flex items-center justify-center font-bold text-sm ${s.isDeferred?"bg-orange-100 text-orange-700 dark:bg-orange-800 dark:text-orange-100":s.isPaid?"bg-green-100 text-green-700 dark:bg-green-800 dark:text-green-100":"bg-red-100 text-red-700 dark:bg-red-800 dark:text-red-100"}`,children:s.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-gray-100 text-sm",children:s.name}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-gray-500",children:[e.jsx(Ge,{className:"h-3 w-3"}),e.jsx("span",{dir:"ltr",children:s.lineNumber})]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6 text-blue-600 hover:bg-blue-50",onClick:()=>Q(s),children:e.jsx(as,{className:"h-3 w-3"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-600 hover:bg-red-50",onClick:()=>Ie(s.id),children:e.jsx(We,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between py-0.5 border-b border-gray-200/50",children:[e.jsxs("span",{className:"text-gray-500 flex items-center gap-1",children:[e.jsx(ts,{className:"h-3 w-3"})," سريل الشريحه"]}),e.jsx("span",{className:"font-medium font-mono",children:s.simNumber||"-"})]}),s.agent&&e.jsxs("div",{className:"flex justify-between py-0.5 border-b border-gray-200/50",children:[e.jsxs("span",{className:"text-gray-500 flex items-center gap-1",children:[e.jsx(_e,{className:"h-3 w-3"})," الوكيل"]}),e.jsx("span",{className:"font-medium",children:s.agent})]}),e.jsxs("div",{className:"flex justify-between py-0.5 border-b border-gray-200/50",children:[e.jsxs("span",{className:"text-gray-500 flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3"})," اسم الباقة"]}),e.jsx("span",{className:"font-medium",children:s.adslPackage||"-"})]}),e.jsxs("div",{className:"flex justify-between py-1 pt-1.5",children:[e.jsxs("span",{className:"text-gray-500 flex items-center gap-1",children:[e.jsx(H,{className:"h-3 w-3"})," سعر الباقة"]}),e.jsx("span",{className:"font-bold text-gray-900",children:ee(s.totalAmount)})]}),s.whatsappNumber&&e.jsx("div",{className:"mt-2",children:e.jsxs(g,{variant:"outline",className:"w-full h-8 gap-2 text-green-600 border-green-200 hover:bg-green-50 hover:text-green-700",onClick:()=>{const a=`مرحباً ${s.name}،
تذكير بموعد دفع اشتراك الانترنت الأرضي الخاص بك.
المبلغ المطلوب: ${s.totalAmount} جنيه.
شكراً لك!`,i=`https://wa.me/2${s.whatsappNumber}?text=${encodeURIComponent(a)}`;window.open(i,"_blank")},children:[e.jsx(Ke,{className:"h-4 w-4"}),"تذكير بالدفع"]})}),e.jsxs("div",{className:"flex gap-2 mt-1.5 px-1",children:[e.jsx(g,{size:"sm",className:`flex-1 h-8 text-xs font-bold ${s.isPaid?"bg-green-600 hover:bg-green-700 text-white":"bg-white text-green-600 border border-green-200 hover:bg-green-50"}`,onClick:()=>X(s,!0),children:"مدفوع"}),e.jsx(g,{size:"sm",variant:"destructive",className:`flex-1 h-8 text-xs font-bold ${!s.isPaid&&!s.isDeferred?"bg-red-600 hover:bg-red-700 text-white":"bg-white text-red-600 border border-red-200 hover:bg-red-50"}`,onClick:()=>X(s,!1),children:"غير مدفوع"}),e.jsx(g,{size:"sm",variant:"outline",className:`flex-1 h-8 text-xs font-bold ${s.isDeferred?"bg-orange-600 hover:bg-orange-700 text-white":"text-orange-600 border-orange-200 hover:bg-orange-50"}`,onClick:()=>$e(s),children:"أجل"})]})]})]},s.id))})})]})}),e.jsx(A,{open:W,onOpenChange:ce,children:e.jsxs(P,{className:"max-w-2xl h-[80vh] flex flex-col p-0",children:[e.jsxs(B,{className:"p-4 border-b",children:[e.jsx(I,{children:"سجل سداد ADSL"}),e.jsx(E,{children:"عرض إيصالات السداد حسب التاريخ"})]}),e.jsxs("div",{className:"p-4 border-b bg-gray-50 flex flex-col gap-4",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx(pe,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(p,{placeholder:"بحث في السجل بالاسم أو الرقم...",value:_,onChange:s=>Se(s.target.value),className:"pr-9 bg-white"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-end w-full",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(b,{children:"نوع البحث"}),e.jsxs("div",{className:"flex bg-white rounded-md border p-1",children:[e.jsx("button",{onClick:()=>me("day"),className:`flex-1 px-3 py-1.5 text-sm rounded-sm transition-colors ${k==="day"?"bg-blue-100 text-blue-700 font-medium":"text-gray-600 hover:bg-gray-50"}`,children:"يومي"}),e.jsx("button",{onClick:()=>me("month"),className:`flex-1 px-3 py-1.5 text-sm rounded-sm transition-colors ${k==="month"?"bg-blue-100 text-blue-700 font-medium":"text-gray-600 hover:bg-gray-50"}`,children:"شهري"})]})]}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(b,{children:k==="day"?"اختر اليوم":"اختر الشهر"}),e.jsx(p,{type:k==="day"?"date":"month",value:k==="day"?K:K.substring(0,7),onChange:s=>Ae(s.target.value),className:"bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-500 mb-1",children:"إجمالي الفترة"}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:ee(Y.reduce((s,a)=>s+(a.amount||0),0))})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-0 relative",children:Y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-500",children:[e.jsx(H,{className:"h-12 w-12 mb-2 opacity-20"}),e.jsx("p",{children:"لا توجد عمليات سداد في هذه الفترة"})]}):e.jsxs(Ze,{children:[e.jsx(es,{className:"sticky top-0 bg-white z-10 shadow-sm",children:e.jsxs(fe,{children:[e.jsx(se,{className:"text-right",children:"التاريخ"}),e.jsx(se,{className:"text-right",children:"اسم الاشتراك"}),e.jsx(se,{className:"text-right",children:"المبلغ"})]})}),e.jsx(ss,{children:Y.map(s=>{var a;return e.jsxs(fe,{children:[e.jsx(ae,{className:"font-mono text-xs text-gray-500",children:(a=s.createdAt)!=null&&a.seconds?new Date(s.createdAt.seconds*1e3).toLocaleString("ar-EG"):"الآن"}),e.jsx(ae,{className:"font-medium",children:s.cardName}),e.jsx(ae,{className:"font-bold text-green-600",children:ee(s.amount)})]},s.id)})})]})})]})}),e.jsx(A,{open:ke,onOpenChange:S,children:e.jsxs(P,{className:"max-w-md",children:[e.jsxs(B,{children:[e.jsx(I,{children:"تأكيد التحويل"}),e.jsxs(E,{children:['هل أنت متأكد من تحويل جميع الاشتراكات إلى "غير مدفوع"؟',e.jsx("br",{}),"سيتم تغيير حالة الدفع لجميع الاشتراكات المسجلة."]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(g,{variant:"outline",onClick:()=>S(!1),children:"إلغاء"}),e.jsx(g,{variant:"destructive",onClick:Ee,children:"نعم، تحويل الكل"})]})]})}),e.jsx(A,{open:ve,onOpenChange:F,children:e.jsxs(P,{className:"max-w-md",children:[e.jsx(B,{children:e.jsx(I,{children:q?"تعديل بيانات الاشتراك":"إضافة اشتراك جديد"})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"الاسم"}),e.jsx(p,{value:r.name,onChange:s=>j({...r,name:s.target.value}),placeholder:"اسم العميل أو صاحب الخط"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"سريل الشريحه"}),e.jsx(p,{value:r.simNumber,onChange:s=>j({...r,simNumber:s.target.value}),placeholder:"سريل الشريحه..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"رقم الخط"}),e.jsx(p,{value:r.lineNumber,onChange:s=>j({...r,lineNumber:s.target.value}),placeholder:"0xxxxxxxx",dir:"ltr"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"الوكيل"}),e.jsx(p,{value:r.agent,onChange:s=>j({...r,agent:s.target.value}),placeholder:"اسم الوكيل..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"اسم الباقة"}),e.jsx(p,{value:r.adslPackage,onChange:s=>j({...r,adslPackage:s.target.value}),placeholder:"مثال: 140 جيجا"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"سعر الباقة"}),e.jsx(p,{type:"number",value:r.totalAmount,onChange:s=>j({...r,totalAmount:s.target.value}),placeholder:"0.00"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"رقم وتساب"}),e.jsx(p,{value:r.whatsappNumber,onChange:s=>j({...r,whatsappNumber:s.target.value}),placeholder:"01xxxxxxxxx",dir:"ltr"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"ملاحظات (اختياري)"}),e.jsx(Ve,{value:r.notes,onChange:s=>j({...r,notes:s.target.value}),placeholder:"أي ملاحظات إضافية...",className:"resize-none"})]}),e.jsxs("div",{className:"pt-4 flex gap-2",children:[e.jsx(g,{className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",onClick:Pe,disabled:J,children:J?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}),"جاري الحفظ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"h-4 w-4 ml-2"}),"حفظ"]})}),e.jsx(g,{variant:"outline",onClick:()=>F(!1),disabled:J,children:"إلغاء"})]})]})]})}),e.jsx(A,{open:ye,onOpenChange:R,children:e.jsxs(P,{className:"max-w-sm",children:[e.jsxs(B,{children:[e.jsx(I,{children:"تسجيل معاملة آجل"}),e.jsx(E,{children:"سيتم إضافة المبلغ للديون المستحقة"})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"اسم العميل"}),e.jsx(p,{value:G,onChange:s=>le(s.target.value),placeholder:"اسم العميل..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"المبلغ"}),e.jsx(p,{type:"number",value:de,onChange:s=>oe(s.target.value),placeholder:"0.00"})]}),e.jsxs("div",{className:"pt-2 flex gap-2",children:[e.jsx(g,{className:"flex-1 bg-orange-600 hover:bg-orange-700 text-white",onClick:Te,children:"تأكيد الأجل"}),e.jsx(g,{variant:"outline",onClick:()=>R(!1),children:"إلغاء"})]})]})]})})]})}export{hs as AdslCardsDialog};
//# sourceMappingURL=AdslCardsDialog-COHSnb4z.js.map
