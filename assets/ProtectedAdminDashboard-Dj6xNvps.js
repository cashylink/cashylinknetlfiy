const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-mBSeGJ8K.js","./index-BsQ0vdi0.css","./freeTrialService-DU8cwcbX.js"])))=>i.map(i=>d[i]);
import{Z as ye,Q as Y,s as C,aq as ie,D as tt,q as ae,aE as Oe,p as K,w as fe,A as pr,b as br,l as Sa,r,j as e,C as Qe,c as as,d as rs,M as Es,f as Ze,e as fr,a2 as jr,x as ia,P as ka,I as at,B as H,G as yr,H as Nr,h as Ea,aw as Aa,a3 as p,at as Me,U as rt,a7 as je,bH as As,R as Ds,aQ as vr,E as wr,bT as ls,F as lt,aT as ca,aX as Sr,ch as kr,t as Er,O as oa,as as da,ae as ys,af as Ns,ag as vs,ah as ws,aM as Xs,aK as Fe,v as Ar,ci as Dr,aG as B,cf as Cr,cj as Tr,ck as Da,V as _r,aO as Ur,aS as Ir,a0 as Js,n as ze,cl as Lr,y as Pr,z as Rr,Y as Fr,cm as Ca,cn as Mr,_ as Or,a as Vr,u as $r,aW as Br,o as Hr}from"./index-mBSeGJ8K.js";import{I as qr,u as Yr,g as xa,s as zr,l as Wr}from"./contentService-B-9y2tZi.js";import{P as Gr}from"./ProfileIcon-ElnJff9P.js";import{T as Qr}from"./textarea-BSkR6eBq.js";import{S as Zr}from"./switch-8_KpJux-.js";import{A as Kr,a as Xr}from"./alert-BKGZp8Qw.js";import{B as ve}from"./badge-D4Cxv57Q.js";import{S as Jr}from"./separator-xJo-nMhI.js";import{R as ns}from"./refresh-cw-VJ-sBqT-.js";import{S as We,a as el}from"./square-pen-7FbzHXSb.js";import{C as Ta,G as Ae}from"./gift-9ZQOjHz8.js";import{E as sl,p as tl}from"./broadcastService-BVTGigy9.js";import{B as Ge}from"./bell-DSbPVF9m.js";import{C as be}from"./calendar-DWuCbuTk.js";import{S as nt,a as it,b as ct,c as ot,d as xe}from"./select-DGk4nkpB.js";import{S as ks,M as ma}from"./smartphone-4Jjo_tT5.js";import{Z as os}from"./zap-PrHmOmUP.js";import{C as is}from"./crown-y81xSMbP.js";import{C as cs}from"./circle-check-big-C-Uwjs2Z.js";import{T as ha,a as ua,b as Pe,c as ne,d as ga,e as Z}from"./table-B-2w-DVH.js";import{T as al,a as rl,b as pa,c as ba,S as Re}from"./tabs-B85OgytT.js";import{U as Ss}from"./users-cmuW5heU.js";import{A as fa}from"./activity-C3VcmJNL.js";import{D as et}from"./download-C_W4yx38.js";import{C as ll}from"./circle-x-bWAeF-qD.js";import{P as nl}from"./pen-line-BxM__rGx.js";import"./dropdown-menu-Dko4WND7.js";import"./index-B0RoPUtu.js";import"./freeTrialService-DU8cwcbX.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const il=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],cl=ye("funnel",il);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ol=[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]],ja=ye("git-branch",ol);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dl=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],ya=ye("hard-drive",dl);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xl=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],ml=ye("menu",xl);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hl=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Na=ye("shield-check",hl);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ul=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],st=ye("upload",ul);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gl=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],dt=ye("user-check",gl);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pl=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],bl=ye("user-x",pl);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fl=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],jl=ye("volume-2",fl);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yl=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],Nl=ye("volume-x",yl),va={generateCode:async i=>{const n="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let h="";for(let v=0;v<8;v++)h+=n.charAt(Math.floor(Math.random()*n.length));const g=`${h.substring(0,4)}-${h.substring(4)}`;return await pr(K(C,"branchActivationCodes"),{code:g,isUsed:!1,createdAt:tt(),createdBy:i}),g},getAllCodes:async()=>{const i=ae(K(C,"branchActivationCodes"));return(await fe(i)).docs.map(h=>({id:h.id,...h.data()})).sort((h,g)=>{var d,_;const v=(d=h.createdAt)!=null&&d.toMillis?h.createdAt.toMillis():0;return((_=g.createdAt)!=null&&_.toMillis?g.createdAt.toMillis():0)-v})},validateCode:async i=>{const n=ae(K(C,"branchActivationCodes"),Oe("code","==",i)),h=await fe(n);if(h.empty)throw new Error("كود التفعيل غير صحيح");const g=h.docs[0].data(),v=h.docs[0].id;if(g.isUsed)throw new Error("تم استخدام هذا الكود مسبقاً");return{...g,docId:v}},markCodeAsUsed:async(i,n,h)=>{const g=Y(C,"branchActivationCodes",i);await ie(g,{isUsed:!0,usedAt:tt(),usedBy:n,createdShopId:h})}},vl=()=>{const{settings:i,loading:n,error:h,updateSettings:g,refreshSettings:v}=br(),{toast:w}=Sa(),[d,_]=r.useState({phoneNumber:"",defaultMessage:"",isEnabled:!0}),[f,S]=r.useState(!1),[k,O]=r.useState(!1),[F,N]=r.useState(""),[b,m]=r.useState({});r.useEffect(()=>{i&&_({phoneNumber:i.phoneNumber,defaultMessage:i.defaultMessage,isEnabled:i.isEnabled})},[i]);const M=()=>{var U,J;const u={};return(U=d.phoneNumber)!=null&&U.trim()?Aa(d.phoneNumber)||(u.phoneNumber="رقم الواتساب غير صحيح (يجب أن يحتوي على 10-15 رقم)"):u.phoneNumber="رقم الواتساب مطلوب",(J=d.defaultMessage)!=null&&J.trim()?d.defaultMessage.length<10&&(u.defaultMessage="الرسالة يجب أن تحتوي على 10 أحرف على الأقل"):u.defaultMessage="الرسالة الافتراضية مطلوبة",m(u),Object.keys(u).length===0},P=async()=>{if(!M()){w({title:"خطأ في البيانات",description:"يرجى تصحيح الأخطاء قبل الحفظ",variant:"destructive"});return}S(!0);try{if(await g(d))w({title:"تم الحفظ بنجاح",description:"تم تحديث إعدادات الواتساب بنجاح",variant:"default"});else throw new Error("فشل في الحفظ")}catch{w({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ الإعدادات",variant:"destructive"})}finally{S(!1)}},j=()=>{if(d.phoneNumber&&d.defaultMessage)try{const u=Ea(d.phoneNumber,d.defaultMessage);N(u),O(!0)}catch{w({title:"خطأ في المعاينة",description:"تأكد من صحة رقم الواتساب",variant:"destructive"})}},E=async()=>{try{await navigator.clipboard.writeText(F),w({title:"تم النسخ",description:"تم نسخ الرابط إلى الحافظة",variant:"default"})}catch{w({title:"خطأ في النسخ",description:"فشل في نسخ الرابط",variant:"destructive"})}},y=u=>{const U=u.replace(/[^\d+]/g,"");_(J=>({...J,phoneNumber:U})),b.phoneNumber&&m(J=>({...J,phoneNumber:""}))};return n?e.jsxs(Qe,{children:[e.jsx(as,{children:e.jsxs(rs,{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-5 w-5"}),"إدارة الواتساب"]})}),e.jsx(Ze,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ns,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"mr-2",children:"جاري التحميل..."})]})})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(Qe,{children:[e.jsxs(as,{children:[e.jsxs(rs,{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-5 w-5"}),"إدارة الواتساب"]}),e.jsx(fr,{children:"إدارة رقم الواتساب والرسائل الافتراضية المعروضة في جميع أنحاء الموقع"})]}),e.jsxs(Ze,{className:"space-y-6",children:[h&&e.jsxs(Kr,{variant:"destructive",children:[e.jsx(jr,{className:"h-4 w-4"}),e.jsx(Xr,{children:h})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${d.isEnabled?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"حالة خدمة الواتساب"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d.isEnabled?"مفعلة":"معطلة"})]})]}),e.jsx(Zr,{checked:d.isEnabled,onCheckedChange:u=>_(U=>({...U,isEnabled:u}))})]}),e.jsx(Jr,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ia,{htmlFor:"phoneNumber",className:"flex items-center gap-2",children:[e.jsx(ka,{className:"h-4 w-4"}),"رقم الواتساب"]}),e.jsx(at,{id:"phoneNumber",type:"tel",placeholder:"مثال: 201000392539",value:d.phoneNumber,onChange:u=>y(u.target.value),className:b.phoneNumber?"border-red-500":"",dir:"ltr"}),b.phoneNumber&&e.jsx("p",{className:"text-sm text-red-500",children:b.phoneNumber}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"أدخل رقم الواتساب مع رمز الدولة (مثال: 201000392539 لمصر)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ia,{htmlFor:"defaultMessage",children:"الرسالة الافتراضية"}),e.jsx(Qr,{id:"defaultMessage",placeholder:"مرحباً، أريد الاستفسار عن خدماتكم",value:d.defaultMessage,onChange:u=>{_(U=>({...U,defaultMessage:u.target.value})),b.defaultMessage&&m(U=>({...U,defaultMessage:""}))},className:b.defaultMessage?"border-red-500":"",rows:4}),b.defaultMessage&&e.jsx("p",{className:"text-sm text-red-500",children:b.defaultMessage}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"هذه الرسالة ستظهر افتراضياً عند النقر على أزرار الواتساب"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(H,{onClick:P,disabled:f,className:"flex items-center gap-2",children:[f?e.jsx(ns,{className:"h-4 w-4 animate-spin"}):e.jsx(We,{className:"h-4 w-4"}),f?"جاري الحفظ...":"حفظ التغييرات"]}),e.jsxs(H,{variant:"outline",onClick:j,disabled:!d.phoneNumber||!d.defaultMessage,className:"flex items-center gap-2",children:[k?e.jsx(yr,{className:"h-4 w-4"}):e.jsx(Nr,{className:"h-4 w-4"}),"معاينة الرابط"]}),e.jsxs(H,{variant:"outline",onClick:v,className:"flex items-center gap-2",children:[e.jsx(ns,{className:"h-4 w-4"}),"تحديث"]})]}),k&&F&&e.jsxs(Qe,{className:"bg-muted/50",children:[e.jsx(as,{children:e.jsx(rs,{className:"text-lg",children:"معاينة رابط الواتساب"})}),e.jsxs(Ze,{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-background rounded border font-mono text-sm break-all",children:F}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(H,{variant:"outline",size:"sm",onClick:E,className:"flex items-center gap-2",children:[e.jsx(Ta,{className:"h-4 w-4"}),"نسخ الرابط"]}),e.jsxs(H,{variant:"outline",size:"sm",onClick:()=>window.open(F,"_blank"),className:"flex items-center gap-2",children:[e.jsx(sl,{className:"h-4 w-4"}),"فتح في الواتساب"]})]})]})]}),i&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"معلومات الإعدادات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"آخر تحديث:"}),e.jsxs(ve,{variant:"outline",className:"mr-2",children:[i.lastUpdated.toLocaleDateString("ar-EG")," - ",i.lastUpdated.toLocaleTimeString("ar-EG")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),e.jsx(ve,{variant:i.isEnabled?"default":"secondary",className:"mr-2",children:i.isEnabled?"مفعل":"معطل"})]})]})]})]})]})})},Cs={enableVisualAlerts:!0,enableAudioAlerts:!0,criticalDays:1,warningDays:3,infoDays:7},wl=i=>{const n=new Date,g=new Date(i).getTime()-n.getTime();return Math.ceil(g/(1e3*60*60*24))},Sl=(i,n=Cs)=>i<0?"expired":i<=n.criticalDays?"critical":i<=n.warningDays?"warning":(i<=n.infoDays,"info"),kl=(i,n,h)=>{const g=El(h);return n<0?`انتهت صلاحية اشتراك ${g} للمستخدم ${i}`:n===0?`ينتهي اشتراك ${g} للمستخدم ${i} اليوم!`:n===1?`ينتهي اشتراك ${g} للمستخدم ${i} غداً`:`ينتهي اشتراك ${g} للمستخدم ${i} خلال ${n} أيام`},El=i=>{switch(i){case p.MONTHLY:return"الشهري";case p.YEARLY:return"السنوي";case p.LIFETIME:return"مدى الحياة";default:return"غير محدد"}},Al=async()=>{try{const i=K(C,"users"),n=ae(i,Oe("subscription","!=",null)),h=await fe(n),g=[];return h.forEach(v=>{var d,_,f,S;const w=v.data();w.subscription&&(w.subscription.planType||w.subscription.plan)&&g.push({id:v.id,...w,subscription:{...w.subscription,startDate:((_=(d=w.subscription.startDate)==null?void 0:d.toDate)==null?void 0:_.call(d))||new Date(w.subscription.startDate),endDate:((S=(f=w.subscription.endDate)==null?void 0:f.toDate)==null?void 0:S.call(f))||new Date(w.subscription.endDate),planType:w.subscription.planType||w.subscription.plan}})}),g}catch(i){return console.error("خطأ في جلب الاشتراكات النشطة:",i),[]}},Dl=async(i=Cs)=>{try{const n=await Al(),h=[];return n.forEach(g=>{if(!g.subscription||!g.subscription.endDate)return;const v=wl(g.subscription.endDate),w=Sl(v,i);if(v<=i.infoDays||v<0){const d={id:`${g.id}_${Date.now()}`,userId:g.id,userName:g.displayName||g.email||"مستخدم غير معروف",userEmail:g.email||"",subscriptionPlan:g.subscription.planType,expiryDate:g.subscription.endDate,daysRemaining:v,type:w,message:kl(g.displayName||g.email||"مستخدم غير معروف",v,g.subscription.planType),isRead:!1,createdAt:new Date};h.push(d)}}),h.sort((g,v)=>{const w={expired:0,critical:1,warning:2,info:3};return w[g.type]!==w[v.type]?w[g.type]-w[v.type]:g.daysRemaining-v.daysRemaining}),h}catch(n){return console.error("خطأ في إنشاء إشعارات الاشتراك:",n),[]}},Cl=(i,n)=>n?i.filter(h=>h.type===n):i,Tl=i=>{localStorage.setItem("notificationSettings",JSON.stringify(i))},_l=()=>{try{const i=localStorage.getItem("notificationSettings");if(i)return{...Cs,...JSON.parse(i)}}catch(i){console.error("خطأ في تحميل إعدادات الإشعارات:",i)}return Cs},Ul=({isOpen:i,onClose:n})=>{const[h,g]=r.useState([]),[v,w]=r.useState([]),[d,_]=r.useState("all"),[f,S]=r.useState(!0),[k,O]=r.useState(_l());r.useEffect(()=>{i&&F()},[i]),r.useEffect(()=>{w(d==="all"?h:Cl(h,d))},[h,d]);const F=async()=>{S(!0);try{const j=await Dl(k);g(j)}catch(j){console.error("خطأ في تحميل الإشعارات:",j)}finally{S(!1)}},N=j=>{switch(j){case"urgent":return e.jsx(As,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(je,{className:"w-5 h-5 text-yellow-500"});case"info":return e.jsx(Ge,{className:"w-5 h-5 text-blue-500"});default:return e.jsx(Ge,{className:"w-5 h-5 text-gray-500"})}},b=j=>{switch(j){case"urgent":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}},m=j=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(j),M=j=>{switch(j){case"all":return"جميع الإشعارات";case"urgent":return"عاجل (يوم واحد)";case"warning":return"تحذير (3 أيام)";case"info":return"معلومات (7 أيام)";default:return"غير محدد"}},P=j=>{const E={...k,[j]:!k[j]};O(E),Tl(E)};return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-xl font-bold",children:"مركز الإشعارات"}),h.length>0&&e.jsx("span",{className:"bg-white text-blue-600 px-2 py-1 rounded-full text-sm font-medium",children:h.length})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(Me,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cl,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"تصفية حسب:"})]}),["all","urgent","warning","info"].map(j=>e.jsx("button",{onClick:()=>_(j),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${d===j?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:M(j)},j))]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"الإعدادات:"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k.visualAlerts,onChange:()=>P("visualAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات المرئية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k.soundAlerts,onChange:()=>P("soundAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات الصوتية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k.autoRefresh,onChange:()=>P("autoRefresh"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التحديث التلقائي"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-96",children:f?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"جاري تحميل الإشعارات..."})]}):v.length===0?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(Ge,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"لا توجد إشعارات"}),e.jsx("p",{className:"text-gray-500",children:d==="all"?"لا توجد إشعارات حاليًا":`لا توجد إشعارات من نوع "${M(d)}"`})]}):e.jsx("div",{className:"p-4 space-y-3",children:v.map(j=>e.jsx("div",{className:`p-4 rounded-lg border-r-4 ${b(j.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[N(j.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:j.message}),e.jsx("span",{className:"text-xs text-gray-500",children:m(j.createdAt)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"المستخدم:"})," ",j.userName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"تاريخ الانتهاء:"})," ",m(j.expiryDate)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",j.daysRemaining]})]})]})]})]})},j.id))})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["آخر تحديث: ",m(new Date)]}),e.jsx("button",{onClick:F,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"تحديث الإشعارات"})]})})]})}):null},Il=({notification:i,onClose:n,soundEnabled:h,onToggleSound:g})=>{const[v,w]=r.useState(!1),[d,_]=r.useState(null);r.useEffect(()=>{if(i&&(w(!0),h&&f(i.type),i.type!=="urgent")){const N=setTimeout(()=>{S()},1e4);return()=>clearTimeout(N)}},[i,h]),r.useEffect(()=>{typeof window<"u"&&window.AudioContext&&_(new AudioContext)},[]);const f=N=>{if(!(!d||!h))try{const b=d.createOscillator(),m=d.createGain();switch(b.connect(m),m.connect(d.destination),N){case"urgent":b.frequency.setValueAtTime(800,d.currentTime),b.frequency.setValueAtTime(1e3,d.currentTime+.1),b.frequency.setValueAtTime(800,d.currentTime+.2),m.gain.setValueAtTime(.3,d.currentTime),m.gain.exponentialRampToValueAtTime(.01,d.currentTime+.5),b.start(d.currentTime),b.stop(d.currentTime+.5);break;case"warning":b.frequency.setValueAtTime(600,d.currentTime),b.frequency.setValueAtTime(700,d.currentTime+.15),m.gain.setValueAtTime(.2,d.currentTime),m.gain.exponentialRampToValueAtTime(.01,d.currentTime+.3),b.start(d.currentTime),b.stop(d.currentTime+.3);break;case"info":b.frequency.setValueAtTime(400,d.currentTime),m.gain.setValueAtTime(.1,d.currentTime),m.gain.exponentialRampToValueAtTime(.01,d.currentTime+.2),b.start(d.currentTime),b.stop(d.currentTime+.2);break}}catch(b){console.error("خطأ في تشغيل الصوت:",b)}},S=()=>{w(!1),setTimeout(()=>{n()},300)},k=N=>{switch(N){case"urgent":return{bg:"bg-red-500",border:"border-red-600",text:"text-white",icon:e.jsx(As,{className:"w-6 h-6"}),pulse:"animate-pulse"};case"warning":return{bg:"bg-yellow-500",border:"border-yellow-600",text:"text-white",icon:e.jsx(je,{className:"w-6 h-6"}),pulse:""};case"info":return{bg:"bg-blue-500",border:"border-blue-600",text:"text-white",icon:e.jsx(Ge,{className:"w-6 h-6"}),pulse:""};default:return{bg:"bg-gray-500",border:"border-gray-600",text:"text-white",icon:e.jsx(Ge,{className:"w-6 h-6"}),pulse:""}}},O=N=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric"}).format(N);if(!i)return null;const F=k(i.type);return e.jsxs("div",{className:"fixed top-4 right-4 z-[9999]",children:[e.jsxs("div",{className:`
          transform transition-all duration-300 ease-in-out
          ${v?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
          ${F.bg} ${F.border} ${F.text} ${F.pulse}
          border-2 rounded-lg shadow-2xl max-w-md min-w-80
          backdrop-blur-sm
        `,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white border-opacity-20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[F.icon,e.jsxs("h3",{className:"font-bold text-lg",children:[i.type==="urgent"&&"تنبيه عاجل!",i.type==="warning"&&"تحذير",i.type==="info"&&"إشعار"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:g,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",title:h?"إيقاف الصوت":"تشغيل الصوت",children:h?e.jsx(jl,{className:"w-4 h-4"}):e.jsx(Nl,{className:"w-4 h-4"})}),e.jsx("button",{onClick:S,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",children:e.jsx(Me,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-lg font-medium mb-3",children:i.message}),e.jsxs("div",{className:"space-y-2 text-sm opacity-90",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"المستخدم:"})," ",i.userName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"تاريخ انتهاء الاشتراك:"})," ",O(i.expiryDate)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",i.daysRemaining," يوم"]})]})]}),i.type==="urgent"&&e.jsx("div",{className:"h-1 bg-white bg-opacity-20",children:e.jsx("div",{className:"h-full bg-white animate-pulse",style:{animation:"progress 10s linear forwards"}})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes progress {
          from { width: 100%; }
          to { width: 0%; }
        }
      `})]})},Ll=({user:i,onActivateSubscription:n,onRequestActivation:h,onDeactivateSubscription:g,onDeleteUser:v,onUpdateSessionLimit:w})=>{const[d,_]=r.useState(p.MONTHLY),[f,S]=r.useState(!1),k=vr(),O=i.sessionLimit,F=i.sessionLimitDisabled===!0,[N,b]=r.useState(()=>F?"2":typeof O=="number"&&O>0?String(O):"2"),[m,M]=r.useState(F);r.useEffect(()=>{const y=i.sessionLimit,u=i.sessionLimitDisabled===!0;M(u),u?b("2"):typeof y=="number"&&y>0?b(String(y)):b("2")},[i]);const P=y=>{const u=y==null?void 0:y.displayName;if(typeof u=="string"&&u.trim())return u.trim();if(u&&typeof u=="object"){const U=u.full_name||u.name||u.ar||u.en;if(typeof U=="string"&&U.trim())return U.trim()}return typeof(y==null?void 0:y.email)=="string"&&y.email.includes("@")?y.email.split("@")[0]:"غير محدد"},j=y=>{switch(y){case p.LIFETIME:return e.jsx(is,{className:"w-4 h-4 text-yellow-500"});case p.YEARLY:return e.jsx(Ae,{className:"w-4 h-4 text-blue-500"});case p.QUARTERLY:return e.jsx(be,{className:"w-4 h-4 text-purple-500"});case p.MONTHLY:return e.jsx(os,{className:"w-4 h-4 text-green-500"});case p.FIVE_MINUTES:return e.jsx(je,{className:"w-4 h-4 text-orange-500"});case p.ZERO:return e.jsx(lt,{className:"w-4 h-4 text-gray-500"});case p.TAHWEELA:return e.jsx(ca,{className:"w-4 h-4 text-blue-600"});case p.BRANCH:return e.jsx(rt,{className:"w-4 h-4 text-indigo-500"});default:return null}},E=y=>{if(!y)return"غير محدد";const u=kr(y);return u?u.toLocaleDateString("ar-EG"):"تاريخ غير صالح"};return e.jsx(Qe,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(Ze,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(rt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:P(i)}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(wr,{className:"w-3 h-3 ml-1"}),i.email]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[e.jsx(ka,{className:"w-3 h-3 ml-1"}),i.phone||"غير محدد"]})]})]}),e.jsx("div",{className:`px-2 py-0.5 rounded-[8px] text-xs font-medium border ${i.isActive?"bg-green-50 text-green-700 border-green-200":"bg-secondary/10 text-secondary border-secondary/20"}`,children:i.isActive?"نشط":"غير نشط"})]}),i.subscription&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[j(i.subscription.planType),e.jsx("span",{className:"text-sm font-medium",children:ls(i.subscription.planType)})]}),e.jsx(ve,{variant:i.subscription.isActive?"default":"destructive",children:i.subscription.isActive?"مفعل":"منتهي"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(be,{className:"w-3 h-3 ml-1"}),"البداية: ",E(i.subscription.startDate)]}),i.subscription.endDate&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(be,{className:"w-3 h-3 ml-1"}),"النهاية: ",E(i.subscription.endDate)]})]})]}),e.jsxs("div",{className:"space-y-3",children:[w&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border border-dashed border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-800",children:"حد عدد الأجهزة"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:y=>M(y.target.checked)}),e.jsx("span",{children:"سماح بعدد غير محدود من الأجهزة"})]}),!m&&e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx("input",{type:"number",min:1,value:N,onChange:y=>b(y.target.value),className:"w-20 rounded-md border border-gray-300 px-2 py-1 text-xs text-center"}),e.jsx("span",{className:"text-xs text-gray-600",children:"أجهزة كحد أقصى"})]}),e.jsx(H,{size:"sm",className:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{const y=parseInt(N,10),u=isNaN(y)||y<1?1:y,U=m?null:u;w(i.id,{sessionLimit:U,sessionLimitDisabled:m})},children:"حفظ"})]})]}),n&&f&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"اختر نوع الباقة:"}),k?e.jsxs("select",{className:"w-full h-10 border border-input bg-background rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring",value:d,onChange:y=>_(y.target.value),children:[e.jsx("option",{value:p.MONTHLY,children:"شهرية"}),e.jsx("option",{value:p.QUARTERLY,children:"ربع سنوية"}),e.jsx("option",{value:p.YEARLY,children:"سنوية"}),e.jsx("option",{value:p.LIFETIME,children:"مدى الحياة"}),e.jsx("option",{value:p.FIVE_MINUTES,children:"5 دقايق"}),e.jsx("option",{value:p.ZERO,children:"زيرو"}),e.jsx("option",{value:p.TAHWEELA,children:"تحويله"})]}):e.jsxs(nt,{value:d,onValueChange:y=>_(y),children:[e.jsx(it,{className:"w-full",children:e.jsx(ct,{placeholder:"اختر نوع الباقة"})}),e.jsxs(ot,{children:[e.jsx(xe,{value:p.MONTHLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{children:"شهرية"})]})}),e.jsx(xe,{value:p.QUARTERLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{children:"ربع سنوية"})]})}),e.jsx(xe,{value:p.YEARLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{children:"سنوية"})]})}),e.jsx(xe,{value:p.LIFETIME,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(qr,{className:"w-4 h-4"}),e.jsx("span",{children:"مدى الحياة"})]})}),e.jsx(xe,{value:p.FIVE_MINUTES,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{children:"5 دقايق"})]})}),e.jsx(xe,{value:p.ZERO,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(lt,{className:"w-4 h-4"}),e.jsx("span",{children:"زيرو"})]})}),e.jsx(xe,{value:p.TAHWEELA,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ca,{className:"w-4 h-4"}),e.jsx("span",{children:"تحويله"})]})})]})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx(H,{size:"sm",onClick:()=>{n(i.id,d),S(!1)},className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:"تأكيد التفعيل"}),e.jsx(H,{size:"sm",variant:"outline",onClick:()=>S(!1),className:"flex-1",children:"إلغاء"})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[(n||h)&&!f&&e.jsx(H,{size:"sm",variant:"outline",onClick:()=>h?h(i):S(!0),className:"flex-1",children:"تفعيل الاشتراك"}),g&&e.jsx(H,{size:"sm",variant:"outline",onClick:()=>g(i.id),className:"flex-1",children:"إلغاء الاشتراك"}),v&&e.jsx(H,{size:"sm",variant:"destructive",onClick:()=>v(i.id),children:e.jsx(Sr,{className:"w-4 h-4"})})]})]})]})})},Pl=Ds.memo(Ll),Rl=[{id:p.MONTHLY,name:"شهرية",icon:os,color:"text-green-600",bg:"bg-green-50",border:"border-green-200"},{id:p.QUARTERLY,name:"ربع سنوية",icon:be,color:"text-purple-600",bg:"bg-purple-50",border:"border-purple-200"},{id:p.YEARLY,name:"سنوية",icon:Ae,color:"text-blue-600",bg:"bg-blue-50",border:"border-blue-200"},{id:p.LIFETIME,name:"مدى الحياة",icon:is,color:"text-yellow-600",bg:"bg-yellow-50",border:"border-yellow-200"},{id:p.FIVE_MINUTES,name:"5 دقايق",icon:je,color:"text-orange-600",bg:"bg-orange-50",border:"border-orange-200"},{id:p.ZERO,name:"زيرو",icon:lt,color:"text-gray-600",bg:"bg-gray-50",border:"border-gray-200"},{id:p.TAHWEELA,name:"تحويله",icon:ns,color:"text-indigo-600",bg:"bg-indigo-50",border:"border-indigo-200"}],Fl={[p.MONTHLY]:{from:"from-blue-50",to:"to-indigo-50",ring:"ring-blue-300"},[p.QUARTERLY]:{from:"from-purple-50",to:"to-pink-50",ring:"ring-purple-300"},[p.YEARLY]:{from:"from-sky-50",to:"to-blue-50",ring:"ring-blue-300"},[p.LIFETIME]:{from:"from-yellow-50",to:"to-amber-50",ring:"ring-amber-300"},[p.FIVE_MINUTES]:{from:"from-orange-50",to:"to-red-50",ring:"ring-orange-300"},[p.ZERO]:{from:"from-gray-50",to:"to-slate-100",ring:"ring-gray-300"},[p.TAHWEELA]:{from:"from-indigo-50",to:"to-violet-50",ring:"ring-indigo-300"}},Ml=i=>{const n=i==null?void 0:i.displayName;if(typeof n=="string"&&n.trim())return n.trim();if(n&&typeof n=="object"){const h=n.full_name||n.name||n.ar||n.en;if(typeof h=="string"&&h.trim())return h.trim()}return typeof(i==null?void 0:i.email)=="string"&&i.email.includes("@")?i.email.split("@")[0]:"مستخدم"},Ol=({isOpen:i,onClose:n,user:h,onActivate:g})=>{const[v,w]=r.useState(p.MONTHLY),[d,_]=r.useState(!1);Ds.useEffect(()=>{i&&(w(p.MONTHLY),_(!1))},[i,h]);const f=async()=>{if(!d){_(!0);try{await g(h.id,v)}catch(S){console.error("Activation failed",S),_(!1)}}};return!i||!h?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 transition-opacity duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-xl shadow-xl transform transition-all flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(os,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800",children:"تفعيل اشتراك جديد"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["للمستخدم: ",Ml(h)]})]})]}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-100 p-1",children:e.jsx(Me,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Rl.map(S=>{const k=Fl[S.id],O=v===S.id;return e.jsxs("div",{onClick:()=>w(S.id),className:`rounded-xl p-4 border shadow-sm bg-gradient-to-br ${k.from} ${k.to} cursor-pointer transition-all ${O?`ring-2 ${k.ring}`:"hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/70 flex items-center justify-center",children:e.jsx(S.icon,{className:`w-5 h-5 ${S.color}`})}),O&&e.jsx(cs,{className:`w-5 h-5 ${S.color}`})]}),e.jsx("div",{className:"font-bold text-gray-800",children:S.name}),O&&e.jsx("div",{className:`text-xs font-medium ${S.color}`,children:"تم الاختيار"})]},S.id)})})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 bg-gray-50 rounded-b-xl border-t border-gray-100 flex-shrink-0",children:[e.jsx("button",{onClick:n,disabled:d,className:"px-5 py-2.5 rounded-lg border border-gray-300 bg-white text-gray-700 font-medium hover:bg-gray-50 focus:ring-2 focus:ring-gray-200 transition-all disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{onClick:f,disabled:d,className:"px-5 py-2.5 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 shadow-lg shadow-blue-600/20 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[d?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(cs,{className:"w-5 h-5"}),d?"جاري التفعيل...":"تفعيل الاشتراك"]})]})]})})},wa=[{value:p.MONTHLY,label:"باقة شهرية"},{value:p.QUARTERLY,label:"باقة ربع سنوية"},{value:p.YEARLY,label:"باقة سنوية"},{value:p.LIFETIME,label:"باقة مدى الحياة"}],Vl=()=>{const[i,n]=r.useState([]),[h,g]=r.useState(!0),[v,w]=r.useState(""),[d,_]=r.useState(null),[f,S]=r.useState(!1),[k,O]=r.useState({status:"",packageName:""}),[F,N]=r.useState(!1),[b,m]=r.useState(null),[M,P]=r.useState(!1),[j,E]=r.useState(null),[y,u]=r.useState("requests"),[U,J]=r.useState([]),[we,Q]=r.useState(!1),[X,Se]=r.useState(""),[me,he]=r.useState(!1),{toast:D}=Sa();r.useEffect(()=>{const x=ae(K(C,"reseller_requests"),Er("createdAt","desc")),L=oa(x,Ne=>{const xs=Ne.docs.map(Ce=>({id:Ce.id,...Ce.data()}));n(xs),g(!1)},Ne=>{console.error("Error fetching reseller requests:",Ne),g(!1)}),de=ae(K(C,"users"),Oe("isResellerEnabled","==",!0)),re=oa(de,Ne=>{const xs=Ne.docs.map(Ce=>({id:Ce.id,...Ce.data()}));J(xs)});return()=>{L(),re()}},[]);const ke=async()=>{if(!X.trim()){D({title:"خطأ",description:"يرجى إدخال البريد الإلكتروني",variant:"destructive"});return}he(!0);try{const x=K(C,"users"),L=ae(x,Oe("email","==",X.trim()),Ar(1)),de=await fe(L);if(de.empty){D({title:"خطأ",description:"لم يتم العثور على مستخدم بهذا البريد الإلكتروني",variant:"destructive"}),he(!1);return}const re=de.docs[0];await ie(Y(C,"users",re.id),{isResellerEnabled:!0}),D({title:"تم التفعيل",description:"تم تفعيل نظام الريسيلر لهذا الحساب بنجاح"}),Q(!1),Se("")}catch(x){console.error("Error activating reseller:",x),D({title:"خطأ",description:"حدث خطأ أثناء التفعيل",variant:"destructive"})}finally{he(!1)}},I=async x=>{if(window.confirm("هل أنت متأكد من تعطيل نظام الريسيلر لهذا الحساب؟"))try{await ie(Y(C,"users",x),{isResellerEnabled:!1}),D({title:"تم التعطيل",description:"تم تعطيل نظام الريسيلر للحساب"})}catch(L){console.error("Error deactivating reseller:",L),D({title:"خطأ",description:"حدث خطأ أثناء التعطيل",variant:"destructive"})}},W=x=>{_(x),O({status:x.status,packageName:x.packageName||""}),S(!0)},ce=async()=>{if(d)try{const x={status:k.status,packageName:k.packageName};let L=null,de=!1;if(k.status==="active"&&k.packageName){const re=new Date,Ne=Dr(k.packageName,re);x.startDate=re,x.endDate=Ne,de=!0,L={planType:k.packageName,startDate:re,endDate:Ne,isActive:!0,activatedAt:re}}else k.status!=="active"&&(de=!1,L={isActive:!1});if(await ie(Y(C,"reseller_requests",d.id),x),d.uid){const re={isActive:de,updatedAt:new Date};L&&(re.subscription=L),await ie(Y(C,"users",d.uid),re)}D({title:"تم التحديث",description:"تم تحديث حالة الحساب وتفعيل الباقة بنجاح"}),S(!1)}catch(x){console.error("Error updating request:",x),D({title:"خطأ",description:"حدث خطأ أثناء التحديث",variant:"destructive"})}},ee=async x=>{if(window.confirm("هل أنت متأكد من حذف هذا الطلب؟"))try{await Fe(Y(C,"reseller_requests",x)),D({title:"تم الحذف",description:"تم حذف الطلب بنجاح"})}catch{D({title:"خطأ",description:"حدث خطأ أثناء الحذف",variant:"destructive"})}},De=x=>{m(x),N(!0)},se=async()=>{if(b)try{await Fe(Y(C,"reseller_requests",b.id)),b.uid&&await ie(Y(C,"users",b.uid),{isActive:!1,role:"user"}),D({title:"تم القبول",description:"تم قبول طلب الحذف وإزالة الحساب من القائمة"}),N(!1)}catch(x){console.error("Error accepting delete:",x),D({title:"خطأ",description:"حدث خطأ أثناء تنفيذ الحذف",variant:"destructive"})}},R=async()=>{if(b)try{await ie(Y(C,"reseller_requests",b.id),{deletionRequested:!1,deletionStatus:"rejected"}),D({title:"تم الرفض",description:"تم رفض طلب الحذف وإشعار المستخدم"}),N(!1)}catch(x){console.error("Error rejecting delete:",x),D({title:"خطأ",description:"حدث خطأ أثناء رفض الطلب",variant:"destructive"})}},ds=x=>{E(x),P(!0)},ue=async()=>{if(j)try{await ie(Y(C,"reseller_requests",j.id),{status:"inactive",packageName:null,startDate:null,endDate:null,cancelRequested:!1,cancelStatus:null}),j.uid&&await ie(Y(C,"users",j.uid),{isActive:!1,"subscription.isActive":!1,"subscription.planId":null,"subscription.endDate":null}),D({title:"تم القبول",description:"تم قبول طلب إلغاء الباقة وإلغاء تفعيل الحساب"}),P(!1)}catch(x){console.error("Error accepting cancel:",x),D({title:"خطأ",description:"حدث خطأ أثناء تنفيذ الإلغاء",variant:"destructive"})}},oe=async()=>{if(j)try{await ie(Y(C,"reseller_requests",j.id),{cancelRequested:!1,cancelStatus:"rejected"}),D({title:"تم الرفض",description:"تم رفض طلب إلغاء الباقة وإشعار المستخدم"}),P(!1)}catch(x){console.error("Error rejecting cancel:",x),D({title:"خطأ",description:"حدث خطأ أثناء رفض الطلب",variant:"destructive"})}},Ts=x=>{var L;return((L=wa.find(de=>de.value===x))==null?void 0:L.label)||x||"-"},Ke=i.filter(x=>{var L;return x.email.toLowerCase().includes(v.toLowerCase())||((L=x.packageName)==null?void 0:L.toLowerCase().includes(v.toLowerCase()))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(al,{defaultValue:"requests",value:y,onValueChange:u,className:"w-full",children:[e.jsxs(rl,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsx(pa,{value:"requests",children:"طلبات الحسابات الفرعية"}),e.jsx(pa,{value:"main_resellers",children:"حسابات الريسيلر الرئيسية (المفعلة)"})]}),e.jsx(ba,{value:"requests",children:e.jsxs(Qe,{children:[e.jsxs(as,{className:"flex flex-row items-center justify-between",children:[e.jsx(rs,{children:"إدارة حسابات الريسيلر الفرعية"}),e.jsxs("div",{className:"relative w-64",children:[e.jsx(Re,{className:"absolute right-2 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(at,{placeholder:"بحث بالبريد الإلكتروني...",className:"pr-8",value:v,onChange:x=>w(x.target.value)})]})]}),e.jsx(Ze,{children:e.jsxs(ha,{children:[e.jsx(ua,{children:e.jsxs(Pe,{children:[e.jsx(ne,{className:"text-right",children:"البريد الإلكتروني"}),e.jsx(ne,{className:"text-right",children:"كلمة المرور"}),e.jsx(ne,{className:"text-right",children:"رقم الهاتف"}),e.jsx(ne,{className:"text-right",children:"الحالة"}),e.jsx(ne,{className:"text-right",children:"الباقة"}),e.jsx(ne,{className:"text-right",children:"الصلاحية"}),e.jsx(ne,{className:"text-right",children:"إجراءات"})]})}),e.jsx(ga,{children:h?e.jsx(Pe,{children:e.jsx(Z,{colSpan:7,className:"text-center",children:"جاري التحميل..."})}):Ke.length===0?e.jsx(Pe,{children:e.jsx(Z,{colSpan:7,className:"text-center",children:"لا توجد طلبات"})}):Ke.map(x=>{var L;return e.jsxs(Pe,{children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[x.email,x.deletionRequested&&e.jsx(ve,{variant:"destructive",className:"cursor-pointer hover:bg-red-700 animate-pulse",onClick:()=>De(x),children:"طلب حذف"}),x.cancelRequested&&e.jsx(ve,{className:"bg-orange-500 hover:bg-orange-600 cursor-pointer animate-pulse",onClick:()=>ds(x),children:"طلب إلغاء باقة"})]})}),e.jsx(Z,{className:"font-mono text-xs",children:x.password}),e.jsx(Z,{children:x.phone||"-"}),e.jsx(Z,{children:x.status==="active"?e.jsx(ve,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"نشط"}):x.status==="pending"?e.jsx(ve,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"قيد الانتظار"}):e.jsx(ve,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"غير نشط"})}),e.jsx(Z,{children:Ts(x.packageName)}),e.jsx(Z,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["الطلب: ",(L=x.createdAt)!=null&&L.seconds?new Date(x.createdAt.seconds*1e3).toLocaleDateString("ar-SA"):"-"]}),x.status==="active"&&x.endDate&&e.jsxs("span",{className:"text-xs text-green-600 font-medium",children:["ينتهي: ",x.endDate.seconds?new Date(x.endDate.seconds*1e3).toLocaleDateString("ar-SA"):"-"]})]})}),e.jsx(Z,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:"outline",size:"sm",onClick:()=>W(x),children:e.jsx(el,{className:"h-4 w-4"})}),e.jsx(H,{variant:"ghost",size:"sm",className:"text-red-600",onClick:()=>ee(x.id),children:e.jsx(da,{className:"h-4 w-4"})})]})})]},x.id)})})]})})]})}),e.jsx(ba,{value:"main_resellers",children:e.jsxs(Qe,{children:[e.jsxs(as,{className:"flex flex-row items-center justify-between",children:[e.jsxs(rs,{className:"flex items-center gap-2",children:[e.jsx(Na,{className:"h-5 w-5 text-blue-600"}),"حسابات الريسيلر الرئيسية المفعلة"]}),e.jsxs(ys,{open:we,onOpenChange:Q,children:[e.jsxs(Ns,{children:[e.jsx(vs,{children:e.jsx(ws,{children:"تفعيل نظام الريسيلر لمستخدم"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"البريد الإلكتروني للمستخدم الرئيسي"}),e.jsx(at,{placeholder:"email@example.com",value:X,onChange:x=>Se(x.target.value)})]}),e.jsx(H,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:ke,disabled:me,children:me?"جاري التفعيل...":"تفعيل النظام"})]})]}),e.jsxs(H,{onClick:()=>Q(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),"تفعيل حساب جديد"]})]})]}),e.jsx(Ze,{children:e.jsxs(ha,{children:[e.jsx(ua,{children:e.jsxs(Pe,{children:[e.jsx(ne,{className:"text-right",children:"البريد الإلكتروني"}),e.jsx(ne,{className:"text-right",children:"الاسم"}),e.jsx(ne,{className:"text-right",children:"تاريخ الانضمام"}),e.jsx(ne,{className:"text-right",children:"الحالة"}),e.jsx(ne,{className:"text-right",children:"إجراءات"})]})}),e.jsx(ga,{children:U.length===0?e.jsx(Pe,{children:e.jsx(Z,{colSpan:5,className:"text-center py-8 text-gray-500",children:"لا توجد حسابات رئيسية مفعلة حالياً"})}):U.map(x=>{var L;return e.jsxs(Pe,{children:[e.jsx(Z,{className:"font-medium",children:x.email}),e.jsx(Z,{children:x.displayName||"-"}),e.jsx(Z,{children:(L=x.createdAt)!=null&&L.seconds?new Date(x.createdAt.seconds*1e3).toLocaleDateString("ar-SA"):"-"}),e.jsx(Z,{children:e.jsxs(ve,{className:"bg-blue-100 text-blue-800 hover:bg-blue-100 flex w-fit items-center gap-1",children:[e.jsx(Na,{className:"h-3 w-3"}),"مفعل كريسيلر"]})}),e.jsx(Z,{children:e.jsxs(H,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>I(x.id),children:[e.jsx(da,{className:"h-4 w-4 mr-1"}),"تعطيل"]})})]},x.id)})})]})})]})})]}),e.jsx(ys,{open:f,onOpenChange:S,children:e.jsxs(Ns,{children:[e.jsx(vs,{children:e.jsx(ws,{children:"تعديل حالة الحساب"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"الحالة"}),e.jsxs(nt,{value:k.status,onValueChange:x=>O(L=>({...L,status:x})),children:[e.jsx(it,{children:e.jsx(ct,{placeholder:"اختر الحالة"})}),e.jsxs(ot,{children:[e.jsx(xe,{value:"pending",children:"قيد الانتظار"}),e.jsx(xe,{value:"active",children:"نشط"}),e.jsx(xe,{value:"inactive",children:"غير نشط"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"اسم الباقة"}),e.jsxs(nt,{value:k.packageName,onValueChange:x=>O(L=>({...L,packageName:x})),children:[e.jsx(it,{children:e.jsx(ct,{placeholder:"اختر الباقة"})}),e.jsx(ot,{children:wa.map(x=>e.jsx(xe,{value:x.value,children:x.label},x.value))})]})]})]}),e.jsxs(Xs,{children:[e.jsx(H,{variant:"outline",onClick:()=>S(!1),children:"إلغاء"}),e.jsx(H,{onClick:ce,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"حفظ التغييرات"})]})]})}),e.jsx(ys,{open:F,onOpenChange:N,children:e.jsxs(Ns,{children:[e.jsx(vs,{children:e.jsx(ws,{className:"text-red-600",children:"مراجعة طلب حذف حساب"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-100",children:[e.jsx("h4",{className:"font-semibold text-red-800 mb-2",children:"سبب الحذف المقدم من المستخدم:"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:(b==null?void 0:b.deletionReason)||"لا يوجد سبب محدد"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("p",{children:["البريد الإلكتروني: ",b==null?void 0:b.email]}),e.jsxs("p",{children:["تاريخ الطلب: ",new Date().toLocaleDateString("ar-SA")]})]}),e.jsx("div",{className:"bg-yellow-50 p-3 rounded text-sm text-yellow-800 border border-yellow-200",children:"تنبيه: قبول الطلب سيؤدي إلى حذف هذا السجل من قائمة الريسيلر وتعطيل حساب المستخدم المرتبط به."})]}),e.jsxs(Xs,{className:"gap-2 sm:gap-0",children:[e.jsx(H,{variant:"outline",onClick:R,className:"text-red-600 border-red-200 hover:bg-red-50",children:"رفض الطلب"}),e.jsx(H,{onClick:se,className:"bg-red-600 hover:bg-red-700 text-white",children:"قبول الحذف"})]})]})}),e.jsx(ys,{open:M,onOpenChange:P,children:e.jsxs(Ns,{children:[e.jsx(vs,{children:e.jsx(ws,{className:"text-orange-600",children:"مراجعة طلب إلغاء باقة"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-100",children:[e.jsx("h4",{className:"font-semibold text-orange-800 mb-2",children:"سبب الإلغاء المقدم من المستخدم:"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:(j==null?void 0:j.cancelReason)||"لا يوجد سبب محدد"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("p",{children:["البريد الإلكتروني: ",j==null?void 0:j.email]}),e.jsxs("p",{children:["تاريخ الطلب: ",new Date().toLocaleDateString("ar-SA")]})]}),e.jsx("div",{className:"bg-yellow-50 p-3 rounded text-sm text-yellow-800 border border-yellow-200",children:"تنبيه: قبول الطلب سيؤدي إلى إيقاف تفعيل الباقة والحساب فوراً."})]}),e.jsxs(Xs,{className:"gap-2 sm:gap-0",children:[e.jsx(H,{variant:"outline",onClick:oe,className:"text-red-600 border-red-200 hover:bg-red-50",children:"رفض الطلب"}),e.jsx(H,{onClick:ue,className:"bg-orange-600 hover:bg-orange-700 text-white",children:"قبول الإلغاء"})]})]})})]})},$l={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_VERSION:"0.0.0",VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"false",VITE_FIREBASE_API_KEY:["AI","za","SyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s"].join(""),VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_AUTH_EMULATOR_URL:"http://localhost:9099",VITE_FIREBASE_FIRESTORE_EMULATOR_HOST:"localhost:8080",VITE_FIREBASE_FUNCTIONS_EMULATOR_HOST:"localhost:5001",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.appspot.com",VITE_FORCE_HASH_ROUTER:"true",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"محل كاشي لينك التجريبي",VITE_SHOW_ENV_BANNER:"true",VITE_USE_EMULATORS:"false",VITE_USE_FIREBASE_EMULATOR:"false"},Bl=({userId:i,adminId:n})=>{const[h,g]=r.useState([]),[v,w]=r.useState(!0),[d,_]=r.useState(null),[f,S]=r.useState(null),k=async()=>{try{w(!0);let N=[],b=[];try{const E=ae(K(C,"users",i,"branches"));N=(await fe(E)).docs.map(u=>({id:u.id,...u.data(),source:"sub"}))}catch(E){console.warn("Subcollection fetch warning:",E)}try{const E=ae(K(C,"branches"),Oe("ownerId","==",i));b=(await fe(E)).docs.map(u=>({id:u.id,...u.data(),source:"root"}))}catch(E){console.warn("Root collection fetch warning:",E)}const m=[...N,...b],M=new Map;(await Promise.all(m.map(async E=>{const y=E.branchUserId||E.id;if(y)try{const u=await Or(Y(C,"users",y));if(u.exists())return{...E,userData:u.data(),realUserId:y}}catch{}return{...E,realUserId:y}}))).forEach(E=>{const y=E.realUserId||E.id;if(!M.has(y))M.set(y,E);else{const u=M.get(y);(E.source==="sub"||!u.loginUsername&&E.loginUsername)&&M.set(y,E)}});const j=Array.from(M.values());g(j)}catch(N){console.error("Error fetching branches:",N)}finally{w(!1)}};r.useEffect(()=>{i&&k()},[i]);const O=async(N,b)=>{if(N.realUserId){S(N.realUserId);try{await Da(N.realUserId,b,n),await k(),alert(`تم تفعيل اشتراك ${ls(b)} للفرع بنجاح`)}catch(m){console.error(m),alert("حدث خطأ أثناء تفعيل اشتراك الفرع")}finally{S(null),_(null)}}},F=async N=>{if(N.realUserId&&window.confirm("هل أنت متأكد من إلغاء اشتراك هذا الفرع؟ سيتم تعطيل الدخول.")){S(N.realUserId);try{await Ca(N.realUserId),await k(),alert("تم إلغاء اشتراك الفرع بنجاح")}catch(b){console.error(b),alert("حدث خطأ أثناء إلغاء الاشتراك")}finally{S(null)}}};return v?e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"جاري تحميل الفروع..."}):h.length===0?e.jsx("div",{className:"mt-2 text-xs text-red-400 bg-red-50 p-2 rounded",children:"لا توجد فروع مضافة لهذا الحساب"}):e.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-100",children:[e.jsxs("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:["حسابات الفروع (",h.length,"):"]}),e.jsx("div",{className:"space-y-2",children:h.map((N,b)=>{var P,j,E,y;const m=((j=(P=N.userData)==null?void 0:P.subscription)==null?void 0:j.isActive)||!1,M=(y=(E=N.userData)==null?void 0:E.subscription)==null?void 0:y.planType;return e.jsxs("div",{className:"bg-gray-50 p-2 rounded text-xs flex justify-between items-center flex-wrap gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-800 block",children:N.branchName||"بدون اسم"}),e.jsx("span",{className:"text-gray-500 font-mono select-all block",children:N.loginUsername||N.email||"لا يوجد بريد"}),m&&e.jsxs("span",{className:"text-green-600 text-[10px] font-bold",children:["مشترك: ",ls(M)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[N.managerName&&e.jsx("span",{className:"text-gray-400 hidden sm:inline",children:N.managerName}),f===N.realUserId?e.jsx("span",{className:"text-gray-400 text-[10px]",children:"جاري التنفيذ..."}):e.jsx(e.Fragment,{children:m?e.jsx("button",{onClick:()=>F(N),className:"bg-red-100 text-red-600 px-2 py-1 rounded hover:bg-red-200 transition-colors",children:"إلغاء"}):e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>_(d===N.realUserId?null:N.realUserId),className:"bg-green-100 text-green-600 px-2 py-1 rounded hover:bg-green-200 transition-colors",children:"تفعيل"}),d===N.realUserId&&e.jsx("div",{className:"absolute left-0 mt-1 w-40 bg-white border rounded shadow-lg z-10 p-1 flex flex-col gap-1",children:[p.MONTHLY,p.QUARTERLY,p.YEARLY].map(u=>e.jsx("button",{onClick:()=>O(N,u),className:"text-right px-2 py-1 hover:bg-gray-100 rounded text-gray-700 w-full",children:ls(u)},u))})]})})]})]},b)})})]})},Hl=({navigate:i,auth:n,devMode:h,setDevMode:g,error:v,setError:w,authLoading:d,setAuthLoading:_,activeTab:f,setActiveTab:S,setNotificationCenterOpen:k,setNotificationSettings:O,setNotifications:F,notificationCount:N,setNotificationCount:b,users:m,setUsers:M,loading:P,setLoading:j,setEditingPlan:E,isSavingContent:y,setIsSavingContent:u,lastUpdateInfo:U,loadContentFromFirebase:J,saveContentToFirebase:we,refreshData:Q})=>{var na;const[X,Se]=r.useState(!0),[me,he]=r.useState(m||[]),[D,ke]=r.useState(""),[I,W]=r.useState(null),[ce,ee]=r.useState({}),[De,se]=r.useState(!1),[R,ds]=r.useState(null),[ue,oe]=r.useState({name:"",price:"",period:"",description:"",features:[]}),[Ts,Ke]=r.useState(!1),[x,L]=r.useState(!1),[de,re]=r.useState(null),[Ne,xs]=r.useState(!1),[Ce,_a]=r.useState({sound:!0}),[Ua,ql]=r.useState(!1),[Ia,La]=r.useState(null),[ms,Pa]=r.useState([]),[hs,xt]=r.useState(!1),[Yl,zl]=r.useState(void 0),[Wl,Gl]=r.useState(""),[Ql,Zl]=r.useState(null),[Kl,Xl]=r.useState(!1),mt=ms.filter(s=>!((s==null?void 0:s.contacted)===!0||(s==null?void 0:s.status)==="contacted")),us=ms.filter(s=>(s==null?void 0:s.contacted)===!0||(s==null?void 0:s.status)==="contacted"),[Jl,en]=r.useState(""),[sn,tn]=r.useState(""),[an,rn]=r.useState(""),[ln,nn]=r.useState(""),[cn,on]=r.useState(!1),[dn,xn]=r.useState(!1),Ra=async s=>{try{await ie(Y(C,"waiting_list",s),{contacted:!0,status:"contacted",contactedAt:tt()})}catch(t){console.error("Failed to mark waiting item as contacted",t),alert("حدث خطأ أثناء تحديث الحالة إلى تم التواصل.")}},[T,Te]=r.useState({}),[_s,Fa]=r.useState(null),[Us,Ma]=r.useState(null),[Is,Oa]=r.useState(null),[ht,ut]=r.useState(!1),[gt,pt]=r.useState(!1),[bt,ft]=r.useState(!1),[Ve,jt]=r.useState(""),[Xe,Va]=r.useState(""),[Je,$a]=r.useState(""),[Ba,Ls]=r.useState(0),[Ha,Ps]=r.useState(0),[qa,Rs]=r.useState(0),[gs,Fs]=r.useState(""),[Ms,yt]=r.useState(""),[Os,Nt]=r.useState(""),[vt,wt]=r.useState(""),[St,kt]=r.useState(""),[Et,At]=r.useState(""),[ps,Dt]=r.useState(""),[Ct,Tt]=r.useState(""),[_t,Ut]=r.useState(!1);r.useEffect(()=>{(async()=>{try{const{systemSettingsService:s}=await B(async()=>{const{systemSettingsService:a}=await import("./index-mBSeGJ8K.js").then(l=>l.cC);return{systemSettingsService:a}},__vite__mapDeps([0,1]),import.meta.url),t=await s.getTelegramWorkerUrl();t&&Tt(t)}catch{}})()},[]);const[It,Ya]=r.useState(!1),[bs,_e]=r.useState("idle"),[Lt,$e]=r.useState(""),[Vs,Pt]=r.useState(""),[$s,Rt]=r.useState(!1),[Bs,Be]=r.useState("idle"),[za,es]=r.useState(""),[mn,hn]=r.useState(!1),[un,gn]=r.useState(null),[pn,bn]=r.useState("monthly"),[Wa,Hs]=r.useState(!1),[Ga,Qa]=r.useState(null),[fn,Za]=r.useState(p.MONTHLY),[qs,Ka]=r.useState(""),[Ft,Xa]=r.useState([]),[Mt,Ot]=r.useState(!1);r.useEffect(()=>{const s=Cr(t=>{wt(String((t==null?void 0:t.version)||"")),kt(String((t==null?void 0:t.downloadURL_64)||"")),At(String((t==null?void 0:t.downloadURL_32)||"")),Dt(String((t==null?void 0:t.notes)||""))});return()=>{try{s()}catch{}}},[]),r.useEffect(()=>{const s=Tr(t=>{jt(String((t==null?void 0:t.version)||"")),Fs(String((t==null?void 0:t.url)||"")),Pt(String((t==null?void 0:t.notes)||"")),Rt(!!(t!=null&&t.force))});return()=>{try{s()}catch{}}},[]);const Ja=async()=>{var l;if($e(""),!(n!=null&&n.currentUser)){_e("error"),$e("يرجى تسجيل الدخول كأدمن قبل النشر");try{alert("يرجى تسجيل الدخول كأدمن قبل النشر")}catch{}return}const s=vt.trim(),t=St.trim(),a=Et.trim();if(!s){_e("error"),$e("رقم الإصدار مطلوب");return}try{new URL(t)}catch{_e("error"),$e("رابط 64-بت غير صالح (يجب أن يكون https://)");return}try{new URL(a)}catch{_e("error"),$e("رابط 32-بت غير صالح (يجب أن يكون https://)");return}try{_e("publishing");const c=typeof window<"u"&&(window.electronAPI||typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("electron"));let o="";if(await Mr({version:s,downloadURL_64:t,downloadURL_32:a,notes:ps.trim()},n.currentUser.uid),c&&((l=window.electronAPI)!=null&&l.publishDesktopVersion)){const A=await n.currentUser.getIdToken(),V={version:s,updateUrl64:t,updateUrli32:a,notes:ps.trim(),force:!!It};o=await window.electronAPI.publishDesktopVersion(A,V)}else o="";_e("done");try{localStorage.setItem("desktop_update_cache",JSON.stringify({version:s,downloadURL_64:t,downloadURL_32:a,notes:ps.trim()}))}catch{}}catch(c){_e("error");const o=(c==null?void 0:c.message)||"فشل النشر: تأكد من الصلاحيات وحالة الاتصال";$e(o);try{alert(o)}catch{}}},ss=s=>{const t=s==null?void 0:s.displayName;let a="";typeof t=="string"?a=t:t&&typeof t=="object"&&(a=(t.ar||t.en||"").toString()),!a&&typeof(s==null?void 0:s.email)=="string"&&(a=s.email);const l=String(a).trim().charAt(0);return l?l.toUpperCase():"؟"},ge=s=>{const t=s==null?void 0:s.displayName;if(typeof t=="string"&&t.trim())return t.trim();if(t&&typeof t=="object"){const a=t.full_name||t.name||t.ar||t.en;if(typeof a=="string"&&a.trim())return a.trim()}return typeof(s==null?void 0:s.email)=="string"&&s.email.includes("@")?s.email.split("@")[0]:"غير محدد"},[Ys,Vt]=r.useState(""),[zs,$t]=r.useState(""),[Bt,Ht]=r.useState(""),[qt,Yt]=r.useState(""),[Ws,zt]=r.useState(""),[Wt,Gt]=r.useState(!1),[He,Gs]=r.useState(""),[le,Qt]=r.useState(24),[Zt,Kt]=r.useState("24"),[Xt,Jt]=r.useState(!1),[jn,ea]=r.useState(!1),[qe,Qs]=r.useState("active");r.useEffect(()=>{if(D){const s=D.toLowerCase(),t=m.filter(a=>(a.displayName||"").toLowerCase().includes(s)||(a.email||"").toLowerCase().includes(s)||(a.phone||"").includes(s));he(t)}else he(m)},[m,D]),r.useEffect(()=>{f==="trials"&&(async()=>{try{ea(!0);const{FreeTrialService:s}=await B(async()=>{const{FreeTrialService:a}=await import("./freeTrialService-DU8cwcbX.js");return{FreeTrialService:a}},__vite__mapDeps([2,0,1]),import.meta.url),t=await s.getTrialDurationHours();Qt(t),Kt(String(t))}catch(s){console.error("Failed to load trial duration",s)}finally{ea(!1)}})()},[f]),r.useEffect(()=>{f==="application"&&(async()=>{try{const{getAppDownloads:s}=await B(async()=>{const{getAppDownloads:a}=await import("./index-mBSeGJ8K.js").then(l=>l.cH);return{getAppDownloads:a}},__vite__mapDeps([0,1]),import.meta.url),t=await s();Te(t||{}),Fs((t==null?void 0:t.androidUrl)||""),yt((t==null?void 0:t.pcUrl)||""),Nt((t==null?void 0:t.pc32Url)||"")}catch(s){console.error("Failed to load app downloads",s)}})()},[f]);const sa=async()=>{xt(!0);try{const s=ae(K(C,"waiting_list")),a=(await fe(s)).docs.map(l=>({id:l.id,...l.data()})).sort((l,c)=>{var V,q,z,$,te,pe;const o=((q=(V=l==null?void 0:l.createdAt)==null?void 0:V.toMillis)==null?void 0:q.call(V))??((z=l==null?void 0:l.createdAt)==null?void 0:z.seconds)*1e3??0;return(((te=($=c==null?void 0:c.createdAt)==null?void 0:$.toMillis)==null?void 0:te.call($))??((pe=c==null?void 0:c.createdAt)==null?void 0:pe.seconds)*1e3??0)-o});Pa(a)}catch(s){console.error("Failed to fetch waiting_list:",s)}finally{xt(!1)}};r.useEffect(()=>{f==="waitingList"&&sa(),f==="branches"&&ta()},[f]);const ta=async()=>{try{const s=await va.getAllCodes();Xa(s)}catch(s){console.error("Error loading branch codes:",s)}},er=async()=>{if(n.currentUser){Ot(!0);try{await va.generateCode(n.currentUser.uid),await ta(),alert("تم توليد كود تفعيل الفرع بنجاح")}catch(s){console.error("Error generating code:",s),alert("حدث خطأ أثناء توليد الكود")}finally{Ot(!1)}}};r.useEffect(()=>{},[f]);const sr=async()=>{var s;if(!Ys.trim()||!zs.trim()){alert("يرجى كتابة عنوان ورسالة الإشعار");return}try{Gt(!0);const t=Ws.trim()?`user:${Ws.trim()}`:"global";await tl({title:Ys.trim(),message:zs.trim(),audienceKey:t,createdBy:(s=n==null?void 0:n.currentUser)==null?void 0:s.uid,linkUrl:Bt.trim()||void 0,actionText:qt.trim()||void 0}),Vt(""),$t(""),Ht(""),Yt(""),zt(""),alert("تم إرسال الإشعار بنجاح!")}catch(t){console.error("خطأ في إرسال الإشعار:",t),alert("حدث خطأ أثناء إرسال الإشعار")}finally{Gt(!1)}},tr=()=>{n!=null&&n.signOut&&n.signOut(),i("/admin/login")},ar=Ds.useCallback(s=>{Qa(s),Za(p.MONTHLY),Hs(!0)},[]),aa=Ds.useCallback(async(s,t,a=null)=>{var l;try{console.log("Activating subscription for user:",s,"with plan:",t,"and variant:",a);const c=((l=n==null?void 0:n.currentUser)==null?void 0:l.uid)||"admin-user-id";await Da(s,t,c,a),console.log("✅ تم تفعيل الاشتراك بنجاح"),Q&&Q()}catch(c){console.error("❌ خطأ في تفعيل الاشتراك:",c),alert("حدث خطأ في تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},[n]),ra=async s=>{try{console.log("Deactivating subscription for user:",s),await Ca(s),console.log("✅ تم إلغاء تفعيل الاشتراك بنجاح"),Q&&Q()}catch(t){console.error("❌ خطأ في إلغاء تفعيل الاشتراك:",t),alert("حدث خطأ في إلغاء تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},rr=async s=>{var t;try{if(!window.confirm(`هل أنت متأكد من حذف هذا المستخدم نهائياً؟

سيتم حذف:
- حساب المستخدم
- جميع بياناته
- اشتراكه
- معاملاته
- محادثاته

هذا الإجراء لا يمكن التراجع عنه!`))return;console.log("بدء حذف المستخدم:",s);const l=((t=n==null?void 0:n.currentUser)==null?void 0:t.uid)||"unknown-admin";try{const o=await Pr(Rr,"deleteUserPermanently")({userId:s});console.log("استجابة دالة الحذف النهائي:",o),M(A=>A.filter(V=>V.id!==s)),he(A=>A.filter(V=>V.id!==s)),alert("تم حذف المستخدم نهائياً مع جميع بياناته وحساب المصادقة.");return}catch(c){console.warn("تعذر تنفيذ الحذف النهائي عبر Cloud Functions، سيتم استخدام الحذف المحلي المؤقت:",(c==null?void 0:c.message)||c)}{const c=[];try{await Fe(Y(C,"profiles",s)),console.log("تم حذف الملف الشخصي")}catch(o){console.error("خطأ في حذف الملف الشخصي:",o),c.push(`الملف الشخصي: ${(o==null?void 0:o.message)||o}`)}try{await Fe(Y(C,"users",s)),console.log("تم حذف وثيقة المستخدم من مجموعة users")}catch(o){console.error("خطأ في حذف وثيقة المستخدم من مجموعة users:",o),c.push(`users: ${(o==null?void 0:o.message)||o}`)}try{const o=ae(K(C,"transactions"),Oe("userId","==",s)),A=await fe(o),V=A.docs.map($=>Fe($.ref)),q=await Promise.allSettled(V),z=q.filter($=>$.status==="rejected");z.length?(console.warn("فشل حذف بعض المعاملات:",z.length),c.push(`المعاملات: فشل حذف ${z.length} من أصل ${q.length}`)):console.log(`تم حذف ${A.size} معاملة`)}catch(o){console.error("خطأ في جلب/حذف المعاملات:",o),c.push(`المعاملات: ${(o==null?void 0:o.message)||o}`)}try{const o=ae(K(C,"chatRooms"),Oe("participants","array-contains",s)),A=await fe(o),V=A.docs.map(async q=>{try{const $=(await fe(K(q.ref,"messages"))).docs.map(te=>Fe(te.ref));await Promise.allSettled($),await Fe(q.ref)}catch(z){console.error("فشل حذف محادثة/رسائل:",z),c.push(`المحادثات: ${q.id}`)}});await Promise.all(V),console.log(`تم إنهاء معالجة ${A.size} محادثة`)}catch(o){console.error("خطأ في جلب/حذف المحادثات:",o),c.push(`المحادثات: ${(o==null?void 0:o.message)||o}`)}try{await Fr(Y(C,"deletedUsers",s),{deletedAt:new Date,deletedBy:l,reason:"حذف نهائي من لوحة الإدارة"})}catch(o){console.error("خطأ في تسجيل المستخدم كمحذوف:",o),c.push(`deletedUsers: ${(o==null?void 0:o.message)||o}`)}M(o=>o.filter(A=>A.id!==s)),he(o=>o.filter(A=>A.id!==s)),c.length===0?alert("تم حذف بيانات المستخدم محلياً بنجاح. ملاحظة: حساب المصادقة لم يُحذف."):alert(`تم حذف المستخدم مع ملاحظات:
- ${c.join(`
- `)}

بعض الموارد قد لم تُحذف بالكامل. يمكنك إعادة المحاولة لاحقًا.`)}}catch(a){console.error("❌ خطأ في حذف المستخدم:",a),alert(`حدث خطأ في حذف المستخدم: ${a.message||"خطأ غير معروف"}`)}};r.useEffect(()=>{(async()=>{try{if(typeof J=="function"){const t=await J();t&&(t.monthly||t.yearly||t.lifetime)&&ee(t)}}catch(t){console.warn("Failed to load content data:",t)}})()},[]);const lr=async()=>{var s;try{if(typeof we!="function")return;u(!0);const t=((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin-user-id";await we(ce,t),alert("تم حفظ جميع التغييرات بنجاح")}catch(t){console.error("❌ خطأ في حفظ المحتوى:",t),alert(`فشل في حفظ المحتوى: ${(t==null?void 0:t.message)||"خطأ غير معروف"}`)}finally{u(!1)}},fs=(s,t,a)=>{ee(l=>({...l,[s]:{...(l==null?void 0:l[s])||{},[t]:a}}))},nr=s=>{ee(t=>{var a;return{...t,[s]:{...(t==null?void 0:t[s])||{},features:[...((a=t==null?void 0:t[s])==null?void 0:a.features)||[],""]}}})},ir=(s,t,a)=>{ee(l=>{var o;const c=[...((o=l==null?void 0:l[s])==null?void 0:o.features)||[]];return c[t]=a,{...l,[s]:{...(l==null?void 0:l[s])||{},features:c}}})},cr=(s,t)=>{ee(a=>{var c;const l=[...((c=a==null?void 0:a[s])==null?void 0:c.features)||[]];return l.splice(t,1),{...a,[s]:{...(a==null?void 0:a[s])||{},features:l}}})},or=()=>{_a(s=>({...s,sound:!s.sound}))},dr=()=>{La(null)},xr=async()=>{try{const s=Number(Zt);if(isNaN(s)||s<1){alert("يرجى إدخال مدة صحيحة بالساعات");return}Jt(!0);const{FreeTrialService:t}=await B(async()=>{const{FreeTrialService:l}=await import("./freeTrialService-DU8cwcbX.js");return{FreeTrialService:l}},__vite__mapDeps([2,0,1]),import.meta.url),a=await t.updateTrialDurationHours(s);a.success?(Qt(s),alert(a.message)):alert(a.message||"فشل تحديث مدة التجربة")}catch(s){console.error("Error updating trial duration:",s),alert("حدث خطأ أثناء تحديث مدة التجربة")}finally{Jt(!1)}},la=async s=>{try{const{FreeTrialService:t}=await B(async()=>{const{FreeTrialService:l}=await import("./freeTrialService-DU8cwcbX.js");return{FreeTrialService:l}},__vite__mapDeps([2,0,1]),import.meta.url),a=await t.startFreeTrialFromAdmin(s);alert(a.message||`تم تفعيل التجربة المجانية لمدة ${le} ${le>=3&&le<=10?"ساعات":le===2?"ساعتين":"ساعة"}`),Q&&Q()}catch(t){console.error("Error activating free trial:",t),alert("حدث خطأ أثناء تفعيل التجربة المجانية. يرجى المحاولة مرة أخرى.")}},mr=async s=>{try{const{FreeTrialService:t}=await B(async()=>{const{FreeTrialService:l}=await import("./freeTrialService-DU8cwcbX.js");return{FreeTrialService:l}},__vite__mapDeps([2,0,1]),import.meta.url),a=await t.cancelActiveFreeTrial(s);Q&&Q()}catch(t){console.error("Error cancelling free trial:",t)}},hr=async s=>{try{const{FreeTrialService:t}=await B(async()=>{const{FreeTrialService:l}=await import("./freeTrialService-DU8cwcbX.js");return{FreeTrialService:l}},__vite__mapDeps([2,0,1]),import.meta.url),a=await t.resetActiveTrialToCurrentDuration(s);alert(a.message)}catch(t){console.error("Error resetting user trial end:",t),alert("حدث خطأ أثناء تحديث نهاية التجربة.")}},ur=(s,t)=>{console.log("Toggling user status:",s,t)},Zs=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleDateString("ar-EG",{year:"numeric",month:"2-digit",day:"2-digit"}):"غير محدد",gr=[{id:"users",label:"المستخدمين",icon:Ss},{id:"reseller",label:"الريسيلر",icon:Ss},{id:"subscriptions",label:"مواعيد الاشتراكات",icon:be},{id:"trials",label:"إدارة التجارب المجانية",icon:Ae},{id:"content",label:"إدارة المحتوى",icon:Ur},{id:"application",label:"التطبيق",icon:ks},{id:"whatsapp",label:"إدارة الواتساب",icon:Es},{id:"branches",label:"باقات الفروع",icon:ja},{id:"analytics",label:"الإحصائيات",icon:fa}];return d?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري التحقق من المصادقة..."}),!1]})}):v?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"حدث خطأ في لوحة التحكم"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700 text-sm font-medium",children:v})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{w(null),i("/admin/login")},className:"w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"🔑 العودة لتسجيل الدخول"}),!1,e.jsx("button",{onClick:()=>{console.log("🔍 Current error details:",v),console.log("🔍 Auth state:",n.currentUser),console.log("🔍 Dev mode:",h),console.log("🔍 Environment:",$l)},className:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:"🐛 طباعة تفاصيل الخطأ في وحدة التحكم"})]})]})}):!h&&!n.currentUser?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"لوحة تحكم المدير"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"يجب تسجيل الدخول للوصول إلى لوحة التحكم"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>i("/admin/login"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"🔑 تسجيل الدخول"}),!1]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col md:flex-row overflow-x-hidden",children:[e.jsxs("div",{className:`bg-white shadow-lg transition-all duration-300 flex flex-col z-40 ${X?"translate-x-0 w-64 md:w-64":"translate-x-full w-64 md:w-16 md:translate-x-0"} fixed inset-y-0 right-0 md:static md:inset-auto`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[X&&e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(_r,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"لوحة الإدارة"}),e.jsx("p",{className:"text-sm text-gray-500",children:"نظام التحكم"})]})]}),e.jsx("button",{onClick:()=>Se(!X),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:X?e.jsx(Me,{className:"w-5 h-5"}):e.jsx(ml,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4",children:e.jsx("ul",{className:"space-y-2",children:gr.map(s=>{const t=s.icon;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>{if(s.id==="externalNotifications"){i("/admin/notifications");return}S(s.id)},className:`w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg transition-colors ${f===s.id?"bg-gradient-to-r from-purple-600 to-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(t,{className:"w-5 h-5"}),X&&e.jsx("span",{className:"font-medium",children:s.label})]})},s.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:tr,className:"w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(Ir,{className:"w-5 h-5"}),X&&e.jsx("span",{className:"font-medium",children:"تسجيل الخروج"})]})})]}),X&&e.jsx("div",{className:"fixed inset-0 bg-black/30 md:hidden",onClick:()=>Se(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[!X&&e.jsx("button",{className:"md:hidden p-2 rounded-lg hover:bg-gray-100",onClick:()=>Se(!0),"aria-label":"فتح القائمة",children:e.jsx(Js,{className:"w-5 h-5"})}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[f==="users"&&"إدارة المستخدمين",f==="reseller"&&"إدارة الريسيلر",f==="waitingList"&&"قائمة الانتظار",f==="subscriptions"&&"مواعيد الاشتراكات",f==="trials"&&"إدارة التجارب المجانية",f==="application"&&"إدارة التطبيق",f==="analytics"&&"الإحصائيات",f==="branches"&&"باقات الفروع"]}),h&&e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full",children:"🔧 وضع التطوير"})]}),e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["مرحباً، ",h?"المطور":"المدير"]}),e.jsx(Gr,{})]})]})}),e.jsxs("main",{className:"flex-1 p-3 sm:p-4 md:p-6 max-w-full overflow-x-hidden",children:[f==="reseller"&&e.jsx(Vl,{}),f==="waitingList"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"طلبات قائمة الانتظار"}),e.jsx("button",{onClick:sa,className:"p-1.5 text-gray-500 hover:bg-gray-100 rounded-full transition-colors",title:"تحديث القائمة",disabled:hs,children:e.jsx(ns,{className:`w-4 h-4 ${hs?"animate-spin":""}`})})]}),e.jsx("div",{className:"text-sm text-gray-500 flex items-center gap-3",children:hs?"جاري التحميل...":e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["إجمالي: ",ms.length]}),e.jsxs("span",{className:"text-red-600",children:["قيد الانتظار: ",mt.length]}),e.jsxs("span",{className:"text-green-600",children:["تم التواصل: ",us.length]})]})})]}),e.jsx("div",{className:"overflow-x-auto",children:hs?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل الطلبات..."})]}):ms.length===0?e.jsx("div",{className:"p-8 text-center text-gray-600",children:"لا توجد طلبات في قائمة الانتظار حالياً"}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الاسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"المعرف"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"سبب الطلب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"رقم الواتساب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الإجراء"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ الإنشاء"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:mt.map(s=>{var A;const t=(s.phone||"").toString(),a=t.replace(/\D/g,"");let l=null;const c="مرحباً، طلبت التحدث معنا. كيف نساعدك؟";try{Aa(t)&&(l=Ea(t,c))}catch{l=null}const o=(A=s.createdAt)!=null&&A.toDate?s.createdAt.toDate():s.createdAt?new Date(s.createdAt):null;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800",children:s.name||"غير محدد"}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500",children:s.userId||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:s.reason||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:a||"—"}),e.jsxs("td",{className:"px-4 py-3 flex items-center gap-2",children:[l?e.jsx("a",{href:l,target:"_blank",rel:"noopener noreferrer",children:e.jsx("button",{className:"px-3 py-1.5 rounded-md bg-green-600 text-white text-sm hover:bg-green-700",children:"واتساب"})}):e.jsx("span",{className:"text-xs text-gray-400",children:"لا يوجد رقم"}),e.jsx("button",{className:"px-3 py-1.5 rounded-md bg-indigo-600 text-white text-sm hover:bg-indigo-700",onClick:()=>Ra(s.id),title:"تمييز كتم التواصل",children:"تم التواصل"})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:o?o.toLocaleString("ar-EG"):"غير محدد"})]},s.id)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"تم التواصل"}),e.jsx("div",{className:"text-sm text-gray-500",children:us.length})]}),e.jsx("div",{className:"overflow-x-auto",children:us.length===0?e.jsx("div",{className:"p-8 text-center text-gray-600",children:"لا يوجد عناصر في قسم تم التواصل"}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الاسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"المعرف"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"سبب الطلب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"رقم الواتساب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الحالة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ التواصل"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:us.map(s=>{var c;const a=(s.phone||"").toString().replace(/\D/g,""),l=(c=s.contactedAt)!=null&&c.toDate?s.contactedAt.toDate():s.contactedAt?new Date(s.contactedAt):null;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800",children:s.name||"غير محدد"}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500",children:s.userId||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:s.reason||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:a||"—"}),e.jsx("td",{className:"px-4 py-3 text-xs",children:e.jsx("span",{className:"px-2 py-1 rounded-full bg-green-100 text-green-700",children:"تم التواصل"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:l?l.toLocaleString("ar-EG"):"غير محدد"})]},s.id)})})]})})]})]}),f==="users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي المستخدمين"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:m.length})]}),e.jsx(Ss,{className:"w-8 h-8 text-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"معرف المستخدم (اختياري)"}),e.jsx("input",{type:"text",value:Ws,onChange:s=>zt(s.target.value),placeholder:"ضع uid الخاص بالمستخدم لاستهداف إشعار شخصي",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اتركه فارغًا للإرسال العام؛ إن وضعته سيتم إرسال الإشعار لهذا المستخدم فقط."})]})]}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>s.isActive).length})]}),e.jsx(dt,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المعطلين"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.filter(s=>!s.isActive).length})]}),e.jsx(bl,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قائمة المستخدمين"}),e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن مستخدم...",value:D,onChange:s=>ke(s.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),D&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",me.length," من أصل ",m.length," مستخدم",D&&e.jsx("button",{onClick:()=>ke(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:P?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):me.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:D?"لا توجد نتائج للبحث":"لا توجد بيانات مستخدمين"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:me.map(s=>e.jsx(Pl,{user:s,onActivateSubscription:aa,onRequestActivation:ar,onToggleUserStatus:ur,onDeactivateSubscription:ra,onDeleteUser:rr,onUpdateSessionLimit:async(t,a)=>{try{const l=Y(C,"users",t),c={sessionLimitDisabled:a.sessionLimitDisabled,updatedAt:new Date};a.sessionLimit===null?c.sessionLimit=null:c.sessionLimit=a.sessionLimit,await ie(l,c),M(o=>o.map(A=>A.id===t?{...A,...c}:A)),alert("تم تحديث حد الأجهزة للمستخدم")}catch(l){console.error("update session limit error:",l),alert("حدث خطأ أثناء تحديث حد الأجهزة")}}},s.id))})})]})]}),f==="application"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ks,{className:"w-5 h-5 text-green-600"})," إدارة تطبيق الأندرويد"]}),(T==null?void 0:T.androidUrl)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["الرابط الحالي: ",e.jsx("a",{href:ze(T.androidUrl),className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:"تنزيل"}),T.androidVersion?` | الإصدار: ${T.androidVersion}`:""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملف APK"}),e.jsx("input",{type:"file",accept:".apk",onChange:s=>{var t;return Fa(((t=s.target.files)==null?void 0:t[0])||null)},className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:Ve,onChange:s=>jt(s.target.value),placeholder:"مثال: 1.0.3",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:async()=>{var s;if(_s)try{ut(!0),Ls(0);const{uploadAppBinaryResumable:t}=await B(async()=>{const{uploadAppBinaryResumable:l}=await import("./index-mBSeGJ8K.js").then(c=>c.cH);return{uploadAppBinaryResumable:l}},__vite__mapDeps([0,1]),import.meta.url),a=await t(_s,"android",((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin",Ve||void 0,l=>Ls(l),3e5);Te(l=>({...l,androidUrl:a,androidVersion:Ve||l.androidVersion}))}catch(t){console.error("Android upload failed",t),alert(t!=null&&t.message?`فشل رفع تطبيق الأندرويد: ${t.message}`:"فشل رفع تطبيق الأندرويد")}finally{ut(!1),Ls(0)}},disabled:ht||!_s,className:"w-full sm:w-auto flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50",children:[e.jsx(st,{className:"w-4 h-4"}),ht?`جاري الرفع... ${Ba}%`:"رفع تطبيق الأندرويد"]}),(T==null?void 0:T.androidUrl)&&e.jsxs("a",{href:ze(T.androidUrl),className:"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(et,{className:"w-4 h-4"})," تنزيل الحالي"]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط مباشر لتطبيق الأندرويد (APK)"}),e.jsx("input",{type:"url",value:gs,onChange:s=>Fs(s.target.value),placeholder:"https://example.com/app-release.apk",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:e.jsxs("button",{onClick:async()=>{var s;try{const{setAppDownloadLinks:t}=await B(async()=>{const{setAppDownloadLinks:a}=await import("./index-mBSeGJ8K.js").then(l=>l.cH);return{setAppDownloadLinks:a}},__vite__mapDeps([0,1]),import.meta.url);await t({androidUrl:gs||void 0,androidVersion:Ve||void 0},((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin"),Te(a=>({...a,androidUrl:gs||void 0,androidVersion:Ve||(a==null?void 0:a.androidVersion)})),alert("تم حفظ رابط الأندرويد بنجاح")}catch(t){console.error("Failed to save android link",t),alert(t!=null&&t.message?`فشل حفظ الرابط: ${t.message}`:"فشل حفظ الرابط")}},className:"w-full sm:w-auto flex items-center gap-2 bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700",children:[e.jsx(We,{className:"w-4 h-4"})," حفظ الرابط"]})})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملاحظات الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:Vs,onChange:s=>Pt(s.target.value),placeholder:"مثال: إصلاحات وتحسينات",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:$s,onChange:s=>Rt(s.target.checked)}),"تحديث إجباري"]})})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("button",{onClick:async()=>{if(es(""),!(n!=null&&n.currentUser)){Be("error"),es("يرجى تسجيل الدخول كأدمن قبل النشر");try{alert("يرجى تسجيل الدخول كأدمن قبل النشر")}catch{}return}const s=Ve.trim(),t=gs.trim();if(!s){Be("error"),es("رقم الإصدار مطلوب");return}try{new URL(t)}catch{Be("error"),es("رابط APK غير صالح (يجب أن يكون https://)");return}try{Be("publishing"),await Lr({version:s,url:t,notes:Vs.trim(),force:!!$s},n.currentUser.uid),Be("done");try{localStorage.setItem("android_update_cache",JSON.stringify({version:s,url:t,notes:Vs.trim(),force:!!$s}))}catch{}alert("تم حفظ تحديث الأندرويد في قاعدة البيانات")}catch(a){Be("error");const l=(a==null?void 0:a.message)||"فشل النشر: تأكد من الصلاحيات وحالة الاتصال";es(l);try{alert(l)}catch{}}},className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"نشر تحديث الأندرويد"}),Bs==="publishing"&&e.jsx("span",{className:"text-sm text-gray-600",children:"جاري النشر..."}),Bs==="error"&&e.jsx("span",{className:"text-sm text-red-600",children:za}),Bs==="done"&&e.jsx("span",{className:"text-sm text-green-600",children:"تم النشر"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ma,{className:"w-5 h-5 text-indigo-600"})," إدارة تطبيق الكمبيوتر (Windows) — 64 بت"]}),(T==null?void 0:T.pcUrl)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["الرابط الحالي: ",e.jsx("a",{href:ze(T.pcUrl),className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:"تنزيل"}),T.pcVersion?` | الإصدار: ${T.pcVersion}`:""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملف التطبيق (EXE/ZIP)"}),e.jsx("input",{type:"file",accept:".exe,.zip",onChange:s=>{var t;return Ma(((t=s.target.files)==null?void 0:t[0])||null)},className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:Xe,onChange:s=>Va(s.target.value),placeholder:"مثال: 2.1.0",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:async()=>{var s;if(Us)try{pt(!0),Ps(0);const{uploadAppBinaryResumable:t}=await B(async()=>{const{uploadAppBinaryResumable:l}=await import("./index-mBSeGJ8K.js").then(c=>c.cH);return{uploadAppBinaryResumable:l}},__vite__mapDeps([0,1]),import.meta.url),a=await t(Us,"pc",((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin",Xe||void 0,l=>Ps(l),3e5);Te(l=>({...l,pcUrl:a,pcVersion:Xe||l.pcVersion}))}catch(t){console.error("PC upload failed",t),alert(t!=null&&t.message?`فشل رفع تطبيق الكمبيوتر: ${t.message}`:"فشل رفع تطبيق الكمبيوتر")}finally{pt(!1),Ps(0)}},disabled:gt||!Us,className:"w-full sm:w-auto flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:[e.jsx(st,{className:"w-4 h-4"}),gt?`جاري الرفع... ${Ha}%`:"رفع تطبيق الكمبيوتر"]}),(T==null?void 0:T.pcUrl)&&e.jsxs("a",{href:ze(T.pcUrl),className:"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(et,{className:"w-4 h-4"})," تنزيل نسخة 64 بت"]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط مباشر لتطبيق الكمبيوتر (EXE/ZIP)"}),e.jsx("input",{type:"url",value:Ms,onChange:s=>yt(s.target.value),placeholder:"https://example.com/cashy-setup.exe",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:async()=>{var s;try{const{setAppDownloadLinks:t}=await B(async()=>{const{setAppDownloadLinks:a}=await import("./index-mBSeGJ8K.js").then(l=>l.cH);return{setAppDownloadLinks:a}},__vite__mapDeps([0,1]),import.meta.url);await t({pcUrl:Ms||void 0,pcVersion:Xe||void 0},((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin"),Te(a=>({...a,pcUrl:Ms||void 0,pcVersion:Xe||(a==null?void 0:a.pcVersion)})),alert("تم حفظ رابط الكمبيوتر بنجاح")}catch(t){console.error("Failed to save pc link",t),alert(t!=null&&t.message?`فشل حفظ الرابط: ${t.message}`:"فشل حفظ الرابط")}},className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700",children:[e.jsx(We,{className:"w-4 h-4"})," حفظ الرابط"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ma,{className:"w-5 h-5 text-sky-600"})," إدارة تطبيق الكمبيوتر (Windows) — 32 بت"]}),(T==null?void 0:T.pc32Url)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["الرابط الحالي: ",e.jsx("a",{href:ze(T.pc32Url),className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:"تنزيل"}),T.pc32Version?` | الإصدار: ${T.pc32Version}`:""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملف التطبيق (EXE/ZIP)"}),e.jsx("input",{type:"file",accept:".exe,.zip",onChange:s=>{var t;return Oa(((t=s.target.files)==null?void 0:t[0])||null)},className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:Je,onChange:s=>$a(s.target.value),placeholder:"مثال: 2.1.0",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:async()=>{var s;if(Is)try{ft(!0),Rs(0);const{uploadAppBinaryResumable:t}=await B(async()=>{const{uploadAppBinaryResumable:l}=await import("./index-mBSeGJ8K.js").then(c=>c.cH);return{uploadAppBinaryResumable:l}},__vite__mapDeps([0,1]),import.meta.url),a=await t(Is,"pc32",((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin",Je||void 0,l=>Rs(l),3e5);Te(l=>({...l,pc32Url:a,pc32Version:Je||l.pc32Version}))}catch(t){console.error("PC32 upload failed",t),alert(t!=null&&t.message?`فشل رفع تطبيق 32 بت: ${t.message}`:"فشل رفع تطبيق 32 بت")}finally{ft(!1),Rs(0)}},disabled:bt||!Is,className:"w-full sm:w-auto flex items-center gap-2 bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700 disabled:opacity-50",children:[e.jsx(st,{className:"w-4 h-4"}),bt?`جاري الرفع... ${qa}%`:"رفع تطبيق 32 بت"]}),(T==null?void 0:T.pc32Url)&&e.jsxs("a",{href:ze(T.pc32Url),className:"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(et,{className:"w-4 h-4"})," تنزيل نسخة 32 بت"]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط مباشر لتطبيق الكمبيوتر نسخة 32 بت (EXE/ZIP)"}),e.jsx("input",{type:"url",value:Os,onChange:s=>Nt(s.target.value),placeholder:"https://example.com/cashy-setup-ia32.exe",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:async()=>{var s;try{const{setAppDownloadLinks:t}=await B(async()=>{const{setAppDownloadLinks:a}=await import("./index-mBSeGJ8K.js").then(l=>l.cH);return{setAppDownloadLinks:a}},__vite__mapDeps([0,1]),import.meta.url);await t({pc32Url:Os||void 0,pc32Version:Je||void 0},((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin"),Te(a=>({...a,pc32Url:Os||void 0,pc32Version:Je||(a==null?void 0:a.pc32Version)})),alert("تم حفظ رابط 32 بت بنجاح")}catch(t){console.error("Failed to save pc32 link",t),alert(t!=null&&t.message?`فشل حفظ الرابط: ${t.message}`:"فشل حفظ الرابط")}},className:"flex items-center gap-2 bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700",children:[e.jsx(We,{className:"w-4 h-4"})," حفظ الرابط"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ya,{className:"w-5 h-5 text-indigo-600"})," إدارة تحديثات برنامج الكمبيوتر"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"إصدار موحّد مع روابط 64-بت و32-بت، وملاحظات وخيار التحديث الإجباري."})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار"}),e.jsx("input",{type:"text",value:vt,onChange:s=>wt(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"مثال: 1.4.0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط نسخة 64-بت"}),e.jsx("input",{type:"text",value:St,onChange:s=>kt(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"رابط المثبّت x64"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط نسخة 32-بت"}),e.jsx("input",{type:"text",value:Et,onChange:s=>At(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"رابط المثبّت ia32"})]}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملاحظات التحديث"}),e.jsx("textarea",{value:ps,onChange:s=>Dt(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",rows:4,placeholder:"نص الملاحظات"})]}),e.jsx("div",{children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:It,onChange:s=>Ya(s.target.checked)}),"تحديث إجباري (لن يفتح التطبيق إلا بعد التحديث)"]})})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("button",{onClick:Ja,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-60",disabled:bs==="publishing",children:"نشر التحديث"}),bs==="publishing"&&e.jsx("span",{className:"text-sm text-gray-600",children:"جاري النشر..."}),bs==="done"&&e.jsx("span",{className:"text-sm text-green-600",children:"تم النشر بنجاح"}),bs==="error"&&e.jsx("span",{className:"text-sm text-red-600",children:"فشل النشر"}),Lt&&e.jsx("span",{className:"text-sm text-red-600",children:Lt})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ks,{className:"w-5 h-5 text-emerald-600"})," إعداد إشعار تحديث تطبيق الأندرويد (Firestore)"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"يقرأه تطبيق الأندرويد عند الفتح ويعرض نافذة داخلية للتنزيل."})]})}),e.jsx("div",{className:"text-sm text-gray-600",children:"تم إلغاء إدارة تحديث تطبيق الموبايل من لوحة الأدمن."})]})]}),f==="branches"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"أكواد تفعيل الفروع"}),e.jsx("p",{className:"text-sm text-gray-500",children:"توليد أكواد تستخدم لمرة واحدة لإضافة فروع جديدة"})]}),e.jsxs("button",{onClick:er,disabled:Mt,className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(Js,{className:"w-4 h-4"}),Mt?"جاري التوليد...":"توليد كود جديد"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الكود"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ التوليد"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ الاستخدام"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[Ft.map(s=>{var t,a;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 font-mono",children:s.code}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${s.isUsed?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:s.isUsed?"مستخدم":"نشط"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.isUsed&&s.usedBy?(()=>{const l=m.find(c=>c.id===s.usedBy);return l?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:ge(l)}),e.jsx("span",{className:"text-xs text-gray-500",children:l.email})]}):e.jsx("span",{className:"text-xs font-mono",children:s.usedBy})})():"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(t=s.createdAt)!=null&&t.toDate?s.createdAt.toDate().toLocaleString("ar-EG"):"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(a=s.usedAt)!=null&&a.toDate?s.usedAt.toDate().toLocaleString("ar-EG"):"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(s.code),alert("تم نسخ الكود")},className:"text-gray-400 hover:text-gray-600",title:"نسخ الكود",children:e.jsx(Ta,{className:"w-4 h-4"})})})]},s.id||s.code)}),Ft.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-sm text-gray-500",children:"لا توجد أكواد مولدة حالياً"})})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"طلبات باقات الفروع (بانتظار التفعيل)"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:m.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.status)==="pending"||((a=s.branchPackage)==null?void 0:a.requested)}).length})]}),e.jsx(ja,{className:"w-8 h-8 text-purple-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"باقات الفروع المفعّلة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>{var t;return((t=s.branchPackage)==null?void 0:t.status)==="active"}).length})]}),e.jsx(cs,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي حسابات باقات الفروع"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:m.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).length})]}),e.jsx(Ss,{className:"w-8 h-8 text-blue-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قسم باقات الفروع"}),e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن حساب باقات الفروع...",value:D,onChange:s=>ke(s.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),D&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",me.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).length," من أصل ",m.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).length," حساب",D&&e.jsx("button",{onClick:()=>ke(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:P?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4",children:(D?me:m).filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).map(s=>{var a,l,c,o,A,V;const t=((a=s.branchPackage)==null?void 0:a.status)||((l=s.branchPackage)!=null&&l.requested?"pending":"none");return e.jsxs("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-purple-600 font-semibold",children:ss(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:ge(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),((c=s.branchPackage)==null?void 0:c.requestedAt)&&e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ الطلب: ",Zs(s.branchPackage.requestedAt)]}),((o=s.branchPackage)==null?void 0:o.limit)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["العدد المطلوب: ",e.jsx("span",{className:"font-bold",children:s.branchPackage.limit})]}),((A=s.branchPackage)==null?void 0:A.packageType)&&e.jsxs("p",{className:"text-sm text-gray-600",children:["نوع الباقة: ",e.jsx("span",{className:"font-bold",children:s.branchPackage.packageType==="basic"?"باقة أساسية":s.branchPackage.packageType==="quarterly"?"باقة ربع سنوية":s.branchPackage.packageType==="pro"?"باقة متقدمة":s.branchPackage.packageType==="enterprise"?"باقة شركات":s.branchPackage.packageType})]})]})]}),e.jsx(Bl,{userId:s.id,adminId:((V=n==null?void 0:n.currentUser)==null?void 0:V.uid)||"admin"}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${t==="active"?"bg-green-100 text-green-700":t==="pending"?"bg-yellow-100 text-yellow-700":t==="rejected"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600"}`,children:t==="active"?"مفعّل":t==="pending"?"بانتظار التفعيل":t==="rejected"?"مرفوض":"غير محدد"}),t==="active"&&e.jsx("button",{title:"إلغاء باقة الفروع",onClick:async()=>{var z;if(window.confirm("هل تريد إلغاء تفعيل باقة الفروع لهذا الحساب؟ سيتم إيقاف جميع الفروع المرتبطة."))try{const{doc:$,updateDoc:te,collection:pe,getDocs:Ye}=await B(async()=>{const{doc:G,updateDoc:Ee,collection:Ue,getDocs:Ie}=await import("./index-mBSeGJ8K.js").then(Le=>Le.cA);return{doc:G,updateDoc:Ee,collection:Ue,getDocs:Ie}},__vite__mapDeps([0,1]),import.meta.url),{db:ts}=await B(async()=>{const{db:G}=await import("./index-mBSeGJ8K.js").then(Ee=>Ee.cB);return{db:G}},__vite__mapDeps([0,1]),import.meta.url),js=((z=n==null?void 0:n.currentUser)==null?void 0:z.uid)||"admin-user-id";await te($(ts,"users",s.id),{"branchPackage.status":"canceled","branchPackage.canceledAt":new Date,"branchPackage.canceledBy":js,updatedAt:new Date});try{const G=pe(ts,"users",s.id,"branches"),Ue=(await Ye(G)).docs.map(async Ie=>{const Le=Ie.data();if(Le.branchUserId)try{await te($(ts,"users",Le.branchUserId),{isActive:!1,"branchPackage.status":"canceled",updatedAt:new Date})}catch(Ks){console.warn(`Failed to deactivate branch user ${Le.branchUserId}`,Ks)}});await Promise.all(Ue)}catch(G){console.error("Error fetching/deactivating branches:",G)}alert("تم إلغاء باقة الفروع وتعطيل الفروع المرتبطة بنجاح")}catch($){console.error("فشل في إلغاء باقة الفروع:",$),alert("حدث خطأ أثناء الإلغاء، حاول مرة أخرى")}},className:"p-1 rounded-md text-red-600 hover:bg-red-50",children:e.jsx(ll,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[t==="pending"&&e.jsx("button",{onClick:async()=>{if(window.confirm("هل أنت متأكد من رفض هذا الطلب؟"))try{const{doc:q,updateDoc:z}=await B(async()=>{const{doc:te,updateDoc:pe}=await import("./index-mBSeGJ8K.js").then(Ye=>Ye.cA);return{doc:te,updateDoc:pe}},__vite__mapDeps([0,1]),import.meta.url),{db:$}=await B(async()=>{const{db:te}=await import("./index-mBSeGJ8K.js").then(pe=>pe.cB);return{db:te}},__vite__mapDeps([0,1]),import.meta.url);await z(q($,"users",s.id),{"branchPackage.status":"rejected",updatedAt:new Date}),alert("تم رفض الطلب")}catch{alert("حدث خطأ")}},className:"px-3 py-1 text-sm rounded-md bg-red-100 text-red-600 hover:bg-red-200",children:"رفض"}),t!=="active"&&e.jsx("button",{onClick:async()=>{var q,z;try{const{doc:$,updateDoc:te,setDoc:pe}=await B(async()=>{const{doc:Ue,updateDoc:Ie,setDoc:Le}=await import("./index-mBSeGJ8K.js").then(Ks=>Ks.cA);return{doc:Ue,updateDoc:Ie,setDoc:Le}},__vite__mapDeps([0,1]),import.meta.url),{db:Ye}=await B(async()=>{const{db:Ue}=await import("./index-mBSeGJ8K.js").then(Ie=>Ie.cB);return{db:Ue}},__vite__mapDeps([0,1]),import.meta.url),ts=((q=n==null?void 0:n.currentUser)==null?void 0:q.uid)||"admin-user-id",js=new Date;let G=new Date(js);const Ee=((z=s.branchPackage)==null?void 0:z.packageType)||"basic";Ee==="quarterly"?G.setMonth(G.getMonth()+3):Ee==="pro"?G.setFullYear(G.getFullYear()+1):Ee==="enterprise"?G=null:G.setMonth(G.getMonth()+1),await te($(Ye,"users",s.id),{"branchPackage.status":"active","branchPackage.activatedAt":js,"branchPackage.endDate":G,"branchPackage.activatedBy":ts,isActive:!0,approved:!0,role:"merchant",updatedAt:new Date}),await pe($(Ye,"profiles",s.id),{role:"merchant",approved:!0,updatedAt:new Date},{merge:!0}),alert("تم تفعيل باقة الفروع لهذا الحساب")}catch($){console.error("فشل في تفعيل باقة الفروع:",$),alert("حدث خطأ أثناء التفعيل، حاول مرة أخرى")}},className:"px-3 py-1 text-sm rounded-md bg-purple-600 text-white hover:bg-purple-700",children:t==="rejected"?"إعادة تفعيل":"تفعيل الطلب"})]})]})]},s.id)})})})]})]}),f==="subscriptions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي الاشتراكات النشطة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>{var t;return(t=s.subscription)==null?void 0:t.isActive}).length})]}),e.jsx(cs,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"تنتهي خلال 7 أيام"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:m.filter(s=>{var o,A;if(!((o=s.subscription)!=null&&o.endDate)||!((A=s.subscription)!=null&&A.isActive))return!1;const t=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),a=new Date,l=t.getTime()-a.getTime(),c=Math.ceil(l/(1e3*60*60*24));return c<=7&&c>0}).length})]}),e.jsx(As,{className:"w-8 h-8 text-orange-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"منتهية الصلاحية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.filter(s=>{var a;return(a=s.subscription)!=null&&a.endDate?(s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate))<new Date:!1}).length})]}),e.jsx(je,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"اشتراكات مدى الحياة"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:m.filter(s=>{var t;return((t=s.subscription)==null?void 0:t.planType)===p.LIFETIME}).length})]}),e.jsx(is,{className:"w-8 h-8 text-yellow-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"جدول مواعيد الاشتراكات"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"عرض جميع الاشتراكات النشطة مع تواريخ البداية والانتهاء"})]}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(Re,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"بحث في الاشتراكات...",value:qs,onChange:s=>Ka(s.target.value),className:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:P?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"نوع الاشتراك"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ البداية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الأيام المتبقية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"إجراء"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.filter(s=>{var a,l;if(!((a=s.subscription)!=null&&a.planType))return!1;const t=((l=s.subscription)==null?void 0:l.isActive)===!1||(s==null?void 0:s.isActive)===!1;if(qs){const c=qs.trim().toLowerCase();if(c){const o=ge(s).toLowerCase(),A=(s.email||"").toLowerCase();if(!o.includes(c)&&!A.includes(c))return!1}}return!t}).sort((s,t)=>{var c,o;if(!((c=s.subscription)!=null&&c.endDate)||!((o=t.subscription)!=null&&o.endDate))return 0;const a=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),l=t.subscription.endDate.toDate?t.subscription.endDate.toDate():new Date(t.subscription.endDate);return a.getTime()-l.getTime()}).map(s=>{const t=s.subscription;if(!t)return null;const a=t.startDate?t.startDate.toDate?t.startDate.toDate():new Date(t.startDate):null,l=t.endDate?t.endDate.toDate?t.endDate.toDate():new Date(t.endDate):null;let c=null,o="غير محدد";const A=(t==null?void 0:t.isActive)===!1||(s==null?void 0:s.isActive)===!1;if(A)o="ملغي";else if(t.planType===p.LIFETIME)o="مدى الحياة";else if(l){const V=new Date,q=l.getTime()-V.getTime();c=Math.ceil(q/(1e3*60*60*24)),c<0?o="منتهي":c<=7?o="ينتهي قريباً":o="نشط"}return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-medium text-sm",children:ss(s)})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:ge(s)}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[t.planType===p.LIFETIME&&e.jsx(is,{className:"w-4 h-4 text-yellow-500 ml-2"}),t.planType===p.YEARLY&&e.jsx(Ae,{className:"w-4 h-4 text-blue-500 ml-2"}),t.planType===p.QUARTERLY&&e.jsx(be,{className:"w-4 h-4 text-purple-500 ml-2"}),t.planType===p.MONTHLY&&e.jsx(os,{className:"w-4 h-4 text-green-500 ml-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:ls(t.planType)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:a?a.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.planType===p.LIFETIME?"مدى الحياة":l?l.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${o==="نشط"?"bg-green-100 text-green-800":o==="ينتهي قريباً"?"bg-orange-100 text-orange-800":o==="منتهي"||o==="ملغي"?"bg-red-100 text-red-800":o==="مدى الحياة"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:o})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:A?"ملغي":t.planType===p.LIFETIME?"∞":c!==null?c<0?"منتهي":`${c} يوم`:"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:async()=>{try{if(!window.confirm("هل تريد إلغاء الاشتراك؟ سيتم الإلغاء فور التأكيد."))return;await ra(s.id)}catch(V){console.error("فشل في إلغاء الاشتراك:",V)}},className:"px-3 py-1 text-sm rounded-md bg-red-600 text-white hover:bg-red-700",children:"الغاء"})})]},s.id)}).filter(Boolean)})]})})]})]}),f==="content"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة محتوى خطط الاشتراك"}),U&&U.lastUpdated&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["آخر تحديث: ",new Date(U.lastUpdated).toLocaleString("ar-SA"),U.updatedBy&&` بواسطة: ${U.updatedBy}`]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>{Ke(!0),oe({name:"الباقة الربع سنوية",price:"250 جنيه",period:"كل 3 أشهر",description:"حل وسط بين الشهرية والسنوية",features:["إدارة محافظ متعددة","تقارير ربع سنوية"]}),ds("quarterly"),se(!0)},className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:[e.jsx(Js,{className:"w-4 h-4"}),"إضافة باقة جديدة"]}),e.jsxs("button",{onClick:lr,disabled:y,className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(We,{className:"w-4 h-4"}),y?"جاري الحفظ...":"حفظ جميع التغييرات"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:Object.entries(ce).map(([s,t])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[s==="monthly"&&e.jsx(os,{className:"w-4 h-4 text-green-500"}),s==="quarterly"&&e.jsx(be,{className:"w-4 h-4 text-purple-500"}),s==="yearly"&&e.jsx(Ae,{className:"w-4 h-4 text-blue-500"}),s==="lifetime"&&e.jsx(is,{className:"w-4 h-4 text-yellow-500"}),t.name]}),e.jsx("button",{onClick:()=>{W(I===s?null:s),Ke(!1),ds(s),oe({...t,features:[...t.features||[]]}),se(!0)},className:"text-purple-600 hover:text-purple-800",children:e.jsx(nl,{className:"w-4 h-4"})})]}),I===s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:t.name,onChange:a=>fs(s,"name",a.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:t.price,onChange:a=>fs(s,"price",a.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:t.period,onChange:a=>fs(s,"period",a.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{value:t.description,onChange:a=>fs(s,"description",a.target.value),rows:3,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>nr(s),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:t.features.map((a,l)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:a,onChange:c=>ir(s,l,c.target.value),className:"flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"}),e.jsx("button",{onClick:()=>cr(s,l),className:"text-red-500 hover:text-red-700",children:e.jsx(Me,{className:"w-4 h-4"})})]},l))})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:t.price}),e.jsx("div",{className:"text-sm text-gray-600",children:t.period}),e.jsx("div",{className:"text-sm text-gray-700",children:t.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"المميزات:"}),t.features.map((a,l)=>e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(cs,{className:"w-3 h-3 text-green-500"}),a]},l))]})]})]},s))})]}),De&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold",children:Ts?"إضافة باقة جديدة":`تعديل ${R==="monthly"?"الباقة الشهرية":R==="yearly"?"الباقة السنوية":R==="lifetime"?"باقة مدى الحياة":"باقة ربع سنوية"}`}),e.jsx("button",{onClick:()=>se(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(Me,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:ue.name,onChange:s=>oe(t=>({...t,name:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:ue.price,onChange:s=>oe(t=>({...t,price:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:ue.period,onChange:s=>oe(t=>({...t,period:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{rows:3,value:ue.description,onChange:s=>oe(t=>({...t,description:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>oe(s=>({...s,features:[...s.features||[],""]})),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:(ue.features||[]).map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:a=>{const l=a.target.value;oe(c=>{const o=[...c.features||[]];return o[t]=l,{...c,features:o}})},className:"flex-1 p-2 border rounded-md text-sm"}),e.jsx("button",{onClick:()=>{oe(a=>{const l=[...a.features||[]];return l.splice(t,1),{...a,features:l}})},className:"text-red-500 hover:text-red-700",children:e.jsx(Me,{className:"w-4 h-4"})})]},t))})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>se(!1),className:"px-4 py-2 rounded-md bg-gray-100 hover:bg-gray-200",children:"إلغاء"}),e.jsx("button",{onClick:()=>{R&&(ee(s=>({...s,[R]:{...ue}})),se(!1))},className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700",children:"حفظ داخل الصفحة"}),e.jsx("button",{onClick:async()=>{var s;if(R)try{const t=((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin";await Yr(R,ue,t),ee(a=>({...a,[R]:{...ue}})),se(!1)}catch(t){console.error("Immediate save failed",t),alert("حدث خطأ أثناء الحفظ الفوري. حاول لاحقًا أو استخدم حفظ جميع التغييرات.")}},className:"px-4 py-2 rounded-md bg-purple-600 text-white hover:bg-purple-700",children:"حفظ فوري"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إرسال إشعار للمستخدمين"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"سيظهر الإشعار كمودال صغير في منتصف الشاشة مع ضباب خفيف."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"عنوان الإشعار"}),e.jsx("input",{type:"text",value:Ys,onChange:s=>Vt(s.target.value),placeholder:"أدخل عنوانًا قصيرًا وجذابًا",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"نص الإشعار"}),e.jsx("textarea",{value:zs,onChange:s=>$t(s.target.value),placeholder:"اكتب محتوى الإشعار الذي سيظهر للمستخدمين",rows:4,className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رابط اختياري"}),e.jsx("input",{type:"text",value:Bt,onChange:s=>Ht(s.target.value),placeholder:"مثال: /user/dashboard أو https://example.com",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"إذا كان الرابط خارجيًا سيفتح في نافذة جديدة، وإذا كان داخليًا سيتم التوجيه داخل الموقع."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"نص زر الإجراء (اختياري)"}),e.jsx("input",{type:"text",value:qt,onChange:s=>Yt(s.target.value),placeholder:"افتراضي: فتح الرابط",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsx("div",{className:"flex items-center justify-end gap-3",children:e.jsx("button",{onClick:sr,disabled:Wt,className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:Wt?"جاري الإرسال...":"إرسال إشعار"})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ya,{className:"w-5 h-5 text-slate-600"})," إعدادات النظام — Telegram/Cloudflare Worker"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"أدخل رابط الـ Worker المركزي. التوكن يبقى سر داخل Cloudflare Secrets."})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط Cloudflare Worker"}),e.jsx("input",{type:"url",value:Ct,onChange:s=>Tt(s.target.value),placeholder:"https://summer-cake-5149.alkaptin2030.workers.dev",className:"w-full p-2 border border-gray-300 rounded-md"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:'تأكد أن المسار يدعم POST عند "/notify" أو الجذر حسب إعدادك.'})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:async()=>{try{Ut(!0);const{systemSettingsService:s}=await B(async()=>{const{systemSettingsService:a}=await import("./index-mBSeGJ8K.js").then(l=>l.cC);return{systemSettingsService:a}},__vite__mapDeps([0,1]),import.meta.url),t=(Ct||"").trim();if(!t){alert("أدخل رابط صحيح");return}await s.setTelegramWorkerUrl(t),alert("تم حفظ رابط Cloudflare Worker بنجاح")}catch(s){console.error("Failed to save worker url",s),alert(s!=null&&s.message?`فشل حفظ الرابط: ${s.message}`:"فشل حفظ الرابط")}finally{Ut(!1)}},className:"flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded-lg hover:bg-slate-700 disabled:opacity-50",disabled:_t,children:[e.jsx(We,{className:"w-4 h-4"})," ",_t?"جاري الحفظ...":"حفظ الرابط"]})})]})]})]})]})]}),f==="trials"&&e.jsxs("div",{className:"space-y-6",children:[console.log("🔍 Trials tab rendering - users data:",m),console.log("🔍 Users count:",(m==null?void 0:m.length)||0),console.log("🔍 Users on trial:",((na=m==null?void 0:m.filter(s=>s.isOnFreeTrial))==null?void 0:na.length)||0),P&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري تحميل بيانات المستخدمين..."})]})}),v&&!P&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(As,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"خطأ في تحميل البيانات"}),e.jsx("p",{className:"text-red-600 mb-4",children:v}),e.jsx("p",{className:"text-sm text-red-500",children:"تأكد من اتصال الإنترنت وإعدادات Firebase"})]}),!P&&!v&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين في التجربة"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:m.filter(s=>s.isOnFreeTrial).length})]}),e.jsx(Ae,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"التجارب المنتهية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).length})]}),e.jsx(je,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المؤهلين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length})]}),e.jsx(dt,{className:"w-8 h-8 text-green-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إعداد مدة التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"يتم تطبيق التغيير فورياً على أي تفعيل جديد."})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"المدة بالساعات"}),e.jsx("input",{type:"number",min:1,max:336,value:Zt,onChange:s=>Kt(s.target.value),className:"w-full px-4 py-2 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm",placeholder:"اكتب عدد الساعات"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["المدة الحالية: ",le," ",le>=3&&le<=10?"ساعات":le===2?"ساعتين":"ساعة"]})]}),e.jsx("div",{className:"flex items-center md:justify-end",children:e.jsx("button",{onClick:xr,disabled:Xt,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium disabled:opacity-50",children:Xt?"جاري التحديث...":"تحديث المدة"})})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-4 border-b border-gray-200 mb-6",children:[e.jsxs("button",{onClick:()=>Qs("eligible"),className:`pb-2 px-4 text-sm font-medium transition-colors relative whitespace-nowrap ${qe==="eligible"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:["المؤهلين للتجربة",e.jsx("span",{className:"mr-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs",children:m.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length})]}),e.jsxs("button",{onClick:()=>Qs("active"),className:`pb-2 px-4 text-sm font-medium transition-colors relative whitespace-nowrap ${qe==="active"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:["التجارب النشطة",e.jsx("span",{className:"mr-2 bg-blue-100 text-blue-600 py-0.5 px-2 rounded-full text-xs",children:m.filter(s=>s.isOnFreeTrial).length})]}),e.jsxs("button",{onClick:()=>Qs("expired"),className:`pb-2 px-4 text-sm font-medium transition-colors relative whitespace-nowrap ${qe==="expired"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:["التجارب المنتهية",e.jsx("span",{className:"mr-2 bg-red-100 text-red-600 py-0.5 px-2 rounded-full text-xs",children:m.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).length})]})]}),qe==="eligible"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين المؤهلين للتجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين لم يستخدموا التجربة المجانية من قبل"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:He,onChange:s=>Gs(s.target.value),placeholder:"ابحث بالاسم أو البريد في المؤهلين للتجربة",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Re,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[m.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).filter(s=>{const t=He.trim().toLowerCase();if(!t)return!0;const a=ge(s).toLowerCase(),l=(s.email||"").toLowerCase();return a.includes(t)||l.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:ss(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:ge(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ التسجيل: ",Zs(s.createdAt)]})]})]}),e.jsx("div",{className:"flex items-center space-x-3 space-x-reverse",children:e.jsx("button",{onClick:()=>la(s.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:`تفعيل التجربة ${le} ${le>=3&&le<=10?"ساعات":le===2?"ساعتين":"ساعة"}`})})]},s.id)),m.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد مستخدمين مؤهلين للتجربة المجانية حالياً"})]})]})})]}),qe==="active"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين في التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين يستخدمون التجربة المجانية حالياً"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:He,onChange:s=>Gs(s.target.value),placeholder:"ابحث بالاسم أو البريد في التجارب المجانية",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Re,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[m.filter(s=>s.isOnFreeTrial).filter(s=>{const t=He.trim().toLowerCase();if(!t)return!0;const a=ge(s).toLowerCase(),l=(s.email||"").toLowerCase();return a.includes(t)||l.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:ss(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:ge(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-blue-600",children:["تنتهي في: ",s.freeTrialEndDate?Zs(s.freeTrialEndDate):"غير محدد"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:"نشط"}),e.jsx("button",{onClick:()=>hr(s.id),className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-xs",children:"ضبط نهاية التجربة"}),e.jsx("button",{onClick:()=>mr(s.id),className:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 text-xs",children:"إلغاء التجربة"})]})]},s.id)),m.filter(s=>s.isOnFreeTrial).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد تجارب نشطة حالياً"})]})]})})]}),qe==="expired"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين المنتهين من التجربة"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين انتهت تجربتهم المجانية"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:He,onChange:s=>Gs(s.target.value),placeholder:"ابحث بالاسم أو البريد في التجارب المنتهية",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Re,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[m.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).filter(s=>{const t=He.trim().toLowerCase();if(!t)return!0;const a=ge(s).toLowerCase(),l=(s.email||"").toLowerCase();return a.includes(t)||l.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-gray-600 font-semibold",children:ss(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:ge(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsx("p",{className:"text-xs text-red-500",children:"انتهت التجربة"})]})]}),e.jsx("div",{className:"flex items-center space-x-3 space-x-reverse",children:e.jsx("button",{onClick:()=>la(s.id),className:"px-3 py-1 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-xs",children:"تفعيل مرة أخرى"})})]},s.id)),m.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(je,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد تجارب منتهية حالياً"})]})]})})]})]})]}),f==="whatsapp"&&e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Es,{className:"w-6 h-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة الواتساب"})]}),e.jsx(vl,{})]}),f==="analytics"&&e.jsxs("div",{className:"bg-white rounded-lg p-8 shadow-sm border border-gray-200 text-center",children:[e.jsx(fa,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"الإحصائيات"}),e.jsx("p",{className:"text-gray-500",children:"سيتم إضافة الإحصائيات قريباً"})]})]})]}),e.jsx(Ol,{isOpen:Wa,onClose:()=>Hs(!1),user:Ga,onActivate:async(s,t)=>{try{await aa(s,t),alert("تم تفعيل الاشتراك بنجاح"),Hs(!1)}catch(a){console.error("فشل في تفعيل الاشتراك:",a),alert("حدث خطأ أثناء تفعيل الاشتراك")}}}),e.jsx(Ul,{isOpen:Ua,onClose:()=>k(!1)}),e.jsx(Il,{notification:Ia,onClose:dr,soundEnabled:Ce.soundAlerts,onToggleSound:or})]})},Qn=()=>{const i=Vr(),{user:n,loading:h}=$r(),[g,v]=r.useState(!1),[w,d]=r.useState(null),[_,f]=r.useState(!0),[S,k]=r.useState("users"),[O,F]=r.useState(0),[N,b]=r.useState([]),[m,M]=r.useState({}),[P,j]=r.useState([]),[E,y]=r.useState([]),[u,U]=r.useState(!1),[J,we]=r.useState(null);r.useEffect(()=>{const I=localStorage.getItem("admin_dev_mode")==="true";v(I)},[]);const Q=async()=>{if(!(!g&&!n)){f(!0),d(null);try{const I=ae(K(C,"users")),ce=(await B(()=>import("./index-mBSeGJ8K.js").then(R=>R.cA),__vite__mapDeps([0,1]),import.meta.url).then(R=>R.getDocs(I))).docs.map(R=>({id:R.id,...R.data()}));b(ce);const ee=ae(K(C,"profiles")),De=await B(()=>import("./index-mBSeGJ8K.js").then(R=>R.cA),__vite__mapDeps([0,1]),import.meta.url).then(R=>R.getDocs(ee)),se={};De.forEach(R=>{se[R.id]=R.data()}),M(se),f(!1)}catch(I){console.error("Error refreshing data:",I),!g&&N.length===0&&d("فشل في تحميل البيانات"),f(!1)}}};r.useEffect(()=>{Q()},[n,g]),r.useEffect(()=>{const I=N.map(W=>{const ce=m[W.id]||{},ee=typeof ce.fullName=="string"?ce.fullName:void 0,De=typeof ce.phone=="string"?ce.phone:void 0,se=typeof W.displayName=="string"&&W.displayName.trim()?W.displayName:ee||W.displayName||void 0;return{...W,displayName:se,phone:W.phone??De??null}});j(I)},[N,m]);const X=I=>{console.log("Notification center:",I)},Se=I=>{console.log("Notification settings:",I)},me=I=>{console.log("Notifications:",I)},he=I=>{console.log("Editing plan:",I)};r.useEffect(()=>{n&&(async()=>{try{const I=await xa();we(I)}catch(I){console.warn("Failed to load last update info:",I),we(null)}})()},[n]);const D=async()=>{try{return await Wr()}catch(I){return console.error("Error loading content:",I),{}}},ke=async I=>{try{U(!0),await zr(I,(n==null?void 0:n.uid)||"admin");const W=await xa();return we(W),!0}catch(W){return console.error("Error saving content:",W),!1}finally{U(!1)}};return h?e.jsx(Br,{}):e.jsx(Hl,{navigate:i,auth:Hr,devMode:g,setDevMode:v,error:w,setError:d,authLoading:h,setAuthLoading:()=>{},activeTab:S,setActiveTab:k,setNotificationCenterOpen:X,setNotificationSettings:Se,setNotifications:me,notificationCount:O,setNotificationCount:F,users:P,setUsers:j,loading:_,setLoading:f,setEditingPlan:he,isSavingContent:u,setIsSavingContent:U,lastUpdateInfo:J,loadContentFromFirebase:D,saveContentToFirebase:ke,refreshData:Q})};export{Qn as default};
//# sourceMappingURL=ProtectedAdminDashboard-Dj6xNvps.js.map
