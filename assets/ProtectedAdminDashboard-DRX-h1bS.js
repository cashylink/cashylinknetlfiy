const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DvnSb1Lh.js","./index-DFE28tXP.css","./freeTrialService-ag8hxyeR.js"])))=>i.map(i=>d[i]);
import{F as J,c as ja,r as l,j as e,bc as Ge,I as ya,B as Z,E as Na,v as wa,h as oe,i as Q,q as Se,at as ks,k as Ie,aq as x,av as de,U as Tt,K as X,bd as Qe,R as Ze,ad as va,M as Sa,t as Es,ag as yt,ak as ka,be as Ea,_ as C,ba as Aa,bf as _a,bg as Ta,S as Ca,aG as Da,af as Ua,ao as Nt,e as ye,bh as Ia,b0 as La,H as Pa,D as Ye,s as Fa,m as Ra,n as Ma,bi as Ue,C as Va,bj as Oa,bk as $a,a as Ba,u as Ha,aj as qa,f as Ya}from"./index-DvnSb1Lh.js";import{u as Wa,g as wt,s as za,l as Ga}from"./contentService-BTZ_TfW3.js";import{A as vt,P as Qa}from"./ProfileIcon-9WiQiAPK.js";import{C as We,a as js,b as ys,d as ze,c as Za}from"./card-CJ-6ser-.js";import{L as St}from"./label-B6P4HKsh.js";import{T as Ka,B as ve}from"./textarea-CMDxbUyO.js";import{S as Xa}from"./switch-C0JIfFYU.js";import{A as Ja,a as er}from"./alert-Ds78u46V.js";import{B as As}from"./badge-BfGzgZeY.js";import{a as sr,C as K,S as Ne,P as tr}from"./separator-CqHV39r0.js";import{u as ar,c as Ct,v as Dt}from"./whatsappService-DIUnbVu6.js";import{R as Le}from"./refresh-cw-ByDjU7ZC.js";import{C as rr}from"./circle-alert-CyhKuebD.js";import{P as Ut}from"./phone-DA7H39xo.js";import{S as we}from"./save-C7Mgi-lw.js";import{C as lr,G as re,U as Ns}from"./users-BELg4dTe.js";import{E as nr,p as ir}from"./broadcastService-CDwMeI4U.js";import{S as cr,a as or,b as dr,c as mr,d as ce}from"./select-Bt20No4d.js";import{Z as Re}from"./zap-BVOH1pJy.js";import{C as Pe}from"./crown-CuelULZ5.js";import{C as Fe}from"./circle-check-big-B7qPpE3T.js";import{S as ws,M as kt}from"./smartphone-Bk_Vpbi6.js";import{D as vs}from"./download-BI83ceFZ.js";import{C as xr}from"./circle-x-BPdk9KzK.js";import"./dropdown-menu-Cr2CyYbi.js";import"./index-BQ7U6Bzi.js";import"./MasterPinDialog-DoxZ0TSE.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ur=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],gr=J("funnel",ur);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]],Et=J("git-branch",hr);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],At=J("hard-drive",pr);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=[["path",{d:"M6 16c5 0 7-8 12-8a4 4 0 0 1 0 8c-5 0-7-8-12-8a4 4 0 1 0 0 8",key:"18ogeb"}]],fr=J("infinity",br);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],yr=J("menu",jr);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nr=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ss=J("upload",Nr);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wr=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],_t=J("user-check",wr);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Sr=J("user-x",vr);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Er=J("volume-2",kr);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],_r=J("volume-x",Ar),Tr=()=>{const{settings:i,loading:n,error:h,updateSettings:p,refreshSettings:f}=ar(),{toast:b}=ja(),[m,A]=l.useState({phoneNumber:"",defaultMessage:"",isEnabled:!0}),[g,w]=l.useState(!1),[_,L]=l.useState(!1),[U,D]=l.useState(""),[u,d]=l.useState({});l.useEffect(()=>{i&&A({phoneNumber:i.phoneNumber,defaultMessage:i.defaultMessage,isEnabled:i.isEnabled})},[i]);const V=()=>{var T,H;const S={};return(T=m.phoneNumber)!=null&&T.trim()?Dt(m.phoneNumber)||(S.phoneNumber="رقم الواتساب غير صحيح (يجب أن يحتوي على 10-15 رقم)"):S.phoneNumber="رقم الواتساب مطلوب",(H=m.defaultMessage)!=null&&H.trim()?m.defaultMessage.length<10&&(S.defaultMessage="الرسالة يجب أن تحتوي على 10 أحرف على الأقل"):S.defaultMessage="الرسالة الافتراضية مطلوبة",d(S),Object.keys(S).length===0},P=async()=>{if(!V()){b({title:"خطأ في البيانات",description:"يرجى تصحيح الأخطاء قبل الحفظ",variant:"destructive"});return}w(!0);try{if(await p(m))b({title:"تم الحفظ بنجاح",description:"تم تحديث إعدادات الواتساب بنجاح",variant:"default"});else throw new Error("فشل في الحفظ")}catch{b({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ الإعدادات",variant:"destructive"})}finally{w(!1)}},y=()=>{if(m.phoneNumber&&m.defaultMessage)try{const S=Ct(m.phoneNumber,m.defaultMessage);D(S),L(!0)}catch{b({title:"خطأ في المعاينة",description:"تأكد من صحة رقم الواتساب",variant:"destructive"})}},me=async()=>{try{await navigator.clipboard.writeText(U),b({title:"تم النسخ",description:"تم نسخ الرابط إلى الحافظة",variant:"default"})}catch{b({title:"خطأ في النسخ",description:"فشل في نسخ الرابط",variant:"destructive"})}},ke=S=>{const T=S.replace(/[^\d+]/g,"");A(H=>({...H,phoneNumber:T})),u.phoneNumber&&d(H=>({...H,phoneNumber:""}))};return n?e.jsxs(We,{children:[e.jsx(js,{children:e.jsxs(ys,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5"}),"إدارة الواتساب"]})}),e.jsx(ze,{children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Le,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"mr-2",children:"جاري التحميل..."})]})})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(We,{children:[e.jsxs(js,{children:[e.jsxs(ys,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5"}),"إدارة الواتساب"]}),e.jsx(Za,{children:"إدارة رقم الواتساب والرسائل الافتراضية المعروضة في جميع أنحاء الموقع"})]}),e.jsxs(ze,{className:"space-y-6",children:[h&&e.jsxs(Ja,{variant:"destructive",children:[e.jsx(rr,{className:"h-4 w-4"}),e.jsx(er,{children:h})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-3 w-3 rounded-full ${m.isEnabled?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"حالة خدمة الواتساب"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.isEnabled?"مفعلة":"معطلة"})]})]}),e.jsx(Xa,{checked:m.isEnabled,onCheckedChange:S=>A(T=>({...T,isEnabled:S}))})]}),e.jsx(sr,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(St,{htmlFor:"phoneNumber",className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"h-4 w-4"}),"رقم الواتساب"]}),e.jsx(ya,{id:"phoneNumber",type:"tel",placeholder:"مثال: 201000392539",value:m.phoneNumber,onChange:S=>ke(S.target.value),className:u.phoneNumber?"border-red-500":"",dir:"ltr"}),u.phoneNumber&&e.jsx("p",{className:"text-sm text-red-500",children:u.phoneNumber}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"أدخل رقم الواتساب مع رمز الدولة (مثال: 201000392539 لمصر)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(St,{htmlFor:"defaultMessage",children:"الرسالة الافتراضية"}),e.jsx(Ka,{id:"defaultMessage",placeholder:"مرحباً، أريد الاستفسار عن خدماتكم",value:m.defaultMessage,onChange:S=>{A(T=>({...T,defaultMessage:S.target.value})),u.defaultMessage&&d(T=>({...T,defaultMessage:""}))},className:u.defaultMessage?"border-red-500":"",rows:4}),u.defaultMessage&&e.jsx("p",{className:"text-sm text-red-500",children:u.defaultMessage}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"هذه الرسالة ستظهر افتراضياً عند النقر على أزرار الواتساب"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(Z,{onClick:P,disabled:g,className:"flex items-center gap-2",children:[g?e.jsx(Le,{className:"h-4 w-4 animate-spin"}):e.jsx(we,{className:"h-4 w-4"}),g?"جاري الحفظ...":"حفظ التغييرات"]}),e.jsxs(Z,{variant:"outline",onClick:y,disabled:!m.phoneNumber||!m.defaultMessage,className:"flex items-center gap-2",children:[_?e.jsx(Na,{className:"h-4 w-4"}):e.jsx(wa,{className:"h-4 w-4"}),"معاينة الرابط"]}),e.jsxs(Z,{variant:"outline",onClick:f,className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"تحديث"]})]}),_&&U&&e.jsxs(We,{className:"bg-muted/50",children:[e.jsx(js,{children:e.jsx(ys,{className:"text-lg",children:"معاينة رابط الواتساب"})}),e.jsxs(ze,{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-background rounded border font-mono text-sm break-all",children:U}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Z,{variant:"outline",size:"sm",onClick:me,className:"flex items-center gap-2",children:[e.jsx(lr,{className:"h-4 w-4"}),"نسخ الرابط"]}),e.jsxs(Z,{variant:"outline",size:"sm",onClick:()=>window.open(U,"_blank"),className:"flex items-center gap-2",children:[e.jsx(nr,{className:"h-4 w-4"}),"فتح في الواتساب"]})]})]})]}),i&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"معلومات الإعدادات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"آخر تحديث:"}),e.jsxs(As,{variant:"outline",className:"mr-2",children:[i.lastUpdated.toLocaleDateString("ar-EG")," - ",i.lastUpdated.toLocaleTimeString("ar-EG")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"الحالة:"}),e.jsx(As,{variant:i.isEnabled?"default":"secondary",className:"mr-2",children:i.isEnabled?"مفعل":"معطل"})]})]})]})]})]})})},Ke={enableVisualAlerts:!0,enableAudioAlerts:!0,criticalDays:1,warningDays:3,infoDays:7},Cr=i=>{const n=new Date,p=new Date(i).getTime()-n.getTime();return Math.ceil(p/(1e3*60*60*24))},Dr=(i,n=Ke)=>i<0?"expired":i<=n.criticalDays?"critical":i<=n.warningDays?"warning":(i<=n.infoDays,"info"),Ur=(i,n,h)=>{const p=Ir(h);return n<0?`انتهت صلاحية اشتراك ${p} للمستخدم ${i}`:n===0?`ينتهي اشتراك ${p} للمستخدم ${i} اليوم!`:n===1?`ينتهي اشتراك ${p} للمستخدم ${i} غداً`:`ينتهي اشتراك ${p} للمستخدم ${i} خلال ${n} أيام`},Ir=i=>{switch(i){case x.MONTHLY:return"الشهري";case x.YEARLY:return"السنوي";case x.LIFETIME:return"مدى الحياة";default:return"غير محدد"}},Lr=async()=>{try{const i=oe(Q,"users"),n=Se(i,ks("subscription","!=",null)),h=await Ie(n),p=[];return h.forEach(f=>{var m,A,g,w;const b=f.data();b.subscription&&(b.subscription.planType||b.subscription.plan)&&p.push({id:f.id,...b,subscription:{...b.subscription,startDate:((A=(m=b.subscription.startDate)==null?void 0:m.toDate)==null?void 0:A.call(m))||new Date(b.subscription.startDate),endDate:((w=(g=b.subscription.endDate)==null?void 0:g.toDate)==null?void 0:w.call(g))||new Date(b.subscription.endDate),planType:b.subscription.planType||b.subscription.plan}})}),p}catch(i){return console.error("خطأ في جلب الاشتراكات النشطة:",i),[]}},Pr=async(i=Ke)=>{try{const n=await Lr(),h=[];return n.forEach(p=>{if(!p.subscription||!p.subscription.endDate)return;const f=Cr(p.subscription.endDate),b=Dr(f,i);if(f<=i.infoDays||f<0){const m={id:`${p.id}_${Date.now()}`,userId:p.id,userName:p.displayName||p.email||"مستخدم غير معروف",userEmail:p.email||"",subscriptionPlan:p.subscription.planType,expiryDate:p.subscription.endDate,daysRemaining:f,type:b,message:Ur(p.displayName||p.email||"مستخدم غير معروف",f,p.subscription.planType),isRead:!1,createdAt:new Date};h.push(m)}}),h.sort((p,f)=>{const b={expired:0,critical:1,warning:2,info:3};return b[p.type]!==b[f.type]?b[p.type]-b[f.type]:p.daysRemaining-f.daysRemaining}),h}catch(n){return console.error("خطأ في إنشاء إشعارات الاشتراك:",n),[]}},Fr=(i,n)=>n?i.filter(h=>h.type===n):i,Rr=i=>{localStorage.setItem("notificationSettings",JSON.stringify(i))},Mr=()=>{try{const i=localStorage.getItem("notificationSettings");if(i)return{...Ke,...JSON.parse(i)}}catch(i){console.error("خطأ في تحميل إعدادات الإشعارات:",i)}return Ke},Vr=({isOpen:i,onClose:n})=>{const[h,p]=l.useState([]),[f,b]=l.useState([]),[m,A]=l.useState("all"),[g,w]=l.useState(!0),[_,L]=l.useState(Mr());l.useEffect(()=>{i&&U()},[i]),l.useEffect(()=>{b(m==="all"?h:Fr(h,m))},[h,m]);const U=async()=>{w(!0);try{const y=await Pr(_);p(y)}catch(y){console.error("خطأ في تحميل الإشعارات:",y)}finally{w(!1)}},D=y=>{switch(y){case"urgent":return e.jsx(Qe,{className:"w-5 h-5 text-red-500"});case"warning":return e.jsx(X,{className:"w-5 h-5 text-yellow-500"});case"info":return e.jsx(ve,{className:"w-5 h-5 text-blue-500"});default:return e.jsx(ve,{className:"w-5 h-5 text-gray-500"})}},u=y=>{switch(y){case"urgent":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";case"info":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}},d=y=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(y),V=y=>{switch(y){case"all":return"جميع الإشعارات";case"urgent":return"عاجل (يوم واحد)";case"warning":return"تحذير (3 أيام)";case"info":return"معلومات (7 أيام)";default:return"غير محدد"}},P=y=>{const me={..._,[y]:!_[y]};L(me),Rr(me)};return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-xl font-bold",children:"مركز الإشعارات"}),h.length>0&&e.jsx("span",{className:"bg-white text-blue-600 px-2 py-1 rounded-full text-sm font-medium",children:h.length})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors",children:e.jsx(de,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gr,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"تصفية حسب:"})]}),["all","urgent","warning","info"].map(y=>e.jsx("button",{onClick:()=>A(y),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${m===y?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:V(y)},y))]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"الإعدادات:"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:_.visualAlerts,onChange:()=>P("visualAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات المرئية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:_.soundAlerts,onChange:()=>P("soundAlerts"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التنبيهات الصوتية"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:_.autoRefresh,onChange:()=>P("autoRefresh"),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"التحديث التلقائي"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-96",children:g?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"جاري تحميل الإشعارات..."})]}):f.length===0?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(ve,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"لا توجد إشعارات"}),e.jsx("p",{className:"text-gray-500",children:m==="all"?"لا توجد إشعارات حاليًا":`لا توجد إشعارات من نوع "${V(m)}"`})]}):e.jsx("div",{className:"p-4 space-y-3",children:f.map(y=>e.jsx("div",{className:`p-4 rounded-lg border-r-4 ${u(y.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[D(y.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:y.message}),e.jsx("span",{className:"text-xs text-gray-500",children:d(y.createdAt)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Tt,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"المستخدم:"})," ",y.userName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"تاريخ الانتهاء:"})," ",d(y.expiryDate)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-700",children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",y.daysRemaining]})]})]})]})]})},y.id))})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["آخر تحديث: ",d(new Date)]}),e.jsx("button",{onClick:U,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"تحديث الإشعارات"})]})})]})}):null},Or=({notification:i,onClose:n,soundEnabled:h,onToggleSound:p})=>{const[f,b]=l.useState(!1),[m,A]=l.useState(null);l.useEffect(()=>{if(i&&(b(!0),h&&g(i.type),i.type!=="urgent")){const D=setTimeout(()=>{w()},1e4);return()=>clearTimeout(D)}},[i,h]),l.useEffect(()=>{typeof window<"u"&&window.AudioContext&&A(new AudioContext)},[]);const g=D=>{if(!(!m||!h))try{const u=m.createOscillator(),d=m.createGain();switch(u.connect(d),d.connect(m.destination),D){case"urgent":u.frequency.setValueAtTime(800,m.currentTime),u.frequency.setValueAtTime(1e3,m.currentTime+.1),u.frequency.setValueAtTime(800,m.currentTime+.2),d.gain.setValueAtTime(.3,m.currentTime),d.gain.exponentialRampToValueAtTime(.01,m.currentTime+.5),u.start(m.currentTime),u.stop(m.currentTime+.5);break;case"warning":u.frequency.setValueAtTime(600,m.currentTime),u.frequency.setValueAtTime(700,m.currentTime+.15),d.gain.setValueAtTime(.2,m.currentTime),d.gain.exponentialRampToValueAtTime(.01,m.currentTime+.3),u.start(m.currentTime),u.stop(m.currentTime+.3);break;case"info":u.frequency.setValueAtTime(400,m.currentTime),d.gain.setValueAtTime(.1,m.currentTime),d.gain.exponentialRampToValueAtTime(.01,m.currentTime+.2),u.start(m.currentTime),u.stop(m.currentTime+.2);break}}catch(u){console.error("خطأ في تشغيل الصوت:",u)}},w=()=>{b(!1),setTimeout(()=>{n()},300)},_=D=>{switch(D){case"urgent":return{bg:"bg-red-500",border:"border-red-600",text:"text-white",icon:e.jsx(Qe,{className:"w-6 h-6"}),pulse:"animate-pulse"};case"warning":return{bg:"bg-yellow-500",border:"border-yellow-600",text:"text-white",icon:e.jsx(X,{className:"w-6 h-6"}),pulse:""};case"info":return{bg:"bg-blue-500",border:"border-blue-600",text:"text-white",icon:e.jsx(ve,{className:"w-6 h-6"}),pulse:""};default:return{bg:"bg-gray-500",border:"border-gray-600",text:"text-white",icon:e.jsx(ve,{className:"w-6 h-6"}),pulse:""}}},L=D=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric"}).format(D);if(!i)return null;const U=_(i.type);return e.jsxs("div",{className:"fixed top-4 right-4 z-[9999]",children:[e.jsxs("div",{className:`
          transform transition-all duration-300 ease-in-out
          ${f?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
          ${U.bg} ${U.border} ${U.text} ${U.pulse}
          border-2 rounded-lg shadow-2xl max-w-md min-w-80
          backdrop-blur-sm
        `,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white border-opacity-20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[U.icon,e.jsxs("h3",{className:"font-bold text-lg",children:[i.type==="urgent"&&"تنبيه عاجل!",i.type==="warning"&&"تحذير",i.type==="info"&&"إشعار"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:p,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",title:h?"إيقاف الصوت":"تشغيل الصوت",children:h?e.jsx(Er,{className:"w-4 h-4"}):e.jsx(_r,{className:"w-4 h-4"})}),e.jsx("button",{onClick:w,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",children:e.jsx(de,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-lg font-medium mb-3",children:i.message}),e.jsxs("div",{className:"space-y-2 text-sm opacity-90",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"المستخدم:"})," ",i.userName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"تاريخ انتهاء الاشتراك:"})," ",L(i.expiryDate)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"الأيام المتبقية:"})," ",i.daysRemaining," يوم"]})]})]}),i.type==="urgent"&&e.jsx("div",{className:"h-1 bg-white bg-opacity-20",children:e.jsx("div",{className:"h-full bg-white animate-pulse",style:{animation:"progress 10s linear forwards"}})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes progress {
          from { width: 100%; }
          to { width: 0%; }
        }
      `})]})},$r=({user:i,onActivateSubscription:n,onRequestActivation:h,onDeactivateSubscription:p,onDeleteUser:f})=>{const[b,m]=l.useState(x.MONTHLY),[A,g]=l.useState(!1),w=va(),_=u=>{const d=u==null?void 0:u.displayName;if(typeof d=="string"&&d.trim())return d.trim();if(d&&typeof d=="object"){const V=d.full_name||d.name||d.ar||d.en;if(typeof V=="string"&&V.trim())return V.trim()}return typeof(u==null?void 0:u.email)=="string"&&u.email.includes("@")?u.email.split("@")[0]:"غير محدد"},L=u=>{switch(u){case x.LIFETIME:return e.jsx(Pe,{className:"w-4 h-4 text-yellow-500"});case x.YEARLY:return e.jsx(re,{className:"w-4 h-4 text-blue-500"});case x.QUARTERLY:return e.jsx(K,{className:"w-4 h-4 text-purple-500"});case x.MONTHLY:return e.jsx(Re,{className:"w-4 h-4 text-green-500"});case x.FIVE_MINUTES:return e.jsx(X,{className:"w-4 h-4 text-orange-500"});case x.ZERO:return e.jsx(Es,{className:"w-4 h-4 text-gray-500"});case x.TAHWEELA:return e.jsx(yt,{className:"w-4 h-4 text-blue-600"});default:return null}},U=u=>{switch(u){case x.MONTHLY:return"شهرية";case x.QUARTERLY:return"ربع سنوية";case x.YEARLY:return"سنوية";case x.LIFETIME:return"مدى الحياة";case x.FIVE_MINUTES:return"5 دقايق";case x.ZERO:return"زيرو";case x.TAHWEELA:return"تحويله";default:return"غير محدد"}},D=u=>{if(!u)return"غير محدد";const d=Ea(u);return d?d.toLocaleDateString("ar-EG"):"تاريخ غير صالح"};return e.jsx(We,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(ze,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Tt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:_(i)}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(Sa,{className:"w-3 h-3 ml-1"}),i.email]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[e.jsx(Ut,{className:"w-3 h-3 ml-1"}),i.phone||"غير محدد"]})]})]}),e.jsx("div",{className:`px-2 py-0.5 rounded-[8px] text-xs font-medium border ${i.isActive?"bg-green-50 text-green-700 border-green-200":"bg-secondary/10 text-secondary border-secondary/20"}`,children:i.isActive?"نشط":"غير نشط"})]}),i.subscription&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[L(i.subscription.planType),e.jsx("span",{className:"text-sm font-medium",children:U(i.subscription.planType)})]}),e.jsx(As,{variant:i.subscription.isActive?"default":"destructive",children:i.subscription.isActive?"مفعل":"منتهي"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(K,{className:"w-3 h-3 ml-1"}),"البداية: ",D(i.subscription.startDate)]}),i.subscription.endDate&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"w-3 h-3 ml-1"}),"النهاية: ",D(i.subscription.endDate)]})]})]}),e.jsxs("div",{className:"space-y-3",children:[n&&A&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"اختر نوع الباقة:"}),w?e.jsxs("select",{className:"w-full h-10 border border-input bg-background rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring",value:b,onChange:u=>m(u.target.value),children:[e.jsx("option",{value:x.MONTHLY,children:"شهرية"}),e.jsx("option",{value:x.QUARTERLY,children:"ربع سنوية"}),e.jsx("option",{value:x.YEARLY,children:"سنوية"}),e.jsx("option",{value:x.LIFETIME,children:"مدى الحياة"}),e.jsx("option",{value:x.FIVE_MINUTES,children:"5 دقايق"}),e.jsx("option",{value:x.ZERO,children:"زيرو"}),e.jsx("option",{value:x.TAHWEELA,children:"تحويله"})]}):e.jsxs(cr,{value:b,onValueChange:u=>m(u),children:[e.jsx(or,{className:"w-full",children:e.jsx(dr,{placeholder:"اختر نوع الباقة"})}),e.jsxs(mr,{children:[e.jsx(ce,{value:x.MONTHLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"شهرية"})]})}),e.jsx(ce,{value:x.QUARTERLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"ربع سنوية"})]})}),e.jsx(ce,{value:x.YEARLY,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"سنوية"})]})}),e.jsx(ce,{value:x.LIFETIME,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(fr,{className:"w-4 h-4"}),e.jsx("span",{children:"مدى الحياة"})]})}),e.jsx(ce,{value:x.FIVE_MINUTES,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"5 دقايق"})]})}),e.jsx(ce,{value:x.ZERO,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(Es,{className:"w-4 h-4"}),e.jsx("span",{children:"زيرو"})]})}),e.jsx(ce,{value:x.TAHWEELA,children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(yt,{className:"w-4 h-4"}),e.jsx("span",{children:"تحويله"})]})})]})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsx(Z,{size:"sm",onClick:()=>{n(i.id,b),g(!1)},className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:"تأكيد التفعيل"}),e.jsx(Z,{size:"sm",variant:"outline",onClick:()=>g(!1),className:"flex-1",children:"إلغاء"})]})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[(n||h)&&!A&&e.jsx(Z,{size:"sm",variant:"outline",onClick:()=>h?h(i):g(!0),className:"flex-1",children:"تفعيل الاشتراك"}),p&&e.jsx(Z,{size:"sm",variant:"outline",onClick:()=>p(i.id),className:"flex-1",children:"إلغاء الاشتراك"}),f&&e.jsx(Z,{size:"sm",variant:"destructive",onClick:()=>f(i.id),children:e.jsx(ka,{className:"w-4 h-4"})})]})]})]})})},Br=Ze.memo($r),Hr=[{id:x.MONTHLY,name:"شهرية",icon:Re,color:"text-green-600",bg:"bg-green-50",border:"border-green-200"},{id:x.QUARTERLY,name:"ربع سنوية",icon:K,color:"text-purple-600",bg:"bg-purple-50",border:"border-purple-200"},{id:x.YEARLY,name:"سنوية",icon:re,color:"text-blue-600",bg:"bg-blue-50",border:"border-blue-200"},{id:x.LIFETIME,name:"مدى الحياة",icon:Pe,color:"text-yellow-600",bg:"bg-yellow-50",border:"border-yellow-200"},{id:x.FIVE_MINUTES,name:"5 دقايق",icon:X,color:"text-orange-600",bg:"bg-orange-50",border:"border-orange-200"},{id:x.ZERO,name:"زيرو",icon:Es,color:"text-gray-600",bg:"bg-gray-50",border:"border-gray-200"},{id:x.TAHWEELA,name:"تحويله",icon:Le,color:"text-indigo-600",bg:"bg-indigo-50",border:"border-indigo-200"}],qr={[x.MONTHLY]:{from:"from-blue-50",to:"to-indigo-50",ring:"ring-blue-300"},[x.QUARTERLY]:{from:"from-purple-50",to:"to-pink-50",ring:"ring-purple-300"},[x.YEARLY]:{from:"from-sky-50",to:"to-blue-50",ring:"ring-blue-300"},[x.LIFETIME]:{from:"from-yellow-50",to:"to-amber-50",ring:"ring-amber-300"},[x.FIVE_MINUTES]:{from:"from-orange-50",to:"to-red-50",ring:"ring-orange-300"},[x.ZERO]:{from:"from-gray-50",to:"to-slate-100",ring:"ring-gray-300"},[x.TAHWEELA]:{from:"from-indigo-50",to:"to-violet-50",ring:"ring-indigo-300"}},Yr=i=>{const n=i==null?void 0:i.displayName;if(typeof n=="string"&&n.trim())return n.trim();if(n&&typeof n=="object"){const h=n.full_name||n.name||n.ar||n.en;if(typeof h=="string"&&h.trim())return h.trim()}return typeof(i==null?void 0:i.email)=="string"&&i.email.includes("@")?i.email.split("@")[0]:"مستخدم"},Wr=({isOpen:i,onClose:n,user:h,onActivate:p})=>{const[f,b]=l.useState(x.MONTHLY),[m,A]=l.useState(!1);Ze.useEffect(()=>{i&&(b(x.MONTHLY),A(!1))},[i,h]);const g=async()=>{if(!m){A(!0);try{await p(h.id,f)}catch(w){console.error("Activation failed",w),A(!1)}}};return!i||!h?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 transition-opacity duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-xl shadow-xl transform transition-all flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(Re,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800",children:"تفعيل اشتراك جديد"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["للمستخدم: ",Yr(h)]})]})]}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-100 p-1",children:e.jsx(de,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Hr.map(w=>{const _=qr[w.id],L=f===w.id;return e.jsxs("div",{onClick:()=>b(w.id),className:`rounded-xl p-4 border shadow-sm bg-gradient-to-br ${_.from} ${_.to} cursor-pointer transition-all ${L?`ring-2 ${_.ring}`:"hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/70 flex items-center justify-center",children:e.jsx(w.icon,{className:`w-5 h-5 ${w.color}`})}),L&&e.jsx(Fe,{className:`w-5 h-5 ${w.color}`})]}),e.jsx("div",{className:"font-bold text-gray-800",children:w.name}),L&&e.jsx("div",{className:`text-xs font-medium ${w.color}`,children:"تم الاختيار"})]},w.id)})})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 bg-gray-50 rounded-b-xl border-t border-gray-100 flex-shrink-0",children:[e.jsx("button",{onClick:n,disabled:m,className:"px-5 py-2.5 rounded-lg border border-gray-300 bg-white text-gray-700 font-medium hover:bg-gray-50 focus:ring-2 focus:ring-gray-200 transition-all disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{onClick:g,disabled:m,className:"px-5 py-2.5 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 shadow-lg shadow-blue-600/20 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[m?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(Fe,{className:"w-5 h-5"}),m?"جاري التفعيل...":"تفعيل الاشتراك"]})]})]})})},zr={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_VERSION:"0.0.0",VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"false",VITE_FIREBASE_API_KEY:["AI","za","SyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s"].join(""),VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_AUTH_EMULATOR_URL:"http://localhost:9099",VITE_FIREBASE_FIRESTORE_EMULATOR_HOST:"localhost:8080",VITE_FIREBASE_FUNCTIONS_EMULATOR_HOST:"localhost:5001",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.appspot.com",VITE_FORCE_HASH_ROUTER:"true",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"محل كاشي لينك التجريبي",VITE_SHOW_ENV_BANNER:"true",VITE_USE_EMULATORS:"false",VITE_USE_FIREBASE_EMULATOR:"false"},Gr=({navigate:i,auth:n,devMode:h,setDevMode:p,error:f,setError:b,authLoading:m,setAuthLoading:A,activeTab:g,setActiveTab:w,setNotificationCenterOpen:_,setNotificationSettings:L,setNotifications:U,notificationCount:D,setNotificationCount:u,users:d,setUsers:V,loading:P,setLoading:y,setEditingPlan:me,isSavingContent:ke,setIsSavingContent:S,lastUpdateInfo:T,loadContentFromFirebase:H,saveContentToFirebase:xe,refreshData:q})=>{var jt;const[z,Ee]=l.useState(!0),[le,ue]=l.useState(d||[]),[O,ge]=l.useState(""),[v,F]=l.useState(null),[ee,Y]=l.useState({}),[Ae,W]=l.useState(!1),[E,_s]=l.useState(null),[ae,se]=l.useState({name:"",price:"",period:"",description:"",features:[]}),[It,Ts]=l.useState(!1),[Qr,Zr]=l.useState(!1),[Kr,Xr]=l.useState(null),[Jr,el]=l.useState(!1),[Lt,Pt]=l.useState({sound:!0}),[Ft,sl]=l.useState(!1),[Rt,Mt]=l.useState(null),[Me,Vt]=l.useState([]),[Ve,Cs]=l.useState(!1),[tl,al]=l.useState(void 0),[rl,ll]=l.useState(""),[nl,il]=l.useState(null),[cl,ol]=l.useState(!1),Ds=Me.filter(s=>!((s==null?void 0:s.contacted)===!0||(s==null?void 0:s.status)==="contacted")),Oe=Me.filter(s=>(s==null?void 0:s.contacted)===!0||(s==null?void 0:s.status)==="contacted"),[dl,ml]=l.useState(""),[xl,ul]=l.useState(""),[gl,hl]=l.useState(""),[pl,bl]=l.useState(""),[fl,jl]=l.useState(!1),[yl,Nl]=l.useState(!1),Ot=async s=>{try{await Pa(Ye(Q,"waiting_list",s),{contacted:!0,status:"contacted",contactedAt:Fa()})}catch(t){console.error("Failed to mark waiting item as contacted",t),alert("حدث خطأ أثناء تحديث الحالة إلى تم التواصل.")}},[N,ne]=l.useState({}),[Xe,$t]=l.useState(null),[Je,Bt]=l.useState(null),[es,Ht]=l.useState(null),[Us,Is]=l.useState(!1),[Ls,Ps]=l.useState(!1),[Fs,Rs]=l.useState(!1),[he,Ms]=l.useState(""),[_e,qt]=l.useState(""),[Te,Yt]=l.useState(""),[Wt,ss]=l.useState(0),[zt,ts]=l.useState(0),[Gt,as]=l.useState(0),[$e,rs]=l.useState(""),[ls,Vs]=l.useState(""),[ns,Os]=l.useState(""),[$s,Bs]=l.useState(""),[Hs,qs]=l.useState(""),[Ys,Ws]=l.useState(""),[Be,zs]=l.useState(""),[Gs,Qs]=l.useState(""),[Zs,Ks]=l.useState(!1);l.useEffect(()=>{(async()=>{try{const{systemSettingsService:s}=await C(async()=>{const{systemSettingsService:a}=await import("./index-DvnSb1Lh.js").then(r=>r.c5);return{systemSettingsService:a}},__vite__mapDeps([0,1]),import.meta.url),t=await s.getTelegramWorkerUrl();t&&Qs(t)}catch{}})()},[]);const[Xs,Qt]=l.useState(!1),[He,ie]=l.useState("idle"),[Js,pe]=l.useState(""),[is,et]=l.useState(""),[cs,st]=l.useState(!1),[os,be]=l.useState("idle"),[Zt,Ce]=l.useState(""),[wl,vl]=l.useState(!1),[Sl,kl]=l.useState(null),[El,Al]=l.useState("monthly"),[Kt,ds]=l.useState(!1),[Xt,Jt]=l.useState(null),[_l,ea]=l.useState(x.MONTHLY),[ms,sa]=l.useState("");l.useEffect(()=>{const s=Aa(t=>{Bs(String((t==null?void 0:t.version)||"")),qs(String((t==null?void 0:t.downloadURL_64)||"")),Ws(String((t==null?void 0:t.downloadURL_32)||"")),zs(String((t==null?void 0:t.notes)||""))});return()=>{try{s()}catch{}}},[]),l.useEffect(()=>{const s=_a(t=>{Ms(String((t==null?void 0:t.version)||"")),rs(String((t==null?void 0:t.url)||"")),et(String((t==null?void 0:t.notes)||"")),st(!!(t!=null&&t.force))});return()=>{try{s()}catch{}}},[]);const ta=async()=>{var r;if(pe(""),!(n!=null&&n.currentUser)){ie("error"),pe("يرجى تسجيل الدخول كأدمن قبل النشر");try{alert("يرجى تسجيل الدخول كأدمن قبل النشر")}catch{}return}const s=$s.trim(),t=Hs.trim(),a=Ys.trim();if(!s){ie("error"),pe("رقم الإصدار مطلوب");return}try{new URL(t)}catch{ie("error"),pe("رابط 64-بت غير صالح (يجب أن يكون https://)");return}try{new URL(a)}catch{ie("error"),pe("رابط 32-بت غير صالح (يجب أن يكون https://)");return}try{ie("publishing");const o=typeof window<"u"&&(window.electronAPI||typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("electron"));let c="";if(await $a({version:s,downloadURL_64:t,downloadURL_32:a,notes:Be.trim()},n.currentUser.uid),o&&((r=window.electronAPI)!=null&&r.publishDesktopVersion)){const j=await n.currentUser.getIdToken(),k={version:s,updateUrl64:t,updateUrli32:a,notes:Be.trim(),force:!!Xs};c=await window.electronAPI.publishDesktopVersion(j,k)}else c="";ie("done");try{localStorage.setItem("desktop_update_cache",JSON.stringify({version:s,downloadURL_64:t,downloadURL_32:a,notes:Be.trim()}))}catch{}}catch(o){ie("error");const c=(o==null?void 0:o.message)||"فشل النشر: تأكد من الصلاحيات وحالة الاتصال";pe(c);try{alert(c)}catch{}}},De=s=>{const t=s==null?void 0:s.displayName;let a="";typeof t=="string"?a=t:t&&typeof t=="object"&&(a=(t.ar||t.en||"").toString()),!a&&typeof(s==null?void 0:s.email)=="string"&&(a=s.email);const r=String(a).trim().charAt(0);return r?r.toUpperCase():"؟"},te=s=>{const t=s==null?void 0:s.displayName;if(typeof t=="string"&&t.trim())return t.trim();if(t&&typeof t=="object"){const a=t.full_name||t.name||t.ar||t.en;if(typeof a=="string"&&a.trim())return a.trim()}return typeof(s==null?void 0:s.email)=="string"&&s.email.includes("@")?s.email.split("@")[0]:"غير محدد"},[xs,tt]=l.useState(""),[us,at]=l.useState(""),[rt,lt]=l.useState(""),[gs,nt]=l.useState(""),[it,ct]=l.useState(!1),[fe,hs]=l.useState(""),[$,ot]=l.useState(24),[dt,mt]=l.useState("24"),[xt,ut]=l.useState(!1),[Tl,gt]=l.useState(!1),[je,ps]=l.useState("active");l.useEffect(()=>{if(O){const s=O.toLowerCase(),t=d.filter(a=>(a.displayName||"").toLowerCase().includes(s)||(a.email||"").toLowerCase().includes(s)||(a.phone||"").includes(s));ue(t)}else ue(d)},[d,O]),l.useEffect(()=>{g==="trials"&&(async()=>{try{gt(!0);const{FreeTrialService:s}=await C(async()=>{const{FreeTrialService:a}=await import("./freeTrialService-ag8hxyeR.js");return{FreeTrialService:a}},__vite__mapDeps([2,0,1]),import.meta.url),t=await s.getTrialDurationHours();ot(t),mt(String(t))}catch(s){console.error("Failed to load trial duration",s)}finally{gt(!1)}})()},[g]),l.useEffect(()=>{g==="application"&&(async()=>{try{const{getAppDownloads:s}=await C(async()=>{const{getAppDownloads:a}=await import("./index-DvnSb1Lh.js").then(r=>r.c7);return{getAppDownloads:a}},__vite__mapDeps([0,1]),import.meta.url),t=await s();ne(t||{}),rs((t==null?void 0:t.androidUrl)||""),Vs((t==null?void 0:t.pcUrl)||""),Os((t==null?void 0:t.pc32Url)||"")}catch(s){console.error("Failed to load app downloads",s)}})()},[g]);const ht=async()=>{Cs(!0);try{const s=Se(oe(Q,"waiting_list")),a=(await Ie(s)).docs.map(r=>({id:r.id,...r.data()})).sort((r,o)=>{var k,I,R,M,B,G;const c=((I=(k=r==null?void 0:r.createdAt)==null?void 0:k.toMillis)==null?void 0:I.call(k))??((R=r==null?void 0:r.createdAt)==null?void 0:R.seconds)*1e3??0;return(((B=(M=o==null?void 0:o.createdAt)==null?void 0:M.toMillis)==null?void 0:B.call(M))??((G=o==null?void 0:o.createdAt)==null?void 0:G.seconds)*1e3??0)-c});Vt(a)}catch(s){console.error("Failed to fetch waiting_list:",s)}finally{Cs(!1)}};l.useEffect(()=>{g==="waitingList"&&ht()},[g]),l.useEffect(()=>{},[g]);const aa=async()=>{var s;if(!xs.trim()||!us.trim()){alert("يرجى كتابة عنوان ورسالة الإشعار");return}try{ct(!0);const t=gs.trim()?`user:${gs.trim()}`:"global";await ir({title:xs.trim(),message:us.trim(),audienceKey:t,createdBy:(s=n==null?void 0:n.currentUser)==null?void 0:s.uid,linkUrl:rt.trim()||void 0}),tt(""),at(""),lt(""),nt(""),alert("تم إرسال الإشعار بنجاح!")}catch(t){console.error("خطأ في إرسال الإشعار:",t),alert("حدث خطأ أثناء إرسال الإشعار")}finally{ct(!1)}},ra=()=>{n!=null&&n.signOut&&n.signOut(),i("/admin/login")},la=Ze.useCallback(s=>{Jt(s),ea(x.MONTHLY),ds(!0)},[]),pt=Ze.useCallback(async(s,t,a=null)=>{var r;try{console.log("Activating subscription for user:",s,"with plan:",t,"and variant:",a);const o=((r=n==null?void 0:n.currentUser)==null?void 0:r.uid)||"admin-user-id";await Ta(s,t,o,a),console.log("✅ تم تفعيل الاشتراك بنجاح"),q&&q()}catch(o){console.error("❌ خطأ في تفعيل الاشتراك:",o),alert("حدث خطأ في تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},[n]),bt=async s=>{try{console.log("Deactivating subscription for user:",s),await Oa(s),console.log("✅ تم إلغاء تفعيل الاشتراك بنجاح"),q&&q()}catch(t){console.error("❌ خطأ في إلغاء تفعيل الاشتراك:",t),alert("حدث خطأ في إلغاء تفعيل الاشتراك. يرجى المحاولة مرة أخرى.")}},na=async s=>{var t;try{if(!window.confirm(`هل أنت متأكد من حذف هذا المستخدم نهائياً؟

سيتم حذف:
- حساب المستخدم
- جميع بياناته
- اشتراكه
- معاملاته
- محادثاته

هذا الإجراء لا يمكن التراجع عنه!`))return;console.log("بدء حذف المستخدم:",s);const r=((t=n==null?void 0:n.currentUser)==null?void 0:t.uid)||"unknown-admin";try{const c=await Ra(Ma,"deleteUserPermanently")({userId:s});console.log("استجابة دالة الحذف النهائي:",c),V(j=>j.filter(k=>k.id!==s)),ue(j=>j.filter(k=>k.id!==s)),alert("تم حذف المستخدم نهائياً مع جميع بياناته وحساب المصادقة.");return}catch(o){console.warn("تعذر تنفيذ الحذف النهائي عبر Cloud Functions، سيتم استخدام الحذف المحلي المؤقت:",(o==null?void 0:o.message)||o)}{const o=[];try{await Ue(Ye(Q,"profiles",s)),console.log("تم حذف الملف الشخصي")}catch(c){console.error("خطأ في حذف الملف الشخصي:",c),o.push(`الملف الشخصي: ${(c==null?void 0:c.message)||c}`)}try{await Ue(Ye(Q,"users",s)),console.log("تم حذف وثيقة المستخدم من مجموعة users")}catch(c){console.error("خطأ في حذف وثيقة المستخدم من مجموعة users:",c),o.push(`users: ${(c==null?void 0:c.message)||c}`)}try{const c=Se(oe(Q,"transactions"),ks("userId","==",s)),j=await Ie(c),k=j.docs.map(M=>Ue(M.ref)),I=await Promise.allSettled(k),R=I.filter(M=>M.status==="rejected");R.length?(console.warn("فشل حذف بعض المعاملات:",R.length),o.push(`المعاملات: فشل حذف ${R.length} من أصل ${I.length}`)):console.log(`تم حذف ${j.size} معاملة`)}catch(c){console.error("خطأ في جلب/حذف المعاملات:",c),o.push(`المعاملات: ${(c==null?void 0:c.message)||c}`)}try{const c=Se(oe(Q,"chatRooms"),ks("participants","array-contains",s)),j=await Ie(c),k=j.docs.map(async I=>{try{const M=(await Ie(oe(I.ref,"messages"))).docs.map(B=>Ue(B.ref));await Promise.allSettled(M),await Ue(I.ref)}catch(R){console.error("فشل حذف محادثة/رسائل:",R),o.push(`المحادثات: ${I.id}`)}});await Promise.all(k),console.log(`تم إنهاء معالجة ${j.size} محادثة`)}catch(c){console.error("خطأ في جلب/حذف المحادثات:",c),o.push(`المحادثات: ${(c==null?void 0:c.message)||c}`)}try{await Va(Ye(Q,"deletedUsers",s),{deletedAt:new Date,deletedBy:r,reason:"حذف نهائي من لوحة الإدارة"})}catch(c){console.error("خطأ في تسجيل المستخدم كمحذوف:",c),o.push(`deletedUsers: ${(c==null?void 0:c.message)||c}`)}V(c=>c.filter(j=>j.id!==s)),ue(c=>c.filter(j=>j.id!==s)),o.length===0?alert("تم حذف بيانات المستخدم محلياً بنجاح. ملاحظة: حساب المصادقة لم يُحذف."):alert(`تم حذف المستخدم مع ملاحظات:
- ${o.join(`
- `)}

بعض الموارد قد لم تُحذف بالكامل. يمكنك إعادة المحاولة لاحقًا.`)}}catch(a){console.error("❌ خطأ في حذف المستخدم:",a),alert(`حدث خطأ في حذف المستخدم: ${a.message||"خطأ غير معروف"}`)}};l.useEffect(()=>{(async()=>{try{if(typeof H=="function"){const t=await H();t&&(t.monthly||t.yearly||t.lifetime)&&Y(t)}}catch(t){console.warn("Failed to load content data:",t)}})()},[]);const ia=async()=>{var s;try{if(typeof xe!="function")return;S(!0);const t=((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin-user-id";await xe(ee,t),alert("تم حفظ جميع التغييرات بنجاح")}catch(t){console.error("❌ خطأ في حفظ المحتوى:",t),alert(`فشل في حفظ المحتوى: ${(t==null?void 0:t.message)||"خطأ غير معروف"}`)}finally{S(!1)}},qe=(s,t,a)=>{Y(r=>({...r,[s]:{...(r==null?void 0:r[s])||{},[t]:a}}))},ca=s=>{Y(t=>{var a;return{...t,[s]:{...(t==null?void 0:t[s])||{},features:[...((a=t==null?void 0:t[s])==null?void 0:a.features)||[],""]}}})},oa=(s,t,a)=>{Y(r=>{var c;const o=[...((c=r==null?void 0:r[s])==null?void 0:c.features)||[]];return o[t]=a,{...r,[s]:{...(r==null?void 0:r[s])||{},features:o}}})},da=(s,t)=>{Y(a=>{var o;const r=[...((o=a==null?void 0:a[s])==null?void 0:o.features)||[]];return r.splice(t,1),{...a,[s]:{...(a==null?void 0:a[s])||{},features:r}}})},ma=()=>{Pt(s=>({...s,sound:!s.sound}))},xa=()=>{Mt(null)},ua=async()=>{try{const s=Number(dt);if(isNaN(s)||s<1){alert("يرجى إدخال مدة صحيحة بالساعات");return}ut(!0);const{FreeTrialService:t}=await C(async()=>{const{FreeTrialService:r}=await import("./freeTrialService-ag8hxyeR.js");return{FreeTrialService:r}},__vite__mapDeps([2,0,1]),import.meta.url),a=await t.updateTrialDurationHours(s);a.success?(ot(s),alert(a.message)):alert(a.message||"فشل تحديث مدة التجربة")}catch(s){console.error("Error updating trial duration:",s),alert("حدث خطأ أثناء تحديث مدة التجربة")}finally{ut(!1)}},ft=async s=>{try{const{FreeTrialService:t}=await C(async()=>{const{FreeTrialService:r}=await import("./freeTrialService-ag8hxyeR.js");return{FreeTrialService:r}},__vite__mapDeps([2,0,1]),import.meta.url),a=await t.startFreeTrialFromAdmin(s);alert(a.message||`تم تفعيل التجربة المجانية لمدة ${$} ${$>=3&&$<=10?"ساعات":$===2?"ساعتين":"ساعة"}`),q&&q()}catch(t){console.error("Error activating free trial:",t),alert("حدث خطأ أثناء تفعيل التجربة المجانية. يرجى المحاولة مرة أخرى.")}},ga=async s=>{try{const{FreeTrialService:t}=await C(async()=>{const{FreeTrialService:r}=await import("./freeTrialService-ag8hxyeR.js");return{FreeTrialService:r}},__vite__mapDeps([2,0,1]),import.meta.url),a=await t.cancelActiveFreeTrial(s);q&&q()}catch(t){console.error("Error cancelling free trial:",t)}},ha=async s=>{try{const{FreeTrialService:t}=await C(async()=>{const{FreeTrialService:r}=await import("./freeTrialService-ag8hxyeR.js");return{FreeTrialService:r}},__vite__mapDeps([2,0,1]),import.meta.url),a=await t.resetActiveTrialToCurrentDuration(s);alert(a.message)}catch(t){console.error("Error resetting user trial end:",t),alert("حدث خطأ أثناء تحديث نهاية التجربة.")}},pa=(s,t)=>{console.log("Toggling user status:",s,t)},bs=s=>s?(s.toDate?s.toDate():new Date(s)).toLocaleDateString("ar-EG",{year:"numeric",month:"2-digit",day:"2-digit"}):"غير محدد",ba=[{id:"users",label:"المستخدمين",icon:Ns},{id:"subscriptions",label:"مواعيد الاشتراكات",icon:K},{id:"trials",label:"إدارة التجارب المجانية",icon:re},{id:"content",label:"إدارة المحتوى",icon:Da},{id:"application",label:"التطبيق",icon:ws},{id:"whatsapp",label:"إدارة الواتساب",icon:Ge},{id:"branches",label:"باقات الفروع",icon:Et},{id:"analytics",label:"الإحصائيات",icon:vt}];return m?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري التحقق من المصادقة..."}),!1]})}):f?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"حدث خطأ في لوحة التحكم"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-700 text-sm font-medium",children:f})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{b(null),i("/admin/login")},className:"w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"🔑 العودة لتسجيل الدخول"}),!1,e.jsx("button",{onClick:()=>{console.log("🔍 Current error details:",f),console.log("🔍 Auth state:",n.currentUser),console.log("🔍 Dev mode:",h),console.log("🔍 Environment:",zr)},className:"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:"🐛 طباعة تفاصيل الخطأ في وحدة التحكم"})]})]})}):!h&&!n.currentUser?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"لوحة تحكم المدير"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"يجب تسجيل الدخول للوصول إلى لوحة التحكم"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>i("/admin/login"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"🔑 تسجيل الدخول"}),!1]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col md:flex-row overflow-x-hidden",children:[e.jsxs("div",{className:`bg-white shadow-lg transition-all duration-300 flex flex-col z-40 ${z?"translate-x-0 w-64 md:w-64":"translate-x-full w-64 md:w-16 md:translate-x-0"} fixed inset-y-0 right-0 md:static md:inset-auto`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[z&&e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Ca,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"لوحة الإدارة"}),e.jsx("p",{className:"text-sm text-gray-500",children:"نظام التحكم"})]})]}),e.jsx("button",{onClick:()=>Ee(!z),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:z?e.jsx(de,{className:"w-5 h-5"}):e.jsx(yr,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4",children:e.jsx("ul",{className:"space-y-2",children:ba.map(s=>{const t=s.icon;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>{if(s.id==="externalNotifications"){i("/admin/notifications");return}w(s.id)},className:`w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg transition-colors ${g===s.id?"bg-gradient-to-r from-purple-600 to-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(t,{className:"w-5 h-5"}),z&&e.jsx("span",{className:"font-medium",children:s.label})]})},s.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:ra,className:"w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(Ua,{className:"w-5 h-5"}),z&&e.jsx("span",{className:"font-medium",children:"تسجيل الخروج"})]})})]}),z&&e.jsx("div",{className:"fixed inset-0 bg-black/30 md:hidden",onClick:()=>Ee(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[!z&&e.jsx("button",{className:"md:hidden p-2 rounded-lg hover:bg-gray-100",onClick:()=>Ee(!0),"aria-label":"فتح القائمة",children:e.jsx(Nt,{className:"w-5 h-5"})}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[g==="users"&&"إدارة المستخدمين",g==="waitingList"&&"قائمة الانتظار",g==="subscriptions"&&"مواعيد الاشتراكات",g==="trials"&&"إدارة التجارب المجانية",g==="application"&&"إدارة التطبيق",g==="analytics"&&"الإحصائيات",g==="branches"&&"باقات الفروع"]}),h&&e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full",children:"🔧 وضع التطوير"})]}),e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["مرحباً، ",h?"المطور":"المدير"]}),e.jsx(Qa,{})]})]})}),e.jsxs("main",{className:"flex-1 p-3 sm:p-4 md:p-6 max-w-full overflow-x-hidden",children:[g==="waitingList"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"طلبات قائمة الانتظار"}),e.jsx("button",{onClick:ht,className:"p-1.5 text-gray-500 hover:bg-gray-100 rounded-full transition-colors",title:"تحديث القائمة",disabled:Ve,children:e.jsx(Le,{className:`w-4 h-4 ${Ve?"animate-spin":""}`})})]}),e.jsx("div",{className:"text-sm text-gray-500 flex items-center gap-3",children:Ve?"جاري التحميل...":e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["إجمالي: ",Me.length]}),e.jsxs("span",{className:"text-red-600",children:["قيد الانتظار: ",Ds.length]}),e.jsxs("span",{className:"text-green-600",children:["تم التواصل: ",Oe.length]})]})})]}),e.jsx("div",{className:"overflow-x-auto",children:Ve?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل الطلبات..."})]}):Me.length===0?e.jsx("div",{className:"p-8 text-center text-gray-600",children:"لا توجد طلبات في قائمة الانتظار حالياً"}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الاسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"المعرف"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"سبب الطلب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"رقم الواتساب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الإجراء"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ الإنشاء"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ds.map(s=>{var j;const t=(s.phone||"").toString(),a=t.replace(/\D/g,"");let r=null;const o="مرحباً، طلبت التحدث معنا. كيف نساعدك؟";try{Dt(t)&&(r=Ct(t,o))}catch{r=null}const c=(j=s.createdAt)!=null&&j.toDate?s.createdAt.toDate():s.createdAt?new Date(s.createdAt):null;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800",children:s.name||"غير محدد"}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500",children:s.userId||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:s.reason||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:a||"—"}),e.jsxs("td",{className:"px-4 py-3 flex items-center gap-2",children:[r?e.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",children:e.jsx("button",{className:"px-3 py-1.5 rounded-md bg-green-600 text-white text-sm hover:bg-green-700",children:"واتساب"})}):e.jsx("span",{className:"text-xs text-gray-400",children:"لا يوجد رقم"}),e.jsx("button",{className:"px-3 py-1.5 rounded-md bg-indigo-600 text-white text-sm hover:bg-indigo-700",onClick:()=>Ot(s.id),title:"تمييز كتم التواصل",children:"تم التواصل"})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:c?c.toLocaleString("ar-EG"):"غير محدد"})]},s.id)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"تم التواصل"}),e.jsx("div",{className:"text-sm text-gray-500",children:Oe.length})]}),e.jsx("div",{className:"overflow-x-auto",children:Oe.length===0?e.jsx("div",{className:"p-8 text-center text-gray-600",children:"لا يوجد عناصر في قسم تم التواصل"}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الاسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"المعرف"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"سبب الطلب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"رقم الواتساب"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"الحالة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"تاريخ التواصل"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Oe.map(s=>{var o;const a=(s.phone||"").toString().replace(/\D/g,""),r=(o=s.contactedAt)!=null&&o.toDate?s.contactedAt.toDate():s.contactedAt?new Date(s.contactedAt):null;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800",children:s.name||"غير محدد"}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500",children:s.userId||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:s.reason||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:a||"—"}),e.jsx("td",{className:"px-4 py-3 text-xs",children:e.jsx("span",{className:"px-2 py-1 rounded-full bg-green-100 text-green-700",children:"تم التواصل"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:r?r.toLocaleString("ar-EG"):"غير محدد"})]},s.id)})})]})})]})]}),g==="users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي المستخدمين"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:d.length})]}),e.jsx(Ns,{className:"w-8 h-8 text-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"معرف المستخدم (اختياري)"}),e.jsx("input",{type:"text",value:gs,onChange:s=>nt(s.target.value),placeholder:"ضع uid الخاص بالمستخدم لاستهداف إشعار شخصي",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"اتركه فارغًا للإرسال العام؛ إن وضعته سيتم إرسال الإشعار لهذا المستخدم فقط."})]})]}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d.filter(s=>s.isActive).length})]}),e.jsx(_t,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المعطلين"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:d.filter(s=>!s.isActive).length})]}),e.jsx(Sr,{className:"w-8 h-8 text-red-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قائمة المستخدمين"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن مستخدم...",value:O,onChange:s=>ge(s.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),O&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",le.length," من أصل ",d.length," مستخدم",O&&e.jsx("button",{onClick:()=>ge(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:P?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):le.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:O?"لا توجد نتائج للبحث":"لا توجد بيانات مستخدمين"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:le.map(s=>e.jsx(Br,{user:s,onActivateSubscription:pt,onRequestActivation:la,onToggleUserStatus:pa,onDeactivateSubscription:bt,onDeleteUser:na},s.id))})})]})]}),g==="application"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ws,{className:"w-5 h-5 text-green-600"})," إدارة تطبيق الأندرويد"]}),(N==null?void 0:N.androidUrl)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["الرابط الحالي: ",e.jsx("a",{href:ye(N.androidUrl),className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:"تنزيل"}),N.androidVersion?` | الإصدار: ${N.androidVersion}`:""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملف APK"}),e.jsx("input",{type:"file",accept:".apk",onChange:s=>{var t;return $t(((t=s.target.files)==null?void 0:t[0])||null)},className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:he,onChange:s=>Ms(s.target.value),placeholder:"مثال: 1.0.3",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:async()=>{var s;if(Xe)try{Is(!0),ss(0);const{uploadAppBinaryResumable:t}=await C(async()=>{const{uploadAppBinaryResumable:r}=await import("./index-DvnSb1Lh.js").then(o=>o.c7);return{uploadAppBinaryResumable:r}},__vite__mapDeps([0,1]),import.meta.url),a=await t(Xe,"android",((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin",he||void 0,r=>ss(r),3e5);ne(r=>({...r,androidUrl:a,androidVersion:he||r.androidVersion}))}catch(t){console.error("Android upload failed",t),alert(t!=null&&t.message?`فشل رفع تطبيق الأندرويد: ${t.message}`:"فشل رفع تطبيق الأندرويد")}finally{Is(!1),ss(0)}},disabled:Us||!Xe,className:"w-full sm:w-auto flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50",children:[e.jsx(Ss,{className:"w-4 h-4"}),Us?`جاري الرفع... ${Wt}%`:"رفع تطبيق الأندرويد"]}),(N==null?void 0:N.androidUrl)&&e.jsxs("a",{href:ye(N.androidUrl),className:"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(vs,{className:"w-4 h-4"})," تنزيل الحالي"]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط مباشر لتطبيق الأندرويد (APK)"}),e.jsx("input",{type:"url",value:$e,onChange:s=>rs(s.target.value),placeholder:"https://example.com/app-release.apk",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:e.jsxs("button",{onClick:async()=>{var s;try{const{setAppDownloadLinks:t}=await C(async()=>{const{setAppDownloadLinks:a}=await import("./index-DvnSb1Lh.js").then(r=>r.c7);return{setAppDownloadLinks:a}},__vite__mapDeps([0,1]),import.meta.url);await t({androidUrl:$e||void 0,androidVersion:he||void 0},((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin"),ne(a=>({...a,androidUrl:$e||void 0,androidVersion:he||(a==null?void 0:a.androidVersion)})),alert("تم حفظ رابط الأندرويد بنجاح")}catch(t){console.error("Failed to save android link",t),alert(t!=null&&t.message?`فشل حفظ الرابط: ${t.message}`:"فشل حفظ الرابط")}},className:"w-full sm:w-auto flex items-center gap-2 bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700",children:[e.jsx(we,{className:"w-4 h-4"})," حفظ الرابط"]})})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملاحظات الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:is,onChange:s=>et(s.target.value),placeholder:"مثال: إصلاحات وتحسينات",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:cs,onChange:s=>st(s.target.checked)}),"تحديث إجباري"]})})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("button",{onClick:async()=>{if(Ce(""),!(n!=null&&n.currentUser)){be("error"),Ce("يرجى تسجيل الدخول كأدمن قبل النشر");try{alert("يرجى تسجيل الدخول كأدمن قبل النشر")}catch{}return}const s=he.trim(),t=$e.trim();if(!s){be("error"),Ce("رقم الإصدار مطلوب");return}try{new URL(t)}catch{be("error"),Ce("رابط APK غير صالح (يجب أن يكون https://)");return}try{be("publishing"),await Ia({version:s,url:t,notes:is.trim(),force:!!cs},n.currentUser.uid),be("done");try{localStorage.setItem("android_update_cache",JSON.stringify({version:s,url:t,notes:is.trim(),force:!!cs}))}catch{}alert("تم حفظ تحديث الأندرويد في قاعدة البيانات")}catch(a){be("error");const r=(a==null?void 0:a.message)||"فشل النشر: تأكد من الصلاحيات وحالة الاتصال";Ce(r);try{alert(r)}catch{}}},className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"نشر تحديث الأندرويد"}),os==="publishing"&&e.jsx("span",{className:"text-sm text-gray-600",children:"جاري النشر..."}),os==="error"&&e.jsx("span",{className:"text-sm text-red-600",children:Zt}),os==="done"&&e.jsx("span",{className:"text-sm text-green-600",children:"تم النشر"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(kt,{className:"w-5 h-5 text-indigo-600"})," إدارة تطبيق الكمبيوتر (Windows) — 64 بت"]}),(N==null?void 0:N.pcUrl)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["الرابط الحالي: ",e.jsx("a",{href:ye(N.pcUrl),className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:"تنزيل"}),N.pcVersion?` | الإصدار: ${N.pcVersion}`:""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملف التطبيق (EXE/ZIP)"}),e.jsx("input",{type:"file",accept:".exe,.zip",onChange:s=>{var t;return Bt(((t=s.target.files)==null?void 0:t[0])||null)},className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:_e,onChange:s=>qt(s.target.value),placeholder:"مثال: 2.1.0",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:async()=>{var s;if(Je)try{Ps(!0),ts(0);const{uploadAppBinaryResumable:t}=await C(async()=>{const{uploadAppBinaryResumable:r}=await import("./index-DvnSb1Lh.js").then(o=>o.c7);return{uploadAppBinaryResumable:r}},__vite__mapDeps([0,1]),import.meta.url),a=await t(Je,"pc",((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin",_e||void 0,r=>ts(r),3e5);ne(r=>({...r,pcUrl:a,pcVersion:_e||r.pcVersion}))}catch(t){console.error("PC upload failed",t),alert(t!=null&&t.message?`فشل رفع تطبيق الكمبيوتر: ${t.message}`:"فشل رفع تطبيق الكمبيوتر")}finally{Ps(!1),ts(0)}},disabled:Ls||!Je,className:"w-full sm:w-auto flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:[e.jsx(Ss,{className:"w-4 h-4"}),Ls?`جاري الرفع... ${zt}%`:"رفع تطبيق الكمبيوتر"]}),(N==null?void 0:N.pcUrl)&&e.jsxs("a",{href:ye(N.pcUrl),className:"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(vs,{className:"w-4 h-4"})," تنزيل نسخة 64 بت"]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط مباشر لتطبيق الكمبيوتر (EXE/ZIP)"}),e.jsx("input",{type:"url",value:ls,onChange:s=>Vs(s.target.value),placeholder:"https://example.com/cashy-setup.exe",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:async()=>{var s;try{const{setAppDownloadLinks:t}=await C(async()=>{const{setAppDownloadLinks:a}=await import("./index-DvnSb1Lh.js").then(r=>r.c7);return{setAppDownloadLinks:a}},__vite__mapDeps([0,1]),import.meta.url);await t({pcUrl:ls||void 0,pcVersion:_e||void 0},((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin"),ne(a=>({...a,pcUrl:ls||void 0,pcVersion:_e||(a==null?void 0:a.pcVersion)})),alert("تم حفظ رابط الكمبيوتر بنجاح")}catch(t){console.error("Failed to save pc link",t),alert(t!=null&&t.message?`فشل حفظ الرابط: ${t.message}`:"فشل حفظ الرابط")}},className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700",children:[e.jsx(we,{className:"w-4 h-4"})," حفظ الرابط"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(kt,{className:"w-5 h-5 text-sky-600"})," إدارة تطبيق الكمبيوتر (Windows) — 32 بت"]}),(N==null?void 0:N.pc32Url)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["الرابط الحالي: ",e.jsx("a",{href:ye(N.pc32Url),className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:"تنزيل"}),N.pc32Version?` | الإصدار: ${N.pc32Version}`:""]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملف التطبيق (EXE/ZIP)"}),e.jsx("input",{type:"file",accept:".exe,.zip",onChange:s=>{var t;return Ht(((t=s.target.files)==null?void 0:t[0])||null)},className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار (اختياري)"}),e.jsx("input",{type:"text",value:Te,onChange:s=>Yt(s.target.value),placeholder:"مثال: 2.1.0",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:async()=>{var s;if(es)try{Rs(!0),as(0);const{uploadAppBinaryResumable:t}=await C(async()=>{const{uploadAppBinaryResumable:r}=await import("./index-DvnSb1Lh.js").then(o=>o.c7);return{uploadAppBinaryResumable:r}},__vite__mapDeps([0,1]),import.meta.url),a=await t(es,"pc32",((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin",Te||void 0,r=>as(r),3e5);ne(r=>({...r,pc32Url:a,pc32Version:Te||r.pc32Version}))}catch(t){console.error("PC32 upload failed",t),alert(t!=null&&t.message?`فشل رفع تطبيق 32 بت: ${t.message}`:"فشل رفع تطبيق 32 بت")}finally{Rs(!1),as(0)}},disabled:Fs||!es,className:"w-full sm:w-auto flex items-center gap-2 bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700 disabled:opacity-50",children:[e.jsx(Ss,{className:"w-4 h-4"}),Fs?`جاري الرفع... ${Gt}%`:"رفع تطبيق 32 بت"]}),(N==null?void 0:N.pc32Url)&&e.jsxs("a",{href:ye(N.pc32Url),className:"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(vs,{className:"w-4 h-4"})," تنزيل نسخة 32 بت"]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط مباشر لتطبيق الكمبيوتر نسخة 32 بت (EXE/ZIP)"}),e.jsx("input",{type:"url",value:ns,onChange:s=>Os(s.target.value),placeholder:"https://example.com/cashy-setup-ia32.exe",className:"w-full p-2 border border-gray-300 rounded-md"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:async()=>{var s;try{const{setAppDownloadLinks:t}=await C(async()=>{const{setAppDownloadLinks:a}=await import("./index-DvnSb1Lh.js").then(r=>r.c7);return{setAppDownloadLinks:a}},__vite__mapDeps([0,1]),import.meta.url);await t({pc32Url:ns||void 0,pc32Version:Te||void 0},((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin"),ne(a=>({...a,pc32Url:ns||void 0,pc32Version:Te||(a==null?void 0:a.pc32Version)})),alert("تم حفظ رابط 32 بت بنجاح")}catch(t){console.error("Failed to save pc32 link",t),alert(t!=null&&t.message?`فشل حفظ الرابط: ${t.message}`:"فشل حفظ الرابط")}},className:"flex items-center gap-2 bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700",children:[e.jsx(we,{className:"w-4 h-4"})," حفظ الرابط"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(At,{className:"w-5 h-5 text-indigo-600"})," إدارة تحديثات برنامج الكمبيوتر"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"إصدار موحّد مع روابط 64-بت و32-بت، وملاحظات وخيار التحديث الإجباري."})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الإصدار"}),e.jsx("input",{type:"text",value:$s,onChange:s=>Bs(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"مثال: 1.4.0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط نسخة 64-بت"}),e.jsx("input",{type:"text",value:Hs,onChange:s=>qs(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"رابط المثبّت x64"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط نسخة 32-بت"}),e.jsx("input",{type:"text",value:Ys,onChange:s=>Ws(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"رابط المثبّت ia32"})]}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ملاحظات التحديث"}),e.jsx("textarea",{value:Be,onChange:s=>zs(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md",rows:4,placeholder:"نص الملاحظات"})]}),e.jsx("div",{children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:Xs,onChange:s=>Qt(s.target.checked)}),"تحديث إجباري (لن يفتح التطبيق إلا بعد التحديث)"]})})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx("button",{onClick:ta,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-60",disabled:He==="publishing",children:"نشر التحديث"}),He==="publishing"&&e.jsx("span",{className:"text-sm text-gray-600",children:"جاري النشر..."}),He==="done"&&e.jsx("span",{className:"text-sm text-green-600",children:"تم النشر بنجاح"}),He==="error"&&e.jsx("span",{className:"text-sm text-red-600",children:"فشل النشر"}),Js&&e.jsx("span",{className:"text-sm text-red-600",children:Js})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ws,{className:"w-5 h-5 text-emerald-600"})," إعداد إشعار تحديث تطبيق الأندرويد (Firestore)"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"يقرأه تطبيق الأندرويد عند الفتح ويعرض نافذة داخلية للتنزيل."})]})}),e.jsx("div",{className:"text-sm text-gray-600",children:"تم إلغاء إدارة تحديث تطبيق الموبايل من لوحة الأدمن."})]})]}),g==="branches"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"طلبات باقات الفروع (بانتظار التفعيل)"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:d.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.status)==="pending"||((a=s.branchPackage)==null?void 0:a.requested)}).length})]}),e.jsx(Et,{className:"w-8 h-8 text-purple-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"باقات الفروع المفعّلة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d.filter(s=>{var t;return((t=s.branchPackage)==null?void 0:t.status)==="active"}).length})]}),e.jsx(Fe,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي حسابات باقات الفروع"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:d.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).length})]}),e.jsx(Ns,{className:"w-8 h-8 text-blue-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"قسم باقات الفروع"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"البحث عن حساب باقات الفروع...",value:O,onChange:s=>ge(s.target.value),className:"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),O&&e.jsxs("div",{className:"text-sm text-gray-600",children:["عرض ",le.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).length," من أصل ",d.filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).length," حساب",O&&e.jsx("button",{onClick:()=>ge(""),className:"mr-2 text-purple-600 hover:text-purple-800 underline",children:"مسح البحث"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:P?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4",children:(O?le:d).filter(s=>{var t,a;return((t=s.branchPackage)==null?void 0:t.requested)||((a=s.branchPackage)==null?void 0:a.status)}).map(s=>{var a,r,o;const t=((a=s.branchPackage)==null?void 0:a.status)||((r=s.branchPackage)!=null&&r.requested?"pending":"none");return e.jsxs("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-purple-600 font-semibold",children:De(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:te(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),((o=s.branchPackage)==null?void 0:o.requestedAt)&&e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ الطلب: ",bs(s.branchPackage.requestedAt)]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${t==="active"?"bg-green-100 text-green-700":t==="pending"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:t==="active"?"مفعّل":t==="pending"?"بانتظار التفعيل":"غير محدد"}),t==="active"&&e.jsx("button",{title:"إلغاء باقة الفروع",onClick:async()=>{var j;if(window.confirm("هل تريد إلغاء تفعيل باقة الفروع لهذا الحساب؟"))try{const{doc:k,updateDoc:I}=await C(async()=>{const{doc:B,updateDoc:G}=await import("./index-DvnSb1Lh.js").then(fs=>fs.c3);return{doc:B,updateDoc:G}},__vite__mapDeps([0,1]),import.meta.url),{db:R}=await C(async()=>{const{db:B}=await import("./index-DvnSb1Lh.js").then(G=>G.c4);return{db:B}},__vite__mapDeps([0,1]),import.meta.url),M=((j=n==null?void 0:n.currentUser)==null?void 0:j.uid)||"admin-user-id";await I(k(R,"users",s.id),{branchPackage:{requested:!0,status:"canceled",canceledAt:new Date,canceledBy:M},isActive:!1,updatedAt:new Date}),alert("تم إلغاء باقة الفروع لهذا الحساب")}catch(k){console.error("فشل في إلغاء باقة الفروع:",k),alert("حدث خطأ أثناء الإلغاء، حاول مرة أخرى")}},className:"p-1 rounded-md text-red-600 hover:bg-red-50",children:e.jsx(xr,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:t!=="active"&&e.jsx("button",{onClick:async()=>{var c;try{const{doc:j,updateDoc:k,setDoc:I}=await C(async()=>{const{doc:B,updateDoc:G,setDoc:fs}=await import("./index-DvnSb1Lh.js").then(fa=>fa.c3);return{doc:B,updateDoc:G,setDoc:fs}},__vite__mapDeps([0,1]),import.meta.url),{db:R}=await C(async()=>{const{db:B}=await import("./index-DvnSb1Lh.js").then(G=>G.c4);return{db:B}},__vite__mapDeps([0,1]),import.meta.url),M=((c=n==null?void 0:n.currentUser)==null?void 0:c.uid)||"admin-user-id";await k(j(R,"users",s.id),{branchPackage:{requested:!0,status:"active",activatedAt:new Date,activatedBy:M},isActive:!0,approved:!0,role:"merchant",updatedAt:new Date}),await I(j(R,"profiles",s.id),{role:"merchant",approved:!0,updatedAt:new Date},{merge:!0}),alert("تم تفعيل باقة الفروع لهذا الحساب")}catch(j){console.error("فشل في تفعيل باقة الفروع:",j),alert("حدث خطأ أثناء التفعيل، حاول مرة أخرى")}},className:"px-3 py-1 text-sm rounded-md bg-purple-600 text-white hover:bg-purple-700",children:"تفعيل باقة الفروع"})})]})]},s.id)})})})]})]}),g==="subscriptions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"إجمالي الاشتراكات النشطة"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d.filter(s=>{var t;return(t=s.subscription)==null?void 0:t.isActive}).length})]}),e.jsx(Fe,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"تنتهي خلال 7 أيام"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:d.filter(s=>{var c,j;if(!((c=s.subscription)!=null&&c.endDate)||!((j=s.subscription)!=null&&j.isActive))return!1;const t=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),a=new Date,r=t.getTime()-a.getTime(),o=Math.ceil(r/(1e3*60*60*24));return o<=7&&o>0}).length})]}),e.jsx(Qe,{className:"w-8 h-8 text-orange-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"منتهية الصلاحية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:d.filter(s=>{var a;return(a=s.subscription)!=null&&a.endDate?(s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate))<new Date:!1}).length})]}),e.jsx(X,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"اشتراكات مدى الحياة"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:d.filter(s=>{var t;return((t=s.subscription)==null?void 0:t.planType)===x.LIFETIME}).length})]}),e.jsx(Pe,{className:"w-8 h-8 text-yellow-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"جدول مواعيد الاشتراكات"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"عرض جميع الاشتراكات النشطة مع تواريخ البداية والانتهاء"})]}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(Ne,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"بحث في الاشتراكات...",value:ms,onChange:s=>sa(s.target.value),className:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:P?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"جاري تحميل البيانات..."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"المستخدم"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"نوع الاشتراك"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ البداية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الحالة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"الأيام المتبقية"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"إجراء"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.filter(s=>{var a,r;if(!((a=s.subscription)!=null&&a.planType))return!1;const t=((r=s.subscription)==null?void 0:r.isActive)===!1||(s==null?void 0:s.isActive)===!1;if(ms){const o=ms.trim().toLowerCase();if(o){const c=te(s).toLowerCase(),j=(s.email||"").toLowerCase();if(!c.includes(o)&&!j.includes(o))return!1}}return!t}).sort((s,t)=>{var o,c;if(!((o=s.subscription)!=null&&o.endDate)||!((c=t.subscription)!=null&&c.endDate))return 0;const a=s.subscription.endDate.toDate?s.subscription.endDate.toDate():new Date(s.subscription.endDate),r=t.subscription.endDate.toDate?t.subscription.endDate.toDate():new Date(t.subscription.endDate);return a.getTime()-r.getTime()}).map(s=>{const t=s.subscription;if(!t)return null;const a=t.startDate?t.startDate.toDate?t.startDate.toDate():new Date(t.startDate):null,r=t.endDate?t.endDate.toDate?t.endDate.toDate():new Date(t.endDate):null;let o=null,c="غير محدد";const j=(t==null?void 0:t.isActive)===!1||(s==null?void 0:s.isActive)===!1;if(j)c="ملغي";else if(t.planType===x.LIFETIME)c="مدى الحياة";else if(r){const k=new Date,I=r.getTime()-k.getTime();o=Math.ceil(I/(1e3*60*60*24)),o<0?c="منتهي":o<=7?c="ينتهي قريباً":c="نشط"}return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-medium text-sm",children:De(s)})}),e.jsxs("div",{className:"mr-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:te(s)}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[t.planType===x.LIFETIME&&e.jsx(Pe,{className:"w-4 h-4 text-yellow-500 ml-2"}),t.planType===x.YEARLY&&e.jsx(re,{className:"w-4 h-4 text-blue-500 ml-2"}),t.planType===x.QUARTERLY&&e.jsx(K,{className:"w-4 h-4 text-purple-500 ml-2"}),t.planType===x.MONTHLY&&e.jsx(Re,{className:"w-4 h-4 text-green-500 ml-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:La(t.planType)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:a?a.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.planType===x.LIFETIME?"مدى الحياة":r?r.toLocaleDateString("ar-EG"):"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${c==="نشط"?"bg-green-100 text-green-800":c==="ينتهي قريباً"?"bg-orange-100 text-orange-800":c==="منتهي"||c==="ملغي"?"bg-red-100 text-red-800":c==="مدى الحياة"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:c})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:j?"ملغي":t.planType===x.LIFETIME?"∞":o!==null?o<0?"منتهي":`${o} يوم`:"غير محدد"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:async()=>{try{if(!window.confirm("هل تريد إلغاء الاشتراك؟ سيتم الإلغاء فور التأكيد."))return;await bt(s.id)}catch(k){console.error("فشل في إلغاء الاشتراك:",k)}},className:"px-3 py-1 text-sm rounded-md bg-red-600 text-white hover:bg-red-700",children:"الغاء"})})]},s.id)}).filter(Boolean)})]})})]})]}),g==="content"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة محتوى خطط الاشتراك"}),T&&T.lastUpdated&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["آخر تحديث: ",new Date(T.lastUpdated).toLocaleString("ar-SA"),T.updatedBy&&` بواسطة: ${T.updatedBy}`]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>{Ts(!0),se({name:"الباقة الربع سنوية",price:"250 جنيه",period:"كل 3 أشهر",description:"حل وسط بين الشهرية والسنوية",features:["إدارة محافظ متعددة","تقارير ربع سنوية"]}),_s("quarterly"),W(!0)},className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:[e.jsx(Nt,{className:"w-4 h-4"}),"إضافة باقة جديدة"]}),e.jsxs("button",{onClick:ia,disabled:ke,className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(we,{className:"w-4 h-4"}),ke?"جاري الحفظ...":"حفظ جميع التغييرات"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:Object.entries(ee).map(([s,t])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[s==="monthly"&&e.jsx(Re,{className:"w-4 h-4 text-green-500"}),s==="quarterly"&&e.jsx(K,{className:"w-4 h-4 text-purple-500"}),s==="yearly"&&e.jsx(re,{className:"w-4 h-4 text-blue-500"}),s==="lifetime"&&e.jsx(Pe,{className:"w-4 h-4 text-yellow-500"}),t.name]}),e.jsx("button",{onClick:()=>{F(v===s?null:s),Ts(!1),_s(s),se({...t,features:[...t.features||[]]}),W(!0)},className:"text-purple-600 hover:text-purple-800",children:e.jsx(tr,{className:"w-4 h-4"})})]}),v===s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:t.name,onChange:a=>qe(s,"name",a.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:t.price,onChange:a=>qe(s,"price",a.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:t.period,onChange:a=>qe(s,"period",a.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{value:t.description,onChange:a=>qe(s,"description",a.target.value),rows:3,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>ca(s),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:t.features.map((a,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:a,onChange:o=>oa(s,r,o.target.value),className:"flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm"}),e.jsx("button",{onClick:()=>da(s,r),className:"text-red-500 hover:text-red-700",children:e.jsx(de,{className:"w-4 h-4"})})]},r))})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:t.price}),e.jsx("div",{className:"text-sm text-gray-600",children:t.period}),e.jsx("div",{className:"text-sm text-gray-700",children:t.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"المميزات:"}),t.features.map((a,r)=>e.jsxs("div",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(Fe,{className:"w-3 h-3 text-green-500"}),a]},r))]})]})]},s))})]}),Ae&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold",children:It?"إضافة باقة جديدة":`تعديل ${E==="monthly"?"الباقة الشهرية":E==="yearly"?"الباقة السنوية":E==="lifetime"?"باقة مدى الحياة":"باقة ربع سنوية"}`}),e.jsx("button",{onClick:()=>W(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(de,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم الباقة"}),e.jsx("input",{type:"text",value:ae.name,onChange:s=>se(t=>({...t,name:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"السعر"}),e.jsx("input",{type:"text",value:ae.price,onChange:s=>se(t=>({...t,price:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:ae.period,onChange:s=>se(t=>({...t,period:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{rows:3,value:ae.description,onChange:s=>se(t=>({...t,description:s.target.value})),className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"المميزات"}),e.jsx("button",{onClick:()=>se(s=>({...s,features:[...s.features||[],""]})),className:"text-sm text-purple-600 hover:text-purple-800",children:"+ إضافة ميزة"})]}),e.jsx("div",{className:"space-y-2",children:(ae.features||[]).map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:a=>{const r=a.target.value;se(o=>{const c=[...o.features||[]];return c[t]=r,{...o,features:c}})},className:"flex-1 p-2 border rounded-md text-sm"}),e.jsx("button",{onClick:()=>{se(a=>{const r=[...a.features||[]];return r.splice(t,1),{...a,features:r}})},className:"text-red-500 hover:text-red-700",children:e.jsx(de,{className:"w-4 h-4"})})]},t))})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>W(!1),className:"px-4 py-2 rounded-md bg-gray-100 hover:bg-gray-200",children:"إلغاء"}),e.jsx("button",{onClick:()=>{E&&(Y(s=>({...s,[E]:{...ae}})),W(!1))},className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700",children:"حفظ داخل الصفحة"}),e.jsx("button",{onClick:async()=>{var s;if(E)try{const t=((s=n==null?void 0:n.currentUser)==null?void 0:s.uid)||"admin";await Wa(E,ae,t),Y(a=>({...a,[E]:{...ae}})),W(!1)}catch(t){console.error("Immediate save failed",t),alert("حدث خطأ أثناء الحفظ الفوري. حاول لاحقًا أو استخدم حفظ جميع التغييرات.")}},className:"px-4 py-2 rounded-md bg-purple-600 text-white hover:bg-purple-700",children:"حفظ فوري"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إرسال إشعار للمستخدمين"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"سيظهر الإشعار كمودال صغير في منتصف الشاشة مع ضباب خفيف."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"عنوان الإشعار"}),e.jsx("input",{type:"text",value:xs,onChange:s=>tt(s.target.value),placeholder:"أدخل عنوانًا قصيرًا وجذابًا",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"نص الإشعار"}),e.jsx("textarea",{value:us,onChange:s=>at(s.target.value),placeholder:"اكتب محتوى الإشعار الذي سيظهر للمستخدمين",rows:4,className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رابط اختياري"}),e.jsx("input",{type:"text",value:rt,onChange:s=>lt(s.target.value),placeholder:"مثال: /user/dashboard أو https://example.com",className:"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"إذا كان الرابط خارجيًا سيفتح في نافذة جديدة، وإذا كان داخليًا سيتم التوجيه داخل الموقع."})]}),e.jsx("div",{className:"flex items-center justify-end gap-3",children:e.jsx("button",{onClick:aa,disabled:it,className:"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:it?"جاري الإرسال...":"إرسال إشعار"})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(At,{className:"w-5 h-5 text-slate-600"})," إعدادات النظام — Telegram/Cloudflare Worker"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"أدخل رابط الـ Worker المركزي. التوكن يبقى سر داخل Cloudflare Secrets."})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط Cloudflare Worker"}),e.jsx("input",{type:"url",value:Gs,onChange:s=>Qs(s.target.value),placeholder:"https://summer-cake-5149.alkaptin2030.workers.dev",className:"w-full p-2 border border-gray-300 rounded-md"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:'تأكد أن المسار يدعم POST عند "/notify" أو الجذر حسب إعدادك.'})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:async()=>{try{Ks(!0);const{systemSettingsService:s}=await C(async()=>{const{systemSettingsService:a}=await import("./index-DvnSb1Lh.js").then(r=>r.c5);return{systemSettingsService:a}},__vite__mapDeps([0,1]),import.meta.url),t=(Gs||"").trim();if(!t){alert("أدخل رابط صحيح");return}await s.setTelegramWorkerUrl(t),alert("تم حفظ رابط Cloudflare Worker بنجاح")}catch(s){console.error("Failed to save worker url",s),alert(s!=null&&s.message?`فشل حفظ الرابط: ${s.message}`:"فشل حفظ الرابط")}finally{Ks(!1)}},className:"flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded-lg hover:bg-slate-700 disabled:opacity-50",disabled:Zs,children:[e.jsx(we,{className:"w-4 h-4"})," ",Zs?"جاري الحفظ...":"حفظ الرابط"]})})]})]})]})]})]}),g==="trials"&&e.jsxs("div",{className:"space-y-6",children:[console.log("🔍 Trials tab rendering - users data:",d),console.log("🔍 Users count:",(d==null?void 0:d.length)||0),console.log("🔍 Users on trial:",((jt=d==null?void 0:d.filter(s=>s.isOnFreeTrial))==null?void 0:jt.length)||0),P&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"جاري تحميل بيانات المستخدمين..."})]})}),f&&!P&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Qe,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"خطأ في تحميل البيانات"}),e.jsx("p",{className:"text-red-600 mb-4",children:f}),e.jsx("p",{className:"text-sm text-red-500",children:"تأكد من اتصال الإنترنت وإعدادات Firebase"})]}),!P&&!f&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين في التجربة"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:d.filter(s=>s.isOnFreeTrial).length})]}),e.jsx(re,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"التجارب المنتهية"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:d.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).length})]}),e.jsx(X,{className:"w-8 h-8 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المستخدمين المؤهلين"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length})]}),e.jsx(_t,{className:"w-8 h-8 text-green-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إعداد مدة التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"يتم تطبيق التغيير فورياً على أي تفعيل جديد."})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"المدة بالساعات"}),e.jsx("input",{type:"number",min:1,max:336,value:dt,onChange:s=>mt(s.target.value),className:"w-full px-4 py-2 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm",placeholder:"اكتب عدد الساعات"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["المدة الحالية: ",$," ",$>=3&&$<=10?"ساعات":$===2?"ساعتين":"ساعة"]})]}),e.jsx("div",{className:"flex items-center md:justify-end",children:e.jsx("button",{onClick:ua,disabled:xt,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium disabled:opacity-50",children:xt?"جاري التحديث...":"تحديث المدة"})})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-4 border-b border-gray-200 mb-6",children:[e.jsxs("button",{onClick:()=>ps("eligible"),className:`pb-2 px-4 text-sm font-medium transition-colors relative whitespace-nowrap ${je==="eligible"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:["المؤهلين للتجربة",e.jsx("span",{className:"mr-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs",children:d.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length})]}),e.jsxs("button",{onClick:()=>ps("active"),className:`pb-2 px-4 text-sm font-medium transition-colors relative whitespace-nowrap ${je==="active"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:["التجارب النشطة",e.jsx("span",{className:"mr-2 bg-blue-100 text-blue-600 py-0.5 px-2 rounded-full text-xs",children:d.filter(s=>s.isOnFreeTrial).length})]}),e.jsxs("button",{onClick:()=>ps("expired"),className:`pb-2 px-4 text-sm font-medium transition-colors relative whitespace-nowrap ${je==="expired"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:["التجارب المنتهية",e.jsx("span",{className:"mr-2 bg-red-100 text-red-600 py-0.5 px-2 rounded-full text-xs",children:d.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).length})]})]}),je==="eligible"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين المؤهلين للتجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين لم يستخدموا التجربة المجانية من قبل"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:fe,onChange:s=>hs(s.target.value),placeholder:"ابحث بالاسم أو البريد في المؤهلين للتجربة",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Ne,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[d.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).filter(s=>{const t=fe.trim().toLowerCase();if(!t)return!0;const a=te(s).toLowerCase(),r=(s.email||"").toLowerCase();return a.includes(t)||r.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:De(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:te(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-gray-400",children:["تاريخ التسجيل: ",bs(s.createdAt)]})]})]}),e.jsx("div",{className:"flex items-center space-x-3 space-x-reverse",children:e.jsx("button",{onClick:()=>ft(s.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:`تفعيل التجربة ${$} ${$>=3&&$<=10?"ساعات":$===2?"ساعتين":"ساعة"}`})})]},s.id)),d.filter(s=>!s.hasUsedFreeTrial&&!s.isOnFreeTrial&&!s.approved).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(re,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد مستخدمين مؤهلين للتجربة المجانية حالياً"})]})]})})]}),je==="active"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين في التجربة المجانية"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين يستخدمون التجربة المجانية حالياً"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:fe,onChange:s=>hs(s.target.value),placeholder:"ابحث بالاسم أو البريد في التجارب المجانية",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Ne,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[d.filter(s=>s.isOnFreeTrial).filter(s=>{const t=fe.trim().toLowerCase();if(!t)return!0;const a=te(s).toLowerCase(),r=(s.email||"").toLowerCase();return a.includes(t)||r.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:De(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:te(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("p",{className:"text-xs text-blue-600",children:["تنتهي في: ",s.freeTrialEndDate?bs(s.freeTrialEndDate):"غير محدد"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:"نشط"}),e.jsx("button",{onClick:()=>ha(s.id),className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-xs",children:"ضبط نهاية التجربة"}),e.jsx("button",{onClick:()=>ga(s.id),className:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 text-xs",children:"إلغاء التجربة"})]})]},s.id)),d.filter(s=>s.isOnFreeTrial).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(re,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد تجارب نشطة حالياً"})]})]})})]}),je==="expired"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"المستخدمين المنتهين من التجربة"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"المستخدمين الذين انتهت تجربتهم المجانية"}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:fe,onChange:s=>hs(s.target.value),placeholder:"ابحث بالاسم أو البريد في التجارب المنتهية",className:"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm"}),e.jsx(Ne,{className:"w-4 h-4 text-gray-400 absolute left-3 top-2.5"})]})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[d.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).filter(s=>{const t=fe.trim().toLowerCase();if(!t)return!0;const a=te(s).toLowerCase(),r=(s.email||"").toLowerCase();return a.includes(t)||r.includes(t)}).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-gray-600 font-semibold",children:De(s)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:te(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsx("p",{className:"text-xs text-red-500",children:"انتهت التجربة"})]})]}),e.jsx("div",{className:"flex items-center space-x-3 space-x-reverse",children:e.jsx("button",{onClick:()=>ft(s.id),className:"px-3 py-1 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-xs",children:"تفعيل مرة أخرى"})})]},s.id)),d.filter(s=>s.hasUsedFreeTrial&&!s.isOnFreeTrial).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"لا يوجد تجارب منتهية حالياً"})]})]})})]})]})]}),g==="whatsapp"&&e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Ge,{className:"w-6 h-6 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"إدارة الواتساب"})]}),e.jsx(Tr,{})]}),g==="analytics"&&e.jsxs("div",{className:"bg-white rounded-lg p-8 shadow-sm border border-gray-200 text-center",children:[e.jsx(vt,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"الإحصائيات"}),e.jsx("p",{className:"text-gray-500",children:"سيتم إضافة الإحصائيات قريباً"})]})]})]}),e.jsx(Wr,{isOpen:Kt,onClose:()=>ds(!1),user:Xt,onActivate:async(s,t)=>{try{await pt(s,t),alert("تم تفعيل الاشتراك بنجاح"),ds(!1)}catch(a){console.error("فشل في تفعيل الاشتراك:",a),alert("حدث خطأ أثناء تفعيل الاشتراك")}}}),e.jsx(Vr,{isOpen:Ft,onClose:()=>_(!1)}),e.jsx(Or,{notification:Rt,onClose:xa,soundEnabled:Lt.soundAlerts,onToggleSound:ma})]})},an=()=>{const i=Ba(),{user:n,loading:h}=Ha(),[p,f]=l.useState(!1),[b,m]=l.useState(null),[A,g]=l.useState(!0),[w,_]=l.useState("users"),[L,U]=l.useState(0),[D,u]=l.useState([]),[d,V]=l.useState({}),[P,y]=l.useState([]),[me,ke]=l.useState([]),[S,T]=l.useState(!1),[H,xe]=l.useState(null);l.useEffect(()=>{const v=localStorage.getItem("admin_dev_mode")==="true";f(v)},[]);const q=async()=>{if(!(!p&&!n)){g(!0),m(null);try{const v=Se(oe(Q,"users")),ee=(await C(()=>import("./index-DvnSb1Lh.js").then(E=>E.c3),__vite__mapDeps([0,1]),import.meta.url).then(E=>E.getDocs(v))).docs.map(E=>({id:E.id,...E.data()}));u(ee);const Y=Se(oe(Q,"profiles")),Ae=await C(()=>import("./index-DvnSb1Lh.js").then(E=>E.c3),__vite__mapDeps([0,1]),import.meta.url).then(E=>E.getDocs(Y)),W={};Ae.forEach(E=>{W[E.id]=E.data()}),V(W),g(!1)}catch(v){console.error("Error refreshing data:",v),!p&&D.length===0&&m("فشل في تحميل البيانات"),g(!1)}}};l.useEffect(()=>{q()},[n,p]),l.useEffect(()=>{const v=D.map(F=>{const ee=d[F.id]||{},Y=typeof ee.fullName=="string"?ee.fullName:void 0,Ae=typeof ee.phone=="string"?ee.phone:void 0,W=typeof F.displayName=="string"&&F.displayName.trim()?F.displayName:Y||F.displayName||void 0;return{...F,displayName:W,phone:F.phone??Ae??null}});y(v)},[D,d]);const z=v=>{console.log("Notification center:",v)},Ee=v=>{console.log("Notification settings:",v)},le=v=>{console.log("Notifications:",v)},ue=v=>{console.log("Editing plan:",v)};l.useEffect(()=>{n&&(async()=>{try{const v=await wt();xe(v)}catch(v){console.warn("Failed to load last update info:",v),xe(null)}})()},[n]);const O=async()=>{try{return await Ga()}catch(v){return console.error("Error loading content:",v),{}}},ge=async v=>{try{T(!0),await za(v,(n==null?void 0:n.uid)||"admin");const F=await wt();return xe(F),!0}catch(F){return console.error("Error saving content:",F),!1}finally{T(!1)}};return h?e.jsx(qa,{}):e.jsx(Gr,{navigate:i,auth:Ya,devMode:p,setDevMode:f,error:b,setError:m,authLoading:h,setAuthLoading:()=>{},activeTab:w,setActiveTab:_,setNotificationCenterOpen:z,setNotificationSettings:Ee,setNotifications:le,notificationCount:L,setNotificationCount:U,users:P,setUsers:y,loading:A,setLoading:g,setEditingPlan:ue,isSavingContent:S,setIsSavingContent:T,lastUpdateInfo:H,loadContentFromFirebase:O,saveContentToFirebase:ge,refreshData:q})};export{an as default};
//# sourceMappingURL=ProtectedAdminDashboard-DRX-h1bS.js.map
