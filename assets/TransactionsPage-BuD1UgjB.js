const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dailyOperationCountService-Bsh4gYfW.js","./index-CZwBW8vR.js","./index-QuU6lc3e.css","./profitService-BUBYCoKY.js"])))=>i.map(i=>d[i]);
import{$ as ps,j as t,r as d,u as Pt,ac as Dt,B as T,K as Ct,af as Oe,ag as Re,ah as Pe,ai as Ee,C as pe,aF as Xe,a5 as M,a6 as $e,b6 as j,a as us,R as ce,ae as hs,aL as xs,q as we,s as Ae,t as W,aG as J,x as Te,ad as R,b7 as de,ab as fs,aT as Ge,V as H,a0 as $,c as gs,d as bs,e as ys,I as Ve,S as vs,b8 as js,aS as Ns,b3 as ws,a3 as As,at as St,g as Ts,aR as kt,au as Ot,b9 as Ds,p as He,aH as Cs,aM as X,ar as De}from"./index-CZwBW8vR.js";import{S as Ss,a as ks,b as Os,c as Rs,d as Ce}from"./select-C1gLQVXw.js";import{B as Ps}from"./badge-DziRw6yR.js";import{S as Es,T as Ls,a as Is,b as Se,c as ke}from"./tabs-CAePOU2u.js";import _s from"./ReceiptModal-CUVVTBKF.js";import Ws from"./InstallmentModal-CsKS9UTM.js";import Ms from"./CreditCardsDialog-Bud6dwHH.js";import Bs from"./MaintenanceDialog-Dbu_6lr7.js";import{SimCardsDialog as zs}from"./SimCardsDialog-Dk2f3tEb.js";import{A as Rt,u as Fs,C as Us,a as $s,f as F,b as Gs,S as Vs}from"./SimCardsAccessDialog-DcM4jv_g.js";import{ProfitService as me}from"./profitService-BUBYCoKY.js";import{D as Hs}from"./dollar-sign-CQHak9ia.js";import{A as qe}from"./arrow-down-left-BvLIcVR-.js";import{C as Et}from"./calendar-DdlfWvl7.js";import{A as Xs}from"./arrow-left-c8JkXMlT.js";import{B as qs}from"./battery-charging-BQPdtoWU.js";import{C as Ys}from"./users-_xFOxS2A.js";import{C as Ks}from"./circle-check-big-DUSZXsZt.js";import"./index-hfObMVTV.js";import"./separator-DqjOD3lx.js";import"./html2canvas.esm-BfYXEYrK.js";import"./printer-1f8tOea1.js";import"./download-CaSm4wTL.js";import"./pen-line-Bt9u66V1.js";import"./refresh-cw-CgaW6Naz.js";import"./alert-dialog-U7gr_XyE.js";import"./textarea---GTGD5h.js";import"./table-CDVWZ-zt.js";import"./wifi-DvA5dCu9.js";import"./save-BUsX5Y5v.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Js=ps("circle-play",Zs),Qs=({userId:D,transactions:s=[]})=>{const[x,g]=d.useState(!1),[se,q]=d.useState(!1),[Q,Y]=d.useState(!1),[B,ue]=d.useState({dailyWithdraw:0,dailyTransfer:0,monthlyWithdraw:0,monthlyTransfer:0,lastUpdated:new Date}),{userSubscription:z}=Pt();d.useEffect(()=>{D&&x&&Q&&ee()},[D,x,Q]);const K=w=>`${w.toFixed(2)} ج.م`,O=async()=>{try{const w=(z==null?void 0:z.subscription)||null,m=(w==null?void 0:w.planType)??(w==null?void 0:w.plan)??null,A=typeof m=="string"?m.toLowerCase():null;if(m===M.ZERO||A==="zero"||A==="0"||m===0)return!0}catch{}try{if(D){const w=await $e(D),m=(w==null?void 0:w.planType)??(w==null?void 0:w.plan)??null,A=typeof m=="string"?m.toLowerCase():null;if(m===M.ZERO||A==="zero"||A==="0"||m===0)return!0}}catch{}return!1},G=async()=>{try{const w=await(async()=>{try{const m=(z==null?void 0:z.subscription)||null,A=(m==null?void 0:m.planType)??(m==null?void 0:m.plan)??null,P=typeof A=="string"?A.toLowerCase():null;if(A===M.TAHWEELA||P==="tahweela")return!0}catch{}try{if(D){const m=await $e(D),A=(m==null?void 0:m.planType)??(m==null?void 0:m.plan)??null,P=typeof A=="string"?A.toLowerCase():null;if(A===M.TAHWEELA||P==="tahweela")return!0}}catch{}return!1})();if(await O()||w){j({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"});return}}catch{}q(!0)},ae=async()=>{try{const w=await(async()=>{try{const m=(z==null?void 0:z.subscription)||null,A=(m==null?void 0:m.planType)??(m==null?void 0:m.plan)??null,P=typeof A=="string"?A.toLowerCase():null;if(A===M.TAHWEELA||P==="tahweela")return!0}catch{}try{if(D){const m=await $e(D),A=(m==null?void 0:m.planType)??(m==null?void 0:m.plan)??null,P=typeof A=="string"?A.toLowerCase():null;if(A===M.TAHWEELA||P==="tahweela")return!0}}catch{}return!1})();if(await O()||w){j({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"}),q(!1);return}}catch{}Y(!0),g(!0),q(!1)},ee=async()=>{if(D)try{if(Array.isArray(s)&&s.length>0){const m=new Date,A=m.getMonth(),P=m.getFullYear(),_=Dt.filterVisibleTransactions(s,"daily",D),re=Dt.filterVisibleTransactions(s,"monthly",D);let he=0,xe=0,V=0,ne=0;_.forEach(C=>{const te=new Date(C.createdAt),I=String(C.status||"confirmed").toLowerCase();if(te.toDateString()!==m.toDateString()||I!=="completed"&&I!=="confirmed"&&I!=="pending")return;const Z=(C.type||C.txnType||"").toLowerCase(),E={type:Z==="withdrawal"?"withdraw":Z,amount:Number(C.amount||0),commission:C.commission};E.type==="withdraw"?he+=me.calculateProfitFromTransaction(E):(E.type==="send"||E.type==="receive"||E.type==="transfer")&&(xe+=me.calculateProfitFromTransaction(E))}),re.forEach(C=>{const te=new Date(C.createdAt),I=String(C.status||"confirmed").toLowerCase();if(te.getMonth()!==A||te.getFullYear()!==P||I!=="completed"&&I!=="confirmed"&&I!=="pending")return;const Z=(C.type||C.txnType||"").toLowerCase(),E={type:Z==="withdrawal"?"withdraw":Z,amount:Number(C.amount||0),commission:C.commission};E.type==="withdraw"?V+=me.calculateProfitFromTransaction(E):(E.type==="send"||E.type==="receive"||E.type==="transfer")&&(ne+=me.calculateProfitFromTransaction(E))}),ue({dailyWithdraw:Math.round(he*100)/100,dailyTransfer:Math.round(xe*100)/100,monthlyWithdraw:Math.round(V*100)/100,monthlyTransfer:Math.round(ne*100)/100,lastUpdated:new Date});return}const w=me.getWithdrawTransferProfits(D);ue({dailyWithdraw:w.dailyWithdrawProfit||0,dailyTransfer:w.dailyTransferProfit||0,monthlyWithdraw:w.monthlyWithdrawProfit||0,monthlyTransfer:w.monthlyTransferProfit||0,lastUpdated:new Date})}catch(w){console.error("Error loading total profits:",w)}};return t.jsxs(t.Fragment,{children:[t.jsx(T,{size:"sm",variant:"ghost",onClick:G,className:"h-2 w-2 p-0 bg-gradient-to-r from-blue-100 to-purple-200 text-purple-700 hover:from-blue-200 hover:to-purple-300 hover:text-purple-800 rounded transition-all duration-300 hover:scale-110 shadow-sm hover:shadow-md",title:"عرض إجمالي الأرباح",children:t.jsx(Ct,{className:"h-1.5 w-1.5"})}),t.jsx(Oe,{open:x,onOpenChange:g,children:t.jsxs(Re,{className:"max-w-[240px] mx-auto bg-white dark:bg-[#0f172a] border border-gray-200 dark:border-slate-800 shadow-md rounded sm:max-w-[220px] sm:bg-gradient-to-br sm:from-purple-50 sm:to-white sm:dark:from-slate-900 sm:dark:to-slate-800 sm:border-2 sm:border-purple-200 sm:dark:border-slate-700 sm:shadow-2xl sm:rounded-2xl",children:[t.jsx(Pe,{className:"text-center pb-0 border-b-0 sm:pb-2 sm:border-b sm:border-purple-200 dark:border-slate-700",children:t.jsxs(Ee,{className:"text-xs font-bold text-purple-800 dark:text-purple-300 flex items-center justify-center gap-1 mb-0 leading-tight tracking-tight sm:text-xs sm:gap-1 sm:mb-0 sm:leading-normal sm:tracking-normal",children:[t.jsx(Hs,{className:"h-2 w-2 text-purple-600 dark:text-purple-400 sm:h-3 sm:w-3"}),"إجمالي الأرباح (فوري)"]})}),t.jsxs("div",{className:"space-y-1 py-1 sm:space-y-2 sm:py-2",children:[t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-1 rounded border border-blue-200 dark:border-blue-900/30 sm:bg-gradient-to-r sm:from-blue-50 sm:to-blue-100 sm:dark:from-blue-900/20 sm:dark:to-blue-900/10 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(pe,{className:"h-2 w-2 text-blue-600 dark:text-blue-400"}),t.jsx("span",{className:"text-[10px] font-semibold text-blue-800 dark:text-blue-300",children:"يومي"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-900 dark:text-blue-100",children:K((B.dailyWithdraw??0)+(B.dailyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 dark:bg-red-900/20 p-0.5 rounded border border-red-200 dark:border-red-900/30",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(qe,{className:"h-2 w-2 text-red-600 dark:text-red-400"}),t.jsx("span",{className:"text-[10px] text-red-800 dark:text-red-300",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700 dark:text-red-200",children:K(B.dailyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-green-50 dark:bg-green-900/20 p-0.5 rounded border border-green-200 dark:border-green-900/30",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Rt,{className:"h-2 w-2 text-green-600 dark:text-green-400"}),t.jsx("span",{className:"text-[10px] text-green-800 dark:text-green-300",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-green-700 dark:text-green-200",children:K(B.dailyTransfer)})]})]})]}),t.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-1 rounded border border-purple-200 dark:border-purple-900/30 sm:bg-gradient-to-r sm:from-purple-50 sm:to-purple-100 sm:dark:from-purple-900/20 sm:dark:to-purple-900/10 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Et,{className:"h-2 w-2 text-purple-600 dark:text-purple-400"}),t.jsx("span",{className:"text-[10px] font-semibold text-purple-800 dark:text-purple-300",children:"شهري"})]}),t.jsx("span",{className:"text-[10px] font-bold text-purple-900 dark:text-purple-100",children:K((B.monthlyWithdraw??0)+(B.monthlyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 dark:bg-red-900/20 p-0.5 rounded border border-red-200 dark:border-red-900/30",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(qe,{className:"h-2 w-2 text-red-600 dark:text-red-400"}),t.jsx("span",{className:"text-[10px] text-red-800 dark:text-red-300",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700 dark:text-red-200",children:K(B.monthlyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-blue-50 dark:bg-blue-900/20 p-0.5 rounded border border-blue-200 dark:border-blue-900/30",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Rt,{className:"h-2 w-2 text-blue-600 dark:text-blue-400"}),t.jsx("span",{className:"text-[10px] text-blue-800 dark:text-blue-300",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-700 dark:text-blue-200",children:K(B.monthlyTransfer)})]})]})]})]}),!Q&&t.jsx("div",{className:"absolute inset-0 bg-yellow-200/70 backdrop-blur-sm flex items-center justify-center rounded sm:rounded-2xl border border-yellow-300 pointer-events-auto",children:t.jsx(T,{size:"sm",variant:"ghost",onClick:()=>q(!0),className:"p-2 bg-yellow-300/80 text-yellow-900 hover:bg-yellow-400/90 rounded-full shadow-sm hover:shadow-md transition-all duration-300",title:"إدخال الرقم السري الرئيسي",children:t.jsx(Ct,{className:"h-4 w-4"})})}),t.jsx("div",{className:"flex justify-center pt-1 border-t-0 sm:pt-2 sm:border-t sm:border-purple-200",children:t.jsx(T,{onClick:()=>g(!1),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-1 rounded-xl text-xs sm:bg-gradient-to-r sm:from-purple-600 sm:to-purple-700 sm:hover:from-purple-700 sm:hover:to-purple-800 sm:px-4 sm:py-1 sm:rounded-xl sm:shadow-lg sm:hover:shadow-xl sm:transition-all sm:duration-300",children:"إغلاق"})})]})}),t.jsx(Xe,{open:se,onOpenChange:q,onSuccess:ae,description:"لا يمكن الاطلاع على إجمالي الأرباح إلا بإدخال الرقم السري الرئيسي"})]})},ea=D=>t.jsx(Qs,{...D}),Ma=()=>{var gt,bt,yt,vt,jt,Nt,wt,At,Tt;const D=us(),{user:s,profile:x,userSubscription:g,userData:se}=Pt(),[q,Q]=d.useState(!1),Y=ce.useMemo(()=>{var n,o,r,a;const e=((n=g==null?void 0:g.subscription)==null?void 0:n.planType)??((o=g==null?void 0:g.subscription)==null?void 0:o.plan)??((r=x==null?void 0:x.subscription)==null?void 0:r.planType)??((a=x==null?void 0:x.subscription)==null?void 0:a.plan)??null;return e===M.ZERO||String(e).toLowerCase()==="zero"},[(gt=g==null?void 0:g.subscription)==null?void 0:gt.planType,(bt=g==null?void 0:g.subscription)==null?void 0:bt.plan,(yt=x==null?void 0:x.subscription)==null?void 0:yt.planType,(vt=x==null?void 0:x.subscription)==null?void 0:vt.plan]),B=ce.useMemo(()=>{var n,o,r,a;const e=((n=g==null?void 0:g.subscription)==null?void 0:n.planType)??((o=g==null?void 0:g.subscription)==null?void 0:o.plan)??((r=x==null?void 0:x.subscription)==null?void 0:r.planType)??((a=x==null?void 0:x.subscription)==null?void 0:a.plan)??null;return e===M.TAHWEELA||String(e).toLowerCase()==="tahweela"},[(jt=g==null?void 0:g.subscription)==null?void 0:jt.planType,(Nt=g==null?void 0:g.subscription)==null?void 0:Nt.plan,(wt=x==null?void 0:x.subscription)==null?void 0:wt.planType,(At=x==null?void 0:x.subscription)==null?void 0:At.plan]),{shopName:ue}=hs(),{isShiftActive:z,shiftUser:K}=xs(),[O,G]=d.useState([]),[ae,ee]=d.useState([]),[w,m]=d.useState(new Set),[A,P]=d.useState(!1),[_,re]=d.useState(null),[he,xe]=d.useState("all"),[V,ne]=d.useState(""),[C,te]=d.useState(""),[I,Z]=d.useState(""),[E,Lt]=d.useState(!1),[It,Le]=d.useState(!1),[_t,Ye]=d.useState(!1),[Wt,Ke]=d.useState(!1),[Ze,Je]=d.useState(""),[Mt,Qe]=d.useState("شرح التطبيق"),[ta,et]=d.useState(null),[ie,Bt]=d.useState(null),[zt,fe]=d.useState(!1);ce.useEffect(()=>{var n;((n=g==null?void 0:g.subscription)==null?void 0:n.planType)===M.TAHWEELA&&(j({title:"غير متاح لاشتراكك",description:"صفحة المعاملات غير متاحة في باقة تحويله. استخدم لوحة المستخدم للتحويل/السحب فقط.",variant:"destructive"}),D("/user/dashboard"))},[(Tt=g==null?void 0:g.subscription)==null?void 0:Tt.planType]);const[sa,Ft]=d.useState(!1),[aa,Ut]=d.useState(!1),[ra,na]=d.useState(!1),[$t,Ie]=d.useState(!1),[Gt,tt]=d.useState(!1),[Vt,st]=d.useState(!1),[Ht,_e]=d.useState(!1),[Xt,qt]=d.useState(null),[Yt,ge]=d.useState(!1),[Kt,at]=d.useState(!1),[rt,be]=d.useState({keepLastCount:30,intervalDays:7,lastResetAt:null});d.useEffect(()=>{(async()=>{if(s!=null&&s.uid)try{const n=await R.getUserData(s.uid),o=(n==null?void 0:n.recentReset)||{},r=Number(o==null?void 0:o.keepLastCount)>0?Number(o.keepLastCount):30,a=Number(o==null?void 0:o.intervalDays)>0?Number(o.intervalDays):7,i=u=>u instanceof Date?u:typeof(u==null?void 0:u.toDate)=="function"?u.toDate():u?new Date(String(u)):null,p=o!=null&&o.lastResetAt?i(o.lastResetAt):null,c=new Date;!p||c.getTime()-p.getTime()>=a*24*60*60*1e3?(await R.updateUserData(s.uid,{recentReset:{keepLastCount:r,intervalDays:a,lastResetAt:c}}),be({keepLastCount:r,intervalDays:a,lastResetAt:c})):be({keepLastCount:r,intervalDays:a,lastResetAt:p})}catch{be({keepLastCount:30,intervalDays:7,lastResetAt:null})}})()},[s==null?void 0:s.uid]),d.useEffect(()=>{if(!(s!=null&&s.uid))return;(async()=>{try{const n=H(W,"users",s.uid),o=await $(n),r=o.exists()?o.data():{},a=r==null?void 0:r.tutorialSeenAt,i=a!=null&&a.toDate?a.toDate():a?new Date(a):null;Bt(i)}catch{}})()},[s==null?void 0:s.uid]),d.useEffect(()=>{(async()=>{try{const n=await $(H(W,"app_guides","latest")),o=n.exists()?n.data():null;if(!o){Je(""),Qe(""),et(null),fe(!1);return}const r=String(o.url||""),a=String(o.title||"شرح التطبيق"),i=o.publishedAt,p=i!=null&&i.toDate?i.toDate():i?new Date(i):new Date;Je(r),Qe(a),et(p),fe(p?!ie||p.getTime()>((ie==null?void 0:ie.getTime())||0):!1)}catch{fe(!1)}})()},[ie]);const Zt=e=>{try{const n=new URL(e);let o="";return n.hostname.includes("youtube.com")?n.pathname==="/watch"?o=n.searchParams.get("v")||"":(n.pathname.startsWith("/embed/")||n.pathname.startsWith("/shorts/"))&&(o=n.pathname.split("/").pop()||""):n.hostname==="youtu.be"&&(o=n.pathname.replace(/^\//,"")),o?`https://www.youtube.com/embed/${o}?autoplay=1&rel=0`:e}catch{return e}},Jt=async()=>{Ke(!0);try{s!=null&&s.uid&&await R.updateUserData(s.uid,{tutorialSeenAt:new Date}),fe(!1)}catch{}},[Qt,ye]=d.useState(!1),[ve,nt]=d.useState(""),[oe,it]=d.useState(""),[je,ot]=d.useState(""),[lt,ct]=d.useState(!1),[dt,We]=d.useState(0);d.useEffect(()=>{if(!(s!=null&&s.uid)){We(0);return}(async()=>{try{const n=H(W,"users",s.uid),o=await $(n),r=o.exists()?o.data():{},p=(Array.isArray(r==null?void 0:r.debts)?r.debts:[]).filter(c=>(c==null?void 0:c.status)==="pending"&&(Number(c==null?void 0:c.amount)||0)>0).length;We(p)}catch{We(0)}})()},[s==null?void 0:s.uid]),d.useEffect(()=>{es(),ts()},[s]),d.useEffect(()=>{if(!(s!=null&&s.uid))return;(async()=>{try{const n=we(Ae(W,"deletedTransactions"),J("userId","==",s.uid)),o=await Te(n),r=[];o.docs.forEach(a=>{const i=a.data(),p=[i.originalTransactionId,i.transactionId,i.reference,a.id].filter(Boolean).map(c=>String(c));r.push(...p)}),r.length>0&&(m(a=>{const i=new Set(a);return r.forEach(p=>i.add(p)),i}),G(a=>a.filter(i=>{const p=String(i.id||""),c=String(i.transactionId||""),f=String(i.reference||"");return!(r.includes(p)||r.includes(c)||r.includes(f))})));try{R.subscribeDeletedTransactionsLocalSync(s.uid)}catch{}}catch(n){console.warn("deletedTransactions fetch failed:",n)}})()},[s==null?void 0:s.uid]),d.useEffect(()=>{(async()=>{try{if(!(s!=null&&s.uid)){m(new Set);return}const e=we(Ae(W,"deletedTransactions"),J("userId","==",s.uid),J("permanent","==",!0)),o=(await Te(e)).docs.flatMap(r=>{const a=r.data();return[a.originalTransactionId,a.transactionId,a.reference,r.id].filter(Boolean).map(String)});m(new Set(o))}catch{m(new Set)}})()},[s==null?void 0:s.uid]);const{data:Me,refetch:ia,isFetching:oa}=Fs({queryKey:["userTransactions",s==null?void 0:s.uid],queryFn:async()=>{if(!(s!=null&&s.uid))return[];try{const e=we(Ae(W,"deletedTransactions"),J("userId","==",s.uid),J("permanent","==",!0)),[n,o,r]=await Promise.all([R.getUserTransactions(s.uid).catch(()=>[]),R.getByUserId(s.uid).catch(()=>[]),Te(e).then(l=>l.docs.flatMap(y=>{const h=y.data();return[h.originalTransactionId,h.transactionId,h.reference,y.id].filter(Boolean).map(String)})).catch(()=>[])]),a=Array.isArray(n)&&n.length>0?n:Array.isArray(o)?o:[],i=new Set(r),c=(a||[]).map(l=>({...l,createdAt:l.createdAt instanceof Date?l.createdAt:new Date(l.createdAt)})).filter(l=>!((l==null?void 0:l.type)==="report"||((l==null?void 0:l.title)||"").includes("إيصال تسليم وردية"))).filter(l=>{const y=String(l.id||""),h=String(l.transactionId||""),b=String(l.reference||l.transactionReference||"");return!i.has(y)&&(!h||!i.has(h))&&(!b||!i.has(b))}),f=s!=null&&s.uid?R.getLocalReceipts(s.uid):[],u=[...c,...Array.isArray(f)?f:[]],v=l=>{var y;return String((l==null?void 0:l.transactionId)||(l==null?void 0:l.id)||(l==null?void 0:l.reference)||(l==null?void 0:l.transactionReference)||((y=l==null?void 0:l.receipt)==null?void 0:y.reference)||`${new Date((l==null?void 0:l.createdAt)||Date.now()).getTime()}`)},S=new Set;return u.filter(l=>{const y=v(l);return S.has(y)?!1:(S.add(y),!0)}).map(ze)}catch(e){return console.error("Error fetching transactions:",e),[]}},enabled:!!(s!=null&&s.uid),staleTime:5*60*1e3});d.useEffect(()=>{Me&&G(Me)},[Me]);const es=async()=>{try{if(!s)return;const e=we(Ae(W,"deletedTransactions"),J("userId","==",s.uid),J("permanent","==",!0)),[n,o,r]=await Promise.all([R.getUserTransactions(s.uid).catch(()=>[]),R.getByUserId(s.uid).catch(()=>[]),Te(e).then(l=>l.docs.flatMap(y=>{const h=y.data();return[h.originalTransactionId,h.transactionId,h.reference,y.id].filter(Boolean).map(String)})).catch(()=>[])]),a=Array.isArray(n)&&n.length>0?n:Array.isArray(o)?o:[],i=new Set(r),c=(a||[]).map(l=>({...l,createdAt:l.createdAt instanceof Date?l.createdAt:new Date(l.createdAt)})).filter(l=>!((l==null?void 0:l.type)==="report"||((l==null?void 0:l.title)||"").includes("إيصال تسليم وردية"))).filter(l=>{const y=String(l.id||""),h=String(l.transactionId||""),b=String(l.reference||l.transactionReference||"");return!i.has(y)&&(!h||!i.has(h))&&(!b||!i.has(b))}),f=s!=null&&s.uid?R.getLocalReceipts(s.uid):[],u=[...c,...Array.isArray(f)?f:[]],v=l=>{var y;return String((l==null?void 0:l.transactionId)||(l==null?void 0:l.id)||(l==null?void 0:l.reference)||(l==null?void 0:l.transactionReference)||((y=l==null?void 0:l.receipt)==null?void 0:y.reference)||`${new Date((l==null?void 0:l.createdAt)||Date.now()).getTime()}`)},S=new Set,N=u.filter(l=>{const y=v(l);return S.has(y)?!1:(S.add(y),!0)});G(N.map(ze))}catch(e){console.error("خطأ في تحميل معاملات المستخدم من Firestore:",e),j({title:"فشل جلب معاملات المستخدم",description:"قد تكون المشكلة صلاحيات Firestore أو اتصال الشبكة. سيتم عرض المتاح محليًا إن وُجد. جرّب تسجيل الدخول مجددًا أو افتح صفحة اختبار المصادقة.",variant:"destructive"})}},ts=async()=>{try{if(!s)return;const n=(await de.getDeletedTransactionsByUser(s.uid)).map(o=>({...o,createdAt:o.createdAt instanceof Date?o.createdAt:new Date(o.createdAt)}));ee(n.map(ze))}catch(e){console.error("خطأ في تحميل المعاملات المحذوفة من Firestore:",e),j({title:"فشل جلب المعاملات المحذوفة",description:"تحقق من الصلاحيات والاتصال. يمكن مراجعة صفحة اختبار المصادقة للتشخيص.",variant:"destructive"})}},le=ce.useMemo(()=>{const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1),o=new Date(e.getFullYear(),e.getMonth()+1,1);return[...O].sort((a,i)=>{const p=a.createdAt instanceof Date?a.createdAt.getTime():0;return(i.createdAt instanceof Date?i.createdAt.getTime():0)-p}).filter(a=>a.createdAt>=n&&a.createdAt<o)},[O]),ss=ce.useMemo(()=>{const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1),o=new Date(e.getFullYear(),e.getMonth()+1,1);return Math.max(0,((O==null?void 0:O.length)||0)-(O||[]).filter(r=>r.createdAt>=n&&r.createdAt<o).length)},[O==null?void 0:O.length]),mt=le.filter(e=>{const n=!V||e.senderPhone.includes(V)||e.receiverPhone.includes(V),o=!C||e.createdAt.toDateString()===new Date(C).toDateString(),r=!I||e.createdAt.toTimeString().startsWith(I);return n&&o&&r}),pt=(e,n)=>{switch(e){case"completed":return t.jsx(Ks,{className:`h-4 w-4 ${n==="withdraw"?"text-red-500":"text-green-500"}`});case"pending":return t.jsx(pe,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return t.jsx(Ys,{className:"h-4 w-4 text-red-500"});default:return t.jsx(pe,{className:"h-4 w-4 text-gray-500"})}},Be=e=>{switch(e){case"completed":return"مكتمل";case"pending":return"قيد المراجعة";case"cancelled":return"ملغي";default:return"غير معروف"}},ze=e=>{const n=((e==null?void 0:e.status)??"").toString().toLowerCase(),o=n==="confirmed"||n==="success"||n==="completed"?"completed":n==="failed"||n==="error"||n==="cancelled"||n==="canceled"?"cancelled":"pending",r=((e==null?void 0:e.type)??(e==null?void 0:e.txnType)??"").toString().toLowerCase();let a="send";r==="withdraw"?a="withdraw":r==="cash_addition"||r==="add"?a="cash_addition":a="send";const i=(e==null?void 0:e.senderPhone)??(e==null?void 0:e.senderMsisdn)??(e==null?void 0:e.sender_msisdn)??(e==null?void 0:e.sender)??(e==null?void 0:e.from)??"",p=(e==null?void 0:e.receiverPhone)??(e==null?void 0:e.receiverMsisdn)??(e==null?void 0:e.receiver_msisdn)??(e==null?void 0:e.receiver)??(e==null?void 0:e.to)??"",c=e==null?void 0:e.createdAt,f=c instanceof Date?c:c!=null&&c.toDate?c.toDate():new Date(c);return{id:e==null?void 0:e.id,senderPhone:i||"غير معروف",receiverPhone:p||"غير معروف",amount:Number((e==null?void 0:e.amount)??0),status:o,type:a,createdAt:f,provider:(e==null?void 0:e.provider)??void 0,commission:(e==null?void 0:e.commission)??void 0,withdrawnAmount:(e==null?void 0:e.withdrawnAmount)??void 0,sentAmount:(e==null?void 0:e.sentAmount)??void 0,fromWallet:(e==null?void 0:e.fromWallet)??(e==null?void 0:e.walletId)??void 0,cashierName:(e==null?void 0:e.cashierName)??(e==null?void 0:e.createdByName)??(e==null?void 0:e.cashier)??void 0,commissionMode:(e==null?void 0:e.commissionMode)??(e==null?void 0:e.commission_mode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,walletEffectAppliedOnCreation:(e==null?void 0:e.walletEffectAppliedOnCreation)??(e==null?void 0:e.effectsAppliedOnCreation)??(e==null?void 0:e.effectAppliedOnCreation)??!1,cashEffectAppliedOnCreation:(e==null?void 0:e.cashEffectAppliedOnCreation)??!1,fee:(e==null?void 0:e.fee)??void 0,senderName:(e==null?void 0:e.senderName)??(e==null?void 0:e.customerName)??void 0,title:(e==null?void 0:e.title)??void 0,description:(e==null?void 0:e.description)??void 0}},as=e=>{const n=String((e==null?void 0:e.provider)||"").toLowerCase(),o=n.includes("vodafone")?"vf-cash":n.includes("instapay")?"instapay":"",r=String(e.description||""),a=String(e.title||""),i=r.includes("تحويل مكنه")||r.includes("تحويل مكينه")||r.includes("machine transfer")||a.includes("تحويل مكنه")||a.includes("تحويل مكينه"),p=e.type==="send"?"تحويل":"سحب";let c=e.type==="withdraw"&&o?`${p} ${o}`:p;return i?c="تحويل مكينه":e.title&&(c=e.title),{id:e.id,type:i||e.type==="send"?"transfer":"withdraw",sender_msisdn:e.senderPhone,receiver_msisdn:e.receiverPhone,amount:e.amount,commission:e.commission||0,status:e.status==="cancelled"?"failed":e.status,createdAt:e.createdAt.toISOString(),updatedAt:e.createdAt.toISOString(),shopName:ue??(x==null?void 0:x.shopName)??(s==null?void 0:s.displayName)??"المحل",cashierName:(e==null?void 0:e.cashierName)??null,commissionMode:(e==null?void 0:e.commissionMode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,fee:(e==null?void 0:e.fee)??void 0,note:(e==null?void 0:e.note)??(e==null?void 0:e.notes)??void 0,senderName:(e==null?void 0:e.senderName)??void 0,provider:(e==null?void 0:e.provider)??void 0,title:c,description:e.description}},Fe=e=>{const n=as(e);qt(n),_e(!0)},rs=e=>{re(e),P(!0)},ns=async()=>{_&&(await is(_.id),P(!1),re(null))},is=async e=>{try{const n=ae.find(a=>a.id===e);if(!n||!s)return;const o=await R.saveUserTransaction(s.uid,{...n,userId:s.uid,status:"completed",cashierName:n.cashierName??"الحساب الرئيسي"});await de.permanentlyDeleteTransaction(e,s.uid);const r={...n,id:o};G(a=>[...a,r]),ee(a=>a.filter(i=>i.id!==e)),j({title:"تم الاسترجاع",description:"تم استرجاع الإيصال إلى حسابك."})}catch(n){console.error("خطأ في استرجاع المعاملة من Firestore:",n),j({title:"فشل الاسترجاع",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},os=async e=>{try{if(!s)return;ee(n=>n.filter(o=>o.id!==e)),await de.permanentlyDeleteTransaction(e,s.uid),await R.removeUserTransaction(s.uid,e),j({title:"تم الحذف نهائيًا",description:"الإيصال لن يعود بعد التحديث."})}catch(n){console.error("فشل الحذف النهائي للمعاملة:",n),j({title:"خطأ في الحذف النهائي",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},ut=async e=>{var n,o,r;try{const a=O.find(h=>h.id===e);if(!a||!s)return;try{const h=(n=g==null?void 0:g.subscription)==null?void 0:n.planType;if(h===M.ZERO){const{dailyOperationCountService:b}=await X(async()=>{const{dailyOperationCountService:U}=await import("./dailyOperationCountService-Bsh4gYfW.js");return{dailyOperationCountService:U}},__vite__mapDeps([0,1,2]),import.meta.url),k=a.type==="send"?"transfer":"withdraw";if(!(await b.checkAndIncrement(s.uid,k,5)).allowed){j({title:"تم بلوغ حد باقة الزيرو",description:"مسموح بحد أقصى 5 تأكيدات يوميًا للتحويل/السحب. جرّب غدًا أو قم بالترقية.",variant:"destructive"});return}}else if(h===M.TAHWEELA){const{dailyOperationCountService:b}=await X(async()=>{const{dailyOperationCountService:U}=await import("./dailyOperationCountService-Bsh4gYfW.js");return{dailyOperationCountService:U}},__vite__mapDeps([0,1,2]),import.meta.url),k=a.type==="send"?"transfer":"withdraw";if(!(await b.checkAndIncrementCombined(s.uid,k,40)).allowed){j({title:"تم بلوغ حد باقة تحويله",description:"هذه الباقة تسمح بحد أقصى 40 عملية تحويل/سحب يومياً.",variant:"destructive"});return}}}catch(h){console.warn("تعذر التحقق من حد التأكيد اليومي:",h)}const i=await Ge.getById(s.uid);if(!(i!=null&&i.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const p=H(W,"dashboardData",i.shopId),c=await $(p);let f=c.exists()?Number(((o=c.data())==null?void 0:o.cashBalance)||0):0;const u=c.exists()?((r=c.data())==null?void 0:r.walletBalances)||{}:{},v=a.fromWallet||Object.keys(u)[0],S=!!(a!=null&&a.limitsReservedOnCreation),N=Number(a.withdrawnAmount??a.sentAmount??a.amount??0),l=a.type==="send"?"transfer":"withdraw";try{const{walletDailyLimitsService:h}=await X(async()=>{const{walletDailyLimitsService:k}=await import("./index-CZwBW8vR.js").then(L=>L.cN);return{walletDailyLimitsService:k}},__vite__mapDeps([1,2]),import.meta.url),b=await h.canPerformOperation(v,N,l);if(!S&&!b.canPerform){j({title:"تجاوز الحدود",description:String(b.message||"لا يمكن الإكمال لتجاوز الحد اليومي/الشهري"),variant:"destructive"});return}}catch{j({title:"فشل التحقق من الحدود",description:"حاول مجددًا بعد قليل",variant:"destructive"});return}let y=!1;if(a.type==="withdraw"){const h=a.fromWallet||Object.keys(u)[0],b=Number(a.withdrawnAmount??a.amount??0),k=Number(a.commission??0),L=!!(a!=null&&a.walletEffectAppliedOnCreation),U=!!(a!=null&&a.cashEffectAppliedOnCreation);if(!L&&h&&b>0){const Ue=u[h]||0;u[h]=Ue+b}U?f=f+b:f=f-b,y=!0,await De(p,{cashBalance:f,walletBalances:u})}else if(a.type==="send"){const h=Number(a.commission??0),b=Number((a==null?void 0:a.fee)??0),k=Number((a==null?void 0:a.sentAmount)??(a==null?void 0:a.transferredAmount)??a.amount??0),L=Math.max(0,k)+Math.max(0,b);L>0&&(f=f+L,await De(p,{cashBalance:f}),y=!0)}await De(H(W,"userTransactions",e),{status:"completed",confirmedAt:new Date});try{const h=a.fromWallet||Object.keys(u)[0],b=Number(a.withdrawnAmount??a.sentAmount??a.amount??0);if(h&&b>0&&!S){const{walletDailyLimitsService:k}=await X(async()=>{const{walletDailyLimitsService:L}=await import("./index-CZwBW8vR.js").then(U=>U.cN);return{walletDailyLimitsService:L}},__vite__mapDeps([1,2]),import.meta.url);await k.updateUsage(h,b,a.type==="send"?"transfer":"withdraw")}}catch{j({title:"فشل تحديث الحدود",description:"تجاوز حد اليوم/الشهر يمنع الإكمال",variant:"destructive"});return}try{const{ProfitService:h}=await X(async()=>{const{ProfitService:L}=await import("./profitService-BUBYCoKY.js");return{ProfitService:L}},__vite__mapDeps([3,1,2]),import.meta.url),b=h.calculateProfitFromTransaction({type:a.type==="send"?"transfer":"withdraw",amount:Number(a.amount||0),commission:Number(a.commission||0),fee:Number((a==null?void 0:a.fee)||0)});!!!(a!=null&&a.profitAddedOnCreation)&&b>0&&h.addProfit(b,s==null?void 0:s.uid)}catch{}G(h=>h.map(b=>b.id===e?{...b,status:"completed"}:b)),j({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),_e(!1)}catch(a){console.error("خطأ في إكمال المعاملة:",a),j({title:"فشل الإكمال",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},ht=async e=>{var n,o;try{const r=O.find(i=>i.id===e);if(!r||!s)return;G(i=>i.filter(p=>p.id!==e)),ee(i=>[{...r},...i]);let a=r.status;try{let i={};try{const u=await $(H(W,"userTransactions",e));if(i=u.exists()?u.data():{},i!=null&&i.status){const v=String(i.status).toLowerCase();v==="completed"||v==="confirmed"||v==="success"?a="completed":v==="pending"?a="pending":(v==="cancelled"||v==="failed")&&(a="cancelled")}}catch{}const p=e,c=String((i==null?void 0:i.transactionId)||(r==null?void 0:r.transactionId)||p),f=String((i==null?void 0:i.reference)||(i==null?void 0:i.transactionReference)||(r==null?void 0:r.reference)||(r==null?void 0:r.transactionReference)||"");await R.removeUserTransaction(s.uid,e),await de.saveDeletedTransaction({...r,userId:s.uid,originalTransactionId:e,transactionId:c,reference:f||void 0,permanent:!0});try{await de.permanentlyDeleteTransaction(e,s.uid)}catch{}}catch(i){console.warn("تعذر الحذف النهائي من قواعد البيانات في هذه الخطوة، سيتم الحذف من لائحة المحذوفات عند التنفيذ اليدوي للحذف النهائي:",i)}try{const i=await Ge.getById(s.uid);if(!(i!=null&&i.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const p=H(W,"dashboardData",i.shopId),c=await $(p);let f=c.exists()?Number(((n=c.data())==null?void 0:n.cashBalance)||0):0;const u=c.exists()?((o=c.data())==null?void 0:o.walletBalances)||{}:{},v=Number(r.withdrawnAmount??r.amount??0),S=Number(r.commission??0),N=r.fromWallet||Object.keys(u)[0],l=!!(r!=null&&r.walletEffectAppliedOnCreation);if(r.type==="send"){const y=Number(r.fee??0),h=Number((r==null?void 0:r.sentAmount)??(r==null?void 0:r.transferredAmount)??r.amount??0);if(a==="completed"&&(f=f-(h+y)),N&&h>0){const b=u[N]||0;u[N]=b+h}}else if(r.type==="withdraw"){if(a==="completed"){if(f=f+v,N&&v>0){const y=u[N]||0;u[N]=y-v}}else if(N&&l&&v>0){const y=u[N]||0;u[N]=y-v}}await De(p,{cashBalance:f,walletBalances:u})}catch(i){console.warn("فشل عكس تأثير الأرصدة محليًا:",i)}try{const i=r.fromWallet;if(i){const{walletDailyLimitsService:p}=await X(async()=>{const{walletDailyLimitsService:u}=await import("./index-CZwBW8vR.js").then(v=>v.cN);return{walletDailyLimitsService:u}},__vite__mapDeps([1,2]),import.meta.url),c=Number(r.withdrawnAmount??r.sentAmount??r.amount??0),f=r.type==="send"?"transfer":"withdraw";await p.rollbackUsage(i,c,f,r.createdAt)}}catch(i){console.warn("فشل استرجاع حدود المحفظة:",i)}try{const{ProfitService:i}=await X(async()=>{const{ProfitService:v}=await import("./profitService-BUBYCoKY.js");return{ProfitService:v}},__vite__mapDeps([3,1,2]),import.meta.url),{ReportsService:p}=await X(async()=>{const{ReportsService:v}=await import("./index-CZwBW8vR.js").then(S=>S.cM);return{ReportsService:v}},__vite__mapDeps([1,2]),import.meta.url),f={txnType:r.type==="send"?"send":"receive",amount:r.amount,commission:r.commission||0,createdAt:r.createdAt,status:"confirmed"},u=i.calculateProfitFromTransaction(f);u>0&&i.addProfit(-u,s.uid);try{p.removeTransactionEffects(r,s.uid)}catch{}}catch(i){console.warn("فشل تحديث التقارير/الأرباح بعد الحذف:",i)}}catch(r){console.error("خطأ أثناء حذف الإيصال:",r)}},xt=d.useRef(!1),ft=fs();d.useEffect(()=>{!(new URLSearchParams(ft.search).get("autoTestBalances")==="1")||xt.current||(xt.current=!0,(async()=>{var o,r,a,i,p,c;try{if(!s)return;const f=await Ge.getById(s.uid);if(!(f!=null&&f.shopId)){console.warn("autoTest: لا يوجد shopId للمستخدم، سيتم إيقاف الاختبار.");return}const u=H(W,"dashboardData",f.shopId),v=await $(u),S=v.exists()?Number(((o=v.data())==null?void 0:o.cashBalance)||0):0,N=v.exists()?((r=v.data())==null?void 0:r.walletBalances)||{}:{},l=Object.keys(N)[0]||void 0,y=100,h=5,b=await R.saveUserTransaction(s.uid,{senderPhone:"auto-test-sender",receiverPhone:"auto-test-receiver",amount:y,status:"pending",type:"withdraw",createdAt:new Date,reference:`AUTO-${Date.now()}`,commission:h,withdrawnAmount:y,fromWallet:l,cashierName:"AutoTest",commissionMode:"add",totalCharged:y+h,walletEffectAppliedOnCreation:!1});console.log("autoTest: تم إنشاء إيصال سحب تجريبي:",b),await ut(b);const k=await $(u),L=k.exists()?Number(((a=k.data())==null?void 0:a.cashBalance)||0):0,U=k.exists()?((i=k.data())==null?void 0:i.walletBalances)||{}:{},Ue=S-y+h,cs=l?Number(N[l]||0)+y:void 0;console.log("autoTest: توقع الدرج بعد الإكمال:",Ue,"فعلي:",L),l&&console.log("autoTest: توقع المحفظة بعد الإكمال:",cs,"فعلي:",U[l]),await ht(b);const Ne=await $(u),ds=Ne.exists()?Number(((p=Ne.data())==null?void 0:p.cashBalance)||0):0,ms=Ne.exists()?((c=Ne.data())==null?void 0:c.walletBalances)||{}:{};console.log("autoTest: تحقق نهائي — الدرج قبل/بعد الحذف:",S,ds),l&&console.log("autoTest: تحقق نهائي — المحفظة قبل/بعد الحذف:",N[l]||0,ms[l]||0),j({title:"اختبار الأرصدة (Firestore فقط)",description:"تم إنشاء/إكمال/حذف إيصال تجريبي والتحقق من الأرصدة.",variant:"default"})}catch(f){console.error("autoTest: فشل اختبار الأرصدة:",f),j({title:"فشل اختبار الأرصدة",description:"تحقق من الاتصال ووجود shopId والمحافظ في Firestore.",variant:"destructive"})}})())},[ft.search,s]);const ls=async()=>{var o,r,a;const e="alkaptin678678@gmail.com",n=(r=(o=He.currentUser)==null?void 0:o.email)==null?void 0:r.toLowerCase();if(!n||n!==e){j({title:"قيد الإنشاء",description:"ميزة الشحن متاحة لهذا الحساب فقط حالياً."});return}if(!ve||!oe||!je){j({title:"بيانات ناقصة",description:"يرجى إدخال رقم وشركة والمبلغ",variant:"destructive"});return}ct(!0);try{const p={vodafone_eg:"Vodafone",orange_eg:"Orange",etisalat_eg:"Etisalat",we_eg:"WE"}[oe]??oe,c=new AbortController,f=setTimeout(()=>c.abort(),15e3),u=await((a=He.currentUser)==null?void 0:a.getIdToken()),v=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...u?{Authorization:`Bearer ${u}`}:{}},body:JSON.stringify({phone:ve,countryCode:"EG",operator:p,amount:Number(je),useLocalAmount:!0}),signal:c.signal});clearTimeout(f);const S=await v.text();let N;try{N=JSON.parse(S)}catch{N={success:!1,message:S||"فشل قراءة استجابة الخادم"}}v.ok&&(N!=null&&N.success)?(j({title:"تم الشحن",description:(N==null?void 0:N.message)||"تم تنفيذ عملية الشحن بنجاح"}),ye(!1),nt(""),it(""),ot("")):j({title:"فشل الشحن",description:(N==null?void 0:N.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(i){console.error("Topup request error:",i),(i==null?void 0:i.name)==="AbortError"?j({title:"انتهت المهلة",description:"الخادم لم يستجب في الوقت المحدد. تأكد أن السيرفر يعمل.",variant:"destructive"}):j({title:"خطأ في الاتصال",description:"تعذر الاتصال بالخادم. حاول لاحقاً.",variant:"destructive"})}finally{ct(!1)}};return t.jsxs("div",{className:"fixed inset-0 overscroll-y-none overflow-y-auto bg-background p-4",children:[t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs(T,{variant:"ghost",size:"sm",onClick:()=>D("/user/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800",children:[t.jsx(Xs,{className:"h-4 w-4"}),"العودة"]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"المعاملات"})]}),t.jsxs(gs,{className:"card-modern fade-in-up",children:[t.jsxs(bs,{className:"pb-2 px-3 pt-3",children:[t.jsx(ys,{className:"text-sm font-bold",children:"المعاملات الأخيرة"}),t.jsxs("div",{className:"flex items-center gap-0.5 mt-1 relative",children:[t.jsxs("div",{className:"flex items-center gap-0.5 flex-1 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[t.jsx(Es,{className:"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors"}),t.jsx(Ve,{placeholder:"بحث...",value:V,onChange:e=>ne(e.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400"})]}),t.jsxs("div",{className:"flex items-center gap-1 mx-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 hover:border-purple-300 transition-all duration-200 hover:scale-105",onClick:()=>{const e=(se==null?void 0:se.simSubscription)||(s==null?void 0:s.simSubscription);let n=!1;e!=null&&e.active&&(e!=null&&e.endsAt)&&(e.endsAt.seconds?new Date(e.endsAt.seconds*1e3):new Date(e.endsAt))>new Date&&(n=!0),n?at(!0):Q(!0)},title:"إدارة الخطوط",children:t.jsx(vs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"hidden md:inline text-[10px] font-bold text-gray-700",children:"خطوط"})]}),t.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:Jt,title:"شرح التطبيق",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(Js,{className:"h-2.5 w-2.5"}),zt&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-600 rounded-full"})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شرح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 hover:border-purple-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(Y||B){j({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"});return}Le(!0)},title:"إدارة التقسيط",children:t.jsx(js,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تقسيط"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ea,{userId:s==null?void 0:s.uid,transactions:O}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"أرباح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:scale-105",onClick:()=>Lt(!0),title:"آلة حاسبة",children:t.jsx(Us,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"حاسبة"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 hover:border-green-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(Y){j({title:"الخطة الحالية لا تسمح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية."});return}Ft(!0)},title:"بيانات المبيعات",children:t.jsx($s,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مبيعات"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(T,{variant:"ghost",size:"sm",className:`h-5 w-5 p-0 rounded border transition-all duration-200 hover:scale-105 ${C||I?"bg-purple-100 text-purple-600 border-purple-300":"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200 hover:border-purple-300"}`,onClick:()=>Ut(!0),title:"اختيار التاريخ",children:[t.jsx(Et,{className:"h-2.5 w-2.5"}),(C||I)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-purple-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تاريخ"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 hover:border-orange-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(Y){j({title:"الخطة الحالية لا تسمح",description:"إدارة الديون غير متاحة في خطة زيرو. قم بالترقية."});return}Ie(!0)},title:"إدارة الديون",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(Ns,{className:"h-2.5 w-2.5"}),dt>0&&t.jsx("div",{className:"absolute -top-1 -right-1 z-10 min-w-[12px] h-[12px] px-[2px] bg-red-600 text-white rounded-full text-[8px] leading-[12px] flex items-center justify-center pointer-events-none ring-1 ring-white",children:dt})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"ديون"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(Y){j({title:"الخطة الحالية لا تسمح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية."});return}st(!0)},title:"الصيانة",children:t.jsx(ws,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"صيانه"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-violet-50 text-violet-600 hover:bg-violet-100 border border-violet-200 hover:border-violet-300 transition-all duration-200 hover:scale-105",onClick:()=>{D("/user/dashboard",{state:{openCashierShiftModal:!0}})},title:"يومية المكنة",children:t.jsx(qs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"المكنة"})]}),t.jsxs("div",{className:"hidden sm:flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(Y){j({title:"الخطة الحالية لا تسمح",description:"الفيز الائتمانية غير متاحة في خطة زيرو. قم بالترقية."});return}tt(!0)},title:"الفيز الائتمانية",children:t.jsx(As,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"فيز"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105 relative",onClick:()=>{ge(!0)},title:"تصفير المعاملات الأخيرة",children:[t.jsx(St,{className:"h-2.5 w-2.5"}),ss>0&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تصفير"})]}),(V||C||I)&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(T,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:()=>{ne(""),te(""),Z("")},title:"مسح",children:t.jsx("span",{className:"text-[10px] font-bold",children:"×"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مسح"})]})]})]})]}),t.jsx(Ts,{className:"px-3 pb-3",children:t.jsxs(Ls,{value:he,onValueChange:xe,className:"w-full",children:[t.jsxs(Is,{className:"hidden sm:grid w-full grid-cols-4 h-10 text-sm bg-gradient-to-r from-gray-50 via-blue-50/30 to-purple-50/30 border border-gray-200/60 rounded-md p-1 shadow-sm relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 opacity-0 hover:opacity-100 transition-all duration-200"}),t.jsxs(Se,{value:"all",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-blue-200/50 hover:bg-blue-50/80 hover:text-blue-700 group",children:[t.jsx("span",{className:"relative z-10",children:"الكل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(Se,{value:"send",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-green-200/50 hover:bg-green-50/80 hover:text-green-700 group",children:[t.jsx("span",{className:"relative z-10",children:"مرسل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(Se,{value:"withdraw",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-orange-200/50 hover:bg-orange-50/80 hover:text-orange-700 group",children:[t.jsx("span",{className:"relative z-10",children:"سحب"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-orange-500/10 to-amber-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(Se,{value:"deleted",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-rose-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-red-200/50 hover:bg-red-50/80 hover:text-red-700 group",children:[t.jsx("span",{className:"relative z-10",children:"محذوف"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-500/10 to-rose-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]})]}),t.jsx(ke,{value:"all",className:"mt-2 receipts-list",children:mt.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:mt.map((e,n)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>Fe(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[pt(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:`font-medium text-sm ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[F(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-red-600",children:["عمولة: ",F(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:`text-[10px] ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:`text-sm ${e.type==="withdraw"?"text-red-500":"text-green-600"}`,children:e.createdAt.toLocaleString("en-GB")})]})]}),t.jsxs("div",{className:"text-right",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-green-700",children:[F(e.amount)," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",F(e.withdrawnAmount)," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",F(e.sentAmount)," جنيه"]}),t.jsx(Ps,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?e.type==="withdraw"?"bg-red-100 text-red-800 border-red-300":e.type==="send"?"bg-green-100 text-green-800 border-green-300":"":e.type==="withdraw"?"bg-red-100 text-red-800":""}`,children:e.type==="withdraw"?"سحب":Be(e.status)})]})]},e.id))})}),t.jsx(ke,{value:"send",className:"mt-2 receipts-list",children:le.filter(e=>e.type==="send").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات إرسال محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:le.filter(e=>e.type==="send").map((e,n)=>t.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-card border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>Fe(e),children:[t.jsx("div",{className:"h-12 w-12 rounded-full flex items-center justify-center shrink-0 bg-green-50",children:t.jsx(Gs,{className:"h-6 w-6 text-green-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h4",{className:"text-base font-bold text-foreground truncate",children:e.receiverPhone}),t.jsxs("span",{className:"text-base font-bold text-green-600 whitespace-nowrap",children:["- ",F(e.amount)," ج.م"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["إلى: ",e.receiverPhone]}),t.jsx("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:e.createdAt.toLocaleString("ar-EG",{day:"numeric",month:"short",hour:"numeric",minute:"numeric",hour12:!0})})]}),t.jsxs("div",{className:`px-2.5 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${e.status==="completed"?"bg-green-50 text-green-700":e.status==="pending"?"bg-yellow-50 text-yellow-700":"bg-red-50 text-red-700"}`,children:[e.status==="completed"&&t.jsx(kt,{className:"h-3 w-3"}),e.status==="pending"&&t.jsx(pe,{className:"h-3 w-3"}),e.status==="failed"&&t.jsx(Ot,{className:"h-3 w-3"}),t.jsx("span",{children:Be(e.status)})]})]})]})]},e.id))})}),t.jsx(ke,{value:"withdraw",className:"mt-2 receipts-list",children:le.filter(e=>e.type==="withdraw").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات سحب محفوظة بعد"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:le.filter(e=>e.type==="withdraw").map((e,n)=>t.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-card border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>Fe(e),children:[t.jsx("div",{className:"h-12 w-12 rounded-full flex items-center justify-center shrink-0 bg-red-50",children:t.jsx(qe,{className:"h-6 w-6 text-red-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h4",{className:"text-base font-bold text-foreground truncate",children:e.receiverPhone}),t.jsxs("span",{className:"text-base font-bold text-red-600 whitespace-nowrap",children:["+ ",F(e.amount)," ج.م"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["من: ",e.senderPhone]}),t.jsx("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:e.createdAt.toLocaleString("ar-EG",{day:"numeric",month:"short",hour:"numeric",minute:"numeric",hour12:!0})})]}),t.jsxs("div",{className:`px-2.5 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${e.status==="completed"?"bg-red-50 text-red-700":e.status==="pending"?"bg-yellow-50 text-yellow-700":"bg-red-50 text-red-700"}`,children:[e.status==="completed"&&t.jsx(kt,{className:"h-3 w-3"}),e.status==="pending"&&t.jsx(pe,{className:"h-3 w-3"}),e.status==="failed"&&t.jsx(Ot,{className:"h-3 w-3"}),t.jsx("span",{children:Be(e.status)})]})]})]})]},e.id))})}),t.jsx(ke,{value:"deleted",className:"mt-2",children:ae.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محذوفة"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ae.map((e,n)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[pt(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[F(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-500",children:["عمولة: ",F(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"text-right mr-2",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[F(e.amount)," جنيه"]}),t.jsx(StatusChip,{variant:"error",text:"محذوف"})]}),t.jsx(T,{variant:"ghost",size:"sm",className:"text-green-600 hover:bg-green-100 h-10 sm:h-12 px-4 sm:px-5 min-w-[44px] touch-manipulation",onClick:()=>rs(e),children:t.jsx("span",{className:"text-xs sm:text-sm",children:"استرجاع"})}),t.jsx(T,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 h-10 sm:h-12 px-3 sm:px-4 min-w-[44px] touch-manipulation",onClick:()=>os(e.id),children:t.jsx(St,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})]},e.id))})})]})})]}),t.jsx(Oe,{open:Wt,onOpenChange:Ke,children:t.jsxs(Re,{className:"dialog-modern max-w-3xl w-full p-0 overflow-hidden border-0 shadow-2xl",children:[t.jsx(Pe,{className:"px-4 pt-4",children:t.jsx(Ee,{className:"text-lg font-bold",children:Mt||"شرح التطبيق"})}),t.jsx("div",{className:"aspect-video w-full bg-black",children:Ze?t.jsx("iframe",{src:Zt(Ze),title:"Application Guide",className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0}):t.jsx("div",{className:"flex items-center justify-center h-full text-white/80",children:"لا يوجد فيديو متاح حالياً"})})]})}),t.jsx(Bs,{open:Vt,onOpenChange:st})]}),t.jsx(Ms,{isOpen:Gt,onClose:()=>tt(!1)}),t.jsx(Xe,{open:$t,onOpenChange:Ie,mode:"verify",title:"الرقم السري الرئيسي لفتح الديون",description:"أدخل الرقم السري الرئيسي لفتح صفحة الديون",userId:s==null?void 0:s.uid,userRole:x==null?void 0:x.role,onSuccess:()=>{Ie(!1),D("/user",{state:{openDebtDialog:!0}})}}),t.jsx(Ds,{open:Yt,onOpenChange:ge,title:"تأكيد كلمة المرور لإخفاء المعاملات السابقة من العرض",description:"سيتم إخفاء كل المعاملات السابقة من شاشة المعاملات والتقارير فقط، ولن تُحذف نهائيًا من حسابك أو من Firebase.",onSuccess:async()=>{try{if(!(s!=null&&s.uid)){ge(!1);return}const e=new Date,n=o=>o instanceof Date?o:typeof(o==null?void 0:o.toDate)=="function"?o.toDate():new Date(String(o));await R.updateUserData(s.uid,{recentReset:{keepLastCount:rt.keepLastCount??30,intervalDays:rt.intervalDays??7,lastResetAt:e}}),be(o=>({...o,lastResetAt:e})),j({title:"تم إخفاء المعاملات السابقة",description:"تم إخفاء كل الإيصالات الأقدم من وقت التصفير من العرض بدون التأثير على التقارير اليومية/الشهرية أو الحدود."})}catch(e){console.error("فشل تنفيذ التصفير النهائي:",e),j({title:"فشل التصفير",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}finally{ge(!1)}}}),t.jsx(Oe,{open:Qt,onOpenChange:e=>{var n,o;if(e){const r="alkaptin678678@gmail.com",a=(o=(n=He.currentUser)==null?void 0:n.email)==null?void 0:o.toLowerCase();if(!a||a!==r){j({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."});return}ye(!0)}else ye(!1)},children:t.jsxs(Re,{dir:"rtl",className:"sm:max-w-md",children:[t.jsx(Pe,{children:t.jsx(Ee,{children:"شحن رصيد الموبايل"})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"رقم الموبايل"}),t.jsx(Ve,{value:ve,onChange:e=>nt(e.target.value),placeholder:"01XXXXXXXXX",dir:"ltr"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"الشركة"}),t.jsxs(Ss,{value:oe,onValueChange:it,children:[t.jsx(ks,{className:"w-full",children:t.jsx(Os,{placeholder:"اختر الشركة"})}),t.jsxs(Rs,{children:[t.jsx(Ce,{value:"vodafone_eg",children:"فودافون"}),t.jsx(Ce,{value:"orange_eg",children:"أورنج"}),t.jsx(Ce,{value:"etisalat_eg",children:"اتصالات"}),t.jsx(Ce,{value:"we_eg",children:"WE"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"المبلغ بالجنيه"}),t.jsx(Ve,{type:"number",min:1,value:je,onChange:e=>ot(e.target.value?Number(e.target.value):""),placeholder:"50"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-2",children:[t.jsx(T,{variant:"outline",onClick:()=>ye(!1),children:"إلغاء"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(T,{variant:"secondary",onClick:()=>D("/topup"),children:"صفحة الشحن الكاملة"}),t.jsx(T,{onClick:ls,disabled:lt||!ve||!oe||!je,children:lt?"جارٍ التنفيذ...":"تأكيد الشحن"})]})]})]})]})}),t.jsx(Oe,{open:A,onOpenChange:P,children:t.jsxs(Re,{className:"sm:max-w-[460px]",children:[t.jsxs(Pe,{children:[t.jsx(Ee,{children:"تأكيد استرجاع الإيصال"}),t.jsx(Cs,{children:"سيتم إعادة الإيصال إلى قائمة المعاملات الحالية."})]}),_&&t.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"المبلغ"}),t.jsxs("span",{className:"font-bold",children:[_.amount," جنيه"]})]}),_.type==="withdraw"?t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"العميل"}),t.jsx("span",{className:"font-medium",children:_.receiverPhone})]}):t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"من → إلى"}),t.jsxs("span",{className:"font-medium",children:[_.senderPhone," → ",_.receiverPhone]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"الكاشير"}),t.jsx("span",{className:"font-medium",children:_.cashierName??"الحساب الرئيسي"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"التاريخ"}),t.jsx("span",{className:"font-medium",children:_.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3",children:[t.jsx(T,{variant:"outline",onClick:()=>{P(!1),re(null)},children:"إلغاء"}),t.jsx(T,{onClick:ns,children:"تأكيد الاسترجاع"})]})]})}),t.jsx(_s,{isOpen:Ht,onClose:()=>_e(!1),transaction:Xt,onPrint:()=>window.print(),onDelete:ht,onComplete:ut}),t.jsx(Xe,{open:It,onOpenChange:Le,mode:"verify",title:"فتح إدارة التقسيط",description:"أدخل الرقم السري الرئيسي للوصول إلى إدارة التقسيط",userId:s==null?void 0:s.uid,userRole:x==null?void 0:x.role,onSuccess:()=>{Le(!1),Ye(!0)}}),t.jsx(Ws,{open:_t,onOpenChange:Ye}),t.jsx(zs,{isOpen:Kt,onClose:()=>at(!1),shopId:x==null?void 0:x.shopId}),t.jsx(Vs,{isOpen:q,onClose:()=>Q(!1),userId:(s==null?void 0:s.uid)||"",userEmail:(s==null?void 0:s.email)||""})]})};export{Ma as default};
//# sourceMappingURL=TransactionsPage-BuD1UgjB.js.map
