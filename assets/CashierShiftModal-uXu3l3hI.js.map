{"version":3,"file":"CashierShiftModal-uXu3l3hI.js","sources":["../../src/components/CashierShiftModal.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useShift } from '@/contexts/ShiftContext';\r\n// تم الاستغناء عن التحقق عبر رقم المدير (PIN) ضمن تسليم الورديه داخل هذه النافذة\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { getLastTransactions } from '@/integrations/firebase/functions';\r\nimport { userDataService } from '@/integrations/firebase/services';\r\nimport { WalletCashService } from '@/utils/walletCashService';\r\nimport { db } from '@/firebase';\r\nimport { doc, getDoc, setDoc } from 'firebase/firestore';\r\n// إعادة استخدام خدمات حساب أرصدة المحافظ لحساب الإجمالي\r\n\r\ninterface Props {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nconst CashierShiftModal: React.FC<Props> = ({ open, onOpenChange }) => {\r\n  const { shiftUser, isShiftActive, shiftStartAt, setShiftUser, startShift, endShift } = useShift();\r\n  const { userSubscription, user, signIn, profile } = useFirebaseAuth();\r\n  const { toast } = useToast();\r\n  const [name, setName] = useState(shiftUser?.name || '');\r\n  const [username, setUsername] = useState(shiftUser?.username || '');\r\n  const [password, setPassword] = useState('');\r\n  const [handoverDialogOpen, setHandoverDialogOpen] = useState(false);\r\n  const [handoverMode, setHandoverMode] = useState<'toAdmin' | 'toUser' | null>(null);\r\n  const [mainPassword, setMainPassword] = useState('');\r\n  const [mainAuthError, setMainAuthError] = useState('');\r\n  const [isVerifyingMain, setIsVerifyingMain] = useState(false);\r\n  const [handoverSelectedUser, setHandoverSelectedUser] = useState<CashierUser | null>(null);\r\n  const [handoverPassword, setHandoverPassword] = useState('');\r\n  const [handoverError, setHandoverError] = useState('');\r\n  const [isHandoverProcessing, setIsHandoverProcessing] = useState(false);\r\n  const [reportDialogOpen, setReportDialogOpen] = useState(false);\r\n  const [reportTotals, setReportTotals] = useState<{ totalTransfers: number; totalWithdrawals: number }>({ totalTransfers: 0, totalWithdrawals: 0 });\r\n  const [deficitChoice, setDeficitChoice] = useState<'yes' | 'no' | null>(null);\r\n  const [deficitAmount, setDeficitAmount] = useState('');\r\n  // حقول النقدية والمحافظ للإيصال\r\n  const [receivedDrawerFunds, setReceivedDrawerFunds] = useState(''); // الفلوس النقدية المستلمة عند بداية الورديه\r\n  const [receivedWalletBalancesTotal, setReceivedWalletBalancesTotal] = useState<number>(0); // أرصدة المحافظ المستلمة (إجمالي)\r\n  const [receivedWalletBalancesMap, setReceivedWalletBalancesMap] = useState<Record<string, number>>({}); // تفصيل أرصدة المحافظ المستلمة\r\n  const [deliveredDrawerFunds, setDeliveredDrawerFunds] = useState<number>(0); // الفلوس النقدية المسلمة عند نهاية الورديه\r\n  const [deliveredWalletBalancesTotal, setDeliveredWalletBalancesTotal] = useState<number>(0); // أرصدة المحافظ المسلمة (إجمالي)\r\n  const [deliveredWalletBalancesMap, setDeliveredWalletBalancesMap] = useState<Record<string, number>>({}); // تفصيل أرصدة المحافظ عند التسليم\r\n  const [handoverTargetLabel, setHandoverTargetLabel] = useState<string>('');\r\n  // نافذة إدخال أرصدة البداية والنقدية مباشرةً بعد الدخول\r\n  const [initialIntakeDialogOpen, setInitialIntakeDialogOpen] = useState(false);\r\n\r\n  const normalizeDigits = (s: string) => {\r\n    const map: Record<string, string> = {\r\n      '٠':'0','١':'1','٢':'2','٣':'3','٤':'4','٥':'5','٦':'6','٧':'7','٨':'8','٩':'9',\r\n      '۰':'0','۱':'1','۲':'2','۳':'3','۴':'4','۵':'5','۶':'6','۷':'7','۸':'8','۹':'9',\r\n      '٫':'.','،':'.','٬':'.',' ':'',\r\n    };\r\n    return s.split('').map(ch => map[ch] ?? ch).join('');\r\n  };\r\n\r\n  type CashierUser = { name: string; username: string; password: string };\r\n  // مفتاح محلي مرتبط بالمستخدم لضمان عدم فقد القائمة بعد التحديث أو تبديل الحساب\r\n  const getCashierUsersKey = () => `cashierUsers_${user?.uid || 'default'}`;\r\n  const [users, setUsers] = useState<CashierUser[]>(() => {\r\n    try {\r\n      // اقرأ أولاً من المفتاح المرتبط بالمستخدم\r\n      let saved = localStorage.getItem(getCashierUsersKey());\r\n      // هجرة ودعم المفتاح القديم غير المربوط بالمستخدم\r\n      if (!saved) {\r\n        const legacy = localStorage.getItem('cashierUsers');\r\n        if (legacy) {\r\n          saved = legacy;\r\n        }\r\n      }\r\n      return saved ? JSON.parse(saved) : [];\r\n    } catch {\r\n      return [];\r\n    }\r\n  });\r\n\r\n  // حالة للتأكد من اكتمال الجلب الأولي لتجنب الكتابة فوق البيانات السحابية بقائمة فارغة\r\n  const [isDataLoaded, setIsDataLoaded] = useState(false);\r\n\r\n  // جلب مستخدمي الوردية من Firestore أو LocalStorage عند تحميل المكون أو تغيير المستخدم\r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n    \r\n    const fetchCashierUsers = async () => {\r\n      let foundInCloud = false;\r\n      try {\r\n        const ref = doc(db, 'profiles', user.uid, 'cashierUsers', 'list');\r\n        const snap = await getDoc(ref);\r\n        if (snap.exists()) {\r\n          const data = snap.data() as any;\r\n          const cloudUsers: CashierUser[] = Array.isArray(data?.users) ? data.users : [];\r\n          if (cloudUsers.length > 0) {\r\n            setUsers(cloudUsers);\r\n            foundInCloud = true;\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.warn('Failed to fetch cashierUsers from Firestore:', err);\r\n      }\r\n\r\n      // في حال عدم وجود بيانات في السحابة (أو فشل الجلب)، حاول استرجاعها من التخزين المحلي\r\n      if (!foundInCloud) {\r\n        try {\r\n          const saved = localStorage.getItem(getCashierUsersKey());\r\n          const localUsers: CashierUser[] = saved ? JSON.parse(saved) : [];\r\n          if (localUsers.length > 0) {\r\n            setUsers(localUsers);\r\n          } else {\r\n             // إذا لم يوجد في السحابة ولا محلياً، نترك الحالة كما هي (فارغة أو محملة مبدئياً)\r\n             // لكن يمكننا التصفير إذا كنا متأكدين\r\n             if (users.length > 0) setUsers([]); \r\n          }\r\n        } catch {\r\n          // ignore\r\n        }\r\n      }\r\n      setIsDataLoaded(true);\r\n    };\r\n    \r\n    fetchCashierUsers();\r\n  }, [user?.uid]);\r\n\r\n  // تحديد الحد الأقصى للمستخدمين حسب الباقة\r\n  const planType = userSubscription?.subscription?.planType as ('monthly' | 'yearly' | 'lifetime' | undefined);\r\n  const maxCashiers = planType === 'yearly' ? 2 : planType === 'lifetime' ? 4 : Number.POSITIVE_INFINITY;\r\n\r\n  useEffect(() => {\r\n    try {\r\n      // احفظ تحت المفتاح المرتبط بالمستخدم\r\n      localStorage.setItem(getCashierUsersKey(), JSON.stringify(users));\r\n      // نظّف المفتاح القديم إن وُجد للحفاظ على الاتساق (اختياري)\r\n      try { localStorage.removeItem('cashierUsers'); } catch {}\r\n    } catch {}\r\n\r\n    // حفظ نسخة في السحابة أيضًا\r\n    const saveToCloud = async () => {\r\n      try {\r\n        if (!user?.uid) return;\r\n        // لا نحفظ قائمة فارغة في السحابة إلا إذا تأكدنا من اكتمال التحميل الأولي\r\n        if (users.length === 0 && !isDataLoaded) return;\r\n\r\n        const ref = doc(db, 'profiles', user.uid, 'cashierUsers', 'list');\r\n        await setDoc(ref, { users }, { merge: true });\r\n      } catch (e) {\r\n        console.warn('Failed to save cashierUsers to Cloud:', e);\r\n      }\r\n    };\r\n    saveToCloud();\r\n  }, [users, isDataLoaded, user?.uid]);\r\n\r\n  const [authDialogOpen, setAuthDialogOpen] = useState(false);\r\n  const [enteredPassword, setEnteredPassword] = useState('');\r\n  const [selectedUser, setSelectedUser] = useState<CashierUser | null>(null);\r\n  // تقارير التسليم المحفوظة محلياً\r\n  const [deliveryReports, setDeliveryReports] = useState<any[]>([]);\r\n  const [deliveryReportsDialogOpen, setDeliveryReportsDialogOpen] = useState(false);\r\n  // عرض إيصال تقرير التسليم عند الضغط على أي تقرير في الموبايل\r\n  const [selectedDeliveryReport, setSelectedDeliveryReport] = useState<any | null>(null);\r\n  const [isDeliveryReportOpen, setIsDeliveryReportOpen] = useState(false);\r\n  // نافذة إضافة مستخدم جديد\r\n  const [addUserDialogOpen, setAddUserDialogOpen] = useState(false);\r\n\r\n  const handleDeleteUser = (usernameToDelete: string) => {\r\n    const isCurrentShiftUser = shiftUser?.username === usernameToDelete;\r\n    let lastHandoverToAdmin = false;\r\n    try { lastHandoverToAdmin = localStorage.getItem('lastHandoverToAdmin') === 'true'; } catch {}\r\n    const handedToAdmin = handoverTargetLabel === 'الأدمن الرئيسي' || lastHandoverToAdmin;\r\n    const canDeleteCurrentShiftUser = isCurrentShiftUser && !isShiftActive && handedToAdmin;\r\n\r\n    // إن كان المستخدم الجاري هو مستخدم الوردية الحالي، لا نسمح بالحذف إلا إذا تم تسليمها للأدمن الرئيسي وانتهت الوردية\r\n    if (isCurrentShiftUser && !canDeleteCurrentShiftUser) {\r\n      toast({ title: 'لا يمكن الحذف', description: 'لا يمكنك حذف مستخدم الوردية أثناء كونها نشطة أو قبل تسليمها للأدمن الرئيسي' });\r\n      return;\r\n    }\r\n\r\n    const confirmMsg = `هل أنت متأكد من حذف المستخدم ${usernameToDelete}؟\\n\\nهذا الإجراء لا يمكن التراجع عنه.`;\r\n    if (!window.confirm(confirmMsg)) return;\r\n\r\n    setUsers((prev) => prev.filter((u) => u.username !== usernameToDelete));\r\n\r\n    // في حال كان المستخدم المحذوف هو المستخدم المحدد للوردية، نقوم بإلغاء تعيينه من السياق بعد التسليم للأدمن\r\n    if (isCurrentShiftUser) {\r\n      setShiftUser(null);\r\n    }\r\n\r\n    toast({ title: 'تم حذف المستخدم', description: usernameToDelete });\r\n  };\r\n\r\n  const handleAddUser = () => {\r\n    if (!name.trim() || !username.trim() || !password.trim()) return;\r\n    if (users.length >= maxCashiers) {\r\n      toast({\r\n        title: 'وصلت الحد الأقصى للمستخدمين',\r\n        description: `هذه الباقة تسمح بإضافة ${Number.isFinite(maxCashiers) ? maxCashiers : 'عدد غير محدود'} كاشير فقط`,\r\n        variant: 'destructive',\r\n      });\r\n      return;\r\n    }\r\n    const newUser: CashierUser = { name: name.trim(), username: username.trim(), password: password.trim() };\r\n    setUsers(prev => [newUser, ...prev]);\r\n    // لا يتم الدخول مباشرةً، يتم الحفظ فقط تحت التسجيل\r\n    setName('');\r\n    setUsername('');\r\n    setPassword('');\r\n  };\r\n\r\n  const handleStartShift = () => {\r\n    // بدء الورديه يفضل أن يتم عبر اختيار مستخدم محفوظ وكلمة السر\r\n    if (!shiftUser) return;\r\n    // إعادة ضبط علم آخر تسليم للأدمن عند بدء وردية جديدة\r\n    try { localStorage.setItem('lastHandoverToAdmin', 'false'); } catch {}\r\n    startShift();\r\n  };\r\n\r\n  const handleEndShift = () => {\r\n    // عند تسليم الورديه، يختار المستخدم: التسليم لمستخدم آخر أم للأدمن الرئيسي\r\n    setHandoverDialogOpen(true);\r\n    setHandoverMode(null);\r\n    setHandoverSelectedUser(null);\r\n    setHandoverPassword('');\r\n    setHandoverError('');\r\n  };\r\n\r\n  const computeShiftTotals = async () => {\r\n    try {\r\n      // 1) المصدر الأساسي: معاملات المستخدم من Firestore\r\n      let transactions: any[] = [];\r\n      try {\r\n        if (user?.uid) {\r\n          transactions = await userDataService.getUserTransactions(user.uid);\r\n        }\r\n      } catch {}\r\n\r\n      // 2) إن لم نجد بيانات (أو كانت صفرية)، اجلب آخر المعاملات من وظائف السحابة\r\n      if (!transactions || transactions.length === 0) {\r\n        try {\r\n          const res = await getLastTransactions({ merchantUserId: user?.uid, limit: 200 });\r\n          transactions = res?.transactions || [];\r\n        } catch {\r\n          // تجاهل أي خطأ في الجلب الخارجي\r\n        }\r\n      }\r\n\r\n      // إزالة الاعتماد على التخزين المحلي لضمان المزامنة عبر الأجهزة\r\n\r\n      const startTime = shiftStartAt ? new Date(shiftStartAt) : null;\r\n      const now = new Date();\r\n\r\n      const isWithdrawTx = (t: any) => {\r\n        const type = t.type;\r\n        const xn = (t as any).txnType;\r\n        return (\r\n          type === 'withdraw' ||\r\n          type === 'withdrawal' ||\r\n          type === 'receive' ||\r\n          xn === 'receive'\r\n        );\r\n      };\r\n\r\n      const isSendTx = (t: any) => {\r\n        const type = t.type;\r\n        const xn = (t as any).txnType;\r\n        return (\r\n          type === 'send' ||\r\n          type === 'transfer' ||\r\n          xn === 'send'\r\n        );\r\n      };\r\n\r\n      const parseDate = (val: any) => {\r\n        if (!val) return null;\r\n        if (val instanceof Date) return val;\r\n        // قد يأتي كنص ISO أو Timestamp من Firebase\r\n        try {\r\n          const d = new Date(val);\r\n          return Number.isNaN(d.getTime()) ? null : d;\r\n        } catch {\r\n          return null;\r\n        }\r\n      };\r\n\r\n      const inShiftWindow = (t: any) => {\r\n        const created = parseDate((t as any).createdAt || (t as any).created_at || (t as any).timestamp);\r\n        if (!created) return false;\r\n        if (startTime && created < startTime) return false;\r\n        return created <= now;\r\n      };\r\n\r\n      const isCompletedStatus = (s: any) => {\r\n        return s === 'completed' || s === 'confirmed'; // توافق بين مخططات الواجهة وFirebase\r\n      };\r\n\r\n      const completed = transactions.filter((t: any) => isCompletedStatus(t.status) && inShiftWindow(t));\r\n\r\n      const totalWithdrawals = completed\r\n        .filter((t: any) => isWithdrawTx(t))\r\n        .reduce((sum: number, t: any) => {\r\n          const amount = (t as any).withdrawnAmount ?? (t as any).receivedAmount ?? (t as any).amount ?? 0;\r\n          return sum + (Number(amount) || 0);\r\n        }, 0);\r\n\r\n      const totalTransfers = completed\r\n        .filter((t: any) => isSendTx(t))\r\n        .reduce((sum: number, t: any) => {\r\n          const amount = (t as any).sentAmount ?? (t as any).transferredAmount ?? (t as any).amount ?? 0;\r\n          return sum + (Number(amount) || 0);\r\n        }, 0);\r\n\r\n      return { totalTransfers, totalWithdrawals };\r\n    } catch {\r\n      return { totalTransfers: 0, totalWithdrawals: 0 };\r\n    }\r\n  };\r\n\r\n  // وضع إدخال يدوي: لا نقوم بأي تعبئة تلقائية عند فتح تقرير التسليم\r\n  useEffect(() => {\r\n    if (!reportDialogOpen) return;\r\n    // عند فتح التقرير، نملأ القيم تلقائياً من إدخال البداية إن وُجدت\r\n    try {\r\n      const d = localStorage.getItem('shiftInitialReceivedDrawerFunds');\r\n      if (d !== null) setReceivedDrawerFunds(d);\r\n    } catch {}\r\n    try {\r\n      const w = localStorage.getItem('shiftInitialReceivedWalletBalancesTotal');\r\n      if (w !== null) {\r\n        const v = parseFloat(w);\r\n        setReceivedWalletBalancesTotal(Number.isFinite(v) ? v : 0);\r\n      }\r\n    } catch {}\r\n  }, [reportDialogOpen]);\r\n\r\n  useEffect(() => {\r\n    if (!handoverDialogOpen) return;\r\n    (async () => {\r\n      try {\r\n        const t = await computeShiftTotals();\r\n        setReportTotals(t);\r\n      } catch {}\r\n    })();\r\n  }, [handoverDialogOpen]);\r\n\r\n  // تحميل تقارير التسليم لعرضها داخل صفحة إضافة المستخدم\r\n  useEffect(() => {\r\n    if (!open && !deliveryReportsDialogOpen) return;\r\n    const loadReports = async () => {\r\n      try {\r\n        const txs = user?.uid ? await userDataService.getUserTransactions(user.uid) : [];\r\n        const reports = (txs || []).filter((t: any) => t?.type === 'report' || (t?.title || '').includes('إيصال تسليم وردية'));\r\n        reports.sort((a: any, b: any) => {\r\n          const ad = new Date(a.createdAt || 0).getTime();\r\n          const bd = new Date(b.createdAt || 0).getTime();\r\n          return bd - ad;\r\n        });\r\n        setDeliveryReports(reports);\r\n      } catch {\r\n        setDeliveryReports([]);\r\n      }\r\n    };\r\n    loadReports();\r\n  }, [open, reportDialogOpen, deliveryReportsDialogOpen, user?.uid]);\r\n\r\n  const saveShiftReceiptToRecent = async (totals: { totalTransfers: number; totalWithdrawals: number }, deficit: boolean, deficitAmt: number) => {\r\n    try {\r\n      // قراءة قيَم البداية المحفوظة لمنع أي تعديل عليها عند التسليم\r\n      let initialDrawerFunds = 0;\r\n      let initialWalletBalancesTotal = 0;\r\n      try {\r\n        const d = parseFloat(localStorage.getItem('shiftInitialReceivedDrawerFunds') || '0');\r\n        initialDrawerFunds = Number.isFinite(d) ? d : 0;\r\n      } catch {}\r\n      try {\r\n        const w = parseFloat(localStorage.getItem('shiftInitialReceivedWalletBalancesTotal') || '0');\r\n        initialWalletBalancesTotal = Number.isFinite(w) ? w : 0;\r\n      } catch {}\r\n      const receipt = {\r\n        id: `shift_receipt_${Date.now()}`,\r\n        type: 'report',\r\n        senderPhone: shiftUser?.username || 'cashier',\r\n        receiverPhone: handoverTargetLabel || 'admin',\r\n        amount: 0,\r\n        status: 'completed',\r\n        createdAt: new Date().toISOString(),\r\n        title: 'إيصال تسليم وردية',\r\n        // تثبيت اسم الكاشير على إيصال التسليم حتى بعد انتهاء الوردية\r\n        cashierName: shiftUser?.name || shiftUser?.username || null,\r\n        deficit: deficit,\r\n        deficitAmount: deficit ? deficitAmt : 0,\r\n        shiftStartAt,\r\n        // حقول النقدية والمحافظ\r\n        receivedDrawerFunds: initialDrawerFunds,\r\n        receivedWalletBalancesTotal: initialWalletBalancesTotal,\r\n        receivedWalletBalances: receivedWalletBalancesMap,\r\n        deliveredDrawerFunds: deliveredDrawerFunds || 0,\r\n        deliveredWalletBalancesTotal: deliveredWalletBalancesTotal || 0,\r\n        deliveredWalletBalances: deliveredWalletBalancesMap,\r\n        // ربح الوردية المحسوب من القيم الموثّقة\r\n        shiftProfit: Math.round((((deliveredDrawerFunds || 0) + (deliveredWalletBalancesTotal || 0)) - (initialDrawerFunds + initialWalletBalancesTotal)) * 100) / 100,\r\n      };\r\n\r\n      if (user?.uid) {\r\n        await userDataService.saveUserTransaction(user.uid, receipt);\r\n      }\r\n\r\n      // حدِّث قائمة تقارير التسليم في الواجهة فورًا\r\n      setDeliveryReports(prev => [receipt, ...(prev || [])]);\r\n    } catch {}\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={open} onOpenChange={onOpenChange}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n        <DialogTitle>{isShiftActive ? 'تسليم الورديه والخروج' : 'إضافة مستخدم وردية'}</DialogTitle>\r\n          </DialogHeader>\r\n          {!isShiftActive ? (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"text-xs text-gray-600\">لاستكمال إضافة مستخدم جديد اضغط الزر أسفل \"إضافة مستخدم جديد\" لفتح النموذج.</div>\r\n\r\n              {/* قائمة المستخدمين المسجلين */}\r\n              {users.length > 0 && (\r\n                <div className=\"mt-4 border-t pt-3\">\r\n                  <div className=\"text-sm font-medium mb-2\">المستخدمون المسجلون</div>\r\n                  <div className=\"space-y-2 max-h-48 overflow-auto\">\r\n                    {users.map((u, idx) => (\r\n                      <div key={idx} className=\"flex items-center justify-between rounded border px-3 py-2\">\r\n                        <div>\r\n                          <div className=\"text-sm font-semibold\">{u.name}</div>\r\n                          <div className=\"text-xs text-gray-500\">{u.username}</div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2 flex-wrap\">\r\n                          <Button size=\"sm\" className=\"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white\" onClick={() => { setSelectedUser(u); setAuthDialogOpen(true); }}>دخول</Button>\r\n                          <Button size=\"sm\" className=\"w-full sm:w-auto\" variant=\"destructive\" onClick={() => handleDeleteUser(u.username)}>حذف</Button>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"p-3 rounded border bg-gray-50\">\r\n                <div className=\"text-sm\">المستخدم الحالي للوردية:</div>\r\n                <div className=\"font-semibold text-sm\">{shiftUser?.name} ({shiftUser?.username})</div>\r\n              </div>\r\n            <div className=\"text-xs text-gray-600\">لإنهاء الوردية والخروج، اضغط \"تسليم الورديه والخروج\" وسيُطلب الرقم السري.</div>\r\n            </div>\r\n          )}\r\n          <DialogFooter className=\"flex flex-wrap gap-2 justify-between\">\r\n            {!isShiftActive ? (\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                <Button className=\"w-full sm:w-auto bg-emerald-600 hover:bg-emerald-700 text-white\" onClick={() => setAddUserDialogOpen(true)}>إضافة مستخدم جديد</Button>\r\n                <Button className=\"w-full sm:w-auto\" variant=\"outline\" onClick={() => setDeliveryReportsDialogOpen(true)}>إيصالات التسليم</Button>\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                <Button className=\"w-full sm:w-auto\" variant=\"destructive\" onClick={handleEndShift}>تسليم الورديه والخروج</Button>\r\n              </div>\r\n            )}\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* نافذة إضافة مستخدم جديد */}\r\n      <Dialog open={addUserDialogOpen} onOpenChange={setAddUserDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>إضافة مستخدم جديد</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <Label className=\"mb-1 block\">الاسم</Label>\r\n              <Input value={name} onChange={(e) => setName(e.target.value)} placeholder=\"أدخل الاسم\" />\r\n            </div>\r\n            <div>\r\n              <Label className=\"mb-1 block\">اسم المستخدم</Label>\r\n              <Input value={username} onChange={(e) => setUsername(e.target.value)} placeholder=\"أدخل اسم المستخدم\" />\r\n            </div>\r\n            <div>\r\n              <Label className=\"mb-1 block\">الرقم السري</Label>\r\n              <Input type=\"password\" autoComplete=\"new-password\" value={password} onChange={(e) => setPassword(e.target.value)} placeholder=\"أدخل الرقم السري\" />\r\n            </div>\r\n            <div className=\"text-xs text-gray-500\">المستخدم يمكنه: التحويل، السحب، اختيار المحفظة فقط.</div>\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              variant=\"secondary\"\r\n              onClick={() => {\r\n                setAddUserDialogOpen(false);\r\n              }}\r\n            >إلغاء</Button>\r\n            <Button\r\n              onClick={() => {\r\n                if (!name.trim() || !username.trim() || !password.trim()) return;\r\n                handleAddUser();\r\n                setAddUserDialogOpen(false);\r\n              }}\r\n            className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n            >حفظ المستخدم</Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* نافذة عرض كل إيصالات التسليم */}\r\n      <Dialog open={deliveryReportsDialogOpen} onOpenChange={setDeliveryReportsDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-lg\">\r\n          <DialogHeader>\r\n            <DialogTitle>إيصالات التسليم</DialogTitle>\r\n          </DialogHeader>\r\n          {deliveryReports.length === 0 ? (\r\n            <div className=\"text-xs text-gray-600\">لا توجد إيصالات تسليم محفوظة بعد.</div>\r\n          ) : (\r\n            <div className=\"space-y-2 max-h-[60vh] overflow-auto\">\r\n              {deliveryReports.map((r: any) => (\r\n                <div\r\n                  key={r.id}\r\n                  className=\"rounded border px-3 py-2 cursor-pointer hover:bg-gray-50\"\r\n                  onClick={() => {\r\n                    setSelectedDeliveryReport(r);\r\n                    setIsDeliveryReportOpen(true);\r\n                  }}\r\n                >\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div className=\"text-sm font-semibold\">{new Date(r.createdAt).toLocaleString('ar-EG')}</div>\r\n                    <div className=\"text-xs text-gray-500\">إلى: {r.receiverPhone}</div>\r\n                  </div>\r\n                  <div className=\"grid grid-cols-2 gap-2 mt-1\">\r\n                    <div className=\"text-xs text-gray-600\">نقدية مسلّمة: {r.deliveredDrawerFunds ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">محافظ مسلّمة (إجمالي): {r.deliveredWalletBalancesTotal ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">نقدية مستلمة: {r.receivedDrawerFunds ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">محافظ مستلمة (إجمالي): {r.receivedWalletBalancesTotal ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">نقدية مسلّمة: {r.deliveredDrawerFunds ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">محافظ مسلّمة (إجمالي): {r.deliveredWalletBalancesTotal ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">نقدية مستلمة: {r.receivedDrawerFunds ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">محافظ مستلمة (إجمالي): {r.receivedWalletBalancesTotal ?? 0}</div>\r\n                    <div className={[\r\n                      'text-xs',\r\n                      ((r.shiftProfit ?? ((r.deliveredDrawerFunds ?? 0) + (r.deliveredWalletBalancesTotal ?? 0) - (r.receivedDrawerFunds ?? 0) - (r.receivedWalletBalancesTotal ?? 0))) >= 0)\r\n                        ? 'text-green-700'\r\n                        : 'text-red-700'\r\n                    ].join(' ')}>أرباح الوردية: {r.shiftProfit ?? ((r.deliveredDrawerFunds ?? 0) + (r.deliveredWalletBalancesTotal ?? 0) - (r.receivedDrawerFunds ?? 0) - (r.receivedWalletBalancesTotal ?? 0))}</div>\r\n                  </div>\r\n                  {r.deficit && (\r\n                    <div className=\"text-xs text-red-600 mt-1\">عجز: {r.deficitAmount ?? 0}</div>\r\n                  )}\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button variant=\"secondary\" onClick={() => setDeliveryReportsDialogOpen(false)}>إغلاق</Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* عرض إيصال تقرير التسليم عند اختيار تقرير */}\r\n      <Dialog open={isDeliveryReportOpen} onOpenChange={setIsDeliveryReportOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>إيصال تسليم وردية</DialogTitle>\r\n          </DialogHeader>\r\n          {selectedDeliveryReport ? (\r\n            <div className=\"space-y-3\">\r\n              <div className=\"p-3 rounded border bg-gray-50\">\r\n                <div className=\"text-sm\">التاريخ: {new Date(selectedDeliveryReport.createdAt).toLocaleString('ar-EG')}</div>\r\n                <div className=\"text-xs text-gray-600 mt-1\">تم التسليم إلى: {selectedDeliveryReport.receiverPhone}</div>\r\n              </div>\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2\">المستلم عند الدخول</div>\r\n                  <div className=\"text-xs text-gray-600\">نقدية: {selectedDeliveryReport.receivedDrawerFunds ?? 0}</div>\r\n                  <div className=\"text-xs text-gray-600\">أرصدة المحافظ (إجمالي): {selectedDeliveryReport.receivedWalletBalancesTotal ?? 0}</div>\r\n                </div>\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2\">المسلّم عند الخروج</div>\r\n                  <div className=\"text-xs text-gray-600\">نقدية: {selectedDeliveryReport.deliveredDrawerFunds ?? 0}</div>\r\n                  <div className=\"text-xs text-gray-600\">أرصدة المحافظ (إجمالي): {selectedDeliveryReport.deliveredWalletBalancesTotal ?? 0}</div>\r\n                </div>\r\n              </div>\r\n              {selectedDeliveryReport.deficit && (\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2 text-red-600\">عجز</div>\r\n                  <div className=\"text-xs text-red-600\">المبلغ: {selectedDeliveryReport.deficitAmount ?? 0}</div>\r\n                </div>\r\n              )}\r\n              {/* تفصيل أرصدة المحافظ إن وُجد */}\r\n              {(selectedDeliveryReport.receivedWalletBalances && Object.keys(selectedDeliveryReport.receivedWalletBalances).length > 0) && (\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2\">تفصيل المحافظ المستلمة</div>\r\n                  <div className=\"space-y-1\">\r\n                    {Object.entries(selectedDeliveryReport.receivedWalletBalances as Record<string, number>).map(([k, v]) => (\r\n                      <div key={k} className=\"flex items-center justify-between text-xs\">\r\n                        <span className=\"text-gray-600\">{k}</span>\r\n                        <span className=\"font-semibold\">{v}</span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {(selectedDeliveryReport.deliveredWalletBalances && Object.keys(selectedDeliveryReport.deliveredWalletBalances).length > 0) && (\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2\">تفصيل المحافظ المسلّمة</div>\r\n                  <div className=\"space-y-1\">\r\n                    {Object.entries(selectedDeliveryReport.deliveredWalletBalances as Record<string, number>).map(([k, v]) => (\r\n                      <div key={k} className=\"flex items-center justify-between text-xs\">\r\n                        <span className=\"text-gray-600\">{k}</span>\r\n                        <span className=\"font-semibold\">{v}</span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-xs text-gray-600\">لا يوجد تقرير محدد للعرض.</div>\r\n          )}\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button variant=\"secondary\" onClick={() => setIsDeliveryReportOpen(false)}>إغلاق</Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* حوار إدخال كلمة السر للدخول */}\r\n      <Dialog open={authDialogOpen} onOpenChange={setAuthDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>أدخل الرقم السري للدخول</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-3\">\r\n            <div className=\"text-sm\">{selectedUser ? `${selectedUser.name} (${selectedUser.username})` : ''}</div>\r\n            <Input\r\n              type=\"password\"\r\n              autoComplete=\"off\"\r\n              value={enteredPassword}\r\n              onChange={(e) => setEnteredPassword(e.target.value)}\r\n              placeholder=\"أدخل الرقم السري\"\r\n            />\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              variant=\"secondary\"\r\n              onClick={() => { setEnteredPassword(''); setSelectedUser(null); setAuthDialogOpen(false); }}\r\n            >إلغاء</Button>\r\n            <Button\r\n              className=\"bg-emerald-600 hover:bg-emerald-700 text-white\"\r\n              onClick={() => {\r\n                if (!selectedUser) return;\r\n                if (enteredPassword.trim() !== selectedUser.password) {\r\n                  toast({ title: 'خطأ في الرقم السري', description: 'الرقم السري للكاشير غير صحيح', variant: 'destructive' });\r\n                  return;\r\n                }\r\n                setShiftUser({ name: selectedUser.name, username: selectedUser.username });\r\n                setEnteredPassword('');\r\n                setAuthDialogOpen(false);\r\n                onOpenChange(false);\r\n                startShift();\r\n                // فتح نافذة إدخال أرصدة البداية والنقدية مباشرةً\r\n                setInitialIntakeDialogOpen(true);\r\n              }}\r\n            >دخول الورديه</Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* نافذة إدخال أرصدة المحافظ والمال النقدي عند بداية الوردية */}\r\n      <Dialog open={initialIntakeDialogOpen} onOpenChange={setInitialIntakeDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>تسجيل أرصدة البداية والنقدية</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"rounded border p-3\">\r\n              <Label className=\"mb-1 block\">الفلوس النقدية المستلمة عند الدخول</Label>\r\n              <Input\r\n                type=\"text\"\r\n                inputMode=\"decimal\"\r\n                value={receivedDrawerFunds}\r\n                onChange={(e) => setReceivedDrawerFunds(normalizeDigits(e.target.value))}\r\n                placeholder=\"أدخل قيمة النقدية في الدرج عند بداية الورديه\"\r\n              />\r\n            </div>\r\n            <div className=\"rounded border p-3\">\r\n              <Label className=\"mb-1 block\">أرصدة المحافظ المستلمة (إجمالي) عند الدخول</Label>\r\n              <Input\r\n                type=\"text\"\r\n                inputMode=\"decimal\"\r\n                value={Number.isFinite(receivedWalletBalancesTotal) ? receivedWalletBalancesTotal : 0}\r\n                onChange={(e) => {\r\n                  const v = parseFloat(normalizeDigits(e.target.value));\r\n                  setReceivedWalletBalancesTotal(Number.isFinite(v) ? v : 0);\r\n                }}\r\n                placeholder=\"أدخل إجمالي أرصدة المحافظ عند بداية الورديه\"\r\n              />\r\n              <div className=\"text-xs text-gray-600 mt-1\">يمكن إضافة التفصيل لاحقاً إن لزم، المهم تسجيل الإجمالي.</div>\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              className=\"bg-emerald-600 hover:bg-emerald-700 text-white\"\r\n              onClick={() => {\r\n                const drawer = parseFloat(receivedDrawerFunds);\r\n                const wallets = receivedWalletBalancesTotal;\r\n                const isDrawerValid = Number.isFinite(drawer) && drawer >= 0;\r\n                const isWalletsValid = Number.isFinite(wallets) && wallets >= 0;\r\n                if (!isDrawerValid || !isWalletsValid) {\r\n                  toast({ title: 'يرجى إدخال قيم صحيحة', description: 'أدخل قيمًا رقمية غير سالبة للنقدية ولإجمالي أرصدة المحافظ', variant: 'destructive' });\r\n                  return;\r\n                }\r\n                // حفظ قيَم البداية محلياً لربطها بإيصال التسليم لاحقاً\r\n                try {\r\n                  localStorage.setItem('shiftInitialReceivedDrawerFunds', String(drawer));\r\n                  localStorage.setItem('shiftInitialReceivedWalletBalancesTotal', String(wallets));\r\n                } catch {}\r\n                toast({ title: 'تم تسجيل أرصدة البداية', description: 'سُجّل إجمالي النقدية وأرصدة المحافظ لبداية الورديه' });\r\n                setInitialIntakeDialogOpen(false);\r\n              }}\r\n            >تأكيد وحفظ</Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* حوار تسليم الورديه: اختيار التسليم لمستخدم آخر أو للأدمن */}\r\n      <Dialog open={handoverDialogOpen} onOpenChange={(open) => { if (open) setHandoverDialogOpen(true); }}>\r\n        <DialogContent className=\"sm:max-w-md\" hideClose disableOutsideClose disableEscClose>\r\n          <DialogHeader>\r\n            <DialogTitle>تسليم الورديه والخروج</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            {/* اختيار الوجهة */}\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                variant={handoverMode === 'toUser' ? 'default' : 'secondary'}\r\n                onClick={() => setHandoverMode('toUser')}\r\n              >تسليم إلى مستخدم آخر</Button>\r\n              <Button\r\n                variant={handoverMode === 'toAdmin' ? 'default' : 'secondary'}\r\n                onClick={() => setHandoverMode('toAdmin')}\r\n              >تسليم إلى الأدمن الرئيسي</Button>\r\n            </div>\r\n\r\n            {/* نموذج تسليم إلى مستخدم آخر */}\r\n            {handoverMode === 'toUser' && (\r\n              <div className=\"space-y-3\">\r\n                {users.length === 0 ? (\r\n                  <div className=\"text-sm text-gray-600\">لا يوجد مستخدمون مسجلون. قم بإضافة مستخدم أولاً.</div>\r\n                ) : (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"text-sm font-medium\">اختر المستخدم الذي سيتسلم الورديه</div>\r\n                    <div className=\"space-y-2 max-h-40 overflow-auto\">\r\n                      {users.map((u, idx) => (\r\n                        <div\r\n                          key={idx}\r\n                          className={`flex items-center justify-between rounded border px-3 py-2 cursor-pointer ${handoverSelectedUser?.username === u.username ? 'bg-indigo-50 border-indigo-200' : ''}`}\r\n                          onClick={() => setHandoverSelectedUser(u)}\r\n                        >\r\n                          <div>\r\n                            <div className=\"text-sm font-semibold\">{u.name}</div>\r\n                            <div className=\"text-xs text-gray-500\">{u.username}</div>\r\n                          </div>\r\n                          <span className=\"text-xs text-gray-400\">اختيار</span>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                <div>\r\n                  <Label className=\"mb-1 block\">كلمة سر المستخدم المحدد</Label>\r\n                  <Input\r\n                    type=\"password\"\r\n                    autoComplete=\"off\"\r\n                    value={handoverPassword}\r\n                    onChange={(e) => setHandoverPassword(e.target.value)}\r\n                    placeholder=\"أدخل كلمة السر\"\r\n                  />\r\n                </div>\r\n                {handoverError && <div className=\"text-xs text-red-600\">{handoverError}</div>}\r\n              </div>\r\n            )}\r\n\r\n            {/* نموذج تسليم إلى الأدمن الرئيسي */}\r\n            {handoverMode === 'toAdmin' && (\r\n              <div className=\"space-y-3\">\r\n                <div className=\"text-sm text-gray-600\">أدخل كلمة مرور الحساب الرئيسي لتسليم الورديه والخروج إلى الأدمن.</div>\r\n                <Input\r\n                  type=\"password\"\r\n                  autoComplete=\"off\"\r\n                  value={mainPassword}\r\n                  onChange={(e) => setMainPassword(e.target.value)}\r\n                  placeholder=\"كلمة المرور\"\r\n                />\r\n                {mainAuthError && (\r\n                  <div className=\"text-xs text-red-600\">{mainAuthError}</div>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              disabled={isHandoverProcessing || !handoverMode}\r\n              onClick={async () => {\r\n                if (!handoverMode) return;\r\n                setIsHandoverProcessing(true);\r\n                try {\r\n                  const totals = reportTotals;\r\n                  computeShiftTotals().then(setReportTotals).catch(() => {});\r\n                  if (handoverMode === 'toUser') {\r\n                    if (!handoverSelectedUser) {\r\n                      setHandoverError('يرجى اختيار المستخدم أولاً');\r\n                      setIsHandoverProcessing(false);\r\n                      return;\r\n                    }\r\n                    if (handoverPassword.trim() !== handoverSelectedUser.password) {\r\n                      setHandoverError('كلمة السر غير صحيحة');\r\n                      setIsHandoverProcessing(false);\r\n                      return;\r\n                    }\r\n                    // إنهاء الورديه الحالية وتسليمها للمستخدم المحدد\r\n                    endShift();\r\n                    setShiftUser({ name: handoverSelectedUser.name, username: handoverSelectedUser.username });\r\n                    startShift();\r\n                    setHandoverTargetLabel(`${handoverSelectedUser.name} (${handoverSelectedUser.username})`);\r\n                    // تحديث العلم الدائم: آخر تسليم ليس للأدمن\r\n                    try { localStorage.setItem('lastHandoverToAdmin', 'false'); } catch {}\r\n                    // تنظيف وإغلاق\r\n                    setHandoverDialogOpen(false);\r\n                    setHandoverMode(null);\r\n                    setHandoverSelectedUser(null);\r\n                    setHandoverPassword('');\r\n                    setHandoverError('');\r\n                    onOpenChange(false);\r\n                    // عرض تقرير التسليم\r\n                    setReportTotals(totals);\r\n                    setDeficitChoice(null);\r\n                    setDeficitAmount('');\r\n                    setReportDialogOpen(true);\r\n                  } else if (handoverMode === 'toAdmin') {\r\n                    setMainAuthError('');\r\n                    const email = user?.email || '';\r\n                    if (!email) {\r\n                      setMainAuthError('لا يوجد بريد للمستخدم الرئيسي للتحقق');\r\n                      setIsHandoverProcessing(false);\r\n                      return;\r\n                    }\r\n                    const { error } = await signIn(email, mainPassword);\r\n                    if (error) {\r\n                      setMainAuthError('كلمة المرور غير صحيحة');\r\n                      setIsHandoverProcessing(false);\r\n                      return;\r\n                    }\r\n                    // إنهاء الوردية وتسليمها للأدمن (العودة للوضع الرئيسي)\r\n                    endShift();\r\n                    // تسجيل خروج مستخدم الوردية الحالي ليصبح قابلاً للحذف\r\n                    setShiftUser(null);\r\n                    // حفظ علم دائم بأن آخر تسليم كان للأدمن الرئيسي\r\n                    try { localStorage.setItem('lastHandoverToAdmin', 'true'); } catch {}\r\n                    setMainPassword('');\r\n                    setHandoverDialogOpen(false);\r\n                    onOpenChange(false);\r\n                    setHandoverTargetLabel('الأدمن الرئيسي');\r\n                    // عرض تقرير التسليم\r\n                    setReportTotals(totals);\r\n                    setDeficitChoice(null);\r\n                    setDeficitAmount('');\r\n                    setReportDialogOpen(true);\r\n                  }\r\n                } catch (e) {\r\n                  setHandoverError('حدث خطأ أثناء التسليم، حاول مرة أخرى');\r\n                } finally {\r\n                  setIsHandoverProcessing(false);\r\n                }\r\n              }}\r\n            className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n            >تأكيد التسليم</Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* نافذة تقرير تسليم الورديه والخروج */}\r\n      <Dialog open={reportDialogOpen} onOpenChange={setReportDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-lg\" hideClose disableOutsideClose disableEscClose>\r\n          <DialogHeader>\r\n            <DialogTitle>تقرير تسليم الورديه والخروج</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"p-3 rounded border bg-gray-50\">\r\n              <div className=\"text-sm\">تم تسليم الورديه إلى: <span className=\"font-semibold\">{handoverTargetLabel}</span></div>\r\n              {shiftStartAt && (\r\n                <div className=\"text-xs text-gray-600 mt-1\">بداية الورديه: {new Date(shiftStartAt).toLocaleString('ar-EG')}</div>\r\n              )}\r\n              <div className=\"text-xs text-gray-600\">نهاية الورديه: {new Date().toLocaleString('ar-EG')}</div>\r\n            </div>\r\n            {/* تمت إزالة عرض إجمالي التحويل والسحب أثناء الورديه */}\r\n            {/* قسم النقدية والمحافظ المطلوبة */}\r\n            <div className=\"space-y-3\">\r\n                <div className=\"grid grid-cols-2 gap-3\">\r\n                  <div className=\"rounded border p-3\">\r\n                    <Label className=\"mb-1 block\">الفلوس النقدية المستلمة</Label>\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={receivedDrawerFunds}\r\n                      readOnly\r\n                      disabled\r\n                      placeholder=\"قيمة مسجلة عند بداية الورديه\"\r\n                    />\r\n                    <div className=\"text-xs text-gray-600 mt-1\">قيمة غير قابلة للتعديل؛ تُسجّل عند الدخول.</div>\r\n                  </div>\r\n                  <div className=\"rounded border p-3\">\r\n                    <Label className=\"mb-1 block\">أرصدة المحافظ المستلمة (إجمالي)</Label>\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={receivedWalletBalancesTotal}\r\n                      readOnly\r\n                      disabled\r\n                      placeholder=\"إجمالي مسجل عند بداية الورديه\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                <div className=\"rounded border p-3\">\r\n                  <Label className=\"mb-1 block\">الفلوس النقدية المسلمة</Label>\r\n                  <Input\r\n                    type=\"text\"\r\n                    inputMode=\"decimal\"\r\n                    value={deliveredDrawerFunds}\r\n                    onChange={(e) => {\r\n                      const v = parseFloat(normalizeDigits(e.target.value));\r\n                      setDeliveredDrawerFunds(Number.isFinite(v) ? v : 0);\r\n                    }}\r\n                    placeholder=\"أدخل قيمة النقدية المسلمة عند نهاية الورديه\"\r\n                  />\r\n                  <div className=\"text-xs text-gray-600 mt-1\">ادخال يدوي لقيمة النقدية المسلّمة عند نهاية الورديه</div>\r\n                </div>\r\n                <div className=\"rounded border p-3\">\r\n                  <Label className=\"mb-1 block\">أرصدة المحافظ المسلمة (إجمالي)</Label>\r\n                  <Input\r\n                    type=\"text\"\r\n                    inputMode=\"decimal\"\r\n                    value={deliveredWalletBalancesTotal}\r\n                    onChange={(e) => {\r\n                      const v = parseFloat(normalizeDigits(e.target.value));\r\n                      setDeliveredWalletBalancesTotal(Number.isFinite(v) ? v : 0);\r\n                    }}\r\n                    placeholder=\"أدخل إجمالي أرصدة المحافظ المسلّمة\"\r\n                  />\r\n                  <div className=\"text-xs text-gray-600 mt-1\">يمكنك إدخال الإجمالي يدوياً؛ التفصيل يُحفظ إن لزم</div>\r\n                </div>\r\n              </div>\r\n              {/* أرباح الوردية */}\r\n              <div className=\"rounded border p-3\">\r\n                <div className=\"text-sm font-semibold mb-1\">أرباح الوردية</div>\r\n                <div className={[\r\n                  'text-sm',\r\n                  ((((deliveredDrawerFunds ?? 0) + (deliveredWalletBalancesTotal ?? 0) - (((parseFloat(receivedDrawerFunds || '0') || 0)) + (receivedWalletBalancesTotal ?? 0))) >= 0)\r\n                    ? 'text-green-700'\r\n                    : 'text-red-700')\r\n                ].join(' ')}>\r\n                  {Math.round((((deliveredDrawerFunds ?? 0) + (deliveredWalletBalancesTotal ?? 0) - (((parseFloat(receivedDrawerFunds || '0') || 0)) + (receivedWalletBalancesTotal ?? 0))) ) * 100) / 100}\r\n                </div>\r\n                <div className=\"text-xs text-gray-600\">محسوبة: (المسلّم − المستلم) للنقدية + المحافظ</div>\r\n                <div className=\"mt-2 grid grid-cols-1 gap-2\">\r\n                  <div className=\"rounded border p-2 bg-gray-50\">\r\n                    <div className=\"text-xs text-gray-700\">مطلوب من الدرج (بدون أرباح)</div>\r\n                    <div className=\"text-sm font-semibold text-gray-900\">\r\n                      {Math.round(((deliveredDrawerFunds ?? 0) - ((parseFloat(receivedDrawerFunds || '0') || 0))) * 100) / 100}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <div className=\"text-sm font-medium\">هل يوجد عجز؟</div>\r\n              <div className=\"flex gap-2\">\r\n                <Button variant={deficitChoice === 'no' ? 'default' : 'secondary'} onClick={() => setDeficitChoice('no')}>لا</Button>\r\n                <Button variant={deficitChoice === 'yes' ? 'default' : 'secondary'} onClick={() => setDeficitChoice('yes')}>نعم</Button>\r\n              </div>\r\n              {deficitChoice === 'yes' && (\r\n                <div>\r\n                  <Label className=\"mb-1 block\">مبلغ العجز</Label>\r\n                  <Input type=\"number\" value={deficitAmount} onChange={(e) => setDeficitAmount(e.target.value)} placeholder=\"أدخل مبلغ العجز\" />\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              onClick={() => {\r\n                const deficit = deficitChoice === 'yes';\r\n                const amt = parseFloat(deficitAmount) || 0;\r\n                (async () => { await saveShiftReceiptToRecent(reportTotals, deficit, amt); })();\r\n                toast({ title: 'تم إضافة إيصال تسليم الورديه', description: 'أُضيف الإيصال إلى المعاملات الأخيرة بعنوان إيصال تسليم وردية' });\r\n                setReportDialogOpen(false);\r\n              }}\r\n            className=\"bg-emerald-600 hover:bg-emerald-700 text-white\"\r\n            >تأكيد وحفظ الإيصال</Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default CashierShiftModal;\r\n"],"names":["CashierShiftModal","open","onOpenChange","shiftUser","isShiftActive","shiftStartAt","setShiftUser","startShift","endShift","useShift","userSubscription","user","signIn","profile","useFirebaseAuth","toast","useToast","name","setName","useState","username","setUsername","password","setPassword","handoverDialogOpen","setHandoverDialogOpen","handoverMode","setHandoverMode","mainPassword","setMainPassword","mainAuthError","setMainAuthError","isVerifyingMain","setIsVerifyingMain","handoverSelectedUser","setHandoverSelectedUser","handoverPassword","setHandoverPassword","handoverError","setHandoverError","isHandoverProcessing","setIsHandoverProcessing","reportDialogOpen","setReportDialogOpen","reportTotals","setReportTotals","deficitChoice","setDeficitChoice","deficitAmount","setDeficitAmount","receivedDrawerFunds","setReceivedDrawerFunds","receivedWalletBalancesTotal","setReceivedWalletBalancesTotal","receivedWalletBalancesMap","setReceivedWalletBalancesMap","deliveredDrawerFunds","setDeliveredDrawerFunds","deliveredWalletBalancesTotal","setDeliveredWalletBalancesTotal","deliveredWalletBalancesMap","setDeliveredWalletBalancesMap","handoverTargetLabel","setHandoverTargetLabel","initialIntakeDialogOpen","setInitialIntakeDialogOpen","normalizeDigits","map","ch","getCashierUsersKey","users","setUsers","saved","legacy","isDataLoaded","setIsDataLoaded","useEffect","foundInCloud","ref","doc","db","snap","getDoc","data","cloudUsers","err","localUsers","planType","_a","maxCashiers","setDoc","e","authDialogOpen","setAuthDialogOpen","enteredPassword","setEnteredPassword","selectedUser","setSelectedUser","deliveryReports","setDeliveryReports","deliveryReportsDialogOpen","setDeliveryReportsDialogOpen","selectedDeliveryReport","setSelectedDeliveryReport","isDeliveryReportOpen","setIsDeliveryReportOpen","addUserDialogOpen","setAddUserDialogOpen","handleDeleteUser","usernameToDelete","isCurrentShiftUser","lastHandoverToAdmin","confirmMsg","prev","u","handleAddUser","newUser","handleEndShift","computeShiftTotals","transactions","userDataService","res","getLastTransactions","startTime","now","isWithdrawTx","t","type","xn","isSendTx","parseDate","val","inShiftWindow","created","isCompletedStatus","s","completed","totalWithdrawals","sum","amount","d","w","v","reports","a","b","ad","saveShiftReceiptToRecent","totals","deficit","deficitAmt","initialDrawerFunds","initialWalletBalancesTotal","receipt","jsxs","Fragment","jsx","Dialog","DialogContent","DialogHeader","DialogTitle","idx","Button","DialogFooter","Label","Input","r","k","drawer","wallets","isDrawerValid","isWalletsValid","email","error","amt"],"mappings":"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"}