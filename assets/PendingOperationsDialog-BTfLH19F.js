import{$ as q,u as J,m as K,r as t,j as e,af as Q,ag as U,ah as X,ai as Y,y as n,I as i,B as x,C as Z,O as ee,q as se,s as z,t as D,aI as te,x as ae,D as re,E as k,V as le,ar as ne}from"./index-BhZSAJfd.js";import{B as O}from"./badge-BAx1Ncm_.js";import{L as C}from"./switch-Bh84k4KK.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],_=q("circle-check",ie);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],de=q("list",ce),ue=({isOpen:r,onClose:P})=>{const{user:c}=J(),{toast:l}=K(),[d,p]=t.useState("add"),[v,o]=t.useState(!1),[W,A]=t.useState(null),[S,j]=t.useState(""),[F,N]=t.useState(""),[b,f]=t.useState(""),[L,y]=t.useState(""),[E,w]=t.useState(""),[B,I]=t.useState([]),T=async()=>{if(c){o(!0);try{const s=se(z(D,"pendingOperations"),te("userId","==",c.uid)),h=(await ae(s)).docs.map(a=>({id:a.id,...a.data()}));h.sort((a,H)=>{var g,M,u,R;const G=((M=(g=a.createdAt)==null?void 0:g.toDate)==null?void 0:M.call(g))||new Date(0);return(((R=(u=H.createdAt)==null?void 0:u.toDate)==null?void 0:R.call(u))||new Date(0))-G}),I(h)}catch(s){console.error("Error fetching pending operations:",s),l({title:"خطأ",description:"فشل تحميل العمليات المعلقة",variant:"destructive"})}finally{o(!1)}}};t.useEffect(()=>{d==="list"&&r&&T()},[d,r]),t.useEffect(()=>{r||(p("add"),j(""),N(""),f(""),y(""),w(""))},[r]);const V=async()=>{if(c){o(!0);try{await re(z(D,"pendingOperations"),{userId:c.uid,senderWalletNumber:S,receiverWalletNumber:F,amount:b?parseFloat(b):0,suspensionDate:L,retrievalDate:E,status:"pending",createdAt:k(),updatedAt:k()}),l({title:"تم الإضافة",description:"تم إضافة العملية المعلقة بنجاح"}),j(""),N(""),f(""),y(""),w("")}catch(s){console.error(s),l({title:"خطأ",description:"حدث خطأ أثناء الإضافة",variant:"destructive"})}finally{o(!1)}}},$=async s=>{A(s);try{const m=le(D,"pendingOperations",s);await ne(m,{status:"retrieved",updatedAt:k()}),I(h=>h.map(a=>a.id===s?{...a,status:"retrieved"}:a)),l({title:"تم التحديث",description:"تم تغيير حالة العملية إلى مسترد"})}catch(m){console.error("Error updating operation status:",m),l({title:"خطأ",description:"فشل تحديث حالة العملية",variant:"destructive"})}finally{A(null)}};return e.jsx(Q,{open:r,onOpenChange:P,children:e.jsxs(U,{className:"sm:max-w-[500px]",dir:"rtl",children:[e.jsx(X,{children:e.jsx(Y,{className:"text-right",children:d==="add"?"إضافة عملية معلقة":"سجل العمليات المعلقة"})}),d==="add"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground text-right mb-2 px-1",children:"هذا قسم خاص بإضافة العمليات المعلقة بين المحافظ ومنتظر رد العملية من الشركة"}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(n,{htmlFor:"senderWallet",className:"text-right",children:"المحفظة المرسلة"}),e.jsx(i,{id:"senderWallet",value:S,onChange:s=>j(s.target.value),className:"col-span-3",placeholder:"رقم المحفظة المرسلة (اختياري)"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(n,{htmlFor:"receiverWallet",className:"text-right",children:"المحفظة المستقبلة"}),e.jsx(i,{id:"receiverWallet",value:F,onChange:s=>N(s.target.value),className:"col-span-3",placeholder:"رقم المحفظة المستقبلة (اختياري)"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(n,{htmlFor:"amount",className:"text-right",children:"المبلغ المعلق"}),e.jsx(i,{id:"amount",type:"number",value:b,onChange:s=>f(s.target.value),className:"col-span-3",placeholder:"0.00 (اختياري)"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(n,{htmlFor:"suspensionDate",className:"text-right",children:"تاريخ التعليق (اختياري)"}),e.jsx(i,{id:"suspensionDate",type:"date",value:L,onChange:s=>y(s.target.value),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(n,{htmlFor:"retrievalDate",className:"text-right",children:"تاريخ الاسترداد (اختياري)"}),e.jsx(i,{id:"retrievalDate",type:"date",value:E,onChange:s=>w(s.target.value),className:"col-span-3"})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 mt-4",children:[e.jsxs(x,{onClick:V,disabled:v,className:"w-full bg-orange-500 hover:bg-orange-600 text-white",children:[v&&e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"إضافة"]}),e.jsxs(x,{variant:"outline",onClick:()=>p("list"),className:"w-full border-orange-200 text-orange-700 hover:bg-orange-50 hover:text-orange-800",children:[e.jsx(de,{className:"ml-2 h-4 w-4"}),"العمليات المعلقة"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"py-4 max-h-[60vh] overflow-y-auto space-y-3",children:v?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(C,{className:"h-8 w-8 animate-spin text-gray-400"})}):B.length>0?B.map(s=>e.jsxs("div",{className:"border rounded-lg p-3 bg-card text-card-foreground shadow-sm relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-3 left-3",children:s.status==="retrieved"?e.jsxs(O,{className:"bg-green-100 text-green-700 border-green-200 hover:bg-green-100",children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),"مسترد"]}):e.jsxs(O,{className:"bg-orange-100 text-orange-700 border-orange-200 hover:bg-orange-100",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"معلق"]})}),e.jsx("div",{className:"flex justify-between items-start mb-2 pl-20",children:e.jsxs("div",{children:[e.jsxs("span",{className:"font-bold text-lg block",children:[s.amount||0," ج.م"]}),s.senderWalletNumber&&e.jsxs("span",{className:"text-sm text-muted-foreground block",children:["من: ",s.senderWalletNumber]}),s.receiverWalletNumber&&e.jsxs("span",{className:"text-sm text-muted-foreground block",children:["إلى: ",s.receiverWalletNumber]}),!s.senderWalletNumber&&!s.receiverWalletNumber&&s.walletNumber&&e.jsx("span",{className:"text-sm text-muted-foreground block",children:s.walletNumber})]})}),e.jsxs("div",{className:"text-xs text-muted-foreground grid grid-cols-2 gap-2 mt-3 pb-2 border-b border-dashed mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block font-semibold text-gray-500",children:"تاريخ التعليق:"}),s.suspensionDate]}),e.jsxs("div",{children:[e.jsx("span",{className:"block font-semibold text-gray-500",children:"تاريخ الاسترداد:"}),s.retrievalDate]})]}),s.status!=="retrieved"&&e.jsx(x,{size:"sm",variant:"outline",className:"w-full border-green-200 text-green-700 hover:bg-green-50 hover:text-green-800 mt-1 h-8 text-xs",onClick:()=>$(s.id),disabled:W===s.id,children:W===s.id?e.jsx(C,{className:"h-3 w-3 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mr-1 h-3 w-3"}),"تم الاسترداد"]})})]},s.id)):e.jsx("div",{className:"text-center text-muted-foreground p-8",children:"لا توجد عمليات معلقة"})}),e.jsx("div",{className:"mt-4",children:e.jsxs(x,{variant:"ghost",onClick:()=>p("add"),className:"w-full flex items-center justify-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"العودة للإضافة"]})})]})]})})};export{ue as PendingOperationsDialog};
//# sourceMappingURL=PendingOperationsDialog-BTfLH19F.js.map
