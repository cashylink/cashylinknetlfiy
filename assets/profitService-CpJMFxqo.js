var F=Object.defineProperty;var M=(m,t,e)=>t in m?F(m,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[t]=e;var S=(m,t,e)=>M(m,typeof t!="symbol"?t+"":t,e);import{a2 as n,a3 as D}from"./index-Cty74lt-.js";class _{static getProfitPinKey(t){return t?`${this.PROFIT_PIN_KEY_BASE}_${t}`:this.PROFIT_PIN_KEY_BASE}static getMasterPinKey(t){return t?`${this.MASTER_PIN_KEY_BASE}_${t}`:this.MASTER_PIN_KEY_BASE}static setProfitPin(t,e){console.warn("setProfitPin is deprecated. Using master PIN instead.")}static hasProfitPin(t){try{const e=localStorage.getItem(this.getMasterPinKey(t));return!!e&&e.length>0}catch{return!1}}static verifyProfitPin(t,e){try{const o=localStorage.getItem(this.getMasterPinKey(e));return o?atob(o)===t:!1}catch{return!1}}static getProfitData(t){n.autoResetReportsIfNeeded(t);const e=n.getProfits(t),o=this.getWithdrawTransferProfits(t);return{dailyProfit:e.dailyProfit,monthlyProfit:e.monthlyProfit,dailyWithdrawProfit:o.dailyWithdrawProfit,monthlyWithdrawProfit:o.monthlyWithdrawProfit,dailyTransferProfit:o.dailyTransferProfit,monthlyTransferProfit:o.monthlyTransferProfit,lastUpdated:new Date}}static addProfit(t,e){n.addProfit(t,"daily",e),n.addProfit(t,"monthly",e)}static calculateProfitFromTransaction(t){return n.calculateTransactionProfit(t)}static resetProfits(t,e,o){if(!this.verifyProfitPin(e,o))return!1;const c=o?`reportsData_${o}`:"reportsData",s=n.getReportsData(o);if(t==="daily"?(s.dailyProfit=0,s.lastDailyProfitResetDate=new Date):(s.monthlyProfit=0,s.lastMonthlyProfitResetDate=new Date),localStorage.setItem(c,JSON.stringify(s)),o)try{D.updateUserData(o,{reportsData:{...s}})}catch(y){console.warn("تعذر مزامنة تصفير الأرباح مع Firebase:",y)}return!0}static clearProfitPin(t){localStorage.removeItem(this.getProfitPinKey(t))}static updateProfitsFromTransactions(t,e){const o=e?`reportsData_${e}`:"reportsData",c=n.getReportsData(e);let s=0,y=0;const P=new Date,w=P.getMonth(),T=P.getFullYear(),g=n.filterVisibleTransactions(t,"daily",e),u=n.filterVisibleTransactions(t,"monthly",e);if(g.forEach(r=>{const i=String(r.type||r.txnType||"").toLowerCase(),h=String(r.title||"");if(i==="cash_addition"||h.includes("إيصال إضافة نقدية"))return;const f=new Date(r.createdAt);if(String(r.status||"confirmed").toLowerCase(),f.toDateString()!==P.toDateString())return;const l=String(r.type||r.txnType||"").toLowerCase(),p={type:l==="withdrawal"?"withdraw":l,amount:Number(r.amount||0),commission:r.commission};s+=this.calculateProfitFromTransaction(p)}),u.forEach(r=>{const i=String(r.type||r.txnType||"").toLowerCase(),h=String(r.title||"");if(i==="cash_addition"||h.includes("إيصال إضافة نقدية"))return;const f=new Date(r.createdAt);if(String(r.status||"confirmed").toLowerCase(),f.getMonth()!==w||f.getFullYear()!==T)return;const l=String(r.type||r.txnType||"").toLowerCase(),p={type:l==="withdrawal"?"withdraw":l,amount:Number(r.amount||0),commission:r.commission};y+=this.calculateProfitFromTransaction(p)}),c.dailyProfit=Math.round(s*100)/100,c.monthlyProfit=Math.round(y*100)/100,localStorage.setItem(o,JSON.stringify(c)),e)try{D.updateUserData(e,{reportsData:{...c}})}catch(r){console.warn("تعذر مزامنة تحديث الأرباح من المعاملات مع Firebase:",r)}}static getWithdrawTransferProfits(t){n.getReportsData(t);const e=new Date,o=e.getMonth(),c=e.getFullYear(),s=`transactions_${t||"default"}`,y=JSON.parse(localStorage.getItem(s)||"[]");let P=0,w=0,T=0,g=0;const u=n.filterVisibleTransactions(y,"daily",t),r=n.filterVisibleTransactions(y,"monthly",t);return u.forEach(i=>{const h=String(i.type||i.txnType||"").toLowerCase(),f=String(i.title||"");if(h==="cash_addition"||f.includes("إيصال إضافة نقدية"))return;const l=new Date(i.createdAt);if(String(i.status||"confirmed").toLowerCase(),l.toDateString()!==e.toDateString())return;const d=String(i.type||i.txnType||"").toLowerCase(),a={type:d==="withdrawal"?"withdraw":d,amount:Number(i.amount||0),commission:i.commission};a.type==="withdraw"?P+=this.calculateProfitFromTransaction(a):(a.type==="receive"||a.type==="send"||a.type==="transfer")&&(T+=this.calculateProfitFromTransaction(a))}),r.forEach(i=>{const h=String(i.type||i.txnType||"").toLowerCase(),f=String(i.title||"");if(h==="cash_addition"||f.includes("إيصال إضافة نقدية"))return;const l=new Date(i.createdAt);if(String(i.status||"confirmed").toLowerCase(),l.getMonth()!==o||l.getFullYear()!==c)return;const d=String(i.type||i.txnType||"").toLowerCase(),a={type:d==="withdrawal"?"withdraw":d,amount:Number(i.amount||0),commission:i.commission};a.type==="withdraw"?w+=this.calculateProfitFromTransaction(a):(a.type==="receive"||a.type==="send"||a.type==="transfer")&&(g+=this.calculateProfitFromTransaction(a))}),{dailyWithdrawProfit:Math.round(P*100)/100,monthlyWithdrawProfit:Math.round(w*100)/100,dailyTransferProfit:Math.round(T*100)/100,monthlyTransferProfit:Math.round(g*100)/100}}}S(_,"PROFIT_PIN_KEY_BASE","profit_pin"),S(_,"MASTER_PIN_KEY_BASE","master_pin");export{_ as ProfitService};
//# sourceMappingURL=profitService-CpJMFxqo.js.map
