import{R as d,f as m,y as p,i as g,P as E,K as N}from"./index-BkgvAZmL.js";const s={phoneNumber:"201000392539",defaultMessage:"مرحباً، أريد الاستفسار عن خدماتكم",isEnabled:!0,lastUpdated:new Date},h="whatsapp-settings",f="app-settings",l="whatsapp_settings_cache",i=async()=>{var a;try{if(!m.currentUser){try{const e=localStorage.getItem(l);if(e){const r=JSON.parse(e);return{phoneNumber:r.phoneNumber||s.phoneNumber,defaultMessage:r.defaultMessage||s.defaultMessage,isEnabled:r.isEnabled!==void 0?r.isEnabled:s.isEnabled,lastUpdated:r.lastUpdated?new Date(r.lastUpdated):s.lastUpdated}}}catch{}return s}const t=p(g,f,h),n=await E(t);if(n.exists()){const e=n.data(),r={phoneNumber:e.phoneNumber||s.phoneNumber,defaultMessage:e.defaultMessage||s.defaultMessage,isEnabled:e.isEnabled!==void 0?e.isEnabled:s.isEnabled,lastUpdated:((a=e.lastUpdated)==null?void 0:a.toDate())||s.lastUpdated};try{localStorage.setItem(l,JSON.stringify(r))}catch{}return r}else return await b(s),s}catch{try{const n=localStorage.getItem(l);if(n){const e=JSON.parse(n);return{phoneNumber:e.phoneNumber||s.phoneNumber,defaultMessage:e.defaultMessage||s.defaultMessage,isEnabled:e.isEnabled!==void 0?e.isEnabled:s.isEnabled,lastUpdated:e.lastUpdated?new Date(e.lastUpdated):s.lastUpdated}}}catch{}return s}},b=async a=>{try{const t=p(g,f,h),n={...a,lastUpdated:new Date};await N(t,n,{merge:!0});try{localStorage.setItem(l,JSON.stringify(n))}catch{}return!0}catch(t){return console.error("خطأ في حفظ إعدادات الواتساب:",t),!1}},S=a=>{const t=a.replace(/\D/g,"");if(t.length<10)throw new Error("رقم الهاتف يجب أن يحتوي على 10 أرقام على الأقل");return t},D=a=>{try{const t=S(a);return t.length>=10&&t.length<=15}catch{return!1}},y=(a,t)=>{const n=S(a),e=encodeURIComponent(t);return`https://wa.me/${n}?text=${e}`},M=async(a,t,n)=>{const e=await i(),r=`مرحباً! أريد الاشتراك في باقة ${a} بسعر ${t}

المميزات المشمولة:
${n.map(o=>`✅ ${o}`).join(`
`)}

أرجو التواصل معي لإتمام عملية الاشتراك.`;return y(e.phoneNumber,r)},I=()=>{const[a,t]=d.useState(null),[n,e]=d.useState(!0),[r,o]=d.useState(null);return d.useEffect(()=>{(async()=>{try{e(!0);const c=await i();t(c),o(null)}catch(c){o("فشل في تحميل إعدادات الواتساب"),console.error(c)}finally{e(!1)}})()},[]),{settings:a,loading:n,error:r,updateSettings:async u=>{try{return e(!0),await b(u)&&a?(t({...a,...u,lastUpdated:new Date}),o(null),!0):(o("فشل في حفظ الإعدادات"),!1)}catch(c){return o("خطأ في تحديث الإعدادات"),console.error(c),!1}finally{e(!1)}},refreshSettings:()=>i().then(t)}};export{M as a,y as c,S as f,I as u,D as v};
