const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-mBSeGJ8K.js","./index-BsQ0vdi0.css"])))=>i.map(i=>d[i]);
import{Z as b,aG as y,q as A,p as f,s as p,aE as v,A as E,D as M,O as m}from"./index-mBSeGJ8K.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],w=b("external-link",D);async function q({title:r,message:o,audienceKey:i,createdBy:l,linkUrl:c,actionText:t}){const a={title:r,message:o,audienceKey:i,active:!0,createdAt:M(),createdBy:l||null,linkUrl:c||void 0,actionText:t||void 0};return(await E(f(p,"broadcasts"),a)).id}async function _(r){try{const{getDocs:o}=await y(async()=>{const{getDocs:t}=await import("./index-mBSeGJ8K.js").then(a=>a.cA);return{getDocs:t}},__vite__mapDeps([0,1]),import.meta.url),i=r.map(t=>{const a=A(f(p,"broadcasts"),v("audienceKey","==",t));return o(a)}),l=await Promise.all(i),c=[];return l.forEach(t=>{t.forEach(a=>{const s=a.data();s.active&&c.push({...s,id:a.id})})}),c.length===0?null:(c.sort((t,a)=>{var n,d;const s=typeof((n=t.createdAt)==null?void 0:n.toMillis)=="function"?t.createdAt.toMillis():0,e=typeof((d=a.createdAt)==null?void 0:d.toMillis)=="function"?a.createdAt.toMillis():0;return s-e}),c[c.length-1])}catch(o){return console.error("fetchActiveBroadcasts error:",o),null}}function B(r,o){return _(r).then(o),()=>{}}function k(r,o){const i=new Map,l=[],c=()=>{const t=new Map;i.forEach(s=>{s.forEach(e=>{e.id&&t.set(e.id,e)})});const a=Array.from(t.values());a.sort((s,e)=>{var u,h;const n=typeof((u=s.createdAt)==null?void 0:u.toMillis)=="function"?s.createdAt.toMillis():0;return(typeof((h=e.createdAt)==null?void 0:h.toMillis)=="function"?e.createdAt.toMillis():0)-n}),o(a)};return r.forEach(t=>{const a=A(f(p,"broadcasts"),v("audienceKey","==",t)),s=m(a,e=>{const n=[];e.forEach(d=>{const u=d.data();u.active&&n.push({...u,id:d.id})}),i.set(t,n),c()},e=>{console.error(`Error in broadcast subscription for key ${t}:`,e)});l.push(s)}),()=>{l.forEach(t=>t())}}export{w as E,k as a,q as p,B as s};
//# sourceMappingURL=broadcastService-BVTGigy9.js.map
