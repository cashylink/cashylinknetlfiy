const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DCCNgGPW.js","./index-CS_QnlXg.css"])))=>i.map(i=>d[i]);
import{W as b,af as v,q as A,n as f,o as h,az as y,y as E,z as M,H as m}from"./index-DCCNgGPW.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],D=b("external-link",_);async function q({title:r,message:o,audienceKey:i,createdBy:l,linkUrl:c}){const t={title:r,message:o,audienceKey:i,active:!0,createdAt:M(),createdBy:l||null,linkUrl:c||void 0};return(await E(f(h,"broadcasts"),t)).id}async function g(r){try{const{getDocs:o}=await v(async()=>{const{getDocs:t}=await import("./index-DCCNgGPW.js").then(a=>a.ck);return{getDocs:t}},__vite__mapDeps([0,1]),import.meta.url),i=r.map(t=>{const a=A(f(h,"broadcasts"),y("audienceKey","==",t));return o(a)}),l=await Promise.all(i),c=[];return l.forEach(t=>{t.forEach(a=>{const e=a.data();e.active&&c.push({...e,id:a.id})})}),c.length===0?null:(c.sort((t,a)=>{var n,d;const e=typeof((n=t.createdAt)==null?void 0:n.toMillis)=="function"?t.createdAt.toMillis():0,s=typeof((d=a.createdAt)==null?void 0:d.toMillis)=="function"?a.createdAt.toMillis():0;return e-s}),c[c.length-1])}catch(o){return console.error("fetchActiveBroadcasts error:",o),null}}function k(r,o){return g(r).then(o),()=>{}}function B(r,o){const i=new Map,l=[],c=()=>{const t=new Map;i.forEach(e=>{e.forEach(s=>{s.id&&t.set(s.id,s)})});const a=Array.from(t.values());a.sort((e,s)=>{var u,p;const n=typeof((u=e.createdAt)==null?void 0:u.toMillis)=="function"?e.createdAt.toMillis():0;return(typeof((p=s.createdAt)==null?void 0:p.toMillis)=="function"?s.createdAt.toMillis():0)-n}),o(a)};return r.forEach(t=>{const a=A(f(h,"broadcasts"),y("audienceKey","==",t)),e=m(a,s=>{const n=[];s.forEach(d=>{const u=d.data();u.active&&n.push({...u,id:d.id})}),i.set(t,n),c()},s=>{console.error(`Error in broadcast subscription for key ${t}:`,s)});l.push(e)}),()=>{l.forEach(t=>t())}}export{D as E,B as a,q as p,k as s};
//# sourceMappingURL=broadcastService-B0YvnSDq.js.map
