import{j as o,A as y,v as i,G as p,B as w,F as U}from"./index-BsVRzvOf.js";const a={phoneNumber:"201000392539",defaultMessage:"مرحباً، أريد الاستفسار عن خدماتكم",isEnabled:!0,lastUpdated:new Date},g="whatsapp-settings",h="app-settings",c="whatsapp_settings_cache",u=async()=>{var n;try{if(!y.currentUser){try{const s=localStorage.getItem(c);if(s){const r=JSON.parse(s);return{phoneNumber:r.phoneNumber||a.phoneNumber,defaultMessage:r.defaultMessage||a.defaultMessage,isEnabled:r.isEnabled!==void 0?r.isEnabled:a.isEnabled,lastUpdated:r.lastUpdated?new Date(r.lastUpdated):a.lastUpdated}}}catch{}return a}const e=i(p,h,g),t=await w(e);if(t.exists()){const s=t.data(),r={phoneNumber:s.phoneNumber||a.phoneNumber,defaultMessage:s.defaultMessage||a.defaultMessage,isEnabled:s.isEnabled!==void 0?s.isEnabled:a.isEnabled,lastUpdated:((n=s.lastUpdated)==null?void 0:n.toDate())||a.lastUpdated};try{localStorage.setItem(c,JSON.stringify(r))}catch{}return r}else return await f(a),a}catch{try{const e=localStorage.getItem(c);if(e){const t=JSON.parse(e);return{phoneNumber:t.phoneNumber||a.phoneNumber,defaultMessage:t.defaultMessage||a.defaultMessage,isEnabled:t.isEnabled!==void 0?t.isEnabled:a.isEnabled,lastUpdated:t.lastUpdated?new Date(t.lastUpdated):a.lastUpdated}}}catch{}return a}},f=async n=>{try{const e=i(p,h,g),t={...n,lastUpdated:new Date};await U(e,t,{merge:!0});try{localStorage.setItem(c,JSON.stringify(t))}catch{}return!0}catch(e){return console.error("خطأ في حفظ إعدادات الواتساب:",e),!1}},b=n=>{const e=n.replace(/\D/g,"");if(e.length<10)throw new Error("رقم الهاتف يجب أن يحتوي على 10 أرقام على الأقل");return e},N=n=>{try{const e=b(n);return e.length>=10&&e.length<=15}catch{return!1}},S=(n,e)=>{const t=b(n),s=encodeURIComponent(e);return`https://wa.me/${t}?text=${s}`},M=()=>{const[n,e]=o.useState(null),[t,s]=o.useState(!0),[r,d]=o.useState(null);return o.useEffect(()=>{(async()=>{try{s(!0);const l=await u();e(l),d(null)}catch(l){d("فشل في تحميل إعدادات الواتساب"),console.error(l)}finally{s(!1)}})()},[]),{settings:n,loading:t,error:r,updateSettings:async l=>{try{return s(!0),await f(l)&&n?(e({...n,...l,lastUpdated:new Date}),d(null),!0):(d("فشل في حفظ الإعدادات"),!1)}catch(m){return d("خطأ في تحديث الإعدادات"),console.error(m),!1}finally{s(!1)}},refreshSettings:()=>u().then(e)}};export{S as D,M,b,N as w};
//# sourceMappingURL=whatsappService-D7s14JCG-CtNQG8BW.js.map
