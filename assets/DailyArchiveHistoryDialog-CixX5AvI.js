import{m as S,R as a,j as e,ah as A,ai as w,aj as C,ak as M,aM as k,y as B,I as L,aV as R,B as j,aZ as g}from"./index-CgV0sHeM.js";const n=i=>Math.round(Number(i||0)).toLocaleString("en-US"),F=({open:i,onOpenChange:d,userId:s})=>{const{toast:o}=S(),[r,h]=a.useState([]),[y,x]=a.useState(!1),[l,p]=a.useState(""),[N,m]=a.useState(!1),u=a.useCallback(()=>`daily_archive_history_${s||"default"}`,[s]);a.useEffect(()=>{(async()=>{if(!(!i||!s))try{x(!0);const f=[...await g.getByUser(s,1e3)].sort((b,D)=>b.reportDate<D.reportDate?1:-1);h(f);try{localStorage.setItem(u(),JSON.stringify(f))}catch{}}catch(c){console.error("Failed to load daily archive history:",c),o({title:"فشل تحميل الأرشيف",description:"تعذر تحميل أرشيف التقارير اليومية",variant:"destructive"})}finally{x(!1)}})()},[i,s]);const v=a.useMemo(()=>{if(!l)return r;const t=l.trim();return r.filter(c=>c.reportDate.includes(t))},[r,l]);return e.jsx(A,{open:i,onOpenChange:d,children:e.jsxs(w,{className:"sm:max-w-xl",children:[e.jsxs(C,{children:[e.jsx(M,{children:"آخر التقارير"}),e.jsx(k,{children:"يعرض تقارير جميع الأيام المؤرشفة مع التاريخ وملخص كل يوم."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"archive-search",children:"بحث بالتاريخ (YYYY-MM-DD)"}),e.jsx(L,{id:"archive-search",placeholder:"مثال: 2025-10-19",value:l,onChange:t=>p(t.target.value)})]}),e.jsx("div",{className:"mt-3 space-y-2 max-h-[50vh] overflow-auto",children:y?e.jsx("div",{className:"text-sm text-muted-foreground",children:"جاري التحميل..."}):v.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"لا توجد تقارير مؤرشفة حتى الآن"}):v.map(t=>e.jsxs("div",{className:"border rounded-md p-2 bg-gradient-to-r from-white/80 to-blue-50/70",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("div",{className:"font-bold text-blue-800",children:t.reportDate}),e.jsxs("div",{className:"text-xs text-blue-700",children:["المعاملات: ",t.totalTransactions]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[e.jsxs("div",{className:"text-xs text-blue-800",children:["الاجمالي: ",e.jsx("span",{className:"font-semibold",children:n(t.totalAmount)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["المسحوب: ",e.jsx("span",{className:"font-semibold",children:n(t.totalWithdrawn)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["المرسل: ",e.jsx("span",{className:"font-semibold",children:n(t.totalSent)})]}),e.jsxs("div",{className:"text-xs text-green-700",children:["الأرباح: ",e.jsx("span",{className:"font-semibold",children:n(t.profit)})]})]})]},t.id||`${t.userId}-${t.reportDate}`))}),e.jsxs(R,{children:[e.jsx(j,{variant:"destructive",onClick:async()=>{if(s)try{m(!0),await g.deleteAllByUser(s),h([]);try{localStorage.setItem(u(),JSON.stringify([]))}catch{}o({title:"تم حذف جميع إيصالات الأرشيف",description:"تم الحذف من السحابة والكاش المحلي."})}catch{o({title:"تعذر حذف الأرشيف بالكامل",description:"تم إخفاء السجلات الحديثة وقد لا تظهر بعد التحديث.",variant:"destructive"})}finally{m(!1)}},disabled:N||!r.length,children:"حذف جميع إيصالات الأرشيف"}),e.jsx(j,{variant:"outline",onClick:()=>d(!1),children:"إغلاق"})]})]})})};export{F as DailyArchiveHistoryDialog,F as default};
//# sourceMappingURL=DailyArchiveHistoryDialog-CixX5AvI.js.map
