{"version":3,"mappings":"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","names":["__iconNode","Building","createLucideIcon","IdCard","Info","walletProviders","WalletsViewPage","isOpen","onClose","onWalletSelect","onEditWallet","onDeleteWallet","user","useFirebaseAuth","wallets","setWallets","useState","selectMode","setSelectMode","selectedIds","setSelectedIds","isLoading","setIsLoading","toast","useToast","calculateWalletMonthlyUsage","walletId","transactions","currentMonth","currentYear","monthlyTransactions","t","transactionDate","isWithdrawTx","type","isSendTx","withdrawalUsage","sum","amount","transferUsage","checkAndResetMonthlyUsage","wallet","today","lastReset","lastResetDate","currentDate","useEffect","firebaseWallets","merchantWalletService","transactionService","walletsWithResetCheck","w","limits","walletDailyLimitsService","error","getProviderInfo","providerId","p","getUsagePercentage","used","limit","formatNumber","num","jsx","Dialog","jsxs","DialogContent","DialogHeader","DialogTitle","Wallet","Badge","Fragment","Button","ops","prev","e","providerInfo","isSelected","cardClasses","Card","id","CardHeader","CardTitle","CreditCard","Star","Edit","Trash2","CardContent","Phone","monthlyWithdrawalLimit","monthlyTransferLimit","monthlyWithdrawUsed","monthlyTransferUsed","remainingWithdraw","remainingTransfer","ArrowLeft","WalletDetailsPage","onBack","setTransactions","selectedPeriod","setSelectedPeriod","walletTransactions","a","b","formatDate","dateString","filteredTransactions","now","startDate","xn","totalWithdrawals","totalTransfers","totalDeposits","completedTransactions","operationsCount","totalProfit","calculateProfit","withdrawalPercentage","transferPercentage","getTransactionIcon","TrendingDown","TrendingUp","DollarSign","Activity","getStatusIcon","status","CheckCircle","Clock","XCircle","AlertCircle","getTransactionTypeText","getStatusText","Calendar","BarChart3","Progress","Separator","transaction","WalletManagement","onWalletUpdate","initialEditingWallet","userSubscription","raw","_a","_b","s","SubscriptionPlan","navigate","useNavigate","isAddingWallet","setIsAddingWallet","editingWallet","setEditingWallet","walletName","setWalletName","walletPhone","setWalletPhone","walletNationalId","setWalletNationalId","walletProvider","setWalletProvider","setMonthlyWithdrawalLimit","setMonthlyTransferLimit","dailyWithdrawalLimit","setDailyWithdrawalLimit","dailyTransferLimit","setDailyTransferLimit","isDefault","setIsDefault","showProviderInfo","setShowProviderInfo","showWalletsView","setShowWalletsView","isMasterPinDialogOpen","setIsMasterPinDialogOpen","selectedWallet","setSelectedWallet","getWalletsKey","lastResetMonth","lastResetYear","calculateWalletDailyUsage","currentDay","dailyTransactions","auth","__vitePreload","n","retryCount","maxRetries","resolve","dailyWithdrawalUsage","dailyTransferUsage","resetForm","saveWallet","updatedWallets","newWalletData","newWalletId","walletToAdd","newWallets","handleEditWallet","handleDeleteWallet","walletToDelete","handleSetDefault","Eye","Plus","Select","SelectTrigger","SelectValue","SelectContent","provider","SelectItem","Input","Settings","X","MasterPinDialog","updated","err"],"ignoreList":[0,1,2],"sources":["../../node_modules/lucide-react/dist/esm/icons/building.js","../../node_modules/lucide-react/dist/esm/icons/id-card.js","../../node_modules/lucide-react/dist/esm/icons/info.js","../../src/components/WalletsViewPage.tsx","../../src/components/WalletDetailsPage.tsx","../../src/components/WalletManagement.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 10h.01\", key: \"1nrarc\" }],\n  [\"path\", { d: \"M12 14h.01\", key: \"1etili\" }],\n  [\"path\", { d: \"M12 6h.01\", key: \"1vi96p\" }],\n  [\"path\", { d: \"M16 10h.01\", key: \"1m94wz\" }],\n  [\"path\", { d: \"M16 14h.01\", key: \"1gbofw\" }],\n  [\"path\", { d: \"M16 6h.01\", key: \"1x0f13\" }],\n  [\"path\", { d: \"M8 10h.01\", key: \"19clt8\" }],\n  [\"path\", { d: \"M8 14h.01\", key: \"6423bh\" }],\n  [\"path\", { d: \"M8 6h.01\", key: \"1dz90k\" }],\n  [\"path\", { d: \"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3\", key: \"cabbwy\" }],\n  [\"rect\", { x: \"4\", y: \"2\", width: \"16\", height: \"20\", rx: \"2\", key: \"1uxh74\" }]\n];\nconst Building = createLucideIcon(\"building\", __iconNode);\n\nexport { __iconNode, Building as default };\n//# sourceMappingURL=building.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 10h2\", key: \"8sgtl7\" }],\n  [\"path\", { d: \"M16 14h2\", key: \"epxaof\" }],\n  [\"path\", { d: \"M6.17 15a3 3 0 0 1 5.66 0\", key: \"n6f512\" }],\n  [\"circle\", { cx: \"9\", cy: \"11\", r: \"2\", key: \"yxgjnd\" }],\n  [\"rect\", { x: \"2\", y: \"5\", width: \"20\", height: \"14\", rx: \"2\", key: \"qneu4z\" }]\n];\nconst IdCard = createLucideIcon(\"id-card\", __iconNode);\n\nexport { __iconNode, IdCard as default };\n//# sourceMappingURL=id-card.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"M12 16v-4\", key: \"1dtifu\" }],\n  [\"path\", { d: \"M12 8h.01\", key: \"e9boi3\" }]\n];\nconst Info = createLucideIcon(\"info\", __iconNode);\n\nexport { __iconNode, Info as default };\n//# sourceMappingURL=info.js.map\n","import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Wallet, Phone, DollarSign, Star, CreditCard, TrendingUp, TrendingDown, ArrowLeft, IdCard, Building, Edit, Trash2 } from 'lucide-react';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { merchantWalletService, transactionService } from '@/integrations/firebase/services';\r\nimport walletDailyLimitsService from '@/utils/walletDailyLimitsService';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\ninterface Wallet {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  nationalId?: string;\r\n  isDefault: boolean;\r\n  isActive?: boolean;\r\n  monthlyWithdrawalLimit: number;\r\n  monthlyTransferLimit: number;\r\n  monthlyWithdrawalUsage?: number;\r\n  monthlyTransferUsage?: number;\r\n  lastResetDate?: string;\r\n  walletProvider?: string;\r\n}\r\n\r\ninterface WalletsViewPageProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onWalletSelect: (wallet: Wallet) => void;\r\n  onEditWallet?: (wallet: Wallet) => void;\r\n  onDeleteWallet?: (walletId: string) => void;\r\n}\r\n\r\n// بيانات شركات المحفظة\r\nconst walletProviders = [\r\n  {\r\n    id: 'vodafone',\r\n    name: 'فودافون كاش',\r\n    ownerName: 'أحمد محمد علي',\r\n    nationalId: '29012345678901'\r\n  },\r\n  {\r\n    id: 'etisalat',\r\n    name: 'اتصالات كاش',\r\n    ownerName: 'فاطمة حسن محمود',\r\n    nationalId: '28506789012345'\r\n  },\r\n  {\r\n    id: 'orange',\r\n    name: 'أورنج كاش',\r\n    ownerName: 'محمد أحمد السيد',\r\n    nationalId: '29309876543210'\r\n  },\r\n  {\r\n    id: 'we_pay',\r\n    name: 'وي باي',\r\n    ownerName: 'نورا عبد الرحمن',\r\n    nationalId: '29112345678901'\r\n  },\r\n  {\r\n    id: 'smart_wallet',\r\n    name: 'سمارت ولت',\r\n    ownerName: 'خالد محمد عبد الله',\r\n    nationalId: '28809876543210'\r\n  },\r\n  {\r\n    id: 'access_pay',\r\n    name: 'أكسس باي',\r\n    ownerName: 'مريم أحمد حسن',\r\n    nationalId: '29456789012345'\r\n  },\r\n  {\r\n    id: 'insta_pay',\r\n    name: 'انستا باي',\r\n    ownerName: 'عمر سعد محمد',\r\n    nationalId: '29012345678901'\r\n  }\r\n];\r\n\r\nconst WalletsViewPage: React.FC<WalletsViewPageProps> = ({ isOpen, onClose, onWalletSelect, onEditWallet, onDeleteWallet }) => {\r\n  const { user } = useFirebaseAuth();\r\n  const [wallets, setWallets] = useState<Wallet[]>([]);\r\n  const [selectMode, setSelectMode] = useState<boolean>(false);\r\n  const [selectedIds, setSelectedIds] = useState<string[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  // دالة للحصول على مفتاح localStorage المرتبط بالمستخدم\r\n  const getWalletsKey = () => `wallets_${user?.uid || 'default'}`;\r\n\r\n  // محاولة تحميل المحافظ من المفاتيح القديمة ثم نقلها للمفتاح الحالي\r\n  const loadWalletsFromLocalWithMigration = (): any[] | null => {\r\n    try {\r\n      const currentKey = getWalletsKey();\r\n      const current = localStorage.getItem(currentKey);\r\n      if (current) {\r\n        const parsed = JSON.parse(current);\r\n        if (Array.isArray(parsed) && parsed.length > 0) return parsed;\r\n      }\r\n      const legacyDefaultKey = 'wallets_default';\r\n      const legacyDefault = localStorage.getItem(legacyDefaultKey);\r\n      if (legacyDefault) {\r\n        const parsed = JSON.parse(legacyDefault);\r\n        if (Array.isArray(parsed) && parsed.length > 0) {\r\n          localStorage.setItem(currentKey, legacyDefault);\r\n          try { localStorage.removeItem(legacyDefaultKey); } catch {}\r\n          return parsed;\r\n        }\r\n      }\r\n      const keys = Object.keys(localStorage).filter(k => k.startsWith('wallets_') && k !== currentKey);\r\n      let best: any[] | null = null;\r\n      let bestKey: string | null = null;\r\n      for (const k of keys) {\r\n        try {\r\n          const s = localStorage.getItem(k);\r\n          if (!s) continue;\r\n          const parsed = JSON.parse(s);\r\n          if (Array.isArray(parsed) && parsed.length > 0) {\r\n            if (!best || parsed.length > (best?.length || 0)) {\r\n              best = parsed;\r\n              bestKey = k;\r\n            }\r\n          }\r\n        } catch {}\r\n      }\r\n      if (best && bestKey) {\r\n        localStorage.setItem(currentKey, JSON.stringify(best));\r\n        try { localStorage.removeItem(bestKey); } catch {}\r\n        return best;\r\n      }\r\n    } catch (e) {\r\n      console.warn('WalletsViewPage migration failed:', e);\r\n    }\r\n    return null;\r\n  };\r\n\r\n  // دالة لحساب الاستخدام الشهري للمحفظة\r\n  const calculateWalletMonthlyUsage = async (walletId: string, transactions: any[]) => {\r\n    const currentMonth = new Date().getMonth();\r\n    const currentYear = new Date().getFullYear();\r\n    \r\n    const monthlyTransactions = transactions.filter(t => {\r\n      const transactionDate = new Date(t.createdAt);\r\n      return (\r\n        transactionDate.getMonth() === currentMonth && \r\n        transactionDate.getFullYear() === currentYear &&\r\n        // مطابقة المعاملات لهذه المحفظة (توافق مع الحقول المختلفة)\r\n        (t.lineId === walletId || t.fromWallet === walletId)\r\n      );\r\n    });\r\n\r\n    // توحيد أنواع المعاملات والحقول المستخدمة لضمان دقة الحسابات عبر المخططات المختلفة\r\n    const isWithdrawTx = (t: any) => {\r\n      const type = t.type;\r\n      const xn = (t as any).txnType;\r\n      return (\r\n        xn === 'receive' ||\r\n        type === 'withdraw' ||\r\n        type === 'withdrawal' ||\r\n        type === 'receive'\r\n      );\r\n    };\r\n\r\n    const isSendTx = (t: any) => {\r\n      const type = t.type;\r\n      const xn = (t as any).txnType;\r\n      return (\r\n        xn === 'send' ||\r\n        type === 'send' ||\r\n        type === 'transfer'\r\n      );\r\n    };\r\n\r\n    const withdrawalUsage = monthlyTransactions\r\n      .filter(isWithdrawTx)\r\n      .reduce((sum, t) => {\r\n        const amount = (t as any).withdrawnAmount !== undefined ? (t as any).withdrawnAmount : t.amount;\r\n        return sum + (amount || 0);\r\n      }, 0);\r\n\r\n    const transferUsage = monthlyTransactions\r\n      .filter(isSendTx)\r\n      .reduce((sum, t) => {\r\n        const amount = (t as any).sentAmount !== undefined ? (t as any).sentAmount : t.amount;\r\n        return sum + (amount || 0);\r\n      }, 0);\r\n\r\n    return { withdrawalUsage, transferUsage };\r\n  };\r\n\r\n  // دالة لفحص وإعادة تعيين العدادات الشهرية\r\n  const checkAndResetMonthlyUsage = (wallet: Wallet): Wallet => {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const lastReset = wallet.lastResetDate;\r\n    \r\n    if (!lastReset) {\r\n      return {\r\n        ...wallet,\r\n        monthlyWithdrawalUsage: 0,\r\n        monthlyTransferUsage: 0,\r\n        lastResetDate: today\r\n      };\r\n    }\r\n\r\n    const lastResetDate = new Date(lastReset);\r\n    const currentDate = new Date();\r\n    \r\n    // فحص إذا كان الشهر قد تغير\r\n    if (lastResetDate.getMonth() !== currentDate.getMonth() || \r\n        lastResetDate.getFullYear() !== currentDate.getFullYear()) {\r\n      return {\r\n        ...wallet,\r\n        monthlyWithdrawalUsage: 0,\r\n        monthlyTransferUsage: 0,\r\n        lastResetDate: today\r\n      };\r\n    }\r\n\r\n    return wallet;\r\n  };\r\n\r\n  // تحميل المحافظ\r\n  useEffect(() => {\r\n    if (!user?.uid || !isOpen) return;\r\n\r\n    const loadWallets = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        const firebaseWallets = await merchantWalletService.getByMerchantId(user.uid);\r\n        const transactions = await transactionService.getByUserId(user.uid);\r\n        \r\n        const formattedWallets = await Promise.all(firebaseWallets.map(async w => {\r\n          const { withdrawalUsage, transferUsage } = await calculateWalletMonthlyUsage(w.id, transactions);\r\n          const limits = await walletDailyLimitsService.getWalletLimits(w.id);\r\n          return {\r\n            id: w.id,\r\n            name: w.label || 'محفظة بدون اسم',\r\n            phone: w.msisdn,\r\n            nationalId: w.nationalId || '',\r\n            isDefault: false,\r\n            isActive: (w as any).isActive === true,\r\n            monthlyWithdrawalLimit: (limits?.monthlyWithdrawLimit ?? w.withdrawLimit ?? 200000),\r\n            monthlyTransferLimit: (limits?.monthlyTransferLimit ?? w.transferLimit ?? 200000),\r\n            monthlyWithdrawalUsage: (limits?.monthlyWithdrawUsed ?? withdrawalUsage ?? 0),\r\n            monthlyTransferUsage: (limits?.monthlyTransferUsed ?? transferUsage ?? 0),\r\n            lastResetDate: new Date().toISOString().split('T')[0],\r\n            walletProvider: (w.walletProvider || '')\r\n          };\r\n        }));\r\n        \r\n        const walletsWithResetCheck = formattedWallets.map(checkAndResetMonthlyUsage);\r\n        setWallets(walletsWithResetCheck);\r\n        \r\n      } catch (error) {\r\n        console.error('Error loading wallets:', error);\r\n        // إظهار تحذير واضح للمستخدم عند فشل جلب البيانات من Firestore\r\n        toast({\r\n          title: 'فشل جلب بيانات المحافظ',\r\n          description: 'قد تكون المشكلة بسبب الصلاحيات أو الاتصال. سيتم عرض البيانات المحلية إن وُجدت. جرّب تسجيل الدخول مجددًا أو افتح صفحة اختبار المصادقة من القائمة.',\r\n          variant: 'destructive'\r\n        });\r\n        \r\n        // لا نعرض بيانات محلية عند الفشل؛ نكتفي بالتنبيه ويظل العرض فارغًا حتى يعود الاتصال\r\n     } finally {\r\n       setIsLoading(false);\r\n     }\r\n    };\r\n\r\n    loadWallets();\r\n  }, [user?.uid, isOpen]);\r\n\r\n  // دالة للحصول على معلومات شركة المحفظة\r\n  const getProviderInfo = (providerId: string) => {\r\n    return walletProviders.find(p => p.id === providerId);\r\n  };\r\n\r\n  // دالة لحساب النسبة المئوية للاستخدام\r\n  const getUsagePercentage = (used: number, limit: number) => {\r\n    return limit > 0 ? Math.min((used / limit) * 100, 100) : 0;\r\n  };\r\n\r\n  // دالة لتنسيق الأرقام\r\n  const formatNumber = (num: number) => {\r\n    return new Intl.NumberFormat('ar-EG').format(num);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader className=\"pb-4\">\r\n          <DialogTitle className=\"flex items-center gap-2 text-lg\">\r\n            <Wallet className=\"h-5 w-5\" />\r\n            الاطلاع على جميع المحافظ\r\n            <Badge variant=\"secondary\" className=\"mr-2\">\r\n              {wallets.length} محفظة\r\n            </Badge>\r\n          </DialogTitle>\r\n          <div className=\"flex items-center gap-2 mt-2\">\r\n            {!selectMode ? (\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => setSelectMode(true)}\r\n                className=\"h-7\"\r\n              >\r\n                تحديد المحافظ\r\n              </Button>\r\n            ) : (\r\n              <>\r\n                <Button\r\n                  size=\"sm\"\r\n                  onClick={async () => {\r\n                    try {\r\n                      if (!user?.uid) return;\r\n                      const ops = wallets.map(w => merchantWalletService.update(w.id, { isActive: selectedIds.includes(w.id) }));\r\n                      await Promise.all(ops);\r\n                      setWallets(prev => prev.map(w => ({ ...w, isActive: selectedIds.includes(w.id) })));\r\n                      setSelectMode(false);\r\n                      toast({ title: 'تم تفعيل المحافظ', description: 'فقط المحافظ المحددة ستظهر في الاختيار الخارجي' });\r\n                      try { window.dispatchEvent(new CustomEvent('wallets:activation-updated')); } catch {}\r\n                    } catch (e) {\r\n                      console.error('Error activating wallets:', e);\r\n                      toast({ title: 'فشل التفعيل', description: 'تعذر تفعيل المحافظ المحددة', variant: 'destructive' });\r\n                    }\r\n                  }}\r\n                  className=\"h-7\"\r\n                >\r\n                  تفعيل المحافظ\r\n                </Button>\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={() => { setSelectMode(false); setSelectedIds([]); }}\r\n                  className=\"h-7\"\r\n                >\r\n                  إلغاء\r\n                </Button>\r\n              </>\r\n            )}\r\n          </div>\r\n        </DialogHeader>\r\n\r\n        {isLoading ? (\r\n          <div className=\"flex justify-center items-center py-8\">\r\n            <div className=\"text-center\">\r\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2\"></div>\r\n              <p className=\"text-sm text-gray-600\">جاري تحميل المحافظ...</p>\r\n            </div>\r\n          </div>\r\n        ) : wallets.length === 0 ? (\r\n          <div className=\"text-center py-8\">\r\n            <Wallet className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n            <p className=\"text-gray-600\">لا توجد محافظ مضافة حتى الآن</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n            {wallets.map((wallet) => {\r\n              const providerInfo = getProviderInfo(wallet.walletProvider || '');\r\n              const withdrawalPercentage = getUsagePercentage(\r\n                wallet.monthlyWithdrawalUsage || 0,\r\n                wallet.monthlyWithdrawalLimit\r\n              );\r\n              const transferPercentage = getUsagePercentage(\r\n                wallet.monthlyTransferUsage || 0,\r\n                wallet.monthlyTransferLimit\r\n              );\r\n\r\n              const isSelected = selectedIds.includes(wallet.id);\r\n              const cardClasses = selectMode\r\n                ? `cursor-pointer transition-shadow border-2 ${isSelected ? 'border-blue-500 shadow-lg' : 'hover:border-blue-300'}`\r\n                : 'cursor-pointer hover:shadow-lg transition-shadow border-2 hover:border-blue-300';\r\n\r\n              return (\r\n                <Card \r\n                  key={wallet.id} \r\n                  className={cardClasses}\r\n                  onClick={() => {\r\n                    if (selectMode) {\r\n                      setSelectedIds(prev => prev.includes(wallet.id) ? prev.filter(id => id !== wallet.id) : [...prev, wallet.id]);\r\n                    } else {\r\n                      onWalletSelect(wallet);\r\n                    }\r\n                  }}\r\n                >\r\n                  <CardHeader className=\"pb-3\">\r\n                    <CardTitle className=\"flex items-center justify-between text-sm\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <CreditCard className=\"h-4 w-4\" />\r\n                        <span>{wallet.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        {wallet.isActive && (\r\n                          <Badge variant=\"default\" className=\"text-xs\">نشطة</Badge>\r\n                        )}\r\n                        {wallet.isDefault && (\r\n                          <Badge variant=\"default\" className=\"text-xs\">\r\n                            <Star className=\"h-3 w-3 mr-1\" />\r\n                            افتراضية\r\n                          </Badge>\r\n                        )}\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            onEditWallet?.(wallet);\r\n                          }}\r\n                          className=\"h-7 px-2\"\r\n                        >\r\n                          <Edit className=\"h-4 w-4\" />\r\n                        </Button>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            onDeleteWallet?.(wallet.id);\r\n                          }}\r\n                          className=\"h-7 px-2 text-destructive hover:text-destructive\"\r\n                        >\r\n                          <Trash2 className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </div>\r\n                    </CardTitle>\r\n                  </CardHeader>\r\n                  \r\n                  <CardContent className=\"space-y-3\">\r\n                    {/* معلومات أساسية */}\r\n                    <div className=\"space-y-2\">\r\n                      <div className=\"flex items-center gap-2 text-sm\">\r\n                        <Phone className=\"h-3 w-3 text-gray-500\" />\r\n                        <span className=\"font-mono\">{wallet.phone}</span>\r\n                      </div>\r\n                      \r\n                      {wallet.nationalId && (\r\n                        <div className=\"flex items-center gap-2 text-sm\">\r\n                          <IdCard className=\"h-3 w-3 text-gray-500\" />\r\n                          <span className=\"font-mono\">{wallet.nationalId}</span>\r\n                        </div>\r\n                      )}\r\n                      \r\n                      {providerInfo && (\r\n                        <div className=\"flex items-center gap-2 text-sm\">\r\n                          <Building className=\"h-3 w-3 text-gray-500\" />\r\n                          <span>{providerInfo.name}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/* الحدود الشهرية بشكل موحد كما في الخارج */}\r\n                    {(() => {\r\n                      const monthlyWithdrawalLimit = wallet.monthlyWithdrawalLimit;\r\n                      const monthlyTransferLimit = wallet.monthlyTransferLimit;\r\n                      const monthlyWithdrawUsed = wallet.monthlyWithdrawalUsage || 0;\r\n                      const monthlyTransferUsed = wallet.monthlyTransferUsage || 0;\r\n                      const remainingWithdraw = Math.max(monthlyWithdrawalLimit - monthlyWithdrawUsed, 0);\r\n                      const remainingTransfer = Math.max(monthlyTransferLimit - monthlyTransferUsed, 0);\r\n\r\n                      return (\r\n                        <div className=\"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2\">\r\n                          <div className=\"text-xs text-gray-600 font-medium text-center\">\r\n                            الحدود الشهرية: {providerInfo?.name || wallet.walletProvider} - {wallet.phone}\r\n                          </div>\r\n                          <div className=\"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex\">\r\n                            <div className=\"w-1/2 bg-red-200 relative\">\r\n                              <div\r\n                                className=\"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-200 ease-out shadow-sm\"\r\n                                style={{ width: `${Math.min(((monthlyWithdrawUsed / Math.max(monthlyWithdrawalLimit, 1)) * 100), 100)}%` }}\r\n                              ></div>\r\n                            </div>\r\n                            <div className=\"w-1/2 bg-blue-200 relative\">\r\n                              <div\r\n                                className=\"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-200 ease-out shadow-sm\"\r\n                                style={{ width: `${Math.min(((monthlyTransferUsed / Math.max(monthlyTransferLimit, 1)) * 100), 100)}%` }}\r\n                              ></div>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex justify-between items-center mt-1\">\r\n                            <div className=\"text-xs text-red-600 font-medium\">\r\n                              متبقي سحب: {formatNumber(remainingWithdraw)} جنيه\r\n                            </div>\r\n                            <div className=\"text-xs text-blue-600 font-medium\">\r\n                              متبقي تحويل: {formatNumber(remainingTransfer)} جنيه\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })()}\r\n\r\n                    {/* زر عرض التفاصيل */}\r\n                    <Button \r\n                      variant=\"outline\" \r\n                      size=\"sm\" \r\n                      className=\"w-full text-xs\"\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        onWalletSelect(wallet);\r\n                      }}\r\n                    >\r\n                      عرض التفاصيل الكاملة\r\n                    </Button>\r\n                  </CardContent>\r\n                </Card>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"flex justify-end pt-4 border-t\">\r\n          <Button onClick={onClose} variant=\"outline\">\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n            إغلاق\r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default WalletsViewPage;","import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { \r\n  Wallet, \r\n  Phone, \r\n  DollarSign, \r\n  Star, \r\n  CreditCard, \r\n  TrendingUp, \r\n  TrendingDown, \r\n  ArrowLeft, \r\n  IdCard, \r\n  Building, \r\n  Calendar,\r\n  Activity,\r\n  BarChart3,\r\n  Clock,\r\n  CheckCircle,\r\n  XCircle,\r\n  AlertCircle\r\n} from 'lucide-react';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { transactionService } from '@/integrations/firebase/services';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { calculateProfit } from '@/utils/commissionCalculator';\r\n\r\ninterface Wallet {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  nationalId?: string;\r\n  isDefault: boolean;\r\n  monthlyWithdrawalLimit: number;\r\n  monthlyTransferLimit: number;\r\n  monthlyWithdrawalUsage?: number;\r\n  monthlyTransferUsage?: number;\r\n  lastResetDate?: string;\r\n  walletProvider?: string;\r\n}\r\n\r\ninterface Transaction {\r\n  id: string;\r\n  type: 'withdrawal' | 'transfer' | 'deposit';\r\n  amount: number;\r\n  status: 'completed' | 'pending' | 'failed';\r\n  createdAt: string;\r\n  description?: string;\r\n  walletId: string;\r\n}\r\n\r\ninterface WalletDetailsPageProps {\r\n  wallet: Wallet | null;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onBack: () => void;\r\n}\r\n\r\n// بيانات شركات المحفظة\r\nconst walletProviders = [\r\n  {\r\n    id: 'vodafone',\r\n    name: 'فودافون كاش',\r\n    ownerName: 'أحمد محمد علي',\r\n    nationalId: '29012345678901'\r\n  },\r\n  {\r\n    id: 'etisalat',\r\n    name: 'اتصالات كاش',\r\n    ownerName: 'فاطمة حسن محمود',\r\n    nationalId: '28506789012345'\r\n  },\r\n  {\r\n    id: 'orange',\r\n    name: 'أورنج كاش',\r\n    ownerName: 'محمد أحمد السيد',\r\n    nationalId: '29309876543210'\r\n  },\r\n  {\r\n    id: 'we_pay',\r\n    name: 'وي باي',\r\n    ownerName: 'نورا عبد الرحمن',\r\n    nationalId: '29112345678901'\r\n  },\r\n  {\r\n    id: 'smart_wallet',\r\n    name: 'سمارت ولت',\r\n    ownerName: 'خالد محمد عبد الله',\r\n    nationalId: '28809876543210'\r\n  },\r\n  {\r\n    id: 'access_pay',\r\n    name: 'أكسس باي',\r\n    ownerName: 'مريم أحمد حسن',\r\n    nationalId: '29456789012345'\r\n  },\r\n  {\r\n    id: 'insta_pay',\r\n    name: 'انستا باي',\r\n    ownerName: 'عمر سعد محمد',\r\n    nationalId: '29012345678901'\r\n  }\r\n];\r\n\r\nconst WalletDetailsPage: React.FC<WalletDetailsPageProps> = ({ wallet, isOpen, onClose, onBack }) => {\r\n  const { user } = useFirebaseAuth();\r\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [selectedPeriod, setSelectedPeriod] = useState<'week' | 'month' | 'all'>('month');\r\n  const { toast } = useToast();\r\n\r\n  // تحميل المعاملات\r\n  useEffect(() => {\r\n    if (!wallet || !user?.uid || !isOpen) return;\r\n\r\n    const loadTransactions = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        const allTransactions = await transactionService.getByUserId(user.uid);\r\n        const walletTransactions = allTransactions\r\n          .filter(t => t.walletId === wallet.id)\r\n          .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n        \r\n        setTransactions(walletTransactions);\r\n      } catch (error) {\r\n        console.error('Error loading transactions:', error);\r\n        toast({\r\n          title: 'فشل جلب معاملات المحفظة',\r\n          description: 'قد تكون المشكلة بسبب صلاحيات Firestore أو الاتصال. تم عرض ما أمكن محليًا. جرّب تسجيل الدخول مجددًا أو صفحة اختبار المصادقة.',\r\n          variant: 'destructive'\r\n        });\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    loadTransactions();\r\n  }, [wallet, user?.uid, isOpen]);\r\n\r\n  if (!wallet) return null;\r\n\r\n  // دالة للحصول على معلومات شركة المحفظة\r\n  const getProviderInfo = (providerId: string) => {\r\n    return walletProviders.find(p => p.id === providerId);\r\n  };\r\n\r\n  // دالة لحساب النسبة المئوية للاستخدام\r\n  const getUsagePercentage = (used: number, limit: number) => {\r\n    return limit > 0 ? Math.min((used / limit) * 100, 100) : 0;\r\n  };\r\n\r\n  // دالة لتنسيق الأرقام\r\n  const formatNumber = (num: number) => {\r\n    return new Intl.NumberFormat('ar-EG').format(num);\r\n  };\r\n\r\n  // دالة لتنسيق التاريخ\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('ar-EG', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  // دالة لفلترة المعاملات حسب الفترة\r\n  const getFilteredTransactions = () => {\r\n    const now = new Date();\r\n    let startDate: Date;\r\n\r\n    switch (selectedPeriod) {\r\n      case 'week':\r\n        startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n        break;\r\n      case 'month':\r\n        startDate = new Date(now.getFullYear(), now.getMonth(), 1);\r\n        break;\r\n      default:\r\n        return transactions;\r\n    }\r\n\r\n    return transactions.filter(t => new Date(t.createdAt) >= startDate);\r\n  };\r\n\r\n  // حساب الإحصائيات\r\n  const filteredTransactions = getFilteredTransactions();\r\n  // توحيد أنواع المعاملات عبر المخططات المختلفة لضمان عدم اختفاء القيم\r\n  const isWithdrawTx = (t: any) => {\r\n    const type = t.type;\r\n    const xn = (t as any).txnType;\r\n    return (\r\n      type === 'withdraw' ||\r\n      type === 'withdrawal' ||\r\n      type === 'receive' ||\r\n      xn === 'receive'\r\n    );\r\n  };\r\n  const isSendTx = (t: any) => {\r\n    const type = t.type;\r\n    const xn = (t as any).txnType;\r\n    return (\r\n      type === 'send' ||\r\n      type === 'transfer' ||\r\n      xn === 'send'\r\n    );\r\n  };\r\n\r\n  const totalWithdrawals = filteredTransactions\r\n    .filter(t => isWithdrawTx(t) && t.status === 'completed')\r\n    .reduce((sum, t) => {\r\n      const amount = (t as any).withdrawnAmount !== undefined ? (t as any).withdrawnAmount : t.amount;\r\n      return sum + (amount || 0);\r\n    }, 0);\r\n  const totalTransfers = filteredTransactions\r\n    .filter(t => isSendTx(t) && t.status === 'completed')\r\n    .reduce((sum, t) => {\r\n      const amount = (t as any).sentAmount !== undefined ? (t as any).sentAmount : t.amount;\r\n      return sum + (amount || 0);\r\n    }, 0);\r\n  const totalDeposits = filteredTransactions\r\n    .filter(t => t.type === 'deposit' && t.status === 'completed')\r\n    .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n  // حساب الأرباح وعدد العمليات خلال الفترة المحددة\r\n  const completedTransactions = filteredTransactions.filter(t => t.status === 'completed');\r\n  const operationsCount = completedTransactions.length;\r\n  const totalProfit = completedTransactions.reduce((sum, t: any) => {\r\n    if (isWithdrawTx(t)) {\r\n      const amount = t.withdrawnAmount ?? t.receivedAmount ?? t.amount ?? 0;\r\n      return sum + calculateProfit(Number(amount) || 0, 'receive');\r\n    }\r\n    if (isSendTx(t)) {\r\n      const amount = t.sentAmount ?? t.transferredAmount ?? t.amount ?? 0;\r\n      return sum + calculateProfit(Number(amount) || 0, 'send');\r\n    }\r\n    return sum;\r\n  }, 0);\r\n\r\n  const providerInfo = getProviderInfo(wallet.walletProvider || '');\r\n  const withdrawalPercentage = getUsagePercentage(\r\n    wallet.monthlyWithdrawalUsage || 0,\r\n    wallet.monthlyWithdrawalLimit\r\n  );\r\n  const transferPercentage = getUsagePercentage(\r\n    wallet.monthlyTransferUsage || 0,\r\n    wallet.monthlyTransferLimit\r\n  );\r\n\r\n  // دالة للحصول على أيقونة نوع المعاملة\r\n  const getTransactionIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'withdrawal':\r\n        return <TrendingDown className=\"h-4 w-4 text-red-500\" />;\r\n      case 'transfer':\r\n        return <TrendingUp className=\"h-4 w-4 text-blue-500\" />;\r\n      case 'deposit':\r\n        return <DollarSign className=\"h-4 w-4 text-green-500\" />;\r\n      default:\r\n        return <Activity className=\"h-4 w-4 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  // دالة للحصول على أيقونة حالة المعاملة\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return <CheckCircle className=\"h-4 w-4 text-green-500\" />;\r\n      case 'pending':\r\n        return <Clock className=\"h-4 w-4 text-yellow-500\" />;\r\n      case 'failed':\r\n        return <XCircle className=\"h-4 w-4 text-red-500\" />;\r\n      default:\r\n        return <AlertCircle className=\"h-4 w-4 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  // دالة للحصول على نص نوع المعاملة\r\n  const getTransactionTypeText = (type: string) => {\r\n    switch (type) {\r\n      case 'withdrawal':\r\n        return 'سحب';\r\n      case 'transfer':\r\n        return 'تحويل';\r\n      case 'deposit':\r\n        return 'إيداع';\r\n      default:\r\n        return 'معاملة';\r\n    }\r\n  };\r\n\r\n  // دالة للحصول على نص حالة المعاملة\r\n  const getStatusText = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return 'مكتملة';\r\n      case 'pending':\r\n        return 'قيد الانتظار';\r\n      case 'failed':\r\n        return 'فاشلة';\r\n      default:\r\n        return 'غير محدد';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader className=\"pb-4\">\r\n          <DialogTitle className=\"flex items-center gap-2 text-lg\">\r\n            <CreditCard className=\"h-5 w-5\" />\r\n            تفاصيل المحفظة: {wallet.name}\r\n            {wallet.isDefault && (\r\n              <Badge variant=\"default\" className=\"mr-2\">\r\n                <Star className=\"h-3 w-3 mr-1\" />\r\n                افتراضية\r\n              </Badge>\r\n            )}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n          {/* معلومات المحفظة الأساسية */}\r\n          <div className=\"lg:col-span-1 space-y-4\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"text-sm flex items-center gap-2\">\r\n                  <IdCard className=\"h-4 w-4\" />\r\n                  المعلومات الأساسية\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-3\">\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  <Phone className=\"h-4 w-4 text-gray-500\" />\r\n                  <span className=\"font-mono\">{wallet.phone}</span>\r\n                </div>\r\n                \r\n                {wallet.nationalId && (\r\n                  <div className=\"flex items-center gap-2 text-sm\">\r\n                    <IdCard className=\"h-4 w-4 text-gray-500\" />\r\n                    <span className=\"font-mono\">{wallet.nationalId}</span>\r\n                  </div>\r\n                )}\r\n                \r\n                {providerInfo && (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex items-center gap-2 text-sm\">\r\n                      <Building className=\"h-4 w-4 text-gray-500\" />\r\n                      <span>{providerInfo.name}</span>\r\n                    </div>\r\n                    <div className=\"text-xs text-gray-600 pr-6\">\r\n                      <div>المالك: {providerInfo.ownerName}</div>\r\n                      <div className=\"font-mono\">الرقم القومي: {providerInfo.nationalId}</div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {wallet.lastResetDate && (\r\n                  <div className=\"flex items-center gap-2 text-sm\">\r\n                    <Calendar className=\"h-4 w-4 text-gray-500\" />\r\n                    <span>آخر إعادة تعيين: {new Date(wallet.lastResetDate).toLocaleDateString('ar-EG')}</span>\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* حدود الاستخدام */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"text-sm flex items-center gap-2\">\r\n                  <BarChart3 className=\"h-4 w-4\" />\r\n                  حدود الاستخدام الشهري\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                {/* حدود السحب */}\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"flex items-center justify-between text-xs\">\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <TrendingDown className=\"h-3 w-3 text-red-500\" />\r\n                      السحب الشهري\r\n                    </span>\r\n                    <span className=\"font-mono\">\r\n                      {formatNumber(wallet.monthlyWithdrawalUsage || 0)} / {formatNumber(wallet.monthlyWithdrawalLimit)}\r\n                    </span>\r\n                  </div>\r\n                  <Progress \r\n                    value={withdrawalPercentage} \r\n                    className=\"h-2\"\r\n                  />\r\n                  <div className=\"text-xs text-gray-600\">\r\n                    متبقي: {formatNumber(wallet.monthlyWithdrawalLimit - (wallet.monthlyWithdrawalUsage || 0))} جنيه\r\n                  </div>\r\n                </div>\r\n\r\n                <Separator />\r\n\r\n                {/* حدود التحويل */}\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"flex items-center justify-between text-xs\">\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <TrendingUp className=\"h-3 w-3 text-green-500\" />\r\n                      التحويل الشهري\r\n                    </span>\r\n                    <span className=\"font-mono\">\r\n                      {formatNumber(wallet.monthlyTransferUsage || 0)} / {formatNumber(wallet.monthlyTransferLimit)}\r\n                    </span>\r\n                  </div>\r\n                  <Progress \r\n                    value={transferPercentage} \r\n                    className=\"h-2\"\r\n                  />\r\n                  <div className=\"text-xs text-gray-600\">\r\n                    متبقي: {formatNumber(wallet.monthlyTransferLimit - (wallet.monthlyTransferUsage || 0))} جنيه\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* المعاملات والإحصائيات */}\r\n          <div className=\"lg:col-span-2 space-y-4\">\r\n            {/* إحصائيات سريعة */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <TrendingDown className=\"h-5 w-5 text-red-500\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalWithdrawals)}</div>\r\n                  <div className=\"text-xs text-gray-600\">إجمالي السحب</div>\r\n                </CardContent>\r\n              </Card>\r\n              \r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <TrendingUp className=\"h-5 w-5 text-blue-500\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalTransfers)}</div>\r\n                  <div className=\"text-xs text-gray-600\">إجمالي التحويل</div>\r\n                </CardContent>\r\n              </Card>\r\n              \r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <DollarSign className=\"h-5 w-5 text-green-500\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalDeposits)}</div>\r\n                  <div className=\"text-xs text-gray-600\">إجمالي الإيداع</div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* أرباح الفترة */}\r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <BarChart3 className=\"h-5 w-5 text-emerald-600\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalProfit)}</div>\r\n                  <div className=\"text-xs text-gray-600\">أرباح الفترة</div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* عدد العمليات */}\r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <Activity className=\"h-5 w-5 text-purple-600\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(operationsCount)}</div>\r\n                  <div className=\"text-xs text-gray-600\">عدد العمليات</div>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n\r\n            {/* فلتر الفترة الزمنية */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"text-sm flex items-center justify-between\">\r\n                  <span className=\"flex items-center gap-2\">\r\n                    <Activity className=\"h-4 w-4\" />\r\n                    سجل المعاملات\r\n                  </span>\r\n                  <div className=\"flex gap-2\">\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant={selectedPeriod === 'week' ? 'default' : 'outline'}\r\n                      onClick={() => setSelectedPeriod('week')}\r\n                      className=\"text-xs\"\r\n                    >\r\n                      أسبوع\r\n                    </Button>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant={selectedPeriod === 'month' ? 'default' : 'outline'}\r\n                      onClick={() => setSelectedPeriod('month')}\r\n                      className=\"text-xs\"\r\n                    >\r\n                      شهر\r\n                    </Button>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant={selectedPeriod === 'all' ? 'default' : 'outline'}\r\n                      onClick={() => setSelectedPeriod('all')}\r\n                      className=\"text-xs\"\r\n                    >\r\n                      الكل\r\n                    </Button>\r\n                  </div>\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                {isLoading ? (\r\n                  <div className=\"flex justify-center items-center py-8\">\r\n                    <div className=\"text-center\">\r\n                      <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2\"></div>\r\n                      <p className=\"text-sm text-gray-600\">جاري تحميل المعاملات...</p>\r\n                    </div>\r\n                  </div>\r\n                ) : filteredTransactions.length === 0 ? (\r\n                  <div className=\"text-center py-8\">\r\n                    <Activity className=\"h-8 w-8 text-gray-400 mx-auto mb-2\" />\r\n                    <p className=\"text-gray-600\">لا توجد معاملات في هذه الفترة</p>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-2 max-h-96 overflow-y-auto\">\r\n                    {filteredTransactions.map((transaction) => (\r\n                      <div key={transaction.id} className=\"flex items-center justify-between p-3 border rounded-lg\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          {getTransactionIcon(transaction.type)}\r\n                          <div>\r\n                            <div className=\"text-sm font-medium\">\r\n                              {getTransactionTypeText(transaction.type)} - {formatNumber(transaction.amount)} جنيه\r\n                            </div>\r\n                            <div className=\"text-xs text-gray-600\">\r\n                              {formatDate(transaction.createdAt)}\r\n                            </div>\r\n                            {transaction.description && (\r\n                              <div className=\"text-xs text-gray-500 mt-1\">\r\n                                {transaction.description}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          {getStatusIcon(transaction.status)}\r\n                          <span className=\"text-xs\">{getStatusText(transaction.status)}</span>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex justify-between pt-4 border-t\">\r\n          <Button onClick={onBack} variant=\"outline\">\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n            العودة للمحافظ\r\n          </Button>\r\n          <Button onClick={onClose} variant=\"outline\">\r\n            إغلاق\r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default WalletDetailsPage;","import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Wallet, Plus, Edit, Trash2, Phone, DollarSign, X, Settings, Info, Star, StarOff, CreditCard, TrendingUp, TrendingDown, Save, IdCard, Eye, Printer } from 'lucide-react';\r\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { SubscriptionPlan } from '@/utils/subscriptionService';\r\nimport { merchantWalletService, transactionService } from '@/integrations/firebase/services';\r\nimport { walletSelectionPinService } from '@/utils/walletSelectionPinService';\r\nimport { walletDailyLimitsService } from '@/utils/walletDailyLimitsService';\r\nimport WalletsViewPage from './WalletsViewPage';\r\nimport WalletDetailsPage from './WalletDetailsPage';\r\n\r\ninterface Wallet {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  nationalId?: string; // الرقم القومي للخط\r\n  isDefault: boolean;\r\n  monthlyWithdrawalLimit: number;\r\n  monthlyTransferLimit: number;\r\n  monthlyWithdrawalUsage?: number; // المبلغ المسحوب هذا الشهر\r\n  monthlyTransferUsage?: number; // المبلغ المحول هذا الشهر\r\n  dailyWithdrawalLimit: number; // الحد الأقصى للسحب اليومي\r\n  dailyTransferLimit: number; // الحد الأقصى للتحويل اليومي\r\n  dailyWithdrawalUsage?: number; // المبلغ المسحوب اليوم\r\n  dailyTransferUsage?: number; // المبلغ المحول اليوم\r\n  lastResetDate?: string; // تاريخ آخر إعادة تعيين للعدادات\r\n  walletProvider?: string; // شركة المحفظة\r\n}\r\n\r\ninterface WalletManagementProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onWalletUpdate?: () => void;\r\n  initialEditingWallet?: Wallet | null;\r\n}\r\n\r\n// بيانات شركات المحفظة مع معلومات أصحاب الخطوط\r\nconst walletProviders = [\r\n  {\r\n    id: 'vodafone',\r\n    name: 'فودافون كاش',\r\n    ownerName: 'أحمد محمد علي',\r\n    nationalId: '29012345678901'\r\n  },\r\n  {\r\n    id: 'etisalat',\r\n    name: 'اتصالات كاش',\r\n    ownerName: 'فاطمة حسن محمود',\r\n    nationalId: '28506789012345'\r\n  },\r\n  {\r\n    id: 'orange',\r\n    name: 'أورنج كاش',\r\n    ownerName: 'محمد أحمد السيد',\r\n    nationalId: '29309876543210'\r\n  },\r\n  {\r\n    id: 'we_pay',\r\n    name: 'وي باي',\r\n    ownerName: 'نورا عبد الرحمن',\r\n    nationalId: '29112345678901'\r\n  },\r\n  {\r\n    id: 'smart_wallet',\r\n    name: 'سمارت ولت',\r\n    ownerName: 'خالد محمد عبد الله',\r\n    nationalId: '28809876543210'\r\n  },\r\n  {\r\n    id: 'access_pay',\r\n    name: 'أكسس باي',\r\n    ownerName: 'مريم أحمد حسن',\r\n    nationalId: '29456789012345'\r\n  },\r\n  {\r\n    id: 'insta_pay',\r\n    name: 'انستا باي',\r\n    ownerName: 'عمر سعد محمد',\r\n    nationalId: '29012345678901'\r\n  }\r\n];\r\n\r\nconst WalletManagement: React.FC<WalletManagementProps> = ({ isOpen, onClose, onWalletUpdate, initialEditingWallet }) => {\r\n  const { toast } = useToast();\r\n  const { user, userSubscription } = useFirebaseAuth();\r\n  const isTahweelaPlan = (() => {\r\n    const raw = (userSubscription as any)?.subscription?.planType ?? (userSubscription as any)?.subscription?.plan ?? (userSubscription as any)?.planType ?? (userSubscription as any)?.plan ?? null;\r\n    const s = typeof raw === 'string' ? String(raw).trim().toLowerCase() : null;\r\n    return raw === SubscriptionPlan.TAHWEELA || s === 'tahweela' || s === 'تحويله';\r\n  })();\r\n  const navigate = useNavigate();\r\n  const [wallets, setWallets] = useState<Wallet[]>([]);\r\n  const [isAddingWallet, setIsAddingWallet] = useState(false);\r\n  const [editingWallet, setEditingWallet] = useState<Wallet | null>(null);\r\n  const [walletName, setWalletName] = useState('');\r\n  const [walletPhone, setWalletPhone] = useState('');\r\n  const [walletNationalId, setWalletNationalId] = useState('');\r\n  const [walletProvider, setWalletProvider] = useState('');\r\n  const [monthlyWithdrawalLimit, setMonthlyWithdrawalLimit] = useState('200000');\r\n  const [monthlyTransferLimit, setMonthlyTransferLimit] = useState('200000');\r\n  const [dailyWithdrawalLimit, setDailyWithdrawalLimit] = useState('100000');\r\n  const [dailyTransferLimit, setDailyTransferLimit] = useState('60000');\r\n  const [isDefault, setIsDefault] = useState(false);\r\n  const [showProviderInfo, setShowProviderInfo] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [showWalletsView, setShowWalletsView] = useState(false);\r\n  const [isMasterPinDialogOpen, setIsMasterPinDialogOpen] = useState(false);\r\n  const [selectedWallet, setSelectedWallet] = useState<Wallet | null>(null);\r\n\r\n  // دالة للحصول على مفتاح localStorage المرتبط بالمستخدم\r\n  const getWalletsKey = () => `wallets_${user?.uid || 'default'}`;\r\n\r\n  // افتح نموذج التعديل مباشرة إذا تم تمرير محفظة للتعديل\r\n  useEffect(() => {\r\n    if (initialEditingWallet) {\r\n      setEditingWallet(initialEditingWallet);\r\n      setIsAddingWallet(true);\r\n      setWalletName(initialEditingWallet.name || '');\r\n      setWalletPhone(initialEditingWallet.phone || '');\r\n      setWalletNationalId(initialEditingWallet.nationalId || '');\r\n      setWalletProvider(initialEditingWallet.walletProvider || '');\r\n      setMonthlyWithdrawalLimit((initialEditingWallet.monthlyWithdrawalLimit || 200000).toString());\r\n      setMonthlyTransferLimit((initialEditingWallet.monthlyTransferLimit || 200000).toString());\r\n      setDailyWithdrawalLimit((initialEditingWallet.dailyWithdrawalLimit || 100000).toString());\r\n      setDailyTransferLimit((initialEditingWallet.dailyTransferLimit || 60000).toString());\r\n      setIsDefault(!!initialEditingWallet.isDefault);\r\n    }\r\n  }, [initialEditingWallet]);\r\n\r\n  // دالة لفحص وإعادة تعيين العدادات الشهرية\r\n  const checkAndResetMonthlyUsage = (wallet: Wallet): Wallet => {\r\n    const currentDate = new Date();\r\n    const currentMonth = currentDate.getMonth();\r\n    const currentYear = currentDate.getFullYear();\r\n    \r\n    if (!wallet.lastResetDate) {\r\n      // إذا لم يكن هناك تاريخ إعادة تعيين، قم بتعيين التاريخ الحالي\r\n      return {\r\n        ...wallet,\r\n        monthlyWithdrawalUsage: wallet.monthlyWithdrawalUsage || 0,\r\n        monthlyTransferUsage: wallet.monthlyTransferUsage || 0,\r\n        lastResetDate: currentDate.toISOString().split('T')[0]\r\n      };\r\n    }\r\n    \r\n    const lastResetDate = new Date(wallet.lastResetDate);\r\n    const lastResetMonth = lastResetDate.getMonth();\r\n    const lastResetYear = lastResetDate.getFullYear();\r\n    \r\n    // إذا كان الشهر أو السنة مختلفة، قم بإعادة تعيين العدادات\r\n    if (currentMonth !== lastResetMonth || currentYear !== lastResetYear) {\r\n      return {\r\n        ...wallet,\r\n        monthlyWithdrawalUsage: 0,\r\n        monthlyTransferUsage: 0,\r\n        lastResetDate: currentDate.toISOString().split('T')[0]\r\n      };\r\n    }\r\n    \r\n    return wallet;\r\n  };\r\n\r\n  // دالة لحساب الاستخدام الشهري للمحفظة من Firebase (تستخدم مخطط المعاملة الحالي)\r\n  const calculateWalletMonthlyUsage = async (walletId: string, transactions: any[]) => {\r\n    const currentMonth = new Date().getMonth();\r\n    const currentYear = new Date().getFullYear();\r\n    \r\n    const monthlyTransactions = transactions.filter((t: any) => {\r\n      const transactionDate = new Date(t.createdAt);\r\n      return (\r\n        transactionDate.getMonth() === currentMonth && \r\n        transactionDate.getFullYear() === currentYear &&\r\n        t.lineId === walletId\r\n      );\r\n    });\r\n\r\n    // \"receive\" = عمليات السحب من المحفظة، \"send\" = عمليات التحويل من المحفظة\r\n    const withdrawalUsage = monthlyTransactions\r\n      .filter((t: any) => t.txnType === 'receive')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    const transferUsage = monthlyTransactions\r\n      .filter((t: any) => t.txnType === 'send')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    return { withdrawalUsage, transferUsage };\r\n  };\r\n\r\n  // دالة لحساب الاستخدام اليومي للمحفظة (تستخدم مخطط المعاملة الحالي)\r\n  const calculateWalletDailyUsage = async (walletId: string, transactions: any[]) => {\r\n    const today = new Date();\r\n    const currentDay = today.getDate();\r\n    const currentMonth = today.getMonth();\r\n    const currentYear = today.getFullYear();\r\n    \r\n    const dailyTransactions = transactions.filter((t: any) => {\r\n      const transactionDate = new Date(t.createdAt);\r\n      return (\r\n        transactionDate.getDate() === currentDay &&\r\n        transactionDate.getMonth() === currentMonth && \r\n        transactionDate.getFullYear() === currentYear &&\r\n        t.lineId === walletId\r\n      );\r\n    });\r\n\r\n    const withdrawalUsage = dailyTransactions\r\n      .filter((t: any) => t.txnType === 'receive')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    const transferUsage = dailyTransactions\r\n      .filter((t: any) => t.txnType === 'send')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    return { withdrawalUsage, transferUsage };\r\n  };\r\n\r\n  // دالة لتحديث استخدام المحفظة\r\n  const updateWalletUsage = async (walletId: string) => {\r\n    try {\r\n      // جلب المعاملات من Firebase\r\n      const transactions = await transactionService.getByUserId(user?.uid || '');\r\n      const { withdrawalUsage, transferUsage } = await calculateWalletMonthlyUsage(walletId, transactions);\r\n      \r\n      setWallets(prevWallets => \r\n        prevWallets.map(wallet => {\r\n          if (wallet.id === walletId) {\r\n            const updatedWallet = checkAndResetMonthlyUsage(wallet);\r\n            return {\r\n              ...updatedWallet,\r\n              monthlyWithdrawalUsage: withdrawalUsage,\r\n              monthlyTransferUsage: transferUsage\r\n            };\r\n          }\r\n          return checkAndResetMonthlyUsage(wallet);\r\n        })\r\n      );\r\n    } catch (error) {\r\n      console.error('Error updating wallet usage:', error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Load wallets from Firebase for the current user\r\n    const loadWallets = async () => {\r\n      // التحقق من وجود المستخدم وحالة المصادقة\r\n      if (!user?.uid) {\r\n        console.log('No user authenticated, skipping wallet loading');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      \r\n      console.log('Loading wallets for user:', user.uid);\r\n      setIsLoading(true);\r\n      \r\n      try {\r\n        // التحقق من حالة المصادقة قبل الطلبات مع انتظار أطول\r\n        const { auth } = await import('@/firebase');\r\n        \r\n        // انتظار حتى يتم تحميل حالة المصادقة بالكامل\r\n        let retryCount = 0;\r\n        const maxRetries = 5;\r\n        \r\n        while (!auth.currentUser && retryCount < maxRetries) {\r\n          console.log(`Waiting for auth state... attempt ${retryCount + 1}`);\r\n          await new Promise(resolve => setTimeout(resolve, 1000));\r\n          retryCount++;\r\n        }\r\n        \r\n        if (!auth.currentUser) {\r\n          console.error('User not authenticated in Firebase Auth after retries');\r\n          throw new Error('not authenticated');\r\n        }\r\n        \r\n        console.log('Firebase Auth User:', auth.currentUser.uid);\r\n        console.log('Context User:', user.uid);\r\n        \r\n        console.log('Fetching wallets from Firebase...');\r\n        const firebaseWallets = await merchantWalletService.getByMerchantId(user.uid);\r\n        console.log('Fetched wallets:', firebaseWallets);\r\n        \r\n        console.log('Fetching transactions from Firebase...');\r\n        const transactions = await transactionService.getByUserId(user.uid);\r\n        console.log('Fetched transactions:', transactions);\r\n        \r\n        const formattedWallets = await Promise.all(firebaseWallets.map(async w => {\r\n          const { withdrawalUsage, transferUsage } = await calculateWalletMonthlyUsage(w.id, transactions);\r\n          const { withdrawalUsage: dailyWithdrawalUsage, transferUsage: dailyTransferUsage } = await calculateWalletDailyUsage(w.id, transactions);\r\n          \r\n          return {\r\n            id: w.id,\r\n            name: w.label || 'محفظة بدون اسم',\r\n            phone: w.msisdn,\r\n            isDefault: false, // يمكن تحديد المحفظة الافتراضية لاحقاً\r\n            monthlyWithdrawalLimit: w.withdrawLimit || 200000,\r\n            monthlyTransferLimit: w.transferLimit || 200000,\r\n            dailyWithdrawalLimit: (w as any).dailyWithdrawLimit || 100000, // الحد الأقصى للسحب اليومي\r\n            dailyTransferLimit: (w as any).dailyTransferLimit || 60000, // الحد الأقصى للتحويل اليومي\r\n            monthlyWithdrawalUsage: withdrawalUsage,\r\n            monthlyTransferUsage: transferUsage,\r\n            dailyWithdrawalUsage: dailyWithdrawalUsage,\r\n            dailyTransferUsage: dailyTransferUsage,\r\n            lastResetDate: new Date().toISOString().split('T')[0],\r\n            // ضم حقول العمولات الافتراضية إن كانت محفوظة في Firebase\r\n            defaultTransferCommission: (w.defaultTransferCommission != null ? Number(w.defaultTransferCommission) : null),\r\n            defaultWithdrawCommission: (w.defaultWithdrawCommission != null ? Number(w.defaultWithdrawCommission) : null)\r\n          };\r\n        }));\r\n        \r\n        // تطبيق فحص إعادة التعيين على جميع المحافظ\r\n        const walletsWithResetCheck = formattedWallets.map(checkAndResetMonthlyUsage);\r\n        setWallets(walletsWithResetCheck);\r\n        console.log('Wallets loaded successfully:', walletsWithResetCheck);\r\n        \r\n      } catch (error) {\r\n        console.error('Error loading wallets:', error);\r\n        // عدم استخدام بيانات محلية للعرض عند الفشل؛ سيظهر المحتوى فارغًا حتى يعود الاتصال\r\n        setWallets([]);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    loadWallets();\r\n  }, [user?.uid]);\r\n\r\n  const resetForm = () => {\r\n    setWalletName('');\r\n    setWalletPhone('');\r\n    setWalletNationalId('');\r\n    setWalletProvider('');\r\n    setMonthlyWithdrawalLimit('200000');\r\n    setMonthlyTransferLimit('200000');\r\n    setDailyWithdrawalLimit('100000');\r\n    setDailyTransferLimit('60000');\r\n    setIsDefault(false);\r\n    setEditingWallet(null);\r\n    setIsAddingWallet(false);\r\n  };\r\n\r\n  const startEdit = (wallet: Wallet) => {\r\n    setWalletName(wallet.name);\r\n    setWalletPhone(wallet.phone);\r\n    setMonthlyWithdrawalLimit(wallet.monthlyWithdrawalLimit.toString());\r\n    setMonthlyTransferLimit(wallet.monthlyTransferLimit.toString());\r\n    setDailyWithdrawalLimit(wallet.dailyWithdrawalLimit.toString());\r\n    setDailyTransferLimit(wallet.dailyTransferLimit.toString());\r\n    setIsDefault(wallet.isDefault);\r\n    setEditingWallet(wallet);\r\n    setIsAddingWallet(true);\r\n  };\r\n\r\n  const saveWallet = async () => {\r\n    if (!walletName.trim() || !walletPhone.trim() || !walletProvider.trim()) {\r\n      toast({\r\n        title: \"خطأ\",\r\n        description: \"يرجى ملء جميع الحقول المطلوبة\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!user?.uid) {\r\n      toast({\r\n        title: \"خطأ\",\r\n        description: \"يجب تسجيل الدخول أولاً\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      if (editingWallet) {\r\n        // Update existing wallet in Firebase\r\n        await merchantWalletService.update(editingWallet.id, {\r\n          label: walletName.trim(),\r\n          msisdn: walletPhone.trim(),\r\n          withdrawLimit: parseInt(monthlyWithdrawalLimit),\r\n          transferLimit: parseInt(monthlyTransferLimit),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit),\r\n          dailyTransferLimit: parseInt(dailyTransferLimit)\r\n        });\r\n\r\n        // Sync limits to walletLimits collection for enforcement\r\n        await walletDailyLimitsService.setLimits(editingWallet.id, {\r\n          dailyTransferLimit: parseInt(dailyTransferLimit || '0'),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit || '0'),\r\n          monthlyTransferLimit: parseInt(monthlyTransferLimit || '0'),\r\n          monthlyWithdrawLimit: parseInt(monthlyWithdrawalLimit || '0')\r\n        });\r\n\r\n        // Update existing wallet in local state\r\n        const updatedWallets = wallets.map(w => \r\n          w.id === editingWallet.id \r\n            ? { \r\n                ...w, \r\n                name: walletName.trim(), \r\n                phone: walletPhone.trim(),\r\n                nationalId: walletNationalId.trim(),\r\n                walletProvider: walletProvider,\r\n                monthlyWithdrawalLimit: parseInt(monthlyWithdrawalLimit),\r\n                monthlyTransferLimit: parseInt(monthlyTransferLimit),\r\n                dailyWithdrawalLimit: parseInt(dailyWithdrawalLimit),\r\n                dailyTransferLimit: parseInt(dailyTransferLimit)\r\n              }\r\n            : w\r\n        );\r\n        \r\n        setWallets(updatedWallets);\r\n        \r\n        // Also save to localStorage for backward compatibility\r\n        localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n        \r\n        toast({\r\n          title: \"تم التحديث\",\r\n          description: \"تم تحديث المحفظة بنجاح\",\r\n        });\r\n\r\n      } else {\r\n        // Create new wallet in Firebase\r\n        const newWalletData = {\r\n          merchantUserId: user.uid,\r\n          provider: walletProvider as const,\r\n          msisdn: walletPhone.trim(),\r\n          label: walletName.trim(),\r\n          isActive: true,\r\n          dailyLimit: 200000,\r\n          monthlyLimit: 200000,\r\n          withdrawLimit: parseInt(monthlyWithdrawalLimit),\r\n          transferLimit: parseInt(monthlyTransferLimit),\r\n          dailyTransferLimit: parseInt(dailyTransferLimit),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit),\r\n          dailyUsage: 0,\r\n          monthlyUsage: 0,\r\n          transferUsage: 0,\r\n          withdrawUsage: 0\r\n        };\r\n\r\n        const newWalletId = await merchantWalletService.create(newWalletData);\r\n        \r\n        // Sync limits to walletLimits collection for enforcement\r\n        await walletDailyLimitsService.setLimits(newWalletId, {\r\n          dailyTransferLimit: parseInt(dailyTransferLimit || '0'),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit || '0'),\r\n          monthlyTransferLimit: parseInt(monthlyTransferLimit || '0'),\r\n          monthlyWithdrawLimit: parseInt(monthlyWithdrawalLimit || '0')\r\n        });\r\n        \r\n        // Add to local state with reset usage counters\r\n        const currentDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format\r\n        const walletToAdd = {\r\n          id: newWalletId,\r\n          name: walletName.trim(),\r\n          phone: walletPhone.trim(),\r\n          nationalId: walletNationalId.trim(),\r\n          walletProvider: walletProvider,\r\n          isDefault: isDefault,\r\n          monthlyWithdrawalLimit: parseInt(monthlyWithdrawalLimit),\r\n          monthlyTransferLimit: parseInt(monthlyTransferLimit),\r\n          dailyWithdrawalLimit: parseInt(dailyWithdrawalLimit),\r\n          dailyTransferLimit: parseInt(dailyTransferLimit),\r\n          monthlyWithdrawalUsage: 0, // بدء من الصفر للمحفظة الجديدة\r\n          monthlyTransferUsage: 0, // بدء من الصفر للمحفظة الجديدة\r\n          dailyWithdrawalUsage: 0, // بدء من الصفر للمحفظة الجديدة\r\n          dailyTransferUsage: 0, // بدء من الصفر للمحفظة الجديدة\r\n          lastResetDate: currentDate, // تسجيل تاريخ الإنشاء\r\n          // ضمان الاتساق: تعريف حقول العمولات الافتراضية للمحفظة الجديدة\r\n          defaultTransferCommission: null,\r\n          defaultWithdrawCommission: null\r\n        };\r\n        \r\n        const newWallets = [...wallets, walletToAdd];\r\n        setWallets(newWallets);\r\n        \r\n        // Also save to localStorage for backward compatibility\r\n        localStorage.setItem(getWalletsKey(), JSON.stringify(newWallets));\r\n        \r\n        toast({\r\n          title: \"تم الإنشاء\",\r\n          description: \"تم إنشاء المحفظة بنجاح\",\r\n        });\r\n      }\r\n      \r\n      if (onWalletUpdate) {\r\n        onWalletUpdate();\r\n      }\r\n\r\n      resetForm();\r\n      setIsAddingWallet(false);\r\n      setEditingWallet(null);\r\n    } catch (error) {\r\n      console.error('Error saving wallet:', error);\r\n      toast({\r\n        title: \"خطأ\",\r\n        description: \"حدث خطأ أثناء حفظ المحفظة\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleEditWallet = (wallet: Wallet) => {\r\n    setEditingWallet(wallet);\r\n    setWalletName(wallet.name);\r\n    setWalletPhone(wallet.phone);\r\n    setWalletNationalId(wallet.nationalId || '');\r\n    setWalletProvider(wallet.walletProvider || '');\r\n    setMonthlyWithdrawalLimit(wallet.monthlyWithdrawalLimit.toString());\r\n    setMonthlyTransferLimit(wallet.monthlyTransferLimit.toString());\r\n    setIsDefault(wallet.isDefault);\r\n    setIsAddingWallet(true);\r\n  };\r\n\r\n  const handleUpdateWallet = () => {\r\n    if (!editingWallet || !walletName || !walletPhone) {\r\n      toast({\r\n        title: \"خطأ\",\r\n        description: \"يرجى ملء جميع الحقول المطلوبة\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    const updatedWallets = wallets.map(w => \r\n      w.id === editingWallet.id \r\n        ? { ...w, name: walletName, phone: walletPhone, monthlyWithdrawalLimit: parseInt(monthlyWithdrawalLimit), monthlyTransferLimit: parseInt(monthlyTransferLimit) }\r\n        : w\r\n    );\r\n\r\n    setWallets(updatedWallets);\r\n    localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n    setEditingWallet(null);\r\n    resetForm();\r\n\r\n    // Call the update callback if provided\r\n    if (onWalletUpdate) {\r\n      onWalletUpdate();\r\n    }\r\n\r\n    toast({\r\n      title: \"تم تحديث المحفظة\",\r\n      description: \"تم تحديث بيانات المحفظة بنجاح\",\r\n    });\r\n  };\r\n\r\n  const handleDeleteWallet = async (walletId: string) => {\r\n    const walletToDelete = wallets.find(w => w.id === walletId);\r\n    \r\n    if (walletToDelete?.isDefault) {\r\n      toast({\r\n        title: \"تحذير\",\r\n        description: \"لا يمكن حذف المحفظة الافتراضية\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!user?.uid) {\r\n      toast({\r\n        title: \"خطأ\",\r\n        description: \"يجب تسجيل الدخول أولاً\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      // Delete from Firebase\r\n      await merchantWalletService.delete(walletId);\r\n      \r\n      // Update local state\r\n      const updatedWallets = wallets.filter(w => w.id !== walletId);\r\n      setWallets(updatedWallets);\r\n      \r\n      // Also update localStorage for backward compatibility\r\n      localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n      \r\n      if (onWalletUpdate) {\r\n        onWalletUpdate();\r\n      }\r\n\r\n      toast({\r\n        title: \"تم الحذف\",\r\n        description: \"تم حذف المحفظة بنجاح\",\r\n      });\r\n    } catch (error) {\r\n      console.error('Error deleting wallet:', error);\r\n      toast({\r\n        title: \"خطأ\",\r\n        description: \"حدث خطأ أثناء حذف المحفظة\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSetDefault = (walletId: string) => {\r\n    const updatedWallets = wallets.map(w => ({\r\n      ...w,\r\n      isDefault: w.id === walletId\r\n    }));\r\n\r\n    setWallets(updatedWallets);\r\n    localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n    \r\n    // Call the update callback if provided\r\n    if (onWalletUpdate) {\r\n      onWalletUpdate();\r\n    }\r\n\r\n    toast({\r\n      title: \"تم تحديث المحفظة الافتراضية\",\r\n      description: \"تم تعيين المحفظة كافتراضية بنجاح\",\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\r\n        <DialogHeader className=\"pb-2\">\r\n          <DialogTitle className=\"flex items-center gap-1 text-sm\">\r\n            <Wallet className=\"h-3 w-3\" />\r\n            إدارة المحافظ\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-2\">\r\n          {/* Add New Wallet Button */}\r\n          <div className=\"flex justify-between items-center\">\r\n            <h3 className=\"text-sm font-semibold\">المحافظ المتاحة ({wallets.length})</h3>\r\n            <div className=\"flex gap-2\">\r\n              <Button\r\n                onClick={() => {\r\n                  // اجبار ادخال الرقم السري الرئيسي قبل الاطلاع على المحافظ\r\n                  setIsMasterPinDialogOpen(true);\r\n                }}\r\n                className=\"flex items-center gap-1 h-6 px-2 text-xs\"\r\n                size=\"sm\"\r\n                variant=\"outline\"\r\n              >\r\n                <Eye className=\"h-3 w-3\" />\r\n                الاطلاع على المحافظ\r\n              </Button>\r\n              <Button\r\n                onClick={() => {\r\n                  onClose();\r\n                  navigate('/user/add-wallet');\r\n                }}\r\n                className=\"flex items-center gap-1 h-6 px-2 text-xs\"\r\n                size=\"sm\"\r\n              >\r\n                <Plus className=\"h-3 w-3\" />\r\n                إضافة محفظة جديدة\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Add/Edit Wallet Form */}\r\n          {(isAddingWallet || editingWallet) && (\r\n            <Card className=\"border-2 border-blue-200 bg-blue-50\">\r\n              <CardHeader className=\"pb-1\">\r\n                <CardTitle className=\"text-sm\">\r\n                  {editingWallet ? 'تعديل المحفظة' : 'إضافة محفظة جديدة'}\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-2 pt-1\">\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                    شركة المحفظة\r\n                  </label>\r\n                  <div className=\"flex gap-1 items-center\">\r\n                    <Select value={walletProvider} onValueChange={setWalletProvider}>\r\n                      <SelectTrigger className=\"h-6 text-xs flex-1\">\r\n                        <SelectValue placeholder=\"اختر شركة المحفظة\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {walletProviders.map((provider) => (\r\n                          <SelectItem key={provider.id} value={provider.id} className=\"text-xs\">\r\n                            <div className=\"flex items-center justify-between w-full\">\r\n                              <span>{provider.name}</span>\r\n                              <button\r\n                                type=\"button\"\r\n                                className=\"h-4 w-4 p-0 ml-2 flex items-center justify-center hover:bg-blue-100 rounded\"\r\n                                onClick={(e) => {\r\n                                  e.preventDefault();\r\n                                  e.stopPropagation();\r\n                                  setShowProviderInfo(provider.id);\r\n                                }}\r\n                              >\r\n                                <Info className=\"h-3 w-3 text-blue-500 hover:text-blue-700\" />\r\n                              </button>\r\n                            </div>\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                    اسم المحفظة\r\n                  </label>\r\n                  <Input\r\n                    value={walletName}\r\n                    onChange={(e) => setWalletName(e.target.value)}\r\n                    placeholder=\"مثال: محفظة العمل\"\r\n                    className=\"h-6 text-xs\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                    رقم الهاتف\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <Phone className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                    <Input\r\n                      value={walletPhone}\r\n                      onChange={(e) => setWalletPhone(e.target.value)}\r\n                      placeholder=\"01030302038\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                    الرقم القومي للخط\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <IdCard className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                    <Input\r\n                      value={walletNationalId}\r\n                      onChange={(e) => setWalletNationalId(e.target.value)}\r\n                      placeholder=\"29012345678901\"\r\n                      maxLength={14}\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                    الحد الشهري للسحب (جنيه)\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <DollarSign className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={monthlyWithdrawalLimit}\r\n                      onChange={(e) => setMonthlyWithdrawalLimit(e.target.value)}\r\n                      placeholder=\"200000\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                    الحد الشهري للتحويل (جنيه)\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <DollarSign className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={monthlyTransferLimit}\r\n                      onChange={(e) => setMonthlyTransferLimit(e.target.value)}\r\n                      placeholder=\"200000\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                    الحد اليومي للسحب (جنيه)\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <TrendingDown className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-red-400\" />\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={dailyWithdrawalLimit}\r\n                      onChange={(e) => setDailyWithdrawalLimit(e.target.value)}\r\n                      placeholder=\"100000\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                    الحد اليومي للتحويل (جنيه)\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <TrendingUp className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-blue-400\" />\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={dailyTransferLimit}\r\n                      onChange={(e) => setDailyTransferLimit(e.target.value)}\r\n                      placeholder=\"60000\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id=\"isDefault\"\r\n                    checked={isDefault}\r\n                    onChange={(e) => setIsDefault(e.target.checked)}\r\n                    className=\"rounded w-3 h-3\"\r\n                  />\r\n                  <label htmlFor=\"isDefault\" className=\"text-xs font-medium text-gray-700\">\r\n                    تعيين كمحفظة افتراضية\r\n                  </label>\r\n                </div>\r\n\r\n                {/* Commission Settings Section */}\r\n                <div className=\"border-t pt-2 mt-2\">\r\n                  <div className=\"flex items-center gap-1 mb-2\">\r\n                    <Settings className=\"h-3 w-3 text-gray-600\" />\r\n                    <label className=\"text-xs font-medium text-gray-700\">\r\n                      إعدادات العمولة\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex gap-1\">\r\n                  <Button\r\n                    onClick={saveWallet}\r\n                    className=\"flex-1 h-6 text-xs\"\r\n                    size=\"sm\"\r\n                  >\r\n                    {editingWallet ? 'تحديث المحفظة' : 'إضافة المحفظة'}\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    onClick={resetForm}\r\n                    className=\"h-6 text-xs\"\r\n                    size=\"sm\"\r\n                  >\r\n                    إلغاء\r\n                  </Button>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n\r\n          {/* Wallets List */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\r\n            {wallets.map((wallet) => (\r\n              <Card key={wallet.id} className={`${wallet.isDefault ? 'border-green-300 bg-green-50' : ''}`}>\r\n                <CardHeader className=\"pb-1\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <CardTitle className=\"text-sm flex items-center gap-1\">\r\n                      <Wallet className=\"h-3 w-3\" />\r\n                      {wallet.name}\r\n                    </CardTitle>\r\n                    {wallet.isDefault && (\r\n                      <Badge variant=\"default\" className=\"bg-green-600 text-xs px-1 py-0\">\r\n                        افتراضية\r\n                      </Badge>\r\n                    )}\r\n                  </div>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-1 pt-0\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <Phone className=\"h-3 w-3 text-gray-500\" />\r\n                    <span className=\"text-xs\">{wallet.phone}</span>\r\n                  </div>\r\n                  {wallet.walletProvider && (\r\n                    <div className=\"text-xs text-blue-600 mt-1\">\r\n                      {walletProviders.find(p => p.id === wallet.walletProvider)?.name || wallet.walletProvider}\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* شريط تقدم الحدود الشهرية واليومية لكل محفظة */}\r\n                  <div className=\"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2\">\r\n                    {/* الحدود الشهرية */}\r\n                    <div>\r\n                      <div className=\"text-xs font-medium text-gray-600 mb-1\">الحدود الشهرية</div>\r\n                      <div className=\"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex\">\r\n                        {/* نصف السحب */}\r\n                        <div className=\"w-1/2 bg-red-200 relative\">\r\n                          <div \r\n                            className=\"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                            style={{ \r\n                              width: `${Math.min(((wallet.monthlyWithdrawalUsage || 0) / wallet.monthlyWithdrawalLimit) * 100, 100)}%` \r\n                            }}\r\n                          ></div>\r\n                        </div>\r\n                        {/* نصف التحويل */}\r\n                        <div className=\"w-1/2 bg-blue-200 relative\">\r\n                          <div \r\n                            className=\"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                            style={{ \r\n                              width: `${Math.min(((wallet.monthlyTransferUsage || 0) / wallet.monthlyTransferLimit) * 100, 100)}%` \r\n                            }}\r\n                          ></div>\r\n                        </div>\r\n                      </div>\r\n                      \r\n                      {/* تفاصيل المبالغ المتبقية الشهرية */}\r\n                      <div className=\"flex justify-between items-center mt-0.5\">\r\n                        <div className=\"text-xs text-red-600 font-medium\">\r\n                          متبقي سحب: {Math.max(wallet.monthlyWithdrawalLimit - (wallet.monthlyWithdrawalUsage || 0), 0)} جنيه\r\n                        </div>\r\n                        <div className=\"text-xs text-blue-600 font-medium\">\r\n                          متبقي تحويل: {Math.max(wallet.monthlyTransferLimit - (wallet.monthlyTransferUsage || 0), 0)} جنيه\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* الحدود اليومية */}\r\n                    {(\r\n                      <div>\r\n                        <div className=\"text-xs font-medium text-gray-600 mb-1\">الحدود اليومية</div>\r\n                        <div className=\"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex\">\r\n                          {/* نصف السحب اليومي */}\r\n                          <div className=\"w-1/2 bg-orange-200 relative\">\r\n                            <div \r\n                              className=\"bg-gradient-to-r from-orange-400 to-orange-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                              style={{ \r\n                                width: `${Math.min(((wallet.dailyWithdrawalUsage || 0) / wallet.dailyWithdrawalLimit) * 100, 100)}%` \r\n                              }}\r\n                            ></div>\r\n                          </div>\r\n                          {/* نصف التحويل اليومي */}\r\n                          <div className=\"w-1/2 bg-green-200 relative\">\r\n                            <div \r\n                              className=\"bg-gradient-to-r from-green-400 to-green-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                              style={{ \r\n                                width: `${Math.min(((wallet.dailyTransferUsage || 0) / wallet.dailyTransferLimit) * 100, 100)}%` \r\n                              }}\r\n                            ></div>\r\n                          </div>\r\n                        </div>\r\n                        \r\n                        {/* تفاصيل المبالغ المتبقية اليومية */}\r\n                        <div className=\"flex justify بين items-center mt-0.5\">\r\n                          <div className=\"text-xs text-orange-600 font-medium\">\r\n                            متبقي سحب يومي: {Math.max(wallet.dailyWithdrawalLimit - (wallet.dailyWithdrawalUsage || 0), 0)} جنيه\r\n                          </div>\r\n                          <div className=\"text-xs text-green-600 font-medium\">\r\n                            متبقي تحويل يومي: {Math.max(wallet.dailyTransferLimit - (wallet.dailyTransferUsage || 0), 0)} جنيه\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div className=\"flex gap-1 pt-1\">\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"outline\"\r\n                      onClick={() => handleEditWallet(wallet)}\r\n                      className=\"flex-1 h-5 text-xs px-1\"\r\n                    >\r\n                      <Edit className=\"h-2 w-2 mr-0.5\" />\r\n                      تعديل\r\n                    </Button>\r\n                    \r\n                    {!wallet.isDefault && (\r\n                      <>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"outline\"\r\n                          onClick={() => handleSetDefault(wallet.id)}\r\n                          className=\"flex-1 h-5 text-xs px-1\"\r\n                        >\r\n                          جعلها افتراضية\r\n                        </Button>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"destructive\"\r\n                          onClick={() => handleDeleteWallet(wallet.id)}\r\n                          className=\"h-5 px-1\"\r\n                        >\r\n                          <Trash2 className=\"h-2 w-2\" />\r\n                        </Button>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n\r\n          {wallets.length === 0 && (\r\n            <div className=\"text-center py-4 text-gray-500 text-xs\">\r\n              لا توجد محافظ متاحة. قم بإضافة محفظة جديدة للبدء.\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* نافذة معلومات صاحب المحفظة */}\r\n      {showProviderInfo && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl\">\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n              <h3 className=\"text-lg font-bold text-gray-800\">معلومات صاحب المحفظة</h3>\r\n              <button\r\n                onClick={() => setShowProviderInfo(null)}\r\n                className=\"h-8 w-8 p-0 flex items-center justify-center hover:bg-gray-100 rounded-full transition-colors\"\r\n              >\r\n                <X className=\"h-4 w-4 text-gray-500\" />\r\n              </button>\r\n            </div>\r\n            \r\n            {(() => {\r\n              const provider = walletProviders.find(p => p.id === showProviderInfo);\r\n              return provider ? (\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"text-center mb-6\">\r\n                    <div className=\"bg-blue-100 p-3 rounded-lg inline-block\">\r\n                      <h4 className=\"font-bold text-blue-700 text-lg\">{provider.name}</h4>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200\">\r\n                    <div className=\"space-y-4\">\r\n                      <div className=\"bg-white p-3 rounded-lg shadow-sm\">\r\n                        <div className=\"flex items-center mb-2\">\r\n                          <div className=\"w-2 h-2 bg-blue-500 rounded-full mr-2\"></div>\r\n                          <span className=\"font-semibold text-gray-700\">اسم صاحب المحفظة:</span>\r\n                        </div>\r\n                        <p className=\"text-gray-900 font-medium text-lg mr-4\">{provider.ownerName}</p>\r\n                      </div>\r\n                      \r\n                      <div className=\"bg-white p-3 rounded-lg shadow-sm\">\r\n                        <div className=\"flex items-center mb-2\">\r\n                          <div className=\"w-2 h-2 bg-green-500 rounded-full mr-2\"></div>\r\n                          <span className=\"font-semibold text-gray-700\">الرقم القومي:</span>\r\n                        </div>\r\n                        <p className=\"text-gray-900 font-mono text-lg mr-4 tracking-wider\">{provider.nationalId}</p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"bg-yellow-50 border border-yellow-200 p-3 rounded-lg\">\r\n                    <div className=\"flex items-center\">\r\n                      <Info className=\"h-4 w-4 text-yellow-600 mr-2\" />\r\n                      <span className=\"text-sm text-yellow-800 font-medium\">\r\n                        هذه البيانات مسجلة رسمياً في النظام لهذه المحفظة\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ) : null;\r\n            })()}\r\n          </div>\r\n        </div>\r\n      )}\r\n      </DialogContent>\r\n\r\n      {/* رقم سري رئيسي قبل فتح عرض المحافظ */}\r\n      <MasterPinDialog\r\n        open={isMasterPinDialogOpen}\r\n        onOpenChange={setIsMasterPinDialogOpen}\r\n        mode=\"verify\"\r\n        title=\"إدخال الرقم السري الرئيسي\"\r\n        description=\"لا يمكن الاطلاع على المحافظ إلا بإدخال الرقم السري الرئيسي\"\r\n        onSuccess={() => {\r\n          setIsMasterPinDialogOpen(false);\r\n          setShowWalletsView(true);\r\n        }}\r\n      />\r\n\r\n      {/* صفحة عرض المحافظ */}\r\n      <WalletsViewPage\r\n        isOpen={showWalletsView}\r\n        onClose={() => setShowWalletsView(false)}\r\n        onWalletSelect={(wallet) => {\r\n          setSelectedWallet(wallet);\r\n          setShowWalletsView(false);\r\n        }}\r\n        onEditWallet={(wallet) => {\r\n          // الانتقال إلى صفحة إضافة المحفظة بوضع التعديل لإعادة استخدام نفس السلوك\r\n          navigate(`/user/add-wallet?edit=1&id=${wallet.id}`);\r\n          setShowWalletsView(false);\r\n        }}\r\n        onDeleteWallet={async (walletId) => {\r\n          // حذف نهائي بدون تأكيد\r\n          try {\r\n            await merchantWalletService.delete(walletId);\r\n            // حدّث الحالة المحلية وقم بمزامنة localStorage لضمان انعكاس الحذف في القوائم\r\n            setWallets(prev => {\r\n              const updated = prev.filter(w => w.id !== walletId);\r\n              try {\r\n                localStorage.setItem(getWalletsKey(), JSON.stringify(updated));\r\n              } catch (e) {\r\n                console.error('Failed to update localStorage wallets after delete:', e);\r\n              }\r\n              return updated;\r\n            });\r\n\r\n            // إعلام الصفحة/المكوّن الأب لتحديث القوائم (مثل صفحة لوحة المستخدم)\r\n            if (onWalletUpdate) {\r\n              try {\r\n                await onWalletUpdate();\r\n              } catch (e) {\r\n                console.error('onWalletUpdate callback failed:', e);\r\n              }\r\n            }\r\n          } catch (err) {\r\n            console.error('Error deleting wallet:', err);\r\n          }\r\n        }}\r\n      />\r\n\r\n      {/* صفحة تفاصيل المحفظة */}\r\n      <WalletDetailsPage\r\n        wallet={selectedWallet}\r\n        isOpen={!!selectedWallet}\r\n        onClose={() => setSelectedWallet(null)}\r\n        onBack={() => {\r\n          setSelectedWallet(null);\r\n          setShowWalletsView(true);\r\n        }}\r\n      />\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default WalletManagement;\r\n"],"file":"assets/WalletManagement-SWSqiXRe.js"}