{"version":3,"mappings":"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","names":["__iconNode","Funnel","createLucideIcon","GitBranch","HardDrive","Menu","ShieldCheck","Upload","UserCheck","UserX","Volume2","VolumeX","branchActivationService","adminId","chars","code","i","formattedCode","addDoc","collection","db","serverTimestamp","q","query","getDocs","doc","a","b","tA","_a","_b","where","snapshot","docData","docId","userId","shopId","ref","updateDoc","WhatsAppManagement","settings","loading","error","updateSettings","refreshSettings","useWhatsAppSettings","toast","useToast","formData","setFormData","useState","isSaving","setIsSaving","showPreview","setShowPreview","previewLink","setPreviewLink","validationErrors","setValidationErrors","useEffect","validateForm","errors","validatePhoneNumber","handleSave","handlePreview","link","createWhatsAppLink","copyLink","handlePhoneChange","value","cleaned","prev","Card","jsx","CardHeader","jsxs","CardTitle","MessageCircle","CardContent","RefreshCw","CardDescription","Alert","AlertCircle","AlertDescription","Switch","checked","Separator","Label","Phone","Input","e","Textarea","Button","Save","EyeOff","Eye","Copy","ExternalLink","Badge","defaultNotificationSettings","calculateDaysRemaining","expiryDate","today","diffTime","getNotificationType","daysRemaining","createNotificationMessage","userName","plan","planName","getPlanDisplayName","SubscriptionPlan","getActiveSubscriptions","usersRef","querySnapshot","users","userData","_d","_c","generateSubscriptionNotifications","notifications","user","notificationType","notification","priorityOrder","filterNotificationsByType","type","saveNotificationSettings","loadNotificationSettings","saved","NotificationCenter","isOpen","onClose","setNotifications","filteredNotifications","setFilteredNotifications","filterType","setFilterType","setLoading","setSettings","loadNotifications","notifs","getNotificationIcon","AlertTriangle","Clock","Bell","getNotificationBgColor","formatDate","date","getFilterLabel","toggleSetting","key","newSettings","X","Filter","User","Calendar","NotificationAlert","soundEnabled","onToggleSound","isVisible","setIsVisible","audioContext","setAudioContext","playNotificationSound","timer","handleClose","oscillator","gainNode","getAlertStyles","styles","UserCard","onActivateSubscription","onRequestActivation","onDeactivateSubscription","onDeleteUser","onUpdateSessionLimit","selectedPlan","setSelectedPlan","showPlanSelector","setShowPlanSelector","customStartDate","setCustomStartDate","customEndDate","setCustomEndDate","isMobile","useIsMobile","rawSessionLimit","rawSessionLimitDisabled","deviceLimit","setDeviceLimit","unlimited","setUnlimited","nextRawLimit","nextDisabled","getUserDisplayName","u","dn","objVal","getPlanIcon","planType","Crown","Gift","Zap","Lock","ArrowUpDown","dateObj","parseFirestoreDate","Mail","Smartphone","parsed","normalized","payloadLimit","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","Infinity","startDate","endDate","Settings","UserCard$1","React","SUBSCRIPTION_PLANS_CONFIG","Star","PLAN_STYLES","ActivationModal","onActivate","isSubmitting","setIsSubmitting","handleActivate","selected","CheckCircle","PLANS","ResellerAdmin","requests","setRequests","searchTerm","setSearchTerm","selectedRequest","setSelectedRequest","isEditOpen","setIsEditOpen","editForm","setEditForm","isDeleteReviewOpen","setIsDeleteReviewOpen","selectedDeleteRequest","setSelectedDeleteRequest","isCancelReviewOpen","setIsCancelReviewOpen","selectedCancelRequest","setSelectedCancelRequest","activeTab","setActiveTab","mainResellers","setMainResellers","isActivateDialogOpen","setIsActivateDialogOpen","activateEmail","setActivateEmail","isActivating","setIsActivating","orderBy","unsubscribe","onSnapshot","docs","qMain","unsubscribeMain","handleActivateReseller","limit","userDoc","handleDeactivateReseller","handleEditClick","req","updateData","subscriptionData","isActive","calculateEndDate","userUpdateData","handleDelete","id","deleteDoc","handleReviewDeleteClick","handleAcceptDelete","handleRejectDelete","handleReviewCancelClick","handleAcceptCancel","handleRejectCancel","getPlanLabel","p","filteredRequests","Tabs","TabsList","TabsTrigger","TabsContent","Search","Table","TableHeader","TableRow","TableHead","TableBody","TableCell","Edit","Trash2","Dialog","DialogContent","DialogHeader","DialogTitle","val","DialogFooter","UserBranchesList","branches","setBranches","activatingBranch","setActivatingBranch","processing","setProcessing","fetchBranches","subBranches","rootBranches","d","qRoot","allBranches","uniqueBranchesMap","bUserId","uDoc","getDoc","item","existing","uniqueBranches","handleActivateBranch","branch","activateUserSubscription","handleDeactivateBranch","deactivateUserSubscription","idx","Fragment","CashierRequests","fetchRequests","statusFilter","data","dateA","handleApprove","userRef","userSnap","now","currentEndsAt","isCurrentValid","newTotal","_e","newRequestEndsAt","finalEndsAt","currentExtra","requestedCount","handleReject","RefreshCcw","expectedEndsAt","SimCardRequests","endsAt","AdminDashboard","navigate","auth","devMode","setDevMode","setError","authLoading","setAuthLoading","setNotificationCenterOpen","setNotificationSettings","notificationCount","setNotificationCount","setUsers","setEditingPlan","isSavingContent","setIsSavingContent","lastUpdateInfo","loadContentFromFirebase","saveContentToFirebase","refreshData","sidebarOpen","setSidebarOpen","filteredUsers","setFilteredUsers","editingPlan","setEditingPlanState","contentData","setContentData","editModalOpen","setEditModalOpen","editModalPlanType","setEditModalPlanType","editDraft","setEditDraft","isNewPlan","setIsNewPlan","autoUpdateEnabled","setAutoUpdateEnabled","lastAutoUpdate","setLastAutoUpdate","isManualUpdating","setIsManualUpdating","notificationSettings","setNotificationSettingsState","notificationCenterOpen","setNotificationCenterOpenState","currentAlert","setCurrentAlert","waitingItems","setWaitingItems","waitingLoading","setWaitingLoading","brandingLogoUrl","setBrandingLogoUrl","brandingExternalUrl","setBrandingExternalUrl","brandingFile","setBrandingFile","brandingUploading","setBrandingUploading","pendingWaitingItems","contactedWaitingItems","updateVersionCode","setUpdateVersionCode","updateTitleInput","setUpdateTitleInput","updateMessageInput","setUpdateMessageInput","updateApkUrlInput","setUpdateApkUrlInput","updateForce","setUpdateForce","loadingUpdateSettings","setLoadingUpdateSettings","markWaitingItemContacted","itemId","appDownloads","setAppDownloads","androidFile","setAndroidFile","pcFile","setPcFile","pc32File","setPc32File","uploadingAndroid","setUploadingAndroid","uploadingPc","setUploadingPc","uploadingPc32","setUploadingPc32","androidVersion","setAndroidVersion","pcVersion","setPcVersion","pc32Version","setPc32Version","androidProgress","setAndroidProgress","pcProgress","setPcProgress","pc32Progress","setPc32Progress","androidUrlInput","setAndroidUrlInput","pcUrlInput","setPcUrlInput","pc32UrlInput","setPc32UrlInput","desktopVersionInput","setDesktopVersionInput","desktopUrl64Input","setDesktopUrl64Input","desktopUrl32Input","setDesktopUrl32Input","desktopNotesInput","setDesktopNotesInput","telegramWorkerUrlInput","setTelegramWorkerUrlInput","savingWorkerUrl","setSavingWorkerUrl","systemSettingsService","__vitePreload","url","desktopForceInput","setDesktopForceInput","desktopPublishStatus","setDesktopPublishStatus","desktopPublishError","setDesktopPublishError","androidNotesInput","setAndroidNotesInput","androidForceInput","setAndroidForceInput","androidPublishStatus","setAndroidPublishStatus","androidPublishError","setAndroidPublishError","reactivationModalOpen","setReactivationModalOpen","selectedUserForReactivation","setSelectedUserForReactivation","selectedPlanForReactivation","setSelectedPlanForReactivation","activationModalOpen","setActivationModalOpen","selectedUserForActivation","setSelectedUserForActivation","selectedPlanForActivation","setSelectedPlanForActivation","cancelSubscriptionModalOpen","setCancelSubscriptionModalOpen","userToCancel","setUserToCancel","subscriptionSearch","setSubscriptionSearch","branchCodes","setBranchCodes","generatingCode","setGeneratingCode","unsub","listenDesktopUpdates","listenAndroidUpdates","handlePublishDesktopVersion","v","u64","u32","isElectronEnv","setDesktopUpdateInfo","token","payload","msg","getUserInitial","base","first","broadcastTitle","setBroadcastTitle","broadcastMessage","setBroadcastMessage","broadcastLinkUrl","setBroadcastLinkUrl","broadcastActionText","setBroadcastActionText","broadcastTargetUserId","setBroadcastTargetUserId","sendingBroadcast","setSendingBroadcast","trialSearch","setTrialSearch","trialDurationHours","setTrialDurationHours","trialDurationInput","setTrialDurationInput","isUpdatingTrialDuration","setIsUpdatingTrialDuration","loadingTrialDuration","setLoadingTrialDuration","trialSubTab","setTrialSubTab","lowerTerm","filtered","FreeTrialService","hours","getAppDownloads","fetchWaitingList","items","ta","_f","loadBranchCodes","codes","handleGenerateBranchCode","handleSendBroadcast","audienceKey","publishBroadcast","handleLogout","handleRequestActivation","handleActivateSubscription","variant","handleDeactivateSubscription","handleDeleteUser","result","httpsCallable","functions","prevUsers","cfErr","transactionsQuery","transactionsSnapshot","deletePromises","docSnapshot","results","failed","r","chatsQuery","chatsSnapshot","deleteChatPromises","chatDoc","deleteMessagePromises","msgDoc","err","setDoc","saveContentChanges","handleContentChange","field","addFeature","handleFeatureChange","index","features","removeFeature","handleToggleSound","handleCloseAlert","handleUpdateTrialDuration","res","handleActivateFreeTrial","handleCancelFreeTrial","handleResetUserTrialEnd","toggleUserStatus","newStatus","timestamp","sidebarItems","Users","FileText","Activity","__vite_import_meta_env__","Shield","Icon","LogOut","Plus","ProfileIcon","phoneRaw","phoneDigits","waLink","defaultMessage","createdAt","contactedAt","uid","start","end","config","resolveDownloadUrl","uploadAppBinaryResumable","n","Download","setAppDownloadLinks","setAndroidUpdateInfo","Monitor","status","doc2","updateDoc2","collection2","getDocs2","db2","branchesRef","updates","bDoc","bData","XCircle","setDoc2","pType","diffDays","isCancelled","em","aDate","bDate","subscription","statusText","planData","Edit3","feature","f","arr","updateSinglePlan","planId","customStart","customEnd","ProtectedAdminDashboard","useNavigate","useFirebaseAuth","rawUsers","setRawUsers","profilesMap","setProfilesMap","setLastUpdateInfo","devModeEnabled","silent","usersQuery","fullUsers","m","profilesQuery","profilesSnap","fullProfiles","merged","fullName","phone","displayName","open","info","getLastUpdateInfo","loadPlans","content","savePlans","LogoLoader"],"ignoreList":[0,1,2,3,4,5,6,7,8,9],"sources":["../../node_modules/lucide-react/dist/esm/icons/funnel.js","../../node_modules/lucide-react/dist/esm/icons/git-branch.js","../../node_modules/lucide-react/dist/esm/icons/hard-drive.js","../../node_modules/lucide-react/dist/esm/icons/menu.js","../../node_modules/lucide-react/dist/esm/icons/shield-check.js","../../node_modules/lucide-react/dist/esm/icons/upload.js","../../node_modules/lucide-react/dist/esm/icons/user-check.js","../../node_modules/lucide-react/dist/esm/icons/user-x.js","../../node_modules/lucide-react/dist/esm/icons/volume-2.js","../../node_modules/lucide-react/dist/esm/icons/volume-x.js","../../src/utils/branchActivationService.ts","../../src/components/WhatsAppManagement.tsx","../../src/utils/notificationService.ts","../../src/components/NotificationCenter.tsx","../../src/components/NotificationAlert.tsx","../../src/components/UserCard.tsx","../../src/components/ActivationModal.tsx","../../src/components/ResellerAdmin.tsx","../../src/pages/AdminDashboard.tsx","../../src/components/ProtectedAdminDashboard.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z\",\n      key: \"sc7q7i\"\n    }\n  ]\n];\nconst Funnel = createLucideIcon(\"funnel\", __iconNode);\n\nexport { __iconNode, Funnel as default };\n//# sourceMappingURL=funnel.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"line\", { x1: \"6\", x2: \"6\", y1: \"3\", y2: \"15\", key: \"17qcm7\" }],\n  [\"circle\", { cx: \"18\", cy: \"6\", r: \"3\", key: \"1h7g24\" }],\n  [\"circle\", { cx: \"6\", cy: \"18\", r: \"3\", key: \"fqmcym\" }],\n  [\"path\", { d: \"M18 9a9 9 0 0 1-9 9\", key: \"n2h4wq\" }]\n];\nconst GitBranch = createLucideIcon(\"git-branch\", __iconNode);\n\nexport { __iconNode, GitBranch as default };\n//# sourceMappingURL=git-branch.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"line\", { x1: \"22\", x2: \"2\", y1: \"12\", y2: \"12\", key: \"1y58io\" }],\n  [\n    \"path\",\n    {\n      d: \"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z\",\n      key: \"oot6mr\"\n    }\n  ],\n  [\"line\", { x1: \"6\", x2: \"6.01\", y1: \"16\", y2: \"16\", key: \"sgf278\" }],\n  [\"line\", { x1: \"10\", x2: \"10.01\", y1: \"16\", y2: \"16\", key: \"1l4acy\" }]\n];\nconst HardDrive = createLucideIcon(\"hard-drive\", __iconNode);\n\nexport { __iconNode, HardDrive as default };\n//# sourceMappingURL=hard-drive.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M4 5h16\", key: \"1tepv9\" }],\n  [\"path\", { d: \"M4 12h16\", key: \"1lakjw\" }],\n  [\"path\", { d: \"M4 19h16\", key: \"1djgab\" }]\n];\nconst Menu = createLucideIcon(\"menu\", __iconNode);\n\nexport { __iconNode, Menu as default };\n//# sourceMappingURL=menu.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z\",\n      key: \"oel41y\"\n    }\n  ],\n  [\"path\", { d: \"m9 12 2 2 4-4\", key: \"dzmm74\" }]\n];\nconst ShieldCheck = createLucideIcon(\"shield-check\", __iconNode);\n\nexport { __iconNode, ShieldCheck as default };\n//# sourceMappingURL=shield-check.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 3v12\", key: \"1x0j5s\" }],\n  [\"path\", { d: \"m17 8-5-5-5 5\", key: \"7q97r8\" }],\n  [\"path\", { d: \"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\", key: \"ih7n3h\" }]\n];\nconst Upload = createLucideIcon(\"upload\", __iconNode);\n\nexport { __iconNode, Upload as default };\n//# sourceMappingURL=upload.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m16 11 2 2 4-4\", key: \"9rsbq5\" }],\n  [\"path\", { d: \"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\", key: \"1yyitq\" }],\n  [\"circle\", { cx: \"9\", cy: \"7\", r: \"4\", key: \"nufk8\" }]\n];\nconst UserCheck = createLucideIcon(\"user-check\", __iconNode);\n\nexport { __iconNode, UserCheck as default };\n//# sourceMappingURL=user-check.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\", key: \"1yyitq\" }],\n  [\"circle\", { cx: \"9\", cy: \"7\", r: \"4\", key: \"nufk8\" }],\n  [\"line\", { x1: \"17\", x2: \"22\", y1: \"8\", y2: \"13\", key: \"3nzzx3\" }],\n  [\"line\", { x1: \"22\", x2: \"17\", y1: \"8\", y2: \"13\", key: \"1swrse\" }]\n];\nconst UserX = createLucideIcon(\"user-x\", __iconNode);\n\nexport { __iconNode, UserX as default };\n//# sourceMappingURL=user-x.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z\",\n      key: \"uqj9uw\"\n    }\n  ],\n  [\"path\", { d: \"M16 9a5 5 0 0 1 0 6\", key: \"1q6k2b\" }],\n  [\"path\", { d: \"M19.364 18.364a9 9 0 0 0 0-12.728\", key: \"ijwkga\" }]\n];\nconst Volume2 = createLucideIcon(\"volume-2\", __iconNode);\n\nexport { __iconNode, Volume2 as default };\n//# sourceMappingURL=volume-2.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z\",\n      key: \"uqj9uw\"\n    }\n  ],\n  [\"line\", { x1: \"22\", x2: \"16\", y1: \"9\", y2: \"15\", key: \"1ewh16\" }],\n  [\"line\", { x1: \"16\", x2: \"22\", y1: \"9\", y2: \"15\", key: \"5ykzw1\" }]\n];\nconst VolumeX = createLucideIcon(\"volume-x\", __iconNode);\n\nexport { __iconNode, VolumeX as default };\n//# sourceMappingURL=volume-x.js.map\n","import { db } from '@/firebase';\nimport { collection, addDoc, getDocs, query, where, updateDoc, doc, serverTimestamp, getDoc } from 'firebase/firestore';\n\nexport interface BranchActivationCode {\n  id?: string;\n  code: string;\n  isUsed: boolean;\n  createdAt: any;\n  createdBy: string;\n  usedAt?: any;\n  usedBy?: string; // userId of the merchant who used it\n  createdShopId?: string; // ID of the shop created with this code\n}\n\nexport const branchActivationService = {\n  /**\n   * Generates a new unique activation code\n   */\n  generateCode: async (adminId: string): Promise<string> => {\n    // Generate a random 6-character alphanumeric code (uppercase)\n    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // Removed confusing chars like I, 1, O, 0\n    let code = '';\n    for (let i = 0; i < 8; i++) {\n      code += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    \n    // Add hyphen for readability: XXXX-XXXX\n    const formattedCode = `${code.substring(0, 4)}-${code.substring(4)}`;\n\n    await addDoc(collection(db, 'branchActivationCodes'), {\n      code: formattedCode,\n      isUsed: false,\n      createdAt: serverTimestamp(),\n      createdBy: adminId\n    });\n\n    return formattedCode;\n  },\n\n  /**\n   * Gets all activation codes (for admin view)\n   */\n  getAllCodes: async (): Promise<BranchActivationCode[]> => {\n    const q = query(collection(db, 'branchActivationCodes'));\n    const snapshot = await getDocs(q);\n    return snapshot.docs.map(doc => ({\n      id: doc.id,\n      ...doc.data()\n    } as BranchActivationCode)).sort((a, b) => {\n        // Sort by createdAt desc\n        const tA = a.createdAt?.toMillis ? a.createdAt.toMillis() : 0;\n        const tB = b.createdAt?.toMillis ? b.createdAt.toMillis() : 0;\n        return tB - tA;\n    });\n  },\n\n  /**\n   * Validates a code\n   * Returns the code document data if valid, throws error otherwise\n   */\n  validateCode: async (code: string): Promise<BranchActivationCode & { docId: string }> => {\n    const q = query(collection(db, 'branchActivationCodes'), where('code', '==', code));\n    const snapshot = await getDocs(q);\n\n    if (snapshot.empty) {\n      throw new Error('   ');\n    }\n\n    const docData = snapshot.docs[0].data() as BranchActivationCode;\n    const docId = snapshot.docs[0].id;\n\n    if (docData.isUsed) {\n      throw new Error('    ');\n    }\n\n    return { ...docData, docId };\n  },\n\n  /**\n   * Marks a code as used\n   */\n  markCodeAsUsed: async (docId: string, userId: string, shopId: string) => {\n    const ref = doc(db, 'branchActivationCodes', docId);\n    await updateDoc(ref, {\n      isUsed: true,\n      usedAt: serverTimestamp(),\n      usedBy: userId,\n      createdShopId: shopId\n    });\n  }\n};\n","import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { \r\n  MessageCircle, \r\n  Phone, \r\n  Save, \r\n  RefreshCw, \r\n  CheckCircle, \r\n  AlertCircle,\r\n  ExternalLink,\r\n  Copy,\r\n  Eye,\r\n  EyeOff\r\n} from 'lucide-react';\r\nimport { \r\n  WhatsAppSettings,\r\n  useWhatsAppSettings,\r\n  validatePhoneNumber,\r\n  createWhatsAppLink,\r\n  formatPhoneNumber\r\n} from '@/utils/whatsappService';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\nconst WhatsAppManagement: React.FC = () => {\r\n  const { settings, loading, error, updateSettings, refreshSettings } = useWhatsAppSettings();\r\n  const { toast } = useToast();\r\n  \r\n  //  \r\n  const [formData, setFormData] = useState<Partial<WhatsAppSettings>>({\r\n    phoneNumber: '',\r\n    defaultMessage: '',\r\n    isEnabled: true\r\n  });\r\n  \r\n  //   \r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const [showPreview, setShowPreview] = useState(false);\r\n  const [previewLink, setPreviewLink] = useState('');\r\n  const [validationErrors, setValidationErrors] = useState<Record<string, string>>({});\r\n\r\n  //     \r\n  useEffect(() => {\r\n    if (settings) {\r\n      setFormData({\r\n        phoneNumber: settings.phoneNumber,\r\n        defaultMessage: settings.defaultMessage,\r\n        isEnabled: settings.isEnabled\r\n      });\r\n    }\r\n  }, [settings]);\r\n\r\n  //    \r\n  const validateForm = (): boolean => {\r\n    const errors: Record<string, string> = {};\r\n    \r\n    if (!formData.phoneNumber?.trim()) {\r\n      errors.phoneNumber = '  ';\r\n    } else if (!validatePhoneNumber(formData.phoneNumber)) {\r\n      errors.phoneNumber = '    (    10-15 )';\r\n    }\r\n    \r\n    if (!formData.defaultMessage?.trim()) {\r\n      errors.defaultMessage = '  ';\r\n    } else if (formData.defaultMessage.length < 10) {\r\n      errors.defaultMessage = '     10   ';\r\n    }\r\n    \r\n    setValidationErrors(errors);\r\n    return Object.keys(errors).length === 0;\r\n  };\r\n\r\n  //  \r\n  const handleSave = async () => {\r\n    if (!validateForm()) {\r\n      toast({\r\n        title: \"  \",\r\n        description: \"    \",\r\n        variant: \"destructive\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsSaving(true);\r\n    try {\r\n      const success = await updateSettings(formData);\r\n      if (success) {\r\n        toast({\r\n          title: \"  \",\r\n          description: \"    \",\r\n          variant: \"default\"\r\n        });\r\n      } else {\r\n        throw new Error('  ');\r\n      }\r\n    } catch (error) {\r\n      toast({\r\n        title: \"  \",\r\n        description: \"    \",\r\n        variant: \"destructive\"\r\n      });\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  //  \r\n  const handlePreview = () => {\r\n    if (formData.phoneNumber && formData.defaultMessage) {\r\n      try {\r\n        const link = createWhatsAppLink(formData.phoneNumber, formData.defaultMessage);\r\n        setPreviewLink(link);\r\n        setShowPreview(true);\r\n      } catch (error) {\r\n        toast({\r\n          title: \"  \",\r\n          description: \"    \",\r\n          variant: \"destructive\"\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  //  \r\n  const copyLink = async () => {\r\n    try {\r\n      await navigator.clipboard.writeText(previewLink);\r\n      toast({\r\n        title: \" \",\r\n        description: \"    \",\r\n        variant: \"default\"\r\n      });\r\n    } catch (error) {\r\n      toast({\r\n        title: \"  \",\r\n        description: \"   \",\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  //     \r\n  const handlePhoneChange = (value: string) => {\r\n    //     \r\n    const cleaned = value.replace(/[^\\d+]/g, '');\r\n    setFormData(prev => ({ ...prev, phoneNumber: cleaned }));\r\n    \r\n    //     \r\n    if (validationErrors.phoneNumber) {\r\n      setValidationErrors(prev => ({ ...prev, phoneNumber: '' }));\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <MessageCircle className=\"h-5 w-5\" />\r\n             \r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"flex items-center justify-center py-8\">\r\n            <RefreshCw className=\"h-6 w-6 animate-spin\" />\r\n            <span className=\"mr-2\"> ...</span>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <MessageCircle className=\"h-5 w-5\" />\r\n             \r\n          </CardTitle>\r\n          <CardDescription>\r\n                     \r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-6\">\r\n          {error && (\r\n            <Alert variant=\"destructive\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              <AlertDescription>{error}</AlertDescription>\r\n            </Alert>\r\n          )}\r\n\r\n          {/*   */}\r\n          <div className=\"flex items-center justify-between p-4 bg-muted rounded-lg\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className={`h-3 w-3 rounded-full ${formData.isEnabled ? 'bg-green-500' : 'bg-red-500'}`} />\r\n              <div>\r\n                <p className=\"font-medium\">  </p>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  {formData.isEnabled ? '' : ''}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <Switch\r\n              checked={formData.isEnabled}\r\n              onCheckedChange={(checked) => \r\n                setFormData(prev => ({ ...prev, isEnabled: checked }))\r\n              }\r\n            />\r\n          </div>\r\n\r\n          <Separator />\r\n\r\n          {/*   */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"phoneNumber\" className=\"flex items-center gap-2\">\r\n              <Phone className=\"h-4 w-4\" />\r\n               \r\n            </Label>\r\n            <Input\r\n              id=\"phoneNumber\"\r\n              type=\"tel\"\r\n              placeholder=\": 201000392539\"\r\n              value={formData.phoneNumber}\r\n              onChange={(e) => handlePhoneChange(e.target.value)}\r\n              className={validationErrors.phoneNumber ? 'border-red-500' : ''}\r\n              dir=\"ltr\"\r\n            />\r\n            {validationErrors.phoneNumber && (\r\n              <p className=\"text-sm text-red-500\">{validationErrors.phoneNumber}</p>\r\n            )}\r\n            <p className=\"text-sm text-muted-foreground\">\r\n                    (: 201000392539 )\r\n            </p>\r\n          </div>\r\n\r\n          {/*   */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"defaultMessage\"> </Label>\r\n            <Textarea\r\n              id=\"defaultMessage\"\r\n              placeholder=\"    \"\r\n              value={formData.defaultMessage}\r\n              onChange={(e) => {\r\n                setFormData(prev => ({ ...prev, defaultMessage: e.target.value }));\r\n                if (validationErrors.defaultMessage) {\r\n                  setValidationErrors(prev => ({ ...prev, defaultMessage: '' }));\r\n                }\r\n              }}\r\n              className={validationErrors.defaultMessage ? 'border-red-500' : ''}\r\n              rows={4}\r\n            />\r\n            {validationErrors.defaultMessage && (\r\n              <p className=\"text-sm text-red-500\">{validationErrors.defaultMessage}</p>\r\n            )}\r\n            <p className=\"text-sm text-muted-foreground\">\r\n                      \r\n            </p>\r\n          </div>\r\n\r\n          {/*   */}\r\n          <div className=\"flex gap-3 pt-4\">\r\n            <Button \r\n              onClick={handleSave} \r\n              disabled={isSaving}\r\n              className=\"flex items-center gap-2\"\r\n            >\r\n              {isSaving ? (\r\n                <RefreshCw className=\"h-4 w-4 animate-spin\" />\r\n              ) : (\r\n                <Save className=\"h-4 w-4\" />\r\n              )}\r\n              {isSaving ? ' ...' : ' '}\r\n            </Button>\r\n            \r\n            <Button \r\n              variant=\"outline\" \r\n              onClick={handlePreview}\r\n              disabled={!formData.phoneNumber || !formData.defaultMessage}\r\n              className=\"flex items-center gap-2\"\r\n            >\r\n              {showPreview ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n               \r\n            </Button>\r\n            \r\n            <Button \r\n              variant=\"outline\" \r\n              onClick={refreshSettings}\r\n              className=\"flex items-center gap-2\"\r\n            >\r\n              <RefreshCw className=\"h-4 w-4\" />\r\n              \r\n            </Button>\r\n          </div>\r\n\r\n          {/*   */}\r\n          {showPreview && previewLink && (\r\n            <Card className=\"bg-muted/50\">\r\n              <CardHeader>\r\n                <CardTitle className=\"text-lg\">  </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                <div className=\"p-3 bg-background rounded border font-mono text-sm break-all\">\r\n                  {previewLink}\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                  <Button \r\n                    variant=\"outline\" \r\n                    size=\"sm\"\r\n                    onClick={copyLink}\r\n                    className=\"flex items-center gap-2\"\r\n                  >\r\n                    <Copy className=\"h-4 w-4\" />\r\n                     \r\n                  </Button>\r\n                  <Button \r\n                    variant=\"outline\" \r\n                    size=\"sm\"\r\n                    onClick={() => window.open(previewLink, '_blank')}\r\n                    className=\"flex items-center gap-2\"\r\n                  >\r\n                    <ExternalLink className=\"h-4 w-4\" />\r\n                      \r\n                  </Button>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n\r\n          {/*   */}\r\n          {settings && (\r\n            <div className=\"pt-4 border-t\">\r\n              <h4 className=\"font-medium mb-3\"> </h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\r\n                <div>\r\n                  <span className=\"text-muted-foreground\"> :</span>\r\n                  <Badge variant=\"outline\" className=\"mr-2\">\r\n                    {settings.lastUpdated.toLocaleDateString('ar-EG')} - {settings.lastUpdated.toLocaleTimeString('ar-EG')}\r\n                  </Badge>\r\n                </div>\r\n                <div>\r\n                  <span className=\"text-muted-foreground\">:</span>\r\n                  <Badge variant={settings.isEnabled ? \"default\" : \"secondary\"} className=\"mr-2\">\r\n                    {settings.isEnabled ? '' : ''}\r\n                  </Badge>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default WhatsAppManagement;","import { collection, getDocs, query, where } from 'firebase/firestore';\r\nimport { db } from '../firebase';\r\nimport { UserWithSubscription, SubscriptionPlan, isSubscriptionValid } from './subscriptionService';\r\n\r\n//  \r\nexport enum NotificationType {\r\n  CRITICAL = 'critical',    //    \r\n  WARNING = 'warning',      // 3   \r\n  INFO = 'info',           // 7   \r\n  EXPIRED = 'expired'      //  \r\n}\r\n\r\n//  \r\nexport interface SubscriptionNotification {\r\n  id: string;\r\n  userId: string;\r\n  userName: string;\r\n  userEmail: string;\r\n  subscriptionPlan: SubscriptionPlan;\r\n  expiryDate: Date;\r\n  daysRemaining: number;\r\n  type: NotificationType;\r\n  message: string;\r\n  isRead: boolean;\r\n  createdAt: Date;\r\n}\r\n\r\n//  \r\nexport interface NotificationSettings {\r\n  enableVisualAlerts: boolean;\r\n  enableAudioAlerts: boolean;\r\n  criticalDays: number;    //    (: 1)\r\n  warningDays: number;     //    (: 3)\r\n  infoDays: number;        //    (: 7)\r\n}\r\n\r\n//  \r\nexport const defaultNotificationSettings: NotificationSettings = {\r\n  enableVisualAlerts: true,\r\n  enableAudioAlerts: true,\r\n  criticalDays: 1,\r\n  warningDays: 3,\r\n  infoDays: 7\r\n};\r\n\r\n//   \r\nexport const calculateDaysRemaining = (expiryDate: Date): number => {\r\n  const today = new Date();\r\n  const expiry = new Date(expiryDate);\r\n  const diffTime = expiry.getTime() - today.getTime();\r\n  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n  return diffDays;\r\n};\r\n\r\n//       \r\nexport const getNotificationType = (\r\n  daysRemaining: number, \r\n  settings: NotificationSettings = defaultNotificationSettings\r\n): NotificationType => {\r\n  if (daysRemaining < 0) {\r\n    return NotificationType.EXPIRED;\r\n  } else if (daysRemaining <= settings.criticalDays) {\r\n    return NotificationType.CRITICAL;\r\n  } else if (daysRemaining <= settings.warningDays) {\r\n    return NotificationType.WARNING;\r\n  } else if (daysRemaining <= settings.infoDays) {\r\n    return NotificationType.INFO;\r\n  }\r\n  return NotificationType.INFO;\r\n};\r\n\r\n//   \r\nexport const createNotificationMessage = (\r\n  userName: string,\r\n  daysRemaining: number,\r\n  plan: SubscriptionPlan\r\n): string => {\r\n  const planName = getPlanDisplayName(plan);\r\n  \r\n  if (daysRemaining < 0) {\r\n    return `   ${planName}  ${userName}`;\r\n  } else if (daysRemaining === 0) {\r\n    return `  ${planName}  ${userName} !`;\r\n  } else if (daysRemaining === 1) {\r\n    return `  ${planName}  ${userName} `;\r\n  } else {\r\n    return `  ${planName}  ${userName}  ${daysRemaining} `;\r\n  }\r\n};\r\n\r\n//     \r\nconst getPlanDisplayName = (plan: SubscriptionPlan): string => {\r\n  switch (plan) {\r\n    case SubscriptionPlan.MONTHLY:\r\n      return '';\r\n    case SubscriptionPlan.YEARLY:\r\n      return '';\r\n    case SubscriptionPlan.LIFETIME:\r\n      return ' ';\r\n    default:\r\n      return ' ';\r\n  }\r\n};\r\n\r\n//     \r\nexport const getActiveSubscriptions = async (): Promise<UserWithSubscription[]> => {\r\n  try {\r\n    const usersRef = collection(db, 'users');\r\n    const q = query(usersRef, where('subscription', '!=', null));\r\n    const querySnapshot = await getDocs(q);\r\n    \r\n    const users: UserWithSubscription[] = [];\r\n    querySnapshot.forEach((doc) => {\r\n      const userData = doc.data();\r\n      if (userData.subscription && (userData.subscription.planType || userData.subscription.plan)) {\r\n        users.push({\r\n          id: doc.id,\r\n          ...userData,\r\n          subscription: {\r\n            ...userData.subscription,\r\n            //    Timestamp  Date  string\r\n            startDate: (userData.subscription.startDate as any)?.toDate?.() || new Date(userData.subscription.startDate),\r\n            endDate: (userData.subscription.endDate as any)?.toDate?.() || new Date(userData.subscription.endDate),\r\n            //      \r\n            planType: userData.subscription.planType || userData.subscription.plan\r\n          }\r\n        } as UserWithSubscription);\r\n      }\r\n    });\r\n    \r\n    return users;\r\n  } catch (error) {\r\n    console.error('    :', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n//    \r\nexport const generateSubscriptionNotifications = async (\r\n  settings: NotificationSettings = defaultNotificationSettings\r\n): Promise<SubscriptionNotification[]> => {\r\n  try {\r\n    const users = await getActiveSubscriptions();\r\n    const notifications: SubscriptionNotification[] = [];\r\n    \r\n    users.forEach((user) => {\r\n      if (!user.subscription || !user.subscription.endDate) return;\r\n      \r\n      const daysRemaining = calculateDaysRemaining(user.subscription.endDate);\r\n      const notificationType = getNotificationType(daysRemaining, settings);\r\n      \r\n      //           \r\n      if (daysRemaining <= settings.infoDays || daysRemaining < 0) {\r\n        const notification: SubscriptionNotification = {\r\n          id: `${user.id}_${Date.now()}`,\r\n          userId: user.id,\r\n          userName: user.displayName || user.email || '  ',\r\n          userEmail: user.email || '',\r\n          subscriptionPlan: user.subscription.planType,\r\n          expiryDate: user.subscription.endDate,\r\n          daysRemaining,\r\n          type: notificationType,\r\n          message: createNotificationMessage(\r\n            user.displayName || user.email || '  ',\r\n            daysRemaining,\r\n            user.subscription.planType\r\n          ),\r\n          isRead: false,\r\n          createdAt: new Date()\r\n        };\r\n        \r\n        notifications.push(notification);\r\n      }\r\n    });\r\n    \r\n    //     (  )\r\n    notifications.sort((a, b) => {\r\n      const priorityOrder = {\r\n        [NotificationType.EXPIRED]: 0,\r\n        [NotificationType.CRITICAL]: 1,\r\n        [NotificationType.WARNING]: 2,\r\n        [NotificationType.INFO]: 3\r\n      };\r\n      \r\n      if (priorityOrder[a.type] !== priorityOrder[b.type]) {\r\n        return priorityOrder[a.type] - priorityOrder[b.type];\r\n      }\r\n      \r\n      return a.daysRemaining - b.daysRemaining;\r\n    });\r\n    \r\n    return notifications;\r\n  } catch (error) {\r\n    console.error('    :', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n//    \r\nexport const filterNotificationsByType = (\r\n  notifications: SubscriptionNotification[],\r\n  type?: NotificationType\r\n): SubscriptionNotification[] => {\r\n  if (!type) return notifications;\r\n  return notifications.filter(notification => notification.type === type);\r\n};\r\n\r\n//     \r\nexport const filterNotificationsByDays = (\r\n  notifications: SubscriptionNotification[],\r\n  maxDays?: number\r\n): SubscriptionNotification[] => {\r\n  if (maxDays === undefined) return notifications;\r\n  return notifications.filter(notification => notification.daysRemaining <= maxDays);\r\n};\r\n\r\n//      \r\nexport const getUnreadNotificationsCount = (notifications: SubscriptionNotification[]): number => {\r\n  return notifications.filter(notification => !notification.isRead).length;\r\n};\r\n\r\n//    \r\nexport const getCriticalNotifications = (notifications: SubscriptionNotification[]): SubscriptionNotification[] => {\r\n  return notifications.filter(notification => \r\n    notification.type === NotificationType.CRITICAL || \r\n    notification.type === NotificationType.EXPIRED\r\n  );\r\n};\r\n\r\n//     localStorage\r\nexport const saveNotificationSettings = (settings: NotificationSettings): void => {\r\n  localStorage.setItem('notificationSettings', JSON.stringify(settings));\r\n};\r\n\r\n//     localStorage\r\nexport const loadNotificationSettings = (): NotificationSettings => {\r\n  try {\r\n    const saved = localStorage.getItem('notificationSettings');\r\n    if (saved) {\r\n      return { ...defaultNotificationSettings, ...JSON.parse(saved) };\r\n    }\r\n  } catch (error) {\r\n    console.error('    :', error);\r\n  }\r\n  return defaultNotificationSettings;\r\n};\r\n\r\n//     (     )\r\nexport const subscribeToSubscriptionChanges = (\r\n  callback: (notifications: SubscriptionNotification[]) => void,\r\n  settings: NotificationSettings = defaultNotificationSettings\r\n) => {\r\n  //      \r\n  //      \r\n  generateSubscriptionNotifications(settings).then(callback);\r\n  return () => {};\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Bell, Filter, X, AlertTriangle, Clock, User, Calendar } from 'lucide-react';\r\nimport { \r\n  generateSubscriptionNotifications, \r\n  filterNotificationsByType, \r\n  filterNotificationsByDays,\r\n  SubscriptionNotification, \r\n  NotificationType,\r\n  loadNotificationSettings,\r\n  saveNotificationSettings,\r\n  NotificationSettings,\r\n  defaultNotificationSettings\r\n} from '../utils/notificationService';\r\n\r\ninterface NotificationCenterProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nconst NotificationCenter: React.FC<NotificationCenterProps> = ({ isOpen, onClose }) => {\r\n  const [notifications, setNotifications] = useState<SubscriptionNotification[]>([]);\r\n  const [filteredNotifications, setFilteredNotifications] = useState<SubscriptionNotification[]>([]);\r\n  const [filterType, setFilterType] = useState<'all' | NotificationType>('all');\r\n  const [loading, setLoading] = useState(true);\r\n  const [settings, setSettings] = useState(loadNotificationSettings());\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      loadNotifications();\r\n    }\r\n  }, [isOpen]);\r\n\r\n  useEffect(() => {\r\n    if (filterType === 'all') {\r\n      setFilteredNotifications(notifications);\r\n    } else {\r\n      setFilteredNotifications(filterNotificationsByType(notifications, filterType));\r\n    }\r\n  }, [notifications, filterType]);\r\n\r\n  const loadNotifications = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const notifs = await generateSubscriptionNotifications(settings);\r\n      setNotifications(notifs);\r\n    } catch (error) {\r\n      console.error('   :', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const getNotificationIcon = (type: NotificationType) => {\r\n    switch (type) {\r\n      case 'urgent':\r\n        return <AlertTriangle className=\"w-5 h-5 text-red-500\" />;\r\n      case 'warning':\r\n        return <Clock className=\"w-5 h-5 text-yellow-500\" />;\r\n      case 'info':\r\n        return <Bell className=\"w-5 h-5 text-blue-500\" />;\r\n      default:\r\n        return <Bell className=\"w-5 h-5 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  const getNotificationBgColor = (type: NotificationType) => {\r\n    switch (type) {\r\n      case 'urgent':\r\n        return 'bg-red-50 border-red-200';\r\n      case 'warning':\r\n        return 'bg-yellow-50 border-yellow-200';\r\n      case 'info':\r\n        return 'bg-blue-50 border-blue-200';\r\n      default:\r\n        return 'bg-gray-50 border-gray-200';\r\n    }\r\n  };\r\n\r\n  const formatDate = (date: Date) => {\r\n    return new Intl.DateTimeFormat('ar-SA', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }).format(date);\r\n  };\r\n\r\n  const getFilterLabel = (type: 'all' | NotificationType) => {\r\n    switch (type) {\r\n      case 'all':\r\n        return ' ';\r\n      case 'urgent':\r\n        return ' ( )';\r\n      case 'warning':\r\n        return ' (3 )';\r\n      case 'info':\r\n        return ' (7 )';\r\n      default:\r\n        return ' ';\r\n    }\r\n  };\r\n\r\n  const toggleSetting = (key: keyof typeof settings) => {\r\n    const newSettings = { ...settings, [key]: !settings[key] };\r\n    setSettings(newSettings);\r\n    saveNotificationSettings(newSettings);\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center\">\r\n      <div className=\"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden\">\r\n        {/* Header */}\r\n        <div className=\"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <Bell className=\"w-6 h-6\" />\r\n              <h2 className=\"text-xl font-bold\"> </h2>\r\n              {notifications.length > 0 && (\r\n                <span className=\"bg-white text-blue-600 px-2 py-1 rounded-full text-sm font-medium\">\r\n                  {notifications.length}\r\n                </span>\r\n              )}\r\n            </div>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"p-2 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors\"\r\n            >\r\n              <X className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Filters and Settings */}\r\n        <div className=\"p-4 border-b bg-gray-50\">\r\n          <div className=\"flex flex-wrap items-center gap-4 mb-4\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <Filter className=\"w-4 h-4 text-gray-600\" />\r\n              <span className=\"text-sm font-medium text-gray-700\"> :</span>\r\n            </div>\r\n            {(['all', 'urgent', 'warning', 'info'] as const).map((type) => (\r\n              <button\r\n                key={type}\r\n                onClick={() => setFilterType(type)}\r\n                className={`px-3 py-1 rounded-full text-sm font-medium transition-colors ${\r\n                  filterType === type\r\n                    ? 'bg-blue-600 text-white'\r\n                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\r\n                }`}\r\n              >\r\n                {getFilterLabel(type)}\r\n              </button>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Settings */}\r\n          <div className=\"flex flex-wrap items-center gap-4\">\r\n            <span className=\"text-sm font-medium text-gray-700\">:</span>\r\n            <label className=\"flex items-center gap-2 cursor-pointer\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={settings.visualAlerts}\r\n                onChange={() => toggleSetting('visualAlerts')}\r\n                className=\"rounded\"\r\n              />\r\n              <span className=\"text-sm\"> </span>\r\n            </label>\r\n            <label className=\"flex items-center gap-2 cursor-pointer\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={settings.soundAlerts}\r\n                onChange={() => toggleSetting('soundAlerts')}\r\n                className=\"rounded\"\r\n              />\r\n              <span className=\"text-sm\"> </span>\r\n            </label>\r\n            <label className=\"flex items-center gap-2 cursor-pointer\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={settings.autoRefresh}\r\n                onChange={() => toggleSetting('autoRefresh')}\r\n                className=\"rounded\"\r\n              />\r\n              <span className=\"text-sm\"> </span>\r\n            </label>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Notifications List */}\r\n        <div className=\"flex-1 overflow-y-auto max-h-96\">\r\n          {loading ? (\r\n            <div className=\"flex items-center justify-center p-8\">\r\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n              <span className=\"mr-3 text-gray-600\">  ...</span>\r\n            </div>\r\n          ) : filteredNotifications.length === 0 ? (\r\n            <div className=\"text-center p-8\">\r\n              <Bell className=\"w-16 h-16 text-gray-300 mx-auto mb-4\" />\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">  </h3>\r\n              <p className=\"text-gray-500\">\r\n                {filterType === 'all' \r\n                  ? '   '\r\n                  : `     \"${getFilterLabel(filterType)}\"`\r\n                }\r\n              </p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"p-4 space-y-3\">\r\n              {filteredNotifications.map((notification) => (\r\n                <div\r\n                  key={notification.id}\r\n                  className={`p-4 rounded-lg border-r-4 ${getNotificationBgColor(notification.type)}`}\r\n                >\r\n                  <div className=\"flex items-start gap-3\">\r\n                    {getNotificationIcon(notification.type)}\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center justify-between mb-2\">\r\n                        <h4 className=\"font-medium text-gray-900\">\r\n                          {notification.message}\r\n                        </h4>\r\n                        <span className=\"text-xs text-gray-500\">\r\n                          {formatDate(notification.createdAt)}\r\n                        </span>\r\n                      </div>\r\n                      \r\n                      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <User className=\"w-4 h-4 text-gray-400\" />\r\n                          <span className=\"text-gray-700\">\r\n                            <strong>:</strong> {notification.userName}\r\n                          </span>\r\n                        </div>\r\n                        \r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Calendar className=\"w-4 h-4 text-gray-400\" />\r\n                          <span className=\"text-gray-700\">\r\n                            <strong> :</strong> {formatDate(notification.expiryDate)}\r\n                          </span>\r\n                        </div>\r\n                        \r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Clock className=\"w-4 h-4 text-gray-400\" />\r\n                          <span className=\"text-gray-700\">\r\n                            <strong> :</strong> {notification.daysRemaining}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"p-4 border-t bg-gray-50\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"text-sm text-gray-600\">\r\n               : {formatDate(new Date())}\r\n            </div>\r\n            <button\r\n              onClick={loadNotifications}\r\n              className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm\"\r\n            >\r\n               \r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NotificationCenter;","import React, { useEffect, useState } from 'react';\r\nimport { X, AlertTriangle, Clock, Bell, Volume2, VolumeX } from 'lucide-react';\r\nimport { NotificationItem, NotificationType } from '../utils/notificationService';\r\n\r\ninterface NotificationAlertProps {\r\n  notification: NotificationItem | null;\r\n  onClose: () => void;\r\n  soundEnabled: boolean;\r\n  onToggleSound: () => void;\r\n}\r\n\r\nconst NotificationAlert: React.FC<NotificationAlertProps> = ({\r\n  notification,\r\n  onClose,\r\n  soundEnabled,\r\n  onToggleSound\r\n}) => {\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const [audioContext, setAudioContext] = useState<AudioContext | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (notification) {\r\n      setIsVisible(true);\r\n      if (soundEnabled) {\r\n        playNotificationSound(notification.type);\r\n      }\r\n      \r\n      // Auto-hide after 10 seconds for non-urgent notifications\r\n      if (notification.type !== 'urgent') {\r\n        const timer = setTimeout(() => {\r\n          handleClose();\r\n        }, 10000);\r\n        \r\n        return () => clearTimeout(timer);\r\n      }\r\n    }\r\n  }, [notification, soundEnabled]);\r\n\r\n  useEffect(() => {\r\n    // Initialize audio context\r\n    if (typeof window !== 'undefined' && window.AudioContext) {\r\n      setAudioContext(new AudioContext());\r\n    }\r\n  }, []);\r\n\r\n  const playNotificationSound = (type: NotificationType) => {\r\n    if (!audioContext || !soundEnabled) return;\r\n\r\n    try {\r\n      const oscillator = audioContext.createOscillator();\r\n      const gainNode = audioContext.createGain();\r\n      \r\n      oscillator.connect(gainNode);\r\n      gainNode.connect(audioContext.destination);\r\n      \r\n      // Different frequencies for different notification types\r\n      switch (type) {\r\n        case 'urgent':\r\n          // High-pitched urgent sound\r\n          oscillator.frequency.setValueAtTime(800, audioContext.currentTime);\r\n          oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.1);\r\n          oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.2);\r\n          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\r\n          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);\r\n          oscillator.start(audioContext.currentTime);\r\n          oscillator.stop(audioContext.currentTime + 0.5);\r\n          break;\r\n          \r\n        case 'warning':\r\n          // Medium-pitched warning sound\r\n          oscillator.frequency.setValueAtTime(600, audioContext.currentTime);\r\n          oscillator.frequency.setValueAtTime(700, audioContext.currentTime + 0.15);\r\n          gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);\r\n          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);\r\n          oscillator.start(audioContext.currentTime);\r\n          oscillator.stop(audioContext.currentTime + 0.3);\r\n          break;\r\n          \r\n        case 'info':\r\n          // Gentle info sound\r\n          oscillator.frequency.setValueAtTime(400, audioContext.currentTime);\r\n          gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);\r\n          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);\r\n          oscillator.start(audioContext.currentTime);\r\n          oscillator.stop(audioContext.currentTime + 0.2);\r\n          break;\r\n      }\r\n    } catch (error) {\r\n      console.error('   :', error);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setIsVisible(false);\r\n    setTimeout(() => {\r\n      onClose();\r\n    }, 300); // Wait for animation to complete\r\n  };\r\n\r\n  const getAlertStyles = (type: NotificationType) => {\r\n    switch (type) {\r\n      case 'urgent':\r\n        return {\r\n          bg: 'bg-red-500',\r\n          border: 'border-red-600',\r\n          text: 'text-white',\r\n          icon: <AlertTriangle className=\"w-6 h-6\" />,\r\n          pulse: 'animate-pulse'\r\n        };\r\n      case 'warning':\r\n        return {\r\n          bg: 'bg-yellow-500',\r\n          border: 'border-yellow-600',\r\n          text: 'text-white',\r\n          icon: <Clock className=\"w-6 h-6\" />,\r\n          pulse: ''\r\n        };\r\n      case 'info':\r\n        return {\r\n          bg: 'bg-blue-500',\r\n          border: 'border-blue-600',\r\n          text: 'text-white',\r\n          icon: <Bell className=\"w-6 h-6\" />,\r\n          pulse: ''\r\n        };\r\n      default:\r\n        return {\r\n          bg: 'bg-gray-500',\r\n          border: 'border-gray-600',\r\n          text: 'text-white',\r\n          icon: <Bell className=\"w-6 h-6\" />,\r\n          pulse: ''\r\n        };\r\n    }\r\n  };\r\n\r\n  const formatDate = (date: Date) => {\r\n    return new Intl.DateTimeFormat('ar-SA', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric'\r\n    }).format(date);\r\n  };\r\n\r\n  if (!notification) return null;\r\n\r\n  const styles = getAlertStyles(notification.type);\r\n\r\n  return (\r\n    <div className=\"fixed top-4 right-4 z-[9999]\">\r\n      <div\r\n        className={`\r\n          transform transition-all duration-300 ease-in-out\r\n          ${isVisible ? 'translate-x-0 opacity-100' : 'translate-x-full opacity-0'}\r\n          ${styles.bg} ${styles.border} ${styles.text} ${styles.pulse}\r\n          border-2 rounded-lg shadow-2xl max-w-md min-w-80\r\n          backdrop-blur-sm\r\n        `}\r\n      >\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between p-4 border-b border-white border-opacity-20\">\r\n          <div className=\"flex items-center gap-3\">\r\n            {styles.icon}\r\n            <h3 className=\"font-bold text-lg\">\r\n              {notification.type === 'urgent' && ' !'}\r\n              {notification.type === 'warning' && ''}\r\n              {notification.type === 'info' && ''}\r\n            </h3>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center gap-2\">\r\n            <button\r\n              onClick={onToggleSound}\r\n              className=\"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors\"\r\n              title={soundEnabled ? ' ' : ' '}\r\n            >\r\n              {soundEnabled ? (\r\n                <Volume2 className=\"w-4 h-4\" />\r\n              ) : (\r\n                <VolumeX className=\"w-4 h-4\" />\r\n              )}\r\n            </button>\r\n            \r\n            <button\r\n              onClick={handleClose}\r\n              className=\"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors\"\r\n            >\r\n              <X className=\"w-4 h-4\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"p-4\">\r\n          <p className=\"text-lg font-medium mb-3\">\r\n            {notification.message}\r\n          </p>\r\n          \r\n          <div className=\"space-y-2 text-sm opacity-90\">\r\n            <div>\r\n              <strong>:</strong> {notification.userName}\r\n            </div>\r\n            <div>\r\n              <strong>  :</strong> {formatDate(notification.expiryDate)}\r\n            </div>\r\n            <div>\r\n              <strong> :</strong> {notification.daysRemaining} \r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Progress bar for urgent notifications */}\r\n        {notification.type === 'urgent' && (\r\n          <div className=\"h-1 bg-white bg-opacity-20\">\r\n            <div \r\n              className=\"h-full bg-white animate-pulse\"\r\n              style={{\r\n                animation: 'progress 10s linear forwards'\r\n              }}\r\n            />\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <style jsx>{`\r\n        @keyframes progress {\r\n          from { width: 100%; }\r\n          to { width: 0%; }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NotificationAlert;","import React, { useState, useEffect } from 'react';\nimport { Card, CardContent } from './ui/card';\nimport { Badge } from './ui/badge';\nimport { Button } from './ui/button';\nimport { Input } from './ui/input';\nimport { Label } from './ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select';\nimport { User, Calendar, Settings, Crown, Clock, Infinity, Gift, Zap, Mail, Lock, Phone, ArrowUpDown, Smartphone } from 'lucide-react'\nimport { UserWithSubscription, SubscriptionPlan, parseFirestoreDate, getPlanDisplayName } from '../utils/subscriptionService';\nimport { useIsMobile } from '@/hooks/use-mobile';\n\ninterface UserCardProps {\n  user: UserWithSubscription;\n  onActivateSubscription?: (userId: string, planType: SubscriptionPlan, customStartDate?: Date, customEndDate?: Date) => void;\n  onRequestActivation?: (user: UserWithSubscription) => void;\n  onDeactivateSubscription?: (userId: string) => void;\n  onToggleUserStatus?: (userId: string) => void;\n  onDeleteUser?: (userId: string) => void;\n  onUpdateSessionLimit?: (userId: string, config: { sessionLimit: number | null; sessionLimitDisabled: boolean }) => void;\n}\n\nconst UserCard: React.FC<UserCardProps> = ({\n  user,\n  onActivateSubscription,\n  onRequestActivation,\n  onDeactivateSubscription,\n  onDeleteUser,\n  onUpdateSessionLimit\n}) => {\n  const [selectedPlan, setSelectedPlan] = useState<SubscriptionPlan>(SubscriptionPlan.MONTHLY);\n  const [showPlanSelector, setShowPlanSelector] = useState(false);\n  const [customStartDate, setCustomStartDate] = useState<string>('');\n  const [customEndDate, setCustomEndDate] = useState<string>('');\n  const isMobile = useIsMobile();\n  const rawSessionLimit = (user as any).sessionLimit;\n  const rawSessionLimitDisabled = (user as any).sessionLimitDisabled === true;\n  const [deviceLimit, setDeviceLimit] = useState<string>(() => {\n    if (rawSessionLimitDisabled) return \"2\";\n    if (typeof rawSessionLimit === \"number\" && rawSessionLimit > 0) return String(rawSessionLimit);\n    return \"2\";\n  });\n  const [unlimited, setUnlimited] = useState<boolean>(rawSessionLimitDisabled);\n\n  useEffect(() => {\n    const nextRawLimit = (user as any).sessionLimit;\n    const nextDisabled = (user as any).sessionLimitDisabled === true;\n    setUnlimited(nextDisabled);\n    if (nextDisabled) {\n      setDeviceLimit(\"2\");\n    } else if (typeof nextRawLimit === \"number\" && nextRawLimit > 0) {\n      setDeviceLimit(String(nextRawLimit));\n    } else {\n      setDeviceLimit(\"2\");\n    }\n  }, [user]);\n  // Helper: safely get display name\n  const getUserDisplayName = (u: any) => {\n    const dn = u?.displayName;\n    if (typeof dn === 'string' && dn.trim()) return dn.trim();\n    if (dn && typeof dn === 'object') {\n      const objVal = dn.full_name || dn.name || dn.ar || dn.en;\n      if (typeof objVal === 'string' && objVal.trim()) return objVal.trim();\n    }\n    if (typeof u?.email === 'string' && u.email.includes('@')) {\n      return u.email.split('@')[0];\n    }\n    return ' ';\n  };\n\n  const getPlanIcon = (planType: SubscriptionPlan) => {\n    switch (planType) {\n      case SubscriptionPlan.LIFETIME:\n        return <Crown className=\"w-4 h-4 text-yellow-500\" />\n      case SubscriptionPlan.YEARLY:\n        return <Gift className=\"w-4 h-4 text-blue-500\" />\n      case SubscriptionPlan.QUARTERLY:\n        return <Calendar className=\"w-4 h-4 text-purple-500\" />\n      case SubscriptionPlan.MONTHLY:\n        return <Zap className=\"w-4 h-4 text-green-500\" />\n      case SubscriptionPlan.FIVE_MINUTES:\n        return <Clock className=\"w-4 h-4 text-orange-500\" />\n      case SubscriptionPlan.ZERO:\n        return <Lock className=\"w-4 h-4 text-gray-500\" />\n      case SubscriptionPlan.TAHWEELA:\n        return <ArrowUpDown className=\"w-4 h-4 text-blue-600\" />\n      case SubscriptionPlan.BRANCH:\n        return <User className=\"w-4 h-4 text-indigo-500\" />\n      default:\n        return null\n    }\n  };\n\n  const formatDate = (date: any) => {\n    if (!date) return ' ';\n    const dateObj = parseFirestoreDate(date);\n    \n    // Validate date\n    if (!dateObj) {\n      return '  ';\n    }\n    \n    return dateObj.toLocaleDateString('ar-EG');\n  };\n\n  return (\n    <Card className=\"hover:shadow-lg transition-shadow\">\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start justify-between mb-4\">\n          <div className=\"flex items-center space-x-3 space-x-reverse\">\n            <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\n              <User className=\"w-5 h-5 text-blue-600\" />\n            </div>\n            <div>\n              <h3 className=\"font-semibold text-gray-900\">\n                {getUserDisplayName(user)}\n              </h3>\n              <div className=\"flex items-center text-sm text-gray-500\">\n                <Mail className=\"w-3 h-3 ml-1\" />\n                {user.email}\n              </div>\n              <div className=\"flex items-center text-sm text-gray-500 mt-1\">\n                <Phone className=\"w-3 h-3 ml-1\" />\n                {user.phone || ' '}\n              </div>\n            </div>\n          </div>\n          <div className={`px-2 py-0.5 rounded-[8px] text-xs font-medium border ${\n            user.isActive \n              ? 'bg-green-50 text-green-700 border-green-200' \n              : 'bg-secondary/10 text-secondary border-secondary/20'\n          }`}>\n            {user.isActive ? '' : ' '}\n          </div>\n        </div>\n\n        {user.subscription && (\n          <div className=\"mb-4 p-3 bg-gray-50 rounded-lg\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <div className=\"flex items-center space-x-2 space-x-reverse\">\n                {getPlanIcon(user.subscription.planType)}\n                <span className=\"text-sm font-medium\">\n                  {getPlanDisplayName(user.subscription.planType)}\n                </span>\n              </div>\n              <Badge variant={user.subscription.isActive ? \"default\" : \"destructive\"}>\n                {user.subscription.isActive ? '' : ''}\n              </Badge>\n            </div>\n            <div className=\"text-xs text-gray-600\">\n              <div className=\"flex items-center mb-1\">\n                <Calendar className=\"w-3 h-3 ml-1\" />\n                : {formatDate(user.subscription.startDate)}\n              </div>\n              {user.subscription.endDate && (\n                <div className=\"flex items-center\">\n                  <Calendar className=\"w-3 h-3 ml-1\" />\n                  : {formatDate(user.subscription.endDate)}\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        <div className=\"space-y-3\">\n          {onUpdateSessionLimit && (\n            <div className=\"p-3 bg-gray-50 rounded-lg border border-dashed border-gray-200\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <div className=\"flex items-center gap-2\">\n                  <Smartphone className=\"w-4 h-4 text-gray-600\" />\n                  <span className=\"text-sm font-medium text-gray-800\">  </span>\n                </div>\n              </div>\n              <div className=\"flex flex-col sm:flex-row gap-2 items-center\">\n                <label className=\"flex items-center gap-2 text-xs text-gray-700\">\n                  <input\n                    type=\"checkbox\"\n                    checked={unlimited}\n                    onChange={(e) => setUnlimited(e.target.checked)}\n                  />\n                  <span>     </span>\n                </label>\n                {!unlimited && (\n                  <div className=\"flex items-center gap-2 w-full sm:w-auto\">\n                    <input\n                      type=\"number\"\n                      min={1}\n                      value={deviceLimit}\n                      onChange={(e) => setDeviceLimit(e.target.value)}\n                      className=\"w-20 rounded-md border border-gray-300 px-2 py-1 text-xs text-center\"\n                    />\n                    <span className=\"text-xs text-gray-600\">  </span>\n                  </div>\n                )}\n                <Button\n                  size=\"sm\"\n                  className=\"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white\"\n                  onClick={() => {\n                    const parsed = parseInt(deviceLimit, 10);\n                    const normalized = isNaN(parsed) || parsed < 1 ? 1 : parsed;\n                    const payloadLimit = unlimited ? null : normalized;\n                    onUpdateSessionLimit(user.id, {\n                      sessionLimit: payloadLimit,\n                      sessionLimitDisabled: unlimited,\n                    });\n                  }}\n                >\n                  \n                </Button>\n              </div>\n            </div>\n          )}\n          {/*    */}\n          {onActivateSubscription && showPlanSelector && (\n            <div className=\"p-3 bg-blue-50 rounded-lg border border-blue-200\">\n              <div className=\"mb-2\">\n                <label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                    :\n                </label>\n                {isMobile ? (\n                  <select\n                    className=\"w-full h-10 border border-input bg-background rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring\"\n                    value={selectedPlan}\n                    onChange={(e) => setSelectedPlan(e.target.value as SubscriptionPlan)}\n                  >\n                    <option value={SubscriptionPlan.MONTHLY}></option>\n                    <option value={SubscriptionPlan.QUARTERLY}> </option>\n                    <option value={SubscriptionPlan.HALF_YEARLY}> </option>\n                    <option value={SubscriptionPlan.YEARLY}></option>\n                    <option value={SubscriptionPlan.LIFETIME}> </option>\n                    <option value={SubscriptionPlan.FIVE_MINUTES}>5 </option>\n                    <option value={SubscriptionPlan.ZERO}></option>\n                    <option value={SubscriptionPlan.TAHWEELA}></option>\n                  </select>\n                ) : (\n                  <Select value={selectedPlan} onValueChange={(value) => setSelectedPlan(value as SubscriptionPlan)}>\n                    <SelectTrigger className=\"w-full\">\n                      <SelectValue placeholder=\"  \" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value={SubscriptionPlan.MONTHLY}>\n                        <div className=\"flex items-center space-x-2 space-x-reverse\">\n                          <Clock className=\"w-4 h-4\" />\n                          <span></span>\n                        </div>\n                      </SelectItem>\n                      <SelectItem value={SubscriptionPlan.QUARTERLY}>\n                        <div className=\"flex items-center space-x-2 space-x-reverse\">\n                          <Calendar className=\"w-4 h-4\" />\n                          <span> </span>\n                        </div>\n                      </SelectItem>\n                      <SelectItem value={SubscriptionPlan.YEARLY}>\n                        <div className=\"flex items-center space-x-2 space-x-reverse\">\n                          <Calendar className=\"w-4 h-4\" />\n                          <span></span>\n                        </div>\n                      </SelectItem>\n                      <SelectItem value={SubscriptionPlan.LIFETIME}>\n                        <div className=\"flex items-center space-x-2 space-x-reverse\">\n                          <Infinity className=\"w-4 h-4\" />\n                          <span> </span>\n                        </div>\n                      </SelectItem>\n                      <SelectItem value={SubscriptionPlan.FIVE_MINUTES}>\n                        <div className=\"flex items-center space-x-2 space-x-reverse\">\n                          <Clock className=\"w-4 h-4\" />\n                          <span>5 </span>\n                        </div>\n                      </SelectItem>\n                      <SelectItem value={SubscriptionPlan.ZERO}>\n                        <div className=\"flex items-center space-x-2 space-x-reverse\">\n                          <Lock className=\"w-4 h-4\" />\n                          <span></span>\n                        </div>\n                      </SelectItem>\n                      <SelectItem value={SubscriptionPlan.TAHWEELA}>\n                        <div className=\"flex items-center space-x-2 space-x-reverse\">\n                          <ArrowUpDown className=\"w-4 h-4\" />\n                          <span></span>\n                        </div>\n                      </SelectItem>\n                    </SelectContent>\n                  </Select>\n                )}\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-2 mb-4\">\n                <div>\n                  <Label className=\"text-xs mb-1 block\">  ()</Label>\n                  <Input \n                    type=\"date\" \n                    value={customStartDate} \n                    onChange={(e) => setCustomStartDate(e.target.value)}\n                    className=\"h-8 text-sm bg-white\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"text-xs mb-1 block\">  ()</Label>\n                  <Input \n                    type=\"date\" \n                    value={customEndDate} \n                    onChange={(e) => setCustomEndDate(e.target.value)}\n                    className=\"h-8 text-sm bg-white\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex space-x-2 space-x-reverse\">\n                <Button\n                  size=\"sm\"\n                  onClick={() => {\n                    const startDate = customStartDate ? new Date(customStartDate) : undefined;\n                    const endDate = customEndDate ? new Date(customEndDate) : undefined;\n                    onActivateSubscription(user.id, selectedPlan, startDate, endDate);\n                    setShowPlanSelector(false);\n                    setCustomStartDate('');\n                    setCustomEndDate('');\n                  }}\n                  className=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white\"\n                >\n                   \n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() => setShowPlanSelector(false)}\n                  className=\"flex-1\"\n                >\n                  \n                </Button>\n              </div>\n            </div>\n          )}\n\n          {/*   */}\n          <div className=\"flex space-x-2 space-x-reverse\">\n            {(onActivateSubscription || onRequestActivation) && !showPlanSelector && (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => onRequestActivation ? onRequestActivation(user) : setShowPlanSelector(true)}\n                className=\"flex-1\"\n              >\n                {user.subscription?.isActive ? ' ' : ' '}\n              </Button>\n            )}\n            {onDeactivateSubscription && (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => onDeactivateSubscription(user.id)}\n                className=\"flex-1\"\n              >\n                 \n              </Button>\n            )}\n            {onDeleteUser && (\n              <Button\n                size=\"sm\"\n                variant=\"destructive\"\n                onClick={() => onDeleteUser(user.id)}\n              >\n                <Settings className=\"w-4 h-4\" />\n              </Button>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default React.memo(UserCard);\n","import React, { useState, useMemo } from 'react';\nimport { Zap, Calendar, Gift, Crown, Clock, Lock, RefreshCw, X, CheckCircle, Star } from 'lucide-react';\nimport { SubscriptionPlan } from '../utils/subscriptionService';\n\ninterface ActivationModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  user: any;\n  onActivate: (userId: string, planId: SubscriptionPlan, customStartDate?: Date, customEndDate?: Date) => Promise<void>;\n}\n\nconst SUBSCRIPTION_PLANS_CONFIG = [\n  { id: SubscriptionPlan.MONTHLY, name: '', icon: Zap, color: 'text-green-600', bg: 'bg-green-50', border: 'border-green-200' },\n  { id: SubscriptionPlan.QUARTERLY, name: ' ', icon: Calendar, color: 'text-purple-600', bg: 'bg-purple-50', border: 'border-purple-200' },\n  { id: SubscriptionPlan.HALF_YEARLY, name: ' ', icon: Star, color: 'text-rose-600', bg: 'bg-rose-50', border: 'border-rose-200' },\n  { id: SubscriptionPlan.YEARLY, name: '', icon: Gift, color: 'text-blue-600', bg: 'bg-blue-50', border: 'border-blue-200' },\n  { id: SubscriptionPlan.LIFETIME, name: ' ', icon: Crown, color: 'text-yellow-600', bg: 'bg-yellow-50', border: 'border-yellow-200' },\n  { id: SubscriptionPlan.FIVE_MINUTES, name: '5 ', icon: Clock, color: 'text-orange-600', bg: 'bg-orange-50', border: 'border-orange-200' },\n  { id: SubscriptionPlan.ZERO, name: '', icon: Lock, color: 'text-gray-600', bg: 'bg-gray-50', border: 'border-gray-200' },\n  { id: SubscriptionPlan.TAHWEELA, name: '', icon: RefreshCw, color: 'text-indigo-600', bg: 'bg-indigo-50', border: 'border-indigo-200' },\n];\n\nconst PLAN_STYLES: Record<SubscriptionPlan, { from: string; to: string; ring: string }> = {\n  [SubscriptionPlan.MONTHLY]: { from: 'from-blue-50', to: 'to-indigo-50', ring: 'ring-blue-300' },\n  [SubscriptionPlan.QUARTERLY]: { from: 'from-purple-50', to: 'to-pink-50', ring: 'ring-purple-300' },\n  [SubscriptionPlan.HALF_YEARLY]: { from: 'from-rose-50', to: 'to-pink-50', ring: 'ring-rose-300' },\n  [SubscriptionPlan.YEARLY]: { from: 'from-sky-50', to: 'to-blue-50', ring: 'ring-blue-300' },\n  [SubscriptionPlan.LIFETIME]: { from: 'from-yellow-50', to: 'to-amber-50', ring: 'ring-amber-300' },\n  [SubscriptionPlan.FIVE_MINUTES]: { from: 'from-orange-50', to: 'to-red-50', ring: 'ring-orange-300' },\n  [SubscriptionPlan.ZERO]: { from: 'from-gray-50', to: 'to-slate-100', ring: 'ring-gray-300' },\n  [SubscriptionPlan.TAHWEELA]: { from: 'from-indigo-50', to: 'to-violet-50', ring: 'ring-indigo-300' },\n};\n\nconst getUserDisplayName = (u: any) => {\n  const dn = u?.displayName;\n  if (typeof dn === 'string' && dn.trim()) return dn.trim();\n  if (dn && typeof dn === 'object') {\n    const objVal = dn.full_name || dn.name || dn.ar || dn.en;\n    if (typeof objVal === 'string' && objVal.trim()) return objVal.trim();\n  }\n  if (typeof u?.email === 'string' && u.email.includes('@')) {\n    return u.email.split('@')[0];\n  }\n  return '';\n};\n\nconst ActivationModal: React.FC<ActivationModalProps> = ({ isOpen, onClose, user, onActivate }) => {\n  const [selectedPlan, setSelectedPlan] = useState<SubscriptionPlan>(SubscriptionPlan.MONTHLY);\n  const [customStartDate, setCustomStartDate] = useState<string>('');\n  const [customEndDate, setCustomEndDate] = useState<string>('');\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  // Reset selection when modal opens/closes or user changes\n  React.useEffect(() => {\n    if (isOpen) {\n      setSelectedPlan(SubscriptionPlan.MONTHLY);\n      setCustomStartDate('');\n      setCustomEndDate('');\n      setIsSubmitting(false);\n    }\n  }, [isOpen, user]);\n\n  const handleActivate = async () => {\n    if (isSubmitting) return;\n    setIsSubmitting(true);\n    try {\n      const startDate = customStartDate ? new Date(customStartDate) : undefined;\n      const endDate = customEndDate ? new Date(customEndDate) : undefined;\n      await onActivate(user.id, selectedPlan, startDate, endDate);\n    } catch (error) {\n      console.error('Activation failed', error);\n      setIsSubmitting(false);\n    }\n  };\n\n  if (!isOpen || !user) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 transition-opacity duration-200\">\n      <div className=\"bg-white w-full max-w-2xl rounded-xl shadow-xl transform transition-all flex flex-col max-h-[90vh]\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-100 flex-shrink-0\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center\">\n              <Zap className=\"w-5 h-5 text-blue-600\" />\n            </div>\n            <div>\n              <h4 className=\"text-xl font-bold text-gray-800\">\n                {user?.subscription?.isActive ? '  ' : '  '}\n              </h4>\n              <p className=\"text-sm text-gray-500\">: {getUserDisplayName(user)}</p>\n            </div>\n          </div>\n          <button \n            onClick={onClose}\n            className=\"text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-100 p-1\"\n          >\n            <X className=\"w-6 h-6\" />\n          </button>\n        </div>\n        \n        <div className=\"p-6 overflow-y-auto flex-1\">\n          <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\n            {SUBSCRIPTION_PLANS_CONFIG.map((plan) => {\n              const styles = PLAN_STYLES[plan.id];\n              const selected = selectedPlan === plan.id;\n              return (\n                <div\n                  key={plan.id}\n                  onClick={() => setSelectedPlan(plan.id)}\n                  className={`rounded-xl p-4 border shadow-sm bg-gradient-to-br ${styles.from} ${styles.to} cursor-pointer transition-all ${\n                    selected ? `ring-2 ${styles.ring}` : 'hover:shadow-md'\n                  }`}\n                >\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <div className=\"w-10 h-10 rounded-full bg-white/70 flex items-center justify-center\">\n                      <plan.icon className={`w-5 h-5 ${plan.color}`} />\n                    </div>\n                    {selected && <CheckCircle className={`w-5 h-5 ${plan.color}`} />}\n                  </div>\n                  <div className=\"font-bold text-gray-800\">{plan.name}</div>\n                  {selected && <div className={`text-xs font-medium ${plan.color}`}> </div>}\n                </div>\n              );\n            })}\n          </div>\n\n          <div className=\"mt-6 border-t border-gray-100 pt-4\">\n            <h5 className=\"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2\">\n              <Calendar className=\"w-4 h-4 text-gray-500\" />\n                 ()\n            </h5>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-xs font-medium text-gray-600 mb-1.5\"> </label>\n                <input\n                  type=\"date\"\n                  value={customStartDate}\n                  onChange={(e) => setCustomStartDate(e.target.value)}\n                  className=\"w-full px-3 py-2 rounded-lg border border-gray-300 text-sm focus:ring-2 focus:ring-blue-100 focus:border-blue-400 outline-none transition-all\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-xs font-medium text-gray-600 mb-1.5\"> </label>\n                <input\n                  type=\"date\"\n                  value={customEndDate}\n                  onChange={(e) => setCustomEndDate(e.target.value)}\n                  className=\"w-full px-3 py-2 rounded-lg border border-gray-300 text-sm focus:ring-2 focus:ring-blue-100 focus:border-blue-400 outline-none transition-all\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex items-center justify-end gap-3 p-6 bg-gray-50 rounded-b-xl border-t border-gray-100 flex-shrink-0\">\n          <button\n            onClick={onClose}\n            disabled={isSubmitting}\n            className=\"px-5 py-2.5 rounded-lg border border-gray-300 bg-white text-gray-700 font-medium hover:bg-gray-50 focus:ring-2 focus:ring-gray-200 transition-all disabled:opacity-50\"\n          >\n            \n          </button>\n          <button\n            onClick={handleActivate}\n            disabled={isSubmitting}\n            className=\"px-5 py-2.5 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 shadow-lg shadow-blue-600/20 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {isSubmitting ? (\n              <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n            ) : (\n              <CheckCircle className=\"w-5 h-5\" />\n            )}\n            {isSubmitting ? ' ...' : (user?.subscription?.isActive ? ' ' : ' ')}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ActivationModal;\n","import React, { useState, useEffect } from 'react';\nimport { db } from '@/firebase';\nimport { collection, query, onSnapshot, orderBy, doc, updateDoc, deleteDoc, Timestamp, where, getDocs, limit } from 'firebase/firestore';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from '@/hooks/use-toast';\nimport { Users, Search, Trash2, Edit, UserCheck, ShieldCheck } from 'lucide-react';\nimport { SubscriptionPlan, calculateEndDate } from '@/utils/subscriptionService';\n\ninterface ResellerRequest {\n  id: string;\n  uid?: string;\n  email: string;\n  password?: string;\n  status: 'pending' | 'active' | 'inactive';\n  packageName?: string;\n  ownerId: string;\n  createdAt: any;\n  startDate?: any;\n  endDate?: any;\n  deletionRequested?: boolean;\n  deletionReason?: string;\n  deletionStatus?: 'pending' | 'rejected';\n  cancelRequested?: boolean;\n  cancelReason?: string;\n  cancelStatus?: 'pending' | 'rejected';\n}\n\nconst PLANS = [\n  { value: SubscriptionPlan.MONTHLY, label: ' ' },\n  { value: SubscriptionPlan.QUARTERLY, label: '  ' },\n  { value: SubscriptionPlan.HALF_YEARLY, label: '  ' },\n  { value: SubscriptionPlan.YEARLY, label: ' ' },\n  { value: SubscriptionPlan.LIFETIME, label: '  ' },\n];\n\nexport const ResellerAdmin = () => {\n  const [requests, setRequests] = useState<ResellerRequest[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedRequest, setSelectedRequest] = useState<ResellerRequest | null>(null);\n  const [isEditOpen, setIsEditOpen] = useState(false);\n  const [editForm, setEditForm] = useState({ status: '', packageName: '' });\n  \n  // Delete Review States\n  const [isDeleteReviewOpen, setIsDeleteReviewOpen] = useState(false);\n  const [selectedDeleteRequest, setSelectedDeleteRequest] = useState<ResellerRequest | null>(null);\n\n  // Cancel Package Review States\n  const [isCancelReviewOpen, setIsCancelReviewOpen] = useState(false);\n  const [selectedCancelRequest, setSelectedCancelRequest] = useState<ResellerRequest | null>(null);\n\n  // Main Reseller Activation States\n  const [activeTab, setActiveTab] = useState('requests');\n  const [mainResellers, setMainResellers] = useState<any[]>([]);\n  const [isActivateDialogOpen, setIsActivateDialogOpen] = useState(false);\n  const [activateEmail, setActivateEmail] = useState('');\n  const [isActivating, setIsActivating] = useState(false);\n\n  const { toast } = useToast();\n\n  useEffect(() => {\n    // 1. Fetch Reseller Requests (Sub-accounts)\n    const q = query(collection(db, 'reseller_requests'), orderBy('createdAt', 'desc'));\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as ResellerRequest));\n      setRequests(docs);\n      setLoading(false);\n    }, (error) => {\n      console.error(\"Error fetching reseller requests:\", error);\n      setLoading(false);\n    });\n\n    // 2. Fetch Main Resellers (Active Parents)\n    const qMain = query(collection(db, 'users'), where('isResellerEnabled', '==', true));\n    const unsubscribeMain = onSnapshot(qMain, (snapshot) => {\n      const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n      setMainResellers(docs);\n    });\n\n    return () => {\n      unsubscribe();\n      unsubscribeMain();\n    };\n  }, []);\n\n  const handleActivateReseller = async () => {\n    if (!activateEmail.trim()) {\n      toast({ title: '', description: '   ', variant: 'destructive' });\n      return;\n    }\n\n    setIsActivating(true);\n    try {\n      // Find user by email\n      const usersRef = collection(db, 'users');\n      const q = query(usersRef, where('email', '==', activateEmail.trim()), limit(1));\n      const querySnapshot = await getDocs(q);\n\n      if (querySnapshot.empty) {\n        toast({ title: '', description: '       ', variant: 'destructive' });\n        setIsActivating(false);\n        return;\n      }\n\n      const userDoc = querySnapshot.docs[0];\n      \n      // Update user to enable reseller system\n      await updateDoc(doc(db, 'users', userDoc.id), {\n        isResellerEnabled: true\n      });\n\n      toast({ title: ' ', description: '      ' });\n      setIsActivateDialogOpen(false);\n      setActivateEmail('');\n    } catch (error) {\n      console.error(\"Error activating reseller:\", error);\n      toast({ title: '', description: '   ', variant: 'destructive' });\n    } finally {\n      setIsActivating(false);\n    }\n  };\n\n  const handleDeactivateReseller = async (userId: string) => {\n    if (!window.confirm('        ')) return;\n    try {\n      await updateDoc(doc(db, 'users', userId), {\n        isResellerEnabled: false\n      });\n      toast({ title: ' ', description: '    ' });\n    } catch (error) {\n      console.error(\"Error deactivating reseller:\", error);\n      toast({ title: '', description: '   ', variant: 'destructive' });\n    }\n  };\n\n  const handleEditClick = (req: ResellerRequest) => {\n    setSelectedRequest(req);\n    setEditForm({ \n      status: req.status, \n      packageName: req.packageName || '' \n    });\n    setIsEditOpen(true);\n  };\n\n  const handleSave = async () => {\n    if (!selectedRequest) return;\n    try {\n      const updateData: any = {\n        status: editForm.status,\n        packageName: editForm.packageName\n      };\n\n      let subscriptionData: any = null;\n      let isActive = false;\n\n      //          \n      if (editForm.status === 'active' && editForm.packageName) {\n        const startDate = new Date();\n        const endDate = calculateEndDate(editForm.packageName as SubscriptionPlan, startDate);\n        updateData.startDate = startDate;\n        updateData.endDate = endDate;\n        \n        isActive = true;\n        subscriptionData = {\n          planType: editForm.packageName,\n          startDate: startDate,\n          endDate: endDate,\n          isActive: true,\n          activatedAt: startDate\n        };\n      } else if (editForm.status !== 'active') {\n        isActive = false;\n        subscriptionData = {\n          isActive: false\n        };\n      }\n\n      //    \n      await updateDoc(doc(db, 'reseller_requests', selectedRequest.id), updateData);\n\n      //    \n      if (selectedRequest.uid) {\n        const userUpdateData: any = {\n          isActive: isActive,\n          updatedAt: new Date()\n        };\n        \n        if (subscriptionData) {\n          userUpdateData.subscription = subscriptionData;\n        }\n\n        await updateDoc(doc(db, 'users', selectedRequest.uid), userUpdateData);\n      }\n\n      toast({ title: ' ', description: '      ' });\n      setIsEditOpen(false);\n    } catch (error) {\n      console.error(\"Error updating request:\", error);\n      toast({ title: '', description: '   ', variant: 'destructive' });\n    }\n  };\n\n  const handleDelete = async (id: string) => {\n    if (!window.confirm('      ')) return;\n    try {\n      await deleteDoc(doc(db, 'reseller_requests', id));\n      toast({ title: ' ', description: '   ' });\n    } catch (error) {\n      toast({ title: '', description: '   ', variant: 'destructive' });\n    }\n  };\n\n  const handleReviewDeleteClick = (req: ResellerRequest) => {\n    setSelectedDeleteRequest(req);\n    setIsDeleteReviewOpen(true);\n  };\n\n  const handleAcceptDelete = async () => {\n    if (!selectedDeleteRequest) return;\n    try {\n      // Delete the reseller request\n      await deleteDoc(doc(db, 'reseller_requests', selectedDeleteRequest.id));\n      \n      // Optionally disable the user if uid exists\n      if (selectedDeleteRequest.uid) {\n        // We might want to keep the user doc but mark it inactive or deleted, \n        // but user asked for deletion from reseller list.\n        // Let's just update the user to inactive for safety.\n        await updateDoc(doc(db, 'users', selectedDeleteRequest.uid), {\n          isActive: false,\n          role: 'user' // Downgrade from merchant/reseller\n        });\n      }\n\n      toast({ title: ' ', description: '       ' });\n      setIsDeleteReviewOpen(false);\n    } catch (error) {\n      console.error(\"Error accepting delete:\", error);\n      toast({ title: '', description: '    ', variant: 'destructive' });\n    }\n  };\n\n  const handleRejectDelete = async () => {\n    if (!selectedDeleteRequest) return;\n    try {\n      await updateDoc(doc(db, 'reseller_requests', selectedDeleteRequest.id), {\n        deletionRequested: false,\n        deletionStatus: 'rejected'\n      });\n      toast({ title: ' ', description: '     ' });\n      setIsDeleteReviewOpen(false);\n    } catch (error) {\n      console.error(\"Error rejecting delete:\", error);\n      toast({ title: '', description: '    ', variant: 'destructive' });\n    }\n  };\n\n  const handleReviewCancelClick = (req: ResellerRequest) => {\n    setSelectedCancelRequest(req);\n    setIsCancelReviewOpen(true);\n  };\n\n  const handleAcceptCancel = async () => {\n    if (!selectedCancelRequest) return;\n    try {\n      // 1. Update reseller request status to inactive and clear package details\n      await updateDoc(doc(db, 'reseller_requests', selectedCancelRequest.id), {\n        status: 'inactive',\n        packageName: null,\n        startDate: null,\n        endDate: null,\n        cancelRequested: false,\n        cancelStatus: null\n      });\n\n      // 2. Update user document to inactive\n      if (selectedCancelRequest.uid) {\n        await updateDoc(doc(db, 'users', selectedCancelRequest.uid), {\n          isActive: false,\n          'subscription.isActive': false,\n          'subscription.planId': null,\n          'subscription.endDate': null\n        });\n      }\n\n      toast({ title: ' ', description: '       ' });\n      setIsCancelReviewOpen(false);\n    } catch (error) {\n      console.error(\"Error accepting cancel:\", error);\n      toast({ title: '', description: '    ', variant: 'destructive' });\n    }\n  };\n\n  const handleRejectCancel = async () => {\n    if (!selectedCancelRequest) return;\n    try {\n      await updateDoc(doc(db, 'reseller_requests', selectedCancelRequest.id), {\n        cancelRequested: false,\n        cancelStatus: 'rejected'\n      });\n      toast({ title: ' ', description: '      ' });\n      setIsCancelReviewOpen(false);\n    } catch (error) {\n      console.error(\"Error rejecting cancel:\", error);\n      toast({ title: '', description: '    ', variant: 'destructive' });\n    }\n  };\n\n  const getPlanLabel = (value?: string) => {\n    return PLANS.find(p => p.value === value)?.label || value || '-';\n  };\n\n  const filteredRequests = requests.filter(req => \n    req.email.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    req.packageName?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      <Tabs defaultValue=\"requests\" value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-2 mb-4\">\n          <TabsTrigger value=\"requests\">  </TabsTrigger>\n          <TabsTrigger value=\"main_resellers\">   ()</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"requests\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between\">\n              <CardTitle>   </CardTitle>\n              <div className=\"relative w-64\">\n                <Search className=\"absolute right-2 top-2.5 h-4 w-4 text-gray-500\" />\n                <Input\n                  placeholder=\"  ...\"\n                  className=\"pr-8\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                />\n              </div>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"text-right\"> </TableHead>\n                    <TableHead className=\"text-right\"> </TableHead>\n                    <TableHead className=\"text-right\"> </TableHead>\n                    <TableHead className=\"text-right\"></TableHead>\n                    <TableHead className=\"text-right\"></TableHead>\n                    <TableHead className=\"text-right\"></TableHead>\n                    <TableHead className=\"text-right\"></TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {loading ? (\n                    <TableRow>\n                      <TableCell colSpan={7} className=\"text-center\"> ...</TableCell>\n                    </TableRow>\n                  ) : filteredRequests.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={7} className=\"text-center\">  </TableCell>\n                    </TableRow>\n                  ) : (\n                    filteredRequests.map((req) => (\n                      <TableRow key={req.id}>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            {req.email}\n                            {req.deletionRequested && (\n                              <Badge \n                                variant=\"destructive\" \n                                className=\"cursor-pointer hover:bg-red-700 animate-pulse\"\n                                onClick={() => handleReviewDeleteClick(req)}\n                              >\n                                 \n                              </Badge>\n                            )}\n                            {req.cancelRequested && (\n                              <Badge \n                                className=\"bg-orange-500 hover:bg-orange-600 cursor-pointer animate-pulse\"\n                                onClick={() => handleReviewCancelClick(req)}\n                              >\n                                  \n                              </Badge>\n                            )}\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"font-mono text-xs\">{req.password}</TableCell>\n                        <TableCell>{req.phone || '-'}</TableCell>\n                        <TableCell>\n                          {req.status === 'active' ? (\n                            <Badge className=\"bg-green-100 text-green-800 hover:bg-green-100\"></Badge>\n                          ) : req.status === 'pending' ? (\n                            <Badge className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-100\"> </Badge>\n                          ) : (\n                            <Badge className=\"bg-red-100 text-red-800 hover:bg-red-100\"> </Badge>\n                          )}\n                        </TableCell>\n                        <TableCell>{getPlanLabel(req.packageName)}</TableCell>\n                        <TableCell>\n                          <div className=\"flex flex-col gap-1\">\n                            <span className=\"text-xs text-gray-500\">\n                              : {req.createdAt?.seconds ? new Date(req.createdAt.seconds * 1000).toLocaleDateString('ar-SA') : '-'}\n                            </span>\n                            {req.status === 'active' && req.endDate && (\n                              <span className=\"text-xs text-green-600 font-medium\">\n                                : {req.endDate.seconds ? new Date(req.endDate.seconds * 1000).toLocaleDateString('ar-SA') : '-'}\n                              </span>\n                            )}\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <Button variant=\"outline\" size=\"sm\" onClick={() => handleEditClick(req)}>\n                              <Edit className=\"h-4 w-4\" />\n                            </Button>\n                            <Button variant=\"ghost\" size=\"sm\" className=\"text-red-600\" onClick={() => handleDelete(req.id)}>\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"main_resellers\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between\">\n              <CardTitle className=\"flex items-center gap-2\">\n                <ShieldCheck className=\"h-5 w-5 text-blue-600\" />\n                   \n              </CardTitle>\n              <Dialog open={isActivateDialogOpen} onOpenChange={setIsActivateDialogOpen}>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>   </DialogTitle>\n                  </DialogHeader>\n                  <div className=\"space-y-4 py-4\">\n                    <div className=\"space-y-2\">\n                      <label className=\"text-sm font-medium\">   </label>\n                      <Input \n                        placeholder=\"email@example.com\" \n                        value={activateEmail}\n                        onChange={(e) => setActivateEmail(e.target.value)}\n                      />\n                    </div>\n                    <Button \n                      className=\"w-full bg-blue-600 hover:bg-blue-700\" \n                      onClick={handleActivateReseller}\n                      disabled={isActivating}\n                    >\n                      {isActivating ? ' ...' : ' '}\n                    </Button>\n                  </div>\n                </DialogContent>\n                <Button onClick={() => setIsActivateDialogOpen(true)} className=\"bg-blue-600 hover:bg-blue-700\">\n                  <UserCheck className=\"mr-2 h-4 w-4\" />\n                    \n                </Button>\n              </Dialog>\n            </CardHeader>\n            <CardContent>\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"text-right\"> </TableHead>\n                    <TableHead className=\"text-right\"></TableHead>\n                    <TableHead className=\"text-right\"> </TableHead>\n                    <TableHead className=\"text-right\"></TableHead>\n                    <TableHead className=\"text-right\"></TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {mainResellers.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={5} className=\"text-center py-8 text-gray-500\">\n                             \n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    mainResellers.map((user) => (\n                      <TableRow key={user.id}>\n                        <TableCell className=\"font-medium\">{user.email}</TableCell>\n                        <TableCell>{user.displayName || '-'}</TableCell>\n                        <TableCell>\n                          {user.createdAt?.seconds ? new Date(user.createdAt.seconds * 1000).toLocaleDateString('ar-SA') : '-'}\n                        </TableCell>\n                        <TableCell>\n                          <Badge className=\"bg-blue-100 text-blue-800 hover:bg-blue-100 flex w-fit items-center gap-1\">\n                            <ShieldCheck className=\"h-3 w-3\" />\n                             \n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <Button \n                            variant=\"ghost\" \n                            size=\"sm\" \n                            className=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n                            onClick={() => handleDeactivateReseller(user.id)}\n                          >\n                            <Trash2 className=\"h-4 w-4 mr-1\" />\n                            \n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))\n                  )}\n                </TableBody>\n              </Table>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      <Dialog open={isEditOpen} onOpenChange={setIsEditOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>  </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\"></label>\n              <Select value={editForm.status} onValueChange={(val) => setEditForm(prev => ({ ...prev, status: val }))}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\" \" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"pending\"> </SelectItem>\n                  <SelectItem value=\"active\"></SelectItem>\n                  <SelectItem value=\"inactive\"> </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\"> </label>\n              <Select value={editForm.packageName} onValueChange={(val) => setEditForm(prev => ({ ...prev, packageName: val }))}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\" \" />\n                </SelectTrigger>\n                <SelectContent>\n                  {PLANS.map((plan) => (\n                    <SelectItem key={plan.value} value={plan.value}>{plan.label}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setIsEditOpen(false)}></Button>\n            <Button onClick={handleSave} className=\"bg-blue-600 hover:bg-blue-700 text-white\"> </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isDeleteReviewOpen} onOpenChange={setIsDeleteReviewOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle className=\"text-red-600\">   </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"bg-red-50 p-4 rounded-lg border border-red-100\">\n              <h4 className=\"font-semibold text-red-800 mb-2\">    :</h4>\n              <p className=\"text-gray-700 whitespace-pre-wrap\">\n                {selectedDeleteRequest?.deletionReason || '   '}\n              </p>\n            </div>\n            <div className=\"text-sm text-gray-500\">\n              <p> : {selectedDeleteRequest?.email}</p>\n              <p> : {new Date().toLocaleDateString('ar-SA')}</p>\n            </div>\n            <div className=\"bg-yellow-50 p-3 rounded text-sm text-yellow-800 border border-yellow-200\">\n              :               .\n            </div>\n          </div>\n          <DialogFooter className=\"gap-2 sm:gap-0\">\n            <Button \n              variant=\"outline\" \n              onClick={handleRejectDelete}\n              className=\"text-red-600 border-red-200 hover:bg-red-50\"\n            >\n               \n            </Button>\n            <Button \n              onClick={handleAcceptDelete} \n              className=\"bg-red-600 hover:bg-red-700 text-white\"\n            >\n               \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isCancelReviewOpen} onOpenChange={setIsCancelReviewOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle className=\"text-orange-600\">   </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"bg-orange-50 p-4 rounded-lg border border-orange-100\">\n              <h4 className=\"font-semibold text-orange-800 mb-2\">    :</h4>\n              <p className=\"text-gray-700 whitespace-pre-wrap\">\n                {selectedCancelRequest?.cancelReason || '   '}\n              </p>\n            </div>\n            <div className=\"text-sm text-gray-500\">\n              <p> : {selectedCancelRequest?.email}</p>\n              <p> : {new Date().toLocaleDateString('ar-SA')}</p>\n            </div>\n            <div className=\"bg-yellow-50 p-3 rounded text-sm text-yellow-800 border border-yellow-200\">\n              :         .\n            </div>\n          </div>\n          <DialogFooter className=\"gap-2 sm:gap-0\">\n            <Button \n              variant=\"outline\" \n              onClick={handleRejectCancel}\n              className=\"text-red-600 border-red-200 hover:bg-red-50\"\n            >\n               \n            </Button>\n            <Button \n              onClick={handleAcceptCancel} \n              className=\"bg-orange-600 hover:bg-orange-700 text-white\"\n            >\n               \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n};\n","import React, { useState, useEffect } from 'react';\r\nimport { Users, Activity, Settings, MessageCircle, Gift, Zap, CheckCircle, UserCheck, UserX, Clock, Shield, Menu, X, Calendar, FileText, LogOut, Bell, Search, AlertTriangle, Crown, Edit3, Save, GitBranch, XCircle, Smartphone, Monitor, Upload, Download, Plus, RefreshCcw, RefreshCw, HardDrive, Video, Copy } from 'lucide-react';\r\nimport { updateSinglePlan } from '../utils/contentService';\r\nimport { getBrandingConfig, uploadLogoAndSave, setBrandingConfig } from '../utils/brandingService';\r\nimport ProfileIcon from '../components/ProfileIcon';\r\nimport NotificationBell from '../components/NotificationBell';\r\nimport { activateUserSubscription, deactivateUserSubscription, getPlanDisplayName, SubscriptionPlan } from '../utils/subscriptionService';\r\nimport { branchActivationService } from '../utils/branchActivationService';\r\nimport { generateSubscriptionNotifications } from '../utils/notificationService';\r\nimport { deleteDoc, doc, query, collection, where, getDocs, getDoc, setDoc, orderBy, updateDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { httpsCallable } from 'firebase/functions';\r\nimport { functions, db } from '../firebase';\r\nimport WhatsAppManagement from '../components/WhatsAppManagement';\r\nimport NotificationCenter from '../components/NotificationCenter';\r\nimport NotificationAlert from '../components/NotificationAlert';\r\nimport UserCard from '../components/UserCard';\r\nimport ActivationModal from '../components/ActivationModal';\r\n//       \r\nimport { publishBroadcast } from '../utils/broadcastService';\r\nimport { createWhatsAppLink, validatePhoneNumber } from '../utils/whatsappService';\r\nimport { resolveDownloadUrl, publishDesktopVersion, setDesktopUpdateInfo, listenDesktopUpdates, setAndroidUpdateInfo, listenAndroidUpdates, publishAndroidVersion } from '@/utils/appDownloadService';\r\nimport { ResellerAdmin } from '@/components/ResellerAdmin';\r\n\r\nconst UserBranchesList = ({ userId, adminId }: { userId: string, adminId: string }) => {\r\n  const [branches, setBranches] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [activatingBranch, setActivatingBranch] = useState<string | null>(null);\r\n  const [processing, setProcessing] = useState<string | null>(null);\r\n\r\n  const fetchBranches = async () => {\r\n    try {\r\n      setLoading(true);\r\n      let subBranches: any[] = [];\r\n      let rootBranches: any[] = [];\r\n\r\n      // 1. Fetch from subcollection (Standard)\r\n      try {\r\n          const q = query(collection(db, 'users', userId, 'branches'));\r\n          const snap = await getDocs(q);\r\n          subBranches = snap.docs.map(d => ({ id: d.id, ...d.data(), source: 'sub' }));\r\n      } catch (e) {\r\n          console.warn('Subcollection fetch warning:', e);\r\n      }\r\n\r\n      // 2. Fetch from root collection (Legacy/Backup)\r\n      try {\r\n          const qRoot = query(collection(db, 'branches'), where('ownerId', '==', userId));\r\n          const snapRoot = await getDocs(qRoot);\r\n          rootBranches = snapRoot.docs.map(d => ({ id: d.id, ...d.data(), source: 'root' }));\r\n      } catch (e) {\r\n          console.warn('Root collection fetch warning:', e);\r\n      }\r\n\r\n      // 3. Merge and Deduplicate\r\n      const allBranches = [...subBranches, ...rootBranches];\r\n      const uniqueBranchesMap = new Map();\r\n      \r\n      // We need to fetch current subscription status for each branch user\r\n      // This is N+1, but usually branches per user are few (1-5)\r\n      const enrichedBranches = await Promise.all(allBranches.map(async (b) => {\r\n          const bUserId = b.branchUserId || b.id; // Usually branchUserId is the user ID\r\n          if (bUserId) {\r\n              try {\r\n                  const uDoc = await getDoc(doc(db, 'users', bUserId));\r\n                  if (uDoc.exists()) {\r\n                      return { ...b, userData: uDoc.data(), realUserId: bUserId };\r\n                  }\r\n              } catch (e) {}\r\n          }\r\n          return { ...b, realUserId: bUserId };\r\n      }));\r\n\r\n      enrichedBranches.forEach(item => {\r\n           const key = item.realUserId || item.id;\r\n           if (!uniqueBranchesMap.has(key)) {\r\n               uniqueBranchesMap.set(key, item);\r\n           } else {\r\n               const existing = uniqueBranchesMap.get(key);\r\n               if (item.source === 'sub' || (!existing.loginUsername && item.loginUsername)) {\r\n                   uniqueBranchesMap.set(key, item);\r\n               }\r\n           }\r\n      });\r\n      \r\n      const uniqueBranches = Array.from(uniqueBranchesMap.values());\r\n      setBranches(uniqueBranches);\r\n\r\n    } catch (e) {\r\n      console.error('Error fetching branches:', e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (userId) fetchBranches();\r\n  }, [userId]);\r\n\r\n  const handleActivateBranch = async (branch: any, planType: SubscriptionPlan) => {\r\n      if (!branch.realUserId) return;\r\n      setProcessing(branch.realUserId);\r\n      try {\r\n          await activateUserSubscription(branch.realUserId, planType, adminId);\r\n          await fetchBranches();\r\n          alert(`   ${getPlanDisplayName(planType)}  `);\r\n      } catch (e) {\r\n          console.error(e);\r\n          alert('     ');\r\n      } finally {\r\n          setProcessing(null);\r\n          setActivatingBranch(null);\r\n      }\r\n  };\r\n\r\n  const handleDeactivateBranch = async (branch: any) => {\r\n      if (!branch.realUserId) return;\r\n      if (!window.confirm('          .')) return;\r\n      \r\n      setProcessing(branch.realUserId);\r\n      try {\r\n          await deactivateUserSubscription(branch.realUserId);\r\n          await fetchBranches();\r\n          alert('    ');\r\n      } catch (e) {\r\n          console.error(e);\r\n          alert('    ');\r\n      } finally {\r\n          setProcessing(null);\r\n      }\r\n  };\r\n\r\n  if (loading) return <div className=\"mt-2 text-xs text-gray-400\">  ...</div>;\r\n  \r\n  if (branches.length === 0) {\r\n      return <div className=\"mt-2 text-xs text-red-400 bg-red-50 p-2 rounded\">     </div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"mt-3 pt-2 border-t border-gray-100\">\r\n      <p className=\"text-xs font-semibold text-gray-600 mb-2\">  ({branches.length}):</p>\r\n      <div className=\"space-y-2\">\r\n        {branches.map((b, idx) => {\r\n          const isActive = b.userData?.subscription?.isActive || false;\r\n          const plan = b.userData?.subscription?.planType;\r\n\r\n          return (\r\n            <div key={idx} className=\"bg-gray-50 p-2 rounded text-xs flex justify-between items-center flex-wrap gap-2\">\r\n               <div>\r\n                 <span className=\"font-medium text-gray-800 block\">{b.branchName || ' '}</span>\r\n                 <span className=\"text-gray-500 font-mono select-all block\">{b.loginUsername || b.email || '  '}</span>\r\n                 {isActive && <span className=\"text-green-600 text-[10px] font-bold\">: {getPlanDisplayName(plan)}</span>}\r\n               </div>\r\n               \r\n               <div className=\"flex items-center gap-2\">\r\n                   {b.managerName && <span className=\"text-gray-400 hidden sm:inline\">{b.managerName}</span>}\r\n                   \r\n                   {processing === b.realUserId ? (\r\n                       <span className=\"text-gray-400 text-[10px]\"> ...</span>\r\n                   ) : (\r\n                       <>\r\n                           {isActive ? (\r\n                               <button \r\n                                   onClick={() => handleDeactivateBranch(b)}\r\n                                   className=\"bg-red-100 text-red-600 px-2 py-1 rounded hover:bg-red-200 transition-colors\"\r\n                               >\r\n                                   \r\n                               </button>\r\n                           ) : (\r\n                               <div className=\"relative\">\r\n                                   <button \r\n                                       onClick={() => setActivatingBranch(activatingBranch === b.realUserId ? null : b.realUserId)}\r\n                                       className=\"bg-green-100 text-green-600 px-2 py-1 rounded hover:bg-green-200 transition-colors\"\r\n                                   >\r\n                                       \r\n                                   </button>\r\n                                   \r\n                                   {activatingBranch === b.realUserId && (\r\n                                       <div className=\"absolute left-0 mt-1 w-40 bg-white border rounded shadow-lg z-10 p-1 flex flex-col gap-1\">\r\n                                           {[SubscriptionPlan.MONTHLY, SubscriptionPlan.QUARTERLY, SubscriptionPlan.HALF_YEARLY, SubscriptionPlan.YEARLY].map(p => (\r\n                                               <button\r\n                                                   key={p}\r\n                                                   onClick={() => handleActivateBranch(b, p)}\r\n                                                   className=\"text-right px-2 py-1 hover:bg-gray-100 rounded text-gray-700 w-full\"\r\n                                               >\r\n                                                   {getPlanDisplayName(p)}\r\n                                               </button>\r\n                                           ))}\r\n                                       </div>\r\n                                   )}\r\n                               </div>\r\n                           )}\r\n                       </>\r\n                   )}\r\n               </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst CashierRequests = ({ adminId }: { adminId: string }) => {\r\n  const [requests, setRequests] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [activeTab, setActiveTab] = useState<'pending' | 'approved'>('pending');\r\n\r\n  const fetchRequests = async () => {\r\n    setLoading(true);\r\n    try {\r\n      // Fetch all requests and filter client-side or fetch based on activeTab\r\n      // For simplicity and small data size, let's fetch all relevant docs or just query based on status.\r\n      // Since we want to toggle tabs, it's better to fetch based on the active tab or fetch all.\r\n      // Let's fetch based on the active tab status.\r\n      \r\n      const statusFilter = activeTab === 'pending' ? 'pending' : 'approved';\r\n      const q = query(collection(db, 'cashierRequests'), where('status', '==', statusFilter));\r\n      \r\n      const snap = await getDocs(q);\r\n      const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));\r\n      // Sort client-side\r\n      data.sort((a: any, b: any) => {\r\n        const dateA = a.createdAt?.seconds || 0;\r\n        const dateB = b.createdAt?.seconds || 0;\r\n        return dateB - dateA;\r\n      });\r\n      setRequests(data);\r\n    } catch (e) {\r\n      console.error(e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchRequests();\r\n  }, [activeTab]);\r\n\r\n  const handleApprove = async (req: any) => {\r\n    if (!window.confirm(`       ${req.userName}  ${req.requestedCount} `)) return;\r\n    \r\n    try {\r\n      const userRef = doc(db, 'users', req.userId);\r\n      const userSnap = await getDoc(userRef);\r\n      const userData = userSnap.exists() ? userSnap.data() : null;\r\n      \r\n      const now = new Date();\r\n      \r\n      // Calculate existing valid extra cashiers\r\n      const currentEndsAt = userData?.subscription?.extraCashiersEndsAt?.toDate?.() || \r\n                            (userData?.subscription?.extraCashiersEndsAt ? new Date(userData.subscription.extraCashiersEndsAt) : null);\r\n      \r\n      const isCurrentValid = currentEndsAt && currentEndsAt > now;\r\n      const currentExtra = isCurrentValid ? (userData?.subscription?.extraCashiers || 0) : 0;\r\n      \r\n      const newTotal = currentExtra + (Number(req.requestedCount) || 0);\r\n\r\n      // Calculate expiry for the NEW request\r\n      let newRequestEndsAt = new Date();\r\n      if (req.planType === 'monthly') newRequestEndsAt.setMonth(now.getMonth() + 1);\r\n      else if (req.planType === 'quarterly') newRequestEndsAt.setMonth(now.getMonth() + 3);\r\n      else if (req.planType === 'half_yearly') newRequestEndsAt.setMonth(now.getMonth() + 6);\r\n      else if (req.planType === 'yearly') newRequestEndsAt.setFullYear(now.getFullYear() + 1);\r\n      else if (req.planType === 'lifetime') newRequestEndsAt.setFullYear(now.getFullYear() + 100);\r\n\r\n      // If current subscription is valid and ends AFTER the new request, keep the longer date\r\n      // Otherwise, extend to the new date.\r\n      const finalEndsAt = (isCurrentValid && currentEndsAt > newRequestEndsAt) ? currentEndsAt : newRequestEndsAt;\r\n\r\n      // Update user subscription\r\n      await updateDoc(userRef, {\r\n        'subscription.extraCashiers': newTotal,\r\n        'subscription.extraCashiersStartsAt': now,\r\n        'subscription.extraCashiersEndsAt': finalEndsAt,\r\n        'subscription.extraCashiersPlan': req.planType\r\n      });\r\n\r\n      // Update request status\r\n      await updateDoc(doc(db, 'cashierRequests', req.id), {\r\n        status: 'approved',\r\n        approvedBy: adminId,\r\n        approvedAt: serverTimestamp(),\r\n        startsAt: now,\r\n        endsAt: finalEndsAt\r\n      });\r\n\r\n      alert('      ');\r\n      fetchRequests();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert('   ');\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (req: any) => {\r\n    if (!window.confirm('         ' + (req.status === 'approved' ? '      .' : '.'))) return;\r\n    \r\n    try {\r\n      if (req.status === 'approved') {\r\n        const userRef = doc(db, 'users', req.userId);\r\n        const userSnap = await getDoc(userRef);\r\n        if (userSnap.exists()) {\r\n          const userData = userSnap.data();\r\n          const currentExtra = userData?.subscription?.extraCashiers || 0;\r\n          const requestedCount = Number(req.requestedCount) || 0;\r\n          const newTotal = Math.max(0, currentExtra - requestedCount);\r\n          await updateDoc(userRef, {\r\n            'subscription.extraCashiers': newTotal\r\n          });\r\n        }\r\n      }\r\n      await deleteDoc(doc(db, 'cashierRequests', req.id));\r\n      alert('   ');\r\n      fetchRequests();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert('   ');\r\n    }\r\n  };\r\n\r\n  const handleReject = async (req: any) => {\r\n    if (!window.confirm('     ')) return;\r\n    try {\r\n      await updateDoc(doc(db, 'cashierRequests', req.id), {\r\n        status: 'rejected',\r\n        rejectedBy: adminId,\r\n        rejectedAt: serverTimestamp()\r\n      });\r\n      fetchRequests();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert('   ');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex gap-4 border-b border-gray-200 pb-2\">\r\n        <button\r\n          onClick={() => setActiveTab('pending')}\r\n          className={`px-4 py-2 font-medium text-sm rounded-lg transition-colors ${\r\n            activeTab === 'pending'\r\n              ? 'bg-blue-100 text-blue-700'\r\n              : 'text-gray-500 hover:bg-gray-100'\r\n          }`}\r\n        >\r\n            \r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab('approved')}\r\n          className={`px-4 py-2 font-medium text-sm rounded-lg transition-colors ${\r\n            activeTab === 'approved'\r\n              ? 'bg-green-100 text-green-700'\r\n              : 'text-gray-500 hover:bg-gray-100'\r\n          }`}\r\n        >\r\n           \r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n        <div className=\"p-6 border-b border-gray-200 flex items-center justify-between\">\r\n          <h3 className=\"text-lg font-semibold text-gray-800\">\r\n            {activeTab === 'pending' ? '  ' : ' '}\r\n          </h3>\r\n          <button onClick={fetchRequests} className=\"p-1.5 text-gray-500 hover:bg-gray-100 rounded-full\">\r\n            <RefreshCcw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\r\n          </button>\r\n        </div>\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full divide-y divide-gray-200\">\r\n            <thead className=\"bg-gray-50\">\r\n              <tr>\r\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"></th>\r\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"> </th>\r\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"></th>\r\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"> </th>\r\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"> </th>\r\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"> </th>\r\n                {activeTab === 'pending' && <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"></th>}\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"bg-white divide-y divide-gray-200\">\r\n              {requests.map((req: any) => {\r\n                const now = req.startsAt?.toDate ? req.startsAt.toDate() : new Date();\r\n                const expectedEndsAt = req.endsAt?.toDate ? req.endsAt.toDate() : (() => {\r\n                  const d = new Date();\r\n                  if (req.planType === 'monthly') d.setMonth(d.getMonth() + 1);\r\n                  else if (req.planType === 'quarterly') d.setMonth(d.getMonth() + 3);\r\n                  else if (req.planType === 'half_yearly') d.setMonth(d.getMonth() + 6);\r\n                  else if (req.planType === 'yearly') d.setFullYear(d.getFullYear() + 1);\r\n                  else if (req.planType === 'lifetime') d.setFullYear(d.getFullYear() + 100);\r\n                  return d;\r\n                })();\r\n\r\n                return (\r\n                <tr key={req.id}>\r\n                  <td className=\"px-4 py-3\">\r\n                    <div className=\"text-sm font-medium text-gray-900\">{req.userName}</div>\r\n                    <div className=\"text-xs text-gray-500\">{req.userEmail}</div>\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-sm text-gray-900\">{req.requestedCount}</td>\r\n                  <td className=\"px-4 py-3 text-sm text-gray-900\">{getPlanDisplayName(req.planType)}</td>\r\n                  <td className=\"px-4 py-3 text-sm text-gray-500\">\r\n                    {now.toLocaleDateString('ar-EG')}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-sm text-gray-500\">\r\n                    {expectedEndsAt.toLocaleDateString('ar-EG')}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-sm text-gray-500\">\r\n                    {req.createdAt?.toDate ? req.createdAt.toDate().toLocaleString('ar-EG') : ''}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 flex gap-2\">\r\n                    {activeTab === 'pending' && (\r\n                      <>\r\n                        <button \r\n                          onClick={() => handleApprove(req)}\r\n                          className=\"bg-green-100 text-green-700 px-3 py-1 rounded text-xs font-medium hover:bg-green-200\"\r\n                        >\r\n                          \r\n                        </button>\r\n                        <button \r\n                          onClick={() => handleReject(req)}\r\n                          className=\"bg-red-100 text-red-700 px-3 py-1 rounded text-xs font-medium hover:bg-red-200\"\r\n                        >\r\n                          \r\n                        </button>\r\n                      </>\r\n                    )}\r\n                    <button \r\n                      onClick={() => handleDelete(req)}\r\n                      className=\"bg-gray-100 text-gray-700 px-3 py-1 rounded text-xs font-medium hover:bg-gray-200\"\r\n                    >\r\n                      \r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n              {requests.length === 0 && (\r\n                <tr>\r\n                  <td colSpan={7} className=\"px-4 py-8 text-center text-gray-500\">   {activeTab === 'pending' ? '' : ''}</td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst SimCardRequests = ({ adminId }: { adminId: string }) => {\r\n  const [requests, setRequests] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [activeTab, setActiveTab] = useState<'pending' | 'approved'>('pending');\r\n\r\n  const fetchRequests = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const statusFilter = activeTab === 'pending' ? 'pending' : 'approved';\r\n      const q = query(collection(db, 'simCardRequests'), where('status', '==', statusFilter));\r\n      \r\n      const snap = await getDocs(q);\r\n      const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));\r\n      data.sort((a: any, b: any) => {\r\n        const dateA = a.createdAt?.seconds || 0;\r\n        const dateB = b.createdAt?.seconds || 0;\r\n        return dateB - dateA;\r\n      });\r\n      setRequests(data);\r\n    } catch (e) {\r\n      console.error(e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchRequests();\r\n  }, [activeTab]);\r\n\r\n  const handleApprove = async (req: any) => {\r\n    if (!window.confirm(`       ${req.email}  ${req.plan}`)) return;\r\n    \r\n    try {\r\n      const userRef = doc(db, 'users', req.userId);\r\n      const now = new Date();\r\n      \r\n      let endsAt = new Date();\r\n      if (req.plan === 'monthly') endsAt.setMonth(now.getMonth() + 1);\r\n      else if (req.plan === 'quarterly') endsAt.setMonth(now.getMonth() + 3);\r\n      else if (req.plan === 'yearly') endsAt.setFullYear(now.getFullYear() + 1);\r\n      else if (req.plan === 'lifetime') endsAt.setFullYear(now.getFullYear() + 100);\r\n\r\n      await updateDoc(userRef, {\r\n        'simSubscription': {\r\n            active: true,\r\n            plan: req.plan,\r\n            startsAt: now,\r\n            endsAt: endsAt\r\n        }\r\n      });\r\n\r\n      await updateDoc(doc(db, 'simCardRequests', req.id), {\r\n        status: 'approved',\r\n        approvedBy: adminId,\r\n        approvedAt: serverTimestamp(),\r\n        startsAt: now,\r\n        endsAt: endsAt\r\n      });\r\n\r\n      alert('      ');\r\n      fetchRequests();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert('   ');\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (req: any) => {\r\n    if (!window.confirm('       ' + (req.status === 'approved' ? '    .' : ''))) return;\r\n    \r\n    try {\r\n      if (req.status === 'approved') {\r\n        const userRef = doc(db, 'users', req.userId);\r\n        await updateDoc(userRef, {\r\n            'simSubscription.active': false\r\n        });\r\n      }\r\n      await deleteDoc(doc(db, 'simCardRequests', req.id));\r\n      alert('      ');\r\n      fetchRequests();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert('   ');\r\n    }\r\n  };\r\n\r\n  const handleReject = async (req: any) => {\r\n    if (!window.confirm('     ')) return;\r\n    try {\r\n      await updateDoc(doc(db, 'simCardRequests', req.id), {\r\n        status: 'rejected',\r\n        rejectedBy: adminId,\r\n        rejectedAt: serverTimestamp()\r\n      });\r\n      fetchRequests();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert('   ');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex gap-4 border-b border-gray-200 pb-2\">\r\n        <button\r\n          onClick={() => setActiveTab('pending')}\r\n          className={`px-4 py-2 font-medium text-sm rounded-lg transition-colors ${\r\n            activeTab === 'pending'\r\n              ? 'bg-blue-100 text-blue-700'\r\n              : 'text-gray-500 hover:bg-gray-100'\r\n          }`}\r\n        >\r\n            \r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab('approved')}\r\n          className={`px-4 py-2 font-medium text-sm rounded-lg transition-colors ${\r\n            activeTab === 'approved'\r\n              ? 'bg-green-100 text-green-700'\r\n              : 'text-gray-500 hover:bg-gray-100'\r\n          }`}\r\n        >\r\n           \r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n        <div className=\"p-6 border-b border-gray-200 flex items-center justify-between\">\r\n          <h3 className=\"text-lg font-semibold text-gray-800\">\r\n            {activeTab === 'pending' ? '   ' : '  '}\r\n          </h3>\r\n          <button onClick={fetchRequests} className=\"p-1.5 text-gray-500 hover:bg-gray-100 rounded-full\">\r\n            <RefreshCcw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\r\n          </button>\r\n        </div>\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full divide-y divide-gray-200\">\r\n            <thead className=\"bg-gray-50\">\r\n              <tr>\r\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"></th>\r\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"></th>\r\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"> </th>\r\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"> </th>\r\n                <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"> </th>\r\n                {activeTab === 'pending' && <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"></th>}\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"bg-white divide-y divide-gray-200\">\r\n              {requests.map((req: any) => {\r\n                const now = req.startsAt?.toDate ? req.startsAt.toDate() : new Date();\r\n                const expectedEndsAt = req.endsAt?.toDate ? req.endsAt.toDate() : (() => {\r\n                  const d = new Date();\r\n                  if (req.plan === 'monthly') d.setMonth(d.getMonth() + 1);\r\n                  else if (req.plan === 'quarterly') d.setMonth(d.getMonth() + 3);\r\n                  else if (req.plan === 'yearly') d.setFullYear(d.getFullYear() + 1);\r\n                  else if (req.plan === 'lifetime') d.setFullYear(d.getFullYear() + 100);\r\n                  return d;\r\n                })();\r\n\r\n                return (\r\n                <tr key={req.id}>\r\n                  <td className=\"px-4 py-3\">\r\n                    <div className=\"text-xs text-gray-500\">{req.email}</div>\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-sm text-gray-900\">{getPlanDisplayName(req.plan)}</td>\r\n                  <td className=\"px-4 py-3 text-sm text-gray-500\">\r\n                    {now.toLocaleDateString('ar-EG')}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-sm text-gray-500\">\r\n                    {expectedEndsAt.toLocaleDateString('ar-EG')}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 text-sm text-gray-500\">\r\n                    {req.createdAt?.toDate ? req.createdAt.toDate().toLocaleString('ar-EG') : ''}\r\n                  </td>\r\n                  <td className=\"px-4 py-3 flex gap-2\">\r\n                    {activeTab === 'pending' && (\r\n                      <>\r\n                        <button \r\n                          onClick={() => handleApprove(req)}\r\n                          className=\"bg-green-100 text-green-700 px-3 py-1 rounded text-xs font-medium hover:bg-green-200\"\r\n                        >\r\n                          \r\n                        </button>\r\n                        <button \r\n                          onClick={() => handleReject(req)}\r\n                          className=\"bg-red-100 text-red-700 px-3 py-1 rounded text-xs font-medium hover:bg-red-200\"\r\n                        >\r\n                          \r\n                        </button>\r\n                      </>\r\n                    )}\r\n                    <button \r\n                      onClick={() => handleDelete(req)}\r\n                      className=\"bg-gray-100 text-gray-700 px-3 py-1 rounded text-xs font-medium hover:bg-gray-200\"\r\n                    >\r\n                      /\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n              {requests.length === 0 && (\r\n                <tr>\r\n                  <td colSpan={6} className=\"px-4 py-8 text-center text-gray-500\">   {activeTab === 'pending' ? '' : ''}</td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst AdminDashboard = ({ \r\n  navigate, \r\n  auth, \r\n  devMode, \r\n  setDevMode, \r\n  error,\r\n  setError, \r\n  authLoading, \r\n  setAuthLoading, \r\n  activeTab, \r\n  setActiveTab, \r\n  setNotificationCenterOpen, \r\n  setNotificationSettings, \r\n  setNotifications, \r\n  notificationCount, \r\n  setNotificationCount, \r\n  users, \r\n  setUsers, \r\n  loading,\r\n  setLoading, \r\n  setEditingPlan, \r\n  isSavingContent, \r\n  setIsSavingContent, \r\n  lastUpdateInfo, \r\n  loadContentFromFirebase, \r\n  saveContentToFirebase,\r\n  refreshData\r\n}) => {\r\n  // State variables\r\n  const [sidebarOpen, setSidebarOpen] = useState(true);\r\n  const [filteredUsers, setFilteredUsers] = useState<any[]>(users || []);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [editingPlan, setEditingPlanState] = useState(null);\r\n  const [contentData, setContentData] = useState<any>({});\r\n  const [editModalOpen, setEditModalOpen] = useState(false);\r\n  const [editModalPlanType, setEditModalPlanType] = useState<string | null>(null);\r\n  const [editDraft, setEditDraft] = useState<any>({ name: '', price: '', period: '', description: '', features: [] });\r\n  const [isNewPlan, setIsNewPlan] = useState(false);\r\n  const [autoUpdateEnabled, setAutoUpdateEnabled] = useState(false);\r\n  const [lastAutoUpdate, setLastAutoUpdate] = useState(null);\r\n  const [isManualUpdating, setIsManualUpdating] = useState(false);\r\n  const [notificationSettings, setNotificationSettingsState] = useState({ sound: true });\r\n  const [notificationCenterOpen, setNotificationCenterOpenState] = useState(false);\r\n  const [currentAlert, setCurrentAlert] = useState(null);\r\n  // Waiting list state\r\n  const [waitingItems, setWaitingItems] = useState<any[]>([]);\r\n  const [waitingLoading, setWaitingLoading] = useState<boolean>(false);\r\n  // Branding (logo) state\r\n  const [brandingLogoUrl, setBrandingLogoUrl] = useState<string | undefined>(undefined);\r\n  const [brandingExternalUrl, setBrandingExternalUrl] = useState<string>('');\r\n  const [brandingFile, setBrandingFile] = useState<File | null>(null);\r\n  const [brandingUploading, setBrandingUploading] = useState(false);\r\n  const pendingWaitingItems = waitingItems.filter((i: any) => !(i?.contacted === true || i?.status === 'contacted'));\r\n  const contactedWaitingItems = waitingItems.filter((i: any) => (i?.contacted === true || i?.status === 'contacted'));\r\n\r\n  const [updateVersionCode, setUpdateVersionCode] = useState<string>('');\r\n  const [updateTitleInput, setUpdateTitleInput] = useState<string>('');\r\n  const [updateMessageInput, setUpdateMessageInput] = useState<string>('');\r\n  const [updateApkUrlInput, setUpdateApkUrlInput] = useState<string>('');\r\n  const [updateForce, setUpdateForce] = useState<boolean>(false);\r\n  const [loadingUpdateSettings, setLoadingUpdateSettings] = useState(false);\r\n\r\n  const markWaitingItemContacted = async (itemId: string) => {\r\n    try {\r\n      await updateDoc(doc(db, 'waiting_list', itemId), {\r\n        contacted: true,\r\n        status: 'contacted',\r\n        contactedAt: serverTimestamp(),\r\n      });\r\n    } catch (e) {\r\n      console.error('Failed to mark waiting item as contacted', e);\r\n      alert('       .');\r\n    }\r\n  };\r\n\r\n  // Application downloads state\r\n  const [appDownloads, setAppDownloads] = useState<any>({});\r\n  const [androidFile, setAndroidFile] = useState<File | null>(null);\r\n  const [pcFile, setPcFile] = useState<File | null>(null);\r\n  const [pc32File, setPc32File] = useState<File | null>(null);\r\n  const [uploadingAndroid, setUploadingAndroid] = useState(false);\r\n  const [uploadingPc, setUploadingPc] = useState(false);\r\n  const [uploadingPc32, setUploadingPc32] = useState(false);\r\n  const [androidVersion, setAndroidVersion] = useState('');\r\n  const [pcVersion, setPcVersion] = useState('');\r\n  const [pc32Version, setPc32Version] = useState('');\r\n  const [androidProgress, setAndroidProgress] = useState<number>(0);\r\n  const [pcProgress, setPcProgress] = useState<number>(0);\r\n  const [pc32Progress, setPc32Progress] = useState<number>(0);\r\n  //     \r\n  const [androidUrlInput, setAndroidUrlInput] = useState('');\r\n  const [pcUrlInput, setPcUrlInput] = useState('');\r\n  const [pc32UrlInput, setPc32UrlInput] = useState('');\r\n  const [desktopVersionInput, setDesktopVersionInput] = useState('');\r\n  const [desktopUrl64Input, setDesktopUrl64Input] = useState('');\r\n  const [desktopUrl32Input, setDesktopUrl32Input] = useState('');\r\n  const [desktopNotesInput, setDesktopNotesInput] = useState('');\r\n  const [telegramWorkerUrlInput, setTelegramWorkerUrlInput] = useState('');\r\n  const [savingWorkerUrl, setSavingWorkerUrl] = useState(false);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const { systemSettingsService } = await import('@/integrations/firebase/services');\r\n        const url = await systemSettingsService.getTelegramWorkerUrl();\r\n        if (url) setTelegramWorkerUrlInput(url);\r\n      } catch {}\r\n    })();\r\n  }, []);\r\n  const [desktopForceInput, setDesktopForceInput] = useState(false);\r\n  const [desktopPublishStatus, setDesktopPublishStatus] = useState<'idle'|'publishing'|'done'|'error'>('idle');\r\n  const [desktopPublishError, setDesktopPublishError] = useState<string>('');\r\n  const [androidNotesInput, setAndroidNotesInput] = useState('');\r\n  const [androidForceInput, setAndroidForceInput] = useState(false);\r\n  const [androidPublishStatus, setAndroidPublishStatus] = useState<'idle'|'publishing'|'done'|'error'>('idle');\r\n  const [androidPublishError, setAndroidPublishError] = useState<string>('');\r\n  const [reactivationModalOpen, setReactivationModalOpen] = useState(false);\r\n  const [selectedUserForReactivation, setSelectedUserForReactivation] = useState<any>(null);\r\n  const [selectedPlanForReactivation, setSelectedPlanForReactivation] = useState<SubscriptionPlan | 'custom'>('monthly');\r\n  \r\n  // Activation Modal State\r\n  const [activationModalOpen, setActivationModalOpen] = useState(false);\r\n  const [selectedUserForActivation, setSelectedUserForActivation] = useState<any>(null);\r\n  const [selectedPlanForActivation, setSelectedPlanForActivation] = useState<SubscriptionPlan>(SubscriptionPlan.MONTHLY);\r\n\r\n  // Cancellation Modal State\r\n  const [cancelSubscriptionModalOpen, setCancelSubscriptionModalOpen] = useState(false);\r\n  const [userToCancel, setUserToCancel] = useState<any>(null);\r\n\r\n  const [subscriptionSearch, setSubscriptionSearch] = useState('');\r\n  const [branchCodes, setBranchCodes] = useState<any[]>([]);\r\n  const [generatingCode, setGeneratingCode] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const unsub = listenDesktopUpdates((d) => {\r\n      setDesktopVersionInput(String(d?.version || ''));\r\n      setDesktopUrl64Input(String(d?.downloadURL_64 || ''));\r\n      setDesktopUrl32Input(String(d?.downloadURL_32 || ''));\r\n      setDesktopNotesInput(String(d?.notes || ''));\r\n    });\r\n    return () => { try { unsub(); } catch {} };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const unsub = listenAndroidUpdates((d) => {\r\n      setAndroidVersion(String(d?.version || ''));\r\n      setAndroidUrlInput(String(d?.url || ''));\r\n      setAndroidNotesInput(String(d?.notes || ''));\r\n      setAndroidForceInput(!!d?.force);\r\n    });\r\n    return () => { try { unsub(); } catch {} };\r\n  }, []);\r\n\r\n  const handlePublishDesktopVersion = async () => {\r\n    setDesktopPublishError('');\r\n    if (!auth?.currentUser) {\r\n      setDesktopPublishStatus('error');\r\n      setDesktopPublishError('     ');\r\n      try { alert('     '); } catch {}\r\n      return;\r\n    }\r\n    //     \r\n    const v = desktopVersionInput.trim();\r\n    const u64 = desktopUrl64Input.trim();\r\n    const u32 = desktopUrl32Input.trim();\r\n    if (!v) {\r\n      setDesktopPublishStatus('error');\r\n      setDesktopPublishError('  ');\r\n      return;\r\n    }\r\n    try { new URL(u64); } catch { setDesktopPublishStatus('error'); setDesktopPublishError(' 64-   (   https://)'); return; }\r\n    try { new URL(u32); } catch { setDesktopPublishStatus('error'); setDesktopPublishError(' 32-   (   https://)'); return; }\r\n    try {\r\n      setDesktopPublishStatus('publishing');\r\n      const isElectronEnv = typeof window !== 'undefined' && ((window as any).electronAPI || (typeof navigator !== 'undefined' && navigator.userAgent.toLowerCase().includes('electron')));\r\n      let url = '';\r\n      await setDesktopUpdateInfo({ version: v, downloadURL_64: u64, downloadURL_32: u32, notes: desktopNotesInput.trim() }, auth.currentUser.uid);\r\n      if (isElectronEnv && (window as any).electronAPI?.publishDesktopVersion) {\r\n        const token = await auth.currentUser.getIdToken();\r\n        const payload = { version: v, updateUrl64: u64, updateUrli32: u32, notes: desktopNotesInput.trim(), force: !!desktopForceInput };\r\n        url = await (window as any).electronAPI.publishDesktopVersion(token, payload);\r\n      } else {\r\n        url = '';\r\n      }\r\n      setDesktopPublishStatus('done');\r\n      try {\r\n        localStorage.setItem('desktop_update_cache', JSON.stringify({ version: v, downloadURL_64: u64, downloadURL_32: u32, notes: desktopNotesInput.trim() }));\r\n      } catch {}\r\n    } catch (e) {\r\n      setDesktopPublishStatus('error');\r\n      const msg = (e as any)?.message || ' :     ';\r\n      setDesktopPublishError(msg);\r\n      try { alert(msg); } catch {}\r\n    }\r\n  };\r\n\r\n  // Helper: safely extract first letter from displayName or email\r\n  const getUserInitial = (u: any) => {\r\n    const dn = u?.displayName;\r\n    let base = '';\r\n    if (typeof dn === 'string') {\r\n      base = dn;\r\n    } else if (dn && typeof dn === 'object') {\r\n      base = (dn.ar || dn.en || '').toString();\r\n    }\r\n    if (!base && typeof u?.email === 'string') {\r\n      base = u.email;\r\n    }\r\n    const first = String(base).trim().charAt(0);\r\n    return first ? first.toUpperCase() : '';\r\n  };\r\n\r\n  // Helper: safely get display name as string\r\n  const getUserDisplayName = (u: any) => {\r\n    const dn = u?.displayName;\r\n    if (typeof dn === 'string' && dn.trim()) return dn.trim();\r\n    if (dn && typeof dn === 'object') {\r\n      const objVal = dn.full_name || dn.name || dn.ar || dn.en;\r\n      if (typeof objVal === 'string' && objVal.trim()) return objVal.trim();\r\n    }\r\n    // fallback to email local-part\r\n    if (typeof u?.email === 'string' && u.email.includes('@')) {\r\n      return u.email.split('@')[0];\r\n    }\r\n    return ' ';\r\n  };\r\n\r\n  // Broadcast form state\r\n  const [broadcastTitle, setBroadcastTitle] = useState('');\r\n  const [broadcastMessage, setBroadcastMessage] = useState('');\r\n  const [broadcastLinkUrl, setBroadcastLinkUrl] = useState('');\r\n  const [broadcastActionText, setBroadcastActionText] = useState('');\r\n  const [broadcastTargetUserId, setBroadcastTargetUserId] = useState('');\r\n  const [sendingBroadcast, setSendingBroadcast] = useState(false);\r\n  //    \r\n  const [trialSearch, setTrialSearch] = useState('');\r\n\r\n  //    \r\n  const [trialDurationHours, setTrialDurationHours] = useState<number>(24);\r\n  const [trialDurationInput, setTrialDurationInput] = useState<string>('24');\r\n  const [isUpdatingTrialDuration, setIsUpdatingTrialDuration] = useState(false);\r\n  const [loadingTrialDuration, setLoadingTrialDuration] = useState(false);\r\n  const [trialSubTab, setTrialSubTab] = useState<'eligible' | 'active' | 'expired'>('active');\r\n\r\n  // Keep filteredUsers in sync with users when users list updates (e.g. status change)\r\n  useEffect(() => {\r\n    if (searchTerm) {\r\n      const lowerTerm = searchTerm.toLowerCase();\r\n      const filtered = users.filter(user => \r\n        (user.displayName || '').toLowerCase().includes(lowerTerm) ||\r\n        (user.email || '').toLowerCase().includes(lowerTerm) ||\r\n        (user.phone || '').includes(lowerTerm)\r\n      );\r\n      setFilteredUsers(filtered);\r\n    } else {\r\n      // If no search term, always show all users\r\n      // This is critical to prevent \"missing users\" issue\r\n      setFilteredUsers(users);\r\n    }\r\n  }, [users, searchTerm]);\r\n\r\n  useEffect(() => {\r\n    if (activeTab === 'trials') {\r\n      (async () => {\r\n        try {\r\n          setLoadingTrialDuration(true);\r\n          const { FreeTrialService } = await import('../utils/freeTrialService');\r\n          const hours = await FreeTrialService.getTrialDurationHours();\r\n          setTrialDurationHours(hours);\r\n          setTrialDurationInput(String(hours));\r\n        } catch (e) {\r\n          console.error('Failed to load trial duration', e);\r\n        } finally {\r\n          setLoadingTrialDuration(false);\r\n        }\r\n      })();\r\n    }\r\n  }, [activeTab]);\r\n\r\n  useEffect(() => {\r\n    if (activeTab === 'application') {\r\n      (async () => {\r\n        try {\r\n          const { getAppDownloads } = await import('../utils/appDownloadService');\r\n          const data = await getAppDownloads();\r\n          setAppDownloads(data || {});\r\n          setAndroidUrlInput(data?.androidUrl || '');\r\n          setPcUrlInput(data?.pcUrl || '');\r\n          setPc32UrlInput(data?.pc32Url || '');\r\n        } catch (e) {\r\n          console.error('Failed to load app downloads', e);\r\n        }\r\n      })();\r\n    }\r\n  }, [activeTab]);\r\n\r\n  const fetchWaitingList = async () => {\r\n    setWaitingLoading(true);\r\n    try {\r\n      const q = query(collection(db, 'waiting_list'));\r\n      const snapshot = await getDocs(q);\r\n      const items = snapshot.docs\r\n        .map((d) => ({ id: d.id, ...d.data() }))\r\n        .sort((a: any, b: any) => {\r\n          const ta = a?.createdAt?.toMillis?.() ?? a?.createdAt?.seconds * 1000 ?? 0;\r\n          const tb = b?.createdAt?.toMillis?.() ?? b?.createdAt?.seconds * 1000 ?? 0;\r\n          return tb - ta; // \r\n        });\r\n      setWaitingItems(items);\r\n    } catch (e) {\r\n      console.error('Failed to fetch waiting_list:', e);\r\n    } finally {\r\n      setWaitingLoading(false);\r\n    }\r\n  };\r\n\r\n  // Subscribe to waiting list when the tab is active\r\n  useEffect(() => {\r\n    if (activeTab === 'waitingList') {\r\n      fetchWaitingList();\r\n    }\r\n    if (activeTab === 'branches') {\r\n      loadBranchCodes();\r\n    }\r\n  }, [activeTab]);\r\n\r\n  const loadBranchCodes = async () => {\r\n    try {\r\n      const codes = await branchActivationService.getAllCodes();\r\n      setBranchCodes(codes);\r\n    } catch (error) {\r\n      console.error('Error loading branch codes:', error);\r\n    }\r\n  };\r\n\r\n  const handleGenerateBranchCode = async () => {\r\n    if (!auth.currentUser) return;\r\n    setGeneratingCode(true);\r\n    try {\r\n      await branchActivationService.generateCode(auth.currentUser.uid);\r\n      await loadBranchCodes();\r\n      alert('     ');\r\n    } catch (error) {\r\n      console.error('Error generating code:', error);\r\n      alert('    ');\r\n    } finally {\r\n      setGeneratingCode(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {}, [activeTab]);\r\n\r\n  const handleSendBroadcast = async () => {\r\n    if (!broadcastTitle.trim() || !broadcastMessage.trim()) {\r\n      alert('    ');\r\n      return;\r\n    }\r\n    try {\r\n      setSendingBroadcast(true);\r\n      const audienceKey = broadcastTargetUserId.trim()\r\n        ? `user:${broadcastTargetUserId.trim()}`\r\n        : 'global';\r\n      await publishBroadcast({\r\n        title: broadcastTitle.trim(),\r\n        message: broadcastMessage.trim(),\r\n        audienceKey,\r\n        createdBy: auth?.currentUser?.uid,\r\n        linkUrl: broadcastLinkUrl.trim() || undefined,\r\n        actionText: broadcastActionText.trim() || undefined,\r\n      });\r\n      setBroadcastTitle('');\r\n      setBroadcastMessage('');\r\n      setBroadcastLinkUrl('');\r\n      setBroadcastActionText('');\r\n      setBroadcastTargetUserId('');\r\n      alert('   !');\r\n    } catch (e) {\r\n      console.error('   :', e);\r\n      alert('    ');\r\n    } finally {\r\n      setSendingBroadcast(false);\r\n    }\r\n  };\r\n\r\n  // Effect to filter users based on search term\r\n  // Removed duplicate useEffect to prevent race conditions\r\n\r\n\r\n  // Functions\r\n  const handleLogout = () => {\r\n    if (auth?.signOut) {\r\n      auth.signOut();\r\n    }\r\n    navigate('/admin/login');\r\n  };\r\n\r\n  const GuidePublisher: React.FC = () => {\r\n    const [url, setUrl] = useState('');\r\n    const [title, setTitle] = useState(' ');\r\n    const [publishing, setPublishing] = useState(false);\r\n    const [current, setCurrent] = useState<any>(null);\r\n\r\n    useEffect(() => {\r\n      (async () => {\r\n        try {\r\n          const snap = await getDoc(doc(db, 'app_guides', 'latest'));\r\n          setCurrent(snap.exists() ? snap.data() : null);\r\n        } catch (e) {\r\n          console.error('Failed to fetch guide:', e);\r\n        }\r\n      })();\r\n    }, []);\r\n\r\n    const publish = async () => {\r\n      try {\r\n        setPublishing(true);\r\n        const u = url.trim();\r\n        try { new URL(u); } catch { alert('      https '); setPublishing(false); return; }\r\n        await setDoc(doc(db, 'app_guides', 'latest'), {\r\n          url: u,\r\n          title: title.trim() || ' ',\r\n          publishedAt: serverTimestamp(),\r\n        }, { merge: true });\r\n        alert('    ');\r\n      } catch (e) {\r\n        console.error('Failed to publish guide:', e);\r\n        alert('   ');\r\n      } finally {\r\n        setPublishing(false);\r\n      }\r\n    };\r\n\r\n    return (\r\n      <div className=\"space-y-3\">\r\n        {current && (\r\n          <div className=\"p-3 bg-gray-50 border border-gray-200 rounded\">\r\n            <div className=\"text-sm text-gray-700\"> :</div>\r\n            <a href={current.url} target=\"_blank\" rel=\"noreferrer\" className=\"text-blue-600 text-sm hover:underline break-all\">{current.url}</a>\r\n          </div>\r\n        )}\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n          <div>\r\n            <label className=\"text-sm text-gray-700\"> </label>\r\n            <input value={title} onChange={(e) => setTitle(e.target.value)} className=\"mt-1 w-full border rounded px-3 py-2\" placeholder=\":  Cashy Link\" />\r\n          </div>\r\n          <div className=\"sm:col-span-2\">\r\n            <label className=\"text-sm text-gray-700\"> </label>\r\n            <input value={url} onChange={(e) => setUrl(e.target.value)} className=\"mt-1 w-full border rounded px-3 py-2\" placeholder=\"https://www.youtube.com/watch?v=...  https://youtu.be/...\" />\r\n          </div>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <button onClick={publish} disabled={publishing} className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50\">\r\n            {publishing ? ' ...' : ' '}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const handleNotificationCenterToggle = () => {\r\n    setNotificationCenterOpenState(prev => !prev);\r\n  };\r\n\r\n  const handleRequestActivation = React.useCallback((user: any) => {\r\n    setSelectedUserForActivation(user);\r\n    setSelectedPlanForActivation(SubscriptionPlan.MONTHLY);\r\n    setActivationModalOpen(true);\r\n  }, []);\r\n\r\n  // Missing function definitions\r\n  const handleActivateSubscription = React.useCallback(async (userId, planType, variant = null, customStartDate = null, customEndDate = null) => {\r\n    try {\r\n      console.log('Activating subscription for user:', userId, 'with plan:', planType, 'variant:', variant, 'dates:', { customStartDate, customEndDate });\r\n      \r\n      //     \r\n      const adminId = auth?.currentUser?.uid || 'admin-user-id';\r\n      \r\n      //     \r\n      await activateUserSubscription(userId, planType, adminId, variant, customStartDate, customEndDate);\r\n      \r\n      console.log('    ');\r\n      \r\n      //      listener\r\n      if (refreshData) {\r\n        refreshData(true);\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error('    :', error);\r\n      //     \r\n      alert('    .    .');\r\n    }\r\n  }, [auth]);\r\n\r\n  const handleReactivateSubscription = async () => {\r\n    if (!selectedUserForReactivation) {\r\n      alert('   ');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const adminId = auth?.currentUser?.uid || 'admin';\r\n      \r\n      console.log('Reactivating user:', selectedUserForReactivation.id, 'Plan:', selectedPlanForReactivation);\r\n\r\n      await activateUserSubscription(\r\n        selectedUserForReactivation.id, \r\n        selectedPlanForReactivation as SubscriptionPlan, \r\n        adminId\r\n      );\r\n      \r\n      alert('    ');\r\n      \r\n      //    \r\n      setReactivationModalOpen(false);\r\n      setSelectedUserForReactivation(null);\r\n      setSelectedPlanForReactivation('monthly');\r\n      \r\n      //     \r\n      setShowCancelledSubscriptions(false);\r\n\r\n    } catch (error) {\r\n      console.error('     :', error);\r\n      alert('     .    .');\r\n    }\r\n  };\r\n\r\n  const handleDeactivateSubscription = async (userId) => {\r\n    try {\r\n      console.log('Deactivating subscription for user:', userId);\r\n      \r\n      //      \r\n      await deactivateUserSubscription(userId);\r\n      \r\n      console.log('     ');\r\n      \r\n      //   \r\n      if (refreshData) {\r\n        refreshData(true);\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error('     :', error);\r\n      alert('     .    .');\r\n    }\r\n  };\r\n\r\n  const handleDeleteUser = async (userId) => {\r\n    try {\r\n      //   \r\n      const confirmDelete = window.confirm(\r\n        '       \\n\\n :\\n-  \\n-  \\n- \\n- \\n- \\n\\n     !'\r\n      );\r\n      \r\n      if (!confirmDelete) {\r\n        return;\r\n      }\r\n\r\n      console.log('  :', userId);\r\n      //      \r\n      const adminId = auth?.currentUser?.uid || 'unknown-admin';\r\n\r\n      //     Cloud Functions (   )\r\n      try {\r\n        const deleteFn = httpsCallable(functions, 'deleteUserPermanently');\r\n        const result: any = await deleteFn({ userId });\r\n        console.log('   :', result);\r\n\r\n        //      \r\n        setUsers(prevUsers => prevUsers.filter(user => user.id !== userId));\r\n        setFilteredUsers(prevUsers => prevUsers.filter(user => user.id !== userId));\r\n\r\n        alert('        .');\r\n        return; //      \r\n      } catch (cfErr: any) {\r\n        console.warn('     Cloud Functions     :', cfErr?.message || cfErr);\r\n      }\r\n\r\n      //    (  Firebase Functions)\r\n      // :        Cloud Functions\r\n      \r\n      {\r\n        //        \r\n        const errors: string[] = [];\r\n\r\n        //    \r\n        try {\r\n          await deleteDoc(doc(db, 'profiles', userId));\r\n          console.log('   ');\r\n        } catch (e: any) {\r\n          console.error('    :', e);\r\n          errors.push(` : ${e?.message || e}`);\r\n        }\r\n\r\n        //      users (  )\r\n        try {\r\n          await deleteDoc(doc(db, 'users', userId));\r\n          console.log('      users');\r\n        } catch (e: any) {\r\n          console.error('       users:', e);\r\n          errors.push(`users: ${e?.message || e}`);\r\n        }\r\n\r\n        //    \r\n        try {\r\n          const transactionsQuery = query(\r\n            collection(db, 'transactions'),\r\n            where('userId', '==', userId)\r\n          );\r\n          const transactionsSnapshot = await getDocs(transactionsQuery);\r\n\r\n          const deletePromises = transactionsSnapshot.docs.map(docSnapshot => deleteDoc(docSnapshot.ref));\r\n          const results = await Promise.allSettled(deletePromises);\r\n          const failed = results.filter(r => r.status === 'rejected');\r\n          if (failed.length) {\r\n            console.warn('   :', failed.length);\r\n            errors.push(`:   ${failed.length}   ${results.length}`);\r\n          } else {\r\n            console.log(`  ${transactionsSnapshot.size} `);\r\n          }\r\n        } catch (e: any) {\r\n          console.error('  / :', e);\r\n          errors.push(`: ${e?.message || e}`);\r\n        }\r\n\r\n        //   \r\n        try {\r\n          const chatsQuery = query(\r\n            collection(db, 'chatRooms'),\r\n            where('participants', 'array-contains', userId)\r\n          );\r\n          const chatsSnapshot = await getDocs(chatsQuery);\r\n\r\n          const deleteChatPromises = chatsSnapshot.docs.map(async (chatDoc) => {\r\n            try {\r\n              //   \r\n              const messagesSnapshot = await getDocs(collection(chatDoc.ref, 'messages'));\r\n              const deleteMessagePromises = messagesSnapshot.docs.map(msgDoc => deleteDoc(msgDoc.ref));\r\n              await Promise.allSettled(deleteMessagePromises);\r\n\r\n              //    \r\n              await deleteDoc(chatDoc.ref);\r\n            } catch (err) {\r\n              console.error('  /:', err);\r\n              errors.push(`: ${chatDoc.id}`);\r\n            }\r\n          });\r\n          await Promise.all(deleteChatPromises);\r\n          console.log(`   ${chatsSnapshot.size} `);\r\n        } catch (e: any) {\r\n          console.error('  / :', e);\r\n          errors.push(`: ${e?.message || e}`);\r\n        }\r\n\r\n        //     \r\n        try {\r\n          await setDoc(doc(db, 'deletedUsers', userId), {\r\n            deletedAt: new Date(),\r\n            deletedBy: adminId,\r\n            reason: '    '\r\n          });\r\n        } catch (e: any) {\r\n          console.error('    :', e);\r\n          errors.push(`deletedUsers: ${e?.message || e}`);\r\n        }\r\n\r\n        //     \r\n        setUsers(prevUsers => prevUsers.filter(user => user.id !== userId));\r\n        setFilteredUsers(prevUsers => prevUsers.filter(user => user.id !== userId));\r\n\r\n        if (errors.length === 0) {\r\n          alert('     . :    .');\r\n        } else {\r\n          alert(`    :\\n- ${errors.join('\\n- ')}\\n\\n     .    .`);\r\n        }\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('    :', error);\r\n      alert(`    : ${error.message || '  '}`);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const loadContent = async () => {\r\n      try {\r\n        if (typeof loadContentFromFirebase === 'function') {\r\n          const data = await loadContentFromFirebase();\r\n          if (data && (data.monthly || data.yearly || data.lifetime)) {\r\n            setContentData(data);\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.warn('Failed to load content data:', e);\r\n      }\r\n    };\r\n    loadContent();\r\n  }, []);\r\n\r\n  const saveContentChanges = async () => {\r\n    try {\r\n      if (typeof saveContentToFirebase !== 'function') return;\r\n      setIsSavingContent(true);\r\n      const adminId = auth?.currentUser?.uid || 'admin-user-id';\r\n      await saveContentToFirebase(contentData, adminId);\r\n      alert('    ');\r\n    } catch (error: any) {\r\n      console.error('    :', error);\r\n      alert(`   : ${error?.message || '  '}`);\r\n    } finally {\r\n      setIsSavingContent(false);\r\n    }\r\n  };\r\n\r\n  const handleContentChange = (planType: 'monthly' | 'quarterly' | 'yearly' | 'lifetime', field: string, value: any) => {\r\n    setContentData((prev: any) => ({\r\n      ...prev,\r\n      [planType]: {\r\n        ...(prev?.[planType] || {}),\r\n        [field]: value,\r\n      },\r\n    }));\r\n  };\r\n\r\n  const addFeature = (planType: 'monthly' | 'quarterly' | 'yearly' | 'lifetime') => {\r\n    setContentData((prev: any) => ({\r\n      ...prev,\r\n      [planType]: {\r\n        ...(prev?.[planType] || {}),\r\n        features: [ ...((prev?.[planType]?.features) || []), '' ],\r\n      },\r\n    }));\r\n  };\r\n\r\n  const handleFeatureChange = (planType: 'monthly' | 'quarterly' | 'yearly' | 'lifetime', index: number, value: string) => {\r\n    setContentData((prev: any) => {\r\n      const features = [ ...((prev?.[planType]?.features) || []) ];\r\n      features[index] = value;\r\n      return {\r\n        ...prev,\r\n        [planType]: {\r\n          ...(prev?.[planType] || {}),\r\n          features,\r\n        },\r\n      };\r\n    });\r\n  };\r\n\r\n  const removeFeature = (planType: 'monthly' | 'quarterly' | 'yearly' | 'lifetime', index: number) => {\r\n    setContentData((prev: any) => {\r\n      const features = [ ...((prev?.[planType]?.features) || []) ];\r\n      features.splice(index, 1);\r\n      return {\r\n        ...prev,\r\n        [planType]: {\r\n          ...(prev?.[planType] || {}),\r\n          features,\r\n        },\r\n      };\r\n    });\r\n  };\r\n\r\n  const handleToggleAutoUpdate = () => {\r\n    setAutoUpdateEnabled(prev => !prev);\r\n  };\r\n\r\n  const handleManualUpdate = () => {\r\n    setIsManualUpdating(true);\r\n    setTimeout(() => setIsManualUpdating(false), 2000);\r\n  };\r\n\r\n  const getAutoUpdaterStatus = () => {\r\n    return autoUpdateEnabled ? '' : '';\r\n  };\r\n\r\n  const handleToggleSound = () => {\r\n    setNotificationSettingsState(prev => ({ ...prev, sound: !prev.sound }));\r\n  };\r\n\r\n  const handleCloseAlert = () => {\r\n    setCurrentAlert(null);\r\n  };\r\n\r\n  const handleUpdateTrialDuration = async () => {\r\n    try {\r\n      const hours = Number(trialDurationInput);\r\n      if (isNaN(hours) || hours < 1) {\r\n        alert('    ');\r\n        return;\r\n      }\r\n      setIsUpdatingTrialDuration(true);\r\n      const { FreeTrialService } = await import('../utils/freeTrialService');\r\n      const res = await FreeTrialService.updateTrialDurationHours(hours);\r\n      if (res.success) {\r\n        setTrialDurationHours(hours);\r\n        alert(res.message);\r\n      } else {\r\n        alert(res.message || '   ');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating trial duration:', error);\r\n      alert('     ');\r\n    } finally {\r\n      setIsUpdatingTrialDuration(false);\r\n    }\r\n  };\r\n\r\n  const handleActivateFreeTrial = async (userId) => {\r\n    try {\r\n      const { FreeTrialService } = await import('../utils/freeTrialService');\r\n      const result = await FreeTrialService.startFreeTrialFromAdmin(userId);\r\n      //     (  )\r\n      alert(result.message || `     ${trialDurationHours} ${trialDurationHours >= 3 && trialDurationHours <= 10 ? '' : trialDurationHours === 2 ? '' : ''}`);\r\n      //   \r\n      if (refreshData) {\r\n        refreshData();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error activating free trial:', error);\r\n      alert('     .    .');\r\n    }\r\n  };\r\n\r\n  const handleCancelFreeTrial = async (userId: string) => {\r\n    try {\r\n      const { FreeTrialService } = await import('../utils/freeTrialService');\r\n      const result = await FreeTrialService.cancelActiveFreeTrial(userId);\r\n      //   \r\n      if (refreshData) {\r\n        refreshData(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error cancelling free trial:', error);\r\n    }\r\n  };\r\n\r\n  const handleResetUserTrialEnd = async (userId) => {\r\n    try {\r\n      const { FreeTrialService } = await import('../utils/freeTrialService');\r\n      const res = await FreeTrialService.resetActiveTrialToCurrentDuration(userId);\r\n      alert(res.message);\r\n    } catch (error) {\r\n      console.error('Error resetting user trial end:', error);\r\n      alert('     .');\r\n    }\r\n  };\r\n\r\n  const toggleUserStatus = (userId, newStatus) => {\r\n    // Implementation for toggling user status\r\n    console.log('Toggling user status:', userId, newStatus);\r\n  };\r\n\r\n  const formatDate = (timestamp: any) => {\r\n    if (!timestamp) return ' ';\r\n    const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);\r\n    return date.toLocaleDateString('ar-EG', {\r\n      year: 'numeric',\r\n      month: '2-digit',\r\n      day: '2-digit'\r\n    });\r\n  };\r\n\r\n  const sidebarItems = [\r\n      { id: 'users', label: '', icon: Users },\r\n      { id: 'reseller', label: '', icon: Users },\r\n      { id: 'subscriptions', label: ' ', icon: Calendar },\r\n      { id: 'trials', label: '  ', icon: Gift },\r\n      { id: 'content', label: ' ', icon: FileText },\r\n      { id: 'application', label: '', icon: Smartphone },\r\n      { id: 'whatsapp', label: ' ', icon: MessageCircle },\r\n      { id: 'branches', label: ' ', icon: GitBranch },\r\n      { id: 'cashierRequests', label: ' ', icon: Users },\r\n      { id: 'simCardRequests', label: ' ', icon: Smartphone },\r\n      { id: 'analytics', label: '', icon: Activity },\r\n    ];\r\n\r\n  //      \r\n  if (authLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">   ...</p>\r\n          {import.meta.env.DEV && (\r\n            <div className=\"mt-4\">\r\n              <button\r\n                onClick={() => {\r\n                  localStorage.setItem('admin_dev_mode', 'true');\r\n                  setDevMode(true);\r\n                  setAuthLoading(false);\r\n                }}\r\n                className=\"bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm\"\r\n              >\r\n                    ( )\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  //     \r\n  if (error) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\r\n        <div className=\"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full\">\r\n          <div className=\"text-red-600 mb-4\">\r\n            <svg className=\"w-16 h-16 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\r\n            </svg>\r\n          </div>\r\n          <h2 className=\"text-xl font-bold text-gray-800 mb-4\">    </h2>\r\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6\">\r\n            <p className=\"text-red-700 text-sm font-medium\">{error}</p>\r\n          </div>\r\n          \r\n          <div className=\"space-y-3\">\r\n            <button\r\n              onClick={() => {\r\n                setError(null);\r\n                navigate('/admin/login');\r\n              }}\r\n              className=\"w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors\"\r\n            >\r\n                 \r\n            </button>\r\n            \r\n            {import.meta.env.DEV && (\r\n              <button\r\n                onClick={() => {\r\n                  localStorage.setItem('admin_dev_mode', 'true');\r\n                  setDevMode(true);\r\n                  setError(null);\r\n                  setAuthLoading(false);\r\n                }}\r\n                className=\"w-full bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors\"\r\n              >\r\n                   \r\n              </button>\r\n            )}\r\n            \r\n            <button\r\n              onClick={() => {\r\n                console.log(' Current error details:', error);\r\n                console.log(' Auth state:', auth.currentUser);\r\n                console.log(' Dev mode:', devMode);\r\n                console.log(' Environment:', import.meta.env);\r\n              }}\r\n              className=\"w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm\"\r\n            >\r\n                    \r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  //       \r\n  if (!devMode && !auth.currentUser) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\r\n        <div className=\"text-center bg-white p-8 rounded-lg shadow-lg max-w-md w-full\">\r\n          <h1 className=\"text-2xl font-bold text-gray-800 mb-6\">  </h1>\r\n          <p className=\"text-gray-600 mb-6\">      </p>\r\n          \r\n          <div className=\"space-y-3\">\r\n            <button\r\n              onClick={() => navigate('/admin/login')}\r\n              className=\"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors\"\r\n            >\r\n                \r\n            </button>\r\n            \r\n            {import.meta.env.DEV && (\r\n              <button\r\n                onClick={() => {\r\n                  localStorage.setItem('admin_dev_mode', 'true');\r\n                  setDevMode(true);\r\n                }}\r\n                className=\"w-full bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 transition-colors\"\r\n              >\r\n                   ( )\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 flex flex-col md:flex-row overflow-x-hidden\">\r\n      {/*   */}\r\n      <div\r\n        className={\r\n          `bg-white shadow-lg transition-all duration-300 flex flex-col z-40 ` +\r\n          `${sidebarOpen ? 'translate-x-0 w-64 md:w-64' : 'translate-x-full w-64 md:w-16 md:translate-x-0'} ` +\r\n          `fixed inset-y-0 right-0 md:static md:inset-auto`\r\n        }\r\n      >\r\n        {/*    */}\r\n        <div className=\"p-4 border-b border-gray-200\">\r\n          <div className=\"flex items-center justify-between\">\r\n            {sidebarOpen && (\r\n              <div className=\"flex items-center space-x-3 space-x-reverse\">\r\n                <div className=\"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg flex items-center justify-center\">\r\n                  <Shield className=\"w-6 h-6 text-white\" />\r\n                </div>\r\n                <div>\r\n                  <h2 className=\"text-lg font-bold text-gray-800\"> </h2>\r\n                  <p className=\"text-sm text-gray-500\"> </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n            <button\r\n              onClick={() => setSidebarOpen(!sidebarOpen)}\r\n              className=\"p-2 rounded-lg hover:bg-gray-100 transition-colors\"\r\n            >\r\n              {sidebarOpen ? <X className=\"w-5 h-5\" /> : <Menu className=\"w-5 h-5\" />}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/*   */}\r\n        <nav className=\"flex-1 p-4\">\r\n          <ul className=\"space-y-2\">\r\n            {sidebarItems.map((item) => {\r\n              const Icon = item.icon;\r\n              return (\r\n                <li key={item.id}>\r\n                  <button\r\n                    onClick={() => { if (item.id === 'externalNotifications') { navigate('/admin/notifications'); return; } setActiveTab(item.id); }}\r\n                    className={`w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg transition-colors ${\r\n                      activeTab === item.id\r\n                        ? 'bg-gradient-to-r from-purple-600 to-blue-600 text-white'\r\n                        : 'text-gray-600 hover:bg-gray-100'\r\n                    }`}\r\n                  >\r\n                    <Icon className=\"w-5 h-5\" />\r\n                    {sidebarOpen && <span className=\"font-medium\">{item.label}</span>}\r\n                  </button>\r\n                </li>\r\n              );\r\n            })}\r\n          </ul>\r\n        </nav>\r\n\r\n        {/*    */}\r\n        <div className=\"p-4 border-t border-gray-200\">\r\n          <button\r\n            onClick={handleLogout}\r\n            className=\"w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors\"\r\n          >\r\n            <LogOut className=\"w-5 h-5\" />\r\n            {sidebarOpen && <span className=\"font-medium\"> </span>}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/*      */}\r\n      {sidebarOpen && (\r\n        <div\r\n          className=\"fixed inset-0 bg-black/30 md:hidden\"\r\n          onClick={() => setSidebarOpen(false)}\r\n        />\r\n      )}\r\n\r\n      {/*   */}\r\n      <div className=\"flex-1 flex flex-col\">\r\n        {/*   */}\r\n        <header className=\"bg-white shadow-sm border-b border-gray-200 p-3 sm:p-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4 space-x-reverse\">\r\n              {/*     :  '+'    */}\r\n              {!sidebarOpen && (\r\n                <button\r\n                  className=\"md:hidden p-2 rounded-lg hover:bg-gray-100\"\r\n                  onClick={() => setSidebarOpen(true)}\r\n                  aria-label=\" \"\r\n                >\r\n                  <Plus className=\"w-5 h-5\" />\r\n                </button>\r\n              )}\r\n              <h1 className=\"text-2xl font-bold text-gray-800\">\r\n                {activeTab === 'users' && ' '}\r\n                {activeTab === 'reseller' && ' '}\r\n                {activeTab === 'waitingList' && ' '}\r\n                {activeTab === 'subscriptions' && ' '}\r\n                {activeTab === 'trials' && '  '}\r\n                {activeTab === 'application' && ' '}\r\n                {activeTab === 'analytics' && ''}\r\n                {activeTab === 'branches' && ' '}\r\n                {activeTab === 'cashierRequests' && ' '}\r\n              </h1>\r\n              {devMode && (\r\n                <span className=\"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full\">\r\n                    \r\n                </span>\r\n              )}\r\n            </div>\r\n            <div className=\"flex items-center space-x-4 space-x-reverse\">\r\n              <div className=\"text-sm text-gray-500\">\r\n                 {devMode ? '' : ''}\r\n              </div>\r\n              <ProfileIcon />\r\n            </div>\r\n          </div>\r\n        </header>\r\n\r\n        {/*   */}\r\n        <main className=\"flex-1 p-3 sm:p-4 md:p-6 max-w-full overflow-x-hidden\">\r\n          {activeTab === 'reseller' && <ResellerAdmin />}\r\n          {activeTab === 'cashierRequests' && <CashierRequests adminId={auth?.currentUser?.uid || 'admin'} />}\r\n          {activeTab === 'simCardRequests' && <SimCardRequests adminId={auth?.currentUser?.uid || 'admin'} />}\r\n          {activeTab === 'waitingList' && (\r\n            <div className=\"space-y-6\">\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n                <div className=\"p-6 border-b border-gray-200 flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-800\">  </h3>\r\n                    <button \r\n                      onClick={fetchWaitingList} \r\n                      className=\"p-1.5 text-gray-500 hover:bg-gray-100 rounded-full transition-colors\"\r\n                      title=\" \"\r\n                      disabled={waitingLoading}\r\n                    >\r\n                      <RefreshCw className={`w-4 h-4 ${waitingLoading ? 'animate-spin' : ''}`} />\r\n                    </button>\r\n                  </div>\r\n                  <div className=\"text-sm text-gray-500 flex items-center gap-3\">\r\n                    {waitingLoading ? ' ...' : (\r\n                      <>\r\n                        <span>: {waitingItems.length}</span>\r\n                        <span className=\"text-red-600\"> : {pendingWaitingItems.length}</span>\r\n                        <span className=\"text-green-600\"> : {contactedWaitingItems.length}</span>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                <div className=\"overflow-x-auto\">\r\n                  {waitingLoading ? (\r\n                    <div className=\"p-8 text-center\">\r\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto\"></div>\r\n                      <p className=\"mt-2 text-gray-500\">  ...</p>\r\n                    </div>\r\n                  ) : waitingItems.length === 0 ? (\r\n                    <div className=\"p-8 text-center text-gray-600\">      </div>\r\n                  ) : (\r\n                    <table className=\"min-w-full divide-y divide-gray-200\">\r\n                      <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"></th>\r\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"></th>\r\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"> </th>\r\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"> </th>\r\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"></th>\r\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"> </th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                        {pendingWaitingItems.map((item: any) => {\r\n                          const phoneRaw = (item.phone || '').toString();\r\n                          const phoneDigits = phoneRaw.replace(/\\D/g, '');\r\n                          let waLink: string | null = null;\r\n                          const defaultMessage = '   .  ';\r\n                          try {\r\n                            if (validatePhoneNumber(phoneRaw)) {\r\n                              waLink = createWhatsAppLink(phoneRaw, defaultMessage);\r\n                            }\r\n                          } catch {\r\n                            waLink = null;\r\n                          }\r\n                          const createdAt = item.createdAt?.toDate ? item.createdAt.toDate() : (item.createdAt ? new Date(item.createdAt) : null);\r\n                          return (\r\n                            <tr key={item.id}>\r\n                              <td className=\"px-4 py-3 text-sm text-gray-800\">{item.name || ' '}</td>\r\n                              <td className=\"px-4 py-3 text-xs text-gray-500\">{item.userId || '-'}</td>\r\n                              <td className=\"px-4 py-3 text-sm text-gray-700\">{item.reason || '-'}</td>\r\n                              <td className=\"px-4 py-3 text-sm text-gray-700\">{phoneDigits || ''}</td>\r\n                              <td className=\"px-4 py-3 flex items-center gap-2\">\r\n                                {waLink ? (\r\n                                  <a href={waLink} target=\"_blank\" rel=\"noopener noreferrer\">\r\n                                    <button className=\"px-3 py-1.5 rounded-md bg-green-600 text-white text-sm hover:bg-green-700\"></button>\r\n                                  </a>\r\n                                ) : (\r\n                                  <span className=\"text-xs text-gray-400\">  </span>\r\n                                )}\r\n                                <button\r\n                                  className=\"px-3 py-1.5 rounded-md bg-indigo-600 text-white text-sm hover:bg-indigo-700\"\r\n                                  onClick={() => markWaitingItemContacted(item.id)}\r\n                                  title=\"  \"\r\n                                >\r\n                                   \r\n                                </button>\r\n                              </td>\r\n                              <td className=\"px-4 py-3 text-sm text-gray-700\">{createdAt ? createdAt.toLocaleString('ar-EG') : ' '}</td>\r\n                            </tr>\r\n                          );\r\n                        })}\r\n                      </tbody>\r\n                    </table>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/*    */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n                <div className=\"p-6 border-b border-gray-200 flex items-center justify-between\">\r\n                  <h3 className=\"text-lg font-semibold text-gray-800\"> </h3>\r\n                  <div className=\"text-sm text-gray-500\">{contactedWaitingItems.length}</div>\r\n                </div>\r\n                <div className=\"overflow-x-auto\">\r\n                  {contactedWaitingItems.length === 0 ? (\r\n                    <div className=\"p-8 text-center text-gray-600\">      </div>\r\n                  ) : (\r\n                    <table className=\"min-w-full divide-y divide-gray-200\">\r\n                      <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"></th>\r\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"></th>\r\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"> </th>\r\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"> </th>\r\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"></th>\r\n                          <th className=\"px-4 py-3 text-right text-xs font-medium text-gray-500\"> </th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                        {contactedWaitingItems.map((item: any) => {\r\n                          const phoneRaw = (item.phone || '').toString();\r\n                          const phoneDigits = phoneRaw.replace(/\\D/g, '');\r\n                          const contactedAt = item.contactedAt?.toDate ? item.contactedAt.toDate() : (item.contactedAt ? new Date(item.contactedAt) : null);\r\n                          return (\r\n                            <tr key={item.id}>\r\n                              <td className=\"px-4 py-3 text-sm text-gray-800\">{item.name || ' '}</td>\r\n                              <td className=\"px-4 py-3 text-xs text-gray-500\">{item.userId || '-'}</td>\r\n                              <td className=\"px-4 py-3 text-sm text-gray-700\">{item.reason || '-'}</td>\r\n                              <td className=\"px-4 py-3 text-sm text-gray-700\">{phoneDigits || ''}</td>\r\n                              <td className=\"px-4 py-3 text-xs\"><span className=\"px-2 py-1 rounded-full bg-green-100 text-green-700\"> </span></td>\r\n                              <td className=\"px-4 py-3 text-sm text-gray-700\">{contactedAt ? contactedAt.toLocaleString('ar-EG') : ' '}</td>\r\n                            </tr>\r\n                          );\r\n                        })}\r\n                      </tbody>\r\n                    </table>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n          {activeTab === 'users' && (\r\n            <div className=\"space-y-6\">\r\n              {/*   */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6\">\r\n                <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-500\"> </p>\r\n                      <p className=\"text-2xl font-bold text-gray-800\">{users.length}</p>\r\n                    </div>\r\n                    <Users className=\"w-8 h-8 text-blue-600\" />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">  ()</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={broadcastTargetUserId}\r\n                      onChange={(e) => setBroadcastTargetUserId(e.target.value)}\r\n                      placeholder=\" uid     \"\r\n                      className=\"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500\"\r\n                    />\r\n                    <p className=\"text-xs text-gray-500 mt-1\">           .</p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-500\"> </p>\r\n                      <p className=\"text-2xl font-bold text-green-600\">\r\n                        {users.filter(user => user.isActive).length}\r\n                      </p>\r\n                    </div>\r\n                    <UserCheck className=\"w-8 h-8 text-green-600\" />\r\n                  </div>\r\n                </div>\r\n                <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-500\"> </p>\r\n                      <p className=\"text-2xl font-bold text-red-600\">\r\n                        {users.filter(user => !user.isActive).length}\r\n                      </p>\r\n                    </div>\r\n                    <UserX className=\"w-8 h-8 text-red-600\" />\r\n                  </div>\r\n                </div>\r\n\r\n              </div>\r\n\r\n              {/*   */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n                <div className=\"p-6 border-b border-gray-200\">\r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-800\"> </h3>\r\n                    <div className=\"relative\">\r\n                      <Search className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\r\n                      <input\r\n                        type=\"text\"\r\n                        placeholder=\"  ...\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                        className=\"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  {searchTerm && (\r\n                    <div className=\"text-sm text-gray-600\">\r\n                       {filteredUsers.length}   {users.length} \r\n                      {searchTerm && (\r\n                        <button\r\n                          onClick={() => setSearchTerm('')}\r\n                          className=\"mr-2 text-purple-600 hover:text-purple-800 underline\"\r\n                        >\r\n                           \r\n                        </button>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <div className=\"overflow-x-auto\">\r\n                  {loading ? (\r\n                    <div className=\"p-8 text-center\">\r\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto\"></div>\r\n                      <p className=\"mt-2 text-gray-500\">  ...</p>\r\n                    </div>\r\n                  ) : filteredUsers.length === 0 ? (\r\n                    <div className=\"p-8 text-center text-gray-500\">\r\n                      {searchTerm ? '   ' : '   '}\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                      {filteredUsers.map((user) => (\r\n                        <UserCard \r\n                          key={user.id} \r\n                          user={user} \r\n                          onActivateSubscription={(uid, plan, start, end) => handleActivateSubscription(uid, plan, null, start, end)}\r\n                          onRequestActivation={handleRequestActivation}\r\n                          onToggleUserStatus={toggleUserStatus}\r\n                          onDeactivateSubscription={handleDeactivateSubscription}\r\n                          onDeleteUser={handleDeleteUser}\r\n                          onUpdateSessionLimit={async (userId, config) => {\r\n                            try {\r\n                              const userRef = doc(db, 'users', userId);\r\n                              const payload: any = {\r\n                                sessionLimitDisabled: config.sessionLimitDisabled,\r\n                                updatedAt: new Date(),\r\n                              };\r\n                              if (config.sessionLimit === null) {\r\n                                payload.sessionLimit = null;\r\n                              } else {\r\n                                payload.sessionLimit = config.sessionLimit;\r\n                              }\r\n                              await updateDoc(userRef, payload);\r\n                              setUsers(prev => prev.map(u => u.id === userId ? { ...u, ...payload } : u));\r\n                              alert('    ');\r\n                            } catch (e) {\r\n                              console.error('update session limit error:', e);\r\n                              alert('     ');\r\n                            }\r\n                          }}\r\n                        />\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n  {activeTab === 'application' && (\r\n        <div className=\"space-y-6\">\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6\">\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold text-gray-800 flex items-center gap-2\">\r\n                      <Smartphone className=\"w-5 h-5 text-green-600\" />   \r\n                    </h3>\r\n                    {appDownloads?.androidUrl && (\r\n                      <p className=\"text-sm text-gray-600 mt-1\">\r\n             : <a href={resolveDownloadUrl(appDownloads.androidUrl)} className=\"text-blue-600 underline\" target=\"_blank\" rel=\"noopener noreferrer\"></a>\r\n                        {appDownloads.androidVersion ? ` | : ${appDownloads.androidVersion}` : ''}\r\n                      </p>\r\n        )}\r\n\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\"> APK</label>\r\n                    <input type=\"file\" accept=\".apk\" onChange={(e) => setAndroidFile(e.target.files?.[0] || null)} className=\"w-full p-2 border border-gray-300 rounded-md\" />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">  ()</label>\r\n                    <input type=\"text\" value={androidVersion} onChange={(e) => setAndroidVersion(e.target.value)} placeholder=\": 1.0.3\" className=\"w-full p-2 border border-gray-300 rounded-md\" />\r\n                  </div>\r\n                  <div className=\"flex flex-col sm:flex-row gap-3\">\r\n                    <button\r\n                      onClick={async () => {\r\n                        if (!androidFile) return;\r\n                        try {\r\n                          setUploadingAndroid(true);\r\n                          setAndroidProgress(0);\r\n                          const { uploadAppBinaryResumable } = await import('../utils/appDownloadService');\r\n                          const url = await uploadAppBinaryResumable(\r\n                            androidFile,\r\n                            'android',\r\n                            auth?.currentUser?.uid || 'admin',\r\n                            androidVersion || undefined,\r\n                            (p) => setAndroidProgress(p),\r\n                            300000 // 5     \r\n                          );\r\n                          setAppDownloads((prev: any) => ({ ...prev, androidUrl: url, androidVersion: androidVersion || prev.androidVersion }));\r\n                        } catch (e: any) {\r\n                          console.error('Android upload failed', e);\r\n                          alert(e?.message ? `   : ${e.message}` : '   ');\r\n                        } finally {\r\n                          setUploadingAndroid(false);\r\n                          setAndroidProgress(0);\r\n                        }\r\n                      }}\r\n                      disabled={uploadingAndroid || !androidFile}\r\n                      className=\"w-full sm:w-auto flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50\"\r\n                    >\r\n                      <Upload className=\"w-4 h-4\" />\r\n                      {uploadingAndroid ? ` ... ${androidProgress}%` : '  '}\r\n                    </button>\r\n                    {appDownloads?.androidUrl && (\r\n            <a href={resolveDownloadUrl(appDownloads.androidUrl)} className=\"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n                        <Download className=\"w-4 h-4\" />  \r\n                      </a>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                {/*      */}\r\n                <div className=\"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end\">\r\n                  <div className=\"lg:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">    (APK)</label>\r\n                    <input type=\"url\" value={androidUrlInput} onChange={(e) => setAndroidUrlInput(e.target.value)} placeholder=\"https://example.com/app-release.apk\" className=\"w-full p-2 border border-gray-300 rounded-md\" />\r\n                  </div>\r\n                  <div className=\"flex flex-col sm:flex-row gap-3\">\r\n                    <button\r\n                      onClick={async () => {\r\n                        try {\r\n                          const { setAppDownloadLinks } = await import('../utils/appDownloadService');\r\n                          await setAppDownloadLinks({ androidUrl: androidUrlInput || undefined, androidVersion: androidVersion || undefined }, auth?.currentUser?.uid || 'admin');\r\n                          setAppDownloads((prev: any) => ({ ...prev, androidUrl: androidUrlInput || undefined, androidVersion: androidVersion || prev?.androidVersion }));\r\n                          alert('    ');\r\n                        } catch (e: any) {\r\n                          console.error('Failed to save android link', e);\r\n                          alert(e?.message ? `  : ${e.message}` : '  ');\r\n                        }\r\n                      }}\r\n                      className=\"w-full sm:w-auto flex items-center gap-2 bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700\"\r\n                    >\r\n                      <Save className=\"w-4 h-4\" />  \r\n                    </button>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end\">\r\n                  <div className=\"lg:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">  ()</label>\r\n                    <input type=\"text\" value={androidNotesInput} onChange={(e) => setAndroidNotesInput(e.target.value)} placeholder=\":  \" className=\"w-full p-2 border border-gray-300 rounded-md\" />\r\n                  </div>\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <label className=\"inline-flex items-center gap-2 text-sm font-medium text-gray-700\">\r\n                      <input type=\"checkbox\" checked={androidForceInput} onChange={(e) => setAndroidForceInput(e.target.checked)} />\r\n                       \r\n                    </label>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"mt-4 flex items-center gap-3\">\r\n                  <button\r\n                    onClick={async () => {\r\n                      setAndroidPublishError('');\r\n                      if (!auth?.currentUser) { setAndroidPublishStatus('error'); setAndroidPublishError('     '); try { alert('     '); } catch {} return; }\r\n                      const v = androidVersion.trim();\r\n                      const u = androidUrlInput.trim();\r\n                      if (!v) { setAndroidPublishStatus('error'); setAndroidPublishError('  '); return; }\r\n                      try { new URL(u); } catch { setAndroidPublishStatus('error'); setAndroidPublishError(' APK   (   https://)'); return; }\r\n                      try {\r\n                        setAndroidPublishStatus('publishing');\r\n                        await setAndroidUpdateInfo({ version: v, url: u, notes: androidNotesInput.trim(), force: !!androidForceInput }, auth.currentUser.uid);\r\n                        setAndroidPublishStatus('done');\r\n                        try { localStorage.setItem('android_update_cache', JSON.stringify({ version: v, url: u, notes: androidNotesInput.trim(), force: !!androidForceInput })); } catch {}\r\n                        alert('      ');\r\n                      } catch (e: any) {\r\n                        setAndroidPublishStatus('error');\r\n                        const msg = e?.message || ' :     ';\r\n                        setAndroidPublishError(msg);\r\n                        try { alert(msg); } catch {}\r\n                      }\r\n                    }}\r\n                    className=\"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700\"\r\n                  >\r\n                      \r\n                  </button>\r\n                  {androidPublishStatus === 'publishing' && <span className=\"text-sm text-gray-600\"> ...</span>}\r\n                  {androidPublishStatus === 'error' && <span className=\"text-sm text-red-600\">{androidPublishError}</span>}\r\n                  {androidPublishStatus === 'done' && <span className=\"text-sm text-green-600\"> </span>}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6\">\r\n              <div className=\"flex items-center justify-between mb-6\">\r\n                <div>\r\n                  <h3 className=\"text-lg font-semibold text-gray-800 flex items-center gap-2\">\r\n                    <Monitor className=\"w-5 h-5 text-indigo-600\" />    (Windows)  64 \r\n                  </h3>\r\n                  {appDownloads?.pcUrl && (\r\n                    <p className=\"text-sm text-gray-600 mt-1\">\r\n             : <a href={resolveDownloadUrl(appDownloads.pcUrl)} className=\"text-blue-600 underline\" target=\"_blank\" rel=\"noopener noreferrer\"></a>\r\n                      {appDownloads.pcVersion ? ` | : ${appDownloads.pcVersion}` : ''}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">  (EXE/ZIP)</label>\r\n                    <input type=\"file\" accept=\".exe,.zip\" onChange={(e) => setPcFile(e.target.files?.[0] || null)} className=\"w-full p-2 border border-gray-300 rounded-md\" />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">  ()</label>\r\n                    <input type=\"text\" value={pcVersion} onChange={(e) => setPcVersion(e.target.value)} placeholder=\": 2.1.0\" className=\"w-full p-2 border border-gray-300 rounded-md\" />\r\n                  </div>\r\n                  <div className=\"flex flex-col sm:flex-row gap-3\">\r\n                    <button\r\n                      onClick={async () => {\r\n                        if (!pcFile) return;\r\n                        try {\r\n                          setUploadingPc(true);\r\n                          setPcProgress(0);\r\n                          const { uploadAppBinaryResumable } = await import('../utils/appDownloadService');\r\n                          const url = await uploadAppBinaryResumable(\r\n                            pcFile,\r\n                            'pc',\r\n                            auth?.currentUser?.uid || 'admin',\r\n                            pcVersion || undefined,\r\n                            (p) => setPcProgress(p),\r\n                            300000 // 5 \r\n                          );\r\n                          setAppDownloads((prev: any) => ({ ...prev, pcUrl: url, pcVersion: pcVersion || prev.pcVersion }));\r\n                        } catch (e: any) {\r\n                          console.error('PC upload failed', e);\r\n                          alert(e?.message ? `   : ${e.message}` : '   ');\r\n                        } finally {\r\n                          setUploadingPc(false);\r\n                          setPcProgress(0);\r\n                        }\r\n                      }}\r\n                      disabled={uploadingPc || !pcFile}\r\n                      className=\"w-full sm:w-auto flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 disabled:opacity-50\"\r\n                    >\r\n                      <Upload className=\"w-4 h-4\" />\r\n                      {uploadingPc ? ` ... ${pcProgress}%` : '  '}\r\n                    </button>\r\n                    {appDownloads?.pcUrl && (\r\n            <a href={resolveDownloadUrl(appDownloads.pcUrl)} className=\"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n                        <Download className=\"w-4 h-4\" />   64 \r\n                      </a>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                {/*      */}\r\n                <div className=\"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end\">\r\n                  <div className=\"lg:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">    (EXE/ZIP)</label>\r\n                    <input type=\"url\" value={pcUrlInput} onChange={(e) => setPcUrlInput(e.target.value)} placeholder=\"https://example.com/cashy-setup.exe\" className=\"w-full p-2 border border-gray-300 rounded-md\" />\r\n                  </div>\r\n                  <div className=\"flex gap-3\">\r\n                    <button\r\n                      onClick={async () => {\r\n                        try {\r\n                          const { setAppDownloadLinks } = await import('../utils/appDownloadService');\r\n                          await setAppDownloadLinks({ pcUrl: pcUrlInput || undefined, pcVersion: pcVersion || undefined }, auth?.currentUser?.uid || 'admin');\r\n                          setAppDownloads((prev: any) => ({ ...prev, pcUrl: pcUrlInput || undefined, pcVersion: pcVersion || prev?.pcVersion }));\r\n                          alert('    ');\r\n                        } catch (e: any) {\r\n                          console.error('Failed to save pc link', e);\r\n                          alert(e?.message ? `  : ${e.message}` : '  ');\r\n                        }\r\n                      }}\r\n                      className=\"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700\"\r\n                    >\r\n                      <Save className=\"w-4 h-4\" />  \r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* 32-bit Windows section */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6\">\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold text-gray-800 flex items-center gap-2\">\r\n                      <Monitor className=\"w-5 h-5 text-sky-600\" />    (Windows)  32 \r\n                    </h3>\r\n                    {appDownloads?.pc32Url && (\r\n                      <p className=\"text-sm text-gray-600 mt-1\">\r\n             : <a href={resolveDownloadUrl(appDownloads.pc32Url)} className=\"text-blue-600 underline\" target=\"_blank\" rel=\"noopener noreferrer\"></a>\r\n                        {appDownloads.pc32Version ? ` | : ${appDownloads.pc32Version}` : ''}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n              <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6 items-start lg:items-end\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">  (EXE/ZIP)</label>\r\n                    <input type=\"file\" accept=\".exe,.zip\" onChange={(e) => setPc32File(e.target.files?.[0] || null)} className=\"w-full p-2 border border-gray-300 rounded-md\" />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">  ()</label>\r\n                    <input type=\"text\" value={pc32Version} onChange={(e) => setPc32Version(e.target.value)} placeholder=\": 2.1.0\" className=\"w-full p-2 border border-gray-300 rounded-md\" />\r\n                  </div>\r\n                  <div className=\"flex flex-col sm:flex-row gap-3\">\r\n                    <button\r\n                      onClick={async () => {\r\n                        if (!pc32File) return;\r\n                        try {\r\n                          setUploadingPc32(true);\r\n                          setPc32Progress(0);\r\n                          const { uploadAppBinaryResumable } = await import('../utils/appDownloadService');\r\n                          const url = await uploadAppBinaryResumable(\r\n                            pc32File,\r\n                            'pc32',\r\n                            auth?.currentUser?.uid || 'admin',\r\n                            pc32Version || undefined,\r\n                            (p) => setPc32Progress(p),\r\n                            300000\r\n                          );\r\n                          setAppDownloads((prev: any) => ({ ...prev, pc32Url: url, pc32Version: pc32Version || prev.pc32Version }));\r\n                        } catch (e: any) {\r\n                          console.error('PC32 upload failed', e);\r\n                          alert(e?.message ? `   32 : ${e.message}` : '   32 ');\r\n                        } finally {\r\n                          setUploadingPc32(false);\r\n                          setPc32Progress(0);\r\n                        }\r\n                      }}\r\n                      disabled={uploadingPc32 || !pc32File}\r\n                      className=\"w-full sm:w-auto flex items-center gap-2 bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700 disabled:opacity-50\"\r\n                    >\r\n                      <Upload className=\"w-4 h-4\" />\r\n                      {uploadingPc32 ? ` ... ${pc32Progress}%` : '  32 '}\r\n                    </button>\r\n                    {appDownloads?.pc32Url && (\r\n            <a href={resolveDownloadUrl(appDownloads.pc32Url)} className=\"w-full sm:w-auto text-center flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n                        <Download className=\"w-4 h-4\" />   32 \r\n                      </a>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                {/*      */}\r\n                <div className=\"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end\">\r\n                  <div className=\"lg:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">     32  (EXE/ZIP)</label>\r\n                    <input type=\"url\" value={pc32UrlInput} onChange={(e) => setPc32UrlInput(e.target.value)} placeholder=\"https://example.com/cashy-setup-ia32.exe\" className=\"w-full p-2 border border-gray-300 rounded-md\" />\r\n                  </div>\r\n                  <div className=\"flex gap-3\">\r\n                    <button\r\n                      onClick={async () => {\r\n                        try {\r\n                          const { setAppDownloadLinks } = await import('../utils/appDownloadService');\r\n                          await setAppDownloadLinks({ pc32Url: pc32UrlInput || undefined, pc32Version: pc32Version || undefined }, auth?.currentUser?.uid || 'admin');\r\n                          setAppDownloads((prev: any) => ({ ...prev, pc32Url: pc32UrlInput || undefined, pc32Version: pc32Version || prev?.pc32Version }));\r\n                          alert('   32  ');\r\n                        } catch (e: any) {\r\n                          console.error('Failed to save pc32 link', e);\r\n                          alert(e?.message ? `  : ${e.message}` : '  ');\r\n                        }\r\n                      }}\r\n                      className=\"flex items-center gap-2 bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700\"\r\n                    >\r\n                      <Save className=\"w-4 h-4\" />  \r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6\">\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold text-gray-800 flex items-center gap-2\">\r\n                      <HardDrive className=\"w-5 h-5 text-indigo-600\" />    \r\n                    </h3>\r\n                    <p className=\"text-sm text-gray-600 mt-1\">    64- 32-    .</p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\"> </label>\r\n                    <input type=\"text\" value={desktopVersionInput} onChange={(e) => setDesktopVersionInput(e.target.value)} className=\"w-full p-2 border border-gray-300 rounded-md\" placeholder=\": 1.4.0\" />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">  64-</label>\r\n                    <input type=\"text\" value={desktopUrl64Input} onChange={(e) => setDesktopUrl64Input(e.target.value)} className=\"w-full p-2 border border-gray-300 rounded-md\" placeholder=\"  x64\" />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">  32-</label>\r\n                    <input type=\"text\" value={desktopUrl32Input} onChange={(e) => setDesktopUrl32Input(e.target.value)} className=\"w-full p-2 border border-gray-300 rounded-md\" placeholder=\"  ia32\" />\r\n                  </div>\r\n                  <div className=\"md:col-span-2 lg:col-span-3\">\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\"> </label>\r\n                    <textarea value={desktopNotesInput} onChange={(e) => setDesktopNotesInput(e.target.value)} className=\"w-full p-2 border border-gray-300 rounded-md\" rows={4} placeholder=\" \" />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"inline-flex items-center gap-2 text-sm font-medium text-gray-700\">\r\n                      <input type=\"checkbox\" checked={desktopForceInput} onChange={(e) => setDesktopForceInput(e.target.checked)} />\r\n                        (     )\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n              <div className=\"mt-4 flex items-center gap-3\">\r\n                <button onClick={handlePublishDesktopVersion} className=\"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-60\" disabled={desktopPublishStatus==='publishing'}>\r\n                   \r\n                </button>\r\n                {desktopPublishStatus==='publishing' && <span className=\"text-sm text-gray-600\"> ...</span>}\r\n                {desktopPublishStatus==='done' && <span className=\"text-sm text-green-600\">  </span>}\r\n                {desktopPublishStatus==='error' && <span className=\"text-sm text-red-600\"> </span>}\r\n                {desktopPublishError && <span className=\"text-sm text-red-600\">{desktopPublishError}</span>}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6\">\r\n              <div className=\"flex items-center justify-between mb-6\">\r\n                <div>\r\n                  <h3 className=\"text-lg font-semibold text-gray-800 flex items-center gap-2\">\r\n                    <Smartphone className=\"w-5 h-5 text-emerald-600\" />      (Firestore)\r\n                  </h3>\r\n                  <p className=\"text-sm text-gray-600 mt-1\">        .</p>\r\n                </div>\r\n              </div>\r\n              <div className=\"text-sm text-gray-600\">        .</div>\r\n            </div>\r\n        </div>\r\n      )}\r\n\r\n          {activeTab === 'branches' && (\r\n            <div className=\"space-y-6\">\r\n              {/*      */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold text-gray-800\">  </h3>\r\n                    <p className=\"text-sm text-gray-500\">       </p>\r\n                  </div>\r\n                  <button\r\n                    onClick={handleGenerateBranchCode}\r\n                    disabled={generatingCode}\r\n                    className=\"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50\"\r\n                  >\r\n                    <Plus className=\"w-4 h-4\" />\r\n                    {generatingCode ? ' ...' : '  '}\r\n                  </button>\r\n                </div>\r\n\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                      <tr>\r\n                        <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\"></th>\r\n                        <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\"></th>\r\n                        <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\"></th>\r\n                        <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\"> </th>\r\n                        <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\"> </th>\r\n                        <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\"></th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                      {branchCodes.map((code) => (\r\n                        <tr key={code.id || code.code}>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 font-mono\">{code.code}</td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\r\n                            <span className={`px-2 py-1 rounded-full text-xs ${code.isUsed ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`}>\r\n                              {code.isUsed ? '' : ''}\r\n                            </span>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                            {code.isUsed && code.usedBy ? (() => {\r\n                              const u = users.find(x => x.id === code.usedBy);\r\n                              return u ? (\r\n                                <div className=\"flex flex-col\">\r\n                                  <span className=\"text-gray-900 font-medium\">{getUserDisplayName(u)}</span>\r\n                                  <span className=\"text-xs text-gray-500\">{u.email}</span>\r\n                                </div>\r\n                              ) : <span className=\"text-xs font-mono\">{code.usedBy}</span>;\r\n                            })() : ''}\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                            {code.createdAt?.toDate ? code.createdAt.toDate().toLocaleString('ar-EG') : ''}\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                            {code.usedAt?.toDate ? code.usedAt.toDate().toLocaleString('ar-EG') : ''}\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                            <button\r\n                              onClick={() => {\r\n                                navigator.clipboard.writeText(code.code);\r\n                                alert('  ');\r\n                              }}\r\n                              className=\"text-gray-400 hover:text-gray-600\"\r\n                              title=\" \"\r\n                            >\r\n                              <Copy className=\"w-4 h-4\" />\r\n                            </button>\r\n                          </td>\r\n                        </tr>\r\n                      ))}\r\n                      {branchCodes.length === 0 && (\r\n                        <tr>\r\n                          <td colSpan={6} className=\"px-6 py-4 text-center text-sm text-gray-500\">\r\n                                \r\n                          </td>\r\n                        </tr>\r\n                      )}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n              {/*     */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-500\">   ( )</p>\r\n                      <p className=\"text-2xl font-bold text-gray-800\">\r\n                        {users.filter(u => u.branchPackage?.status === 'pending' || u.branchPackage?.requested).length}\r\n                      </p>\r\n                    </div>\r\n                    <GitBranch className=\"w-8 h-8 text-purple-600\" />\r\n                  </div>\r\n                </div>\r\n                <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-500\">  </p>\r\n                      <p className=\"text-2xl font-bold text-green-600\">\r\n                        {users.filter(u => u.branchPackage?.status === 'active').length}\r\n                      </p>\r\n                    </div>\r\n                    <CheckCircle className=\"w-8 h-8 text-green-600\" />\r\n                  </div>\r\n                </div>\r\n                <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-500\">   </p>\r\n                      <p className=\"text-2xl font-bold text-blue-600\">\r\n                        {users.filter(u => u.branchPackage?.requested || u.branchPackage?.status).length}\r\n                      </p>\r\n                    </div>\r\n                    <Users className=\"w-8 h-8 text-blue-600\" />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/*     */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n                <div className=\"p-6 border-b border-gray-200\">\r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-800\">  </h3>\r\n                    <div className=\"relative\">\r\n                      <Search className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\r\n                      <input\r\n                        type=\"text\"\r\n                        placeholder=\"    ...\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                        className=\"pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  {searchTerm && (\r\n                    <div className=\"text-sm text-gray-600\">\r\n                       {filteredUsers.filter(u => u.branchPackage?.requested || u.branchPackage?.status).length}   {users.filter(u => u.branchPackage?.requested || u.branchPackage?.status).length} \r\n                      {searchTerm && (\r\n                        <button\r\n                          onClick={() => setSearchTerm('')}\r\n                          className=\"mr-2 text-purple-600 hover:text-purple-800 underline\"\r\n                        >\r\n                           \r\n                        </button>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"overflow-x-auto\">\r\n                  {loading ? (\r\n                    <div className=\"p-8 text-center\">\r\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto\"></div>\r\n                      <p className=\"mt-2 text-gray-500\">  ...</p>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4\">\r\n                      {(searchTerm ? filteredUsers : users)\r\n                        .filter(u => u.branchPackage?.requested || u.branchPackage?.status)\r\n                        .map((user) => {\r\n                          const status = user.branchPackage?.status || (user.branchPackage?.requested ? 'pending' : 'none');\r\n                          return (\r\n                            <div key={user.id} className=\"border rounded-lg p-4 bg-white shadow-sm\">\r\n                              <div className=\"flex items-center space-x-4 space-x-reverse\">\r\n                                <div className=\"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center\">\r\n                                  <span className=\"text-purple-600 font-semibold\">{getUserInitial(user)}</span>\r\n                                </div>\r\n                                <div>\r\n                                  <h4 className=\"font-medium text-gray-800\">{getUserDisplayName(user)}</h4>\r\n                                  <p className=\"text-sm text-gray-500\">{user.email}</p>\r\n                                  {user.branchPackage?.requestedAt && (\r\n                                    <p className=\"text-xs text-gray-400\"> : {formatDate(user.branchPackage.requestedAt)}</p>\r\n                                  )}\r\n                                  {user.branchPackage?.limit && (\r\n                                    <p className=\"text-sm text-gray-600 mt-1\"> : <span className=\"font-bold\">{user.branchPackage.limit}</span></p>\r\n                                  )}\r\n                                  {user.branchPackage?.packageType && (\r\n                                    <p className=\"text-sm text-gray-600\"> : <span className=\"font-bold\">\r\n                                      {user.branchPackage.packageType === 'basic' ? ' ' : \r\n                                       user.branchPackage.packageType === 'quarterly' ? '  ' :\r\n                                       user.branchPackage.packageType === 'pro' ? ' ' : \r\n                                       user.branchPackage.packageType === 'enterprise' ? ' ' : user.branchPackage.packageType}\r\n                                    </span></p>\r\n                                  )}\r\n                                </div>\r\n                              </div>\r\n                              \r\n                              <UserBranchesList userId={user.id} adminId={auth?.currentUser?.uid || 'admin'} />\r\n\r\n                              <div className=\"mt-4 flex items-center justify-between\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <span className={`text-xs px-2 py-1 rounded-full ${status === 'active' ? 'bg-green-100 text-green-700' : status === 'pending' ? 'bg-yellow-100 text-yellow-700' : status === 'rejected' ? 'bg-red-100 text-red-700' : 'bg-gray-100 text-gray-600'}`}>\r\n                                    {status === 'active' ? '' : status === 'pending' ? ' ' : status === 'rejected' ? '' : ' '}\r\n                                  </span>\r\n                                  {status === 'active' && (\r\n                                    <button\r\n                                      title=\"  \"\r\n                                      onClick={async () => {\r\n                                        const confirmCancel = window.confirm('            .');\r\n                                        if (!confirmCancel) return;\r\n                                        try {\r\n                                          const { doc, updateDoc, collection, getDocs } = await import('firebase/firestore');\r\n                                          const { db } = await import('../firebase');\r\n                                          const adminId = auth?.currentUser?.uid || 'admin-user-id';\r\n                                          \r\n                                          // 1.     (     )\r\n                                          await updateDoc(doc(db, 'users', user.id), {\r\n                                            \"branchPackage.status\": 'canceled',\r\n                                            \"branchPackage.canceledAt\": new Date(),\r\n                                            \"branchPackage.canceledBy\": adminId,\r\n                                            updatedAt: new Date()\r\n                                          });\r\n\r\n                                          // 2.    \r\n                                          try {\r\n                                            const branchesRef = collection(db, 'users', user.id, 'branches');\r\n                                            const branchesSnap = await getDocs(branchesRef);\r\n                                            \r\n                                            const updates = branchesSnap.docs.map(async (bDoc) => {\r\n                                              const bData = bDoc.data();\r\n                                              if (bData.branchUserId) {\r\n                                                try {\r\n                                                  //        \r\n                                                  await updateDoc(doc(db, 'users', bData.branchUserId), {\r\n                                                    isActive: false,\r\n                                                    \"branchPackage.status\": 'canceled', //  \r\n                                                    updatedAt: new Date()\r\n                                                  });\r\n                                                } catch (err) {\r\n                                                  console.warn(`Failed to deactivate branch user ${bData.branchUserId}`, err);\r\n                                                }\r\n                                              }\r\n                                            });\r\n                                            await Promise.all(updates);\r\n                                          } catch (err) {\r\n                                            console.error('Error fetching/deactivating branches:', err);\r\n                                          }\r\n\r\n                                          alert('       ');\r\n                                        } catch (e) {\r\n                                          console.error('    :', e);\r\n                                          alert('      ');\r\n                                        }\r\n                                      }}\r\n                                      className=\"p-1 rounded-md text-red-600 hover:bg-red-50\"\r\n                                    >\r\n                                      <XCircle className=\"w-5 h-5\" />\r\n                                    </button>\r\n                                  )}\r\n                                </div>\r\n                                <div className=\"flex items-center space-x-2 space-x-reverse\">\r\n                                  {status === 'pending' && (\r\n                                     <button\r\n                                      onClick={async () => {\r\n                                        if (!window.confirm('      ')) return;\r\n                                        try {\r\n                                            const { doc, updateDoc } = await import('firebase/firestore');\r\n                                            const { db } = await import('../firebase');\r\n                                            await updateDoc(doc(db, 'users', user.id), {\r\n                                                \"branchPackage.status\": 'rejected',\r\n                                                updatedAt: new Date()\r\n                                            });\r\n                                            alert('  ');\r\n                                        } catch(e) {\r\n                                            alert(' ');\r\n                                        }\r\n                                      }}\r\n                                      className=\"px-3 py-1 text-sm rounded-md bg-red-100 text-red-600 hover:bg-red-200\"\r\n                                     >\r\n                                        \r\n                                     </button>\r\n                                  )}\r\n                                  {status !== 'active' && (\r\n                                    <button\r\n                                      onClick={async () => {\r\n                                        try {\r\n                                          const { doc, updateDoc, setDoc } = await import('firebase/firestore');\r\n                                          const { db } = await import('../firebase');\r\n                                          const adminId = auth?.currentUser?.uid || 'admin-user-id';\r\n\r\n                                          //    \r\n                                          const startDate = new Date();\r\n                                          let endDate = new Date(startDate);\r\n                                          const pType = user.branchPackage?.packageType || 'basic';\r\n                                          \r\n                                          if (pType === 'quarterly') {\r\n                                            endDate.setMonth(endDate.getMonth() + 3);\r\n                                          } else if (pType === 'pro') {\r\n                                            endDate.setFullYear(endDate.getFullYear() + 1);\r\n                                          } else if (pType === 'enterprise') {\r\n                                            endDate = null as any; // Lifetime\r\n                                          } else {\r\n                                            // basic or default -> Monthly\r\n                                            endDate.setMonth(endDate.getMonth() + 1);\r\n                                          }\r\n\r\n                                          //     Dot Notation     (  )\r\n                                          await updateDoc(doc(db, 'users', user.id), {\r\n                                            \"branchPackage.status\": 'active',\r\n                                            \"branchPackage.activatedAt\": startDate,\r\n                                            \"branchPackage.endDate\": endDate,\r\n                                            \"branchPackage.activatedBy\": adminId,\r\n                                            //     :     \r\n                                            isActive: true,\r\n                                            approved: true,\r\n                                            role: 'merchant',\r\n                                            updatedAt: new Date()\r\n                                          });\r\n\r\n                                          //     profiles      \r\n                                          await setDoc(\r\n                                            doc(db, 'profiles', user.id),\r\n                                            {\r\n                                              role: 'merchant',\r\n                                              approved: true,\r\n                                              updatedAt: new Date()\r\n                                            },\r\n                                            { merge: true }\r\n                                          );\r\n\r\n                                          alert('     ');\r\n                                        } catch (e) {\r\n                                          console.error('    :', e);\r\n                                          alert('      ');\r\n                                        }\r\n                                      }}\r\n                                      className=\"px-3 py-1 text-sm rounded-md bg-purple-600 text-white hover:bg-purple-700\"\r\n                                    >\r\n                                      {status === 'rejected' ? ' ' : ' '}\r\n                                    </button>\r\n                                  )}\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          );\r\n                        })}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {activeTab === 'subscriptions' && (\r\n            <div className=\"space-y-6\">\r\n              {/*   */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n                <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-500\">  </p>\r\n                      <p className=\"text-2xl font-bold text-green-600\">\r\n                        {users.filter(user => user.subscription?.isActive).length}\r\n                      </p>\r\n                    </div>\r\n                    <CheckCircle className=\"w-8 h-8 text-green-600\" />\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-500\">  7 </p>\r\n                      <p className=\"text-2xl font-bold text-orange-600\">\r\n                        {users.filter(user => {\r\n                          if (!user.subscription?.endDate || !user.subscription?.isActive) return false;\r\n                          const endDate = user.subscription.endDate.toDate ? user.subscription.endDate.toDate() : new Date(user.subscription.endDate);\r\n                          const now = new Date();\r\n                          const diffTime = endDate.getTime() - now.getTime();\r\n                          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n                          return diffDays <= 7 && diffDays > 0;\r\n                        }).length}\r\n                      </p>\r\n                    </div>\r\n                    <AlertTriangle className=\"w-8 h-8 text-orange-600\" />\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-500\"> </p>\r\n                      <p className=\"text-2xl font-bold text-red-600\">\r\n                        {users.filter(user => {\r\n                          if (!user.subscription?.endDate) return false;\r\n                          const endDate = user.subscription.endDate.toDate ? user.subscription.endDate.toDate() : new Date(user.subscription.endDate);\r\n                          return endDate < new Date();\r\n                        }).length}\r\n                      </p>\r\n                    </div>\r\n                    <Clock className=\"w-8 h-8 text-red-600\" />\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-500\">  </p>\r\n                      <p className=\"text-2xl font-bold text-yellow-600\">\r\n                        {users.filter(user => user.subscription?.planType === SubscriptionPlan.LIFETIME).length}\r\n                      </p>\r\n                    </div>\r\n                    <Crown className=\"w-8 h-8 text-yellow-600\" />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/*    */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\r\n                <div className=\"p-6 border-b border-gray-200 flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold text-gray-800\">\r\n                        \r\n                    </h3>\r\n                    <p className=\"text-sm text-gray-600 mt-1\">\r\n                             \r\n                    </p>\r\n                  </div>\r\n                  \r\n                  {/*    */}\r\n                  <div className=\"relative w-full md:w-64\">\r\n                    <Search className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\r\n                    <input\r\n                      type=\"text\"\r\n                      placeholder=\"  ...\"\r\n                      value={subscriptionSearch}\r\n                      onChange={(e) => setSubscriptionSearch(e.target.value)}\r\n                      className=\"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm\"\r\n                    />\r\n                  </div>\r\n\r\n                  \r\n                </div>\r\n                \r\n                <div className=\"overflow-x-auto\">\r\n                  {loading ? (\r\n                    <div className=\"p-8 text-center\">\r\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto\"></div>\r\n                      <p className=\"mt-2 text-gray-500\">  ...</p>\r\n                    </div>\r\n                  ) : (\r\n                    <table className=\"w-full\">\r\n                      <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                          <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                            \r\n                          </th>\r\n                          <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                             \r\n                          </th>\r\n                          <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                             \r\n                          </th>\r\n                          <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                             \r\n                          </th>\r\n                          <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                            \r\n                          </th>\r\n                          <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                             \r\n                          </th>\r\n                          <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                            \r\n                          </th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                        {users\r\n                          .filter(user => {\r\n                            if (!user.subscription?.planType) return false;\r\n                            const isCancelled = (user.subscription?.isActive === false) || (user?.isActive === false);\r\n                            \r\n                            //   \r\n                            if (subscriptionSearch) {\r\n                              const q = subscriptionSearch.trim().toLowerCase();\r\n                              if (q) {\r\n                                const dn = getUserDisplayName(user).toLowerCase();\r\n                                const em = (user.email || '').toLowerCase();\r\n                                if (!dn.includes(q) && !em.includes(q)) return false;\r\n                              }\r\n                            }\r\n\r\n                            return !isCancelled;\r\n                          })\r\n                          .sort((a, b) => {\r\n                            if (!a.subscription?.endDate || !b.subscription?.endDate) return 0;\r\n                            const aDate = a.subscription.endDate.toDate ? a.subscription.endDate.toDate() : new Date(a.subscription.endDate);\r\n                            const bDate = b.subscription.endDate.toDate ? b.subscription.endDate.toDate() : new Date(b.subscription.endDate);\r\n                            return aDate.getTime() - bDate.getTime();\r\n                          })\r\n                          .map((user) => {\r\n                            const subscription = user.subscription;\r\n                            if (!subscription) return null;\r\n                            \r\n                            const startDate = subscription.startDate ? \r\n                              (subscription.startDate.toDate ? subscription.startDate.toDate() : new Date(subscription.startDate)) : null;\r\n                            const endDate = subscription.endDate ? \r\n                              (subscription.endDate.toDate ? subscription.endDate.toDate() : new Date(subscription.endDate)) : null;\r\n                            \r\n                          let daysRemaining = null;\r\n                          let statusColor = 'text-gray-600';\r\n                          let statusText = ' ';\r\n                          const isCancelled = (subscription?.isActive === false) || (user?.isActive === false);\r\n                          \r\n                          if (isCancelled) {\r\n                            statusText = '';\r\n                            statusColor = 'text-red-600';\r\n                          } else if (subscription.planType === SubscriptionPlan.LIFETIME) {\r\n                            statusText = ' ';\r\n                            statusColor = 'text-yellow-600';\r\n                          } else if (endDate) {\r\n                            const now = new Date();\r\n                            const diffTime = endDate.getTime() - now.getTime();\r\n                            daysRemaining = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n                            \r\n                            if (daysRemaining < 0) {\r\n                              statusText = '';\r\n                              statusColor = 'text-red-600';\r\n                            } else if (daysRemaining <= 7) {\r\n                              statusText = ' ';\r\n                              statusColor = 'text-orange-600';\r\n                            } else {\r\n                              statusText = '';\r\n                              statusColor = 'text-green-600';\r\n                            }\r\n                          }\r\n                            \r\n                            return (\r\n                              <tr key={user.id} className=\"hover:bg-gray-50\">\r\n                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                  <div className=\"flex items-center\">\r\n                                    <div className=\"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0\">\r\n                                      <span className=\"text-white font-medium text-sm\">\r\n                                        {getUserInitial(user)}\r\n                                      </span>\r\n                                    </div>\r\n                                    <div className=\"mr-4\">\r\n                                      <div className=\"text-sm font-medium text-gray-900\">\r\n                                        {getUserDisplayName(user)}\r\n                                      </div>\r\n                                      <div className=\"text-sm text-gray-500\">{user.email}</div>\r\n                                    </div>\r\n                                  </div>\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                  <div className=\"flex items-center\">\r\n                                    {subscription.planType === SubscriptionPlan.LIFETIME && <Crown className=\"w-4 h-4 text-yellow-500 ml-2\" />}\r\n                                    {subscription.planType === SubscriptionPlan.YEARLY && <Gift className=\"w-4 h-4 text-blue-500 ml-2\" />}\r\n                                    {subscription.planType === SubscriptionPlan.QUARTERLY && <Calendar className=\"w-4 h-4 text-purple-500 ml-2\" />}\r\n                                    {subscription.planType === SubscriptionPlan.MONTHLY && <Zap className=\"w-4 h-4 text-green-500 ml-2\" />}\r\n                                    <span className=\"text-sm font-medium text-gray-900\">\r\n                                      {getPlanDisplayName(subscription.planType)}\r\n                                    </span>\r\n                                  </div>\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                                  {startDate ? startDate.toLocaleDateString('ar-EG') : ' '}\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                                  {subscription.planType === SubscriptionPlan.LIFETIME ? \r\n                                    ' ' : \r\n                                    (endDate ? endDate.toLocaleDateString('ar-EG') : ' ')\r\n                                  }\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                  <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${\r\n                                    statusText === '' ? 'bg-green-100 text-green-800' :\r\n                                    statusText === ' ' ? 'bg-orange-100 text-orange-800' :\r\n                                    statusText === '' ? 'bg-red-100 text-red-800' :\r\n                                    statusText === '' ? 'bg-red-100 text-red-800' :\r\n                                    statusText === ' ' ? 'bg-yellow-100 text-yellow-800' :\r\n                                    'bg-gray-100 text-gray-800'\r\n                                  }`}>\r\n                                    {statusText}\r\n                                  </span>\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                                  {isCancelled ? '' : (\r\n                                    subscription.planType === SubscriptionPlan.LIFETIME ? \r\n                                      '' : \r\n                                      (daysRemaining !== null ? \r\n                                        (daysRemaining < 0 ? '' : `${daysRemaining} `) : \r\n                                        ' '\r\n                                      )\r\n                                  )}\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                  <button\r\n                                    onClick={() => {\r\n                                      setUserToCancel(user);\r\n                                      setCancelSubscriptionModalOpen(true);\r\n                                    }}\r\n                                    className=\"px-3 py-1 text-sm rounded-md bg-red-600 text-white hover:bg-red-700\"\r\n                                  >\r\n                                    \r\n                                  </button>\r\n                                </td>\r\n                              </tr>\r\n                            );\r\n                          })\r\n                          .filter(Boolean)}\r\n                      </tbody>\r\n                    </table>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {activeTab === 'content' && (\r\n            <div className=\"space-y-6\">\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold text-gray-800\">   </h3>\r\n                    {lastUpdateInfo && lastUpdateInfo.lastUpdated && (\r\n                      <p className=\"text-sm text-gray-600 mt-1\">\r\n                         : {new Date(lastUpdateInfo.lastUpdated).toLocaleString('ar-SA')} \r\n                        {lastUpdateInfo.updatedBy && ` : ${lastUpdateInfo.updatedBy}`}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <button\r\n                      onClick={() => {\r\n                        setIsNewPlan(true);\r\n                        //     \r\n                        const initial = {\r\n                          name: '  ',\r\n                          price: '250 ',\r\n                          period: ' 3 ',\r\n                          description: '    ',\r\n                          features: ['  ', '  ']\r\n                        };\r\n                        setEditDraft(initial);\r\n                        setEditModalPlanType('quarterly');\r\n                        setEditModalOpen(true);\r\n                      }}\r\n                      className=\"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700\"\r\n                    >\r\n                      <Plus className=\"w-4 h-4\" />\r\n                        \r\n                    </button>\r\n                    <button\r\n                      onClick={saveContentChanges}\r\n                      disabled={isSavingContent}\r\n                      className=\"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50\"\r\n                    >\r\n                      <Save className=\"w-4 h-4\" />\r\n                      {isSavingContent ? ' ...' : '  '}\r\n                    </button>\r\n                  </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                  {Object.entries(contentData).map(([planType, planData]) => (\r\n                    <div key={planType} className=\"border border-gray-200 rounded-lg p-4\">\r\n                      <div className=\"flex items-center justify-between mb-4\">\r\n                        <h4 className=\"font-semibold text-gray-800 flex items-center gap-2\">\r\n                          {planType === 'monthly' && <Zap className=\"w-4 h-4 text-green-500\" />}\r\n                          {planType === 'quarterly' && <Calendar className=\"w-4 h-4 text-purple-500\" />}\r\n                          {planType === 'yearly' && <Gift className=\"w-4 h-4 text-blue-500\" />}\r\n                          {planType === 'lifetime' && <Crown className=\"w-4 h-4 text-yellow-500\" />}\r\n                          {planData.name}\r\n                        </h4>\r\n                        <button\r\n                          onClick={() => {\r\n                            setEditingPlanState(editingPlan === planType ? null : planType);\r\n                            setIsNewPlan(false);\r\n                            setEditModalPlanType(planType as string);\r\n                            setEditDraft({ ...planData, features: [...(planData.features || [])] });\r\n                            setEditModalOpen(true);\r\n                          }}\r\n                          className=\"text-purple-600 hover:text-purple-800\"\r\n                        >\r\n                          <Edit3 className=\"w-4 h-4\" />\r\n                        </button>\r\n                      </div>\r\n\r\n                      {editingPlan === planType ? (\r\n                        <div className=\"space-y-4\">\r\n                          <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\"> </label>\r\n                            <input\r\n                              type=\"text\"\r\n                              value={planData.name}\r\n                              onChange={(e) => handleContentChange(planType, 'name', e.target.value)}\r\n                              className=\"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\r\n                            />\r\n                          </div>\r\n\r\n                          <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\"></label>\r\n                            <input\r\n                              type=\"text\"\r\n                              value={planData.price}\r\n                              onChange={(e) => handleContentChange(planType, 'price', e.target.value)}\r\n                              className=\"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\r\n                            />\r\n                          </div>\r\n\r\n                          <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\"></label>\r\n                            <input\r\n                              type=\"text\"\r\n                              value={planData.period}\r\n                              onChange={(e) => handleContentChange(planType, 'period', e.target.value)}\r\n                              className=\"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\r\n                            />\r\n                          </div>\r\n\r\n                          <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\"></label>\r\n                            <textarea\r\n                              value={planData.description}\r\n                              onChange={(e) => handleContentChange(planType, 'description', e.target.value)}\r\n                              rows={3}\r\n                              className=\"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\r\n                            />\r\n                          </div>\r\n\r\n                          <div>\r\n                            <div className=\"flex items-center justify-between mb-2\">\r\n                              <label className=\"block text-sm font-medium text-gray-700\"></label>\r\n                              <button\r\n                                onClick={() => addFeature(planType)}\r\n                                className=\"text-sm text-purple-600 hover:text-purple-800\"\r\n                              >\r\n                                +  \r\n                              </button>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                              {planData.features.map((feature, index) => (\r\n                                <div key={index} className=\"flex items-center gap-2\">\r\n                                  <input\r\n                                    type=\"text\"\r\n                                    value={feature}\r\n                                    onChange={(e) => handleFeatureChange(planType, index, e.target.value)}\r\n                                    className=\"flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm\"\r\n                                  />\r\n                                  <button\r\n                                    onClick={() => removeFeature(planType, index)}\r\n                                    className=\"text-red-500 hover:text-red-700\"\r\n                                  >\r\n                                    <X className=\"w-4 h-4\" />\r\n                                  </button>\r\n                                </div>\r\n                              ))}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"space-y-3\">\r\n                          <div className=\"text-2xl font-bold text-purple-600\">{planData.price}</div>\r\n                          <div className=\"text-sm text-gray-600\">{planData.period}</div>\r\n                          <div className=\"text-sm text-gray-700\">{planData.description}</div>\r\n                          <div className=\"space-y-1\">\r\n                            <div className=\"text-sm font-medium text-gray-700\">:</div>\r\n                            {planData.features.map((feature, index) => (\r\n                              <div key={index} className=\"text-xs text-gray-600 flex items-center gap-1\">\r\n                                <CheckCircle className=\"w-3 h-3 text-green-500\" />\r\n                                {feature}\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  ))}\r\n              </div>\r\n            </div>\r\n\r\n\r\n            \r\n            {/*  /  */}\r\n            {editModalOpen && (\r\n              <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40\">\r\n                <div className=\"bg-white w-full max-w-2xl rounded-xl shadow-lg p-6\">\r\n                  <div className=\"flex items-center justify-between mb-4\">\r\n                    <h4 className=\"text-lg font-semibold\">\r\n                      {isNewPlan ? '  ' : ` ${editModalPlanType === 'monthly' ? ' ' : editModalPlanType === 'yearly' ? ' ' : editModalPlanType === 'lifetime' ? '  ' : '  '}`}\r\n                    </h4>\r\n                    <button onClick={() => setEditModalOpen(false)} className=\"text-gray-500 hover:text-gray-700\">\r\n                      <X className=\"w-5 h-5\" />\r\n                    </button>\r\n                  </div>\r\n\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\"> </label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={editDraft.name}\r\n                        onChange={(e) => setEditDraft((d: any) => ({ ...d, name: e.target.value }))}\r\n                        className=\"w-full p-2 border rounded-md\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\"></label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={editDraft.price}\r\n                        onChange={(e) => setEditDraft((d: any) => ({ ...d, price: e.target.value }))}\r\n                        className=\"w-full p-2 border rounded-md\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\"></label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={editDraft.period}\r\n                        onChange={(e) => setEditDraft((d: any) => ({ ...d, period: e.target.value }))}\r\n                        className=\"w-full p-2 border rounded-md\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"md:col-span-2\">\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\"></label>\r\n                      <textarea\r\n                        rows={3}\r\n                        value={editDraft.description}\r\n                        onChange={(e) => setEditDraft((d: any) => ({ ...d, description: e.target.value }))}\r\n                        className=\"w-full p-2 border rounded-md\"\r\n                      />\r\n                    </div>\r\n\r\n                    <div className=\"md:col-span-2\">\r\n                      <div className=\"flex items-center justify-between mb-2\">\r\n                        <label className=\"block text-sm font-medium text-gray-700\"></label>\r\n                        <button\r\n                          onClick={() => setEditDraft((d: any) => ({ ...d, features: [...(d.features || []), ''] }))}\r\n                          className=\"text-sm text-purple-600 hover:text-purple-800\"\r\n                        >\r\n                          +  \r\n                        </button>\r\n                      </div>\r\n                      <div className=\"space-y-2\">\r\n                        {(editDraft.features || []).map((f: string, idx: number) => (\r\n                          <div key={idx} className=\"flex items-center gap-2\">\r\n                            <input\r\n                              type=\"text\"\r\n                              value={f}\r\n                              onChange={(e) => {\r\n                                const val = e.target.value;\r\n                                setEditDraft((d: any) => {\r\n                                  const arr = [...(d.features || [])];\r\n                                  arr[idx] = val;\r\n                                  return { ...d, features: arr };\r\n                                });\r\n                              }}\r\n                              className=\"flex-1 p-2 border rounded-md text-sm\"\r\n                            />\r\n                            <button\r\n                              onClick={() => {\r\n                                setEditDraft((d: any) => {\r\n                                  const arr = [...(d.features || [])];\r\n                                  arr.splice(idx, 1);\r\n                                  return { ...d, features: arr };\r\n                                });\r\n                              }}\r\n                              className=\"text-red-500 hover:text-red-700\"\r\n                            >\r\n                              <X className=\"w-4 h-4\" />\r\n                            </button>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"mt-6 flex items-center justify-end gap-3\">\r\n                    <button\r\n                      onClick={() => setEditModalOpen(false)}\r\n                      className=\"px-4 py-2 rounded-md bg-gray-100 hover:bg-gray-200\"\r\n                    >\r\n                      \r\n                    </button>\r\n                    <button\r\n                      onClick={() => {\r\n                        if (!editModalPlanType) return;\r\n                        setContentData((prev: any) => ({\r\n                          ...prev,\r\n                          [editModalPlanType]: { ...editDraft }\r\n                        }));\r\n                        setEditModalOpen(false);\r\n                      }}\r\n                      className=\"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700\"\r\n                    >\r\n                        \r\n                    </button>\r\n                    <button\r\n                      onClick={async () => {\r\n                        if (!editModalPlanType) return;\r\n                        try {\r\n                          const adminId = auth?.currentUser?.uid || 'admin';\r\n                          await updateSinglePlan(editModalPlanType as any, editDraft, adminId);\r\n                          setContentData((prev: any) => ({ ...prev, [editModalPlanType!]: { ...editDraft } }));\r\n                          setEditModalOpen(false);\r\n                        } catch (e) {\r\n                          console.error('Immediate save failed', e);\r\n                          alert('    .       .');\r\n                        }\r\n                      }}\r\n                      className=\"px-4 py-2 rounded-md bg-purple-600 text-white hover:bg-purple-700\"\r\n                    >\r\n                       \r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n              {/*    */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n                <div className=\"mb-6\">\r\n                  <h3 className=\"text-lg font-semibold text-gray-800\">  </h3>\r\n                  <p className=\"text-sm text-gray-600 mt-1\">         .</p>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\"> </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={broadcastTitle}\r\n                      onChange={(e) => setBroadcastTitle(e.target.value)}\r\n                      placeholder=\"   \"\r\n                      className=\"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\"> </label>\r\n                    <textarea\r\n                      value={broadcastMessage}\r\n                      onChange={(e) => setBroadcastMessage(e.target.value)}\r\n                      placeholder=\"     \"\r\n                      rows={4}\r\n                      className=\"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\"> </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={broadcastLinkUrl}\r\n                      onChange={(e) => setBroadcastLinkUrl(e.target.value)}\r\n                      placeholder=\": /user/dashboard  https://example.com\"\r\n                      className=\"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500\"\r\n                    />\r\n                    <p className=\"text-xs text-gray-500 mt-1\">              .</p>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">   ()</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={broadcastActionText}\r\n                      onChange={(e) => setBroadcastActionText(e.target.value)}\r\n                      placeholder=\":  \"\r\n                      className=\"w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500\"\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex items-center justify-end gap-3\">\r\n                    <button\r\n                      onClick={handleSendBroadcast}\r\n                      disabled={sendingBroadcast}\r\n                      className=\"px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50\"\r\n                    >\r\n                      {sendingBroadcast ? ' ...' : ' '}\r\n                    </button>\r\n              </div>\r\n\r\n              {/*    Telegram Worker */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6\">\r\n                <div className=\"flex items-center justify-between mb-6\">\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold text-gray-800 flex items-center gap-2\">\r\n                      <HardDrive className=\"w-5 h-5 text-slate-600\" />    Telegram/Cloudflare Worker\r\n                    </h3>\r\n                    <p className=\"text-sm text-gray-600 mt-1\">   Worker .     Cloudflare Secrets.</p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-4 items-start lg:items-end\">\r\n                  <div className=\"lg:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\"> Cloudflare Worker</label>\r\n                    <input\r\n                      type=\"url\"\r\n                      value={telegramWorkerUrlInput}\r\n                      onChange={(e) => setTelegramWorkerUrlInput(e.target.value)}\r\n                      placeholder=\"https://summer-cake-5149.alkaptin2030.workers.dev\"\r\n                      className=\"w-full p-2 border border-gray-300 rounded-md\"\r\n                    />\r\n                    <p className=\"text-xs text-gray-500 mt-2\">    POST  \"/notify\"    .</p>\r\n                  </div>\r\n                  <div className=\"flex gap-3\">\r\n                    <button\r\n                      onClick={async () => {\r\n                        try {\r\n                          setSavingWorkerUrl(true);\r\n                          const { systemSettingsService } = await import('@/integrations/firebase/services');\r\n                          const base = (telegramWorkerUrlInput || '').trim();\r\n                          if (!base) { alert('  '); return; }\r\n                          await systemSettingsService.setTelegramWorkerUrl(base);\r\n                          alert('   Cloudflare Worker ');\r\n                        } catch (e: any) {\r\n                          console.error('Failed to save worker url', e);\r\n                          alert(e?.message ? `  : ${e.message}` : '  ');\r\n                        } finally {\r\n                          setSavingWorkerUrl(false);\r\n                        }\r\n                      }}\r\n                      className=\"flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded-lg hover:bg-slate-700 disabled:opacity-50\"\r\n                      disabled={savingWorkerUrl}\r\n                    >\r\n                      <Save className=\"w-4 h-4\" /> {savingWorkerUrl ? ' ...' : ' '}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n          \r\n          {activeTab === 'trials' && (\r\n            <div className=\"space-y-6\">\r\n              {console.log(' Trials tab rendering - users data:', users)}\r\n              {console.log(' Users count:', users?.length || 0)}\r\n              {console.log(' Users on trial:', users?.filter(user => user.isOnFreeTrial)?.length || 0)}\r\n              \r\n              {/*   */}\r\n              {loading && (\r\n                <div className=\"flex items-center justify-center py-12\">\r\n                  <div className=\"text-center\">\r\n                    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n                    <p className=\"text-gray-600\">   ...</p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              \r\n              {/*   */}\r\n              {error && !loading && (\r\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 text-center\">\r\n                  <AlertTriangle className=\"w-12 h-12 text-red-500 mx-auto mb-3\" />\r\n                  <h3 className=\"text-lg font-semibold text-red-800 mb-2\">   </h3>\r\n                  <p className=\"text-red-600 mb-4\">{error}</p>\r\n                  <p className=\"text-sm text-red-500\">     Firebase</p>\r\n                </div>\r\n              )}\r\n              \r\n              {/*   -         */}\r\n              {!loading && !error && (\r\n                <div className=\"space-y-6\">\r\n                  {/*     */}\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-500\">  </p>\r\n                      <p className=\"text-2xl font-bold text-blue-600\">\r\n                        {users.filter(user => user.isOnFreeTrial).length}\r\n                      </p>\r\n                    </div>\r\n                    <Gift className=\"w-8 h-8 text-blue-600\" />\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-500\"> </p>\r\n                      <p className=\"text-2xl font-bold text-red-600\">\r\n                        {users.filter(user => user.hasUsedFreeTrial && !user.isOnFreeTrial).length}\r\n                      </p>\r\n                    </div>\r\n                    <Clock className=\"w-8 h-8 text-red-600\" />\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-500\"> </p>\r\n                      <p className=\"text-2xl font-bold text-green-600\">\r\n                        {users.filter(user => !user.hasUsedFreeTrial && !user.isOnFreeTrial && !user.approved).length}\r\n                      </p>\r\n                    </div>\r\n                    <UserCheck className=\"w-8 h-8 text-green-600\" />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/*     */}\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n                <div className=\"p-6 border-b border-gray-200\">\r\n                  <h3 className=\"text-lg font-semibold text-gray-800\">   </h3>\r\n                  <p className=\"text-sm text-gray-500 mt-1\">       .</p>\r\n                </div>\r\n                <div className=\"p-6\">\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 items-end\">\r\n                    <div className=\"md:col-span-2\">\r\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\"> </label>\r\n                      <input\r\n                        type=\"number\"\r\n                        min={1}\r\n                        max={336}\r\n                        value={trialDurationInput}\r\n                        onChange={(e) => setTrialDurationInput(e.target.value)}\r\n                        className=\"w-full px-4 py-2 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm\"\r\n                        placeholder=\"  \"\r\n                      />\r\n                      <p className=\"text-xs text-gray-500 mt-1\"> : {trialDurationHours} {trialDurationHours >= 3 && trialDurationHours <= 10 ? '' : trialDurationHours === 2 ? '' : ''}</p>\r\n                    </div>\r\n                    <div className=\"flex items-center md:justify-end\">\r\n                      <button\r\n                        onClick={handleUpdateTrialDuration}\r\n                        disabled={isUpdatingTrialDuration}\r\n                        className=\"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium disabled:opacity-50\"\r\n                      >\r\n                        {isUpdatingTrialDuration ? ' ...' : ' '}\r\n                      </button>\r\n        </div>\r\n      </div>\r\n      </div>\r\n      </div>\r\n\r\n              {/*      */}\r\n              <div className=\"flex flex-wrap gap-2 sm:gap-4 border-b border-gray-200 mb-6\">\r\n                <button\r\n                  onClick={() => setTrialSubTab('eligible')}\r\n                  className={`pb-2 px-4 text-sm font-medium transition-colors relative whitespace-nowrap ${\r\n                    trialSubTab === 'eligible' \r\n                      ? 'text-blue-600 border-b-2 border-blue-600' \r\n                      : 'text-gray-500 hover:text-gray-700'\r\n                  }`}\r\n                >\r\n                   \r\n                  <span className=\"mr-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs\">\r\n                    {users.filter(user => !user.hasUsedFreeTrial && !user.isOnFreeTrial && !user.approved).length}\r\n                  </span>\r\n                </button>\r\n                <button\r\n                  onClick={() => setTrialSubTab('active')}\r\n                  className={`pb-2 px-4 text-sm font-medium transition-colors relative whitespace-nowrap ${\r\n                    trialSubTab === 'active' \r\n                      ? 'text-blue-600 border-b-2 border-blue-600' \r\n                      : 'text-gray-500 hover:text-gray-700'\r\n                  }`}\r\n                >\r\n                   \r\n                  <span className=\"mr-2 bg-blue-100 text-blue-600 py-0.5 px-2 rounded-full text-xs\">\r\n                    {users.filter(user => user.isOnFreeTrial).length}\r\n                  </span>\r\n                </button>\r\n                <button\r\n                  onClick={() => setTrialSubTab('expired')}\r\n                  className={`pb-2 px-4 text-sm font-medium transition-colors relative whitespace-nowrap ${\r\n                    trialSubTab === 'expired' \r\n                      ? 'text-blue-600 border-b-2 border-blue-600' \r\n                      : 'text-gray-500 hover:text-gray-700'\r\n                  }`}\r\n                >\r\n                   \r\n                  <span className=\"mr-2 bg-red-100 text-red-600 py-0.5 px-2 rounded-full text-xs\">\r\n                    {users.filter(user => user.hasUsedFreeTrial && !user.isOnFreeTrial).length}\r\n                  </span>\r\n                </button>\r\n              </div>\r\n\r\n              {/*      */}\r\n              {trialSubTab === 'eligible' && (\r\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n                <div className=\"p-6 border-b border-gray-200\">\r\n                  <h3 className=\"text-lg font-semibold text-gray-800\">   </h3>\r\n                  <p className=\"text-sm text-gray-500 mt-1\">       </p>\r\n                  {/*      */}\r\n                  <div className=\"mt-4\">\r\n                    <div className=\"relative\">\r\n                      <input\r\n                        type=\"text\"\r\n                        value={trialSearch}\r\n                        onChange={(e) => setTrialSearch(e.target.value)}\r\n                        placeholder=\"      \"\r\n                        className=\"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm\"\r\n                      />\r\n                      <Search className=\"w-4 h-4 text-gray-400 absolute left-3 top-2.5\" />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"p-6\">\r\n                  <div className=\"space-y-4\">\r\n                    {/*     */}\r\n                    {users\r\n                      .filter(user => !user.hasUsedFreeTrial && !user.isOnFreeTrial && !user.approved)\r\n                      .filter(user => {\r\n                        const q = trialSearch.trim().toLowerCase();\r\n                        if (!q) return true;\r\n                        const dn = getUserDisplayName(user).toLowerCase();\r\n                        const em = (user.email || '').toLowerCase();\r\n                        return dn.includes(q) || em.includes(q);\r\n                      })\r\n                      .map(user => (\r\n                        <div key={user.id} className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50\">\r\n                          <div className=\"flex items-center space-x-4 space-x-reverse\">\r\n                            <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\r\n                              <span className=\"text-blue-600 font-semibold\">\r\n                                {getUserInitial(user)}\r\n                              </span>\r\n                            </div>\r\n                            <div>\r\n                              <h4 className=\"font-medium text-gray-800\">{getUserDisplayName(user)}</h4>\r\n                              <p className=\"text-sm text-gray-500\">{user.email}</p>\r\n                              <p className=\"text-xs text-gray-400\">\r\n                                 : {formatDate(user.createdAt)}\r\n                              </p>\r\n                            </div>\r\n                          </div>\r\n                          \r\n                          <div className=\"flex items-center space-x-3 space-x-reverse\">\r\n                            <button\r\n                              onClick={() => handleActivateFreeTrial(user.id)}\r\n                              className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium\"\r\n                            >\r\n                              {`  ${trialDurationHours} ${trialDurationHours >= 3 && trialDurationHours <= 10 ? '' : trialDurationHours === 2 ? '' : ''}`}\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    \r\n                    {users.filter(user => !user.hasUsedFreeTrial && !user.isOnFreeTrial && !user.approved).length === 0 && (\r\n                      <div className=\"text-center py-8\">\r\n                        <Gift className=\"w-12 h-12 text-gray-400 mx-auto mb-3\" />\r\n                        <p className=\"text-gray-500\">      </p>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              )}\r\n\r\n              {/*      */}\r\n              {trialSubTab === 'active' && (\r\n                <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n                  <div className=\"p-6 border-b border-gray-200\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-800\">   </h3>\r\n                    <p className=\"text-sm text-gray-500 mt-1\">     </p>\r\n                    {/*     */}\r\n                    <div className=\"mt-4\">\r\n                      <div className=\"relative\">\r\n                        <input\r\n                          type=\"text\"\r\n                          value={trialSearch}\r\n                          onChange={(e) => setTrialSearch(e.target.value)}\r\n                          placeholder=\"      \"\r\n                          className=\"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm\"\r\n                        />\r\n                        <Search className=\"w-4 h-4 text-gray-400 absolute left-3 top-2.5\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"p-6\">\r\n                    <div className=\"space-y-4\">\r\n                      {users\r\n                        .filter(user => user.isOnFreeTrial)\r\n                        .filter(user => {\r\n                          const q = trialSearch.trim().toLowerCase();\r\n                          if (!q) return true;\r\n                          const dn = getUserDisplayName(user).toLowerCase();\r\n                          const em = (user.email || '').toLowerCase();\r\n                          return dn.includes(q) || em.includes(q);\r\n                        })\r\n                        .map(user => (\r\n                          <div key={user.id} className=\"flex items-center justify-between p-4 border border-blue-200 rounded-lg bg-blue-50\">\r\n                            <div className=\"flex items-center space-x-4 space-x-reverse\">\r\n                              <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\r\n                                <span className=\"text-blue-600 font-semibold\">\r\n                                  {getUserInitial(user)}\r\n                                </span>\r\n                              </div>\r\n                              <div>\r\n                                <h4 className=\"font-medium text-gray-800\">{getUserDisplayName(user)}</h4>\r\n                                <p className=\"text-sm text-gray-500\">{user.email}</p>\r\n                                <p className=\"text-xs text-blue-600\">\r\n                                   : {user.freeTrialEndDate ? formatDate(user.freeTrialEndDate) : ' '}\r\n                                </p>\r\n                              </div>\r\n                            </div>\r\n                            \r\n                          <div className=\"flex items-center space-x-3 space-x-reverse\">\r\n                            <span className=\"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium\">\r\n                              \r\n                            </span>\r\n                            <button\r\n                              onClick={() => handleResetUserTrialEnd(user.id)}\r\n                              className=\"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-xs\"\r\n                            >\r\n                                \r\n                            </button>\r\n                            <button\r\n                              onClick={() => handleCancelFreeTrial(user.id)}\r\n                              className=\"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 text-xs\"\r\n                            >\r\n                               \r\n                            </button>\r\n                          </div>\r\n                          </div>\r\n                        ))}\r\n                        {users.filter(user => user.isOnFreeTrial).length === 0 && (\r\n                          <div className=\"text-center py-8\">\r\n                            <Gift className=\"w-12 h-12 text-gray-400 mx-auto mb-3\" />\r\n                            <p className=\"text-gray-500\">    </p>\r\n                          </div>\r\n                        )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/*     */}\r\n              {trialSubTab === 'expired' && (\r\n                <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n                  <div className=\"p-6 border-b border-gray-200\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-800\">   </h3>\r\n                    <p className=\"text-sm text-gray-500 mt-1\">    </p>\r\n                    {/*   */}\r\n                    <div className=\"mt-4\">\r\n                      <div className=\"relative\">\r\n                        <input\r\n                          type=\"text\"\r\n                          value={trialSearch}\r\n                          onChange={(e) => setTrialSearch(e.target.value)}\r\n                          placeholder=\"      \"\r\n                          className=\"w-full px-4 py-2 pl-10 rounded-md border border-gray-300 focus:border-blue-500 focus:ring-blue-500 text-sm\"\r\n                        />\r\n                        <Search className=\"w-4 h-4 text-gray-400 absolute left-3 top-2.5\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"p-6\">\r\n                    <div className=\"space-y-4\">\r\n                      {users\r\n                        .filter(user => user.hasUsedFreeTrial && !user.isOnFreeTrial)\r\n                        .filter(user => {\r\n                          const q = trialSearch.trim().toLowerCase();\r\n                          if (!q) return true;\r\n                          const dn = getUserDisplayName(user).toLowerCase();\r\n                          const em = (user.email || '').toLowerCase();\r\n                          return dn.includes(q) || em.includes(q);\r\n                        })\r\n                        .map(user => (\r\n                          <div key={user.id} className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50\">\r\n                            <div className=\"flex items-center space-x-4 space-x-reverse\">\r\n                              <div className=\"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center\">\r\n                                <span className=\"text-gray-600 font-semibold\">\r\n                                  {getUserInitial(user)}\r\n                                </span>\r\n                              </div>\r\n                              <div>\r\n                                <h4 className=\"font-medium text-gray-800\">{getUserDisplayName(user)}</h4>\r\n                                <p className=\"text-sm text-gray-500\">{user.email}</p>\r\n                                <p className=\"text-xs text-red-500\">\r\n                                   \r\n                                </p>\r\n                              </div>\r\n                            </div>\r\n                            \r\n                            <div className=\"flex items-center space-x-3 space-x-reverse\">\r\n                              <button\r\n                                onClick={() => handleActivateFreeTrial(user.id)}\r\n                                className=\"px-3 py-1 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-xs\"\r\n                              >\r\n                                  \r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                        \r\n                        {users.filter(user => user.hasUsedFreeTrial && !user.isOnFreeTrial).length === 0 && (\r\n                          <div className=\"text-center py-8\">\r\n                            <Clock className=\"w-12 h-12 text-gray-400 mx-auto mb-3\" />\r\n                            <p className=\"text-gray-500\">    </p>\r\n                          </div>\r\n                        )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/*        */}\r\n\r\n          {activeTab === 'whatsapp' && (\r\n            <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-200\">\r\n              <div className=\"flex items-center gap-3 mb-6\">\r\n                <MessageCircle className=\"w-6 h-6 text-green-600\" />\r\n                <h3 className=\"text-lg font-semibold text-gray-800\"> </h3>\r\n              </div>\r\n              <WhatsAppManagement />\r\n            </div>\r\n          )}\r\n\r\n          {activeTab === 'analytics' && (\r\n            <div className=\"bg-white rounded-lg p-8 shadow-sm border border-gray-200 text-center\">\r\n              <Activity className=\"w-16 h-16 text-gray-400 mx-auto mb-4\" />\r\n              <h3 className=\"text-lg font-semibold text-gray-800 mb-2\"></h3>\r\n              <p className=\"text-gray-500\">   </p>\r\n            </div>\r\n          )}\r\n        </main>\r\n      </div>\r\n\r\n      \r\n\r\n      {/*     */}\r\n      {cancelSubscriptionModalOpen && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40\">\r\n          <div className=\"bg-white w-full max-w-md rounded-xl shadow-lg p-6 animate-in fade-in zoom-in duration-200\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h4 className=\"text-lg font-semibold text-gray-800\">\r\n                  \r\n              </h4>\r\n              <button onClick={() => setCancelSubscriptionModalOpen(false)} className=\"text-gray-500 hover:text-gray-700\">\r\n                <X className=\"w-5 h-5\" />\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"mb-6\">\r\n              <p className=\"text-gray-600\">\r\n                         \r\n                <span className=\"font-semibold text-gray-800 mx-1\">\r\n                  {userToCancel ? getUserDisplayName(userToCancel) : ''}\r\n                </span>\r\n                \r\n              </p>\r\n              <p className=\"text-red-500 text-sm mt-2 font-medium bg-red-50 p-2 rounded border border-red-100\">\r\n                <AlertTriangle className=\"w-4 h-4 inline-block ml-1\" />\r\n                    .\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"flex items-center justify-end gap-3\">\r\n              <button\r\n                onClick={() => setCancelSubscriptionModalOpen(false)}\r\n                className=\"px-4 py-2 rounded-md bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium\"\r\n              >\r\n                \r\n              </button>\r\n              <button\r\n                onClick={async () => {\r\n                  if (userToCancel) {\r\n                    await handleDeactivateSubscription(userToCancel.id);\r\n                    setCancelSubscriptionModalOpen(false);\r\n                  }\r\n                }}\r\n                className=\"px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700 font-medium shadow-sm\"\r\n              >\r\n                  \r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/*     */}\r\n      <ActivationModal\r\n        isOpen={activationModalOpen}\r\n        onClose={() => setActivationModalOpen(false)}\r\n        user={selectedUserForActivation}\r\n        onActivate={async (userId, planId, customStart, customEnd) => {\r\n          try {\r\n            await handleActivateSubscription(userId, planId, null, customStart, customEnd);\r\n            alert('   ');\r\n            setActivationModalOpen(false);\r\n          } catch (error) {\r\n            console.error('   :', error);\r\n            alert('    ');\r\n          }\r\n        }}\r\n      />\r\n\r\n      {/* Notification Center */}\r\n      <NotificationCenter\r\n        isOpen={notificationCenterOpen}\r\n        onClose={() => setNotificationCenterOpen(false)}\r\n      />\r\n\r\n      {/* Notification Alert */}\r\n      <NotificationAlert\r\n        notification={currentAlert}\r\n        onClose={handleCloseAlert}\r\n        soundEnabled={notificationSettings.soundAlerts}\r\n        onToggleSound={handleToggleSound}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminDashboard;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport AdminDashboard from '../pages/AdminDashboard';\r\nimport { auth } from '../firebase';\r\nimport { collection, query, getDocs } from 'firebase/firestore';\r\nimport { db } from '../firebase';\r\nimport { loadContentFromFirebase as loadPlans, saveContentToFirebase as savePlans, getLastUpdateInfo } from '@/utils/contentService';\r\nimport LogoLoader from '@/components/LogoLoader';\r\n\r\nconst ProtectedAdminDashboard = () => {\r\n  const navigate = useNavigate();\r\n  const { user, loading: authLoading } = useFirebaseAuth();\r\n  const [devMode, setDevMode] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const mergeUsers = (rUsers: any[], pMap: Record<string, any>) => {\r\n    return rUsers.map((u) => {\r\n      const p = pMap[u.id] || {};\r\n      const fullName = typeof p.fullName === 'string' ? p.fullName : undefined;\r\n      const phone = typeof p.phone === 'string' ? p.phone : undefined;\r\n      const displayName = (typeof u.displayName === 'string' && u.displayName.trim())\r\n        ? u.displayName\r\n        : (fullName || u.displayName || undefined);\r\n      return {\r\n        ...u,\r\n        displayName,\r\n        phone: u.phone ?? phone ?? null,\r\n      };\r\n    });\r\n  };\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  \r\n  const [activeTab, setActiveTab] = useState('users');\r\n  const [notificationCount, setNotificationCount] = useState(0);\r\n  \r\n  const [rawUsers, setRawUsers] = useState<any[]>([]);\r\n  const [profilesMap, setProfilesMap] = useState<Record<string, any>>({});\r\n  \r\n  const [users, setUsers] = useState<any[]>([]);\r\n  const [filteredUsers, setFilteredUsers] = useState<any[]>([]);\r\n  \r\n  const [isSavingContent, setIsSavingContent] = useState(false);\r\n  const [lastUpdateInfo, setLastUpdateInfo] = useState<any>(null);\r\n\r\n  // Check for dev mode on component mount\r\n  useEffect(() => {\r\n    const devModeEnabled = localStorage.getItem('admin_dev_mode') === 'true';\r\n    setDevMode(devModeEnabled);\r\n  }, []);\r\n\r\n  //     \r\n  const refreshData = async (silent = false) => {\r\n    if (!devMode && !user) return;\r\n    \r\n    if (!silent) setLoading(true);\r\n    setError(null);\r\n    try {\r\n      //  \r\n      const usersQuery = query(collection(db, 'users'));\r\n      const usersSnap = await import('firebase/firestore').then(m => m.getDocs(usersQuery));\r\n      const fullUsers = usersSnap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n      setRawUsers(fullUsers);\r\n\r\n      //  \r\n      const profilesQuery = query(collection(db, 'profiles'));\r\n      const profilesSnap = await import('firebase/firestore').then(m => m.getDocs(profilesQuery));\r\n      const fullProfiles: Record<string, any> = {};\r\n      profilesSnap.forEach((doc) => {\r\n        fullProfiles[doc.id] = doc.data();\r\n      });\r\n      setProfilesMap(fullProfiles);\r\n      \r\n      if (!silent) setLoading(false);\r\n    } catch (error) {\r\n      console.error('Error refreshing data:', error);\r\n      if (!devMode && rawUsers.length === 0) {\r\n        setError('   ');\r\n      }\r\n      if (!silent) setLoading(false);\r\n    }\r\n  };\r\n\r\n  //    \r\n  useEffect(() => {\r\n    refreshData();\r\n  }, [user, devMode]);\r\n\r\n  // New: Merge raw users with profilesMap to fill displayName and phone\r\n  useEffect(() => {\r\n    // console.log('ProtectedAdminDashboard: Merging users. Raw count:', rawUsers.length);\r\n    const merged = rawUsers.map((u) => {\r\n      const p = profilesMap[u.id] || {};\r\n      const fullName = typeof p.fullName === 'string' ? p.fullName : undefined;\r\n      const phone = typeof p.phone === 'string' ? p.phone : undefined;\r\n      const displayName = (typeof u.displayName === 'string' && u.displayName.trim())\r\n        ? u.displayName\r\n        : (fullName || u.displayName || undefined);\r\n      return {\r\n        ...u,\r\n        displayName,\r\n        phone: u.phone ?? phone ?? null,\r\n      };\r\n    });\r\n    \r\n    // Always update users and filteredUsers to ensure they are in sync\r\n    // This fixes the issue where users might disappear if filteredUsers gets out of sync\r\n    setUsers(merged);\r\n  }, [rawUsers, profilesMap]);\r\n\r\n  // Dummy functions for props that AdminDashboard expects\r\n  const setNotificationCenterOpen = (open: boolean) => {\r\n    console.log('Notification center:', open);\r\n  };\r\n\r\n  const setNotificationSettings = (settings: any) => {\r\n    console.log('Notification settings:', settings);\r\n  };\r\n\r\n  const setNotifications = (notifications: any[]) => {\r\n    console.log('Notifications:', notifications);\r\n  };\r\n\r\n  const setEditingPlan = (plan: any) => {\r\n    console.log('Editing plan:', plan);\r\n  };\r\n\r\n  useEffect(() => {\r\n    //        (  )\r\n    if (!user) return;\r\n    (async () => {\r\n      try {\r\n        const info = await getLastUpdateInfo();\r\n        setLastUpdateInfo(info);\r\n      } catch (e) {\r\n        console.warn('Failed to load last update info:', e);\r\n        setLastUpdateInfo(null);\r\n      }\r\n    })();\r\n  }, [user]);\r\n\r\n  const loadContentFromFirebase = async () => {\r\n    try {\r\n      const data = await loadPlans();\r\n      return data;\r\n    } catch (e) {\r\n      console.error('Error loading content:', e);\r\n      return {};\r\n    }\r\n  };\r\n\r\n  const saveContentToFirebase = async (content: any) => {\r\n    try {\r\n      setIsSavingContent(true);\r\n      await savePlans(content, user?.uid || 'admin');\r\n      const info = await getLastUpdateInfo();\r\n      setLastUpdateInfo(info);\r\n      return true;\r\n    } catch (e) {\r\n      console.error('Error saving content:', e);\r\n      return false;\r\n    } finally {\r\n      setIsSavingContent(false);\r\n    }\r\n  };\r\n\r\n  if (authLoading) {\r\n    return <LogoLoader />;\r\n  }\r\n\r\n  return (\r\n    <AdminDashboard\r\n      navigate={navigate}\r\n      auth={auth}\r\n      devMode={devMode}\r\n      setDevMode={setDevMode}\r\n      error={error}\r\n      setError={setError}\r\n      authLoading={authLoading}\r\n      setAuthLoading={() => {}} // Firebase auth handles this\r\n      activeTab={activeTab}\r\n      setActiveTab={setActiveTab}\r\n      setNotificationCenterOpen={setNotificationCenterOpen}\r\n      setNotificationSettings={setNotificationSettings}\r\n      setNotifications={setNotifications}\r\n      notificationCount={notificationCount}\r\n      setNotificationCount={setNotificationCount}\r\n      users={users}\r\n      setUsers={setUsers}\r\n      loading={loading}\r\n      setLoading={setLoading}\r\n      setEditingPlan={setEditingPlan}\r\n      isSavingContent={isSavingContent}\r\n      setIsSavingContent={setIsSavingContent}\r\n      lastUpdateInfo={lastUpdateInfo}\r\n      loadContentFromFirebase={loadContentFromFirebase}\r\n      saveContentToFirebase={saveContentToFirebase}\r\n      refreshData={refreshData}\r\n    />\r\n  );\r\n};\r\n\r\nexport default ProtectedAdminDashboard;\r\n"],"file":"assets/ProtectedAdminDashboard-w6rKnhqP.js"}