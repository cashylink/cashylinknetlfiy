import{C as O,d as V,S as i,I as e,t as f,a as d,A as N}from"./index-BsVRzvOf.js";import{o as q,c as z,i as D,l as F}from"./card-SlwaggFS-BswsJdJN.js";import{o as G,$ as H,r as I,Z as J,Q as L}from"./select-QKdc2TYn-4nnF_b5r.js";const P=[{label:"Vodafone",value:"Vodafone"},{label:"Orange",value:"Orange"},{label:"Etisalat",value:"Etisalat"},{label:"WE",value:"WE"}],y=u=>{const s=u.replace(/\D/g,"");return s.length===10||s.length===11},B=()=>{const u=O(),{toast:s}=V(),[l,w]=i.useState(""),[C,Q]=i.useState("EG"),[h,S]=i.useState("Vodafone"),[c,k]=i.useState(""),[o,x]=i.useState(!1),[X,m]=i.useState(!1),E=async t=>{if(t.preventDefault(),!y(l)){s({title:"رقم غير صالح",description:"من فضلك أدخل رقم مصري صحيح (10 أو 11 رقم)",variant:"destructive"});return}const n=Number(c);if(!Number.isFinite(n)||n<=0){s({title:"قيمة غير صالحة",description:"من فضلك أدخل مبلغ صحيح بالجنيه المصري",variant:"destructive"});return}m(!0)},$=async()=>{var t,n,v;m(!1);const T="alkaptin678678@gmail.com",p=(n=(t=N.currentUser)==null?void 0:t.email)==null?void 0:n.toLowerCase();if(!p||p!==T){s({title:"قيد الإنشاء",description:"ميزة الشحن متاحة لهذا الحساب فقط حالياً."});return}x(!0);try{const r=new AbortController,A=setTimeout(()=>r.abort(),15e3),b=await((v=N.currentUser)==null?void 0:v.getIdToken()),j=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...b?{Authorization:`Bearer ${b}`}:{}},body:JSON.stringify({phone:l,countryCode:C,operator:h,amount:Number(c),useLocalAmount:!0}),signal:r.signal});clearTimeout(A);const g=await j.text();let a;try{a=JSON.parse(g)}catch{a={success:!1,message:g||"فشل قراءة استجابة الخادم"}}j.ok&&a!=null&&a.success?s({title:"تم الشحن",description:(a==null?void 0:a.message)||"تم تنفيذ عملية الشحن بنجاح"}):s({title:"فشل الشحن",description:(a==null?void 0:a.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(r){console.error("Topup request error:",r),(r==null?void 0:r.name)==="AbortError"?s({title:"انتهت المهلة",description:"الخادم لم يستجب في الوقت المحدد. تأكد أن السيرفر يعمل.",variant:"destructive"}):s({title:"خطأ في الاتصال",description:"تعذر الاتصال بالخادم. حاول لاحقاً.",variant:"destructive"})}finally{x(!1)}};return e.jsxs("div",{className:"min-h-screen p-4",children:[e.jsxs(q,{className:"max-w-md mx-auto",children:[e.jsx(z,{children:e.jsx(D,{className:"text-right",children:"شحن رصيد الموبايل"})}),e.jsx(F,{children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-right mb-1",children:"رقم الموبايل"}),e.jsx(f,{value:l,onChange:t=>w(t.target.value),placeholder:"01XXXXXXXXX",dir:"ltr"}),!y(l)&&l.length>0&&e.jsx("p",{className:"text-xs text-red-600 mt-1 text-right",children:"رقم غير صالح (10 أو 11 رقم)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-right mb-1",children:"الشركة"}),e.jsxs(G,{value:h,onValueChange:S,children:[e.jsx(H,{className:"w-full",children:e.jsx(I,{placeholder:"اختر الشركة"})}),e.jsx(J,{children:P.map(t=>e.jsx(L,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-right mb-1",children:"المبلغ بالجنيه (EGP)"}),e.jsx(f,{type:"number",inputMode:"decimal",value:c,onChange:t=>k(t.target.value),placeholder:"مثال: 10",dir:"ltr"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>u(-1),children:"رجوع"}),e.jsx(d,{type:"submit",disabled:o,children:o?"جارٍ التنفيذ...":"شحن"})]})]})})]}),X&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 w-[90%] max-w-md",children:[e.jsx("h2",{className:"text-lg font-semibold text-right mb-2",children:"تأكيد العملية"}),e.jsxs("p",{className:"text-right mb-4",children:["هتشحن رقم ",l," مبلغ ",c," جنيه — تأكيد؟"]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(d,{variant:"outline",onClick:()=>m(!1),children:"إلغاء"}),e.jsx(d,{onClick:$,disabled:o,children:o?"جارٍ التنفيذ...":"تأكيد"})]})]})})]})};export{B as default};
//# sourceMappingURL=TopUpPage-D1sGJ46Q-JRDLPoEf.js.map
