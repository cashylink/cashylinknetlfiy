import{d as $,S as r,I as e,t as x,a as N,o as k,g as S,i as F,R as I,G as C,U as A,A as D}from"./index-C_crvORM.js";import{o as T,c as G,i as H,l as R}from"./card-SlwaggFS-CAdsFCUe.js";import{u as m}from"./label-_mnIMROJ-DCx9a6ad.js";import{l as q,n as J}from"./textarea-DK4Tmvmm-BLT-W9oy.js";import{o as K}from"./link-BcnlpFfX-0X6LnnsC.js";const M=()=>{const{toast:a}=$(),[u,p]=r.useState(""),[v,y]=r.useState(""),[j,f]=r.useState(""),[n,c]=r.useState(!1),[d,g]=r.useState(""),w=async s=>{var l;if(s.preventDefault(),!u.trim()||!v.trim()){a({title:"خطأ",description:"العنوان والنص مطلوبان",variant:"destructive"});return}try{c(!0);const t={title:u.trim(),body:v.trim(),link:j.trim()||""};if(d.trim()){const o=k(S,"sendFcmToUser"),i={};t.link&&(i.link=t.link);const b=await o({userId:d.trim(),title:t.title,body:t.body,data:i}),h=!!((l=b==null?void 0:b.data)!=null&&l.ok);a({title:h?"تم الإرسال":"تحذير",description:h?`أُرسل إلى المستخدم ${d}`:"لا توجد أجهزة مسجلة لهذا المستخدم",variant:h?void 0:"destructive"})}else await F(I(C,"broadcasts"),{title:t.title,message:t.body,linkUrl:t.link||void 0,audienceKey:"global",active:!0,createdAt:A()}),a({title:"تم الإرسال",description:"تم إنشاء بث عام وسيتم إرسال الإشعار"});p(""),y(""),f(""),g("")}catch(t){a({title:"فشل الإرسال",description:String((t==null?void 0:t.message)||t),variant:"destructive"})}finally{c(!1)}},U=async()=>{var s,l;try{const t=((s=D.currentUser)==null?void 0:s.uid)||"";if(!t){a({title:"غير مسجل",description:"سجّل الدخول كأدمن لإرسال اختبار",variant:"destructive"});return}c(!0);const o=await k(S,"sendFcmToUser")({userId:t,title:"إشعار اختبار",body:"تم إرسال إشعار تجريبي بنجاح",data:{type:"test"}}),i=!!((l=o==null?void 0:o.data)!=null&&l.ok);a({title:i?"تم إرسال الاختبار":"فشل الاختبار",description:i?"تفقد هاتفك الآن":"تحقق من حفظ توكن الجهاز",variant:i?void 0:"destructive"})}catch(t){a({title:"فشل الاختبار",description:String((t==null?void 0:t.message)||t),variant:"destructive"})}finally{c(!1)}};return e.jsx("div",{className:"min-h-screen p-4",children:e.jsxs(T,{className:"max-w-xl mx-auto",children:[e.jsx(G,{children:e.jsxs(H,{className:"flex items-center gap-2 text-base",children:[e.jsx(q,{className:"h-4 w-4"}),"إرسال إشعار خارجي"]})}),e.jsx(R,{className:"space-y-4",children:e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"userId",children:"إرسال لمستخدم محدد (اختياري)"}),e.jsx(x,{id:"userId",value:d,onChange:s=>g(s.target.value),placeholder:"أدخل معرف المستخدم (UID)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"إذا تركته فارغاً سيتم إرسال إشعار عام للجميع."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"title",children:"العنوان"}),e.jsx(x,{id:"title",value:u,onChange:s=>p(s.target.value),placeholder:"عنوان الإشعار"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"body",children:"النص"}),e.jsx(J,{id:"body",value:v,onChange:s=>y(s.target.value),placeholder:"نص الإشعار",className:"min-h-[120px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{htmlFor:"link",className:"flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3"})," رابط اختياري"]}),e.jsx(x,{id:"link",value:j,onChange:s=>f(s.target.value),placeholder:"https://example.com أو cashy://..."})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(N,{type:"button",onClick:U,disabled:n,variant:"outline",children:n?"...":"إرسال اختبار لنفسي"}),e.jsx(N,{type:"submit",disabled:n,className:"px-6",children:n?"جاري الإرسال...":"إرسال"})]})]})})]})})};export{M as default};
//# sourceMappingURL=AdminNotificationsPage-DrTU2ja9-BsABTxfv.js.map
