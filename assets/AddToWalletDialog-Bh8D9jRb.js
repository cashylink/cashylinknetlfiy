import{r,j as e,a5 as O,a6 as q,a7 as H,a8 as V,ap as v,aw as y,v as i,B as d,I as w,E as z,F as I,D as R}from"./index-bCWIXU_s.js";import{M as S}from"./MasterPinDialog-A5-_nbFS.js";import{C as W}from"./circle-alert-BxhCUO6U.js";function Q({open:p,onOpenChange:C,onSuccess:P,title:k,description:D,currentBalance:o,balanceLabel:E,userId:m}){const[x,f]=r.useState(""),[n,j]=r.useState(""),[s,h]=r.useState("add"),[u,F]=r.useState(!1),[N,l]=r.useState(""),[b,c]=r.useState(!1),[M,L]=r.useState(!1);r.useEffect(()=>{let a=!0;return(async()=>{const t=await S.hasMasterPin(m);a&&L(t)})(),()=>{a=!1}},[m,p]);const A=async a=>{a.preventDefault(),l(""),c(!0);try{const t=parseFloat(n);if(isNaN(t)||t<=0){l("يرجى إدخال مبلغ صحيح أكبر من صفر"),c(!1);return}if(s==="subtract"&&t>o){l("لا يمكن خصم مبلغ أكبر من الرصيد الحالي"),c(!1);return}if(M)if(await S.verifyMasterPin(x,m)){const $=s==="add"?t:-t;g(),P($)}else l("الرقم السري غير صحيح");else l("لم يتم تعيين الرقم السري الرئيسي. يرجى تعيينه من إعدادات البروفيل أولاً")}catch{l("حدث خطأ أثناء التحقق من الرقم السري")}finally{c(!1)}},g=()=>{f(""),j(""),h("add"),l(""),C(!1)},T=()=>{const a=parseFloat(n)||0;return s==="add"?o+a:o-a};return e.jsx(O,{open:p,onOpenChange:g,children:e.jsxs(q,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(H,{children:e.jsxs(V,{className:"flex items-center gap-2 text-right",children:[s==="add"?e.jsx(v,{className:"h-5 w-5 text-green-600"}):e.jsx(y,{className:"h-5 w-5 text-red-600"}),k]})}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground text-right",children:D}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs(i,{className:"text-sm font-medium text-gray-700",children:[E," الحالي"]}),e.jsxs("div",{className:"text-lg font-bold text-gray-900 mt-1",children:[o.toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-right",children:"نوع العملية"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{type:"button",variant:s==="add"?"default":"outline",onClick:()=>h("add"),className:"flex-1 flex items-center gap-2",children:[e.jsx(v,{className:"h-4 w-4"}),"إضافة"]}),e.jsxs(d,{type:"button",variant:s==="subtract"?"default":"outline",onClick:()=>h("subtract"),className:"flex-1 flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"خصم"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"amount",className:"text-right",children:["المبلغ المراد ",s==="add"?"إضافته":"خصمه"]}),e.jsx(w,{id:"amount",type:"number",step:"0.01",min:"0.01",value:n,onChange:a=>j(a.target.value),placeholder:`أدخل المبلغ المراد ${s==="add"?"إضافته":"خصمه"}`,className:"text-right",required:!0})]}),n&&!isNaN(parseFloat(n))&&e.jsxs("div",{className:`p-3 rounded-lg ${s==="add"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[e.jsx(i,{className:"text-sm font-medium text-gray-700",children:"الرصيد الجديد المتوقع"}),e.jsxs("div",{className:`text-lg font-bold mt-1 ${s==="add"?"text-green-700":"text-red-700"}`,children:[T().toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"pin",className:"text-right",children:"الرقم السري"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{id:"pin",type:u?"text":"password",autoComplete:"off",value:x,onChange:a=>f(a.target.value),placeholder:"أدخل الرقم السري",className:"text-right pr-10",required:!0}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>F(!u),children:u?e.jsx(z,{className:"h-4 w-4"}):e.jsx(I,{className:"h-4 w-4"})})]})]}),N&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600 bg-red-50 p-2 rounded",children:[e.jsx(W,{className:"h-4 w-4"}),N]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:g,className:"flex-1",children:"إلغاء"}),e.jsx(d,{type:"submit",disabled:b||!x||!n,className:`flex-1 ${s==="add"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:b?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"جاري التحديث..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),s==="add"?"إضافة المبلغ":"خصم المبلغ"]})})]})]})]})})}export{Q as AddToWalletDialog};
//# sourceMappingURL=AddToWalletDialog-Bh8D9jRb.js.map
