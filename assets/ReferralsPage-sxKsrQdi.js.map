{"version":3,"file":"ReferralsPage-sxKsrQdi.js","sources":["../../src/pages/ReferralsPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { \r\n  Share2, \r\n  Users, \r\n  Copy, \r\n  CheckCircle, \r\n  Clock, \r\n  XCircle,\r\n  Gift,\r\n  Link as LinkIcon,\r\n  UserPlus\r\n} from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { referralService } from '@/integrations/firebase/services';\r\nimport { Referral } from '@/integrations/firebase/types';\r\n\r\nconst ReferralsPage = () => {\r\n  const { user, profile } = useFirebaseAuth();\r\n  const { toast } = useToast();\r\n  const [referrals, setReferrals] = useState<Referral[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [copySuccess, setCopySuccess] = useState(false);\r\n\r\n  // إنشاء رابط الإحالة\r\n  const referralLink = profile?.referralCode \r\n    ? `${window.location.origin}/register?ref=${profile.referralCode}`\r\n    : '';\r\n\r\n  useEffect(() => {\r\n    if (user?.uid) {\r\n      loadReferrals();\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, [user]);\r\n\r\n  const loadReferrals = async () => {\r\n    try {\r\n      setLoading(true);\r\n      if (user?.uid) {\r\n        const userReferrals = await referralService.getByReferrerId(user.uid);\r\n        setReferrals(userReferrals);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading referrals:', error);\r\n      toast({\r\n        title: \"خطأ في تحميل الإحالات\",\r\n        description: \"حدث خطأ أثناء تحميل قائمة الإحالات\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const copyReferralLink = async () => {\r\n    try {\r\n      await navigator.clipboard.writeText(referralLink);\r\n      setCopySuccess(true);\r\n      toast({\r\n        title: \"تم النسخ بنجاح\",\r\n        description: \"تم نسخ رابط الإحالة إلى الحافظة\",\r\n      });\r\n      setTimeout(() => setCopySuccess(false), 2000);\r\n    } catch (error) {\r\n      toast({\r\n        title: \"خطأ في النسخ\",\r\n        description: \"حدث خطأ أثناء نسخ الرابط\",\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return (\r\n          <Badge variant=\"default\" className=\"bg-green-100 text-green-800 border-green-200\">\r\n            <CheckCircle className=\"w-3 h-3 mr-1\" />\r\n            مكتملة\r\n          </Badge>\r\n        );\r\n      case 'pending':\r\n        return (\r\n          <Badge variant=\"secondary\" className=\"bg-yellow-100 text-yellow-800 border-yellow-200\">\r\n            <Clock className=\"w-3 h-3 mr-1\" />\r\n            قيد الانتظار\r\n          </Badge>\r\n        );\r\n      case 'cancelled':\r\n        return (\r\n          <Badge variant=\"destructive\" className=\"bg-red-100 text-red-800 border-red-200\">\r\n            <XCircle className=\"w-3 h-3 mr-1\" />\r\n            ملغية\r\n          </Badge>\r\n        );\r\n      default:\r\n        return (\r\n          <Badge variant=\"outline\">\r\n            غير محدد\r\n          </Badge>\r\n        );\r\n    }\r\n  };\r\n\r\n  const formatDate = (timestamp: any) => {\r\n    if (!timestamp) return 'غير محدد';\r\n    const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);\r\n    return date.toLocaleDateString('ar-SA', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric'\r\n    });\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background p-4\">\r\n        <div className=\"max-w-6xl mx-auto\">\r\n          <div className=\"text-center py-12\">\r\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto\"></div>\r\n            <p className=\"mt-4 text-gray-600\">جاري تحميل الإحالات...</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background p-4\">\r\n      <div className=\"max-w-6xl mx-auto space-y-6\">\r\n        {/* Header */}\r\n        <div className=\"text-center mb-8\">\r\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2 flex items-center justify-center gap-2\">\r\n            <Share2 className=\"h-8 w-8 text-green-600\" />\r\n            نظام الإحالات\r\n          </h1>\r\n          <p className=\"text-gray-600\">\r\n            ادع أصدقاءك واحصل على مكافآت عند انضمامهم\r\n          </p>\r\n        </div>\r\n\r\n        {/* رابط الإحالة */}\r\n        <Card className=\"shadow-lg border-0 bg-white/80 backdrop-blur-sm\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2 text-green-700\">\r\n              <LinkIcon className=\"h-5 w-5\" />\r\n              رابط الإحالة الخاص بك\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            {referralLink ? (\r\n              <>\r\n                <div className=\"flex gap-2\">\r\n                  <Input\r\n                    value={referralLink}\r\n                    readOnly\r\n                    className=\"flex-1 bg-gray-50 border-gray-200\"\r\n                  />\r\n                  <Button\r\n                    onClick={copyReferralLink}\r\n                    variant={copySuccess ? \"default\" : \"outline\"}\r\n                    className={copySuccess ? \"bg-green-600 hover:bg-green-700\" : \"\"}\r\n                  >\r\n                    {copySuccess ? (\r\n                      <CheckCircle className=\"h-4 w-4\" />\r\n                    ) : (\r\n                      <Copy className=\"h-4 w-4\" />\r\n                    )}\r\n                  </Button>\r\n                </div>\r\n                <Alert className=\"border-green-200 bg-green-50\">\r\n                  <Gift className=\"h-4 w-4 text-green-600\" />\r\n                  <AlertDescription className=\"text-green-700\">\r\n                    شارك هذا الرابط مع أصدقائك للحصول على مكافآت عند تسجيلهم\r\n                  </AlertDescription>\r\n                </Alert>\r\n              </>\r\n            ) : (\r\n              <Alert variant=\"destructive\">\r\n                <AlertDescription>\r\n                  لم يتم العثور على رمز الإحالة الخاص بك\r\n                </AlertDescription>\r\n              </Alert>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* إحصائيات الإحالات */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n          <Card className=\"shadow-lg border-0 bg-white/80 backdrop-blur-sm\">\r\n            <CardContent className=\"p-6\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-gray-600\">إجمالي الإحالات</p>\r\n                  <p className=\"text-2xl font-bold text-gray-900\">{referrals.length}</p>\r\n                </div>\r\n                <Users className=\"h-8 w-8 text-blue-600\" />\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"shadow-lg border-0 bg-white/80 backdrop-blur-sm\">\r\n            <CardContent className=\"p-6\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-gray-600\">الإحالات المكتملة</p>\r\n                  <p className=\"text-2xl font-bold text-green-600\">\r\n                    {referrals.filter(r => r.status === 'completed').length}\r\n                  </p>\r\n                </div>\r\n                <CheckCircle className=\"h-8 w-8 text-green-600\" />\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"shadow-lg border-0 bg-white/80 backdrop-blur-sm\">\r\n            <CardContent className=\"p-6\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-gray-600\">قيد الانتظار</p>\r\n                  <p className=\"text-2xl font-bold text-yellow-600\">\r\n                    {referrals.filter(r => r.status === 'pending').length}\r\n                  </p>\r\n                </div>\r\n                <Clock className=\"h-8 w-8 text-yellow-600\" />\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {/* قائمة الإحالات */}\r\n        <Card className=\"shadow-lg border-0 bg-white/80 backdrop-blur-sm\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <UserPlus className=\"h-5 w-5 text-green-600\" />\r\n              المستخدمون المحالون\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {referrals.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <Users className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\r\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\r\n                  لا توجد إحالات بعد\r\n                </h3>\r\n                <p className=\"text-gray-600 mb-4\">\r\n                  ابدأ بدعوة أصدقائك باستخدام رابط الإحالة أعلاه\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {referrals.map((referral) => (\r\n                  <div\r\n                    key={referral.id}\r\n                    className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg bg-gray-50/50\"\r\n                  >\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center gap-3 mb-2\">\r\n                        <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center\">\r\n                          <UserPlus className=\"h-5 w-5 text-green-600\" />\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"font-medium text-gray-900\">\r\n                            {referral.referredUserEmail}\r\n                          </p>\r\n                          <p className=\"text-sm text-gray-600\">\r\n                            تاريخ الإحالة: {formatDate(referral.createdAt)}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3\">\r\n                      {getStatusBadge(referral.status)}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ReferralsPage;"],"names":["ReferralsPage","user","profile","useFirebaseAuth","toast","useToast","referrals","setReferrals","useState","loading","setLoading","copySuccess","setCopySuccess","referralLink","useEffect","loadReferrals","userReferrals","referralService","error","copyReferralLink","getStatusBadge","status","jsxs","Badge","jsx","CheckCircle","Clock","XCircle","formatDate","timestamp","Share2","Card","CardHeader","CardTitle","LinkIcon","CardContent","Fragment","Input","Button","Copy","Alert","Gift","AlertDescription","Users","r","UserPlus","referral"],"mappings":"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"}