const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-F79wE54_.js","./index-CF_cwj-9.css"])))=>i.map(i=>d[i]);
import{m as Zt,aN as es,u as ts,ae as ss,r as o,R as Je,aO as De,s as _,t as N,q as de,j as e,af as pt,ag as xt,ah as gt,ai as ft,aP as as,B as v,aQ as rs,aJ as is,c as q,d as V,e as L,at as Se,V as T,x as te,aL as se,g as H,I as S,D as Ae,E,aR as ns,aS as vt,C as cs,_ as Ce,ad as $,v as ls}from"./index-F79wE54_.js";import{B as G}from"./badge-CL3KS5lq.js";import{S as qe}from"./separator-5VE7iToZ.js";import{A as os,a as ds,b as ms,c as hs,d as us}from"./alert-dialog-D_Ggvzn4.js";import{S as bt,a as Nt,b as yt,c as wt,d as jt}from"./select-_viMUn4-.js";import{C as ps,V as xs}from"./VideoModal-BOFkNPz9.js";import{C as gs}from"./calendar-4HaEghcA.js";const p=j=>{try{return j.toLocaleString("en-US",{maximumFractionDigits:2})}catch{return String(j)}},Ve=j=>{try{return(j?new Date(j):new Date).toLocaleString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return new Date().toISOString()}},U="machine_daily_opening_values",W="machine_daily_opening_snapshot";function ks({open:j,onOpenChange:Le}){var dt,mt;const{toast:u}=Zt(),{shiftUser:O}=es(),{user:h}=ts(),{shopId:g,shopName:Dt}=ss(),A=()=>{try{if(h!=null&&h.uid){const a=`selectedShopId_${h.uid}`,i=localStorage.getItem(a);if(i)return i}const t=Object.keys(localStorage||{}).filter(a=>a.startsWith("selectedShopId_"));for(const a of t){const i=localStorage.getItem(a);if(i)return i}return null}catch{return null}};o.useEffect(()=>{try{if(j){const t=document.body.style.overflow;document.body.setAttribute("data-prev-overflow",t),document.body.style.overflow="hidden"}else{const t=document.body.getAttribute("data-prev-overflow")||"";document.body.style.overflow=t,document.body.removeAttribute("data-prev-overflow")}}catch{}return()=>{try{const t=document.body.getAttribute("data-prev-overflow")||"";document.body.style.overflow=t,document.body.removeAttribute("data-prev-overflow")}catch{}}},[j]);const[He,fe]=o.useState(""),[Ge,ve]=o.useState(""),[Ke,ke]=o.useState(""),[K,ae]=o.useState(null),[Y,re]=o.useState(null),[_e,ie]=o.useState(null),[Q,ne]=o.useState(null),[w,J]=o.useState("opening"),[$e,Ye]=o.useState(""),[Ie,Qe]=o.useState(""),[Be,Xe]=o.useState(null),[Ze,me]=o.useState([]),[Oe,St]=o.useState([]),[X,ce]=o.useState([]),[At,Fe]=o.useState(!1),[Ct,et]=o.useState(!1),[he,Pe]=o.useState(""),[ue,Re]=o.useState(""),[kt,be]=o.useState(!1),[F,tt]=o.useState(null),[P,Me]=o.useState([]),[r,le]=o.useState(null),[st,at]=o.useState(""),[fs,vs]=o.useState(!1),[bs,Ns]=o.useState(!1),[Te,rt]=o.useState(""),[R,it]=o.useState("rate"),[Ee,_t]=o.useState("2"),[Ue,$t]=o.useState(""),[It,Bt]=o.useState(0),[Ot,Ft]=o.useState(0),[Pt,Rt]=o.useState(0),[Mt,Tt]=o.useState(0),[Ne,Et]=o.useState(!1),[Z,pe]=o.useState(!1),ee=Je.useRef(!1),ye=Je.useRef(null),we=Je.useRef(null);o.useEffect(()=>{j&&(ee.current=!1,pe(!1))},[j]),o.useEffect(()=>{if(j)try{const t=r?`${U}_${r}`:U,a=r?`${W}_${r}`:W,i=localStorage.getItem(t);if(i){const n=JSON.parse(i);typeof(n==null?void 0:n.openingBase)=="number"&&ae(n.openingBase),typeof(n==null?void 0:n.openingAir)=="number"&&re(n.openingAir),typeof(n==null?void 0:n.drawerCash)=="number"&&ie(n.drawerCash)}else ae(null),re(null),ie(null);const m=localStorage.getItem(a);if(m){const n=JSON.parse(m);typeof(n==null?void 0:n.openingBase)=="number"&&typeof(n==null?void 0:n.openingAir)=="number"?ne({openingBase:n.openingBase,openingAir:n.openingAir,drawerCash:n.drawerCash||0}):ne(null)}else ne(null);fe(""),ve(""),ke("")}catch{}},[j,r]),o.useEffect(()=>{(async()=>{try{const t=g||A();if(!j||!t)return;const{getDocs:a}=await De(async()=>{const{getDocs:c}=await import("./index-F79wE54_.js").then(s=>s.cF);return{getDocs:c}},__vite__mapDeps([0,1]),import.meta.url),i=_(N,"shops",t,"machines"),n=(await a(de(i))).docs.map(c=>({id:c.id,name:String(c.data().name||"ماكينة"),monthlyLimit:Number(c.data().monthlyLimit||5e4)}));Me(n);try{const c=localStorage.getItem(`machineDaily_selected_${t}`);c&&n.some(l=>l.id===c)?le(c):!r&&n.length>0&&(le(n[0].id),localStorage.setItem(`machineDaily_selected_${t}`,n[0].id))}catch{}}catch(t){console.error("Load machines error:",t)}})()},[j,g]);const C=o.useMemo(()=>(O==null?void 0:O.displayName)||(O==null?void 0:O.name)||(O==null?void 0:O.username)||void 0,[O]),Ut=o.useMemo(()=>X.reduce((t,a)=>t+(a.profit||0),0),[X]),Wt=o.useMemo(()=>X.reduce((t,a)=>t+(a.wholesalePrice||0),0),[X]),zt=async()=>{try{const t=g||A();if(t&&r){const a=_(N,"shops",t,"machines",r,"transfers"),i=await te(de(a));await Promise.all(i.docs.map(m=>se(m.ref)));try{localStorage.setItem(`machineDaily_transfers_${t}_${r}`,JSON.stringify([]))}catch{}}}catch{}ce([]),u({title:"تم حذف الإيصالات",description:"تم مسح كل إيصالات التحويل."})},Jt=async()=>{try{const t=g||A();if(t&&r){const a=_(N,"shops",t,"machines",r,"deliveries"),i=await te(de(a));await Promise.all(i.docs.map(m=>se(m.ref)));try{localStorage.setItem(`machineDaily_deliveries_${t}_${r}`,JSON.stringify([]))}catch{}}}catch{}me([]),u({title:"تم حذف الإيصالات",description:"تم مسح كل إيصالات الماكينة."})},qt=async t=>{var m;if(!r)return;const a=g||A();if(!a)return;const i=[...X];ce(n=>n.filter(c=>c.id!==t.id));try{const n=K||0,c=Y||0,s=_e||0;let l=n,d=c,x=s;t.deductFrom==="base"?l=Math.round((n+t.wholesalePrice)*100)/100:t.deductFrom==="air"&&(d=Math.round((c+t.wholesalePrice)*100)/100),x=Math.round((s-t.retailPrice)*100)/100,ae(l),re(d),ie(x),Q&&ne({openingBase:l,openingAir:d,drawerCash:x});const b=`${U}_${r}`,f=`${W}_${r}`;localStorage.setItem(b,JSON.stringify({openingBase:l,openingAir:d,drawerCash:x})),localStorage.setItem(f,JSON.stringify({openingBase:l,openingAir:d,drawerCash:x}));const y=`machineDaily_transfers_${a}_${r}`,D=i.filter(oe=>oe.id!==t.id);localStorage.setItem(y,JSON.stringify(D));const I=T(N,"shops",a,"machines",r,"transfers",t.id);await se(I);const xe=T(N,"shops",a,"machines",r);if(await Ce(xe,{openingBase:l,openingAir:d,drawerCash:x,updatedAt:E()},{merge:!0}),h!=null&&h.uid){const oe=((m=P.find(z=>z.id===r))==null?void 0:m.name)||"ماكينة";await $.saveUserTransaction(h.uid,{type:"expense",amount:t.retailPrice,senderName:oe,title:"حذف إيصال تحويل",description:`إلغاء تحويل من ${oe}`,shopId:a,status:"completed",createdAt:new Date,transactionId:`del_mtr_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,cashierName:C||"Unknown"});const k=await $.getUserData(h.uid),B=Number((k==null?void 0:k.cashBalance)||0)-t.retailPrice;await $.updateUserData(h.uid,{cashBalance:B})}u({title:"تم الحذف",description:"تم حذف الإيصال واسترجاع الأرصدة."})}catch(n){console.error("Error deleting transfer receipt:",n),ce(i),u({title:"خطأ",description:"فشل حذف الإيصال.",variant:"destructive"})}},Vt=t=>{me(a=>a.filter(i=>i.id!==t)),u({title:"تم حذف الإيصال",description:"تم إزالة إيصال الماكينة المحدد."})},Lt=()=>{ae(null),re(null),ie(null),ne(null),fe(""),ve(""),ke("");try{const t=r?`${U}_${r}`:U,a=r?`${W}_${r}`:W;localStorage.removeItem(t),localStorage.removeItem(a)}catch{}u({title:"تم التصفير",description:"يمكنك الآن إدخال رصيد افتتاحي جديد."})},Ht=async()=>{var m;const t=parseFloat(He||"0"),a=parseFloat(Ge||"0"),i=parseFloat(Ke||"0");if(isNaN(t)||isNaN(a)||isNaN(i)){u({title:"قيمة غير صالحة",description:"يرجى إدخال أرقام صحيحة للرصيد الافتتاحي وفلوس الدرج.",variant:"destructive"});return}if(t<0||a<0||i<0){u({title:"قيمة سالبة",description:"لا يمكن إدخال قيم سالبة.",variant:"destructive"});return}ae(t),re(a),ie(i);try{const n=r?`${U}_${r}`:U,c=r?`${W}_${r}`:W;localStorage.setItem(n,JSON.stringify({openingBase:t,openingAir:a,drawerCash:i})),localStorage.setItem(c,JSON.stringify({openingBase:t,openingAir:a,drawerCash:i})),ne({openingBase:t,openingAir:a,drawerCash:i});const s=g||A();if(s&&r){const l=T(N,"shops",s,"machines",r);await Ce(l,{name:((m=P.find(d=>d.id===r))==null?void 0:m.name)||"ماكينة",openingBase:t,openingAir:a,drawerCash:i,cashierName:C||"Unknown",shopName:Dt||null,updatedAt:E()},{merge:!0})}}catch{}u({title:"تم تسجيل البيانات",description:`الافتتاحي الأساسي: ${p(t)}، الهواء: ${p(a)}، فلوس الدرج: ${p(i)}`})},Gt=()=>{const t=parseFloat($e||"0"),a=parseFloat(Ie||"0");if(isNaN(t)||isNaN(a)){u({title:"قيمة غير صالحة",description:"يرجى إدخال أرقام صحيحة لرصيد التسليم.",variant:"destructive"});return}if(t<0||a<0){u({title:"قيمة سالبة",description:"لا يمكن إدخال قيم سالبة.",variant:"destructive"});return}const i=(Q==null?void 0:Q.openingBase)??(K||0),m=(Q==null?void 0:Q.openingAir)??(Y||0),n=i+m,s=t+a-n;Xe(s);const l={id:`${Date.now()}`,openingBase:i,openingAir:m,deliveryBase:t,deliveryAir:a,netResult:s,createdAt:new Date().toISOString(),cashierName:C||"Unknown",requiredDrawerNoProfit:s<0?Math.round(-s*100)/100:0};we.current=l.id,(async()=>{var d;try{const x=g||A();if(x&&r){if(await Ae(_(N,"shops",x,"machines",r,"deliveries"),{cashierName:C||"Unknown",userId:h==null?void 0:h.uid,openingBase:i,openingAir:m,deliveryBase:t,deliveryAir:a,netResult:s,createdAt:E()}),await Ce(T(N,"shops",x,"machines",r),{lastDeliveryAt:E(),updatedAt:E()},{merge:!0}),h!=null&&h.uid){const b=((d=P.find(f=>f.id===r))==null?void 0:d.name)||"ماكينة";await $.saveUserTransaction(h.uid,{type:"machine_delivery",amount:s,senderName:b,title:"تسليم وردية مكنه",description:`تسليم وردية مكنه: ${b}`,shopId:x,status:"completed",createdAt:new Date,transactionId:`mdel_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,reference:`MDL-${Date.now()}`,cashierName:C||"Unknown",details:{openingBase:i,openingAir:m,deliveryBase:t,deliveryAir:a}})}me(b=>[l,...b]);try{const b=g||A(),f=b&&r?`machineDaily_deliveries_${b}_${r}`:`machineDaily_deliveries_${r}`,y=localStorage.getItem(f),D=y?JSON.parse(y):[],I=[l,...Array.isArray(D)?D:[]];localStorage.setItem(f,JSON.stringify(I))}catch{}u({title:"تم إنشاء إيصال تسليم",description:`الناتج النهائي: ${p(s)}`})}}catch(x){console.error("Persist delivery error:",x),u({title:"خطأ",description:"حدث خطأ أثناء حفظ التسليم. تأكد من الصلاحيات.",variant:"destructive"})}})()},nt=()=>{const t=parseFloat(he||"0"),a=parseFloat(ue||"0");if(!Number.isFinite(t)||!Number.isFinite(a)){u({title:"قيمة غير صالحة",description:"يرجى إدخال أرقام صحيحة لسعر الجملة وسعر التجزئة.",variant:"destructive"});return}if(t<0||a<0){u({title:"قيمة سالبة",description:"لا يمكن إدخال قيم سالبة.",variant:"destructive"});return}if(K==null||Y==null){u({title:"سجل الرصيد الافتتاحي أولاً",description:'يرجى إدخال الرصيد الأساسي ورصيد الهواء ثم الضغط "إضافة".'});return}const i=Math.round((a-t)*100)/100;tt({wholesalePrice:t,retailPrice:a,profit:i}),be(!0)},ct=async t=>{var a;if(!ee.current&&F){ee.current=!0,pe(!0);try{const i=Date.now(),m=`temp_mtr_${i}`,n=`MTR-${i}`,c={id:`transfer_${Date.now()}`,wholesalePrice:F.wholesalePrice,retailPrice:F.retailPrice,profit:F.profit,createdAt:new Date().toISOString(),cashierName:C||"Unknown",deductFrom:t};ye.current=c.id;const s=F.wholesalePrice,l=K??0,d=Y??0,x=_e??0;if(s>(t==="base"?l:d)){u({title:"رصيد غير كافٍ",description:"لا يوجد رصيد كافٍ للخصم بسعر الجملة.",variant:"destructive"});return}const f=t==="base"?Math.round((l-s)*100)/100:l,y=t==="air"?Math.round((d-s)*100)/100:d,D=F.retailPrice,I=Math.round((x+D)*100)/100;ae(f),re(y),ie(I);try{const xe=r?`${U}_${r}`:U,oe=r?`${W}_${r}`:W;localStorage.setItem(xe,JSON.stringify({openingBase:f,openingAir:y,drawerCash:I})),localStorage.setItem(oe,JSON.stringify({openingBase:f,openingAir:y,drawerCash:I}));const k=g||A();if(k&&r){const ht=T(N,"shops",k,"machines",r);if(await Ce(ht,{openingBase:f,openingAir:y,drawerCash:I,cashierName:C||"Unknown",updatedAt:E()},{merge:!0}),await Ae(_(N,"shops",k,"machines",r,"transfers"),{wholesalePrice:F.wholesalePrice,retailPrice:F.retailPrice,profit:F.profit,deductFrom:t,cashierName:C||"Unknown",userId:h==null?void 0:h.uid,createdAt:E()}),h!=null&&h.uid){const B=((a=P.find(M=>M.id===r))==null?void 0:a.name)||"ماكينة",z=F.retailPrice;await $.saveUserTransaction(h.uid,{type:"transfer",amount:z,senderName:B,title:"إيصال تحويل مكينه",description:`تحويل مكنه من ${B}`,shopId:k,status:"completed",createdAt:new Date,transactionId:`mtr_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,reference:n,cashierName:C||"Unknown"});try{const M=await $.getUserData(h.uid),ge=Number((M==null?void 0:M.cashBalance)||0)+z;await $.updateUserData(h.uid,{cashBalance:ge});try{if(k){const je=T(N,"dashboardData",k),ut=await getDoc(je);if(ut.exists()){const Xt=Number(ut.data().cashBalance||0);await updateDoc(je,{cashBalance:Xt+z,lastUpdated:new Date().toISOString()})}}}catch{}try{localStorage.setItem(`cashBalance_${h.uid}`,String(ge)),window.dispatchEvent(new CustomEvent("cashBalanceChanged",{detail:{value:ge}}))}catch{}try{const je={id:m,type:"transfer",amount:z,status:"completed",createdAt:new Date,title:"إيصال تحويل مكينه",description:`تحويل مكنه من ${B}`,reference:n,senderName:B,shopId:k,cashierName:C||"Unknown"};window.dispatchEvent(new CustomEvent("dashboard:external-update",{detail:{newTransaction:je}})),window.dispatchEvent(new CustomEvent("transaction-created"))}catch{}}catch(M){console.error("Error updating cash balance for machine transfer:",M)}}u({title:"تم الحفظ",description:"تم حفظ التحويل بنجاح وإضافته للدرج"}),ce(B=>[c,...B]);try{const B=g||A(),z=B&&r?`machineDaily_transfers_${B}_${r}`:"machineDaily_transfers",M=localStorage.getItem(z),ze=M?JSON.parse(M):[],ge=[c,...Array.isArray(ze)?ze:[]];localStorage.setItem(z,JSON.stringify(ge))}catch{}Fe(!1),Pe(""),Re(""),tt(null),be(!1),u({title:"تم تسجيل تحويل",description:`الربح الفوري: ${p(c.profit)} | خصم المخزون: -${p(s)} (${t==="base"?"الأساسي":"الهواء"}) | درج (المباع فقط): +${p(D)}`})}else console.error("Missing shopId or selectedMachineId",{sid2:k,selectedMachineId:r}),u({title:"تنبيه",description:"قد لا يتم حفظ البيانات في السيرفر لعدم توفر معرف المحل أو الماكينة",variant:"destructive"})}catch(xe){console.error("Error finalizing transfer:",xe),u({title:"خطأ",description:"حدث خطأ أثناء حفظ التحويل في قاعدة البيانات",variant:"destructive"})}}finally{ee.current=!1,pe(!1)}}},Kt=()=>{fe(""),ve(""),Ye(""),Qe(""),Xe(null)},lt=async()=>{if(!j||!r)return;const t=g||A();if(t){try{const a=_(N,"shops",t,"machines",r,"deliveries");console.log(`Fetching deliveries from: shops/${t}/machines/${r}/deliveries`);const i=await te(de(a));console.log(`Found ${i.docs.length} delivery documents`);const n=[...i.docs.map(c=>{var d,x;const s=c.data(),l=(x=(d=s==null?void 0:s.createdAt)==null?void 0:d.toDate)!=null&&x.call(d)?s.createdAt.toDate():new Date;return{id:c.id,openingBase:Number((s==null?void 0:s.openingBase)||0),openingAir:Number((s==null?void 0:s.openingAir)||0),deliveryBase:Number((s==null?void 0:s.deliveryBase)||0),deliveryAir:Number((s==null?void 0:s.deliveryAir)||0),netResult:typeof(s==null?void 0:s.netResult)=="number"?Number(s.netResult):Math.round((Number((s==null?void 0:s.deliveryBase)||0)+Number((s==null?void 0:s.deliveryAir)||0)-(Number((s==null?void 0:s.openingBase)||0)+Number((s==null?void 0:s.openingAir)||0)))*100)/100,createdAt:l.toISOString(),cashierName:(s==null?void 0:s.cashierName)||void 0,requiredDrawerNoProfit:typeof(s==null?void 0:s.requiredDrawerNoProfit)=="number"?s.requiredDrawerNoProfit:void 0}})].sort((c,s)=>new Date(s.createdAt).getTime()-new Date(c.createdAt).getTime());me(c=>{if(we.current&&!n.find(l=>l.id===we.current)){const l=c.find(d=>d.id===we.current);if(l)return[l,...n].sort((b,f)=>new Date(f.createdAt).getTime()-new Date(b.createdAt).getTime()).filter((b,f,y)=>f===y.findIndex(D=>D.id===b.id))}return n});try{localStorage.setItem(`machineDaily_deliveries_${t}_${r}`,JSON.stringify(n))}catch{}}catch(a){console.error("Error fetching deliveries:",a)}try{const a=_(N,"shops",t,"machines",r,"transfers");console.log(`Fetching transfers from: shops/${t}/machines/${r}/transfers`);const i=await te(de(a));console.log(`Found ${i.docs.length} transfer documents`);const n=[...i.docs.map(c=>{var x,b;const s=c.data(),l=(b=(x=s==null?void 0:s.createdAt)==null?void 0:x.toDate)!=null&&b.call(x)?s.createdAt.toDate():new Date,d=s==null?void 0:s.deductFrom;return{id:c.id,wholesalePrice:Number((s==null?void 0:s.wholesalePrice)||0),retailPrice:Number((s==null?void 0:s.retailPrice)||0),profit:Number((s==null?void 0:s.profit)??(Number((s==null?void 0:s.retailPrice)||0)-Number((s==null?void 0:s.wholesalePrice)||0)||0)),createdAt:l.toISOString(),cashierName:(s==null?void 0:s.cashierName)||void 0,deductFrom:d==="base"||d==="air"?d:void 0}})].sort((c,s)=>new Date(s.createdAt).getTime()-new Date(c.createdAt).getTime());ce(c=>{if(ye.current&&!n.find(l=>l.id===ye.current)){const l=c.find(d=>d.id===ye.current);if(l)return[l,...n].sort((b,f)=>new Date(f.createdAt).getTime()-new Date(b.createdAt).getTime()).filter((b,f,y)=>f===y.findIndex(D=>D.id===b.id))}return n});try{localStorage.setItem(`machineDaily_transfers_${t}_${r}`,JSON.stringify(n))}catch{}}catch(a){console.error("Error fetching transfers:",a),u({title:"خطأ",description:"فشل في جلب التحويلات من السيرفر",variant:"destructive"})}u({title:"تم التحديث",description:"تم جلب أحدث البيانات."})}};o.useEffect(()=>{if(!j||!r)return;const t=g||A();try{const a=t?`machineDaily_deliveries_${t}_${r}`:`machineDaily_deliveries_${r}`,i=localStorage.getItem(a);if(i){const c=JSON.parse(i);Array.isArray(c)&&me(c)}const m=t?`machineDaily_transfers_${t}_${r}`:`machineDaily_transfers_${r}`,n=localStorage.getItem(m);if(n){const c=JSON.parse(n);Array.isArray(c)&&ce(c)}}catch{}lt()},[j,g,r]);const We=async()=>{if(!(!r||!g))try{const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth(),t.getDate()),m=_(N,"shops",g,"machines",r,"withdrawals"),n=de(m,ls("createdAt","desc")),s=(await te(n)).docs.map(f=>{var D;const y=f.data();return{id:f.id,...y,createdAt:(D=y.createdAt)!=null&&D.toDate?y.createdAt.toDate():new Date(y.createdAt)}});St(s);let l=0,d=0,x=0,b=0;s.forEach(f=>{const y=f.createdAt,D=Number(f.amount)||0,I=Number(f.commission)||0;y>=a&&(l+=D,x+=I),y>=i&&(d+=D,b+=I)}),Bt(l),Ft(d),Rt(x),Tt(b)}catch(t){console.error("Error fetching monthly withdrawals:",t)}};o.useEffect(()=>{(w==="cashWithdrawal"||w==="withdrawalReceipts")&&r&&We()},[w,r,g]);const Yt=async t=>{if(!(!r||!g))try{const a=T(N,"shops",g,"machines",r,"withdrawals",t),{getDoc:i}=await De(async()=>{const{getDoc:n}=await import("./index-F79wE54_.js").then(c=>c.cF);return{getDoc:n}},__vite__mapDeps([0,1]),import.meta.url),m=await i(a);if(m.exists()){const n=m.data();if(n.deductedFromDrawer&&n.userId&&n.amount){const c=await $.getUserData(n.userId),l=Number((c==null?void 0:c.cashBalance)||0)+Number(n.amount);await $.updateUserData(n.userId,{cashBalance:l});try{const{updateDoc:d}=await De(async()=>{const{updateDoc:b}=await import("./index-F79wE54_.js").then(f=>f.cF);return{updateDoc:b}},__vite__mapDeps([0,1]),import.meta.url),x=T(N,"dashboardData",g);await d(x,{cashBalance:l})}catch(d){console.error("Error updating shop cash balance:",d)}}}await se(a),u({title:"تم الحذف",description:"تم حذف إيصال السحب"}),We()}catch(a){console.error("Delete withdrawal error:",a),u({title:"خطأ",description:"فشل الحذف",variant:"destructive"})}},Qt=async()=>{var t;if(!ee.current){ee.current=!0,pe(!0);try{const a=parseFloat(Te);if(isNaN(a)||a<=0){u({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}let i=0,m=0;if(R==="rate"){const c=parseFloat(Ee);if(isNaN(c)||c<0){u({title:"خطأ",description:"يرجى إدخال عمولة صحيحة",variant:"destructive"});return}i=a/1e3*c,m=c}else{const c=parseFloat(Ue);if(isNaN(c)||c<0){u({title:"خطأ",description:"يرجى إدخال مبلغ عمولة صحيح",variant:"destructive"});return}i=c}if(!r||!g){u({title:"خطأ",description:"بيانات المحل أو الماكينة غير متوفرة",variant:"destructive"});return}let n=null;try{if(Ne&&(h!=null&&h.uid)){const c=await $.getUserData(h.uid),l=Number((c==null?void 0:c.cashBalance)||0)-a;n=l,await $.updateUserData(h.uid,{cashBalance:l});try{const{updateDoc:d}=await De(async()=>{const{updateDoc:b}=await import("./index-F79wE54_.js").then(f=>f.cF);return{updateDoc:b}},__vite__mapDeps([0,1]),import.meta.url),x=T(N,"dashboardData",g);await d(x,{cashBalance:l})}catch(d){console.error("Error updating shop cash balance:",d)}}if(await Ae(_(N,"shops",g,"machines",r,"withdrawals"),{amount:a,commissionMode:R,commissionRate:R==="rate"?m:0,fixedCommission:R==="fixed"?i:0,commission:i,createdAt:E(),userId:h==null?void 0:h.uid,cashierName:C||"Unknown",deductedFromDrawer:Ne}),h!=null&&h.uid)try{const c=((t=P.find(x=>x.id===r))==null?void 0:t.name)||"ماكينة",s={type:"machine_withdrawal",amount:a,commission:i,senderName:c,title:"إيصال سحب فوري",description:`سحب كاش بقيمة ${p(a)} وعمولة ${p(i)}${Ne?" (تم الخصم من الدرج)":""}`,shopId:g,status:"completed",createdAt:new Date,transactionId:`mwd_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,reference:`MWD-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,cashierName:C||"Unknown"},l=await $.saveUserTransaction(h.uid,s),d={...s,id:l};try{window.dispatchEvent(new CustomEvent("dashboard:external-update",{detail:{newTransaction:d}})),window.dispatchEvent(new CustomEvent("transaction-created")),n!==null&&window.dispatchEvent(new CustomEvent("cashBalanceChanged",{detail:{value:n}}))}catch(x){console.error("Error dispatching events:",x)}}catch(c){console.error("Failed to save user transaction log:",c)}u({title:"تم السحب",description:`تم سحب ${p(a)} وعمولة ${p(i)}`}),rt(""),We()}catch(c){console.error("Withdrawal error:",c),u({title:"خطأ",description:"فشل في تنفيذ السحب",variant:"destructive"})}}finally{ee.current=!1,pe(!1)}}},ot=t=>{t||Kt(),Le(t)};return e.jsxs(pt,{open:j,onOpenChange:ot,children:[e.jsxs(xt,{className:"w-screen h-[100vh] overflow-hidden rounded-none p-0 flex flex-col dark:bg-[#121212]",children:[e.jsxs(gt,{className:"sticky top-0 bg-white dark:bg-[#0F0F0F] z-20 border-b border-gray-200 dark:border-[#333] px-4 py-3",children:[e.jsxs(ft,{className:"flex items-center justify-between text-right",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-5 w-5 text-yellow-500"}),"يومية المكنة ",r&&((dt=P.find(t=>t.id===r))!=null&&dt.name)?`- ${(mt=P.find(t=>t.id===r))==null?void 0:mt.name}`:""]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(v,{variant:"ghost",onClick:()=>et(!0),title:"شرح فيديو",className:"gap-1 px-2 text-rose-600 hover:text-rose-700 hover:bg-rose-50",children:[e.jsx(ps,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"شرح قسم المكن فديو"})]}),e.jsx(v,{variant:"ghost",size:"icon",onClick:lt,title:"تحديث البيانات",children:e.jsx(rs,{className:"h-4 w-4"})})]})]}),e.jsx(is,{className:"text-right",children:'أدخل الرصيد الافتتاحي، ثم في نهاية اليوم قم بإدخال رصيد التسليم لإنشاء إيصال منظم باسم "إيصالات ماكينة".'}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 sm:flex sm:flex-wrap sm:justify-end gap-2",children:[e.jsx(v,{size:"sm",variant:"outline",className:`w-full sm:w-auto ${w==="machines"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>J("machines"),children:"الماكينات"}),e.jsx(v,{size:"sm",variant:"outline",className:`w-full sm:w-auto ${w==="cashWithdrawal"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>J("cashWithdrawal"),children:"سحب كاش"}),e.jsx(v,{size:"sm",variant:"outline",className:`w-full sm:w-auto ${w==="withdrawalReceipts"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>J("withdrawalReceipts"),children:"إيصالات سحب مكنة"}),e.jsx(v,{size:"sm",variant:"outline",className:`w-full sm:w-auto ${w==="opening"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>J("opening"),children:"الرصيد الافتتاحي"}),e.jsx(v,{size:"sm",variant:"outline",className:`w-full sm:w-auto ${w==="transfer"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>J("transfer"),children:"التحويل"}),e.jsx(v,{size:"sm",variant:"outline",className:`w-full sm:w-auto ${w==="transferReceipts"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>J("transferReceipts"),children:"إيصالات التحويل"}),e.jsx(v,{size:"sm",variant:"outline",className:`w-full sm:w-auto ${w==="delivery"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>J("delivery"),children:"تسليم الوردية"}),e.jsx(v,{size:"sm",variant:"outline",className:`w-full sm:w-auto col-span-2 sm:col-auto ${w==="deliveryReceipts"?"bg-violet-600 text-white hover:bg-violet-700":"border-violet-300 text-violet-700"}`,onClick:()=>J("deliveryReceipts"),children:"إيصالات التسليم"})]})]}),e.jsxs("div",{className:"px-4 py-3 overflow-y-auto flex-1 grid grid-cols-1 gap-6",children:[w==="machines"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsxs(L,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-right",children:"إدارة الماكينات"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(v,{variant:"destructive",onClick:async()=>{try{if(!g||!r)return;const t=T(N,"shops",g,"machines",r);try{const i=await te(_(N,"shops",g,"machines",r,"transfers"));await Promise.all(i.docs.map(m=>se(m.ref)))}catch{}try{const i=await te(_(N,"shops",g,"machines",r,"deliveries"));await Promise.all(i.docs.map(m=>se(m.ref)))}catch{}await se(t),Me(i=>i.filter(m=>m.id!==r));const a=P.find(i=>i.id!==r);le(a?a.id:null);try{const i=`${U}_${r}`,m=`${W}_${r}`;localStorage.removeItem(i),localStorage.removeItem(m)}catch{}u({title:"تم حذف الماكينة",description:"تمت الإزالة نهائيًا."})}catch{u({title:"فشل الحذف",description:"تعذر حذف الماكينة.",variant:"destructive"})}},disabled:!r,title:"حذف الماكينة",children:e.jsx(Se,{className:"h-4 w-4"})})})]})}),e.jsx(H,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"الماكينة الحالية"}),e.jsxs(bt,{value:r??"",onValueChange:t=>{le(t);try{const a=g||A();a&&localStorage.setItem(`machineDaily_selected_${a}`,t)}catch{}},children:[e.jsx(Nt,{className:"text-right",children:e.jsx(yt,{placeholder:"اختر ماكينة"})}),e.jsx(wt,{children:P.map(t=>e.jsx(jt,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"إنشاء ماكينة جديدة"}),e.jsx(S,{value:st,onChange:t=>at(t.target.value),placeholder:"اسم الماكينة",className:"text-right"})]}),e.jsx("div",{className:"flex justify-end md:justify-start",children:e.jsx(v,{onClick:async()=>{try{if(!g){u({title:"لا يوجد محل",description:"يرجى التأكد من تحميل بيانات المحل.",variant:"destructive"});return}const t=(st||"").trim();if(!t){u({title:"اسم الماكينة مطلوب",description:"أدخل اسم للماكينة الجديدة.",variant:"destructive"});return}const a=await Ae(_(N,"shops",g,"machines"),{name:t,shopId:g,createdAt:E(),updatedAt:E(),isActive:!0}),i={id:a.id,name:t};Me(m=>[i,...m]),le(a.id),at(""),u({title:"تم إنشاء ماكينة",description:`تمت إضافة ${t}`})}catch(t){console.error("Create machine error:",t),u({title:"خطأ في الإنشاء",description:"تعذر إنشاء الماكينة.",variant:"destructive"})}},className:"bg-violet-600 hover:bg-violet-700",children:"إضافة"})})]})]})})]}),w==="opening"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsx(L,{className:"flex items-center justify-between",children:e.jsx("span",{className:"text-right",children:"الرصيد الافتتاحي"})})}),e.jsx("div",{className:"flex items-center justify-between px-6",children:K!=null&&Y!=null&&e.jsxs(G,{className:"bg-violet-100 text-violet-700 border border-violet-200",children:["تم التسجيل: أساسي ",p(K)," | هواء ",p(Y)," | درج ",p(_e??0)]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"اختيار الماكينة"}),e.jsxs(bt,{value:r||"",onValueChange:le,children:[e.jsx(Nt,{className:"w-full text-right flex-row-reverse",dir:"rtl",children:e.jsx(yt,{placeholder:"اختر الماكينة"})}),e.jsx(wt,{dir:"rtl",children:P.map(t=>e.jsx(jt,{value:t.id,className:"text-right cursor-pointer justify-end",children:t.name},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"الرصيد الأساسي"}),e.jsx(S,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:He,onChange:t=>fe(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"رصيد الهواء"}),e.jsx(S,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:Ge,onChange:t=>ve(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"فلوس الدرج"}),e.jsx(S,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:Ke,onChange:t=>ke(t.target.value),placeholder:"0.00",className:"text-right"})]})]}),e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx(v,{variant:"outline",className:"mr-2",onClick:Lt,children:"تصفير"}),e.jsx(v,{onClick:Ht,className:"bg-violet-600 hover:bg-violet-700",children:"إضافة"})]})]})]}),w==="transfer"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsx(L,{className:"flex items-center justify-between",children:e.jsx("span",{className:"text-right",children:"التحويل"})})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"سعر الجملة"}),e.jsx(S,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:he,onChange:t=>Pe(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"سعر التجزئة"}),e.jsx(S,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:ue,onChange:t=>Re(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(G,{className:"bg-green-100 text-green-700 border border-green-200",children:["الربح الفوري: ",p(parseFloat(ue||"0")-parseFloat(he||"0")||0)]}),e.jsx(v,{onClick:nt,disabled:K==null||Y==null,className:"bg-violet-600 hover:bg-violet-700",children:"تحويل"})]})]})]}),w==="transferReceipts"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsxs(L,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-right",children:"إيصالات التحويل"}),e.jsxs(G,{className:"bg-green-100 text-green-700 border border-green-200",children:["ربح: ",p(Ut)]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(v,{variant:"outline",size:"sm",onClick:zt,className:"border-red-300 text-red-700 hover:bg-red-50",children:"حذف الإيصالات"})})]})}),e.jsx(H,{className:"space-y-3",children:X.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-right",children:"لا توجد تحويلات مسجلة."}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1",children:X.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-100 bg-white dark:bg-gray-800 dark:border-gray-700 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-4 sm:gap-6",children:[e.jsxs("div",{className:"text-center min-w-[3rem]",children:[e.jsx("span",{className:"block text-[10px] text-gray-500 mb-0.5",children:"جملة"}),e.jsx("span",{className:"block text-sm font-bold text-gray-900 dark:text-gray-100",children:p(t.wholesalePrice)})]}),e.jsx("div",{className:"h-8 w-px bg-gray-100 dark:bg-gray-700"}),e.jsxs("div",{className:"text-center min-w-[3rem]",children:[e.jsx("span",{className:"block text-[10px] text-gray-500 mb-0.5",children:"تجزئة"}),e.jsx("span",{className:"block text-sm font-bold text-gray-900 dark:text-gray-100",children:p(t.retailPrice)})]}),e.jsx("div",{className:"h-8 w-px bg-gray-100 dark:bg-gray-700"}),e.jsxs("div",{className:"text-center min-w-[3rem]",children:[e.jsx("span",{className:"block text-[10px] text-gray-500 mb-0.5",children:"ربح"}),e.jsx("span",{className:"block text-sm font-bold text-green-600",children:p(t.profit)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{variant:"ghost",size:"icon",className:"h-7 w-7 text-red-400 hover:text-red-600 hover:bg-red-50",onClick:()=>qt(t),title:"حذف واسترجاع الرصيد",children:e.jsx(Se,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex flex-col items-end gap-1.5",children:[t.deductFrom&&e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full border ${t.deductFrom==="base"?"bg-blue-50 text-blue-700 border-blue-100":"bg-amber-50 text-amber-700 border-amber-100"}`,children:t.deductFrom==="base"?"من الأساسي":"من الهواء"}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-gray-400",children:[e.jsx("span",{children:Ve(t.createdAt)}),t.cashierName&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{orientation:"vertical",className:"h-3"}),e.jsx("span",{title:t.cashierName,children:t.cashierName.split(" ")[0]})]})]})]})]})]},t.id))})})]}),w==="cashWithdrawal"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsx(L,{className:"text-right",children:"سحب كاش"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded border border-blue-100 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-blue-600 block",children:"سحب اليوم (يصفر 12 ليلاً)"}),e.jsx("span",{className:"text-lg font-bold text-blue-800",children:p(Ot)})]}),e.jsxs("div",{className:"pt-2 mt-2 border-t border-blue-200 flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] text-blue-500 font-medium",children:"الربح اليومي"}),e.jsx("span",{className:"text-sm font-bold text-blue-700",children:p(Mt)})]})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded border border-green-100 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-green-600 block",children:"سحب الشهر (يصفر أول الشهر)"}),e.jsx("span",{className:"text-lg font-bold text-green-800",children:p(It)})]}),e.jsxs("div",{className:"pt-2 mt-2 border-t border-green-200 flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] text-green-500 font-medium",children:"الربح الشهري"}),e.jsx("span",{className:"text-sm font-bold text-green-700",children:p(Pt)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"مبلغ السحب"}),e.jsx(S,{type:"number",min:0,value:Te,onChange:t=>rt(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"space-y-2 border p-3 rounded bg-gray-50",children:[e.jsx("label",{className:"text-sm font-medium block text-right mb-2",children:"طريقة حساب العمولة"}),e.jsxs("div",{className:"flex justify-end gap-2 mb-3",children:[e.jsx(v,{variant:R==="fixed"?"default":"outline",size:"sm",onClick:()=>it("fixed"),className:R==="fixed"?"bg-violet-600":"",children:"مبلغ ثابت"}),e.jsx(v,{variant:R==="rate"?"default":"outline",size:"sm",onClick:()=>it("rate"),className:R==="rate"?"bg-violet-600":"",children:"نسبة لكل ألف"})]}),R==="rate"?e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"العمولة (لكل ألف)"}),e.jsx(S,{type:"number",min:0,value:Ee,onChange:t=>_t(t.target.value),placeholder:"2",className:"text-right"})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"مبلغ العمولة الكلي"}),e.jsx(S,{type:"number",min:0,value:Ue,onChange:t=>$t(t.target.value),placeholder:"0.00",className:"text-right"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse mt-2 justify-end",children:[e.jsx("label",{htmlFor:"deductDrawer",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:"خصم من درج النقدية"}),e.jsx(ns,{id:"deductDrawer",checked:Ne,onCheckedChange:t=>Et(!!t)})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["سيتم تسجيل عمولة: ",e.jsx("span",{className:"font-bold text-green-600",children:p(R==="rate"?parseFloat(Te||"0")/1e3*parseFloat(Ee||"0"):parseFloat(Ue||"0"))})]}),e.jsx(v,{onClick:Qt,disabled:Z,className:"bg-violet-600 hover:bg-violet-700 disabled:opacity-70",children:Z?"جاري السحب...":"سحب"})]})]})]}),w==="withdrawalReceipts"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsxs(L,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-right",children:"إيصالات سحب مكنة"}),e.jsxs(G,{variant:"outline",className:"text-violet-700 border-violet-200 bg-violet-50",children:["عدد الإيصالات: ",Oe.length]})]})}),e.jsx(H,{className:"space-y-3",children:Oe.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-right",children:"لا توجد سحوبات مسجلة لهذا الشهر."}):e.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto pr-1",children:Oe.map(t=>{var a;return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-100 bg-white dark:bg-gray-800 dark:border-gray-700 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right min-w-[4rem]",children:[e.jsx("span",{className:"block text-[10px] text-gray-500 mb-0.5",children:"المبلغ"}),e.jsx("span",{className:"block text-sm font-bold text-gray-900 dark:text-gray-100",children:p(t.amount)})]}),e.jsx("div",{className:"h-8 w-px bg-gray-100 dark:bg-gray-700"}),e.jsxs("div",{className:"text-right min-w-[3rem]",children:[e.jsx("span",{className:"block text-[10px] text-gray-500 mb-0.5",children:"العمولة"}),e.jsx("span",{className:"block text-sm font-bold text-green-600",children:p(t.commission)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{variant:"ghost",size:"icon",className:"h-7 w-7 text-red-400 hover:text-red-600 hover:bg-red-50",onClick:()=>Yt(t.id),title:"حذف الإيصال",children:e.jsx(Se,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex flex-col items-end gap-1.5",children:e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-gray-400",children:[e.jsx("span",{children:Ve((a=t.createdAt)!=null&&a.toISOString?t.createdAt.toISOString():t.createdAt)}),t.cashierName&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{orientation:"vertical",className:"h-3"}),e.jsx("span",{title:t.cashierName,children:t.cashierName.split(" ")[0]})]})]})})]})]},t.id)})})})]}),w==="delivery"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsx(L,{className:"text-right",children:"تسليم الوردية"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"الرصيد الأساسي الحالي"}),e.jsx(S,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:$e,onChange:t=>Ye(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"رصيد الهواء الحالي"}),e.jsx(S,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:Ie,onChange:t=>Qe(t.target.value),placeholder:"0.00",className:"text-right"})]})]}),e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsx(v,{onClick:Gt,className:"bg-violet-600 hover:bg-violet-700",children:"تسليم"})}),Be!=null&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-right",children:e.jsxs(G,{className:Be>=0?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200",children:["الناتج النهائي: ",p(Be)]})}),e.jsxs("div",{className:"mt-2 flex items-center justify-end gap-2",children:[e.jsxs(G,{className:"bg-blue-100 text-blue-700 border border-blue-200",children:["المجموع النهائي: ",p(parseFloat($e||"0")+parseFloat(Ie||"0"))]}),e.jsxs(G,{className:"bg-amber-100 text-amber-700 border border-amber-200",children:["مطلوب من الدرج (بدون أرباح): ",p(Wt)]})]})]})]})]}),w==="deliveryReceipts"&&e.jsxs(q,{children:[e.jsx(V,{className:"pb-2",children:e.jsxs(L,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-right",children:"إيصالات التسليم"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(v,{variant:"outline",size:"sm",onClick:Jt,className:"border-red-300 text-red-700 hover:bg-red-50",children:"حذف الإيصالات"})})]})}),e.jsx(H,{className:"space-y-3",children:Ze.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-right",children:"لا توجد إيصالات حتى الآن."}):e.jsx("div",{className:"space-y-3",children:Ze.map(t=>e.jsxs("div",{className:"rounded-lg border p-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"الافتتاحي"}),e.jsxs("p",{className:"text-sm",children:["أساسي: ",p(t.openingBase)]}),e.jsxs("p",{className:"text-sm",children:["هواء: ",p(t.openingAir)]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"التسليم"}),e.jsxs("p",{className:"text-sm",children:["أساسي: ",p(t.deliveryBase)]}),e.jsxs("p",{className:"text-sm",children:["هواء: ",p(t.deliveryAir)]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>Vt(t.id),className:"border-red-300 text-red-700 hover:bg-red-50",children:[e.jsx(Se,{className:"h-3 w-3 mr-1"})," حذف"]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"النتيجة"}),e.jsx("p",{className:`text-sm ${t.netResult>=0?"text-green-700":"text-red-700"}`,children:p(t.netResult)}),e.jsxs("div",{className:"mt-1 flex items-center justify-end gap-2",children:[e.jsxs("span",{className:"text-[11px] bg-blue-100 text-blue-700 border border-blue-200 rounded px-2 py-0.5",children:["المجموع النهائي: ",p(t.deliveryBase+t.deliveryAir)]}),typeof t.requiredDrawerNoProfit=="number"&&e.jsxs("span",{className:"text-[11px] bg-amber-100 text-amber-700 border border-amber-200 rounded px-2 py-0.5",children:["مطلوب من الدرج (بدون أرباح): ",p(t.requiredDrawerNoProfit||0)]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 text-xs text-gray-500",children:[e.jsx(gs,{className:"h-3 w-3"}),e.jsx("span",{children:Ve(t.createdAt)}),t.cashierName&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{orientation:"vertical",className:"h-3"}),e.jsxs("span",{children:["الكاشير: ",t.cashierName]})]})]})]})]},t.id))})})]})]}),e.jsxs(vt,{className:"sticky bottom-0 bg-white dark:bg-[#0F0F0F] z-20 border-t border-gray-200 dark:border-[#333] px-4 py-3 flex items-center justify-between",children:[e.jsx(v,{variant:"outline",onClick:()=>ot(!1),children:"إغلاق"}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(cs,{className:"h-3 w-3"}),e.jsx("span",{children:"يسجل التاريخ والوقت تلقائياً لكل إيصال"})]})]})]}),e.jsx(pt,{open:At,onOpenChange:Fe,children:e.jsxs(xt,{className:"sm:max-w-sm",children:[e.jsx(gt,{children:e.jsx(ft,{children:"تحويل رصيد"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"سعر الجملة"}),e.jsx(S,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:he,onChange:t=>Pe(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"سعر التجزئة"}),e.jsx(S,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:ue,onChange:t=>Re(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsx("div",{className:"text-right",children:e.jsxs(G,{className:"bg-green-100 text-green-700 border border-green-200",children:["الربح الفوري: ",p(parseFloat(ue||"0")-parseFloat(he||"0")||0)]})})]}),e.jsxs(vt,{className:"flex items-center justify-end gap-2",children:[e.jsx(v,{variant:"secondary",onClick:()=>Fe(!1),children:"إلغاء"}),e.jsx(v,{onClick:nt,className:"bg-violet-600 hover:bg-violet-700",children:"تحويل"})]})]})}),e.jsx(os,{open:kt,onOpenChange:be,children:e.jsxs(ds,{children:[e.jsxs(ms,{children:[e.jsx(hs,{children:"اختيار مصدر الخصم"}),e.jsx(us,{children:"هل يتم الخصم من الرصيد الأساسي أم من رصيد الهواء؟"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-4",children:[e.jsx(v,{variant:"ghost",onClick:()=>be(!1),disabled:Z,children:"رجوع"}),e.jsx(v,{className:"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>ct("base"),disabled:Z,children:Z?"جاري التحويل...":"خصم من الأساسي"}),e.jsx(v,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>ct("air"),disabled:Z,children:Z?"جاري التحويل...":"خصم من الهواء"})]})]})}),e.jsx(xs,{isOpen:Ct,onClose:()=>et(!1),videoUrl:"https://www.youtube.com/watch?v=sHWKmqAmxic",title:"شرح قسم مكن الشحن وتسجيل اليومية"})]})}export{ks as default};
//# sourceMappingURL=MachineDailyDialog-IJ2PRARk.js.map
