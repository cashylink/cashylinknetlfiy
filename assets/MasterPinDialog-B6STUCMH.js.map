{"version":3,"file":"MasterPinDialog-B6STUCMH.js","sources":["../../src/utils/masterPinService.ts","../../src/components/PasswordConfirmDialog.tsx","../../src/components/MasterPinDialog.tsx"],"sourcesContent":["/**\r\n * خدمة إدارة الرقم السري الرئيسي مع ربطه بالمستخدم وحفظه في Firestore و localStorage\r\n */\r\n\r\nimport { doc, getDoc, setDoc, updateDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { db } from '@/firebase';\r\nimport { userDataService } from '@/integrations/firebase/services';\r\n\r\nconst MASTER_PIN_KEY_BASE = 'master_pin';\r\nconst masterPinCache: Map<string, string> = new Map(); // يخزن القيمة المشفرة لكل مستخدم\r\n\r\nfunction getKey(userId?: string) {\r\n  return userId ? `${MASTER_PIN_KEY_BASE}_${userId}` : MASTER_PIN_KEY_BASE;\r\n}\r\n\r\nasync function loadFromFirestore(userId: string): Promise<string | null> {\r\n  try {\r\n    const data = await userDataService.getUserData(userId);\r\n    const encoded = (data?.security && data.security.masterPin) || (data as any)?.masterPin || null;\r\n    return typeof encoded === 'string' && encoded.length > 0 ? encoded : null;\r\n  } catch {\r\n    // فشل الشبكة أو عدم وجود الوثيقة\r\n    try {\r\n      const docRef = doc(db, 'users', userId);\r\n      const snap = await getDoc(docRef);\r\n      if (snap.exists()) {\r\n        const data: any = snap.data();\r\n        const encoded = (data?.security && data.security.masterPin) || data?.masterPin || null;\r\n        return typeof encoded === 'string' && encoded.length > 0 ? encoded : null;\r\n      }\r\n    } catch {}\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction loadFromLocalStorage(userId?: string): string | null {\r\n  try {\r\n    const val = localStorage.getItem(getKey(userId));\r\n    return val && val.length > 0 ? val : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function persistToFirestore(userId: string, encodedPin: string | null) {\r\n  try {\r\n    const payload: any = {\r\n      security: {\r\n        masterPin: encodedPin || null,\r\n        masterPinUpdatedAt: serverTimestamp()\r\n      },\r\n      updatedAt: serverTimestamp()\r\n    };\r\n    await setDoc(doc(db, 'users', userId), payload, { merge: true });\r\n  } catch (e) {\r\n    // محاولة بديلة باستخدام updateDoc إذا كان المستند موجوداً\r\n    try {\r\n      await updateDoc(doc(db, 'users', userId), {\r\n        security: {\r\n          masterPin: encodedPin || null,\r\n          masterPinUpdatedAt: serverTimestamp()\r\n        },\r\n        updatedAt: serverTimestamp()\r\n      });\r\n    } catch {}\r\n  }\r\n}\r\n\r\nfunction persistToLocalStorage(userId: string | undefined, encodedPin: string | null) {\r\n  try {\r\n    const key = getKey(userId);\r\n    if (encodedPin) {\r\n      localStorage.setItem(key, encodedPin);\r\n    } else {\r\n      localStorage.removeItem(key);\r\n    }\r\n  } catch {}\r\n}\r\n\r\nexport class MasterPinService {\r\n  /**\r\n   * التحقق من وجود رقم سري رئيسي (يحمّل من الذاكرة أو التخزين إذا لزم)\r\n   */\r\n  static async hasMasterPin(userId?: string): Promise<boolean> {\r\n    const userKey = getKey(userId);\r\n    // 1) فحص الكاش للمفتاح الخاص بالمستخدم\r\n    if (masterPinCache.has(userKey)) {\r\n      const val = masterPinCache.get(userKey)!;\r\n      return val !== '' && val != null;\r\n    }\r\n    // 2) فحص التخزين المحلي للمفتاح الخاص بالمستخدم\r\n    const localValUser = loadFromLocalStorage(userId);\r\n    if (localValUser) {\r\n      masterPinCache.set(userKey, localValUser);\r\n      return true;\r\n    }\r\n    // 3) في حال توفر userId، افحص المفتاح الأساسي (غير المرتبط بمستخدم) وقم بمهاجرته\r\n    if (userId) {\r\n      const baseVal = loadFromLocalStorage(undefined);\r\n      if (baseVal) {\r\n        // هجرة: انقل القيمة إلى مفتاح المستخدم واحفظها في Firestore، واحذف المفتاح الأساسي\r\n        masterPinCache.set(userKey, baseVal);\r\n        persistToLocalStorage(userId, baseVal);\r\n        try { persistToLocalStorage(undefined, null); } catch {}\r\n        await persistToFirestore(userId, baseVal);\r\n        return true;\r\n      }\r\n    }\r\n    // 4) فحص Firestore عند توفر userId ثم مزامنة محلية\r\n    if (userId) {\r\n      const remoteVal = await loadFromFirestore(userId);\r\n      if (remoteVal) {\r\n        masterPinCache.set(userKey, remoteVal);\r\n        persistToLocalStorage(userId, remoteVal);\r\n        try { persistToLocalStorage(undefined, null); } catch {}\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * إنشاء رقم سري رئيسي جديد\r\n   */\r\n  static async createMasterPin(pin: string, userId?: string): Promise<boolean> {\r\n    try {\r\n      if (!pin || pin.length < 4) return false;\r\n      const encodedPin = btoa(pin);\r\n      const key = getKey(userId);\r\n      masterPinCache.set(key, encodedPin);\r\n      persistToLocalStorage(userId, encodedPin);\r\n      if (userId) await persistToFirestore(userId, encodedPin);\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error creating master PIN:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * التحقق من صحة الرقم السري الرئيسي\r\n   */\r\n  static async verifyMasterPin(inputPin: string, userId?: string): Promise<boolean> {\r\n    try {\r\n      const key = getKey(userId);\r\n      if (!(await this.hasMasterPin(userId))) return false;\r\n      const savedEncoded = masterPinCache.get(key);\r\n      if (!savedEncoded) return false;\r\n      const decodedPin = atob(savedEncoded);\r\n      return decodedPin === inputPin;\r\n    } catch (error) {\r\n      console.error('Error verifying master PIN:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تغيير الرقم السري الرئيسي\r\n   */\r\n  static async changeMasterPin(currentPin: string, newPin: string, userId?: string): Promise<boolean> {\r\n    try {\r\n      const ok = await this.verifyMasterPin(currentPin, userId);\r\n      if (!ok) return false;\r\n      return await this.createMasterPin(newPin, userId);\r\n    } catch (error) {\r\n      console.error('Error changing master PIN:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * حذف الرقم السري الرئيسي\r\n   */\r\n  static async deleteMasterPin(userId?: string): Promise<boolean> {\r\n    try {\r\n      const key = getKey(userId);\r\n      masterPinCache.delete(key);\r\n      persistToLocalStorage(userId, null);\r\n      if (userId) await persistToFirestore(userId, null);\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error deleting master PIN:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * الحصول على الرقم السري (للاختبار فقط)\r\n   */\r\n  static async getMasterPin(userId?: string): Promise<string | null> {\r\n    try {\r\n      const key = getKey(userId);\r\n      if (!(await this.hasMasterPin(userId))) return null;\r\n      const savedEncoded = masterPinCache.get(key);\r\n      return savedEncoded ? atob(savedEncoded) : null;\r\n    } catch (error) {\r\n      console.error('Error getting master PIN:', error);\r\n      return null;\r\n    }\r\n  }\r\n}","import React, { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '@/components/ui/dialog';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Lock } from 'lucide-react';\r\nimport { auth } from '@/firebase';\r\nimport { EmailAuthProvider, reauthenticateWithCredential } from 'firebase/auth';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\ninterface PasswordConfirmDialogProps {\r\n  open: boolean;\r\n  onOpenChange?: (open: boolean) => void;\r\n  title?: string;\r\n  description?: string;\r\n  onSuccess: () => void;\r\n}\r\n\r\nconst PasswordConfirmDialog: React.FC<PasswordConfirmDialogProps> = ({\r\n  open,\r\n  onOpenChange,\r\n  title = 'تأكيد كلمة المرور',\r\n  description = 'أدخل كلمة مرور تسجيل الدخول للمتابعة',\r\n  onSuccess,\r\n}) => {\r\n  const { toast } = useToast();\r\n  const [password, setPassword] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const handleConfirm = async () => {\r\n    setError(null);\r\n    try {\r\n      const currentUser = auth.currentUser;\r\n      if (!currentUser || !currentUser.email) {\r\n        setError('لا يوجد مستخدم مسجل حالياً. يرجى تسجيل الدخول أولاً.');\r\n        return;\r\n      }\r\n      setIsLoading(true);\r\n      const credential = EmailAuthProvider.credential(currentUser.email, password);\r\n      await reauthenticateWithCredential(currentUser, credential);\r\n      setIsLoading(false);\r\n      setPassword('');\r\n      toast({ title: 'تم التأكيد', description: 'تم التحقق من كلمة المرور بنجاح' });\r\n      onSuccess();\r\n      if (onOpenChange) onOpenChange(false);\r\n    } catch (e: any) {\r\n      console.error('إعادة التحقق بكلمة المرور فشلت:', e);\r\n      setIsLoading(false);\r\n      const code = e?.code || '';\r\n      if (code === 'auth/wrong-password') {\r\n        setError('كلمة المرور غير صحيحة. حاول مرة أخرى.');\r\n      } else if (code === 'auth/too-many-requests') {\r\n        setError('تمت محاولات كثيرة. يرجى الانتظار قليلاً ثم المحاولة.');\r\n      } else {\r\n        setError('حدث خطأ أثناء التحقق. حاول مرة أخرى.');\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleClose = (openVal: boolean) => {\r\n    if (onOpenChange) onOpenChange(openVal);\r\n    if (!openVal) {\r\n      setPassword('');\r\n      setError(null);\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-[400px]\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"text-right\">{title}</DialogTitle>\r\n          <DialogDescription className=\"text-right\">{description}</DialogDescription>\r\n        </DialogHeader>\r\n        <div className=\"grid gap-4 py-2\">\r\n          <div className=\"grid grid-cols-4 items-center gap-2\">\r\n            <label htmlFor=\"password\" className=\"text-right col-span-1 text-sm\">كلمة المرور</label>\r\n            <div className=\"col-span-3 relative\">\r\n              <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n              <Input\r\n                id=\"password\"\r\n                type=\"password\"\r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n                placeholder=\"نفس كلمة مرور تسجيل الدخول\"\r\n                autoComplete=\"off\"\r\n              />\r\n            </div>\r\n          </div>\r\n          {error && (\r\n            <div className=\"text-red-600 text-xs text-right\">{error}</div>\r\n          )}\r\n        </div>\r\n        <DialogFooter className=\"flex justify-end gap-2\">\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={() => handleClose(false)}\r\n            disabled={isLoading}\r\n          >\r\n            إلغاء\r\n          </Button>\r\n          <Button\r\n            onClick={handleConfirm}\r\n            disabled={isLoading || !password}\r\n            className=\"bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-60\"\r\n          >\r\n            {isLoading ? 'جاري التحقق...' : 'تأكيد'}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default PasswordConfirmDialog;","import React, { useState, useEffect, useRef } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { Eye, EyeOff, Lock, AlertCircle, Shield } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { MasterPinService } from '@/utils/masterPinService';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport PasswordConfirmDialog from '@/components/PasswordConfirmDialog';\r\n\r\ninterface MasterPinDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  onSuccess?: () => void;\r\n  title?: string;\r\n  description?: string;\r\n  mode?: 'verify' | 'create' | 'change';\r\n}\r\n\r\nexport const MasterPinDialog: React.FC<MasterPinDialogProps> = ({\r\n  open,\r\n  onOpenChange,\r\n  onSuccess,\r\n  title = \"الرقم السري الرئيسي\",\r\n  description = \"رقم سري موحد لإدارة جميع عناصر الموقع\",\r\n  mode = 'verify'\r\n}) => {\r\n  const [currentPin, setCurrentPin] = useState('');\r\n  const [newPin, setNewPin] = useState('');\r\n  const [confirmPin, setConfirmPin] = useState('');\r\n  const [showCurrentPin, setShowCurrentPin] = useState(false);\r\n  const [showNewPin, setShowNewPin] = useState(false);\r\n  const [showConfirmPin, setShowConfirmPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n  const { user, profile } = useFirebaseAuth();\r\n  const userId = user?.uid;\r\n  const [hasMasterPin, setHasMasterPin] = useState(false);\r\n  const [useOverrideReset, setUseOverrideReset] = useState(false);\r\n  const canOverrideReset = (profile?.role === 'admin' || profile?.role === 'staff');\r\n  const [isPasswordConfirmOpen, setIsPasswordConfirmOpen] = useState(false);\r\n  const [passwordVerified, setPasswordVerified] = useState(false);\r\n  const formRef = useRef<HTMLFormElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    const check = async () => {\r\n      try {\r\n        const has = await MasterPinService.hasMasterPin(userId);\r\n        if (mounted) setHasMasterPin(has);\r\n      } catch {}\r\n    };\r\n    if (open) check();\r\n    return () => { mounted = false; };\r\n  }, [userId, open]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      if (mode === 'verify') {\r\n        if (!currentPin) {\r\n          setError('يرجى إدخال الرقم السري الرئيسي');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n        const ok = await MasterPinService.verifyMasterPin(currentPin, userId);\r\n        if (!ok) {\r\n          setError('الرقم السري غير صحيح');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n        toast({ title: \"تم التأكيد\", description: \"تم التحقق من الرقم السري بنجاح\" });\r\n        onSuccess?.();\r\n        handleClose();\r\n      } else if (mode === 'create') {\r\n        if (!newPin || newPin.length < 4) {\r\n          setError('يجب أن يكون الرقم السري الجديد 4 أرقام على الأقل');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n        if (newPin !== confirmPin) {\r\n          setError('الرقم السري الجديد وتأكيده غير متطابقين');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n        const created = await MasterPinService.createMasterPin(newPin, userId);\r\n        if (!created) {\r\n          setError('تعذر إنشاء الرقم السري الرئيسي');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n        toast({ title: \"تم تعيين الرقم السري الرئيسي\", description: \"تم تعيين الرقم السري الرئيسي بنجاح\" });\r\n        onSuccess?.();\r\n        handleClose();\r\n      } else if (mode === 'change') {\r\n        // منع التغيير إذا لم يتم تحميل المستخدم لضمان التطابق في مفاتيح التخزين\r\n        if (!userId) {\r\n          setError('لا يمكن تغيير الرقم السري قبل تحميل حساب المستخدم. الرجاء إعادة المحاولة بعد تسجيل الدخول أو انتظار التحميل.');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n        // إذا كان هناك رقم سري محفوظ، تحقق من الحالي ما لم يكن هناك تجاوز إداري\r\n        if (hasMasterPin && !useOverrideReset) {\r\n          if (!passwordVerified) {\r\n            if (!currentPin) {\r\n              setError('يرجى إدخال الرقم السري الحالي أو تأكيد كلمة الدخول');\r\n              setIsLoading(false);\r\n              return;\r\n            }\r\n            const ok = await MasterPinService.verifyMasterPin(currentPin, userId);\r\n            if (!ok) {\r\n              setError('الرقم السري الحالي غير صحيح');\r\n              setIsLoading(false);\r\n              return;\r\n            }\r\n          }\r\n        }\r\n        if (!newPin || newPin.length < 4) {\r\n          setError('يجب أن يكون الرقم السري الجديد 4 أرقام على الأقل');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n        if (newPin !== confirmPin) {\r\n          setError('الرقم السري الجديد وتأكيده غير متطابقين');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n        const changed = hasMasterPin\r\n          ? (\r\n            (useOverrideReset && canOverrideReset) || passwordVerified\r\n              ? await MasterPinService.createMasterPin(newPin, userId) // إعادة تعيين بدون الحاجة للرقم الحالي بعد تحقق كلمة الدخول أو صلاحية إدارية\r\n              : await MasterPinService.changeMasterPin(currentPin, newPin, userId)\r\n            )\r\n          : await MasterPinService.createMasterPin(newPin, userId);\r\n        if (!changed) {\r\n          setError('تعذر تغيير الرقم السري الرئيسي');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n        toast({ title: hasMasterPin ? (((useOverrideReset && canOverrideReset) || passwordVerified) ? \"تم إعادة تعيين الرقم السري الرئيسي\" : \"تم تغيير الرقم السري الرئيسي\") : \"تم تعيين الرقم السري الرئيسي\", description: hasMasterPin ? (((useOverrideReset && canOverrideReset) || passwordVerified) ? \"تمت إعادة التعيين بدون الحاجة للرقم الحالي\" : \"تم تغيير الرقم السري الرئيسي بنجاح\") : \"تم تعيين الرقم السري الرئيسي بنجاح\" });\r\n        onSuccess?.();\r\n        handleClose();\r\n      }\r\n    } catch (error) {\r\n      setError('حدث خطأ أثناء معالجة الرقم السري');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setCurrentPin('');\r\n    setNewPin('');\r\n    setConfirmPin('');\r\n    setError('');\r\n    setShowCurrentPin(false);\r\n    setShowNewPin(false);\r\n    setShowConfirmPin(false);\r\n    setPasswordVerified(false);\r\n    setIsPasswordConfirmOpen(false);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-center justify-center\">\r\n            <Shield className=\"h-5 w-5 text-blue-600\" />\r\n            {title}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"text-center text-sm text-gray-600 mb-4\">\r\n          {description}\r\n        </div>\r\n\r\n        <form ref={formRef} onSubmit={handleSubmit} className=\"space-y-4\">\r\n          {/* الرقم السري الحالي (للتحقق أو التغيير) */}\r\n          {(mode === 'verify' || (mode === 'change' && hasMasterPin)) && (\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"currentPin\" className=\"text-right block\">\r\n                {mode === 'verify' ? 'الرقم السري الرئيسي' : 'الرقم السري الحالي'}\r\n              </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"currentPin\"\r\n                  type={showCurrentPin ? \"text\" : \"password\"}\r\n                  autoComplete=\"off\"\r\n                  value={currentPin}\r\n                  onChange={(e) => setCurrentPin(e.target.value)}\r\n                  onKeyDown={(e) => { if (e.key === 'Enter') { try { formRef.current?.requestSubmit(); } catch {} } }}\r\n                  placeholder={mode === 'verify' ? 'أدخل الرقم السري الرئيسي' : 'أدخل الرقم السري الحالي'}\r\n                  className=\"pr-10\"\r\n                  dir=\"ltr\"\r\n                  disabled={mode === 'change' && passwordVerified}\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowCurrentPin(!showCurrentPin)}\r\n                >\r\n                  {showCurrentPin ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n              {mode === 'change' && hasMasterPin && canOverrideReset && (\r\n                <div className=\"text-xs text-gray-600 mt-2 flex items-center justify-between\">\r\n                  <span>نسيت الرقم السري؟</span>\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    className=\"h-7 px-2\"\r\n                    onClick={() => {\r\n                      setUseOverrideReset(prev => !prev);\r\n                    }}\r\n                  >\r\n                    {useOverrideReset ? 'إلغاء إعادة التعيين الإدارية' : 'إعادة تعيين بدون الرقم الحالي'}\r\n                  </Button>\r\n                </div>\r\n              )}\r\n              {mode === 'change' && hasMasterPin && (\r\n                <div className=\"text-xs text-gray-600 mt-2 flex items-center justify-between\">\r\n                  <span>لا تعرف الرقم الحالي؟ يمكنك تأكيد بكلمة الدخول</span>\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"secondary\"\r\n                    size=\"sm\"\r\n                    className=\"h-7 px-2\"\r\n                    onClick={() => setIsPasswordConfirmOpen(true)}\r\n                  >\r\n                    تأكيد بكلمة الدخول\r\n                  </Button>\r\n                </div>\r\n              )}\r\n              {mode === 'change' && passwordVerified && (\r\n                <div className=\"text-[11px] text-green-600\">تم التحقق من كلمة الدخول — يمكنك المتابعة بدون الرقم الحالي</div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* الرقم السري الجديد (للإنشاء أو التغيير) */}\r\n          {(mode === 'create' || mode === 'change') && (\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"newPin\" className=\"text-right block\">\r\n                {mode === 'create' ? 'الرقم السري الرئيسي الجديد' : 'الرقم السري الجديد'}\r\n              </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"newPin\"\r\n                  type={showNewPin ? \"text\" : \"password\"}\r\n                  autoComplete=\"off\"\r\n                  value={newPin}\r\n                  onChange={(e) => setNewPin(e.target.value)}\r\n                  onKeyDown={(e) => { if (e.key === 'Enter') { try { formRef.current?.requestSubmit(); } catch {} } }}\r\n                  placeholder={mode === 'create' ? 'أدخل الرقم السري الجديد' : 'أدخل الرقم السري الجديد'}\r\n                  className=\"pr-10\"\r\n                  dir=\"ltr\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowNewPin(!showNewPin)}\r\n                >\r\n                  {showNewPin ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* تأكيد الرقم السري الجديد (للإنشاء أو التغيير) */}\r\n          {(mode === 'create' || mode === 'change') && (\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"confirmPin\" className=\"text-right block\">\r\n                تأكيد الرقم السري الجديد\r\n              </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"confirmPin\"\r\n                  type={showConfirmPin ? \"text\" : \"password\"}\r\n                  autoComplete=\"off\"\r\n                  value={confirmPin}\r\n                  onChange={(e) => setConfirmPin(e.target.value)}\r\n                  onKeyDown={(e) => { if (e.key === 'Enter') { try { formRef.current?.requestSubmit(); } catch {} } }}\r\n                  placeholder=\"أعد إدخال الرقم السري الجديد\"\r\n                  className=\"pr-10\"\r\n                  dir=\"ltr\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowConfirmPin(!showConfirmPin)}\r\n                >\r\n                  {showConfirmPin ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* رسالة الخطأ */}\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-red-600 text-sm bg-red-50 p-3 rounded-lg\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {/* أزرار التحكم */}\r\n          <div className=\"flex gap-3 pt-4\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              className=\"flex-1\"\r\n            >\r\n              إلغاء\r\n            </Button>\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              className=\"flex-1 bg-blue-600 hover:bg-blue-700\"\r\n            >\r\n              {isLoading ? (\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n                  جاري المعالجة...\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <Lock className=\"h-4 w-4 mr-2\" />\r\n                  {mode === 'verify' ? 'تحقق' : mode === 'create' ? 'إنشاء' : 'تغيير'}\r\n                </>\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </form>\r\n        <PasswordConfirmDialog\r\n          open={isPasswordConfirmOpen}\r\n          onOpenChange={setIsPasswordConfirmOpen}\r\n          title=\"تأكيد بكلمة دخول الحساب\"\r\n          description=\"أدخل كلمة المرور المستخدمة لتسجيل الدخول للسماح بتغيير الرقم السري\"\r\n          onSuccess={() => {\r\n            setPasswordVerified(true);\r\n            setIsPasswordConfirmOpen(false);\r\n            setError('');\r\n          }}\r\n        />\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n"],"names":["MASTER_PIN_KEY_BASE","masterPinCache","getKey","userId","loadFromFirestore","data","userDataService","encoded","docRef","doc","db","snap","getDoc","loadFromLocalStorage","val","persistToFirestore","encodedPin","payload","serverTimestamp","setDoc","updateDoc","persistToLocalStorage","key","MasterPinService","userKey","localValUser","baseVal","remoteVal","pin","error","inputPin","savedEncoded","currentPin","newPin","PasswordConfirmDialog","open","onOpenChange","title","description","onSuccess","toast","useToast","password","setPassword","useState","isLoading","setIsLoading","setError","handleConfirm","currentUser","auth","credential","EmailAuthProvider","reauthenticateWithCredential","e","code","handleClose","openVal","jsx","Dialog","DialogContent","jsxs","DialogHeader","DialogTitle","DialogDescription","Lock","Input","DialogFooter","Button","MasterPinDialog","mode","setCurrentPin","setNewPin","confirmPin","setConfirmPin","showCurrentPin","setShowCurrentPin","showNewPin","setShowNewPin","showConfirmPin","setShowConfirmPin","user","profile","useFirebaseAuth","hasMasterPin","setHasMasterPin","useOverrideReset","setUseOverrideReset","canOverrideReset","isPasswordConfirmOpen","setIsPasswordConfirmOpen","passwordVerified","setPasswordVerified","formRef","useRef","useEffect","mounted","has","handleSubmit","Shield","Label","_a","EyeOff","Eye","prev","AlertCircle","Fragment"],"mappings":"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"}