const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-CWTdLx7E.js","./index-Dd7n0Un2.css"])))=>i.map(i=>d[i]);
import{X as ye,u as je,r as m,i as pe,j as e,a5 as Ne,a6 as ve,a7 as we,a8 as be,B as b,aN as Z,C as _,b as ee,c as se,ao as ke,e as R,bs as Te,aQ as ge,bt as We,b7 as le,_ as Ge,aO as He,a as Xe,F as qe,ap as Ke,I as Q,aJ as Qe,aj as Ze,aA as es}from"./index-CWTdLx7E.js";import{B as re}from"./badge-Dkne3qZK.js";import{S as ss,a as ts,b as as,c as rs,d as ns}from"./select-CQoGb_cR.js";import{a as is}from"./MasterPinDialog-BwapmE19.js";import{W as de}from"./wallet-CXLK-p8Q.js";import{S as Ue}from"./star-BUl7nXNo.js";import{a as Me}from"./square-pen-DcDaycsB.js";import{T as Pe}from"./trash-2-BKuXmImO.js";import{P as oe}from"./phone-CsW_Skzd.js";import{A as Ae}from"./arrow-left-BnhAVXv5.js";import{P as De}from"./progress-CPYwaj7F.js";import{S as ls}from"./separator-B89kj3pz.js";import{C as cs}from"./calendar-B6wCJ-48.js";import{C as Se}from"./chart-column-BOEFQMCG.js";import{T as ce}from"./trending-down-CpuGKJ3w.js";import{D as me}from"./dollar-sign-DFJExlvM.js";import{A as ie}from"./activity-CXWcyp0b.js";import{C as ds}from"./circle-alert-NzwhoXxt.js";import{C as os}from"./circle-x-Cc6eogP3.js";import{C as ms}from"./circle-check-big-C85Ma9-W.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],Fe=ye("building",hs);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]],he=ye("id-card",xs);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Ce=ye("info",us),fs=[{id:"vodafone",name:"فودافون كاش",ownerName:"أحمد محمد علي",nationalId:"29012345678901"},{id:"etisalat",name:"اتصالات كاش",ownerName:"فاطمة حسن محمود",nationalId:"28506789012345"},{id:"orange",name:"أورنج كاش",ownerName:"محمد أحمد السيد",nationalId:"29309876543210"},{id:"we_pay",name:"وي باي",ownerName:"نورا عبد الرحمن",nationalId:"29112345678901"},{id:"smart_wallet",name:"سمارت ولت",ownerName:"خالد محمد عبد الله",nationalId:"28809876543210"},{id:"access_pay",name:"أكسس باي",ownerName:"مريم أحمد حسن",nationalId:"29456789012345"},{id:"insta_pay",name:"انستا باي",ownerName:"عمر سعد محمد",nationalId:"29012345678901"}],gs=({isOpen:d,onClose:Y,onWalletSelect:C,onEditWallet:T,onDeleteWallet:y})=>{const{user:i}=je(),[v,X]=m.useState([]),[W,L]=m.useState(!1),[$,E]=m.useState([]),[F,z]=m.useState(!1),{toast:f}=pe(),H=async(a,l)=>{const p=new Date().getMonth(),D=new Date().getFullYear(),o=l.filter(N=>{const j=new Date(N.createdAt);return j.getMonth()===p&&j.getFullYear()===D&&(N.lineId===a||N.fromWallet===a)}),u=N=>{const j=N.type;return N.txnType==="receive"||j==="withdraw"||j==="withdrawal"||j==="receive"},w=N=>{const j=N.type;return N.txnType==="send"||j==="send"||j==="transfer"},P=o.filter(u).reduce((N,j)=>{const A=j.withdrawnAmount!==void 0?j.withdrawnAmount:j.amount;return N+(A||0)},0),h=o.filter(w).reduce((N,j)=>{const A=j.sentAmount!==void 0?j.sentAmount:j.amount;return N+(A||0)},0);return{withdrawalUsage:P,transferUsage:h}},B=a=>{const l=new Date().toISOString().split("T")[0],p=a.lastResetDate;if(!p)return{...a,monthlyWithdrawalUsage:0,monthlyTransferUsage:0,lastResetDate:l};const D=new Date(p),o=new Date;return D.getMonth()!==o.getMonth()||D.getFullYear()!==o.getFullYear()?{...a,monthlyWithdrawalUsage:0,monthlyTransferUsage:0,lastResetDate:l}:a};m.useEffect(()=>{if(!(i!=null&&i.uid)||!d)return;(async()=>{z(!0);try{const l=await Z.getByMerchantId(i.uid),p=await Te.getByUserId(i.uid),o=(await Promise.all(l.map(async u=>{const{withdrawalUsage:w,transferUsage:P}=await H(u.id,p),h=await ge.getWalletLimits(u.id);return{id:u.id,name:u.label||"محفظة بدون اسم",phone:u.msisdn,nationalId:u.nationalId||"",isDefault:!1,isActive:u.isActive===!0,monthlyWithdrawalLimit:(h==null?void 0:h.monthlyWithdrawLimit)??u.withdrawLimit??2e5,monthlyTransferLimit:(h==null?void 0:h.monthlyTransferLimit)??u.transferLimit??2e5,monthlyWithdrawalUsage:(h==null?void 0:h.monthlyWithdrawUsed)??w??0,monthlyTransferUsage:(h==null?void 0:h.monthlyTransferUsed)??P??0,lastResetDate:new Date().toISOString().split("T")[0],walletProvider:u.walletProvider||""}}))).map(B);X(o)}catch(l){console.error("Error loading wallets:",l),f({title:"فشل جلب بيانات المحافظ",description:"قد تكون المشكلة بسبب الصلاحيات أو الاتصال. سيتم عرض البيانات المحلية إن وُجدت. جرّب تسجيل الدخول مجددًا أو افتح صفحة اختبار المصادقة من القائمة.",variant:"destructive"})}finally{z(!1)}})()},[i==null?void 0:i.uid,d]);const U=a=>fs.find(l=>l.id===a),J=(a,l)=>l>0?Math.min(a/l*100,100):0,O=a=>new Intl.NumberFormat("ar-EG").format(a);return e.jsx(Ne,{open:d,onOpenChange:Y,children:e.jsxs(ve,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(we,{className:"pb-4",children:[e.jsxs(be,{className:"flex items-center gap-2 text-lg",children:[e.jsx(de,{className:"h-5 w-5"}),"الاطلاع على جميع المحافظ",e.jsxs(re,{variant:"secondary",className:"mr-2",children:[v.length," محفظة"]})]}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:W?e.jsxs(e.Fragment,{children:[e.jsx(b,{size:"sm",onClick:async()=>{try{if(!(i!=null&&i.uid))return;const a=v.map(l=>Z.update(l.id,{isActive:$.includes(l.id)}));await Promise.all(a),X(l=>l.map(p=>({...p,isActive:$.includes(p.id)}))),L(!1),f({title:"تم تفعيل المحافظ",description:"فقط المحافظ المحددة ستظهر في الاختيار الخارجي"});try{window.dispatchEvent(new CustomEvent("wallets:activation-updated"))}catch{}}catch(a){console.error("Error activating wallets:",a),f({title:"فشل التفعيل",description:"تعذر تفعيل المحافظ المحددة",variant:"destructive"})}},className:"h-7",children:"تفعيل المحافظ"}),e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>{L(!1),E([])},className:"h-7",children:"إلغاء"})]}):e.jsx(b,{variant:"outline",size:"sm",onClick:()=>L(!0),className:"h-7",children:"تحديد المحافظ"})})]}),F?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"جاري تحميل المحافظ..."})]})}):v.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(de,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"لا توجد محافظ مضافة حتى الآن"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(a=>{const l=U(a.walletProvider||"");J(a.monthlyWithdrawalUsage||0,a.monthlyWithdrawalLimit),J(a.monthlyTransferUsage||0,a.monthlyTransferLimit);const p=$.includes(a.id),D=W?`cursor-pointer transition-shadow border-2 ${p?"border-blue-500 shadow-lg":"hover:border-blue-300"}`:"cursor-pointer hover:shadow-lg transition-shadow border-2 hover:border-blue-300";return e.jsxs(_,{className:D,onClick:()=>{W?E(o=>o.includes(a.id)?o.filter(u=>u!==a.id):[...o,a.id]):C(a)},children:[e.jsx(ee,{className:"pb-3",children:e.jsxs(se,{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx("span",{children:a.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.isActive&&e.jsx(re,{variant:"default",className:"text-xs",children:"نشطة"}),a.isDefault&&e.jsxs(re,{variant:"default",className:"text-xs",children:[e.jsx(Ue,{className:"h-3 w-3 mr-1"}),"افتراضية"]}),e.jsx(b,{variant:"ghost",size:"sm",onClick:o=>{o.stopPropagation(),T==null||T(a)},className:"h-7 px-2",children:e.jsx(Me,{className:"h-4 w-4"})}),e.jsx(b,{variant:"ghost",size:"sm",onClick:o=>{o.stopPropagation(),y==null||y(a.id)},className:"h-7 px-2 text-destructive hover:text-destructive",children:e.jsx(Pe,{className:"h-4 w-4"})})]})]})}),e.jsxs(R,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(oe,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"font-mono",children:a.phone})]}),a.nationalId&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(he,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"font-mono",children:a.nationalId})]}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Fe,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{children:l.name})]})]}),(()=>{const o=a.monthlyWithdrawalLimit,u=a.monthlyTransferLimit,w=a.monthlyWithdrawalUsage||0,P=a.monthlyTransferUsage||0,h=Math.max(o-w,0),N=Math.max(u-P,0);return e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2",children:[e.jsxs("div",{className:"text-xs text-gray-600 font-medium text-center",children:["الحدود الشهرية: ",(l==null?void 0:l.name)||a.walletProvider," - ",a.phone]}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-red-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-200 ease-out shadow-sm",style:{width:`${Math.min(w/Math.max(o,1)*100,100)}%`}})}),e.jsx("div",{className:"w-1/2 bg-blue-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-200 ease-out shadow-sm",style:{width:`${Math.min(P/Math.max(u,1)*100,100)}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsxs("div",{className:"text-xs text-red-600 font-medium",children:["متبقي سحب: ",O(h)," جنيه"]}),e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["متبقي تحويل: ",O(N)," جنيه"]})]})]})})(),e.jsx(b,{variant:"outline",size:"sm",className:"w-full text-xs",onClick:o=>{o.stopPropagation(),C(a)},children:"عرض التفاصيل الكاملة"})]})]},a.id)})}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsxs(b,{onClick:Y,variant:"outline",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"إغلاق"]})})]})})},ys=[{id:"vodafone",name:"فودافون كاش",ownerName:"أحمد محمد علي",nationalId:"29012345678901"},{id:"etisalat",name:"اتصالات كاش",ownerName:"فاطمة حسن محمود",nationalId:"28506789012345"},{id:"orange",name:"أورنج كاش",ownerName:"محمد أحمد السيد",nationalId:"29309876543210"},{id:"we_pay",name:"وي باي",ownerName:"نورا عبد الرحمن",nationalId:"29112345678901"},{id:"smart_wallet",name:"سمارت ولت",ownerName:"خالد محمد عبد الله",nationalId:"28809876543210"},{id:"access_pay",name:"أكسس باي",ownerName:"مريم أحمد حسن",nationalId:"29456789012345"},{id:"insta_pay",name:"انستا باي",ownerName:"عمر سعد محمد",nationalId:"29012345678901"}],js=({wallet:d,isOpen:Y,onClose:C,onBack:T})=>{const{user:y}=je(),[i,v]=m.useState([]),[X,W]=m.useState(!1),[L,$]=m.useState("month"),{toast:E}=pe();if(m.useEffect(()=>{if(!d||!(y!=null&&y.uid)||!Y)return;(async()=>{W(!0);try{const g=(await Te.getByUserId(y.uid)).filter(te=>te.walletId===d.id).sort((te,q)=>new Date(q.createdAt).getTime()-new Date(te.createdAt).getTime());v(g)}catch(n){console.error("Error loading transactions:",n),E({title:"فشل جلب معاملات المحفظة",description:"قد تكون المشكلة بسبب صلاحيات Firestore أو الاتصال. تم عرض ما أمكن محليًا. جرّب تسجيل الدخول مجددًا أو صفحة اختبار المصادقة.",variant:"destructive"})}finally{W(!1)}})()},[d,y==null?void 0:y.uid,Y]),!d)return null;const F=t=>ys.find(n=>n.id===t),z=(t,n)=>n>0?Math.min(t/n*100,100):0,f=t=>new Intl.NumberFormat("ar-EG").format(t),H=t=>new Date(t).toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=(()=>{const t=new Date;let n;switch(L){case"week":n=new Date(t.getTime()-7*24*60*60*1e3);break;case"month":n=new Date(t.getFullYear(),t.getMonth(),1);break;default:return i}return i.filter(g=>new Date(g.createdAt)>=n)})(),J=t=>{const n=t.type,g=t.txnType;return n==="withdraw"||n==="withdrawal"||n==="receive"||g==="receive"},O=t=>{const n=t.type,g=t.txnType;return n==="send"||n==="transfer"||g==="send"},a=U.filter(t=>J(t)&&t.status==="completed").reduce((t,n)=>{const g=n.withdrawnAmount!==void 0?n.withdrawnAmount:n.amount;return t+(g||0)},0),l=U.filter(t=>O(t)&&t.status==="completed").reduce((t,n)=>{const g=n.sentAmount!==void 0?n.sentAmount:n.amount;return t+(g||0)},0),p=U.filter(t=>t.type==="deposit"&&t.status==="completed").reduce((t,n)=>t+n.amount,0),D=U.filter(t=>t.status==="completed"),o=D.length,u=D.reduce((t,n)=>{if(J(n)){const g=n.withdrawnAmount??n.receivedAmount??n.amount??0;return t+We(Number(g)||0,"receive")}if(O(n)){const g=n.sentAmount??n.transferredAmount??n.amount??0;return t+We(Number(g)||0,"send")}return t},0),w=F(d.walletProvider||""),P=z(d.monthlyWithdrawalUsage||0,d.monthlyWithdrawalLimit),h=z(d.monthlyTransferUsage||0,d.monthlyTransferLimit),N=t=>{switch(t){case"withdrawal":return e.jsx(ce,{className:"h-4 w-4 text-red-500"});case"transfer":return e.jsx(le,{className:"h-4 w-4 text-blue-500"});case"deposit":return e.jsx(me,{className:"h-4 w-4 text-green-500"});default:return e.jsx(ie,{className:"h-4 w-4 text-gray-500"})}},j=t=>{switch(t){case"completed":return e.jsx(ms,{className:"h-4 w-4 text-green-500"});case"pending":return e.jsx(Ge,{className:"h-4 w-4 text-yellow-500"});case"failed":return e.jsx(os,{className:"h-4 w-4 text-red-500"});default:return e.jsx(ds,{className:"h-4 w-4 text-gray-500"})}},A=t=>{switch(t){case"withdrawal":return"سحب";case"transfer":return"تحويل";case"deposit":return"إيداع";default:return"معاملة"}},ne=t=>{switch(t){case"completed":return"مكتملة";case"pending":return"قيد الانتظار";case"failed":return"فاشلة";default:return"غير محدد"}};return e.jsx(Ne,{open:Y,onOpenChange:C,children:e.jsxs(ve,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(we,{className:"pb-4",children:e.jsxs(be,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ke,{className:"h-5 w-5"}),"تفاصيل المحفظة: ",d.name,d.isDefault&&e.jsxs(re,{variant:"default",className:"mr-2",children:[e.jsx(Ue,{className:"h-3 w-3 mr-1"}),"افتراضية"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsxs(_,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"text-sm flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"المعلومات الأساسية"]})}),e.jsxs(R,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(oe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-mono",children:d.phone})]}),d.nationalId&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(he,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-mono",children:d.nationalId})]}),w&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Fe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:w.name})]}),e.jsxs("div",{className:"text-xs text-gray-600 pr-6",children:[e.jsxs("div",{children:["المالك: ",w.ownerName]}),e.jsxs("div",{className:"font-mono",children:["الرقم القومي: ",w.nationalId]})]})]}),d.lastResetDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(cs,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:["آخر إعادة تعيين: ",new Date(d.lastResetDate).toLocaleDateString("ar-EG")]})]})]})]}),e.jsxs(_,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"text-sm flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"حدود الاستخدام الشهري"]})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"h-3 w-3 text-red-500"}),"السحب الشهري"]}),e.jsxs("span",{className:"font-mono",children:[f(d.monthlyWithdrawalUsage||0)," / ",f(d.monthlyWithdrawalLimit)]})]}),e.jsx(De,{value:P,className:"h-2"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["متبقي: ",f(d.monthlyWithdrawalLimit-(d.monthlyWithdrawalUsage||0))," جنيه"]})]}),e.jsx(ls,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-3 w-3 text-green-500"}),"التحويل الشهري"]}),e.jsxs("span",{className:"font-mono",children:[f(d.monthlyTransferUsage||0)," / ",f(d.monthlyTransferLimit)]})]}),e.jsx(De,{value:h,className:"h-2"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["متبقي: ",f(d.monthlyTransferLimit-(d.monthlyTransferUsage||0))," جنيه"]})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(_,{children:e.jsxs(R,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(ce,{className:"h-5 w-5 text-red-500"})}),e.jsx("div",{className:"text-lg font-bold",children:f(a)}),e.jsx("div",{className:"text-xs text-gray-600",children:"إجمالي السحب"})]})}),e.jsx(_,{children:e.jsxs(R,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(le,{className:"h-5 w-5 text-blue-500"})}),e.jsx("div",{className:"text-lg font-bold",children:f(l)}),e.jsx("div",{className:"text-xs text-gray-600",children:"إجمالي التحويل"})]})}),e.jsx(_,{children:e.jsxs(R,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(me,{className:"h-5 w-5 text-green-500"})}),e.jsx("div",{className:"text-lg font-bold",children:f(p)}),e.jsx("div",{className:"text-xs text-gray-600",children:"إجمالي الإيداع"})]})}),e.jsx(_,{children:e.jsxs(R,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(Se,{className:"h-5 w-5 text-emerald-600"})}),e.jsx("div",{className:"text-lg font-bold",children:f(u)}),e.jsx("div",{className:"text-xs text-gray-600",children:"أرباح الفترة"})]})}),e.jsx(_,{children:e.jsxs(R,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(ie,{className:"h-5 w-5 text-purple-600"})}),e.jsx("div",{className:"text-lg font-bold",children:f(o)}),e.jsx("div",{className:"text-xs text-gray-600",children:"عدد العمليات"})]})})]}),e.jsxs(_,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"text-sm flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"سجل المعاملات"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{size:"sm",variant:L==="week"?"default":"outline",onClick:()=>$("week"),className:"text-xs",children:"أسبوع"}),e.jsx(b,{size:"sm",variant:L==="month"?"default":"outline",onClick:()=>$("month"),className:"text-xs",children:"شهر"}),e.jsx(b,{size:"sm",variant:L==="all"?"default":"outline",onClick:()=>$("all"),className:"text-xs",children:"الكل"})]})]})}),e.jsx(R,{children:X?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"جاري تحميل المعاملات..."})]})}):U.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ie,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"لا توجد معاملات في هذه الفترة"})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:U.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[N(t.type),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:[A(t.type)," - ",f(t.amount)," جنيه"]}),e.jsx("div",{className:"text-xs text-gray-600",children:H(t.createdAt)}),t.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:t.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j(t.status),e.jsx("span",{className:"text-xs",children:ne(t.status)})]})]},t.id))})})]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsxs(b,{onClick:T,variant:"outline",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"العودة للمحافظ"]}),e.jsx(b,{onClick:C,variant:"outline",children:"إغلاق"})]})]})})},fe=[{id:"vodafone",name:"فودافون كاش",ownerName:"أحمد محمد علي",nationalId:"29012345678901"},{id:"etisalat",name:"اتصالات كاش",ownerName:"فاطمة حسن محمود",nationalId:"28506789012345"},{id:"orange",name:"أورنج كاش",ownerName:"محمد أحمد السيد",nationalId:"29309876543210"},{id:"we_pay",name:"وي باي",ownerName:"نورا عبد الرحمن",nationalId:"29112345678901"},{id:"smart_wallet",name:"سمارت ولت",ownerName:"خالد محمد عبد الله",nationalId:"28809876543210"},{id:"access_pay",name:"أكسس باي",ownerName:"مريم أحمد حسن",nationalId:"29456789012345"},{id:"insta_pay",name:"انستا باي",ownerName:"عمر سعد محمد",nationalId:"29012345678901"}],zs=({isOpen:d,onClose:Y,onWalletUpdate:C,initialEditingWallet:T})=>{const{toast:y}=pe(),{user:i,userSubscription:v}=je();(()=>{var c,I;const s=((c=v==null?void 0:v.subscription)==null?void 0:c.planType)??((I=v==null?void 0:v.subscription)==null?void 0:I.plan)??(v==null?void 0:v.planType)??(v==null?void 0:v.plan)??null,r=typeof s=="string"?String(s).trim().toLowerCase():null;return s===He.TAHWEELA||r==="tahweela"||r==="تحويله"})();const X=Xe(),[W,L]=m.useState([]),[$,E]=m.useState(!1),[F,z]=m.useState(null),[f,H]=m.useState(""),[B,U]=m.useState(""),[J,O]=m.useState(""),[a,l]=m.useState(""),[p,D]=m.useState("200000"),[o,u]=m.useState("200000"),[w,P]=m.useState("100000"),[h,N]=m.useState("60000"),[j,A]=m.useState(!1),[ne,t]=m.useState(null),[n,g]=m.useState(!1),[te,q]=m.useState(!1),[_e,xe]=m.useState(!1),[Ie,ue]=m.useState(null),ae=()=>`wallets_${(i==null?void 0:i.uid)||"default"}`;m.useEffect(()=>{T&&(z(T),E(!0),H(T.name||""),U(T.phone||""),O(T.nationalId||""),l(T.walletProvider||""),D((T.monthlyWithdrawalLimit||2e5).toString()),u((T.monthlyTransferLimit||2e5).toString()),P((T.dailyWithdrawalLimit||1e5).toString()),N((T.dailyTransferLimit||6e4).toString()),A(!!T.isDefault))},[T]);const Re=s=>{const r=new Date,c=r.getMonth(),I=r.getFullYear();if(!s.lastResetDate)return{...s,monthlyWithdrawalUsage:s.monthlyWithdrawalUsage||0,monthlyTransferUsage:s.monthlyTransferUsage||0,lastResetDate:r.toISOString().split("T")[0]};const M=new Date(s.lastResetDate),V=M.getMonth(),K=M.getFullYear();return c!==V||I!==K?{...s,monthlyWithdrawalUsage:0,monthlyTransferUsage:0,lastResetDate:r.toISOString().split("T")[0]}:s},ze=async(s,r)=>{const c=new Date().getMonth(),I=new Date().getFullYear(),M=r.filter(S=>{const x=new Date(S.createdAt);return x.getMonth()===c&&x.getFullYear()===I&&S.lineId===s}),V=M.filter(S=>S.txnType==="receive").reduce((S,x)=>S+(x.amount||0),0),K=M.filter(S=>S.txnType==="send").reduce((S,x)=>S+(x.amount||0),0);return{withdrawalUsage:V,transferUsage:K}},Oe=async(s,r)=>{const c=new Date,I=c.getDate(),M=c.getMonth(),V=c.getFullYear(),K=r.filter(k=>{const G=new Date(k.createdAt);return G.getDate()===I&&G.getMonth()===M&&G.getFullYear()===V&&k.lineId===s}),S=K.filter(k=>k.txnType==="receive").reduce((k,G)=>k+(G.amount||0),0),x=K.filter(k=>k.txnType==="send").reduce((k,G)=>k+(G.amount||0),0);return{withdrawalUsage:S,transferUsage:x}};m.useEffect(()=>{(async()=>{if(!(i!=null&&i.uid)){console.log("No user authenticated, skipping wallet loading"),g(!1);return}console.log("Loading wallets for user:",i.uid),g(!0);try{const{auth:r}=await es(async()=>{const{auth:x}=await import("./index-CWTdLx7E.js").then(k=>k.cl);return{auth:x}},__vite__mapDeps([0,1]),import.meta.url);let c=0;const I=5;for(;!r.currentUser&&c<I;)console.log(`Waiting for auth state... attempt ${c+1}`),await new Promise(x=>setTimeout(x,1e3)),c++;if(!r.currentUser)throw console.error("User not authenticated in Firebase Auth after retries"),new Error("not authenticated");console.log("Firebase Auth User:",r.currentUser.uid),console.log("Context User:",i.uid),console.log("Fetching wallets from Firebase...");const M=await Z.getByMerchantId(i.uid);console.log("Fetched wallets:",M),console.log("Fetching transactions from Firebase...");const V=await Te.getByUserId(i.uid);console.log("Fetched transactions:",V);const S=(await Promise.all(M.map(async x=>{const{withdrawalUsage:k,transferUsage:G}=await ze(x.id,V),{withdrawalUsage:Je,transferUsage:Ve}=await Oe(x.id,V);return{id:x.id,name:x.label||"محفظة بدون اسم",phone:x.msisdn,isDefault:!1,monthlyWithdrawalLimit:x.withdrawLimit||2e5,monthlyTransferLimit:x.transferLimit||2e5,dailyWithdrawalLimit:x.dailyWithdrawLimit||1e5,dailyTransferLimit:x.dailyTransferLimit||6e4,monthlyWithdrawalUsage:k,monthlyTransferUsage:G,dailyWithdrawalUsage:Je,dailyTransferUsage:Ve,lastResetDate:new Date().toISOString().split("T")[0],defaultTransferCommission:x.defaultTransferCommission!=null?Number(x.defaultTransferCommission):null,defaultWithdrawCommission:x.defaultWithdrawCommission!=null?Number(x.defaultWithdrawCommission):null}}))).map(Re);L(S),console.log("Wallets loaded successfully:",S)}catch(r){console.error("Error loading wallets:",r),L([])}finally{g(!1)}})()},[i==null?void 0:i.uid]);const Le=()=>{H(""),U(""),O(""),l(""),D("200000"),u("200000"),P("100000"),N("60000"),A(!1),z(null),E(!1)},Ye=async()=>{if(!f.trim()||!B.trim()||!a.trim()){y({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}if(!(i!=null&&i.uid)){y({title:"خطأ",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}g(!0);try{if(F){await Z.update(F.id,{label:f.trim(),msisdn:B.trim(),withdrawLimit:parseInt(p),transferLimit:parseInt(o),dailyWithdrawLimit:parseInt(w),dailyTransferLimit:parseInt(h)}),await ge.setLimits(F.id,{dailyTransferLimit:parseInt(h||"0"),dailyWithdrawLimit:parseInt(w||"0"),monthlyTransferLimit:parseInt(o||"0"),monthlyWithdrawLimit:parseInt(p||"0")});const s=W.map(r=>r.id===F.id?{...r,name:f.trim(),phone:B.trim(),nationalId:J.trim(),walletProvider:a,monthlyWithdrawalLimit:parseInt(p),monthlyTransferLimit:parseInt(o),dailyWithdrawalLimit:parseInt(w),dailyTransferLimit:parseInt(h)}:r);L(s),localStorage.setItem(ae(),JSON.stringify(s)),y({title:"تم التحديث",description:"تم تحديث المحفظة بنجاح"})}else{const s={merchantUserId:i.uid,provider:a,msisdn:B.trim(),label:f.trim(),isActive:!0,dailyLimit:2e5,monthlyLimit:2e5,withdrawLimit:parseInt(p),transferLimit:parseInt(o),dailyTransferLimit:parseInt(h),dailyWithdrawLimit:parseInt(w),dailyUsage:0,monthlyUsage:0,transferUsage:0,withdrawUsage:0},r=await Z.create(s);await ge.setLimits(r,{dailyTransferLimit:parseInt(h||"0"),dailyWithdrawLimit:parseInt(w||"0"),monthlyTransferLimit:parseInt(o||"0"),monthlyWithdrawLimit:parseInt(p||"0")});const c=new Date().toISOString().split("T")[0],I={id:r,name:f.trim(),phone:B.trim(),nationalId:J.trim(),walletProvider:a,isDefault:j,monthlyWithdrawalLimit:parseInt(p),monthlyTransferLimit:parseInt(o),dailyWithdrawalLimit:parseInt(w),dailyTransferLimit:parseInt(h),monthlyWithdrawalUsage:0,monthlyTransferUsage:0,dailyWithdrawalUsage:0,dailyTransferUsage:0,lastResetDate:c,defaultTransferCommission:null,defaultWithdrawCommission:null},M=[...W,I];L(M),localStorage.setItem(ae(),JSON.stringify(M)),y({title:"تم الإنشاء",description:"تم إنشاء المحفظة بنجاح"})}C&&C(),Le(),E(!1),z(null)}catch(s){console.error("Error saving wallet:",s),y({title:"خطأ",description:"حدث خطأ أثناء حفظ المحفظة",variant:"destructive"})}finally{g(!1)}},$e=s=>{z(s),H(s.name),U(s.phone),O(s.nationalId||""),l(s.walletProvider||""),D(s.monthlyWithdrawalLimit.toString()),u(s.monthlyTransferLimit.toString()),A(s.isDefault),E(!0)},Ee=async s=>{const r=W.find(c=>c.id===s);if(r!=null&&r.isDefault){y({title:"تحذير",description:"لا يمكن حذف المحفظة الافتراضية",variant:"destructive"});return}if(!(i!=null&&i.uid)){y({title:"خطأ",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}g(!0);try{await Z.delete(s);const c=W.filter(I=>I.id!==s);L(c),localStorage.setItem(ae(),JSON.stringify(c)),C&&C(),y({title:"تم الحذف",description:"تم حذف المحفظة بنجاح"})}catch(c){console.error("Error deleting wallet:",c),y({title:"خطأ",description:"حدث خطأ أثناء حذف المحفظة",variant:"destructive"})}finally{g(!1)}},Be=s=>{const r=W.map(c=>({...c,isDefault:c.id===s}));L(r),localStorage.setItem(ae(),JSON.stringify(r)),C&&C(),y({title:"تم تحديث المحفظة الافتراضية",description:"تم تعيين المحفظة كافتراضية بنجاح"})};return e.jsxs(Ne,{open:d,onOpenChange:Y,children:[e.jsxs(ve,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(we,{className:"pb-2",children:e.jsxs(be,{className:"flex items-center gap-1 text-sm",children:[e.jsx(de,{className:"h-3 w-3"}),"إدارة المحافظ"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-sm font-semibold",children:["المحافظ المتاحة (",W.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{onClick:()=>{xe(!0)},className:"flex items-center gap-1 h-6 px-2 text-xs",size:"sm",variant:"outline",children:[e.jsx(qe,{className:"h-3 w-3"}),"الاطلاع على المحافظ"]}),e.jsxs(b,{onClick:()=>{Y(),X("/user/add-wallet")},className:"flex items-center gap-1 h-6 px-2 text-xs",size:"sm",children:[e.jsx(Ke,{className:"h-3 w-3"}),"إضافة محفظة جديدة"]})]})]}),($||F)&&e.jsxs(_,{className:"border-2 border-blue-200 bg-blue-50",children:[e.jsx(ee,{className:"pb-1",children:e.jsx(se,{className:"text-sm",children:F?"تعديل المحفظة":"إضافة محفظة جديدة"})}),e.jsxs(R,{className:"space-y-2 pt-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"شركة المحفظة"}),e.jsx("div",{className:"flex gap-1 items-center",children:e.jsxs(ss,{value:a,onValueChange:l,children:[e.jsx(ts,{className:"h-6 text-xs flex-1",children:e.jsx(as,{placeholder:"اختر شركة المحفظة"})}),e.jsx(rs,{children:fe.map(s=>e.jsx(ns,{value:s.id,className:"text-xs",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:s.name}),e.jsx("button",{type:"button",className:"h-4 w-4 p-0 ml-2 flex items-center justify-center hover:bg-blue-100 rounded",onClick:r=>{r.preventDefault(),r.stopPropagation(),t(s.id)},children:e.jsx(Ce,{className:"h-3 w-3 text-blue-500 hover:text-blue-700"})})]})},s.id))})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"اسم المحفظة"}),e.jsx(Q,{value:f,onChange:s=>H(s.target.value),placeholder:"مثال: محفظة العمل",className:"h-6 text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(Q,{value:B,onChange:s=>U(s.target.value),placeholder:"01030302038",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الرقم القومي للخط"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(Q,{value:J,onChange:s=>O(s.target.value),placeholder:"29012345678901",maxLength:14,className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الحد الشهري للسحب (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(Q,{type:"number",value:p,onChange:s=>D(s.target.value),placeholder:"200000",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الحد الشهري للتحويل (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx(Q,{type:"number",value:o,onChange:s=>u(s.target.value),placeholder:"200000",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الحد اليومي للسحب (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-red-400"}),e.jsx(Q,{type:"number",value:w,onChange:s=>P(s.target.value),placeholder:"100000",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"الحد اليومي للتحويل (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-blue-400"}),e.jsx(Q,{type:"number",value:h,onChange:s=>N(s.target.value),placeholder:"60000",className:"pl-6 h-6 text-xs"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"isDefault",checked:j,onChange:s=>A(s.target.checked),className:"rounded w-3 h-3"}),e.jsx("label",{htmlFor:"isDefault",className:"text-xs font-medium text-gray-700",children:"تعيين كمحفظة افتراضية"})]}),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(Qe,{className:"h-3 w-3 text-gray-600"}),e.jsx("label",{className:"text-xs font-medium text-gray-700",children:"إعدادات العمولة"})]})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(b,{onClick:Ye,className:"flex-1 h-6 text-xs",size:"sm",children:F?"تحديث المحفظة":"إضافة المحفظة"}),e.jsx(b,{variant:"outline",onClick:Le,className:"h-6 text-xs",size:"sm",children:"إلغاء"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:W.map(s=>{var r;return e.jsxs(_,{className:`${s.isDefault?"border-green-300 bg-green-50":""}`,children:[e.jsx(ee,{className:"pb-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(se,{className:"text-sm flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),s.name]}),s.isDefault&&e.jsx(re,{variant:"default",className:"bg-green-600 text-xs px-1 py-0",children:"افتراضية"})]})}),e.jsxs(R,{className:"space-y-1 pt-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"text-xs",children:s.phone})]}),s.walletProvider&&e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:((r=fe.find(c=>c.id===s.walletProvider))==null?void 0:r.name)||s.walletProvider}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"الحدود الشهرية"}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-red-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((s.monthlyWithdrawalUsage||0)/s.monthlyWithdrawalLimit*100,100)}%`}})}),e.jsx("div",{className:"w-1/2 bg-blue-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((s.monthlyTransferUsage||0)/s.monthlyTransferLimit*100,100)}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-0.5",children:[e.jsxs("div",{className:"text-xs text-red-600 font-medium",children:["متبقي سحب: ",Math.max(s.monthlyWithdrawalLimit-(s.monthlyWithdrawalUsage||0),0)," جنيه"]}),e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["متبقي تحويل: ",Math.max(s.monthlyTransferLimit-(s.monthlyTransferUsage||0),0)," جنيه"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"الحدود اليومية"}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-orange-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-orange-400 to-orange-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((s.dailyWithdrawalUsage||0)/s.dailyWithdrawalLimit*100,100)}%`}})}),e.jsx("div",{className:"w-1/2 bg-green-200 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-green-400 to-green-600 h-1 transition-all duration-700 ease-out shadow-sm",style:{width:`${Math.min((s.dailyTransferUsage||0)/s.dailyTransferLimit*100,100)}%`}})})]}),e.jsxs("div",{className:"flex justify بين items-center mt-0.5",children:[e.jsxs("div",{className:"text-xs text-orange-600 font-medium",children:["متبقي سحب يومي: ",Math.max(s.dailyWithdrawalLimit-(s.dailyWithdrawalUsage||0),0)," جنيه"]}),e.jsxs("div",{className:"text-xs text-green-600 font-medium",children:["متبقي تحويل يومي: ",Math.max(s.dailyTransferLimit-(s.dailyTransferUsage||0),0)," جنيه"]})]})]})]}),e.jsxs("div",{className:"flex gap-1 pt-1",children:[e.jsxs(b,{size:"sm",variant:"outline",onClick:()=>$e(s),className:"flex-1 h-5 text-xs px-1",children:[e.jsx(Me,{className:"h-2 w-2 mr-0.5"}),"تعديل"]}),!s.isDefault&&e.jsxs(e.Fragment,{children:[e.jsx(b,{size:"sm",variant:"outline",onClick:()=>Be(s.id),className:"flex-1 h-5 text-xs px-1",children:"جعلها افتراضية"}),e.jsx(b,{size:"sm",variant:"destructive",onClick:()=>Ee(s.id),className:"h-5 px-1",children:e.jsx(Pe,{className:"h-2 w-2"})})]})]})]})]},s.id)})}),W.length===0&&e.jsx("div",{className:"text-center py-4 text-gray-500 text-xs",children:"لا توجد محافظ متاحة. قم بإضافة محفظة جديدة للبدء."})]}),ne&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"معلومات صاحب المحفظة"}),e.jsx("button",{onClick:()=>t(null),className:"h-8 w-8 p-0 flex items-center justify-center hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Ze,{className:"h-4 w-4 text-gray-500"})})]}),(()=>{const s=fe.find(r=>r.id===ne);return s?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-center mb-6",children:e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg inline-block",children:e.jsx("h4",{className:"font-bold text-blue-700 text-lg",children:s.name})})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-2"}),e.jsx("span",{className:"font-semibold text-gray-700",children:"اسم صاحب المحفظة:"})]}),e.jsx("p",{className:"text-gray-900 font-medium text-lg mr-4",children:s.ownerName})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),e.jsx("span",{className:"font-semibold text-gray-700",children:"الرقم القومي:"})]}),e.jsx("p",{className:"text-gray-900 font-mono text-lg mr-4 tracking-wider",children:s.nationalId})]})]})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{className:"h-4 w-4 text-yellow-600 mr-2"}),e.jsx("span",{className:"text-sm text-yellow-800 font-medium",children:"هذه البيانات مسجلة رسمياً في النظام لهذه المحفظة"})]})})]}):null})()]})})]}),e.jsx(is,{open:_e,onOpenChange:xe,mode:"verify",title:"إدخال الرقم السري الرئيسي",description:"لا يمكن الاطلاع على المحافظ إلا بإدخال الرقم السري الرئيسي",onSuccess:()=>{xe(!1),q(!0)}}),e.jsx(gs,{isOpen:te,onClose:()=>q(!1),onWalletSelect:s=>{ue(s),q(!1)},onEditWallet:s=>{X(`/user/add-wallet?edit=1&id=${s.id}`),q(!1)},onDeleteWallet:async s=>{try{if(await Z.delete(s),L(r=>{const c=r.filter(I=>I.id!==s);try{localStorage.setItem(ae(),JSON.stringify(c))}catch(I){console.error("Failed to update localStorage wallets after delete:",I)}return c}),C)try{await C()}catch(r){console.error("onWalletUpdate callback failed:",r)}}catch(r){console.error("Error deleting wallet:",r)}}}),e.jsx(js,{wallet:Ie,isOpen:!!Ie,onClose:()=>ue(null),onBack:()=>{ue(null),q(!0)}})]})};export{zs as default};
//# sourceMappingURL=WalletManagement-CmGzcax1.js.map
