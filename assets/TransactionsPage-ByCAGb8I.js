const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dailyOperationCountService-BuoXgFag.js","./index-tnWDkOuX.js","./index-Bpuv6Nub.css","./profitService-4r9FqAF7.js"])))=>i.map(i=>d[i]);
import{J as Lt,r as m,a8 as Ss,j as t,a2 as Rs,a4 as Ps,a5 as Ie,a6 as Ve,aR as Os,T as Ze,u as _t,a0 as St,B as S,w as Rt,W as Pe,X as Oe,Y as Ee,Z as ke,Q as Ye,S as H,at as Ge,aS as j,a as Es,R as ue,aT as ks,af as Is,y as J,i as W,z as te,q as se,h as ae,av as Y,a1 as U,k as Pt,aU as Ls,o as _s,aV as pe,$ as Ms,ae as He,K as ne,I as Xe,aW as Ws,as as Ot,aX as Bs,aY as Fs,f as qe,aC as Us,ad as G,O as De}from"./index-tnWDkOuX.js";import{C as zs,a as $s,b as Vs,d as Gs}from"./card-SlwaggFS.js";import{u as Hs,S as Xs,a as qs,b as Ys,c as Ks,d as Se}from"./select-QKdc2TYn.js";import{B as Re}from"./badge-Cq-GDK1F.js";import{c as Mt,R as Zs,I as Js}from"./index-CS8iiUxP.js";import{A as Et,a as kt,C as Qs,b as ea,f as z,M as ta,c as sa,R as aa,I as ra}from"./MaintenanceDialog-BLQvmu15.js";import{M as Ke,P as na}from"./MasterPinDialog-CDin1iyv.js";import{ProfitService as he}from"./profitService-4r9FqAF7.js";import{D as ia}from"./dollar-sign-bNLkxbzG.js";import{C as Wt}from"./calendar-DYpYXkMW.js";import{A as oa}from"./arrow-left-BDVMu6ut.js";import{S as la}from"./separator-Dk6MyxBB.js";import{T as It}from"./progress-BOoGedvV.js";import{C as ca}from"./circle-x-CAZlwHZs.js";import{C as da}from"./circle-check-big-DcMEd0KV.js";import"./whatsappService-D7s14JCG.js";import"./download-DFIibxe-.js";import"./label-_mnIMROJ.js";import"./circle-alert-BbiXZQj6.js";import"./shield-DSoskD-c.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=Lt("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=Lt("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);var Le="Tabs",[pa]=Rs(Le,[Mt]),Bt=Mt(),[ha,Je]=pa(Le),Ft=m.forwardRef((g,a)=>{const{__scopeTabs:f,value:u,onValueChange:E,defaultValue:k,orientation:O="horizontal",dir:$,activationMode:_="automatic",...R}=g,T=Hs($),[D,B]=Ss({prop:u,onChange:E,defaultProp:k??"",caller:Le});return t.jsx(ha,{scope:f,baseId:Ps(),value:D,onValueChange:B,orientation:O,dir:T,activationMode:_,children:t.jsx(Ie.div,{dir:T,"data-orientation":O,...R,ref:a})})});Ft.displayName=Le;var Ut="TabsList",zt=m.forwardRef((g,a)=>{const{__scopeTabs:f,loop:u=!0,...E}=g,k=Je(Ut,f),O=Bt(f);return t.jsx(Zs,{asChild:!0,...O,orientation:k.orientation,dir:k.dir,loop:u,children:t.jsx(Ie.div,{role:"tablist","aria-orientation":k.orientation,...E,ref:a})})});zt.displayName=Ut;var $t="TabsTrigger",Vt=m.forwardRef((g,a)=>{const{__scopeTabs:f,value:u,disabled:E=!1,...k}=g,O=Je($t,f),$=Bt(f),_=Xt(O.baseId,u),R=qt(O.baseId,u),T=u===O.value;return t.jsx(Js,{asChild:!0,...$,focusable:!E,active:T,children:t.jsx(Ie.button,{type:"button",role:"tab","aria-selected":T,"aria-controls":R,"data-state":T?"active":"inactive","data-disabled":E?"":void 0,disabled:E,id:_,...k,ref:a,onMouseDown:Ve(g.onMouseDown,D=>{!E&&D.button===0&&D.ctrlKey===!1?O.onValueChange(u):D.preventDefault()}),onKeyDown:Ve(g.onKeyDown,D=>{[" ","Enter"].includes(D.key)&&O.onValueChange(u)}),onFocus:Ve(g.onFocus,()=>{const D=O.activationMode!=="manual";!T&&!E&&D&&O.onValueChange(u)})})})});Vt.displayName=$t;var Gt="TabsContent",Ht=m.forwardRef((g,a)=>{const{__scopeTabs:f,value:u,forceMount:E,children:k,...O}=g,$=Je(Gt,f),_=Xt($.baseId,u),R=qt($.baseId,u),T=u===$.value,D=m.useRef(T);return m.useEffect(()=>{const B=requestAnimationFrame(()=>D.current=!1);return()=>cancelAnimationFrame(B)},[]),t.jsx(Os,{present:E||T,children:({present:B})=>t.jsx(Ie.div,{"data-state":T?"active":"inactive","data-orientation":$.orientation,role:"tabpanel","aria-labelledby":_,hidden:!B,id:R,tabIndex:0,...O,ref:a,style:{...g.style,animationDuration:D.current?"0s":void 0},children:B&&k})})});Ht.displayName=Gt;function Xt(g,a){return`${g}-trigger-${a}`}function qt(g,a){return`${g}-content-${a}`}var xa=Ft,Yt=zt,Kt=Vt,Zt=Ht;const fa=xa,Jt=m.forwardRef(({className:g,...a},f)=>t.jsx(Yt,{ref:f,className:Ze("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",g),...a}));Jt.displayName=Yt.displayName;const xe=m.forwardRef(({className:g,...a},f)=>t.jsx(Kt,{ref:f,className:Ze("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",g),...a}));xe.displayName=Kt.displayName;const fe=m.forwardRef(({className:g,...a},f)=>t.jsx(Zt,{ref:f,className:Ze("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",g),...a}));fe.displayName=Zt.displayName;const ga=({userId:g,transactions:a=[]})=>{const[f,u]=m.useState(!1),[E,k]=m.useState(!1),[O,$]=m.useState(!1),[_,R]=m.useState({dailyWithdraw:0,dailyTransfer:0,monthlyWithdraw:0,monthlyTransfer:0,lastUpdated:new Date}),{userSubscription:T}=_t();m.useEffect(()=>{g&&f&&O&&_e()},[g,f,O]);const D=N=>`${N.toFixed(2)} ج.م`,B=async()=>{try{const N=(T==null?void 0:T.subscription)||null,p=(N==null?void 0:N.planType)??(N==null?void 0:N.plan)??null,C=typeof p=="string"?p.toLowerCase():null;if(p===H.ZERO||C==="zero"||C==="0"||p===0)return!0}catch{}try{if(g){const N=await Ge(g),p=(N==null?void 0:N.planType)??(N==null?void 0:N.plan)??null,C=typeof p=="string"?p.toLowerCase():null;if(p===H.ZERO||C==="zero"||C==="0"||p===0)return!0}}catch{}return!1},ie=async()=>{try{const N=await(async()=>{try{const p=(T==null?void 0:T.subscription)||null,C=(p==null?void 0:p.planType)??(p==null?void 0:p.plan)??null,V=typeof C=="string"?C.toLowerCase():null;if(C===H.TAHWEELA||V==="tahweela")return!0}catch{}try{if(g){const p=await Ge(g),C=(p==null?void 0:p.planType)??(p==null?void 0:p.plan)??null,V=typeof C=="string"?C.toLowerCase():null;if(C===H.TAHWEELA||V==="tahweela")return!0}}catch{}return!1})();if(await B()||N){j({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"});return}}catch{}k(!0)},re=async()=>{try{const N=await(async()=>{try{const p=(T==null?void 0:T.subscription)||null,C=(p==null?void 0:p.planType)??(p==null?void 0:p.plan)??null,V=typeof C=="string"?C.toLowerCase():null;if(C===H.TAHWEELA||V==="tahweela")return!0}catch{}try{if(g){const p=await Ge(g),C=(p==null?void 0:p.planType)??(p==null?void 0:p.plan)??null,V=typeof C=="string"?C.toLowerCase():null;if(C===H.TAHWEELA||V==="tahweela")return!0}}catch{}return!1})();if(await B()||N){j({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"}),k(!1);return}}catch{}$(!0),u(!0),k(!1)},_e=async()=>{if(g)try{if(Array.isArray(a)&&a.length>0){const p=new Date,C=p.getMonth(),V=p.getFullYear(),Me=St.filterVisibleTransactions(a,"daily",g),Q=St.filterVisibleTransactions(a,"monthly",g);let oe=0,K=0,ge=0,Z=0;Me.forEach(M=>{const le=new Date(M.createdAt),X=String(M.status||"confirmed").toLowerCase();if(le.toDateString()!==p.toDateString()||X!=="completed"&&X!=="confirmed"&&X!=="pending")return;const ee=(M.type||M.txnType||"").toLowerCase(),I={type:ee==="withdrawal"?"withdraw":ee,amount:Number(M.amount||0),commission:M.commission};I.type==="withdraw"?oe+=he.calculateProfitFromTransaction(I):(I.type==="send"||I.type==="receive"||I.type==="transfer")&&(K+=he.calculateProfitFromTransaction(I))}),Q.forEach(M=>{const le=new Date(M.createdAt),X=String(M.status||"confirmed").toLowerCase();if(le.getMonth()!==C||le.getFullYear()!==V||X!=="completed"&&X!=="confirmed"&&X!=="pending")return;const ee=(M.type||M.txnType||"").toLowerCase(),I={type:ee==="withdrawal"?"withdraw":ee,amount:Number(M.amount||0),commission:M.commission};I.type==="withdraw"?ge+=he.calculateProfitFromTransaction(I):(I.type==="send"||I.type==="receive"||I.type==="transfer")&&(Z+=he.calculateProfitFromTransaction(I))}),R({dailyWithdraw:Math.round(oe*100)/100,dailyTransfer:Math.round(K*100)/100,monthlyWithdraw:Math.round(ge*100)/100,monthlyTransfer:Math.round(Z*100)/100,lastUpdated:new Date});return}const N=he.getWithdrawTransferProfits(g);R({dailyWithdraw:N.dailyWithdrawProfit||0,dailyTransfer:N.dailyTransferProfit||0,monthlyWithdraw:N.monthlyWithdrawProfit||0,monthlyTransfer:N.monthlyTransferProfit||0,lastUpdated:new Date})}catch(N){console.error("Error loading total profits:",N)}};return t.jsxs(t.Fragment,{children:[t.jsx(S,{size:"sm",variant:"ghost",onClick:ie,className:"h-2 w-2 p-0 bg-gradient-to-r from-blue-100 to-purple-200 text-purple-700 hover:from-blue-200 hover:to-purple-300 hover:text-purple-800 rounded transition-all duration-300 hover:scale-110 shadow-sm hover:shadow-md",title:"عرض إجمالي الأرباح",children:t.jsx(Rt,{className:"h-1.5 w-1.5"})}),t.jsx(Pe,{open:f,onOpenChange:u,children:t.jsxs(Oe,{className:"max-w-[240px] mx-auto bg-white border border-gray-200 shadow-md rounded sm:max-w-[220px] sm:bg-gradient-to-br sm:from-purple-50 sm:to-white sm:border-2 sm:border-purple-200 sm:shadow-2xl sm:rounded-2xl",children:[t.jsx(Ee,{className:"text-center pb-0 border-b-0 sm:pb-2 sm:border-b sm:border-purple-200",children:t.jsxs(ke,{className:"text-xs font-bold text-purple-800 flex items-center justify-center gap-1 mb-0 leading-tight tracking-tight sm:text-xs sm:gap-1 sm:mb-0 sm:leading-normal sm:tracking-normal",children:[t.jsx(ia,{className:"h-2 w-2 text-purple-600 sm:h-3 sm:w-3"}),"إجمالي الأرباح (فوري)"]})}),t.jsxs("div",{className:"space-y-1 py-1 sm:space-y-2 sm:py-2",children:[t.jsxs("div",{className:"bg-blue-50 p-1 rounded border border-blue-200 sm:bg-gradient-to-r sm:from-blue-50 sm:to-blue-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ye,{className:"h-2 w-2 text-blue-600"}),t.jsx("span",{className:"text-[10px] font-semibold text-blue-800",children:"يومي"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-900",children:D((_.dailyWithdraw??0)+(_.dailyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 p-0.5 rounded border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Et,{className:"h-2 w-2 text-red-600"}),t.jsx("span",{className:"text-[10px] text-red-800",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700",children:D(_.dailyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-green-50 p-0.5 rounded border border-green-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(kt,{className:"h-2 w-2 text-green-600"}),t.jsx("span",{className:"text-[10px] text-green-800",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-green-700",children:D(_.dailyTransfer)})]})]})]}),t.jsxs("div",{className:"bg-purple-50 p-1 rounded border border-purple-200 sm:bg-gradient-to-r sm:from-purple-50 sm:to-purple-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Wt,{className:"h-2 w-2 text-purple-600"}),t.jsx("span",{className:"text-[10px] font-semibold text-purple-800",children:"شهري"})]}),t.jsx("span",{className:"text-[10px] font-bold text-purple-900",children:D((_.monthlyWithdraw??0)+(_.monthlyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 p-0.5 rounded border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Et,{className:"h-2 w-2 text-red-600"}),t.jsx("span",{className:"text-[10px] text-red-800",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700",children:D(_.monthlyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-0.5 rounded border border-blue-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(kt,{className:"h-2 w-2 text-blue-600"}),t.jsx("span",{className:"text-[10px] text-blue-800",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-700",children:D(_.monthlyTransfer)})]})]})]})]}),!O&&t.jsx("div",{className:"absolute inset-0 bg-yellow-200/70 backdrop-blur-sm flex items-center justify-center rounded sm:rounded-2xl border border-yellow-300 pointer-events-auto",children:t.jsx(S,{size:"sm",variant:"ghost",onClick:()=>k(!0),className:"p-2 bg-yellow-300/80 text-yellow-900 hover:bg-yellow-400/90 rounded-full shadow-sm hover:shadow-md transition-all duration-300",title:"إدخال الرقم السري الرئيسي",children:t.jsx(Rt,{className:"h-4 w-4"})})}),t.jsx("div",{className:"flex justify-center pt-1 border-t-0 sm:pt-2 sm:border-t sm:border-purple-200",children:t.jsx(S,{onClick:()=>u(!1),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-1 rounded-xl text-xs sm:bg-gradient-to-r sm:from-purple-600 sm:to-purple-700 sm:hover:from-purple-700 sm:hover:to-purple-800 sm:px-4 sm:py-1 sm:rounded-xl sm:shadow-lg sm:hover:shadow-xl sm:transition-all sm:duration-300",children:"إغلاق"})})]})}),t.jsx(Ke,{open:E,onOpenChange:k,onSuccess:re,description:"لا يمكن الاطلاع على إجمالي الأرباح إلا بإدخال الرقم السري الرئيسي"})]})},va=g=>t.jsx(ga,{...g}),Va=()=>{var yt,bt,jt,Nt,wt,Tt,Ct,At,Dt;const g=Es(),{user:a,profile:f,userSubscription:u}=_t(),E=ue.useMemo(()=>{var n,i,r,s;const e=((n=u==null?void 0:u.subscription)==null?void 0:n.planType)??((i=u==null?void 0:u.subscription)==null?void 0:i.plan)??((r=f==null?void 0:f.subscription)==null?void 0:r.planType)??((s=f==null?void 0:f.subscription)==null?void 0:s.plan)??null;return e===H.ZERO||String(e).toLowerCase()==="zero"},[(yt=u==null?void 0:u.subscription)==null?void 0:yt.planType,(bt=u==null?void 0:u.subscription)==null?void 0:bt.plan,(jt=f==null?void 0:f.subscription)==null?void 0:jt.planType,(Nt=f==null?void 0:f.subscription)==null?void 0:Nt.plan]),k=ue.useMemo(()=>{var n,i,r,s;const e=((n=u==null?void 0:u.subscription)==null?void 0:n.planType)??((i=u==null?void 0:u.subscription)==null?void 0:i.plan)??((r=f==null?void 0:f.subscription)==null?void 0:r.planType)??((s=f==null?void 0:f.subscription)==null?void 0:s.plan)??null;return e===H.TAHWEELA||String(e).toLowerCase()==="tahweela"},[(wt=u==null?void 0:u.subscription)==null?void 0:wt.planType,(Tt=u==null?void 0:u.subscription)==null?void 0:Tt.plan,(Ct=f==null?void 0:f.subscription)==null?void 0:Ct.planType,(At=f==null?void 0:f.subscription)==null?void 0:At.plan]),{shopName:O}=ks(),{isShiftActive:$,shiftUser:_}=Is(),[R,T]=m.useState([]),[D,B]=m.useState([]),[ie,re]=m.useState(new Set),[_e,N]=m.useState(!1),[p,C]=m.useState(null),[V,Me]=m.useState("all"),[Q,oe]=m.useState(""),[K,ge]=m.useState(""),[Z,M]=m.useState(""),[le,X]=m.useState(!1),[ee,I]=m.useState(!1),[Qt,Qe]=m.useState(!1),[es,et]=m.useState(!1),[tt,st]=m.useState(""),[ts,at]=m.useState("شرح التطبيق"),[ya,rt]=m.useState(null),[ce,ss]=m.useState(null),[as,ve]=m.useState(!1);ue.useEffect(()=>{var n;((n=u==null?void 0:u.subscription)==null?void 0:n.planType)===H.TAHWEELA&&(j({title:"غير متاح لاشتراكك",description:"صفحة المعاملات غير متاحة في باقة تحويله. استخدم لوحة المستخدم للتحويل/السحب فقط.",variant:"destructive"}),g("/user/dashboard"))},[(Dt=u==null?void 0:u.subscription)==null?void 0:Dt.planType]);const[ba,rs]=m.useState(!1),[ja,ns]=m.useState(!1),[Na,wa]=m.useState(!1),[is,We]=m.useState(!1),[os,nt]=m.useState(!1),[ls,it]=m.useState(!1),[cs,Be]=m.useState(!1),[ds,ms]=m.useState(null),[us,ye]=m.useState(!1),[ot,be]=m.useState({keepLastCount:30,intervalDays:7,lastResetAt:null});m.useEffect(()=>{(async()=>{if(a!=null&&a.uid)try{const n=await U.getUserData(a.uid),i=(n==null?void 0:n.recentReset)||{},r=Number(i==null?void 0:i.keepLastCount)>0?Number(i.keepLastCount):30,s=Number(i==null?void 0:i.intervalDays)>0?Number(i.intervalDays):7,l=b=>b instanceof Date?b:typeof(b==null?void 0:b.toDate)=="function"?b.toDate():b?new Date(String(b)):null,d=i!=null&&i.lastResetAt?l(i.lastResetAt):null,x=new Date;!d||x.getTime()-d.getTime()>=s*24*60*60*1e3?(await U.updateUserData(a.uid,{recentReset:{keepLastCount:r,intervalDays:s,lastResetAt:x}}),be({keepLastCount:r,intervalDays:s,lastResetAt:x})):be({keepLastCount:r,intervalDays:s,lastResetAt:d})}catch{be({keepLastCount:30,intervalDays:7,lastResetAt:null})}})()},[a==null?void 0:a.uid]),m.useEffect(()=>{if(!(a!=null&&a.uid))return;const e=J(W,"users",a.uid),n=te(e,i=>{try{const r=i.exists()?i.data():{},s=r==null?void 0:r.tutorialSeenAt,l=s!=null&&s.toDate?s.toDate():s?new Date(s):null;ss(l)}catch{}});return()=>n()},[a==null?void 0:a.uid]),m.useEffect(()=>{const e=te(J(W,"app_guides","latest"),n=>{try{const i=n.exists()?n.data():null;if(!i){st(""),at(""),rt(null),ve(!1);return}const r=String(i.url||""),s=String(i.title||"شرح التطبيق"),l=i.publishedAt,d=l!=null&&l.toDate?l.toDate():l?new Date(l):new Date;st(r),at(s),rt(d),ve(d?!ce||d.getTime()>((ce==null?void 0:ce.getTime())||0):!1)}catch{ve(!1)}},n=>{console.warn("فشل الاشتراك في دليل التطبيق:",n)});return()=>e()},[ce]);const ps=e=>{try{const n=new URL(e);let i="";return n.hostname.includes("youtube.com")?n.pathname==="/watch"?i=n.searchParams.get("v")||"":(n.pathname.startsWith("/embed/")||n.pathname.startsWith("/shorts/"))&&(i=n.pathname.split("/").pop()||""):n.hostname==="youtu.be"&&(i=n.pathname.replace(/^\//,"")),i?`https://www.youtube.com/embed/${i}?autoplay=1&rel=0`:e}catch{return e}},hs=async()=>{et(!0);try{a!=null&&a.uid&&await U.updateUserData(a.uid,{tutorialSeenAt:new Date}),ve(!1)}catch{}},[xs,je]=m.useState(!1),[Ne,lt]=m.useState(""),[de,ct]=m.useState(""),[we,dt]=m.useState(""),[mt,ut]=m.useState(!1),[pt,Te]=m.useState(0);m.useEffect(()=>{if(!(a!=null&&a.uid)){Te(0);return}const e=J(W,"users",a.uid),n=te(e,i=>{try{const r=i.exists()?i.data():{},l=(Array.isArray(r==null?void 0:r.debts)?r.debts:[]).filter(d=>(d==null?void 0:d.status)==="pending"&&(Number(d==null?void 0:d.amount)||0)>0).length;Te(l)}catch{Te(0)}},i=>{console.warn("فشل الاشتراك في ديون المستخدم من Firestore:",i),Te(0)});return()=>n()},[a==null?void 0:a.uid]),m.useEffect(()=>{fs(),gs()},[a]),m.useEffect(()=>{if(!(a!=null&&a.uid))return;let e=null,n=null;try{const i=se(ae(W,"deletedTransactions"),Y("userId","==",a.uid));e=te(i,r=>{try{const s=[];r.docChanges().forEach(l=>{const d=l.doc.data(),x=[d.originalTransactionId,d.transactionId,d.reference,l.doc.id].filter(Boolean).map(h=>String(h));s.push(...x)}),s.length>0&&(re(l=>{const d=new Set(l);return s.forEach(x=>d.add(x)),d}),T(l=>l.filter(d=>{const x=String(d.id||""),h=String(d.transactionId||""),b=String(d.reference||"");return!(s.includes(x)||s.includes(h)||s.includes(b))})))}catch(s){console.warn("deletedTransactions snapshot handling failed:",s)}},r=>{console.warn("deletedTransactions subscription error:",r)});try{n=U.subscribeDeletedTransactionsLocalSync(a.uid)}catch{}}catch{}return()=>{try{e&&e()}catch{}try{n&&n()}catch{}}},[a==null?void 0:a.uid]),m.useEffect(()=>{(async()=>{try{if(!(a!=null&&a.uid)){re(new Set);return}const e=se(ae(W,"deletedTransactions"),Y("userId","==",a.uid),Y("permanent","==",!0)),i=(await Pt(e)).docs.flatMap(r=>{const s=r.data();return[s.originalTransactionId,s.transactionId,s.reference,r.id].filter(Boolean).map(String)});re(new Set(i))}catch{re(new Set)}})()},[a==null?void 0:a.uid]),m.useEffect(()=>{if(!(a!=null&&a.uid))return;let e=null,n=!1;const i=s=>{const d=s.map(c=>{const o=c.data(),v=o==null?void 0:o.createdAt,y=v!=null&&v.toDate?v.toDate():v instanceof Date?v:new Date(v);return{id:c.id,...o,createdAt:y}}).filter(c=>(c==null?void 0:c.status)!=="cancelled"&&!(c!=null&&c.isDeleted)).filter(c=>!((c==null?void 0:c.type)==="report"||((c==null?void 0:c.title)||"").includes("إيصال تسليم وردية"))).sort((c,o)=>{const v=c.createdAt?new Date(c.createdAt).getTime():0;return(o.createdAt?new Date(o.createdAt).getTime():0)-v}).filter(c=>{const o=String(c.id||""),v=String(c.transactionId||""),y=String(c.reference||c.transactionReference||"");return!ie.has(o)&&(!v||!ie.has(v))&&(!y||!ie.has(y))}),x=a!=null&&a.uid?U.getLocalReceipts(a.uid):[],h=[...d,...Array.isArray(x)?x:[]],b=c=>{var o;return String((c==null?void 0:c.transactionId)||(c==null?void 0:c.id)||(c==null?void 0:c.reference)||(c==null?void 0:c.transactionReference)||((o=c==null?void 0:c.receipt)==null?void 0:o.reference)||`${new Date((c==null?void 0:c.createdAt)||Date.now()).getTime()}`)},P=new Set,A=h.filter(c=>{const o=b(c);return P.has(o)?!1:(P.add(o),!0)});T(A.map(Ue))},r=()=>{const s=se(ae(W,"userTransactions"),Y("userId","==",a.uid));e=te(s,l=>{try{i(l.docs)}catch(d){console.error("خطأ في معالجة بيانات الاشتراك الاحتياطي:",d)}},l=>{console.error("خطأ في الاشتراك الاحتياطي لمعاملات المستخدم:",l)})};(async()=>{try{const s=se(ae(W,"userTransactions"),Y("userId","==",a.uid)),l=await Ls(s);if(l&&l.docs&&l.docs.length>0)try{i(l.docs)}catch{}}catch{}})();try{const s=se(ae(W,"userTransactions"),Y("userId","==",a.uid),_s("createdAt","desc"),limit(200));try{e=te(s,{includeMetadataChanges:!0},l=>{try{i(l.docs)}catch(d){console.error("خطأ في معالجة بيانات الاشتراك:",d)}},l=>{if(console.error("خطأ في الاشتراك لمعاملات المستخدم:",l),!n){n=!0;try{e&&e()}catch{}r()}})}catch{const d=se(ae(W,"userTransactions"),Y("userId","==",a.uid));e=te(d,x=>{try{i(x.docs)}catch{}},x=>{console.error("خطأ في الاشتراك البسيط لمعاملات المستخدم:",x),n||(n=!0,r())})}}catch(s){console.error("فشل إعداد الاشتراك الفوري لمعاملات المستخدم، بدء السقوط الاحتياطي:",s),r()}return()=>{try{e&&e()}catch{}}},[a==null?void 0:a.uid]);const fs=async()=>{try{if(!a)return;const e=se(ae(W,"deletedTransactions"),Y("userId","==",a.uid),Y("permanent","==",!0)),[n,i,r]=await Promise.all([U.getUserTransactions(a.uid).catch(()=>[]),U.getByUserId(a.uid).catch(()=>[]),Pt(e).then(o=>o.docs.flatMap(v=>{const y=v.data();return[y.originalTransactionId,y.transactionId,y.reference,v.id].filter(Boolean).map(String)})).catch(()=>[])]),s=Array.isArray(n)&&n.length>0?n:Array.isArray(i)?i:[],l=new Set(r),x=(s||[]).map(o=>({...o,createdAt:o.createdAt instanceof Date?o.createdAt:new Date(o.createdAt)})).filter(o=>!((o==null?void 0:o.type)==="report"||((o==null?void 0:o.title)||"").includes("إيصال تسليم وردية"))).filter(o=>{const v=String(o.id||""),y=String(o.transactionId||""),w=String(o.reference||o.transactionReference||"");return!l.has(v)&&(!y||!l.has(y))&&(!w||!l.has(w))}),h=a!=null&&a.uid?U.getLocalReceipts(a.uid):[],b=[...x,...Array.isArray(h)?h:[]],P=o=>{var v;return String((o==null?void 0:o.transactionId)||(o==null?void 0:o.id)||(o==null?void 0:o.reference)||(o==null?void 0:o.transactionReference)||((v=o==null?void 0:o.receipt)==null?void 0:v.reference)||`${new Date((o==null?void 0:o.createdAt)||Date.now()).getTime()}`)},A=new Set,c=b.filter(o=>{const v=P(o);return A.has(v)?!1:(A.add(v),!0)});T(c.map(Ue))}catch(e){console.error("خطأ في تحميل معاملات المستخدم من Firestore:",e),j({title:"فشل جلب معاملات المستخدم",description:"قد تكون المشكلة صلاحيات Firestore أو اتصال الشبكة. سيتم عرض المتاح محليًا إن وُجد. جرّب تسجيل الدخول مجددًا أو افتح صفحة اختبار المصادقة.",variant:"destructive"})}},gs=async()=>{try{if(!a)return;const n=(await pe.getDeletedTransactionsByUser(a.uid)).map(i=>({...i,createdAt:i.createdAt instanceof Date?i.createdAt:new Date(i.createdAt)}));B(n.map(Ue))}catch(e){console.error("خطأ في تحميل المعاملات المحذوفة من Firestore:",e),j({title:"فشل جلب المعاملات المحذوفة",description:"تحقق من الصلاحيات والاتصال. يمكن مراجعة صفحة اختبار المصادقة للتشخيص.",variant:"destructive"})}},me=ue.useMemo(()=>{const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,1);return[...R].sort((s,l)=>l.createdAt.getTime()-s.createdAt.getTime()).filter(s=>s.createdAt>=n&&s.createdAt<i)},[R]),vs=ue.useMemo(()=>{const e=new Date,n=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,1);return Math.max(0,((R==null?void 0:R.length)||0)-(R||[]).filter(r=>r.createdAt>=n&&r.createdAt<i).length)},[R==null?void 0:R.length]),ht=me.filter(e=>{const n=!Q||e.senderPhone.includes(Q)||e.receiverPhone.includes(Q),i=!K||e.createdAt.toDateString()===new Date(K).toDateString(),r=!Z||e.createdAt.toTimeString().startsWith(Z);return n&&i&&r}),Ce=(e,n)=>{switch(e){case"completed":return t.jsx(da,{className:`h-4 w-4 ${n==="withdraw"?"text-red-500":"text-green-500"}`});case"pending":return t.jsx(Ye,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return t.jsx(ca,{className:"h-4 w-4 text-red-500"});default:return t.jsx(Ye,{className:"h-4 w-4 text-gray-500"})}},Fe=e=>{switch(e){case"completed":return"مكتمل";case"pending":return"قيد المراجعة";case"cancelled":return"ملغي";default:return"غير معروف"}},Ue=e=>{const n=((e==null?void 0:e.status)??"").toString().toLowerCase(),i=n==="confirmed"||n==="success"||n==="completed"?"completed":n==="failed"||n==="error"||n==="cancelled"||n==="canceled"?"cancelled":"pending",s=((e==null?void 0:e.type)??(e==null?void 0:e.txnType)??"").toString().toLowerCase()==="withdraw"?"withdraw":"send",l=(e==null?void 0:e.senderPhone)??(e==null?void 0:e.senderMsisdn)??(e==null?void 0:e.sender_msisdn)??(e==null?void 0:e.sender)??(e==null?void 0:e.from)??"",d=(e==null?void 0:e.receiverPhone)??(e==null?void 0:e.receiverMsisdn)??(e==null?void 0:e.receiver_msisdn)??(e==null?void 0:e.receiver)??(e==null?void 0:e.to)??"",x=e==null?void 0:e.createdAt,h=x instanceof Date?x:x!=null&&x.toDate?x.toDate():new Date(x);return{id:e==null?void 0:e.id,senderPhone:l||"غير معروف",receiverPhone:d||"غير معروف",amount:Number((e==null?void 0:e.amount)??0),status:i,type:s,createdAt:h,commission:(e==null?void 0:e.commission)??void 0,withdrawnAmount:(e==null?void 0:e.withdrawnAmount)??void 0,sentAmount:(e==null?void 0:e.sentAmount)??void 0,fromWallet:(e==null?void 0:e.fromWallet)??(e==null?void 0:e.walletId)??void 0,cashierName:(e==null?void 0:e.cashierName)??(e==null?void 0:e.createdByName)??(e==null?void 0:e.cashier)??void 0,commissionMode:(e==null?void 0:e.commissionMode)??(e==null?void 0:e.commission_mode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,walletEffectAppliedOnCreation:(e==null?void 0:e.walletEffectAppliedOnCreation)??(e==null?void 0:e.effectsAppliedOnCreation)??(e==null?void 0:e.effectAppliedOnCreation)??!1,cashEffectAppliedOnCreation:(e==null?void 0:e.cashEffectAppliedOnCreation)??!1,fee:(e==null?void 0:e.fee)??void 0,senderName:(e==null?void 0:e.senderName)??(e==null?void 0:e.customerName)??void 0}},ys=e=>({id:e.id,type:e.type==="send"?"transfer":"withdraw",sender_msisdn:e.senderPhone,receiver_msisdn:e.receiverPhone,amount:e.amount,commission:e.commission||0,status:e.status==="cancelled"?"failed":e.status,createdAt:e.createdAt.toISOString(),updatedAt:e.createdAt.toISOString(),shopName:O??(f==null?void 0:f.shopName)??(a==null?void 0:a.displayName)??"المحل",cashierName:(e==null?void 0:e.cashierName)??null,commissionMode:(e==null?void 0:e.commissionMode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,fee:(e==null?void 0:e.fee)??void 0,note:(e==null?void 0:e.note)??(e==null?void 0:e.notes)??void 0,senderName:(e==null?void 0:e.senderName)??void 0}),ze=e=>{const n=ys(e);ms(n),Be(!0)},bs=e=>{C(e),N(!0)},js=async()=>{p&&(await Ns(p.id),N(!1),C(null))},Ns=async e=>{try{const n=D.find(s=>s.id===e);if(!n||!a)return;const i=await U.saveUserTransaction(a.uid,{...n,userId:a.uid,status:"completed",cashierName:n.cashierName??"الحساب الرئيسي"});await pe.permanentlyDeleteTransaction(e,a.uid);const r={...n,id:i};T(s=>[...s,r]),B(s=>s.filter(l=>l.id!==e)),j({title:"تم الاسترجاع",description:"تم استرجاع الإيصال إلى حسابك."})}catch(n){console.error("خطأ في استرجاع المعاملة من Firestore:",n),j({title:"فشل الاسترجاع",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},ws=async e=>{try{if(!a)return;B(n=>n.filter(i=>i.id!==e)),await pe.permanentlyDeleteTransaction(e,a.uid),await U.removeUserTransaction(a.uid,e),j({title:"تم الحذف نهائيًا",description:"الإيصال لن يعود بعد التحديث."})}catch(n){console.error("فشل الحذف النهائي للمعاملة:",n),j({title:"خطأ في الحذف النهائي",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},xt=async e=>{var n,i,r;try{const s=R.find(y=>y.id===e);if(!s||!a)return;try{const y=(n=u==null?void 0:u.subscription)==null?void 0:n.planType;if(y===H.ZERO){const{dailyOperationCountService:w}=await G(async()=>{const{dailyOperationCountService:q}=await import("./dailyOperationCountService-BuoXgFag.js");return{dailyOperationCountService:q}},__vite__mapDeps([0,1,2]),import.meta.url),L=s.type==="send"?"transfer":"withdraw";if(!(await w.checkAndIncrement(a.uid,L,5)).allowed){j({title:"تم بلوغ حد باقة الزيرو",description:"مسموح بحد أقصى 5 تأكيدات يوميًا للتحويل/السحب. جرّب غدًا أو قم بالترقية.",variant:"destructive"});return}}else if(y===H.TAHWEELA){const{dailyOperationCountService:w}=await G(async()=>{const{dailyOperationCountService:q}=await import("./dailyOperationCountService-BuoXgFag.js");return{dailyOperationCountService:q}},__vite__mapDeps([0,1,2]),import.meta.url),L=s.type==="send"?"transfer":"withdraw";if(!(await w.checkAndIncrementCombined(a.uid,L,40)).allowed){j({title:"تم بلوغ حد باقة تحويله",description:"هذه الباقة تسمح بحد أقصى 40 عملية تحويل/سحب يومياً.",variant:"destructive"});return}}}catch(y){console.warn("تعذر التحقق من حد التأكيد اليومي:",y)}const l=await He.getById(a.uid);if(!(l!=null&&l.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const d=J(W,"dashboardData",l.shopId),x=await ne(d);let h=x.exists()?Number(((i=x.data())==null?void 0:i.cashBalance)||0):0;const b=x.exists()?((r=x.data())==null?void 0:r.walletBalances)||{}:{},P=s.fromWallet||Object.keys(b)[0],A=!!(s!=null&&s.limitsReservedOnCreation),c=Number(s.withdrawnAmount??s.sentAmount??s.amount??0),o=s.type==="send"?"transfer":"withdraw";try{const{walletDailyLimitsService:y}=await G(async()=>{const{walletDailyLimitsService:L}=await import("./index-tnWDkOuX.js").then(F=>F.c8);return{walletDailyLimitsService:L}},__vite__mapDeps([1,2]),import.meta.url),w=await y.canPerformOperation(P,c,o);if(!A&&!w.canPerform){j({title:"تجاوز الحدود",description:String(w.message||"لا يمكن الإكمال لتجاوز الحد اليومي/الشهري"),variant:"destructive"});return}}catch{j({title:"فشل التحقق من الحدود",description:"حاول مجددًا بعد قليل",variant:"destructive"});return}let v=!1;if(s.type==="withdraw"){const y=s.fromWallet||Object.keys(b)[0],w=Number(s.withdrawnAmount??s.amount??0),L=Number(s.commission??0),F=!!(s!=null&&s.walletEffectAppliedOnCreation),q=!!(s!=null&&s.cashEffectAppliedOnCreation);if(!F&&y&&w>0){const $e=b[y]||0;b[y]=$e+w}q?h=h+w:h=h-w,v=!0,await De(d,{cashBalance:h,walletBalances:b})}else if(s.type==="send"){const y=Number(s.commission??0),w=Number((s==null?void 0:s.fee)??0),L=Number((s==null?void 0:s.sentAmount)??(s==null?void 0:s.transferredAmount)??s.amount??0),F=Math.max(0,L)+Math.max(0,w);F>0&&(h=h+F,await De(d,{cashBalance:h}),v=!0)}await De(J(W,"userTransactions",e),{status:"completed",confirmedAt:new Date});try{const y=s.fromWallet||Object.keys(b)[0],w=Number(s.withdrawnAmount??s.sentAmount??s.amount??0);if(y&&w>0&&!A){const{walletDailyLimitsService:L}=await G(async()=>{const{walletDailyLimitsService:F}=await import("./index-tnWDkOuX.js").then(q=>q.c8);return{walletDailyLimitsService:F}},__vite__mapDeps([1,2]),import.meta.url);await L.updateUsage(y,w,s.type==="send"?"transfer":"withdraw")}}catch{j({title:"فشل تحديث الحدود",description:"تجاوز حد اليوم/الشهر يمنع الإكمال",variant:"destructive"});return}try{const{ProfitService:y}=await G(async()=>{const{ProfitService:F}=await import("./profitService-4r9FqAF7.js");return{ProfitService:F}},__vite__mapDeps([3,1,2]),import.meta.url),w=y.calculateProfitFromTransaction({type:s.type==="send"?"transfer":"withdraw",amount:Number(s.amount||0),commission:Number(s.commission||0),fee:Number((s==null?void 0:s.fee)||0)});!!!(s!=null&&s.profitAddedOnCreation)&&w>0&&y.addProfit(w,a==null?void 0:a.uid)}catch{}T(y=>y.map(w=>w.id===e?{...w,status:"completed"}:w)),j({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),Be(!1)}catch(s){console.error("خطأ في إكمال المعاملة:",s),j({title:"فشل الإكمال",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},ft=async e=>{var n,i;try{const r=R.find(s=>s.id===e);if(!r||!a)return;T(s=>s.filter(l=>l.id!==e)),B(s=>[{...r},...s]);try{let s={};try{const h=await ne(J(W,"userTransactions",e));s=h.exists()?h.data():{}}catch{}const l=e,d=String((s==null?void 0:s.transactionId)||(r==null?void 0:r.transactionId)||l),x=String((s==null?void 0:s.reference)||(s==null?void 0:s.transactionReference)||(r==null?void 0:r.reference)||(r==null?void 0:r.transactionReference)||"");await U.removeUserTransaction(a.uid,e),await pe.saveDeletedTransaction({...r,userId:a.uid,originalTransactionId:e,transactionId:d,reference:x||void 0,permanent:!0});try{await pe.permanentlyDeleteTransaction(e,a.uid)}catch{}}catch(s){console.warn("تعذر الحذف النهائي من قواعد البيانات في هذه الخطوة، سيتم الحذف من لائحة المحذوفات عند التنفيذ اليدوي للحذف النهائي:",s)}try{const s=await He.getById(a.uid);if(!(s!=null&&s.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const l=J(W,"dashboardData",s.shopId),d=await ne(l);let x=d.exists()?Number(((n=d.data())==null?void 0:n.cashBalance)||0):0;const h=d.exists()?((i=d.data())==null?void 0:i.walletBalances)||{}:{},b=Number(r.withdrawnAmount??r.amount??0),P=Number(r.commission??0),A=r.fromWallet||Object.keys(h)[0],c=!!(r!=null&&r.walletEffectAppliedOnCreation);if(r.type==="send"){const o=Number(r.fee??0),v=Number((r==null?void 0:r.sentAmount)??(r==null?void 0:r.transferredAmount)??r.amount??0);if(r.status==="completed"&&(x=x-(v+P+o)),A&&v>0){const y=h[A]||0;h[A]=y+v}}else if(r.type==="withdraw"){if(r.status==="completed"){if(x=x+b-P,A&&b>0){const o=h[A]||0;h[A]=o-b}}else if(A&&c&&b>0){const o=h[A]||0;h[A]=o-b}}await De(l,{cashBalance:x,walletBalances:h})}catch(s){console.warn("فشل عكس تأثير الأرصدة محليًا:",s)}try{const s=r.fromWallet;if(s){const{walletDailyLimitsService:l}=await G(async()=>{const{walletDailyLimitsService:x}=await import("./index-tnWDkOuX.js").then(h=>h.c8);return{walletDailyLimitsService:x}},__vite__mapDeps([1,2]),import.meta.url),d=await l.getWalletLimits(s);if(d){const x=r.type==="send",h={updatedAt:(await G(async()=>{const{serverTimestamp:o}=await import("./index-tnWDkOuX.js").then(v=>v.c2);return{serverTimestamp:o}},__vite__mapDeps([1,2]),import.meta.url)).serverTimestamp()};x?(h.dailyTransferUsed=Math.max(0,(d.dailyTransferUsed||0)-r.amount),h.monthlyTransferUsed=Math.max(0,(d.monthlyTransferUsed||0)-r.amount)):(h.dailyWithdrawUsed=Math.max(0,(d.dailyWithdrawUsed||0)-r.amount),h.monthlyWithdrawUsed=Math.max(0,(d.monthlyWithdrawUsed||0)-r.amount));const{doc:b,setDoc:P}=await G(async()=>{const{doc:o,setDoc:v}=await import("./index-tnWDkOuX.js").then(y=>y.c2);return{doc:o,setDoc:v}},__vite__mapDeps([1,2]),import.meta.url),{db:A}=await G(async()=>{const{db:o}=await import("./index-tnWDkOuX.js").then(v=>v.c3);return{db:o}},__vite__mapDeps([1,2]),import.meta.url),c=b(A,"walletLimits",s);await P(c,h,{merge:!0})}}}catch(s){console.warn("فشل استرجاع حدود المحفظة:",s)}try{const{ProfitService:s}=await G(async()=>{const{ProfitService:b}=await import("./profitService-4r9FqAF7.js");return{ProfitService:b}},__vite__mapDeps([3,1,2]),import.meta.url),{ReportsService:l}=await G(async()=>{const{ReportsService:b}=await import("./index-tnWDkOuX.js").then(P=>P.c7);return{ReportsService:b}},__vite__mapDeps([1,2]),import.meta.url),x={txnType:r.type==="send"?"send":"receive",amount:r.amount,commission:r.commission||0,createdAt:r.createdAt,status:"confirmed"},h=s.calculateProfitFromTransaction(x);h>0&&s.addProfit(-h,a.uid);try{l.removeTransactionEffects(r,a.uid)}catch{}}catch(s){console.warn("فشل تحديث التقارير/الأرباح بعد الحذف:",s)}}catch(r){console.error("خطأ أثناء حذف الإيصال:",r)}},gt=m.useRef(!1),vt=Ms();m.useEffect(()=>{!(new URLSearchParams(vt.search).get("autoTestBalances")==="1")||gt.current||(gt.current=!0,(async()=>{var i,r,s,l,d,x;try{if(!a)return;const h=await He.getById(a.uid);if(!(h!=null&&h.shopId)){console.warn("autoTest: لا يوجد shopId للمستخدم، سيتم إيقاف الاختبار.");return}const b=J(W,"dashboardData",h.shopId),P=await ne(b),A=P.exists()?Number(((i=P.data())==null?void 0:i.cashBalance)||0):0,c=P.exists()?((r=P.data())==null?void 0:r.walletBalances)||{}:{},o=Object.keys(c)[0]||void 0,v=100,y=5,w=await U.saveUserTransaction(a.uid,{senderPhone:"auto-test-sender",receiverPhone:"auto-test-receiver",amount:v,status:"pending",type:"withdraw",createdAt:new Date,reference:`AUTO-${Date.now()}`,commission:y,withdrawnAmount:v,fromWallet:o,cashierName:"AutoTest",commissionMode:"add",totalCharged:v+y,walletEffectAppliedOnCreation:!1});console.log("autoTest: تم إنشاء إيصال سحب تجريبي:",w),await xt(w);const L=await ne(b),F=L.exists()?Number(((s=L.data())==null?void 0:s.cashBalance)||0):0,q=L.exists()?((l=L.data())==null?void 0:l.walletBalances)||{}:{},$e=A-v+y,Cs=o?Number(c[o]||0)+v:void 0;console.log("autoTest: توقع الدرج بعد الإكمال:",$e,"فعلي:",F),o&&console.log("autoTest: توقع المحفظة بعد الإكمال:",Cs,"فعلي:",q[o]),await ft(w);const Ae=await ne(b),As=Ae.exists()?Number(((d=Ae.data())==null?void 0:d.cashBalance)||0):0,Ds=Ae.exists()?((x=Ae.data())==null?void 0:x.walletBalances)||{}:{};console.log("autoTest: تحقق نهائي — الدرج قبل/بعد الحذف:",A,As),o&&console.log("autoTest: تحقق نهائي — المحفظة قبل/بعد الحذف:",c[o]||0,Ds[o]||0),j({title:"اختبار الأرصدة (Firestore فقط)",description:"تم إنشاء/إكمال/حذف إيصال تجريبي والتحقق من الأرصدة.",variant:"default"})}catch(h){console.error("autoTest: فشل اختبار الأرصدة:",h),j({title:"فشل اختبار الأرصدة",description:"تحقق من الاتصال ووجود shopId والمحافظ في Firestore.",variant:"destructive"})}})())},[vt.search,a]);const Ts=async()=>{var i,r,s;const e="alkaptin678678@gmail.com",n=(r=(i=qe.currentUser)==null?void 0:i.email)==null?void 0:r.toLowerCase();if(!n||n!==e){j({title:"قيد الإنشاء",description:"ميزة الشحن متاحة لهذا الحساب فقط حالياً."});return}if(!Ne||!de||!we){j({title:"بيانات ناقصة",description:"يرجى إدخال رقم وشركة والمبلغ",variant:"destructive"});return}ut(!0);try{const d={vodafone_eg:"Vodafone",orange_eg:"Orange",etisalat_eg:"Etisalat",we_eg:"WE"}[de]??de,x=new AbortController,h=setTimeout(()=>x.abort(),15e3),b=await((s=qe.currentUser)==null?void 0:s.getIdToken()),P=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...b?{Authorization:`Bearer ${b}`}:{}},body:JSON.stringify({phone:Ne,countryCode:"EG",operator:d,amount:Number(we),useLocalAmount:!0}),signal:x.signal});clearTimeout(h);const A=await P.text();let c;try{c=JSON.parse(A)}catch{c={success:!1,message:A||"فشل قراءة استجابة الخادم"}}P.ok&&(c!=null&&c.success)?(j({title:"تم الشحن",description:(c==null?void 0:c.message)||"تم تنفيذ عملية الشحن بنجاح"}),je(!1),lt(""),ct(""),dt("")):j({title:"فشل الشحن",description:(c==null?void 0:c.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(l){console.error("Topup request error:",l),(l==null?void 0:l.name)==="AbortError"?j({title:"انتهت المهلة",description:"الخادم لم يستجب في الوقت المحدد. تأكد أن السيرفر يعمل.",variant:"destructive"}):j({title:"خطأ في الاتصال",description:"تعذر الاتصال بالخادم. حاول لاحقاً.",variant:"destructive"})}finally{ut(!1)}};return t.jsxs("div",{className:"fixed inset-0 overscroll-y-none overflow-y-auto bg-background p-4",children:[t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs(S,{variant:"ghost",size:"sm",onClick:()=>g("/user/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800",children:[t.jsx(oa,{className:"h-4 w-4"}),"العودة"]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"المعاملات"})]}),t.jsxs(zs,{className:"card-modern fade-in-up",children:[t.jsxs($s,{className:"pb-2 px-3 pt-3",children:[t.jsx(Vs,{className:"text-sm font-bold",children:"المعاملات الأخيرة"}),t.jsxs("div",{className:"flex items-center gap-0.5 mt-1 relative",children:[t.jsxs("div",{className:"flex items-center gap-0.5 flex-1 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[t.jsx(la,{className:"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors"}),t.jsx(Xe,{placeholder:"بحث...",value:Q,onChange:e=>oe(e.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400"})]}),t.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(S,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:hs,title:"شرح التطبيق",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(ua,{className:"h-2.5 w-2.5"}),as&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-600 rounded-full"})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شرح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(S,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 hover:border-purple-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(E||k){j({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"});return}I(!0)},title:"إدارة التقسيط",children:t.jsx(Ws,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تقسيط"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(va,{userId:a==null?void 0:a.uid,transactions:R}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"أرباح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(S,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border border-emerald-200 hover:border-emerald-300 transition-all duration-200 hover:scale-105",onClick:()=>{j({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."})},title:"نافذة شحن سريعة",children:t.jsx(Ot,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شحن"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(S,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:scale-105",onClick:()=>X(!0),title:"آلة حاسبة",children:t.jsx(Qs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"حاسبة"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(S,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 hover:border-green-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(E){j({title:"الخطة الحالية لا تسمح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية."});return}rs(!0)},title:"بيانات المبيعات",children:t.jsx(ea,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مبيعات"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(S,{variant:"ghost",size:"sm",className:`h-5 w-5 p-0 rounded border transition-all duration-200 hover:scale-105 ${K||Z?"bg-purple-100 text-purple-600 border-purple-300":"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200 hover:border-purple-300"}`,onClick:()=>ns(!0),title:"اختيار التاريخ",children:[t.jsx(Wt,{className:"h-2.5 w-2.5"}),(K||Z)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-purple-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تاريخ"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(S,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 hover:border-orange-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(E){j({title:"الخطة الحالية لا تسمح",description:"إدارة الديون غير متاحة في خطة زيرو. قم بالترقية."});return}We(!0)},title:"إدارة الديون",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(Bs,{className:"h-2.5 w-2.5"}),pt>0&&t.jsx("div",{className:"absolute -top-1 -right-1 z-10 min-w-[12px] h-[12px] px-[2px] bg-red-600 text-white rounded-full text-[8px] leading-[12px] flex items-center justify-center pointer-events-none ring-1 ring-white",children:pt})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"ديون"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(S,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(E){j({title:"الخطة الحالية لا تسمح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية."});return}it(!0)},title:"الصيانة",children:t.jsx(Fs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"صيانه"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(S,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-violet-50 text-violet-600 hover:bg-violet-100 border border-violet-200 hover:border-violet-300 transition-all duration-200 hover:scale-105",onClick:()=>{g("/user/dashboard",{state:{openCashierShiftModal:!0}})},title:"يومية المكنة",children:t.jsx(ma,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"المكنة"})]}),t.jsxs("div",{className:"hidden sm:flex items-center gap-1",children:[t.jsx(S,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(E){j({title:"الخطة الحالية لا تسمح",description:"الفيز الائتمانية غير متاحة في خطة زيرو. قم بالترقية."});return}nt(!0)},title:"الفيز الائتمانية",children:t.jsx(Ot,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"فيز"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(S,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105 relative",onClick:()=>{ye(!0)},title:"تصفير المعاملات الأخيرة",children:[t.jsx(It,{className:"h-2.5 w-2.5"}),vs>0&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تصفير"})]}),(Q||K||Z)&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(S,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:()=>{oe(""),ge(""),M("")},title:"مسح",children:t.jsx("span",{className:"text-[10px] font-bold",children:"×"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مسح"})]})]})]})]}),t.jsx(Gs,{className:"px-3 pb-3",children:t.jsxs(fa,{value:V,onValueChange:Me,className:"w-full",children:[t.jsxs(Jt,{className:"hidden sm:grid w-full grid-cols-4 h-10 text-sm bg-gradient-to-r from-gray-50 via-blue-50/30 to-purple-50/30 border border-gray-200/60 rounded-md p-1 shadow-sm relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 opacity-0 hover:opacity-100 transition-all duration-200"}),t.jsxs(xe,{value:"all",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-blue-200/50 hover:bg-blue-50/80 hover:text-blue-700 group",children:[t.jsx("span",{className:"relative z-10",children:"الكل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(xe,{value:"send",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-green-200/50 hover:bg-green-50/80 hover:text-green-700 group",children:[t.jsx("span",{className:"relative z-10",children:"مرسل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(xe,{value:"withdraw",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-orange-200/50 hover:bg-orange-50/80 hover:text-orange-700 group",children:[t.jsx("span",{className:"relative z-10",children:"سحب"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-orange-500/10 to-amber-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(xe,{value:"deleted",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-rose-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-red-200/50 hover:bg-red-50/80 hover:text-red-700 group",children:[t.jsx("span",{className:"relative z-10",children:"محذوف"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-500/10 to-rose-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]})]}),t.jsx(fe,{value:"all",className:"mt-2 receipts-list",children:ht.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ht.map((e,n)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>ze(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[Ce(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:`font-medium text-sm ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[z(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-red-600",children:["عمولة: ",z(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:`text-[10px] ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:`text-sm ${e.type==="withdraw"?"text-red-500":"text-green-600"}`,children:e.createdAt.toLocaleString("en-GB")})]})]}),t.jsxs("div",{className:"text-right",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-green-700",children:[z(e.amount)," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",z(e.withdrawnAmount)," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",z(e.sentAmount)," جنيه"]}),t.jsx(Re,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?e.type==="withdraw"?"bg-red-100 text-red-800 border-red-300":e.type==="send"?"bg-green-100 text-green-800 border-green-300":"":e.type==="withdraw"?"bg-red-100 text-red-800":""}`,children:e.type==="withdraw"?"سحب":Fe(e.status)})]})]},e.id))})}),t.jsx(fe,{value:"send",className:"mt-2 receipts-list",children:me.filter(e=>e.type==="send").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات إرسال محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:me.filter(e=>e.type==="send").map((e,n)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-all duration-200",onClick:()=>ze(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[Ce(e.status,e.type),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-sm text-green-700",children:[e.senderPhone," → ",e.receiverPhone]}),t.jsxs("p",{className:"text-[10px] text-green-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-green-600",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm text-green-700",children:[z(e.amount)," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",z(e.sentAmount)," جنيه"]}),t.jsx(Re,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?"bg-green-100 text-green-800 border-green-300":""}`,children:Fe(e.status)})]})]},e.id))})}),t.jsx(fe,{value:"withdraw",className:"mt-2 receipts-list",children:me.filter(e=>e.type==="withdraw").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات سحب محفوظة بعد"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:me.filter(e=>e.type==="withdraw").map((e,n)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border cursor-pointer",onClick:()=>ze(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[Ce(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.receiverPhone}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[z(e.amount)," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",z(e.withdrawnAmount)," جنيه"]}),t.jsx(Re,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?"bg-red-100 text-red-800 border-red-300":"bg-red-100 text-red-800"}`,children:Fe(e.status)})]})]},e.id))})}),t.jsx(fe,{value:"deleted",className:"mt-2",children:D.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محذوفة"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:D.map((e,n)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[Ce(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[z(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-500",children:["عمولة: ",z(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"text-right mr-2",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[z(e.amount)," جنيه"]}),t.jsx(Re,{variant:"secondary",className:"text-[10px] bg-red-100 text-red-800",children:"محذوف"})]}),t.jsx(S,{variant:"ghost",size:"sm",className:"text-green-600 hover:bg-green-100 h-10 sm:h-12 px-4 sm:px-5 min-w-[44px] touch-manipulation",onClick:()=>bs(e),children:t.jsx("span",{className:"text-xs sm:text-sm",children:"استرجاع"})}),t.jsx(S,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 h-10 sm:h-12 px-3 sm:px-4 min-w-[44px] touch-manipulation",onClick:()=>ws(e.id),children:t.jsx(It,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})]},e.id))})})]})})]}),t.jsx(Pe,{open:es,onOpenChange:et,children:t.jsxs(Oe,{className:"dialog-modern max-w-3xl w-full p-0 overflow-hidden border-0 shadow-2xl",children:[t.jsx(Ee,{className:"px-4 pt-4",children:t.jsx(ke,{className:"text-lg font-bold",children:ts||"شرح التطبيق"})}),t.jsx("div",{className:"aspect-video w-full bg-black",children:tt?t.jsx("iframe",{src:ps(tt),title:"Application Guide",className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0}):t.jsx("div",{className:"flex items-center justify-center h-full text-white/80",children:"لا يوجد فيديو متاح حالياً"})})]})}),t.jsx(ta,{open:ls,onOpenChange:it})]}),t.jsx(sa,{isOpen:os,onClose:()=>nt(!1)}),t.jsx(Ke,{open:is,onOpenChange:We,mode:"verify",title:"الرقم السري الرئيسي لفتح الديون",description:"أدخل الرقم السري الرئيسي لفتح صفحة الديون",onSuccess:()=>{We(!1),g("/user",{state:{openDebtDialog:!0}})}}),t.jsx(na,{open:us,onOpenChange:ye,title:"تأكيد كلمة المرور لتصفير المعاملات الأخيرة",description:"سيتم حذف كل المعاملات السابقة نهائيًا من حسابك وFirebase.",onSuccess:async()=>{try{if(!(a!=null&&a.uid)){ye(!1);return}const e=new Date,n=i=>i instanceof Date?i:typeof(i==null?void 0:i.toDate)=="function"?i.toDate():new Date(String(i));await U.updateUserData(a.uid,{recentReset:{keepLastCount:ot.keepLastCount??30,intervalDays:ot.intervalDays??7,lastResetAt:e}}),be(i=>({...i,lastResetAt:e})),j({title:"تم إخفاء المعاملات السابقة",description:"تم إخفاء كل الإيصالات الأقدم من وقت التصفير من العرض بدون التأثير على التقارير اليومية/الشهرية أو الحدود."})}catch(e){console.error("فشل تنفيذ التصفير النهائي:",e),j({title:"فشل التصفير",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}finally{ye(!1)}}}),t.jsx(Pe,{open:xs,onOpenChange:e=>{var n,i;if(e){const r="alkaptin678678@gmail.com",s=(i=(n=qe.currentUser)==null?void 0:n.email)==null?void 0:i.toLowerCase();if(!s||s!==r){j({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."});return}je(!0)}else je(!1)},children:t.jsxs(Oe,{dir:"rtl",className:"sm:max-w-md",children:[t.jsx(Ee,{children:t.jsx(ke,{children:"شحن رصيد الموبايل"})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"رقم الموبايل"}),t.jsx(Xe,{value:Ne,onChange:e=>lt(e.target.value),placeholder:"01XXXXXXXXX",dir:"ltr"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"الشركة"}),t.jsxs(Xs,{value:de,onValueChange:ct,children:[t.jsx(qs,{className:"w-full",children:t.jsx(Ys,{placeholder:"اختر الشركة"})}),t.jsxs(Ks,{children:[t.jsx(Se,{value:"vodafone_eg",children:"فودافون"}),t.jsx(Se,{value:"orange_eg",children:"أورنج"}),t.jsx(Se,{value:"etisalat_eg",children:"اتصالات"}),t.jsx(Se,{value:"we_eg",children:"WE"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"المبلغ بالجنيه"}),t.jsx(Xe,{type:"number",min:1,value:we,onChange:e=>dt(e.target.value?Number(e.target.value):""),placeholder:"50"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-2",children:[t.jsx(S,{variant:"outline",onClick:()=>je(!1),children:"إلغاء"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(S,{variant:"secondary",onClick:()=>g("/topup"),children:"صفحة الشحن الكاملة"}),t.jsx(S,{onClick:Ts,disabled:mt||!Ne||!de||!we,children:mt?"جارٍ التنفيذ...":"تأكيد الشحن"})]})]})]})]})}),t.jsx(Pe,{open:_e,onOpenChange:N,children:t.jsxs(Oe,{className:"sm:max-w-[460px]",children:[t.jsxs(Ee,{children:[t.jsx(ke,{children:"تأكيد استرجاع الإيصال"}),t.jsx(Us,{children:"سيتم إعادة الإيصال إلى قائمة المعاملات الحالية."})]}),p&&t.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"المبلغ"}),t.jsxs("span",{className:"font-bold",children:[p.amount," جنيه"]})]}),p.type==="withdraw"?t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"العميل"}),t.jsx("span",{className:"font-medium",children:p.receiverPhone})]}):t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"من → إلى"}),t.jsxs("span",{className:"font-medium",children:[p.senderPhone," → ",p.receiverPhone]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"الكاشير"}),t.jsx("span",{className:"font-medium",children:p.cashierName??"الحساب الرئيسي"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"التاريخ"}),t.jsx("span",{className:"font-medium",children:p.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3",children:[t.jsx(S,{variant:"outline",onClick:()=>{N(!1),C(null)},children:"إلغاء"}),t.jsx(S,{onClick:js,children:"تأكيد الاسترجاع"})]})]})}),t.jsx(aa,{isOpen:cs,onClose:()=>Be(!1),transaction:ds,onPrint:()=>window.print(),onDelete:ft,onComplete:xt}),t.jsx(Ke,{open:ee,onOpenChange:I,mode:"verify",title:"فتح إدارة التقسيط",description:"أدخل الرقم السري الرئيسي للوصول إلى إدارة التقسيط",onSuccess:()=>{I(!1),Qe(!0)}}),t.jsx(ra,{open:Qt,onOpenChange:Qe})]})};export{Va as default};
//# sourceMappingURL=TransactionsPage-ByCAGb8I.js.map
