import{$ as q,r as h,u as X,m as Y,j as e,af as G,ag as J,ah as K,ai as Q,y as L,I as S,B as f,a5 as z,a6 as ne,a1 as U,a7 as B,a as de,a2 as $,c as H,d as oe,e as ce,at as me,g as Z}from"./index-F79wE54_.js";import{B as le}from"./badge-CL3KS5lq.js";import{P as E}from"./progress-BPFzI8Ao.js";import{S as he,a as xe,b as ge,c as ue,d as M}from"./select-_viMUn4-.js";import fe from"./WalletPrinterDialog-BIs3eref.js";import{P as ye}from"./printer-Bjq4Pwm4.js";import{S as pe}from"./square-pen-CdIGtQFW.js";import"./textarea-FNjKYb28.js";import"./html2canvas.esm-BfYXEYrK.js";import"./wallet-D7yXYRLl.js";import"./arrow-left-DVGZRrC9.js";import"./save-Cw6XuImU.js";import"./download-C-zYrU0J.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],ve=q("toggle-left",je);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],be=q("toggle-right",Le);function Ne({open:j,onOpenChange:k,wallet:s,onSuccess:I}){const[t,o]=h.useState({provider:(s==null?void 0:s.provider)||"",msisdn:(s==null?void 0:s.msisdn)||"",dailyLimit:(s==null?void 0:s.dailyLimit)||0,monthlyLimit:(s==null?void 0:s.monthlyLimit)||0,transferLimit:(s==null?void 0:s.transferLimit)||2e5,withdrawLimit:(s==null?void 0:s.withdrawLimit)||2e5,dailyTransferLimit:(s==null?void 0:s.dailyTransferLimit)||6e4,dailyWithdrawLimit:(s==null?void 0:s.dailyWithdrawLimit)||1e5,monthlyTransferLimit:(s==null?void 0:s.monthlyTransferLimit)||(s==null?void 0:s.transferLimit)||2e5,monthlyWithdrawLimit:(s==null?void 0:s.monthlyWithdrawLimit)||(s==null?void 0:s.withdrawLimit)||2e5,ownerName:(s==null?void 0:s.ownerName)||"",nationalId:(s==null?void 0:s.nationalId)||""}),[m,T]=h.useState(!1),[D,u]=h.useState(null),{user:x,userSubscription:y}=X(),{toast:b}=Y();h.useEffect(()=>{j&&s?(o({provider:s.provider||"",msisdn:s.msisdn||"",dailyLimit:s.dailyLimit??0,monthlyLimit:s.monthlyLimit??0,transferLimit:s.transferLimit??2e5,withdrawLimit:s.withdrawLimit??2e5,dailyTransferLimit:s.dailyTransferLimit??6e4,dailyWithdrawLimit:s.dailyWithdrawLimit??1e5,monthlyTransferLimit:s.monthlyTransferLimit??s.transferLimit??2e5,monthlyWithdrawLimit:s.monthlyWithdrawLimit??s.withdrawLimit??2e5,ownerName:s.ownerName||"",nationalId:s.nationalId||""}),u(null)):j&&!s&&(o({provider:"",msisdn:"",dailyLimit:0,monthlyLimit:0,transferLimit:2e5,withdrawLimit:2e5,dailyTransferLimit:6e4,dailyWithdrawLimit:1e5,monthlyTransferLimit:2e5,monthlyWithdrawLimit:2e5,ownerName:"",nationalId:""}),u(null))},[s,j]);const F=(a,g)=>{const r=a.slice(0,3);return g==="vodafone_cash"&&r==="010"||g==="orange_cash"&&r==="012"||g==="etisalat_cash"&&r==="011"||g==="instapay"&&r==="015"},_=a=>{switch(a){case"INVALID_MSISDN":return"رقم المحفظة غير صالح.";case"PROVIDER_MISMATCH":return"المزوّد لا يطابق مقدمة الرقم.";case"ALREADY_EXISTS":return"المحفظة مضافة قبل كده.";case"RLS_DENIED":return"ليست لديك صلاحية لإضافة المحفظة.";default:return"خطأ غير متوقع."}},C=async a=>{var g;if(a.preventDefault(),u(null),!/^01\d{9}$/.test(t.msisdn)){u("اكتب رقم 11 رقم يبدأ بـ 01.");return}if(!F(t.msisdn,t.provider)){u("مقدم الخدمة لا يتطابق مع مقدمة الرقم.");return}if(!(s!=null&&s.id)&&(x!=null&&x.uid))try{let r=!1;const l=((g=y==null?void 0:y.subscription)==null?void 0:g.planType)??(y==null?void 0:y.planType)??null,N=typeof l=="string"?l.toLowerCase():null;if(l===z.ZERO||N==="zero"||l===0||N==="0")r=!0;else{const p=await ne(x.uid),n=(p==null?void 0:p.planType)??(p==null?void 0:p.plan)??null,v=typeof n=="string"?n.toLowerCase():null;r=n===z.ZERO||v==="zero"||n===0||v==="0"}if(r&&(await U.getByMerchantId(x.uid)).length>=5){u("باقة زيرو تسمح بإضافة 5 محافظ فقط. قم بالترقية."),b({title:"تحذير",description:"لا يمكنك إضافة أكثر من 5 محافظ في باقة زيرو. قم بالترقية.",variant:"destructive"});return}}catch(r){console.warn("Zero plan limit check failed:",r)}T(!0);try{if(!(x!=null&&x.uid)){console.warn("يجب تسجيل الدخول قبل حفظ/إضافة المحفظة");return}const r={...t,merchantUserId:x==null?void 0:x.uid,isActive:!0,provider:t.provider};if(console.log("Saving wallet data:",r),s!=null&&s.id)await U.update(s.id,r),await B.setLimits(s.id,{dailyTransferLimit:t.dailyTransferLimit,dailyWithdrawLimit:t.dailyWithdrawLimit,monthlyTransferLimit:t.monthlyTransferLimit??t.transferLimit,monthlyWithdrawLimit:t.monthlyWithdrawLimit??t.withdrawLimit}),console.log("Wallet updated successfully"),I();else{console.log("Creating new wallet...");const l=await U.create(r);console.log("Wallet created with ID:",l),await B.setLimits(l,{dailyTransferLimit:t.dailyTransferLimit,dailyWithdrawLimit:t.dailyWithdrawLimit,monthlyTransferLimit:t.monthlyTransferLimit??t.transferLimit,monthlyWithdrawLimit:t.monthlyWithdrawLimit??t.withdrawLimit});const N={id:l,...r,dailyUsage:0,monthlyUsage:0};console.log("Final wallet object:",N),I(N)}b({title:"تم إضافة المحفظة",description:`تم ${s!=null&&s.id?"تحديث":"إضافة"} المحفظة بنجاح`}),k(!1)}catch(r){console.error("Error saving wallet:",r);let l="حصل خطأ أثناء الإضافة";r.code?l=_(r.code):r.message&&(l=r.message),b({title:"خطأ",description:l,variant:"destructive"})}finally{T(!1)}};return e.jsx(G,{open:j,onOpenChange:k,children:e.jsxs(J,{className:"sm:max-w-md",children:[e.jsx(K,{children:e.jsx(Q,{children:s!=null&&s.id?"تعديل المحفظة":"إضافة محفظة جديدة"})}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"provider",children:"المزود"}),e.jsxs(he,{value:t.provider,onValueChange:a=>o({...t,provider:a}),disabled:m,children:[e.jsx(xe,{children:e.jsx(ge,{placeholder:"اختر المزود"})}),e.jsxs(ue,{children:[e.jsx(M,{value:"vodafone_cash",children:"Vodafone Cash"}),e.jsx(M,{value:"etisalat_cash",children:"Etisalat Cash"}),e.jsx(M,{value:"orange_cash",children:"Orange Cash"}),e.jsx(M,{value:"instapay",children:"InstaPay"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"msisdn",children:"رقم الهاتف"}),e.jsx(S,{id:"msisdn",placeholder:"01xxxxxxxxx",value:t.msisdn,onChange:a=>o({...t,msisdn:a.target.value}),disabled:m,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"ownerName",children:"اسم صاحب المحفظة (اختياري)"}),e.jsx(S,{id:"ownerName",type:"text",value:t.ownerName,onChange:a=>o({...t,ownerName:a.target.value}),disabled:m,placeholder:"اكتب اسم صاحب المحفظة"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"nationalId",children:"الرقم القومي (اختياري)"}),e.jsx(S,{id:"nationalId",type:"text",value:t.nationalId,onChange:a=>o({...t,nationalId:a.target.value}),disabled:m,placeholder:"الرقم القومي"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"dailyWithdrawLimit",children:"حد السحب اليومي (ج.م)"}),e.jsx(S,{id:"dailyWithdrawLimit",type:"number",min:"0",step:"0.01",value:t.dailyWithdrawLimit,onChange:a=>o({...t,dailyWithdrawLimit:parseFloat(a.target.value)||0}),disabled:m,placeholder:"100000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"dailyTransferLimit",children:"حد التحويل اليومي (ج.م)"}),e.jsx(S,{id:"dailyTransferLimit",type:"number",min:"0",step:"0.01",value:t.dailyTransferLimit,onChange:a=>o({...t,dailyTransferLimit:parseFloat(a.target.value)||0}),disabled:m,placeholder:"60000"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"monthlyWithdrawLimit",children:"حد السحب الشهري (ج.م)"}),e.jsx(S,{id:"monthlyWithdrawLimit",type:"number",min:"0",step:"0.01",value:t.monthlyWithdrawLimit,onChange:a=>o({...t,monthlyWithdrawLimit:parseFloat(a.target.value)||2e5}),disabled:m,placeholder:"200000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"monthlyTransferLimit",children:"حد التحويل الشهري (ج.م)"}),e.jsx(S,{id:"monthlyTransferLimit",type:"number",min:"0",step:"0.01",value:t.monthlyTransferLimit,onChange:a=>o({...t,monthlyTransferLimit:parseFloat(a.target.value)||2e5}),disabled:m,placeholder:"200000"})]})]}),D&&e.jsx("div",{className:"text-red-600 text-sm mt-2",children:D}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>k(!1),disabled:m,children:"إلغاء"}),e.jsx(f,{type:"submit",disabled:m,className:"btn-primary",children:m?e.jsxs(e.Fragment,{children:[e.jsx(Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"جارِ الإضافة…"]}):s!=null&&s.id?"تحديث المحفظة":"إضافة المحفظة"})]})]})]})})}function $e({showAddButton:j=!0,showUsageBars:k=!0,showLimitCards:s=!0,showEditButton:I=!0}){const[t,o]=h.useState([]),[m,T]=h.useState(!0),[D,u]=h.useState(!1),[x,y]=h.useState(!1),[b,F]=h.useState(null),[_,C]=h.useState(j),[a,g]=h.useState(!1),[r,l]=h.useState(null),[N,p]=h.useState(void 0),{user:n}=X(),{toast:v}=Y(),w=de();h.useEffect(()=>{n!=null&&n.uid&&P()},[n==null?void 0:n.uid]);const P=async()=>{try{if(!(n!=null&&n.uid)){o([]),T(!1);return}T(!0);const c=(await U.getByMerchantId(n.uid)).map(d=>({...d,dailyUsage:d.dailyUsage||0,monthlyUsage:d.monthlyUsage||0,transferUsage:d.transferUsage||0,withdrawUsage:d.withdrawUsage||0}));o(c)}catch(i){console.error("Error fetching wallets from Firebase:",i),v({title:"خطأ",description:"فشل في تحميل المحافظ من الخادم. يرجى المحاولة مرة أخرى.",variant:"destructive"}),o([])}finally{T(!1)}},ee=async(i,c)=>{try{await U.update(i,{isActive:!c});const d=t.map(W=>W.id===i?{...W,isActive:!W.isActive}:W);o(d),v({title:"تم التحديث",description:`تم ${c?"إلغاء تفعيل":"تفعيل"} المحفظة بنجاح`})}catch(d){console.error("Error toggling wallet status:",d),v({title:"خطأ",description:"فشل في تحديث حالة المحفظة",variant:"destructive"})}},ie=async(i,c)=>{l({id:i,msisdn:c}),g(!0)},se=async()=>{if(r)try{await U.delete(r.id);const i=t.filter(c=>c.id!==r.id);o(i),n!=null&&n.uid&&await P(),v({title:"تم الحذف",description:`تم حذف المحفظة ${r.msisdn} بنجاح`})}catch(i){console.error("Error deleting wallet:",i),v({title:"خطأ",description:"فشل في حذف المحفظة",variant:"destructive"})}finally{g(!1),l(null)}},A=(i,c)=>{if(c===0)return"bg-muted";const d=i/c*100;return d>=100?"bg-destructive":d>=80?"bg-warning":"bg-success"},te=i=>{switch(i){case"vodafone_cash":return"bg-red-600";case"etisalat_cash":return"bg-green-600";case"orange_cash":return"bg-orange-600";case"instapay":return"bg-blue-600";default:return"bg-gray-600"}},re=i=>{switch(i){case"vodafone_cash":return"#dc2626";case"etisalat_cash":return"#16a34a";case"orange_cash":return"#ea580c";case"instapay":return"#2563eb";default:return"#6b7280"}},ae=i=>{switch(i){case"vodafone_cash":return"فودافون كاش";case"etisalat_cash":return"اتصالات كاش";case"orange_cash":return"أورانج كاش";case"instapay":return"إنستاباي";default:return String(i).replace(/_/g," ")}};return m?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"}),e.jsx("p",{className:"text-muted-foreground animate-pulse",children:"جاري تحميل المحافظ..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"محافظي"}),e.jsxs(f,{variant:"outline",size:"sm",onClick:P,disabled:m,className:"flex items-center gap-2",children:[e.jsx("svg",{className:`w-4 h-4 ${m?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"تحديث"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{onClick:()=>y(!0),variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"طباعة محفظة"]}),j&&_&&e.jsxs(f,{onClick:()=>{u(!0),C(!1)},className:"btn-primary",children:[e.jsx($,{className:"ml-2 h-4 w-4"}),"إضافة محفظة جديدة"]})]})]}),e.jsxs("div",{className:"grid gap-6",children:[t.map(i=>{var c,d,W,O,R,V;return e.jsxs(H,{className:"card-glass hover:shadow-lg transition-all duration-300 border-l-4",style:{borderLeftColor:re(i.provider)},children:[e.jsx(oe,{className:"pb-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:`${te(i.provider)} text-white font-medium px-3 py-1`,children:ae(i.provider)}),e.jsx("div",{className:`w-3 h-3 rounded-full ${i.isActive?"bg-green-500":"bg-gray-400"}`,title:i.isActive?"نشط":"غير نشط"})]}),e.jsx(ce,{className:"text-xl font-bold text-primary",children:i.msisdn}),i.label&&e.jsxs("span",{className:"text-sm text-muted-foreground font-medium",children:["(",i.label,")"]})]})}),e.jsxs("div",{className:"flex items-center gap-2 bg-muted/50 rounded-lg p-2",children:[I&&e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>{w(`/user/add-wallet?edit=1&id=${i.id}`)},children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>ee(i.id,i.isActive),children:i.isActive?e.jsx(be,{className:"h-5 w-5 text-success"}):e.jsx(ve,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>ie(i.id,i.msisdn),className:"text-destructive hover:text-destructive",children:e.jsx(me,{className:"h-4 w-4"})})]})]})}),e.jsx(Z,{className:"pt-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 p-3 rounded-md border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium mb-2 text-center",children:["الحدود الشهرية: ",i.provider," - ",i.msisdn]}),e.jsxs("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-red-200 dark:bg-red-900/50 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-red-400 to-red-600 h-2 transition-all duration-200 ease-out",style:{width:`${i.withdrawLimit?Math.min((i.withdrawUsage||0)/i.withdrawLimit*100,100):0}%`}})}),e.jsx("div",{className:"w-1/2 bg-blue-200 dark:bg-blue-900/50 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 h-2 transition-all duration-200 ease-out",style:{width:`${i.transferLimit?Math.min((i.transferUsage||0)/i.transferLimit*100,100):0}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsxs("div",{className:"text-xs text-red-600 dark:text-red-400 font-medium",children:["متبقي سحب: ",Math.max((i.withdrawLimit||0)-(i.withdrawUsage||0),0).toLocaleString()," جنيه"]}),e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium",children:["متبقي تحويل: ",Math.max((i.transferLimit||0)-(i.transferUsage||0),0).toLocaleString()," جنيه"]})]})]}),k&&e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-3",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"الاستخدام اليومي"}),e.jsxs("span",{className:"font-bold",children:[(c=i.dailyUsage)==null?void 0:c.toLocaleString()," / ",i.dailyLimit>0?i.dailyLimit.toLocaleString():"∞"," جنيه"]})]}),e.jsx(E,{value:i.dailyLimit>0?Math.min((i.dailyUsage||0)/i.dailyLimit*100,100):0,className:`h-3 ${A(i.dailyUsage||0,i.dailyLimit)}`}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1 text-right",children:[i.dailyLimit>0?((i.dailyUsage||0)/i.dailyLimit*100).toFixed(1):0,"% مستخدم"]})]}),k&&e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-3",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"الاستخدام الشهري"}),e.jsxs("span",{className:"font-bold",children:[(d=i.monthlyUsage)==null?void 0:d.toLocaleString()," / ",i.monthlyLimit>0?i.monthlyLimit.toLocaleString():"∞"," جنيه"]})]}),e.jsx(E,{value:i.monthlyLimit>0?Math.min((i.monthlyUsage||0)/i.monthlyLimit*100,100):0,className:`h-3 ${A(i.monthlyUsage||0,i.monthlyLimit)}`}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1 text-right",children:[i.monthlyLimit>0?((i.monthlyUsage||0)/i.monthlyLimit*100).toFixed(1):0,"% مستخدم"]})]}),s&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/30 rounded-lg p-4 border border-blue-200 dark:border-blue-900/50",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-3",children:[e.jsx("span",{className:"font-medium text-blue-700 dark:text-blue-400",children:"حد التحويل"}),e.jsxs("span",{className:"font-bold text-blue-900 dark:text-blue-200",children:[((W=i.transferUsage)==null?void 0:W.toLocaleString())||0," / ",((O=i.transferLimit)==null?void 0:O.toLocaleString())||2e5," جنيه"]})]}),e.jsx(E,{value:i.transferLimit?Math.min((i.transferUsage||0)/i.transferLimit*100,100):0,className:"h-3 bg-blue-100 dark:bg-blue-900/30"}),e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1 text-right",children:[i.transferLimit?((i.transferUsage||0)/i.transferLimit*100).toFixed(1):0,"% مستخدم"]}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1 text-right font-medium",children:["المتبقي: ",Math.max((i.transferLimit||0)-(i.transferUsage||0),0).toLocaleString()," جنيه"]})]}),s&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-950/30 rounded-lg p-4 border border-green-200 dark:border-green-900/50",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-3",children:[e.jsx("span",{className:"font-medium text-green-700 dark:text-green-400",children:"حد السحب"}),e.jsxs("span",{className:"font-bold text-green-900 dark:text-green-200",children:[((R=i.withdrawUsage)==null?void 0:R.toLocaleString())||0," / ",((V=i.withdrawLimit)==null?void 0:V.toLocaleString())||2e5," جنيه"]})]}),e.jsx(E,{value:i.withdrawLimit?Math.min((i.withdrawUsage||0)/i.withdrawLimit*100,100):0,className:"h-3 bg-green-100 dark:bg-green-900/30"}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1 text-right",children:[i.withdrawLimit?((i.withdrawUsage||0)/i.withdrawLimit*100).toFixed(1):0,"% مستخدم"]}),e.jsxs("div",{className:"text-xs text-green-700 dark:text-green-300 mt-1 text-right font-medium",children:["المتبقي: ",Math.max((i.withdrawLimit||0)-(i.withdrawUsage||0),0).toLocaleString()," جنيه"]})]})]})})]},i.id)}),t.length===0&&e.jsx(H,{className:"card-glass",children:e.jsxs(Z,{className:"text-center py-16",children:[e.jsx("div",{className:"bg-muted/30 rounded-full w-24 h-24 mx-auto mb-6 flex items-center justify-center",children:e.jsx($,{className:"w-12 h-12 text-muted-foreground"})}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"لا توجد محافظ"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"ابدأ بإضافة محفظتك الأولى لتتمكن من استقبال المدفوعات من عملائك"}),j&&_&&e.jsxs(f,{onClick:()=>{u(!0),C(!1)},size:"lg",className:"btn-primary px-8",children:[e.jsx($,{className:"w-5 h-5 ml-2"}),"إضافة محفظة جديدة"]})]})})]}),e.jsx(Ne,{open:D,onOpenChange:i=>{u(i),i||(F(null),C(!0))},wallet:b,onSuccess:i=>{console.log("onSuccess called with:",i),console.log("editingWallet:",b),i&&!b?(console.log("Adding new wallet to list"),o(c=>{const d=[...c,i];return console.log("Updated wallets list:",d),d})):(console.log("Refreshing wallets from Firebase"),P()),u(!1),F(null),C(!0)}}),e.jsx(G,{open:a,onOpenChange:g,children:e.jsxs(J,{children:[e.jsx(K,{children:e.jsx(Q,{children:"تأكيد حذف المحفظة"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["هل أنت متأكد من حذف المحفظة ",r==null?void 0:r.msisdn,"؟ هذا الإجراء لا يمكن التراجع عنه."]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{variant:"outline",onClick:()=>g(!1),children:"إلغاء"}),e.jsx(f,{variant:"destructive",onClick:se,children:"حذف"})]})]})]})}),e.jsx(fe,{isOpen:x,onClose:()=>{y(!1),p(void 0)},wallets:t.map(i=>({id:i.id,name:i.label||i.msisdn,phone:i.msisdn,walletProvider:i.provider})),initialWalletId:N})]})}export{$e as WalletsManagement};
//# sourceMappingURL=WalletsManagement-BZ_0C27Z.js.map
