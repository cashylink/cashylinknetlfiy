{"version":3,"file":"CPanelPage-DnPtgr8M.js","sources":["../../src/pages/CPanelPage.tsx"],"sourcesContent":["import React, { useState } from \"react\";\nimport { Card, CardHeader, CardTitle, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { useFirebaseAuth } from \"@/contexts/FirebaseAuthContext\";\nimport { functions } from \"@/firebase\";\nimport { httpsCallable } from \"firebase/functions\";\n\nexport default function CPanelPage() {\n  const { user, profile, isSubscriptionActive, userSubscription } = useFirebaseAuth();\n  const [open, setOpen] = useState(false);\n  const [shopName, setShopName] = useState(\"\");\n  const [managerName, setManagerName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [message, setMessage] = useState<string | null>(null);\n\n  const isBranchPackageActive = userSubscription?.branchPackage?.status === \"active\";\n  const canManage = (\n    profile?.role === \"admin\" ||\n    profile?.role === \"merchant\" ||\n    isSubscriptionActive ||\n    isBranchPackageActive\n  );\n\n  const resetForm = () => {\n    setShopName(\"\");\n    setManagerName(\"\");\n    setEmail(\"\");\n    setPassword(\"\");\n  };\n\n  const handleCreate = async () => {\n    setMessage(null);\n    if (!canManage) {\n      setMessage(\"هذه العملية تتطلب اشتراكًا مفعلًا أو صلاحية مدير/تاجر.\");\n      return;\n    }\n\n    if (!shopName || !managerName || !email || !password) {\n      setMessage(\"يرجى ملء جميع الحقول المطلوبة.\");\n      return;\n    }\n\n    try {\n      setLoading(true);\n      const createFn = httpsCallable(functions, \"createShopAndManager\");\n      const result: any = await createFn({\n        shopName,\n        managerName,\n        email,\n        password,\n      });\n      const data = result?.data;\n      setMessage(\n        data?.success\n          ? `تم إنشاء المتجر (${data.shopId}) ومدير الحساب بنجاح.`\n          : \"فشل إنشاء الحساب، حاول مرة أخرى.\"\n      );\n      if (data?.success) {\n        resetForm();\n        setOpen(false);\n      }\n    } catch (err: any) {\n      const msg = err?.message || \"حدث خطأ غير متوقع أثناء الإنشاء\";\n      setMessage(msg);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-4\">\n      <Card>\n        <CardHeader>\n          <CardTitle>لوحة التحكم (CPanel)</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-muted-foreground\">\n                إضافة محل جديد مع إنشاء حساب المدير ليتسجل من صفحة الدخول العادية.\n              </p>\n            </div>\n            <Button onClick={() => setOpen(true)} disabled={!canManage}>\n              إضافة محل\n            </Button>\n          </div>\n\n          {!user && (\n            <p className=\"mt-3 text-sm text-red-600\">\n              يجب تسجيل الدخول للوصول إلى لوحة التحكم.\n            </p>\n          )}\n          {user && !canManage && (\n            <p className=\"mt-3 text-sm text-red-600\">\n              حسابك ليس لديه صلاحيات كافية أو اشتراك/باقة فروع مفعّلة لإنشاء المحلات.\n              إذا كنت مشتركًا بباقة مدفوعة أو لديك باقة فروع مفعّلة، ستتمكن من إضافة الحسابات مباشرة.\n            </p>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={open} onOpenChange={setOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>إضافة محل ومدير</DialogTitle>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-2\">\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"shopName\">اسم المحل</Label>\n              <Input\n                id=\"shopName\"\n                value={shopName}\n                onChange={(e) => setShopName(e.target.value)}\n                placeholder=\"مثال: متجر أحمد\"\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"managerName\">اسم المدير</Label>\n              <Input\n                id=\"managerName\"\n                value={managerName}\n                onChange={(e) => setManagerName(e.target.value)}\n                placeholder=\"مثال: أحمد علي\"\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"email\">الإيميل</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                placeholder=\"example@mail.com\"\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"password\">الباسوورد</Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                placeholder=\"••••••••\"\n              />\n            </div>\n            {message && (\n              <p className=\"text-sm text-muted-foreground\">{message}</p>\n            )}\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setOpen(false)} disabled={loading}>\n              إلغاء\n            </Button>\n            <Button onClick={handleCreate} disabled={loading || !canManage}>\n              {loading ? \"جاري الإنشاء...\" : \"إنشاء الحساب\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}"],"names":["CPanelPage","user","profile","isSubscriptionActive","userSubscription","useFirebaseAuth","open","setOpen","useState","shopName","setShopName","managerName","setManagerName","email","setEmail","password","setPassword","loading","setLoading","message","setMessage","isBranchPackageActive","_a","canManage","resetForm","handleCreate","result","httpsCallable","functions","data","err","msg","jsxs","Card","jsx","CardHeader","CardTitle","CardContent","Button","Dialog","DialogContent","DialogHeader","DialogTitle","Label","Input","e","DialogFooter"],"mappings":"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"}