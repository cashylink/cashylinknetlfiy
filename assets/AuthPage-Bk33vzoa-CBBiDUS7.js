import{X as S,C as $,S as c,q,W as D,d as H,I as e,J as I,H as L,t as u,a as g,k as _,c as x}from"./index-BsVRzvOf.js";import{o as W,c as F,i as J,l as K}from"./card-SlwaggFS-BswsJdJN.js";import{h as P}from"./BrandLogo-BV6Nd5YH-MYYsMva0.js";import{m as X,w as j}from"./brandingService-C3FKjfeb-B084ml0j.js";import{a as w}from"./download-DFIibxe--CsopZRn5.js";const z=m=>{const p=m.replace(/\D/g,"");return/^01(0|1|2|5)\d{8}$/.test(p)};function G(){const[m]=S(),p=$(),y=m.get("mode")||"signin",[l,N]=c.useState(y==="signup"),[h,v]=c.useState(!1),[t,b]=c.useState(q()),[a,d]=c.useState({email:"",password:"",fullName:"",phone:""}),{signIn:C,signUp:U,user:k}=D();c.useEffect(()=>{try{const r=typeof window<"u"?window.localStorage.getItem("cashy:lastEmail"):null;r&&d(s=>({...s,email:r,password:""}))}catch{}},[]);const{toast:n}=H();if(k)return e.jsx(I,{to:"/dashboard-redirect",replace:!0});c.useEffect(()=>{(async()=>{try{const r=await L();b(r||{})}catch(r){console.error("Failed to load app downloads",r)}})()},[]);const E=async r=>{if(r.preventDefault(),h){n({title:"جارٍ التنفيذ",description:"يرجى الانتظار حتى تكتمل العملية"});return}if(typeof navigator<"u"&&navigator.onLine===!1){n({title:"لا يوجد اتصال",description:"تحقق من اتصال الإنترنت ثم أعد المحاولة",variant:"destructive"});return}v(!0);try{if(l){const s=(a.email||"").trim().toLowerCase(),f=(a.password||"").trim();if(!z(a.phone))throw n({title:"رقم غير صالح",description:"يجب أن يكون رقم مصري 11 رقم ويبدأ بـ 010/011/012/015",variant:"destructive"}),new Error("رقم الهاتف غير صالح");const{error:o}=await U(s,f,a.fullName,a.phone);if(o)throw o;n({title:"تم إنشاء الحساب بنجاح!",description:"تحقق من بريدك الإلكتروني لتفعيل الحساب"});const i=a.fullName||"التاجر الجديد";p(`/user/account-setup?user_name=${encodeURIComponent(i)}`)}else{const s=(a.email||"").trim().toLowerCase(),f=(a.password||"").trim();if(!/^\S+@\S+\.\S+$/.test(s))throw new Error("صيغة البريد الإلكتروني غير صحيحة");const{error:o}=await C(s,f);if(o){const i=o==null?void 0:o.code;throw i==="auth/invalid-email"?new Error("صيغة البريد الإلكتروني غير صحيحة"):i==="auth/user-not-found"?new Error("لا يوجد حساب بهذا البريد الإلكتروني"):i==="auth/wrong-password"?new Error("كلمة المرور غير صحيحة"):i==="auth/invalid-credential"?new Error("البريد الإلكتروني أو كلمة المرور غير صحيحة"):i==="auth/too-many-requests"?new Error("تم تجاوز عدد المحاولات المسموح، حاول لاحقاً"):o}n({title:"مرحباً بك!",description:"تم تسجيل الدخول بنجاح، جاري إعداد حسابك..."})}}catch(s){n({title:"خطأ",description:(s==null?void 0:s.message)||"حدث خطأ أثناء المعالجة",variant:"destructive"})}finally{v(!1)}};return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs(W,{className:"w-full max-w-md",children:[e.jsxs(F,{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx(P,{size:32}),e.jsx("span",{className:"text-xl font-bold",children:"CashyLink"})]}),e.jsx(J,{children:l?"إنشاء حساب جديد":"تسجيل الدخول"})]}),e.jsxs(K,{children:[e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[l&&e.jsxs(e.Fragment,{children:[e.jsx(u,{placeholder:"الاسم الكامل",value:a.fullName,onChange:r=>d({...a,fullName:r.target.value}),required:!0}),e.jsx(u,{placeholder:"رقم مصري (11 رقم يبدأ بـ 010/011/012/015)",value:a.phone,onChange:r=>d({...a,phone:r.target.value}),dir:"ltr",inputMode:"numeric",required:!0})]}),e.jsx(u,{type:"email",placeholder:"البريد الإلكتروني",value:a.email,onChange:r=>{const s=r.target.value;d({...a,email:s});try{window.localStorage.setItem("cashy:lastEmail",s)}catch{}},required:!0}),e.jsx(u,{type:"password",placeholder:"كلمة المرور",value:a.password,onChange:r=>d({...a,password:r.target.value}),autoComplete:l?"new-password":"off",required:!0}),e.jsx(g,{type:"submit",className:"w-full btn-primary",onClick:r=>{if(h){r.preventDefault(),r.stopPropagation(),n({title:"جارٍ التنفيذ",description:"يرجى الانتظار حتى تكتمل العملية"});return}typeof navigator<"u"&&navigator.onLine===!1&&(r.preventDefault(),r.stopPropagation(),n({title:"لا يوجد اتصال",description:"تحقق من اتصال الإنترنت ثم أعد المحاولة",variant:"destructive"}))},children:h?"جاري المعالجة...":l?"إنشاء الحساب":"تسجيل الدخول"})]}),e.jsxs("div",{className:"text-center mt-6",children:[e.jsx("span",{className:"text-muted-foreground",children:l?"لديك حساب؟":"ليس لديك حساب؟"}),e.jsx(g,{variant:"link",onClick:()=>N(!l),className:"text-primary",children:l?"تسجيل الدخول":"إنشاء حساب"})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx(_,{to:"/",children:e.jsx(g,{variant:"ghost",className:"text-muted-foreground",children:"العودة للصفحة الرئيسية"})})}),e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3 justify-center items-center",children:[e.jsxs("a",{href:x(t==null?void 0:t.androidUrl)||"#",onClick:r=>{t!=null&&t.androidUrl||r.preventDefault()},className:`flex items-center gap-3 px-4 py-2 rounded-lg shadow-elegant transform hover:scale-105 transition-all duration-300 ${t!=null&&t.androidUrl?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,"aria-disabled":!(t!=null&&t.androidUrl),target:"_blank",rel:"noopener noreferrer",children:[e.jsx(X,{className:"h-5 w-5"}),"تحميل للأندرويد",e.jsx(w,{className:"h-4 w-4"})]}),e.jsxs("a",{href:x(t==null?void 0:t.pcUrl)||"#",onClick:r=>{t!=null&&t.pcUrl||r.preventDefault()},className:`flex items-center gap-3 px-4 py-2 rounded-lg shadow-elegant transform hover:scale-105 transition-all duration-300 ${t!=null&&t.pcUrl?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,"aria-disabled":!(t!=null&&t.pcUrl),target:"_blank",rel:"noopener noreferrer",children:[e.jsx(j,{className:"h-5 w-5"}),"تحميل تطبيق الكمبيوتر نسخة 64 بت",e.jsx(w,{className:"h-4 w-4"})]}),e.jsxs("a",{href:x(t==null?void 0:t.pc32Url)||"#",onClick:r=>{t!=null&&t.pc32Url||r.preventDefault()},className:`flex items-center gap-3 px-4 py-2 rounded-lg shadow-elegant transform hover:scale-105 transition-all duration-300 ${t!=null&&t.pc32Url?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,"aria-disabled":!(t!=null&&t.pc32Url),target:"_blank",rel:"noopener noreferrer",children:[e.jsx(j,{className:"h-5 w-5"}),"تحميل تطبيق الكمبيوتر نسخة 32 بت",e.jsx(w,{className:"h-4 w-4"})]})]})]})]})})}export{G as default};
//# sourceMappingURL=AuthPage-Bk33vzoa-CBBiDUS7.js.map
