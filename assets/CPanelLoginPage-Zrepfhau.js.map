{"version":3,"file":"CPanelLoginPage-Zrepfhau.js","sources":["../../src/pages/CPanelLoginPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useFirebaseAuth } from \"@/contexts/FirebaseAuthContext\";\nimport { toast } from \"sonner\";\nimport { ArrowRight, Eye, EyeOff, Lock, Mail, Shield } from \"lucide-react\";\nimport { auth, db } from \"@/firebase\";\nimport { doc, setDoc, serverTimestamp } from \"firebase/firestore\";\n\nconst CPanelLoginPage = () => {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const { signIn } = useFirebaseAuth();\n  const navigate = useNavigate();\n\n  // استرجاع آخر بريد مستخدم\n  useEffect(() => {\n    try {\n      const last = typeof window !== 'undefined' ? window.localStorage.getItem('cashy:lastEmail') : null;\n      if (last) setEmail(last);\n    } catch {}\n  }, []);\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    // حارس التنفيذ المتكرر\n    if (isLoading) {\n      toast.info(\"جارٍ تنفيذ تسجيل الدخول، يرجى الانتظار...\");\n      return;\n    }\n    // فحص الاتصال\n    if (typeof navigator !== 'undefined' && navigator.onLine === false) {\n      toast.error(\"لا يوجد اتصال بالإنترنت. يرجى التأكد من الشبكة ثم المحاولة.\");\n      return;\n    }\n    if (!email || !password) {\n      toast.error(\"يرجى إدخال البريد الإلكتروني وكلمة المرور\");\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const { error } = await signIn(email, password);\n      if (error) {\n        const code = (error as any)?.code;\n        if (code === 'auth/invalid-email') {\n          toast.error('صيغة البريد الإلكتروني غير صحيحة');\n        } else if (code === 'auth/user-not-found') {\n          toast.error('لا يوجد حساب بهذا البريد الإلكتروني');\n        } else if (code === 'auth/wrong-password') {\n          toast.error('كلمة المرور غير صحيحة');\n        } else if (code === 'auth/invalid-credential') {\n          toast.error('البريد الإلكتروني أو كلمة المرور غير صحيحة');\n        } else if (code === 'auth/too-many-requests') {\n          toast.error('تم تجاوز عدد المحاولات المسموح، حاول لاحقاً');\n        } else {\n          toast.error((error as any)?.message || 'حدث خطأ أثناء تسجيل الدخول');\n        }\n        return;\n      }\n\n      try {\n        // عند تسجيل الدخول من صفحة cpanel/login نعلّم الحساب كحساب باقات الفروع (في انتظار التفعيل)\n        const uid = auth.currentUser?.uid;\n        if (uid) {\n          await setDoc(doc(db, 'users', uid), {\n            branchPackage: {\n              requested: true,\n              status: 'pending',\n              requestedAt: serverTimestamp()\n            },\n            updatedAt: serverTimestamp()\n          }, { merge: true });\n        }\n      } catch (e) {\n        // فشل تحديث العلم ليس عائقًا لتسجيل الدخول\n        console.warn('تعذر وسم المستخدم كباقة فروع:', e);\n      }\n      toast.success(\"تم تسجيل الدخول بنجاح\");\n      navigate(\"/cpanel\");\n    } catch (err: any) {\n      toast.error(err?.message || \"فشل تسجيل الدخول، حاول مرة أخرى\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background px-4 py-8 flex items-center justify-center\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader>\n          <div className=\"flex items-center gap-2\">\n            <Shield className=\"w-6 h-6\" />\n            <CardTitle>تسجيل دخول لوحة التحكم</CardTitle>\n          </div>\n          <CardDescription>ادخل باستخدام بريدك الإلكتروني وكلمة المرور</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleLogin} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">البريد الإلكتروني</Label>\n              <div className=\"relative\">\n                <Mail className=\"absolute right-3 top-2.5 w-5 h-5 text-muted-foreground\" />\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => {\n                    const v = e.target.value;\n                    setEmail(v);\n                    try { window.localStorage.setItem('cashy:lastEmail', v); } catch {}\n                  }}\n                  placeholder=\"example@mail.com\"\n                  className=\"pr-10\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">كلمة المرور</Label>\n              <div className=\"relative\">\n                <Lock className=\"absolute right-3 top-2.5 w-5 h-5 text-muted-foreground\" />\n                <Input\n                  id=\"password\"\n                  type={showPassword ? \"text\" : \"password\"}\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  placeholder=\"••••••••\"\n                  className=\"pr-10\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPassword((v) => !v)}\n                  className=\"absolute left-3 top-2.5 text-muted-foreground\"\n                  aria-label={showPassword ? \"إخفاء كلمة المرور\" : \"إظهار كلمة المرور\"}\n                >\n                  {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\n                </button>\n              </div>\n            </div>\n\n            <button\n              type=\"submit\"\n              onClick={(e) => {\n                if (isLoading) {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  toast.info(\"جارٍ تنفيذ تسجيل الدخول، يرجى الانتظار...\");\n                } else if (typeof navigator !== 'undefined' && navigator.onLine === false) {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  toast.error(\"لا يوجد اتصال بالإنترنت. يرجى التأكد من الشبكة ثم المحاولة.\");\n                } else {\n                  if (!email) toast.error(\"يرجى إدخال البريد الإلكتروني\");\n                  if (!password) toast.error(\"يرجى إدخال كلمة المرور\");\n                }\n              }}\n              className=\"w-full inline-flex items-center justify-center gap-2 rounded-md bg-primary px-4 py-2 text-white hover:opacity-90\"\n            >\n              {isLoading ? (\n                <div className=\"flex items-center\">\n                  <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white ml-2\"></div>\n                  جاري تسجيل الدخول...\n                </div>\n              ) : (\n                <div className=\"flex items-center justify-center\">\n                  <ArrowRight className=\"w-5 h-5 ml-2\" />\n                  تسجيل الدخول\n                </div>\n              )}\n            </button>\n\n            <div className=\"mt-4 text-center space-y-3\">\n              <p className=\"text-sm text-muted-foreground\">\n                نسيت كلمة المرور؟\n              </p>\n              <div className=\"flex items-center justify-center gap-2\">\n                <Link to=\"/user/forgot-password\" className=\"text-primary text-sm\">\n                  إعادة تعيين كلمة المرور\n                </Link>\n                <span className=\"text-muted-foreground\">•</span>\n                <Link to=\"/auth?mode=signup\" className=\"text-primary text-sm\">\n                  إنشاء حساب جديد\n                </Link>\n              </div>\n            </div>\n\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n\nexport default CPanelLoginPage;\n"],"names":["CPanelLoginPage","email","setEmail","useState","password","setPassword","showPassword","setShowPassword","isLoading","setIsLoading","signIn","useFirebaseAuth","navigate","useNavigate","useEffect","last","handleLogin","e","toast","error","code","uid","_a","auth","setDoc","doc","db","serverTimestamp","err","jsxs","Card","CardHeader","jsx","Shield","CardTitle","CardDescription","CardContent","Label","Mail","Input","v","Lock","EyeOff","Eye","ArrowRight","Link"],"mappings":"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"}