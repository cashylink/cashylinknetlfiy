import{W as I,C as F,S as a,v as U,G as z,L,a6 as O,I as s,a as v,a7 as u,a8 as D,a9 as G}from"./index-C_crvORM.js";import{FreeTrialService as m}from"./freeTrialService-BwabY7bi-Do-h6uD3.js";import{c as H}from"./shield-DSoskD-c-Cy9u9Dod.js";function J(){const{user:r,signOut:y,userSubscription:P,isSubscriptionActive:b,checkSubscriptionStatus:g}=I(),i=F(),[f,p]=a.useState(!1),[R,V]=a.useState(!1),[A,j]=a.useState(!1),[w,N]=a.useState(!1),[o,k]=a.useState(4),T=[{title:"Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©",price:150,features:["Ø¯Ø¹Ù… Ù…Ø¬Ø§Ù†ÙŠ ÙƒØ§Ù…Ù„","ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ø³ØªÙ…Ø±Ø©","Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚","20 Ù…Ø­ÙØ¸Ø©"],bg:"from-blue-50 to-indigo-50"},{title:"Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ©",price:350,features:["Ø¯Ø¹Ù… Ù…Ù…ÙŠØ²","Ø­ØªÙ‰ 30 Ù…Ø­ÙØ¸Ø©","Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚","Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ù„Ù‰ ØªÙ„Ø¬Ø±Ø§Ù…"],bg:"from-emerald-50 to-green-50"},{title:"Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©",price:1e3,features:["Ø¯Ø¹Ù… Ù…Ù…ØªØ§Ø²","Ø¹Ø¯Ø¯ Ù…Ø­Ø§ÙØ¸ Ù…ÙØªÙˆØ­","Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚","Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ù„Ù‰ ØªÙ„Ø¬Ø±Ø§Ù…"],bg:"from-purple-50 to-pink-50"},{title:"Ø¨Ø§Ù‚Ø© Ù…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©",price:3e3,features:["Ø¯Ø¹Ù… Ù…Ù…ØªØ§Ø²","Ø¹Ø¯Ø¯ Ù…Ø­Ø§ÙØ¸ Ù…ÙØªÙˆØ­","Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚","Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ù„Ù‰ ØªÙ„Ø¬Ø±Ø§Ù…"],bg:"from-orange-50 to-amber-50"}];a.useEffect(()=>{if(!(r!=null&&r.uid))return;console.log("ðŸ” PendingApprovalPage: Setting up real-time subscription monitoring for user:",r.uid);const e=U(z,"users",r.uid),n=L(e,l=>{var c,h;if(l.exists()){const t=l.data();if(console.log("ðŸ“Š PendingApprovalPage: User data updated:",{userId:r.uid,isApproved:t.isApproved,approved:t.approved,freeTrialActive:t.freeTrialActive,subscription:t.subscription,subscriptionActive:(c=t.subscription)==null?void 0:c.isActive}),(t==null?void 0:t.isOnFreeTrial)===!0||(t==null?void 0:t.freeTrialActive)===!0){console.log("âœ… PendingApprovalPage: Free trial active, redirecting..."),setTimeout(()=>{i("/user/dashboard",{replace:!0})},800);return}if(((h=t==null?void 0:t.branchPackage)==null?void 0:h.status)==="active"){console.log("âœ… PendingApprovalPage: Branch package active, redirecting..."),setTimeout(()=>{i("/user/dashboard",{replace:!0})},800);return}const d=t.subscription;if(d&&d.isActive===!0){const x=O(d);if(console.log("ðŸ” PendingApprovalPage: Subscription validation result:",{hasSubscription:!!d,isActive:d.isActive,isValid:x,planType:d.planType}),x){console.log("âœ… PendingApprovalPage: Valid subscription found, redirecting to dashboard..."),setTimeout(()=>{i("/user/dashboard",{replace:!0})},800);return}}}},l=>{console.error("âŒ PendingApprovalPage: Error in real-time listener:",l)});return()=>{console.log("ðŸ”Œ PendingApprovalPage: Cleaning up real-time listener"),n()}},[r==null?void 0:r.uid,i]),a.useEffect(()=>{const e=n=>{const{userId:l,planType:c}=n.detail;console.log("ðŸŽ‰ PendingApprovalPage: Subscription activation event received:",{userId:l,planType:c,currentUserId:r==null?void 0:r.uid}),l===(r==null?void 0:r.uid)&&(console.log("âœ… PendingApprovalPage: Subscription activated for current user"),u.success("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§ÙƒÙƒ! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…..."),setTimeout(async()=>{await g(),i("/user/dashboard",{replace:!0})},1500))};return console.log("ðŸ”” PendingApprovalPage: Setting up subscription activation listener"),window.addEventListener("subscriptionActivated",e),()=>{console.log("ðŸ”Œ PendingApprovalPage: Cleaning up subscription activation listener"),window.removeEventListener("subscriptionActivated",e)}},[r==null?void 0:r.uid,i,g]),a.useEffect(()=>{console.log("ðŸ” PendingApprovalPage: Checking subscription status on load:",{isSubscriptionActive:b,hasUserSubscription:!!P}),b&&(console.log("âœ… PendingApprovalPage: Active subscription detected, redirecting..."),i("/user/dashboard",{replace:!0}))},[b,i]),a.useEffect(()=>{if(!(r!=null&&r.uid))return;const e=setInterval(async()=>{console.log("ðŸ”„ PendingApprovalPage: Periodic subscription status check"),await g()},3e4);return()=>{clearInterval(e)}},[r==null?void 0:r.uid,g]),a.useEffect(()=>{(async()=>{if(r!=null&&r.uid)try{const e=await m.getTrialData(r.uid);j(e.hasUsedFreeTrial),N(e.isOnFreeTrial)}catch(e){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©:",e)}})()},[r==null?void 0:r.uid]),a.useEffect(()=>{(async()=>{try{const e=await m.getTrialDurationHours();k(e)}catch(e){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¯Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©:",e)}})()},[]);const S=async()=>{await y(),i("/auth")},E=async()=>{if(r!=null&&r.uid){p(!0);try{await D(r.uid,G.ZERO,r.uid),u.success("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¨Ø§Ù‚Ø© Ø§Ù„Ø²ÙŠØ±Ùˆ! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡..."),setTimeout(()=>{try{i("/user/dashboard",{replace:!0})}catch{}},1200)}catch(e){console.error("Error activating zero plan:",e),u.error("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙØ¹ÙŠÙ„ Ø¨Ø§Ù‚Ø© Ø§Ù„Ø²ÙŠØ±Ùˆ")}finally{p(!1)}}},$=async()=>{if(r!=null&&r.uid){p(!0);try{const e=await m.startFreeTrial(r.uid);e.success?(u.success(e.message||`ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© Ù„Ù…Ø¯Ø© ${o} ${o>=3&&o<=10?"Ø³Ø§Ø¹Ø§Øª":o===2?"Ø³Ø§Ø¹ØªÙŠÙ†":"Ø³Ø§Ø¹Ø©"}! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡...`),setTimeout(()=>{try{i("/user/dashboard",{replace:!0})}catch{}},1200)):u.error(e.message)}catch(e){console.error("Error activating trial:",e),u.error("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©")}finally{p(!1)}}},C=(e,n,l)=>{try{const c=encodeURIComponent(`Ø£Ø±ØºØ¨ ÙÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ ${e} Ø¨Ø³Ø¹Ø± ${n} Ø¬
Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:
- ${l.join(`
- `)}`);window.open(`https://wa.me/201000392539?text=${c}`,"_blank")}catch{}};return s.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:s.jsxs("div",{className:"w-full max-w-5xl bg-white rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 p-4 sm:p-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"flex justify-center mb-2",children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:"linear-gradient(135deg, #f59e0b, #d97706)",filter:"blur(8px)",opacity:.3}}),s.jsx("div",{className:"relative bg-gradient-to-br from-orange-400 to-orange-600 p-2 rounded-full",children:s.jsx(H,{className:"h-10 w-10 text-white"})})]})}),s.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Ù…Ø·Ù„ÙˆØ¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨"}),s.jsx("p",{className:"text-gray-700 text-sm mt-1",children:"Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© ÙˆØ§Ø¶ØºØ· Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„ÙÙˆØ±ÙŠ."})]}),s.jsx("div",{className:"pt-4",children:s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-2 items-stretch",children:T.map(e=>s.jsxs("div",{className:`h-full rounded-lg p-2 border shadow-sm bg-gradient-to-br ${e.bg} dark:from-gray-800 dark:to-gray-700 dark:border-gray-700`,children:[s.jsx("div",{className:"font-bold text-sm text-gray-800 dark:text-gray-100 mb-1",children:e.title}),s.jsxs("div",{className:"text-lg font-extrabold text-gray-900 dark:text-gray-100 mb-2",children:[e.price," Ø¬"]}),s.jsx("ul",{className:"text-[11px] text-gray-700 dark:text-gray-200 text-right space-y-1 mb-2",children:e.features.map(n=>s.jsxs("li",{children:["â€¢ ",n]},n))}),s.jsx(v,{size:"sm",className:"w-full bg-green-600 hover:bg-green-700 text-xs py-1 h-8",onClick:()=>C(e.title,e.price,e.features),children:"ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨"})]},e.title))})}),s.jsxs("div",{className:"pt-3",children:[s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-2",children:[s.jsx(v,{size:"sm",className:"w-full bg-emerald-600 hover:bg-emerald-700",onClick:E,disabled:f,children:"Ø¬Ø±Ø¨ Ø¨Ø§Ù‚Ø© Ø§Ù„Ø²ÙŠØ±Ùˆ"}),!A&&!w&&s.jsx(v,{size:"sm",className:"w-full bg-blue-600 hover:bg-blue-700",onClick:$,disabled:f,children:`Ø¬Ø±Ø¨ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ${o} ${o>=3&&o<=10?"Ø³Ø§Ø¹Ø§Øª":o===2?"Ø³Ø§Ø¹ØªÙŠÙ†":"Ø³Ø§Ø¹Ø©"}`})]}),s.jsx(v,{variant:"outline",className:"border-2 border-gray-300 hover:border-gray-400 text-gray-700 hover:text-gray-800 px-5 py-2 rounded-lg font-semibold text-xs transition-all duration-300",onClick:S,children:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"})]})]})})}export{J as default};
//# sourceMappingURL=PendingApprovalPage-Cwm_Vl7i-BRxxKWZd.js.map
