{"version":3,"file":"TopUpPage-D1sGJ46Q-Dyn2XGKk.js","sources":["../../assets/TopUpPage-D1sGJ46Q.js"],"sourcesContent":["import{a as A,c as P,r as i,j as e,I as C,B as d,f as N}from\"./index-tnWDkOuX.js\";import{C as I,a as B,b as L,d as U}from\"./card-SlwaggFS.js\";import{S as z,a as D,b as G,c as J,d as W}from\"./select-QKdc2TYn.js\";const q=[{label:\"Vodafone\",value:\"Vodafone\"},{label:\"Orange\",value:\"Orange\"},{label:\"Etisalat\",value:\"Etisalat\"},{label:\"WE\",value:\"WE\"}],y=u=>{const a=u.replace(/\\D/g,\"\");return a.length===10||a.length===11},$=()=>{const u=A(),{toast:a}=P(),[l,S]=i.useState(\"\"),[w,F]=i.useState(\"EG\"),[h,T]=i.useState(\"Vodafone\"),[o,E]=i.useState(\"\"),[c,x]=i.useState(!1),[k,m]=i.useState(!1),X=async t=>{if(t.preventDefault(),!y(l)){a({title:\"رقم غير صالح\",description:\"من فضلك أدخل رقم مصري صحيح (10 أو 11 رقم)\",variant:\"destructive\"});return}const n=Number(o);if(!Number.isFinite(n)||n<=0){a({title:\"قيمة غير صالحة\",description:\"من فضلك أدخل مبلغ صحيح بالجنيه المصري\",variant:\"destructive\"});return}m(!0)},O=async()=>{var p,g,b;m(!1);const t=\"alkaptin678678@gmail.com\",n=(g=(p=N.currentUser)==null?void 0:p.email)==null?void 0:g.toLowerCase();if(!n||n!==t){a({title:\"قيد الإنشاء\",description:\"ميزة الشحن متاحة لهذا الحساب فقط حالياً.\"});return}x(!0);try{const r=new AbortController,V=setTimeout(()=>r.abort(),15e3),f=await((b=N.currentUser)==null?void 0:b.getIdToken()),j=await fetch(\"/api/topup\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",...f?{Authorization:`Bearer ${f}`}:{}},body:JSON.stringify({phone:l,countryCode:w,operator:h,amount:Number(o),useLocalAmount:!0}),signal:r.signal});clearTimeout(V);const v=await j.text();let s;try{s=JSON.parse(v)}catch{s={success:!1,message:v||\"فشل قراءة استجابة الخادم\"}}j.ok&&(s!=null&&s.success)?a({title:\"تم الشحن\",description:(s==null?void 0:s.message)||\"تم تنفيذ عملية الشحن بنجاح\"}):a({title:\"فشل الشحن\",description:(s==null?void 0:s.message)||\"حدث خطأ أثناء طلب الشحن\",variant:\"destructive\"})}catch(r){console.error(\"Topup request error:\",r),(r==null?void 0:r.name)===\"AbortError\"?a({title:\"انتهت المهلة\",description:\"الخادم لم يستجب في الوقت المحدد. تأكد أن السيرفر يعمل.\",variant:\"destructive\"}):a({title:\"خطأ في الاتصال\",description:\"تعذر الاتصال بالخادم. حاول لاحقاً.\",variant:\"destructive\"})}finally{x(!1)}};return e.jsxs(\"div\",{className:\"min-h-screen p-4\",children:[e.jsxs(I,{className:\"max-w-md mx-auto\",children:[e.jsx(B,{children:e.jsx(L,{className:\"text-right\",children:\"شحن رصيد الموبايل\"})}),e.jsx(U,{children:e.jsxs(\"form\",{onSubmit:X,className:\"space-y-4\",children:[e.jsxs(\"div\",{children:[e.jsx(\"label\",{className:\"block text-right mb-1\",children:\"رقم الموبايل\"}),e.jsx(C,{value:l,onChange:t=>S(t.target.value),placeholder:\"01XXXXXXXXX\",dir:\"ltr\"}),!y(l)&&l.length>0&&e.jsx(\"p\",{className:\"text-xs text-red-600 mt-1 text-right\",children:\"رقم غير صالح (10 أو 11 رقم)\"})]}),e.jsxs(\"div\",{children:[e.jsx(\"label\",{className:\"block text-right mb-1\",children:\"الشركة\"}),e.jsxs(z,{value:h,onValueChange:T,children:[e.jsx(D,{className:\"w-full\",children:e.jsx(G,{placeholder:\"اختر الشركة\"})}),e.jsx(J,{children:q.map(t=>e.jsx(W,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs(\"div\",{children:[e.jsx(\"label\",{className:\"block text-right mb-1\",children:\"المبلغ بالجنيه (EGP)\"}),e.jsx(C,{type:\"number\",inputMode:\"decimal\",value:o,onChange:t=>E(t.target.value),placeholder:\"مثال: 10\",dir:\"ltr\"})]}),e.jsxs(\"div\",{className:\"flex items-center justify-between\",children:[e.jsx(d,{type:\"button\",variant:\"outline\",onClick:()=>u(-1),children:\"رجوع\"}),e.jsx(d,{type:\"submit\",disabled:c,children:c?\"جارٍ التنفيذ...\":\"شحن\"})]})]})})]}),k&&e.jsx(\"div\",{className:\"fixed inset-0 bg-black/40 flex items-center justify-center z-50\",children:e.jsxs(\"div\",{className:\"bg-white rounded-lg p-4 w-[90%] max-w-md\",children:[e.jsx(\"h2\",{className:\"text-lg font-semibold text-right mb-2\",children:\"تأكيد العملية\"}),e.jsxs(\"p\",{className:\"text-right mb-4\",children:[\"هتشحن رقم \",l,\" مبلغ \",o,\" جنيه — تأكيد؟\"]}),e.jsxs(\"div\",{className:\"flex gap-2 justify-end\",children:[e.jsx(d,{variant:\"outline\",onClick:()=>m(!1),children:\"إلغاء\"}),e.jsx(d,{onClick:O,disabled:c,children:c?\"جارٍ التنفيذ...\":\"تأكيد\"})]})]})})]})};export{$ as default};\r\n//# sourceMappingURL=TopUpPage-D1sGJ46Q.js.map\r\n"],"names":["q","a","$","A","P","l","S","i","w","F","T","o","E","c","k","X","O","p","g","b","t","n","N","V","f","v","s","e","I","B","L","U","C","z","D","G","J","W","d"],"mappings":"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"}