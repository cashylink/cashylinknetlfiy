{"version":3,"file":"CPanelLoginPage-B1bg6uq4.js","sources":["../../src/pages/CPanelLoginPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { useFirebaseAuth } from \"@/contexts/FirebaseAuthContext\";\r\nimport { toast } from \"sonner\";\r\nimport { ArrowRight, Eye, EyeOff, Lock, Mail, Shield } from \"lucide-react\";\r\nimport { auth, db } from \"@/firebase\";\r\nimport { doc, setDoc, serverTimestamp } from \"firebase/firestore\";\r\n\r\nconst CPanelLoginPage = () => {\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { signIn } = useFirebaseAuth();\r\n  const navigate = useNavigate();\r\n\r\n  // استرجاع آخر بريد مستخدم\r\n  useEffect(() => {\r\n    try {\r\n      const last = typeof window !== 'undefined' ? window.localStorage.getItem('cashy:lastEmail') : null;\r\n      if (last) setEmail(last);\r\n    } catch {}\r\n  }, []);\r\n\r\n  const handleLogin = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    // حارس التنفيذ المتكرر\r\n    if (isLoading) {\r\n      toast.info(\"جارٍ تنفيذ تسجيل الدخول، يرجى الانتظار...\");\r\n      return;\r\n    }\r\n    // فحص الاتصال\r\n    if (typeof navigator !== 'undefined' && navigator.onLine === false) {\r\n      toast.error(\"لا يوجد اتصال بالإنترنت. يرجى التأكد من الشبكة ثم المحاولة.\");\r\n      return;\r\n    }\r\n    if (!email || !password) {\r\n      toast.error(\"يرجى إدخال البريد الإلكتروني وكلمة المرور\");\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      const { error } = await signIn(email, password);\r\n      if (error) {\r\n        const code = (error as any)?.code;\r\n        if (code === 'auth/invalid-email') {\r\n          toast.error('صيغة البريد الإلكتروني غير صحيحة');\r\n        } else if (code === 'auth/user-not-found') {\r\n          toast.error('لا يوجد حساب بهذا البريد الإلكتروني');\r\n        } else if (code === 'auth/wrong-password') {\r\n          toast.error('كلمة المرور غير صحيحة');\r\n        } else if (code === 'auth/invalid-credential') {\r\n          toast.error('البريد الإلكتروني أو كلمة المرور غير صحيحة');\r\n        } else if (code === 'auth/too-many-requests') {\r\n          toast.error('تم تجاوز عدد المحاولات المسموح، حاول لاحقاً');\r\n        } else {\r\n          toast.error((error as any)?.message || 'حدث خطأ أثناء تسجيل الدخول');\r\n        }\r\n        return;\r\n      }\r\n\r\n      try {\r\n        // عند تسجيل الدخول من صفحة cpanel/login نعلّم الحساب كحساب باقات الفروع (في انتظار التفعيل)\r\n        const uid = auth.currentUser?.uid;\r\n        if (uid) {\r\n          await setDoc(doc(db, 'users', uid), {\r\n            branchPackage: {\r\n              requested: true,\r\n              status: 'pending',\r\n              requestedAt: serverTimestamp()\r\n            },\r\n            updatedAt: serverTimestamp()\r\n          }, { merge: true });\r\n        }\r\n      } catch (e) {\r\n        // فشل تحديث العلم ليس عائقًا لتسجيل الدخول\r\n        console.warn('تعذر وسم المستخدم كباقة فروع:', e);\r\n      }\r\n      toast.success(\"تم تسجيل الدخول بنجاح\");\r\n      navigate(\"/cpanel\");\r\n    } catch (err: any) {\r\n      toast.error(err?.message || \"فشل تسجيل الدخول، حاول مرة أخرى\");\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background px-4 py-8 flex items-center justify-center\">\r\n      <Card className=\"w-full max-w-md\">\r\n        <CardHeader>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Shield className=\"w-6 h-6\" />\r\n            <CardTitle>تسجيل دخول لوحة التحكم</CardTitle>\r\n          </div>\r\n          <CardDescription>ادخل باستخدام بريدك الإلكتروني وكلمة المرور</CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <form onSubmit={handleLogin} className=\"space-y-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"email\">البريد الإلكتروني</Label>\r\n              <div className=\"relative\">\r\n                <Mail className=\"absolute right-3 top-2.5 w-5 h-5 text-muted-foreground\" />\r\n                <Input\r\n                  id=\"email\"\r\n                  type=\"email\"\r\n                  value={email}\r\n                  onChange={(e) => {\r\n                    const v = e.target.value;\r\n                    setEmail(v);\r\n                    try { window.localStorage.setItem('cashy:lastEmail', v); } catch {}\r\n                  }}\r\n                  placeholder=\"example@mail.com\"\r\n                  className=\"pr-10\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"password\">كلمة المرور</Label>\r\n              <div className=\"relative\">\r\n                <Lock className=\"absolute right-3 top-2.5 w-5 h-5 text-muted-foreground\" />\r\n                <Input\r\n                  id=\"password\"\r\n                  type={showPassword ? \"text\" : \"password\"}\r\n                  value={password}\r\n                  onChange={(e) => setPassword(e.target.value)}\r\n                  placeholder=\"••••••••\"\r\n                  className=\"pr-10\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowPassword((v) => !v)}\r\n                  className=\"absolute left-3 top-2.5 text-muted-foreground\"\r\n                  aria-label={showPassword ? \"إخفاء كلمة المرور\" : \"إظهار كلمة المرور\"}\r\n                >\r\n                  {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <button\r\n              type=\"submit\"\r\n              onClick={(e) => {\r\n                if (isLoading) {\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  toast.info(\"جارٍ تنفيذ تسجيل الدخول، يرجى الانتظار...\");\r\n                } else if (typeof navigator !== 'undefined' && navigator.onLine === false) {\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  toast.error(\"لا يوجد اتصال بالإنترنت. يرجى التأكد من الشبكة ثم المحاولة.\");\r\n                } else {\r\n                  if (!email) toast.error(\"يرجى إدخال البريد الإلكتروني\");\r\n                  if (!password) toast.error(\"يرجى إدخال كلمة المرور\");\r\n                }\r\n              }}\r\n              className=\"w-full inline-flex items-center justify-center gap-2 rounded-md bg-primary px-4 py-2 text-white hover:opacity-90\"\r\n            >\r\n              {isLoading ? (\r\n                <div className=\"flex items-center\">\r\n                  <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white ml-2\"></div>\r\n                  جاري تسجيل الدخول...\r\n                </div>\r\n              ) : (\r\n                <div className=\"flex items-center justify-center\">\r\n                  <ArrowRight className=\"w-5 h-5 ml-2\" />\r\n                  تسجيل الدخول\r\n                </div>\r\n              )}\r\n            </button>\r\n\r\n            <div className=\"mt-4 text-center space-y-3\">\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                نسيت كلمة المرور؟\r\n              </p>\r\n              <div className=\"flex items-center justify-center gap-2\">\r\n                <Link to=\"/user/forgot-password\" className=\"text-primary text-sm\">\r\n                  إعادة تعيين كلمة المرور\r\n                </Link>\r\n                <span className=\"text-muted-foreground\">•</span>\r\n                <Link to=\"/auth?mode=signup\" className=\"text-primary text-sm\">\r\n                  إنشاء حساب جديد\r\n                </Link>\r\n              </div>\r\n            </div>\r\n\r\n          </form>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CPanelLoginPage;\r\n"],"names":["CPanelLoginPage","email","setEmail","useState","password","setPassword","showPassword","setShowPassword","isLoading","setIsLoading","signIn","useFirebaseAuth","navigate","useNavigate","useEffect","last","handleLogin","e","toast","error","code","uid","_a","auth","setDoc","doc","db","serverTimestamp","err","jsxs","Card","CardHeader","jsx","Shield","CardTitle","CardDescription","CardContent","Label","Mail","Input","v","Lock","EyeOff","Eye","ArrowRight","Link"],"mappings":"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"}