import{r as n,u as N,a as b,j as e,S as C,M as L,I as f,t as S,E,v as P,A as k,C as a,L as h,f as I,F as A,G as D,i as F,s as x}from"./index-DA5EGBVC.js";import{L as p}from"./label-DGcgSfhx.js";import{C as q,a as M,b as R,c as T,d as G}from"./card-BDAHS7kE.js";const z=()=>{const[l,m]=n.useState(""),[o,g]=n.useState(""),[c,j]=n.useState(!1),[d,u]=n.useState(!1),{signIn:w}=N(),v=b();n.useEffect(()=>{try{const s=typeof window<"u"?window.localStorage.getItem("cashy:lastEmail"):null;s&&m(s)}catch{}},[]);const y=async s=>{var i;if(s.preventDefault(),d){a.info("جارٍ تنفيذ تسجيل الدخول، يرجى الانتظار...");return}if(typeof navigator<"u"&&navigator.onLine===!1){a.error("لا يوجد اتصال بالإنترنت. يرجى التأكد من الشبكة ثم المحاولة.");return}if(!l||!o){a.error("يرجى إدخال البريد الإلكتروني وكلمة المرور");return}u(!0);try{const{error:t}=await w(l,o);if(t){const r=t==null?void 0:t.code;r==="auth/invalid-email"?a.error("صيغة البريد الإلكتروني غير صحيحة"):r==="auth/user-not-found"?a.error("لا يوجد حساب بهذا البريد الإلكتروني"):r==="auth/wrong-password"?a.error("كلمة المرور غير صحيحة"):r==="auth/invalid-credential"?a.error("البريد الإلكتروني أو كلمة المرور غير صحيحة"):r==="auth/too-many-requests"?a.error("تم تجاوز عدد المحاولات المسموح، حاول لاحقاً"):a.error((t==null?void 0:t.message)||"حدث خطأ أثناء تسجيل الدخول");return}try{const r=(i=I.currentUser)==null?void 0:i.uid;r&&await A(D(F,"users",r),{branchPackage:{requested:!0,status:"pending",requestedAt:x()},updatedAt:x()},{merge:!0})}catch(r){console.warn("تعذر وسم المستخدم كباقة فروع:",r)}a.success("تم تسجيل الدخول بنجاح"),v("/cpanel")}catch(t){a.error((t==null?void 0:t.message)||"فشل تسجيل الدخول، حاول مرة أخرى")}finally{u(!1)}};return e.jsx("div",{className:"min-h-screen bg-background px-4 py-8 flex items-center justify-center",children:e.jsxs(q,{className:"w-full max-w-md",children:[e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-6 h-6"}),e.jsx(R,{children:"تسجيل دخول لوحة التحكم"})]}),e.jsx(T,{children:"ادخل باستخدام بريدك الإلكتروني وكلمة المرور"})]}),e.jsx(G,{children:e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"email",children:"البريد الإلكتروني"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute right-3 top-2.5 w-5 h-5 text-muted-foreground"}),e.jsx(f,{id:"email",type:"email",value:l,onChange:s=>{const i=s.target.value;m(i);try{window.localStorage.setItem("cashy:lastEmail",i)}catch{}},placeholder:"example@mail.com",className:"pr-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"password",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute right-3 top-2.5 w-5 h-5 text-muted-foreground"}),e.jsx(f,{id:"password",type:c?"text":"password",value:o,onChange:s=>g(s.target.value),placeholder:"••••••••",className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>j(s=>!s),className:"absolute left-3 top-2.5 text-muted-foreground","aria-label":c?"إخفاء كلمة المرور":"إظهار كلمة المرور",children:c?e.jsx(E,{className:"w-5 h-5"}):e.jsx(P,{className:"w-5 h-5"})})]})]}),e.jsx("button",{type:"submit",onClick:s=>{d?(s.preventDefault(),s.stopPropagation(),a.info("جارٍ تنفيذ تسجيل الدخول، يرجى الانتظار...")):typeof navigator<"u"&&navigator.onLine===!1?(s.preventDefault(),s.stopPropagation(),a.error("لا يوجد اتصال بالإنترنت. يرجى التأكد من الشبكة ثم المحاولة.")):(l||a.error("يرجى إدخال البريد الإلكتروني"),o||a.error("يرجى إدخال كلمة المرور"))},className:"w-full inline-flex items-center justify-center gap-2 rounded-md bg-primary px-4 py-2 text-white hover:opacity-90",children:d?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white ml-2"}),"جاري تسجيل الدخول..."]}):e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(k,{className:"w-5 h-5 ml-2"}),"تسجيل الدخول"]})}),e.jsxs("div",{className:"mt-4 text-center space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"نسيت كلمة المرور؟"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(h,{to:"/user/forgot-password",className:"text-primary text-sm",children:"إعادة تعيين كلمة المرور"}),e.jsx("span",{className:"text-muted-foreground",children:"•"}),e.jsx(h,{to:"/auth?mode=signup",className:"text-primary text-sm",children:"إنشاء حساب جديد"})]})]})]})})]})})};export{z as default};
//# sourceMappingURL=CPanelLoginPage-B1bg6uq4.js.map
