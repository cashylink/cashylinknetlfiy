import{J as ce,a as he,b as ue,c as fe,u as pe,r as i,aq as j,j as e,B as I,ar as xe,I as d,as as ge,S as G,at as ye}from"./index-DKHjTn06.js";import{C as K,a as we,b as ve,d as Q}from"./card-CdZ89wHA.js";import{L as l}from"./label-xK2gNCpt.js";import{S as Ne,a as je,b as be,c as Le,d as We}from"./select-CNUPPz9r.js";import{walletDailyLimitsService as X}from"./walletDailyLimitsService-DdjjL_Zn.js";import{A as Ce}from"./arrow-left-Dg0WTfXV.js";import{W as Te}from"./wallet-CcB5ksMi.js";import{P as Ie}from"./phone-Bfk7DEDM.js";import{C as Se}from"./circle-alert--64_gie4.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=ce("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),Ae=()=>{const S=he(),[W]=ue(),{toast:w}=fe(),{user:s,userSubscription:c}=pe(),[v,k]=i.useState(""),[N,P]=i.useState(""),[F,Y]=i.useState(""),[D,ee]=i.useState(""),[b,E]=i.useState(""),[h,U]=i.useState("200000"),[u,M]=i.useState("200000"),[f,_]=i.useState("100000"),[p,O]=i.useState("60000"),[r,B]=i.useState(""),[n,R]=i.useState(""),[A,te]=i.useState(!1),[q,z]=i.useState(!1),[Z,C]=i.useState([]),[L,ae]=i.useState(!1),[T,se]=i.useState(null),[Pe,ie]=i.useState(""),[le,re]=i.useState(""),ne=[{id:"vodafone",name:"فودافون كاش",color:"bg-red-500"},{id:"etisalat",name:"اتصالات كاش",color:"bg-green-500"},{id:"orange",name:"أورنج كاش",color:"bg-orange-500"},{id:"we_pay",name:"وي باي",color:"bg-purple-500"},{id:"smart_wallet",name:"سمارت ولت",color:"bg-blue-500"},{id:"access_pay",name:"أكسس باي",color:"bg-teal-500"},{id:"insta_pay",name:"انستا باي",color:"bg-pink-500"}],de=()=>`wallets_${(s==null?void 0:s.uid)||"default"}`;i.useEffect(()=>{oe()},[s==null?void 0:s.uid]);const H=t=>{switch(t){case"vodafone":return"vodafone_cash";case"etisalat":return"etisalat_cash";case"orange":return"orange_cash";case"insta_pay":return"instapay";default:return t}},J=t=>{switch(t){case"vodafone_cash":return"vodafone";case"etisalat_cash":return"etisalat";case"orange_cash":return"orange";case"instapay":return"insta_pay";default:return t}};i.useEffect(()=>{const t=W.get("edit")==="1",m=W.get("id");ae(t),se(m),t&&m&&(async()=>{try{const a=await j.getById(m);a&&(k(a.label||""),P(a.msisdn||""),E(J(a.provider||"")),U(String(a.withdrawLimit||2e5)),M(String(a.transferLimit||2e5)),B((a.defaultTransferCommission??"").toString()),R((a.defaultWithdrawCommission??"").toString()),_(String(a.dailyWithdrawLimit??1e5)),O(String(a.dailyTransferLimit??6e4)),ie(a.msisdn||""),re(a.provider||""))}catch(a){console.error("Error loading wallet for edit:",a)}})()},[W]);const oe=async()=>{if(s!=null&&s.uid)try{const t=await j.getByMerchantId(s.uid);if(t&&t.length>0){const m=t.map(a=>({id:a.id,name:a.label||"",phone:a.msisdn||"",isDefault:!1,monthlyWithdrawalLimit:typeof a.withdrawLimit=="number"?a.withdrawLimit:0,monthlyTransferLimit:typeof a.transferLimit=="number"?a.transferLimit:0,monthlyWithdrawalUsage:typeof a.withdrawUsage=="number"?a.withdrawUsage:0,monthlyTransferUsage:typeof a.transferUsage=="number"?a.transferUsage:0,lastResetDate:void 0,walletProvider:J(a.provider||""),defaultTransferCommission:a.defaultTransferCommission??null,defaultWithdrawCommission:a.defaultWithdrawCommission??null,dailyWithdrawalLimit:typeof a.dailyWithdrawLimit=="number"?a.dailyWithdrawLimit:1e5,dailyTransferLimit:typeof a.dailyTransferLimit=="number"?a.dailyTransferLimit:6e4}));C(m)}else C([])}catch(t){console.error("Error loading wallets:",t),C([])}},me=async t=>{var m;if(t.preventDefault(),!v||!N){w({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}if(!L&&(s!=null&&s.uid))try{let a=!1;const x=((m=c==null?void 0:c.subscription)==null?void 0:m.planType)??(c==null?void 0:c.planType)??null,g=typeof x=="string"?x.toLowerCase():null;if(x===G.ZERO||g==="zero"||x===0||g==="0")a=!0;else{const o=await ye(s.uid),y=(o==null?void 0:o.planType)??(o==null?void 0:o.plan)??null,$=typeof y=="string"?y.toLowerCase():null;a=y===G.ZERO||$==="zero"||y===0||$==="0"}if(a&&(await j.getByMerchantId(s.uid)).length>=5){w({title:"تحذير",description:"باقة زيرو تسمح بإضافة 5 محافظ فقط. قم بالترقية.",variant:"destructive"});return}}catch(a){console.warn("Zero plan limit check failed:",a)}z(!0);try{const a=new Date().toISOString().split("T")[0];if(L&&T)await j.update(T,{provider:H(b||le||""),msisdn:N,label:v,transferLimit:parseInt(u),withdrawLimit:parseInt(h),dailyTransferLimit:parseInt(p||"0"),dailyWithdrawLimit:parseInt(f||"0"),defaultTransferCommission:r!=null&&r.trim()!==""?parseFloat(r):null,defaultWithdrawCommission:n!=null&&n.trim()!==""?parseFloat(n):null}),await X.setLimits(T,{dailyTransferLimit:parseInt(p||"0"),dailyWithdrawLimit:parseInt(f||"0"),monthlyTransferLimit:parseInt(u||"0"),monthlyWithdrawLimit:parseInt(h||"0")}),w({title:"تم التحديث",description:"تم تحديث بيانات المحفظة بنجاح"});else{const x={merchantUserId:(s==null?void 0:s.uid)||"",provider:H(b),msisdn:N,label:v,isActive:!0,dailyLimit:5e4,monthlyLimit:3e5,transferLimit:parseInt(u),withdrawLimit:parseInt(h),dailyTransferLimit:parseInt(p||"0"),dailyWithdrawLimit:parseInt(f||"0"),transferUsage:0,withdrawUsage:0,defaultTransferCommission:r!=null&&r.trim()!==""?parseFloat(r):null,defaultWithdrawCommission:n!=null&&n.trim()!==""?parseFloat(n):null};let g;if(s!=null&&s.uid)g=await j.create(x),await X.setLimits(g,{dailyTransferLimit:parseInt(p||"0"),dailyWithdrawLimit:parseInt(f||"0"),monthlyTransferLimit:parseInt(u||"0"),monthlyWithdrawLimit:parseInt(h||"0")});else{console.warn("يجب تسجيل الدخول قبل إنشاء المحفظة");return}const o={id:g,name:v,phone:N,ownerName:F,nationalId:D,isDefault:A||Z.length===0,monthlyWithdrawalLimit:parseInt(h),monthlyTransferLimit:parseInt(u),monthlyWithdrawalUsage:0,monthlyTransferUsage:0,dailyWithdrawalLimit:parseInt(f),dailyTransferLimit:parseInt(p),lastResetDate:a,walletProvider:b,defaultTransferCommission:r!=null&&r.trim()!==""?parseFloat(r):null,defaultWithdrawCommission:n!=null&&n.trim()!==""?parseFloat(n):null},y=[...Z,o];localStorage.setItem(de(),JSON.stringify(y)),w({title:"تم الإنشاء",description:"تم إنشاء المحفظة بنجاح"})}S("/user/dashboard")}catch(a){console.error("Error saving wallet:",a),w({title:"خطأ",description:"حدث خطأ أثناء حفظ المحفظة",variant:"destructive"})}finally{z(!1)}},V=()=>{S("/user/dashboard")};return e.jsx("div",{className:"min-h-screen bg-background p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:V,className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"العودة"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(xe,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:L?"تعديل المحفظة":"إضافة محفظة جديدة"})]})]}),e.jsxs(K,{className:"shadow-lg",children:[e.jsx(we,{children:e.jsxs(ve,{className:"flex items-center gap-2 text-right",children:[e.jsx(Te,{className:"h-5 w-5 text-blue-600"}),"بيانات المحفظة"]})}),e.jsx(Q,{children:e.jsxs("form",{onSubmit:me,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"walletName",className:"text-right block font-medium",children:"اسم المحفظة *"}),e.jsx(d,{id:"walletName",type:"text",placeholder:"مثال: محفظة العمل",value:v,onChange:t=>k(t.target.value),className:"text-right",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"walletPhone",className:"text-right block font-medium",children:"رقم الهاتف *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(d,{id:"walletPhone",type:"tel",placeholder:"01xxxxxxxxx",value:N,onChange:t=>P(t.target.value),className:"text-right pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"walletOwnerName",className:"text-right block font-medium",children:"اسم صاحب المحفظة (اختياري)"}),e.jsx(d,{id:"walletOwnerName",type:"text",placeholder:"اسم صاحب المحفظة",value:F,onChange:t=>Y(t.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"walletNationalId",className:"text-right block font-medium",children:"الرقم القومي (اختياري)"}),e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(d,{id:"walletNationalId",type:"text",placeholder:"الرقم القومي",value:D,onChange:t=>ee(t.target.value),className:"text-right pl-10"})]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-blue-700 bg-blue-50 border border-blue-100 p-3 rounded",children:[e.jsx(Se,{className:"h-4 w-4 mt-0.5"}),e.jsx("p",{className:"text-sm text-right",children:'يمكن ترك "عمولة التحويل" و"عمولة السحب" فارغتين إذا أردت إدخال العمولة يدويًا أثناء تنفيذ العملية، أو كتابتهما هنا لتكونا قيمًا افتراضية تُستخدم تلقائيًا.'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"defaultTransferCommission",className:"text-right block font-medium",children:"عمولة التحويل (افتراضية - اختياري)"}),e.jsx(d,{id:"defaultTransferCommission",type:"number",step:"0.01",min:"0",placeholder:"أدخل عمولة التحويل الافتراضية (مثال: 5)",value:r,onChange:t=>B(t.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"defaultWithdrawCommission",className:"text-right block font-medium",children:"عمولة السحب (افتراضية - اختياري)"}),e.jsx(d,{id:"defaultWithdrawCommission",type:"number",step:"0.01",min:"0",placeholder:"أدخل عمولة السحب الافتراضية (مثال: 5)",value:n,onChange:t=>R(t.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"walletProvider",className:"text-right block font-medium",children:"شركة المحفظة"}),e.jsxs(Ne,{value:b,onValueChange:E,children:[e.jsx(je,{className:"text-right",children:e.jsx(be,{placeholder:"اختر شركة المحفظة"})}),e.jsx(Le,{children:ne.map(t=>e.jsx(We,{value:t.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t.color}`}),t.name]})},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"monthlyWithdrawalLimit",className:"text-right block font-medium",children:"حد السحب الشهري"}),e.jsx(d,{id:"monthlyWithdrawalLimit",type:"number",value:h,onChange:t=>U(t.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"monthlyTransferLimit",className:"text-right block font-medium",children:"حد التحويل الشهري"}),e.jsx(d,{id:"monthlyTransferLimit",type:"number",value:u,onChange:t=>M(t.target.value),className:"text-right"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"dailyWithdrawalLimit",className:"text-right block font-medium",children:"حد السحب اليومي"}),e.jsx(d,{id:"dailyWithdrawalLimit",type:"number",value:f,onChange:t=>_(t.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"dailyTransferLimit",className:"text-right block font-medium",children:"حد التحويل اليومي"}),e.jsx(d,{id:"dailyTransferLimit",type:"number",value:p,onChange:t=>O(t.target.value),className:"text-right"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(l,{htmlFor:"isDefault",className:"font-medium",children:"جعل هذه المحفظة افتراضية"}),e.jsx("input",{id:"isDefault",type:"checkbox",checked:A,onChange:t=>te(t.target.checked),className:"rounded"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(I,{type:"button",variant:"outline",onClick:V,className:"flex-1",children:"إلغاء"}),e.jsx(I,{type:"submit",disabled:q,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:q?"جاري الحفظ...":L?"حفظ التعديلات":"إضافة المحفظة"})]})]})})]}),e.jsx(K,{className:"mt-6 bg-blue-50 border-blue-200",children:e.jsx(Q,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ke,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"معلومات مهمة:"}),e.jsxs("ul",{className:"space-y-1 text-blue-700",children:[e.jsx("li",{children:"• تأكد من صحة رقم الهاتف المدخل"}),e.jsx("li",{children:"• يمكنك تعديل الحدود الشهرية لاحقاً"}),e.jsx("li",{children:"• المحفظة الافتراضية ستكون الخيار الأول في المعاملات"})]})]})]})})})]})})};export{Ae as default};
//# sourceMappingURL=WalletAdditionPage-UT_a_ESN.js.map
