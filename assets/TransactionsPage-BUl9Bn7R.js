const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dailyOperationCountService-Br8p3Ou7.js","./index-DCCNgGPW.js","./index-CS_QnlXg.css","./profitService-Bwg-yNfl.js"])))=>i.map(i=>d[i]);
import{W as Pt,j as t,r as d,u as kt,a2 as Tt,B as A,D as At,aC as De,aD as Ce,aE as Se,aF as Oe,$ as de,aw as W,ax as ze,aK as v,a as cs,R as oe,aL as ds,ah as ms,q as ve,n as be,o as I,az as Q,t as je,a3 as E,aM as le,a1 as ps,ag as Fe,J as V,X as $,C as hs,b as us,c as xs,I as Ue,aN as fs,av as Dt,aO as gs,aP as ys,e as vs,aQ as Ct,aA as St,m as $e,aG as bs,af as H,Y as Ne}from"./index-DCCNgGPW.js";import{S as js,a as Ns,b as ws,c as Ts,d as we}from"./select-DGlsBkiO.js";import{B as As}from"./badge-DfJ_Cd6V.js";import{C as Et,S as Ds,T as Cs,a as Ss,b as Te,c as Ae}from"./tabs-sXmhEuOx.js";import{A as Ot,u as Os,C as Rs,a as Ps,f as B,b as ks,M as Es,c as Ls,R as Is,I as _s}from"./MaintenanceDialog-DgzlfQZR.js";import{M as Ge,P as Ws}from"./MasterPinDialog-BxzQrVxp.js";import{ProfitService as ce}from"./profitService-Bwg-yNfl.js";import{D as Ms}from"./dollar-sign-Cx5pdup0.js";import{A as qe}from"./arrow-down-left-DACJ6E-y.js";import{A as Bs}from"./arrow-left-CaId6H0o.js";import{T as Rt}from"./trash-2-DcC1U_Hc.js";import{C as zs}from"./circle-x-kanmRERm.js";import{C as Fs}from"./circle-check-big-BoX_IbGj.js";import"./index-TUMzqYWw.js";import"./whatsappService-B1cIRXDd.js";import"./download-o2Ens89R.js";import"./progress-D56HxldF.js";import"./circle-alert-Dp4UJch_.js";import"./refresh-cw-BB3NaMkG.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=[["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["path",{d:"M14.856 6H16a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.935",key:"lre1cr"}],["path",{d:"M22 14v-4",key:"14q9d5"}],["path",{d:"M5.14 18H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2.936",key:"13q5k0"}]],$s=Pt("battery-charging",Us);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],qs=Pt("circle-play",Gs),Vs=({userId:D,transactions:a=[]})=>{const[j,f]=d.useState(!1),[X,Y]=d.useState(!1),[te,Ve]=d.useState(!1),[z,P]=d.useState({dailyWithdraw:0,dailyTransfer:0,monthlyWithdraw:0,monthlyTransfer:0,lastUpdated:new Date}),{userSubscription:O}=kt();d.useEffect(()=>{D&&j&&te&&Re()},[D,j,te]);const M=N=>`${N.toFixed(2)} ج.م`,K=async()=>{try{const N=(O==null?void 0:O.subscription)||null,c=(N==null?void 0:N.planType)??(N==null?void 0:N.plan)??null,T=typeof c=="string"?c.toLowerCase():null;if(c===W.ZERO||T==="zero"||T==="0"||c===0)return!0}catch{}try{if(D){const N=await ze(D),c=(N==null?void 0:N.planType)??(N==null?void 0:N.plan)??null,T=typeof c=="string"?c.toLowerCase():null;if(c===W.ZERO||T==="zero"||T==="0"||c===0)return!0}}catch{}return!1},He=async()=>{try{const N=await(async()=>{try{const c=(O==null?void 0:O.subscription)||null,T=(c==null?void 0:c.planType)??(c==null?void 0:c.plan)??null,_=typeof T=="string"?T.toLowerCase():null;if(T===W.TAHWEELA||_==="tahweela")return!0}catch{}try{if(D){const c=await ze(D),T=(c==null?void 0:c.planType)??(c==null?void 0:c.plan)??null,_=typeof T=="string"?T.toLowerCase():null;if(T===W.TAHWEELA||_==="tahweela")return!0}}catch{}return!1})();if(await K()||N){v({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"});return}}catch{}Y(!0)},ee=async()=>{try{const N=await(async()=>{try{const c=(O==null?void 0:O.subscription)||null,T=(c==null?void 0:c.planType)??(c==null?void 0:c.plan)??null,_=typeof T=="string"?T.toLowerCase():null;if(T===W.TAHWEELA||_==="tahweela")return!0}catch{}try{if(D){const c=await ze(D),T=(c==null?void 0:c.planType)??(c==null?void 0:c.plan)??null,_=typeof T=="string"?T.toLowerCase():null;if(T===W.TAHWEELA||_==="tahweela")return!0}}catch{}return!1})();if(await K()||N){v({title:"غير متاح لاشتراكك",description:"عرض إجمالي الأرباح غير متاح في هذه الخطة.",variant:"destructive"}),Y(!1);return}}catch{}Ve(!0),f(!0),Y(!1)},Re=async()=>{if(D)try{if(Array.isArray(a)&&a.length>0){const c=new Date,T=c.getMonth(),_=c.getFullYear(),Pe=Tt.filterVisibleTransactions(a,"daily",D),Z=Tt.filterVisibleTransactions(a,"monthly",D);let se=0,G=0,me=0,q=0;Pe.forEach(k=>{const ae=new Date(k.createdAt),F=String(k.status||"confirmed").toLowerCase();if(ae.toDateString()!==c.toDateString()||F!=="completed"&&F!=="confirmed"&&F!=="pending")return;const J=(k.type||k.txnType||"").toLowerCase(),C={type:J==="withdrawal"?"withdraw":J,amount:Number(k.amount||0),commission:k.commission};C.type==="withdraw"?se+=ce.calculateProfitFromTransaction(C):(C.type==="send"||C.type==="receive"||C.type==="transfer")&&(G+=ce.calculateProfitFromTransaction(C))}),Z.forEach(k=>{const ae=new Date(k.createdAt),F=String(k.status||"confirmed").toLowerCase();if(ae.getMonth()!==T||ae.getFullYear()!==_||F!=="completed"&&F!=="confirmed"&&F!=="pending")return;const J=(k.type||k.txnType||"").toLowerCase(),C={type:J==="withdrawal"?"withdraw":J,amount:Number(k.amount||0),commission:k.commission};C.type==="withdraw"?me+=ce.calculateProfitFromTransaction(C):(C.type==="send"||C.type==="receive"||C.type==="transfer")&&(q+=ce.calculateProfitFromTransaction(C))}),P({dailyWithdraw:Math.round(se*100)/100,dailyTransfer:Math.round(G*100)/100,monthlyWithdraw:Math.round(me*100)/100,monthlyTransfer:Math.round(q*100)/100,lastUpdated:new Date});return}const N=ce.getWithdrawTransferProfits(D);P({dailyWithdraw:N.dailyWithdrawProfit||0,dailyTransfer:N.dailyTransferProfit||0,monthlyWithdraw:N.monthlyWithdrawProfit||0,monthlyTransfer:N.monthlyTransferProfit||0,lastUpdated:new Date})}catch(N){console.error("Error loading total profits:",N)}};return t.jsxs(t.Fragment,{children:[t.jsx(A,{size:"sm",variant:"ghost",onClick:He,className:"h-2 w-2 p-0 bg-gradient-to-r from-blue-100 to-purple-200 text-purple-700 hover:from-blue-200 hover:to-purple-300 hover:text-purple-800 rounded transition-all duration-300 hover:scale-110 shadow-sm hover:shadow-md",title:"عرض إجمالي الأرباح",children:t.jsx(At,{className:"h-1.5 w-1.5"})}),t.jsx(De,{open:j,onOpenChange:f,children:t.jsxs(Ce,{className:"max-w-[240px] mx-auto bg-white border border-gray-200 shadow-md rounded sm:max-w-[220px] sm:bg-gradient-to-br sm:from-purple-50 sm:to-white sm:border-2 sm:border-purple-200 sm:shadow-2xl sm:rounded-2xl",children:[t.jsx(Se,{className:"text-center pb-0 border-b-0 sm:pb-2 sm:border-b sm:border-purple-200",children:t.jsxs(Oe,{className:"text-xs font-bold text-purple-800 flex items-center justify-center gap-1 mb-0 leading-tight tracking-tight sm:text-xs sm:gap-1 sm:mb-0 sm:leading-normal sm:tracking-normal",children:[t.jsx(Ms,{className:"h-2 w-2 text-purple-600 sm:h-3 sm:w-3"}),"إجمالي الأرباح (فوري)"]})}),t.jsxs("div",{className:"space-y-1 py-1 sm:space-y-2 sm:py-2",children:[t.jsxs("div",{className:"bg-blue-50 p-1 rounded border border-blue-200 sm:bg-gradient-to-r sm:from-blue-50 sm:to-blue-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(de,{className:"h-2 w-2 text-blue-600"}),t.jsx("span",{className:"text-[10px] font-semibold text-blue-800",children:"يومي"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-900",children:M((z.dailyWithdraw??0)+(z.dailyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 p-0.5 rounded border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(qe,{className:"h-2 w-2 text-red-600"}),t.jsx("span",{className:"text-[10px] text-red-800",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700",children:M(z.dailyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-green-50 p-0.5 rounded border border-green-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ot,{className:"h-2 w-2 text-green-600"}),t.jsx("span",{className:"text-[10px] text-green-800",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-green-700",children:M(z.dailyTransfer)})]})]})]}),t.jsxs("div",{className:"bg-purple-50 p-1 rounded border border-purple-200 sm:bg-gradient-to-r sm:from-purple-50 sm:to-purple-100 sm:p-2 sm:rounded-xl sm:shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Et,{className:"h-2 w-2 text-purple-600"}),t.jsx("span",{className:"text-[10px] font-semibold text-purple-800",children:"شهري"})]}),t.jsx("span",{className:"text-[10px] font-bold text-purple-900",children:M((z.monthlyWithdraw??0)+(z.monthlyTransfer??0))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsxs("div",{className:"flex items-center justify-between bg-red-50 p-0.5 rounded border border-red-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(qe,{className:"h-2 w-2 text-red-600"}),t.jsx("span",{className:"text-[10px] text-red-800",children:"سحب"})]}),t.jsx("span",{className:"text-[10px] font-bold text-red-700",children:M(z.monthlyWithdraw)})]}),t.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-0.5 rounded border border-blue-200",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ot,{className:"h-2 w-2 text-blue-600"}),t.jsx("span",{className:"text-[10px] text-blue-800",children:"تحويل"})]}),t.jsx("span",{className:"text-[10px] font-bold text-blue-700",children:M(z.monthlyTransfer)})]})]})]})]}),!te&&t.jsx("div",{className:"absolute inset-0 bg-yellow-200/70 backdrop-blur-sm flex items-center justify-center rounded sm:rounded-2xl border border-yellow-300 pointer-events-auto",children:t.jsx(A,{size:"sm",variant:"ghost",onClick:()=>Y(!0),className:"p-2 bg-yellow-300/80 text-yellow-900 hover:bg-yellow-400/90 rounded-full shadow-sm hover:shadow-md transition-all duration-300",title:"إدخال الرقم السري الرئيسي",children:t.jsx(At,{className:"h-4 w-4"})})}),t.jsx("div",{className:"flex justify-center pt-1 border-t-0 sm:pt-2 sm:border-t sm:border-purple-200",children:t.jsx(A,{onClick:()=>f(!1),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-1 rounded-xl text-xs sm:bg-gradient-to-r sm:from-purple-600 sm:to-purple-700 sm:hover:from-purple-700 sm:hover:to-purple-800 sm:px-4 sm:py-1 sm:rounded-xl sm:shadow-lg sm:hover:shadow-xl sm:transition-all sm:duration-300",children:"إغلاق"})})]})}),t.jsx(Ge,{open:X,onOpenChange:Y,onSuccess:ee,description:"لا يمكن الاطلاع على إجمالي الأرباح إلا بإدخال الرقم السري الرئيسي"})]})},Hs=D=>t.jsx(Vs,{...D}),ba=()=>{var xt,ft,gt,yt,vt,bt,jt,Nt,wt;const D=cs(),{user:a,profile:j,userSubscription:f}=kt(),X=oe.useMemo(()=>{var r,l,n,s;const e=((r=f==null?void 0:f.subscription)==null?void 0:r.planType)??((l=f==null?void 0:f.subscription)==null?void 0:l.plan)??((n=j==null?void 0:j.subscription)==null?void 0:n.planType)??((s=j==null?void 0:j.subscription)==null?void 0:s.plan)??null;return e===W.ZERO||String(e).toLowerCase()==="zero"},[(xt=f==null?void 0:f.subscription)==null?void 0:xt.planType,(ft=f==null?void 0:f.subscription)==null?void 0:ft.plan,(gt=j==null?void 0:j.subscription)==null?void 0:gt.planType,(yt=j==null?void 0:j.subscription)==null?void 0:yt.plan]),Y=oe.useMemo(()=>{var r,l,n,s;const e=((r=f==null?void 0:f.subscription)==null?void 0:r.planType)??((l=f==null?void 0:f.subscription)==null?void 0:l.plan)??((n=j==null?void 0:j.subscription)==null?void 0:n.planType)??((s=j==null?void 0:j.subscription)==null?void 0:s.plan)??null;return e===W.TAHWEELA||String(e).toLowerCase()==="tahweela"},[(vt=f==null?void 0:f.subscription)==null?void 0:vt.planType,(bt=f==null?void 0:f.subscription)==null?void 0:bt.plan,(jt=j==null?void 0:j.subscription)==null?void 0:jt.planType,(Nt=j==null?void 0:j.subscription)==null?void 0:Nt.plan]),{shopName:te}=ds(),{isShiftActive:Ve,shiftUser:z}=ms(),[P,O]=d.useState([]),[M,K]=d.useState([]),[He,ee]=d.useState(new Set),[Re,N]=d.useState(!1),[c,T]=d.useState(null),[_,Pe]=d.useState("all"),[Z,se]=d.useState(""),[G,me]=d.useState(""),[q,k]=d.useState(""),[ae,F]=d.useState(!1),[J,C]=d.useState(!1),[Lt,Xe]=d.useState(!1),[It,Ye]=d.useState(!1),[Ke,Ze]=d.useState(""),[_t,Je]=d.useState("شرح التطبيق"),[Xs,Qe]=d.useState(null),[ne,Wt]=d.useState(null),[Mt,pe]=d.useState(!1);oe.useEffect(()=>{var r;((r=f==null?void 0:f.subscription)==null?void 0:r.planType)===W.TAHWEELA&&(v({title:"غير متاح لاشتراكك",description:"صفحة المعاملات غير متاحة في باقة تحويله. استخدم لوحة المستخدم للتحويل/السحب فقط.",variant:"destructive"}),D("/user/dashboard"))},[(wt=f==null?void 0:f.subscription)==null?void 0:wt.planType]);const[Ys,Bt]=d.useState(!1),[Ks,zt]=d.useState(!1),[Zs,Js]=d.useState(!1),[Ft,ke]=d.useState(!1),[Ut,et]=d.useState(!1),[$t,tt]=d.useState(!1),[Gt,Ee]=d.useState(!1),[qt,Vt]=d.useState(null),[Ht,he]=d.useState(!1),[st,ue]=d.useState({keepLastCount:30,intervalDays:7,lastResetAt:null});d.useEffect(()=>{(async()=>{if(a!=null&&a.uid)try{const r=await E.getUserData(a.uid),l=(r==null?void 0:r.recentReset)||{},n=Number(l==null?void 0:l.keepLastCount)>0?Number(l.keepLastCount):30,s=Number(l==null?void 0:l.intervalDays)>0?Number(l.intervalDays):7,i=p=>p instanceof Date?p:typeof(p==null?void 0:p.toDate)=="function"?p.toDate():p?new Date(String(p)):null,u=l!=null&&l.lastResetAt?i(l.lastResetAt):null,m=new Date;!u||m.getTime()-u.getTime()>=s*24*60*60*1e3?(await E.updateUserData(a.uid,{recentReset:{keepLastCount:n,intervalDays:s,lastResetAt:m}}),ue({keepLastCount:n,intervalDays:s,lastResetAt:m})):ue({keepLastCount:n,intervalDays:s,lastResetAt:u})}catch{ue({keepLastCount:30,intervalDays:7,lastResetAt:null})}})()},[a==null?void 0:a.uid]),d.useEffect(()=>{if(!(a!=null&&a.uid))return;(async()=>{try{const r=V(I,"users",a.uid),l=await $(r),n=l.exists()?l.data():{},s=n==null?void 0:n.tutorialSeenAt,i=s!=null&&s.toDate?s.toDate():s?new Date(s):null;Wt(i)}catch{}})()},[a==null?void 0:a.uid]),d.useEffect(()=>{(async()=>{try{const r=await $(V(I,"app_guides","latest")),l=r.exists()?r.data():null;if(!l){Ze(""),Je(""),Qe(null),pe(!1);return}const n=String(l.url||""),s=String(l.title||"شرح التطبيق"),i=l.publishedAt,u=i!=null&&i.toDate?i.toDate():i?new Date(i):new Date;Ze(n),Je(s),Qe(u),pe(u?!ne||u.getTime()>((ne==null?void 0:ne.getTime())||0):!1)}catch{pe(!1)}})()},[ne]);const Xt=e=>{try{const r=new URL(e);let l="";return r.hostname.includes("youtube.com")?r.pathname==="/watch"?l=r.searchParams.get("v")||"":(r.pathname.startsWith("/embed/")||r.pathname.startsWith("/shorts/"))&&(l=r.pathname.split("/").pop()||""):r.hostname==="youtu.be"&&(l=r.pathname.replace(/^\//,"")),l?`https://www.youtube.com/embed/${l}?autoplay=1&rel=0`:e}catch{return e}},Yt=async()=>{Ye(!0);try{a!=null&&a.uid&&await E.updateUserData(a.uid,{tutorialSeenAt:new Date}),pe(!1)}catch{}},[Kt,xe]=d.useState(!1),[fe,at]=d.useState(""),[re,nt]=d.useState(""),[ge,rt]=d.useState(""),[it,ot]=d.useState(!1),[lt,Le]=d.useState(0);d.useEffect(()=>{if(!(a!=null&&a.uid)){Le(0);return}(async()=>{try{const r=V(I,"users",a.uid),l=await $(r),n=l.exists()?l.data():{},u=(Array.isArray(n==null?void 0:n.debts)?n.debts:[]).filter(m=>(m==null?void 0:m.status)==="pending"&&(Number(m==null?void 0:m.amount)||0)>0).length;Le(u)}catch{Le(0)}})()},[a==null?void 0:a.uid]),d.useEffect(()=>{Zt(),Jt()},[a]),d.useEffect(()=>{if(!(a!=null&&a.uid))return;(async()=>{try{const r=ve(be(I,"deletedTransactions"),Q("userId","==",a.uid)),l=await je(r),n=[];l.docs.forEach(s=>{const i=s.data(),u=[i.originalTransactionId,i.transactionId,i.reference,s.id].filter(Boolean).map(m=>String(m));n.push(...u)}),n.length>0&&(ee(s=>{const i=new Set(s);return n.forEach(u=>i.add(u)),i}),O(s=>s.filter(i=>{const u=String(i.id||""),m=String(i.transactionId||""),x=String(i.reference||"");return!(n.includes(u)||n.includes(m)||n.includes(x))})));try{E.subscribeDeletedTransactionsLocalSync(a.uid)}catch{}}catch(r){console.warn("deletedTransactions fetch failed:",r)}})()},[a==null?void 0:a.uid]),d.useEffect(()=>{(async()=>{try{if(!(a!=null&&a.uid)){ee(new Set);return}const e=ve(be(I,"deletedTransactions"),Q("userId","==",a.uid),Q("permanent","==",!0)),l=(await je(e)).docs.flatMap(n=>{const s=n.data();return[s.originalTransactionId,s.transactionId,s.reference,n.id].filter(Boolean).map(String)});ee(new Set(l))}catch{ee(new Set)}})()},[a==null?void 0:a.uid]);const{data:Ie,refetch:Qs,isFetching:ea}=Os({queryKey:["userTransactions",a==null?void 0:a.uid],queryFn:async()=>{if(!(a!=null&&a.uid))return[];try{const e=ve(be(I,"deletedTransactions"),Q("userId","==",a.uid),Q("permanent","==",!0)),[r,l,n]=await Promise.all([E.getUserTransactions(a.uid).catch(()=>[]),E.getByUserId(a.uid).catch(()=>[]),je(e).then(o=>o.docs.flatMap(y=>{const h=y.data();return[h.originalTransactionId,h.transactionId,h.reference,y.id].filter(Boolean).map(String)})).catch(()=>[])]),s=Array.isArray(r)&&r.length>0?r:Array.isArray(l)?l:[],i=new Set(n),m=(s||[]).map(o=>({...o,createdAt:o.createdAt instanceof Date?o.createdAt:new Date(o.createdAt)})).filter(o=>!((o==null?void 0:o.type)==="report"||((o==null?void 0:o.title)||"").includes("إيصال تسليم وردية"))).filter(o=>{const y=String(o.id||""),h=String(o.transactionId||""),g=String(o.reference||o.transactionReference||"");return!i.has(y)&&(!h||!i.has(h))&&(!g||!i.has(g))}),x=a!=null&&a.uid?E.getLocalReceipts(a.uid):[],p=[...m,...Array.isArray(x)?x:[]],b=o=>{var y;return String((o==null?void 0:o.transactionId)||(o==null?void 0:o.id)||(o==null?void 0:o.reference)||(o==null?void 0:o.transactionReference)||((y=o==null?void 0:o.receipt)==null?void 0:y.reference)||`${new Date((o==null?void 0:o.createdAt)||Date.now()).getTime()}`)},S=new Set;return p.filter(o=>{const y=b(o);return S.has(y)?!1:(S.add(y),!0)}).map(We)}catch(e){return console.error("Error fetching transactions:",e),[]}},enabled:!!(a!=null&&a.uid),staleTime:5*60*1e3});d.useEffect(()=>{Ie&&O(Ie)},[Ie]);const Zt=async()=>{try{if(!a)return;const e=ve(be(I,"deletedTransactions"),Q("userId","==",a.uid),Q("permanent","==",!0)),[r,l,n]=await Promise.all([E.getUserTransactions(a.uid).catch(()=>[]),E.getByUserId(a.uid).catch(()=>[]),je(e).then(o=>o.docs.flatMap(y=>{const h=y.data();return[h.originalTransactionId,h.transactionId,h.reference,y.id].filter(Boolean).map(String)})).catch(()=>[])]),s=Array.isArray(r)&&r.length>0?r:Array.isArray(l)?l:[],i=new Set(n),m=(s||[]).map(o=>({...o,createdAt:o.createdAt instanceof Date?o.createdAt:new Date(o.createdAt)})).filter(o=>!((o==null?void 0:o.type)==="report"||((o==null?void 0:o.title)||"").includes("إيصال تسليم وردية"))).filter(o=>{const y=String(o.id||""),h=String(o.transactionId||""),g=String(o.reference||o.transactionReference||"");return!i.has(y)&&(!h||!i.has(h))&&(!g||!i.has(g))}),x=a!=null&&a.uid?E.getLocalReceipts(a.uid):[],p=[...m,...Array.isArray(x)?x:[]],b=o=>{var y;return String((o==null?void 0:o.transactionId)||(o==null?void 0:o.id)||(o==null?void 0:o.reference)||(o==null?void 0:o.transactionReference)||((y=o==null?void 0:o.receipt)==null?void 0:y.reference)||`${new Date((o==null?void 0:o.createdAt)||Date.now()).getTime()}`)},S=new Set,w=p.filter(o=>{const y=b(o);return S.has(y)?!1:(S.add(y),!0)});O(w.map(We))}catch(e){console.error("خطأ في تحميل معاملات المستخدم من Firestore:",e),v({title:"فشل جلب معاملات المستخدم",description:"قد تكون المشكلة صلاحيات Firestore أو اتصال الشبكة. سيتم عرض المتاح محليًا إن وُجد. جرّب تسجيل الدخول مجددًا أو افتح صفحة اختبار المصادقة.",variant:"destructive"})}},Jt=async()=>{try{if(!a)return;const r=(await le.getDeletedTransactionsByUser(a.uid)).map(l=>({...l,createdAt:l.createdAt instanceof Date?l.createdAt:new Date(l.createdAt)}));K(r.map(We))}catch(e){console.error("خطأ في تحميل المعاملات المحذوفة من Firestore:",e),v({title:"فشل جلب المعاملات المحذوفة",description:"تحقق من الصلاحيات والاتصال. يمكن مراجعة صفحة اختبار المصادقة للتشخيص.",variant:"destructive"})}},ie=oe.useMemo(()=>{const e=new Date,r=new Date(e.getFullYear(),e.getMonth(),1),l=new Date(e.getFullYear(),e.getMonth()+1,1);return[...P].sort((s,i)=>{const u=s.createdAt instanceof Date?s.createdAt.getTime():0;return(i.createdAt instanceof Date?i.createdAt.getTime():0)-u}).filter(s=>s.createdAt>=r&&s.createdAt<l)},[P]),Qt=oe.useMemo(()=>{const e=new Date,r=new Date(e.getFullYear(),e.getMonth(),1),l=new Date(e.getFullYear(),e.getMonth()+1,1);return Math.max(0,((P==null?void 0:P.length)||0)-(P||[]).filter(n=>n.createdAt>=r&&n.createdAt<l).length)},[P==null?void 0:P.length]),ct=ie.filter(e=>{const r=!Z||e.senderPhone.includes(Z)||e.receiverPhone.includes(Z),l=!G||e.createdAt.toDateString()===new Date(G).toDateString(),n=!q||e.createdAt.toTimeString().startsWith(q);return r&&l&&n}),dt=(e,r)=>{switch(e){case"completed":return t.jsx(Fs,{className:`h-4 w-4 ${r==="withdraw"?"text-red-500":"text-green-500"}`});case"pending":return t.jsx(de,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return t.jsx(zs,{className:"h-4 w-4 text-red-500"});default:return t.jsx(de,{className:"h-4 w-4 text-gray-500"})}},_e=e=>{switch(e){case"completed":return"مكتمل";case"pending":return"قيد المراجعة";case"cancelled":return"ملغي";default:return"غير معروف"}},We=e=>{const r=((e==null?void 0:e.status)??"").toString().toLowerCase(),l=r==="confirmed"||r==="success"||r==="completed"?"completed":r==="failed"||r==="error"||r==="cancelled"||r==="canceled"?"cancelled":"pending",s=((e==null?void 0:e.type)??(e==null?void 0:e.txnType)??"").toString().toLowerCase()==="withdraw"?"withdraw":"send",i=(e==null?void 0:e.senderPhone)??(e==null?void 0:e.senderMsisdn)??(e==null?void 0:e.sender_msisdn)??(e==null?void 0:e.sender)??(e==null?void 0:e.from)??"",u=(e==null?void 0:e.receiverPhone)??(e==null?void 0:e.receiverMsisdn)??(e==null?void 0:e.receiver_msisdn)??(e==null?void 0:e.receiver)??(e==null?void 0:e.to)??"",m=e==null?void 0:e.createdAt,x=m instanceof Date?m:m!=null&&m.toDate?m.toDate():new Date(m);return{id:e==null?void 0:e.id,senderPhone:i||"غير معروف",receiverPhone:u||"غير معروف",amount:Number((e==null?void 0:e.amount)??0),status:l,type:s,createdAt:x,provider:(e==null?void 0:e.provider)??void 0,commission:(e==null?void 0:e.commission)??void 0,withdrawnAmount:(e==null?void 0:e.withdrawnAmount)??void 0,sentAmount:(e==null?void 0:e.sentAmount)??void 0,fromWallet:(e==null?void 0:e.fromWallet)??(e==null?void 0:e.walletId)??void 0,cashierName:(e==null?void 0:e.cashierName)??(e==null?void 0:e.createdByName)??(e==null?void 0:e.cashier)??void 0,commissionMode:(e==null?void 0:e.commissionMode)??(e==null?void 0:e.commission_mode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,walletEffectAppliedOnCreation:(e==null?void 0:e.walletEffectAppliedOnCreation)??(e==null?void 0:e.effectsAppliedOnCreation)??(e==null?void 0:e.effectAppliedOnCreation)??!1,cashEffectAppliedOnCreation:(e==null?void 0:e.cashEffectAppliedOnCreation)??!1,fee:(e==null?void 0:e.fee)??void 0,senderName:(e==null?void 0:e.senderName)??(e==null?void 0:e.customerName)??void 0}},es=e=>{const r=String((e==null?void 0:e.provider)||"").toLowerCase(),l=r.includes("vodafone")?"vf-cash":r.includes("instapay")?"instapay":"",n=e.type==="send"?"تحويل":"سحب",s=e.type==="withdraw"&&l?`${n} ${l}`:n;return{id:e.id,type:e.type==="send"?"transfer":"withdraw",sender_msisdn:e.senderPhone,receiver_msisdn:e.receiverPhone,amount:e.amount,commission:e.commission||0,status:e.status==="cancelled"?"failed":e.status,createdAt:e.createdAt.toISOString(),updatedAt:e.createdAt.toISOString(),shopName:te??(j==null?void 0:j.shopName)??(a==null?void 0:a.displayName)??"المحل",cashierName:(e==null?void 0:e.cashierName)??null,commissionMode:(e==null?void 0:e.commissionMode)??void 0,totalCharged:(e==null?void 0:e.totalCharged)??void 0,fee:(e==null?void 0:e.fee)??void 0,note:(e==null?void 0:e.note)??(e==null?void 0:e.notes)??void 0,senderName:(e==null?void 0:e.senderName)??void 0,provider:(e==null?void 0:e.provider)??void 0,title:s}},Me=e=>{const r=es(e);Vt(r),Ee(!0)},ts=e=>{T(e),N(!0)},ss=async()=>{c&&(await as(c.id),N(!1),T(null))},as=async e=>{try{const r=M.find(s=>s.id===e);if(!r||!a)return;const l=await E.saveUserTransaction(a.uid,{...r,userId:a.uid,status:"completed",cashierName:r.cashierName??"الحساب الرئيسي"});await le.permanentlyDeleteTransaction(e,a.uid);const n={...r,id:l};O(s=>[...s,n]),K(s=>s.filter(i=>i.id!==e)),v({title:"تم الاسترجاع",description:"تم استرجاع الإيصال إلى حسابك."})}catch(r){console.error("خطأ في استرجاع المعاملة من Firestore:",r),v({title:"فشل الاسترجاع",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},ns=async e=>{try{if(!a)return;K(r=>r.filter(l=>l.id!==e)),await le.permanentlyDeleteTransaction(e,a.uid),await E.removeUserTransaction(a.uid,e),v({title:"تم الحذف نهائيًا",description:"الإيصال لن يعود بعد التحديث."})}catch(r){console.error("فشل الحذف النهائي للمعاملة:",r),v({title:"خطأ في الحذف النهائي",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},mt=async e=>{var r,l,n;try{const s=P.find(h=>h.id===e);if(!s||!a)return;try{const h=(r=f==null?void 0:f.subscription)==null?void 0:r.planType;if(h===W.ZERO){const{dailyOperationCountService:g}=await H(async()=>{const{dailyOperationCountService:U}=await import("./dailyOperationCountService-Br8p3Ou7.js");return{dailyOperationCountService:U}},__vite__mapDeps([0,1,2]),import.meta.url),R=s.type==="send"?"transfer":"withdraw";if(!(await g.checkAndIncrement(a.uid,R,5)).allowed){v({title:"تم بلوغ حد باقة الزيرو",description:"مسموح بحد أقصى 5 تأكيدات يوميًا للتحويل/السحب. جرّب غدًا أو قم بالترقية.",variant:"destructive"});return}}else if(h===W.TAHWEELA){const{dailyOperationCountService:g}=await H(async()=>{const{dailyOperationCountService:U}=await import("./dailyOperationCountService-Br8p3Ou7.js");return{dailyOperationCountService:U}},__vite__mapDeps([0,1,2]),import.meta.url),R=s.type==="send"?"transfer":"withdraw";if(!(await g.checkAndIncrementCombined(a.uid,R,40)).allowed){v({title:"تم بلوغ حد باقة تحويله",description:"هذه الباقة تسمح بحد أقصى 40 عملية تحويل/سحب يومياً.",variant:"destructive"});return}}}catch(h){console.warn("تعذر التحقق من حد التأكيد اليومي:",h)}const i=await Fe.getById(a.uid);if(!(i!=null&&i.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const u=V(I,"dashboardData",i.shopId),m=await $(u);let x=m.exists()?Number(((l=m.data())==null?void 0:l.cashBalance)||0):0;const p=m.exists()?((n=m.data())==null?void 0:n.walletBalances)||{}:{},b=s.fromWallet||Object.keys(p)[0],S=!!(s!=null&&s.limitsReservedOnCreation),w=Number(s.withdrawnAmount??s.sentAmount??s.amount??0),o=s.type==="send"?"transfer":"withdraw";try{const{walletDailyLimitsService:h}=await H(async()=>{const{walletDailyLimitsService:R}=await import("./index-DCCNgGPW.js").then(L=>L.cq);return{walletDailyLimitsService:R}},__vite__mapDeps([1,2]),import.meta.url),g=await h.canPerformOperation(b,w,o);if(!S&&!g.canPerform){v({title:"تجاوز الحدود",description:String(g.message||"لا يمكن الإكمال لتجاوز الحد اليومي/الشهري"),variant:"destructive"});return}}catch{v({title:"فشل التحقق من الحدود",description:"حاول مجددًا بعد قليل",variant:"destructive"});return}let y=!1;if(s.type==="withdraw"){const h=s.fromWallet||Object.keys(p)[0],g=Number(s.withdrawnAmount??s.amount??0),R=Number(s.commission??0),L=!!(s!=null&&s.walletEffectAppliedOnCreation),U=!!(s!=null&&s.cashEffectAppliedOnCreation);if(!L&&h&&g>0){const Be=p[h]||0;p[h]=Be+g}U?x=x+g:x=x-g,y=!0,await Ne(u,{cashBalance:x,walletBalances:p})}else if(s.type==="send"){const h=Number(s.commission??0),g=Number((s==null?void 0:s.fee)??0),R=Number((s==null?void 0:s.sentAmount)??(s==null?void 0:s.transferredAmount)??s.amount??0),L=Math.max(0,R)+Math.max(0,g);L>0&&(x=x+L,await Ne(u,{cashBalance:x}),y=!0)}await Ne(V(I,"userTransactions",e),{status:"completed",confirmedAt:new Date});try{const h=s.fromWallet||Object.keys(p)[0],g=Number(s.withdrawnAmount??s.sentAmount??s.amount??0);if(h&&g>0&&!S){const{walletDailyLimitsService:R}=await H(async()=>{const{walletDailyLimitsService:L}=await import("./index-DCCNgGPW.js").then(U=>U.cq);return{walletDailyLimitsService:L}},__vite__mapDeps([1,2]),import.meta.url);await R.updateUsage(h,g,s.type==="send"?"transfer":"withdraw")}}catch{v({title:"فشل تحديث الحدود",description:"تجاوز حد اليوم/الشهر يمنع الإكمال",variant:"destructive"});return}try{const{ProfitService:h}=await H(async()=>{const{ProfitService:L}=await import("./profitService-Bwg-yNfl.js");return{ProfitService:L}},__vite__mapDeps([3,1,2]),import.meta.url),g=h.calculateProfitFromTransaction({type:s.type==="send"?"transfer":"withdraw",amount:Number(s.amount||0),commission:Number(s.commission||0),fee:Number((s==null?void 0:s.fee)||0)});!!!(s!=null&&s.profitAddedOnCreation)&&g>0&&h.addProfit(g,a==null?void 0:a.uid)}catch{}O(h=>h.map(g=>g.id===e?{...g,status:"completed"}:g)),v({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),Ee(!1)}catch(s){console.error("خطأ في إكمال المعاملة:",s),v({title:"فشل الإكمال",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}},pt=async e=>{var r,l;try{const n=P.find(i=>i.id===e);if(!n||!a)return;O(i=>i.filter(u=>u.id!==e)),K(i=>[{...n},...i]);let s=n.status;try{let i={};try{const p=await $(V(I,"userTransactions",e));if(i=p.exists()?p.data():{},i!=null&&i.status){const b=String(i.status).toLowerCase();b==="completed"||b==="confirmed"||b==="success"?s="completed":b==="pending"?s="pending":(b==="cancelled"||b==="failed")&&(s="cancelled")}}catch{}const u=e,m=String((i==null?void 0:i.transactionId)||(n==null?void 0:n.transactionId)||u),x=String((i==null?void 0:i.reference)||(i==null?void 0:i.transactionReference)||(n==null?void 0:n.reference)||(n==null?void 0:n.transactionReference)||"");await E.removeUserTransaction(a.uid,e),await le.saveDeletedTransaction({...n,userId:a.uid,originalTransactionId:e,transactionId:m,reference:x||void 0,permanent:!0});try{await le.permanentlyDeleteTransaction(e,a.uid)}catch{}}catch(i){console.warn("تعذر الحذف النهائي من قواعد البيانات في هذه الخطوة، سيتم الحذف من لائحة المحذوفات عند التنفيذ اليدوي للحذف النهائي:",i)}try{const i=await Fe.getById(a.uid);if(!(i!=null&&i.shopId))throw new Error("لا يمكن تحديد معرف المتجر (shopId) للمستخدم");const u=V(I,"dashboardData",i.shopId),m=await $(u);let x=m.exists()?Number(((r=m.data())==null?void 0:r.cashBalance)||0):0;const p=m.exists()?((l=m.data())==null?void 0:l.walletBalances)||{}:{},b=Number(n.withdrawnAmount??n.amount??0),S=Number(n.commission??0),w=n.fromWallet||Object.keys(p)[0],o=!!(n!=null&&n.walletEffectAppliedOnCreation);if(n.type==="send"){const y=Number(n.fee??0),h=Number((n==null?void 0:n.sentAmount)??(n==null?void 0:n.transferredAmount)??n.amount??0);if(s==="completed"&&(x=x-(h+y)),w&&h>0){const g=p[w]||0;p[w]=g+h}}else if(n.type==="withdraw"){if(s==="completed"){if(x=x+b,w&&b>0){const y=p[w]||0;p[w]=y-b}}else if(w&&o&&b>0){const y=p[w]||0;p[w]=y-b}}await Ne(u,{cashBalance:x,walletBalances:p})}catch(i){console.warn("فشل عكس تأثير الأرصدة محليًا:",i)}try{const i=n.fromWallet;if(i){const{walletDailyLimitsService:u}=await H(async()=>{const{walletDailyLimitsService:p}=await import("./index-DCCNgGPW.js").then(b=>b.cq);return{walletDailyLimitsService:p}},__vite__mapDeps([1,2]),import.meta.url),m=Number(n.withdrawnAmount??n.sentAmount??n.amount??0),x=n.type==="send"?"transfer":"withdraw";await u.rollbackUsage(i,m,x,n.createdAt)}}catch(i){console.warn("فشل استرجاع حدود المحفظة:",i)}try{const{ProfitService:i}=await H(async()=>{const{ProfitService:b}=await import("./profitService-Bwg-yNfl.js");return{ProfitService:b}},__vite__mapDeps([3,1,2]),import.meta.url),{ReportsService:u}=await H(async()=>{const{ReportsService:b}=await import("./index-DCCNgGPW.js").then(S=>S.cp);return{ReportsService:b}},__vite__mapDeps([1,2]),import.meta.url),x={txnType:n.type==="send"?"send":"receive",amount:n.amount,commission:n.commission||0,createdAt:n.createdAt,status:"confirmed"},p=i.calculateProfitFromTransaction(x);p>0&&i.addProfit(-p,a.uid);try{u.removeTransactionEffects(n,a.uid)}catch{}}catch(i){console.warn("فشل تحديث التقارير/الأرباح بعد الحذف:",i)}}catch(n){console.error("خطأ أثناء حذف الإيصال:",n)}},ht=d.useRef(!1),ut=ps();d.useEffect(()=>{!(new URLSearchParams(ut.search).get("autoTestBalances")==="1")||ht.current||(ht.current=!0,(async()=>{var l,n,s,i,u,m;try{if(!a)return;const x=await Fe.getById(a.uid);if(!(x!=null&&x.shopId)){console.warn("autoTest: لا يوجد shopId للمستخدم، سيتم إيقاف الاختبار.");return}const p=V(I,"dashboardData",x.shopId),b=await $(p),S=b.exists()?Number(((l=b.data())==null?void 0:l.cashBalance)||0):0,w=b.exists()?((n=b.data())==null?void 0:n.walletBalances)||{}:{},o=Object.keys(w)[0]||void 0,y=100,h=5,g=await E.saveUserTransaction(a.uid,{senderPhone:"auto-test-sender",receiverPhone:"auto-test-receiver",amount:y,status:"pending",type:"withdraw",createdAt:new Date,reference:`AUTO-${Date.now()}`,commission:h,withdrawnAmount:y,fromWallet:o,cashierName:"AutoTest",commissionMode:"add",totalCharged:y+h,walletEffectAppliedOnCreation:!1});console.log("autoTest: تم إنشاء إيصال سحب تجريبي:",g),await mt(g);const R=await $(p),L=R.exists()?Number(((s=R.data())==null?void 0:s.cashBalance)||0):0,U=R.exists()?((i=R.data())==null?void 0:i.walletBalances)||{}:{},Be=S-y+h,is=o?Number(w[o]||0)+y:void 0;console.log("autoTest: توقع الدرج بعد الإكمال:",Be,"فعلي:",L),o&&console.log("autoTest: توقع المحفظة بعد الإكمال:",is,"فعلي:",U[o]),await pt(g);const ye=await $(p),os=ye.exists()?Number(((u=ye.data())==null?void 0:u.cashBalance)||0):0,ls=ye.exists()?((m=ye.data())==null?void 0:m.walletBalances)||{}:{};console.log("autoTest: تحقق نهائي — الدرج قبل/بعد الحذف:",S,os),o&&console.log("autoTest: تحقق نهائي — المحفظة قبل/بعد الحذف:",w[o]||0,ls[o]||0),v({title:"اختبار الأرصدة (Firestore فقط)",description:"تم إنشاء/إكمال/حذف إيصال تجريبي والتحقق من الأرصدة.",variant:"default"})}catch(x){console.error("autoTest: فشل اختبار الأرصدة:",x),v({title:"فشل اختبار الأرصدة",description:"تحقق من الاتصال ووجود shopId والمحافظ في Firestore.",variant:"destructive"})}})())},[ut.search,a]);const rs=async()=>{var l,n,s;const e="alkaptin678678@gmail.com",r=(n=(l=$e.currentUser)==null?void 0:l.email)==null?void 0:n.toLowerCase();if(!r||r!==e){v({title:"قيد الإنشاء",description:"ميزة الشحن متاحة لهذا الحساب فقط حالياً."});return}if(!fe||!re||!ge){v({title:"بيانات ناقصة",description:"يرجى إدخال رقم وشركة والمبلغ",variant:"destructive"});return}ot(!0);try{const u={vodafone_eg:"Vodafone",orange_eg:"Orange",etisalat_eg:"Etisalat",we_eg:"WE"}[re]??re,m=new AbortController,x=setTimeout(()=>m.abort(),15e3),p=await((s=$e.currentUser)==null?void 0:s.getIdToken()),b=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...p?{Authorization:`Bearer ${p}`}:{}},body:JSON.stringify({phone:fe,countryCode:"EG",operator:u,amount:Number(ge),useLocalAmount:!0}),signal:m.signal});clearTimeout(x);const S=await b.text();let w;try{w=JSON.parse(S)}catch{w={success:!1,message:S||"فشل قراءة استجابة الخادم"}}b.ok&&(w!=null&&w.success)?(v({title:"تم الشحن",description:(w==null?void 0:w.message)||"تم تنفيذ عملية الشحن بنجاح"}),xe(!1),at(""),nt(""),rt("")):v({title:"فشل الشحن",description:(w==null?void 0:w.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(i){console.error("Topup request error:",i),(i==null?void 0:i.name)==="AbortError"?v({title:"انتهت المهلة",description:"الخادم لم يستجب في الوقت المحدد. تأكد أن السيرفر يعمل.",variant:"destructive"}):v({title:"خطأ في الاتصال",description:"تعذر الاتصال بالخادم. حاول لاحقاً.",variant:"destructive"})}finally{ot(!1)}};return t.jsxs("div",{className:"fixed inset-0 overscroll-y-none overflow-y-auto bg-background p-4",children:[t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[t.jsxs(A,{variant:"ghost",size:"sm",onClick:()=>D("/user/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800",children:[t.jsx(Bs,{className:"h-4 w-4"}),"العودة"]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"المعاملات"})]}),t.jsxs(hs,{className:"card-modern fade-in-up",children:[t.jsxs(us,{className:"pb-2 px-3 pt-3",children:[t.jsx(xs,{className:"text-sm font-bold",children:"المعاملات الأخيرة"}),t.jsxs("div",{className:"flex items-center gap-0.5 mt-1 relative",children:[t.jsxs("div",{className:"flex items-center gap-0.5 flex-1 bg-gray-50 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[t.jsx(Ds,{className:"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors"}),t.jsx(Ue,{placeholder:"بحث...",value:Z,onChange:e=>se(e.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400"})]}),t.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:Yt,title:"شرح التطبيق",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(qs,{className:"h-2.5 w-2.5"}),Mt&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-600 rounded-full"})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شرح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 hover:border-purple-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(X||Y){v({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"});return}C(!0)},title:"إدارة التقسيط",children:t.jsx(fs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تقسيط"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Hs,{userId:a==null?void 0:a.uid,transactions:P}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"أرباح"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border border-emerald-200 hover:border-emerald-300 transition-all duration-200 hover:scale-105",onClick:()=>{v({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."})},title:"نافذة شحن سريعة",children:t.jsx(Dt,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"شحن"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 hover:border-blue-300 transition-all duration-200 hover:scale-105",onClick:()=>F(!0),title:"آلة حاسبة",children:t.jsx(Rs,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"حاسبة"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-green-50 text-green-600 hover:bg-green-100 border border-green-200 hover:border-green-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(X){v({title:"الخطة الحالية لا تسمح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية."});return}Bt(!0)},title:"بيانات المبيعات",children:t.jsx(Ps,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مبيعات"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(A,{variant:"ghost",size:"sm",className:`h-5 w-5 p-0 rounded border transition-all duration-200 hover:scale-105 ${G||q?"bg-purple-100 text-purple-600 border-purple-300":"bg-purple-50 text-purple-600 hover:bg-purple-100 border-purple-200 hover:border-purple-300"}`,onClick:()=>zt(!0),title:"اختيار التاريخ",children:[t.jsx(Et,{className:"h-2.5 w-2.5"}),(G||q)&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-purple-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تاريخ"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"relative h-5 w-5 p-0 rounded bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 hover:border-orange-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(X){v({title:"الخطة الحالية لا تسمح",description:"إدارة الديون غير متاحة في خطة زيرو. قم بالترقية."});return}ke(!0)},title:"إدارة الديون",children:t.jsxs("div",{className:"relative inline-flex items-center justify-center h-full w-full",children:[t.jsx(gs,{className:"h-2.5 w-2.5"}),lt>0&&t.jsx("div",{className:"absolute -top-1 -right-1 z-10 min-w-[12px] h-[12px] px-[2px] bg-red-600 text-white rounded-full text-[8px] leading-[12px] flex items-center justify-center pointer-events-none ring-1 ring-white",children:lt})]})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"ديون"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 hover:border-amber-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(X){v({title:"الخطة الحالية لا تسمح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية."});return}tt(!0)},title:"الصيانة",children:t.jsx(ys,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"صيانه"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-violet-50 text-violet-600 hover:bg-violet-100 border border-violet-200 hover:border-violet-300 transition-all duration-200 hover:scale-105",onClick:()=>{D("/user/dashboard",{state:{openCashierShiftModal:!0}})},title:"يومية المكنة",children:t.jsx($s,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"المكنة"})]}),t.jsxs("div",{className:"hidden sm:flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-indigo-50 text-indigo-600 hover:bg-indigo-100 border border-indigo-200 hover:border-indigo-300 transition-all duration-200 hover:scale-105",onClick:()=>{if(X){v({title:"الخطة الحالية لا تسمح",description:"الفيز الائتمانية غير متاحة في خطة زيرو. قم بالترقية."});return}et(!0)},title:"الفيز الائتمانية",children:t.jsx(Dt,{className:"h-2.5 w-2.5"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"فيز"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105 relative",onClick:()=>{he(!0)},title:"تصفير المعاملات الأخيرة",children:[t.jsx(Rt,{className:"h-2.5 w-2.5"}),Qt>0&&t.jsx("div",{className:"absolute -top-0.5 -right-0.5 h-1 w-1 bg-red-500 rounded-full"})]}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"تصفير"})]}),(Z||G||q)&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(A,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 rounded bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 hover:border-red-300 transition-all duration-200 hover:scale-105",onClick:()=>{se(""),me(""),k("")},title:"مسح",children:t.jsx("span",{className:"text-[10px] font-bold",children:"×"})}),t.jsx("span",{className:"text-[10px] font-bold text-gray-700",children:"مسح"})]})]})]})]}),t.jsx(vs,{className:"px-3 pb-3",children:t.jsxs(Cs,{value:_,onValueChange:Pe,className:"w-full",children:[t.jsxs(Ss,{className:"hidden sm:grid w-full grid-cols-4 h-10 text-sm bg-gradient-to-r from-gray-50 via-blue-50/30 to-purple-50/30 border border-gray-200/60 rounded-md p-1 shadow-sm relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-pink-500/5 opacity-0 hover:opacity-100 transition-all duration-200"}),t.jsxs(Te,{value:"all",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-blue-200/50 hover:bg-blue-50/80 hover:text-blue-700 group",children:[t.jsx("span",{className:"relative z-10",children:"الكل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(Te,{value:"send",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-green-200/50 hover:bg-green-50/80 hover:text-green-700 group",children:[t.jsx("span",{className:"relative z-10",children:"مرسل"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/10 to-emerald-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(Te,{value:"withdraw",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-orange-200/50 hover:bg-orange-50/80 hover:text-orange-700 group",children:[t.jsx("span",{className:"relative z-10",children:"سحب"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-orange-500/10 to-amber-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]}),t.jsxs(Te,{value:"deleted",className:"text-sm relative z-10 rounded transition-all duration-300  data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-rose-600 data-[state=active]:text-white data-[state=active]:shadow-md data-[state=active]:shadow-red-200/50 hover:bg-red-50/80 hover:text-red-700 group",children:[t.jsx("span",{className:"relative z-10",children:"محذوف"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-red-500/10 to-rose-500/10 opacity-0 group-hover:opacity-100 transition-all duration-300 rounded"})]})]}),t.jsx(Ae,{value:"all",className:"mt-2 receipts-list",children:ct.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ct.map((e,r)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 bg-white rounded-lg border hover:shadow-md cursor-pointer transition-all duration-200",onClick:()=>Me(e),children:[t.jsxs("div",{className:"flex items-center gap-1",children:[dt(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:`font-medium text-sm ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[B(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-red-600",children:["عمولة: ",B(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:`text-[10px] ${e.type==="withdraw"?"text-red-700":"text-green-700"}`,children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:`text-sm ${e.type==="withdraw"?"text-red-500":"text-green-600"}`,children:e.createdAt.toLocaleString("en-GB")})]})]}),t.jsxs("div",{className:"text-right",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-green-700",children:[B(e.amount)," جنيه"]}),e.withdrawnAmount&&t.jsxs("p",{className:"text-sm text-red-600",children:["مسحوب: ",B(e.withdrawnAmount)," جنيه"]}),e.sentAmount&&t.jsxs("p",{className:"text-sm text-green-600",children:["مرسل: ",B(e.sentAmount)," جنيه"]}),t.jsx(As,{variant:e.status==="completed"?"default":"secondary",className:`text-sm ${e.status==="completed"?e.type==="withdraw"?"bg-red-100 text-red-800 border-red-300":e.type==="send"?"bg-green-100 text-green-800 border-green-300":"":e.type==="withdraw"?"bg-red-100 text-red-800":""}`,children:e.type==="withdraw"?"سحب":_e(e.status)})]})]},e.id))})}),t.jsx(Ae,{value:"send",className:"mt-2 receipts-list",children:ie.filter(e=>e.type==="send").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات إرسال محفوظة بعد"}):t.jsx("div",{className:"space-y-1 fade-in-up tab-content-smooth max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ie.filter(e=>e.type==="send").map((e,r)=>t.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-card border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>Me(e),children:[t.jsx("div",{className:"h-12 w-12 rounded-full flex items-center justify-center shrink-0 bg-green-50",children:t.jsx(ks,{className:"h-6 w-6 text-green-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h4",{className:"text-base font-bold text-foreground truncate",children:e.receiverPhone}),t.jsxs("span",{className:"text-base font-bold text-green-600 whitespace-nowrap",children:["- ",B(e.amount)," ج.م"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["إلى: ",e.receiverPhone]}),t.jsx("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:e.createdAt.toLocaleString("ar-EG",{day:"numeric",month:"short",hour:"numeric",minute:"numeric",hour12:!0})})]}),t.jsxs("div",{className:`px-2.5 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${e.status==="completed"?"bg-green-50 text-green-700":e.status==="pending"?"bg-yellow-50 text-yellow-700":"bg-red-50 text-red-700"}`,children:[e.status==="completed"&&t.jsx(Ct,{className:"h-3 w-3"}),e.status==="pending"&&t.jsx(de,{className:"h-3 w-3"}),e.status==="failed"&&t.jsx(St,{className:"h-3 w-3"}),t.jsx("span",{children:_e(e.status)})]})]})]})]},e.id))})}),t.jsx(Ae,{value:"withdraw",className:"mt-2 receipts-list",children:ie.filter(e=>e.type==="withdraw").length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات سحب محفوظة بعد"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:ie.filter(e=>e.type==="withdraw").map((e,r)=>t.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-card border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>Me(e),children:[t.jsx("div",{className:"h-12 w-12 rounded-full flex items-center justify-center shrink-0 bg-red-50",children:t.jsx(qe,{className:"h-6 w-6 text-red-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h4",{className:"text-base font-bold text-foreground truncate",children:e.receiverPhone}),t.jsxs("span",{className:"text-base font-bold text-red-600 whitespace-nowrap",children:["+ ",B(e.amount)," ج.م"]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:["من: ",e.senderPhone]}),t.jsx("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:e.createdAt.toLocaleString("ar-EG",{day:"numeric",month:"short",hour:"numeric",minute:"numeric",hour12:!0})})]}),t.jsxs("div",{className:`px-2.5 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${e.status==="completed"?"bg-red-50 text-red-700":e.status==="pending"?"bg-yellow-50 text-yellow-700":"bg-red-50 text-red-700"}`,children:[e.status==="completed"&&t.jsx(Ct,{className:"h-3 w-3"}),e.status==="pending"&&t.jsx(de,{className:"h-3 w-3"}),e.status==="failed"&&t.jsx(St,{className:"h-3 w-3"}),t.jsx("span",{children:_e(e.status)})]})]})]})]},e.id))})}),t.jsx(Ae,{value:"deleted",className:"mt-2",children:M.length===0?t.jsx("div",{className:"text-center py-4 text-gray-500 fade-in-up tab-stagger-item text-[10px]",children:"لا توجد معاملات محذوفة"}):t.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:M.map((e,r)=>t.jsxs("div",{className:"receipts-row flex items-center justify-between p-3 rounded-lg border",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[dt(e.status,e.type),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-sm text-red-700",children:e.type==="withdraw"?e.receiverPhone:`${e.senderPhone} → ${e.receiverPhone}`}),e.type==="withdraw"&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm font-semibold text-red-600",children:[B(e.amount)," جنيه"]}),t.jsxs("p",{className:"text-xs text-orange-500",children:["عمولة: ",B(e.commission||0)," جنيه"]})]}),t.jsxs("p",{className:"text-[10px] text-red-700",children:["تمت بواسطة: ",e.cashierName??"الحساب الرئيسي"]}),t.jsx("p",{className:"text-sm text-red-500",children:e.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"text-right mr-2",children:[e.type!=="withdraw"&&t.jsxs("p",{className:"font-bold text-sm text-red-700",children:[B(e.amount)," جنيه"]}),t.jsx(StatusChip,{variant:"error",text:"محذوف"})]}),t.jsx(A,{variant:"ghost",size:"sm",className:"text-green-600 hover:bg-green-100 h-10 sm:h-12 px-4 sm:px-5 min-w-[44px] touch-manipulation",onClick:()=>ts(e),children:t.jsx("span",{className:"text-xs sm:text-sm",children:"استرجاع"})}),t.jsx(A,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-100 h-10 sm:h-12 px-3 sm:px-4 min-w-[44px] touch-manipulation",onClick:()=>ns(e.id),children:t.jsx(Rt,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})]},e.id))})})]})})]}),t.jsx(De,{open:It,onOpenChange:Ye,children:t.jsxs(Ce,{className:"dialog-modern max-w-3xl w-full p-0 overflow-hidden border-0 shadow-2xl",children:[t.jsx(Se,{className:"px-4 pt-4",children:t.jsx(Oe,{className:"text-lg font-bold",children:_t||"شرح التطبيق"})}),t.jsx("div",{className:"aspect-video w-full bg-black",children:Ke?t.jsx("iframe",{src:Xt(Ke),title:"Application Guide",className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0}):t.jsx("div",{className:"flex items-center justify-center h-full text-white/80",children:"لا يوجد فيديو متاح حالياً"})})]})}),t.jsx(Es,{open:$t,onOpenChange:tt})]}),t.jsx(Ls,{isOpen:Ut,onClose:()=>et(!1)}),t.jsx(Ge,{open:Ft,onOpenChange:ke,mode:"verify",title:"الرقم السري الرئيسي لفتح الديون",description:"أدخل الرقم السري الرئيسي لفتح صفحة الديون",onSuccess:()=>{ke(!1),D("/user",{state:{openDebtDialog:!0}})}}),t.jsx(Ws,{open:Ht,onOpenChange:he,title:"تأكيد كلمة المرور لتصفير المعاملات الأخيرة",description:"سيتم حذف كل المعاملات السابقة نهائيًا من حسابك وFirebase.",onSuccess:async()=>{try{if(!(a!=null&&a.uid)){he(!1);return}const e=new Date,r=l=>l instanceof Date?l:typeof(l==null?void 0:l.toDate)=="function"?l.toDate():new Date(String(l));await E.updateUserData(a.uid,{recentReset:{keepLastCount:st.keepLastCount??30,intervalDays:st.intervalDays??7,lastResetAt:e}}),ue(l=>({...l,lastResetAt:e})),v({title:"تم إخفاء المعاملات السابقة",description:"تم إخفاء كل الإيصالات الأقدم من وقت التصفير من العرض بدون التأثير على التقارير اليومية/الشهرية أو الحدود."})}catch(e){console.error("فشل تنفيذ التصفير النهائي:",e),v({title:"فشل التصفير",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}finally{he(!1)}}}),t.jsx(De,{open:Kt,onOpenChange:e=>{var r,l;if(e){const n="alkaptin678678@gmail.com",s=(l=(r=$e.currentUser)==null?void 0:r.email)==null?void 0:l.toLowerCase();if(!s||s!==n){v({title:"قيد الإنشاء",description:"هذه الميزة قيد الإنشاء حالياً."});return}xe(!0)}else xe(!1)},children:t.jsxs(Ce,{dir:"rtl",className:"sm:max-w-md",children:[t.jsx(Se,{children:t.jsx(Oe,{children:"شحن رصيد الموبايل"})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"رقم الموبايل"}),t.jsx(Ue,{value:fe,onChange:e=>at(e.target.value),placeholder:"01XXXXXXXXX",dir:"ltr"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"الشركة"}),t.jsxs(js,{value:re,onValueChange:nt,children:[t.jsx(Ns,{className:"w-full",children:t.jsx(ws,{placeholder:"اختر الشركة"})}),t.jsxs(Ts,{children:[t.jsx(we,{value:"vodafone_eg",children:"فودافون"}),t.jsx(we,{value:"orange_eg",children:"أورنج"}),t.jsx(we,{value:"etisalat_eg",children:"اتصالات"}),t.jsx(we,{value:"we_eg",children:"WE"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-right mb-1",children:"المبلغ بالجنيه"}),t.jsx(Ue,{type:"number",min:1,value:ge,onChange:e=>rt(e.target.value?Number(e.target.value):""),placeholder:"50"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-2",children:[t.jsx(A,{variant:"outline",onClick:()=>xe(!1),children:"إلغاء"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(A,{variant:"secondary",onClick:()=>D("/topup"),children:"صفحة الشحن الكاملة"}),t.jsx(A,{onClick:rs,disabled:it||!fe||!re||!ge,children:it?"جارٍ التنفيذ...":"تأكيد الشحن"})]})]})]})]})}),t.jsx(De,{open:Re,onOpenChange:N,children:t.jsxs(Ce,{className:"sm:max-w-[460px]",children:[t.jsxs(Se,{children:[t.jsx(Oe,{children:"تأكيد استرجاع الإيصال"}),t.jsx(bs,{children:"سيتم إعادة الإيصال إلى قائمة المعاملات الحالية."})]}),c&&t.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"المبلغ"}),t.jsxs("span",{className:"font-bold",children:[c.amount," جنيه"]})]}),c.type==="withdraw"?t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"العميل"}),t.jsx("span",{className:"font-medium",children:c.receiverPhone})]}):t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"من → إلى"}),t.jsxs("span",{className:"font-medium",children:[c.senderPhone," → ",c.receiverPhone]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"الكاشير"}),t.jsx("span",{className:"font-medium",children:c.cashierName??"الحساب الرئيسي"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"التاريخ"}),t.jsx("span",{className:"font-medium",children:c.createdAt.toLocaleString("ar-EG")})]})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3",children:[t.jsx(A,{variant:"outline",onClick:()=>{N(!1),T(null)},children:"إلغاء"}),t.jsx(A,{onClick:ss,children:"تأكيد الاسترجاع"})]})]})}),t.jsx(Is,{isOpen:Gt,onClose:()=>Ee(!1),transaction:qt,onPrint:()=>window.print(),onDelete:pt,onComplete:mt}),t.jsx(Ge,{open:J,onOpenChange:C,mode:"verify",title:"فتح إدارة التقسيط",description:"أدخل الرقم السري الرئيسي للوصول إلى إدارة التقسيط",onSuccess:()=>{C(!1),Xe(!0)}}),t.jsx(_s,{open:Lt,onOpenChange:Xe})]})};export{ba as default};
//# sourceMappingURL=TransactionsPage-BUl9Bn7R.js.map
