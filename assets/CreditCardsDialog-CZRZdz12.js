import{$ as oe,m as ce,r as d,j as e,af as W,ag as O,ah as V,ai as G,a3 as S,B as j,a2 as xe,y as m,I as h,at as he,a4 as J,b9 as ue}from"./index-BhZSAJfd.js";import{C as pe}from"./circle-check-big-BNaTjBaY.js";import{P as ge}from"./pen-line-BACi4g7l.js";import{C as _}from"./calendar-BlcmveZO.js";import{D as Ne}from"./dollar-sign-DdJUiMim.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],je=oe("arrow-up",we),Le=({isOpen:B,onClose:q})=>{console.log("CreditCardsDialog rendered with isOpen:",B);const{toast:o}=ce(),[c,D]=d.useState([]),[E,b]=d.useState(!1),[u,C]=d.useState(null),[i,l]=d.useState({name:"",bank:"",creditLimit:"",startDate:"",endDate:"",reminderDate:"",color:"#8B5CF6",holderName:"",withdrawLimit:"",depositLimit:""}),[f,M]=d.useState(null),[p,I]=d.useState(null),[L,y]=d.useState(""),[P,A]=d.useState(""),z=["#8B5CF6","#EF4444","#10B981","#F59E0B","#3B82F6","#EC4899","#6366F1","#14B8A6"];d.useEffect(()=>{const t=localStorage.getItem("creditCards");if(t)try{const n=JSON.parse(t).map(s=>{const r=Number(s.creditLimit)||0,x=Number(s.usedAmount)||0,N=Number.isFinite(s.availableAmount)?Number(s.availableAmount):Math.max(0,r-x),w=Number(s.withdrawLimit)||r,le=Number(s.depositLimit)||r,de=Number.isFinite(s.withdrawUsed)&&s.withdrawUsed>=0?Number(s.withdrawUsed):x,me=Number.isFinite(s.depositUsed)&&s.depositUsed>=0?Number(s.depositUsed):0;return{id:String(s.id),name:String(s.name||""),bank:String(s.bank||""),creditLimit:r,usedAmount:x,availableAmount:N,startDate:s.startDate||"",endDate:s.endDate||"",reminderDate:s.reminderDate||"",color:s.color||"#8B5CF6",holderName:s.holderName||"",withdrawLimit:w,depositLimit:le,withdrawUsed:de,depositUsed:me}});D(n)}catch{D([])}},[]);const v=t=>{localStorage.setItem("creditCards",JSON.stringify(t)),D(t)},H=()=>{if(!i.name||!i.bank||!i.creditLimit){o({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}const t=parseFloat(i.creditLimit),a=i.withdrawLimit?parseFloat(i.withdrawLimit):t,n=i.depositLimit?parseFloat(i.depositLimit):t,s={id:Date.now().toString(),name:i.name,bank:i.bank,creditLimit:t,usedAmount:0,availableAmount:t,startDate:i.startDate,endDate:i.endDate,reminderDate:i.reminderDate,color:i.color,holderName:i.holderName,withdrawLimit:a,depositLimit:n,withdrawUsed:0,depositUsed:0},r=[...c,s];v(r),l({name:"",bank:"",creditLimit:"",startDate:"",endDate:"",reminderDate:"",color:"#8B5CF6",holderName:"",withdrawLimit:"",depositLimit:""}),b(!1),o({title:"تم بنجاح",description:"تم إضافة بطاقة الائتمان بنجاح"})},R=t=>{const a=c.filter(n=>n.id!==t);v(a),o({title:"تم الحذف",description:"تم حذف بطاقة الائتمان بنجاح"})},K=t=>{C(t),l({name:t.name,bank:t.bank,creditLimit:t.creditLimit.toString(),startDate:t.startDate,endDate:t.endDate,reminderDate:t.reminderDate,color:t.color,holderName:t.holderName||"",withdrawLimit:(t.withdrawLimit??t.creditLimit).toString(),depositLimit:(t.depositLimit??t.creditLimit).toString()}),b(!0)},Q=()=>{if(!u)return;const t=parseFloat(i.creditLimit),a=i.withdrawLimit?parseFloat(i.withdrawLimit):t,n=i.depositLimit?parseFloat(i.depositLimit):t,s={...u,name:i.name,bank:i.bank,creditLimit:t,availableAmount:t-u.usedAmount,startDate:i.startDate,endDate:i.endDate,reminderDate:i.reminderDate,color:i.color,holderName:i.holderName,withdrawLimit:a,depositLimit:n},r=c.map(x=>x.id===u.id?s:x);v(r),C(null),b(!1),l({name:"",bank:"",creditLimit:"",startDate:"",endDate:"",reminderDate:"",color:"#8B5CF6",holderName:"",withdrawLimit:"",depositLimit:""}),o({title:"تم التحديث",description:"تم تحديث بطاقة الائتمان بنجاح"})},X=()=>{C(null),b(!1),l({name:"",bank:"",creditLimit:"",startDate:"",endDate:"",reminderDate:"",color:"#8B5CF6",holderName:"",withdrawLimit:"",depositLimit:""})},Y=(t,a)=>{const n=c.map(s=>{if(s.id===t){const r=s.withdrawLimit??s.creditLimit,N=(s.withdrawUsed??s.usedAmount??0)+a;if(N>r)return o({title:"خطأ",description:"مبلغ السحب يتجاوز حد السحب المحدد للبطاقة",variant:"destructive"}),s;const w=s.usedAmount+a;return{...s,usedAmount:w,availableAmount:s.creditLimit-w,withdrawUsed:N}}return s});v(n)},Z=(t,a)=>{const n=c.map(s=>{if(s.id===t){const r=s.depositLimit??s.creditLimit,N=(s.depositUsed??0)+a;if(N>r)return o({title:"خطأ",description:"مبلغ الإيداع يتجاوز حد الإيداع المحدد للبطاقة",variant:"destructive"}),s;const w=Math.max(0,s.usedAmount-a);return{...s,usedAmount:w,availableAmount:s.creditLimit-w,depositUsed:N}}return s});v(n)},ee=t=>t.usedAmount/t.creditLimit*100,te=t=>{const a=t.withdrawLimit??t.creditLimit;if(!a||a<=0)return 0;const n=t.withdrawUsed??t.usedAmount??0;return Math.min(100,n/a*100)},se=t=>{const a=t.depositLimit??t.creditLimit;if(!a||a<=0)return 0;const n=t.depositUsed??0;return Math.min(100,n/a*100)},ie=t=>{if(!t)return!1;const a=new Date,s=new Date(t).getTime()-a.getTime(),r=Math.ceil(s/(1e3*60*60*24));return r<=7&&r>=0},$=(t,a)=>{M(t),I(a),y(""),A("")},F=()=>{M(null),I(null),y(""),A("")},ae=()=>{if(!p||!f)return;const t=parseFloat(L.replace(",","."));if(!t||isNaN(t)||t<=0){o({title:"خطأ",description:"يرجى إدخال مبلغ صحيح أكبر من صفر",variant:"destructive"});return}p==="withdraw"?Y(f,t):Z(f,t),F(),o({title:"تم بنجاح",description:p==="withdraw"?"تم تسجيل عملية السحب":"تم تسجيل عملية الإيداع"})},g=c.find(t=>t.id===f)||null,k=parseFloat(L.replace(",",".")),U=parseFloat(P.replace(",",".")),T=!isNaN(k)&&k>0,ne=!isNaN(U)&&U>=0,re=T?Math.max(0,k-(ne?U:0)):0;return e.jsx(W,{open:B,onOpenChange:q,children:e.jsxs(O,{className:"max-w-4xl max-h-[95vh] overflow-y-auto p-3 sm:p-6",children:[e.jsx(V,{className:"pb-4",children:e.jsxs(G,{className:"flex items-center gap-2 text-lg sm:text-xl",children:[e.jsx(S,{className:"h-5 w-5 sm:h-6 sm:w-6 text-purple-600"}),"إدارة كروت الائتمان"]})}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[!E&&e.jsxs(j,{onClick:()=>b(!0),className:"w-full bg-purple-600 hover:bg-purple-700 text-white py-3 text-base",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"إضافة بطاقة ائتمان جديدة"]}),E&&e.jsxs("div",{className:"bg-gray-50 p-3 sm:p-4 rounded-lg border",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-3 sm:mb-4",children:u?"تعديل بطاقة الائتمان":"إضافة بطاقة ائتمان جديدة"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"cardName",className:"text-sm font-medium",children:"اسم البطاقة"}),e.jsx(h,{id:"cardName",value:i.name,onChange:t=>l({...i,name:t.target.value}),placeholder:"مثال: بطاقة التسوق",className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"bankName",className:"text-sm font-medium",children:"اسم البنك"}),e.jsx(h,{id:"bankName",value:i.bank,onChange:t=>l({...i,bank:t.target.value}),placeholder:"مثال: البنك الأهلي",className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"creditLimit",className:"text-sm font-medium",children:"الحد الائتماني (جنيه)"}),e.jsx(h,{id:"creditLimit",type:"number",value:i.creditLimit,onChange:t=>l({...i,creditLimit:t.target.value}),placeholder:"10000",className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"cardColor",className:"text-sm font-medium",children:"لون البطاقة"}),e.jsx("div",{className:"flex gap-3 mt-2 flex-wrap",children:z.map(t=>e.jsx("button",{type:"button",className:`w-10 h-10 rounded-full border-2 ${i.color===t?"border-gray-800":"border-gray-300"}`,style:{backgroundColor:t},onClick:()=>l({...i,color:t})},t))})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"startDate",className:"text-sm font-medium",children:"تاريخ بداية المدة"}),e.jsx(h,{id:"startDate",type:"date",value:i.startDate,onChange:t=>l({...i,startDate:t.target.value}),className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"endDate",className:"text-sm font-medium",children:"تاريخ نهاية المدة"}),e.jsx(h,{id:"endDate",type:"date",value:i.endDate,onChange:t=>l({...i,endDate:t.target.value}),className:"mt-1 h-11"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"reminderDate",className:"text-sm font-medium",children:"تاريخ التذكير"}),e.jsx(h,{id:"reminderDate",type:"date",value:i.reminderDate,onChange:t=>l({...i,reminderDate:t.target.value}),className:"mt-1 h-11"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[e.jsxs(j,{onClick:u?Q:H,className:"bg-green-600 hover:bg-green-700 text-white py-3 text-base flex-1",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),u?"حفظ التعديلات":"إضافة البطاقة"]}),e.jsx(j,{onClick:X,variant:"outline",className:"py-3 text-base flex-1",children:"إلغاء"})]})]}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:c.length===0?e.jsxs("div",{className:"text-center py-6 sm:py-8 text-gray-500",children:[e.jsx(S,{className:"h-10 w-10 sm:h-12 sm:w-12 mx-auto mb-3 sm:mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm sm:text-base",children:"لا توجد بطاقات ائتمان مضافة بعد"})]}):c.map(t=>e.jsxs("div",{className:"relative overflow-hidden rounded-2xl p-4 sm:p-5 shadow-md border text-white bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800",style:{borderColor:t.color},children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 opacity-60",style:{background:`radial-gradient(circle at top left, ${t.color}, transparent 55%)`}}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 text-right",children:[e.jsx("h4",{className:"text-base sm:text-lg font-semibold tracking-wide",children:t.name}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-200",children:t.bank}),t.holderName&&e.jsxs("p",{className:"mt-1 text-xs sm:text-sm text-gray-100",children:["صاحب البطاقة: ",e.jsx("span",{className:"font-medium",children:t.holderName})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-yellow-300"}),e.jsx("span",{className:"text-lg sm:text-xl font-black tracking-widest",children:"VISA"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>K(t),className:"p-2 rounded-full bg-white/10 hover:bg-white/20 text-blue-100 transition-colors",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>R(t.id),className:"p-2 rounded-full bg-white/10 hover:bg-white/20 text-red-100 transition-colors",children:e.jsx(he,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-gray-100",children:[e.jsx("span",{children:"الإجمالي المستخدم"}),e.jsxs("span",{children:[t.usedAmount.toFixed(2)," / ",t.creditLimit.toFixed(2)," ج.م"]})]}),e.jsx("div",{className:"w-full h-1.5 rounded-full bg-white/15 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400",style:{width:`${Math.min(100,ee(t))}%`}})}),e.jsx("div",{className:"flex justify-between text-[11px] text-gray-200",children:e.jsxs("span",{children:["المتاح: ",t.availableAmount.toFixed(2)," ج.م"]})})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs sm:text-sm text-gray-100",children:[e.jsx("span",{children:"حد السحب"}),e.jsxs("span",{children:[((t.withdrawUsed??t.usedAmount)||0).toFixed(2)," /"," ",(t.withdrawLimit??t.creditLimit).toFixed(2)," ج.م"]})]}),e.jsx("div",{className:"h-1.5 rounded-full bg-red-950/60 overflow-hidden",children:e.jsx("div",{className:"h-full bg-red-400",style:{width:`${te(t)}%`}})}),e.jsxs("div",{className:"flex justify-between items-center text-xs sm:text-sm text-gray-100 mt-2",children:[e.jsx("span",{children:"حد الإيداع"}),e.jsxs("span",{children:[(t.depositUsed??0).toFixed(2)," /"," ",(t.depositLimit??t.creditLimit).toFixed(2)," ج.م"]})]}),e.jsx("div",{className:"h-1.5 rounded-full bg-emerald-950/60 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-400",style:{width:`${se(t)}%`}})})]}),ie(t.endDate)&&e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-xl bg-amber-500/15 border border-amber-400/40 text-amber-100 text-xs sm:text-sm",children:[e.jsx(J,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:"موعد سداد البطاقة قريب، تأكد من السداد في الوقت المحدد."})]}),(t.startDate||t.endDate||t.reminderDate)&&e.jsxs("div",{className:"grid grid-cols-1 gap-1.5 text-[11px] sm:text-xs text-gray-100",children:[t.startDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{children:["البداية: ",new Date(t.startDate).toLocaleDateString("ar-EG")]})]}),t.endDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{children:["النهاية: ",new Date(t.endDate).toLocaleDateString("ar-EG")]})]}),t.reminderDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{children:["التذكير: ",new Date(t.reminderDate).toLocaleDateString("ar-EG")]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2",children:[e.jsxs(j,{onClick:()=>$(t.id,"withdraw"),className:"w-full bg-red-500 hover:bg-red-600 text-white py-2.5 text-sm",disabled:t.availableAmount<=0,children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"سحب"]}),e.jsxs(j,{onClick:()=>$(t.id,"deposit"),className:"w-full bg-emerald-500 hover:bg-emerald-600 text-white py-2.5 text-sm",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"إيداع"]})]})]})]},t.id))})]}),e.jsx(W,{open:!!p,onOpenChange:t=>{t||F()},children:e.jsxs(O,{className:"max-w-md",children:[e.jsx(V,{children:e.jsx(G,{className:"text-lg font-semibold",children:p==="withdraw"?"سحب من البطاقة":"إيداع في البطاقة"})}),e.jsxs("div",{className:"space-y-4",children:[g&&e.jsxs("div",{className:"rounded-lg bg-gray-50 p-3 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"font-medium",children:g.name}),e.jsx("span",{className:"text-xs text-gray-500",children:g.bank})]}),g.holderName&&e.jsxs("div",{className:"text-xs text-gray-600",children:["صاحب البطاقة: ",e.jsx("span",{className:"font-medium",children:g.holderName})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"rounded-md bg-white border px-2 py-1",children:[e.jsx("div",{className:"text-gray-500",children:"المتاح"}),e.jsxs("div",{className:"font-semibold text-gray-800",children:[g.availableAmount.toFixed(2)," ج.م"]})]}),e.jsxs("div",{className:"rounded-md bg-white border px-2 py-1",children:[e.jsx("div",{className:"text-gray-500",children:"المستخدم"}),e.jsxs("div",{className:"font-semibold text-gray-800",children:[g.usedAmount.toFixed(2)," ج.م"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"actionAmount",className:"text-sm font-medium",children:p==="withdraw"?"مبلغ السحب":"مبلغ الإيداع"}),e.jsx(h,{id:"actionAmount",type:"number",value:L,onChange:t=>y(t.target.value),className:"mt-1 h-10",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"actionFee",className:"text-sm font-medium",children:"العمولة المخصومة من المبلغ"}),e.jsx(h,{id:"actionFee",type:"number",value:P,onChange:t=>A(t.target.value),className:"mt-1 h-10",placeholder:"0.00"}),T&&e.jsxs("p",{className:"mt-1 text-xs text-gray-600",children:["الصافي بعد العمولة:"," ",e.jsxs("span",{className:"font-semibold text-gray-800",children:[re.toFixed(2)," ج.م"]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsxs(j,{onClick:ae,className:`flex-1 h-10 ${p==="withdraw"?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700"} text-white`,children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"تأكيد"]}),e.jsx(j,{onClick:F,variant:"outline",className:"flex-1 h-10",children:"إلغاء"})]})]})]})})]})})};export{Le as default};
//# sourceMappingURL=CreditCardsDialog-CZRZdz12.js.map
