import{_ as Me,r as o,j as e,bb as Oe,aq as Fe,bG as Z,a9 as ee,u as ie,l as ce,af as le,ag as de,ah as ue,ai as fe,aG as Te,x as q,I as z,B as L,H as Y,J,aP as Ve,aE as $e,b$ as Ge,c0 as Ke,c1 as Be,a as He,aK as We,c2 as qe,c3 as ze,a_ as Ye,W as Je,aV as Xe}from"./index-CzMrJEuC.js";import{D as Qe,a as Ze,b as et,c as tt,d as ae,e as X}from"./dropdown-menu-BbnyNGMu.js";import{L as st,g as rt}from"./switch-BsQLD5QZ.js";import{FreeTrialService as nt}from"./freeTrialService-BlbSJwfx.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]],ot=Me("cloud-download",at);function it(n,t=[]){let s=[];function d(c,m){const u=o.createContext(m);u.displayName=c+"Context";const h=s.length;s=[...s,m];const f=E=>{var O;const{scope:I,children:_,...R}=E,P=((O=I==null?void 0:I[n])==null?void 0:O[h])||u,j=o.useMemo(()=>R,Object.values(R));return e.jsx(P.Provider,{value:j,children:_})};f.displayName=c+"Provider";function C(E,I){var P;const _=((P=I==null?void 0:I[n])==null?void 0:P[h])||u,R=o.useContext(_);if(R)return R;if(m!==void 0)return m;throw new Error(`\`${E}\` must be used within \`${c}\``)}return[f,C]}const i=()=>{const c=s.map(m=>o.createContext(m));return function(u){const h=(u==null?void 0:u[n])||c;return o.useMemo(()=>({[`__scope${n}`]:{...u,[n]:h}}),[u,h])}};return i.scopeName=n,[d,ct(i,...t)]}function ct(...n){const t=n[0];if(n.length===1)return t;const s=()=>{const d=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(c){const m=d.reduce((u,{useScope:h,scopeName:f})=>{const E=h(c)[`__scope${f}`];return{...u,...E}},{});return o.useMemo(()=>({[`__scope${t.scopeName}`]:m}),[m])}};return s.scopeName=t.scopeName,s}var lt=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],te=lt.reduce((n,t)=>{const s=Oe(`Primitive.${t}`),d=o.forwardRef((i,c)=>{const{asChild:m,...u}=i,h=m?s:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(h,{...u,ref:c})});return d.displayName=`Primitive.${t}`,{...n,[t]:d}},{}),me={exports:{}},he={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V=o;function dt(n,t){return n===t&&(n!==0||1/n===1/t)||n!==n&&t!==t}var ut=typeof Object.is=="function"?Object.is:dt,ft=V.useState,mt=V.useEffect,ht=V.useLayoutEffect,pt=V.useDebugValue;function wt(n,t){var s=t(),d=ft({inst:{value:s,getSnapshot:t}}),i=d[0].inst,c=d[1];return ht(function(){i.value=s,i.getSnapshot=t,Q(i)&&c({inst:i})},[n,s,t]),mt(function(){return Q(i)&&c({inst:i}),n(function(){Q(i)&&c({inst:i})})},[n]),pt(s),s}function Q(n){var t=n.getSnapshot;n=n.value;try{var s=t();return!ut(n,s)}catch{return!0}}function gt(n,t){return t()}var xt=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?gt:wt;he.useSyncExternalStore=V.useSyncExternalStore!==void 0?V.useSyncExternalStore:xt;me.exports=he;var vt=me.exports;function St(){return vt.useSyncExternalStore(jt,()=>!0,()=>!1)}function jt(){return()=>{}}var se="Avatar",[bt]=it(se),[Nt,pe]=bt(se),we=o.forwardRef((n,t)=>{const{__scopeAvatar:s,...d}=n,[i,c]=o.useState("idle");return e.jsx(Nt,{scope:s,imageLoadingStatus:i,onImageLoadingStatusChange:c,children:e.jsx(te.span,{...d,ref:t})})});we.displayName=se;var ge="AvatarImage",xe=o.forwardRef((n,t)=>{const{__scopeAvatar:s,src:d,onLoadingStatusChange:i=()=>{},...c}=n,m=pe(ge,s),u=Pt(d,c),h=Fe(f=>{i(f),m.onImageLoadingStatusChange(f)});return Z(()=>{u!=="idle"&&h(u)},[u,h]),u==="loaded"?e.jsx(te.img,{...c,ref:t,src:d}):null});xe.displayName=ge;var ve="AvatarFallback",Se=o.forwardRef((n,t)=>{const{__scopeAvatar:s,delayMs:d,...i}=n,c=pe(ve,s),[m,u]=o.useState(d===void 0);return o.useEffect(()=>{if(d!==void 0){const h=window.setTimeout(()=>u(!0),d);return()=>window.clearTimeout(h)}},[d]),m&&c.imageLoadingStatus!=="loaded"?e.jsx(te.span,{...i,ref:t}):null});Se.displayName=ve;function oe(n,t){return n?t?(n.src!==t&&(n.src=t),n.complete&&n.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Pt(n,{referrerPolicy:t,crossOrigin:s}){const d=St(),i=o.useRef(null),c=d?(i.current||(i.current=new window.Image),i.current):null,[m,u]=o.useState(()=>oe(c,n));return Z(()=>{u(oe(c,n))},[c,n]),Z(()=>{const h=E=>()=>{u(E)};if(!c)return;const f=h("loaded"),C=h("error");return c.addEventListener("load",f),c.addEventListener("error",C),t&&(c.referrerPolicy=t),typeof s=="string"&&(c.crossOrigin=s),()=>{c.removeEventListener("load",f),c.removeEventListener("error",C)}},[c,s,t]),m}var je=we,be=xe,Ne=Se;const Pe=o.forwardRef(({className:n,...t},s)=>e.jsx(je,{ref:s,className:ee("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",n),...t}));Pe.displayName=je.displayName;const ye=o.forwardRef(({className:n,...t},s)=>e.jsx(be,{ref:s,className:ee("aspect-square h-full w-full",n),...t}));ye.displayName=be.displayName;const ke=o.forwardRef(({className:n,...t},s)=>e.jsx(Ne,{ref:s,className:ee("flex h-full w-full items-center justify-center rounded-full bg-muted",n),...t}));ke.displayName=Ne.displayName;function yt({open:n,onOpenChange:t}){const{user:s}=ie(),{toast:d}=ce(),[i,c]=o.useState(!1),[m,u]=o.useState(!1),[h,f]=o.useState(!1),[C,E]=o.useState(!1),[I,_]=o.useState(!1),[R,P]=o.useState(!1),[j,O]=o.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[l,S]=o.useState({currentPassword:"",newPassword:"",confirmPassword:""}),M=()=>{const p={currentPassword:"",newPassword:"",confirmPassword:""};return j.currentPassword||(p.currentPassword="كلمة المرور الحالية مطلوبة"),j.newPassword?j.newPassword.length<6&&(p.newPassword="كلمة المرور يجب أن تكون 6 أحرف على الأقل"):p.newPassword="كلمة المرور الجديدة مطلوبة",j.confirmPassword?j.newPassword!==j.confirmPassword&&(p.confirmPassword="كلمات المرور غير متطابقة"):p.confirmPassword="تأكيد كلمة المرور مطلوب",S(p),!Object.values(p).some(v=>v!=="")},y=async p=>{if(p.preventDefault(),!(!M()||!s||!s.email)){c(!0);try{const v=Ge.credential(s.email,j.currentPassword);await Ke(s,v),P(!0),_(!0),d({title:"تأكيد الهوية",description:"أدخل الرقم السري الرئيسي لتأكيد تغيير كلمة المرور"})}catch(v){console.error("خطأ في تغيير كلمة المرور:",v);let A="حدث خطأ أثناء تغيير كلمة المرور";if(v.code==="auth/wrong-password"){S(D=>({...D,currentPassword:"كلمة المرور الحالية غير صحيحة"}));return}else if(v.code==="auth/weak-password"){S(D=>({...D,newPassword:"كلمة المرور ضعيفة جداً"}));return}else v.code==="auth/requires-recent-login"&&(A="يجب تسجيل الدخول مرة أخرى لتغيير كلمة المرور");d({title:"خطأ في تغيير كلمة المرور",description:A,variant:"destructive"})}finally{c(!1)}}},B=async()=>{if(s){c(!0);try{await Be(s,j.newPassword),d({title:"تم تغيير كلمة المرور بنجاح",description:"تم تحديث كلمة المرور الخاصة بك بنجاح"}),O({currentPassword:"",newPassword:"",confirmPassword:""}),S({currentPassword:"",newPassword:"",confirmPassword:""}),_(!1),P(!1),t(!1)}catch(p){console.error("خطأ في تحديث كلمة المرور:",p);let v="حدث خطأ أثناء تغيير كلمة المرور";p.code==="auth/requires-recent-login"&&(v="انتهت جلسة المصادقة. يرجى إعادة إدخال كلمة المرور الحالية"),d({title:"خطأ في تغيير كلمة المرور",description:v,variant:"destructive"})}finally{c(!1)}}},k=p=>v=>{O(A=>({...A,[p]:v.target.value})),l[p]&&S(A=>({...A,[p]:""}))},g=()=>{O({currentPassword:"",newPassword:"",confirmPassword:""}),S({currentPassword:"",newPassword:"",confirmPassword:""}),_(!1),P(!1),t(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(le,{open:n,onOpenChange:g,children:e.jsxs(de,{className:"sm:max-w-[425px]",children:[e.jsxs(ue,{children:[e.jsx(fe,{children:"تغيير كلمة المرور"}),e.jsx(Te,{children:"أدخل كلمة المرور الحالية وكلمة المرور الجديدة لتحديث حسابك"})]}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"currentPassword",children:"كلمة المرور الحالية"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{id:"currentPassword",type:m?"text":"password",value:j.currentPassword,onChange:k("currentPassword"),className:l.currentPassword?"border-red-500":"",autoComplete:"off",disabled:i}),e.jsx(L,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>u(!m),disabled:i,children:m?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"})})]}),l.currentPassword&&e.jsx("p",{className:"text-sm text-red-500",children:l.currentPassword})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"newPassword",children:"كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{id:"newPassword",type:h?"text":"password",value:j.newPassword,onChange:k("newPassword"),className:l.newPassword?"border-red-500":"",autoComplete:"new-password",disabled:i}),e.jsx(L,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>f(!h),disabled:i,children:h?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"})})]}),l.newPassword&&e.jsx("p",{className:"text-sm text-red-500",children:l.newPassword})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"confirmPassword",children:"تأكيد كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{id:"confirmPassword",type:C?"text":"password",value:j.confirmPassword,onChange:k("confirmPassword"),className:l.confirmPassword?"border-red-500":"",autoComplete:"new-password",disabled:i}),e.jsx(L,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>E(!C),disabled:i,children:C?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"})})]}),l.confirmPassword&&e.jsx("p",{className:"text-sm text-red-500",children:l.confirmPassword})]}),e.jsxs(Ve,{children:[e.jsx(L,{type:"button",variant:"outline",onClick:g,disabled:i,children:"إلغاء"}),e.jsxs(L,{type:"submit",disabled:i,children:[i&&e.jsx(st,{className:"mr-2 h-4 w-4 animate-spin"}),"تغيير كلمة المرور"]})]})]})]})}),e.jsx($e,{open:I&&R,onOpenChange:p=>{_(p),p||P(!1)},mode:"verify",title:"التحقق من الرقم السري الرئيسي",description:"لا يمكن تغيير كلمة المرور إلا بعد التحقق من الرقم السري الرئيسي",onSuccess:B,onCancel:()=>{_(!1),P(!1)}})]})}const kt="cashy.google.accessToken",Ct="cashy.google.email",Et="cashy.google.expiresAt";function It(){try{const n=localStorage.getItem(kt),t=localStorage.getItem(Ct),s=localStorage.getItem(Et),d=s?Number(s):null;return{token:n,email:t,expiresAt:d}}catch{return{token:null,email:null,expiresAt:null}}}async function _t(n,t,s){try{const d=await fetch("/user/google-backup-token",{method:"POST",headers:{"Content-Type":"application/json","X-USER-ID":n},body:JSON.stringify({email:t,refresh_token:s})}),i=await d.json().catch(()=>({}));return!!(d.ok&&(i!=null&&i.ok))}catch{return!1}}function Ot({className:n}){const{user:t,profile:s,signOut:d,updateUserProfile:i}=ie(),c=He(),[m,u]=o.useState(!1),{isShiftActive:h}=We(),{toast:f}=ce(),[C,E]=o.useState(!1),[I,_]=o.useState(!1),[R,P]=o.useState(!1),[{token:j},O]=o.useState(()=>It()),l=typeof window<"u"?window.electronAPI:void 0,S=!!l,[M,y]=o.useState(!1),[B,k]=o.useState(!1),[g,p]=o.useState(""),[v,A]=o.useState(""),[D,re]=o.useState(!1),[F,H]=o.useState(0),[W,$]=o.useState(!1),[Ce,Ee]=o.useState(""),[b,Ie]=o.useState(""),[At,Dt]=o.useState(!1),[G,_e]=o.useState(0),[Ae,De]=o.useState(!1);o.useEffect(()=>{(async()=>{if(!(t!=null&&t.uid))return;const a=await nt.checkTrialValidity(t.uid);De(a.isValid&&!a.isExpired),_e(a.hoursRemaining)})()},[t==null?void 0:t.uid]);const U=(r,a)=>{const w=String(r||"").split(".").map(x=>parseInt(x,10)||0),N=String(a||"").split(".").map(x=>parseInt(x,10)||0);for(let x=0;x<Math.max(w.length,N.length);x++){const T=w[x]||0,K=N[x]||0;if(T>K)return 1;if(T<K)return-1}return 0};o.useEffect(()=>{if(!(!S||!l))try{l.onUpdateAvailable(r=>{var w,N,x;const a=String(((w=r==null?void 0:r.info)==null?void 0:w.version)||"");p(a),A(String(((N=r==null?void 0:r.info)==null?void 0:N.notes)||"")),re(!!((x=r==null?void 0:r.info)!=null&&x.force)),U(a,b)>0?y(!0):y(!1)}),l.onUpdateDownloaded(r=>{var w,N;const a=String(((w=r==null?void 0:r.info)==null?void 0:w.version)||"");p(a),A(String(((N=r==null?void 0:r.info)==null?void 0:N.notes)||"")),$(!1),H(100),U(a,b)>0?y(!0):y(!1);try{S&&(t!=null&&t.uid)&&a&&(i==null||i({lastAckDesktopVersion:a}))}catch{}}),l.onUpdateError(r=>{try{f({title:"فشل التحديث",description:String((r==null?void 0:r.message)||(r==null?void 0:r.code)||"تعذر التحميل"),variant:"destructive"})}catch{}}),typeof l.onUpdateProgress=="function"&&l.onUpdateProgress(r=>{const a=(r==null?void 0:r.percent)==null?0:Number(r.percent);$(!0),H(Math.max(0,Math.min(100,isNaN(a)?0:a)))}),typeof l.appVersion=="function"&&l.appVersion().then(r=>{typeof r=="string"&&Ie(r);try{S&&(t!=null&&t.uid)&&typeof r=="string"&&r&&(i==null||i({desktopInstalledVersion:r}))}catch{}}).catch(()=>{})}catch{}},[S,l]),o.useEffect(()=>{S&&F>=100&&k(!0)},[S,F]),o.useEffect(()=>{const r=qe(a=>{const w=String((a==null?void 0:a.version)||""),x=`desktop_update_seen_${String((t==null?void 0:t.uid)||"anon")}`;let T="";try{T=localStorage.getItem(x)||""}catch{}if(w&&w!==g){if(U(w,b)>0)if(y(!0),T===w)k(!1);else{k(!0);try{localStorage.setItem(x,w)}catch{}}else y(!1);p(w),A(String((a==null?void 0:a.notes)||"")),re((a==null?void 0:a.force)||!1);const K=ze({downloadURL_64:a==null?void 0:a.downloadURL_64,downloadURL_32:a==null?void 0:a.downloadURL_32})||"";Ee(K)}});return()=>{try{r()}catch{}}},[g,b,t==null?void 0:t.uid]);const Le=async()=>{var r;try{if(l){try{await l.checkUpdate()}catch{}k(!0),$(!0),H(0);const a=await((r=l.downloadUpdate)==null?void 0:r.call(l,Ce))??await l.downloadUpdate();if(typeof a=="string"&&a.startsWith("err:")){try{f({title:"فشل التحديث",description:a.slice(4),variant:"destructive"})}catch{}$(!1)}else if(a==="noop")try{f({title:"لا يوجد تحديث",description:"لا تتوفر نسخة أحدث حالياً."})}catch{}else if(a==="manual")try{f({title:"جارٍ تنزيل التحديث",description:"سيتم تطبيق التحديث تلقائيًا بعد اكتمال التنزيل."})}catch{}else if(a==="autoUpdater")try{f({title:"تنزيل تلقائي",description:"سيتم تطبيق التحديث تلقائياً بواسطة النظام."})}catch{}}}catch(a){try{f({title:"فشل التحديث",description:(a==null?void 0:a.message)||"حدث خطأ أثناء التنزيل",variant:"destructive"})}catch{}}},Ue=()=>s!=null&&s.fullName?s==null?void 0:s.fullName.split(" ").map(r=>r.charAt(0)).join("").toUpperCase().slice(0,2):t.email?t.email.charAt(0).toUpperCase():"U",ne=s!=null&&s.avatarId?rt(s.avatarId):null;if(o.useEffect(()=>{console.log("Profile updated in ProfileIcon:",s==null?void 0:s.avatarId)},[s==null?void 0:s.avatarId]),o.useEffect(()=>{const r=async a=>{try{if(!(a!=null&&a.data)||typeof a.data!="object"||a.origin!=="https://cashy.link")return;const{type:w,email:N,refresh_token:x}=a.data||{};w==="cashy_oauth_token"&&(t!=null&&t.uid)&&N&&x&&await _t(t.uid,String(N),String(x))&&f({title:"تم ربط جوجل",description:"تم حفظ توكن النسخ الاحتياطي عبر الخادم."})}catch{}};return window.addEventListener("message",r),()=>window.removeEventListener("message",r)},[t==null?void 0:t.uid]),!t)return null;const Re=async()=>{try{await d()}catch(r){console.error("خطأ في تسجيل الخروج:",r)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[S&&e.jsxs(L,{type:"button",onClick:()=>{k(!0),U(g,b)>0&&y(!0)},title:"تحديث التطبيق",className:"relative inline-flex items-center justify-center w-9 h-9 rounded-md bg-transparent text-blue-600 hover:bg-blue-500/10 focus:outline-none dark:text-blue-400 dark:hover:bg-blue-400/10",variant:"ghost",children:[e.jsx(ot,{className:"w-5 h-5"}),M&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 inline-block w-2 h-2 rounded-full bg-red-500"})]}),e.jsxs(Qe,{children:[e.jsx(Ze,{asChild:!0,children:e.jsx(L,{variant:"ghost",className:`relative h-8 w-8 rounded-full p-0 hover:bg-transparent focus:ring-1 focus:ring-primary focus:ring-offset-1 transition-all duration-200 ${n}`,children:e.jsx(Pe,{className:"h-8 w-8 border border-border shadow-sm hover:shadow-md transition-all duration-200 hover:scale-105 bg-white",children:ne?e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-white dark:bg-neutral-900/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"w-full h-full flex items-center justify-center scale-[2.5]",children:ne.component})}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{src:t.photoURL||void 0,alt:(s==null?void 0:s.fullName)||t.email||"المستخدم",className:"object-cover"}),e.jsx(ke,{className:"bg-gradient-to-br from-indigo-500 via-sky-500 to-emerald-400 text-white font-semibold text-sm tracking-wide uppercase border border-white/70 shadow-md",children:Ue()})]})})})}),e.jsxs(et,{className:"w-64",align:"end",forceMount:!0,children:[e.jsx(tt,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:(s==null?void 0:s.fullName)||"المستخدم"}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:t.email}),(s==null?void 0:s.role)&&e.jsxs("p",{className:"text-xs leading-none text-muted-foreground",children:["الدور: ",s.role==="staff"?"مدير":s.role==="merchant"?"تاجر":"مستخدم"]}),Ae&&e.jsx("div",{className:"mt-2 flex items-center justify-center gap-1 bg-emerald-50 border border-emerald-200 text-emerald-800 text-xs rounded-md py-1",children:e.jsxs("span",{className:"font-semibold",children:["تجربة: ",G," ",G>=3&&G<=10?"ساعات":G===2?"ساعتين":"ساعة"]})})]})}),e.jsx(ae,{}),e.jsxs(X,{onClick:()=>{var r;if(h&&((r=shiftUser==null?void 0:shiftUser.permissions)==null?void 0:r.settings)===!1){f({title:"تم رفض الوصول",description:"ليس لديك صلاحية للوصول إلى هذا القسم. يرجى مراجعة المسؤول.",variant:"destructive"});return}c("/profile-settings")},className:"cursor-pointer",children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"إعدادات البروفيل"})]}),((s==null?void 0:s.role)==="admin"||(s==null?void 0:s.role)==="staff")&&e.jsxs(X,{onClick:()=>c("/admin"),className:"cursor-pointer",children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"لوحة الإدارة"})]}),e.jsx(ae,{}),e.jsxs(X,{onClick:Re,className:"cursor-pointer text-red-600 focus:text-red-600",children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"تسجيل الخروج"})]})]})]})]}),S&&e.jsx(le,{open:B,onOpenChange:r=>{if(!(!r&&D&&M&&U(g,b)>0)&&(k(r),!r&&F<100)){const w=`desktop_update_seen_${String((t==null?void 0:t.uid)||"anon")}`;try{g&&localStorage.setItem(w,g)}catch{}y(!1)}},children:e.jsxs(de,{className:"sm:max-w-md",onInteractOutside:r=>{D&&M&&U(g,b)>0&&r.preventDefault()},onEscapeKeyDown:r=>{D&&M&&U(g,b)>0&&r.preventDefault()},children:[e.jsx(ue,{children:e.jsx(fe,{children:D?"تحديث إجباري مطلوب":"يوجد تحديث جديد للبرنامج"})}),e.jsx("div",{className:"text-sm",children:W?"جارٍ تنزيل التحديث...":M&&U(g,b)>0?"هل ترغب في تنزيله الآن؟":"التطبيق مُحدَّث لآخر إصدار"}),g&&e.jsxs("div",{className:"mt-2 text-xs",children:["الإصدار الجديد: ",e.jsxs("span",{className:"font-semibold",children:["v",g]})]}),b&&e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["إصدار التطبيق لديك: ",e.jsxs("span",{className:"font-semibold",children:["v",b]})]}),v&&e.jsx("div",{className:"mt-2 text-xs text-muted-foreground whitespace-pre-line",children:v}),W&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"w-full h-2 bg-gray-200 rounded",children:e.jsx("div",{className:"h-2 bg-blue-600 rounded",style:{width:`${F}%`}})}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[Math.round(F),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3",children:[!D&&e.jsx(L,{variant:"outline",onClick:()=>{const a=`desktop_update_seen_${String((t==null?void 0:t.uid)||"anon")}`;try{g&&localStorage.setItem(a,g)}catch{}y(!1),k(!1)},children:"إلغاء"}),!W&&F<100&&M&&U(g,b)>0&&e.jsx(L,{className:"bg-blue-600 hover:bg-blue-700",onClick:Le,children:D?"تحديث الآن (إجباري)":"بدء التنزيل"}),F>=100&&e.jsx(L,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{try{if(l!=null&&l.applyUpdate){f({title:"جاري التحديث",description:"سيتم إغلاق التطبيق وتثبيت التحديث فوراً..."});const r=await l.applyUpdate();typeof r=="string"&&r.startsWith("err:")&&f({title:"فشل التحديث",description:r.slice(4),variant:"destructive"})}else if(l!=null&&l.openUpdateFolder){const r=await l.openUpdateFolder();typeof r=="string"&&r.startsWith("err:")?f({title:"تعذر فتح مجلد التحديث",description:r.slice(4),variant:"destructive"}):f({title:"افتح ملف التثبيت",description:"تم فتح مجلد التحديث — اضغط على الملف لتثبيت."})}}catch(r){f({title:"فشل التحديث",description:(r==null?void 0:r.message)||"حدث خطأ غير متوقع",variant:"destructive"})}},children:"تحديث الآن"})]})]})}),e.jsx(yt,{open:m,onOpenChange:u})]})}export{Ot as P};
//# sourceMappingURL=ProfileIcon-CoHGJzAB.js.map
