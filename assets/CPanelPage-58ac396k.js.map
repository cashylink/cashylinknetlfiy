{"version":3,"file":"CPanelPage-58ac396k.js","sources":["../../src/pages/CPanelPage.tsx"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport { Card, CardHeader, CardTitle, CardContent } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\r\nimport { useFirebaseAuth } from \"@/contexts/FirebaseAuthContext\";\r\nimport { functions } from \"@/firebase\";\r\nimport { httpsCallable } from \"firebase/functions\";\r\n\r\nexport default function CPanelPage() {\r\n  const { user, profile, isSubscriptionActive, userSubscription } = useFirebaseAuth();\r\n  const [open, setOpen] = useState(false);\r\n  const [shopName, setShopName] = useState(\"\");\r\n  const [managerName, setManagerName] = useState(\"\");\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [message, setMessage] = useState<string | null>(null);\r\n\r\n  const isBranchPackageActive = userSubscription?.branchPackage?.status === \"active\";\r\n  const canManage = (\r\n    profile?.role === \"admin\" ||\r\n    profile?.role === \"merchant\" ||\r\n    isSubscriptionActive ||\r\n    isBranchPackageActive\r\n  );\r\n\r\n  const resetForm = () => {\r\n    setShopName(\"\");\r\n    setManagerName(\"\");\r\n    setEmail(\"\");\r\n    setPassword(\"\");\r\n  };\r\n\r\n  const handleCreate = async () => {\r\n    setMessage(null);\r\n    if (!canManage) {\r\n      setMessage(\"هذه العملية تتطلب اشتراكًا مفعلًا أو صلاحية مدير/تاجر.\");\r\n      return;\r\n    }\r\n\r\n    if (!shopName || !managerName || !email || !password) {\r\n      setMessage(\"يرجى ملء جميع الحقول المطلوبة.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      const createFn = httpsCallable(functions, \"createShopAndManager\");\r\n      const result: any = await createFn({\r\n        shopName,\r\n        managerName,\r\n        email,\r\n        password,\r\n      });\r\n      const data = result?.data;\r\n      setMessage(\r\n        data?.success\r\n          ? `تم إنشاء المتجر (${data.shopId}) ومدير الحساب بنجاح.`\r\n          : \"فشل إنشاء الحساب، حاول مرة أخرى.\"\r\n      );\r\n      if (data?.success) {\r\n        resetForm();\r\n        setOpen(false);\r\n      }\r\n    } catch (err: any) {\r\n      const msg = err?.message || \"حدث خطأ غير متوقع أثناء الإنشاء\";\r\n      setMessage(msg);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"container mx-auto p-4\">\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>لوحة التحكم (CPanel)</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                إضافة محل جديد مع إنشاء حساب المدير ليتسجل من صفحة الدخول العادية.\r\n              </p>\r\n            </div>\r\n            <Button onClick={() => setOpen(true)} disabled={!canManage}>\r\n              إضافة محل\r\n            </Button>\r\n          </div>\r\n\r\n          {!user && (\r\n            <p className=\"mt-3 text-sm text-red-600\">\r\n              يجب تسجيل الدخول للوصول إلى لوحة التحكم.\r\n            </p>\r\n          )}\r\n          {user && !canManage && (\r\n            <p className=\"mt-3 text-sm text-red-600\">\r\n              حسابك ليس لديه صلاحيات كافية أو اشتراك/باقة فروع مفعّلة لإنشاء المحلات.\r\n              إذا كنت مشتركًا بباقة مدفوعة أو لديك باقة فروع مفعّلة، ستتمكن من إضافة الحسابات مباشرة.\r\n            </p>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <Dialog open={open} onOpenChange={setOpen}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>إضافة محل ومدير</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"grid gap-4 py-2\">\r\n            <div className=\"grid gap-2\">\r\n              <Label htmlFor=\"shopName\">اسم المحل</Label>\r\n              <Input\r\n                id=\"shopName\"\r\n                value={shopName}\r\n                onChange={(e) => setShopName(e.target.value)}\r\n                placeholder=\"مثال: متجر أحمد\"\r\n              />\r\n            </div>\r\n            <div className=\"grid gap-2\">\r\n              <Label htmlFor=\"managerName\">اسم المدير</Label>\r\n              <Input\r\n                id=\"managerName\"\r\n                value={managerName}\r\n                onChange={(e) => setManagerName(e.target.value)}\r\n                placeholder=\"مثال: أحمد علي\"\r\n              />\r\n            </div>\r\n            <div className=\"grid gap-2\">\r\n              <Label htmlFor=\"email\">الإيميل</Label>\r\n              <Input\r\n                id=\"email\"\r\n                type=\"email\"\r\n                value={email}\r\n                onChange={(e) => setEmail(e.target.value)}\r\n                placeholder=\"example@mail.com\"\r\n              />\r\n            </div>\r\n            <div className=\"grid gap-2\">\r\n              <Label htmlFor=\"password\">الباسوورد</Label>\r\n              <Input\r\n                id=\"password\"\r\n                type=\"password\"\r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n                placeholder=\"••••••••\"\r\n              />\r\n            </div>\r\n            {message && (\r\n              <p className=\"text-sm text-muted-foreground\">{message}</p>\r\n            )}\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setOpen(false)} disabled={loading}>\r\n              إلغاء\r\n            </Button>\r\n            <Button onClick={handleCreate} disabled={loading || !canManage}>\r\n              {loading ? \"جاري الإنشاء...\" : \"إنشاء الحساب\"}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}"],"names":["CPanelPage","user","profile","isSubscriptionActive","userSubscription","useFirebaseAuth","open","setOpen","useState","shopName","setShopName","managerName","setManagerName","email","setEmail","password","setPassword","loading","setLoading","message","setMessage","isBranchPackageActive","_a","canManage","resetForm","handleCreate","result","httpsCallable","functions","data","err","msg","jsxs","Card","jsx","CardHeader","CardTitle","CardContent","Button","Dialog","DialogContent","DialogHeader","DialogTitle","Label","Input","e","DialogFooter"],"mappings":"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"}