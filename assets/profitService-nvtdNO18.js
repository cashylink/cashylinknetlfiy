var M=Object.defineProperty;var F=(m,t,e)=>t in m?M(m,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[t]=e;var S=(m,t,e)=>F(m,typeof t!="symbol"?t+"":t,e);import{ac as s,ad as D}from"./index-B_gBGKq7.js";class _{static getProfitPinKey(t){return t?`${this.PROFIT_PIN_KEY_BASE}_${t}`:this.PROFIT_PIN_KEY_BASE}static getMasterPinKey(t){return t?`${this.MASTER_PIN_KEY_BASE}_${t}`:this.MASTER_PIN_KEY_BASE}static setProfitPin(t,e){console.warn("setProfitPin is deprecated. Using master PIN instead.")}static hasProfitPin(t){try{let e=localStorage.getItem(this.getMasterPinKey(t));return(!e||e.length===0)&&t&&(e=localStorage.getItem(this.getMasterPinKey(void 0))),!!e&&e.length>0}catch{return!1}}static verifyProfitPin(t,e){try{let a=localStorage.getItem(this.getMasterPinKey(e));return!a&&e&&(a=localStorage.getItem(this.getMasterPinKey(void 0))),a?atob(a)===t:!1}catch{return!1}}static getProfitData(t){s.autoResetReportsIfNeeded(t);const e=s.getProfits(t),a=this.getWithdrawTransferProfits(t);return{dailyProfit:e.dailyProfit,monthlyProfit:e.monthlyProfit,dailyWithdrawProfit:a.dailyWithdrawProfit,monthlyWithdrawProfit:a.monthlyWithdrawProfit,dailyTransferProfit:a.dailyTransferProfit,monthlyTransferProfit:a.monthlyTransferProfit,lastUpdated:new Date}}static addProfit(t,e){s.addProfit(t,"daily",e),s.addProfit(t,"monthly",e)}static calculateProfitFromTransaction(t){return s.calculateTransactionProfit(t)}static resetProfits(t,e,a){if(!this.verifyProfitPin(e,a))return!1;const c=a?`reportsData_${a}`:"reportsData",l=s.getReportsData(a);if(t==="daily"?(l.dailyProfit=0,l.lastDailyProfitResetDate=new Date):(l.monthlyProfit=0,l.lastMonthlyProfitResetDate=new Date),localStorage.setItem(c,JSON.stringify(l)),a)try{D.updateUserData(a,{reportsData:{...l}})}catch(h){console.warn("تعذر مزامنة تصفير الأرباح مع Firebase:",h)}return!0}static clearProfitPin(t){localStorage.removeItem(this.getProfitPinKey(t))}static updateProfitsFromTransactions(t,e){const a=e?`reportsData_${e}`:"reportsData",c=s.getReportsData(e);let l=0,h=0;const P=new Date,p=P.getMonth(),g=P.getFullYear(),T=s.filterVisibleTransactions(t,"daily",e),u=s.filterVisibleTransactions(t,"monthly",e);if(T.forEach(r=>{const i=String(r.type||r.txnType||"").toLowerCase(),d=String(r.title||"");if(i==="cash_addition"||d.includes("إيصال إضافة نقدية"))return;const y=new Date(r.createdAt);if(String(r.status||"confirmed").toLowerCase(),y.toDateString()!==P.toDateString())return;const n=String(r.type||r.txnType||"").toLowerCase(),w={type:n==="withdrawal"||n==="machine_withdrawal"?"withdraw":n,amount:Number(r.amount||0),commission:r.commission};l+=this.calculateProfitFromTransaction(w)}),u.forEach(r=>{const i=String(r.type||r.txnType||"").toLowerCase(),d=String(r.title||"");if(i==="cash_addition"||d.includes("إيصال إضافة نقدية"))return;const y=new Date(r.createdAt);if(String(r.status||"confirmed").toLowerCase(),y.getMonth()!==p||y.getFullYear()!==g)return;const n=String(r.type||r.txnType||"").toLowerCase(),w={type:n==="withdrawal"||n==="machine_withdrawal"?"withdraw":n,amount:Number(r.amount||0),commission:r.commission};h+=this.calculateProfitFromTransaction(w)}),c.dailyProfit=Math.round(l*100)/100,c.monthlyProfit=Math.round(h*100)/100,localStorage.setItem(a,JSON.stringify(c)),e)try{D.updateUserData(e,{reportsData:{...c}})}catch(r){console.warn("تعذر مزامنة تحديث الأرباح من المعاملات مع Firebase:",r)}}static getWithdrawTransferProfits(t){s.getReportsData(t);const e=new Date,a=e.getMonth(),c=e.getFullYear(),l=`transactions_${t||"default"}`,h=JSON.parse(localStorage.getItem(l)||"[]");let P=0,p=0,g=0,T=0;const u=s.filterVisibleTransactions(h,"daily",t),r=s.filterVisibleTransactions(h,"monthly",t);return u.forEach(i=>{const d=String(i.type||i.txnType||"").toLowerCase(),y=String(i.title||"");if(d==="cash_addition"||y.includes("إيصال إضافة نقدية"))return;const n=new Date(i.createdAt);if(String(i.status||"confirmed").toLowerCase(),n.toDateString()!==e.toDateString())return;const f=String(i.type||i.txnType||"").toLowerCase(),o={type:f==="withdrawal"||f==="machine_withdrawal"?"withdraw":f,amount:Number(i.amount||0),commission:i.commission};o.type==="withdraw"?P+=this.calculateProfitFromTransaction(o):(o.type==="receive"||o.type==="send"||o.type==="transfer")&&(g+=this.calculateProfitFromTransaction(o))}),r.forEach(i=>{const d=String(i.type||i.txnType||"").toLowerCase(),y=String(i.title||"");if(d==="cash_addition"||y.includes("إيصال إضافة نقدية"))return;const n=new Date(i.createdAt);if(String(i.status||"confirmed").toLowerCase(),n.getMonth()!==a||n.getFullYear()!==c)return;const f=String(i.type||i.txnType||"").toLowerCase(),o={type:f==="withdrawal"||f==="machine_withdrawal"?"withdraw":f,amount:Number(i.amount||0),commission:i.commission};o.type==="withdraw"?p+=this.calculateProfitFromTransaction(o):(o.type==="receive"||o.type==="send"||o.type==="transfer")&&(T+=this.calculateProfitFromTransaction(o))}),{dailyWithdrawProfit:Math.round(P*100)/100,monthlyWithdrawProfit:Math.round(p*100)/100,dailyTransferProfit:Math.round(g*100)/100,monthlyTransferProfit:Math.round(T*100)/100}}}S(_,"PROFIT_PIN_KEY_BASE","profit_pin"),S(_,"MASTER_PIN_KEY_BASE","master_pin");export{_ as ProfitService};
//# sourceMappingURL=profitService-nvtdNO18.js.map
