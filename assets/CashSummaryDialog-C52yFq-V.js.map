{"version":3,"file":"CashSummaryDialog-C52yFq-V.js","sources":["../../src/components/CashSummaryDialog.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { DollarSign, Package, ArrowRightLeft, BatteryCharging } from 'lucide-react';\r\nimport { db } from '@/firebase';\r\nimport { useShop } from '@/hooks/useShop';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { collection, getDocs, query, where, doc, updateDoc, getDoc, onSnapshot } from 'firebase/firestore';\r\nimport { reportsService } from '@/utils/reportsService';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\r\nimport { userDataService } from '@/integrations/firebase/services';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\n\r\ninterface CashSummaryDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  userId?: string | null;\r\n  cashBalance: number;\r\n  walletBalances: Record<string, number>;\r\n  transactions: any[];\r\n}\r\n\r\nexport const CashSummaryDialog: React.FC<CashSummaryDialogProps> = ({ open, onOpenChange, userId, cashBalance, walletBalances, transactions }) => {\r\n  const [accessorySalesToday, setAccessorySalesToday] = React.useState(0);\r\n  const [ackAccessoryToday, setAckAccessoryToday] = React.useState(0);\r\n  const [maintenanceTotalToday, setMaintenanceTotalToday] = React.useState(0);\r\n  const [ackMaintenanceToday, setAckMaintenanceToday] = React.useState(0);\r\n  const [machineChargingTotalToday, setMachineChargingTotalToday] = React.useState(0);\r\n  const [ackMachineChargingToday, setAckMachineChargingToday] = React.useState(0);\r\n  const [localCashBalance, setLocalCashBalance] = React.useState<number>(cashBalance || 0);\r\n  const [lastUpdate, setLastUpdate] = React.useState(0);\r\n  const [isReceiptPinOpen, setIsReceiptPinOpen] = React.useState(false);\r\n  const [pendingReceiptType, setPendingReceiptType] = React.useState<'accessory' | 'maintenance' | 'machineCharging' | null>(null);\r\n  const { toast } = useToast();\r\n  const { shopId: shopIdCtx } = useShop() || ({} as any);\r\n  const { user, profile } = useFirebaseAuth();\r\n  const [isDeductReasonOpen, setIsDeductReasonOpen] = React.useState(false);\r\n  const [deductReason, setDeductReason] = React.useState('');\r\n  const [isDeductPinOpen, setIsDeductPinOpen] = React.useState(false);\r\n  const [isDeductAmountOpen, setIsDeductAmountOpen] = React.useState(false);\r\n  const [deductAmount, setDeductAmount] = React.useState('');\r\n\r\n  const getCashBalanceKey = () => `cashBalance_${userId || 'default'}_${(shopIdCtx || (profile as any)?.shopId || 'main')}`;\r\n  const getGenericCashKey = () => `cashBalance_${userId || 'default'}`;\r\n\r\n  const formatCurrency = (n: number) => `${new Intl.NumberFormat('ar-EG', { maximumFractionDigits: 0 }).format(Number(n || 0))} جنيه`;\r\n\r\n  // 1. تحميل فلوس الإكسسوار من dailySales (الرئيسية وتحت المستخدم) مع إزالة التكرار\n  React.useEffect(() => {\n    if (!open || !userId) {\n      if (!open) {\n        setAccessorySalesToday(0);\n        setAckAccessoryToday(0);\n      }\n      return;\n    }\n\n    let cancelled = false;\n\n    const loadAccessorySales = async () => {\n      try {\n        const userDoc = await userDataService.getUserData(userId);\n        const lastReceiptStr = userDoc?.[`lastReceipt_accessory`];\n        const lastReceiptDate = lastReceiptStr ? new Date(lastReceiptStr) : new Date(0);\n        const lastReceiptTime = lastReceiptDate.getTime();\n        const lastReceiptDayStr = lastReceiptDate.toISOString().slice(0, 10);\n\n        const combinedDocs: { id: string; data: any }[] = [];\n\n        try {\n          const qMain = query(\n            collection(db, 'dailySales'),\n            where('userId', '==', userId),\n            ...(shopIdCtx ? [where('shopId', '==', shopIdCtx)] : []),\n            where('date', '>=', lastReceiptDayStr)\n          );\n          const snapMain = await getDocs(qMain);\n          snapMain.forEach(d => {\n            combinedDocs.push({ id: d.id, data: d.data() });\n          });\n        } catch (e) {\n          console.warn('Failed to load top-level dailySales for accessory:', e);\n        }\n\n        try {\n          const snapUser = await getDocs(collection(db, 'users', userId, 'dailySales'));\n          snapUser.forEach(d => {\n            const data = d.data();\n            if (shopIdCtx && data.shopId && data.shopId !== shopIdCtx) return;\n            combinedDocs.push({ id: d.id, data });\n          });\n        } catch (e) {\n          console.warn('Failed to load nested dailySales for accessory:', e);\n        }\n\n        const uniqueDocs = new Map<string, any>();\n        combinedDocs.forEach(item => {\n          const key = String(item.data.clientId || item.id);\n          if (!uniqueDocs.has(key)) {\n            uniqueDocs.set(key, item.data);\n          }\n        });\n\n        let total = 0;\n        uniqueDocs.forEach((d: any) => {\n          if (d.isDeferred) return;\n\n          let createdAt = 0;\n          if (d.createdAt?.toDate) createdAt = d.createdAt.toDate().getTime();\n          else if (d.createdAt instanceof Date) createdAt = d.createdAt.getTime();\n          else if (typeof d.createdAt === 'number') createdAt = d.createdAt;\n          else if (typeof d.createdAt === 'string') createdAt = new Date(d.createdAt).getTime();\n          else if (d.date) {\n            const timeStr = d.time || '00:00';\n            createdAt = new Date(`${d.date}T${timeStr}:00`).getTime();\n          }\n\n          if (!createdAt || createdAt <= lastReceiptTime) return;\n\n          const price = Number(d.sellingPrice ?? d.price ?? 0);\n          const qty = Number(d.quantity ?? d.qty ?? 0);\n          if (price > 0 && qty > 0) {\n            total += price * qty;\n          }\n        });\n\n        if (!cancelled) {\n          setAccessorySalesToday(total);\n          setAckAccessoryToday(0);\n        }\n      } catch (e) {\n        console.warn('Failed to load accessory sales for cash summary:', e);\n        if (!cancelled) {\n          setAccessorySalesToday(0);\n          setAckAccessoryToday(0);\n        }\n      }\n    };\n\n    loadAccessorySales();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [open, userId, shopIdCtx, lastUpdate]);\n\r\n  // 2. Load other data (Maintenance, Machine Charging, Receipts)\r\n  React.useEffect(() => {\r\n    if (!open) return;\r\n\r\n    const loadOtherData = async () => {\r\n      let userDoc: any = {};\r\n      try {\r\n         if (userId) userDoc = await userDataService.getUserData(userId) || {};\r\n      } catch {}\r\n\r\n      // Maintenance\r\n      const loadMaintenanceTotal = async () => {\r\n        try {\r\n          if (!userId) { setMaintenanceTotalToday(0); return; }\r\n          \r\n          const lastReceiptStr = userDoc?.[`lastReceipt_maintenance`];\r\n          const lastReceiptTime = lastReceiptStr ? new Date(lastReceiptStr).getTime() : 0;\r\n\r\n          let snap;\r\n          try {\r\n            const q = query(\r\n              collection(db, 'maintenance_items'),\r\n              where('userId', '==', userId)\r\n            );\r\n            snap = await getDocs(q);\r\n          } catch (e) {\r\n            snap = await getDocs(query(collection(db, 'maintenance_items'), where('userId', '==', userId)));\r\n          }\r\n\r\n          let totalAmount = 0;\r\n          snap.forEach(docSnap => {\r\n            const d: any = docSnap.data();\r\n            const status = (d.status || 'in_progress') as string;\r\n\r\n            let createdAtMs = 0;\r\n            if (d.createdAt?.toDate) {\r\n              createdAtMs = d.createdAt.toDate().getTime();\r\n            } else if (typeof d.createdAt === 'string') {\r\n              createdAtMs = new Date(d.createdAt).getTime();\r\n            }\r\n\r\n            let completedAtMs = 0;\r\n            if (d.completedAt?.toDate) {\r\n              completedAtMs = d.completedAt.toDate().getTime();\r\n            } else if (typeof d.completedAt === 'string') {\r\n              completedAtMs = new Date(d.completedAt).getTime();\r\n            }\r\n\r\n            const referenceTime = status === 'completed'\r\n              ? (completedAtMs || createdAtMs)\r\n              : createdAtMs;\r\n\r\n            if (!referenceTime || referenceTime <= lastReceiptTime) return;\r\n\r\n            let amount = 0;\r\n            const repair = Number(d.repairPrice || 0);\r\n            const partial = d.partialPayment !== undefined ? Number(d.partialPayment) : NaN;\r\n\r\n            if (status === 'completed') {\r\n              if (Number.isFinite(repair) && repair > 0) {\r\n                amount = repair;\r\n              }\r\n            } else if (Number.isFinite(partial) && partial > 0) {\r\n              amount = partial;\r\n            }\r\n\r\n            if (amount > 0) {\r\n              totalAmount += amount;\r\n            }\r\n          });\r\n\r\n          setMaintenanceTotalToday(Math.max(0, totalAmount));\r\n          setAckMaintenanceToday(0);\r\n        } catch (e) {\r\n          console.warn('فشل تحميل إجمالي فلوس الصيانة لليوم:', e);\r\n        }\r\n      };\r\n\r\n      // Machine Charging\r\n      const calculateMachineChargingTotal = async () => {\r\n        try {\r\n            if (!userId) { setMachineChargingTotalToday(0); return; }\r\n            \r\n            const lastReceiptStr = userDoc?.[`lastReceipt_machineCharging`];\r\n            const lastReceiptTime = lastReceiptStr ? new Date(lastReceiptStr).getTime() : 0;\r\n\r\n            const q = query(\r\n              collection(db, 'userTransactions'),\r\n              where('userId', '==', userId)\r\n            );\r\n            const snap = await getDocs(q);\r\n            \r\n            let total = 0;\r\n            snap.forEach(d => {\r\n              const t: any = d.data();\r\n              let tTime = 0;\r\n              if (t.createdAt?.toDate) tTime = t.createdAt.toDate().getTime();\r\n              else if (typeof t.createdAt === 'string') tTime = new Date(t.createdAt).getTime();\r\n              \r\n              if (tTime <= lastReceiptTime) return;\r\n\r\n              const desc = String(t.description || '');\r\n              const rawTitle = String(t.title || '');\r\n              const isMachine = \r\n                t.title === 'إيصال تحويل مكينه' || \r\n                desc.includes('تحويل مكنه') || \r\n                desc.includes('تحويل مكينه') || \r\n                rawTitle.includes('تحويل مكنه') || \r\n                rawTitle.includes('تحويل مكينه');\r\n              \r\n              const isCompleted = t.status === 'completed' || t.status === 'confirmed';\r\n      \r\n              if (isMachine && isCompleted) {\r\n                total += (Number(t.amount) || 0);\r\n              }\r\n            });\r\n            setMachineChargingTotalToday(total);\r\n            setAckMachineChargingToday(0);\r\n        } catch (e) { console.warn(e); }\r\n      };\r\n\r\n      // Daily Receipts & Cash Balance\r\n      const loadDailyReceipts = async () => {\r\n        try {\r\n          if (!userId) { setAckAccessoryToday(0); return; }\r\n          \r\n          try {\r\n            const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n            const snap = await getDoc(doc(db, 'dashboardData', sid));\r\n            if (snap.exists()) {\r\n              const v = Number((snap.data() as any)?.cashBalance || 0);\r\n              setLocalCashBalance(v);\r\n              try { localStorage.setItem(`cashBalance_${userId}`, String(v)); localStorage.setItem(getCashBalanceKey(), String(v)); } catch {}\r\n            } else {\r\n              setLocalCashBalance(Number(userDoc?.cashBalance || cashBalance || 0));\r\n            }\r\n          } catch {\r\n            setLocalCashBalance(Number(userDoc?.cashBalance || cashBalance || 0));\r\n          }\r\n        } catch (e) {\r\n          setAckAccessoryToday(0);\r\n          setAckMaintenanceToday(0);\r\n          setAckMachineChargingToday(0);\r\n        }\r\n      };\r\n\r\n      await loadMaintenanceTotal();\r\n      await calculateMachineChargingTotal();\r\n      await loadDailyReceipts();\r\n    };\r\n\r\n    loadOtherData();\r\n  }, [open, userId, transactions, cashBalance, shopIdCtx, lastUpdate]);\r\n\r\n  React.useEffect(() => {\r\n    const handler = (e: any) => {\r\n      try {\r\n        const v = Number(e?.detail?.value);\r\n        if (Number.isFinite(v)) {\r\n          setLocalCashBalance(v);\r\n        }\r\n      } catch {}\r\n    };\r\n    window.addEventListener('cashBalanceChanged', handler as EventListener);\r\n    return () => window.removeEventListener('cashBalanceChanged', handler as EventListener);\r\n  }, [open]);\r\n\r\n  React.useEffect(() => {\r\n    if (!open || !userId) return;\r\n    const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n    // استبدال onSnapshot بـ getDoc لتقليل القراءات\r\n    const fetchDashboardData = async () => {\r\n      try {\r\n        const snap = await getDoc(doc(db, 'dashboardData', sid));\r\n        if (snap.exists()) {\r\n          const v = Number((snap.data() as any)?.cashBalance || 0);\r\n          setLocalCashBalance(v);\r\n          try { \r\n            localStorage.setItem(`cashBalance_${userId}`, String(v)); \r\n            localStorage.setItem(getCashBalanceKey(), String(v)); \r\n          } catch {}\r\n        }\r\n      } catch (e) {\r\n        console.warn('Error fetching dashboard data:', e);\r\n      }\r\n    };\r\n    \r\n    fetchDashboardData();\r\n    \r\n    return () => { };\r\n  }, [open, userId, shopIdCtx]);\r\n\r\n  const effectiveAccessoryToday = Math.max(0, Number(accessorySalesToday) - Number(ackAccessoryToday));\r\n  const effectiveMaintenanceToday = Math.max(0, Number(maintenanceTotalToday) - Number(ackMaintenanceToday));\r\n  const effectiveMachineChargingToday = Math.max(0, Number(machineChargingTotalToday) - Number(ackMachineChargingToday));\r\n\r\n  const handleReceipt = async (type: 'accessory' | 'maintenance' | 'machineCharging') => {\r\n    if (!userId) return;\r\n    const todayStr = new Date().toISOString().slice(0, 10);\r\n    try {\r\n      let amountToAck = 0;\r\n      if (type === 'accessory') amountToAck = effectiveAccessoryToday;\r\n      else if (type === 'maintenance') amountToAck = effectiveMaintenanceToday;\r\n      else if (type === 'machineCharging') amountToAck = effectiveMachineChargingToday;\r\n\r\n      if (amountToAck <= 0) {\r\n        toast({ title: 'لا يوجد مبلغ لتأكيد استلامه', variant: 'default' });\r\n        return;\r\n      }\r\n      const newCash = Math.max(0, Number(localCashBalance) - amountToAck);\r\n      setLocalCashBalance(newCash);\r\n      \r\n      const now = new Date().toISOString();\r\n      await userDataService.updateUserData(userId, {\r\n        cashBalance: newCash,\r\n        [`lastReceipt_${type}`]: now\r\n      });\r\n\r\n      try {\r\n        const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n        await updateDoc(doc(db, 'dashboardData', sid), { cashBalance: newCash, lastUpdated: new Date().toISOString() } as any);\r\n      } catch { }\r\n      try {\r\n        localStorage.setItem(`cashBalance_${userId}`, String(newCash));\r\n        localStorage.setItem(getCashBalanceKey(), String(newCash));\r\n      } catch {}\r\n      try {\r\n        window.dispatchEvent(new CustomEvent('cashBalanceChanged', { detail: { value: newCash } }));\r\n      } catch {}\r\n\r\n      setLastUpdate(Date.now());\r\n      \r\n      let typeLabel = '';\r\n      if (type === 'accessory') typeLabel = 'الإكسسوار';\r\n      else if (type === 'maintenance') typeLabel = 'الصيانة';\r\n      else typeLabel = 'مكن الشحن';\r\n\r\n      toast({ title: 'تم الاستلام', description: `تم خصم ${amountToAck.toLocaleString('en-US', { maximumFractionDigits: 0 })} من الدرج وتصفير بند ${typeLabel}` });\r\n    } catch (e) {\r\n      toast({ title: 'خطأ', description: 'تعذر تنفيذ عملية تم الاستلام', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  const startDeductionFlow = () => {\r\n    setDeductReason('');\r\n    setDeductAmount('');\r\n    setIsDeductReasonOpen(true);\r\n  };\r\n\r\n  const confirmDeductReason = () => {\r\n    if (!deductReason.trim()) {\r\n      toast({ title: 'سبب الخصم مطلوب', variant: 'destructive' });\r\n      return;\r\n    }\r\n    setIsDeductReasonOpen(false);\r\n    setIsDeductPinOpen(true);\r\n  };\r\n\r\n  const openDeductAmount = () => {\r\n    setIsDeductPinOpen(false);\r\n    setIsDeductAmountOpen(true);\r\n  };\r\n\r\n  const performDeduction = async () => {\r\n    try {\r\n      if (!userId) return;\r\n      const amt = Math.max(0, Number(deductAmount || 0));\r\n      if (!Number.isFinite(amt) || amt <= 0) {\r\n        toast({ title: 'مبلغ غير صالح', description: 'أدخل مبلغ خصم صحيح أكبر من الصفر', variant: 'destructive' });\r\n        return;\r\n      }\r\n      const newCash = Math.max(0, Number(localCashBalance) - amt);\r\n      setLocalCashBalance(newCash);\r\n      await userDataService.updateUserData(userId, { cashBalance: newCash });\r\n      try {\r\n        const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n        await updateDoc(doc(db, 'dashboardData', sid), { cashBalance: newCash, lastUpdated: new Date().toISOString() } as any);\r\n      } catch { }\r\n      try { localStorage.setItem(`cashBalance_${userId}`, String(newCash)); } catch {}\r\n      try {\r\n        const timestamp = new Date().toISOString();\r\n        localStorage.setItem(getCashBalanceKey(), String(newCash));\r\n        localStorage.setItem(getCashBalanceKey() + '_lastUpdated', timestamp);\r\n      } catch {}\r\n\r\n      const tx = {\r\n        title: 'ايصال خصم من الفلوس النقديه',\r\n        type: 'cash_deduction',\r\n        amount: amt,\r\n        status: 'completed',\r\n        createdAt: new Date(),\r\n        note: deductReason,\r\n        cashierName: 'الحساب الرئيسي'\r\n      };\r\n      try { await userDataService.saveUserTransaction(userId, tx); } catch {}\r\n\r\n      toast({ title: 'تم الخصم', description: `تم خصم ${amt.toLocaleString('en-US', { maximumFractionDigits: 0 })} من الدرج` });\r\n      setIsDeductAmountOpen(false);\r\n      setDeductAmount('');\r\n      setDeductReason('');\r\n    } catch (e) {\r\n      toast({ title: 'فشل الخصم', description: 'تعذر تنفيذ عملية الخصم', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-lg animate-in fade-in-90 zoom-in-95 slide-in-from-top-4 bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-800\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right text-gray-900 dark:text-gray-100\">\r\n            <DollarSign className=\"h-5 w-5 text-emerald-600 dark:text-emerald-500\" />\r\n            تفاصيل الفلوس النقدية\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-3\">\r\n          <div className=\"flex items-center justify-between bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-900/50 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-amber-800 dark:text-amber-300 font-bold text-sm\">\r\n              <DollarSign className=\"h-4 w-4\" />\r\n              مجموع الفلوس النقدية (الدرج)\r\n            </div>\r\n            <div className=\"text-amber-700 dark:text-amber-400 font-extrabold text-sm\">\r\n              {formatCurrency(localCashBalance)}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-900/50 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-blue-800 dark:text-blue-300 font-bold text-sm\">\r\n              <Package className=\"h-4 w-4\" />\r\n              فلوس الاكسسوار\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"text-blue-700 dark:text-blue-400 font-extrabold text-sm\">\r\n                {formatCurrency(effectiveAccessoryToday)}\r\n              </div>\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"h-6 px-2 rounded-lg bg-gradient-to-r from-blue-100 to-blue-200 text-blue-700 hover:from-blue-200 hover:to-blue-300 hover:text-blue-800 dark:from-blue-900/50 dark:to-blue-800/50 dark:text-blue-200 dark:hover:from-blue-800 dark:hover:to-blue-700\"\r\n                onClick={() => { setPendingReceiptType('accessory'); setIsReceiptPinOpen(true); }}\r\n              >\r\n                تم الاستلام\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between bg-emerald-50 dark:bg-emerald-950/30 border border-emerald-200 dark:border-emerald-900/50 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-emerald-800 dark:text-emerald-300 font-bold text-sm\">\r\n              <ArrowRightLeft className=\"h-4 w-4\" />\r\n              فلوس الصيانة\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"text-emerald-700 dark:text-emerald-400 font-extrabold text-sm\">\r\n                {formatCurrency(effectiveMaintenanceToday)}\r\n              </div>\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"h-6 px-2 rounded-lg bg-gradient-to-r from-emerald-100 to-emerald-200 text-emerald-700 hover:from-emerald-200 hover:to-emerald-300 hover:text-emerald-800 dark:from-emerald-900/50 dark:to-emerald-800/50 dark:text-emerald-200 dark:hover:from-emerald-800 dark:hover:to-emerald-700\"\r\n                onClick={() => { setPendingReceiptType('maintenance'); setIsReceiptPinOpen(true); }}\r\n              >\r\n                تم الاستلام\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between bg-violet-50 dark:bg-violet-950/30 border border-violet-200 dark:border-violet-900/50 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-violet-800 dark:text-violet-300 font-bold text-sm\">\r\n              <BatteryCharging className=\"h-4 w-4\" />\r\n              مكن الشحن\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"text-violet-700 dark:text-violet-400 font-extrabold text-sm\">\r\n                {formatCurrency(effectiveMachineChargingToday)}\r\n              </div>\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"h-6 px-2 rounded-lg bg-gradient-to-r from-violet-100 to-violet-200 text-violet-700 hover:from-violet-200 hover:to-violet-300 hover:text-violet-800 dark:from-violet-900/50 dark:to-violet-800/50 dark:text-violet-200 dark:hover:from-violet-800 dark:hover:to-violet-700\"\r\n                onClick={() => { setPendingReceiptType('machineCharging'); setIsReceiptPinOpen(true); }}\r\n              >\r\n                تم الاستلام\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          \r\n\r\n          <div className=\"flex items-center justify-between bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-900/50 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-red-800 dark:text-red-300 font-bold text-sm\">\r\n              خصم فلوس من الفلوس النقديه\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"h-6 px-2 rounded-lg bg-gradient-to-r from-red-100 to-red-200 text-red-700 hover:from-red-200 hover:to-red-300 hover:text-red-800 dark:from-red-900/50 dark:to-red-800/50 dark:text-red-200 dark:hover:from-red-800 dark:hover:to-red-700\"\r\n                onClick={startDeductionFlow}\r\n              >\r\n                خصم\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* نافذة الرقم السري لعملية تم الاستلام */}\r\n        <MasterPinDialog\r\n          open={isReceiptPinOpen}\r\n          onOpenChange={setIsReceiptPinOpen}\r\n          mode=\"verify\"\r\n          title=\"تأكيد الرقم السري لعملية تم الاستلام\"\r\n          description=\"يرجى إدخال الرقم السري الرئيسي لتأكيد استلام المبلغ\" \r\n          userId={userId || user?.uid}\r\n          userRole={profile?.role}\r\n          onSuccess={() => {\r\n            if (pendingReceiptType) {\r\n              handleReceipt(pendingReceiptType);\r\n              setPendingReceiptType(null);\r\n            }\r\n            setIsReceiptPinOpen(false);\r\n          }}\r\n        />\r\n\r\n        <Dialog open={isDeductReasonOpen} onOpenChange={setIsDeductReasonOpen}>\r\n          <DialogContent className=\"sm:max-w-sm bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-800\">\r\n            <DialogHeader>\r\n              <DialogTitle className=\"text-gray-900 dark:text-gray-100\">سبب الخصم</DialogTitle>\r\n            </DialogHeader>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"deduct-reason\" className=\"text-gray-900 dark:text-gray-100\">اكتب سبب الخصم</Label>\r\n              <Input \r\n                id=\"deduct-reason\" \r\n                value={deductReason} \r\n                onChange={(e) => setDeductReason(e.target.value)} \r\n                placeholder=\"سبب الخصم\" \r\n                className=\"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100\"\r\n              />\r\n            </div>\r\n            <div className=\"flex justify-end gap-2 mt-3\">\r\n              <Button variant=\"outline\" onClick={() => setIsDeductReasonOpen(false)} className=\"dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-800\">إلغاء</Button>\r\n              <Button onClick={confirmDeductReason} className=\"bg-red-600 hover:bg-red-700 text-white\">متابعة</Button>\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n\r\n        <MasterPinDialog\r\n          open={isDeductPinOpen}\r\n          onOpenChange={setIsDeductPinOpen}\r\n          mode=\"verify\"\r\n          title=\"تأكيد الرقم السري لعملية الخصم\"\r\n          description=\"يرجى إدخال الرقم السري الرئيسي لمتابعة الخصم\"\r\n          userId={userId || user?.uid}\r\n          userRole={profile?.role}\r\n          onSuccess={openDeductAmount}\r\n        />\r\n\r\n        <Dialog open={isDeductAmountOpen} onOpenChange={setIsDeductAmountOpen}>\r\n          <DialogContent className=\"sm:max-w-sm bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-800\">\r\n            <DialogHeader>\r\n              <DialogTitle className=\"text-gray-900 dark:text-gray-100\">مبلغ الخصم</DialogTitle>\r\n            </DialogHeader>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"deduct-amount\" className=\"text-gray-900 dark:text-gray-100\">أدخل مبلغ الخصم</Label>\r\n              <Input \r\n                id=\"deduct-amount\" \r\n                type=\"number\" \r\n                value={deductAmount} \r\n                onChange={(e) => setDeductAmount(e.target.value)} \r\n                placeholder=\"0.00\" \r\n                className=\"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100\"\r\n              />\r\n            </div>\r\n            <div className=\"flex justify-end gap-2 mt-3\">\r\n              <Button variant=\"outline\" onClick={() => setIsDeductAmountOpen(false)} className=\"dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-800\">إلغاء</Button>\r\n              <Button onClick={performDeduction} className=\"bg-red-600 hover:bg-red-700 text-white\">تأكيد الخصم</Button>\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default CashSummaryDialog;\r\n"],"names":["CashSummaryDialog","open","onOpenChange","userId","cashBalance","walletBalances","transactions","accessorySalesToday","setAccessorySalesToday","React","ackAccessoryToday","setAckAccessoryToday","maintenanceTotalToday","setMaintenanceTotalToday","ackMaintenanceToday","setAckMaintenanceToday","machineChargingTotalToday","setMachineChargingTotalToday","ackMachineChargingToday","setAckMachineChargingToday","localCashBalance","setLocalCashBalance","lastUpdate","setLastUpdate","isReceiptPinOpen","setIsReceiptPinOpen","pendingReceiptType","setPendingReceiptType","toast","useToast","shopIdCtx","useShop","user","profile","useFirebaseAuth","isDeductReasonOpen","setIsDeductReasonOpen","deductReason","setDeductReason","isDeductPinOpen","setIsDeductPinOpen","isDeductAmountOpen","setIsDeductAmountOpen","deductAmount","setDeductAmount","getCashBalanceKey","formatCurrency","n","cancelled","userDoc","userDataService","lastReceiptStr","lastReceiptDate","lastReceiptTime","lastReceiptDayStr","combinedDocs","qMain","query","collection","db","where","getDocs","e","d","data","uniqueDocs","item","key","total","createdAt","_a","timeStr","price","qty","loadMaintenanceTotal","snap","q","totalAmount","docSnap","status","createdAtMs","completedAtMs","_b","referenceTime","amount","repair","partial","calculateMachineChargingTotal","t","tTime","desc","rawTitle","isMachine","isCompleted","loadDailyReceipts","sid","getDoc","doc","v","handler","effectiveAccessoryToday","effectiveMaintenanceToday","effectiveMachineChargingToday","handleReceipt","type","amountToAck","newCash","now","updateDoc","typeLabel","startDeductionFlow","confirmDeductReason","openDeductAmount","performDeduction","amt","timestamp","tx","jsx","Dialog","DialogContent","DialogHeader","jsxs","DialogTitle","DollarSign","Package","Button","ArrowRightLeft","BatteryCharging","MasterPinDialog","Label","Input"],"mappings":"8nCAwBO,MAAMA,GAAsD,CAAC,CAAE,KAAAC,EAAM,aAAAC,GAAc,OAAAC,EAAQ,YAAAC,EAAa,eAAAC,GAAgB,aAAAC,MAAmB,CAChJ,KAAM,CAACC,GAAqBC,CAAsB,EAAIC,EAAM,SAAS,CAAC,EAChE,CAACC,GAAmBC,CAAoB,EAAIF,EAAM,SAAS,CAAC,EAC5D,CAACG,GAAuBC,CAAwB,EAAIJ,EAAM,SAAS,CAAC,EACpE,CAACK,GAAqBC,EAAsB,EAAIN,EAAM,SAAS,CAAC,EAChE,CAACO,GAA2BC,EAA4B,EAAIR,EAAM,SAAS,CAAC,EAC5E,CAACS,GAAyBC,EAA0B,EAAIV,EAAM,SAAS,CAAC,EACxE,CAACW,EAAkBC,CAAmB,EAAIZ,EAAM,SAAiBL,GAAe,CAAC,EACjF,CAACkB,GAAYC,EAAa,EAAId,EAAM,SAAS,CAAC,EAC9C,CAACe,GAAkBC,CAAmB,EAAIhB,EAAM,SAAS,EAAK,EAC9D,CAACiB,GAAoBC,CAAqB,EAAIlB,EAAM,SAAiE,IAAI,EACzH,CAAE,MAAAmB,CAAA,EAAUC,GAAA,EACZ,CAAE,OAAQC,GAAcC,GAAA,GAAc,CAAA,EACtC,CAAE,KAAAC,EAAM,QAAAC,CAAA,EAAYC,GAAA,EACpB,CAACC,GAAoBC,CAAqB,EAAI3B,EAAM,SAAS,EAAK,EAClE,CAAC4B,EAAcC,CAAe,EAAI7B,EAAM,SAAS,EAAE,EACnD,CAAC8B,GAAiBC,CAAkB,EAAI/B,EAAM,SAAS,EAAK,EAC5D,CAACgC,GAAoBC,CAAqB,EAAIjC,EAAM,SAAS,EAAK,EAClE,CAACkC,GAAcC,CAAe,EAAInC,EAAM,SAAS,EAAE,EAEnDoC,EAAoB,IAAM,eAAe1C,GAAU,SAAS,IAAK2B,IAAcG,GAAA,YAAAA,EAAiB,SAAU,MAAO,GAGjHa,EAAkBC,GAAc,GAAG,IAAI,KAAK,aAAa,QAAS,CAAE,sBAAuB,CAAA,CAAG,EAAE,OAAO,OAAOA,GAAK,CAAC,CAAC,CAAC,QAG5HtC,EAAM,UAAU,IAAM,CACpB,GAAI,CAACR,GAAQ,CAACE,EAAQ,CACfF,IACHO,EAAuB,CAAC,EACxBG,EAAqB,CAAC,GAExB,MACF,CAEA,IAAIqC,EAAY,GAkFhB,OAhF2B,SAAY,CACrC,GAAI,CACF,MAAMC,EAAU,MAAMC,EAAgB,YAAY/C,CAAM,EAClDgD,EAAiBF,GAAA,YAAAA,EAAU,sBAC3BG,EAAkBD,EAAiB,IAAI,KAAKA,CAAc,EAAI,IAAI,KAAK,CAAC,EACxEE,EAAkBD,EAAgB,QAAA,EAClCE,EAAoBF,EAAgB,YAAA,EAAc,MAAM,EAAG,EAAE,EAE7DG,EAA4C,CAAA,EAElD,GAAI,CACF,MAAMC,EAAQC,EACZC,EAAWC,EAAI,YAAY,EAC3BC,EAAM,SAAU,KAAMzD,CAAM,EAC5B,GAAI2B,EAAY,CAAC8B,EAAM,SAAU,KAAM9B,CAAS,CAAC,EAAI,CAAA,EACrD8B,EAAM,OAAQ,KAAMN,CAAiB,CAAA,GAEtB,MAAMO,EAAQL,CAAK,GAC3B,QAAQ,GAAK,CACpBD,EAAa,KAAK,CAAE,GAAI,EAAE,GAAI,KAAM,EAAE,KAAA,EAAQ,CAChD,CAAC,CACH,OAASO,EAAG,CACV,QAAQ,KAAK,qDAAsDA,CAAC,CACtE,CAEA,GAAI,EACe,MAAMD,EAAQH,EAAWC,EAAI,QAASxD,EAAQ,YAAY,CAAC,GACnE,QAAQ4D,GAAK,CACpB,MAAMC,EAAOD,EAAE,KAAA,EACXjC,GAAakC,EAAK,QAAUA,EAAK,SAAWlC,GAChDyB,EAAa,KAAK,CAAE,GAAIQ,EAAE,GAAI,KAAAC,EAAM,CACtC,CAAC,CACH,OAASF,EAAG,CACV,QAAQ,KAAK,kDAAmDA,CAAC,CACnE,CAEA,MAAMG,MAAiB,IACvBV,EAAa,QAAQW,GAAQ,CAC3B,MAAMC,EAAM,OAAOD,EAAK,KAAK,UAAYA,EAAK,EAAE,EAC3CD,EAAW,IAAIE,CAAG,GACrBF,EAAW,IAAIE,EAAKD,EAAK,IAAI,CAEjC,CAAC,EAED,IAAIE,EAAQ,EACZH,EAAW,QAASF,GAAW,OAC7B,GAAIA,EAAE,WAAY,OAElB,IAAIM,EAAY,EAChB,IAAIC,EAAAP,EAAE,YAAF,MAAAO,EAAa,OAAQD,EAAYN,EAAE,UAAU,OAAA,EAAS,QAAA,UACjDA,EAAE,qBAAqB,KAAMM,EAAYN,EAAE,UAAU,QAAA,UACrD,OAAOA,EAAE,WAAc,WAAsBA,EAAE,kBAC/C,OAAOA,EAAE,WAAc,SAAUM,EAAY,IAAI,KAAKN,EAAE,SAAS,EAAE,QAAA,UACnEA,EAAE,KAAM,CACf,MAAMQ,EAAUR,EAAE,MAAQ,QAC1BM,EAAY,IAAI,KAAK,GAAGN,EAAE,IAAI,IAAIQ,CAAO,KAAK,EAAE,QAAA,CAClD,CAEA,GAAI,CAACF,GAAaA,GAAahB,EAAiB,OAEhD,MAAMmB,EAAQ,OAAOT,EAAE,cAAgBA,EAAE,OAAS,CAAC,EAC7CU,EAAM,OAAOV,EAAE,UAAYA,EAAE,KAAO,CAAC,EACvCS,EAAQ,GAAKC,EAAM,IACrBL,GAASI,EAAQC,EAErB,CAAC,EAEIzB,IACHxC,EAAuB4D,CAAK,EAC5BzD,EAAqB,CAAC,EAE1B,OAASmD,EAAG,CACV,QAAQ,KAAK,mDAAoDA,CAAC,EAC7Dd,IACHxC,EAAuB,CAAC,EACxBG,EAAqB,CAAC,EAE1B,CACF,GAEA,EAEO,IAAM,CACXqC,EAAY,EACd,CACF,EAAG,CAAC/C,EAAME,EAAQ2B,EAAWR,EAAU,CAAC,EAGxCb,EAAM,UAAU,IAAM,CACpB,GAAI,CAACR,EAAM,QAEW,SAAY,CAChC,IAAIgD,EAAe,CAAA,EACnB,GAAI,CACG9C,IAAQ8C,EAAU,MAAMC,EAAgB,YAAY/C,CAAM,GAAK,CAAA,EACtE,MAAQ,CAAC,CAGT,MAAMuE,EAAuB,SAAY,CACvC,GAAI,CACF,GAAI,CAACvE,EAAQ,CAAEU,EAAyB,CAAC,EAAG,MAAQ,CAEpD,MAAMsC,EAAiBF,GAAA,YAAAA,EAAU,wBAC3BI,EAAkBF,EAAiB,IAAI,KAAKA,CAAc,EAAE,UAAY,EAE9E,IAAIwB,EACJ,GAAI,CACF,MAAMC,EAAInB,EACRC,EAAWC,EAAI,mBAAmB,EAClCC,EAAM,SAAU,KAAMzD,CAAM,CAAA,EAE9BwE,EAAO,MAAMd,EAAQe,CAAC,CACxB,MAAY,CACVD,EAAO,MAAMd,EAAQJ,EAAMC,EAAWC,EAAI,mBAAmB,EAAGC,EAAM,SAAU,KAAMzD,CAAM,CAAC,CAAC,CAChG,CAEA,IAAI0E,EAAc,EAClBF,EAAK,QAAQG,GAAW,WACtB,MAAMf,EAASe,EAAQ,KAAA,EACjBC,EAAUhB,EAAE,QAAU,cAE5B,IAAIiB,EAAc,GACdV,GAAAP,EAAE,YAAF,MAAAO,GAAa,OACfU,EAAcjB,EAAE,UAAU,OAAA,EAAS,QAAA,EAC1B,OAAOA,EAAE,WAAc,WAChCiB,EAAc,IAAI,KAAKjB,EAAE,SAAS,EAAE,QAAA,GAGtC,IAAIkB,EAAgB,GAChBC,GAAAnB,EAAE,cAAF,MAAAmB,GAAe,OACjBD,EAAgBlB,EAAE,YAAY,OAAA,EAAS,QAAA,EAC9B,OAAOA,EAAE,aAAgB,WAClCkB,EAAgB,IAAI,KAAKlB,EAAE,WAAW,EAAE,QAAA,GAG1C,MAAMoB,EAAgBJ,IAAW,aAC5BE,GAAiBD,EAGtB,GAAI,CAACG,GAAiBA,GAAiB9B,EAAiB,OAExD,IAAI+B,EAAS,EACb,MAAMC,EAAS,OAAOtB,EAAE,aAAe,CAAC,EAClCuB,EAAUvB,EAAE,iBAAmB,OAAY,OAAOA,EAAE,cAAc,EAAI,IAExEgB,IAAW,YACT,OAAO,SAASM,CAAM,GAAKA,EAAS,IACtCD,EAASC,GAEF,OAAO,SAASC,CAAO,GAAKA,EAAU,IAC/CF,EAASE,GAGPF,EAAS,IACXP,GAAeO,EAEnB,CAAC,EAEDvE,EAAyB,KAAK,IAAI,EAAGgE,CAAW,CAAC,EACjD9D,GAAuB,CAAC,CAC1B,OAAS+C,EAAG,CACV,QAAQ,KAAK,uCAAwCA,CAAC,CACxD,CACF,EAGMyB,EAAgC,SAAY,CAChD,GAAI,CACA,GAAI,CAACpF,EAAQ,CAAEc,GAA6B,CAAC,EAAG,MAAQ,CAExD,MAAMkC,EAAiBF,GAAA,YAAAA,EAAU,4BAC3BI,EAAkBF,EAAiB,IAAI,KAAKA,CAAc,EAAE,UAAY,EAExEyB,EAAInB,EACRC,EAAWC,EAAI,kBAAkB,EACjCC,EAAM,SAAU,KAAMzD,CAAM,CAAA,EAExBwE,EAAO,MAAMd,EAAQe,CAAC,EAE5B,IAAIR,EAAQ,EACZO,EAAK,QAAQZ,GAAK,OAChB,MAAMyB,EAASzB,EAAE,KAAA,EACjB,IAAI0B,EAAQ,EAIZ,IAHInB,EAAAkB,EAAE,YAAF,MAAAlB,EAAa,OAAQmB,EAAQD,EAAE,UAAU,OAAA,EAAS,QAAA,EAC7C,OAAOA,EAAE,WAAc,WAAUC,EAAQ,IAAI,KAAKD,EAAE,SAAS,EAAE,QAAA,GAEpEC,GAASpC,EAAiB,OAE9B,MAAMqC,EAAO,OAAOF,EAAE,aAAe,EAAE,EACjCG,EAAW,OAAOH,EAAE,OAAS,EAAE,EAC/BI,EACJJ,EAAE,QAAU,qBACZE,EAAK,SAAS,YAAY,GAC1BA,EAAK,SAAS,aAAa,GAC3BC,EAAS,SAAS,YAAY,GAC9BA,EAAS,SAAS,aAAa,EAE3BE,EAAcL,EAAE,SAAW,aAAeA,EAAE,SAAW,YAEzDI,GAAaC,IACfzB,GAAU,OAAOoB,EAAE,MAAM,GAAK,EAElC,CAAC,EACDvE,GAA6BmD,CAAK,EAClCjD,GAA2B,CAAC,CAChC,OAAS2C,EAAG,CAAE,QAAQ,KAAKA,CAAC,CAAG,CACjC,EAGMgC,EAAoB,SAAY,OACpC,GAAI,CACF,GAAI,CAAC3F,EAAQ,CAAEQ,EAAqB,CAAC,EAAG,MAAQ,CAEhD,GAAI,CACF,MAAMoF,EAAOjE,IAAcG,GAAA,YAAAA,EAAiB,SAAU,OAChD0C,EAAO,MAAMqB,GAAOC,EAAItC,EAAI,gBAAiBoC,CAAG,CAAC,EACvD,GAAIpB,EAAK,SAAU,CACjB,MAAMuB,EAAI,SAAQ5B,EAAAK,EAAK,KAAA,IAAL,YAAAL,EAAqB,cAAe,CAAC,EACvDjD,EAAoB6E,CAAC,EACrB,GAAI,CAAE,aAAa,QAAQ,eAAe/F,CAAM,GAAI,OAAO+F,CAAC,CAAC,EAAG,aAAa,QAAQrD,EAAA,EAAqB,OAAOqD,CAAC,CAAC,CAAG,MAAQ,CAAC,CACjI,MACE7E,EAAoB,QAAO4B,GAAA,YAAAA,EAAS,cAAe7C,GAAe,CAAC,CAAC,CAExE,MAAQ,CACNiB,EAAoB,QAAO4B,GAAA,YAAAA,EAAS,cAAe7C,GAAe,CAAC,CAAC,CACtE,CACF,MAAY,CACVO,EAAqB,CAAC,EACtBI,GAAuB,CAAC,EACxBI,GAA2B,CAAC,CAC9B,CACF,EAEA,MAAMuD,EAAA,EACN,MAAMa,EAAA,EACN,MAAMO,EAAA,CACR,GAEA,CACF,EAAG,CAAC7F,EAAME,EAAQG,GAAcF,EAAa0B,EAAWR,EAAU,CAAC,EAEnEb,EAAM,UAAU,IAAM,CACpB,MAAM0F,EAAWrC,GAAW,OAC1B,GAAI,CACF,MAAMoC,EAAI,QAAO5B,EAAAR,GAAA,YAAAA,EAAG,SAAH,YAAAQ,EAAW,KAAK,EAC7B,OAAO,SAAS4B,CAAC,GACnB7E,EAAoB6E,CAAC,CAEzB,MAAQ,CAAC,CACX,EACA,cAAO,iBAAiB,qBAAsBC,CAAwB,EAC/D,IAAM,OAAO,oBAAoB,qBAAsBA,CAAwB,CACxF,EAAG,CAAClG,CAAI,CAAC,EAETQ,EAAM,UAAU,IAAM,CACpB,GAAI,CAACR,GAAQ,CAACE,EAAQ,OACtB,MAAM4F,EAAOjE,IAAcG,GAAA,YAAAA,EAAiB,SAAU,OAkBtD,OAhB2B,SAAY,OACrC,GAAI,CACF,MAAM0C,EAAO,MAAMqB,GAAOC,EAAItC,EAAI,gBAAiBoC,CAAG,CAAC,EACvD,GAAIpB,EAAK,SAAU,CACjB,MAAMuB,EAAI,SAAQ5B,EAAAK,EAAK,KAAA,IAAL,YAAAL,EAAqB,cAAe,CAAC,EACvDjD,EAAoB6E,CAAC,EACrB,GAAI,CACF,aAAa,QAAQ,eAAe/F,CAAM,GAAI,OAAO+F,CAAC,CAAC,EACvD,aAAa,QAAQrD,EAAA,EAAqB,OAAOqD,CAAC,CAAC,CACrD,MAAQ,CAAC,CACX,CACF,OAASpC,EAAG,CACV,QAAQ,KAAK,iCAAkCA,CAAC,CAClD,CACF,GAEA,EAEO,IAAM,CAAE,CACjB,EAAG,CAAC7D,EAAME,EAAQ2B,CAAS,CAAC,EAE5B,MAAMsE,GAA0B,KAAK,IAAI,EAAG,OAAO7F,EAAmB,EAAI,OAAOG,EAAiB,CAAC,EAC7F2F,GAA4B,KAAK,IAAI,EAAG,OAAOzF,EAAqB,EAAI,OAAOE,EAAmB,CAAC,EACnGwF,GAAgC,KAAK,IAAI,EAAG,OAAOtF,EAAyB,EAAI,OAAOE,EAAuB,CAAC,EAE/GqF,GAAgB,MAAOC,GAA0D,CACrF,GAAKrG,EACC,KAAe,KAAA,EAAO,cAAc,MAAM,EAAG,EAAE,EACrD,GAAI,CACF,IAAIsG,EAAc,EAKlB,GAJID,IAAS,YAAaC,EAAcL,GAC/BI,IAAS,cAAeC,EAAcJ,GACtCG,IAAS,oBAAmBC,EAAcH,IAE/CG,GAAe,EAAG,CACpB7E,EAAM,CAAE,MAAO,8BAA+B,QAAS,UAAW,EAClE,MACF,CACA,MAAM8E,EAAU,KAAK,IAAI,EAAG,OAAOtF,CAAgB,EAAIqF,CAAW,EAClEpF,EAAoBqF,CAAO,EAE3B,MAAMC,EAAM,IAAI,KAAA,EAAO,YAAA,EACvB,MAAMzD,EAAgB,eAAe/C,EAAQ,CAC3C,YAAauG,EACb,CAAC,eAAeF,CAAI,EAAE,EAAGG,CAAA,CAC1B,EAED,GAAI,CACF,MAAMZ,EAAOjE,IAAcG,GAAA,YAAAA,EAAiB,SAAU,OACtD,MAAM2E,GAAUX,EAAItC,EAAI,gBAAiBoC,CAAG,EAAG,CAAE,YAAaW,EAAS,YAAa,IAAI,KAAA,EAAO,YAAA,EAAsB,CACvH,MAAQ,CAAE,CACV,GAAI,CACF,aAAa,QAAQ,eAAevG,CAAM,GAAI,OAAOuG,CAAO,CAAC,EAC7D,aAAa,QAAQ7D,EAAA,EAAqB,OAAO6D,CAAO,CAAC,CAC3D,MAAQ,CAAC,CACT,GAAI,CACF,OAAO,cAAc,IAAI,YAAY,qBAAsB,CAAE,OAAQ,CAAE,MAAOA,CAAA,CAAQ,CAAG,CAAC,CAC5F,MAAQ,CAAC,CAETnF,GAAc,KAAK,KAAK,EAExB,IAAIsF,EAAY,GACZL,IAAS,YAAaK,EAAY,YAC7BL,IAAS,cAAeK,EAAY,UACxCA,EAAY,YAEjBjF,EAAM,CAAE,MAAO,cAAe,YAAa,UAAU6E,EAAY,eAAe,QAAS,CAAE,sBAAuB,EAAG,CAAC,wBAAwBI,CAAS,GAAI,CAC7J,MAAY,CACVjF,EAAM,CAAE,MAAO,MAAO,YAAa,+BAAgC,QAAS,cAAe,CAC7F,EACF,EAEMkF,GAAqB,IAAM,CAC/BxE,EAAgB,EAAE,EAClBM,EAAgB,EAAE,EAClBR,EAAsB,EAAI,CAC5B,EAEM2E,GAAsB,IAAM,CAChC,GAAI,CAAC1E,EAAa,OAAQ,CACxBT,EAAM,CAAE,MAAO,kBAAmB,QAAS,cAAe,EAC1D,MACF,CACAQ,EAAsB,EAAK,EAC3BI,EAAmB,EAAI,CACzB,EAEMwE,GAAmB,IAAM,CAC7BxE,EAAmB,EAAK,EACxBE,EAAsB,EAAI,CAC5B,EAEMuE,GAAmB,SAAY,CACnC,GAAI,CACF,GAAI,CAAC9G,EAAQ,OACb,MAAM+G,EAAM,KAAK,IAAI,EAAG,OAAOvE,IAAgB,CAAC,CAAC,EACjD,GAAI,CAAC,OAAO,SAASuE,CAAG,GAAKA,GAAO,EAAG,CACrCtF,EAAM,CAAE,MAAO,gBAAiB,YAAa,mCAAoC,QAAS,cAAe,EACzG,MACF,CACA,MAAM8E,EAAU,KAAK,IAAI,EAAG,OAAOtF,CAAgB,EAAI8F,CAAG,EAC1D7F,EAAoBqF,CAAO,EAC3B,MAAMxD,EAAgB,eAAe/C,EAAQ,CAAE,YAAauG,EAAS,EACrE,GAAI,CACF,MAAMX,EAAOjE,IAAcG,GAAA,YAAAA,EAAiB,SAAU,OACtD,MAAM2E,GAAUX,EAAItC,EAAI,gBAAiBoC,CAAG,EAAG,CAAE,YAAaW,EAAS,YAAa,IAAI,KAAA,EAAO,YAAA,EAAsB,CACvH,MAAQ,CAAE,CACV,GAAI,CAAE,aAAa,QAAQ,eAAevG,CAAM,GAAI,OAAOuG,CAAO,CAAC,CAAG,MAAQ,CAAC,CAC/E,GAAI,CACF,MAAMS,EAAY,IAAI,KAAA,EAAO,YAAA,EAC7B,aAAa,QAAQtE,EAAA,EAAqB,OAAO6D,CAAO,CAAC,EACzD,aAAa,QAAQ7D,IAAsB,eAAgBsE,CAAS,CACtE,MAAQ,CAAC,CAET,MAAMC,EAAK,CACT,MAAO,8BACP,KAAM,iBACN,OAAQF,EACR,OAAQ,YACR,cAAe,KACf,KAAM7E,EACN,YAAa,gBAAA,EAEf,GAAI,CAAE,MAAMa,EAAgB,oBAAoB/C,EAAQiH,CAAE,CAAG,MAAQ,CAAC,CAEtExF,EAAM,CAAE,MAAO,WAAY,YAAa,UAAUsF,EAAI,eAAe,QAAS,CAAE,sBAAuB,CAAA,CAAG,CAAC,YAAa,EACxHxE,EAAsB,EAAK,EAC3BE,EAAgB,EAAE,EAClBN,EAAgB,EAAE,CACpB,MAAY,CACVV,EAAM,CAAE,MAAO,YAAa,YAAa,yBAA0B,QAAS,cAAe,CAC7F,CACF,EAEA,OACEyF,EAAAA,IAACC,GAAO,KAAArH,EAAY,aAAAC,GAClB,gBAACqH,EAAA,CAAc,UAAU,kIAAkI,IAAI,MAC7J,SAAA,CAAAF,MAACG,EAAA,CACC,SAAAC,EAAAA,KAACC,EAAA,CAAY,UAAU,sEACrB,SAAA,CAAAL,EAAAA,IAACM,GAAA,CAAW,UAAU,gDAAA,CAAiD,EAAE,uBAAA,CAAA,CAE3E,CAAA,CACF,EAEAF,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,qIACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,+EACb,SAAA,CAAAJ,EAAAA,IAACM,GAAA,CAAW,UAAU,SAAA,CAAU,EAAE,8BAAA,EAEpC,QACC,MAAA,CAAI,UAAU,4DACZ,SAAA7E,EAAe1B,CAAgB,CAAA,CAClC,CAAA,EACF,EAEAqG,EAAAA,KAAC,MAAA,CAAI,UAAU,iIACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,6EACb,SAAA,CAAAJ,EAAAA,IAACO,GAAA,CAAQ,UAAU,SAAA,CAAU,EAAE,gBAAA,EAEjC,EACAH,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAJ,MAAC,MAAA,CAAI,UAAU,0DACZ,SAAAvE,EAAesD,EAAuB,EACzC,EACAiB,EAAAA,IAACQ,EAAA,CACC,KAAK,KACL,QAAQ,QACR,UAAU,sPACV,QAAS,IAAM,CAAElG,EAAsB,WAAW,EAAGF,EAAoB,EAAI,CAAG,EACjF,SAAA,aAAA,CAAA,CAED,CAAA,CACF,CAAA,EACF,EAEAgG,EAAAA,KAAC,MAAA,CAAI,UAAU,6IACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,mFACb,SAAA,CAAAJ,EAAAA,IAACS,GAAA,CAAe,UAAU,SAAA,CAAU,EAAE,cAAA,EAExC,EACAL,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAJ,MAAC,MAAA,CAAI,UAAU,gEACZ,SAAAvE,EAAeuD,EAAyB,EAC3C,EACAgB,EAAAA,IAACQ,EAAA,CACC,KAAK,KACL,QAAQ,QACR,UAAU,uRACV,QAAS,IAAM,CAAElG,EAAsB,aAAa,EAAGF,EAAoB,EAAI,CAAG,EACnF,SAAA,aAAA,CAAA,CAED,CAAA,CACF,CAAA,EACF,EAEAgG,EAAAA,KAAC,MAAA,CAAI,UAAU,yIACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,iFACb,SAAA,CAAAJ,EAAAA,IAACU,GAAA,CAAgB,UAAU,SAAA,CAAU,EAAE,WAAA,EAEzC,EACAN,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAJ,MAAC,MAAA,CAAI,UAAU,8DACZ,SAAAvE,EAAewD,EAA6B,EAC/C,EACAe,EAAAA,IAACQ,EAAA,CACC,KAAK,KACL,QAAQ,QACR,UAAU,4QACV,QAAS,IAAM,CAAElG,EAAsB,iBAAiB,EAAGF,EAAoB,EAAI,CAAG,EACvF,SAAA,aAAA,CAAA,CAED,CAAA,CACF,CAAA,EACF,EAIAgG,EAAAA,KAAC,MAAA,CAAI,UAAU,6HACb,SAAA,CAAAJ,EAAAA,IAAC,MAAA,CAAI,UAAU,2EAA2E,SAAA,6BAE1F,EACAA,EAAAA,IAAC,MAAA,CAAI,UAAU,0BACb,SAAAA,EAAAA,IAACQ,EAAA,CACC,KAAK,KACL,QAAQ,QACR,UAAU,2OACV,QAASf,GACV,SAAA,KAAA,CAAA,CAED,CACF,CAAA,CAAA,CACF,CAAA,EACF,EAGAO,EAAAA,IAACW,GAAA,CACC,KAAMxG,GACN,aAAcC,EACd,KAAK,SACL,MAAM,uCACN,YAAY,sDACZ,OAAQtB,IAAU6B,GAAA,YAAAA,EAAM,KACxB,SAAUC,GAAA,YAAAA,EAAS,KACnB,UAAW,IAAM,CACXP,KACF6E,GAAc7E,EAAkB,EAChCC,EAAsB,IAAI,GAE5BF,EAAoB,EAAK,CAC3B,CAAA,CAAA,EAGF4F,EAAAA,IAACC,GAAO,KAAMnF,GAAoB,aAAcC,EAC9C,SAAAqF,EAAAA,KAACF,EAAA,CAAc,UAAU,6EACvB,SAAA,CAAAF,EAAAA,IAACG,GACC,SAAAH,EAAAA,IAACK,EAAA,CAAY,UAAU,mCAAmC,qBAAS,CAAA,CACrE,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAJ,MAACY,GAAA,CAAM,QAAQ,gBAAgB,UAAU,mCAAmC,SAAA,iBAAc,EAC1FZ,EAAAA,IAACa,GAAA,CACC,GAAG,gBACH,MAAO7F,EACP,SAAWyB,GAAMxB,EAAgBwB,EAAE,OAAO,KAAK,EAC/C,YAAY,YACZ,UAAU,iGAAA,CAAA,CACZ,EACF,EACA2D,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAJ,EAAAA,IAACQ,EAAA,CAAO,QAAQ,UAAU,QAAS,IAAMzF,EAAsB,EAAK,EAAG,UAAU,iEAAiE,SAAA,OAAA,CAAK,QACtJyF,EAAA,CAAO,QAASd,GAAqB,UAAU,yCAAyC,SAAA,QAAA,CAAM,CAAA,CAAA,CACjG,CAAA,CAAA,CACF,CAAA,CACF,EAEAM,EAAAA,IAACW,GAAA,CACC,KAAMzF,GACN,aAAcC,EACd,KAAK,SACL,MAAM,iCACN,YAAY,+CACZ,OAAQrC,IAAU6B,GAAA,YAAAA,EAAM,KACxB,SAAUC,GAAA,YAAAA,EAAS,KACnB,UAAW+E,EAAA,CAAA,EAGbK,EAAAA,IAACC,GAAO,KAAM7E,GAAoB,aAAcC,EAC9C,SAAA+E,EAAAA,KAACF,EAAA,CAAc,UAAU,6EACvB,SAAA,CAAAF,EAAAA,IAACG,GACC,SAAAH,EAAAA,IAACK,EAAA,CAAY,UAAU,mCAAmC,sBAAU,CAAA,CACtE,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAJ,MAACY,GAAA,CAAM,QAAQ,gBAAgB,UAAU,mCAAmC,SAAA,kBAAe,EAC3FZ,EAAAA,IAACa,GAAA,CACC,GAAG,gBACH,KAAK,SACL,MAAOvF,GACP,SAAWmB,GAAMlB,EAAgBkB,EAAE,OAAO,KAAK,EAC/C,YAAY,OACZ,UAAU,iGAAA,CAAA,CACZ,EACF,EACA2D,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAJ,EAAAA,IAACQ,EAAA,CAAO,QAAQ,UAAU,QAAS,IAAMnF,EAAsB,EAAK,EAAG,UAAU,iEAAiE,SAAA,OAAA,CAAK,QACtJmF,EAAA,CAAO,QAASZ,GAAkB,UAAU,yCAAyC,SAAA,aAAA,CAAW,CAAA,CAAA,CACnG,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,CAEJ"}