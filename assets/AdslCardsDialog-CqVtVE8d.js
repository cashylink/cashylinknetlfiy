import{u as Ge,m as Ke,r as i,q as ge,aG as he,s as L,t as f,T as ee,V as w,j as e,af as A,ag as P,ai as I,aH as O,B as x,au as We,C as se,I as p,a2 as _e,P as Ve,U as ue,aI as ae,M as Xe,at as fe,ah as B,y as b,ar as M,E as D,D as pe,aJ as be,aK as Ye,a0 as Qe}from"./index-CZwBW8vR.js";import{T as Ze}from"./textarea---GTGD5h.js";import{T as es,a as ss,b as je,c as z,d as as,e as H}from"./table-CDVWZ-zt.js";import{W as te,H as ts,P as rs}from"./wifi-DvA5dCu9.js";import{B as U}from"./SimCardsAccessDialog-DcM4jv_g.js";import{S as Ne}from"./tabs-CAePOU2u.js";import{S as ns}from"./save-BUsX5Y5v.js";import"./select-C1gLQVXw.js";import"./index-hfObMVTV.js";function us({isOpen:q,onClose:re,shopId:ve}){const{user:t}=Ge(),{toast:d}=Ke(),[v,y]=i.useState([]),[we,$]=i.useState(!0),[R,ye]=i.useState(""),[u,J]=i.useState("all"),[ke,T]=i.useState(!1),[G,ne]=i.useState(null),[K,le]=i.useState(!1),[r,j]=i.useState({name:"",simNumber:"",lineNumber:"",agent:"",whatsappNumber:"",callsPackage:"",internetPackage:"",adslPackage:"",totalAmount:"",remainingAmount:"",nationalId:"",isPaid:!1,notes:""}),[Ce,F]=i.useState(!1),[E,De]=i.useState(null),[W,ie]=i.useState(""),[de,oe]=i.useState(""),[Se,S]=i.useState(!1),[_,ce]=i.useState(!1),[Ae,Pe]=i.useState([]),[V,Ie]=i.useState(""),[X,$e]=i.useState(()=>{const s=new Date,a=s.getFullYear(),l=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return`${a}-${l}-${n}`}),[k,me]=i.useState("day");i.useEffect(()=>{if(!(t!=null&&t.uid))return;const s=`adslCards_${t.uid}`;try{const n=localStorage.getItem(s);n&&(y(JSON.parse(n)),$(!1))}catch(n){console.warn("Error loading adsl cards from localStorage",n)}if(!q)return;$(!0);const a=ge(L(f,"adslCards"),he("userId","==",t.uid)),l=ee(a,n=>{const c=n.docs.map(h=>({id:h.id,...h.data()})).sort((h,o)=>{var m,C;const g=((m=h.createdAt)==null?void 0:m.seconds)||0;return(((C=o.createdAt)==null?void 0:C.seconds)||0)-g});y(c);try{localStorage.setItem(s,JSON.stringify(c))}catch{}$(!1)},n=>{console.error("Error fetching ADSL cards:",n),d({title:"خطأ",description:"تعذّر تحميل البيانات. تأكد من الصلاحيات والاتصال.",variant:"destructive"}),$(!1)});return()=>l()},[t==null?void 0:t.uid,q]);const Y=s=>{s?(ne(s),j({name:s.name,simNumber:s.simNumber,lineNumber:s.lineNumber,agent:s.agent||"",whatsappNumber:s.whatsappNumber||"",callsPackage:s.callsPackage,internetPackage:s.internetPackage,adslPackage:s.adslPackage||"",totalAmount:s.totalAmount.toString(),remainingAmount:s.remainingAmount.toString(),nationalId:s.nationalId||"",isPaid:s.isPaid||!1,notes:s.notes||""})):(ne(null),j({name:"",simNumber:"",lineNumber:"",agent:"",whatsappNumber:"",callsPackage:"",internetPackage:"",adslPackage:"",totalAmount:"",remainingAmount:"",nationalId:"",isPaid:!1,notes:""})),T(!0)},Re=async()=>{if(console.log("handleSave started"),!(t!=null&&t.uid)){const s="لم يتم العثور على بيانات المستخدم";d({title:"خطأ",description:s,variant:"destructive"}),alert(s);return}if(!r.name.trim()){const s="يرجى إدخال الاسم";d({title:"خطأ",description:s,variant:"destructive"}),alert(s);return}if(!r.lineNumber.trim()){const s="يرجى إدخال رقم الخط";d({title:"خطأ",description:s,variant:"destructive"}),alert(s);return}le(!0);try{const s={name:r.name,simNumber:r.simNumber||"",lineNumber:r.lineNumber,agent:r.agent||"",whatsappNumber:r.whatsappNumber||"",callsPackage:r.callsPackage||"",internetPackage:r.internetPackage||"",adslPackage:r.adslPackage||"",totalAmount:parseFloat(r.totalAmount)||0,remainingAmount:parseFloat(r.remainingAmount)||0,nationalId:r.nationalId||"",isPaid:r.isPaid||!1,notes:r.notes,userId:t.uid,shopId:ve||t.uid,updatedAt:D()};console.log("Saving card data:",s),G?(await M(w(f,"adslCards",G.id),s),d({title:"تم التحديث",description:"تم تحديث بيانات الاشتراك بنجاح"})):(await pe(L(f,"adslCards"),{...s,createdAt:D()}),d({title:"تم الإضافة",description:"تم إضافة الاشتراك الجديد بنجاح"})),T(!1)}catch(s){console.error("Error saving ADSL card:",s),d({title:"خطأ",description:`حدث خطأ أثناء الحفظ: ${s.message}`,variant:"destructive"}),alert(`حدث خطأ أثناء الحفظ: ${s.message}`)}finally{le(!1)}},Te=async s=>{if(confirm("هل أنت متأكد من حذف هذا الاشتراك؟"))try{await be(w(f,"adslCards",s)),d({title:"تم الحذف",description:"تم حذف الاشتراك بنجاح"})}catch(a){console.error(a),d({title:"خطأ",description:"فشل الحذف",variant:"destructive"})}},Q=async(s,a)=>{y(l=>l.map(n=>n.id===s.id?{...n,isPaid:a,isDeferred:!1}:n));try{await M(w(f,"adslCards",s.id),{isPaid:a,isDeferred:!1,updatedAt:D()}),a&&await pe(L(f,"adslReceipts"),{cardId:s.id,cardName:s.name,amount:s.totalAmount,userId:t==null?void 0:t.uid,createdAt:D(),type:"payment"}),d({title:"تم التحديث",description:a?"تم تحديد الاشتراك كمدفوع وتم تسجيل إيصال":"تم تحديد الاشتراك كغير مدفوع"})}catch(l){y(n=>n.map(c=>c.id===s.id?{...c,isPaid:!a,isDeferred:s.isDeferred}:c)),console.error(l),d({title:"خطأ",description:"حدث خطأ أثناء تحديث الحالة",variant:"destructive"})}},Fe=s=>{var a;De(s),ie(s.name||""),oe(((a=s.totalAmount)==null?void 0:a.toString())||""),F(!0)},Ee=async()=>{if(!(t!=null&&t.uid)||!E)return;if(!W.trim()){d({title:"خطأ",description:"يرجى إدخال اسم العميل",variant:"destructive"});return}const s=parseFloat(de);if(isNaN(s)||s<=0){d({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}try{const a=w(f,"users",t.uid),n=(await Qe(a)).data(),c=Array.isArray(n==null?void 0:n.debts)?n.debts:[],h={id:`DEBT-${Date.now()}`,debtorName:W,mobile:E.lineNumber,amount:s,reason:"تمن تسديد باقة ADSL",status:"pending",createdAt:new Date,paidAmount:0,partialPayments:[]};await M(a,{debts:[h,...c]}),y(o=>o.map(g=>g.id===E.id?{...g,isPaid:!1,isDeferred:!0,debtId:h.id}:g)),await M(w(f,"adslCards",E.id),{isPaid:!1,isDeferred:!0,debtId:h.id,updatedAt:D()}),d({title:"تم الإضافة",description:"تم إضافة الدين وتأجيل الاشتراك"}),F(!1)}catch(a){console.error(a),d({title:"خطأ",description:"حدث خطأ أثناء حفظ الدين",variant:"destructive"})}};i.useEffect(()=>{if(!(t!=null&&t.uid))return;const s=w(f,"users",t.uid),a=ee(s,async l=>{if(l.exists()){const c=l.data().debts||[],h=v.filter(o=>o.isDeferred&&!o.isPaid);for(const o of h){let g=!1;if(o.debtId){const N=c.find(m=>m.id===o.debtId);N&&N.status==="paid"&&(g=!0)}else c.find(m=>m.status==="paid"&&m.reason==="تمن تسديد باقة ADSL"&&(m.mobile&&m.mobile===o.lineNumber||!m.mobile&&m.debtorName===o.name&&Math.abs(m.amount-o.totalAmount)<.1))&&(g=!0);g&&await Q(o,!0)}}});return()=>a()},[t==null?void 0:t.uid,v]);const xe=v.filter(s=>{const a=s.name.toLowerCase().includes(R.toLowerCase())||s.lineNumber.includes(R)||s.simNumber.includes(R),l=u==="all"?!0:u==="paid"?s.isPaid:u==="unpaid"?!s.isPaid&&!s.isDeferred:u==="deferred"?s.isDeferred:!0;return a&&l}),Le=v.filter(s=>s.isPaid).length,Oe=v.filter(s=>!s.isPaid&&!s.isDeferred).length,Be=v.filter(s=>s.isDeferred).length,Me=async()=>{S(!0)},ze=async()=>{if(t!=null&&t.uid)try{const s=Ye(f);v.forEach(a=>{if(a.isPaid){const l=w(f,"adslCards",a.id);s.update(l,{isPaid:!1,updatedAt:D()})}}),await s.commit(),y(a=>a.map(l=>({...l,isPaid:!1}))),d({title:"تم التحديث",description:"تم تحويل جميع الاشتراكات إلى غير مدفوع بنجاح"}),S(!1)}catch(s){console.error("Error resetting cards:",s),d({title:"خطأ",description:"حدث خطأ أثناء تحديث الاشتراكات",variant:"destructive"}),S(!1)}},He=async s=>{if(confirm(`هل أنت متأكد من حذف هذا الإيصال؟
سيتم حذف المبلغ من السجل نهائياً.`))try{await be(w(f,"adslReceipts",s)),d({title:"تم الحذف",description:"تم حذف الإيصال بنجاح"})}catch(a){console.error(a),d({title:"خطأ",description:"فشل حذف الإيصال",variant:"destructive"})}};i.useEffect(()=>{if(!_||!(t!=null&&t.uid))return;const s=ge(L(f,"adslReceipts"),he("userId","==",t.uid)),a=ee(s,l=>{const n=l.docs.map(c=>({id:c.id,...c.data()}));n.sort((c,h)=>{var N,m;const o=((N=c.createdAt)==null?void 0:N.seconds)||Math.floor(Date.now()/1e3);return(((m=h.createdAt)==null?void 0:m.seconds)||Math.floor(Date.now()/1e3))-o}),Pe(n)},l=>{console.error("Error fetching receipts:",l),d({title:"خطأ",description:"فشل تحميل السجل",variant:"destructive"})});return()=>a()},[_,t==null?void 0:t.uid]);const Z=Ae.filter(s=>{var N;if(V.trim()){const m=V.toLowerCase(),C=v.find(Je=>Je.id===s.cardId),Ue=s.cardName.toLowerCase().includes(m),qe=C?C.lineNumber.includes(m)||C.simNumber.includes(m):!1;return Ue||qe}const a=(N=s.createdAt)!=null&&N.seconds?s.createdAt.seconds*1e3:Date.now(),l=new Date(a),[n,c,h]=X.split("-").map(Number),o=new Date(n,c-1,h),g=new Date(n,c-1,h);return k==="day"?(o.setHours(0,0,0,0),g.setHours(23,59,59,999)):(o.setDate(1),o.setHours(0,0,0,0),g.setMonth(g.getMonth()+1),g.setDate(0),g.setHours(23,59,59,999)),l>=o&&l<=g});return e.jsxs(e.Fragment,{children:[e.jsx(A,{open:q,onOpenChange:s=>!s&&re(),children:e.jsxs(P,{className:"max-w-screen w-screen h-screen flex flex-col p-0 gap-0 bg-gray-50 dark:bg-gray-900 rounded-none border-0",children:[e.jsxs("div",{className:"p-3 border-b bg-white dark:bg-gray-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 dark:bg-blue-900/30 rounded-full text-blue-600",children:e.jsx(te,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"text-base font-bold",children:"إدارة ADSL"}),e.jsx(O,{className:"text-xs",children:"سجل ومتابعة اشتراكات ADSL"})]})]}),e.jsx(x,{onClick:()=>re(),variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(We,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 p-2 bg-gray-50/50 dark:bg-gray-900/50 border-b",children:[e.jsxs("div",{onClick:()=>J(u==="paid"?"all":"paid"),className:`cursor-pointer rounded-md border py-1.5 px-2 flex flex-row items-center justify-center gap-2 transition-all hover:shadow-sm ${u==="paid"?"bg-green-100 border-green-300 ring-1 ring-green-500 ring-offset-1 dark:ring-offset-gray-900":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-green-300"}`,children:[e.jsx("div",{className:`p-1 rounded-full ${u==="paid"?"bg-green-200":"bg-green-100"} text-green-700`,children:e.jsx(U,{className:"h-3.5 w-3.5"})}),e.jsxs("div",{className:"flex items-center gap-1.5 leading-none",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-600 dark:text-gray-400",children:"المدفوعة"}),e.jsx("div",{className:"text-sm font-bold text-green-600",children:Le})]})]}),e.jsxs("div",{onClick:()=>J(u==="unpaid"?"all":"unpaid"),className:`cursor-pointer rounded-md border py-1.5 px-2 flex flex-row items-center justify-center gap-2 transition-all hover:shadow-sm ${u==="unpaid"?"bg-red-100 border-red-300 ring-1 ring-red-500 ring-offset-1 dark:ring-offset-gray-900":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-red-300"}`,children:[e.jsx("div",{className:`p-1 rounded-full ${u==="unpaid"?"bg-red-200":"bg-red-100"} text-red-700`,children:e.jsx(se,{className:"h-3.5 w-3.5"})}),e.jsxs("div",{className:"flex items-center gap-1.5 leading-none",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-600 dark:text-gray-400",children:"غير المدفوعة"}),e.jsx("div",{className:"text-sm font-bold text-red-600",children:Oe})]})]}),e.jsxs("div",{onClick:()=>J(u==="deferred"?"all":"deferred"),className:`cursor-pointer rounded-md border py-1.5 px-2 flex flex-row items-center justify-center gap-2 transition-all hover:shadow-sm ${u==="deferred"?"bg-orange-100 border-orange-300 ring-1 ring-orange-500 ring-offset-1 dark:ring-offset-gray-900":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-orange-300"}`,children:[e.jsx("div",{className:`p-1 rounded-full ${u==="deferred"?"bg-orange-200":"bg-orange-100"} text-orange-700`,children:e.jsx(se,{className:"h-3.5 w-3.5"})}),e.jsxs("div",{className:"flex items-center gap-1.5 leading-none",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-600 dark:text-gray-400",children:"مؤجلة الدفع"}),e.jsx("div",{className:"text-sm font-bold text-orange-600",children:Be})]})]})]}),e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 border-b flex flex-col md:flex-row gap-3 justify-between items-center",children:[e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(Ne,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(p,{placeholder:"بحث بالاسم أو الرقم...",value:R,onChange:s=>ye(s.target.value),className:"pr-9"})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs(x,{onClick:()=>ce(!0),variant:"outline",className:"flex-1 md:flex-none gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"سجل السداد"]}),e.jsxs(x,{onClick:()=>Y(),className:"flex-1 md:flex-none bg-blue-600 hover:bg-blue-700 text-white gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),"إضافة اشتراك جديد"]}),e.jsxs(x,{onClick:Me,variant:"destructive",className:"flex-1 md:flex-none gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"تحويل الكل لغير مدفوع"]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:we?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):xe.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(te,{className:"h-12 w-12 mb-3 opacity-20"}),e.jsx("p",{children:"لا توجد اشتراكات مسجلة"}),e.jsx(x,{variant:"link",onClick:()=>Y(),className:"text-blue-600",children:"إضافة أول اشتراك"})]}):e.jsx("div",{className:"flex flex-col gap-3",children:xe.map(s=>e.jsx("div",{className:`rounded-xl shadow-sm border p-3 hover:shadow-md transition-shadow ${s.isDeferred?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800":s.isPaid?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"}`,children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto md:min-w-[200px]",children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center font-bold text-sm ${s.isDeferred?"bg-orange-100 text-orange-700 dark:bg-orange-800 dark:text-orange-100":s.isPaid?"bg-green-100 text-green-700 dark:bg-green-800 dark:text-green-100":"bg-red-100 text-red-700 dark:bg-red-800 dark:text-red-100"}`,children:s.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-gray-100 text-sm",children:s.name}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(Ve,{className:"h-3 w-3"}),e.jsx("span",{dir:"ltr",children:s.lineNumber})]})]})]}),e.jsxs("div",{className:"flex-1 w-full grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-x-4 gap-y-2 text-xs",children:[s.nationalId&&e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-500 text-[10px] flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3"})," القومي"]}),e.jsx("span",{className:"font-mono font-medium truncate",children:s.nationalId})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-500 text-[10px] flex items-center gap-1",children:[e.jsx(ts,{className:"h-3 w-3"})," سريل الشريحه"]}),e.jsx("span",{className:"font-mono font-medium",children:s.simNumber||"-"})]}),s.agent&&e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-500 text-[10px] flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3"})," الوكيل"]}),e.jsx("span",{className:"font-medium",children:s.agent})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-500 text-[10px] flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3"})," اسم الباقة"]}),e.jsx("span",{className:"font-medium",children:s.adslPackage||"-"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-500 text-[10px] flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"})," سعر الباقة"]}),e.jsx("span",{className:"font-bold text-gray-900",children:ae(s.totalAmount)})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full md:w-auto items-center",children:[s.whatsappNumber&&e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8 text-green-600 hover:bg-green-50",onClick:()=>{const a=`مرحباً ${s.name}،
تذكير بموعد دفع اشتراك الانترنت الأرضي الخاص بك.
المبلغ المطلوب: ${s.totalAmount} جنيه.
شكراً لك!`,l=`https://wa.me/2${s.whatsappNumber}?text=${encodeURIComponent(a)}`;window.open(l,"_blank")},title:"إرسال تذكير واتساب",children:e.jsx(Xe,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex bg-white/50 rounded-lg p-1 gap-1 shadow-sm",children:[e.jsx(x,{size:"sm",className:`h-7 px-2 text-xs font-bold ${s.isPaid?"bg-green-600 hover:bg-green-700 text-white":"bg-white text-green-600 border border-green-200 hover:bg-green-50"}`,onClick:()=>Q(s,!0),children:"مدفوع"}),e.jsx(x,{size:"sm",variant:"destructive",className:`h-7 px-2 text-xs font-bold ${!s.isPaid&&!s.isDeferred?"bg-red-600 hover:bg-red-700 text-white":"bg-white text-red-600 border border-red-200 hover:bg-red-50"}`,onClick:()=>Q(s,!1),children:"غير"}),e.jsx(x,{size:"sm",variant:"outline",className:`h-7 px-2 text-xs font-bold ${s.isDeferred?"bg-orange-600 hover:bg-orange-700 text-white":"text-orange-600 border-orange-200 hover:bg-orange-50"}`,onClick:()=>Fe(s),children:"أجل"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-600 hover:bg-blue-50",onClick:()=>Y(s),children:e.jsx(rs,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 hover:bg-red-50",onClick:()=>Te(s.id),children:e.jsx(fe,{className:"h-4 w-4"})})]})]})]})},s.id))})})]})}),e.jsx(A,{open:_,onOpenChange:ce,children:e.jsxs(P,{className:"max-w-2xl h-[80vh] flex flex-col p-0",children:[e.jsxs(B,{className:"p-4 border-b",children:[e.jsx(I,{children:"سجل سداد ADSL"}),e.jsx(O,{children:"عرض إيصالات السداد حسب التاريخ"})]}),e.jsxs("div",{className:"p-4 border-b bg-gray-50 flex flex-col gap-4",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx(Ne,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(p,{placeholder:"بحث في السجل بالاسم أو الرقم...",value:V,onChange:s=>Ie(s.target.value),className:"pr-9 bg-white"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-end w-full",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(b,{children:"نوع البحث"}),e.jsxs("div",{className:"flex bg-white rounded-md border p-1",children:[e.jsx("button",{onClick:()=>me("day"),className:`flex-1 px-3 py-1.5 text-sm rounded-sm transition-colors ${k==="day"?"bg-blue-100 text-blue-700 font-medium":"text-gray-600 hover:bg-gray-50"}`,children:"يومي"}),e.jsx("button",{onClick:()=>me("month"),className:`flex-1 px-3 py-1.5 text-sm rounded-sm transition-colors ${k==="month"?"bg-blue-100 text-blue-700 font-medium":"text-gray-600 hover:bg-gray-50"}`,children:"شهري"})]})]}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(b,{children:k==="day"?"اختر اليوم":"اختر الشهر"}),e.jsx(p,{type:k==="day"?"date":"month",value:k==="day"?X:X.substring(0,7),onChange:s=>$e(s.target.value),className:"bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-500 mb-1",children:"إجمالي الفترة"}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:ae(Z.reduce((s,a)=>s+(a.amount||0),0))})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-0 relative",children:Z.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-500",children:[e.jsx(U,{className:"h-12 w-12 mb-2 opacity-20"}),e.jsx("p",{children:"لا توجد عمليات سداد في هذه الفترة"})]}):e.jsxs(es,{children:[e.jsx(ss,{className:"sticky top-0 bg-white z-10 shadow-sm",children:e.jsxs(je,{children:[e.jsx(z,{className:"text-right",children:"التاريخ"}),e.jsx(z,{className:"text-right",children:"اسم الاشتراك"}),e.jsx(z,{className:"text-right",children:"المبلغ"}),e.jsx(z,{className:"w-[50px]"})]})}),e.jsx(as,{children:Z.map(s=>{var a;return e.jsxs(je,{children:[e.jsx(H,{className:"font-mono text-xs text-gray-500",children:(a=s.createdAt)!=null&&a.seconds?new Date(s.createdAt.seconds*1e3).toLocaleString("ar-EG"):"الآن"}),e.jsx(H,{className:"font-medium",children:s.cardName}),e.jsx(H,{className:"font-bold text-green-600",children:ae(s.amount)}),e.jsx(H,{children:e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 hover:bg-red-50",onClick:()=>He(s.id),children:e.jsx(fe,{className:"h-4 w-4"})})})]},s.id)})})]})})]})}),e.jsx(A,{open:Se,onOpenChange:S,children:e.jsxs(P,{className:"max-w-md",children:[e.jsxs(B,{children:[e.jsx(I,{children:"تأكيد التحويل"}),e.jsxs(O,{children:['هل أنت متأكد من تحويل جميع الاشتراكات إلى "غير مدفوع"؟',e.jsx("br",{}),"سيتم تغيير حالة الدفع لجميع الاشتراكات المسجلة."]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(x,{variant:"outline",onClick:()=>S(!1),children:"إلغاء"}),e.jsx(x,{variant:"destructive",onClick:ze,children:"نعم، تحويل الكل"})]})]})}),e.jsx(A,{open:ke,onOpenChange:T,children:e.jsxs(P,{className:"max-w-md",children:[e.jsx(B,{children:e.jsx(I,{children:G?"تعديل بيانات الاشتراك":"إضافة اشتراك جديد"})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"الاسم"}),e.jsx(p,{value:r.name,onChange:s=>j({...r,name:s.target.value}),placeholder:"اسم العميل أو صاحب الخط"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"سريل الشريحه"}),e.jsx(p,{value:r.simNumber,onChange:s=>j({...r,simNumber:s.target.value}),placeholder:"سريل الشريحه..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"رقم الخط"}),e.jsx(p,{value:r.lineNumber,onChange:s=>j({...r,lineNumber:s.target.value}),placeholder:"0xxxxxxxx",dir:"ltr"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"الوكيل"}),e.jsx(p,{value:r.agent,onChange:s=>j({...r,agent:s.target.value}),placeholder:"اسم الوكيل..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"اسم الباقة"}),e.jsx(p,{value:r.adslPackage,onChange:s=>j({...r,adslPackage:s.target.value}),placeholder:"مثال: 140 جيجا"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"سعر الباقة"}),e.jsx(p,{type:"number",value:r.totalAmount,onChange:s=>j({...r,totalAmount:s.target.value}),placeholder:"0.00"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"رقم وتساب"}),e.jsx(p,{value:r.whatsappNumber,onChange:s=>j({...r,whatsappNumber:s.target.value}),placeholder:"01xxxxxxxxx",dir:"ltr"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"ملاحظات (اختياري)"}),e.jsx(Ze,{value:r.notes,onChange:s=>j({...r,notes:s.target.value}),placeholder:"أي ملاحظات إضافية...",className:"resize-none"})]}),e.jsxs("div",{className:"pt-4 flex gap-2",children:[e.jsx(x,{className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",onClick:Re,disabled:K,children:K?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}),"جاري الحفظ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"h-4 w-4 ml-2"}),"حفظ"]})}),e.jsx(x,{variant:"outline",onClick:()=>T(!1),disabled:K,children:"إلغاء"})]})]})]})}),e.jsx(A,{open:Ce,onOpenChange:F,children:e.jsxs(P,{className:"max-w-sm",children:[e.jsxs(B,{children:[e.jsx(I,{children:"تسجيل معاملة آجل"}),e.jsx(O,{children:"سيتم إضافة المبلغ للديون المستحقة"})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"اسم العميل"}),e.jsx(p,{value:W,onChange:s=>ie(s.target.value),placeholder:"اسم العميل..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"المبلغ"}),e.jsx(p,{type:"number",value:de,onChange:s=>oe(s.target.value),placeholder:"0.00"})]}),e.jsxs("div",{className:"pt-2 flex gap-2",children:[e.jsx(x,{className:"flex-1 bg-orange-600 hover:bg-orange-700 text-white",onClick:Ee,children:"تأكيد الأجل"}),e.jsx(x,{variant:"outline",onClick:()=>F(!1),children:"إلغاء"})]})]})]})})]})}export{us as AdslCardsDialog};
//# sourceMappingURL=AdslCardsDialog-CqVtVE8d.js.map
