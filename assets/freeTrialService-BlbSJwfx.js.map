{"version":3,"file":"freeTrialService-BlbSJwfx.js","sources":["../../src/utils/freeTrialService.ts"],"sourcesContent":["import { doc, updateDoc, serverTimestamp, getDoc, setDoc } from 'firebase/firestore';\r\nimport { db } from '@/firebase';\r\nimport { isSubscriptionValid } from '@/utils/subscriptionService';\r\n\r\nexport interface FreeTrialData {\r\n  hasUsedFreeTrial: boolean;\r\n  freeTrialStartDate: Date | null;\r\n  freeTrialEndDate: Date | null;\r\n  isOnFreeTrial: boolean;\r\n}\r\n\r\nexport class FreeTrialService {\r\n  private static readonly TRIAL_DURATION_HOURS = 24;\r\n\r\n  /**\r\n   * بدء التجربة المجانية من لوحة الإدارة مع مدة مخصصة\r\n   */\r\n  static async startFreeTrialFromAdmin(userId: string): Promise<{ success: boolean; message: string }> {\r\n    try {\r\n      const userRef = doc(db, 'users', userId);\r\n      const userDoc = await getDoc(userRef);\r\n      \r\n      if (!userDoc.exists()) {\r\n        return { success: false, message: 'المستخدم غير موجود' };\r\n      }\r\n\r\n      const userData = userDoc.data();\r\n      \r\n      // التحقق من حالة تجربة سابقة بشكل متساهل: إذا كان العلم موجودًا بدون تواريخ، اعتبرها غير مُفعّلة\r\n      const hasUsed = !!userData.hasUsedFreeTrial;\r\n      const startExisting = userData.freeTrialStartDate?.toDate?.() ? userData.freeTrialStartDate.toDate() : (userData.freeTrialStartDate ? new Date(userData.freeTrialStartDate as any) : null);\r\n      const endExisting = userData.freeTrialEndDate?.toDate?.() ? userData.freeTrialEndDate.toDate() : (userData.freeTrialEndDate ? new Date(userData.freeTrialEndDate as any) : null);\r\n      const inconsistent = hasUsed && !startExisting && !endExisting;\r\n      if (hasUsed && !inconsistent) {\r\n        return { success: false, message: 'لقد استخدم هذا المستخدم التجربة المجانية من قبل' };\r\n      }\r\n\r\n      // حساب تاريخ انتهاء التجربة المجانية (المدة الديناميكية)\r\n      const startDate = new Date();\r\n      const hours = await this.getTrialDurationHours();\r\n      const endDate = new Date(startDate.getTime() + hours * 60 * 60 * 1000);\r\n\r\n      await setDoc(userRef, {\r\n        hasUsedFreeTrial: true,\r\n        freeTrialStartDate: startDate,\r\n        freeTrialEndDate: endDate,\r\n        isOnFreeTrial: true,\r\n        isActive: true, // تفعيل الحساب مع التجربة المجانية\r\n        approved: true, // الموافقة التلقائية للتجربة المجانية\r\n        updatedAt: serverTimestamp()\r\n      }, { merge: true });\r\n\r\n      return { \r\n        success: true, \r\n        message: `تم تفعيل التجربة المجانية لمدة ${hours} ${hours >= 3 && hours <= 10 ? 'ساعات' : hours === 2 ? 'ساعتين' : 'ساعة'}` \r\n      };\r\n    } catch (error) {\r\n      console.error('Error starting admin free trial:', error);\r\n      return { success: false, message: 'حدث خطأ أثناء تفعيل التجربة المجانية' };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * بدء التجربة المجانية للمستخدم مع الموافقة التلقائية\r\n   */\r\n  static async startFreeTrial(userId: string): Promise<{ success: boolean; message: string }> {\r\n    try {\r\n      const userRef = doc(db, 'users', userId);\r\n      const userDoc = await getDoc(userRef);\r\n      \r\n      if (!userDoc.exists()) {\r\n        return { success: false, message: 'المستخدم غير موجود' };\r\n      }\r\n\r\n      const userData = userDoc.data();\r\n      \r\n      // التحقق من حالة تجربة سابقة بشكل متساهل: إذا كان العلم موجودًا بدون تواريخ، اعتبرها غير مُفعّلة\r\n      const hasUsed = !!userData.hasUsedFreeTrial;\r\n      const startExisting = userData.freeTrialStartDate?.toDate?.() ? userData.freeTrialStartDate.toDate() : (userData.freeTrialStartDate ? new Date(userData.freeTrialStartDate as any) : null);\r\n      const endExisting = userData.freeTrialEndDate?.toDate?.() ? userData.freeTrialEndDate.toDate() : (userData.freeTrialEndDate ? new Date(userData.freeTrialEndDate as any) : null);\r\n      const inconsistent = hasUsed && !startExisting && !endExisting;\r\n      if (hasUsed && !inconsistent) {\r\n        return { success: false, message: 'تم استخدام التجربة المجانية من قبل لايمكنك استخدامها مرة اخري فعل حسابك لاستكمال استخدامه شكرا' };\r\n      }\r\n\r\n      // حساب تاريخ انتهاء التجربة المجانية (المدة الديناميكية)\r\n      const startDate = new Date();\r\n      const hours = await this.getTrialDurationHours();\r\n      const endDate = new Date(startDate.getTime() + hours * 60 * 60 * 1000);\r\n\r\n      await setDoc(userRef, {\r\n        hasUsedFreeTrial: true,\r\n        freeTrialStartDate: startDate,\r\n        freeTrialEndDate: endDate,\r\n        isOnFreeTrial: true,\r\n        isActive: true, // تفعيل الحساب مع التجربة المجانية\r\n        approved: true, // الموافقة التلقائية للتجربة المجانية\r\n        updatedAt: serverTimestamp()\r\n      }, { merge: true });\r\n\r\n      return { \r\n        success: true, \r\n        message: `تم تفعيل التجربة المجانية لمدة ${hours} ${hours >= 3 && hours <= 10 ? 'ساعات' : hours === 2 ? 'ساعتين' : 'ساعة'}` \r\n      };\r\n    } catch (error) {\r\n      console.error('خطأ في بدء التجربة المجانية:', error);\r\n      return { success: false, message: 'حدث خطأ أثناء تفعيل التجربة المجانية' };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * التحقق من صلاحية التجربة المجانية\r\n   */\r\n  static async checkTrialValidity(userId: string): Promise<{\r\n    isValid: boolean;\r\n    isExpired: boolean;\r\n    hoursRemaining: number;\r\n    hasUsedTrial: boolean;\r\n  }> {\r\n    try {\r\n      const userRef = doc(db, 'users', userId);\r\n      const userDoc = await getDoc(userRef);\r\n      \r\n      if (!userDoc.exists()) {\r\n        return { isValid: false, isExpired: false, hoursRemaining: 0, hasUsedTrial: false };\r\n      }\r\n\r\n      const userData = userDoc.data();\r\n      const hasUsedTrial = userData.hasUsedFreeTrial || false;\r\n      const isOnFreeTrial = userData.isOnFreeTrial || false;\r\n      let endDate = userData.freeTrialEndDate?.toDate?.() ? userData.freeTrialEndDate.toDate() : (userData.freeTrialEndDate ? new Date(userData.freeTrialEndDate as any) : null);\r\n      const startDate = userData.freeTrialStartDate?.toDate?.() ? userData.freeTrialStartDate.toDate() : (userData.freeTrialStartDate ? new Date(userData.freeTrialStartDate as any) : null);\r\n\r\n      if (!hasUsedTrial || !isOnFreeTrial || !endDate) {\r\n        return { isValid: false, isExpired: false, hoursRemaining: 0, hasUsedTrial };\r\n      }\r\n\r\n      const now = new Date();\r\n      const isExpired = now > endDate;\r\n      \r\n      if (isExpired) {\r\n        // إنهاء التجربة المجانية وتعطيل الحساب فوراً\r\n        await updateDoc(userRef, {\r\n          isOnFreeTrial: false,\r\n          isActive: false, // تعطيل الحساب فور انتهاء التجربة\r\n          approved: false, // إلغاء الموافقة ليعود الحساب لحالة انتظار التفعيل\r\n          updatedAt: serverTimestamp()\r\n        });\r\n        \r\n        // لا توجيه؛ سيُدار التجمد داخل لوحة المستخدم\r\n        \r\n        return { isValid: false, isExpired: true, hoursRemaining: 0, hasUsedTrial };\r\n      }\r\n\r\n      // لا تقم بتمديد مدة التجربة تلقائياً؛ احترم المدة التي تم تفعيلها عند البدء\r\n\r\n      // حساب الساعات المتبقية\r\n      const timeDiff = endDate.getTime() - now.getTime();\r\n      const hoursRemaining = Math.ceil(timeDiff / (1000 * 3600));\r\n\r\n      return { isValid: true, isExpired: false, hoursRemaining, hasUsedTrial };\r\n    } catch (error) {\r\n      console.error('خطأ في التحقق من صلاحية التجربة المجانية:', error);\r\n      return { isValid: false, isExpired: false, hoursRemaining: 0, hasUsedTrial: false };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * الحصول على بيانات التجربة المجانية للمستخدم\r\n   */\r\n  static async getTrialData(userId: string): Promise<FreeTrialData> {\r\n    try {\r\n      const userRef = doc(db, 'users', userId);\r\n      const userDoc = await getDoc(userRef);\r\n      \r\n      if (!userDoc.exists()) {\r\n        return {\r\n          hasUsedFreeTrial: false,\r\n          freeTrialStartDate: null,\r\n          freeTrialEndDate: null,\r\n          isOnFreeTrial: false\r\n        };\r\n      }\r\n\r\n      const userData = userDoc.data();\r\n      return {\r\n        hasUsedFreeTrial: userData.hasUsedFreeTrial || false,\r\n        freeTrialStartDate: userData.freeTrialStartDate?.toDate() || null,\r\n        freeTrialEndDate: userData.freeTrialEndDate?.toDate() || null,\r\n        isOnFreeTrial: userData.isOnFreeTrial || false\r\n      };\r\n    } catch (error) {\r\n      console.error('خطأ في الحصول على بيانات التجربة المجانية:', error);\r\n      return {\r\n        hasUsedFreeTrial: false,\r\n        freeTrialStartDate: null,\r\n        freeTrialEndDate: null,\r\n        isOnFreeTrial: false\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * الحصول على مدة التجربة المجانية من إعدادات النظام\r\n   */\r\n  static async getTrialDurationHours(): Promise<number> {\r\n    try {\r\n      const configRef = doc(db, 'config', 'freeTrial');\r\n      const snapshot = await getDoc(configRef);\r\n      if (snapshot.exists()) {\r\n        const data = snapshot.data() as any;\r\n        const hours = typeof data?.durationHours === 'number' ? data.durationHours : this.TRIAL_DURATION_HOURS;\r\n        if (!Number.isFinite(hours) || hours < 1) return this.TRIAL_DURATION_HOURS;\r\n        return hours;\r\n      }\r\n      return this.TRIAL_DURATION_HOURS;\r\n    } catch (e) {\r\n      console.warn('getTrialDurationHours: fallback to default due to error', e);\r\n      return this.TRIAL_DURATION_HOURS;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تحديث مدة التجربة المجانية في إعدادات النظام\r\n   */\r\n  static async updateTrialDurationHours(hours: number): Promise<{ success: boolean; message: string }> {\r\n    try {\r\n      if (!Number.isFinite(hours) || hours < 1) {\r\n        return { success: false, message: 'المدة يجب أن تكون ساعة واحدة على الأقل' };\r\n      }\r\n      const configRef = doc(db, 'config', 'freeTrial');\r\n      await setDoc(configRef, { durationHours: hours, updatedAt: serverTimestamp() }, { merge: true });\r\n      return { success: true, message: 'تم تحديث مدة التجربة المجانية بنجاح' };\r\n    } catch (e) {\r\n      console.error('Error updating trial duration hours:', e);\r\n      return { success: false, message: 'تعذر تحديث مدة التجربة المجانية' };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إعادة ضبط مدة التجربة النشطة للمستخدم بناءً على الإعداد الحالي\r\n   */\r\n  static async resetActiveTrialToCurrentDuration(userId: string): Promise<{ success: boolean; message: string }> {\r\n    try {\r\n      const userRef = doc(db, 'users', userId);\r\n      const userDoc = await getDoc(userRef);\r\n      if (!userDoc.exists()) {\r\n        return { success: false, message: 'المستخدم غير موجود' };\r\n      }\r\n      const userData = userDoc.data();\r\n      const isOnFreeTrial = !!userData.isOnFreeTrial;\r\n      const start = userData.freeTrialStartDate?.toDate?.() ? userData.freeTrialStartDate.toDate() : (userData.freeTrialStartDate ? new Date(userData.freeTrialStartDate as any) : null);\r\n      if (!isOnFreeTrial || !start) {\r\n        return { success: false, message: 'لا توجد تجربة نشطة لإعادة ضبطها' };\r\n      }\r\n      const hours = await this.getTrialDurationHours();\r\n      const newEnd = new Date(start.getTime() + hours * 60 * 60 * 1000);\r\n      await updateDoc(userRef, {\r\n        freeTrialEndDate: newEnd,\r\n        updatedAt: serverTimestamp()\r\n      });\r\n      return { success: true, message: `تم ضبط نهاية التجربة إلى ${hours} ${hours >= 3 && hours <= 10 ? 'ساعات' : hours === 2 ? 'ساعتين' : 'ساعة'}` };\r\n    } catch (e) {\r\n      console.error('Error resetting active trial duration:', e);\r\n      return { success: false, message: 'تعذر إعادة ضبط مدة التجربة' };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * إلغاء التجربة المجانية النشطة فوراً وجعل الحساب يحتاج إلى تفعيل\r\n   */\r\n  static async cancelActiveFreeTrial(userId: string): Promise<{ success: boolean; message: string }> {\r\n    try {\r\n      const userRef = doc(db, 'users', userId);\r\n      const userDoc = await getDoc(userRef);\r\n      if (!userDoc.exists()) {\r\n        return { success: false, message: 'المستخدم غير موجود' };\r\n      }\r\n      const userData = userDoc.data();\r\n      const isOnFreeTrial = !!userData.isOnFreeTrial;\r\n      if (!isOnFreeTrial) {\r\n        return { success: false, message: 'لا توجد تجربة مجانية نشطة لهذا المستخدم' };\r\n      }\r\n\r\n      await updateDoc(userRef, {\r\n        isOnFreeTrial: false,\r\n        isActive: false,\r\n        approved: false,\r\n        freeTrialEndDate: new Date(),\r\n        updatedAt: serverTimestamp()\r\n      });\r\n\r\n      return { success: true, message: 'تم إلغاء التجربة المجانية وحُوّل الحساب إلى طلب تفعيل' };\r\n    } catch (e) {\r\n      console.error('Error cancelling active free trial:', e);\r\n      return { success: false, message: 'تعذر إلغاء التجربة المجانية الآن' };\r\n    }\r\n  }\r\n}\r\n"],"names":["FreeTrialService","userId","userRef","doc","db","userDoc","getDoc","userData","hasUsed","startExisting","_b","_a","endExisting","_d","_c","startDate","hours","endDate","setDoc","serverTimestamp","error","hasUsedTrial","isOnFreeTrial","now","updateDoc","timeDiff","configRef","snapshot","data","e","start","newEnd","__publicField"],"mappings":"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"}