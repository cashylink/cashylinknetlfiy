import{j as e,aa as He,ab as Xe,bc as qe,B as $,a6 as Qe,m as Ye,u as Ze,aM as et,bd as tt,b5 as me,r as n,R as st,aW as at,c as R,d as F,e as _,g as M,be as nt,K as Ae,aG as lt,I as K,C as rt,aU as it,aV as ne,W as G,t as H,V as ct,bf as ot,a1 as Oe,$ as dt,bg as Pe,an as Le,a as mt,bh as Re}from"./index-DhbnydJl.js";import{S as he,a as ue,b as xe,c as fe,d as S}from"./select-Bn8RCTk-.js";import{W as pe}from"./wallet--cZcBirk.js";import{ProfitService as Fe}from"./profitService-QTJQLMA0.js";import{D as _e}from"./dollar-sign-AUKMnGdi.js";import{A as ht}from"./arrow-down-left-DcYD3MrR.js";function Me({open:D,onOpenChange:x,transaction:h,walletName:a}){if(!h)return null;h.type==="receive"||h.type;const u=h.type==="withdraw"||h.type==="receive",le=Math.abs(h.amount||0);return e.jsx(He,{open:D,onOpenChange:x,children:e.jsxs(Xe,{className:"sm:max-w-md border-0 shadow-2xl overflow-hidden p-0 gap-0",children:[e.jsxs("div",{className:`h-32 w-full flex flex-col items-center justify-center ${u?"bg-emerald-600":"bg-blue-600"}`,children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-full mb-2 backdrop-blur-sm",children:e.jsx(qe,{className:"w-10 h-10 text-white"})}),e.jsx("h2",{className:"text-white text-xl font-bold",children:u?"تم استلام مبلغ بنجاح":"تم التحويل بنجاح"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 font-medium mb-1",children:"المبلغ"}),e.jsxs("div",{className:`text-4xl font-bold ${u?"text-emerald-600":"text-blue-600"}`,children:[le.toLocaleString()," ",e.jsx("span",{className:"text-xl text-gray-400 font-normal",children:"ج.م"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 space-y-3 border border-gray-100",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-500",children:u?"من":"إلى"}),e.jsx("span",{className:"font-semibold text-gray-900",dir:"ltr",children:u?h.senderName||h.senderPhone||h.senderMsisdn:h.receiverName||h.receiverPhone||h.receiverMsisdn})]}),e.jsx("div",{className:"h-px bg-gray-200 w-full"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),"المحفظة"]}),e.jsx("span",{className:"font-semibold text-gray-900",children:a||h.shopName||"غير محدد"})]}),e.jsx("div",{className:"h-px bg-gray-200 w-full"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"رقم العملية"}),e.jsx("span",{className:"font-mono text-xs text-gray-600 bg-gray-200 px-2 py-1 rounded",children:h.reference||h.id})]})]}),e.jsx($,{onClick:()=>x(!1),className:`w-full py-6 text-lg shadow-lg hover:shadow-xl transition-all ${u?"bg-emerald-600 hover:bg-emerald-700":"bg-blue-600 hover:bg-blue-700"}`,children:"تم"})]})]})})}const ut=()=>{var Ce,Te;const D=Qe(),{toast:x}=Ye(),{signOut:h,user:a,profile:u}=Ze(),{isShiftActive:le,shiftUser:ge}=et(),E=tt(),U=(typeof me<"u"&&typeof me.getPlatform=="function"?me.getPlatform():"web")==="android"||/Android/i.test(typeof navigator<"u"?navigator.userAgent:""),[w,V]=n.useState("01030302038"),[re,be]=n.useState(""),[v,ie]=n.useState(""),[z,Q]=n.useState(""),[I,we]=n.useState("transfer"),[je,ye]=n.useState("vodafone_cash"),[ve,Ne]=n.useState("vodafone_cash"),[Y,ce]=n.useState(""),[C,P]=n.useState([]),[xt,ft]=n.useState("all"),[pt,gt]=n.useState(!1),[Se,bt]=n.useState(""),[k,Ke]=n.useState([]),[wt,jt]=n.useState(null),[yt,vt]=n.useState(!1),[Nt,St]=n.useState([]),[Dt,It]=n.useState([]),[Bt,Wt]=n.useState(!1),[Ct,Tt]=n.useState("daily"),[Et,L]=n.useState([]),[oe,g]=n.useState(0),[A,b]=n.useState({}),[kt,At]=n.useState(!1),[De,Ie]=n.useState(!0);n.useEffect(()=>{try{const t=a!=null&&a.uid?`receiverPhoneInputEnabled_${a.uid}`:"receiverPhoneInputEnabled",s=localStorage.getItem(t)??localStorage.getItem("receiverPhoneInputEnabled");Ie(s===null?!0:s==="true")}catch{Ie(!0)}},[a==null?void 0:a.uid]);const[Ot,Pt]=n.useState(!1),[Lt,Rt]=n.useState(!1),[Ft,_t]=n.useState(!1),[Mt,Kt]=n.useState(!1),[$t,Ut]=n.useState(""),[Vt,zt]=n.useState(!1),[$e,J]=n.useState(!1),[Z,Be]=n.useState(()=>{try{const t=a!=null&&a.uid?`dailyReportsLockEnabled_${a==null?void 0:a.uid}`:"dailyReportsLockEnabled";return(localStorage.getItem(t)??localStorage.getItem("dailyReportsLockEnabled"))==="true"}catch{return!1}}),[Ue,ee]=n.useState(!1),[Ve,ze]=n.useState(!1),[o,de]=n.useState(null),te=st.useRef("");n.useEffect(()=>{if(!(a!=null&&a.uid))return;(async()=>{try{const s=await it.getByMerchantId(a.uid);if(s){const l=s.map(r=>({id:r.id,name:r.label||r.alias||"محفظة",phone:r.msisdn||"",isDefault:!1}));Ke(l)}}catch(s){console.error("Failed to load wallets",s)}})()},[a==null?void 0:a.uid]),n.useEffect(()=>{if(!a||E||U)return;let t=()=>{};return(async()=>{const l=await ne.getById(a.uid);if(l!=null&&l.shopId){const r=G(H,"dashboardData",l.shopId);t=ct(r,i=>{var d;if(i.exists()){const m=i.data(),c=m.transactions||[];if(c.length>0){const f=c[0];te.current?te.current!==f.id&&((f.provider||f.originType==="transfer"||f.originType==="withdraw"||f.originType==="sms"||f.originType==="auto"||(d=f.reference)!=null&&d.startsWith("VF-"))&&de(f),te.current=f.id):te.current=f.id}P(c);const y=m.cashBalance;if(typeof y=="number"){g(y);try{localStorage.setItem("lastKnownCashBalance",String(y))}catch{}}const N=m.walletBalances;if(N&&Object.keys(N).length>0){b(N);try{localStorage.setItem("lastKnownWalletBalances",JSON.stringify(N))}catch{}}L(m.deletedTransactions||[])}})}})(),()=>t()},[a,E,U]),n.useEffect(()=>{try{const t=localStorage.getItem("lastKnownCashBalance");t&&!isNaN(Number(t))&&g(Number(t));const s=localStorage.getItem("lastKnownWalletBalances");s&&b(JSON.parse(s))}catch{}},[]);const j=t=>{const s="٠١٢٣٤٥٦٧٨٩",l="۰۱۲۳۴۵۶۷۸۹";return(t||"").split("").map(r=>{const i=s.indexOf(r);if(i>-1)return String(i);const d=l.indexOf(r);return d>-1?String(d):r}).join("")},We=t=>{const s=j(t).replace(/\D/g,"");return s.startsWith("010")?"vodafone_cash":s.startsWith("011")?"etisalat_cash":s.startsWith("012")?"orange_cash":null};n.useEffect(()=>{const t=We(w);t&&t!==je&&ye(t)},[w]),n.useEffect(()=>{const t=We(v);t&&t!==ve&&Ne(t)},[v]),n.useEffect(()=>{try{const t=a!=null&&a.uid?`dailyReportsLockEnabled_${a==null?void 0:a.uid}`:"dailyReportsLockEnabled",s=localStorage.getItem(t)??localStorage.getItem("dailyReportsLockEnabled");Be(s==="true")}catch{}},[a==null?void 0:a.uid]),n.useEffect(()=>{const t=D.state||{};t!=null&&t.openTransactionSection&&(((t==null?void 0:t.transactionType)==="withdraw"||(t==null?void 0:t.transactionType)==="transfer")&&we(t.transactionType),ze(!0),t!=null&&t.startNewTransaction&&(V("01030302038"),ie(""),Q(""),ce("")),setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"})},50))},[D.state]);const se=async t=>{if(a)try{const s=await ne.getById(a.uid);if(s!=null&&s.shopId){const l=G(H,"dashboardData",s.shopId);t.cashBalance!==void 0&&(t.cashBalance=Math.round(t.cashBalance)),await Le(l,t);const r={};if(t.walletBalances&&(r.walletBalances=t.walletBalances),t.cashBalance!==void 0&&(r.cashBalance=Math.round(t.cashBalance)),Object.keys(r).length>0){const i=G(H,"users",a.uid);await Le(i,r)}}}catch(s){console.error("Error saving to Firebase:",s),x({title:"خطأ في الحفظ",description:"حدث خطأ أثناء حفظ البيانات في Firebase",variant:"destructive"})}};n.useEffect(()=>{if(!a)return;(async()=>{J(!0);try{const s=await ne.getById(a.uid);if(s!=null&&s.shopId){const l=G(H,"dashboardData",s.shopId);try{const i=await ot(l);if(i.exists()){const d=i.data();g(d.cashBalance||0),b(d.walletBalances||{}),L(d.deletedTransactions||[]),J(!1)}}catch{}const r=await Oe(l);if(r.exists()){const i=r.data(),d=i.cashBalance;if(typeof d=="number"){g(d);try{localStorage.setItem("lastKnownCashBalance",String(d))}catch{}}else{const c=localStorage.getItem("lastKnownCashBalance");c&&!isNaN(Number(c))?g(Number(c)):g(0)}const m=i.walletBalances;if(m&&typeof m=="object"){b(m);try{localStorage.setItem("lastKnownWalletBalances",JSON.stringify(m))}catch{}}else{const c=localStorage.getItem("lastKnownWalletBalances");b(c?JSON.parse(c):{})}L(i.deletedTransactions||[])}else{const i={walletBalances:{},deletedTransactions:[]};await dt(l,i),g(0),b(i.walletBalances),L(i.deletedTransactions)}}}catch(s){console.error("Error loading data from Firebase:",s);let l=!1;try{const r=localStorage.getItem("lastKnownCashBalance"),i=localStorage.getItem("lastKnownWalletBalances");r!==null&&!isNaN(Number(r))&&(g(Number(r)),l=!0),i&&(b(JSON.parse(i)),l=!0)}catch{}l||(g(0),b({})),L([])}finally{J(!1)}})()},[a]),n.useEffect(()=>{const t=s=>{const{cashBalance:l,walletBalances:r,newTransaction:i,delta:d}=s.detail||{};if(d){const{amount:m,type:c,walletId:y,commission:N,totalDeducted:f}=d,p=Number(m||0),T=Number(N||0),ae=Number(f||p+T);g(B=>{let W=0;return c==="withdraw"?W=-p+T:c==="send"||c==="transfer"?W=p+T:c==="atm_withdraw"&&(W=p),B+W}),y&&b(B=>{const W=Number(B[y]||0);let O=0;return c==="withdraw"?O=p:c==="send"||c==="transfer"?O=-p:c==="atm_withdraw"&&(O=-ae),{...B,[y]:W+O}})}typeof l=="number"&&g(l),r&&typeof r=="object"&&b(r),i&&(P(m=>m.some(c=>c.id===i.id)?m:[i,...m]),x({title:"تم تسجيل عملية خارجية",description:"تم تحديث الأرصدة والسجلات بنجاح"}))};return window.addEventListener("dashboard:external-update",t),()=>window.removeEventListener("dashboard:external-update",t)},[]);const Je=async()=>{if(a){J(!0);try{const t=await ne.getById(a.uid);if(t!=null&&t.shopId){const s=G(H,"dashboardData",t.shopId),l=await Oe(s);if(l.exists()){const r=l.data();g(r.cashBalance||0),b(r.walletBalances||{}),L(r.deletedTransactions||[]),x({title:"تم تحديث البيانات",description:"تم تحميل أحدث البيانات من السيرفر بنجاح"})}}}catch(t){console.error("Error refreshing dashboard data:",t),x({title:"فشل التحديث",description:"حدث خطأ أثناء تحديث البيانات",variant:"destructive"})}finally{J(!1)}}},Ge=async t=>{if(t.preventDefault(),I==="transfer"){if(!w||!z||De&&!v){x({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}const s=(u==null?void 0:u.shopName)||(a==null?void 0:a.displayName)||"محل كاشي لينك",l=k.find(B=>B.id===Se)||k.find(B=>B.isDefault),r=Y&&Y.trim()!==""?parseFloat(Y):0;if(!l){x({title:"لا توجد محفظة",description:"يرجى اختيار محفظة لإتمام التحويل",variant:"destructive"});return}const i=Math.round(parseFloat(z)),d=i+r,m=A[l.id]||0;if(m<d){x({title:"رصيد المحفظة غير كافٍ",description:`الرصيد الحالي ${m} لا يكفي لخصم ${d}`,variant:"destructive"});return}const c=Pe(i,"send"),y={id:Date.now().toString(),type:"send",senderPhone:w,receiverPhone:v,amount:i,status:"pending",createdAt:new Date,withdrawnAmount:0,sentAmount:i,merchantShopName:s,shopName:(l==null?void 0:l.name)||"المحفظة الرئيسية",commission:c,fee:r,fromWallet:l.id},N=[y,...C];P(N);const f=i+r,p=l==null?void 0:l.id,T=p&&A[p]||0,ae=p?{...A,[p]:T-f}:A;b(ae),await se({transactions:N,walletBalances:ae}),x({title:"تم إرسال التحويل",description:"جاري معالجة التحويل..."}),setTimeout(async()=>{const W=[{...y,status:"completed"},...C];P(W);const O=r,Ee=Math.max(0,c)+(Number.isFinite(O)?O:0),ke=oe+Ee;g(ke),await se({transactions:W,cashBalance:ke}),Fe.addProfit(Ee)},2e3),V("01030302038"),ie(""),Q(""),ce("")}else if(I==="withdraw"){if(!w||!z){x({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}const s=(u==null?void 0:u.shopName)||(a==null?void 0:a.displayName)||"محل كاشي لينك",l=k.find(c=>c.id===Se)||k.find(c=>c.isDefault);if(!l){x({title:"لا توجد محفظة",description:"يرجى اختيار محفظة لإتمام السحب",variant:"destructive"});return}const r=Math.round(parseFloat(z));if(!Number.isFinite(r)||r<=0){x({title:"خطأ",description:"أدخل مبلغًا صحيحًا للسحب",variant:"destructive"});return}const i=Pe(r,"receive"),d={id:Date.now().toString(),type:"withdraw",senderPhone:w,receiverPhone:"",amount:r,status:"pending",createdAt:new Date,withdrawnAmount:r,sentAmount:0,merchantShopName:s,shopName:(l==null?void 0:l.name)||"المحفظة الرئيسية",commission:i,fromWallet:l.id,senderName:re||void 0},m=[d,...C];P(m),await se({transactions:m}),x({title:"تم إنشاء عملية السحب",description:"جاري معالجة السحب..."}),setTimeout(async()=>{const y=[{...d,status:"completed"},...C];P(y);const N=l.id,f=A[N]||0,p={...A,[N]:f+r};b(p);const T=oe-r+Math.max(0,i);g(T),await se({transactions:y,walletBalances:p,cashBalance:T}),Fe.addProfit(Math.max(0,i))},2e3),V("01030302038"),Q("")}};return e.jsxs("div",{className:"min-h-screen bg-background p-4",children:[e.jsx(Me,{open:!!o,onOpenChange:t=>!t&&de(null),transaction:o,walletName:(Ce=k.find(t=>t.id===(o==null?void 0:o.fromWallet)))==null?void 0:Ce.name}),$e&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-center",children:"جاري تحميل البيانات..."})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"لوحة تحكم الإدارة"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs($,{onClick:Je,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(RefreshCcw,{className:"h-4 w-4"}),"تحديث"]}),e.jsxs($,{onClick:h,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(at,{className:"h-4 w-4"}),"تسجيل الخروج"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(R,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"الرصيد النقدي"}),e.jsx(_e,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(M,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[oe.toLocaleString("en-US",{maximumFractionDigits:0})," جنيه"]})})]}),e.jsxs(R,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"أرصدة المحافظ"}),e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(M,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[Object.values(A).reduce((t,s)=>t+s,0).toLocaleString("en-US",{maximumFractionDigits:0})," جنيه"]})})]}),e.jsxs(R,{className:"relative",children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"المعاملات اليوم"}),e.jsx(nt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(M,{className:Z?"filter blur-sm pointer-events-none":"",children:e.jsx("div",{className:"text-2xl font-bold",children:C.length})}),Z&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center rounded-lg bg-yellow-100/60",children:e.jsxs($,{size:"sm",variant:"ghost",onClick:()=>ee(!0),className:"flex items-center gap-2 bg-yellow-200/70 hover:bg-yellow-300 text-yellow-900 px-3 py-2 rounded-xl shadow-md hover:shadow-lg transition-all",title:"عرض تقارير اليوم",children:[e.jsx(Ae,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"عرض تقارير اليوم"})]})})]}),e.jsxs(R,{className:"relative",children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"إجمالي اليوم"}),e.jsx(_e,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(M,{className:Z?"filter blur-sm pointer-events-none":"",children:e.jsxs("div",{className:"text-2xl font-bold",children:[C.reduce((t,s)=>t+s.amount,0).toLocaleString()," جنيه"]})}),Z&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center rounded-lg bg-yellow-100/60",children:e.jsxs($,{size:"sm",variant:"ghost",onClick:()=>ee(!0),className:"flex items-center gap-2 bg-yellow-200/70 hover:bg-yellow-300 text-yellow-900 px-3 py-2 rounded-xl shadow-md hover:shadow-lg transition-all",title:"عرض تقارير اليوم",children:[e.jsx(Ae,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"عرض تقارير اليوم"})]})})]}),e.jsx(lt,{open:Ue,onOpenChange:ee,mode:"verify",title:"قفل تقارير اليوم",description:"لا يمكن الاطلاع على تقارير اليوم إلا بإدخال الرقم السري الرئيسي",userId:a==null?void 0:a.uid,userRole:u==null?void 0:u.role,onSuccess:()=>{Be(!1),ee(!1)}})]}),e.jsxs(R,{className:E&&Ve?"sticky top-0 z-40 shadow-lg bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/70":"",children:[e.jsx(F,{children:e.jsx(_,{children:"إجراء معاملة جديدة"})}),e.jsx(M,{children:e.jsxs("form",{onSubmit:Ge,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"نوع المعاملة"}),e.jsxs(he,{value:I,onValueChange:t=>we(t),children:[e.jsx(ue,{children:e.jsx(xe,{})}),e.jsxs(fe,{children:[e.jsx(S,{value:"transfer",children:"تحويل"}),e.jsx(S,{value:"withdraw",children:"سحب"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"رقم المرسل"}),e.jsx(K,{type:"tel",value:w,onChange:t=>V(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const s=document.getElementById("receiverPhoneInput");if(s)s.focus();else{const l=document.getElementById("amountInput");l==null||l.focus()}}},placeholder:"01xxxxxxxxx"})]}),I==="transfer"&&De&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"رقم المستقبل"}),e.jsx(K,{id:"receiverPhoneInput",type:"tel",value:v,onChange:t=>ie(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const s=document.getElementById("amountInput");s==null||s.focus()}},placeholder:"01xxxxxxxxx"})]}),I==="withdraw"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"اسم الراسل (اختياري)"}),e.jsx(K,{id:"senderNameInput",type:"text",value:re,onChange:t=>be(t.target.value),placeholder:"مثال: أحمد عبد الرحمن"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"شركة المرسل"}),e.jsxs(he,{value:je,onValueChange:t=>ye(t),children:[e.jsx(ue,{children:e.jsx(xe,{})}),e.jsxs(fe,{children:[e.jsx(S,{value:"vodafone_cash",children:"فودافون"}),e.jsx(S,{value:"etisalat_cash",children:"اتصالات"}),e.jsx(S,{value:"orange_cash",children:"أورانج"}),e.jsx(S,{value:"instapay",children:"إنستاباي"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"شركة المستقبل"}),e.jsxs(he,{value:ve,onValueChange:t=>Ne(t),children:[e.jsx(ue,{children:e.jsx(xe,{})}),e.jsxs(fe,{children:[e.jsx(S,{value:"vodafone_cash",children:"فودافون"}),e.jsx(S,{value:"etisalat_cash",children:"اتصالات"}),e.jsx(S,{value:"orange_cash",children:"أورانج"}),e.jsx(S,{value:"instapay",children:"إنستاباي"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"المبلغ"}),e.jsx(K,{id:"amountInput",type:"number",value:z,onChange:t=>Q(t.target.value),onKeyDown:t=>{if(t.key==="Enter"){const s=document.getElementById("txSubmitButton");s==null||s.focus()}},placeholder:"0.00"})]}),I==="withdraw"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"اسم الراسل (اختياري)"}),e.jsx(K,{id:"senderNameInput",type:"text",value:re,onChange:t=>be(t.target.value),placeholder:"مثال: أحمد عبد الرحمن"})]}),I==="transfer"&&(j(w||"").replace(/\D/g,"").startsWith("010")&&j(v||"").replace(/\D/g,"").startsWith("010")||j(w||"").replace(/\D/g,"").startsWith("010")&&(j(v||"").replace(/\D/g,"").startsWith("011")||j(v||"").replace(/\D/g,"").startsWith("012")||j(v||"").replace(/\D/g,"").startsWith("015"))||j(w||"").replace(/\D/g,"").startsWith("012")&&j(v||"").replace(/\D/g,"").startsWith("010")||j(w||"").replace(/\D/g,"").startsWith("011")&&j(v||"").replace(/\D/g,"").startsWith("010")||j(w||"").replace(/\D/g,"").startsWith("015")&&j(v||"").replace(/\D/g,"").startsWith("010"))&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"رسوم التحويل"}),e.jsx(K,{type:"number",value:Y,onChange:t=>ce(t.target.value),placeholder:"0.00"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"تُخصم من المحفظة وتضاف للدرج"})]})]}),e.jsx($,{id:"txSubmitButton",type:"submit",className:`w-full ${I==="transfer"?"btn-transfer-confirm":"btn-withdraw-confirm"}`,children:I==="transfer"?"إرسال التحويل":"تنفيذ السحب"})]})})]}),e.jsxs(R,{children:[e.jsx(F,{children:e.jsx(_,{children:"المعاملات الأخيرة"})}),e.jsx(M,{children:C.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"لا توجد معاملات حديثة."}):e.jsx("div",{className:E||U?"receipts-list space-y-3 max-h-[310px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400":"receipts-list space-y-3",children:C.map(t=>{var s;return e.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-card border border-gray-100 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx("div",{className:`h-12 w-12 rounded-full flex items-center justify-center shrink-0 ${t.type==="withdraw"?"bg-red-50":"bg-green-50"}`,children:t.type==="withdraw"?e.jsx(ht,{className:"h-6 w-6 text-red-600"}):e.jsx(ArrowUpRight,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"text-base font-bold text-foreground truncate",children:t.type==="send"?"تحويل أموال":"سحب نقدي"}),e.jsxs("span",{className:`text-base font-bold whitespace-nowrap ${t.type==="send"?"text-green-600":"text-red-600"}`,children:[t.type==="send"?"-":"+"," ",t.amount.toLocaleString()," ج.م"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:t.type==="send"?e.jsx("span",{dir:"ltr",children:t.receiverPhone}):e.jsx("span",{dir:"ltr",children:t.senderPhone})}),e.jsx("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:t.createdAt instanceof Date?t.createdAt.toLocaleString("ar-EG",{day:"numeric",month:"short",hour:"numeric",minute:"numeric",hour12:!0}):new Date(t.createdAt.seconds*1e3).toLocaleString("ar-EG",{day:"numeric",month:"short",hour:"numeric",minute:"numeric",hour12:!0})}),(t.fromWallet||t.shopName||t.provider)&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1 flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),((s=k.find(l=>l.id===t.fromWallet))==null?void 0:s.name)||(t.provider==="vodafone_cash"?"فودافون كاش":t.provider==="etisalat_cash"?"اتصالات كاش":t.provider==="orange_cash"?"أورانج كاش":t.provider==="instapay"?"إنستاباي":t.shopName||"المحفظة")]})]}),e.jsxs("div",{className:`px-2.5 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${t.status==="completed"?"bg-green-50 text-green-700":t.status==="pending"?"bg-yellow-50 text-yellow-700":"bg-red-50 text-red-700"}`,children:[t.status==="completed"&&e.jsx(Check,{className:"h-3 w-3"}),t.status==="pending"&&e.jsx(rt,{className:"h-3 w-3"}),t.status==="failed"&&e.jsx(X,{className:"h-3 w-3"}),e.jsx("span",{children:t.status==="completed"?"ناجحة":t.status==="pending"?"معالجة":"فشلت"})]})]})]})]},t.id)})})})]}),e.jsx(Me,{open:!!o,onOpenChange:t=>!t&&de(null),transaction:o,walletName:((Te=k.find(t=>t.id===(o==null?void 0:o.fromWallet)))==null?void 0:Te.name)||((o==null?void 0:o.provider)==="vodafone_cash"?"فودافون كاش":(o==null?void 0:o.provider)==="etisalat_cash"?"اتصالات كاش":(o==null?void 0:o.provider)==="orange_cash"?"أورانج كاش":(o==null?void 0:o.provider)==="instapay"?"إنستاباي":o==null?void 0:o.shopName)})]})]})},Yt=()=>{const D=mt(),[x,h]=n.useState(!1),[a,u]=n.useState(!0);return n.useEffect(()=>{(()=>{const ge=localStorage.getItem("dashboardAuth"),E=localStorage.getItem("dashboardUser");if(ge==="true"&&E)try{const q=JSON.parse(E),U=new Date(q.loginTime);(new Date().getTime()-U.getTime())/(1e3*60*60)<24?h(!0):(localStorage.removeItem("dashboardAuth"),localStorage.removeItem("dashboardUser"),D("/dashboard/login"))}catch(q){console.error("Error parsing user data:",q),D("/dashboard/login")}else D("/dashboard/login");u(!1)})()},[D]),a?e.jsx(Re,{}):x?e.jsx(ut,{}):e.jsx(Re,{})};export{Yt as default};
//# sourceMappingURL=ProtectedDashboard-CMyGL1BE.js.map
