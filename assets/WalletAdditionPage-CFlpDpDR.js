import{a as ue,i as fe,l as xe,u as ge,R as pe,r as i,a0 as b,j as e,B as S,a1 as ye,C as Q,c as we,d as ve,f as X,x as l,I as d,P as Ne,a2 as je,a3 as be,a4 as Y,a5 as Le,a6 as ee}from"./index-CzMrJEuC.js";import{S as We,a as Ce,b as Te,c as Ie,d as Se}from"./select-DHMtOuee.js";import{A as Fe}from"./arrow-left-DE7YICBa.js";import{W as Pe}from"./wallet-BpRPCgGm.js";import{B as Ee}from"./building-2-PwAzrvCc.js";const Be=()=>{const F=ue(),[C]=fe(),{toast:w}=xe(),{user:s,userSubscription:c,profile:v}=ge(),P=pe.useMemo(()=>{if((v==null?void 0:v.transferFeesEnabled)!==void 0)return v.transferFeesEnabled;try{const a=s!=null&&s.uid?`transferFeesEnabled_${s.uid}`:"transferFeesEnabled";return(localStorage.getItem(a)??localStorage.getItem("transferFeesEnabled"))!=="false"}catch{return!0}},[v,s==null?void 0:s.uid]),[N,E]=i.useState(""),[j,k]=i.useState(""),[D,ae]=i.useState(""),[U,te]=i.useState(""),[L,_]=i.useState(""),[h,O]=i.useState("200000"),[u,R]=i.useState("200000"),[f,B]=i.useState("100000"),[x,M]=i.useState("60000"),[r,A]=i.useState(""),[n,z]=i.useState(""),[Z,se]=i.useState(!1),[$,q]=i.useState(!1),[G,T]=i.useState([]),[W,ie]=i.useState(!1),[I,le]=i.useState(null),[ke,re]=i.useState(""),[ne,de]=i.useState(""),oe=[{id:"vodafone",name:"فودافون كاش",color:"bg-red-500"},{id:"etisalat",name:"اتصالات كاش",color:"bg-green-500"},{id:"orange",name:"أورنج كاش",color:"bg-orange-500"},{id:"we_pay",name:"وي باي",color:"bg-purple-500"},{id:"smart_wallet",name:"سمارت ولت",color:"bg-blue-500"},{id:"access_pay",name:"أكسس باي",color:"bg-teal-500"},{id:"insta_pay",name:"انستا باي",color:"bg-pink-500"}],me=()=>`wallets_${(s==null?void 0:s.uid)||"default"}`;i.useEffect(()=>{ce()},[s==null?void 0:s.uid]);const H=a=>{switch(a){case"vodafone":return"vodafone_cash";case"etisalat":return"etisalat_cash";case"orange":return"orange_cash";case"insta_pay":return"instapay";default:return a}},J=a=>{switch(a){case"vodafone_cash":return"vodafone";case"etisalat_cash":return"etisalat";case"orange_cash":return"orange";case"instapay":return"insta_pay";default:return a}};i.useEffect(()=>{const a=C.get("edit")==="1",o=C.get("id");ie(a),le(o),a&&o&&(async()=>{try{const t=await b.getById(o);t&&(E(t.label||""),k(t.msisdn||""),_(J(t.provider||"")),O(String(t.withdrawLimit||2e5)),R(String(t.transferLimit||2e5)),A((t.defaultTransferCommission??"").toString()),z((t.defaultWithdrawCommission??"").toString()),B(String(t.dailyWithdrawLimit??1e5)),M(String(t.dailyTransferLimit??6e4)),re(t.msisdn||""),de(t.provider||""))}catch(t){console.error("Error loading wallet for edit:",t)}})()},[C]);const ce=async()=>{if(s!=null&&s.uid)try{const a=await b.getByMerchantId(s.uid);if(a&&a.length>0){const o=a.map(t=>({id:t.id,name:t.label||"",phone:t.msisdn||"",isDefault:!1,monthlyWithdrawalLimit:typeof t.withdrawLimit=="number"?t.withdrawLimit:0,monthlyTransferLimit:typeof t.transferLimit=="number"?t.transferLimit:0,monthlyWithdrawalUsage:typeof t.withdrawUsage=="number"?t.withdrawUsage:0,monthlyTransferUsage:typeof t.transferUsage=="number"?t.transferUsage:0,lastResetDate:void 0,walletProvider:J(t.provider||""),defaultTransferCommission:t.defaultTransferCommission??null,defaultWithdrawCommission:t.defaultWithdrawCommission??null,dailyWithdrawalLimit:typeof t.dailyWithdrawLimit=="number"?t.dailyWithdrawLimit:1e5,dailyTransferLimit:typeof t.dailyTransferLimit=="number"?t.dailyTransferLimit:6e4}));T(o)}else T([])}catch(a){console.error("Error loading wallets:",a),T([])}},he=async a=>{var o;if(a.preventDefault(),!N||!j){w({title:"خطأ",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"});return}if(!W&&(s!=null&&s.uid))try{let t=!1;const g=((o=c==null?void 0:c.subscription)==null?void 0:o.planType)??(c==null?void 0:c.planType)??null,p=typeof g=="string"?g.toLowerCase():null;if(g===Y.ZERO||p==="zero"||g===0||p==="0")t=!0;else{const m=await Le(s.uid),y=(m==null?void 0:m.planType)??(m==null?void 0:m.plan)??null,V=typeof y=="string"?y.toLowerCase():null;t=y===Y.ZERO||V==="zero"||y===0||V==="0"}if(t&&(await b.getByMerchantId(s.uid)).length>=5){w({title:"تحذير",description:"باقة زيرو تسمح بإضافة 5 محافظ فقط. قم بالترقية.",variant:"destructive"});return}}catch(t){console.warn("Zero plan limit check failed:",t)}q(!0);try{const t=new Date().toISOString().split("T")[0];if(W&&I)await b.update(I,{provider:H(L||ne||""),msisdn:j,label:N,transferLimit:parseInt(u),withdrawLimit:parseInt(h),dailyTransferLimit:parseInt(x||"0"),dailyWithdrawLimit:parseInt(f||"0"),defaultTransferCommission:P&&r!=null&&r.trim()!==""?parseFloat(r):null,defaultWithdrawCommission:n!=null&&n.trim()!==""?parseFloat(n):null}),await ee.setLimits(I,{dailyTransferLimit:parseInt(x||"0"),dailyWithdrawLimit:parseInt(f||"0"),monthlyTransferLimit:parseInt(u||"0"),monthlyWithdrawLimit:parseInt(h||"0")}),w({title:"تم التحديث",description:"تم تحديث بيانات المحفظة بنجاح"});else{const g={merchantUserId:(s==null?void 0:s.uid)||"",provider:H(L),msisdn:j,label:N,isActive:!0,dailyLimit:5e4,monthlyLimit:3e5,transferLimit:parseInt(u),withdrawLimit:parseInt(h),dailyTransferLimit:parseInt(x||"0"),dailyWithdrawLimit:parseInt(f||"0"),transferUsage:0,withdrawUsage:0,defaultTransferCommission:P&&r!=null&&r.trim()!==""?parseFloat(r):null,defaultWithdrawCommission:n!=null&&n.trim()!==""?parseFloat(n):null};let p;if(s!=null&&s.uid)p=await b.create(g),await ee.setLimits(p,{dailyTransferLimit:parseInt(x||"0"),dailyWithdrawLimit:parseInt(f||"0"),monthlyTransferLimit:parseInt(u||"0"),monthlyWithdrawLimit:parseInt(h||"0")});else{console.warn("يجب تسجيل الدخول قبل إنشاء المحفظة");return}const m={id:p,name:N,phone:j,ownerName:D,nationalId:U,isDefault:Z||G.length===0,monthlyWithdrawalLimit:parseInt(h),monthlyTransferLimit:parseInt(u),monthlyWithdrawalUsage:0,monthlyTransferUsage:0,dailyWithdrawalLimit:parseInt(f),dailyTransferLimit:parseInt(x),lastResetDate:t,walletProvider:L,defaultTransferCommission:r!=null&&r.trim()!==""?parseFloat(r):null,defaultWithdrawCommission:n!=null&&n.trim()!==""?parseFloat(n):null},y=[...G,m];localStorage.setItem(me(),JSON.stringify(y)),w({title:"تم الإنشاء",description:"تم إنشاء المحفظة بنجاح"})}F("/user/dashboard")}catch(t){console.error("Error saving wallet:",t),w({title:"خطأ",description:"حدث خطأ أثناء حفظ المحفظة",variant:"destructive"})}finally{q(!1)}},K=()=>{F("/user/dashboard")};return e.jsx("div",{className:"min-h-screen bg-background p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(S,{variant:"outline",size:"sm",onClick:K,className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),"العودة"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ye,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:W?"تعديل المحفظة":"إضافة محفظة جديدة"})]})]}),e.jsxs(Q,{className:"shadow-lg",children:[e.jsx(we,{children:e.jsxs(ve,{className:"flex items-center gap-2 text-right",children:[e.jsx(Pe,{className:"h-5 w-5 text-blue-600"}),"بيانات المحفظة"]})}),e.jsx(X,{children:e.jsxs("form",{onSubmit:he,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"walletName",className:"text-right block font-medium",children:"اسم المحفظة *"}),e.jsx(d,{id:"walletName",type:"text",placeholder:"مثال: محفظة العمل",value:N,onChange:a=>E(a.target.value),className:"text-right",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"walletPhone",className:"text-right block font-medium",children:"رقم الهاتف *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(d,{id:"walletPhone",type:"tel",placeholder:"01xxxxxxxxx",value:j,onChange:a=>k(a.target.value),className:"text-right pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"walletOwnerName",className:"text-right block font-medium",children:"اسم صاحب المحفظة (اختياري)"}),e.jsx(d,{id:"walletOwnerName",type:"text",placeholder:"اسم صاحب المحفظة",value:D,onChange:a=>ae(a.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"walletNationalId",className:"text-right block font-medium",children:"الرقم القومي (اختياري)"}),e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(d,{id:"walletNationalId",type:"text",placeholder:"الرقم القومي",value:U,onChange:a=>te(a.target.value),className:"text-right pl-10"})]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-blue-700 bg-blue-50 border border-blue-100 p-3 rounded",children:[e.jsx(be,{className:"h-4 w-4 mt-0.5"}),e.jsx("p",{className:"text-sm text-right",children:'يمكن ترك "عمولة التحويل" و"عمولة السحب" فارغتين إذا أردت إدخال العمولة يدويًا أثناء تنفيذ العملية، أو كتابتهما هنا لتكونا قيمًا افتراضية تُستخدم تلقائيًا.'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"defaultTransferCommission",className:"text-right block font-medium",children:"عمولة التحويل (افتراضية - اختياري)"}),e.jsx(d,{id:"defaultTransferCommission",type:"number",step:"0.01",min:"0",placeholder:"أدخل عمولة التحويل الافتراضية (مثال: 5)",value:r,onChange:a=>A(a.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"defaultWithdrawCommission",className:"text-right block font-medium",children:"عمولة السحب (افتراضية - اختياري)"}),e.jsx(d,{id:"defaultWithdrawCommission",type:"number",step:"0.01",min:"0",placeholder:"أدخل عمولة السحب الافتراضية (مثال: 5)",value:n,onChange:a=>z(a.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"walletProvider",className:"text-right block font-medium",children:"شركة المحفظة"}),e.jsxs(We,{value:L,onValueChange:_,children:[e.jsx(Ce,{className:"text-right",children:e.jsx(Te,{placeholder:"اختر شركة المحفظة"})}),e.jsx(Ie,{children:oe.map(a=>e.jsx(Se,{value:a.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${a.color}`}),a.name]})},a.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"monthlyWithdrawalLimit",className:"text-right block font-medium",children:"حد السحب الشهري"}),e.jsx(d,{id:"monthlyWithdrawalLimit",type:"number",value:h,onChange:a=>O(a.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"monthlyTransferLimit",className:"text-right block font-medium",children:"حد التحويل الشهري"}),e.jsx(d,{id:"monthlyTransferLimit",type:"number",value:u,onChange:a=>R(a.target.value),className:"text-right"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"dailyWithdrawalLimit",className:"text-right block font-medium",children:"حد السحب اليومي"}),e.jsx(d,{id:"dailyWithdrawalLimit",type:"number",value:f,onChange:a=>B(a.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"dailyTransferLimit",className:"text-right block font-medium",children:"حد التحويل اليومي"}),e.jsx(d,{id:"dailyTransferLimit",type:"number",value:x,onChange:a=>M(a.target.value),className:"text-right"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(l,{htmlFor:"isDefault",className:"font-medium",children:"جعل هذه المحفظة افتراضية"}),e.jsx("input",{id:"isDefault",type:"checkbox",checked:Z,onChange:a=>se(a.target.checked),className:"rounded"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(S,{type:"button",variant:"outline",onClick:K,className:"flex-1",children:"إلغاء"}),e.jsx(S,{type:"submit",disabled:$,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:$?"جاري الحفظ...":W?"حفظ التعديلات":"إضافة المحفظة"})]})]})})]}),e.jsx(Q,{className:"mt-6 bg-blue-50 border-blue-200",children:e.jsx(X,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Ee,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"معلومات مهمة:"}),e.jsxs("ul",{className:"space-y-1 text-blue-700",children:[e.jsx("li",{children:"• تأكد من صحة رقم الهاتف المدخل"}),e.jsx("li",{children:"• يمكنك تعديل الحدود الشهرية لاحقاً"}),e.jsx("li",{children:"• المحفظة الافتراضية ستكون الخيار الأول في المعاملات"})]})]})]})})})]})})};export{Be as default};
//# sourceMappingURL=WalletAdditionPage-CFlpDpDR.js.map
