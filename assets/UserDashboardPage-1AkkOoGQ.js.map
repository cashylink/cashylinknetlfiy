{"version":3,"mappings":"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","names":["__iconNode","Banknote","createLucideIcon","Building","CalendarDays","CirclePlus","IdCard","Info","ListChecks","Notebook","Package","RotateCcw","ScanBarcode","Send","TrendingDown","getLastTransactions","data","httpsCallable","functions","error","sendTelegramMessage","walletProviders","WalletsViewPage","isOpen","onClose","onWalletSelect","onEditWallet","onDeleteWallet","user","useFirebaseAuth","wallets","setWallets","useState","selectMode","setSelectMode","selectedIds","setSelectedIds","isLoading","setIsLoading","toast","useToast","calculateWalletMonthlyUsage","walletId","transactions","currentMonth","currentYear","monthlyTransactions","t","transactionDate","isWithdrawTx","type","isSendTx","withdrawalUsage","sum","amount","transferUsage","checkAndResetMonthlyUsage","wallet","today","lastReset","lastResetDate","currentDate","useEffect","firebaseWallets","merchantWalletService","transactionService","walletsWithResetCheck","w","limits","walletDailyLimitsService","getProviderInfo","providerId","p","getUsagePercentage","used","limit","formatNumber","num","jsx","Dialog","jsxs","DialogContent","DialogHeader","DialogTitle","Wallet","Badge","Fragment","Button","ops","prev","e","providerInfo","isSelected","cardClasses","Card","id","CardHeader","CardTitle","CreditCard","Star","Edit","Trash2","CardContent","Phone","monthlyWithdrawalLimit","monthlyTransferLimit","monthlyWithdrawUsed","monthlyTransferUsed","remainingWithdraw","remainingTransfer","ArrowLeft","WalletDetailsPage","onBack","setTransactions","selectedPeriod","setSelectedPeriod","walletTransactions","a","b","formatDate","dateString","filteredTransactions","now","startDate","xn","totalWithdrawals","totalTransfers","totalDeposits","completedTransactions","operationsCount","totalProfit","calculateProfit","withdrawalPercentage","transferPercentage","getTransactionIcon","TrendingUp","DollarSign","Activity","getStatusIcon","status","CheckCircle","Clock","XCircle","AlertCircle","getTransactionTypeText","getStatusText","Calendar","BarChart3","Progress","Separator","transaction","WalletManagement","onWalletUpdate","initialEditingWallet","userSubscription","raw","_a","_b","s","SubscriptionPlan","navigate","useNavigate","isAddingWallet","setIsAddingWallet","editingWallet","setEditingWallet","walletName","setWalletName","walletPhone","setWalletPhone","walletNationalId","setWalletNationalId","walletProvider","setWalletProvider","setMonthlyWithdrawalLimit","setMonthlyTransferLimit","dailyWithdrawalLimit","setDailyWithdrawalLimit","dailyTransferLimit","setDailyTransferLimit","isDefault","setIsDefault","showProviderInfo","setShowProviderInfo","showWalletsView","setShowWalletsView","isMasterPinDialogOpen","setIsMasterPinDialogOpen","selectedWallet","setSelectedWallet","getWalletsKey","lastResetMonth","lastResetYear","calculateWalletDailyUsage","currentDay","dailyTransactions","auth","__vitePreload","n","retryCount","maxRetries","resolve","dailyWithdrawalUsage","dailyTransferUsage","resetForm","saveWallet","updatedWallets","newWalletData","newWalletId","walletToAdd","newWallets","handleEditWallet","handleDeleteWallet","walletToDelete","handleSetDefault","Eye","Plus","Select","SelectTrigger","SelectValue","SelectContent","provider","SelectItem","Input","Settings","X","MasterPinDialog","updated","err","TransactionDetailsModal","onDelete","handlePrint","hasSenderNumber","hasSenderName","senderLabel","senderValue","printContent","formatNumberEnglish","printWindow","handleDelete","Receipt","Store","SenderIcon","User","ArrowRight","Printer","EditBalanceDialog","open","onOpenChange","onSuccess","title","description","currentBalance","balanceLabel","userId","pin","setPin","newAmount","setNewAmount","showPin","setShowPin","setError","handleSubmit","MasterPinService","handleClose","React","Label","EyeOff","Lock","SecurityService","encodedPin","savedPin","__publicField","ChangePinDialog","currentPin","setCurrentPin","newPin","setNewPin","confirmPin","setConfirmPin","showCurrentPin","setShowCurrentPin","showNewPin","setShowNewPin","showConfirmPin","setShowConfirmPin","hasExistingPin","cashPinsCache","ChangeCashPinDialog","CASH_PIN_KEY","verifyCurrentPin","saveNewPin","walletTotalPinsCache","ChangeWalletTotalPinDialog","WALLET_TOTAL_PIN_KEY","AddToWalletDialog","setAmount","operationType","setOperationType","hasMasterPin","setHasMasterPin","mounted","has","amountValue","finalAmount","getNewBalance","Minus","isValidId","walletLimitsService","limitsRef","doc","db","limitsSnap","getDoc","Timestamp","newUsage","setDoc","serverTimestamp","usage","txQuery","query","collection","where","txSnap","getDocs","used_transfer","used_withdraw","tx","calculatedUsage","remaining","currentUsage","canPerform","newUsedTransfer","newUsedWithdraw","ref","updatedUsage","resetUsage","merchantUserId","usagePromises","useReadIdsKey","NotificationBell","className","profile","isSubscriptionActive","location","useLocation","notifications","setNotifications","readIds","setReadIds","queueOpen","setQueueOpen","queueReason","setQueueReason","queueSubmitting","setQueueSubmitting","queueMessage","setQueueMessage","queueLatestStatus","setQueueLatestStatus","flyAlert","setFlyAlert","flyVisible","setFlyVisible","prevIdsRef","useRef","isFirstFetchRef","flyTimerRef","triggerRef","flyNodeRef","flyStyle","setFlyStyle","audienceKeys","useMemo","keys","storageKey","canShowNotifications","onPendingApprovalPage","arr","fetchNotifications","subscribeToActiveBroadcastsList","list","freshThreshold","oldIds","createdAt","handleOneSignalNotification","event","notif","instantBroadcast","OneSignal","ids","newItems","unreadCount","acc","markAsRead","next","markAllAsRead","openLink","url","isAndroid","Capacitor","isApk","deeplink","updateFlyPosition","rect","margin","width","top","left","viewportWidth","handler","q","docs","d","ta","_c","_e","_d","_f","latest","contacted","DropdownMenu","DropdownMenuTrigger","Bell","DropdownMenuContent","DropdownMenuLabel","DropdownMenuSeparator","isUnread","ExternalLink","createPortal","CalculatorDialog","display","setDisplay","previousValue","setPreviousValue","operation","setOperation","waitingForOperand","setWaitingForOperand","inputNumber","inputOperation","nextOperation","inputValue","newValue","calculate","firstValue","secondValue","performCalculation","clearAll","clearEntry","inputDecimal","toggleSign","percentage","value","handleKeyPress","key","Calculator","SalesDataDialog","initialBarcode","salesData","setSalesData","newProduct","setNewProduct","isAddProductOpen","setIsAddProductOpen","editingId","setEditingId","isShiftActive","shiftUser","useShift","shopIdCtx","useShop","shopProducts","setShopProducts","sellingQtyByProduct","setSellingQtyByProduct","addQtyByProduct","setAddQtyByProduct","serialByProduct","setSerialByProduct","scannedBarcode","setScannedBarcode","isInvoiceMode","setIsInvoiceMode","invoiceSelections","setInvoiceSelections","isWholesaleVisible","setIsWholesaleVisible","isProfitLocked","setIsProfitLocked","isProfitPinDialogOpen","setIsProfitPinDialogOpen","barcodeBufferRef","lastKeyTimeRef","monthlySalesTotal","setMonthlySalesTotal","monthlyProfitTotal","setMonthlyProfitTotal","isMobileStatsOpen","setIsMobileStatsOpen","isMonthlyLocked","setIsMonthlyLocked","isMonthlyCollapsed","setIsMonthlyCollapsed","isSalesReceiptsDialogOpen","setIsSalesReceiptsDialogOpen","isProductStatsCollapsed","setIsProductStatsCollapsed","isTipsCollapsed","setIsTipsCollapsed","sellingPriceOverrideByProduct","setSellingPriceOverrideByProduct","isMasterPinActionOpen","setIsMasterPinActionOpen","masterPinActionTitle","setMasterPinActionTitle","masterPinActionDescription","setMasterPinActionDescription","protectedActionRef","requireMasterPin","action","customers","setCustomers","isDeferredFormOpen","setIsDeferredFormOpen","deferredCustomerId","setDeferredCustomerId","deferredCustomerName","setDeferredCustomerName","deferredCustomerMobile","setDeferredCustomerMobile","pendingDeferredProduct","setPendingDeferredProduct","userDataService","c","isDeleteConfirmOpen","setIsDeleteConfirmOpen","deleteTargetSale","setDeleteTargetSale","deleteActionType","setDeleteActionType","openDeleteConfirm","sale","productSearchTerm","setProductSearchTerm","filteredShopProducts","term","isAddQtyDialogOpen","setIsAddQtyDialogOpen","productToAddQty","setProductToAddQty","qtyToAdd","setQtyToAdd","handleOpenAddQtyDialog","product","handleAddQtyConfirm","newQty","updateDoc","loadSalesData","loadMonthlyStats","target","tag","code","processBarcode","loadShopProducts","shopId","savedProducts","parsed","snap","products","byUserAndShop","byUserOnly","fallbackProducts","byUser","missingShopProducts","original","migrationError","recoverUnsyncedSalesToFirestore","getLocalDateYYYYMMDD","y","m","dd","sortSales","it","dt","sid","allKey","savedAll","todayLocal","localKey","savedLocal","sorted","todayUtc","utcKey","savedUtc","syncSalesDataFromFirestore","saveSalesData","sortedDay","existingAllRaw","existingAll","byId","item","mergedAll","sortedAll","saveAllSalesData","todayCairo","snap1","snap2","q1","q2","remote","x","merged","start","end","toDateStr","startStr","endStr","sidMonthly","byUserShop","byUserShopNested","sales","profit","docSnap","dateStr","sellingPrice","qty","pr","saveSaleToFirebase","performedByType","performedByName","performedByUsername","docRef","addDoc","docRef2","getCashBalanceKey","updateSaleInFirebase","updatedFields","saleDoc","saleDoc2","markDeferredSalePaid","unsynced","existingSnap","existingQ","existingQ2","docId","addOutOfStockDeficiency","productName","safeList","exists","optimisticItem","updatedOptimistic","newItem","sellProduct","isDeferred","customer","qtyStr","serial","overrideStr","overridePrice","usedPrice","saleWithId","saleTotal","cashKey","savedCash","newCash","localDataKey","updateData","receiptRef","txToCloud","deleteSale","updatedDay","updatedAll","bgTasks","matched","deleteDoc","sellProductByBarcode","deleteProduct","createProduct","name","selling","wholesale","payload","trimmedBarcode","trimmedSerial","trimmed","printSelectedInvoice","items","prod","shopName","phone","invoiceTotal","rowsHtml","formatMoney","html","dailySalesOffset","setDailySalesOffset","dailyProfitOffset","setDailyProfitOffset","monthlySalesOffset","setMonthlySalesOffset","monthlyProfitOffset","setMonthlyProfitOffset","getStorageKeys","uid","date","month","savedDaily","savedMonthly","saveDailyOffsets","saveMonthlyOffsets","handleResetDailyStats","currentSales","currentProfit","handleResetMonthlyStats","RefreshCw","ChevronDown","ChevronUp","Tabs","TabsList","TabsTrigger","FileText","TabsContent","Search","v","Table","TableHeader","TableRow","TableHead","TableBody","TableCell","val","DialogDescription","mobile","userData","newDebt","telegramNotifier","tgt","sub","getUserSubscription","rawPlan","planStr","act","DialogFooter","CashSummaryDialog","cashBalance","walletBalances","accessorySalesToday","setAccessorySalesToday","ackAccessoryToday","setAckAccessoryToday","maintenanceTotalToday","setMaintenanceTotalToday","ackMaintenanceToday","setAckMaintenanceToday","localCashBalance","setLocalCashBalance","isReceiptPinOpen","setIsReceiptPinOpen","pendingReceiptType","setPendingReceiptType","isDeductReasonOpen","setIsDeductReasonOpen","deductReason","setDeductReason","isDeductPinOpen","setIsDeductPinOpen","isDeductAmountOpen","setIsDeductAmountOpen","deductAmount","setDeductAmount","formatCurrency","loadAccessorySales","todayStr","total","price","loadMaintenanceTotal","totalAmount","completedAt","repair","loadDailyReceipts","r","effectiveAccessoryToday","effectiveMaintenanceToday","handleReceipt","amountToAck","startDeductionFlow","confirmDeductReason","openDeductAmount","performDeduction","amt","timestamp","ArrowRightLeft","FawryMachineIcon","size","props","ROOT_NAME","createAlertDialogContext","createContextScope","createDialogScope","useDialogScope","AlertDialog","__scopeAlertDialog","alertDialogProps","dialogScope","DialogPrimitive.Root","TRIGGER_NAME","AlertDialogTrigger","React.forwardRef","forwardedRef","triggerProps","DialogPrimitive.Trigger","PORTAL_NAME","AlertDialogPortal","portalProps","DialogPrimitive.Portal","OVERLAY_NAME","AlertDialogOverlay","overlayProps","DialogPrimitive.Overlay","CONTENT_NAME","AlertDialogContentProvider","useAlertDialogContentContext","Slottable","createSlottable","AlertDialogContent","children","contentProps","contentRef","React.useRef","composedRefs","useComposedRefs","cancelRef","DialogPrimitive.WarningProvider","TITLE_NAME","DialogPrimitive.Content","composeEventHandlers","DescriptionWarning","AlertDialogTitle","titleProps","DialogPrimitive.Title","DESCRIPTION_NAME","AlertDialogDescription","descriptionProps","DialogPrimitive.Description","ACTION_NAME","AlertDialogAction","actionProps","DialogPrimitive.Close","CANCEL_NAME","AlertDialogCancel","cancelProps","MESSAGE","React.useEffect","Root2","Portal2","Overlay2","Content2","Action","Cancel","Title2","Description2","AlertDialogPrimitive.Root","AlertDialogPrimitive.Portal","AlertDialogPrimitive.Overlay","cn","AlertDialogPrimitive.Content","AlertDialogHeader","AlertDialogPrimitive.Title","AlertDialogPrimitive.Description","AlertDialogPrimitive.Action","buttonVariants","AlertDialogPrimitive.Cancel","formatDateTime","iso","STORAGE_KEY_OPENING","STORAGE_KEY_OPENING_SNAPSHOT","MachineDailyDialog","getFallbackShopId","k","openingBase","setOpeningBase","openingAir","setOpeningAir","drawerCash","setDrawerCash","savedOpeningBase","setSavedOpeningBase","savedOpeningAir","setSavedOpeningAir","savedDrawerCash","setSavedDrawerCash","openingSnapshot","setOpeningSnapshot","isOpeningOpen","setIsOpeningOpen","isDeliverySectionOpen","setIsDeliverySectionOpen","deliveryBase","setDeliveryBase","deliveryAir","setDeliveryAir","netResult","setNetResult","receipts","setReceipts","transferReceipts","setTransferReceipts","transferDialogOpen","setTransferDialogOpen","wholesalePrice","setWholesalePrice","retailPrice","setRetailPrice","deductDialogOpen","setDeductDialogOpen","pendingTransfer","setPendingTransfer","machines","setMachines","selectedMachineId","setSelectedMachineId","newMachineName","setNewMachineName","transferServerHydrated","setTransferServerHydrated","deliveriesServerHydrated","setDeliveriesServerHydrated","keyOpening","keySnap","savedOpening","obj","savedSnap","getDocs2","col","savedId","cashierName","totalTransferProfit","totalWholesaleTransferred","handleClearTransferReceipts","handleClearMachineReceipts","handleDeleteMachineReceipt","handleResetOpening","handleAddOpening","base","air","dc","sid0","handleStartDelivery","handleDoDelivery","dBase","dAir","openingBaseForReceipt","openingAirForReceipt","openingSum","result","receipt","sid1","current","handleTransferConfirm","finalizeTransfer","from","stockDeductAmount","prevBase","prevAir","prevDrawer","newBase","newAir","totalDrawerAdded","newDrawer","sid2","machineRef","sidKey","resetDialogState","refreshMachineData","created","ded","keyDel","cachedDel","keyTrans","cachedTrans","nextOpen","baseRef","transSnap","delSnap","sidSel","useDebouncedValue","delay","debounced","setDebounced","MonthlyProfitDisplayDialog","setIsOpen","isAuthenticated","setIsAuthenticated","profitData","setProfitData","loadProfitData","visibleMonthly","reportsService","monthlyWithdrawProfit","monthlyTransferProfit","txDate","txForCalc","ProfitService","profits","isZeroPlan","localSub","rawLocal","planLocalStr","remoteSub","rawRemote","planRemoteStr","handleEyeClick","handlePinSuccess","ArrowDownLeft","MonthlyProfitEyeButton","ProfitPinDialog","setHasExistingPin","DailyProfitDisplayDialog","isPinDialogOpen","setIsPinDialogOpen","visibleDaily","dailyWithdrawProfit","dailyTransferProfit","DailyProfitEyeButton","WalletsListDialog","onSelectWallet","selectedWalletId","handleSelect","totalBalance","ScrollArea","balance","Check","CashierShiftModal","shiftStartAt","setShiftUser","startShift","endShift","signIn","setName","username","setUsername","password","setPassword","handoverDialogOpen","setHandoverDialogOpen","handoverMode","setHandoverMode","mainPassword","setMainPassword","mainAuthError","setMainAuthError","isVerifyingMain","setIsVerifyingMain","handoverSelectedUser","setHandoverSelectedUser","handoverPassword","setHandoverPassword","handoverError","setHandoverError","isHandoverProcessing","setIsHandoverProcessing","reportDialogOpen","setReportDialogOpen","reportTotals","setReportTotals","deficitChoice","setDeficitChoice","deficitAmount","setDeficitAmount","receivedDrawerFunds","setReceivedDrawerFunds","receivedWalletBalancesTotal","setReceivedWalletBalancesTotal","receivedWalletBalancesMap","setReceivedWalletBalancesMap","deliveredDrawerFunds","setDeliveredDrawerFunds","deliveredWalletBalancesTotal","setDeliveredWalletBalancesTotal","deliveredWalletBalancesMap","setDeliveredWalletBalancesMap","handoverTargetLabel","setHandoverTargetLabel","initialIntakeDialogOpen","setInitialIntakeDialogOpen","normalizeDigits","map","ch","getCashierUsersKey","users","setUsers","saved","legacy","cloudUsers","localUsers","planType","maxCashiers","authDialogOpen","setAuthDialogOpen","enteredPassword","setEnteredPassword","selectedUser","setSelectedUser","deliveryReports","setDeliveryReports","deliveryReportsDialogOpen","setDeliveryReportsDialogOpen","selectedDeliveryReport","setSelectedDeliveryReport","isDeliveryReportOpen","setIsDeliveryReportOpen","addUserDialogOpen","setAddUserDialogOpen","handleDeleteUser","usernameToDelete","isCurrentShiftUser","lastHandoverToAdmin","confirmMsg","u","handleAddUser","newUser","handleEndShift","computeShiftTotals","res","startTime","parseDate","inShiftWindow","isCompletedStatus","completed","reports","ad","saveShiftReceiptToRecent","totals","deficit","deficitAmt","initialDrawerFunds","initialWalletBalancesTotal","idx","drawer","isDrawerValid","isWalletsValid","email","ShiftProfileDialog","fetchCashierUsers","loadFromLocal","match","o","ChangeLogDialog","Wrench","Sparkles","WalletCashService","currentCashBalance","currentWalletBalances","limitCheck","available","totalAvailable","newWalletBalances","remainingAmount","newCashBalance","message","afterBalance","totalWalletBalance","defaultWallet","targetWallet","updateCashBalance","updateWalletBalances","preview","audioCtx","getAudioContext","AnyWindow","Ctx","scheduleNoiseBurst","ctx","durationMs","durationSec","bufferSize","buffer","i","source","filter","gain","scheduleToneSweep","startFreq","endFreq","osc","playVodafoneShakshan","strictValidateMsisdn","msisdn","normalized","GoogleBackupBar","loading","setLoading","setMessage","UserDashboardPage","formRef","formTranslateY","setFormTranslateY","submitTopUp","allowedEmail","userEmail","topupPhone","topupOperator","topupAmount","setTopupLoading","idToken","resp","setIsTopUpOpen","setTopupPhone","setTopupOperator","setTopupAmount","signOut","isVodafoneCashUser","params","useParams","queryClientHook","useQueryClient","isMobile","useIsMobile","isCashierModalOpen","setIsCashierModalOpen","isShiftProfileOpen","setIsShiftProfileOpen","isChangeLogOpen","setIsChangeLogOpen","isDeveloperInfoOpen","setIsDeveloperInfoOpen","branchDialogOpen","setBranchDialogOpen","branchRequestOpen","setBranchRequestOpen","branches","setBranches","managerNameInput","setManagerNameInput","branchNameInput","setBranchNameInput","branchEmailInput","setBranchEmailInput","loginPasswordInput","setLoginPasswordInput","branchLoading","setBranchLoading","branchLoginOpen","setBranchLoginOpen","branchLoginTarget","setBranchLoginTarget","branchLoginUsername","setBranchLoginUsername","branchLoginPassword","setBranchLoginPassword","branchAuthLoading","setBranchAuthLoading","branchDetailsOpen","setBranchDetailsOpen","branchDetailsLoading","setBranchDetailsLoading","selectedBranchDetails","setSelectedBranchDetails","showAddBranchForm","setShowAddBranchForm","branchesLoaded","setBranchesLoaded","appDownloads","setAppDownloads","getAppDownloads","runtimeDesktopVersion","setRuntimeDesktopVersion","api","appVersion","localVersion","isElectronEnv","subBranches","rootBranches","branchesRef","qRoot","fsQuery","allBranches","uniqueBranchesMap","uniqueBranches","branchEditOpen","setBranchEditOpen","selectedBranchToEdit","setSelectedBranchToEdit","editBranchName","setEditBranchName","editManagerName","setEditManagerName","editBranchEmail","setEditBranchEmail","editBranchLoading","setEditBranchLoading","openEditBranchDialog","branch","handleUpdateBranch","updates","fetchBranchDetails","userDocSnap","walletsSnap","debtsSnap","salesSnap","qMerchant","snapMerchant","snapSub","reportsData","reportsDailyProfit","reportsMonthlyProfit","walletBalancesMap","walletsTotal","debtsTotal","paid","outstanding","monthStr","todaySales","monthSales","todayProfit","monthProfit","totalSalesSection","adbDevices","setAdbDevices","selectedAdbDeviceId","setSelectedAdbDeviceId","Preferences","isDeviceConnected","ensureDeviceReadyBeforeSend","sel","usb","ip","wifiCandidate","wifiIp","devices","sendTransfer","receiverPhone","sw","getSelectedWalletObj","senderPhone","sendTransferFromWalletDeepLink","setIsPostConfirmPopupOpen","setIsPinModalOpen","msg","selectedSimSlotForTransfer","setSelectedSimSlotForTransfer","triggerSendTransferCode","lastUSSDTransfer","receiver","setUssdLoading","getUssdCodeBySender","openUssdDeepLink","readyId","decoratedId","pick","setLastDecoratedDeviceId","e2","maybeIp","lastDecoratedDeviceId","handlePinSubmit","deviceId","rawLink","devId","receiverDigits","amountInt","pinDigits","baseUrl","isUserActive","setIsUserActive","isCheckingActivation","setIsCheckingActivation","isShopExpensesDialogOpen","setIsShopExpensesDialogOpen","isShopExpensesPinDialogOpen","setIsShopExpensesPinDialogOpen","expenseName","setExpenseName","expenseAmount","setExpenseAmount","expenseNotes","setExpenseNotes","expenses","setExpenses","isExpenseDeductionChoiceOpen","setIsExpenseDeductionChoiceOpen","expenseDeductionSource","setExpenseDeductionSource","selectedWalletForExpense","setSelectedWalletForExpense","isReceiptsOpen","setIsReceiptsOpen","isReceiptsDialogOpen","setIsReceiptsDialogOpen","showActivationModal","setShowActivationModal","isDeficienciesDialogOpen","setIsDeficienciesDialogOpen","deficiencyName","setDeficiencyName","deficiencyQuantity","setDeficiencyQuantity","deficiencies","setDeficiencies","isOnFreeTrial","setIsOnFreeTrial","freeTrialHoursRemaining","setFreeTrialHoursRemaining","hasUsedFreeTrial","setHasUsedFreeTrial","setUserSubscription","branchPackage","setBranchPackage","isRefreshingSubscription","setIsRefreshingSubscription","setSenderPhone","setReceiverPhone","withdrawNote","setWithdrawNote","withdrawSenderName","setWithdrawSenderName","isQuickDebtOpen","setIsQuickDebtOpen","quickDebtName","setQuickDebtName","quickDebtAmount","setQuickDebtAmount","quickDebtNotes","setQuickDebtNotes","quickDebtCustomerId","setQuickDebtCustomerId","quickDebtInfo","setQuickDebtInfo","didCreateQuickDebt","setDidCreateQuickDebt","isWalletsDialogOpen","setIsWalletsDialogOpen","isWalletsPinDialogOpen","setIsWalletsPinDialogOpen","isWalletSelectionPinDialogOpen","setIsWalletSelectionPinDialogOpen","pendingSelectedWalletId","setPendingSelectedWalletId","manualCommission","setManualCommission","transferCommission","setTransferCommission","transferExtraFee","setTransferExtraFee","isMonthlyLimitWarnOpen","setIsMonthlyLimitWarnOpen","selectedQuickIcon","setSelectedQuickIcon","monthlyLimitWarnData","setMonthlyLimitWarnData","isWithdrawSenderNameInputEnabled","setIsWithdrawSenderNameInputEnabled","withRetry","arabicIndic","easternIndic","ai","ei","isCommissionAddMode","setIsCommissionAddMode","transactionType","setTransactionType","activeTab","setActiveTab","debts","setDebts","localTransactionsBuffer","recentTransactionsQuery","useQuery","orderBy","collection2","query2","where2","orderBy2","limit2","db2","filtered","rawType","deletedIds","deletedTransactions","active","getKey","seen","distinct","handleTransactionCreated","activeBuffer","bt","existsById","existsByRef","isOld","completedDebtIds","saveDebtsToStorage","dp","userVal","globalVal","defVal","isSalesDataOpen","setIsSalesDataOpen","pendingBarcode","setPendingBarcode","isWalletManagementOpen","setIsWalletManagementOpen","isWalletsListOpen","setIsWalletsListOpen","editingWalletForDropdown","setEditingWalletForDropdown","baseAmount","commissionCalc","ratePerThousand","manual","debtAmount","savedWalletsStr","parsedWallets","candidateId","getSelectedWalletKey","useLayoutEffect","preferredKey","anyWalletKey","savedSelected","walletToSelect","loadExpensesFromStorage","loadDeficienciesFromStorage","walletsQuery","merchantWalletService2","savedSelectedWallet","handleExternalUpdate","newTransaction","limitUpdate","delta","commission","comm","setCashBalance","change","newVal","existing","setHasLocalDataToSync","setWalletBalances","currentVal","walletKey","getWalletBalancesKey","setSelectedWalletLimits","isTransfer","newLimits","walletSearch","setWalletSearch","filteredWallets","selectedTransaction","setSelectedTransaction","isTransactionDetailsOpen","setIsTransactionDetailsOpen","isReceiptOpen","setIsReceiptOpen","receiptTransaction","setReceiptTransaction","dailyStats","setDailyStats","monthlyStatsArray","setMonthlyStatsArray","isResetDialogOpen","setIsResetDialogOpen","resetType","setResetType","setDeletedTransactions","isRealtimeActive","setIsRealtimeActive","deletedEffectsAppliedRef","transactionsRef","applyLocalDeleteEffects","savedWallets","amountVal","opType","handleDeleteReceipt","transactionId","idStr","refStr","alreadyApplied","updatedTransactions","auditLogService","handleCompleteReceipt","plan","dailyOperationCountService","limitErr","originalId","txnId","refId","calculateDailyStats","searchPhone","setSearchPhone","debouncedSearchPhone","selectedDate","setSelectedDate","selectedTime","setSelectedTime","reportSearchPhone","setReportSearchPhone","isTransferSuccess","setIsTransferSuccess","isWithdrawSuccess","setIsWithdrawSuccess","isPostConfirmPopupOpen","postConfirmInfo","setPostConfirmInfo","setLastUSSDTransfer","ussdLoading","isPinModalOpen","isCalculatorOpen","setIsCalculatorOpen","showDesktopQuickIcons","isInstallmentPinOpen","setIsInstallmentPinOpen","isInstallmentModalOpen","setIsInstallmentModalOpen","isCreditCardsOpen","setIsCreditCardsOpen","isMaintenanceOpen","setIsMaintenanceOpen","isMachineDailyDialogOpen","setIsMachineDailyDialogOpen","areReportsCollapsed","setAreReportsCollapsed","isMonthlyPinDialogOpen","setIsMonthlyPinDialogOpen","isTelegramOpen","setIsTelegramOpen","telegramChatId","setTelegramChatId","telegramDailyEnabled","setTelegramDailyEnabled","isVipOpen","setIsVipOpen","isDailyLocked","setIsDailyLocked","isDailyPinDialogOpen","setIsDailyPinDialogOpen","isDebtsDialogOpen","setIsDebtsDialogOpen","isDebtsPasswordDialogOpen","setIsDebtsPasswordDialogOpen","isDebtsPinRequired","setIsDebtsPinRequired","isDebtsPinToggleOpen","setIsDebtsPinToggleOpen","pendingDebtsPinValue","setPendingDebtsPinValue","debtorName","setDebtorName","setDebtAmount","debtReason","setDebtReason","debtRole","setDebtRole","selectedDebt","setSelectedDebt","isDebtReceiptOpen","setIsDebtReceiptOpen","isDebtAdjustDialogOpen","setIsDebtAdjustDialogOpen","debtAdjustType","setDebtAdjustType","debtAdjustAmount","setDebtAdjustAmount","pendingDebtAdjustment","setPendingDebtAdjustment","isDebtsPinDialogOpen","setIsDebtsPinDialogOpen","isPartialPaymentOpen","setIsPartialPaymentOpen","partialPaymentAmount","setPartialPaymentAmount","isDebtReceiptsListOpen","setIsDebtReceiptsListOpen","debtsPage","setDebtsPage","DEBTS_PAGE_SIZE","visibleDebts","openDebts","hasPin","loadDebtsFromStorage","isAddCustomerDialogOpen","setIsAddCustomerDialogOpen","newCustomerName","setNewCustomerName","newCustomerMobile","setNewCustomerMobile","selectedCustomerId","setSelectedCustomerId","customerDebtAmount","setCustomerDebtAmount","isEditCustomerDialogOpen","setIsEditCustomerDialogOpen","editingCustomerId","setEditingCustomerId","editingCustomerName","setEditingCustomerName","editingCustomerMobile","setEditingCustomerMobile","isDeleteCustomerConfirmOpen","setIsDeleteCustomerConfirmOpen","customerToDeleteId","setCustomerToDeleteId","customerToDeleteName","setCustomerToDeleteName","isDebtDeductionChoiceOpen","setIsDebtDeductionChoiceOpen","pendingDebtToCreate","setPendingDebtToCreate","deductionSource","setDeductionSource","selectedWalletForDeduction","setSelectedWalletForDeduction","isPaymentCreditChoiceOpen","setIsPaymentCreditChoiceOpen","paymentAmountPending","setPaymentAmountPending","paymentCreditSource","setPaymentCreditSource","selectedWalletForPaymentCredit","setSelectedWalletForPaymentCredit","selectedWalletLimits","selectedWalletName","setSelectedWalletName","debtsToSave","serialized","getDebtsKey","getDebtsDefaultKey","getDebtsLastWriteKey","promises","localUserKey","localDefaultKey","localLastWriteKey","localByUser","localByDefault","lastWriteStr","lastWriteMs","parseDebts","listStr","debt","localDebts","migrated","debtsUnsyncedKey","hasDebtsUnsynced","collectionDebts","fbDebts","json","msisdns","unsubscribe","onSnapshot","snapshot","isActive","trialValidity","FreeTrialService","isOnTrial","shouldShowModal","fetchSubscriptionData","subscriptionData","isRefreshing","setIsRefreshing","isDatePickerOpen","setIsDatePickerOpen","isEditCashDialogOpen","setIsEditCashDialogOpen","isEditWalletDialogOpen","setIsEditWalletDialogOpen","isAddToWalletDialogOpen","setIsAddToWalletDialogOpen","isResetSelectedWalletDialogOpen","setIsResetSelectedWalletDialogOpen","resetSelectedWalletPinInput","setResetSelectedWalletPinInput","isResetRecentDialogOpen","setIsResetRecentDialogOpen","isCashAmountDialogOpen","setIsCashAmountDialogOpen","cashAmountInput","setCashAmountInput","isTopUpOpen","topupLoading","isYourReportsOpen","setIsYourReportsOpen","isReportsPinOpen","setIsReportsPinOpen","reportArchives","setReportArchives","dailyReportsArchiveService","getCustomersKey","getExpensesKey","saveExpensesToStorage","permanentlyDeleteExpense","expenseId","doc2","deleteDoc2","cloudErr","finalList","timeA","getDeficienciesKey","newKey","oldKey","oldRaw","newRaw","oldList","newList","saveDeficienciesToStorage","currentShopId","saveCustomersToStorage","loadCustomersFromStorage","userDoc","firebaseCustomers","getTransactionsKey","getTransactionKey","createdAtMs","transactionsData","refetchTransactions","cashPinInput","setCashPinInput","editingWalletId","setEditingWalletId","isShiftHandoverAllowed","valid","isSubscriptionValid","allowedPlan","isTahweelaPlan","handleOpenShiftProfile","isEditCashBalanceOpen","setIsEditCashBalanceOpen","isChangePinDialogOpen","setIsChangePinDialogOpen","isChangeCashPinDialogOpen","setIsChangeCashPinDialogOpen","isChangeWalletTotalPinDialogOpen","setIsChangeWalletTotalPinDialogOpen","isAddCashDialogOpen","setIsAddCashDialogOpen","addCashAmountInput","setAddCashAmountInput","addCashPinInput","setAddCashPinInput","isAddingCash","setIsAddingCash","addCashNoteEnabled","setAddCashNoteEnabled","addCashNoteText","setAddCashNoteText","isCashSummaryOpen","setIsCashSummaryOpen","isCashSummaryPinDialogOpen","setIsCashSummaryPinDialogOpen","isAddWalletTotalDialogOpen","setIsAddWalletTotalDialogOpen","addWalletTotalAmountInput","setAddWalletTotalAmountInput","addWalletTotalPinInput","setAddWalletTotalPinInput","isAddingWalletTotal","setIsAddingWalletTotal","syncLocalDataWithFirebase","localDataStr","localDebtsStr","localData","localDebtsRaw","toJsDate","normalize","remoteDebtsRaw","remoteDebts","byIdRemote","ld","rd","rdPaid","ldPaid","rdStatus","ldStatus","take","recentResetConfig","setRecentResetConfig","keep","interval","last","effectiveTransactions","monthStart","nextMonthStart","hiddenCount","vipTop10","monthEnd","phoneRaw","toWaNumber","sendVipWhatsApp","composeTelegramDailySummary","txToday","totalOps","totalWithdrawn","totalSent","accessoriesSales","cairoDate","totalDebts","pp","deficienciesText","getFilteredTransactions","phoneQuery","selectedDateObj","hours","minutes","filterDateTime","nextHour","handleSendTelegramDailyReport","text","canSend","prevAt","isResetWalletTotalDialogOpen","setIsResetWalletTotalDialogOpen","resetWalletTotalPinInput","setResetWalletTotalPinInput","isResetCashDialogOpen","setIsResetCashDialogOpen","resetCashPinInput","setResetCashPinInput","hasLocalDataToSync","isTelegramReportPinOpen","setIsTelegramReportPinOpen","fn","retries","delayMs","lastErr","verifyWalletTotalPin","inputPin","verifyCashDrawerPin","wbKeyNew","wbKeyOld","savedWalletBalances","cbKeyNew","cbKeyOld","legacyKey","savedCashBalance","dashboardData","cb","wbs","serverTime","localCashTime","localTime","getWalletLimitsCacheKey","wid","walletLimitsData","limitsObj","refreshSelectedWalletLimits","setWalletSelection","transactionSection","walletSelect","loadWalletsFromFirebase","userDocRef","docSnapshot","handleSubscriptionActivated","handleUserSubscriptionUpdated","handleGlobalShortcuts","remoteBalances","remoteCash","remoteTs","localCashTsStr","localWalletsTsStr","localCashTs","localWalletsTs","firebaseDeletedTransactions","formattedWallets","userTransactions","transactionsWithDates","deletedTransactionIds","permanentDeletedKeys","permQ","permSet","activeTransactions","txId","txTxnId","txRef","inDeleted","blockedByPerm","loadUserData","autoMonthlyDbCleanup","autoResetLimits","autoResetReports","dayDate","baseDateStr","dayTransactions","totalTransactions","reportDateStr","resetResult","utDocs","q1fb","gDocs","q2fb","savedWallet","currentPath","handleWindowFocus","handleWalletChange","walletSelectionPinService","handleTransactionTypeChange","onKeyDown","btn","handleTransactionClick","short","handleDeleteTransaction","transactionToDelete","txKey","refKey","saveError","updatedDeletedTransactions","fromWalletId","update","setDoc2","ReportsService","transactionData","errorMessage","dateOverride","sameDay","visibleTransactions","calculateMonthlyStats","visibleMonthlyTransactions","totalTransferred","currentMonthlyStats","walletMonthlyUsageMemo","selectedWalletObj","amountNum","predictedMonthlyWithdrawUsed","predictedMonthlyTransferUsed","percent","withdrawThreshold","transferThreshold","monthKey","warnKeyBase","handleTransaction","setSuccessOptimistic","revertSuccess","yyyy","mm","dailyKey","usedCountRaw","walletUsage","validation","commissionAmount","rate","effectiveAmount","isDeferredTransfer","isDeferredWithdraw","skipProcess","linkedDebtId","sDigits","rDigits","is010To011","extraFee","fullCommission","currentWalletBalance","totalDebit","check","effectiveSelectedWalletId","limitsSrc","pendingToday","dailyLimit","dailyUsed","pendingMonth","monthlyLimit","monthlyUsed","prevBalance","walletObj","previousBalance","updatedDebts","debtRef","addToCash","tempTransactionId","transactionDataCreateOptimistic","optimisticTransaction","oldData","updatedTransactionsList","usedCount","effectiveWalletId","remainingWalletBalance","srcPhone","dstPhone","hasFee","mark","commissionPart","feePart","shouldSend","prevMsg","transactionDataCreate","transactionDataForUser","createdTransactionId","updatedLimits","realTransaction","amountToReceive","amountToDeliver","dateFormatter","timeFormatter","totalOutstandingDebts","handleResetSuccess","hiddenIds","getResetDialogTitle","getResetDialogDescription","handleEditWalletBalance","handleEditCashSuccess","newBalance","dataRef","handleEditWalletBalanceSuccess","updatedBalances","handleAddToWalletSuccess","addedAmount","operationAmount","backupKeys","LogoLoader","ArrowUpDown","BadgePercent","BarChart","AlertTriangle","InstallmentModal","isShiftReceipt","isCashAddReceipt","ArrowUpRight","noteText","ReceiptModal","Code","Crown","ProfileIcon","MessageCircle","Switch","PlusCircle","manager","bname","pw","newUserId","shopIdNew","tempAppName","tempApp","initializeApp","firebaseConfig","tempAuth","getAuth","tempDb","getFirestore","createUserWithEmailAndPassword","shopError","subError","firebaseSignOut","deleteApp","safeEncode","branchData","fsSetDoc","fsDoc","newBranch","expectedUser","expectedPw","enc","viewBottom","needed","offset","WalletsManagement","walletMonthlyUsage","walletDailyUsage","dailyWithdrawUsed","dailyTransferUsed","predictedDailyWithdrawUsed","predictedDailyTransferUsed","dest","amountEl","commissionEl","quickBtn","swInner","commissionPerThousand","debtVal","manualFixed","manualEl","submitBtn","selected","amountToSave","selectedCustomer","currentTotal","walletIds","amountPerWallet","ratio","additionalAmount","amountToAdd","CreditCardsDialog","MaintenanceDialog","todayTx","st","reportDate","nextVal","PasswordConfirmDialog","resetAt","toDelete","cfg","cleared","newCustomer","totalDebt","ex","newExpenseId","addDoc2","serverTimestamp2","newExpense","updatedExpenses","updateDoc2","isAdjustment","isDecrease","newCashBalanceValue","newWalletBalancesValue","didUpdateCash","didUpdateWallet","finalSelectedDebt","didUpdateDebts","currentAmount","becamePaid","q3","snap3","batch","writeBatch","batchCount","processSnap","txnData","stillPaid","updatePayload","syncPromises","dashPayload","related","principal","totalDue","remainingBefore","newPaidTotal","isFullyPaid","ids2","ids3","updatedArr","payAmount","computedRemaining","baseAmt","prevPaid","createReceipt","method","sentAmt","PinModal","BranchRequestDialog"],"ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,30],"sources":["../../node_modules/lucide-react/dist/esm/icons/banknote.js","../../node_modules/lucide-react/dist/esm/icons/building.js","../../node_modules/lucide-react/dist/esm/icons/calendar-days.js","../../node_modules/lucide-react/dist/esm/icons/circle-plus.js","../../node_modules/lucide-react/dist/esm/icons/id-card.js","../../node_modules/lucide-react/dist/esm/icons/info.js","../../node_modules/lucide-react/dist/esm/icons/list-checks.js","../../node_modules/lucide-react/dist/esm/icons/notebook.js","../../node_modules/lucide-react/dist/esm/icons/package.js","../../node_modules/lucide-react/dist/esm/icons/rotate-ccw.js","../../node_modules/lucide-react/dist/esm/icons/scan-barcode.js","../../node_modules/lucide-react/dist/esm/icons/send.js","../../node_modules/lucide-react/dist/esm/icons/trending-down.js","../../src/integrations/firebase/functions.ts","../../src/components/WalletsViewPage.tsx","../../src/components/WalletDetailsPage.tsx","../../src/components/WalletManagement.tsx","../../src/components/TransactionDetailsModal.tsx","../../src/components/EditBalanceDialog.tsx","../../src/utils/securityService.ts","../../src/components/ChangePinDialog.tsx","../../src/components/ChangeCashPinDialog.tsx","../../src/components/ChangeWalletTotalPinDialog.tsx","../../src/components/AddToWalletDialog.tsx","../../src/utils/walletLimitsService.ts","../../src/components/NotificationBell.tsx","../../src/components/CalculatorDialog.tsx","../../src/components/SalesDataDialog.tsx","../../src/components/CashSummaryDialog.tsx","../../src/components/icons/FawryMachineIcon.tsx","../../node_modules/@radix-ui/react-alert-dialog/dist/index.mjs","../../src/components/ui/alert-dialog.tsx","../../src/components/MachineDailyDialog.tsx","../../src/hooks/useDebouncedValue.ts","../../src/components/MonthlyProfitDisplayDialog.tsx","../../src/components/ProfitPinDialog.tsx","../../src/components/DailyProfitDisplayDialog.tsx","../../src/components/WalletsListDialog.tsx","../../src/components/CashierShiftModal.tsx","../../src/components/ShiftProfileDialog.tsx","../../src/components/ChangeLogDialog.tsx","../../src/utils/walletCashService.ts","../../src/utils/sound.ts","../../src/utils/walletValidation.ts","../../src/pages/UserDashboardPage.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"rect\", { width: \"20\", height: \"12\", x: \"2\", y: \"6\", rx: \"2\", key: \"9lu3g6\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"2\", key: \"1c9p78\" }],\n  [\"path\", { d: \"M6 12h.01M18 12h.01\", key: \"113zkx\" }]\n];\nconst Banknote = createLucideIcon(\"banknote\", __iconNode);\n\nexport { __iconNode, Banknote as default };\n//# sourceMappingURL=banknote.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 10h.01\", key: \"1nrarc\" }],\n  [\"path\", { d: \"M12 14h.01\", key: \"1etili\" }],\n  [\"path\", { d: \"M12 6h.01\", key: \"1vi96p\" }],\n  [\"path\", { d: \"M16 10h.01\", key: \"1m94wz\" }],\n  [\"path\", { d: \"M16 14h.01\", key: \"1gbofw\" }],\n  [\"path\", { d: \"M16 6h.01\", key: \"1x0f13\" }],\n  [\"path\", { d: \"M8 10h.01\", key: \"19clt8\" }],\n  [\"path\", { d: \"M8 14h.01\", key: \"6423bh\" }],\n  [\"path\", { d: \"M8 6h.01\", key: \"1dz90k\" }],\n  [\"path\", { d: \"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3\", key: \"cabbwy\" }],\n  [\"rect\", { x: \"4\", y: \"2\", width: \"16\", height: \"20\", rx: \"2\", key: \"1uxh74\" }]\n];\nconst Building = createLucideIcon(\"building\", __iconNode);\n\nexport { __iconNode, Building as default };\n//# sourceMappingURL=building.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M8 2v4\", key: \"1cmpym\" }],\n  [\"path\", { d: \"M16 2v4\", key: \"4m81vk\" }],\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"4\", rx: \"2\", key: \"1hopcy\" }],\n  [\"path\", { d: \"M3 10h18\", key: \"8toen8\" }],\n  [\"path\", { d: \"M8 14h.01\", key: \"6423bh\" }],\n  [\"path\", { d: \"M12 14h.01\", key: \"1etili\" }],\n  [\"path\", { d: \"M16 14h.01\", key: \"1gbofw\" }],\n  [\"path\", { d: \"M8 18h.01\", key: \"lrp35t\" }],\n  [\"path\", { d: \"M12 18h.01\", key: \"mhygvu\" }],\n  [\"path\", { d: \"M16 18h.01\", key: \"kzsmim\" }]\n];\nconst CalendarDays = createLucideIcon(\"calendar-days\", __iconNode);\n\nexport { __iconNode, CalendarDays as default };\n//# sourceMappingURL=calendar-days.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"M8 12h8\", key: \"1wcyev\" }],\n  [\"path\", { d: \"M12 8v8\", key: \"napkw2\" }]\n];\nconst CirclePlus = createLucideIcon(\"circle-plus\", __iconNode);\n\nexport { __iconNode, CirclePlus as default };\n//# sourceMappingURL=circle-plus.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 10h2\", key: \"8sgtl7\" }],\n  [\"path\", { d: \"M16 14h2\", key: \"epxaof\" }],\n  [\"path\", { d: \"M6.17 15a3 3 0 0 1 5.66 0\", key: \"n6f512\" }],\n  [\"circle\", { cx: \"9\", cy: \"11\", r: \"2\", key: \"yxgjnd\" }],\n  [\"rect\", { x: \"2\", y: \"5\", width: \"20\", height: \"14\", rx: \"2\", key: \"qneu4z\" }]\n];\nconst IdCard = createLucideIcon(\"id-card\", __iconNode);\n\nexport { __iconNode, IdCard as default };\n//# sourceMappingURL=id-card.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"M12 16v-4\", key: \"1dtifu\" }],\n  [\"path\", { d: \"M12 8h.01\", key: \"e9boi3\" }]\n];\nconst Info = createLucideIcon(\"info\", __iconNode);\n\nexport { __iconNode, Info as default };\n//# sourceMappingURL=info.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M13 5h8\", key: \"a7qcls\" }],\n  [\"path\", { d: \"M13 12h8\", key: \"h98zly\" }],\n  [\"path\", { d: \"M13 19h8\", key: \"c3s6r1\" }],\n  [\"path\", { d: \"m3 17 2 2 4-4\", key: \"1jhpwq\" }],\n  [\"path\", { d: \"m3 7 2 2 4-4\", key: \"1obspn\" }]\n];\nconst ListChecks = createLucideIcon(\"list-checks\", __iconNode);\n\nexport { __iconNode, ListChecks as default };\n//# sourceMappingURL=list-checks.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M2 6h4\", key: \"aawbzj\" }],\n  [\"path\", { d: \"M2 10h4\", key: \"l0bgd4\" }],\n  [\"path\", { d: \"M2 14h4\", key: \"1gsvsf\" }],\n  [\"path\", { d: \"M2 18h4\", key: \"1bu2t1\" }],\n  [\"rect\", { width: \"16\", height: \"20\", x: \"4\", y: \"2\", rx: \"2\", key: \"1nb95v\" }],\n  [\"path\", { d: \"M16 2v20\", key: \"rotuqe\" }]\n];\nconst Notebook = createLucideIcon(\"notebook\", __iconNode);\n\nexport { __iconNode, Notebook as default };\n//# sourceMappingURL=notebook.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z\",\n      key: \"1a0edw\"\n    }\n  ],\n  [\"path\", { d: \"M12 22V12\", key: \"d0xqtd\" }],\n  [\"polyline\", { points: \"3.29 7 12 12 20.71 7\", key: \"ousv84\" }],\n  [\"path\", { d: \"m7.5 4.27 9 5.15\", key: \"1c824w\" }]\n];\nconst Package = createLucideIcon(\"package\", __iconNode);\n\nexport { __iconNode, Package as default };\n//# sourceMappingURL=package.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\", key: \"1357e3\" }],\n  [\"path\", { d: \"M3 3v5h5\", key: \"1xhq8a\" }]\n];\nconst RotateCcw = createLucideIcon(\"rotate-ccw\", __iconNode);\n\nexport { __iconNode, RotateCcw as default };\n//# sourceMappingURL=rotate-ccw.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 7V5a2 2 0 0 1 2-2h2\", key: \"aa7l1z\" }],\n  [\"path\", { d: \"M17 3h2a2 2 0 0 1 2 2v2\", key: \"4qcy5o\" }],\n  [\"path\", { d: \"M21 17v2a2 2 0 0 1-2 2h-2\", key: \"6vwrx8\" }],\n  [\"path\", { d: \"M7 21H5a2 2 0 0 1-2-2v-2\", key: \"ioqczr\" }],\n  [\"path\", { d: \"M8 7v10\", key: \"23sfjj\" }],\n  [\"path\", { d: \"M12 7v10\", key: \"jspqdw\" }],\n  [\"path\", { d: \"M17 7v10\", key: \"578dap\" }]\n];\nconst ScanBarcode = createLucideIcon(\"scan-barcode\", __iconNode);\n\nexport { __iconNode, ScanBarcode as default };\n//# sourceMappingURL=scan-barcode.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z\",\n      key: \"1ffxy3\"\n    }\n  ],\n  [\"path\", { d: \"m21.854 2.147-10.94 10.939\", key: \"12cjpa\" }]\n];\nconst Send = createLucideIcon(\"send\", __iconNode);\n\nexport { __iconNode, Send as default };\n//# sourceMappingURL=send.js.map\n","/**\n * @license lucide-react v0.561.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 17h6v-6\", key: \"t6n2it\" }],\n  [\"path\", { d: \"m22 17-8.5-8.5-5 5L2 7\", key: \"x473p\" }]\n];\nconst TrendingDown = createLucideIcon(\"trending-down\", __iconNode);\n\nexport { __iconNode, TrendingDown as default };\n//# sourceMappingURL=trending-down.js.map\n","import { getFunctions, httpsCallable } from 'firebase/functions';\r\nimport { functions } from '../../firebase';\r\nimport { Transaction } from './types';\r\n\r\n//      \r\ninterface GetLastTransactionsData {\r\n  limit?: number;\r\n  walletId?: string;\r\n  lineId?: string;\r\n  merchantUserId?: string;\r\n}\r\n\r\n//      \r\ninterface GetLastTransactionsResult {\r\n  transactions: Transaction[];\r\n}\r\n\r\n//    \r\ninterface CancelTransactionData {\r\n  transactionId: string;\r\n  reason: string;\r\n  cancelledBy: string;\r\n}\r\n\r\ninterface UpdateTransactionStatusData {\r\n  transactionId: string;\r\n  status: 'pending' | 'completed' | 'failed' | 'cancelled';\r\n  updatedBy: string;\r\n  note?: string;\r\n}\r\n\r\n//    \r\ninterface CancelTransactionResult {\r\n  success: boolean;\r\n  message?: string;\r\n}\r\n\r\ninterface UpdateTransactionStatusResult {\r\n  success: boolean;\r\n  message?: string;\r\n}\r\n\r\n//   Functions  \r\n// const functions = getFunctions(app); //    firebase.ts\r\n\r\n//    \r\ninterface RecordTransactionData {\r\n  lineId: string;\r\n  walletId: string;\r\n  txnType: 'send' | 'receive';\r\n  amount: number;\r\n  senderMsisdn?: string;\r\n  receiverMsisdn?: string;\r\n  reference?: string;\r\n  fee?: number;\r\n}\r\n\r\n//    \r\ninterface RecordTransactionResult {\r\n  id: string;\r\n  shopId: string;\r\n  lineId: string;\r\n  walletId: string;\r\n  merchantUserId: string;\r\n  provider: string;\r\n  txnType: 'send' | 'receive';\r\n  amount: number;\r\n  commission: number;\r\n  profit: number;\r\n  sender_msisdn: string;\r\n  receiver_msisdn: string;\r\n  reference: string | null;\r\n  status: 'confirmed';\r\n  createdAt: string;\r\n  fee?: number;\r\n}\r\n\r\n/**\r\n *     Cloud Function\r\n * @param data  \r\n * @returns   \r\n */\r\nexport const recordTransaction = async (data: RecordTransactionData): Promise<RecordTransactionResult> => {\r\n  try {\r\n    //   Cloud Function\r\n    const recordTransactionFn = httpsCallable<RecordTransactionData, RecordTransactionResult>(\r\n      functions,\r\n      'recordTransaction'\r\n    );\r\n\r\n    //  \r\n    const result = await recordTransactionFn(data);\r\n    \r\n    //  \r\n    return result.data;\r\n  } catch (error: any) {\r\n    console.error('Error recording transaction:', error);\r\n    \r\n    //      \r\n    if (error.code === 'functions/unauthenticated') {\r\n      throw new Error('    ');\r\n    } else if (error.code === 'functions/invalid-argument') {\r\n      throw new Error('   : ' + error.message);\r\n    } else if (error.code === 'functions/resource-exhausted') {\r\n      throw new Error('  : ' + error.message);\r\n    } else if (error.code === 'functions/failed-precondition') {\r\n      throw new Error('   : ' + error.message);\r\n    } else {\r\n      throw new Error('    : ' + (error.message || '  '));\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n *    Cloud Function\r\n * @param data   \r\n * @returns   \r\n */\r\nexport const cancelTransaction = async (data: CancelTransactionData): Promise<CancelTransactionResult> => {\r\n  try {\r\n    //   Cloud Function\r\n    const cancelTransactionFn = httpsCallable<CancelTransactionData, CancelTransactionResult>(\r\n      functions,\r\n      'cancelTransaction'\r\n    );\r\n\r\n    //  \r\n    const result = await cancelTransactionFn(data);\r\n    \r\n    //  \r\n    return result.data;\r\n  } catch (error: any) {\r\n    console.error('Error cancelling transaction:', error);\r\n    \r\n    //      \r\n    if (error.code === 'functions/unauthenticated') {\r\n      throw new Error('    ');\r\n    } else if (error.code === 'functions/invalid-argument') {\r\n      throw new Error('   : ' + error.message);\r\n    } else if (error.code === 'functions/not-found') {\r\n      throw new Error('  : ' + error.message);\r\n    } else if (error.code === 'functions/permission-denied') {\r\n      throw new Error('     : ' + error.message);\r\n    } else {\r\n      throw new Error('    : ' + (error.message || '  '));\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n *     Cloud Function\r\n * @param data   \r\n * @returns   \r\n */\r\n/**\r\n *      Cloud Function\r\n * @param data  \r\n * @returns   \r\n */\r\nexport const getLastTransactions = async (data: GetLastTransactionsData = {}): Promise<GetLastTransactionsResult> => {\r\n  try {\r\n    //   Cloud Function\r\n    const getLastTransactionsFn = httpsCallable<GetLastTransactionsData, GetLastTransactionsResult>(\r\n      functions,\r\n      'getLastTransactions'\r\n    );\r\n\r\n    //  \r\n    const result = await getLastTransactionsFn(data);\r\n    \r\n    //  \r\n    return result.data;\r\n  } catch (error: any) {\r\n    console.error('Error getting last transactions:', error);\r\n    \r\n    //      \r\n    if (error.code === 'functions/unauthenticated') {\r\n      throw new Error('     ');\r\n    } else if (error.code === 'functions/invalid-argument') {\r\n      throw new Error('   : ' + error.message);\r\n    } else if (error.code === 'functions/permission-denied') {\r\n      throw new Error('      : ' + error.message);\r\n    } else {\r\n      throw new Error('    : ' + (error.message || '  '));\r\n    }\r\n  }\r\n};\r\n\r\nexport const updateTransactionStatus = async (data: UpdateTransactionStatusData): Promise<UpdateTransactionStatusResult> => {\r\n  try {\r\n    //   Cloud Function\r\n    const updateStatusFn = httpsCallable<UpdateTransactionStatusData, UpdateTransactionStatusResult>(\r\n      functions,\r\n      'updateTransactionStatus'\r\n    );\r\n\r\n    //  \r\n    const result = await updateStatusFn(data);\r\n    \r\n    //  \r\n    return result.data;\r\n  } catch (error: any) {\r\n    console.error('Error updating transaction status:', error);\r\n    \r\n    //      \r\n    if (error.code === 'functions/unauthenticated') {\r\n      throw new Error('     ');\r\n    } else if (error.code === 'functions/invalid-argument') {\r\n      throw new Error('   : ' + error.message);\r\n    } else if (error.code === 'functions/not-found') {\r\n      throw new Error('  : ' + error.message);\r\n    } else if (error.code === 'functions/permission-denied') {\r\n      throw new Error('      : ' + error.message);\r\n    } else {\r\n      throw new Error('     : ' + (error.message || '  '));\r\n    }\r\n  }\r\n};\r\n\r\nexport const sendTelegramMessage = async (data: { chatId: string; text: string }): Promise<{ ok: boolean }> => {\r\n  const fn = httpsCallable<typeof data, { ok: boolean }>(functions, 'sendTelegramMessage');\r\n  const res = await fn(data);\r\n  return res.data;\r\n};\r\n\r\nexport const sendTelegramDailySummary = async (data: { userId?: string; chatId: string; text: string }): Promise<{ ok: boolean }> => {\r\n  return sendTelegramMessage({ chatId: data.chatId, text: data.text });\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Wallet, Phone, DollarSign, Star, CreditCard, TrendingUp, TrendingDown, ArrowLeft, IdCard, Building, Edit, Trash2 } from 'lucide-react';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { merchantWalletService, transactionService } from '@/integrations/firebase/services';\r\nimport walletDailyLimitsService from '@/utils/walletDailyLimitsService';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\ninterface Wallet {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  nationalId?: string;\r\n  isDefault: boolean;\r\n  isActive?: boolean;\r\n  monthlyWithdrawalLimit: number;\r\n  monthlyTransferLimit: number;\r\n  monthlyWithdrawalUsage?: number;\r\n  monthlyTransferUsage?: number;\r\n  lastResetDate?: string;\r\n  walletProvider?: string;\r\n}\r\n\r\ninterface WalletsViewPageProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onWalletSelect: (wallet: Wallet) => void;\r\n  onEditWallet?: (wallet: Wallet) => void;\r\n  onDeleteWallet?: (walletId: string) => void;\r\n}\r\n\r\n//   \r\nconst walletProviders = [\r\n  {\r\n    id: 'vodafone',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29012345678901'\r\n  },\r\n  {\r\n    id: 'etisalat',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '28506789012345'\r\n  },\r\n  {\r\n    id: 'orange',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29309876543210'\r\n  },\r\n  {\r\n    id: 'we_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29112345678901'\r\n  },\r\n  {\r\n    id: 'smart_wallet',\r\n    name: ' ',\r\n    ownerName: '   ',\r\n    nationalId: '28809876543210'\r\n  },\r\n  {\r\n    id: 'access_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29456789012345'\r\n  },\r\n  {\r\n    id: 'insta_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29012345678901'\r\n  }\r\n];\r\n\r\nconst WalletsViewPage: React.FC<WalletsViewPageProps> = ({ isOpen, onClose, onWalletSelect, onEditWallet, onDeleteWallet }) => {\r\n  const { user } = useFirebaseAuth();\r\n  const [wallets, setWallets] = useState<Wallet[]>([]);\r\n  const [selectMode, setSelectMode] = useState<boolean>(false);\r\n  const [selectedIds, setSelectedIds] = useState<string[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  //     localStorage  \r\n  const getWalletsKey = () => `wallets_${user?.uid || 'default'}`;\r\n\r\n  //          \r\n  const loadWalletsFromLocalWithMigration = (): any[] | null => {\r\n    try {\r\n      const currentKey = getWalletsKey();\r\n      const current = localStorage.getItem(currentKey);\r\n      if (current) {\r\n        const parsed = JSON.parse(current);\r\n        if (Array.isArray(parsed) && parsed.length > 0) return parsed;\r\n      }\r\n      const legacyDefaultKey = 'wallets_default';\r\n      const legacyDefault = localStorage.getItem(legacyDefaultKey);\r\n      if (legacyDefault) {\r\n        const parsed = JSON.parse(legacyDefault);\r\n        if (Array.isArray(parsed) && parsed.length > 0) {\r\n          localStorage.setItem(currentKey, legacyDefault);\r\n          try { localStorage.removeItem(legacyDefaultKey); } catch {}\r\n          return parsed;\r\n        }\r\n      }\r\n      const keys = Object.keys(localStorage).filter(k => k.startsWith('wallets_') && k !== currentKey);\r\n      let best: any[] | null = null;\r\n      let bestKey: string | null = null;\r\n      for (const k of keys) {\r\n        try {\r\n          const s = localStorage.getItem(k);\r\n          if (!s) continue;\r\n          const parsed = JSON.parse(s);\r\n          if (Array.isArray(parsed) && parsed.length > 0) {\r\n            if (!best || parsed.length > (best?.length || 0)) {\r\n              best = parsed;\r\n              bestKey = k;\r\n            }\r\n          }\r\n        } catch {}\r\n      }\r\n      if (best && bestKey) {\r\n        localStorage.setItem(currentKey, JSON.stringify(best));\r\n        try { localStorage.removeItem(bestKey); } catch {}\r\n        return best;\r\n      }\r\n    } catch (e) {\r\n      console.warn('WalletsViewPage migration failed:', e);\r\n    }\r\n    return null;\r\n  };\r\n\r\n  //     \r\n  const calculateWalletMonthlyUsage = async (walletId: string, transactions: any[]) => {\r\n    const currentMonth = new Date().getMonth();\r\n    const currentYear = new Date().getFullYear();\r\n    \r\n    const monthlyTransactions = transactions.filter(t => {\r\n      const transactionDate = new Date(t.createdAt);\r\n      return (\r\n        transactionDate.getMonth() === currentMonth && \r\n        transactionDate.getFullYear() === currentYear &&\r\n        //     (   )\r\n        (t.lineId === walletId || t.fromWallet === walletId)\r\n      );\r\n    });\r\n\r\n    //           \r\n    const isWithdrawTx = (t: any) => {\r\n      const type = t.type;\r\n      const xn = (t as any).txnType;\r\n      return (\r\n        xn === 'receive' ||\r\n        type === 'withdraw' ||\r\n        type === 'withdrawal' ||\r\n        type === 'receive'\r\n      );\r\n    };\r\n\r\n    const isSendTx = (t: any) => {\r\n      const type = t.type;\r\n      const xn = (t as any).txnType;\r\n      return (\r\n        xn === 'send' ||\r\n        type === 'send' ||\r\n        type === 'transfer'\r\n      );\r\n    };\r\n\r\n    const withdrawalUsage = monthlyTransactions\r\n      .filter(isWithdrawTx)\r\n      .reduce((sum, t) => {\r\n        const amount = (t as any).withdrawnAmount !== undefined ? (t as any).withdrawnAmount : t.amount;\r\n        return sum + (amount || 0);\r\n      }, 0);\r\n\r\n    const transferUsage = monthlyTransactions\r\n      .filter(isSendTx)\r\n      .reduce((sum, t) => {\r\n        const amount = (t as any).sentAmount !== undefined ? (t as any).sentAmount : t.amount;\r\n        return sum + (amount || 0);\r\n      }, 0);\r\n\r\n    return { withdrawalUsage, transferUsage };\r\n  };\r\n\r\n  //      \r\n  const checkAndResetMonthlyUsage = (wallet: Wallet): Wallet => {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const lastReset = wallet.lastResetDate;\r\n    \r\n    if (!lastReset) {\r\n      return {\r\n        ...wallet,\r\n        monthlyWithdrawalUsage: 0,\r\n        monthlyTransferUsage: 0,\r\n        lastResetDate: today\r\n      };\r\n    }\r\n\r\n    const lastResetDate = new Date(lastReset);\r\n    const currentDate = new Date();\r\n    \r\n    //      \r\n    if (lastResetDate.getMonth() !== currentDate.getMonth() || \r\n        lastResetDate.getFullYear() !== currentDate.getFullYear()) {\r\n      return {\r\n        ...wallet,\r\n        monthlyWithdrawalUsage: 0,\r\n        monthlyTransferUsage: 0,\r\n        lastResetDate: today\r\n      };\r\n    }\r\n\r\n    return wallet;\r\n  };\r\n\r\n  //  \r\n  useEffect(() => {\r\n    if (!user?.uid || !isOpen) return;\r\n\r\n    const loadWallets = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        const firebaseWallets = await merchantWalletService.getByMerchantId(user.uid);\r\n        const transactions = await transactionService.getByUserId(user.uid);\r\n        \r\n        const formattedWallets = await Promise.all(firebaseWallets.map(async w => {\r\n          const { withdrawalUsage, transferUsage } = await calculateWalletMonthlyUsage(w.id, transactions);\r\n          const limits = await walletDailyLimitsService.getWalletLimits(w.id);\r\n          return {\r\n            id: w.id,\r\n            name: w.label || '  ',\r\n            phone: w.msisdn,\r\n            nationalId: w.nationalId || '',\r\n            isDefault: false,\r\n            isActive: (w as any).isActive === true,\r\n            monthlyWithdrawalLimit: (limits?.monthlyWithdrawLimit ?? w.withdrawLimit ?? 200000),\r\n            monthlyTransferLimit: (limits?.monthlyTransferLimit ?? w.transferLimit ?? 200000),\r\n            monthlyWithdrawalUsage: (limits?.monthlyWithdrawUsed ?? withdrawalUsage ?? 0),\r\n            monthlyTransferUsage: (limits?.monthlyTransferUsed ?? transferUsage ?? 0),\r\n            lastResetDate: new Date().toISOString().split('T')[0],\r\n            walletProvider: (w.walletProvider || '')\r\n          };\r\n        }));\r\n        \r\n        const walletsWithResetCheck = formattedWallets.map(checkAndResetMonthlyUsage);\r\n        setWallets(walletsWithResetCheck);\r\n        \r\n      } catch (error) {\r\n        console.error('Error loading wallets:', error);\r\n        //          Firestore\r\n        toast({\r\n          title: '   ',\r\n          description: '      .      .           .',\r\n          variant: 'destructive'\r\n        });\r\n        \r\n        //              \r\n     } finally {\r\n       setIsLoading(false);\r\n     }\r\n    };\r\n\r\n    loadWallets();\r\n  }, [user?.uid, isOpen]);\r\n\r\n  //      \r\n  const getProviderInfo = (providerId: string) => {\r\n    return walletProviders.find(p => p.id === providerId);\r\n  };\r\n\r\n  //     \r\n  const getUsagePercentage = (used: number, limit: number) => {\r\n    return limit > 0 ? Math.min((used / limit) * 100, 100) : 0;\r\n  };\r\n\r\n  //   \r\n  const formatNumber = (num: number) => {\r\n    return new Intl.NumberFormat('ar-EG').format(num);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader className=\"pb-4\">\r\n          <DialogTitle className=\"flex items-center gap-2 text-lg\">\r\n            <Wallet className=\"h-5 w-5\" />\r\n               \r\n            <Badge variant=\"secondary\" className=\"mr-2\">\r\n              {wallets.length} \r\n            </Badge>\r\n          </DialogTitle>\r\n          <div className=\"flex items-center gap-2 mt-2\">\r\n            {!selectMode ? (\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => setSelectMode(true)}\r\n                className=\"h-7\"\r\n              >\r\n                 \r\n              </Button>\r\n            ) : (\r\n              <>\r\n                <Button\r\n                  size=\"sm\"\r\n                  onClick={async () => {\r\n                    try {\r\n                      if (!user?.uid) return;\r\n                      const ops = wallets.map(w => merchantWalletService.update(w.id, { isActive: selectedIds.includes(w.id) }));\r\n                      await Promise.all(ops);\r\n                      setWallets(prev => prev.map(w => ({ ...w, isActive: selectedIds.includes(w.id) })));\r\n                      setSelectMode(false);\r\n                      toast({ title: '  ', description: '      ' });\r\n                      try { window.dispatchEvent(new CustomEvent('wallets:activation-updated')); } catch {}\r\n                    } catch (e) {\r\n                      console.error('Error activating wallets:', e);\r\n                      toast({ title: ' ', description: '   ', variant: 'destructive' });\r\n                    }\r\n                  }}\r\n                  className=\"h-7\"\r\n                >\r\n                   \r\n                </Button>\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={() => { setSelectMode(false); setSelectedIds([]); }}\r\n                  className=\"h-7\"\r\n                >\r\n                  \r\n                </Button>\r\n              </>\r\n            )}\r\n          </div>\r\n        </DialogHeader>\r\n\r\n        {isLoading ? (\r\n          <div className=\"flex justify-center items-center py-8\">\r\n            <div className=\"text-center\">\r\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2\"></div>\r\n              <p className=\"text-sm text-gray-600\">  ...</p>\r\n            </div>\r\n          </div>\r\n        ) : wallets.length === 0 ? (\r\n          <div className=\"text-center py-8\">\r\n            <Wallet className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n            <p className=\"text-gray-600\">     </p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n            {wallets.map((wallet) => {\r\n              const providerInfo = getProviderInfo(wallet.walletProvider || '');\r\n              const withdrawalPercentage = getUsagePercentage(\r\n                wallet.monthlyWithdrawalUsage || 0,\r\n                wallet.monthlyWithdrawalLimit\r\n              );\r\n              const transferPercentage = getUsagePercentage(\r\n                wallet.monthlyTransferUsage || 0,\r\n                wallet.monthlyTransferLimit\r\n              );\r\n\r\n              const isSelected = selectedIds.includes(wallet.id);\r\n              const cardClasses = selectMode\r\n                ? `cursor-pointer transition-shadow border-2 ${isSelected ? 'border-blue-500 shadow-lg' : 'hover:border-blue-300'}`\r\n                : 'cursor-pointer hover:shadow-lg transition-shadow border-2 hover:border-blue-300';\r\n\r\n              return (\r\n                <Card \r\n                  key={wallet.id} \r\n                  className={cardClasses}\r\n                  onClick={() => {\r\n                    if (selectMode) {\r\n                      setSelectedIds(prev => prev.includes(wallet.id) ? prev.filter(id => id !== wallet.id) : [...prev, wallet.id]);\r\n                    } else {\r\n                      onWalletSelect(wallet);\r\n                    }\r\n                  }}\r\n                >\r\n                  <CardHeader className=\"pb-3\">\r\n                    <CardTitle className=\"flex items-center justify-between text-sm\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <CreditCard className=\"h-4 w-4\" />\r\n                        <span>{wallet.name}</span>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        {wallet.isActive && (\r\n                          <Badge variant=\"default\" className=\"text-xs\"></Badge>\r\n                        )}\r\n                        {wallet.isDefault && (\r\n                          <Badge variant=\"default\" className=\"text-xs\">\r\n                            <Star className=\"h-3 w-3 mr-1\" />\r\n                            \r\n                          </Badge>\r\n                        )}\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            onEditWallet?.(wallet);\r\n                          }}\r\n                          className=\"h-7 px-2\"\r\n                        >\r\n                          <Edit className=\"h-4 w-4\" />\r\n                        </Button>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            onDeleteWallet?.(wallet.id);\r\n                          }}\r\n                          className=\"h-7 px-2 text-destructive hover:text-destructive\"\r\n                        >\r\n                          <Trash2 className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </div>\r\n                    </CardTitle>\r\n                  </CardHeader>\r\n                  \r\n                  <CardContent className=\"space-y-3\">\r\n                    {/*   */}\r\n                    <div className=\"space-y-2\">\r\n                      <div className=\"flex items-center gap-2 text-sm\">\r\n                        <Phone className=\"h-3 w-3 text-gray-500\" />\r\n                        <span className=\"font-mono\">{wallet.phone}</span>\r\n                      </div>\r\n                      \r\n                      {wallet.nationalId && (\r\n                        <div className=\"flex items-center gap-2 text-sm\">\r\n                          <IdCard className=\"h-3 w-3 text-gray-500\" />\r\n                          <span className=\"font-mono\">{wallet.nationalId}</span>\r\n                        </div>\r\n                      )}\r\n                      \r\n                      {providerInfo && (\r\n                        <div className=\"flex items-center gap-2 text-sm\">\r\n                          <Building className=\"h-3 w-3 text-gray-500\" />\r\n                          <span>{providerInfo.name}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/*        */}\r\n                    {(() => {\r\n                      const monthlyWithdrawalLimit = wallet.monthlyWithdrawalLimit;\r\n                      const monthlyTransferLimit = wallet.monthlyTransferLimit;\r\n                      const monthlyWithdrawUsed = wallet.monthlyWithdrawalUsage || 0;\r\n                      const monthlyTransferUsed = wallet.monthlyTransferUsage || 0;\r\n                      const remainingWithdraw = Math.max(monthlyWithdrawalLimit - monthlyWithdrawUsed, 0);\r\n                      const remainingTransfer = Math.max(monthlyTransferLimit - monthlyTransferUsed, 0);\r\n\r\n                      return (\r\n                        <div className=\"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2\">\r\n                          <div className=\"text-xs text-gray-600 font-medium text-center\">\r\n                             : {providerInfo?.name || wallet.walletProvider} - {wallet.phone}\r\n                          </div>\r\n                          <div className=\"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex\">\r\n                            <div className=\"w-1/2 bg-red-200 relative\">\r\n                              <div\r\n                                className=\"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-200 ease-out shadow-sm\"\r\n                                style={{ width: `${Math.min(((monthlyWithdrawUsed / Math.max(monthlyWithdrawalLimit, 1)) * 100), 100)}%` }}\r\n                              ></div>\r\n                            </div>\r\n                            <div className=\"w-1/2 bg-blue-200 relative\">\r\n                              <div\r\n                                className=\"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-200 ease-out shadow-sm\"\r\n                                style={{ width: `${Math.min(((monthlyTransferUsed / Math.max(monthlyTransferLimit, 1)) * 100), 100)}%` }}\r\n                              ></div>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex justify-between items-center mt-1\">\r\n                            <div className=\"text-xs text-red-600 font-medium\">\r\n                               : {formatNumber(remainingWithdraw)} \r\n                            </div>\r\n                            <div className=\"text-xs text-blue-600 font-medium\">\r\n                               : {formatNumber(remainingTransfer)} \r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })()}\r\n\r\n                    {/*    */}\r\n                    <Button \r\n                      variant=\"outline\" \r\n                      size=\"sm\" \r\n                      className=\"w-full text-xs\"\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        onWalletSelect(wallet);\r\n                      }}\r\n                    >\r\n                        \r\n                    </Button>\r\n                  </CardContent>\r\n                </Card>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"flex justify-end pt-4 border-t\">\r\n          <Button onClick={onClose} variant=\"outline\">\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n            \r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default WalletsViewPage;","import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { \r\n  Wallet, \r\n  Phone, \r\n  DollarSign, \r\n  Star, \r\n  CreditCard, \r\n  TrendingUp, \r\n  TrendingDown, \r\n  ArrowLeft, \r\n  IdCard, \r\n  Building, \r\n  Calendar,\r\n  Activity,\r\n  BarChart3,\r\n  Clock,\r\n  CheckCircle,\r\n  XCircle,\r\n  AlertCircle\r\n} from 'lucide-react';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { transactionService } from '@/integrations/firebase/services';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { calculateProfit } from '@/utils/commissionCalculator';\r\n\r\ninterface Wallet {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  nationalId?: string;\r\n  isDefault: boolean;\r\n  monthlyWithdrawalLimit: number;\r\n  monthlyTransferLimit: number;\r\n  monthlyWithdrawalUsage?: number;\r\n  monthlyTransferUsage?: number;\r\n  lastResetDate?: string;\r\n  walletProvider?: string;\r\n}\r\n\r\ninterface Transaction {\r\n  id: string;\r\n  type: 'withdrawal' | 'transfer' | 'deposit';\r\n  amount: number;\r\n  status: 'completed' | 'pending' | 'failed';\r\n  createdAt: string;\r\n  description?: string;\r\n  walletId: string;\r\n}\r\n\r\ninterface WalletDetailsPageProps {\r\n  wallet: Wallet | null;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onBack: () => void;\r\n}\r\n\r\n//   \r\nconst walletProviders = [\r\n  {\r\n    id: 'vodafone',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29012345678901'\r\n  },\r\n  {\r\n    id: 'etisalat',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '28506789012345'\r\n  },\r\n  {\r\n    id: 'orange',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29309876543210'\r\n  },\r\n  {\r\n    id: 'we_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29112345678901'\r\n  },\r\n  {\r\n    id: 'smart_wallet',\r\n    name: ' ',\r\n    ownerName: '   ',\r\n    nationalId: '28809876543210'\r\n  },\r\n  {\r\n    id: 'access_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29456789012345'\r\n  },\r\n  {\r\n    id: 'insta_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29012345678901'\r\n  }\r\n];\r\n\r\nconst WalletDetailsPage: React.FC<WalletDetailsPageProps> = ({ wallet, isOpen, onClose, onBack }) => {\r\n  const { user } = useFirebaseAuth();\r\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [selectedPeriod, setSelectedPeriod] = useState<'week' | 'month' | 'all'>('month');\r\n  const { toast } = useToast();\r\n\r\n  //  \r\n  useEffect(() => {\r\n    if (!wallet || !user?.uid || !isOpen) return;\r\n\r\n    const loadTransactions = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        const allTransactions = await transactionService.getByUserId(user.uid);\r\n        const walletTransactions = allTransactions\r\n          .filter(t => t.walletId === wallet.id)\r\n          .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n        \r\n        setTransactions(walletTransactions);\r\n      } catch (error) {\r\n        console.error('Error loading transactions:', error);\r\n        toast({\r\n          title: '   ',\r\n          description: '     Firestore  .     .        .',\r\n          variant: 'destructive'\r\n        });\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    loadTransactions();\r\n  }, [wallet, user?.uid, isOpen]);\r\n\r\n  if (!wallet) return null;\r\n\r\n  //      \r\n  const getProviderInfo = (providerId: string) => {\r\n    return walletProviders.find(p => p.id === providerId);\r\n  };\r\n\r\n  //     \r\n  const getUsagePercentage = (used: number, limit: number) => {\r\n    return limit > 0 ? Math.min((used / limit) * 100, 100) : 0;\r\n  };\r\n\r\n  //   \r\n  const formatNumber = (num: number) => {\r\n    return new Intl.NumberFormat('ar-EG').format(num);\r\n  };\r\n\r\n  //   \r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('ar-EG', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  //     \r\n  const getFilteredTransactions = () => {\r\n    const now = new Date();\r\n    let startDate: Date;\r\n\r\n    switch (selectedPeriod) {\r\n      case 'week':\r\n        startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n        break;\r\n      case 'month':\r\n        startDate = new Date(now.getFullYear(), now.getMonth(), 1);\r\n        break;\r\n      default:\r\n        return transactions;\r\n    }\r\n\r\n    return transactions.filter(t => new Date(t.createdAt) >= startDate);\r\n  };\r\n\r\n  //  \r\n  const filteredTransactions = getFilteredTransactions();\r\n  //          \r\n  const isWithdrawTx = (t: any) => {\r\n    const type = t.type;\r\n    const xn = (t as any).txnType;\r\n    return (\r\n      type === 'withdraw' ||\r\n      type === 'withdrawal' ||\r\n      type === 'receive' ||\r\n      xn === 'receive'\r\n    );\r\n  };\r\n  const isSendTx = (t: any) => {\r\n    const type = t.type;\r\n    const xn = (t as any).txnType;\r\n    return (\r\n      type === 'send' ||\r\n      type === 'transfer' ||\r\n      xn === 'send'\r\n    );\r\n  };\r\n\r\n  const totalWithdrawals = filteredTransactions\r\n    .filter(t => isWithdrawTx(t) && t.status === 'completed')\r\n    .reduce((sum, t) => {\r\n      const amount = (t as any).withdrawnAmount !== undefined ? (t as any).withdrawnAmount : t.amount;\r\n      return sum + (amount || 0);\r\n    }, 0);\r\n  const totalTransfers = filteredTransactions\r\n    .filter(t => isSendTx(t) && t.status === 'completed')\r\n    .reduce((sum, t) => {\r\n      const amount = (t as any).sentAmount !== undefined ? (t as any).sentAmount : t.amount;\r\n      return sum + (amount || 0);\r\n    }, 0);\r\n  const totalDeposits = filteredTransactions\r\n    .filter(t => t.type === 'deposit' && t.status === 'completed')\r\n    .reduce((sum, t) => sum + t.amount, 0);\r\n\r\n  //       \r\n  const completedTransactions = filteredTransactions.filter(t => t.status === 'completed');\r\n  const operationsCount = completedTransactions.length;\r\n  const totalProfit = completedTransactions.reduce((sum, t: any) => {\r\n    if (isWithdrawTx(t)) {\r\n      const amount = t.withdrawnAmount ?? t.receivedAmount ?? t.amount ?? 0;\r\n      return sum + calculateProfit(Number(amount) || 0, 'receive');\r\n    }\r\n    if (isSendTx(t)) {\r\n      const amount = t.sentAmount ?? t.transferredAmount ?? t.amount ?? 0;\r\n      return sum + calculateProfit(Number(amount) || 0, 'send');\r\n    }\r\n    return sum;\r\n  }, 0);\r\n\r\n  const providerInfo = getProviderInfo(wallet.walletProvider || '');\r\n  const withdrawalPercentage = getUsagePercentage(\r\n    wallet.monthlyWithdrawalUsage || 0,\r\n    wallet.monthlyWithdrawalLimit\r\n  );\r\n  const transferPercentage = getUsagePercentage(\r\n    wallet.monthlyTransferUsage || 0,\r\n    wallet.monthlyTransferLimit\r\n  );\r\n\r\n  //      \r\n  const getTransactionIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'withdrawal':\r\n        return <TrendingDown className=\"h-4 w-4 text-red-500\" />;\r\n      case 'transfer':\r\n        return <TrendingUp className=\"h-4 w-4 text-blue-500\" />;\r\n      case 'deposit':\r\n        return <DollarSign className=\"h-4 w-4 text-green-500\" />;\r\n      default:\r\n        return <Activity className=\"h-4 w-4 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  //      \r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return <CheckCircle className=\"h-4 w-4 text-green-500\" />;\r\n      case 'pending':\r\n        return <Clock className=\"h-4 w-4 text-yellow-500\" />;\r\n      case 'failed':\r\n        return <XCircle className=\"h-4 w-4 text-red-500\" />;\r\n      default:\r\n        return <AlertCircle className=\"h-4 w-4 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  //      \r\n  const getTransactionTypeText = (type: string) => {\r\n    switch (type) {\r\n      case 'withdrawal':\r\n        return '';\r\n      case 'transfer':\r\n        return '';\r\n      case 'deposit':\r\n        return '';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  //      \r\n  const getStatusText = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return '';\r\n      case 'pending':\r\n        return ' ';\r\n      case 'failed':\r\n        return '';\r\n      default:\r\n        return ' ';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader className=\"pb-4\">\r\n          <DialogTitle className=\"flex items-center gap-2 text-lg\">\r\n            <CreditCard className=\"h-5 w-5\" />\r\n             : {wallet.name}\r\n            {wallet.isDefault && (\r\n              <Badge variant=\"default\" className=\"mr-2\">\r\n                <Star className=\"h-3 w-3 mr-1\" />\r\n                \r\n              </Badge>\r\n            )}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n          {/*    */}\r\n          <div className=\"lg:col-span-1 space-y-4\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"text-sm flex items-center gap-2\">\r\n                  <IdCard className=\"h-4 w-4\" />\r\n                   \r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-3\">\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  <Phone className=\"h-4 w-4 text-gray-500\" />\r\n                  <span className=\"font-mono\">{wallet.phone}</span>\r\n                </div>\r\n                \r\n                {wallet.nationalId && (\r\n                  <div className=\"flex items-center gap-2 text-sm\">\r\n                    <IdCard className=\"h-4 w-4 text-gray-500\" />\r\n                    <span className=\"font-mono\">{wallet.nationalId}</span>\r\n                  </div>\r\n                )}\r\n                \r\n                {providerInfo && (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"flex items-center gap-2 text-sm\">\r\n                      <Building className=\"h-4 w-4 text-gray-500\" />\r\n                      <span>{providerInfo.name}</span>\r\n                    </div>\r\n                    <div className=\"text-xs text-gray-600 pr-6\">\r\n                      <div>: {providerInfo.ownerName}</div>\r\n                      <div className=\"font-mono\"> : {providerInfo.nationalId}</div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {wallet.lastResetDate && (\r\n                  <div className=\"flex items-center gap-2 text-sm\">\r\n                    <Calendar className=\"h-4 w-4 text-gray-500\" />\r\n                    <span>  : {new Date(wallet.lastResetDate).toLocaleDateString('ar-EG')}</span>\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/*   */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"text-sm flex items-center gap-2\">\r\n                  <BarChart3 className=\"h-4 w-4\" />\r\n                    \r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                {/*   */}\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"flex items-center justify-between text-xs\">\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <TrendingDown className=\"h-3 w-3 text-red-500\" />\r\n                       \r\n                    </span>\r\n                    <span className=\"font-mono\">\r\n                      {formatNumber(wallet.monthlyWithdrawalUsage || 0)} / {formatNumber(wallet.monthlyWithdrawalLimit)}\r\n                    </span>\r\n                  </div>\r\n                  <Progress \r\n                    value={withdrawalPercentage} \r\n                    className=\"h-2\"\r\n                  />\r\n                  <div className=\"text-xs text-gray-600\">\r\n                    : {formatNumber(wallet.monthlyWithdrawalLimit - (wallet.monthlyWithdrawalUsage || 0))} \r\n                  </div>\r\n                </div>\r\n\r\n                <Separator />\r\n\r\n                {/*   */}\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"flex items-center justify-between text-xs\">\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <TrendingUp className=\"h-3 w-3 text-green-500\" />\r\n                       \r\n                    </span>\r\n                    <span className=\"font-mono\">\r\n                      {formatNumber(wallet.monthlyTransferUsage || 0)} / {formatNumber(wallet.monthlyTransferLimit)}\r\n                    </span>\r\n                  </div>\r\n                  <Progress \r\n                    value={transferPercentage} \r\n                    className=\"h-2\"\r\n                  />\r\n                  <div className=\"text-xs text-gray-600\">\r\n                    : {formatNumber(wallet.monthlyTransferLimit - (wallet.monthlyTransferUsage || 0))} \r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/*   */}\r\n          <div className=\"lg:col-span-2 space-y-4\">\r\n            {/*   */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <TrendingDown className=\"h-5 w-5 text-red-500\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalWithdrawals)}</div>\r\n                  <div className=\"text-xs text-gray-600\"> </div>\r\n                </CardContent>\r\n              </Card>\r\n              \r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <TrendingUp className=\"h-5 w-5 text-blue-500\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalTransfers)}</div>\r\n                  <div className=\"text-xs text-gray-600\"> </div>\r\n                </CardContent>\r\n              </Card>\r\n              \r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <DollarSign className=\"h-5 w-5 text-green-500\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalDeposits)}</div>\r\n                  <div className=\"text-xs text-gray-600\"> </div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/*   */}\r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <BarChart3 className=\"h-5 w-5 text-emerald-600\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(totalProfit)}</div>\r\n                  <div className=\"text-xs text-gray-600\"> </div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/*   */}\r\n              <Card>\r\n                <CardContent className=\"p-4 text-center\">\r\n                  <div className=\"flex items-center justify-center mb-2\">\r\n                    <Activity className=\"h-5 w-5 text-purple-600\" />\r\n                  </div>\r\n                  <div className=\"text-lg font-bold\">{formatNumber(operationsCount)}</div>\r\n                  <div className=\"text-xs text-gray-600\"> </div>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n\r\n            {/*    */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"text-sm flex items-center justify-between\">\r\n                  <span className=\"flex items-center gap-2\">\r\n                    <Activity className=\"h-4 w-4\" />\r\n                     \r\n                  </span>\r\n                  <div className=\"flex gap-2\">\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant={selectedPeriod === 'week' ? 'default' : 'outline'}\r\n                      onClick={() => setSelectedPeriod('week')}\r\n                      className=\"text-xs\"\r\n                    >\r\n                      \r\n                    </Button>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant={selectedPeriod === 'month' ? 'default' : 'outline'}\r\n                      onClick={() => setSelectedPeriod('month')}\r\n                      className=\"text-xs\"\r\n                    >\r\n                      \r\n                    </Button>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant={selectedPeriod === 'all' ? 'default' : 'outline'}\r\n                      onClick={() => setSelectedPeriod('all')}\r\n                      className=\"text-xs\"\r\n                    >\r\n                      \r\n                    </Button>\r\n                  </div>\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                {isLoading ? (\r\n                  <div className=\"flex justify-center items-center py-8\">\r\n                    <div className=\"text-center\">\r\n                      <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-2\"></div>\r\n                      <p className=\"text-sm text-gray-600\">  ...</p>\r\n                    </div>\r\n                  </div>\r\n                ) : filteredTransactions.length === 0 ? (\r\n                  <div className=\"text-center py-8\">\r\n                    <Activity className=\"h-8 w-8 text-gray-400 mx-auto mb-2\" />\r\n                    <p className=\"text-gray-600\">     </p>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-2 max-h-96 overflow-y-auto\">\r\n                    {filteredTransactions.map((transaction) => (\r\n                      <div key={transaction.id} className=\"flex items-center justify-between p-3 border rounded-lg\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          {getTransactionIcon(transaction.type)}\r\n                          <div>\r\n                            <div className=\"text-sm font-medium\">\r\n                              {getTransactionTypeText(transaction.type)} - {formatNumber(transaction.amount)} \r\n                            </div>\r\n                            <div className=\"text-xs text-gray-600\">\r\n                              {formatDate(transaction.createdAt)}\r\n                            </div>\r\n                            {transaction.description && (\r\n                              <div className=\"text-xs text-gray-500 mt-1\">\r\n                                {transaction.description}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          {getStatusIcon(transaction.status)}\r\n                          <span className=\"text-xs\">{getStatusText(transaction.status)}</span>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex justify-between pt-4 border-t\">\r\n          <Button onClick={onBack} variant=\"outline\">\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n             \r\n          </Button>\r\n          <Button onClick={onClose} variant=\"outline\">\r\n            \r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default WalletDetailsPage;","import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Wallet, Plus, Edit, Trash2, Phone, DollarSign, X, Settings, Info, Star, StarOff, CreditCard, TrendingUp, TrendingDown, Save, IdCard, Eye } from 'lucide-react';\r\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { SubscriptionPlan } from '@/utils/subscriptionService';\r\nimport { merchantWalletService, transactionService } from '@/integrations/firebase/services';\r\nimport { walletSelectionPinService } from '@/utils/walletSelectionPinService';\r\nimport { walletDailyLimitsService } from '@/utils/walletDailyLimitsService';\r\nimport WalletsViewPage from './WalletsViewPage';\r\nimport WalletDetailsPage from './WalletDetailsPage';\r\n\r\ninterface Wallet {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  nationalId?: string; //   \r\n  isDefault: boolean;\r\n  monthlyWithdrawalLimit: number;\r\n  monthlyTransferLimit: number;\r\n  monthlyWithdrawalUsage?: number; //    \r\n  monthlyTransferUsage?: number; //    \r\n  dailyWithdrawalLimit: number; //    \r\n  dailyTransferLimit: number; //    \r\n  dailyWithdrawalUsage?: number; //   \r\n  dailyTransferUsage?: number; //   \r\n  lastResetDate?: string; //     \r\n  walletProvider?: string; //  \r\n}\r\n\r\ninterface WalletManagementProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onWalletUpdate?: () => void;\r\n  initialEditingWallet?: Wallet | null;\r\n}\r\n\r\n//       \r\nconst walletProviders = [\r\n  {\r\n    id: 'vodafone',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29012345678901'\r\n  },\r\n  {\r\n    id: 'etisalat',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '28506789012345'\r\n  },\r\n  {\r\n    id: 'orange',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29309876543210'\r\n  },\r\n  {\r\n    id: 'we_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29112345678901'\r\n  },\r\n  {\r\n    id: 'smart_wallet',\r\n    name: ' ',\r\n    ownerName: '   ',\r\n    nationalId: '28809876543210'\r\n  },\r\n  {\r\n    id: 'access_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29456789012345'\r\n  },\r\n  {\r\n    id: 'insta_pay',\r\n    name: ' ',\r\n    ownerName: '  ',\r\n    nationalId: '29012345678901'\r\n  }\r\n];\r\n\r\nconst WalletManagement: React.FC<WalletManagementProps> = ({ isOpen, onClose, onWalletUpdate, initialEditingWallet }) => {\r\n  const { toast } = useToast();\r\n  const { user, userSubscription } = useFirebaseAuth();\r\n  const isTahweelaPlan = (() => {\r\n    const raw = (userSubscription as any)?.subscription?.planType ?? (userSubscription as any)?.subscription?.plan ?? (userSubscription as any)?.planType ?? (userSubscription as any)?.plan ?? null;\r\n    const s = typeof raw === 'string' ? String(raw).trim().toLowerCase() : null;\r\n    return raw === SubscriptionPlan.TAHWEELA || s === 'tahweela' || s === '';\r\n  })();\r\n  const navigate = useNavigate();\r\n  const [wallets, setWallets] = useState<Wallet[]>([]);\r\n  const [isAddingWallet, setIsAddingWallet] = useState(false);\r\n  const [editingWallet, setEditingWallet] = useState<Wallet | null>(null);\r\n  const [walletName, setWalletName] = useState('');\r\n  const [walletPhone, setWalletPhone] = useState('');\r\n  const [walletNationalId, setWalletNationalId] = useState('');\r\n  const [walletProvider, setWalletProvider] = useState('');\r\n  const [monthlyWithdrawalLimit, setMonthlyWithdrawalLimit] = useState('200000');\r\n  const [monthlyTransferLimit, setMonthlyTransferLimit] = useState('200000');\r\n  const [dailyWithdrawalLimit, setDailyWithdrawalLimit] = useState('100000');\r\n  const [dailyTransferLimit, setDailyTransferLimit] = useState('60000');\r\n  const [isDefault, setIsDefault] = useState(false);\r\n  const [showProviderInfo, setShowProviderInfo] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [showWalletsView, setShowWalletsView] = useState(false);\r\n  const [isMasterPinDialogOpen, setIsMasterPinDialogOpen] = useState(false);\r\n  const [selectedWallet, setSelectedWallet] = useState<Wallet | null>(null);\r\n\r\n  //     localStorage  \r\n  const getWalletsKey = () => `wallets_${user?.uid || 'default'}`;\r\n\r\n  //         \r\n  useEffect(() => {\r\n    if (initialEditingWallet) {\r\n      setEditingWallet(initialEditingWallet);\r\n      setIsAddingWallet(true);\r\n      setWalletName(initialEditingWallet.name || '');\r\n      setWalletPhone(initialEditingWallet.phone || '');\r\n      setWalletNationalId(initialEditingWallet.nationalId || '');\r\n      setWalletProvider(initialEditingWallet.walletProvider || '');\r\n      setMonthlyWithdrawalLimit((initialEditingWallet.monthlyWithdrawalLimit || 200000).toString());\r\n      setMonthlyTransferLimit((initialEditingWallet.monthlyTransferLimit || 200000).toString());\r\n      setDailyWithdrawalLimit((initialEditingWallet.dailyWithdrawalLimit || 100000).toString());\r\n      setDailyTransferLimit((initialEditingWallet.dailyTransferLimit || 60000).toString());\r\n      setIsDefault(!!initialEditingWallet.isDefault);\r\n    }\r\n  }, [initialEditingWallet]);\r\n\r\n  //      \r\n  const checkAndResetMonthlyUsage = (wallet: Wallet): Wallet => {\r\n    const currentDate = new Date();\r\n    const currentMonth = currentDate.getMonth();\r\n    const currentYear = currentDate.getFullYear();\r\n    \r\n    if (!wallet.lastResetDate) {\r\n      //           \r\n      return {\r\n        ...wallet,\r\n        monthlyWithdrawalUsage: wallet.monthlyWithdrawalUsage || 0,\r\n        monthlyTransferUsage: wallet.monthlyTransferUsage || 0,\r\n        lastResetDate: currentDate.toISOString().split('T')[0]\r\n      };\r\n    }\r\n    \r\n    const lastResetDate = new Date(wallet.lastResetDate);\r\n    const lastResetMonth = lastResetDate.getMonth();\r\n    const lastResetYear = lastResetDate.getFullYear();\r\n    \r\n    //          \r\n    if (currentMonth !== lastResetMonth || currentYear !== lastResetYear) {\r\n      return {\r\n        ...wallet,\r\n        monthlyWithdrawalUsage: 0,\r\n        monthlyTransferUsage: 0,\r\n        lastResetDate: currentDate.toISOString().split('T')[0]\r\n      };\r\n    }\r\n    \r\n    return wallet;\r\n  };\r\n\r\n  //       Firebase (   )\r\n  const calculateWalletMonthlyUsage = async (walletId: string, transactions: any[]) => {\r\n    const currentMonth = new Date().getMonth();\r\n    const currentYear = new Date().getFullYear();\r\n    \r\n    const monthlyTransactions = transactions.filter((t: any) => {\r\n      const transactionDate = new Date(t.createdAt);\r\n      return (\r\n        transactionDate.getMonth() === currentMonth && \r\n        transactionDate.getFullYear() === currentYear &&\r\n        t.lineId === walletId\r\n      );\r\n    });\r\n\r\n    // \"receive\" =     \"send\" =    \r\n    const withdrawalUsage = monthlyTransactions\r\n      .filter((t: any) => t.txnType === 'receive')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    const transferUsage = monthlyTransactions\r\n      .filter((t: any) => t.txnType === 'send')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    return { withdrawalUsage, transferUsage };\r\n  };\r\n\r\n  //      (   )\r\n  const calculateWalletDailyUsage = async (walletId: string, transactions: any[]) => {\r\n    const today = new Date();\r\n    const currentDay = today.getDate();\r\n    const currentMonth = today.getMonth();\r\n    const currentYear = today.getFullYear();\r\n    \r\n    const dailyTransactions = transactions.filter((t: any) => {\r\n      const transactionDate = new Date(t.createdAt);\r\n      return (\r\n        transactionDate.getDate() === currentDay &&\r\n        transactionDate.getMonth() === currentMonth && \r\n        transactionDate.getFullYear() === currentYear &&\r\n        t.lineId === walletId\r\n      );\r\n    });\r\n\r\n    const withdrawalUsage = dailyTransactions\r\n      .filter((t: any) => t.txnType === 'receive')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    const transferUsage = dailyTransactions\r\n      .filter((t: any) => t.txnType === 'send')\r\n      .reduce((sum: number, t: any) => sum + (t.amount || 0), 0);\r\n\r\n    return { withdrawalUsage, transferUsage };\r\n  };\r\n\r\n  //    \r\n  const updateWalletUsage = async (walletId: string) => {\r\n    try {\r\n      //    Firebase\r\n      const transactions = await transactionService.getByUserId(user?.uid || '');\r\n      const { withdrawalUsage, transferUsage } = await calculateWalletMonthlyUsage(walletId, transactions);\r\n      \r\n      setWallets(prevWallets => \r\n        prevWallets.map(wallet => {\r\n          if (wallet.id === walletId) {\r\n            const updatedWallet = checkAndResetMonthlyUsage(wallet);\r\n            return {\r\n              ...updatedWallet,\r\n              monthlyWithdrawalUsage: withdrawalUsage,\r\n              monthlyTransferUsage: transferUsage\r\n            };\r\n          }\r\n          return checkAndResetMonthlyUsage(wallet);\r\n        })\r\n      );\r\n    } catch (error) {\r\n      console.error('Error updating wallet usage:', error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Load wallets from Firebase for the current user\r\n    const loadWallets = async () => {\r\n      //      \r\n      if (!user?.uid) {\r\n        console.log('No user authenticated, skipping wallet loading');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      \r\n      console.log('Loading wallets for user:', user.uid);\r\n      setIsLoading(true);\r\n      \r\n      try {\r\n        //         \r\n        const { auth } = await import('@/firebase');\r\n        \r\n        //       \r\n        let retryCount = 0;\r\n        const maxRetries = 5;\r\n        \r\n        while (!auth.currentUser && retryCount < maxRetries) {\r\n          console.log(`Waiting for auth state... attempt ${retryCount + 1}`);\r\n          await new Promise(resolve => setTimeout(resolve, 1000));\r\n          retryCount++;\r\n        }\r\n        \r\n        if (!auth.currentUser) {\r\n          console.error('User not authenticated in Firebase Auth after retries');\r\n          throw new Error('not authenticated');\r\n        }\r\n        \r\n        console.log('Firebase Auth User:', auth.currentUser.uid);\r\n        console.log('Context User:', user.uid);\r\n        \r\n        console.log('Fetching wallets from Firebase...');\r\n        const firebaseWallets = await merchantWalletService.getByMerchantId(user.uid);\r\n        console.log('Fetched wallets:', firebaseWallets);\r\n        \r\n        console.log('Fetching transactions from Firebase...');\r\n        const transactions = await transactionService.getByUserId(user.uid);\r\n        console.log('Fetched transactions:', transactions);\r\n        \r\n        const formattedWallets = await Promise.all(firebaseWallets.map(async w => {\r\n          const { withdrawalUsage, transferUsage } = await calculateWalletMonthlyUsage(w.id, transactions);\r\n          const { withdrawalUsage: dailyWithdrawalUsage, transferUsage: dailyTransferUsage } = await calculateWalletDailyUsage(w.id, transactions);\r\n          \r\n          return {\r\n            id: w.id,\r\n            name: w.label || '  ',\r\n            phone: w.msisdn,\r\n            isDefault: false, //     \r\n            monthlyWithdrawalLimit: w.withdrawLimit || 200000,\r\n            monthlyTransferLimit: w.transferLimit || 200000,\r\n            dailyWithdrawalLimit: (w as any).dailyWithdrawLimit || 100000, //    \r\n            dailyTransferLimit: (w as any).dailyTransferLimit || 60000, //    \r\n            monthlyWithdrawalUsage: withdrawalUsage,\r\n            monthlyTransferUsage: transferUsage,\r\n            dailyWithdrawalUsage: dailyWithdrawalUsage,\r\n            dailyTransferUsage: dailyTransferUsage,\r\n            lastResetDate: new Date().toISOString().split('T')[0],\r\n            //         Firebase\r\n            defaultTransferCommission: (w.defaultTransferCommission != null ? Number(w.defaultTransferCommission) : null),\r\n            defaultWithdrawCommission: (w.defaultWithdrawCommission != null ? Number(w.defaultWithdrawCommission) : null)\r\n          };\r\n        }));\r\n        \r\n        //       \r\n        const walletsWithResetCheck = formattedWallets.map(checkAndResetMonthlyUsage);\r\n        setWallets(walletsWithResetCheck);\r\n        console.log('Wallets loaded successfully:', walletsWithResetCheck);\r\n        \r\n      } catch (error) {\r\n        console.error('Error loading wallets:', error);\r\n        //             \r\n        setWallets([]);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    loadWallets();\r\n  }, [user?.uid]);\r\n\r\n  const resetForm = () => {\r\n    setWalletName('');\r\n    setWalletPhone('');\r\n    setWalletNationalId('');\r\n    setWalletProvider('');\r\n    setMonthlyWithdrawalLimit('200000');\r\n    setMonthlyTransferLimit('200000');\r\n    setDailyWithdrawalLimit('100000');\r\n    setDailyTransferLimit('60000');\r\n    setIsDefault(false);\r\n    setEditingWallet(null);\r\n    setIsAddingWallet(false);\r\n  };\r\n\r\n  const startEdit = (wallet: Wallet) => {\r\n    setWalletName(wallet.name);\r\n    setWalletPhone(wallet.phone);\r\n    setMonthlyWithdrawalLimit(wallet.monthlyWithdrawalLimit.toString());\r\n    setMonthlyTransferLimit(wallet.monthlyTransferLimit.toString());\r\n    setDailyWithdrawalLimit(wallet.dailyWithdrawalLimit.toString());\r\n    setDailyTransferLimit(wallet.dailyTransferLimit.toString());\r\n    setIsDefault(wallet.isDefault);\r\n    setEditingWallet(wallet);\r\n    setIsAddingWallet(true);\r\n  };\r\n\r\n  const saveWallet = async () => {\r\n    if (!walletName.trim() || !walletPhone.trim() || !walletProvider.trim()) {\r\n      toast({\r\n        title: \"\",\r\n        description: \"    \",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!user?.uid) {\r\n      toast({\r\n        title: \"\",\r\n        description: \"   \",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      if (editingWallet) {\r\n        // Update existing wallet in Firebase\r\n        await merchantWalletService.update(editingWallet.id, {\r\n          label: walletName.trim(),\r\n          msisdn: walletPhone.trim(),\r\n          withdrawLimit: parseInt(monthlyWithdrawalLimit),\r\n          transferLimit: parseInt(monthlyTransferLimit),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit),\r\n          dailyTransferLimit: parseInt(dailyTransferLimit)\r\n        });\r\n\r\n        // Sync limits to walletLimits collection for enforcement\r\n        await walletDailyLimitsService.setLimits(editingWallet.id, {\r\n          dailyTransferLimit: parseInt(dailyTransferLimit || '0'),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit || '0'),\r\n          monthlyTransferLimit: parseInt(monthlyTransferLimit || '0'),\r\n          monthlyWithdrawLimit: parseInt(monthlyWithdrawalLimit || '0')\r\n        });\r\n\r\n        // Update existing wallet in local state\r\n        const updatedWallets = wallets.map(w => \r\n          w.id === editingWallet.id \r\n            ? { \r\n                ...w, \r\n                name: walletName.trim(), \r\n                phone: walletPhone.trim(),\r\n                nationalId: walletNationalId.trim(),\r\n                walletProvider: walletProvider,\r\n                monthlyWithdrawalLimit: parseInt(monthlyWithdrawalLimit),\r\n                monthlyTransferLimit: parseInt(monthlyTransferLimit),\r\n                dailyWithdrawalLimit: parseInt(dailyWithdrawalLimit),\r\n                dailyTransferLimit: parseInt(dailyTransferLimit)\r\n              }\r\n            : w\r\n        );\r\n        \r\n        setWallets(updatedWallets);\r\n        \r\n        // Also save to localStorage for backward compatibility\r\n        localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n        \r\n        toast({\r\n          title: \" \",\r\n          description: \"   \",\r\n        });\r\n\r\n      } else {\r\n        // Create new wallet in Firebase\r\n        const newWalletData = {\r\n          merchantUserId: user.uid,\r\n          provider: walletProvider as const,\r\n          msisdn: walletPhone.trim(),\r\n          label: walletName.trim(),\r\n          isActive: true,\r\n          dailyLimit: 200000,\r\n          monthlyLimit: 200000,\r\n          withdrawLimit: parseInt(monthlyWithdrawalLimit),\r\n          transferLimit: parseInt(monthlyTransferLimit),\r\n          dailyTransferLimit: parseInt(dailyTransferLimit),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit),\r\n          dailyUsage: 0,\r\n          monthlyUsage: 0,\r\n          transferUsage: 0,\r\n          withdrawUsage: 0\r\n        };\r\n\r\n        const newWalletId = await merchantWalletService.create(newWalletData);\r\n        \r\n        // Sync limits to walletLimits collection for enforcement\r\n        await walletDailyLimitsService.setLimits(newWalletId, {\r\n          dailyTransferLimit: parseInt(dailyTransferLimit || '0'),\r\n          dailyWithdrawLimit: parseInt(dailyWithdrawalLimit || '0'),\r\n          monthlyTransferLimit: parseInt(monthlyTransferLimit || '0'),\r\n          monthlyWithdrawLimit: parseInt(monthlyWithdrawalLimit || '0')\r\n        });\r\n        \r\n        // Add to local state with reset usage counters\r\n        const currentDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format\r\n        const walletToAdd = {\r\n          id: newWalletId,\r\n          name: walletName.trim(),\r\n          phone: walletPhone.trim(),\r\n          nationalId: walletNationalId.trim(),\r\n          walletProvider: walletProvider,\r\n          isDefault: isDefault,\r\n          monthlyWithdrawalLimit: parseInt(monthlyWithdrawalLimit),\r\n          monthlyTransferLimit: parseInt(monthlyTransferLimit),\r\n          dailyWithdrawalLimit: parseInt(dailyWithdrawalLimit),\r\n          dailyTransferLimit: parseInt(dailyTransferLimit),\r\n          monthlyWithdrawalUsage: 0, //     \r\n          monthlyTransferUsage: 0, //     \r\n          dailyWithdrawalUsage: 0, //     \r\n          dailyTransferUsage: 0, //     \r\n          lastResetDate: currentDate, //   \r\n          //  :      \r\n          defaultTransferCommission: null,\r\n          defaultWithdrawCommission: null\r\n        };\r\n        \r\n        const newWallets = [...wallets, walletToAdd];\r\n        setWallets(newWallets);\r\n        \r\n        // Also save to localStorage for backward compatibility\r\n        localStorage.setItem(getWalletsKey(), JSON.stringify(newWallets));\r\n        \r\n        toast({\r\n          title: \" \",\r\n          description: \"   \",\r\n        });\r\n      }\r\n      \r\n      if (onWalletUpdate) {\r\n        onWalletUpdate();\r\n      }\r\n\r\n      resetForm();\r\n      setIsAddingWallet(false);\r\n      setEditingWallet(null);\r\n    } catch (error) {\r\n      console.error('Error saving wallet:', error);\r\n      toast({\r\n        title: \"\",\r\n        description: \"    \",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleEditWallet = (wallet: Wallet) => {\r\n    setEditingWallet(wallet);\r\n    setWalletName(wallet.name);\r\n    setWalletPhone(wallet.phone);\r\n    setWalletNationalId(wallet.nationalId || '');\r\n    setWalletProvider(wallet.walletProvider || '');\r\n    setMonthlyWithdrawalLimit(wallet.monthlyWithdrawalLimit.toString());\r\n    setMonthlyTransferLimit(wallet.monthlyTransferLimit.toString());\r\n    setIsDefault(wallet.isDefault);\r\n    setIsAddingWallet(true);\r\n  };\r\n\r\n  const handleUpdateWallet = () => {\r\n    if (!editingWallet || !walletName || !walletPhone) {\r\n      toast({\r\n        title: \"\",\r\n        description: \"    \",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    const updatedWallets = wallets.map(w => \r\n      w.id === editingWallet.id \r\n        ? { ...w, name: walletName, phone: walletPhone, monthlyWithdrawalLimit: parseInt(monthlyWithdrawalLimit), monthlyTransferLimit: parseInt(monthlyTransferLimit) }\r\n        : w\r\n    );\r\n\r\n    setWallets(updatedWallets);\r\n    localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n    setEditingWallet(null);\r\n    resetForm();\r\n\r\n    // Call the update callback if provided\r\n    if (onWalletUpdate) {\r\n      onWalletUpdate();\r\n    }\r\n\r\n    toast({\r\n      title: \"  \",\r\n      description: \"    \",\r\n    });\r\n  };\r\n\r\n  const handleDeleteWallet = async (walletId: string) => {\r\n    const walletToDelete = wallets.find(w => w.id === walletId);\r\n    \r\n    if (walletToDelete?.isDefault) {\r\n      toast({\r\n        title: \"\",\r\n        description: \"    \",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!user?.uid) {\r\n      toast({\r\n        title: \"\",\r\n        description: \"   \",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      // Delete from Firebase\r\n      await merchantWalletService.delete(walletId);\r\n      \r\n      // Update local state\r\n      const updatedWallets = wallets.filter(w => w.id !== walletId);\r\n      setWallets(updatedWallets);\r\n      \r\n      // Also update localStorage for backward compatibility\r\n      localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n      \r\n      if (onWalletUpdate) {\r\n        onWalletUpdate();\r\n      }\r\n\r\n      toast({\r\n        title: \" \",\r\n        description: \"   \",\r\n      });\r\n    } catch (error) {\r\n      console.error('Error deleting wallet:', error);\r\n      toast({\r\n        title: \"\",\r\n        description: \"    \",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSetDefault = (walletId: string) => {\r\n    const updatedWallets = wallets.map(w => ({\r\n      ...w,\r\n      isDefault: w.id === walletId\r\n    }));\r\n\r\n    setWallets(updatedWallets);\r\n    localStorage.setItem(getWalletsKey(), JSON.stringify(updatedWallets));\r\n    \r\n    // Call the update callback if provided\r\n    if (onWalletUpdate) {\r\n      onWalletUpdate();\r\n    }\r\n\r\n    toast({\r\n      title: \"   \",\r\n      description: \"    \",\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\r\n        <DialogHeader className=\"pb-2\">\r\n          <DialogTitle className=\"flex items-center gap-1 text-sm\">\r\n            <Wallet className=\"h-3 w-3\" />\r\n             \r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-2\">\r\n          {/* Add New Wallet Button */}\r\n          <div className=\"flex justify-between items-center\">\r\n            <h3 className=\"text-sm font-semibold\">  ({wallets.length})</h3>\r\n            <div className=\"flex gap-2\">\r\n              <Button\r\n                onClick={() => {\r\n                  //         \r\n                  setIsMasterPinDialogOpen(true);\r\n                }}\r\n                className=\"flex items-center gap-1 h-6 px-2 text-xs\"\r\n                size=\"sm\"\r\n                variant=\"outline\"\r\n              >\r\n                <Eye className=\"h-3 w-3\" />\r\n                  \r\n              </Button>\r\n              <Button\r\n                onClick={() => {\r\n                  onClose();\r\n                  navigate('/user/add-wallet');\r\n                }}\r\n                className=\"flex items-center gap-1 h-6 px-2 text-xs\"\r\n                size=\"sm\"\r\n              >\r\n                <Plus className=\"h-3 w-3\" />\r\n                  \r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Add/Edit Wallet Form */}\r\n          {(isAddingWallet || editingWallet) && (\r\n            <Card className=\"border-2 border-blue-200 bg-blue-50\">\r\n              <CardHeader className=\"pb-1\">\r\n                <CardTitle className=\"text-sm\">\r\n                  {editingWallet ? ' ' : '  '}\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-2 pt-1\">\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                     \r\n                  </label>\r\n                  <div className=\"flex gap-1 items-center\">\r\n                    <Select value={walletProvider} onValueChange={setWalletProvider}>\r\n                      <SelectTrigger className=\"h-6 text-xs flex-1\">\r\n                        <SelectValue placeholder=\"  \" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {walletProviders.map((provider) => (\r\n                          <SelectItem key={provider.id} value={provider.id} className=\"text-xs\">\r\n                            <div className=\"flex items-center justify-between w-full\">\r\n                              <span>{provider.name}</span>\r\n                              <button\r\n                                type=\"button\"\r\n                                className=\"h-4 w-4 p-0 ml-2 flex items-center justify-center hover:bg-blue-100 rounded\"\r\n                                onClick={(e) => {\r\n                                  e.preventDefault();\r\n                                  e.stopPropagation();\r\n                                  setShowProviderInfo(provider.id);\r\n                                }}\r\n                              >\r\n                                <Info className=\"h-3 w-3 text-blue-500 hover:text-blue-700\" />\r\n                              </button>\r\n                            </div>\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                     \r\n                  </label>\r\n                  <Input\r\n                    value={walletName}\r\n                    onChange={(e) => setWalletName(e.target.value)}\r\n                    placeholder=\":  \"\r\n                    className=\"h-6 text-xs\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                     \r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <Phone className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                    <Input\r\n                      value={walletPhone}\r\n                      onChange={(e) => setWalletPhone(e.target.value)}\r\n                      placeholder=\"01030302038\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                      \r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <IdCard className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                    <Input\r\n                      value={walletNationalId}\r\n                      onChange={(e) => setWalletNationalId(e.target.value)}\r\n                      placeholder=\"29012345678901\"\r\n                      maxLength={14}\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                       ()\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <DollarSign className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={monthlyWithdrawalLimit}\r\n                      onChange={(e) => setMonthlyWithdrawalLimit(e.target.value)}\r\n                      placeholder=\"200000\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                       ()\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <DollarSign className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={monthlyTransferLimit}\r\n                      onChange={(e) => setMonthlyTransferLimit(e.target.value)}\r\n                      placeholder=\"200000\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                       ()\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <TrendingDown className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-red-400\" />\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={dailyWithdrawalLimit}\r\n                      onChange={(e) => setDailyWithdrawalLimit(e.target.value)}\r\n                      placeholder=\"100000\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"text-xs font-medium text-gray-700 mb-1 block\">\r\n                       ()\r\n                  </label>\r\n                  <div className=\"relative\">\r\n                    <TrendingUp className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-blue-400\" />\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={dailyTransferLimit}\r\n                      onChange={(e) => setDailyTransferLimit(e.target.value)}\r\n                      placeholder=\"60000\"\r\n                      className=\"pl-6 h-6 text-xs\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id=\"isDefault\"\r\n                    checked={isDefault}\r\n                    onChange={(e) => setIsDefault(e.target.checked)}\r\n                    className=\"rounded w-3 h-3\"\r\n                  />\r\n                  <label htmlFor=\"isDefault\" className=\"text-xs font-medium text-gray-700\">\r\n                      \r\n                  </label>\r\n                </div>\r\n\r\n                {/* Commission Settings Section */}\r\n                <div className=\"border-t pt-2 mt-2\">\r\n                  <div className=\"flex items-center gap-1 mb-2\">\r\n                    <Settings className=\"h-3 w-3 text-gray-600\" />\r\n                    <label className=\"text-xs font-medium text-gray-700\">\r\n                       \r\n                    </label>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex gap-1\">\r\n                  <Button\r\n                    onClick={saveWallet}\r\n                    className=\"flex-1 h-6 text-xs\"\r\n                    size=\"sm\"\r\n                  >\r\n                    {editingWallet ? ' ' : ' '}\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    onClick={resetForm}\r\n                    className=\"h-6 text-xs\"\r\n                    size=\"sm\"\r\n                  >\r\n                    \r\n                  </Button>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n\r\n          {/* Wallets List */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\r\n            {wallets.map((wallet) => (\r\n              <Card key={wallet.id} className={`${wallet.isDefault ? 'border-green-300 bg-green-50' : ''}`}>\r\n                <CardHeader className=\"pb-1\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <CardTitle className=\"text-sm flex items-center gap-1\">\r\n                      <Wallet className=\"h-3 w-3\" />\r\n                      {wallet.name}\r\n                    </CardTitle>\r\n                    {wallet.isDefault && (\r\n                      <Badge variant=\"default\" className=\"bg-green-600 text-xs px-1 py-0\">\r\n                        \r\n                      </Badge>\r\n                    )}\r\n                  </div>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-1 pt-0\">\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <Phone className=\"h-3 w-3 text-gray-500\" />\r\n                    <span className=\"text-xs\">{wallet.phone}</span>\r\n                  </div>\r\n                  {wallet.walletProvider && (\r\n                    <div className=\"text-xs text-blue-600 mt-1\">\r\n                      {walletProviders.find(p => p.id === wallet.walletProvider)?.name || wallet.walletProvider}\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/*        */}\r\n                  <div className=\"bg-gradient-to-r from-gray-50 to-gray-100 p-2 rounded-md border border-gray-200 shadow-sm space-y-2\">\r\n                    {/*   */}\r\n                    <div>\r\n                      <div className=\"text-xs font-medium text-gray-600 mb-1\"> </div>\r\n                      <div className=\"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex\">\r\n                        {/*   */}\r\n                        <div className=\"w-1/2 bg-red-200 relative\">\r\n                          <div \r\n                            className=\"bg-gradient-to-r from-red-400 to-red-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                            style={{ \r\n                              width: `${Math.min(((wallet.monthlyWithdrawalUsage || 0) / wallet.monthlyWithdrawalLimit) * 100, 100)}%` \r\n                            }}\r\n                          ></div>\r\n                        </div>\r\n                        {/*   */}\r\n                        <div className=\"w-1/2 bg-blue-200 relative\">\r\n                          <div \r\n                            className=\"bg-gradient-to-r from-blue-400 to-blue-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                            style={{ \r\n                              width: `${Math.min(((wallet.monthlyTransferUsage || 0) / wallet.monthlyTransferLimit) * 100, 100)}%` \r\n                            }}\r\n                          ></div>\r\n                        </div>\r\n                      </div>\r\n                      \r\n                      {/*     */}\r\n                      <div className=\"flex justify-between items-center mt-0.5\">\r\n                        <div className=\"text-xs text-red-600 font-medium\">\r\n                           : {Math.max(wallet.monthlyWithdrawalLimit - (wallet.monthlyWithdrawalUsage || 0), 0)} \r\n                        </div>\r\n                        <div className=\"text-xs text-blue-600 font-medium\">\r\n                           : {Math.max(wallet.monthlyTransferLimit - (wallet.monthlyTransferUsage || 0), 0)} \r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/*   */}\r\n                    {(\r\n                      <div>\r\n                        <div className=\"text-xs font-medium text-gray-600 mb-1\"> </div>\r\n                        <div className=\"w-full bg-gray-200 rounded-full h-1 overflow-hidden flex\">\r\n                          {/*    */}\r\n                          <div className=\"w-1/2 bg-orange-200 relative\">\r\n                            <div \r\n                              className=\"bg-gradient-to-r from-orange-400 to-orange-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                              style={{ \r\n                                width: `${Math.min(((wallet.dailyWithdrawalUsage || 0) / wallet.dailyWithdrawalLimit) * 100, 100)}%` \r\n                              }}\r\n                            ></div>\r\n                          </div>\r\n                          {/*    */}\r\n                          <div className=\"w-1/2 bg-green-200 relative\">\r\n                            <div \r\n                              className=\"bg-gradient-to-r from-green-400 to-green-600 h-1 transition-all duration-700 ease-out shadow-sm\"\r\n                              style={{ \r\n                                width: `${Math.min(((wallet.dailyTransferUsage || 0) / wallet.dailyTransferLimit) * 100, 100)}%` \r\n                              }}\r\n                            ></div>\r\n                          </div>\r\n                        </div>\r\n                        \r\n                        {/*     */}\r\n                        <div className=\"flex justify  items-center mt-0.5\">\r\n                          <div className=\"text-xs text-orange-600 font-medium\">\r\n                              : {Math.max(wallet.dailyWithdrawalLimit - (wallet.dailyWithdrawalUsage || 0), 0)} \r\n                          </div>\r\n                          <div className=\"text-xs text-green-600 font-medium\">\r\n                              : {Math.max(wallet.dailyTransferLimit - (wallet.dailyTransferUsage || 0), 0)} \r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div className=\"flex gap-1 pt-1\">\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"outline\"\r\n                      onClick={() => handleEditWallet(wallet)}\r\n                      className=\"flex-1 h-5 text-xs px-1\"\r\n                    >\r\n                      <Edit className=\"h-2 w-2 mr-0.5\" />\r\n                      \r\n                    </Button>\r\n                    \r\n                    {!wallet.isDefault && (\r\n                      <>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"outline\"\r\n                          onClick={() => handleSetDefault(wallet.id)}\r\n                          className=\"flex-1 h-5 text-xs px-1\"\r\n                        >\r\n                           \r\n                        </Button>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          variant=\"destructive\"\r\n                          onClick={() => handleDeleteWallet(wallet.id)}\r\n                          className=\"h-5 px-1\"\r\n                        >\r\n                          <Trash2 className=\"h-2 w-2\" />\r\n                        </Button>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n\r\n          {wallets.length === 0 && (\r\n            <div className=\"text-center py-4 text-gray-500 text-xs\">\r\n                 .     .\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/*     */}\r\n      {showProviderInfo && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl\">\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n              <h3 className=\"text-lg font-bold text-gray-800\">  </h3>\r\n              <button\r\n                onClick={() => setShowProviderInfo(null)}\r\n                className=\"h-8 w-8 p-0 flex items-center justify-center hover:bg-gray-100 rounded-full transition-colors\"\r\n              >\r\n                <X className=\"h-4 w-4 text-gray-500\" />\r\n              </button>\r\n            </div>\r\n            \r\n            {(() => {\r\n              const provider = walletProviders.find(p => p.id === showProviderInfo);\r\n              return provider ? (\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"text-center mb-6\">\r\n                    <div className=\"bg-blue-100 p-3 rounded-lg inline-block\">\r\n                      <h4 className=\"font-bold text-blue-700 text-lg\">{provider.name}</h4>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200\">\r\n                    <div className=\"space-y-4\">\r\n                      <div className=\"bg-white p-3 rounded-lg shadow-sm\">\r\n                        <div className=\"flex items-center mb-2\">\r\n                          <div className=\"w-2 h-2 bg-blue-500 rounded-full mr-2\"></div>\r\n                          <span className=\"font-semibold text-gray-700\">  :</span>\r\n                        </div>\r\n                        <p className=\"text-gray-900 font-medium text-lg mr-4\">{provider.ownerName}</p>\r\n                      </div>\r\n                      \r\n                      <div className=\"bg-white p-3 rounded-lg shadow-sm\">\r\n                        <div className=\"flex items-center mb-2\">\r\n                          <div className=\"w-2 h-2 bg-green-500 rounded-full mr-2\"></div>\r\n                          <span className=\"font-semibold text-gray-700\"> :</span>\r\n                        </div>\r\n                        <p className=\"text-gray-900 font-mono text-lg mr-4 tracking-wider\">{provider.nationalId}</p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"bg-yellow-50 border border-yellow-200 p-3 rounded-lg\">\r\n                    <div className=\"flex items-center\">\r\n                      <Info className=\"h-4 w-4 text-yellow-600 mr-2\" />\r\n                      <span className=\"text-sm text-yellow-800 font-medium\">\r\n                               \r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ) : null;\r\n            })()}\r\n          </div>\r\n        </div>\r\n      )}\r\n      </DialogContent>\r\n\r\n      {/*        */}\r\n      <MasterPinDialog\r\n        open={isMasterPinDialogOpen}\r\n        onOpenChange={setIsMasterPinDialogOpen}\r\n        mode=\"verify\"\r\n        title=\"   \"\r\n        description=\"         \"\r\n        onSuccess={() => {\r\n          setIsMasterPinDialogOpen(false);\r\n          setShowWalletsView(true);\r\n        }}\r\n      />\r\n\r\n      {/*    */}\r\n      <WalletsViewPage\r\n        isOpen={showWalletsView}\r\n        onClose={() => setShowWalletsView(false)}\r\n        onWalletSelect={(wallet) => {\r\n          setSelectedWallet(wallet);\r\n          setShowWalletsView(false);\r\n        }}\r\n        onEditWallet={(wallet) => {\r\n          //           \r\n          navigate(`/user/add-wallet?edit=1&id=${wallet.id}`);\r\n          setShowWalletsView(false);\r\n        }}\r\n        onDeleteWallet={async (walletId) => {\r\n          //    \r\n          try {\r\n            await merchantWalletService.delete(walletId);\r\n            //      localStorage     \r\n            setWallets(prev => {\r\n              const updated = prev.filter(w => w.id !== walletId);\r\n              try {\r\n                localStorage.setItem(getWalletsKey(), JSON.stringify(updated));\r\n              } catch (e) {\r\n                console.error('Failed to update localStorage wallets after delete:', e);\r\n              }\r\n              return updated;\r\n            });\r\n\r\n            //  /    (   )\r\n            if (onWalletUpdate) {\r\n              try {\r\n                await onWalletUpdate();\r\n              } catch (e) {\r\n                console.error('onWalletUpdate callback failed:', e);\r\n              }\r\n            }\r\n          } catch (err) {\r\n            console.error('Error deleting wallet:', err);\r\n          }\r\n        }}\r\n      />\r\n\r\n      {/*    */}\r\n      <WalletDetailsPage\r\n        wallet={selectedWallet}\r\n        isOpen={!!selectedWallet}\r\n        onClose={() => setSelectedWallet(null)}\r\n        onBack={() => {\r\n          setSelectedWallet(null);\r\n          setShowWalletsView(true);\r\n        }}\r\n      />\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default WalletManagement;\r\n","import React from 'react';\r\nimport { formatNumberEnglish } from '@/utils/formatters';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Card, CardContent, CardHeader } from '@/components/ui/card';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { CheckCircle, Clock, XCircle, Phone, DollarSign, Calendar, Trash2, Printer, ArrowDownLeft, ArrowUpDown, Receipt, Store, User, CreditCard, ArrowRight } from 'lucide-react';\r\n\r\ninterface Transaction {\r\n  id: string;\r\n  type: 'send' | 'receive' | 'withdraw';\r\n  senderPhone: string;\r\n  receiverPhone: string;\r\n  amount: number;\r\n  status: 'pending' | 'completed' | 'failed';\r\n  createdAt: Date;\r\n  withdrawnAmount?: number; //  \r\n  sentAmount?: number; //  \r\n  fromWallet?: string; //   \r\n  //    \r\n  senderNumber?: string; //  \r\n  senderName?: string; //    \r\n  shopName?: string; //  \r\n  transferredAmount?: number; //  \r\n  receiverNumber?: string; //  \r\n  withdrawnAmountDetailed?: number; //   \r\n  merchantShopName?: string; //        \r\n  transactionReference?: string; //  \r\n  commission?: number; // \r\n  fee?: number; //   \r\n  notes?: string; //  \r\n}\r\n\r\ninterface TransactionDetailsModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  transaction: Transaction | null;\r\n  onDelete: (transactionId: string) => void;\r\n}\r\n\r\nconst TransactionDetailsModal: React.FC<TransactionDetailsModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  transaction,\r\n  onDelete\r\n}) => {\r\n  if (!transaction) return null;\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return <CheckCircle className=\"h-5 w-5 text-green-500\" />;\r\n      case 'pending':\r\n        return <Clock className=\"h-5 w-5 text-yellow-500\" />;\r\n      case 'failed':\r\n        return <XCircle className=\"h-5 w-5 text-red-500\" />;\r\n      default:\r\n        return <Clock className=\"h-5 w-5 text-gray-500\" />;\r\n    }\r\n  };\r\n\r\n  const getStatusText = (status: string) => {\r\n    switch (status) {\r\n      case 'completed':\r\n        return '';\r\n      case 'pending':\r\n        return ' ';\r\n      case 'failed':\r\n        return '';\r\n      default:\r\n        return ' ';\r\n    }\r\n  };\r\n\r\n  const getTransactionTypeText = (type: string) => {\r\n    switch (type) {\r\n      case 'withdraw':\r\n        return '';\r\n      case 'send':\r\n        return '';\r\n      case 'receive':\r\n        return '';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  const getTransactionIcon = (type: string) => {\r\n    switch (type) {\r\n      case 'withdraw':\r\n        return <ArrowDownLeft className=\"h-5 w-5 text-green-500\" />;\r\n      default:\r\n        return <ArrowUpDown className=\"h-5 w-5 text-blue-500\" />;\r\n    }\r\n  };\r\n\r\n  const handlePrint = () => {\r\n    const hasSenderNumber = !!transaction.senderNumber;\r\n    const hasSenderName = !!transaction.senderName;\r\n    const senderLabel = hasSenderNumber\r\n      ? ' :'\r\n      : hasSenderName\r\n      ? ' :'\r\n      : ' :';\r\n    const senderValue = hasSenderNumber\r\n      ? transaction.senderNumber\r\n      : hasSenderName\r\n      ? transaction.senderName\r\n      : transaction.senderPhone;\r\n\r\n    const printContent = `\r\n      <div style=\"font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 500px; margin: 0 auto; padding: 30px; background: #fff;\">\r\n        <!-- Header -->\r\n        <div style=\"text-align: center; margin-bottom: 30px; border-bottom: 2px solid #2563eb; padding-bottom: 20px;\">\r\n          <h1 style=\"color: #2563eb; margin-bottom: 5px; font-size: 28px;\"> </h1>\r\n          <p style=\"color: #666; font-size: 16px; margin: 0;\"> : ${transaction.transactionReference || transaction.id}</p>\r\n          <p style=\"color: #888; font-size: 14px; margin: 5px 0 0 0;\">${new Date().toLocaleString('ar-EG')}</p>\r\n        </div>\r\n        \r\n        <!-- Shop Info -->\r\n        <div style=\"background: #f8fafc; border-radius: 12px; padding: 20px; margin-bottom: 20px;\">\r\n          <h3 style=\"color: #1e293b; margin: 0 0 15px 0; font-size: 18px;\"> </h3>\r\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 8px;\">\r\n            <span style=\"font-weight: 600; color: #475569;\"> :</span>\r\n            <span style=\"color: #1e293b;\">${transaction.merchantShopName || transaction.shopName || ' '}</span>\r\n          </div>\r\n        </div>\r\n        \r\n        <!-- Transaction Details -->\r\n        <div style=\"background: #fff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; margin-bottom: 20px;\">\r\n          <h3 style=\"color: #1e293b; margin: 0 0 15px 0; font-size: 18px;\"> </h3>\r\n          \r\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n            <span style=\"font-weight: 600; color: #475569;\"> :</span>\r\n            <span style=\"color: #2563eb; font-weight: 600;\">${getTransactionTypeText(transaction.type)}</span>\r\n          </div>\r\n          \r\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n            <span style=\"font-weight: 600; color: #475569;\">:</span>\r\n            <span style=\"color: ${transaction.status === 'completed' ? '#16a34a' : transaction.status === 'pending' ? '#ca8a04' : '#dc2626'}; font-weight: 600;\">\r\n              ${getStatusText(transaction.status)}\r\n            </span>\r\n          </div>\r\n\r\n          ${(transaction as any)?.cashierName ? `\r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\">:</span>\r\n              <span style=\"color: #1e293b;\">${(transaction as any).cashierName}</span>\r\n            </div>\r\n          ` : ''}\r\n          \r\n          ${transaction.type !== 'withdraw' ? `\r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\">${senderLabel}</span>\r\n              <span style=\"color: #1e293b;\">${senderValue}</span>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\"> :</span>\r\n              <span style=\"color: #1e293b;\">${transaction.receiverNumber || transaction.receiverPhone}</span>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\"> :</span>\r\n              <span style=\"color: #2563eb; font-weight: bold; font-size: 16px;\">${formatNumberEnglish(transaction.transferredAmount || transaction.amount)} </span>\r\n            </div>\r\n          ` : `\r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\"> :</span>\r\n              <span style=\"color: #1e293b;\">${transaction.senderPhone}</span>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\"> :</span>\r\n              <span style=\"color: #dc2626; font-weight: bold; font-size: 16px;\">${formatNumberEnglish(transaction.withdrawnAmountDetailed || transaction.withdrawnAmount || transaction.amount)} </span>\r\n            </div>\r\n          `}\r\n          \r\n          ${transaction.commission ? `\r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\">:</span>\r\n              <span style=\"color: #f59e0b; font-weight: 600;\">${formatNumberEnglish(transaction.commission || 0)} </span>\r\n            </div>\r\n          ` : ''}\r\n          ${transaction.commission ? `\r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\">:</span>\r\n              <span style=\"color: #16a34a; font-weight: 600;\">${formatNumberEnglish(transaction.commission || 0)} </span>\r\n            </div>\r\n          ` : ''}\r\n          ${((transaction as any)?.fee && Number((transaction as any).fee) > 0) ? `\r\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px; padding: 8px 0; border-bottom: 1px solid #f1f5f9;\">\r\n              <span style=\"font-weight: 600; color: #475569;\">:</span>\r\n              <span style=\"color: #64748b; font-weight: 600;\">${formatNumberEnglish((transaction as any).fee || 0)} </span>\r\n            </div>\r\n          ` : ''}\r\n          \r\n          <div style=\"display: flex; justify-content: space-between; padding: 8px 0;\">\r\n            <span style=\"font-weight: 600; color: #475569;\"> :</span>\r\n            <span style=\"color: #1e293b;\">${transaction.createdAt.toLocaleString('ar-EG')}</span>\r\n          </div>\r\n        </div>\r\n        \r\n        <!-- Total Amount -->\r\n        <div style=\"background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); border-radius: 12px; padding: 20px; margin-bottom: 20px; text-align: center;\">\r\n          <h3 style=\"color: white; margin: 0 0 10px 0; font-size: 16px;\"> </h3>\r\n          <p style=\"color: white; font-size: 24px; font-weight: bold; margin: 0;\">\r\n            ${transaction.type === 'withdraw' ? '-' : ''}${formatNumberEnglish(transaction.amount)} \r\n          </p>\r\n        </div>\r\n        \r\n        \r\n        \r\n        \r\n        <!-- Footer -->\r\n        <div style=\"text-align: center; color: #64748b; font-size: 12px; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;\">\r\n          <p style=\"margin: 0 0 5px 0;\">  </p>\r\n          <p style=\"margin: 0;\">   : ${new Date().toLocaleString('ar-EG')}</p>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    const printWindow = window.open('', '_blank');\r\n    if (printWindow) {\r\n      printWindow.document.write(`\r\n        <html>\r\n          <head>\r\n            <title>  - ${transaction.transactionReference || transaction.id}</title>\r\n            <meta charset=\"UTF-8\">\r\n            <style>\r\n              body { \r\n                margin: 0; \r\n                padding: 20px; \r\n                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n                background: #f8fafc;\r\n              }\r\n              @media print {\r\n                body { \r\n                  margin: 0; \r\n                  background: white;\r\n                }\r\n              }\r\n            </style>\r\n          </head>\r\n          <body>\r\n            ${printContent}\r\n          </body>\r\n        </html>\r\n      `);\r\n      printWindow.document.close();\r\n      printWindow.print();\r\n    }\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    if (window.confirm('            .')) {\r\n      onDelete(transaction.id);\r\n      onClose(); //    \r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"w-[92vw] sm:w-auto sm:max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-xl\">\r\n            <Receipt className=\"h-6 w-6 text-blue-600\" />\r\n              \r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-6\">\r\n          {/* Header Section */}\r\n          <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200\">\r\n            <CardHeader className=\"text-center pb-2\">\r\n              <div className=\"flex items-center justify-center gap-2 mb-2\">\r\n                {getStatusIcon(transaction.status)}\r\n                <Badge \r\n                  variant={transaction.status === 'completed' ? 'default' : 'secondary'}\r\n                  className=\"text-sm\"\r\n                >\r\n                  {getStatusText(transaction.status)}\r\n                </Badge>\r\n              </div>\r\n              <h3 className=\"text-2xl font-bold text-blue-600\">\r\n                {transaction.type === 'withdraw' ? '-' : ''}{formatNumberEnglish(transaction.amount)} \r\n              </h3>\r\n              <p className=\"text-sm text-gray-600\">\r\n                 : {transaction.transactionReference || transaction.id}\r\n              </p>\r\n            </CardHeader>\r\n          </Card>\r\n\r\n          {/* Shop Information */}\r\n          <Card>\r\n            <CardHeader className=\"pb-3\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <Store className=\"h-5 w-5 text-green-600\" />\r\n                <h4 className=\"font-semibold text-lg\"> </h4>\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                <span className=\"font-medium text-gray-700\"> :</span>\r\n                <span className=\"text-gray-900\">{transaction.merchantShopName || transaction.shopName || ' '}</span>\r\n              </div>\r\n              {(transaction as any)?.cashierName && (\r\n                <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                  <span className=\"font-medium text-gray-700\">:</span>\r\n                  <span className=\"text-gray-900\">{(transaction as any).cashierName}</span>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Transaction Details */}\r\n          <Card>\r\n            <CardHeader className=\"pb-3\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <CreditCard className=\"h-5 w-5 text-blue-600\" />\r\n                <h4 className=\"font-semibold text-lg\"> </h4>\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              <div className=\"grid grid-cols-1 gap-3\">\r\n                <div className=\"flex items-center justify-between p-3 bg-blue-50 rounded-lg\">\r\n                  <span className=\"font-medium text-blue-700\"> :</span>\r\n                  <Badge variant=\"outline\" className=\"bg-blue-100 text-blue-800\">\r\n                    {getTransactionTypeText(transaction.type)}\r\n                  </Badge>\r\n                </div>\r\n\r\n                {transaction.type !== 'withdraw' ? (\r\n                  <>\r\n                    {(() => {\r\n                      const hasSenderNumber = !!transaction.senderNumber;\r\n                      const hasSenderName = !!transaction.senderName;\r\n                      const senderLabel = hasSenderNumber\r\n                        ? ' :'\r\n                        : hasSenderName\r\n                        ? ' :'\r\n                        : ' :';\r\n                      const senderValue = hasSenderNumber\r\n                        ? transaction.senderNumber\r\n                        : hasSenderName\r\n                        ? transaction.senderName\r\n                        : transaction.senderPhone;\r\n                      const SenderIcon = hasSenderNumber ? User : Phone;\r\n                      return (\r\n                        <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <SenderIcon className=\"h-4 w-4 text-gray-500\" />\r\n                            <span className=\"font-medium text-gray-700\">{senderLabel}</span>\r\n                          </div>\r\n                          <span className=\"text-gray-900 font-mono\">{senderValue}</span>\r\n                        </div>\r\n                      );\r\n                    })()}\r\n\r\n                    <div className=\"flex items-center justify-center p-2\">\r\n                      <ArrowRight className=\"h-6 w-6 text-blue-500\" />\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center justify-between p-3 bg-green-50 rounded-lg\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <User className=\"h-4 w-4 text-green-500\" />\r\n                        <span className=\"font-medium text-green-700\"> :</span>\r\n                      </div>\r\n                      <span className=\"text-green-900 font-mono\">{transaction.receiverNumber || transaction.receiverPhone}</span>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center justify-between p-3 bg-blue-50 rounded-lg\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <DollarSign className=\"h-4 w-4 text-blue-500\" />\r\n                        <span className=\"font-medium text-blue-700\"> :</span>\r\n                      </div>\r\n                      <span className=\"text-blue-900 font-bold text-lg\">{formatNumberEnglish(transaction.transferredAmount || transaction.amount)} </span>\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Phone className=\"h-4 w-4 text-gray-500\" />\r\n                        <span className=\"font-medium text-gray-700\"> :</span>\r\n                      </div>\r\n                      <span className=\"text-gray-900 font-mono\">{transaction.senderPhone}</span>\r\n                    </div>\r\n\r\n                    {(transaction as any)?.senderName && (\r\n                      <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <User className=\"h-4 w-4 text-gray-500\" />\r\n                          <span className=\"font-medium text-gray-700\">  :</span>\r\n                        </div>\r\n                        <span className=\"text-gray-900\">{(transaction as any).senderName}</span>\r\n                      </div>\r\n                    )}\r\n\r\n                    <div className=\"flex items-center justify-between p-3 bg-red-50 rounded-lg\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <DollarSign className=\"h-4 w-4 text-red-500\" />\r\n                        <span className=\"font-medium text-red-700\"> :</span>\r\n                      </div>\r\n                      <span className=\"text-red-900 font-bold text-lg\">{formatNumberEnglish(transaction.withdrawnAmountDetailed || transaction.withdrawnAmount || transaction.amount)} </span>\r\n                    </div>\r\n                  </>\r\n                )}\r\n\r\n                {transaction.commission && (\r\n                  <div className=\"flex items-center justify-between p-3 bg-yellow-50 rounded-lg\">\r\n                    <span className=\"font-medium text-yellow-700\">:</span>\r\n                    <span className=\"text-yellow-900 font-semibold\">{transaction.commission} </span>\r\n                  </div>\r\n                )}\r\n\r\n                {transaction.commission && (\r\n                  <div className=\"flex items-center justify-between p-3 bg-green-50 rounded-lg\">\r\n                    <span className=\"font-medium text-green-700\">:</span>\r\n                    <span className=\"text-green-900 font-semibold\">{transaction.commission} </span>\r\n                  </div>\r\n                )}\r\n\r\n                {(transaction as any)?.fee && Number((transaction as any).fee) > 0 && (\r\n                  <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                    <span className=\"font-medium text-gray-700\">:</span>\r\n                    <span className=\"text-gray-900 font-semibold\">{(transaction as any).fee} </span>\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Calendar className=\"h-4 w-4 text-gray-500\" />\r\n                    <span className=\"font-medium text-gray-700\"> :</span>\r\n                  </div>\r\n                  <span className=\"text-gray-900\">{transaction.createdAt.toLocaleString('ar-EG')}</span>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          \r\n\r\n          {/* Action Buttons */}\r\n          <div className=\"flex gap-3\">\r\n            <Button\r\n              onClick={handlePrint}\r\n              className=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white\"\r\n              size=\"lg\"\r\n            >\r\n              <Printer className=\"h-5 w-5 mr-2\" />\r\n               \r\n            </Button>\r\n            \r\n            <Button\r\n              onClick={handleDelete}\r\n              variant=\"destructive\"\r\n              className=\"flex-1\"\r\n              size=\"lg\"\r\n            >\r\n              <Trash2 className=\"h-5 w-5 mr-2\" />\r\n               \r\n            </Button>\r\n          </div>\r\n\r\n          <Button\r\n            onClick={onClose}\r\n            variant=\"outline\"\r\n            className=\"w-full\"\r\n            size=\"lg\"\r\n          >\r\n             \r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default TransactionDetailsModal;\r\n","import React, { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Lock, Eye, EyeOff, AlertCircle, DollarSign } from 'lucide-react';\r\nimport { MasterPinService } from '@/utils/masterPinService';\r\n\r\ninterface EditBalanceDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  onSuccess: (newAmount: number) => void;\r\n  title: string;\r\n  description: string;\r\n  currentBalance: number;\r\n  balanceLabel: string;\r\n  userId?: string;\r\n}\r\n\r\nexport function EditBalanceDialog({ \r\n  open, \r\n  onOpenChange, \r\n  onSuccess, \r\n  title, \r\n  description,\r\n  currentBalance,\r\n  balanceLabel,\r\n  userId\r\n}: EditBalanceDialogProps) {\r\n  const [pin, setPin] = useState('');\r\n  const [newAmount, setNewAmount] = useState(currentBalance.toString());\r\n  const [showPin, setShowPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  //           \r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      //    \r\n      const amount = parseFloat(newAmount);\r\n      if (isNaN(amount) || amount < 0) {\r\n        setError('   ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      const hasSecretPin = await MasterPinService.hasMasterPin(userId);\r\n      if (hasSecretPin) {\r\n        //     \r\n        const isValid = await MasterPinService.verifyMasterPin(pin, userId);\r\n        if (isValid) {\r\n          onSuccess(amount);\r\n          onOpenChange(false);\r\n          setPin('');\r\n          setNewAmount('');\r\n        } else {\r\n          setError('   ');\r\n        }\r\n      } else {\r\n        setError('     .         ');\r\n      }\r\n    } catch (error) {\r\n      setError('      ');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setPin('');\r\n    setNewAmount(currentBalance.toString());\r\n    setError('');\r\n    onOpenChange(false);\r\n  };\r\n\r\n  //      \r\n  React.useEffect(() => {\r\n    if (open) {\r\n      setNewAmount(currentBalance.toString());\r\n    }\r\n  }, [currentBalance, open]);\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            <DollarSign className=\"h-5 w-5\" />\r\n            {title}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-muted-foreground text-right\">\r\n            {description}\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"bg-gray-50 p-3 rounded-lg\">\r\n            <Label className=\"text-sm font-medium text-gray-700\">\r\n              {balanceLabel} \r\n            </Label>\r\n            <div className=\"text-lg font-bold text-gray-900 mt-1\">\r\n              {currentBalance.toLocaleString()} \r\n            </div>\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"newAmount\" className=\"text-right\">\r\n               \r\n            </Label>\r\n            <Input\r\n              id=\"newAmount\"\r\n              type=\"number\"\r\n              step=\"0.01\"\r\n              min=\"0\"\r\n              value={newAmount}\r\n              onChange={(e) => setNewAmount(e.target.value)}\r\n              placeholder=\"  \"\r\n              className=\"text-right\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"pin\" className=\"text-right\">\r\n               \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"pin\"\r\n                type={showPin ? 'text' : 'password'}\r\n                value={pin}\r\n                onChange={(e) => setPin(e.target.value)}\r\n                placeholder=\"  \"\r\n                className=\"text-right pr-10\"\r\n                required\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowPin(!showPin)}\r\n              >\r\n                {showPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-sm text-red-600 bg-red-50 p-2 rounded\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              className=\"flex-1\"\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading || !pin || !newAmount}\r\n              className=\"flex-1\"\r\n            >\r\n              {isLoading ? (\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n                   ...\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <Lock className=\"h-4 w-4 mr-2\" />\r\n                   \r\n                </>\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}","//      \r\nexport class SecurityService {\r\n  private static readonly SECRET_KEY_BASE = 'dashboard_secret_pin';\r\n  private static secretCache: Map<string, string> = new Map();\r\n\r\n  //    localStorage  \r\n  private static getSecretKey(userId?: string): string {\r\n    return userId ? `${this.SECRET_KEY_BASE}_${userId}` : this.SECRET_KEY_BASE;\r\n  }\r\n\r\n  //    (  )\r\n  static setSecretPin(pin: string, userId?: string): void {\r\n    const encodedPin = btoa(pin); //  \r\n    this.secretCache.set(this.getSecretKey(userId), encodedPin);\r\n  }\r\n\r\n  //      \r\n  static hasSecretPin(userId?: string): boolean {\r\n    return this.secretCache.has(this.getSecretKey(userId));\r\n  }\r\n\r\n  //     \r\n  static verifySecretPin(pin: string, userId?: string): boolean {\r\n    const savedPin = this.secretCache.get(this.getSecretKey(userId));\r\n    if (!savedPin) return false;\r\n    \r\n    try {\r\n      const decodedPin = atob(savedPin);\r\n      return decodedPin === pin;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  //    ( )\r\n  static clearSecretPin(userId?: string): void {\r\n    this.secretCache.delete(this.getSecretKey(userId));\r\n  }\r\n}","import React, { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Lock, Eye, EyeOff, AlertCircle, Settings } from 'lucide-react';\r\nimport { SecurityService } from '@/utils/securityService';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\ninterface ChangePinDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  userId?: string;\r\n}\r\n\r\nexport function ChangePinDialog({ open, onOpenChange, userId }: ChangePinDialogProps) {\r\n  const [currentPin, setCurrentPin] = useState('');\r\n  const [newPin, setNewPin] = useState('');\r\n  const [confirmPin, setConfirmPin] = useState('');\r\n  const [showCurrentPin, setShowCurrentPin] = useState(false);\r\n  const [showNewPin, setShowNewPin] = useState(false);\r\n  const [showConfirmPin, setShowConfirmPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  const hasExistingPin = SecurityService.hasSecretPin(userId);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      //     \r\n      if (!newPin || newPin.length < 4) {\r\n        setError('     4   ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (newPin !== confirmPin) {\r\n        setError('     ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      //          \r\n      if (hasExistingPin) {\r\n        if (!currentPin) {\r\n          setError('    ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        if (!SecurityService.verifySecretPin(currentPin, userId)) {\r\n          setError('    ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      //    \r\n      SecurityService.setSecretPin(newPin, userId);\r\n\r\n      //   \r\n      toast({\r\n        title: hasExistingPin ? \"   \" : \"   \",\r\n        description: hasExistingPin \r\n          ? \"    \" \r\n          : \"    \",\r\n      });\r\n\r\n      //     \r\n      handleClose();\r\n    } catch (error) {\r\n      setError('     ');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setCurrentPin('');\r\n    setNewPin('');\r\n    setConfirmPin('');\r\n    setError('');\r\n    setShowCurrentPin(false);\r\n    setShowNewPin(false);\r\n    setShowConfirmPin(false);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            <Settings className=\"h-5 w-5\" />\r\n            {hasExistingPin ? \"  \" : \"  \"}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-muted-foreground text-right\">\r\n            {hasExistingPin \r\n              ? \"       \"\r\n              : \"         \"\r\n            }\r\n          </div>\r\n\r\n          {/*    (  ) */}\r\n          {hasExistingPin && (\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"currentPin\" className=\"text-right block\">\r\n                  \r\n              </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"currentPin\"\r\n                  type={showCurrentPin ? \"text\" : \"password\"}\r\n                  autoComplete=\"off\"\r\n                  value={currentPin}\r\n                  onChange={(e) => setCurrentPin(e.target.value)}\r\n                  placeholder=\"   \"\r\n                  className=\"pr-10\"\r\n                  dir=\"ltr\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowCurrentPin(!showCurrentPin)}\r\n                >\r\n                  {showCurrentPin ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"newPin\" className=\"text-right block\">\r\n                \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"newPin\"\r\n                type={showNewPin ? \"text\" : \"password\"}\r\n                autoComplete=\"off\"\r\n                value={newPin}\r\n                onChange={(e) => setNewPin(e.target.value)}\r\n                placeholder=\"   \"\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowNewPin(!showNewPin)}\r\n              >\r\n                {showNewPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*     */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"confirmPin\" className=\"text-right block\">\r\n                 \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"confirmPin\"\r\n                type={showConfirmPin ? \"text\" : \"password\"}\r\n                autoComplete=\"off\"\r\n                value={confirmPin}\r\n                onChange={(e) => setConfirmPin(e.target.value)}\r\n                placeholder=\"    \"\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowConfirmPin(!showConfirmPin)}\r\n              >\r\n                {showConfirmPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*   */}\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-red-600 text-sm\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {/*   */}\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              className=\"flex-1\"\r\n            >\r\n              <Lock className=\"h-4 w-4 mr-2\" />\r\n              {isLoading ? \" ...\" : (hasExistingPin ? \"  \" : \"  \")}\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              disabled={isLoading}\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}","import React, { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Lock, Eye, EyeOff, AlertCircle, DollarSign } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\nconst cashPinsCache: Map<string, string> = new Map();\r\n\r\ninterface ChangeCashPinDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  userId?: string;\r\n}\r\n\r\nexport function ChangeCashPinDialog({ open, onOpenChange, userId }: ChangeCashPinDialogProps) {\r\n  const [currentPin, setCurrentPin] = useState('');\r\n  const [newPin, setNewPin] = useState('');\r\n  const [confirmPin, setConfirmPin] = useState('');\r\n  const [showCurrentPin, setShowCurrentPin] = useState(false);\r\n  const [showNewPin, setShowNewPin] = useState(false);\r\n  const [showConfirmPin, setShowConfirmPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  const CASH_PIN_KEY = userId ? `cash_drawer_pin_${userId}` : 'cash_drawer_pin';\r\n  \r\n  const hasExistingPin = () => {\r\n    return cashPinsCache.has(CASH_PIN_KEY);\r\n  };\r\n\r\n  const verifyCurrentPin = (pin: string) => {\r\n    const savedPin = cashPinsCache.get(CASH_PIN_KEY);\r\n    if (!savedPin) return false;\r\n    \r\n    try {\r\n      const decodedPin = atob(savedPin);\r\n      return decodedPin === pin;\r\n    } catch {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const saveNewPin = (pin: string) => {\r\n    const encodedPin = btoa(pin);\r\n    cashPinsCache.set(CASH_PIN_KEY, encodedPin);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      //     \r\n      if (!newPin || newPin.length < 4) {\r\n        setError('     4   ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (newPin !== confirmPin) {\r\n        setError('     ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      //          \r\n      if (hasExistingPin()) {\r\n        if (!currentPin) {\r\n          setError('      ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        if (!verifyCurrentPin(currentPin)) {\r\n          setError('      ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      //    \r\n      saveNewPin(newPin);\r\n\r\n      //   \r\n      toast({\r\n        title: hasExistingPin() ? \"    \" : \"    \",\r\n        description: hasExistingPin() \r\n          ? \"      \" \r\n          : \"      \",\r\n      });\r\n\r\n      //     \r\n      handleClose();\r\n    } catch (error) {\r\n      setError('       ');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setCurrentPin('');\r\n    setNewPin('');\r\n    setConfirmPin('');\r\n    setError('');\r\n    setShowCurrentPin(false);\r\n    setShowNewPin(false);\r\n    setShowConfirmPin(false);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            <DollarSign className=\"h-5 w-5 text-green-600\" />\r\n            {hasExistingPin() ? \"   \" : \"   \"}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-muted-foreground text-right\">\r\n            {hasExistingPin() \r\n              ? \"        \"\r\n              : \"         \"\r\n            }\r\n          </div>\r\n\r\n          {/*    (  ) */}\r\n          {hasExistingPin() && (\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"currentPin\" className=\"text-right block\">\r\n                    \r\n              </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"currentPin\"\r\n                  type={showCurrentPin ? \"text\" : \"password\"}\r\n                  autoComplete=\"off\"\r\n                  value={currentPin}\r\n                  onChange={(e) => setCurrentPin(e.target.value)}\r\n                  placeholder=\"   \"\r\n                  className=\"pr-10\"\r\n                  dir=\"ltr\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowCurrentPin(!showCurrentPin)}\r\n                >\r\n                  {showCurrentPin ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"newPin\" className=\"text-right block\">\r\n                  \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"newPin\"\r\n                type={showNewPin ? \"text\" : \"password\"}\r\n                autoComplete=\"off\"\r\n                value={newPin}\r\n                onChange={(e) => setNewPin(e.target.value)}\r\n                placeholder=\"   \"\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowNewPin(!showNewPin)}\r\n              >\r\n                {showNewPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*     */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"confirmPin\" className=\"text-right block\">\r\n                 \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"confirmPin\"\r\n                type={showConfirmPin ? \"text\" : \"password\"}\r\n                autoComplete=\"off\"\r\n                value={confirmPin}\r\n                onChange={(e) => setConfirmPin(e.target.value)}\r\n                placeholder=\"    \"\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowConfirmPin(!showConfirmPin)}\r\n              >\r\n                {showConfirmPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*   */}\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-red-600 text-sm\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {/*   */}\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              className=\"flex-1 bg-green-600 hover:bg-green-700\"\r\n            >\r\n              <Lock className=\"h-4 w-4 mr-2\" />\r\n              {isLoading ? \" ...\" : (hasExistingPin() ? \"   \" : \"   \")}\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              disabled={isLoading}\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </form>\r\n\r\n        <div className=\"text-xs text-gray-500 text-center mt-2\">\r\n                  \r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}","import React, { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Lock, Eye, EyeOff, AlertCircle, Wallet } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\nconst walletTotalPinsCache: Map<string, string> = new Map();\r\n\r\ninterface ChangeWalletTotalPinDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  userId?: string;\r\n}\r\n\r\nexport function ChangeWalletTotalPinDialog({ open, onOpenChange, userId }: ChangeWalletTotalPinDialogProps) {\r\n  const [currentPin, setCurrentPin] = useState('');\r\n  const [newPin, setNewPin] = useState('');\r\n  const [confirmPin, setConfirmPin] = useState('');\r\n  const [showCurrentPin, setShowCurrentPin] = useState(false);\r\n  const [showNewPin, setShowNewPin] = useState(false);\r\n  const [showConfirmPin, setShowConfirmPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  const WALLET_TOTAL_PIN_KEY = userId ? `wallet_total_pin_${userId}` : 'wallet_total_pin';\r\n  \r\n  const hasExistingPin = () => {\r\n    return walletTotalPinsCache.has(WALLET_TOTAL_PIN_KEY);\r\n  };\r\n\r\n  const verifyCurrentPin = (pin: string) => {\r\n    const savedPin = walletTotalPinsCache.get(WALLET_TOTAL_PIN_KEY);\r\n    if (!savedPin) return false;\r\n    \r\n    try {\r\n      const decodedPin = atob(savedPin);\r\n      return decodedPin === pin;\r\n    } catch {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const saveNewPin = (pin: string) => {\r\n    const encodedPin = btoa(pin);\r\n    walletTotalPinsCache.set(WALLET_TOTAL_PIN_KEY, encodedPin);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      //     \r\n      if (!newPin || newPin.length < 4) {\r\n        setError('     4   ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (newPin !== confirmPin) {\r\n        setError('     ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      //          \r\n      if (hasExistingPin()) {\r\n        if (!currentPin) {\r\n          setError('      ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        if (!verifyCurrentPin(currentPin)) {\r\n          setError('      ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      //    \r\n      saveNewPin(newPin);\r\n\r\n      //   \r\n      toast({\r\n        title: hasExistingPin() ? \"    \" : \"    \",\r\n        description: hasExistingPin() \r\n          ? \"      \" \r\n          : \"      \",\r\n      });\r\n\r\n      //     \r\n      handleClose();\r\n    } catch (error) {\r\n      setError('       ');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setCurrentPin('');\r\n    setNewPin('');\r\n    setConfirmPin('');\r\n    setError('');\r\n    setShowCurrentPin(false);\r\n    setShowNewPin(false);\r\n    setShowConfirmPin(false);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            <Wallet className=\"h-5 w-5 text-blue-600\" />\r\n            {hasExistingPin() ? \"   \" : \"   \"}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-muted-foreground text-right\">\r\n            {hasExistingPin() \r\n              ? \"        \"\r\n              : \"         \"\r\n            }\r\n          </div>\r\n\r\n          {/*    (  ) */}\r\n          {hasExistingPin() && (\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"currentPin\" className=\"text-right block\">\r\n                    \r\n              </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"currentPin\"\r\n                  type={showCurrentPin ? \"text\" : \"password\"}\r\n                  autoComplete=\"off\"\r\n                  value={currentPin}\r\n                  onChange={(e) => setCurrentPin(e.target.value)}\r\n                  placeholder=\"   \"\r\n                  className=\"pr-10\"\r\n                  dir=\"ltr\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowCurrentPin(!showCurrentPin)}\r\n                >\r\n                  {showCurrentPin ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"newPin\" className=\"text-right block\">\r\n                  \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"newPin\"\r\n                type={showNewPin ? \"text\" : \"password\"}\r\n                autoComplete=\"off\"\r\n                value={newPin}\r\n                onChange={(e) => setNewPin(e.target.value)}\r\n                placeholder=\"   \"\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowNewPin(!showNewPin)}\r\n              >\r\n                {showNewPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*     */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"confirmPin\" className=\"text-right block\">\r\n                 \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"confirmPin\"\r\n                type={showConfirmPin ? \"text\" : \"password\"}\r\n                autoComplete=\"off\"\r\n                value={confirmPin}\r\n                onChange={(e) => setConfirmPin(e.target.value)}\r\n                placeholder=\"    \"\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowConfirmPin(!showConfirmPin)}\r\n              >\r\n                {showConfirmPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*   */}\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-red-600 text-sm\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {/*   */}\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              className=\"flex-1 bg-blue-600 hover:bg-blue-700\"\r\n            >\r\n              <Lock className=\"h-4 w-4 mr-2\" />\r\n              {isLoading ? \" ...\" : (hasExistingPin() ? \"   \" : \"   \")}\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              disabled={isLoading}\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </form>\r\n\r\n        <div className=\"text-xs text-gray-500 text-center mt-2\">\r\n                  \r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}","import React, { useEffect, useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Lock, Eye, EyeOff, AlertCircle, Plus, Minus } from 'lucide-react';\r\nimport { MasterPinService } from '@/utils/masterPinService';\r\n\r\ninterface AddToWalletDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  onSuccess: (addedAmount: number) => void;\r\n  title: string;\r\n  description: string;\r\n  currentBalance: number;\r\n  balanceLabel: string;\r\n  userId?: string;\r\n}\r\n\r\nexport function AddToWalletDialog({ \r\n  open, \r\n  onOpenChange, \r\n  onSuccess, \r\n  title, \r\n  description,\r\n  currentBalance,\r\n  balanceLabel,\r\n  userId\r\n}: AddToWalletDialogProps) {\r\n  const [pin, setPin] = useState('');\r\n  const [amount, setAmount] = useState('');\r\n  const [operationType, setOperationType] = useState<'add' | 'subtract'>('add');\r\n  const [showPin, setShowPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  const [hasMasterPin, setHasMasterPin] = useState(false);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n      const has = await MasterPinService.hasMasterPin(userId);\r\n      if (mounted) setHasMasterPin(has);\r\n    })();\r\n    return () => { mounted = false; };\r\n  }, [userId, open]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      //    \r\n      const amountValue = parseFloat(amount);\r\n      if (isNaN(amountValue) || amountValue <= 0) {\r\n        setError('      ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      //         \r\n      if (operationType === 'subtract' && amountValue > currentBalance) {\r\n        setError('       ');\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (hasMasterPin) {\r\n        //     \r\n        const ok = await MasterPinService.verifyMasterPin(pin, userId);\r\n        if (ok) {\r\n          const finalAmount = operationType === 'add' ? amountValue : -amountValue;\r\n          \r\n          //   \r\n          handleClose();\r\n          \r\n          //   \r\n          onSuccess(finalAmount);\r\n        } else {\r\n          setError('   ');\r\n        }\r\n      } else {\r\n        setError('     .      ');\r\n      }\r\n    } catch (error) {\r\n      setError('      ');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setPin('');\r\n    setAmount('');\r\n    setOperationType('add');\r\n    setError('');\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const getNewBalance = () => {\r\n    const amountValue = parseFloat(amount) || 0;\r\n    if (operationType === 'add') {\r\n      return currentBalance + amountValue;\r\n    } else {\r\n      return currentBalance - amountValue;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            {operationType === 'add' ? (\r\n              <Plus className=\"h-5 w-5 text-green-600\" />\r\n            ) : (\r\n              <Minus className=\"h-5 w-5 text-red-600\" />\r\n            )}\r\n            {title}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-muted-foreground text-right\">\r\n            {description}\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"bg-gray-50 p-3 rounded-lg\">\r\n            <Label className=\"text-sm font-medium text-gray-700\">\r\n              {balanceLabel} \r\n            </Label>\r\n            <div className=\"text-lg font-bold text-gray-900 mt-1\">\r\n              {currentBalance.toLocaleString()} \r\n            </div>\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label className=\"text-right\"> </Label>\r\n            <div className=\"flex gap-2\">\r\n              <Button\r\n                type=\"button\"\r\n                variant={operationType === 'add' ? 'default' : 'outline'}\r\n                onClick={() => setOperationType('add')}\r\n                className=\"flex-1 flex items-center gap-2\"\r\n              >\r\n                <Plus className=\"h-4 w-4\" />\r\n                \r\n              </Button>\r\n              <Button\r\n                type=\"button\"\r\n                variant={operationType === 'subtract' ? 'default' : 'outline'}\r\n                onClick={() => setOperationType('subtract')}\r\n                className=\"flex-1 flex items-center gap-2\"\r\n              >\r\n                <Minus className=\"h-4 w-4\" />\r\n                \r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*   */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"amount\" className=\"text-right\">\r\n                {operationType === 'add' ? '' : ''}\r\n            </Label>\r\n            <Input\r\n              id=\"amount\"\r\n              type=\"number\"\r\n              step=\"0.01\"\r\n              min=\"0.01\"\r\n              value={amount}\r\n              onChange={(e) => setAmount(e.target.value)}\r\n              placeholder={`   ${operationType === 'add' ? '' : ''}`}\r\n              className=\"text-right\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          {/*     */}\r\n          {amount && !isNaN(parseFloat(amount)) && (\r\n            <div className={`p-3 rounded-lg ${operationType === 'add' ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}`}>\r\n              <Label className=\"text-sm font-medium text-gray-700\">\r\n                  \r\n              </Label>\r\n              <div className={`text-lg font-bold mt-1 ${operationType === 'add' ? 'text-green-700' : 'text-red-700'}`}>\r\n                {getNewBalance().toLocaleString()} \r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"pin\" className=\"text-right\">\r\n               \r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"pin\"\r\n                type={showPin ? 'text' : 'password'}\r\n                autoComplete=\"off\"\r\n                value={pin}\r\n                onChange={(e) => setPin(e.target.value)}\r\n                placeholder=\"  \"\r\n                className=\"text-right pr-10\"\r\n                required\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowPin(!showPin)}\r\n              >\r\n                {showPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-sm text-red-600 bg-red-50 p-2 rounded\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              className=\"flex-1\"\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading || !pin || !amount}\r\n              className={`flex-1 ${operationType === 'add' ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'}`}\r\n            >\r\n              {isLoading ? (\r\n                <div className=\"flex items-center gap-2\">\r\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n                   ...\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <Lock className=\"h-4 w-4 mr-2\" />\r\n                  {operationType === 'add' ? ' ' : ' '}\r\n                </>\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}","import { merchantWalletService } from '@/integrations/firebase/services';\r\nimport { db, auth } from '@/firebase';\r\nimport { doc, setDoc, getDoc, collection, query, where, getDocs, serverTimestamp, Timestamp } from 'firebase/firestore';\r\n\r\n// Runtime guard to prevent invalid Firestore document paths\r\nconst isValidId = (id: any): id is string => typeof id === 'string' && id.trim().length > 0;\r\n\r\n//    \r\ninterface WalletUsage {\r\n  walletId: string;\r\n  used_transfer: number;\r\n  used_withdraw: number;\r\n  monthly_limit: number;\r\n  last_reset: Timestamp | null;\r\n  updatedAt: Timestamp;\r\n}\r\n\r\n//   \r\ninterface Transaction {\r\n  id: string;\r\n  uid: string;\r\n  type: 'transfer' | 'withdraw';\r\n  amount: number;\r\n  createdAt: Timestamp;\r\n  status: string;\r\n}\r\n\r\n//    \r\nexport const walletLimitsService = {\r\n  //     \r\n  getCurrentMonthId(): string {\r\n    const now = new Date();\r\n    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;\r\n  },\r\n\r\n  //       Firebase\r\n  async getWalletUsage(walletId: string): Promise<WalletUsage | null> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('Error getting wallet usage: invalid walletId', walletId);\r\n        return null;\r\n      }\r\n      //        walletLimits\r\n      const limitsRef = doc(db, 'walletLimits', walletId);\r\n      const limitsSnap = await getDoc(limitsRef);\r\n      \r\n      if (limitsSnap.exists()) {\r\n        const data = limitsSnap.data();\r\n        return {\r\n          walletId,\r\n          used_transfer: (data.monthlyTransferUsed ?? data.used_transfer ?? 0),\r\n          used_withdraw: (data.monthlyWithdrawUsed ?? data.used_withdraw ?? 0),\r\n          monthly_limit: (data.monthlyLimit ?? data.monthlyTransferLimit ?? data.monthlyWithdrawLimit ?? 200000),\r\n          last_reset: (data.lastMonthlyReset ?? data.last_reset ?? null),\r\n          updatedAt: data.updatedAt || Timestamp.now()\r\n        };\r\n      }\r\n      \r\n      //       \r\n      const newUsage: WalletUsage = {\r\n        walletId,\r\n        used_transfer: 0,\r\n        used_withdraw: 0,\r\n        monthly_limit: 200000,\r\n        last_reset: null,\r\n        updatedAt: Timestamp.now()\r\n      };\r\n      \r\n      //   \r\n      await setDoc(limitsRef, {\r\n        monthlyTransferUsed: 0,\r\n        monthlyWithdrawUsed: 0,\r\n        monthlyTransferLimit: 200000,\r\n        monthlyWithdrawLimit: 200000,\r\n        lastMonthlyReset: null,\r\n        updatedAt: serverTimestamp(),\r\n        ownerId: auth.currentUser?.uid\r\n      });\r\n      \r\n      return newUsage;\r\n    } catch (error) {\r\n      console.error('Error getting wallet usage:', error);\r\n      return {\r\n        walletId,\r\n        used_transfer: 0,\r\n        used_withdraw: 0,\r\n        monthly_limit: 200000,\r\n        last_reset: null,\r\n        updatedAt: Timestamp.now()\r\n      };\r\n    }\r\n  },\r\n\r\n  //        (   )\r\n  shouldResetLimits(lastReset: Timestamp | null): boolean {\r\n    const now = new Date();\r\n    const currentDay = now.getDate();\r\n    \r\n    if (!lastReset) {\r\n      return currentDay === 1;\r\n    }\r\n    \r\n    //           \r\n    if (currentDay === 1) {\r\n      const lastResetDate = lastReset.toDate();\r\n      const currentMonth = now.getMonth();\r\n      const currentYear = now.getFullYear();\r\n      \r\n      //         \r\n      return (lastResetDate.getMonth() !== currentMonth || lastResetDate.getFullYear() !== currentYear);\r\n    }\r\n    \r\n    return false;\r\n  },\r\n\r\n  //      \r\n  async autoResetLimitsIfNeeded(walletId: string): Promise<boolean> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('    : walletId  ', walletId);\r\n        return false;\r\n      }\r\n      // Debug\r\n      if (typeof import.meta !== 'undefined' && (import.meta as any).env && (import.meta as any).env.DEV) {\r\n        console.debug('autoResetLimitsIfNeeded -> walletId:', walletId);\r\n      }\r\n      const usage = await this.getWalletUsage(walletId);\r\n      if (!usage) return false;\r\n      \r\n      if (this.shouldResetLimits(usage.last_reset)) {\r\n        console.log(`     ${walletId} -    `);\r\n        return await this.resetWalletUsage(walletId);\r\n      }\r\n      \r\n      return false;\r\n    } catch (error) {\r\n      console.error('    :', error);\r\n      return false;\r\n    }\r\n  },\r\n  \r\n  //     serverTimestamp\r\n  async resetWalletUsage(walletId: string): Promise<boolean> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('    : walletId  ', walletId);\r\n        return false;\r\n      }\r\n      const limitsRef = doc(db, 'walletLimits', walletId);\r\n      \r\n      //       serverTimestamp\r\n      await setDoc(limitsRef, {\r\n        monthlyTransferUsed: 0,\r\n        monthlyWithdrawUsed: 0,\r\n        lastMonthlyReset: serverTimestamp(),\r\n        updatedAt: serverTimestamp()\r\n      }, { merge: true });\r\n      \r\n      console.log(`     ${walletId} `);\r\n      return true;\r\n    } catch (error) {\r\n      console.error('    :', error);\r\n      return false;\r\n    }\r\n  },\r\n\r\n  //        last_reset\r\n  async calculateUsageFromTransactions(walletId: string): Promise<{ used_transfer: number; used_withdraw: number }> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('     : walletId  ', walletId);\r\n        return { used_transfer: 0, used_withdraw: 0 };\r\n      }\r\n      const limitsRef = doc(db, 'walletLimits', walletId);\r\n      const now = new Date();\r\n      let lastReset: Timestamp | null = Timestamp.fromDate(new Date(now.getFullYear(), now.getMonth(), 1));\r\n      try {\r\n        const limitsSnap = await getDoc(limitsRef);\r\n        lastReset = limitsSnap.exists() ? (limitsSnap.data()?.lastMonthlyReset ?? limitsSnap.data()?.last_reset ?? lastReset) : lastReset;\r\n      } catch {}\r\n      \r\n      //   \r\n      const txQuery = query(\r\n        collection(db, 'tx'),\r\n        where('uid', '==', walletId),\r\n        ...(lastReset ? [where('createdAt', '>=', lastReset)] : [])\r\n      );\r\n      \r\n      const txSnap = await getDocs(txQuery);\r\n      let used_transfer = 0;\r\n      let used_withdraw = 0;\r\n      \r\n      txSnap.forEach((doc) => {\r\n        const tx = doc.data() as Transaction;\r\n        if (tx.status === 'completed') {\r\n          if (tx.type === 'transfer') {\r\n            used_transfer += tx.amount;\r\n          } else if (tx.type === 'withdraw') {\r\n            used_withdraw += tx.amount;\r\n          }\r\n        }\r\n      });\r\n      \r\n      return { used_transfer, used_withdraw };\r\n    } catch (error) {\r\n      console.error('     :', error);\r\n      return { used_transfer: 0, used_withdraw: 0 };\r\n    }\r\n  },\r\n\r\n  //          (Optimistic UI)\r\n  async getWalletUsageWithRefresh(walletId: string): Promise<WalletUsage | null> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('      : walletId  ', walletId);\r\n        return null;\r\n      }\r\n      // Debug\r\n      if (typeof import.meta !== 'undefined' && (import.meta as any).env && (import.meta as any).env.DEV) {\r\n        console.debug('getWalletUsageWithRefresh -> walletId:', walletId);\r\n      }\r\n      //     \r\n      const usage = await this.getWalletUsage(walletId);\r\n      if (!usage) {\r\n        const calculatedUsage = await this.calculateUsageFromTransactions(walletId);\r\n        const limitsRef = doc(db, 'walletLimits', walletId);\r\n        try {\r\n          await setDoc(limitsRef, {\r\n            monthlyTransferUsed: calculatedUsage.used_transfer,\r\n            monthlyWithdrawUsed: calculatedUsage.used_withdraw,\r\n            updatedAt: serverTimestamp(),\r\n            ownerId: auth.currentUser?.uid\r\n          }, { merge: true });\r\n        } catch {}\r\n        return {\r\n          walletId,\r\n          used_transfer: calculatedUsage.used_transfer,\r\n          used_withdraw: calculatedUsage.used_withdraw,\r\n          monthly_limit: 200000,\r\n          last_reset: null,\r\n          updatedAt: Timestamp.now()\r\n        };\r\n      }\r\n      \r\n      //        \r\n      const calculatedUsage = await this.calculateUsageFromTransactions(walletId);\r\n      \r\n      //      \r\n      if (usage.used_transfer !== calculatedUsage.used_transfer || \r\n          usage.used_withdraw !== calculatedUsage.used_withdraw) {\r\n        \r\n        const limitsRef = doc(db, 'walletLimits', walletId);\r\n        \r\n        try {\r\n          await setDoc(limitsRef, {\r\n            monthlyTransferUsed: calculatedUsage.used_transfer,\r\n            monthlyWithdrawUsed: calculatedUsage.used_withdraw,\r\n            updatedAt: serverTimestamp(),\r\n            ownerId: auth.currentUser?.uid\r\n          }, { merge: true });\r\n        } catch {}\r\n        \r\n        //    \r\n        return await this.getWalletUsage(walletId);\r\n      }\r\n      \r\n      return usage;\r\n    } catch (error) {\r\n      console.error('      :', error);\r\n      return {\r\n        walletId,\r\n        used_transfer: 0,\r\n        used_withdraw: 0,\r\n        monthly_limit: 200000,\r\n        last_reset: null,\r\n        updatedAt: Timestamp.now()\r\n      };\r\n    }\r\n  },\r\n\r\n  //  : remaining = monthly_limit - used_*\r\n  calculateRemaining(usage: WalletUsage): { remainingTransfer: number; remainingWithdraw: number } {\r\n    return {\r\n      remainingTransfer: Math.max(0, usage.monthly_limit - usage.used_transfer),\r\n      remainingWithdraw: Math.max(0, usage.monthly_limit - usage.used_withdraw)\r\n    };\r\n  },\r\n\r\n  //          \r\n  async canPerformOperation(walletId: string, amount: number, type: 'transfer' | 'withdraw'): Promise<{ canPerform: boolean; message?: string; remaining?: number }> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        console.error('Error checking operation limits: invalid walletId', walletId);\r\n        return { canPerform: false, message: 'walletId  ' };\r\n      }\r\n      //     \r\n      const usage = await this.getWalletUsageWithRefresh(walletId);\r\n      if (!usage) {\r\n        return { canPerform: false, message: '      ' };\r\n      }\r\n\r\n      const remaining = this.calculateRemaining(usage);\r\n      \r\n      if (type === 'transfer') {\r\n        if (amount > remaining.remainingTransfer) {\r\n          return { \r\n            canPerform: false, \r\n            message: `   . : ${remaining.remainingTransfer.toLocaleString()} .   ${usage.monthly_limit.toLocaleString()} .`,\r\n            remaining: remaining.remainingTransfer\r\n          };\r\n        }\r\n      }\r\n\r\n      if (type === 'withdraw') {\r\n        if (amount > remaining.remainingWithdraw) {\r\n          return { \r\n            canPerform: false, \r\n            message: `   . : ${remaining.remainingWithdraw.toLocaleString()} .   ${usage.monthly_limit.toLocaleString()} .`,\r\n            remaining: remaining.remainingWithdraw\r\n          };\r\n        }\r\n      }\r\n\r\n      return { canPerform: true };\r\n    } catch (error) {\r\n      console.error('Error checking operation limits:', error);\r\n      return { canPerform: false, message: '    ' };\r\n    }\r\n  },\r\n  \r\n  //       Optimistic UI\r\n  async updateUsage(walletId: string, amount: number, type: 'transfer' | 'withdraw'): Promise<WalletUsage> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        throw new Error('walletId  ');\r\n      }\r\n      //      \r\n      const currentUsage = await this.getWalletUsageWithRefresh(walletId);\r\n      if (!currentUsage) {\r\n        throw new Error('      ');\r\n      }\r\n\r\n      //     \r\n      const canPerform = await this.canPerformOperation(walletId, amount, type);\r\n      if (!canPerform.canPerform) {\r\n        throw new Error(canPerform.message || '   ');\r\n      }\r\n\r\n      //  \r\n      const newUsedTransfer = type === 'transfer' ? currentUsage.used_transfer + amount : currentUsage.used_transfer;\r\n      const newUsedWithdraw = type === 'withdraw' ? currentUsage.used_withdraw + amount : currentUsage.used_withdraw;\r\n\r\n      //    Firebase  await\r\n      const ref = doc(db, 'walletLimits', currentUsage.walletId);\r\n      \r\n      try {\r\n        await setDoc(ref, {\r\n          monthlyTransferUsed: newUsedTransfer,\r\n          monthlyWithdrawUsed: newUsedWithdraw,\r\n          updatedAt: serverTimestamp(),\r\n          ownerId: auth.currentUser?.uid\r\n        }, { merge: true });\r\n      } catch {}\r\n\r\n      //      \r\n      let updatedUsage = await this.getWalletUsageWithRefresh(walletId);\r\n      if (!updatedUsage) {\r\n        updatedUsage = {\r\n          walletId,\r\n          used_transfer: newUsedTransfer,\r\n          used_withdraw: newUsedWithdraw,\r\n          monthly_limit: currentUsage.monthly_limit,\r\n          last_reset: currentUsage.last_reset,\r\n          updatedAt: Timestamp.now()\r\n        } as WalletUsage;\r\n      }\r\n\r\n      return updatedUsage;\r\n    } catch (error) {\r\n      console.error('Error updating wallet usage:', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  //       Firebase\r\n  async resetWalletUsageManually(walletId: string): Promise<WalletUsage> {\r\n    try {\r\n      if (!isValidId(walletId)) {\r\n        throw new Error('walletId  ');\r\n      }\r\n      const ref = doc(db, 'walletLimits', walletId);\r\n      \r\n      //       \r\n      const resetUsage: WalletUsage = {\r\n        walletId,\r\n        used_transfer: 0,\r\n        used_withdraw: 0,\r\n        monthly_limit: 0,\r\n        last_reset: null,\r\n        updatedAt: new Date() as any\r\n      };\r\n\r\n      //    Firebase  \r\n      setDoc(ref, {\r\n        monthlyTransferUsed: 0,\r\n        monthlyWithdrawUsed: 0,\r\n        lastMonthlyReset: serverTimestamp(),\r\n        updatedAt: serverTimestamp()\r\n      }, { merge: true }).catch(error => {\r\n        console.error('      Firebase:', error);\r\n      });\r\n\r\n      console.log(`     ${walletId} `);\r\n      return resetUsage;\r\n    } catch (error) {\r\n      console.error('Error resetting wallet usage:', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  //      \r\n  async getAllWalletsUsage(merchantUserId: string): Promise<WalletUsage[]> {\r\n    try {\r\n      //     \r\n      const wallets = await merchantWalletService.getByMerchantId(merchantUserId);\r\n      const usagePromises = wallets.map(wallet => this.getWalletUsageWithRefresh(wallet.id));\r\n      const usageResults = await Promise.all(usagePromises);\r\n      \r\n      return usageResults.filter(usage => usage !== null) as WalletUsage[];\r\n    } catch (error) {\r\n      console.error('Error getting all wallets usage:', error);\r\n      return [];\r\n    }\r\n  },\r\n\r\n\r\n\r\n\r\n};\r\n","import React, { useEffect, useMemo, useState, useRef } from 'react';\r\nimport { Capacitor } from '@capacitor/core';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { createPortal } from 'react-dom';\r\nimport { Bell, CheckCircle, ExternalLink } from 'lucide-react';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { Broadcast, subscribeToActiveBroadcastsList } from '@/utils/broadcastService';\r\nimport { Button } from '@/components/ui/button';\r\nimport { db } from '@/firebase';\r\nimport { collection, addDoc, query, where, getDocs, serverTimestamp } from 'firebase/firestore';\r\n\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuLabel,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from '@/components/ui/dropdown-menu';\r\n\r\ninterface NotificationBellProps {\r\n  className?: string;\r\n}\r\n\r\nfunction useReadIdsKey(userId?: string) {\r\n  return userId ? `readBroadcastIds_${userId}` : `readBroadcastIds_guest`;\r\n}\r\n\r\nexport default function NotificationBell({ className }: NotificationBellProps) {\r\n  const { user, profile, isSubscriptionActive } = useFirebaseAuth();\r\n  const location = useLocation();\r\n  const [notifications, setNotifications] = useState<Broadcast[]>([]);\r\n  const [readIds, setReadIds] = useState<Set<string>>(new Set());\r\n\r\n  // States for queue\r\n  const [queueOpen, setQueueOpen] = useState(false);\r\n  const [queueReason, setQueueReason] = useState('');\r\n  const [queueSubmitting, setQueueSubmitting] = useState(false);\r\n  const [queueMessage, setQueueMessage] = useState<string | null>(null);\r\n  const [queueLatestStatus, setQueueLatestStatus] = useState<'none' | 'pending' | 'contacted'>('none');\r\n\r\n  //        5     \r\n  const [flyAlert, setFlyAlert] = useState<Broadcast | null>(null);\r\n  const [flyVisible, setFlyVisible] = useState(false);\r\n  const prevIdsRef = useRef<Set<string>>(new Set());\r\n  const didInitRef = useRef(false);\r\n  const isFirstFetchRef = useRef(true);\r\n  const flyTimerRef = useRef<number | null>(null);\r\n  //        \r\n  const triggerRef = useRef<HTMLDivElement | null>(null);\r\n  const flyNodeRef = useRef<HTMLDivElement | null>(null);\r\n  const [flyStyle, setFlyStyle] = useState<React.CSSProperties>({ position: 'fixed', top: 0, left: 0, zIndex: 10000 });\r\n  \r\n  //     (fly-out)  \r\n  const ENABLE_FLY_ALERT = true;\r\n\r\n  const audienceKeys = useMemo(() => {\r\n    const keys: string[] = ['global'];\r\n    if (user?.uid) keys.push(`user:${user.uid}`);\r\n    if (profile?.shopId) keys.push(`shop:${profile.shopId}`);\r\n    return keys;\r\n  }, [user?.uid, profile?.shopId]);\r\n\r\n  const storageKey = useReadIdsKey(user?.uid);\r\n\r\n  //          \r\n  const canShowNotifications = useMemo(() => {\r\n    const onPendingApprovalPage = location?.pathname?.includes('/user/pending-approval');\r\n    //         \r\n    //        \r\n    const isSignedIn = Boolean(user?.uid);\r\n    return isSignedIn && !onPendingApprovalPage;\r\n  }, [user?.uid, location?.pathname]);\r\n\r\n  useEffect(() => {\r\n    //         \r\n    try {\r\n      const raw = localStorage.getItem(storageKey);\r\n      if (raw) {\r\n        const arr = JSON.parse(raw);\r\n        if (Array.isArray(arr)) setReadIds(new Set(arr.filter(Boolean)));\r\n      } else {\r\n        setReadIds(new Set());\r\n      }\r\n    } catch (e) {\r\n      console.warn('Failed to load read ids', e);\r\n      setReadIds(new Set());\r\n    }\r\n  }, [storageKey]);\r\n\r\n  useEffect(() => {\r\n    //         \r\n    if (!canShowNotifications) {\r\n      setNotifications([]);\r\n      return;\r\n    }\r\n\r\n    //         (  )\r\n    isFirstFetchRef.current = true;\r\n    \r\n    const fetchNotifications = () => {\r\n        subscribeToActiveBroadcastsList(audienceKeys, (list) => {\r\n            if (isFirstFetchRef.current) {\r\n                //        (  )   \"\"\r\n                //            \r\n                const now = Date.now();\r\n                const freshThreshold = 60 * 1000; //  \r\n                \r\n                const oldIds = list.filter(n => {\r\n                    //    \r\n                    const createdAt = n.createdAt?.toMillis ? n.createdAt.toMillis() : (n.createdAt?.seconds ? n.createdAt.seconds * 1000 : 0);\r\n                    const isFresh = (now - createdAt) < freshThreshold;\r\n                    return !isFresh; //         \r\n                }).map(n => n.id).filter(Boolean) as string[];\r\n\r\n                prevIdsRef.current = new Set(oldIds);\r\n                isFirstFetchRef.current = false;\r\n            }\r\n            setNotifications(list);\r\n        });\r\n    };\r\n\r\n    //  \r\n    fetchNotifications();\r\n\r\n    //   OneSignal       \r\n    const handleOneSignalNotification = (event: any) => {\r\n        console.log(' OneSignal Notification received', event);\r\n        \r\n        // 1.        (Client-side)  \r\n        try {\r\n            const notif = event.notification || event;\r\n            if (notif && (notif.title || notif.body)) {\r\n                const instantBroadcast: Broadcast = {\r\n                    id: `temp_${Date.now()}`,\r\n                    title: notif.title || ' ',\r\n                    message: notif.body || notif.message || '',\r\n                    audienceKey: 'global',\r\n                    active: true,\r\n                    createdAt: { toMillis: () => Date.now(), seconds: Math.floor(Date.now() / 1000), nanoseconds: 0 } as any,\r\n                };\r\n                \r\n                //  \r\n                setFlyAlert(instantBroadcast);\r\n                setFlyVisible(true);\r\n                \r\n                //   \r\n                if (flyTimerRef.current) clearTimeout(flyTimerRef.current as any);\r\n                flyTimerRef.current = window.setTimeout(() => {\r\n                    setFlyVisible(false);\r\n                    setFlyAlert(null);\r\n                }, 5000);\r\n            }\r\n        } catch (e) {\r\n            console.error('Error parsing OneSignal event for instant alert', e);\r\n        }\r\n\r\n        // 2.     \r\n        fetchNotifications();\r\n    };\r\n\r\n    //   \r\n    try {\r\n        const OneSignal = (window as any).OneSignal;\r\n        if (OneSignal && OneSignal.Notifications && OneSignal.Notifications.addEventListener) {\r\n            OneSignal.Notifications.addEventListener('foregroundWillDisplay', handleOneSignalNotification);\r\n        }\r\n    } catch (e) {\r\n        console.error('Failed to add OneSignal listener', e);\r\n    }\r\n\r\n    return () => {\r\n        try {\r\n            const OneSignal = (window as any).OneSignal;\r\n            if (OneSignal && OneSignal.Notifications && OneSignal.Notifications.removeEventListener) {\r\n                OneSignal.Notifications.removeEventListener('foregroundWillDisplay', handleOneSignalNotification);\r\n            }\r\n        } catch {}\r\n    };\r\n  }, [audienceKeys, canShowNotifications]);\r\n\r\n  //            5 \r\n  useEffect(() => {\r\n    if (!ENABLE_FLY_ALERT) return; //    \r\n    const ids = new Set((notifications.map((n) => n.id).filter(Boolean) as string[]));\r\n    \r\n    //     didInitRef    isFirstFetchRef   \r\n    //          \r\n    const newItems = notifications.filter((n) => n.id && !prevIdsRef.current.has(n.id!));\r\n    if (newItems.length > 0) {\r\n      setFlyAlert(newItems[0]);\r\n      setFlyVisible(true);\r\n      if (flyTimerRef.current) {\r\n        clearTimeout(flyTimerRef.current as any);\r\n      }\r\n      flyTimerRef.current = window.setTimeout(() => {\r\n        setFlyVisible(false);\r\n        setFlyAlert(null);\r\n      }, 5000);\r\n    }\r\n    prevIdsRef.current = ids;\r\n  }, [notifications]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (flyTimerRef.current) {\r\n        clearTimeout(flyTimerRef.current as any);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const unreadCount = notifications.reduce((acc, n) => acc + (n.id && !readIds.has(n.id) ? 1 : 0), 0);\r\n  //        \r\n\r\n  const markAsRead = (id?: string) => {\r\n    if (!id) return;\r\n    if (readIds.has(id)) return;\r\n    const next = new Set(readIds);\r\n    next.add(id);\r\n    setReadIds(next);\r\n    try {\r\n      localStorage.setItem(storageKey, JSON.stringify(Array.from(next)));\r\n    } catch {}\r\n  };\r\n\r\n  const markAllAsRead = () => {\r\n    const ids = notifications.map((n) => n.id).filter(Boolean) as string[];\r\n    const next = new Set(readIds);\r\n    ids.forEach((id) => next.add(id));\r\n    setReadIds(next);\r\n    try {\r\n      localStorage.setItem(storageKey, JSON.stringify(Array.from(next)));\r\n    } catch {}\r\n  };\r\n\r\n  const openLink = (url?: string, id?: string) => {\r\n    if (url) {\r\n      try {\r\n        const isAndroid = Capacitor?.isNativePlatform && Capacitor.getPlatform() === 'android';\r\n        const isApk = /\\.apk(\\?|$)/i.test(url);\r\n        if (isAndroid && isApk) {\r\n          const deeplink = `cashy://update?url=${encodeURIComponent(url)}`;\r\n          window.location.href = deeplink;\r\n        } else {\r\n          window.open(url, '_blank');\r\n        }\r\n      } catch {\r\n        try { window.open(url, '_blank'); } catch {}\r\n      }\r\n    }\r\n    if (id) markAsRead(id);\r\n  };\r\n\r\n  //      (  )\r\n  const updateFlyPosition = () => {\r\n    if (!triggerRef.current || !flyNodeRef.current) return;\r\n    const rect = triggerRef.current.getBoundingClientRect();\r\n    const margin = 8;\r\n    const width = flyNodeRef.current.offsetWidth || 320;\r\n    const top = rect.bottom + margin;\r\n    let left = rect.right - width; //    \r\n    const viewportWidth = window.innerWidth;\r\n    left = Math.min(Math.max(left, margin), viewportWidth - width - margin);\r\n    setFlyStyle((prev) => ({ ...prev, top, left }));\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!ENABLE_FLY_ALERT) return; //       \r\n    if (!flyVisible) return;\r\n    updateFlyPosition();\r\n    const handler = () => updateFlyPosition();\r\n    window.addEventListener('resize', handler);\r\n    window.addEventListener('scroll', handler, true);\r\n    return () => {\r\n      window.removeEventListener('resize', handler);\r\n      window.removeEventListener('scroll', handler, true);\r\n    };\r\n  }, [flyVisible]);\r\n\r\n  const submitQueueRequest = async () => {\r\n    if (!user?.uid) {\r\n      alert('    .');\r\n      return;\r\n    }\r\n    const reason = queueReason.trim();\r\n    if (!reason) {\r\n      alert('    .');\r\n      return;\r\n    }\r\n    try {\r\n      setQueueSubmitting(true);\r\n      setQueueMessage(null);\r\n      const name = (profile?.fullName && profile.fullName.trim())\r\n        ? profile.fullName.trim()\r\n        : (user.email ? user.email.split('@')[0] : '');\r\n      const phone = profile?.phone || null;\r\n      await addDoc(collection(db, 'waiting_list'), {\r\n        userId: user.uid,\r\n        name,\r\n        phone,\r\n        reason,\r\n        status: 'pending',\r\n        createdAt: serverTimestamp(),\r\n      });\r\n      setQueueMessage('       ');\r\n      setQueueReason('');\r\n      //      \r\n      setTimeout(() => setQueueOpen(false), 900);\r\n    } catch (e) {\r\n      console.error('    :', e);\r\n      alert('    .   .');\r\n    } finally {\r\n      setQueueSubmitting(false);\r\n    }\r\n  };\r\n\r\n  //          \r\n  useEffect(() => {\r\n    if (!user?.uid) {\r\n      setQueueLatestStatus('none');\r\n      return;\r\n    }\r\n    //        \r\n    const checkQueueStatus = async () => {\r\n      try {\r\n        const q = query(\r\n          collection(db, 'waiting_list'),\r\n          where('userId', '==', user.uid)\r\n        );\r\n        const snapshot = await getDocs(q);\r\n        \r\n        const docs = snapshot.docs\r\n          .map((d) => ({ id: d.id, ...d.data() }))\r\n          .sort((a: any, b: any) => {\r\n            const ta = a?.createdAt?.toMillis?.() ?? a?.createdAt?.seconds * 1000 ?? 0;\r\n            const tb = b?.createdAt?.toMillis?.() ?? b?.createdAt?.seconds * 1000 ?? 0;\r\n            return tb - ta; // \r\n          });\r\n\r\n        if (docs.length === 0) {\r\n          setQueueLatestStatus('none');\r\n          return;\r\n        }\r\n\r\n        const latest = docs[0] as any;\r\n        const contacted = latest?.contacted === true || latest?.status === 'contacted';\r\n        setQueueLatestStatus(contacted ? 'contacted' : 'pending');\r\n      } catch (e) {\r\n        console.warn('    waiting_list:', e);\r\n        setQueueLatestStatus('none');\r\n      }\r\n    };\r\n\r\n    checkQueueStatus();\r\n  }, [user?.uid]);\r\n\r\n  if (!canShowNotifications) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className={`relative inline-flex items-center gap-2 ${className || ''}`} ref={triggerRef}>\r\n      {/*     */}\r\n      <DropdownMenu onOpenChange={(open) => { if (open && unreadCount > 0) markAllAsRead(); }}>\r\n        <DropdownMenuTrigger asChild>\r\n          <Button\r\n            variant=\"ghost\"\r\n            className=\"relative h-8 w-8 rounded-full p-0 hover:bg-transparent focus:ring-1 focus:ring-primary focus:ring-offset-1 transition-all\"\r\n            title=\"\"\r\n          >\r\n            <div className=\"relative h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center border border-border shadow-sm hover:shadow-md\">\r\n              <Bell className=\"h-4 w-4 text-primary\" />\r\n              {unreadCount > 0 && (\r\n                <span className=\"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-red-500 text-white text-[10px] font-bold flex items-center justify-center shadow\">\r\n                  {unreadCount}\r\n                </span>\r\n              )}\r\n            </div>\r\n          </Button>\r\n        </DropdownMenuTrigger>\r\n        <DropdownMenuContent className=\"w-80\" align=\"end\" forceMount>\r\n          <DropdownMenuLabel className=\"flex items-center justify-between\">\r\n            <span></span>\r\n            {notifications.length > 0 && (\r\n              <Button variant=\"outline\" size=\"sm\" className=\"h-7 text-xs\" onClick={markAllAsRead}>\r\n                <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n                  \r\n              </Button>\r\n            )}\r\n          </DropdownMenuLabel>\r\n          <DropdownMenuSeparator />\r\n\r\n          {notifications.length === 0 ? (\r\n            <div className=\"p-3 text-sm text-muted-foreground\">   </div>\r\n          ) : (\r\n            <div className=\"max-h-64 overflow-y-auto pr-1\">\r\n              {notifications.map((n) => {\r\n                const isUnread = n.id ? !readIds.has(n.id) : false;\r\n                return (\r\n                  <div key={n.id} className={`px-2 py-2 rounded-md ${isUnread ? 'bg-primary/5' : ''}`}>\r\n                    <div className=\"flex items-start gap-2\">\r\n                      <Bell className={`h-4 w-4 ${isUnread ? 'text-primary' : 'text-muted-foreground'}`} />\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"text-sm font-medium\">{n.title || ''}</div>\r\n                        <div className=\"text-xs text-muted-foreground whitespace-pre-line\">{n.message}</div>\r\n                        {n.linkUrl && (\r\n                          <Button variant=\"link\" className=\"px-0 h-6 text-xs\" onClick={() => openLink(n.linkUrl, n.id)}>\r\n                              <ExternalLink className=\"h-3 w-3 ml-1\" />\r\n                          </Button>\r\n                        )}\r\n                      </div>\r\n                      {isUnread ? (\r\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => markAsRead(n.id)} title=\" \">\r\n                          <CheckCircle className=\"h-4 w-4 text-primary\" />\r\n                        </Button>\r\n                      ) : (\r\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" disabled title=\"\">\r\n                          <CheckCircle className=\"h-4 w-4 text-muted-foreground\" />\r\n                        </Button>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n        </DropdownMenuContent>\r\n      </DropdownMenu>\r\n\r\n\r\n      {/*          */}\r\n      {ENABLE_FLY_ALERT && flyAlert && createPortal(\r\n        <div ref={flyNodeRef} style={flyStyle} className={`pointer-events-auto transition-all duration-300 ${flyVisible ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-3'}`}>\r\n          <div className=\"bg-white rounded-xl shadow-2xl border border-gray-200 p-4 w-80 max-w-[calc(100vw-16px)] flex items-start gap-3\">\r\n            <div className=\"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center\">\r\n              <Bell className=\"w-4 h-4 text-primary\" />\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <div className=\"text-sm font-semibold\">{flyAlert.title || ' '}</div>\r\n              <div className=\"text-xs text-muted-foreground whitespace-pre-line\">{flyAlert.message}</div>\r\n              {flyAlert.linkUrl && (\r\n                <Button variant=\"link\" className=\"px-0 h-6 text-xs\" onClick={() => openLink(flyAlert.linkUrl, flyAlert.id)}>\r\n                   \r\n                </Button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>,\r\n        document.body\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Calculator, X } from 'lucide-react';\r\n\r\ninterface CalculatorDialogProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport function CalculatorDialog({ isOpen, onClose }: CalculatorDialogProps) {\r\n  const [display, setDisplay] = useState('0');\r\n  const [previousValue, setPreviousValue] = useState<number | null>(null);\r\n  const [operation, setOperation] = useState<string | null>(null);\r\n  const [waitingForOperand, setWaitingForOperand] = useState(false);\r\n\r\n  const inputNumber = (num: string) => {\r\n    if (waitingForOperand) {\r\n      setDisplay(num);\r\n      setWaitingForOperand(false);\r\n    } else {\r\n      setDisplay(display === '0' ? num : display + num);\r\n    }\r\n  };\r\n\r\n  const inputOperation = (nextOperation: string) => {\r\n    const inputValue = parseFloat(display);\r\n\r\n    if (previousValue === null) {\r\n      setPreviousValue(inputValue);\r\n    } else if (operation) {\r\n      const currentValue = previousValue || 0;\r\n      const newValue = calculate(currentValue, inputValue, operation);\r\n\r\n      setDisplay(String(newValue));\r\n      setPreviousValue(newValue);\r\n    }\r\n\r\n    setWaitingForOperand(true);\r\n    setOperation(nextOperation);\r\n  };\r\n\r\n  const calculate = (firstValue: number, secondValue: number, operation: string): number => {\r\n    switch (operation) {\r\n      case '+':\r\n        return firstValue + secondValue;\r\n      case '-':\r\n        return firstValue - secondValue;\r\n      case '':\r\n        return firstValue * secondValue;\r\n      case '':\r\n        if (secondValue === 0) {\r\n          return 0; //    Infinity    \r\n        }\r\n        return firstValue / secondValue;\r\n      case '=':\r\n        return secondValue;\r\n      default:\r\n        return secondValue;\r\n    }\r\n  };\r\n\r\n  const performCalculation = () => {\r\n    const inputValue = parseFloat(display);\r\n\r\n    if (previousValue !== null && operation) {\r\n      const newValue = calculate(previousValue, inputValue, operation);\r\n      setDisplay(String(newValue));\r\n      setPreviousValue(null);\r\n      setOperation(null);\r\n      setWaitingForOperand(true);\r\n    }\r\n  };\r\n\r\n  const clearAll = () => {\r\n    setDisplay('0');\r\n    setPreviousValue(null);\r\n    setOperation(null);\r\n    setWaitingForOperand(false);\r\n  };\r\n\r\n  const clearEntry = () => {\r\n    setDisplay('0');\r\n  };\r\n\r\n  const inputDecimal = () => {\r\n    if (waitingForOperand) {\r\n      setDisplay('0.');\r\n      setWaitingForOperand(false);\r\n    } else if (display.indexOf('.') === -1) {\r\n      setDisplay(display + '.');\r\n    }\r\n  };\r\n\r\n  const toggleSign = () => {\r\n    if (display !== '0') {\r\n      setDisplay(display.charAt(0) === '-' ? display.slice(1) : '-' + display);\r\n    }\r\n  };\r\n\r\n  const percentage = () => {\r\n    const value = parseFloat(display);\r\n    setDisplay(String(value / 100));\r\n  };\r\n\r\n  //   \r\n  const handleKeyPress = (event: KeyboardEvent) => {\r\n    const key = event.key;\r\n    \r\n    //    \r\n    event.preventDefault();\r\n    \r\n    //  0-9\r\n    if (key >= '0' && key <= '9') {\r\n      inputNumber(key);\r\n    }\r\n    //  \r\n    else if (key === '+') {\r\n      inputOperation('+');\r\n    }\r\n    else if (key === '-') {\r\n      inputOperation('-');\r\n    }\r\n    else if (key === '*') {\r\n      inputOperation('');\r\n    }\r\n    else if (key === '/') {\r\n      inputOperation('');\r\n    }\r\n    //  \r\n    else if (key === 'Enter' || key === '=') {\r\n      performCalculation();\r\n    }\r\n    else if (key === 'Escape' || key === 'c' || key === 'C') {\r\n      clearAll();\r\n    }\r\n    else if (key === 'Backspace') {\r\n      clearEntry();\r\n    }\r\n    else if (key === '.') {\r\n      inputDecimal();\r\n    }\r\n    else if (key === '%') {\r\n      percentage();\r\n    }\r\n  };\r\n\r\n  //   event listener  /  \r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      document.addEventListener('keydown', handleKeyPress);\r\n    } else {\r\n      document.removeEventListener('keydown', handleKeyPress);\r\n    }\r\n\r\n    //    \r\n    return () => {\r\n      document.removeEventListener('keydown', handleKeyPress);\r\n    };\r\n  }, [isOpen, display, previousValue, operation, waitingForOperand]);\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={(open) => !open && onClose()}>\r\n      <DialogContent className=\"sm:max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            <Calculator className=\"h-5 w-5\" />\r\n             \r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <div className=\"space-y-4\">\r\n          {/*   */}\r\n          <div className=\"bg-gray-900 text-white p-4 rounded-lg text-right\">\r\n            <div className=\"text-3xl font-mono font-bold min-h-[3rem] flex items-center justify-end overflow-hidden\">\r\n              {display}\r\n            </div>\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"grid grid-cols-4 gap-2\">\r\n            {/*   */}\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-gray-100 hover:bg-gray-200\"\r\n              onClick={clearAll}\r\n            >\r\n              AC\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-gray-100 hover:bg-gray-200\"\r\n              onClick={clearEntry}\r\n            >\r\n              CE\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-gray-100 hover:bg-gray-200\"\r\n              onClick={percentage}\r\n            >\r\n              %\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600\"\r\n              onClick={() => inputOperation('')}\r\n            >\r\n              \r\n            </Button>\r\n\r\n            {/*   */}\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('7')}\r\n            >\r\n              7\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('8')}\r\n            >\r\n              8\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('9')}\r\n            >\r\n              9\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600\"\r\n              onClick={() => inputOperation('')}\r\n            >\r\n              \r\n            </Button>\r\n\r\n            {/*   */}\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('4')}\r\n            >\r\n              4\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('5')}\r\n            >\r\n              5\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('6')}\r\n            >\r\n              6\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600\"\r\n              onClick={() => inputOperation('-')}\r\n            >\r\n              -\r\n            </Button>\r\n\r\n            {/*   */}\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('1')}\r\n            >\r\n              1\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('2')}\r\n            >\r\n              2\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={() => inputNumber('3')}\r\n            >\r\n              3\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600\"\r\n              onClick={() => inputOperation('+')}\r\n            >\r\n              +\r\n            </Button>\r\n\r\n            {/*   */}\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50 col-span-2\"\r\n              onClick={() => inputNumber('0')}\r\n            >\r\n              0\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-lg font-semibold bg-white hover:bg-gray-50\"\r\n              onClick={inputDecimal}\r\n            >\r\n              .\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-12 text-sm font-semibold bg-orange-500 text-white hover:bg-orange-600\"\r\n              onClick={performCalculation}\r\n            >\r\n              =\r\n            </Button>\r\n          </div>\r\n\r\n          {/*     */}\r\n          <Button\r\n            variant=\"outline\"\r\n            className=\"w-full h-10 text-sm font-semibold bg-gray-100 hover:bg-gray-200\"\r\n            onClick={toggleSign}\r\n          >\r\n            +/-\r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\nexport default CalculatorDialog;","import React, { useState, useEffect, useMemo } from 'react';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogDescription,\r\n  DialogFooter,\r\n} from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { db } from '@/firebase';\r\nimport { collection, addDoc, serverTimestamp, query, where, limit, getDocs, updateDoc, deleteDoc, doc, setDoc } from 'firebase/firestore';\r\nimport { X, Plus, Edit, Edit3, Trash2, Save, XCircle, DollarSign, Package, TrendingUp, Calculator, BookOpen, ChevronDown, ChevronUp, Calendar, Clock, BarChart3, Target, Award, TrendingDown, AlertCircle, Info, ChevronLeft, ChevronRight, Eye, EyeOff, Receipt, Search, ScanBarcode, Printer, Lock, RefreshCw, FileText, RotateCcw } from 'lucide-react';\r\nimport { getUserSubscription, SubscriptionPlan } from '@/utils/subscriptionService';\r\nimport { useShift } from '@/contexts/ShiftContext';\r\nimport { userDataService, telegramNotifier } from '@/integrations/firebase/services';\r\nimport { useShop } from '@/hooks/useShop';\r\n\r\ninterface SalesDataDialogProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  initialBarcode?: string | null;\r\n}\r\n\r\ninterface SaleItem {\r\n  id: string;\r\n  productName: string;\r\n  price: number;\r\n  wholesalePrice?: number;\r\n  quantity: number;\r\n  date: string;\r\n  time: string;\r\n  performedByType?: 'cashier' | 'admin';\r\n  performedByName?: string;\r\n  performedByUsername?: string | null;\r\n  serialNumber?: string;\r\n  barcode?: string;\r\n  firestoreId?: string;\r\n  isDeferred?: boolean;\r\n  customerName?: string;\r\n  customerMobile?: string;\r\n  customerId?: string;\r\n  createdAtMs?: number;\r\n}\r\n\r\ninterface NewProduct {\r\n  productName: string;\r\n  price: string;\r\n  wholesalePrice?: string;\r\n  quantity: string;\r\n  barcode?: string;\r\n  serialNumber?: string;\r\n}\r\n\r\ninterface ShopProduct {\r\n  id: string;\r\n  name: string;\r\n  sellingPrice: number;\r\n  wholesalePrice: number;\r\n  quantity: number;\r\n  barcode?: string;\r\n  serialNumber?: string;\r\n}\r\n\r\nexport function SalesDataDialog({ isOpen, onClose, initialBarcode }: SalesDataDialogProps) {\r\n  const [salesData, setSalesData] = useState<SaleItem[]>([]);\r\n  const [newProduct, setNewProduct] = useState<NewProduct>({ productName: '', price: '', wholesalePrice: '', quantity: '', barcode: '', serialNumber: '' });\r\n  const [isAddProductOpen, setIsAddProductOpen] = useState<boolean>(false);\r\n  const [editingId, setEditingId] = useState<string | null>(null);\r\n  //  :    /  \r\n  const { toast } = useToast();\r\n  const { user, profile } = useFirebaseAuth();\r\n  const { isShiftActive, shiftUser } = useShift();\r\n  const { shopId: shopIdCtx } = useShop();\r\n  const [shopProducts, setShopProducts] = useState<ShopProduct[]>([]);\r\nconst [sellingQtyByProduct, setSellingQtyByProduct] = useState<Record<string, string>>({});\r\nconst [addQtyByProduct, setAddQtyByProduct] = useState<Record<string, string>>({});\r\nconst [serialByProduct, setSerialByProduct] = useState<Record<string, string>>({});\r\nconst [scannedBarcode, setScannedBarcode] = useState<string>('');\r\nconst [isInvoiceMode, setIsInvoiceMode] = useState<boolean>(false);\r\nconst [invoiceSelections, setInvoiceSelections] = useState<Record<string, number>>({});\r\n// /     \r\nconst [isWholesaleVisible, setIsWholesaleVisible] = useState<boolean>(false);\r\n//      \r\n  const [isProfitLocked, setIsProfitLocked] = useState<boolean>(true);\r\n  const [isProfitPinDialogOpen, setIsProfitPinDialogOpen] = useState<boolean>(false);\r\nconst barcodeBufferRef = React.useRef<string>('');\r\nconst lastKeyTimeRef = React.useRef<number>(0);\r\n  const [monthlySalesTotal, setMonthlySalesTotal] = useState<number>(0);\r\n  const [monthlyProfitTotal, setMonthlyProfitTotal] = useState<number>(0);\r\n  const [isMobileStatsOpen, setIsMobileStatsOpen] = useState<boolean>(false);\r\n  const [isMasterPinDialogOpen, setIsMasterPinDialogOpen] = useState<boolean>(false);\r\n  const [isMonthlyLocked, setIsMonthlyLocked] = useState<boolean>(true);\r\nconst [isMonthlyCollapsed, setIsMonthlyCollapsed] = useState<boolean>(false);\r\nconst [isSalesReceiptsDialogOpen, setIsSalesReceiptsDialogOpen] = useState<boolean>(false);\r\n//  :        \r\nconst [isProductStatsCollapsed, setIsProductStatsCollapsed] = useState<boolean>(true);\r\nconst [isTipsCollapsed, setIsTipsCollapsed] = useState<boolean>(true);\r\n  //        \r\n  const [sellingPriceOverrideByProduct, setSellingPriceOverrideByProduct] = useState<Record<string, string>>({});\r\n  //        (/)\r\n  const [isMasterPinActionOpen, setIsMasterPinActionOpen] = useState<boolean>(false);\r\n  const [masterPinActionTitle, setMasterPinActionTitle] = useState<string>('  ');\r\n  const [masterPinActionDescription, setMasterPinActionDescription] = useState<string>('    ');\r\n  const protectedActionRef = React.useRef<(() => void) | null>(null);\r\n  const requireMasterPin = (title: string, description: string, action: () => Promise<void> | void) => {\r\n    setMasterPinActionTitle(title);\r\n    setMasterPinActionDescription(description);\r\n    protectedActionRef.current = action;\r\n    setIsMasterPinActionOpen(true);\r\n  };\r\n  const [customers, setCustomers] = useState<{ id: string; name: string; mobile?: string }[]>([]);\r\n  const [isDeferredFormOpen, setIsDeferredFormOpen] = useState<boolean>(false);\r\n  const [deferredCustomerId, setDeferredCustomerId] = useState<string>('');\r\n  const [deferredCustomerName, setDeferredCustomerName] = useState<string>('');\r\n  const [deferredCustomerMobile, setDeferredCustomerMobile] = useState<string>('');\r\n  const [pendingDeferredProduct, setPendingDeferredProduct] = useState<ShopProduct | null>(null);\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        if (!isOpen || !user?.uid) return;\r\n        const data = await userDataService.getUserData(user.uid);\r\n        const list = Array.isArray(data?.customers) ? data.customers.map((c: any) => ({ id: String(c.id || ''), name: String(c.name || ''), mobile: c.mobile || undefined })) : [];\r\n        setCustomers(list);\r\n      } catch {}\r\n    })();\r\n  }, [isOpen, user?.uid]);\r\n  //    /\r\n  const [isDeleteConfirmOpen, setIsDeleteConfirmOpen] = useState<boolean>(false);\r\n  const [deleteTargetSale, setDeleteTargetSale] = useState<SaleItem | null>(null);\r\n  const [deleteActionType, setDeleteActionType] = useState<'return' | 'delete' | null>(null);\r\n  const openDeleteConfirm = (sale: SaleItem, type: 'return' | 'delete') => {\r\n    setDeleteTargetSale(sale);\r\n    setDeleteActionType(type);\r\n    setIsDeleteConfirmOpen(true);\r\n  };\r\n  //    \r\n  const [productSearchTerm, setProductSearchTerm] = useState<string>('');\r\n  const filteredShopProducts = useMemo(() => {\r\n    const term = productSearchTerm.trim().toLowerCase();\r\n    if (!term) return shopProducts;\r\n    return shopProducts.filter(p => p.name.toLowerCase().includes(term));\r\n  }, [shopProducts, productSearchTerm]);\r\n\r\n  //     (  prompt)\r\n  const [isAddQtyDialogOpen, setIsAddQtyDialogOpen] = useState<boolean>(false);\r\n  const [productToAddQty, setProductToAddQty] = useState<ShopProduct | null>(null);\r\n  const [qtyToAdd, setQtyToAdd] = useState<string>('1');\r\n\r\n  const handleOpenAddQtyDialog = (product: ShopProduct) => {\r\n    setProductToAddQty(product);\r\n    setQtyToAdd('1');\r\n    setIsAddQtyDialogOpen(true);\r\n  };\r\n\r\n  const handleAddQtyConfirm = () => {\r\n    if (!productToAddQty) return;\r\n    const q = parseInt(qtyToAdd);\r\n    if (q > 0) {\r\n      setIsAddQtyDialogOpen(false);\r\n      requireMasterPin(' ', ` ${q}   ${productToAddQty.name}`, async () => {\r\n         try {\r\n            const newQty = productToAddQty.quantity + q;\r\n            await updateDoc(doc(db, 'products', productToAddQty.id), { quantity: newQty, updatedAt: serverTimestamp() });\r\n            setShopProducts(prev => prev.map(p => p.id === productToAddQty.id ? { ...p, quantity: newQty } : p));\r\n            toast({ title: ' ', description: `  ${q} ` });\r\n         } catch (e) { console.error(e); }\r\n      });\r\n    }\r\n  };\r\n\r\n  const getUtcDateYYYYMMDD = () => new Date().toISOString().split('T')[0];\r\n\r\n  //        \r\n  useEffect(() => {\r\n    if (isOpen && user?.uid) {\r\n      loadSalesData();\r\n      //          PIN \r\n      if (!isMonthlyLocked) {\r\n        loadMonthlyStats();\r\n      }\r\n    }\r\n  }, [isOpen, user?.uid, isMonthlyLocked]);\r\n\r\n  //       \r\n  //           loadSalesData\r\n\r\n\r\n  //       (   )\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    const handler = (e: KeyboardEvent) => {\r\n      //        input/textarea    \r\n      const target = e.target as HTMLElement | null;\r\n      const tag = target?.tagName?.toLowerCase();\r\n      const isTyping = tag === 'input' || tag === 'textarea' || !!(target && (target as any).isContentEditable);\r\n      if (isTyping) return;\r\n      //    PIN        \r\n      if (isMasterPinActionOpen || isMasterPinDialogOpen || isProfitPinDialogOpen) return;\r\n\r\n      const now = Date.now();\r\n      if (e.key === 'Enter') {\r\n        const code = (barcodeBufferRef.current || '').trim();\r\n        barcodeBufferRef.current = '';\r\n        if (code) {\r\n          processBarcode(code);\r\n        }\r\n        return;\r\n      }\r\n      if (e.key.length === 1) {\r\n        if (now - (lastKeyTimeRef.current || 0) > 100) {\r\n          barcodeBufferRef.current = '';\r\n        }\r\n        barcodeBufferRef.current += e.key;\r\n        lastKeyTimeRef.current = now;\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handler as unknown as EventListener);\r\n    return () => window.removeEventListener('keydown', handler as unknown as EventListener);\r\n  }, [isOpen, shopProducts, isMasterPinActionOpen, isMasterPinDialogOpen, isProfitPinDialogOpen]);\r\n\r\n  //        \r\n  useEffect(() => {\r\n    if (isOpen && initialBarcode) {\r\n      processBarcode(initialBarcode);\r\n    }\r\n  }, [isOpen, initialBarcode]);\r\n\r\n  //     Firestore   \r\n  const loadShopProducts = async () => {\r\n    if (!user?.uid) return;\r\n    \r\n    const shopId = profile?.shopId || shopIdCtx || 'main';\r\n    const storageKey = `shopProducts_${user.uid}_${shopId}`;\r\n\r\n    //      \r\n    try {\r\n      const savedProducts = localStorage.getItem(storageKey);\r\n      if (savedProducts) {\r\n        const parsed = JSON.parse(savedProducts);\r\n        if (Array.isArray(parsed) && parsed.length > 0) {\r\n           setShopProducts(parsed);\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.warn('Failed to load products from cache', e);\r\n    }\r\n\r\n    try {\r\n      let snap;\r\n      let products: ShopProduct[] = [];\r\n\r\n      //         \r\n      if (profile?.shopId) {\r\n        const byUserAndShop = query(\r\n          collection(db, 'products'),\r\n          where('shopId', '==', profile.shopId),\r\n          where('userId', '==', user.uid)\r\n        );\r\n        snap = await getDocs(byUserAndShop);\r\n        products = snap.docs.map(d => ({\r\n          id: d.id,\r\n          name: String(d.data().name ?? ''),\r\n          sellingPrice: Number(d.data().sellingPrice ?? 0),\r\n          wholesalePrice: Number(d.data().wholesalePrice ?? 0),\r\n          quantity: Number(d.data().quantity ?? 0),\r\n          barcode: String(d.data().barcode ?? ''),\r\n          serialNumber: String(d.data().serialNumber ?? ''),\r\n        }));\r\n\r\n        //  :          \r\n        if (products.length === 0) {\r\n          const byUserOnly = query(\r\n            collection(db, 'products'),\r\n            where('userId', '==', user.uid)\r\n          );\r\n          const fallbackSnap = await getDocs(byUserOnly);\r\n          const fallbackProducts: ShopProduct[] = fallbackSnap.docs.map(d => ({\r\n            id: d.id,\r\n            name: String(d.data().name ?? ''),\r\n            sellingPrice: Number(d.data().sellingPrice ?? 0),\r\n            wholesalePrice: Number(d.data().wholesalePrice ?? 0),\r\n            quantity: Number(d.data().quantity ?? 0),\r\n            barcode: String(d.data().barcode ?? ''),\r\n            serialNumber: String(d.data().serialNumber ?? ''),\r\n          }));\r\n\r\n          if (fallbackProducts.length > 0) {\r\n            products = fallbackProducts;\r\n            //        /\r\n            toast({\r\n              title: '  ',\r\n              description: '         .',\r\n            });\r\n          }\r\n        }\r\n      } else {\r\n        const byUser = query(\r\n          collection(db, 'products'),\r\n          where('userId', '==', user.uid)\r\n        );\r\n        snap = await getDocs(byUser);\r\n        products = snap.docs.map(d => ({\r\n          id: d.id,\r\n          name: String(d.data().name ?? ''),\r\n          sellingPrice: Number(d.data().sellingPrice ?? 0),\r\n          wholesalePrice: Number(d.data().wholesalePrice ?? 0),\r\n          quantity: Number(d.data().quantity ?? 0),\r\n          barcode: String(d.data().barcode ?? ''),\r\n          serialNumber: String(d.data().serialNumber ?? ''),\r\n        }));\r\n      }\r\n\r\n      setShopProducts(products);\r\n      \r\n      //        \r\n      try {\r\n        localStorage.setItem(storageKey, JSON.stringify(products));\r\n      } catch {}\r\n\r\n      //  :        shopId   \r\n      if (profile?.shopId && products.length > 0) {\r\n        const missingShopProducts = products.filter(p => {\r\n          //       \r\n          const original = (snap?.docs || []).find(d => d.id === p.id);\r\n          const hasShopId = !!original && !!(original.data() as any).shopId;\r\n          return !hasShopId;\r\n        });\r\n        if (missingShopProducts.length > 0) {\r\n          try {\r\n            await Promise.all(\r\n              missingShopProducts.map(p => updateDoc(doc(db, 'products', p.id), {\r\n                shopId: profile.shopId,\r\n                updatedAt: serverTimestamp(),\r\n              }))\r\n            );\r\n            toast({\r\n              title: '  ',\r\n              description: '        .',\r\n            });\r\n          } catch (migrationError) {\r\n            console.warn('  shopId  :', migrationError);\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading shop products:', error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isOpen && user?.uid) {\r\n      loadShopProducts();\r\n      loadMonthlyStats();\r\n      loadSalesData();\r\n      recoverUnsyncedSalesToFirestore();\r\n    }\r\n  }, [isOpen, user?.uid, profile?.shopId]);\r\n\r\n  const getLocalDateYYYYMMDD = () => {\r\n    const d = new Date();\r\n    const y = d.getFullYear();\r\n    const m = String(d.getMonth() + 1).padStart(2, '0');\r\n    const dd = String(d.getDate()).padStart(2, '0');\r\n    return `${y}-${m}-${dd}`;\r\n  };\r\n\r\n  const sortSales = (arr: SaleItem[]) => {\r\n    const key = (it: SaleItem) => {\r\n      if (typeof it.createdAtMs === 'number') return it.createdAtMs;\r\n      const n = parseInt(it.id, 10);\r\n      if (!isNaN(n)) return n;\r\n      const dt = new Date(it.date);\r\n      return isNaN(dt.getTime()) ? 0 : dt.getTime();\r\n    };\r\n    return [...arr].sort((a, b) => key(b) - key(a));\r\n  };\r\n\r\n  const loadSalesData = () => {\r\n    if (!user?.uid) {\r\n      console.log('No user authenticated, cannot load sales data');\r\n      return;\r\n    }\r\n    const sid = shopIdCtx || (profile as any)?.shopId || 'main';\r\n    const allKey = `salesData_all_${user.uid}_${sid}`;\r\n    const savedAll = localStorage.getItem(allKey);\r\n    if (savedAll) {\r\n      try {\r\n        const parsed = JSON.parse(savedAll);\r\n        setSalesData(Array.isArray(parsed) ? sortSales(parsed) : []);\r\n        return;\r\n      } catch {}\r\n    }\r\n    const todayLocal = getLocalDateYYYYMMDD();\r\n    const localKey = `salesData_${user.uid}_${sid}_${todayLocal}`;\r\n    const savedLocal = localStorage.getItem(localKey);\r\n    if (savedLocal) {\r\n      const parsed = JSON.parse(savedLocal);\r\n      const sorted = Array.isArray(parsed) ? sortSales(parsed) : [];\r\n      setSalesData(sorted);\r\n      try { localStorage.setItem(allKey, JSON.stringify(sorted)); } catch {}\r\n      return;\r\n    }\r\n    const todayUtc = new Date().toISOString().split('T')[0];\r\n    const utcKey = `salesData_${user.uid}_${sid}_${todayUtc}`;\r\n    const savedUtc = localStorage.getItem(utcKey);\r\n    if (savedUtc) {\r\n      const parsed = JSON.parse(savedUtc);\r\n      const sorted = Array.isArray(parsed) ? sortSales(parsed) : [];\r\n      setSalesData(sorted);\r\n      try {\r\n        localStorage.setItem(localKey, JSON.stringify(sorted));\r\n        localStorage.setItem(allKey, JSON.stringify(sorted));\r\n      } catch {}\r\n      return;\r\n    }\r\n    syncSalesDataFromFirestore();\r\n  };\r\n\r\n  const saveSalesData = (data: SaleItem[]) => {\r\n    if (!user?.uid) {\r\n      console.log('No user authenticated, cannot save sales data');\r\n      return;\r\n    }\r\n    const sid = shopIdCtx || (profile as any)?.shopId || 'main';\r\n    const todayLocal = getLocalDateYYYYMMDD();\r\n    const localKey = `salesData_${user.uid}_${sid}_${todayLocal}`;\r\n    const allKey = `salesData_all_${user.uid}_${sid}`;\r\n    const sortedDay = sortSales(data);\r\n    localStorage.setItem(localKey, JSON.stringify(sortedDay));\r\n    try {\r\n      const existingAllRaw = localStorage.getItem(allKey);\r\n      const existingAll = existingAllRaw ? JSON.parse(existingAllRaw) : [];\r\n      const byId: Record<string, SaleItem> = {} as any;\r\n      [...(Array.isArray(existingAll) ? existingAll : []), ...sortedDay].forEach((item: SaleItem) => {\r\n        byId[item.id] = item;\r\n      });\r\n      const mergedAll = Object.values(byId) as SaleItem[];\r\n      const sortedAll = sortSales(mergedAll);\r\n      localStorage.setItem(allKey, JSON.stringify(sortedAll));\r\n    } catch {}\r\n    setSalesData(sortedDay);\r\n  };\r\n\r\n  const saveAllSalesData = (data: SaleItem[]) => {\r\n    if (!user?.uid) {\r\n      console.log('No user authenticated, cannot save sales data');\r\n      return;\r\n    }\r\n    const sid = shopIdCtx || (profile as any)?.shopId || 'main';\r\n    const allKey = `salesData_all_${user.uid}_${sid}`;\r\n    try {\r\n      const existingAllRaw = localStorage.getItem(allKey);\r\n      const existingAll = existingAllRaw ? JSON.parse(existingAllRaw) : [];\r\n      const byId: Record<string, SaleItem> = {} as any;\r\n      [...(Array.isArray(existingAll) ? existingAll : []), ...data].forEach((item: SaleItem) => {\r\n        byId[item.id] = item;\r\n      });\r\n      const mergedAll = Object.values(byId) as SaleItem[];\r\n      const sortedAll = sortSales(mergedAll);\r\n      localStorage.setItem(allKey, JSON.stringify(sortedAll));\r\n    } catch {}\r\n    const sortedDay = sortSales(data);\r\n    setSalesData(sortedDay);\r\n  };\r\n\r\n  const syncSalesDataFromFirestore = async () => {\r\n    if (!user?.uid) return;\r\n    try {\r\n      const sid = shopIdCtx || (profile as any)?.shopId || null;\r\n      const todayUtc = new Date().toISOString().split('T')[0];\r\n      const todayCairo = new Intl.DateTimeFormat('en-CA', { timeZone: 'Africa/Cairo' }).format(new Date());\r\n      let snap1, snap2;\r\n      try {\r\n        const q1 = query(\r\n          collection(db, 'dailySales'),\r\n          where('userId', '==', user.uid),\r\n          ...(sid ? [where('shopId', '==', sid)] : [])\r\n        );\r\n        snap1 = await getDocs(q1);\r\n      } catch {}\r\n      try {\r\n        const q2 = query(\r\n          collection(db, 'users', user.uid, 'dailySales'),\r\n          ...(sid ? [where('shopId', '==', sid)] : [])\r\n        );\r\n        snap2 = await getDocs(q2);\r\n      } catch {}\r\n      const docs = [\r\n        ...(snap1 ? snap1.docs : []),\r\n        ...(snap2 ? snap2.docs : []),\r\n      ];\r\n      const remote = docs.map(d => {\r\n        const x: any = d.data();\r\n        return {\r\n          id: String(x.clientId || d.id),\r\n          firestoreId: d.id,\r\n          productName: String(x.productName || ''),\r\n          price: Number(x.sellingPrice || 0),\r\n          wholesalePrice: x.wholesalePrice !== undefined ? Number(x.wholesalePrice) : null,\r\n          quantity: Number(x.quantity || 0),\r\n          date: String(x.date || todayUtc),\r\n          time: String(x.time || ''),\r\n          serialNumber: x.serialNumber || undefined,\r\n          barcode: x.barcode || undefined,\r\n          performedByType: x.performedByType || undefined,\r\n          performedByName: x.performedByName || undefined,\r\n          performedByUsername: x.performedByUsername || undefined,\r\n          isDeferred: !!x.isDeferred,\r\n          customerName: x.customerName || undefined,\r\n          customerMobile: x.customerMobile || undefined,\r\n          customerId: x.customerId || undefined,\r\n          createdAtMs: x?.createdAt?.toDate?.() ? x.createdAt.toDate().getTime() : (new Date(String(x.date || todayUtc)).getTime()),\r\n        } as SaleItem;\r\n      });\r\n      const byId: Record<string, SaleItem> = {} as any;\r\n      [...salesData, ...remote].forEach((s: any) => { byId[s.id] = s; });\r\n      const merged = Object.values(byId) as SaleItem[];\r\n      saveAllSalesData(merged);\r\n    } catch {}\r\n  };\r\n\r\n  //     Firestore\r\n  const loadMonthlyStats = async () => {\r\n    if (!user?.uid) return;\r\n    try {\r\n      const now = new Date();\r\n      const start = new Date(now.getFullYear(), now.getMonth(), 1);\r\n      const end = new Date(now.getFullYear(), now.getMonth() + 1, 0);\r\n      const toDateStr = (d: Date) => d.toISOString().split('T')[0];\r\n      const startStr = toDateStr(start);\r\n      const endStr = toDateStr(end);\r\n      const sidMonthly = shopIdCtx || (profile as any)?.shopId || null;\r\n      let snap;\r\n      try {\r\n        const byUserShop = query(\r\n          collection(db, 'dailySales'),\r\n          where('userId', '==', user.uid),\r\n          ...(sidMonthly ? [where('shopId', '==', sidMonthly)] : [])\r\n        );\r\n        snap = await getDocs(byUserShop);\r\n      } catch {\r\n        const byUserShopNested = query(\r\n          collection(db, 'users', user.uid, 'dailySales'),\r\n          ...(sidMonthly ? [where('shopId', '==', sidMonthly)] : [])\r\n        );\r\n        snap = await getDocs(byUserShopNested);\r\n      }\r\n      let sales = 0;\r\n      let profit = 0;\r\n      snap.forEach(docSnap => {\r\n        const d = docSnap.data() as any;\r\n        const dateStr = String(d.date ?? '').slice(0, 10);\r\n        if (d.isDeferred) return;\r\n        if (dateStr >= startStr && dateStr <= endStr) {\r\n          const sellingPrice = Number(d.sellingPrice ?? 0);\r\n          const qty = Number(d.quantity ?? 0);\r\n          const pr = Number(d.profit ?? ((Number(d.sellingPrice ?? 0) - Number(d.wholesalePrice ?? 0)) * qty));\r\n          sales += sellingPrice * qty;\r\n          profit += pr;\r\n        }\r\n      });\r\n\r\n      setMonthlySalesTotal(sales);\r\n      setMonthlyProfitTotal(profit);\r\n    } catch (error) {\r\n      console.error('Error loading monthly stats:', error);\r\n    }\r\n  };\r\n\r\n  //     Firebase   \r\n  const saveSaleToFirebase = async (sale: SaleItem): Promise<string | null> => {\r\n    if (!user?.uid) return null;\r\n    try {\r\n      const profit = ((sale.price ?? 0) - (sale.wholesalePrice ?? 0)) * (sale.quantity ?? 0);\r\n      const performedByType = isShiftActive && shiftUser ? 'cashier' : 'admin';\r\n      const performedByName = performedByType === 'cashier' ? (shiftUser?.name || '') : (profile?.fullName || user?.displayName || ' ');\r\n      const performedByUsername = performedByType === 'cashier' ? (shiftUser?.username || null) : null;\r\n      const docRef = await addDoc(collection(db, 'dailySales'), {\r\n        userId: user.uid,\r\n        clientId: sale.id,\r\n        productName: sale.productName,\r\n        quantity: sale.quantity,\r\n        wholesalePrice: sale.wholesalePrice ?? null,\r\n        sellingPrice: sale.price,\r\n        profit,\r\n        date: sale.date,\r\n        time: sale.time,\r\n        performedByType,\r\n        performedByName,\r\n        performedByUsername,\r\n        serialNumber: sale.serialNumber ?? null,\r\n        barcode: sale.barcode ?? null,\r\n        isDeferred: !!sale.isDeferred,\r\n        customerName: sale.customerName || null,\r\n        customerMobile: sale.customerMobile || null,\r\n        customerId: sale.customerId || null,\r\n        ...(profile?.shopId ? { shopId: profile.shopId } : (shopIdCtx ? { shopId: shopIdCtx } : {})),\r\n        createdAt: serverTimestamp()\r\n      });\r\n      try {\r\n        await setDoc(doc(db, 'users', user.uid, 'dailySales', docRef.id), {\r\n          userId: user.uid,\r\n          clientId: sale.id,\r\n          productName: sale.productName,\r\n          quantity: sale.quantity,\r\n          wholesalePrice: sale.wholesalePrice ?? null,\r\n          sellingPrice: sale.price,\r\n          profit,\r\n          date: sale.date,\r\n          time: sale.time,\r\n          performedByType,\r\n          performedByName,\r\n          performedByUsername,\r\n          serialNumber: sale.serialNumber ?? null,\r\n          barcode: sale.barcode ?? null,\r\n          isDeferred: !!sale.isDeferred,\r\n          customerName: sale.customerName || null,\r\n          customerMobile: sale.customerMobile || null,\r\n          customerId: sale.customerId || null,\r\n          ...(profile?.shopId ? { shopId: profile.shopId } : (shopIdCtx ? { shopId: shopIdCtx } : {})),\r\n          createdAt: serverTimestamp()\r\n        });\r\n      } catch {}\r\n      return docRef.id;\r\n    } catch {\r\n      try {\r\n        const docRef2 = await addDoc(collection(db, 'users', user.uid, 'dailySales'), {\r\n          userId: user.uid,\r\n          clientId: sale.id,\r\n          productName: sale.productName,\r\n          quantity: sale.quantity,\r\n          wholesalePrice: sale.wholesalePrice ?? null,\r\n          sellingPrice: sale.price,\r\n          profit,\r\n          date: sale.date,\r\n          time: sale.time,\r\n          performedByType,\r\n          performedByName,\r\n          performedByUsername,\r\n          serialNumber: sale.serialNumber ?? null,\r\n          barcode: sale.barcode ?? null,\r\n          isDeferred: !!sale.isDeferred,\r\n          customerName: sale.customerName || null,\r\n          customerMobile: sale.customerMobile || null,\r\n          customerId: sale.customerId || null,\r\n          ...(profile?.shopId ? { shopId: profile.shopId } : (shopIdCtx ? { shopId: shopIdCtx } : {})),\r\n          createdAt: serverTimestamp()\r\n        });\r\n        try {\r\n          await setDoc(doc(db, 'dailySales', docRef2.id), {\r\n            userId: user.uid,\r\n            clientId: sale.id,\r\n            productName: sale.productName,\r\n            quantity: sale.quantity,\r\n            wholesalePrice: sale.wholesalePrice ?? null,\r\n            sellingPrice: sale.price,\r\n            profit,\r\n            date: sale.date,\r\n            time: sale.time,\r\n            performedByType,\r\n            performedByName,\r\n            performedByUsername,\r\n            serialNumber: sale.serialNumber ?? null,\r\n            barcode: sale.barcode ?? null,\r\n            isDeferred: !!sale.isDeferred,\r\n            customerName: sale.customerName || null,\r\n            customerMobile: sale.customerMobile || null,\r\n            customerId: sale.customerId || null,\r\n            ...(profile?.shopId ? { shopId: profile.shopId } : (shopIdCtx ? { shopId: shopIdCtx } : {})),\r\n            createdAt: serverTimestamp()\r\n          });\r\n        } catch {}\r\n        return docRef2.id;\r\n      } catch (error) {\r\n        console.error('Error saving sale:', error);\r\n        return null;\r\n      }\r\n    }\r\n  };\r\n\r\n  //      \r\n  const getCashBalanceKey = () => {\r\n    const sid = shopIdCtx || (profile as any)?.shopId || 'main';\r\n    return `cashBalance_${user?.uid || 'default'}_${sid}`;\r\n  };\r\n\r\n  //     Firebase\r\n  const updateSaleInFirebase = async (id: string, updatedFields: Partial<SaleItem>) => {\r\n    if (!user?.uid) return;\r\n    try {\r\n      const saleDoc = doc(db, 'dailySales', id);\r\n      await updateDoc(saleDoc, updatedFields as any);\r\n    } catch {\r\n      try {\r\n        const saleDoc2 = doc(db, 'users', user.uid, 'dailySales', id);\r\n        await updateDoc(saleDoc2, updatedFields as any);\r\n      } catch (error) {\r\n        console.error('Error updating sale:', error);\r\n      }\r\n    }\r\n  };\r\n\r\n  const markDeferredSalePaid = async (sale: SaleItem) => {\r\n    try {\r\n      const id = sale.firestoreId;\r\n      if (id) {\r\n        await updateSaleInFirebase(id, { isDeferred: false } as any);\r\n      } else {\r\n        try {\r\n          const q = query(\r\n            collection(db, 'dailySales'),\r\n            where('userId', '==', user?.uid || ''),\r\n            where('date', '==', sale.date),\r\n            where('productName', '==', sale.productName),\r\n            limit(5)\r\n          );\r\n          const snap = await getDocs(q);\r\n          const target = snap.docs[0];\r\n          if (target) await updateDoc(target.ref, { isDeferred: false } as any);\r\n        } catch {}\r\n      }\r\n      setSalesData(prev => prev.map(s => s.id === sale.id ? { ...s, isDeferred: false } : s));\r\n      try { await loadMonthlyStats(); } catch {}\r\n      toast({ title: ' ', description: `   ${sale.productName}` });\r\n    } catch (error) {\r\n      console.error('Error marking deferred sale as paid:', error);\r\n      toast({ title: ' ', description: '    ', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  const recoverUnsyncedSalesToFirestore = async () => {\r\n    if (!user?.uid) return;\r\n    const unsynced = salesData.filter(s => !s.firestoreId);\r\n    if (unsynced.length === 0) return;\r\n    for (const sale of unsynced) {\r\n      try {\r\n        let existingSnap;\r\n        try {\r\n          const existingQ = query(\r\n            collection(db, 'dailySales'),\r\n            where('userId', '==', user.uid),\r\n            where('clientId', '==', sale.id),\r\n            limit(1)\r\n          );\r\n          existingSnap = await getDocs(existingQ);\r\n        } catch {\r\n          const existingQ2 = query(\r\n            collection(db, 'users', user.uid, 'dailySales'),\r\n            where('clientId', '==', sale.id),\r\n            limit(1)\r\n          );\r\n          existingSnap = await getDocs(existingQ2);\r\n        }\r\n        if (!existingSnap.empty) {\r\n          const docId = existingSnap.docs[0].id;\r\n          const updated = salesData.map(s => s.id === sale.id ? { ...s, firestoreId: docId } : s);\r\n          saveSalesData(updated);\r\n          continue;\r\n        }\r\n        const docId = await saveSaleToFirebase(sale);\r\n        if (docId) {\r\n          const updated = salesData.map(s => s.id === sale.id ? { ...s, firestoreId: docId } : s);\r\n          saveSalesData(updated);\r\n        }\r\n      } catch {}\r\n    }\r\n  };\r\n\r\n  //       (Firestore   )\r\n  const addOutOfStockDeficiency = async (productName: string) => {\r\n    try {\r\n      if (user?.uid) {\r\n        try {\r\n          const ref = collection(db, 'deficiencies');\r\n          const docRef = await addDoc(ref, {\r\n            shopId: (profile?.shopId || user.uid || 'default-shop'),\r\n            name: productName,\r\n            quantity: 1,\r\n            status: 'pending',\r\n            createdAt: serverTimestamp(),\r\n          });\r\n          //         /\r\n          try {\r\n            const key = `deficiencies_${(profile?.shopId || user?.uid || 'default-shop')}`;\r\n            const raw = localStorage.getItem(key);\r\n            const list = raw ? JSON.parse(raw) : [];\r\n            const safeList = Array.isArray(list) ? list : [];\r\n            const exists = safeList.some((d: any) => String(d?.id || '') === docRef.id);\r\n            const optimisticItem = {\r\n              id: docRef.id,\r\n              name: productName,\r\n              quantity: 1,\r\n              status: 'pending',\r\n              createdAt: new Date().toISOString(),\r\n            };\r\n            const updatedOptimistic = exists ? safeList : [...safeList, optimisticItem];\r\n            localStorage.setItem(key, JSON.stringify(updatedOptimistic));\r\n          } catch {}\r\n          toast({ title: '  ', description: ` ${productName}      ` });\r\n          return;\r\n        } catch (err) {\r\n          console.warn('Failed to add deficiency to Firestore, falling back to local storage:', err);\r\n        }\r\n      }\r\n      const key = `deficiencies_${(profile?.shopId || user?.uid || 'default-shop')}`;\r\n      const raw = localStorage.getItem(key);\r\n      const list = raw ? JSON.parse(raw) : [];\r\n      const safeList = Array.isArray(list) ? list : [];\r\n      const exists = safeList.some((d: any) => String(d?.name || '').trim() === productName && String(d?.status || 'pending') === 'pending');\r\n      if (exists) return;\r\n      const newItem = {\r\n        id: Date.now().toString(),\r\n        name: productName,\r\n        quantity: 1,\r\n        status: 'pending',\r\n        createdAt: new Date().toISOString(),\r\n      };\r\n      const updated = [...safeList, newItem];\r\n      localStorage.setItem(key, JSON.stringify(updated));\r\n      toast({ title: '  ', description: ` ${productName}      ` });\r\n    } catch (e) {\r\n      console.error('Error adding deficiency for out-of-stock:', e);\r\n    }\r\n  };\r\n\r\n  //     \r\n  const sellProduct = async (product: ShopProduct, isDeferred = false, customer?: { id?: string; name: string; mobile?: string }) => {\r\n    const qtyStr = sellingQtyByProduct[product.id] || '';\r\n    const qty = parseInt(qtyStr);\r\n    if (isNaN(qty) || qty <= 0) {\r\n      toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n      return;\r\n    }\r\n    if (qty > product.quantity) {\r\n      toast({ title: '   ', description: '     ', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    const now = new Date();\r\n    const performedByType = isShiftActive && shiftUser ? 'cashier' : 'admin';\r\n    const performedByName = performedByType === 'cashier' ? (shiftUser?.name || '') : (profile?.fullName || user?.displayName || ' ');\r\n    const performedByUsername = performedByType === 'cashier' ? (shiftUser?.username || null) : null;\r\n\r\n    const serial = (product.serialNumber || '').trim();\r\n    //       \r\n    const overrideStr = sellingPriceOverrideByProduct[product.id] || '';\r\n    const overridePrice = parseFloat(overrideStr);\r\n    const usedPrice = (!isNaN(overridePrice) && overridePrice > 0) ? overridePrice : product.sellingPrice;\r\n    const sale: SaleItem = {\r\n      id: Date.now().toString(),\r\n      productName: product.name,\r\n      price: usedPrice,\r\n      wholesalePrice: product.wholesalePrice,\r\n      quantity: qty,\r\n      date: now.toISOString().split('T')[0],\r\n      time: now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }),\r\n      createdAtMs: now.getTime(),\r\n      performedByType,\r\n      performedByName,\r\n      performedByUsername,\r\n      serialNumber: serial || undefined,\r\n      barcode: product.barcode,\r\n      isDeferred,\r\n      customerName: customer?.name,\r\n      customerMobile: customer?.mobile,\r\n      customerId: customer?.id,\r\n    };\r\n\r\n    try {\r\n      //            \r\n      const docId = await saveSaleToFirebase(sale);\r\n      const saleWithId: SaleItem = docId ? { ...sale, firestoreId: docId } : sale;\r\n      saveSalesData([...salesData, saleWithId]);\r\n      //       Firestore\r\n      const newQty = product.quantity - qty;\r\n      await updateDoc(doc(db, 'products', product.id), { quantity: newQty, updatedAt: serverTimestamp() });\r\n      setShopProducts(prev => prev.map(p => p.id === product.id ? { ...p, quantity: newQty } : p));\r\n      setSellingQtyByProduct(prev => ({ ...prev, [product.id]: '' }));\r\n      setSellingPriceOverrideByProduct(prev => ({ ...prev, [product.id]: '' }));\r\n      if (newQty === 0) {\r\n        addOutOfStockDeficiency(product.name);\r\n      }\r\n\r\n      if (!isDeferred) {\r\n        try {\r\n          const saleTotal = usedPrice * qty;\r\n          const cashKey = getCashBalanceKey();\r\n          const savedCash = localStorage.getItem(cashKey);\r\n          const currentCash = savedCash ? parseFloat(savedCash) : 0;\r\n          const newCash = currentCash + saleTotal;\r\n          localStorage.setItem(cashKey, newCash.toString());\r\n          const localDataKey = `userData_${user?.uid}`;\r\n          const updateData = { cashBalance: newCash, lastUpdated: new Date().toISOString() } as any;\r\n          localStorage.setItem(localDataKey, JSON.stringify(updateData));\r\n          if (user?.uid) {\r\n            userDataService.updateUserData(user.uid, updateData).catch(() => {});\r\n          }\r\n          const shopId = (profile as any)?.shopId || shopIdCtx;\r\n          if (shopId) {\r\n            try { await updateDoc(doc(db, 'dashboardData', shopId), { cashBalance: newCash }); } catch {}\r\n          }\r\n          try { window.dispatchEvent(new CustomEvent('cashBalanceChanged', { detail: { value: newCash } })); } catch {}\r\n          try {\r\n            if (user?.uid) {\r\n              const receiptRef = `SALECASH-${user.uid}-${Date.now()}`;\r\n              const txToCloud: any = {\r\n                txnType: 'cash_addition',\r\n                type: 'cash_addition',\r\n                amount: saleTotal,\r\n                status: 'confirmed',\r\n                senderMsisdn: ' ',\r\n                receiverMsisdn: '',\r\n                reference: receiptRef,\r\n                title: '  ',\r\n                merchantUserId: user.uid,\r\n                createdBy: user.uid,\r\n                shopId: (profile as any)?.shopId || shopIdCtx || undefined,\r\n                cashierName: performedByName,\r\n                performedByType,\r\n                performedByUsername,\r\n                createdAt: new Date()\r\n              };\r\n              await userDataService.saveUserTransaction(user.uid, txToCloud);\r\n            }\r\n          } catch {}\r\n          \r\n          //    \r\n          setMonthlySalesTotal(prev => prev + saleTotal);\r\n          const profit = ((usedPrice - (product.wholesalePrice || 0)) * qty);\r\n          setMonthlyProfitTotal(prev => prev + profit);\r\n        } catch (e) {\r\n          console.warn('      :', e);\r\n        }\r\n      }\r\n\r\n      toast({ title: ' ', description: `  ${qty}   ${product.name}` });\r\n    } catch (error) {\r\n      console.error('Error selling product:', error);\r\n      toast({ title: ' ', description: '   ', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  //          \r\n  const deleteSale = async (sale: SaleItem) => {\r\n    if (!user?.uid) return;\r\n    if (isShiftActive) {\r\n      toast({ title: '    ', description: '      ', variant: 'destructive' });\r\n      return;\r\n    }\r\n    requireMasterPin(\r\n      '   ',\r\n      '       ',\r\n      async () => {\r\n        try {\r\n          //       \r\n          const todayLocal = getLocalDateYYYYMMDD();\r\n          const localKey = `salesData_${user.uid}_${todayLocal}`;\r\n          const allKey = `salesData_all_${user.uid}`;\r\n          const updatedDay = salesData.filter(s => s.id !== sale.id);\r\n          try {\r\n            localStorage.setItem(localKey, JSON.stringify(updatedDay));\r\n            const existingAllRaw = localStorage.getItem(allKey);\r\n            const existingAll = existingAllRaw ? JSON.parse(existingAllRaw) : [];\r\n            const updatedAll = (Array.isArray(existingAll) ? existingAll : []).filter((s: any) => s?.id !== sale.id);\r\n            localStorage.setItem(allKey, JSON.stringify(updatedAll));\r\n          } catch {}\r\n          setSalesData(updatedDay);\r\n\r\n          //          \r\n          const bgTasks: Promise<any>[] = [];\r\n          if (!sale.isDeferred) {\r\n            try {\r\n              const saleTotal = (sale.price ?? 0) * (sale.quantity ?? 0);\r\n              const cashKey = getCashBalanceKey();\r\n              const savedCash = localStorage.getItem(cashKey);\r\n              const currentCash = savedCash ? parseFloat(savedCash) : 0;\r\n              const newCash = currentCash - saleTotal;\r\n              localStorage.setItem(cashKey, newCash.toString());\r\n              const localDataKey = `userData_${user?.uid}`;\r\n              const updateData = { cashBalance: newCash, lastUpdated: new Date().toISOString() } as any;\r\n              try { localStorage.setItem(localDataKey, JSON.stringify(updateData)); } catch {}\r\n              if (user?.uid) {\r\n                bgTasks.push(userDataService.updateUserData(user.uid, updateData));\r\n              }\r\n              const shopId = (profile as any)?.shopId || shopIdCtx;\r\n              if (shopId) {\r\n                bgTasks.push(updateDoc(doc(db, 'dashboardData', shopId), { cashBalance: newCash }).catch(() => {}));\r\n              }\r\n              try { window.dispatchEvent(new CustomEvent('cashBalanceChanged', { detail: { value: newCash } })); } catch {}\r\n              \r\n              //    \r\n              const profit = ((sale.price ?? 0) - (sale.wholesalePrice ?? 0)) * (sale.quantity ?? 0);\r\n              setMonthlySalesTotal(prev => prev - saleTotal);\r\n              setMonthlyProfitTotal(prev => prev - profit);\r\n\r\n            } catch (e) {\r\n              console.warn('       :', e);\r\n            }\r\n          }\r\n\r\n          //  :       \r\n          try {\r\n            const matched = shopProducts.find(p => (sale.barcode && p.barcode === sale.barcode) || p.name === sale.productName);\r\n            if (matched) {\r\n              const newQty = (matched.quantity || 0) + (sale.quantity || 0);\r\n              setShopProducts(prev => prev.map(p => p.id === matched.id ? { ...p, quantity: newQty } : p));\r\n              bgTasks.push(updateDoc(doc(db, 'products', matched.id), { quantity: newQty, updatedAt: serverTimestamp() }));\r\n            }\r\n          } catch (e) {\r\n            console.warn('     :', e);\r\n          }\r\n\r\n          //     Firestore  \r\n          try {\r\n            if (sale.firestoreId) {\r\n              bgTasks.push(deleteDoc(doc(db, 'dailySales', sale.firestoreId)).catch(() => {}));\r\n              bgTasks.push(deleteDoc(doc(db, 'users', user.uid, 'dailySales', sale.firestoreId)).catch(() => {}));\r\n            } else {\r\n              bgTasks.push((async () => {\r\n                try {\r\n                  const q = query(\r\n                    collection(db, 'dailySales'),\r\n                    where('userId', '==', user.uid),\r\n                    where('date', '==', sale.date),\r\n                    where('productName', '==', sale.productName),\r\n                    limit(5)\r\n                  );\r\n                  let snap = await getDocs(q);\r\n                  if (snap.empty) {\r\n                    const q2 = query(\r\n                      collection(db, 'users', user.uid, 'dailySales'),\r\n                      where('date', '==', sale.date),\r\n                      where('productName', '==', sale.productName),\r\n                      limit(5)\r\n                    );\r\n                    snap = await getDocs(q2);\r\n                  }\r\n                  if (!snap.empty) {\r\n                    const target = snap.docs.find((d: any) => {\r\n                      const data: any = d.data();\r\n                      return Number(data?.sellingPrice ?? 0) === Number(sale.price ?? 0)\r\n                        && Number(data?.quantity ?? 0) === Number(sale.quantity ?? 0)\r\n                        && String(data?.time ?? '') === String(sale.time ?? '');\r\n                    }) || snap.docs[0];\r\n                    if (target) {\r\n                      await deleteDoc(target.ref);\r\n                    }\r\n                  }\r\n                } catch (e) {\r\n                  console.warn('     Firestore ( ):', e);\r\n                }\r\n              })());\r\n            }\r\n          } catch (e) {\r\n            console.warn('      Firestore:', e);\r\n          }\r\n\r\n          //       ( )\r\n          try {\r\n            if (!isMonthlyLocked) {\r\n              setTimeout(() => { try { loadMonthlyStats(); } catch {} }, 0);\r\n            }\r\n          } catch {}\r\n\r\n          //      \r\n          try { await Promise.allSettled(bgTasks); } catch {}\r\n\r\n          toast({ title: '  ', description: `     ${sale.productName}   ` });\r\n        } catch (error) {\r\n          console.error('Error deleting sale:', error);\r\n          toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  //    :   = 1\r\n  const sellProductByBarcode = async (product: ShopProduct) => {\r\n    try {\r\n      setSellingQtyByProduct(prev => ({ ...prev, [product.id]: '1' }));\r\n      await sellProduct(product);\r\n    } catch (err) {\r\n      console.error('Error selling by barcode:', err);\r\n    }\r\n  };\r\n\r\n  //      \r\n  const addPieces = async (product: ShopProduct) => {\r\n    if (isShiftActive) {\r\n      toast({ title: '    ', description: '     ', variant: 'destructive' });\r\n      return;\r\n    }\r\n    const qtyStr = addQtyByProduct[product.id] || '';\r\n    const qty = parseInt(qtyStr);\r\n    if (isNaN(qty) || qty <= 0) {\r\n      toast({ title: '  ', description: '   ', variant: 'destructive' });\r\n      return;\r\n    }\r\n    requireMasterPin(\r\n      '  ',\r\n      '        ',\r\n      async () => {\r\n        try {\r\n          const newQty = product.quantity + qty;\r\n          await updateDoc(doc(db, 'products', product.id), { quantity: newQty, updatedAt: serverTimestamp() });\r\n          setShopProducts(prev => prev.map(p => p.id === product.id ? { ...p, quantity: newQty } : p));\r\n          setAddQtyByProduct(prev => ({ ...prev, [product.id]: '' }));\r\n          toast({ title: ' ', description: `  ${qty}   ${product.name}` });\r\n        } catch (error) {\r\n          console.error('Error adding pieces:', error);\r\n          toast({ title: ' ', description: '    ', variant: 'destructive' });\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  //      \r\n  const deleteProduct = async (product: ShopProduct) => {\r\n    if (!user?.uid) return;\r\n    if (isShiftActive) {\r\n      toast({ title: '    ', description: '     ', variant: 'destructive' });\r\n      return;\r\n    }\r\n    const ok = window.confirm(`    \"${product.name}\"`);\r\n    if (!ok) return;\r\n    requireMasterPin(\r\n      '  ',\r\n      '        ',\r\n      async () => {\r\n        try {\r\n          await deleteDoc(doc(db, 'products', product.id));\r\n          setShopProducts(prev => prev.filter(p => p.id !== product.id));\r\n          toast({ title: ' ', description: `   ${product.name}` });\r\n        } catch (error) {\r\n          console.error('Error deleting product:', error);\r\n          toast({ title: ' ', description: '  ', variant: 'destructive' });\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  //     Firestore  \r\n  const createProduct = async () => {\r\n    try {\r\n      if (!user?.uid) {\r\n        toast({ title: '', description: '  ', variant: 'destructive' });\r\n        return;\r\n      }\r\n      if (isShiftActive) {\r\n        toast({ title: '    ', description: '     ', variant: 'destructive' });\r\n        return;\r\n      }\r\n      const name = newProduct.productName.trim();\r\n      const selling = parseFloat(newProduct.price);\r\n      const wholesale = parseFloat(newProduct.wholesalePrice || '0');\r\n      const qty = parseInt(newProduct.quantity);\r\n\r\n      if (!name || isNaN(selling) || isNaN(qty)) {\r\n        toast({ title: '  ', description: '    ', variant: 'destructive' });\r\n        return;\r\n      }\r\n      //           PIN \r\n      //     undefined   Firestore\r\n      const payload: any = {\r\n        name,\r\n        sellingPrice: selling,\r\n        wholesalePrice: isNaN(wholesale) ? 0 : wholesale,\r\n        quantity: isNaN(qty) ? 0 : qty,\r\n        userId: user.uid,\r\n        createdAt: serverTimestamp(),\r\n        updatedAt: serverTimestamp(),\r\n      };\r\n\r\n      //        \r\n      const trimmedBarcode = (newProduct.barcode || '').trim();\r\n      if (trimmedBarcode) payload.barcode = trimmedBarcode;\r\n      const trimmedSerial = (newProduct.serialNumber || '').trim();\r\n      if (trimmedSerial) payload.serialNumber = trimmedSerial;\r\n\r\n      if (profile?.shopId) {\r\n        payload.shopId = profile.shopId;\r\n      }\r\n\r\n      const docRef = await addDoc(collection(db, 'products'), payload);\r\n\r\n      setShopProducts((prev) => [\r\n        {\r\n          id: docRef.id,\r\n          name,\r\n          sellingPrice: selling,\r\n          wholesalePrice: isNaN(wholesale) ? 0 : wholesale,\r\n          quantity: isNaN(qty) ? 0 : qty,\r\n          barcode: (newProduct.barcode || '').trim() || '',\r\n          serialNumber: (newProduct.serialNumber || '').trim() || '',\r\n        },\r\n        ...prev,\r\n      ]);\r\n\r\n      setNewProduct({ productName: '', price: '', wholesalePrice: '', quantity: '', barcode: '', serialNumber: '' });\r\n\r\n      toast({ title: ' ', description: `   ${name} ` });\r\n    } catch (error) {\r\n      console.error('createProduct error', error);\r\n      toast({ title: ' ', description: '  .  ', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  //  :    \r\n  const processBarcode = async (code: string) => {\r\n    const trimmed = (code || '').trim();\r\n    if (!trimmed) return;\r\n    const product = shopProducts.find((p) => (p.barcode || '') === trimmed);\r\n    if (!product) {\r\n      toast({ title: '  ', description: '      ' });\r\n      return;\r\n    }\r\n    await sellProductByBarcode(product);\r\n  };\r\n\r\n  //    \r\n  const printSelectedInvoice = () => {\r\n    const items = Object.entries(invoiceSelections)\r\n      .map(([id, qty]) => {\r\n        const q = Number(qty);\r\n        const prod = shopProducts.find(p => p.id === id);\r\n        if (!prod || !q || q <= 0) return null as any;\r\n        return { name: prod.name, qty: q, price: prod.sellingPrice, total: q * prod.sellingPrice };\r\n      })\r\n      .filter(Boolean) as { name: string; qty: number; price: number; total: number }[];\r\n\r\n    if (items.length === 0) {\r\n      toast({ title: '   ', description: '      ' });\r\n      return;\r\n    }\r\n\r\n    const shopName = (profile as any)?.shopName || user?.displayName || '';\r\n    const phone = (profile as any)?.phone || user?.phoneNumber || '';\r\n    const invoiceTotal = items.reduce((sum, it) => sum + it.total, 0);\r\n    const dateStr = new Date().toLocaleString('ar-EG');\r\n\r\n    const rowsHtml = items\r\n      .map((it) => `\r\n        <tr>\r\n          <td style=\"border:1px solid #ddd;padding:6px\">${it.name}</td>\r\n          <td style=\"border:1px solid #ddd;padding:6px;text-align:center\">${it.qty}</td>\r\n          <td style=\"border:1px solid #ddd;padding:6px;text-align:center\">${formatMoney(it.price)}</td>\r\n          <td style=\"border:1px solid #ddd;padding:6px;text-align:center;font-weight:bold;color:#0a7\">${formatMoney(it.total)}</td>\r\n        </tr>\r\n      `)\r\n      .join('');\r\n\r\n    const html = `\r\n      <html>\r\n        <head>\r\n          <meta charset=\"utf-8\" />\r\n          <title></title>\r\n          <style>\r\n            body { font-family: Tahoma, Arial, sans-serif; direction: rtl; }\r\n            .header { text-align: center; margin-bottom: 12px; }\r\n            .header h2 { margin: 0; }\r\n            .meta { text-align: center; color: #555; margin-bottom: 8px; }\r\n            table { width: 100%; border-collapse: collapse; }\r\n            .total { text-align: left; font-weight: bold; margin-top: 10px; }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          <div class=\"header\">\r\n            <h2>${shopName}</h2>\r\n            ${phone ? `<div class=\"meta\"> : ${phone}</div>` : ''}\r\n            <div class=\"meta\">: ${dateStr}</div>\r\n          </div>\r\n          <table>\r\n            <thead>\r\n              <tr>\r\n                <th style=\"border:1px solid #ddd;padding:6px\"></th>\r\n                <th style=\"border:1px solid #ddd;padding:6px\"></th>\r\n                <th style=\"border:1px solid #ddd;padding:6px\"></th>\r\n                <th style=\"border:1px solid #ddd;padding:6px\"></th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              ${rowsHtml}\r\n            </tbody>\r\n          </table>\r\n          <div class=\"total\"> : ${formatMoney(invoiceTotal)}</div>\r\n        </body>\r\n      </html>\r\n    `;\r\n\r\n    const w = window.open('', '_blank');\r\n    if (!w) return;\r\n    w.document.write(html);\r\n    w.document.close();\r\n    w.focus();\r\n    w.print();\r\n    w.close();\r\n  };\r\n\r\n  // --- Offsets for Daily/Monthly Reset (Persistence) ---\r\n  const [dailySalesOffset, setDailySalesOffset] = useState<number>(0);\r\n  const [dailyProfitOffset, setDailyProfitOffset] = useState<number>(0);\r\n  const [monthlySalesOffset, setMonthlySalesOffset] = useState<number>(0);\r\n  const [monthlyProfitOffset, setMonthlyProfitOffset] = useState<number>(0);\r\n\r\n  const getStorageKeys = () => {\r\n    const sid = shopIdCtx || (profile as any)?.shopId || 'main';\r\n    const uid = user?.uid || 'guest';\r\n    \r\n    // Use local date to match sales data loading logic\r\n    const d = new Date();\r\n    const y = d.getFullYear();\r\n    const m = String(d.getMonth() + 1).padStart(2, '0');\r\n    const dd = String(d.getDate()).padStart(2, '0');\r\n    \r\n    const date = `${y}-${m}-${dd}`; // Local YYYY-MM-DD\r\n    const month = `${y}-${m}`;      // Local YYYY-MM\r\n\r\n    return {\r\n      daily: `dailyOffset_${uid}_${sid}_${date}`,\r\n      monthly: `monthlyOffset_${uid}_${sid}_${month}`\r\n    };\r\n  };\r\n\r\n  // Load offsets on mount\r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n    const keys = getStorageKeys();\r\n    \r\n    try {\r\n      const savedDaily = localStorage.getItem(keys.daily);\r\n      if (savedDaily) {\r\n        const { sales, profit } = JSON.parse(savedDaily);\r\n        setDailySalesOffset(Number(sales) || 0);\r\n        setDailyProfitOffset(Number(profit) || 0);\r\n      } else {\r\n        setDailySalesOffset(0);\r\n        setDailyProfitOffset(0);\r\n      }\r\n\r\n      const savedMonthly = localStorage.getItem(keys.monthly);\r\n      if (savedMonthly) {\r\n        const { sales, profit } = JSON.parse(savedMonthly);\r\n        setMonthlySalesOffset(Number(sales) || 0);\r\n        setMonthlyProfitOffset(Number(profit) || 0);\r\n      } else {\r\n         setMonthlySalesOffset(0);\r\n         setMonthlyProfitOffset(0);\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to load offsets', e);\r\n    }\r\n  }, [user?.uid, shopIdCtx, (profile as any)?.shopId, isOpen]);\r\n\r\n  const saveDailyOffsets = (sales: number, profit: number) => {\r\n    const keys = getStorageKeys();\r\n    localStorage.setItem(keys.daily, JSON.stringify({ sales, profit }));\r\n  };\r\n\r\n  const saveMonthlyOffsets = (sales: number, profit: number) => {\r\n    const keys = getStorageKeys();\r\n    localStorage.setItem(keys.monthly, JSON.stringify({ sales, profit }));\r\n  };\r\n\r\n  const handleResetDailyStats = () => {\r\n    requireMasterPin(\r\n      '   ( )',\r\n      '        (     )',\r\n      async () => {\r\n        try {\r\n          const currentSales = salesData.filter(s => !s.isDeferred).reduce((sum, item) => sum + item.price * item.quantity, 0);\r\n          const currentProfit = salesData.filter(s => !s.isDeferred).reduce((sum, item) => sum + ((item.price - (item.wholesalePrice ?? 0)) * item.quantity), 0);\r\n          \r\n          setDailySalesOffset(currentSales);\r\n          setDailyProfitOffset(currentProfit);\r\n          saveDailyOffsets(currentSales, currentProfit);\r\n          \r\n          toast({ title: ' ', description: '     (   )' });\r\n        } catch (e) {\r\n          console.error(e);\r\n          toast({ title: '', description: '   ', variant: 'destructive' });\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  const handleResetMonthlyStats = () => {\r\n    requireMasterPin(\r\n      '  ',\r\n      '      (     )',\r\n      async () => {\r\n        try {\r\n           setMonthlySalesOffset(monthlySalesTotal);\r\n           setMonthlyProfitOffset(monthlyProfitTotal);\r\n           saveMonthlyOffsets(monthlySalesTotal, monthlyProfitTotal);\r\n           \r\n           toast({ title: ' ', description: '    ' });\r\n        } catch (e) {\r\n           console.error(e);\r\n           toast({ title: '', description: '    ', variant: 'destructive' });\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-none w-[100vw] h-[100dvh] p-0 overflow-hidden bg-[#fdfbf7]\">\r\n        <div className=\"flex flex-col h-full\" dir=\"rtl\">\r\n          {/* Header */}\r\n          <div className=\"bg-[#fcf9f2] border-b px-3 py-2 flex items-center justify-between shrink-0 z-10 h-14 sm:h-auto\">\r\n             <div className=\"flex items-center gap-2\">\r\n                <div className=\"bg-primary/10 p-1.5 rounded-full\">\r\n                  <BarChart3 className=\"h-4 w-4 text-primary\" />\r\n                </div>\r\n                <div className=\"flex flex-col justify-center\">\r\n                  <DialogTitle className=\"text-sm font-bold leading-tight\"> </DialogTitle>\r\n                  <p className=\"text-[10px] text-muted-foreground hidden sm:block leading-none mt-0.5\">   </p>\r\n                </div>\r\n             </div>\r\n             <div className=\"flex items-center gap-2\">\r\n                <Button variant=\"outline\" size=\"sm\" onClick={() => recoverUnsyncedSalesToFirestore()} className=\"hidden sm:flex h-7 text-[10px] px-2\">\r\n                   <RefreshCw className=\"h-3 w-3 ml-1.5\" />\r\n                   \r\n                </Button>\r\n                <Button variant=\"ghost\" size=\"icon\" onClick={onClose} className=\"rounded-full h-8 w-8\">\r\n                   <X className=\"h-4 w-4\" />\r\n                </Button>\r\n             </div>\r\n          </div>\r\n\r\n          <div className=\"flex-1 overflow-hidden flex flex-col md:flex-row\">\r\n            {/* Sidebar */}\r\n            <div className=\"w-full md:w-80 bg-[#fcf9f2] border-l flex flex-col shrink-0 order-2 md:order-1\">\r\n              <div className=\"flex-1 overflow-y-auto scrollbar-thin\">\r\n                <div className=\"p-4 space-y-4\">\r\n                  {/* Summary Card */}\r\n                  <Card className=\"hidden md:block\">\r\n                     <CardHeader className=\"p-4 pb-2 flex flex-row items-center justify-between space-y-0\">\r\n                        <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\r\n                           <DollarSign className=\"h-4 w-4 text-primary\" />\r\n                            \r\n                        </CardTitle>\r\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 text-muted-foreground hover:text-red-600\" onClick={handleResetDailyStats} title=\" \">\r\n                          <RotateCcw className=\"h-3.5 w-3.5\" />\r\n                        </Button>\r\n                     </CardHeader>\r\n                     <CardContent className=\"p-4 pt-2 space-y-3\">\r\n                        <div className=\"flex justify-between items-center p-3 bg-gray-50 rounded-lg border\">\r\n                           <span className=\"text-sm text-muted-foreground\"></span>\r\n                           <span className=\"text-lg font-bold text-primary\">\r\n                              {formatMoney(Math.max(0, salesData.filter(s => !s.isDeferred).reduce((sum, item) => sum + item.price * item.quantity, 0) - dailySalesOffset))}\r\n                           </span>\r\n                        </div>\r\n                        <div className=\"relative overflow-hidden p-3 bg-emerald-50/50 rounded-lg border border-emerald-100\">\r\n                           <div className={`flex justify-between items-center ${isProfitLocked ? \"blur-sm\" : \"\"}`}>\r\n                              <span className=\"text-sm text-emerald-700\"></span>\r\n                              <span className=\"text-lg font-bold text-emerald-700\">\r\n                                 {formatMoney(Math.max(0, salesData.filter(s => !s.isDeferred).reduce((sum, item) => sum + ((item.price - (item.wholesalePrice ?? 0)) * item.quantity), 0) - dailyProfitOffset))}\r\n                              </span>\r\n                           </div>\r\n                           {isProfitLocked && (\r\n                              <div className=\"absolute inset-0 flex items-center justify-center bg-white/50\">\r\n                                 <Button size=\"sm\" variant=\"outline\" onClick={() => setIsProfitPinDialogOpen(true)} className=\"h-7 text-xs bg-white\">\r\n                                    <Lock className=\"h-3 w-3 ml-1\" />\r\n                                    \r\n                                 </Button>\r\n                              </div>\r\n                           )}\r\n                        </div>\r\n                     </CardContent>\r\n                  </Card>\r\n\r\n                  {/* Monthly Stats Accordion */}\r\n                  <Card className=\"shadow-none border-none bg-transparent hidden md:block\">\r\n                     <div className=\"flex items-center justify-between w-full p-2\">\r\n                        <button onClick={() => setIsMonthlyCollapsed(!isMonthlyCollapsed)} className=\"flex items-center gap-2 text-sm font-medium text-gray-600 hover:text-primary transition-colors flex-1 text-right\">\r\n                           <Calendar className=\"h-4 w-4\" />\r\n                            \r\n                           {isMonthlyCollapsed ? <ChevronDown className=\"h-4 w-4\" /> : <ChevronUp className=\"h-4 w-4\" />}\r\n                        </button>\r\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 text-muted-foreground hover:text-red-600\" onClick={handleResetMonthlyStats} title=\" \">\r\n                          <RotateCcw className=\"h-3.5 w-3.5\" />\r\n                        </Button>\r\n                     </div>\r\n                     {!isMonthlyCollapsed && (\r\n                        <div className=\"mt-2 grid grid-cols-2 gap-2 animate-in slide-in-from-top-2\">\r\n                           <div className=\"col-span-2 relative\">\r\n                              <div className={`grid grid-cols-2 gap-2 ${isMonthlyLocked ? 'blur-sm select-none' : ''}`}>\r\n                                 <div className=\"bg-indigo-50 p-3 rounded-xl border border-indigo-100 text-center\">\r\n                                    <span className=\"text-[10px] text-indigo-600 block mb-1\"></span>\r\n                                    <span className=\"text-sm font-bold text-indigo-700\">{formatMoney(Math.max(0, monthlySalesTotal - monthlySalesOffset))}</span>\r\n                                 </div>\r\n                                 <div className=\"bg-pink-50 p-3 rounded-xl border border-pink-100 text-center\">\r\n                                    <span className=\"text-[10px] text-pink-600 block mb-1\"></span>\r\n                                    <span className=\"text-sm font-bold text-pink-700\">{formatMoney(Math.max(0, monthlyProfitTotal - monthlyProfitOffset))}</span>\r\n                                 </div>\r\n                              </div>\r\n                              {isMonthlyLocked && (\r\n                                 <div className=\"absolute inset-0 flex items-center justify-center z-10\">\r\n                                    <Button size=\"sm\" variant=\"outline\" onClick={() => setIsMasterPinDialogOpen(true)} className=\"h-8 bg-white/80 backdrop-blur-sm\">\r\n                                       <Lock className=\"h-3 w-3 ml-1\" />\r\n                                        \r\n                                    </Button>\r\n                                 </div>\r\n                              )}\r\n                           </div>\r\n                        </div>\r\n                     )}\r\n                  </Card>\r\n                  \r\n                  <Separator className=\"hidden md:block\" />\r\n                  \r\n                  <Button variant=\"outline\" className=\"w-full justify-start h-10\" onClick={() => setIsSalesReceiptsDialogOpen(true)}>\r\n                     <Receipt className=\"h-4 w-4 ml-2\" />\r\n                      \r\n                  </Button>\r\n               </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Main Content Area */}\r\n            <div className=\"flex-1 overflow-hidden flex flex-col order-1 md:order-2 bg-[#fdfbf7]\">\r\n              <Tabs defaultValue=\"products\" className=\"flex-1 flex flex-col overflow-hidden\">\r\n                <div className=\"px-2 py-1.5 bg-[#fcf9f2] border-b flex items-center justify-between shrink-0\">\r\n                  <TabsList className=\"h-8\">\r\n                    <TabsTrigger value=\"products\" className=\"text-xs px-2 sm:px-3\"> </TabsTrigger>\r\n                    <TabsTrigger value=\"sales-log\" className=\"text-xs px-2 sm:px-3\">\r\n                       \r\n                      <Badge variant=\"secondary\" className=\"mr-2 h-5 px-1.5 text-[10px] hidden sm:inline-flex\">\r\n                        {salesData.filter(s => !s.isDeferred).length}\r\n                      </Badge>\r\n                    </TabsTrigger>\r\n                  </TabsList>\r\n\r\n                  <Button \r\n                    variant=\"ghost\" \r\n                    size=\"sm\" \r\n                    className=\"md:hidden text-xs h-8 px-2 bg-white/50 border mr-1 text-primary\" \r\n                    onClick={() => setIsMobileStatsOpen(true)}\r\n                  >\r\n                    <FileText className=\"h-3 w-3 ml-1\" />\r\n                     \r\n                  </Button>\r\n\r\n                  <div className=\"flex items-center gap-2 text-xs text-gray-500 font-mono\" dir=\"ltr\">\r\n                    <span className=\"hidden sm:inline\">{new Date().toLocaleDateString('ar-EG')}</span>\r\n                    <Clock className=\"h-3.5 w-3.5 text-gray-400\" />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Products Tab */}\r\n                <TabsContent value=\"products\" className=\"flex-1 p-0 m-0 overflow-hidden h-full relative\">\r\n                  <div className=\"absolute inset-0 overflow-y-auto scrollbar-thin\">\r\n                    <div className=\"p-4 space-y-4\">\r\n                      {/* Add Product Card */}\r\n                      <Card className=\"border-dashed border-2 border-gray-200 hover:border-gray-300 transition-all bg-gray-50/30 overflow-hidden\">\r\n                    <div \r\n                      className=\"p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors\"\r\n                      onClick={() => setIsAddProductOpen(!isAddProductOpen)}\r\n                    >\r\n                       <div className=\"flex items-center gap-3\">\r\n                          <div className=\"bg-emerald-100 p-2 rounded-full\">\r\n                            <Plus className=\"h-5 w-5 text-emerald-600\" />\r\n                          </div>\r\n                          <div className=\"text-right\">\r\n                             <h3 className=\"font-semibold text-gray-900 text-sm\">  </h3>\r\n                             <p className=\"text-xs text-gray-500\">    </p>\r\n                          </div>\r\n                       </div>\r\n                       <Button variant=\"ghost\" size=\"sm\" className=\"rounded-full h-8 w-8 p-0\">\r\n                         <ChevronDown className={`h-5 w-5 text-gray-400 transition-transform duration-200 ${isAddProductOpen ? 'rotate-180' : ''}`} />\r\n                       </Button>\r\n                    </div>\r\n                    \r\n                    {isAddProductOpen && (\r\n                      <div className=\"px-4 pb-4 pt-0 animate-in slide-in-from-top-2\">\r\n                         <div className=\"h-px bg-gray-200 mb-4\" />\r\n                         <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                            <div className=\"space-y-1.5\">\r\n                              <Label className=\"text-xs font-medium text-gray-700\">  <span className=\"text-red-500\">*</span></Label>\r\n                              <Input \r\n                                value={newProduct.productName} \r\n                                onChange={(e) => setNewProduct(p => ({ ...p, productName: e.target.value }))}\r\n                                className=\"h-9 bg-white\"\r\n                                placeholder=\":   \"\r\n                              />\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-3\">\r\n                              <div className=\"space-y-1.5\">\r\n                                <Label className=\"text-xs font-medium text-gray-700\">  <span className=\"text-red-500\">*</span></Label>\r\n                                <Input \r\n                                  type=\"number\" \r\n                                  value={newProduct.price} \r\n                                  onChange={(e) => setNewProduct(p => ({ ...p, price: e.target.value }))}\r\n                                  className=\"h-9 bg-white\"\r\n                                  placeholder=\"0.00\"\r\n                                />\r\n                              </div>\r\n                              <div className=\"space-y-1.5\">\r\n                                <Label className=\"text-xs font-medium text-gray-700\"> </Label>\r\n                                <Input \r\n                                  type=\"number\" \r\n                                  value={newProduct.wholesalePrice || ''} \r\n                                  onChange={(e) => setNewProduct(p => ({ ...p, wholesalePrice: e.target.value }))}\r\n                                  className=\"h-9 bg-white\"\r\n                                  placeholder=\"0.00\"\r\n                                />\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-3\">\r\n                              <div className=\"space-y-1.5\">\r\n                                <Label className=\"text-xs font-medium text-gray-700\"> <span className=\"text-red-500\">*</span></Label>\r\n                                <Input \r\n                                  type=\"number\" \r\n                                  value={newProduct.quantity} \r\n                                  onChange={(e) => setNewProduct(p => ({ ...p, quantity: e.target.value }))}\r\n                                  className=\"h-9 bg-white\"\r\n                                  placeholder=\"1\"\r\n                                />\r\n                              </div>\r\n                              <div className=\"space-y-1.5\">\r\n                                <Label className=\"text-xs font-medium text-gray-700\"> ()</Label>\r\n                                <div className=\"relative\">\r\n                                  <Input \r\n                                    value={newProduct.barcode || ''} \r\n                                    onChange={(e) => setNewProduct(p => ({ ...p, barcode: e.target.value }))}\r\n                                    className=\"h-9 bg-white pl-8\"\r\n                                    placeholder=\"Scan...\"\r\n                                  />\r\n                                  <ScanBarcode className=\"absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-gray-400\" />\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"flex items-end\">\r\n                               <Button \r\n                                className=\"w-full h-9 bg-emerald-600 hover:bg-emerald-700 text-white shadow-sm\"\r\n                                onClick={() => {\r\n                                  if (isShiftActive) {\r\n                                    toast({ title: ' ', description: '     ', variant: 'destructive' });\r\n                                    return;\r\n                                  }\r\n                                  requireMasterPin(' ', '   ', createProduct);\r\n                                }}\r\n                              >\r\n                                <Plus className=\"h-4 w-4 ml-2\" />\r\n                                  \r\n                               </Button>\r\n                            </div>\r\n                         </div>\r\n                      </div>\r\n                    )}\r\n                  </Card>\r\n\r\n                  {/* Products Toolbar */}\r\n                  <div className=\"flex flex-col sm:flex-row gap-3 items-stretch sm:items-center justify-between bg-white p-2 rounded-xl border border-gray-100 shadow-sm\">\r\n                     <div className=\"relative flex-1 w-full sm:max-w-md group\">\r\n                        <Search className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400 group-focus-within:text-primary transition-colors\" />\r\n                        <Input\r\n                          value={productSearchTerm}\r\n                          onChange={(e) => setProductSearchTerm(e.target.value)}\r\n                          placeholder=\"   ...\"\r\n                          className=\"pl-3 pr-9 h-10 border-0 bg-transparent focus-visible:ring-0 placeholder:text-gray-400\"\r\n                        />\r\n                     </div>\r\n                     <div className=\"h-8 w-px bg-gray-200 hidden sm:block\" />\r\n                     <div className=\"flex items-center gap-2 w-full sm:w-auto\">\r\n                        <div className=\"relative flex-1 sm:w-48 group\">\r\n                           <ScanBarcode className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400 group-focus-within:text-primary transition-colors\" />\r\n                           <Input\r\n                             value={scannedBarcode}\r\n                             onChange={(e) => setScannedBarcode(e.target.value)}\r\n                             onKeyDown={async (e) => {\r\n                               if (e.key === 'Enter' && scannedBarcode.trim()) {\r\n                                 await processBarcode(scannedBarcode.trim());\r\n                                 setScannedBarcode('');\r\n                               }\r\n                             }}\r\n                             placeholder=\" ...\"\r\n                             className=\"pr-9 h-9 bg-gray-50 border-gray-200 focus:bg-white transition-all text-sm\"\r\n                           />\r\n                        </div>\r\n                        <div className=\"flex items-center gap-1 border-r pr-2 mr-1\">\r\n                          <Button\r\n                            variant={isInvoiceMode ? \"default\" : \"ghost\"}\r\n                            size=\"icon\"\r\n                            onClick={() => setIsInvoiceMode(!isInvoiceMode)}\r\n                            className={`h-9 w-9 shrink-0 transition-all rounded-full ${isInvoiceMode ? 'bg-primary text-primary-foreground' : 'text-gray-500 hover:text-primary hover:bg-primary/10'}`}\r\n                            title=\" \"\r\n                          >\r\n                            <Receipt className=\"h-4 w-4\" />\r\n                          </Button>\r\n                          {isInvoiceMode && (\r\n                             <Button \r\n                              variant=\"outline\"\r\n                              size=\"icon\"\r\n                              onClick={printSelectedInvoice}\r\n                              disabled={Object.values(invoiceSelections).every(v => !v)}\r\n                              className=\"h-9 w-9 shrink-0 rounded-full border-gray-200\"\r\n                              title=\" \"\r\n                             >\r\n                               <Printer className=\"h-4 w-4 text-gray-600\" />\r\n                             </Button>\r\n                          )}\r\n                        </div>\r\n                     </div>\r\n                  </div>\r\n\r\n                  {/* Products Grid/List */}\r\n                  <div className=\"space-y-4\">\r\n                    {filteredShopProducts.length === 0 ? (\r\n                      <div className=\"flex flex-col items-center justify-center py-16 px-4 bg-white rounded-xl border border-dashed border-gray-200 text-center shadow-sm\">\r\n                        <div className=\"bg-gray-50 p-4 rounded-full mb-4\">\r\n                           <Package className=\"h-10 w-10 text-gray-300\" />\r\n                        </div>\r\n                        <h3 className=\"text-lg font-semibold text-gray-900 mb-1\">  </h3>\r\n                        <p className=\"text-gray-500 text-sm max-w-xs mx-auto mb-4\">\r\n                                 .\r\n                        </p>\r\n                        <Button variant=\"outline\" onClick={() => setIsAddProductOpen(true)} className=\"gap-2\">\r\n                          <Plus className=\"h-4 w-4\" />\r\n                            \r\n                        </Button>\r\n                      </div>\r\n                    ) : (\r\n                      <>\r\n                        {/* Desktop Table View */}\r\n                        <div className=\"hidden md:block bg-[#fcf9f2] rounded-xl border border-gray-100 shadow-sm overflow-hidden\">\r\n                           <Table>\r\n                             <TableHeader className=\"bg-gray-50/80\">\r\n                               <TableRow className=\"hover:bg-transparent border-gray-100\">\r\n                                 <TableHead className=\"text-right h-11 font-semibold text-gray-700\"></TableHead>\r\n                                 <TableHead className=\"text-center h-11 font-semibold text-gray-700 w-28\"></TableHead>\r\n                                 <TableHead className=\"text-center h-11 font-semibold text-gray-700 w-28\">\r\n                                   <div className=\"flex items-center justify-center gap-1.5 cursor-pointer hover:text-primary transition-colors select-none\" onClick={() => {\r\n                                    if (isWholesaleVisible) {\r\n                                      setIsWholesaleVisible(false);\r\n                                    } else {\r\n                                      requireMasterPin('  ', '      ', () => setIsWholesaleVisible(true));\r\n                                    }\r\n                                  }}>\r\n                                    <span></span>\r\n                                    {isWholesaleVisible ? <EyeOff className=\"h-3.5 w-3.5\" /> : <Eye className=\"h-3.5 w-3.5\" />}\r\n                                  </div>\r\n                                 </TableHead>\r\n                                 <TableHead className=\"text-center h-11 font-semibold text-gray-700 w-24\"></TableHead>\r\n                                 <TableHead className=\"text-center h-11 font-semibold text-gray-700 w-[420px]\"> </TableHead>\r\n                               </TableRow>\r\n                             </TableHeader>\r\n                             <TableBody>\r\n                               {filteredShopProducts.map(product => (\r\n                                 <TableRow key={product.id} className=\"hover:bg-gray-50/60 transition-colors border-gray-100\">\r\n                                   <TableCell className=\"font-medium py-3\">\r\n                                     <div className=\"text-gray-900 font-bold\">{product.name}</div>\r\n                                     {product.barcode && (\r\n                                       <div className=\"flex items-center gap-1 text-[11px] text-gray-500 font-mono mt-0.5\">\r\n                                          <ScanBarcode className=\"h-3 w-3\" />\r\n                                          {product.barcode}\r\n                                       </div>\r\n                                     )}\r\n                                   </TableCell>\r\n                                   <TableCell className=\"text-center py-3\">\r\n                                      <span className=\"font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-md\">{formatMoney(product.sellingPrice)}</span>\r\n                                   </TableCell>\r\n                                   <TableCell className=\"text-center py-3\">\r\n                                      <span className={`font-medium text-xs ${isWholesaleVisible ? \"text-gray-600\" : \"blur-sm select-none text-gray-300\"}`}>\r\n                                        {formatMoney(product.wholesalePrice)}\r\n                                      </span>\r\n                                   </TableCell>\r\n                                   <TableCell className=\"text-center py-3\">\r\n                                     <div className=\"flex items-center justify-center gap-1\">\r\n                                       <Badge variant={product.quantity > 0 ? \"outline\" : \"destructive\"} className={`font-mono ${product.quantity > 0 ? 'bg-gray-50 text-gray-700 border-gray-200' : ''}`}>\r\n                                         {product.quantity}\r\n                                       </Badge>\r\n                                       <Button\r\n                                          size=\"icon\"\r\n                                          variant=\"ghost\"\r\n                                          className=\"h-5 w-5 rounded-full text-emerald-600 hover:bg-emerald-50 hover:text-emerald-700\"\r\n                                          onClick={() => handleOpenAddQtyDialog(product)}\r\n                                          title=\" \"\r\n                                       >\r\n                                          <Plus className=\"h-3 w-3\" />\r\n                                       </Button>\r\n                                     </div>\r\n                                   </TableCell>\r\n                                   <TableCell className=\"py-3\">\r\n                                     <div className=\"flex items-center gap-2 justify-end\">\r\n                                        <div className=\"relative group\">\r\n                                           <Input \r\n                                             type=\"number\" \r\n                                             className=\"h-8 w-14 text-center px-1 text-sm bg-white border-gray-200 focus:border-primary/50\" \r\n                                             placeholder=\"1\"\r\n                                             value={sellingQtyByProduct[product.id] || ''}\r\n                                             onChange={e => setSellingQtyByProduct(prev => ({ ...prev, [product.id]: e.target.value }))}\r\n                                           />\r\n                                           <span className=\"absolute -top-2 -right-1 text-[9px] bg-white px-0.5 text-gray-400 group-hover:text-primary transition-colors\"></span>\r\n                                        </div>\r\n                                        \r\n                                        <div className=\"relative group\">\r\n                                           <Input \r\n                                             type=\"number\" \r\n                                             className=\"h-8 w-16 text-center px-1 bg-gray-50 border-gray-200 focus:border-primary/50 text-sm focus:bg-white transition-colors\" \r\n                                             placeholder=\"\"\r\n                                             value={sellingPriceOverrideByProduct[product.id] || ''}\r\n                                             onChange={e => setSellingPriceOverrideByProduct(prev => ({ ...prev, [product.id]: e.target.value }))}\r\n                                             title=\"  \"\r\n                                           />\r\n                                           <span className=\"absolute -top-2 -right-1 text-[9px] bg-white px-0.5 text-gray-400 group-hover:text-primary transition-colors\"></span>\r\n                                        </div>\r\n\r\n                                        <Button \r\n                                          size=\"sm\" \r\n                                          className=\"h-8 bg-indigo-600 hover:bg-indigo-700 text-white shadow-sm px-3 font-medium\"\r\n                                          onClick={() => sellProduct(product)}\r\n                                        >\r\n                                          \r\n                                        </Button>\r\n                                        <Button \r\n                                          size=\"sm\" \r\n                                          variant=\"secondary\"\r\n                                          className=\"h-8 text-amber-700 bg-amber-50 hover:bg-amber-100 border border-amber-200 px-3 font-medium\"\r\n                                          onClick={() => { setPendingDeferredProduct(product); setIsDeferredFormOpen(true); }}\r\n                                        >\r\n                                          \r\n                                        </Button>\r\n                                        \r\n                                        {isInvoiceMode && (\r\n                                           <Input \r\n                                             type=\"number\"\r\n                                             className=\"h-8 w-12 text-center border-indigo-200 focus:border-indigo-400 bg-indigo-50/30\"\r\n                                             placeholder=\"#\"\r\n                                             value={invoiceSelections[product.id] ?? ''}\r\n                                             onChange={(e) => {\r\n                                                const val = parseInt(e.target.value || '0');\r\n                                                setInvoiceSelections(prev => ({ ...prev, [product.id]: isNaN(val) ? 0 : val }));\r\n                                             }}\r\n                                           />\r\n                                        )}\r\n                                        \r\n                                        <div className=\"w-px h-4 bg-gray-200 mx-1\" />\r\n                                        \r\n                                        <Button\r\n                                          size=\"icon\"\r\n                                          variant=\"ghost\"\r\n                                          className=\"h-8 w-8 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full\"\r\n                                          onClick={() => deleteProduct(product)}\r\n                                          disabled={isShiftActive}\r\n                                        >\r\n                                          <Trash2 className=\"h-4 w-4\" />\r\n                                        </Button>\r\n                                     </div>\r\n                                   </TableCell>\r\n                                 </TableRow>\r\n                               ))}\r\n                             </TableBody>\r\n                           </Table>\r\n                        </div>\r\n\r\n                        {/* Mobile Cards View */}\r\n                        <div className=\"md:hidden grid grid-cols-1 gap-3\">\r\n                           {filteredShopProducts.map(product => (\r\n                             <Card key={product.id} className=\"overflow-hidden border-gray-100 shadow-sm hover:shadow-md transition-shadow bg-[#fcf9f2]\">\r\n                                <CardContent className=\"p-4 space-y-4\">\r\n                                   <div className=\"flex justify-between items-start\">\r\n                                      <div>\r\n                                        <h4 className=\"font-bold text-gray-900 text-base\">{product.name}</h4>\r\n                                        <div className=\"flex flex-wrap items-center gap-2 mt-2\">\r\n                                           <Badge variant=\"secondary\" className=\"bg-emerald-50 text-emerald-700 border-emerald-100\">\r\n                                              {formatMoney(product.sellingPrice)}\r\n                                           </Badge>\r\n                                           <span className={`text-xs text-gray-500 flex items-center gap-1 ${!isWholesaleVisible && 'blur-sm select-none'}`}>\r\n                                              <span className=\"text-gray-400\">:</span>\r\n                                              {formatMoney(product.wholesalePrice)}\r\n                                           </span>\r\n                                           <span className=\"text-gray-300\">|</span>\r\n                                           <span className=\"text-xs text-gray-600 font-medium flex items-center gap-1\">\r\n                                              : {product.quantity}\r\n                                              <Button\r\n                                                size=\"icon\"\r\n                                                variant=\"ghost\"\r\n                                                className=\"h-5 w-5 rounded-full text-emerald-600 hover:bg-emerald-50\"\r\n                                                onClick={() => handleOpenAddQtyDialog(product)}\r\n                                              >\r\n                                                <Plus className=\"h-3 w-3\" />\r\n                                              </Button>\r\n                                           </span>\r\n                                        </div>\r\n                                      </div>\r\n                                      <Button \r\n                                        size=\"icon\" \r\n                                        variant=\"ghost\" \r\n                                        className=\"h-8 w-8 -mt-1 -ml-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full\"\r\n                                        onClick={() => deleteProduct(product)}\r\n                                        disabled={isShiftActive}\r\n                                      >\r\n                                        <Trash2 className=\"h-4 w-4\" />\r\n                                      </Button>\r\n                                   </div>\r\n                                   \r\n                                   <div className=\"flex items-center gap-2 bg-gray-50/50 p-2 rounded-lg border border-gray-100\">\r\n                                      <div className=\"relative flex-1\">\r\n                                        <Input \r\n                                           type=\"number\" \r\n                                           className=\"h-9 w-full bg-white text-center border-gray-200 focus:border-indigo-300\" \r\n                                           placeholder=\"\"\r\n                                           value={sellingQtyByProduct[product.id] || ''}\r\n                                           onChange={e => setSellingQtyByProduct(prev => ({ ...prev, [product.id]: e.target.value }))}\r\n                                        />\r\n                                        <span className=\"absolute inset-y-0 right-2 flex items-center text-[10px] text-gray-400 pointer-events-none\"></span>\r\n                                      </div>\r\n                                      <div className=\"relative w-28\">\r\n                                        <Input \r\n                                           type=\"number\" \r\n                                           className=\"h-9 w-full bg-white text-center border-gray-200 focus:border-indigo-300\" \r\n                                           placeholder=\" \"\r\n                                           value={sellingPriceOverrideByProduct[product.id] || ''}\r\n                                           onChange={e => setSellingPriceOverrideByProduct(prev => ({ ...prev, [product.id]: e.target.value }))}\r\n                                        />\r\n                                        <span className=\"absolute inset-y-0 right-2 flex items-center text-[10px] text-gray-400 pointer-events-none\"></span>\r\n                                      </div>\r\n                                   </div>\r\n                                   \r\n                                   <div className=\"grid grid-cols-2 gap-3\">\r\n                                      <Button \r\n                                         className=\"h-10 bg-indigo-600 text-white hover:bg-indigo-700 shadow-sm font-bold\"\r\n                                         onClick={() => sellProduct(product)}\r\n                                      >\r\n                                         <DollarSign className=\"h-4 w-4 ml-2\" />\r\n                                          \r\n                                      </Button>\r\n                                      <Button \r\n                                         variant=\"outline\"\r\n                                         className=\"h-10 border-amber-200 text-amber-700 bg-amber-50 hover:bg-amber-100 font-bold\"\r\n                                         onClick={() => { setPendingDeferredProduct(product); setIsDeferredFormOpen(true); }}\r\n                                      >\r\n                                         <Clock className=\"h-4 w-4 ml-2\" />\r\n                                          \r\n                                      </Button>\r\n                                   </div>\r\n                                   \r\n                                   {isInvoiceMode && (\r\n                                      <div className=\"pt-3 border-t border-dashed border-gray-200\">\r\n                                         <div className=\"flex items-center gap-3\">\r\n                                            <span className=\"text-xs font-medium text-gray-500\">:</span>\r\n                                            <Input \r\n                                               type=\"number\"\r\n                                               className=\"h-8 flex-1 bg-indigo-50/30 border-indigo-100\"\r\n                                               value={invoiceSelections[product.id] ?? ''}\r\n                                               onChange={(e) => {\r\n                                                  const val = parseInt(e.target.value || '0');\r\n                                                  setInvoiceSelections(prev => ({ ...prev, [product.id]: isNaN(val) ? 0 : val }));\r\n                                               }}\r\n                                               placeholder=\"  \"\r\n                                            />\r\n                                         </div>\r\n                                      </div>\r\n                                   )}\r\n                                </CardContent>\r\n                             </Card>\r\n                           ))}\r\n                        </div>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                    </div>\r\n                  </div>\r\n                </TabsContent>\r\n\r\n                {/* Sales Log Tab */}\r\n                <TabsContent value=\"sales-log\" className=\"flex-1 p-0 m-0 overflow-hidden h-full relative\">\r\n                  <div className=\"absolute inset-0 overflow-y-auto scrollbar-thin\">\r\n                    <div className=\"p-4 space-y-4 min-h-full\">\r\n                      {/* Mobile Stats Trigger Button */}\r\n                      <div className=\"md:hidden\">\r\n                         <Button \r\n                           variant=\"outline\" \r\n                           className=\"w-full justify-between bg-white border-dashed border-2 border-gray-200 h-12 text-gray-700 hover:text-primary hover:border-primary/50 hover:bg-primary/5 shadow-sm\"\r\n                           onClick={() => setIsMobileStatsOpen(true)}\r\n                         >\r\n                           <span className=\"flex items-center gap-2 font-semibold\">\r\n                             <FileText className=\"h-4 w-4 text-primary\" />\r\n                              \r\n                           </span>\r\n                           <span className=\"text-xs text-muted-foreground font-normal bg-gray-50 px-2 py-1 rounded-full border\">\r\n                               \r\n                           </span>\r\n                         </Button>\r\n                      </div>\r\n\r\n                      {salesData.length === 0 ? (\r\n                        <div className=\"flex-1 flex flex-col items-center justify-center py-12 px-4 bg-[#fcf9f2]/50 rounded-xl border border-dashed border-gray-200 text-center\">\r\n                       <div className=\"bg-[#fcf9f2] p-4 rounded-full shadow-sm mb-4\">\r\n                         <Receipt className=\"h-8 w-8 text-gray-400\" />\r\n                       </div>\r\n                       <h3 className=\"text-lg font-semibold text-gray-900 mb-1\">  </h3>\r\n                       <p className=\"text-gray-500 text-sm\">      .</p>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"space-y-4\">\r\n                       {/* Desktop Log View */}\r\n                      <div className=\"hidden md:block bg-[#fcf9f2] rounded-xl border border-gray-100 shadow-sm overflow-hidden\">\r\n                         <Table>\r\n                             <TableHeader className=\"bg-gray-50/80\">\r\n                                <TableRow className=\"hover:bg-transparent\">\r\n                                   <TableHead className=\"text-right h-11 font-semibold text-gray-700\"></TableHead>\r\n                                   <TableHead className=\"text-center h-11 font-semibold text-gray-700\"></TableHead>\r\n                                   <TableHead className=\"text-center h-11 font-semibold text-gray-700\"></TableHead>\r\n                                   <TableHead className=\"text-center h-11 font-semibold text-gray-700\"></TableHead>\r\n                                   <TableHead className=\"text-center h-11 font-semibold text-gray-700\"></TableHead>\r\n                                   <TableHead className=\"text-center h-11 font-semibold text-gray-700\"></TableHead>\r\n                                   <TableHead className=\"text-center h-11 font-semibold text-gray-700\"></TableHead>\r\n                                   <TableHead className=\"text-center h-11 font-semibold text-gray-700\"></TableHead>\r\n                                </TableRow>\r\n                             </TableHeader>\r\n                             <TableBody>\r\n                                {salesData.map((sale) => (\r\n                                   <TableRow key={sale.id} className=\"hover:bg-gray-50/60 transition-colors\">\r\n                                      <TableCell className=\"py-3\">\r\n                                         <div className=\"font-medium text-gray-900\">{sale.productName}</div>\r\n                                         {sale.isDeferred && <Badge variant=\"secondary\" className=\"mt-1 text-[10px] bg-amber-100 text-amber-700 border-amber-200\"></Badge>}\r\n                                      </TableCell>\r\n                                      <TableCell className=\"text-center py-3\">{formatMoney(sale.price)}</TableCell>\r\n                                      <TableCell className=\"text-center py-3\">\r\n                                        <Badge variant=\"outline\" className=\"font-mono bg-gray-50\">\r\n                                          {sale.quantity}\r\n                                        </Badge>\r\n                                      </TableCell>\r\n                                      <TableCell className=\"text-center font-bold text-green-600 py-3\">\r\n                                         {formatMoney(sale.price * sale.quantity)}\r\n                                      </TableCell>\r\n                                      <TableCell className=\"text-center text-indigo-600 py-3\">\r\n                                        <span className={isWholesaleVisible ? \"\" : \"blur-sm select-none text-gray-300\"}>\r\n                                           {formatMoney(((sale.price ?? 0) - (sale.wholesalePrice ?? 0)) * sale.quantity)}\r\n                                        </span>\r\n                                     </TableCell>\r\n                                     <TableCell className=\"text-center text-gray-500 text-xs py-3 font-mono\">\r\n                                        {formatDate(sale.date)}\r\n                                     </TableCell>\r\n                                     <TableCell className=\"text-center text-gray-500 text-xs py-3 font-mono\">\r\n                                        {sale.time}\r\n                                     </TableCell>\r\n                                      <TableCell className=\"py-3\">\r\n                                         <div className=\"flex justify-center gap-2\">\r\n                                            {sale.isDeferred && (\r\n                                              <Button size=\"sm\" variant=\"outline\" className=\"h-8 text-xs border-amber-200 text-amber-700 bg-amber-50 hover:bg-amber-100\" onClick={() => requireMasterPin('   ', '     ', () => markDeferredSalePaid(sale))}>\r\n                                                \r\n                                              </Button>\r\n                                            )}\r\n                                            <Button size=\"sm\" variant=\"ghost\" className=\"h-8 w-8 p-0 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-full\" onClick={() => openDeleteConfirm(sale, 'return')} title=\"\">\r\n                                               <TrendingDown className=\"h-4 w-4\" />\r\n                                            </Button>\r\n                                            <Button size=\"sm\" variant=\"ghost\" className=\"h-8 w-8 p-0 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full\" onClick={() => openDeleteConfirm(sale, 'delete')} title=\" \">\r\n                                               <XCircle className=\"h-4 w-4\" />\r\n                                            </Button>\r\n                                         </div>\r\n                                      </TableCell>\r\n                                   </TableRow>\r\n                                ))}\r\n                             </TableBody>\r\n                          </Table>\r\n                       </div>\r\n\r\n                       {/* Mobile Log View */}\r\n                       <div className=\"md:hidden space-y-3\">\r\n                          {salesData.map((sale) => (\r\n                             <Card key={sale.id} className=\"overflow-hidden border-gray-100 shadow-sm bg-[#fcf9f2]\">\r\n                                <CardContent className=\"p-4\">\r\n                                  <div className=\"flex justify-between items-start mb-3\">\r\n                                     <div>\r\n                                        <h4 className=\"font-bold text-gray-900 text-sm\">{sale.productName}</h4>\r\n                                        <div className=\"text-xs text-gray-500 mt-1 flex items-center gap-2\">\r\n                                         <span className=\"bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 font-mono\">{sale.time}</span>\r\n                                         <span className=\"text-gray-400\">|</span>\r\n                                         <span>{formatDate(sale.date)}</span>\r\n                                         {sale.isDeferred && <Badge variant=\"outline\" className=\"text-[10px] bg-amber-50 text-amber-700 border-amber-100 px-1.5 py-0 h-5\"></Badge>}\r\n                                      </div>\r\n                                     </div>\r\n                                     <div className=\"text-left\">\r\n                                        <div className=\"font-bold text-green-600 text-sm\">{formatMoney(sale.price * sale.quantity)}</div>\r\n                                        <div className=\"text-xs text-gray-400 mt-0.5\">{sale.quantity}  {formatMoney(sale.price)}</div>\r\n                                     </div>\r\n                                  </div>\r\n                                  \r\n                                  <div className=\"flex items-center justify-end gap-2 pt-3 border-t border-gray-50\">\r\n                                     {sale.isDeferred && (\r\n                                       <Button size=\"sm\" variant=\"ghost\" className=\"h-8 text-xs text-amber-600 bg-amber-50 hover:bg-amber-100\" onClick={() => requireMasterPin('   ', '     ', () => markDeferredSalePaid(sale))}>\r\n                                         \r\n                                       </Button>\r\n                                    )}\r\n                                     <Button size=\"sm\" variant=\"ghost\" className=\"h-8 text-xs text-red-600 hover:bg-red-50\" onClick={() => openDeleteConfirm(sale, 'return')}>\r\n                                        <TrendingDown className=\"h-3.5 w-3.5 ml-1.5\" />\r\n                                        \r\n                                     </Button>\r\n                                     <Button size=\"sm\" variant=\"ghost\" className=\"h-8 w-8 p-0 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full\" onClick={() => openDeleteConfirm(sale, 'delete')}>\r\n                                        <Trash2 className=\"h-4 w-4\" />\r\n                                     </Button>\r\n                                  </div>\r\n                                </CardContent>\r\n                             </Card>\r\n                          ))}\r\n                       </div>\r\n                    </div>\r\n                  )}\r\n                    </div>\r\n                  </div>\r\n                </TabsContent>\r\n\r\n              </Tabs>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n      <Dialog open={isDeferredFormOpen} onOpenChange={setIsDeferredFormOpen}>\r\n        <DialogContent className=\"max-w-sm mx-auto bg-white border border-gray-100 shadow-xl rounded-2xl sm:max-w-md p-6 gap-5\">\r\n          <DialogHeader className=\"text-center space-y-2\">\r\n            <div className=\"mx-auto bg-amber-100 p-3 rounded-full w-fit\">\r\n              <Clock className=\"h-6 w-6 text-amber-600\" />\r\n            </div>\r\n            <DialogTitle className=\"text-xl font-bold text-gray-900\">  </DialogTitle>\r\n            <DialogDescription className=\"text-gray-500 text-sm\">\r\n                    \r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          \r\n          <div className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-1 gap-1.5\">\r\n              <Label className=\"text-sm font-medium text-gray-700\">  ()</Label>\r\n              <div className=\"relative\">\r\n                 <select\r\n                   className=\"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 appearance-none\"\r\n                   value={deferredCustomerId}\r\n                   onChange={(e) => {\r\n                     const val = e.target.value;\r\n                     setDeferredCustomerId(val);\r\n                     const c = customers.find(x => x.id === val);\r\n                     if (c) {\r\n                       setDeferredCustomerName(c.name);\r\n                       setDeferredCustomerMobile(c.mobile || '');\r\n                     }\r\n                   }}\r\n                 >\r\n                   <option value=\"\">--    --</option>\r\n                   {customers.map(c => (\r\n                     <option key={c.id} value={c.id}>{c.name}{c.mobile ? ` - ${c.mobile}` : ''}</option>\r\n                   ))}\r\n                 </select>\r\n                 <ChevronDown className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none\" />\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"grid grid-cols-1 gap-1.5\">\r\n              <Label className=\"text-sm font-medium text-gray-700\">  <span className=\"text-red-500\">*</span></Label>\r\n              <Input\r\n                value={deferredCustomerName}\r\n                onChange={(e) => setDeferredCustomerName(e.target.value)}\r\n                placeholder=\"  ...\"\r\n                className=\"h-10\"\r\n              />\r\n            </div>\r\n            \r\n            <div className=\"grid grid-cols-1 gap-1.5\">\r\n              <Label className=\"text-sm font-medium text-gray-700\">  ()</Label>\r\n              <Input\r\n                value={deferredCustomerMobile}\r\n                onChange={(e) => setDeferredCustomerMobile(e.target.value)}\r\n                placeholder=\"  ...\"\r\n                className=\"h-10\"\r\n              />\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center gap-3 mt-2\">\r\n            <Button variant=\"outline\" className=\"flex-1 h-10 border-gray-200\" onClick={() => setIsDeferredFormOpen(false)}></Button>\r\n            <Button\r\n              className=\"flex-1 h-10 bg-amber-600 hover:bg-amber-700 text-white shadow-sm\"\r\n              onClick={async () => {\r\n                try {\r\n                  const prod = pendingDeferredProduct;\r\n                  if (!prod) { setIsDeferredFormOpen(false); return; }\r\n                  const name = deferredCustomerName.trim();\r\n                  const mobile = deferredCustomerMobile.trim() || undefined;\r\n                  const id = deferredCustomerId || undefined;\r\n                  if (!name) { toast({ title: ' ', description: '  ', variant: 'destructive' }); return; }\r\n                  await sellProduct(prod, true, { id, name, mobile });\r\n                try {\r\n                  if (user?.uid) {\r\n                    const saleTotal = prod.sellingPrice * (parseInt(sellingQtyByProduct[prod.id] || '0') || 0);\r\n                    const userData = await userDataService.getUserData(user.uid);\r\n                    const list: any[] = Array.isArray(userData?.debts) ? userData.debts : [];\r\n                    const newDebt = {\r\n                      id: Date.now().toString(),\r\n                      debtorName: name,\r\n                      customerId: id || null,\r\n                      mobile: mobile || null,\r\n                      amount: saleTotal,\r\n                      reason: `   ${prod.name}`,\r\n                      status: 'pending',\r\n                      createdAt: new Date(),\r\n                      partialPayments: []\r\n                    };\r\n                    const updated = [newDebt, ...list];\r\n                    userDataService.updateUserData(user.uid, { debts: updated }).catch(() => {});\r\n                    try {\r\n                      const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n                      localStorage.setItem(`debts_${user.uid}_${sid}`, JSON.stringify(updated));\r\n                      localStorage.setItem(`debts_default_${sid}`, JSON.stringify(updated));\r\n                      localStorage.setItem(`debts_last_write_${user.uid}_${sid}`, Date.now().toString());\r\n                    } catch {}\r\n                    try { window.dispatchEvent(new CustomEvent('debtsUpdated', { detail: { count: updated.length } })); } catch {}\r\n                    try { telegramNotifier.send(user.uid, `    ${newDebt.debtorName}  ${newDebt.amount} `).catch(() => {}); } catch {}\r\n                  }\r\n                } catch {}\r\n                  setIsDeferredFormOpen(false);\r\n                  setPendingDeferredProduct(null);\r\n                } catch {}\r\n              }}\r\n            >\r\n               \r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*     */}\r\n      <Dialog open={isSalesReceiptsDialogOpen} onOpenChange={setIsSalesReceiptsDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-4xl max-h-[85vh] flex flex-col p-0 overflow-hidden gap-0\">\r\n          <div className=\"p-4 border-b flex items-center justify-between bg-gray-50/50\">\r\n             <div className=\"flex items-center gap-3\">\r\n                <div className=\"bg-white p-2 rounded-full border shadow-sm\">\r\n                   <Receipt className=\"h-5 w-5 text-indigo-600\" />\r\n                </div>\r\n                <div>\r\n                   <DialogTitle className=\"text-lg font-bold\"> </DialogTitle>\r\n                   <DialogDescription className=\"text-xs\">    </DialogDescription>\r\n                </div>\r\n             </div>\r\n             <Button variant=\"ghost\" size=\"icon\" onClick={() => setIsSalesReceiptsDialogOpen(false)} className=\"rounded-full\">\r\n                <X className=\"h-5 w-5\" />\r\n             </Button>\r\n          </div>\r\n          \r\n          <div className=\"flex-1 overflow-y-auto p-4\">\r\n            {salesData.filter(s => !s.isDeferred).length === 0 ? (\r\n              <div className=\"flex flex-col items-center justify-center py-12 text-center\">\r\n                 <div className=\"bg-gray-50 p-4 rounded-full mb-3\">\r\n                    <Receipt className=\"h-8 w-8 text-gray-300\" />\r\n                 </div>\r\n                 <p className=\"text-gray-500 font-medium\">     </p>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                {/* Desktop View */}\r\n                <div className=\"hidden md:block border rounded-xl overflow-hidden shadow-sm\">\r\n                  <Table>\r\n                    <TableHeader className=\"bg-gray-50/80\">\r\n                      <TableRow className=\"hover:bg-transparent\">\r\n                        <TableHead className=\"text-right h-10 font-semibold text-gray-700\"></TableHead>\r\n                        <TableHead className=\"text-right h-10 font-semibold text-gray-700\"> </TableHead>\r\n                        <TableHead className=\"text-right h-10 font-semibold text-gray-700\"> </TableHead>\r\n                        <TableHead className=\"text-right h-10 font-semibold text-gray-700\"></TableHead>\r\n                        <TableHead className=\"text-right h-10 font-semibold text-gray-700\"></TableHead>\r\n                        <TableHead className=\"text-right h-10 font-semibold text-gray-700\"></TableHead>\r\n                        <TableHead className=\"text-right h-10 font-semibold text-gray-700\"></TableHead>\r\n                        <TableHead className=\"text-right h-10 font-semibold text-gray-700\"></TableHead>\r\n                        <TableHead className=\"text-right h-10 font-semibold text-gray-700\"></TableHead>\r\n                      </TableRow>\r\n                    </TableHeader>\r\n                    <TableBody>\r\n                      {salesData.filter(s => !s.isDeferred).map((item) => (\r\n                        <TableRow key={item.id} className=\"hover:bg-gray-50/60\">\r\n                          <TableCell className=\"font-medium text-gray-900 py-3\">{item.productName}</TableCell>\r\n                          <TableCell className=\"text-gray-700 py-3\">{formatMoney(item.price)}</TableCell>\r\n                          <TableCell className=\"text-gray-700 py-3\">{formatMoney(item.wholesalePrice ?? 0)}</TableCell>\r\n                          <TableCell className=\"text-gray-700 py-3 font-mono\">{formatNumber(item.quantity)}</TableCell>\r\n                          <TableCell className=\"text-gray-700 py-3 font-bold text-emerald-600\">{formatMoney((item.price ?? 0) * (item.quantity ?? 0))}</TableCell>\r\n                          <TableCell className=\"text-gray-700 py-3 text-indigo-600\">{formatMoney(((item.price ?? 0) - (item.wholesalePrice ?? 0)) * (item.quantity ?? 0))}</TableCell>\r\n                          <TableCell className=\"text-gray-500 py-3 text-xs\">{formatDate(item.date)}</TableCell>\r\n                          <TableCell className=\"text-gray-500 py-3 text-xs font-mono\">{item.time}</TableCell>\r\n                          <TableCell className=\"text-gray-700 py-3 text-xs\">{item.executedBy || '-'}</TableCell>\r\n                        </TableRow>\r\n                      ))}\r\n                    </TableBody>\r\n                  </Table>\r\n                </div>\r\n\r\n                {/* Mobile View */}\r\n                <div className=\"md:hidden space-y-3\">\r\n                  {salesData.filter(s => !s.isDeferred).map((item) => (\r\n                    <Card key={item.id} className=\"overflow-hidden border-gray-100 shadow-sm\">\r\n                      <CardContent className=\"p-4 space-y-3\">\r\n                         <div className=\"flex justify-between items-start\">\r\n                            <div>\r\n                               <h4 className=\"font-bold text-gray-900 text-sm\">{item.productName}</h4>\r\n                               <div className=\"text-xs text-gray-500 mt-1 flex items-center gap-2\">\r\n                                  <span className=\"bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 font-mono\">{item.time}</span>\r\n                                  <span className=\"text-gray-400\">|</span>\r\n                                  <span>{formatDate(item.date)}</span>\r\n                               </div>\r\n                            </div>\r\n                            <div className=\"text-left\">\r\n                               <div className=\"font-bold text-emerald-600 text-sm\">{formatMoney((item.price ?? 0) * (item.quantity ?? 0))}</div>\r\n                               <div className=\"text-xs text-gray-400 mt-0.5\">{item.quantity}  {formatMoney(item.price)}</div>\r\n                            </div>\r\n                         </div>\r\n                         \r\n                         <div className=\"grid grid-cols-2 gap-2 pt-3 border-t border-dashed border-gray-100 text-xs\">\r\n                            <div className=\"bg-gray-50 p-2 rounded flex flex-col items-center justify-center\">\r\n                               <span className=\"text-gray-400 mb-1\"></span>\r\n                               <span className=\"font-bold text-indigo-600\">{formatMoney(((item.price ?? 0) - (item.wholesalePrice ?? 0)) * (item.quantity ?? 0))}</span>\r\n                            </div>\r\n                            <div className=\"bg-gray-50 p-2 rounded flex flex-col items-center justify-center\">\r\n                               <span className=\"text-gray-400 mb-1\"></span>\r\n                               <span className=\"font-medium text-gray-700 truncate max-w-full px-1\">{item.executedBy || '-'}</span>\r\n                            </div>\r\n                         </div>\r\n                      </CardContent>\r\n                    </Card>\r\n                  ))}\r\n                </div>\r\n              </>\r\n            )}\r\n          </div>\r\n          \r\n          <div className=\"p-4 border-t bg-gray-50/30 flex justify-end\">\r\n            <Button variant=\"outline\" onClick={() => setIsSalesReceiptsDialogOpen(false)} className=\"px-6\"></Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n      {/*   /    */}\r\n      <Dialog open={isDeleteConfirmOpen} onOpenChange={setIsDeleteConfirmOpen}>\r\n        <DialogContent className=\"max-w-sm mx-auto bg-white border border-gray-100 shadow-xl rounded-2xl sm:max-w-md p-6 gap-6\">\r\n          <div className=\"flex flex-col items-center text-center gap-2\">\r\n             <div className={`p-3 rounded-full ${deleteActionType === 'return' ? 'bg-amber-100 text-amber-600' : 'bg-red-100 text-red-600'}`}>\r\n                {deleteActionType === 'return' ? <TrendingDown className=\"h-6 w-6\" /> : <Trash2 className=\"h-6 w-6\" />}\r\n             </div>\r\n             <DialogTitle className=\"text-xl font-bold text-gray-900 mt-2\">\r\n               {deleteActionType === 'return' ? ' ' : ' '}\r\n             </DialogTitle>\r\n             <div className=\"text-sm text-gray-500 space-y-1\">\r\n               <p>\r\n                     {deleteActionType === 'return' ? '' : ''} \r\n                 <span className=\"font-bold text-gray-900 mx-1\">{deleteTargetSale?.productName}</span>\r\n                 \r\n                 <span className=\"font-bold text-gray-900 mx-1 font-mono\">{formatNumber(deleteTargetSale?.quantity || 0)}</span>\r\n               </p>\r\n               <p className=\"text-xs text-gray-400\">    .</p>\r\n             </div>\r\n          </div>\r\n          \r\n          <div className=\"grid grid-cols-2 gap-3\">\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"h-10 border-gray-200\"\r\n              onClick={() => setIsDeleteConfirmOpen(false)}\r\n            >\r\n              \r\n            </Button>\r\n            <Button\r\n              className={`h-10 ${deleteActionType === 'return' ? 'bg-amber-600 hover:bg-amber-700' : 'bg-red-600 hover:bg-red-700'} text-white shadow-sm`}\r\n              onClick={() => {\r\n                const tgt = deleteTargetSale;\r\n                setIsDeleteConfirmOpen(false);\r\n                if (tgt) deleteSale(tgt);\r\n              }}\r\n            >\r\n              {deleteActionType === 'return' ? ' ' : ' '}\r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*        */}\r\n      <MasterPinDialog\r\n        open={isProfitPinDialogOpen}\r\n        onOpenChange={setIsProfitPinDialogOpen}\r\n        mode=\"verify\"\r\n        title=\"  \"\r\n        description=\"      \"\r\n        onSuccess={() => {\r\n          setIsProfitLocked(false);\r\n          setIsProfitPinDialogOpen(false);\r\n        }}\r\n      />\r\n      {/*         */}\r\n      <MasterPinDialog\r\n        open={isMasterPinDialogOpen}\r\n        onOpenChange={setIsMasterPinDialogOpen}\r\n        mode=\"verify\"\r\n        title=\"  \"\r\n        description=\"          \"\r\n        onSuccess={async () => {\r\n          try {\r\n            const uid = user?.uid;\r\n            if (uid) {\r\n              const sub = await getUserSubscription(uid);\r\n              const rawPlan: any = (sub as any)?.planType ?? (sub as any)?.plan ?? null;\r\n              const planStr = typeof rawPlan === 'string' ? rawPlan.toLowerCase() : null;\r\n              const isZero = rawPlan === SubscriptionPlan.ZERO || planStr === 'zero';\r\n              if (isZero) {\r\n                toast({\r\n                  title: ' ',\r\n                  description: '      .     .',\r\n                  variant: 'destructive',\r\n                });\r\n                //    \r\n                return;\r\n              }\r\n            }\r\n          } catch (e) {}\r\n          setIsMonthlyLocked(false);\r\n          setIsMasterPinDialogOpen(false);\r\n          //       \r\n          loadMonthlyStats();\r\n        }}\r\n      />\r\n      {/*       (/) */}\r\n      <MasterPinDialog\r\n        open={isMasterPinActionOpen}\r\n        onOpenChange={setIsMasterPinActionOpen}\r\n        mode=\"verify\"\r\n        title={masterPinActionTitle}\r\n        description={masterPinActionDescription}\r\n        onSuccess={() => {\r\n          const act = protectedActionRef.current;\r\n          protectedActionRef.current = null;\r\n          setIsMasterPinActionOpen(false);\r\n          if (act) act();\r\n        }}\r\n      />\r\n\r\n      {/*    */}\r\n      <Dialog open={isAddQtyDialogOpen} onOpenChange={setIsAddQtyDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-[400px]\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"text-center\"> </DialogTitle>\r\n            <DialogDescription className=\"text-center\">\r\n                : <span className=\"font-bold text-black\">{productToAddQty?.name}</span>\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"py-6 flex flex-col items-center gap-4\">\r\n             <div className=\"flex items-center gap-4 w-full justify-center\">\r\n                <Button variant=\"outline\" size=\"icon\" onClick={() => setQtyToAdd(prev => String(Math.max(1, parseInt(prev || '0') - 1)))}>\r\n                   <TrendingDown className=\"h-4 w-4\" />\r\n                </Button>\r\n                <Input\r\n                  id=\"qty\"\r\n                  type=\"number\"\r\n                  value={qtyToAdd}\r\n                  onChange={(e) => setQtyToAdd(e.target.value)}\r\n                  className=\"w-32 text-center text-2xl font-bold h-12\"\r\n                  autoFocus\r\n                  onKeyDown={(e) => {\r\n                    if (e.key === 'Enter') {\r\n                      handleAddQtyConfirm();\r\n                    }\r\n                  }}\r\n                />\r\n                <Button variant=\"outline\" size=\"icon\" onClick={() => setQtyToAdd(prev => String(parseInt(prev || '0') + 1))}>\r\n                   <TrendingUp className=\"h-4 w-4\" />\r\n                </Button>\r\n             </div>\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 sm:justify-center\">\r\n            <Button variant=\"outline\" onClick={() => setIsAddQtyDialogOpen(false)} className=\"flex-1\"></Button>\r\n            <Button onClick={handleAddQtyConfirm} className=\"flex-1 bg-emerald-600 hover:bg-emerald-700\"> </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <Dialog open={isMobileStatsOpen} onOpenChange={setIsMobileStatsOpen}>\r\n        <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n          <DialogHeader>\r\n            <DialogTitle>  </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4 py-4\">\r\n             {/* Day Stats */}\r\n             <div className=\"bg-gray-50 p-4 rounded-lg border\">\r\n                <div className=\"flex items-center justify-between mb-3\">\r\n                  <h3 className=\"font-semibold flex items-center gap-2\">\r\n                    <DollarSign className=\"h-4 w-4 text-primary\" />\r\n                     \r\n                  </h3>\r\n                  <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 text-muted-foreground hover:text-red-600\" onClick={handleResetDailyStats} title=\" \">\r\n                    <RotateCcw className=\"h-3.5 w-3.5\" />\r\n                  </Button>\r\n                </div>\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                   <div className=\"text-center p-2 bg-white rounded border\">\r\n                      <div className=\"text-xs text-muted-foreground mb-1\"></div>\r\n                      <div className=\"font-bold text-primary\">\r\n                         {formatMoney(Math.max(0, salesData.filter(s => !s.isDeferred).reduce((sum, item) => sum + item.price * item.quantity, 0) - dailySalesOffset))}\r\n                      </div>\r\n                   </div>\r\n                   <div className=\"text-center p-2 bg-white rounded border relative overflow-hidden\">\r\n                      <div className={`text-xs text-emerald-700 mb-1`}></div>\r\n                      <div className={`font-bold text-emerald-700 ${isProfitLocked ? \"blur-sm\" : \"\"}`}>\r\n                         {formatMoney(Math.max(0, salesData.filter(s => !s.isDeferred).reduce((sum, item) => sum + ((item.price - (item.wholesalePrice ?? 0)) * item.quantity), 0) - dailyProfitOffset))}\r\n                      </div>\r\n                      {isProfitLocked && (\r\n                         <div className=\"absolute inset-0 flex items-center justify-center bg-white/50\">\r\n                            <Button size=\"sm\" variant=\"ghost\" onClick={() => { setIsMobileStatsOpen(false); setIsProfitPinDialogOpen(true); }} className=\"h-full w-full opacity-0 absolute inset-0\"></Button>\r\n                            <Lock className=\"h-3 w-3 text-muted-foreground\" />\r\n                         </div>\r\n                      )}\r\n                   </div>\r\n                </div>\r\n             </div>\r\n\r\n             {/* Month Stats */}\r\n             <div className=\"bg-indigo-50/50 p-4 rounded-lg border border-indigo-100\">\r\n                <div className=\"flex items-center justify-between mb-3\">\r\n                  <h3 className=\"font-semibold flex items-center gap-2 text-indigo-900\">\r\n                    <Calendar className=\"h-4 w-4 text-indigo-600\" />\r\n                     \r\n                  </h3>\r\n                  <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 text-muted-foreground hover:text-red-600\" onClick={handleResetMonthlyStats} title=\" \">\r\n                    <RotateCcw className=\"h-3.5 w-3.5\" />\r\n                  </Button>\r\n                </div>\r\n                <div className=\"grid grid-cols-2 gap-4 relative\">\r\n                   <div className={`text-center p-2 bg-white rounded border border-indigo-100 ${isMonthlyLocked ? \"blur-sm\" : \"\"}`}>\r\n                      <div className=\"text-xs text-indigo-600 mb-1\"></div>\r\n                      <div className=\"font-bold text-indigo-700\">{formatMoney(Math.max(0, monthlySalesTotal - monthlySalesOffset))}</div>\r\n                   </div>\r\n                   <div className={`text-center p-2 bg-white rounded border border-indigo-100 ${isMonthlyLocked ? \"blur-sm\" : \"\"}`}>\r\n                      <div className=\"text-xs text-pink-600 mb-1\"></div>\r\n                      <div className=\"font-bold text-pink-700\">{formatMoney(Math.max(0, monthlyProfitTotal - monthlyProfitOffset))}</div>\r\n                   </div>\r\n                   {isMonthlyLocked && (\r\n                      <div className=\"absolute inset-0 flex items-center justify-center z-10\">\r\n                         <Button size=\"sm\" variant=\"outline\" onClick={() => { setIsMobileStatsOpen(false); setIsMasterPinDialogOpen(true); }} className=\"h-8 bg-white/80 backdrop-blur-sm\">\r\n                            <Lock className=\"h-3 w-3 ml-1\" />\r\n                             \r\n                         </Button>\r\n                      </div>\r\n                   )}\r\n                </div>\r\n             </div>\r\n          </div>\r\n          <DialogFooter>\r\n             <Button onClick={() => setIsMobileStatsOpen(false)}></Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\n//  //     \r\nconst formatNumber = (n: number) => new Intl.NumberFormat('ar-EG').format(Number(n || 0));\r\nconst formatMoney = (n: number) => `${new Intl.NumberFormat('ar-EG', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(Number(n || 0))} .`;\r\nconst formatDate = (dateStr: string) => {\r\n  try {\r\n    const d = new Date(dateStr);\r\n    if (isNaN(d.getTime())) return new Date(`${dateStr}T00:00:00`).toLocaleDateString('ar-EG');\r\n    return d.toLocaleDateString('ar-EG');\r\n  } catch {\r\n    return dateStr;\r\n  }\r\n};\r\n","import React from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { DollarSign, Package, ArrowRightLeft } from 'lucide-react';\r\nimport { db } from '@/firebase';\r\nimport { useShop } from '@/hooks/useShop';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { collection, getDocs, query, where, doc, updateDoc, getDoc } from 'firebase/firestore';\r\nimport { reportsService } from '@/utils/reportsService';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\r\nimport { userDataService } from '@/integrations/firebase/services';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\n\r\ninterface CashSummaryDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  userId?: string | null;\r\n  cashBalance: number;\r\n  walletBalances: Record<string, number>;\r\n  transactions: any[];\r\n}\r\n\r\nexport const CashSummaryDialog: React.FC<CashSummaryDialogProps> = ({ open, onOpenChange, userId, cashBalance, walletBalances, transactions }) => {\r\n  const [accessorySalesToday, setAccessorySalesToday] = React.useState(0);\r\n  const [ackAccessoryToday, setAckAccessoryToday] = React.useState(0);\r\n  const [maintenanceTotalToday, setMaintenanceTotalToday] = React.useState(0);\r\n  const [ackMaintenanceToday, setAckMaintenanceToday] = React.useState(0);\r\n  const [localCashBalance, setLocalCashBalance] = React.useState<number>(cashBalance || 0);\r\n  const [isReceiptPinOpen, setIsReceiptPinOpen] = React.useState(false);\r\n  const [pendingReceiptType, setPendingReceiptType] = React.useState<'accessory' | 'maintenance' | null>(null);\r\n  const { toast } = useToast();\r\n  const { shopId: shopIdCtx } = useShop() || ({} as any);\r\n  const { profile } = useFirebaseAuth();\r\n  const [isDeductReasonOpen, setIsDeductReasonOpen] = React.useState(false);\r\n  const [deductReason, setDeductReason] = React.useState('');\r\n  const [isDeductPinOpen, setIsDeductPinOpen] = React.useState(false);\r\n  const [isDeductAmountOpen, setIsDeductAmountOpen] = React.useState(false);\r\n  const [deductAmount, setDeductAmount] = React.useState('');\r\n\r\n  const getCashBalanceKey = () => `cashBalance_${userId || 'default'}_${(shopIdCtx || (profile as any)?.shopId || 'main')}`;\r\n  const getGenericCashKey = () => `cashBalance_${userId || 'default'}`;\r\n\r\n  const formatCurrency = (n: number) => `${new Intl.NumberFormat('ar-EG').format(Number(n || 0))} `;\r\n\r\n  React.useEffect(() => {\r\n    const loadAccessorySales = async () => {\r\n      try {\r\n        if (!userId) { setAccessorySalesToday(0); return; }\r\n        const d = new Date();\r\n        const y = d.getFullYear();\r\n        const m = String(d.getMonth() + 1).padStart(2, '0');\r\n        const dd = String(d.getDate()).padStart(2, '0');\r\n        const todayStr = `${y}-${m}-${dd}`;\r\n        let snap;\r\n        try {\r\n          const q = query(\r\n            collection(db, 'dailySales'),\r\n            where('userId', '==', userId),\r\n            ...(shopIdCtx ? [where('shopId', '==', shopIdCtx)] : []),\r\n            where('date', '==', todayStr)\r\n          );\r\n          snap = await getDocs(q);\r\n        } catch {\r\n          const q2 = query(\r\n            collection(db, 'users', userId, 'dailySales'),\r\n            ...(shopIdCtx ? [where('shopId', '==', shopIdCtx)] : []),\r\n            where('date', '==', todayStr)\r\n          );\r\n          snap = await getDocs(q2);\r\n        }\r\n        let total = 0;\r\n        snap.forEach(docSnap => {\r\n          const d: any = docSnap.data();\r\n          const price = Number(d.sellingPrice ?? 0);\r\n          const qty = Number(d.quantity ?? 0);\r\n          if (price > 0 && qty > 0) {\r\n            total += price * qty;\r\n          }\r\n        });\r\n        setAccessorySalesToday(total);\r\n      } catch (e) {\r\n        console.warn('    :', e);\r\n      }\r\n    };\r\n\r\n    const loadMaintenanceTotal = async () => {\r\n      try {\r\n        if (!userId) { setMaintenanceProfitToday(0); return; }\r\n        const d = new Date();\r\n        const start = new Date(d.getFullYear(), d.getMonth(), d.getDate(), 0, 0, 0, 0);\r\n        const end = new Date(d.getFullYear(), d.getMonth(), d.getDate(), 23, 59, 59, 999);\r\n        let snap;\r\n        try {\r\n          const q = query(\r\n            collection(db, 'maintenance_items'),\r\n            where('userId', '==', userId),\r\n            where('status', '==', 'completed')\r\n          );\r\n          snap = await getDocs(q);\r\n        } catch (e) {\r\n          snap = await getDocs(query(collection(db, 'maintenance_items'), where('userId', '==', userId)));\r\n        }\r\n        let totalAmount = 0;\r\n        snap.forEach(docSnap => {\r\n          const d: any = docSnap.data();\r\n          if ((d.status || 'in_progress') !== 'completed') return;\r\n          const completedAt = d.completedAt?.toDate?.();\r\n          if (!completedAt) return;\r\n          if (completedAt.getTime() >= start.getTime() && completedAt.getTime() <= end.getTime()) {\r\n            const repair = Number(d.repairPrice || 0);\r\n            if (Number.isFinite(repair) && repair > 0) totalAmount += repair;\r\n          }\r\n        });\r\n        setMaintenanceTotalToday(Math.max(0, totalAmount));\r\n      } catch (e) {\r\n        console.warn('     :', e);\r\n      }\r\n    };\r\n\r\n    \r\n\r\n    const loadDailyReceipts = async () => {\r\n      try {\r\n        if (!userId) { setAckAccessoryToday(0); return; }\r\n        const data = await userDataService.getUserData(userId);\r\n        const todayStr = new Date().toISOString().slice(0, 10);\r\n        const r = data?.dailyReceipts || {};\r\n        if (r?.date && String(r.date).slice(0,10) === todayStr) {\r\n          setAckAccessoryToday(Number(r.accessory || 0));\r\n          setAckMaintenanceToday(Number(r.maintenance || 0));\r\n        } else {\r\n          setAckAccessoryToday(0);\r\n          setAckMaintenanceToday(0);\r\n        }\r\n        try {\r\n          const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n          const snap = await getDoc(doc(db, 'dashboardData', sid));\r\n          if (snap.exists()) {\r\n            const v = Number((snap.data() as any)?.cashBalance || 0);\r\n            setLocalCashBalance(v);\r\n            try { localStorage.setItem(`cashBalance_${userId}`, String(v)); localStorage.setItem(getCashBalanceKey(), String(v)); } catch {}\r\n          } else {\r\n            setLocalCashBalance(Number(data?.cashBalance || cashBalance || 0));\r\n          }\r\n        } catch {\r\n          setLocalCashBalance(Number(data?.cashBalance || cashBalance || 0));\r\n        }\r\n      } catch (e) {\r\n        setAckAccessoryToday(0);\r\n        setAckMaintenanceToday(0);\r\n      }\r\n    };\r\n\r\n    if (open) {\r\n      loadAccessorySales();\r\n      loadMaintenanceTotal();\r\n      loadDailyReceipts();\r\n    }\r\n  }, [open, userId, transactions, cashBalance, shopIdCtx]);\r\n\r\n  React.useEffect(() => {\r\n    const handler = (e: any) => {\r\n      try {\r\n        const v = Number(e?.detail?.value);\r\n        if (Number.isFinite(v)) {\r\n          setLocalCashBalance(v);\r\n        }\r\n      } catch {}\r\n    };\r\n    window.addEventListener('cashBalanceChanged', handler as EventListener);\r\n    return () => window.removeEventListener('cashBalanceChanged', handler as EventListener);\r\n  }, [open]);\r\n\r\n  React.useEffect(() => {\r\n    if (!open || !userId) return;\r\n    const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n    //  onSnapshot  getDoc  \r\n    const fetchDashboardData = async () => {\r\n      try {\r\n        const snap = await getDoc(doc(db, 'dashboardData', sid));\r\n        if (snap.exists()) {\r\n          const v = Number((snap.data() as any)?.cashBalance || 0);\r\n          setLocalCashBalance(v);\r\n          try { \r\n            localStorage.setItem(`cashBalance_${userId}`, String(v)); \r\n            localStorage.setItem(getCashBalanceKey(), String(v)); \r\n          } catch {}\r\n        }\r\n      } catch (e) {\r\n        console.warn('Error fetching dashboard data:', e);\r\n      }\r\n    };\r\n    \r\n    fetchDashboardData();\r\n    \r\n    return () => { };\r\n  }, [open, userId, shopIdCtx]);\r\n\r\n  const effectiveAccessoryToday = Math.max(0, Number(accessorySalesToday) - Number(ackAccessoryToday));\r\n  const effectiveMaintenanceToday = Math.max(0, Number(maintenanceTotalToday) - Number(ackMaintenanceToday));\r\n\r\n  const handleReceipt = async (type: 'accessory' | 'maintenance') => {\r\n    if (!userId) return;\r\n    const todayStr = new Date().toISOString().slice(0, 10);\r\n    try {\r\n      const amountToAck = type === 'accessory' ? effectiveAccessoryToday : effectiveMaintenanceToday;\r\n      if (amountToAck <= 0) {\r\n        toast({ title: '    ', variant: 'default' });\r\n        return;\r\n      }\r\n      const newCash = Math.max(0, Number(localCashBalance) - amountToAck);\r\n      setLocalCashBalance(newCash);\r\n      if (type === 'accessory') {\r\n        setAckAccessoryToday(prev => prev + amountToAck);\r\n      } else {\r\n        setAckMaintenanceToday(prev => prev + amountToAck);\r\n      }\r\n      await userDataService.updateUserData(userId, {\r\n        cashBalance: newCash,\r\n        dailyReceipts: {\r\n          date: todayStr,\r\n          accessory: type === 'accessory' ? (ackAccessoryToday + amountToAck) : ackAccessoryToday,\r\n          maintenance: type === 'maintenance' ? (ackMaintenanceToday + amountToAck) : ackMaintenanceToday,\r\n        }\r\n      });\r\n      try {\r\n        const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n        await updateDoc(doc(db, 'dashboardData', sid), { cashBalance: newCash, lastUpdated: new Date().toISOString() } as any);\r\n      } catch { }\r\n      try {\r\n        localStorage.setItem(`cashBalance_${userId}`, String(newCash));\r\n        localStorage.setItem(getCashBalanceKey(), String(newCash));\r\n      } catch {}\r\n      try {\r\n        window.dispatchEvent(new CustomEvent('cashBalanceChanged', { detail: { value: newCash } }));\r\n      } catch {}\r\n      toast({ title: ' ', description: `  ${amountToAck.toFixed(2)}     ${type === 'accessory' ? '' : ''}` });\r\n    } catch (e) {\r\n      toast({ title: '', description: '    ', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  const startDeductionFlow = () => {\r\n    setDeductReason('');\r\n    setDeductAmount('');\r\n    setIsDeductReasonOpen(true);\r\n  };\r\n\r\n  const confirmDeductReason = () => {\r\n    if (!deductReason.trim()) {\r\n      toast({ title: '  ', variant: 'destructive' });\r\n      return;\r\n    }\r\n    setIsDeductReasonOpen(false);\r\n    setIsDeductPinOpen(true);\r\n  };\r\n\r\n  const openDeductAmount = () => {\r\n    setIsDeductPinOpen(false);\r\n    setIsDeductAmountOpen(true);\r\n  };\r\n\r\n  const performDeduction = async () => {\r\n    try {\r\n      if (!userId) return;\r\n      const amt = Math.max(0, Number(deductAmount || 0));\r\n      if (!Number.isFinite(amt) || amt <= 0) {\r\n        toast({ title: '  ', description: '      ', variant: 'destructive' });\r\n        return;\r\n      }\r\n      const newCash = Math.max(0, Number(localCashBalance) - amt);\r\n      setLocalCashBalance(newCash);\r\n      await userDataService.updateUserData(userId, { cashBalance: newCash });\r\n      try {\r\n        const sid = (shopIdCtx || (profile as any)?.shopId || 'main');\r\n        await updateDoc(doc(db, 'dashboardData', sid), { cashBalance: newCash, lastUpdated: new Date().toISOString() } as any);\r\n      } catch { }\r\n      try { localStorage.setItem(`cashBalance_${userId}`, String(newCash)); } catch {}\r\n      try {\r\n        const timestamp = new Date().toISOString();\r\n        localStorage.setItem(getCashBalanceKey(), String(newCash));\r\n        localStorage.setItem(getCashBalanceKey() + '_lastUpdated', timestamp);\r\n      } catch {}\r\n\r\n      const tx = {\r\n        title: '    ',\r\n        type: 'cash_deduction',\r\n        amount: amt,\r\n        status: 'completed',\r\n        createdAt: new Date(),\r\n        note: deductReason,\r\n        cashierName: ' '\r\n      };\r\n      try { await userDataService.saveUserTransaction(userId, tx); } catch {}\r\n\r\n      toast({ title: ' ', description: `  ${amt.toFixed(2)}  ` });\r\n      setIsDeductAmountOpen(false);\r\n      setDeductAmount('');\r\n      setDeductReason('');\r\n    } catch (e) {\r\n      toast({ title: ' ', description: '   ', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-lg animate-in fade-in-90 zoom-in-95 slide-in-from-top-4\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-right\">\r\n            <DollarSign className=\"h-5 w-5 text-emerald-600\" />\r\n              \r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-3\">\r\n          <div className=\"flex items-center justify-between bg-amber-50 border border-amber-200 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-amber-800 font-bold text-sm\">\r\n              <DollarSign className=\"h-4 w-4\" />\r\n                 ()\r\n            </div>\r\n            <div className=\"text-amber-700 font-extrabold text-sm\">\r\n              {formatCurrency(localCashBalance)}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between bg-blue-50 border border-blue-200 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-blue-800 font-bold text-sm\">\r\n              <Package className=\"h-4 w-4\" />\r\n               \r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"text-blue-700 font-extrabold text-sm\">\r\n                {formatCurrency(effectiveAccessoryToday)}\r\n              </div>\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"h-6 px-2 rounded-lg bg-gradient-to-r from-blue-100 to-blue-200 text-blue-700 hover:from-blue-200 hover:to-blue-300 hover:text-blue-800\"\r\n                onClick={() => { setPendingReceiptType('accessory'); setIsReceiptPinOpen(true); }}\r\n              >\r\n                 \r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between bg-emerald-50 border border-emerald-200 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-emerald-800 font-bold text-sm\">\r\n              <ArrowRightLeft className=\"h-4 w-4\" />\r\n               \r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"text-emerald-700 font-extrabold text-sm\">\r\n                {formatCurrency(effectiveMaintenanceToday)}\r\n              </div>\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"h-6 px-2 rounded-lg bg-gradient-to-r from-emerald-100 to-emerald-200 text-emerald-700 hover:from-emerald-200 hover:to-emerald-300 hover:text-emerald-800\"\r\n                onClick={() => { setPendingReceiptType('maintenance'); setIsReceiptPinOpen(true); }}\r\n              >\r\n                 \r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          \r\n\r\n          <div className=\"flex items-center justify-between bg-red-50 border border-red-200 rounded-lg p-2\">\r\n            <div className=\"flex items-center gap-2 text-red-800 font-bold text-sm\">\r\n                  \r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"h-6 px-2 rounded-lg bg-gradient-to-r from-red-100 to-red-200 text-red-700 hover:from-red-200 hover:to-red-300 hover:text-red-800\"\r\n                onClick={startDeductionFlow}\r\n              >\r\n                \r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/*       */}\r\n        <MasterPinDialog\r\n          open={isReceiptPinOpen}\r\n          onOpenChange={setIsReceiptPinOpen}\r\n          mode=\"verify\"\r\n          title=\"     \"\r\n          description=\"       \" \r\n          onSuccess={() => {\r\n            if (pendingReceiptType) {\r\n              handleReceipt(pendingReceiptType);\r\n              setPendingReceiptType(null);\r\n            }\r\n            setIsReceiptPinOpen(false);\r\n          }}\r\n        />\r\n\r\n        <Dialog open={isDeductReasonOpen} onOpenChange={setIsDeductReasonOpen}>\r\n          <DialogContent className=\"sm:max-w-sm\">\r\n            <DialogHeader>\r\n              <DialogTitle> </DialogTitle>\r\n            </DialogHeader>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"deduct-reason\">  </Label>\r\n              <Input id=\"deduct-reason\" value={deductReason} onChange={(e) => setDeductReason(e.target.value)} placeholder=\" \" />\r\n            </div>\r\n            <div className=\"flex justify-end gap-2 mt-3\">\r\n              <Button variant=\"outline\" onClick={() => setIsDeductReasonOpen(false)}></Button>\r\n              <Button onClick={confirmDeductReason} className=\"bg-red-600 hover:bg-red-700\"></Button>\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n\r\n        <MasterPinDialog\r\n          open={isDeductPinOpen}\r\n          onOpenChange={setIsDeductPinOpen}\r\n          mode=\"verify\"\r\n          title=\"    \"\r\n          description=\"      \"\r\n          onSuccess={openDeductAmount}\r\n        />\r\n\r\n        <Dialog open={isDeductAmountOpen} onOpenChange={setIsDeductAmountOpen}>\r\n          <DialogContent className=\"sm:max-w-sm\">\r\n            <DialogHeader>\r\n              <DialogTitle> </DialogTitle>\r\n            </DialogHeader>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"deduct-amount\">  </Label>\r\n              <Input id=\"deduct-amount\" type=\"number\" value={deductAmount} onChange={(e) => setDeductAmount(e.target.value)} placeholder=\"0.00\" />\r\n            </div>\r\n            <div className=\"flex justify-end gap-2 mt-3\">\r\n              <Button variant=\"outline\" onClick={() => setIsDeductAmountOpen(false)}></Button>\r\n              <Button onClick={performDeduction} className=\"bg-red-600 hover:bg-red-700\"> </Button>\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default CashSummaryDialog;\r\n","import React from 'react';\r\n\r\nexport interface FawryMachineIconProps extends React.SVGProps<SVGSVGElement> {\r\n  size?: number;\r\n}\r\n\r\n//    (POS) -   currentColor  \r\nexport default function FawryMachineIcon({ size = 24, className, ...props }: FawryMachineIconProps) {\r\n  return (\r\n    <svg\r\n      width={size}\r\n      height={size}\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      className={className}\r\n      {...props}\r\n    >\r\n      {/*   */}\r\n      <rect x=\"5\" y=\"2.5\" width=\"14\" height=\"19\" rx=\"2.5\" stroke=\"currentColor\" strokeWidth=\"1.5\" />\r\n      {/*  */}\r\n      <rect x=\"7\" y=\"4.5\" width=\"10\" height=\"5.5\" rx=\"1\" stroke=\"currentColor\" strokeWidth=\"1.2\" />\r\n      {/*   */}\r\n      <path d=\"M9.5 11.5h5\" stroke=\"currentColor\" strokeWidth=\"1.4\" strokeLinecap=\"round\" />\r\n      {/*   (3x3) */}\r\n      <circle cx=\"8.5\" cy=\"14\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n      <circle cx=\"12\" cy=\"14\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n      <circle cx=\"15.5\" cy=\"14\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n\r\n      <circle cx=\"8.5\" cy=\"17\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n      <circle cx=\"12\" cy=\"17\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n      <circle cx=\"15.5\" cy=\"17\" r=\"0.9\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n\r\n      {/*    */}\r\n      <rect x=\"8\" y=\"19\" width=\"9\" height=\"1.8\" rx=\"0.6\" stroke=\"currentColor\" strokeWidth=\"1\" />\r\n    </svg>\r\n  );\r\n}","\"use client\";\n\n// src/alert-dialog.tsx\nimport * as React from \"react\";\nimport { createContextScope } from \"@radix-ui/react-context\";\nimport { useComposedRefs } from \"@radix-ui/react-compose-refs\";\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\";\nimport { createDialogScope } from \"@radix-ui/react-dialog\";\nimport { composeEventHandlers } from \"@radix-ui/primitive\";\nimport { createSlottable } from \"@radix-ui/react-slot\";\nimport { jsx, jsxs } from \"react/jsx-runtime\";\nvar ROOT_NAME = \"AlertDialog\";\nvar [createAlertDialogContext, createAlertDialogScope] = createContextScope(ROOT_NAME, [\n  createDialogScope\n]);\nvar useDialogScope = createDialogScope();\nvar AlertDialog = (props) => {\n  const { __scopeAlertDialog, ...alertDialogProps } = props;\n  const dialogScope = useDialogScope(__scopeAlertDialog);\n  return /* @__PURE__ */ jsx(DialogPrimitive.Root, { ...dialogScope, ...alertDialogProps, modal: true });\n};\nAlertDialog.displayName = ROOT_NAME;\nvar TRIGGER_NAME = \"AlertDialogTrigger\";\nvar AlertDialogTrigger = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...triggerProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Trigger, { ...dialogScope, ...triggerProps, ref: forwardedRef });\n  }\n);\nAlertDialogTrigger.displayName = TRIGGER_NAME;\nvar PORTAL_NAME = \"AlertDialogPortal\";\nvar AlertDialogPortal = (props) => {\n  const { __scopeAlertDialog, ...portalProps } = props;\n  const dialogScope = useDialogScope(__scopeAlertDialog);\n  return /* @__PURE__ */ jsx(DialogPrimitive.Portal, { ...dialogScope, ...portalProps });\n};\nAlertDialogPortal.displayName = PORTAL_NAME;\nvar OVERLAY_NAME = \"AlertDialogOverlay\";\nvar AlertDialogOverlay = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...overlayProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Overlay, { ...dialogScope, ...overlayProps, ref: forwardedRef });\n  }\n);\nAlertDialogOverlay.displayName = OVERLAY_NAME;\nvar CONTENT_NAME = \"AlertDialogContent\";\nvar [AlertDialogContentProvider, useAlertDialogContentContext] = createAlertDialogContext(CONTENT_NAME);\nvar Slottable = createSlottable(\"AlertDialogContent\");\nvar AlertDialogContent = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, children, ...contentProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    const contentRef = React.useRef(null);\n    const composedRefs = useComposedRefs(forwardedRef, contentRef);\n    const cancelRef = React.useRef(null);\n    return /* @__PURE__ */ jsx(\n      DialogPrimitive.WarningProvider,\n      {\n        contentName: CONTENT_NAME,\n        titleName: TITLE_NAME,\n        docsSlug: \"alert-dialog\",\n        children: /* @__PURE__ */ jsx(AlertDialogContentProvider, { scope: __scopeAlertDialog, cancelRef, children: /* @__PURE__ */ jsxs(\n          DialogPrimitive.Content,\n          {\n            role: \"alertdialog\",\n            ...dialogScope,\n            ...contentProps,\n            ref: composedRefs,\n            onOpenAutoFocus: composeEventHandlers(contentProps.onOpenAutoFocus, (event) => {\n              event.preventDefault();\n              cancelRef.current?.focus({ preventScroll: true });\n            }),\n            onPointerDownOutside: (event) => event.preventDefault(),\n            onInteractOutside: (event) => event.preventDefault(),\n            children: [\n              /* @__PURE__ */ jsx(Slottable, { children }),\n              /* @__PURE__ */ jsx(DescriptionWarning, { contentRef })\n            ]\n          }\n        ) })\n      }\n    );\n  }\n);\nAlertDialogContent.displayName = CONTENT_NAME;\nvar TITLE_NAME = \"AlertDialogTitle\";\nvar AlertDialogTitle = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...titleProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Title, { ...dialogScope, ...titleProps, ref: forwardedRef });\n  }\n);\nAlertDialogTitle.displayName = TITLE_NAME;\nvar DESCRIPTION_NAME = \"AlertDialogDescription\";\nvar AlertDialogDescription = React.forwardRef((props, forwardedRef) => {\n  const { __scopeAlertDialog, ...descriptionProps } = props;\n  const dialogScope = useDialogScope(__scopeAlertDialog);\n  return /* @__PURE__ */ jsx(DialogPrimitive.Description, { ...dialogScope, ...descriptionProps, ref: forwardedRef });\n});\nAlertDialogDescription.displayName = DESCRIPTION_NAME;\nvar ACTION_NAME = \"AlertDialogAction\";\nvar AlertDialogAction = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...actionProps } = props;\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Close, { ...dialogScope, ...actionProps, ref: forwardedRef });\n  }\n);\nAlertDialogAction.displayName = ACTION_NAME;\nvar CANCEL_NAME = \"AlertDialogCancel\";\nvar AlertDialogCancel = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAlertDialog, ...cancelProps } = props;\n    const { cancelRef } = useAlertDialogContentContext(CANCEL_NAME, __scopeAlertDialog);\n    const dialogScope = useDialogScope(__scopeAlertDialog);\n    const ref = useComposedRefs(forwardedRef, cancelRef);\n    return /* @__PURE__ */ jsx(DialogPrimitive.Close, { ...dialogScope, ...cancelProps, ref });\n  }\n);\nAlertDialogCancel.displayName = CANCEL_NAME;\nvar DescriptionWarning = ({ contentRef }) => {\n  const MESSAGE = `\\`${CONTENT_NAME}\\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \\`${CONTENT_NAME}\\` by passing a \\`${DESCRIPTION_NAME}\\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \\`id\\` and passing the same value to the \\`aria-describedby\\` prop in \\`${CONTENT_NAME}\\`. If the description is confusing or duplicative for sighted users, you can use the \\`@radix-ui/react-visually-hidden\\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;\n  React.useEffect(() => {\n    const hasDescription = document.getElementById(\n      contentRef.current?.getAttribute(\"aria-describedby\")\n    );\n    if (!hasDescription) console.warn(MESSAGE);\n  }, [MESSAGE, contentRef]);\n  return null;\n};\nvar Root2 = AlertDialog;\nvar Trigger2 = AlertDialogTrigger;\nvar Portal2 = AlertDialogPortal;\nvar Overlay2 = AlertDialogOverlay;\nvar Content2 = AlertDialogContent;\nvar Action = AlertDialogAction;\nvar Cancel = AlertDialogCancel;\nvar Title2 = AlertDialogTitle;\nvar Description2 = AlertDialogDescription;\nexport {\n  Action,\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogOverlay,\n  AlertDialogPortal,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n  Cancel,\n  Content2 as Content,\n  Description2 as Description,\n  Overlay2 as Overlay,\n  Portal2 as Portal,\n  Root2 as Root,\n  Title2 as Title,\n  Trigger2 as Trigger,\n  createAlertDialogScope\n};\n//# sourceMappingURL=index.mjs.map\n","import * as React from \"react\"\r\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\nimport { buttonVariants } from \"@/components/ui/button\"\r\n\r\nconst AlertDialog = AlertDialogPrimitive.Root\r\n\r\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\r\n\r\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\r\n\r\nconst AlertDialogOverlay = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Overlay\r\n    className={cn(\r\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\r\n      className\r\n    )}\r\n    {...props}\r\n    ref={ref}\r\n  />\r\n))\r\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\r\n\r\nconst AlertDialogContent = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPortal>\r\n    <AlertDialogOverlay />\r\n    <AlertDialogPrimitive.Content\r\n      ref={ref}\r\n      className={cn(\r\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg rounded-2xl duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  </AlertDialogPortal>\r\n))\r\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\r\n\r\nconst AlertDialogHeader = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) => (\r\n  <div\r\n    className={cn(\r\n      \"flex flex-col space-y-2 text-center sm:text-left\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n)\r\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\r\n\r\nconst AlertDialogFooter = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) => (\r\n  <div\r\n    className={cn(\r\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n)\r\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\r\n\r\nconst AlertDialogTitle = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Title\r\n    ref={ref}\r\n    className={cn(\"text-lg font-semibold\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\r\n\r\nconst AlertDialogDescription = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Description\r\n    ref={ref}\r\n    className={cn(\"text-sm text-muted-foreground\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogDescription.displayName =\r\n  AlertDialogPrimitive.Description.displayName\r\n\r\nconst AlertDialogAction = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Action\r\n    ref={ref}\r\n    className={cn(buttonVariants(), className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\r\n\r\nconst AlertDialogCancel = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Cancel\r\n    ref={ref}\r\n    className={cn(\r\n      buttonVariants({ variant: \"outline\" }),\r\n      \"mt-2 sm:mt-0\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\r\n\r\nexport {\r\n  AlertDialog,\r\n  AlertDialogPortal,\r\n  AlertDialogOverlay,\r\n  AlertDialogTrigger,\r\n  AlertDialogContent,\r\n  AlertDialogHeader,\r\n  AlertDialogFooter,\r\n  AlertDialogTitle,\r\n  AlertDialogDescription,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n}\r\n","import React, { useEffect, useMemo, useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from '@/components/ui/dialog';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { Receipt, Calendar, Clock, ChevronDown, Trash2, RefreshCcw } from 'lucide-react';\r\nimport FawryMachineIcon from '@/components/icons/FawryMachineIcon';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useShift } from '@/contexts/ShiftContext';\r\nimport { AlertDialog, AlertDialogContent, AlertDialogHeader, AlertDialogTitle, AlertDialogDescription, AlertDialogAction, AlertDialogCancel } from '@/components/ui/alert-dialog';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { db } from '@/firebase';\r\nimport { addDoc, collection, doc, setDoc, serverTimestamp, deleteDoc, getDocs, orderBy, query } from 'firebase/firestore';\r\nimport { useShop } from '@/hooks/useShop';\r\n\r\ninterface MachineDailyDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\ninterface MachineReceipt {\r\n  id: string;\r\n  openingBase: number; //   \r\n  openingAir: number;  //   \r\n  deliveryBase: number; //    \r\n  deliveryAir: number;  //    \r\n  netResult: number;    //  : () - ()\r\n  createdAt: string;    //  \r\n  cashierName?: string; //    \r\n  requiredDrawerNoProfit?: number; //     \r\n}\r\n\r\ninterface TransferReceipt {\r\n  id: string;\r\n  wholesalePrice: number; //    \r\n  retailPrice: number;    //    \r\n  profit: number;         //  :  - \r\n  createdAt: string;\r\n  cashierName?: string;\r\n  deductFrom?: 'base' | 'air'; //  :   \r\n}\r\n\r\nconst formatNumber = (n: number) => {\r\n  try { return n.toLocaleString('en-US', { maximumFractionDigits: 2 }); } catch { return String(n); }\r\n};\r\n\r\nconst formatDateTime = (iso?: string) => {\r\n  try {\r\n    const d = iso ? new Date(iso) : new Date();\r\n    return d.toLocaleString('en-GB', {\r\n      year: 'numeric', month: '2-digit', day: '2-digit',\r\n      hour: '2-digit', minute: '2-digit', second: '2-digit',\r\n      hour12: false,\r\n    });\r\n  } catch {\r\n    return new Date().toISOString();\r\n  }\r\n};\r\n\r\n//         \r\nconst STORAGE_KEY_OPENING = 'machine_daily_opening_values';\r\nconst STORAGE_KEY_OPENING_SNAPSHOT = 'machine_daily_opening_snapshot';\r\n\r\nexport default function MachineDailyDialog({ open, onOpenChange }: MachineDailyDialogProps) {\r\n  const { toast } = useToast();\r\n  const { shiftUser } = useShift();\r\n  const { shopId, shopName } = useShop();\r\n  const getFallbackShopId = () => {\r\n    try {\r\n      const keys = Object.keys(localStorage || {}).filter(k => k.startsWith('selectedShopId_'));\r\n      for (const k of keys) {\r\n        const v = localStorage.getItem(k);\r\n        if (v) return v;\r\n      }\r\n      return null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  //           \r\n  useEffect(() => {\r\n    try {\r\n      if (open) {\r\n        const prev = document.body.style.overflow;\r\n        document.body.setAttribute('data-prev-overflow', prev);\r\n        document.body.style.overflow = 'hidden';\r\n      } else {\r\n        const prev = document.body.getAttribute('data-prev-overflow') || '';\r\n        document.body.style.overflow = prev;\r\n        document.body.removeAttribute('data-prev-overflow');\r\n      }\r\n    } catch {}\r\n    return () => {\r\n      try {\r\n        const prev = document.body.getAttribute('data-prev-overflow') || '';\r\n        document.body.style.overflow = prev;\r\n        document.body.removeAttribute('data-prev-overflow');\r\n      } catch {}\r\n    };\r\n  }, [open]);\r\n\r\n  //   \r\n  const [openingBase, setOpeningBase] = useState<string>('');\r\n  const [openingAir, setOpeningAir] = useState<string>('');\r\n  const [drawerCash, setDrawerCash] = useState<string>('');\r\n\r\n  //    \r\n  const [savedOpeningBase, setSavedOpeningBase] = useState<number | null>(null);\r\n  const [savedOpeningAir, setSavedOpeningAir] = useState<number | null>(null);\r\n  const [savedDrawerCash, setSavedDrawerCash] = useState<number | null>(null);\r\n  const [openingSnapshot, setOpeningSnapshot] = useState<{ openingBase: number; openingAir: number; drawerCash: number } | null>(null);\r\n\r\n  // /   \r\n  const [isOpeningOpen, setIsOpeningOpen] = useState(false);\r\n\r\n  //   \r\n  const [isDeliverySectionOpen, setIsDeliverySectionOpen] = useState(false);\r\n  const [deliveryBase, setDeliveryBase] = useState<string>('');\r\n  const [deliveryAir, setDeliveryAir] = useState<string>('');\r\n  const [netResult, setNetResult] = useState<number | null>(null);\r\n\r\n  //    (  )\r\n  const [receipts, setReceipts] = useState<MachineReceipt[]>([]);\r\n\r\n  //    (  )\r\n  const [transferReceipts, setTransferReceipts] = useState<TransferReceipt[]>([]);\r\n\r\n  //     /\r\n  const [transferDialogOpen, setTransferDialogOpen] = useState(false);\r\n  const [wholesalePrice, setWholesalePrice] = useState<string>('');\r\n  const [retailPrice, setRetailPrice] = useState<string>('');\r\n\r\n  //      \r\n  const [deductDialogOpen, setDeductDialogOpen] = useState(false);\r\n  const [pendingTransfer, setPendingTransfer] = useState<{\r\n    wholesalePrice: number;\r\n    retailPrice: number;\r\n    profit: number;\r\n  } | null>(null);\r\n\r\n  //   (/)\r\n  const [machines, setMachines] = useState<{ id: string; name: string }[]>([]);\r\n  const [selectedMachineId, setSelectedMachineId] = useState<string | null>(null);\r\n  const [newMachineName, setNewMachineName] = useState<string>('');\r\n  const [transferServerHydrated, setTransferServerHydrated] = useState(false);\r\n  const [deliveriesServerHydrated, setDeliveriesServerHydrated] = useState(false);\r\n\r\n  // Hydrate per-machine opening values when dialog opens or machine changes\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    try {\r\n      const keyOpening = selectedMachineId ? `${STORAGE_KEY_OPENING}_${selectedMachineId}` : STORAGE_KEY_OPENING;\r\n      const keySnap = selectedMachineId ? `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}` : STORAGE_KEY_OPENING_SNAPSHOT;\r\n      const savedOpening = localStorage.getItem(keyOpening);\r\n      if (savedOpening) {\r\n        const obj = JSON.parse(savedOpening);\r\n        if (typeof obj?.openingBase === 'number') setSavedOpeningBase(obj.openingBase);\r\n        if (typeof obj?.openingAir === 'number') setSavedOpeningAir(obj.openingAir);\r\n        if (typeof obj?.drawerCash === 'number') setSavedDrawerCash(obj.drawerCash);\r\n      } else {\r\n        setSavedOpeningBase(null);\r\n        setSavedOpeningAir(null);\r\n        setSavedDrawerCash(null);\r\n      }\r\n\r\n      const savedSnap = localStorage.getItem(keySnap);\r\n      if (savedSnap) {\r\n        const snap = JSON.parse(savedSnap);\r\n        if (typeof snap?.openingBase === 'number' && typeof snap?.openingAir === 'number') {\r\n          setOpeningSnapshot({ openingBase: snap.openingBase, openingAir: snap.openingAir, drawerCash: snap.drawerCash || 0 });\r\n        } else {\r\n          setOpeningSnapshot(null);\r\n        }\r\n      } else {\r\n        setOpeningSnapshot(null);\r\n      }\r\n    } catch {}\r\n  }, [open, selectedMachineId]);\r\n\r\n  //      \r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const sid = shopId || getFallbackShopId();\r\n        if (!open || !sid) return;\r\n        const { getDocs } = await import('firebase/firestore');\r\n        const col = collection(db, 'shops', sid, 'machines');\r\n        const snap = await getDocs(query(col));\r\n        const list = snap.docs.map(d => ({ id: d.id, name: String(d.data().name || '') }));\r\n        setMachines(list);\r\n        try {\r\n          const savedId = localStorage.getItem(`machineDaily_selected_${sid}`);\r\n          const exists = savedId && list.some(m => m.id === savedId);\r\n          if (exists) {\r\n            setSelectedMachineId(savedId as string);\r\n          } else if (!selectedMachineId && list.length > 0) {\r\n            setSelectedMachineId(list[0].id);\r\n            localStorage.setItem(`machineDaily_selected_${sid}`, list[0].id);\r\n          }\r\n        } catch {}\r\n      } catch (err) {\r\n        console.error('Load machines error:', err);\r\n      }\r\n    })();\r\n  }, [open, shopId]);\r\n\r\n  //       \r\n\r\n  const cashierName = useMemo(() => {\r\n    return shiftUser?.displayName || shiftUser?.name || shiftUser?.username || undefined;\r\n  }, [shiftUser]);\r\n\r\n  const totalTransferProfit = useMemo(() => transferReceipts.reduce((sum, t) => sum + (t.profit || 0), 0), [transferReceipts]);\r\n  const totalWholesaleTransferred = useMemo(() => transferReceipts.reduce((sum, t) => sum + (t.wholesalePrice || 0), 0), [transferReceipts]);\r\n\r\n  const handleClearTransferReceipts = async () => {\r\n    try {\r\n      const sid = shopId || getFallbackShopId();\r\n      if (sid && selectedMachineId) {\r\n        const col = collection(db, 'shops', sid, 'machines', selectedMachineId, 'transfers');\r\n        const snap = await getDocs(query(col));\r\n        await Promise.all(snap.docs.map(d => deleteDoc(d.ref)));\r\n        try { localStorage.setItem(`machineDaily_transfers_${sid}_${selectedMachineId}`, JSON.stringify([])); } catch {}\r\n      }\r\n    } catch {}\r\n    setTransferReceipts([]);\r\n    toast({ title: '  ', description: '    .' });\r\n  };\r\n\r\n  const handleClearMachineReceipts = async () => {\r\n    try {\r\n      const sid = shopId || getFallbackShopId();\r\n      if (sid && selectedMachineId) {\r\n        const col = collection(db, 'shops', sid, 'machines', selectedMachineId, 'deliveries');\r\n        const snap = await getDocs(query(col));\r\n        await Promise.all(snap.docs.map(d => deleteDoc(d.ref)));\r\n        try { localStorage.setItem(`machineDaily_deliveries_${sid}_${selectedMachineId}`, JSON.stringify([])); } catch {}\r\n      }\r\n    } catch {}\r\n    setReceipts([]);\r\n    toast({ title: '  ', description: '    .' });\r\n  };\r\n\r\n  const handleDeleteMachineReceipt = (id: string) => {\r\n    setReceipts(prev => prev.filter(r => r.id !== id));\r\n    toast({ title: '  ', description: '    .' });\r\n  };\r\n\r\n  //     \r\n  const handleResetOpening = () => {\r\n    setSavedOpeningBase(null);\r\n    setSavedOpeningAir(null);\r\n    setSavedDrawerCash(null);\r\n    setOpeningSnapshot(null);\r\n  \r\n    setOpeningBase('');\r\n    setOpeningAir('');\r\n    setDrawerCash('');\r\n  \r\n    try {\r\n      const keyOpening = selectedMachineId ? `${STORAGE_KEY_OPENING}_${selectedMachineId}` : STORAGE_KEY_OPENING;\r\n      const keySnap = selectedMachineId ? `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}` : STORAGE_KEY_OPENING_SNAPSHOT;\r\n      localStorage.removeItem(keyOpening);\r\n      localStorage.removeItem(keySnap);\r\n    } catch {}\r\n  \r\n    toast({ title: ' ', description: '     .' });\r\n  };\r\n  const handleAddOpening = async () => {\r\n    const base = parseFloat(openingBase || '0');\r\n    const air = parseFloat(openingAir || '0');\r\n    const dc = parseFloat(drawerCash || '0');\r\n\r\n    if (isNaN(base) || isNaN(air) || isNaN(dc)) {\r\n      toast({ title: '  ', description: '       .', variant: 'destructive' });\r\n      return;\r\n    }\r\n    if (base < 0 || air < 0 || dc < 0) {\r\n      toast({ title: ' ', description: '    .', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    setSavedOpeningBase(base);\r\n    setSavedOpeningAir(air);\r\n    setSavedDrawerCash(dc);\r\n    try {\r\n      const keyOpening = selectedMachineId ? `${STORAGE_KEY_OPENING}_${selectedMachineId}` : STORAGE_KEY_OPENING;\r\n      const keySnap = selectedMachineId ? `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}` : STORAGE_KEY_OPENING_SNAPSHOT;\r\n      localStorage.setItem(keyOpening, JSON.stringify({ openingBase: base, openingAir: air, drawerCash: dc }));\r\n      localStorage.setItem(keySnap, JSON.stringify({ openingBase: base, openingAir: air, drawerCash: dc }));\r\n      setOpeningSnapshot({ openingBase: base, openingAir: air, drawerCash: dc });\r\n      //   Firestore   \r\n      const sid0 = shopId || getFallbackShopId();\r\n      if (sid0 && selectedMachineId) {\r\n        const ref = doc(db, 'shops', sid0, 'machines', selectedMachineId);\r\n        await setDoc(ref, {\r\n          name: machines.find(m => m.id === selectedMachineId)?.name || '',\r\n          openingBase: base,\r\n          openingAir: air,\r\n          drawerCash: dc,\r\n          cashierName,\r\n          shopName: shopName || null,\r\n          updatedAt: serverTimestamp(),\r\n        }, { merge: true });\r\n      }\r\n    } catch {}\r\n\r\n    toast({ title: '  ', description: ` : ${formatNumber(base)} : ${formatNumber(air)}  : ${formatNumber(dc)}` });\r\n  };\r\n\r\n  const handleStartDelivery = () => {\r\n    if (savedOpeningBase == null || savedOpeningAir == null) {\r\n      toast({ title: '   ', description: '    \"\"   .' });\r\n      return;\r\n    }\r\n    setIsDeliverySectionOpen(true);\r\n  };\r\n\r\n  const handleDoDelivery = () => {\r\n    const dBase = parseFloat(deliveryBase || '0');\r\n    const dAir = parseFloat(deliveryAir || '0');\r\n\r\n    if (isNaN(dBase) || isNaN(dAir)) {\r\n      toast({ title: '  ', description: '     .', variant: 'destructive' });\r\n      return;\r\n    }\r\n    if (dBase < 0 || dAir < 0) {\r\n      toast({ title: ' ', description: '    .', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    const openingBaseForReceipt = openingSnapshot?.openingBase ?? (savedOpeningBase || 0);\r\n    const openingAirForReceipt = openingSnapshot?.openingAir ?? (savedOpeningAir || 0);\r\n\r\n    const openingSum = (openingBaseForReceipt) + (openingAirForReceipt);\r\n    const deliverySum = dBase + dAir;\r\n    const result = deliverySum - openingSum;\r\n\r\n    setNetResult(result);\r\n\r\n    const receipt: MachineReceipt = {\r\n      id: `${Date.now()}`,\r\n      openingBase: openingBaseForReceipt,\r\n      openingAir: openingAirForReceipt,\r\n      deliveryBase: dBase,\r\n      deliveryAir: dAir,\r\n      netResult: result,\r\n      createdAt: new Date().toISOString(),\r\n      cashierName,\r\n      requiredDrawerNoProfit: result < 0 ? Math.round(-result * 100) / 100 : 0,\r\n    };\r\n\r\n    //    Firestore   \r\n    void (async () => {\r\n      try {\r\n        const sid1 = shopId || getFallbackShopId();\r\n        if (sid1 && selectedMachineId) {\r\n          await addDoc(collection(db, 'shops', sid1, 'machines', selectedMachineId, 'deliveries'), {\r\n            cashierName,\r\n            openingBase: openingBaseForReceipt,\r\n            openingAir: openingAirForReceipt,\r\n            deliveryBase: dBase,\r\n            deliveryAir: dAir,\r\n            netResult: result,\r\n            createdAt: serverTimestamp(),\r\n          });\r\n          await setDoc(doc(db, 'shops', sid1, 'machines', selectedMachineId), {\r\n            lastDeliveryAt: serverTimestamp(),\r\n            updatedAt: serverTimestamp(),\r\n          }, { merge: true });\r\n        }\r\n      } catch (err) {\r\n        console.error('Persist delivery error:', err);\r\n      }\r\n    })();\r\n\r\n    setReceipts((prev) => [receipt, ...prev]);\r\n    try {\r\n      const sid = shopId || getFallbackShopId();\r\n      const key = sid && selectedMachineId ? `machineDaily_deliveries_${sid}_${selectedMachineId}` : `machineDaily_deliveries_${selectedMachineId}`;\r\n      const current = localStorage.getItem(key);\r\n      const arr = current ? JSON.parse(current) : [];\r\n      const next = [receipt, ...(Array.isArray(arr) ? arr : [])];\r\n      localStorage.setItem(key, JSON.stringify(next));\r\n    } catch {}\r\n\r\n    toast({ title: '   ', description: ` : ${formatNumber(result)}` });\r\n  };\r\n\r\n  const handleTransferConfirm = () => {\r\n    const w = parseFloat(wholesalePrice || '0');\r\n    const r = parseFloat(retailPrice || '0');\r\n    if (!Number.isFinite(w) || !Number.isFinite(r)) {\r\n      toast({ title: '  ', description: '       .', variant: 'destructive' });\r\n      return;\r\n    }\r\n    if (w < 0 || r < 0) {\r\n      toast({ title: ' ', description: '    .', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    if (savedOpeningBase == null || savedOpeningAir == null) {\r\n      toast({ title: '   ', description: '        \"\".' });\r\n      return;\r\n    }\r\n\r\n    const profit = Math.round((r - w) * 100) / 100;\r\n    setPendingTransfer({ wholesalePrice: w, retailPrice: r, profit });\r\n    setDeductDialogOpen(true);\r\n  };\r\n\r\n  const finalizeTransfer = async (from: 'base' | 'air') => {\r\n    if (!pendingTransfer) return;\r\n    const receipt: TransferReceipt = {\r\n      id: `transfer_${Date.now()}`,\r\n      wholesalePrice: pendingTransfer.wholesalePrice,\r\n      retailPrice: pendingTransfer.retailPrice,\r\n      profit: pendingTransfer.profit,\r\n      createdAt: new Date().toISOString(),\r\n      cashierName,\r\n      deductFrom: from,\r\n    };\r\n\r\n    //     \r\n    const stockDeductAmount = pendingTransfer.wholesalePrice; //     \r\n    const prevBase = savedOpeningBase ?? 0;\r\n    const prevAir = savedOpeningAir ?? 0;\r\n    const prevDrawer = savedDrawerCash ?? 0;\r\n\r\n    //      \r\n    const availableStock = from === 'base' ? prevBase : prevAir;\r\n    if (stockDeductAmount > availableStock) {\r\n      toast({ title: '  ', description: '      .', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    const newBase = from === 'base' ? Math.round((prevBase - stockDeductAmount) * 100) / 100 : prevBase;\r\n    const newAir = from === 'air' ? Math.round((prevAir - stockDeductAmount) * 100) / 100 : prevAir;\r\n    const totalDrawerAdded = pendingTransfer.retailPrice;\r\n    const newDrawer = Math.round((prevDrawer + totalDrawerAdded) * 100) / 100;\r\n\r\n    setSavedOpeningBase(newBase);\r\n    setSavedOpeningAir(newAir);\r\n    setSavedDrawerCash(newDrawer);\r\n    try {\r\n      const keyOpening = selectedMachineId ? `${STORAGE_KEY_OPENING}_${selectedMachineId}` : STORAGE_KEY_OPENING;\r\n      const keySnap = selectedMachineId ? `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}` : STORAGE_KEY_OPENING_SNAPSHOT;\r\n      localStorage.setItem(keyOpening, JSON.stringify({ openingBase: newBase, openingAir: newAir, drawerCash: newDrawer }));\r\n      localStorage.setItem(keySnap, JSON.stringify({ openingBase: newBase, openingAir: newAir, drawerCash: newDrawer }));\r\n      //    Firestore +   \r\n      const sid2 = shopId || getFallbackShopId();\r\n      if (sid2 && selectedMachineId) {\r\n        const machineRef = doc(db, 'shops', sid2, 'machines', selectedMachineId);\r\n        await setDoc(machineRef, {\r\n          openingBase: newBase,\r\n          openingAir: newAir,\r\n          drawerCash: newDrawer,\r\n          cashierName,\r\n          updatedAt: serverTimestamp(),\r\n        }, { merge: true });\r\n        await addDoc(collection(db, 'shops', sid2, 'machines', selectedMachineId, 'transfers'), {\r\n          wholesalePrice: pendingTransfer.wholesalePrice,\r\n          retailPrice: pendingTransfer.retailPrice,\r\n          profit: pendingTransfer.profit,\r\n          deductFrom: from,\r\n          cashierName,\r\n          createdAt: serverTimestamp(),\r\n        });\r\n      }\r\n    } catch {}\r\n\r\n    setTransferReceipts(prev => [receipt, ...prev]);\r\n    try {\r\n      const sidKey = shopId || getFallbackShopId();\r\n      const key = sidKey && selectedMachineId ? `machineDaily_transfers_${sidKey}_${selectedMachineId}` : 'machineDaily_transfers';\r\n      const current = localStorage.getItem(key);\r\n      const arr = current ? JSON.parse(current) : [];\r\n      const next = [receipt, ...(Array.isArray(arr) ? arr : [])];\r\n      localStorage.setItem(key, JSON.stringify(next));\r\n    } catch {}\r\n    setTransferDialogOpen(false);\r\n    setWholesalePrice('');\r\n    setRetailPrice('');\r\n    setPendingTransfer(null);\r\n    setDeductDialogOpen(false);\r\n    toast({ title: '  ', description: ` : ${formatNumber(receipt.profit)} |  : -${formatNumber(stockDeductAmount)} (${from === 'base' ? '' : ''}) |  ( ): +${formatNumber(totalDrawerAdded)}` });\r\n  };\r\n\r\n  const resetDialogState = () => {\r\n    setOpeningBase('');\r\n    setOpeningAir('');\r\n    setIsDeliverySectionOpen(false);\r\n    setDeliveryBase('');\r\n    setDeliveryAir('');\r\n    setNetResult(null);\r\n  };\r\n\r\n\r\n  const refreshMachineData = async () => {\r\n    if (!open || !selectedMachineId) return;\r\n    const sid = shopId || getFallbackShopId();\r\n    if (!sid) return;\r\n\r\n    // Fetch Deliveries\r\n    try {\r\n      const col = collection(db, 'shops', sid, 'machines', selectedMachineId, 'deliveries');\r\n      const snap = await getDocs(query(col));\r\n      const list: MachineReceipt[] = snap.docs.map((d) => {\r\n        const x: any = d.data();\r\n        const created = x?.createdAt?.toDate?.() ? x.createdAt.toDate() : new Date();\r\n        return {\r\n          id: d.id,\r\n          openingBase: Number(x?.openingBase || 0),\r\n          openingAir: Number(x?.openingAir || 0),\r\n          deliveryBase: Number(x?.deliveryBase || 0),\r\n          deliveryAir: Number(x?.deliveryAir || 0),\r\n          netResult: typeof x?.netResult === 'number'\r\n            ? Number(x.netResult)\r\n            : Math.round(((Number(x?.deliveryBase || 0) + Number(x?.deliveryAir || 0)) - (Number(x?.openingBase || 0) + Number(x?.openingAir || 0))) * 100) / 100,\r\n          createdAt: created.toISOString(),\r\n          cashierName: x?.cashierName || undefined,\r\n          requiredDrawerNoProfit: typeof x?.requiredDrawerNoProfit === 'number' ? x.requiredDrawerNoProfit : undefined,\r\n        } as MachineReceipt;\r\n      });\r\n      const sorted = [...list].sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n      setReceipts(sorted);\r\n      try { localStorage.setItem(`machineDaily_deliveries_${sid}_${selectedMachineId}`, JSON.stringify(sorted)); } catch {}\r\n    } catch (e) {\r\n      console.error('Error fetching deliveries:', e);\r\n    }\r\n\r\n    // Fetch Transfers\r\n    try {\r\n      const col = collection(db, 'shops', sid, 'machines', selectedMachineId, 'transfers');\r\n      const snap = await getDocs(query(col));\r\n      const list: TransferReceipt[] = snap.docs.map((d) => {\r\n        const x: any = d.data();\r\n        const created = x?.createdAt?.toDate?.() ? x.createdAt.toDate() : new Date();\r\n        const ded: any = x?.deductFrom;\r\n        return {\r\n          id: d.id,\r\n          wholesalePrice: Number(x?.wholesalePrice || 0),\r\n          retailPrice: Number(x?.retailPrice || 0),\r\n          profit: Number(x?.profit ?? ((Number(x?.retailPrice || 0) - Number(x?.wholesalePrice || 0)) || 0)),\r\n          createdAt: created.toISOString(),\r\n          cashierName: x?.cashierName || undefined,\r\n          deductFrom: ded === 'base' || ded === 'air' ? ded : undefined,\r\n        } as TransferReceipt;\r\n      });\r\n      const sorted = [...list].sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n      setTransferReceipts(sorted);\r\n      try { localStorage.setItem(`machineDaily_transfers_${sid}_${selectedMachineId}`, JSON.stringify(sorted)); } catch {}\r\n    } catch (e) {\r\n      console.error('Error fetching transfers:', e);\r\n    }\r\n    \r\n    toast({ title: ' ', description: '   .' });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!open || !selectedMachineId) return;\r\n    const sid = shopId || getFallbackShopId();\r\n    // Load from cache first\r\n    try {\r\n      const keyDel = sid ? `machineDaily_deliveries_${sid}_${selectedMachineId}` : `machineDaily_deliveries_${selectedMachineId}`;\r\n      const cachedDel = localStorage.getItem(keyDel);\r\n      if (cachedDel) {\r\n        const parsed = JSON.parse(cachedDel);\r\n        if (Array.isArray(parsed)) setReceipts(parsed);\r\n      }\r\n      \r\n      const keyTrans = sid ? `machineDaily_transfers_${sid}_${selectedMachineId}` : `machineDaily_transfers_${selectedMachineId}`;\r\n      const cachedTrans = localStorage.getItem(keyTrans);\r\n      if (cachedTrans) {\r\n        const parsed = JSON.parse(cachedTrans);\r\n        if (Array.isArray(parsed)) setTransferReceipts(parsed);\r\n      }\r\n    } catch {}\r\n\r\n    // Initial Fetch\r\n    refreshMachineData();\r\n  }, [open, shopId, selectedMachineId]);\r\n\r\n\r\n  const handleClose = (nextOpen: boolean) => {\r\n    if (!nextOpen) {\r\n      //           \r\n      resetDialogState();\r\n    }\r\n    onOpenChange(nextOpen);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"w-screen h-[100vh] overflow-hidden rounded-none p-0 flex flex-col dark:bg-[#121212]\">\r\n        <DialogHeader className=\"sticky top-0 bg-white dark:bg-[#0F0F0F] z-20 border-b border-gray-200 dark:border-[#333] px-4 py-3\">\r\n          <DialogTitle className=\"flex items-center justify-between text-right\">\r\n            <span className=\"flex items-center gap-2\">\r\n              <FawryMachineIcon className=\"h-5 w-5 text-yellow-500\" />\r\n               \r\n            </span>\r\n          </DialogTitle>\r\n          <DialogDescription className=\"text-right\">\r\n                           \" \".\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"px-4 py-3 overflow-y-auto flex-1 grid grid-cols-1 gap-6\">\r\n          {/* /  */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n          <CardTitle className=\"flex items-center justify-between\">\r\n            <span className=\"text-right\"> </span>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                variant=\"destructive\"\r\n                onClick={async () => {\r\n                  try {\r\n                    if (!shopId || !selectedMachineId) return;\r\n                    const baseRef = doc(db, 'shops', shopId, 'machines', selectedMachineId);\r\n                    try {\r\n                      const transSnap = await getDocs(collection(db, 'shops', shopId, 'machines', selectedMachineId, 'transfers'));\r\n                      await Promise.all(transSnap.docs.map(d => deleteDoc(d.ref)));\r\n                    } catch {}\r\n                    try {\r\n                      const delSnap = await getDocs(collection(db, 'shops', shopId, 'machines', selectedMachineId, 'deliveries'));\r\n                      await Promise.all(delSnap.docs.map(d => deleteDoc(d.ref)));\r\n                    } catch {}\r\n                    await deleteDoc(baseRef);\r\n                    setMachines(prev => prev.filter(m => m.id !== selectedMachineId));\r\n                    const next = machines.find(m => m.id !== selectedMachineId);\r\n                    setSelectedMachineId(next ? next.id : null);\r\n                    try {\r\n                      const keyOpening = `${STORAGE_KEY_OPENING}_${selectedMachineId}`;\r\n                      const keySnap = `${STORAGE_KEY_OPENING_SNAPSHOT}_${selectedMachineId}`;\r\n                      localStorage.removeItem(keyOpening);\r\n                      localStorage.removeItem(keySnap);\r\n                    } catch {}\r\n                    toast({ title: '  ', description: '  .' });\r\n                  } catch (err) {\r\n                    toast({ title: ' ', description: '  .' , variant: 'destructive' });\r\n                  }\r\n                }}\r\n                disabled={!selectedMachineId}\r\n                title=\" \"\r\n              >\r\n                <Trash2 className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n          </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 items-end\">\r\n                <div>\r\n                  <label className=\"text-sm font-medium block text-right\"> </label>\r\n                  <Select value={selectedMachineId ?? ''} onValueChange={(v) => { setSelectedMachineId(v); try { const sidSel = shopId || getFallbackShopId(); if (sidSel) localStorage.setItem(`machineDaily_selected_${sidSel}`, v); } catch {} }}>\r\n                    <SelectTrigger className=\"text-right\">\r\n                      <SelectValue placeholder=\" \" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {machines.map(m => (\r\n                        <SelectItem key={m.id} value={m.id}>{m.name}</SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-2\">\r\n                  <div className=\"md:col-span-2\">\r\n                    <label className=\"text-sm font-medium block text-right\">  </label>\r\n                    <Input value={newMachineName} onChange={(e) => setNewMachineName(e.target.value)} placeholder=\" \" className=\"text-right\" />\r\n                  </div>\r\n                  <div className=\"flex justify-end md:justify-start\">\r\n                    <Button\r\n                      onClick={async () => {\r\n                        try {\r\n                          if (!shopId) {\r\n                            toast({ title: '  ', description: '     .', variant: 'destructive' });\r\n                            return;\r\n                          }\r\n                          const name = (newMachineName || '').trim();\r\n                          if (!name) {\r\n                            toast({ title: '  ', description: '   .', variant: 'destructive' });\r\n                            return;\r\n                          }\r\n                          const ref = await addDoc(collection(db, 'shops', shopId, 'machines'), {\r\n                            name,\r\n                            shopId,\r\n                            createdAt: serverTimestamp(),\r\n                            updatedAt: serverTimestamp(),\r\n                            isActive: true,\r\n                          });\r\n                          const created = { id: ref.id, name };\r\n                          setMachines(prev => [created, ...prev]);\r\n                          setSelectedMachineId(ref.id);\r\n                          setNewMachineName('');\r\n                          toast({ title: '  ', description: `  ${name}` });\r\n                        } catch (err) {\r\n                          console.error('Create machine error:', err);\r\n                          toast({ title: '  ', description: '  .', variant: 'destructive' });\r\n                        }\r\n                      }}\r\n                      className=\"bg-violet-600 hover:bg-violet-700\"\r\n                    >\r\n                      \r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n          {/*   */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n              <CardTitle className=\"flex items-center justify-between\">\r\n                <span className=\"text-right\"> </span>\r\n                <Button variant=\"ghost\" size=\"sm\" onClick={() => setIsOpeningOpen((v) => !v)} className=\"flex items-center gap-1\">\r\n                  <ChevronDown className={`h-4 w-4 transition-transform ${isOpeningOpen ? 'rotate-180' : ''}`} />\r\n                </Button>\r\n              </CardTitle>\r\n            </CardHeader>\r\n            {/*        */}\r\n            <div className=\"flex items-center justify-between px-6\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <Button variant=\"outline\" onClick={() => setTransferDialogOpen(true)} disabled={savedOpeningBase == null || savedOpeningAir == null} className=\"border-violet-300 text-violet-700\">\r\n                  \r\n                </Button>\r\n              </div>\r\n              {savedOpeningBase != null && savedOpeningAir != null && (\r\n                <Badge className=\"bg-violet-100 text-violet-700 border border-violet-200\">\r\n                   :  {formatNumber(savedOpeningBase)} |  {formatNumber(savedOpeningAir)} |  {formatNumber(savedDrawerCash ?? 0)}\r\n                </Badge>\r\n              )}\r\n            </div>\r\n            <CardContent className={`space-y-4 ${isOpeningOpen ? '' : 'hidden'}`}>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div className=\"space-y-1\">\r\n                  <label className=\"text-sm font-medium block text-right\"> </label>\r\n                  <Input\r\n                    inputMode=\"decimal\"\r\n                    type=\"number\"\r\n                    min={0}\r\n                    step=\"0.01\"\r\n                    value={openingBase}\r\n                    onChange={(e) => setOpeningBase(e.target.value)}\r\n                    placeholder=\"0.00\"\r\n                    className=\"text-right\"\r\n                  />\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                  <label className=\"text-sm font-medium block text-right\"> </label>\r\n                  <Input\r\n                    inputMode=\"decimal\"\r\n                    type=\"number\"\r\n                    min={0}\r\n                    step=\"0.01\"\r\n                    value={openingAir}\r\n                    onChange={(e) => setOpeningAir(e.target.value)}\r\n                    placeholder=\"0.00\"\r\n                    className=\"text-right\"\r\n                  />\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                  <label className=\"text-sm font-medium block text-right\"> </label>\r\n                  <Input\r\n                    inputMode=\"decimal\"\r\n                    type=\"number\"\r\n                    min={0}\r\n                    step=\"0.01\"\r\n                    value={drawerCash}\r\n                    onChange={(e) => setDrawerCash(e.target.value)}\r\n                    placeholder=\"0.00\"\r\n                    className=\"text-right\"\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"flex items-center justify-end\">\r\n                <Button variant=\"outline\" className=\"mr-2\" onClick={handleResetOpening}>\r\n                  \r\n                </Button>\r\n                <Button onClick={handleAddOpening} className=\"bg-violet-600 hover:bg-violet-700\">\r\n                  \r\n                </Button>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/*   */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n              <CardTitle className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <span className=\"text-right\"> </span>\r\n                  <Badge className=\"bg-green-100 text-green-700 border border-green-200\">: {formatNumber(totalTransferProfit)}</Badge>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Button variant=\"outline\" size=\"sm\" onClick={handleClearTransferReceipts} className=\"border-red-300 text-red-700 hover:bg-red-50\"> </Button>\r\n                  <Receipt className=\"h-4 w-4 text-gray-500\" />\r\n                </div>\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              {transferReceipts.length === 0 ? (\r\n                <p className=\"text-sm text-gray-500 text-right\">   .</p>\r\n              ) : (\r\n                <div className=\"space-y-3 max-h-52 overflow-y-auto pr-1\">\r\n                  {transferReceipts.map((t) => (\r\n                    <div key={t.id} className=\"rounded-lg border p-3 grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\"> </p>\r\n                        <p className=\"text-sm\">{formatNumber(t.wholesalePrice)}</p>\r\n                      </div>\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\"> </p>\r\n                        <p className=\"text-sm\">{formatNumber(t.retailPrice)}</p>\r\n                      </div>\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\"> </p>\r\n                        <p className=\"text-sm text-green-700\">{formatNumber(t.profit)}</p>\r\n                        {t.deductFrom && (\r\n                          <div className=\"mt-1\">\r\n                            <span className=\"text-[11px] bg-violet-100 text-violet-700 border border-violet-200 rounded px-2 py-0.5\"> : {t.deductFrom === 'base' ? '' : ''}</span>\r\n                          </div>\r\n                        )}\r\n                        <div className=\"flex items-center justify-end gap-2 text-xs text-gray-500\">\r\n                          <Calendar className=\"h-3 w-3\" />\r\n                          <span>{formatDateTime(t.createdAt)}</span>\r\n                          {t.cashierName && (\r\n                            <>\r\n                              <Separator orientation=\"vertical\" className=\"h-3\" />\r\n                              <span>: {t.cashierName}</span>\r\n                            </>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/*   -   */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n              <CardTitle className=\"text-right\"> </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              {!isDeliverySectionOpen ? (\r\n                <div className=\"flex justify-end\">\r\n                  <Button variant=\"outline\" onClick={handleStartDelivery} className=\"border-violet-300 text-violet-700\">\r\n                     \r\n                  </Button>\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div className=\"space-y-1\">\r\n                      <label className=\"text-sm font-medium block text-right\">  </label>\r\n                      <Input\r\n                        inputMode=\"decimal\"\r\n                        type=\"number\"\r\n                        min={0}\r\n                        step=\"0.01\"\r\n                        value={deliveryBase}\r\n                        onChange={(e) => setDeliveryBase(e.target.value)}\r\n                        placeholder=\"0.00\"\r\n                        className=\"text-right\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-1\">\r\n                      <label className=\"text-sm font-medium block text-right\">  </label>\r\n                      <Input\r\n                        inputMode=\"decimal\"\r\n                        type=\"number\"\r\n                        min={0}\r\n                        step=\"0.01\"\r\n                        value={deliveryAir}\r\n                        onChange={(e) => setDeliveryAir(e.target.value)}\r\n                        placeholder=\"0.00\"\r\n                        className=\"text-right\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-center justify-end gap-2\">\r\n                    <Button variant=\"secondary\" onClick={() => setIsDeliverySectionOpen(false)}></Button>\r\n                    <Button onClick={handleDoDelivery} className=\"bg-green-600 hover:bg-green-700\"></Button>\r\n                  </div>\r\n\r\n                  {netResult != null && (\r\n                    <div className=\"mt-3\">\r\n                      <div className=\"text-right\">\r\n                        <Badge className={netResult >= 0 ? 'bg-green-100 text-green-700 border border-green-200' : 'bg-red-100 text-red-700 border border-red-200'}>\r\n                           : {formatNumber(netResult)}\r\n                        </Badge>\r\n                      </div>\r\n                      <div className=\"mt-2 flex items-center justify-end gap-2\">\r\n                        <Badge className=\"bg-blue-100 text-blue-700 border border-blue-200\">\r\n                           : {formatNumber(parseFloat(deliveryBase || '0') + parseFloat(deliveryAir || '0'))}\r\n                        </Badge>\r\n                        <Badge className=\"bg-amber-100 text-amber-700 border border-amber-200\">\r\n                             ( ): {formatNumber(totalWholesaleTransferred)}\r\n                        </Badge>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/*   */}\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n              <CardTitle className=\"flex items-center justify-between\">\r\n                <span className=\"text-right\"> </span>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Button variant=\"outline\" size=\"sm\" onClick={handleClearMachineReceipts} className=\"border-red-300 text-red-700 hover:bg-red-50\"> </Button>\r\n                  <Receipt className=\"h-4 w-4 text-gray-500\" />\r\n                </div>\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              {receipts.length === 0 ? (\r\n                <p className=\"text-sm text-gray-500 text-right\">    .</p>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {receipts.map((r) => (\r\n                    <div key={r.id} className=\"rounded-lg border p-3 grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\"></p>\r\n                        <p className=\"text-sm\">: {formatNumber(r.openingBase)}</p>\r\n                        <p className=\"text-sm\">: {formatNumber(r.openingAir)}</p>\r\n                      </div>\r\n                      <div className=\"text-right space-y-1\">\r\n                        <p className=\"text-xs text-gray-500\"></p>\r\n                        <p className=\"text-sm\">: {formatNumber(r.deliveryBase)}</p>\r\n                        <p className=\"text-sm\">: {formatNumber(r.deliveryAir)}</p>\r\n                      </div>\r\n                      <div className=\"text-right space-y-1\">\r\n                        <div className=\"flex items-center justify-end\">\r\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => handleDeleteMachineReceipt(r.id)} className=\"border-red-300 text-red-700 hover:bg-red-50\">\r\n                            <Trash2 className=\"h-3 w-3 mr-1\" /> \r\n                          </Button>\r\n                        </div>\r\n                        <p className=\"text-xs text-gray-500\"></p>\r\n                        <p className={`text-sm ${r.netResult >= 0 ? 'text-green-700' : 'text-red-700'}`}>{formatNumber(r.netResult)}</p>\r\n                        <div className=\"mt-1 flex items-center justify-end gap-2\">\r\n                          <span className=\"text-[11px] bg-blue-100 text-blue-700 border border-blue-200 rounded px-2 py-0.5\">\r\n                             : {formatNumber(r.deliveryBase + r.deliveryAir)}\r\n                          </span>\r\n                          {typeof r.requiredDrawerNoProfit === 'number' && (\r\n                            <span className=\"text-[11px] bg-amber-100 text-amber-700 border border-amber-200 rounded px-2 py-0.5\">\r\n                                 ( ): {formatNumber(r.requiredDrawerNoProfit || 0)}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"flex items-center justify-end gap-2 text-xs text-gray-500\">\r\n                          <Calendar className=\"h-3 w-3\" />\r\n                          <span>{formatDateTime(r.createdAt)}</span>\r\n                          {r.cashierName && (\r\n                            <>\r\n                              <Separator orientation=\"vertical\" className=\"h-3\" />\r\n                              <span>: {r.cashierName}</span>\r\n                            </>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        <DialogFooter className=\"sticky bottom-0 bg-white dark:bg-[#0F0F0F] z-20 border-t border-gray-200 dark:border-[#333] px-4 py-3 flex items-center justify-between\">\r\n          <Button variant=\"outline\" onClick={() => handleClose(false)}></Button>\r\n          <div className=\"text-xs text-gray-500 flex items-center gap-1\">\r\n            <Clock className=\"h-3 w-3\" />\r\n            <span>     </span>\r\n          </div>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n\r\n      {/*    */}\r\n      <Dialog open={transferDialogOpen} onOpenChange={setTransferDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-sm\">\r\n          <DialogHeader>\r\n            <DialogTitle> </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-3\">\r\n            <div>\r\n              <label className=\"text-sm font-medium block text-right\"> </label>\r\n              <Input\r\n                inputMode=\"decimal\"\r\n                type=\"number\"\r\n                min={0}\r\n                step=\"0.01\"\r\n                value={wholesalePrice}\r\n                onChange={(e) => setWholesalePrice(e.target.value)}\r\n                placeholder=\"0.00\"\r\n                className=\"text-right\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"text-sm font-medium block text-right\"> </label>\r\n              <Input\r\n                inputMode=\"decimal\"\r\n                type=\"number\"\r\n                min={0}\r\n                step=\"0.01\"\r\n                value={retailPrice}\r\n                onChange={(e) => setRetailPrice(e.target.value)}\r\n                placeholder=\"0.00\"\r\n                className=\"text-right\"\r\n              />\r\n            </div>\r\n            <div className=\"text-right\">\r\n              <Badge className=\"bg-green-100 text-green-700 border border-green-200\">\r\n                 : {formatNumber((parseFloat(retailPrice || '0') - parseFloat(wholesalePrice || '0')) || 0)}\r\n              </Badge>\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex items-center justify-end gap-2\">\r\n            <Button variant=\"secondary\" onClick={() => setTransferDialogOpen(false)}></Button>\r\n            <Button onClick={handleTransferConfirm} className=\"bg-violet-600 hover:bg-violet-700\"></Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n      {/*     */}\r\n      <AlertDialog open={deductDialogOpen} onOpenChange={setDeductDialogOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>  </AlertDialogTitle>\r\n            <AlertDialogDescription>         </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <div className=\"flex items-center justify-end gap-2 mt-4\">\r\n            <AlertDialogCancel onClick={() => setDeductDialogOpen(false)}></AlertDialogCancel>\r\n            <AlertDialogAction className=\"bg-emerald-600 hover:bg-emerald-700 text-white\" onClick={() => finalizeTransfer('base')}>  </AlertDialogAction>\r\n            <AlertDialogAction className=\"bg-blue-600 hover:bg-blue-700 text-white\" onClick={() => finalizeTransfer('air')}>  </AlertDialogAction>\r\n          </div>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </Dialog>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport function useDebouncedValue<T>(value: T, delay = 300) {\r\n  const [debounced, setDebounced] = React.useState<T>(value);\r\n\r\n  React.useEffect(() => {\r\n    const handler = setTimeout(() => setDebounced(value), delay);\r\n    return () => clearTimeout(handler);\r\n  }, [value, delay]);\r\n\r\n  return debounced;\r\n}","import React, { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Eye, DollarSign, ArrowDownLeft, ArrowRightLeft, Clock, Calendar } from 'lucide-react';\r\nimport { ProfitService } from '@/utils/profitService';\r\nimport { reportsService } from '@/utils/reportsService';\r\nimport { MasterPinDialog } from './MasterPinDialog';\r\nimport { toast } from '@/hooks/use-toast'\r\nimport { getUserSubscription, SubscriptionPlan } from '@/utils/subscriptionService'\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext'\r\n\r\ninterface MonthlyProfitDisplayDialogProps {\r\n  userId?: string;\r\n  transactions: any[];\r\n}\r\n\r\ninterface ProfitData {\r\n  monthlyWithdrawalProfit: number;\r\n  monthlyTransferProfit: number;\r\n  lastUpdated: Date;\r\n}\r\n\r\nconst MonthlyProfitDisplayDialog: React.FC<MonthlyProfitDisplayDialogProps> = ({ userId, transactions }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isMasterPinDialogOpen, setIsMasterPinDialogOpen] = useState(false);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [profitData, setProfitData] = useState<ProfitData>({\r\n    monthlyWithdrawalProfit: 0,\r\n    monthlyTransferProfit: 0,\r\n    lastUpdated: new Date()\r\n  });\r\n  const { userSubscription } = useFirebaseAuth();\r\n\r\n  useEffect(() => {\r\n    if (userId && isOpen && isAuthenticated) {\r\n      loadProfitData();\r\n    }\r\n  }, [userId, isOpen, isAuthenticated]);\r\n\r\n  const loadProfitData = async () => {\r\n    if (!userId) return;\r\n    \r\n    try {\r\n      //            localStorage\r\n      if (Array.isArray(transactions) && transactions.length > 0) {\r\n        const today = new Date();\r\n        const currentMonth = today.getMonth();\r\n        const currentYear = today.getFullYear();\r\n\r\n        const visibleMonthly = reportsService.filterVisibleTransactions(transactions as any[], 'monthly', userId);\r\n\r\n        let monthlyWithdrawProfit = 0;\r\n        let monthlyTransferProfit = 0;\r\n\r\n        visibleMonthly.forEach((tx: any) => {\r\n          const txDate = new Date(tx.createdAt);\r\n          const status = String(tx.status || 'confirmed').toLowerCase();\r\n          if (txDate.getMonth() !== currentMonth || txDate.getFullYear() !== currentYear) return;\r\n          if (status !== 'completed' && status !== 'confirmed') return;\r\n\r\n          const t = (tx.type || tx.txnType || '').toLowerCase();\r\n          const txForCalc = {\r\n            type: t === 'withdrawal' ? 'withdraw' : t,\r\n            amount: Number(tx.amount || 0),\r\n            commission: tx.commission,\r\n          };\r\n\r\n          if (txForCalc.type === 'withdraw') {\r\n            monthlyWithdrawProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          } else if (txForCalc.type === 'send' || txForCalc.type === 'receive' || txForCalc.type === 'transfer') {\r\n            monthlyTransferProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          }\r\n        });\r\n\r\n        setProfitData({\r\n          monthlyWithdrawalProfit: Math.round(monthlyWithdrawProfit * 100) / 100,\r\n          monthlyTransferProfit: Math.round(monthlyTransferProfit * 100) / 100,\r\n          lastUpdated: new Date()\r\n        });\r\n        return;\r\n      }\r\n\r\n      //        localStorage ()\r\n      const profits = ProfitService.getWithdrawTransferProfits(userId);\r\n      setProfitData({\r\n        monthlyWithdrawalProfit: profits.monthlyWithdrawProfit || 0,\r\n        monthlyTransferProfit: profits.monthlyTransferProfit || 0,\r\n        lastUpdated: new Date()\r\n      });\r\n    } catch (error) {\r\n      console.error('Error loading profit data:', error);\r\n    }\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return `${amount.toFixed(2)} .`;\r\n  };\r\n\r\n  const formatDate = (date: Date) => {\r\n    return new Intl.DateTimeFormat('ar-EG', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }).format(date);\r\n  };\r\n\r\n  //         \r\n  const isZeroPlan = async (): Promise<boolean> => {\r\n    try {\r\n      const localSub: any = (userSubscription as any)?.subscription || null;\r\n      const rawLocal: any = localSub?.planType ?? localSub?.plan ?? null;\r\n      const planLocalStr = typeof rawLocal === 'string' ? rawLocal.toLowerCase() : null;\r\n      if (rawLocal === SubscriptionPlan.ZERO || planLocalStr === 'zero' || planLocalStr === '0' || rawLocal === 0) {\r\n        return true;\r\n      }\r\n    } catch {}\r\n\r\n    try {\r\n      if (userId) {\r\n        const remoteSub: any = await getUserSubscription(userId);\r\n        const rawRemote: any = remoteSub?.planType ?? remoteSub?.plan ?? null;\r\n        const planRemoteStr = typeof rawRemote === 'string' ? rawRemote.toLowerCase() : null;\r\n        if (rawRemote === SubscriptionPlan.ZERO || planRemoteStr === 'zero' || planRemoteStr === '0' || rawRemote === 0) {\r\n          return true;\r\n        }\r\n      }\r\n    } catch {}\r\n\r\n    return false;\r\n  };\r\n\r\n  const handleEyeClick = async () => {\r\n    //         \r\n    try {\r\n      if (await isZeroPlan()) {\r\n        toast({\r\n          title: ' ',\r\n          description: '       .     .',\r\n          variant: 'destructive'\r\n        })\r\n        return\r\n      }\r\n    } catch {}\r\n    setIsMasterPinDialogOpen(true)\r\n  }\r\n\r\n  const handlePinSuccess = async () => {\r\n    //            \r\n    try {\r\n      if (await isZeroPlan()) {\r\n        toast({\r\n          title: ' ',\r\n          description: '       .     .',\r\n          variant: 'destructive'\r\n        });\r\n        setIsMasterPinDialogOpen(false);\r\n        return;\r\n      }\r\n    } catch {}\r\n\r\n    setIsAuthenticated(true);\r\n    setIsOpen(true);\r\n    setIsMasterPinDialogOpen(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        size=\"sm\"\r\n        variant=\"ghost\"\r\n        onClick={handleEyeClick}\r\n        className=\"h-6 w-6 p-0 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded-full transition-colors duration-200\"\r\n        title=\"  \"\r\n      >\r\n        <Eye className=\"h-4 w-4\" />\r\n      </Button>\r\n\r\n      <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n        <DialogContent className=\"max-w-[280px] sm:max-w-[320px] mx-auto bg-white border border-gray-200 shadow-xl rounded-xl p-0 overflow-hidden\">\r\n          <DialogHeader className=\"bg-gray-50 px-4 py-3 border-b border-gray-100\">\r\n            <DialogTitle className=\"text-sm font-bold text-gray-900 flex items-center justify-center gap-2\">\r\n              <div className=\"p-1.5 bg-white rounded-full border border-gray-200\">\r\n                <Calendar className=\"h-4 w-4 text-purple-600\" />\r\n              </div>\r\n               \r\n            </DialogTitle>\r\n          </DialogHeader>\r\n\r\n          <div className=\"p-4 space-y-3\">\r\n            {/*  */}\r\n            <div className=\"flex items-center justify-between p-2 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"p-1.5 bg-red-50 rounded-md\">\r\n                  <ArrowDownLeft className=\"h-3.5 w-3.5 text-red-600\" />\r\n                </div>\r\n                <span className=\"font-medium text-gray-700 text-sm\"></span>\r\n              </div>\r\n              <span className=\"font-bold text-sm text-gray-900\">\r\n                {formatCurrency(profitData.monthlyWithdrawalProfit)}\r\n              </span>\r\n            </div>\r\n\r\n            {/*  */}\r\n            <div className=\"flex items-center justify-between p-2 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"p-1.5 bg-green-50 rounded-md\">\r\n                  <ArrowRightLeft className=\"h-3.5 w-3.5 text-green-600\" />\r\n                </div>\r\n                <span className=\"font-medium text-gray-700 text-sm\"></span>\r\n              </div>\r\n              <span className=\"font-bold text-sm text-gray-900\">\r\n                {formatCurrency(profitData.monthlyTransferProfit)}\r\n              </span>\r\n            </div>\r\n\r\n            {/*  */}\r\n            <div className=\"flex items-center justify-between p-3 bg-purple-50 rounded-lg border border-purple-100 mt-2\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"p-1.5 bg-white rounded-md shadow-sm\">\r\n                  <DollarSign className=\"h-3.5 w-3.5 text-purple-600\" />\r\n                </div>\r\n                <span className=\"font-bold text-purple-900 text-sm\"></span>\r\n              </div>\r\n              <span className=\"font-bold text-base text-purple-700\">\r\n                {formatCurrency(profitData.monthlyWithdrawalProfit + profitData.monthlyTransferProfit)}\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-gray-50 px-4 py-3 border-t border-gray-100 flex justify-center\">\r\n            <Button\r\n              onClick={() => setIsOpen(false)}\r\n              className=\"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 hover:text-gray-900 w-full sm:w-auto px-8 rounded-lg text-sm font-medium shadow-sm\"\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <MasterPinDialog\r\n        open={isMasterPinDialogOpen}\r\n        onOpenChange={setIsMasterPinDialogOpen}\r\n        onSuccess={handlePinSuccess}\r\n        description=\"          \"\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport const MonthlyProfitEyeButton: React.FC<MonthlyProfitDisplayDialogProps> = (props) => {\r\n  return <MonthlyProfitDisplayDialog {...props} />;\r\n};\r\n\r\nexport default MonthlyProfitDisplayDialog;","import React, { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Eye, EyeOff, Lock, AlertCircle } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { ProfitService } from '@/utils/profitService';\r\nimport { MasterPinService } from '@/utils/masterPinService';\r\nimport { useEffect } from 'react';\r\n\r\ninterface ProfitPinDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  onSuccess: () => void;\r\n  userId?: string;\r\n}\r\n\r\nexport function ProfitPinDialog({ \r\n  open, \r\n  onOpenChange, \r\n  onSuccess, \r\n  userId \r\n}: ProfitPinDialogProps) {\r\n  const [pin, setPin] = useState('');\r\n  const [confirmPin, setConfirmPin] = useState('');\r\n  const [showPin, setShowPin] = useState(false);\r\n  const [showConfirmPin, setShowConfirmPin] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [hasExistingPin, setHasExistingPin] = useState(false);\r\n  const { toast } = useToast();\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n      const has = await MasterPinService.hasMasterPin(userId);\r\n      if (mounted) setHasExistingPin(has);\r\n    })();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [userId, open]);\r\n\r\n  const handleClose = () => {\r\n    setPin('');\r\n    setConfirmPin('');\r\n    setError('');\r\n    setShowPin(false);\r\n    setShowConfirmPin(false);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      if (hasExistingPin) {\r\n        //     \r\n        const ok = await MasterPinService.verifyMasterPin(pin, userId);\r\n        if (!ok) {\r\n          setError('   ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n      } else {\r\n        //     \r\n        if (pin.length < 4) {\r\n          setError('     4   ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        if (pin !== confirmPin) {\r\n          setError('   ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        const created = await MasterPinService.createMasterPin(pin, userId);\r\n        if (!created) {\r\n          setError('    ');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      toast({\r\n        title: \" \",\r\n        description: hasExistingPin \r\n          ? \"      \" \r\n          : \"     \",\r\n      });\r\n\r\n      onSuccess();\r\n      handleClose();\r\n    } catch (error) {\r\n      setError('     ');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-md\" dir=\"rtl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2 text-lg font-semibold\">\r\n            <Lock className=\"h-5 w-5 text-green-600\" />\r\n            {hasExistingPin ? '   ' : '   '}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div className=\"text-sm text-gray-600 bg-blue-50 p-3 rounded-lg\">\r\n            {hasExistingPin \r\n              ? '      '\r\n              : '       .      .'\r\n            }\r\n          </div>\r\n\r\n          {/*    */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"pin\">\r\n              {hasExistingPin ? '  ' : '   '}\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"pin\"\r\n                type={showPin ? \"text\" : \"password\"}\r\n                value={pin}\r\n                onChange={(e) => setPin(e.target.value)}\r\n                placeholder={hasExistingPin ? \"  \" : \"    (4   )\"}\r\n                className=\"pr-10\"\r\n                dir=\"ltr\"\r\n                autoComplete=\"off\"\r\n                required\r\n              />\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                onClick={() => setShowPin(!showPin)}\r\n              >\r\n                {showPin ? (\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Eye className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/*     (  ) */}\r\n          {!hasExistingPin && (\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"confirmPin\">  </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"confirmPin\"\r\n                  type={showConfirmPin ? \"text\" : \"password\"}\r\n                  value={confirmPin}\r\n                  onChange={(e) => setConfirmPin(e.target.value)}\r\n                  placeholder=\"   \"\r\n                  className=\"pr-10\"\r\n                  dir=\"ltr\"\r\n                  autoComplete=\"off\"\r\n                  required\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowConfirmPin(!showConfirmPin)}\r\n                >\r\n                  {showConfirmPin ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/*   */}\r\n          {error && (\r\n            <div className=\"flex items-center gap-2 text-red-600 text-sm\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {/*   */}\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading}\r\n              className=\"flex-1 bg-green-600 hover:bg-green-700\"\r\n            >\r\n              <Lock className=\"h-4 w-4 mr-2\" />\r\n              {isLoading \r\n                ? \" ...\" \r\n                : hasExistingPin \r\n                  ? \" \" \r\n                  : \"  \"\r\n              }\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              disabled={isLoading}\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}","import React, { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Eye, DollarSign, ArrowDownLeft, ArrowRightLeft, Clock } from 'lucide-react';\r\nimport { ProfitService } from '@/utils/profitService';\r\nimport { ProfitPinDialog } from './ProfitPinDialog';\r\nimport { formatCurrency } from '@/utils/formatters';\r\nimport { reportsService } from '@/utils/reportsService';\r\n\r\ninterface DailyProfitDisplayDialogProps {\r\n  userId?: string;\r\n  transactions: any[];\r\n}\r\n\r\ninterface ProfitData {\r\n  dailyWithdrawalProfit: number;\r\n  dailyTransferProfit: number;\r\n  lastUpdated: Date;\r\n}\r\n\r\nconst DailyProfitDisplayDialog: React.FC<DailyProfitDisplayDialogProps> = ({ userId, transactions }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isPinDialogOpen, setIsPinDialogOpen] = useState(false);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [profitData, setProfitData] = useState<ProfitData>({\r\n    dailyWithdrawalProfit: 0,\r\n    dailyTransferProfit: 0,\r\n    lastUpdated: new Date()\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (userId && isOpen && isAuthenticated) {\r\n      loadProfitData();\r\n    }\r\n  }, [userId, isOpen, isAuthenticated, transactions]);\r\n\r\n  const loadProfitData = async () => {\r\n    if (!userId) return;\r\n    \r\n    try {\r\n      //            localStorage\r\n      if (Array.isArray(transactions) && transactions.length > 0) {\r\n        const today = new Date();\r\n        const visibleDaily = reportsService.filterVisibleTransactions(transactions as any[], 'daily', userId);\r\n\r\n        let dailyWithdrawProfit = 0;\r\n        let dailyTransferProfit = 0;\r\n\r\n        visibleDaily.forEach((tx: any) => {\r\n          const txDate = new Date(tx.createdAt);\r\n          const status = String(tx.status || 'confirmed').toLowerCase();\r\n          if (txDate.toDateString() !== today.toDateString()) return;\r\n          //    (pending)    \r\n        \r\n          const t = (tx.type || tx.txnType || '').toLowerCase();\r\n          const title = String(tx.title || '');\r\n          if (t === 'cash_addition' || title.includes('  ')) return;\r\n          const txForCalc = {\r\n            type: t === 'withdrawal' ? 'withdraw' : t,\r\n            amount: Number(tx.amount || 0),\r\n            commission: tx.commission,\r\n          };\r\n\r\n          if (txForCalc.type === 'withdraw') {\r\n            dailyWithdrawProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          } else if (txForCalc.type === 'send' || txForCalc.type === 'receive' || txForCalc.type === 'transfer') {\r\n            dailyTransferProfit += ProfitService.calculateProfitFromTransaction(txForCalc);\r\n          }\r\n        });\r\n\r\n        setProfitData({\r\n          dailyWithdrawalProfit: Math.round(dailyWithdrawProfit * 100) / 100,\r\n          dailyTransferProfit: Math.round(dailyTransferProfit * 100) / 100,\r\n          lastUpdated: new Date()\r\n        });\r\n\r\n        //         \r\n        try { ProfitService.updateProfitsFromTransactions(transactions, userId); } catch {}\r\n        return;\r\n      }\r\n\r\n      //        localStorage ()\r\n      const profits = ProfitService.getWithdrawTransferProfits(userId);\r\n      setProfitData({\r\n        dailyWithdrawalProfit: profits.dailyWithdrawProfit || 0,\r\n        dailyTransferProfit: profits.dailyTransferProfit || 0,\r\n        lastUpdated: new Date()\r\n      });\r\n    } catch (error) {\r\n      console.error('Error loading profit data:', error);\r\n    }\r\n  };\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return `${amount.toFixed(2)} .`;\r\n  };\r\n\r\n  const formatDate = (date: Date) => {\r\n    return new Intl.DateTimeFormat('ar-EG', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }).format(date);\r\n  };\r\n\r\n  const handleEyeClick = () => {\r\n    if (ProfitService.hasProfitPin(userId)) {\r\n      setIsPinDialogOpen(true);\r\n    } else {\r\n      setIsPinDialogOpen(true);\r\n    }\r\n  };\r\n\r\n  const handlePinSuccess = () => {\r\n    setIsAuthenticated(true);\r\n    setIsOpen(true);\r\n    setIsPinDialogOpen(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        size=\"sm\"\r\n        variant=\"ghost\"\r\n        onClick={handleEyeClick}\r\n        className=\"h-6 w-6 p-0 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-colors duration-200\"\r\n        title=\"  \"\r\n      >\r\n        <Eye className=\"h-4 w-4\" />\r\n      </Button>\r\n\r\n      <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n        <DialogContent className=\"max-w-[280px] sm:max-w-[320px] mx-auto bg-white border border-gray-200 shadow-xl rounded-xl p-0 overflow-hidden\">\r\n          <DialogHeader className=\"bg-gray-50 px-4 py-3 border-b border-gray-100\">\r\n            <DialogTitle className=\"text-sm font-bold text-gray-900 flex items-center justify-center gap-2\">\r\n              <div className=\"p-1.5 bg-white rounded-full border border-gray-200\">\r\n                <DollarSign className=\"h-4 w-4 text-blue-600\" />\r\n              </div>\r\n               \r\n            </DialogTitle>\r\n          </DialogHeader>\r\n\r\n          <div className=\"p-4 space-y-3\">\r\n            {/*  */}\r\n            <div className=\"flex items-center justify-between p-2 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"p-1.5 bg-red-50 rounded-md\">\r\n                  <ArrowDownLeft className=\"h-3.5 w-3.5 text-red-600\" />\r\n                </div>\r\n                <span className=\"font-medium text-gray-700 text-sm\"></span>\r\n              </div>\r\n              <span className=\"font-bold text-sm text-gray-900\">\r\n                {formatCurrency(profitData.dailyWithdrawalProfit)}\r\n              </span>\r\n            </div>\r\n\r\n            {/*  */}\r\n            <div className=\"flex items-center justify-between p-2 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"p-1.5 bg-green-50 rounded-md\">\r\n                  <ArrowRightLeft className=\"h-3.5 w-3.5 text-green-600\" />\r\n                </div>\r\n                <span className=\"font-medium text-gray-700 text-sm\"></span>\r\n              </div>\r\n              <span className=\"font-bold text-sm text-gray-900\">\r\n                {formatCurrency(profitData.dailyTransferProfit)}\r\n              </span>\r\n            </div>\r\n\r\n            {/*  */}\r\n            <div className=\"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-100 mt-2\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"p-1.5 bg-white rounded-md shadow-sm\">\r\n                  <DollarSign className=\"h-3.5 w-3.5 text-blue-600\" />\r\n                </div>\r\n                <span className=\"font-bold text-blue-900 text-sm\"></span>\r\n              </div>\r\n              <span className=\"font-bold text-base text-blue-700\">\r\n                {formatCurrency(profitData.dailyWithdrawalProfit + profitData.dailyTransferProfit)}\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-gray-50 px-4 py-3 border-t border-gray-100 flex justify-center\">\r\n            <Button\r\n              onClick={() => setIsOpen(false)}\r\n              className=\"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 hover:text-gray-900 w-full sm:w-auto px-8 rounded-lg text-sm font-medium shadow-sm\"\r\n            >\r\n              \r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <ProfitPinDialog\r\n        open={isPinDialogOpen}\r\n        onOpenChange={setIsPinDialogOpen}\r\n        onSuccess={handlePinSuccess}\r\n        userId={userId}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport const DailyProfitEyeButton: React.FC<DailyProfitDisplayDialogProps> = (props) => {\r\n  return <DailyProfitDisplayDialog {...props} />;\r\n};\r\n\r\nexport default DailyProfitDisplayDialog;\r\n","import React from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Wallet, Check, Phone } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface WalletData {\n  id: string;\n  name: string;\n  phone: string;\n  isDefault: boolean;\n}\n\ninterface WalletsListDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n  wallets: WalletData[];\n  walletBalances: Record<string, number>;\n  onSelectWallet: (walletId: string) => void;\n  selectedWalletId?: string;\n}\n\nexport function WalletsListDialog({\n  isOpen,\n  onClose,\n  wallets,\n  walletBalances,\n  onSelectWallet,\n  selectedWalletId\n}: WalletsListDialogProps) {\n  \n  const handleSelect = (walletId: string) => {\n    onSelectWallet(walletId);\n    onClose();\n  };\n\n  const totalBalance = Object.values(walletBalances).reduce((sum, val) => sum + (Number(val) || 0), 0);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-md bg-gradient-to-br from-white to-gray-50 border-0 shadow-2xl\">\n        <DialogHeader className=\"space-y-4 pb-4 border-b border-gray-100\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-3 bg-blue-100 rounded-full\">\n              <Wallet className=\"w-6 h-6 text-blue-600\" />\n            </div>\n            <div className=\"space-y-1\">\n              <DialogTitle className=\"text-xl font-bold text-gray-900\">\n                 \n              </DialogTitle>\n              <p className=\"text-sm text-gray-500 font-medium\">\n                 : <span className=\"text-blue-600 font-bold text-base\">{totalBalance.toLocaleString('en-US')} </span>\n              </p>\n            </div>\n          </div>\n        </DialogHeader>\n        \n        <ScrollArea className=\"max-h-[60vh] pr-4 -mr-4\">\n          <div className=\"grid gap-3 py-2\">\n            {wallets.length === 0 ? (\n              <div className=\"text-center py-8 text-gray-500 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200\">\n                <p>   </p>\n              </div>\n            ) : (\n              wallets.map((wallet) => {\n                const balance = walletBalances[wallet.id] || 0;\n                const isSelected = selectedWalletId === wallet.id;\n                \n                return (\n                  <button\n                    key={wallet.id}\n                    onClick={() => handleSelect(wallet.id)}\n                    className={cn(\n                      \"w-full group relative flex items-center justify-between p-4 rounded-xl border-2 transition-all duration-200\",\n                      isSelected \n                        ? \"border-blue-500 bg-blue-50/50 shadow-md ring-1 ring-blue-200\" \n                        : \"border-transparent bg-white hover:bg-gray-50 hover:border-gray-200 shadow-sm hover:shadow-md\"\n                    )}\n                  >\n                    <div className=\"flex items-center gap-4\">\n                      <div className={cn(\n                        \"w-12 h-12 rounded-full flex items-center justify-center transition-colors\",\n                        isSelected ? \"bg-blue-100 text-blue-600\" : \"bg-gray-100 text-gray-500 group-hover:bg-gray-200\"\n                      )}>\n                        <Wallet className=\"w-6 h-6\" />\n                      </div>\n                      \n                      <div className=\"flex flex-col items-start gap-1\">\n                        <span className={cn(\n                          \"font-bold text-lg\",\n                          isSelected ? \"text-blue-900\" : \"text-gray-900\"\n                        )}>\n                          {wallet.name}\n                        </span>\n                        <div className=\"flex items-center gap-1.5 text-gray-500\">\n                          <Phone className=\"w-3.5 h-3.5\" />\n                          <span className=\"text-sm font-medium dir-ltr\">{wallet.phone}</span>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"flex flex-col items-end gap-1\">\n                      <span className={cn(\n                        \"font-extrabold text-lg\",\n                        balance > 0 ? \"text-emerald-600\" : \"text-gray-400\"\n                      )}>\n                        {balance.toLocaleString('en-US')}\n                        <span className=\"text-xs mr-1 font-medium text-gray-400\"></span>\n                      </span>\n                      {isSelected && (\n                        <div className=\"flex items-center gap-1 text-xs font-bold text-blue-600 bg-blue-100 px-2 py-0.5 rounded-full\">\n                          <Check className=\"w-3 h-3\" />\n                          \n                        </div>\n                      )}\n                    </div>\n                  </button>\n                );\n              })\n            )}\n          </div>\n        </ScrollArea>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","import React, { useEffect, useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useShift } from '@/contexts/ShiftContext';\r\n//        (PIN)      \r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { getLastTransactions } from '@/integrations/firebase/functions';\r\nimport { userDataService } from '@/integrations/firebase/services';\r\nimport { WalletCashService } from '@/utils/walletCashService';\r\nimport { db } from '@/firebase';\r\nimport { doc, getDoc, setDoc } from 'firebase/firestore';\r\n//        \r\n\r\ninterface Props {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nconst CashierShiftModal: React.FC<Props> = ({ open, onOpenChange }) => {\r\n  const { shiftUser, isShiftActive, shiftStartAt, setShiftUser, startShift, endShift } = useShift();\r\n  const { userSubscription, user, signIn, profile } = useFirebaseAuth();\r\n  const { toast } = useToast();\r\n  const [name, setName] = useState(shiftUser?.name || '');\r\n  const [username, setUsername] = useState(shiftUser?.username || '');\r\n  const [password, setPassword] = useState('');\r\n  const [handoverDialogOpen, setHandoverDialogOpen] = useState(false);\r\n  const [handoverMode, setHandoverMode] = useState<'toAdmin' | 'toUser' | null>(null);\r\n  const [mainPassword, setMainPassword] = useState('');\r\n  const [mainAuthError, setMainAuthError] = useState('');\r\n  const [isVerifyingMain, setIsVerifyingMain] = useState(false);\r\n  const [handoverSelectedUser, setHandoverSelectedUser] = useState<CashierUser | null>(null);\r\n  const [handoverPassword, setHandoverPassword] = useState('');\r\n  const [handoverError, setHandoverError] = useState('');\r\n  const [isHandoverProcessing, setIsHandoverProcessing] = useState(false);\r\n  const [reportDialogOpen, setReportDialogOpen] = useState(false);\r\n  const [reportTotals, setReportTotals] = useState<{ totalTransfers: number; totalWithdrawals: number }>({ totalTransfers: 0, totalWithdrawals: 0 });\r\n  const [deficitChoice, setDeficitChoice] = useState<'yes' | 'no' | null>(null);\r\n  const [deficitAmount, setDeficitAmount] = useState('');\r\n  //    \r\n  const [receivedDrawerFunds, setReceivedDrawerFunds] = useState(''); //      \r\n  const [receivedWalletBalancesTotal, setReceivedWalletBalancesTotal] = useState<number>(0); //    ()\r\n  const [receivedWalletBalancesMap, setReceivedWalletBalancesMap] = useState<Record<string, number>>({}); //    \r\n  const [deliveredDrawerFunds, setDeliveredDrawerFunds] = useState<number>(0); //      \r\n  const [deliveredWalletBalancesTotal, setDeliveredWalletBalancesTotal] = useState<number>(0); //    ()\r\n  const [deliveredWalletBalancesMap, setDeliveredWalletBalancesMap] = useState<Record<string, number>>({}); //     \r\n  const [handoverTargetLabel, setHandoverTargetLabel] = useState<string>('');\r\n  //        \r\n  const [initialIntakeDialogOpen, setInitialIntakeDialogOpen] = useState(false);\r\n\r\n  const normalizeDigits = (s: string) => {\r\n    const map: Record<string, string> = {\r\n      '':'0','':'1','':'2','':'3','':'4','':'5','':'6','':'7','':'8','':'9',\r\n      '':'0','':'1','':'2','':'3','':'4','':'5','':'6','':'7','':'8','':'9',\r\n      '':'.','':'.','':'.',' ':'',\r\n    };\r\n    return s.split('').map(ch => map[ch] ?? ch).join('');\r\n  };\r\n\r\n  type CashierUser = { name: string; username: string; password: string };\r\n  //             \r\n  const getCashierUsersKey = () => `cashierUsers_${user?.uid || 'default'}`;\r\n  const [users, setUsers] = useState<CashierUser[]>(() => {\r\n    try {\r\n      //      \r\n      let saved = localStorage.getItem(getCashierUsersKey());\r\n      //       \r\n      if (!saved) {\r\n        const legacy = localStorage.getItem('cashierUsers');\r\n        if (legacy) {\r\n          saved = legacy;\r\n        }\r\n      }\r\n      return saved ? JSON.parse(saved) : [];\r\n    } catch {\r\n      return [];\r\n    }\r\n  });\r\n\r\n  //     Firestore     \r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        if (!user?.uid) return;\r\n        const ref = doc(db, 'profiles', user.uid, 'cashierUsers', 'list');\r\n        const snap = await getDoc(ref);\r\n        if (snap.exists()) {\r\n          const data = snap.data() as any;\r\n          const cloudUsers: CashierUser[] = Array.isArray(data?.users) ? data.users : [];\r\n          if (cloudUsers && cloudUsers.length > 0) {\r\n            setUsers(cloudUsers);\r\n          }\r\n        }\r\n      } catch {}\r\n    })();\r\n  }, [user?.uid]);\r\n\r\n  //     getDoc  \r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n    const fetchCashierUsers = async () => {\r\n      try {\r\n        const ref = doc(db, 'profiles', user.uid, 'cashierUsers', 'list');\r\n        const snap = await getDoc(ref);\r\n        if (snap.exists()) {\r\n          const data = snap.data() as any;\r\n          const cloudUsers: CashierUser[] = Array.isArray(data?.users) ? data.users : [];\r\n          if (cloudUsers && cloudUsers.length > 0) {\r\n            setUsers(cloudUsers);\r\n          } else {\r\n            // Fallback to local if cloud is empty (legacy)\r\n            try {\r\n              const saved = localStorage.getItem(getCashierUsersKey());\r\n              const localUsers: CashierUser[] = saved ? JSON.parse(saved) : [];\r\n              setUsers(localUsers);\r\n            } catch {\r\n              setUsers([]);\r\n            }\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.warn('Failed to fetch cashierUsers:', err);\r\n      }\r\n    };\r\n    fetchCashierUsers();\r\n  }, [user?.uid]);\r\n\r\n  //      \r\n  const planType = userSubscription?.subscription?.planType as ('monthly' | 'yearly' | 'lifetime' | undefined);\r\n  const maxCashiers = planType === 'yearly' ? 2 : planType === 'lifetime' ? 4 : Number.POSITIVE_INFINITY;\r\n\r\n  useEffect(() => {\r\n    try {\r\n      //     \r\n      localStorage.setItem(getCashierUsersKey(), JSON.stringify(users));\r\n      //         ()\r\n      try { localStorage.removeItem('cashierUsers'); } catch {}\r\n    } catch {}\r\n    //     \r\n    (async () => {\r\n      try {\r\n        if (!user?.uid) return;\r\n        const ref = doc(db, 'profiles', user.uid, 'cashierUsers', 'list');\r\n        await setDoc(ref, { users }, { merge: true });\r\n      } catch {}\r\n    })();\r\n  }, [users]);\r\n\r\n  const [authDialogOpen, setAuthDialogOpen] = useState(false);\r\n  const [enteredPassword, setEnteredPassword] = useState('');\r\n  const [selectedUser, setSelectedUser] = useState<CashierUser | null>(null);\r\n  //    \r\n  const [deliveryReports, setDeliveryReports] = useState<any[]>([]);\r\n  const [deliveryReportsDialogOpen, setDeliveryReportsDialogOpen] = useState(false);\r\n  //           \r\n  const [selectedDeliveryReport, setSelectedDeliveryReport] = useState<any | null>(null);\r\n  const [isDeliveryReportOpen, setIsDeliveryReportOpen] = useState(false);\r\n  //    \r\n  const [addUserDialogOpen, setAddUserDialogOpen] = useState(false);\r\n\r\n  const handleDeleteUser = (usernameToDelete: string) => {\r\n    const isCurrentShiftUser = shiftUser?.username === usernameToDelete;\r\n    let lastHandoverToAdmin = false;\r\n    try { lastHandoverToAdmin = localStorage.getItem('lastHandoverToAdmin') === 'true'; } catch {}\r\n    const handedToAdmin = handoverTargetLabel === ' ' || lastHandoverToAdmin;\r\n    const canDeleteCurrentShiftUser = isCurrentShiftUser && !isShiftActive && handedToAdmin;\r\n\r\n    //                   \r\n    if (isCurrentShiftUser && !canDeleteCurrentShiftUser) {\r\n      toast({ title: '  ', description: '            ' });\r\n      return;\r\n    }\r\n\r\n    const confirmMsg = `      ${usernameToDelete}\\n\\n     .`;\r\n    if (!window.confirm(confirmMsg)) return;\r\n\r\n    setUsers((prev) => prev.filter((u) => u.username !== usernameToDelete));\r\n\r\n    //                 \r\n    if (isCurrentShiftUser) {\r\n      setShiftUser(null);\r\n    }\r\n\r\n    toast({ title: '  ', description: usernameToDelete });\r\n  };\r\n\r\n  const handleAddUser = () => {\r\n    if (!name.trim() || !username.trim() || !password.trim()) return;\r\n    if (users.length >= maxCashiers) {\r\n      toast({\r\n        title: '   ',\r\n        description: `    ${Number.isFinite(maxCashiers) ? maxCashiers : '  '}  `,\r\n        variant: 'destructive',\r\n      });\r\n      return;\r\n    }\r\n    const newUser: CashierUser = { name: name.trim(), username: username.trim(), password: password.trim() };\r\n    setUsers(prev => [newUser, ...prev]);\r\n    //         \r\n    setName('');\r\n    setUsername('');\r\n    setPassword('');\r\n  };\r\n\r\n  const handleStartShift = () => {\r\n    //           \r\n    if (!shiftUser) return;\r\n    //          \r\n    try { localStorage.setItem('lastHandoverToAdmin', 'false'); } catch {}\r\n    startShift();\r\n  };\r\n\r\n  const handleEndShift = () => {\r\n    //     :      \r\n    setHandoverDialogOpen(true);\r\n    setHandoverMode(null);\r\n    setHandoverSelectedUser(null);\r\n    setHandoverPassword('');\r\n    setHandoverError('');\r\n  };\r\n\r\n  const computeShiftTotals = async () => {\r\n    try {\r\n      // 1)  :    Firestore\r\n      let transactions: any[] = [];\r\n      try {\r\n        if (user?.uid) {\r\n          transactions = await userDataService.getUserTransactions(user.uid);\r\n        }\r\n      } catch {}\r\n\r\n      // 2)     (  )      \r\n      if (!transactions || transactions.length === 0) {\r\n        try {\r\n          const res = await getLastTransactions({ merchantUserId: user?.uid, limit: 200 });\r\n          transactions = res?.transactions || [];\r\n        } catch {\r\n          //      \r\n        }\r\n      }\r\n\r\n      //         \r\n\r\n      const startTime = shiftStartAt ? new Date(shiftStartAt) : null;\r\n      const now = new Date();\r\n\r\n      const isWithdrawTx = (t: any) => {\r\n        const type = t.type;\r\n        const xn = (t as any).txnType;\r\n        return (\r\n          type === 'withdraw' ||\r\n          type === 'withdrawal' ||\r\n          type === 'receive' ||\r\n          xn === 'receive'\r\n        );\r\n      };\r\n\r\n      const isSendTx = (t: any) => {\r\n        const type = t.type;\r\n        const xn = (t as any).txnType;\r\n        return (\r\n          type === 'send' ||\r\n          type === 'transfer' ||\r\n          xn === 'send'\r\n        );\r\n      };\r\n\r\n      const parseDate = (val: any) => {\r\n        if (!val) return null;\r\n        if (val instanceof Date) return val;\r\n        //    ISO  Timestamp  Firebase\r\n        try {\r\n          const d = new Date(val);\r\n          return Number.isNaN(d.getTime()) ? null : d;\r\n        } catch {\r\n          return null;\r\n        }\r\n      };\r\n\r\n      const inShiftWindow = (t: any) => {\r\n        const created = parseDate((t as any).createdAt || (t as any).created_at || (t as any).timestamp);\r\n        if (!created) return false;\r\n        if (startTime && created < startTime) return false;\r\n        return created <= now;\r\n      };\r\n\r\n      const isCompletedStatus = (s: any) => {\r\n        return s === 'completed' || s === 'confirmed'; //     Firebase\r\n      };\r\n\r\n      const completed = transactions.filter((t: any) => isCompletedStatus(t.status) && inShiftWindow(t));\r\n\r\n      const totalWithdrawals = completed\r\n        .filter((t: any) => isWithdrawTx(t))\r\n        .reduce((sum: number, t: any) => {\r\n          const amount = (t as any).withdrawnAmount ?? (t as any).receivedAmount ?? (t as any).amount ?? 0;\r\n          return sum + (Number(amount) || 0);\r\n        }, 0);\r\n\r\n      const totalTransfers = completed\r\n        .filter((t: any) => isSendTx(t))\r\n        .reduce((sum: number, t: any) => {\r\n          const amount = (t as any).sentAmount ?? (t as any).transferredAmount ?? (t as any).amount ?? 0;\r\n          return sum + (Number(amount) || 0);\r\n        }, 0);\r\n\r\n      return { totalTransfers, totalWithdrawals };\r\n    } catch {\r\n      return { totalTransfers: 0, totalWithdrawals: 0 };\r\n    }\r\n  };\r\n\r\n  //   :         \r\n  useEffect(() => {\r\n    if (!reportDialogOpen) return;\r\n    //           \r\n    try {\r\n      const d = localStorage.getItem('shiftInitialReceivedDrawerFunds');\r\n      if (d !== null) setReceivedDrawerFunds(d);\r\n    } catch {}\r\n    try {\r\n      const w = localStorage.getItem('shiftInitialReceivedWalletBalancesTotal');\r\n      if (w !== null) {\r\n        const v = parseFloat(w);\r\n        setReceivedWalletBalancesTotal(Number.isFinite(v) ? v : 0);\r\n      }\r\n    } catch {}\r\n  }, [reportDialogOpen]);\r\n\r\n  useEffect(() => {\r\n    if (!handoverDialogOpen) return;\r\n    (async () => {\r\n      try {\r\n        const t = await computeShiftTotals();\r\n        setReportTotals(t);\r\n      } catch {}\r\n    })();\r\n  }, [handoverDialogOpen]);\r\n\r\n  //        \r\n  useEffect(() => {\r\n    if (!open && !deliveryReportsDialogOpen) return;\r\n    const loadReports = async () => {\r\n      try {\r\n        const txs = user?.uid ? await userDataService.getUserTransactions(user.uid) : [];\r\n        const reports = (txs || []).filter((t: any) => t?.type === 'report' || (t?.title || '').includes('  '));\r\n        reports.sort((a: any, b: any) => {\r\n          const ad = new Date(a.createdAt || 0).getTime();\r\n          const bd = new Date(b.createdAt || 0).getTime();\r\n          return bd - ad;\r\n        });\r\n        setDeliveryReports(reports);\r\n      } catch {\r\n        setDeliveryReports([]);\r\n      }\r\n    };\r\n    loadReports();\r\n  }, [open, reportDialogOpen, deliveryReportsDialogOpen, user?.uid]);\r\n\r\n  const saveShiftReceiptToRecent = async (totals: { totalTransfers: number; totalWithdrawals: number }, deficit: boolean, deficitAmt: number) => {\r\n    try {\r\n      //          \r\n      let initialDrawerFunds = 0;\r\n      let initialWalletBalancesTotal = 0;\r\n      try {\r\n        const d = parseFloat(localStorage.getItem('shiftInitialReceivedDrawerFunds') || '0');\r\n        initialDrawerFunds = Number.isFinite(d) ? d : 0;\r\n      } catch {}\r\n      try {\r\n        const w = parseFloat(localStorage.getItem('shiftInitialReceivedWalletBalancesTotal') || '0');\r\n        initialWalletBalancesTotal = Number.isFinite(w) ? w : 0;\r\n      } catch {}\r\n      const receipt = {\r\n        id: `shift_receipt_${Date.now()}`,\r\n        type: 'report',\r\n        senderPhone: shiftUser?.username || 'cashier',\r\n        receiverPhone: handoverTargetLabel || 'admin',\r\n        amount: 0,\r\n        status: 'completed',\r\n        createdAt: new Date().toISOString(),\r\n        title: '  ',\r\n        //          \r\n        cashierName: shiftUser?.name || shiftUser?.username || null,\r\n        deficit: deficit,\r\n        deficitAmount: deficit ? deficitAmt : 0,\r\n        shiftStartAt,\r\n        //   \r\n        receivedDrawerFunds: initialDrawerFunds,\r\n        receivedWalletBalancesTotal: initialWalletBalancesTotal,\r\n        receivedWalletBalances: receivedWalletBalancesMap,\r\n        deliveredDrawerFunds: deliveredDrawerFunds || 0,\r\n        deliveredWalletBalancesTotal: deliveredWalletBalancesTotal || 0,\r\n        deliveredWalletBalances: deliveredWalletBalancesMap,\r\n        //      \r\n        shiftProfit: Math.round((((deliveredDrawerFunds || 0) + (deliveredWalletBalancesTotal || 0)) - (initialDrawerFunds + initialWalletBalancesTotal)) * 100) / 100,\r\n      };\r\n\r\n      if (user?.uid) {\r\n        await userDataService.saveUserTransaction(user.uid, receipt);\r\n      }\r\n\r\n      //       \r\n      setDeliveryReports(prev => [receipt, ...(prev || [])]);\r\n    } catch {}\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={open} onOpenChange={onOpenChange}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n        <DialogTitle>{isShiftActive ? '  ' : '  '}</DialogTitle>\r\n          </DialogHeader>\r\n          {!isShiftActive ? (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"text-xs text-gray-600\">       \"  \"  .</div>\r\n\r\n              {/*    */}\r\n              {users.length > 0 && (\r\n                <div className=\"mt-4 border-t pt-3\">\r\n                  <div className=\"text-sm font-medium mb-2\"> </div>\r\n                  <div className=\"space-y-2 max-h-48 overflow-auto\">\r\n                    {users.map((u, idx) => (\r\n                      <div key={idx} className=\"flex items-center justify-between rounded border px-3 py-2\">\r\n                        <div>\r\n                          <div className=\"text-sm font-semibold\">{u.name}</div>\r\n                          <div className=\"text-xs text-gray-500\">{u.username}</div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2 flex-wrap\">\r\n                          <Button size=\"sm\" className=\"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white\" onClick={() => { setSelectedUser(u); setAuthDialogOpen(true); }}></Button>\r\n                          <Button size=\"sm\" className=\"w-full sm:w-auto\" variant=\"destructive\" onClick={() => handleDeleteUser(u.username)}></Button>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"p-3 rounded border bg-gray-50\">\r\n                <div className=\"text-sm\">  :</div>\r\n                <div className=\"font-semibold text-sm\">{shiftUser?.name} ({shiftUser?.username})</div>\r\n              </div>\r\n            <div className=\"text-xs text-gray-600\">    \"  \"   .</div>\r\n            </div>\r\n          )}\r\n          <DialogFooter className=\"flex flex-wrap gap-2 justify-between\">\r\n            {!isShiftActive ? (\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                <Button className=\"w-full sm:w-auto bg-emerald-600 hover:bg-emerald-700 text-white\" onClick={() => setAddUserDialogOpen(true)}>  </Button>\r\n                <Button className=\"w-full sm:w-auto\" variant=\"outline\" onClick={() => setDeliveryReportsDialogOpen(true)}> </Button>\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                <Button className=\"w-full sm:w-auto\" variant=\"destructive\" onClick={handleEndShift}>  </Button>\r\n              </div>\r\n            )}\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*     */}\r\n      <Dialog open={addUserDialogOpen} onOpenChange={setAddUserDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>  </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <Label className=\"mb-1 block\"></Label>\r\n              <Input value={name} onChange={(e) => setName(e.target.value)} placeholder=\" \" />\r\n            </div>\r\n            <div>\r\n              <Label className=\"mb-1 block\"> </Label>\r\n              <Input value={username} onChange={(e) => setUsername(e.target.value)} placeholder=\"  \" />\r\n            </div>\r\n            <div>\r\n              <Label className=\"mb-1 block\"> </Label>\r\n              <Input type=\"password\" autoComplete=\"new-password\" value={password} onChange={(e) => setPassword(e.target.value)} placeholder=\"  \" />\r\n            </div>\r\n            <div className=\"text-xs text-gray-500\"> :     .</div>\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              variant=\"secondary\"\r\n              onClick={() => {\r\n                setAddUserDialogOpen(false);\r\n              }}\r\n            ></Button>\r\n            <Button\r\n              onClick={() => {\r\n                if (!name.trim() || !username.trim() || !password.trim()) return;\r\n                handleAddUser();\r\n                setAddUserDialogOpen(false);\r\n              }}\r\n            className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n            > </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*      */}\r\n      <Dialog open={deliveryReportsDialogOpen} onOpenChange={setDeliveryReportsDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-lg\">\r\n          <DialogHeader>\r\n            <DialogTitle> </DialogTitle>\r\n          </DialogHeader>\r\n          {deliveryReports.length === 0 ? (\r\n            <div className=\"text-xs text-gray-600\">     .</div>\r\n          ) : (\r\n            <div className=\"space-y-2 max-h-[60vh] overflow-auto\">\r\n              {deliveryReports.map((r: any) => (\r\n                <div\r\n                  key={r.id}\r\n                  className=\"rounded border px-3 py-2 cursor-pointer hover:bg-gray-50\"\r\n                  onClick={() => {\r\n                    setSelectedDeliveryReport(r);\r\n                    setIsDeliveryReportOpen(true);\r\n                  }}\r\n                >\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div className=\"text-sm font-semibold\">{new Date(r.createdAt).toLocaleString('ar-EG')}</div>\r\n                    <div className=\"text-xs text-gray-500\">: {r.receiverPhone}</div>\r\n                  </div>\r\n                  <div className=\"grid grid-cols-2 gap-2 mt-1\">\r\n                    <div className=\"text-xs text-gray-600\"> : {r.deliveredDrawerFunds ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">  (): {r.deliveredWalletBalancesTotal ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\"> : {r.receivedDrawerFunds ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">  (): {r.receivedWalletBalancesTotal ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\"> : {r.deliveredDrawerFunds ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">  (): {r.deliveredWalletBalancesTotal ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\"> : {r.receivedDrawerFunds ?? 0}</div>\r\n                    <div className=\"text-xs text-gray-600\">  (): {r.receivedWalletBalancesTotal ?? 0}</div>\r\n                    <div className={[\r\n                      'text-xs',\r\n                      ((r.shiftProfit ?? ((r.deliveredDrawerFunds ?? 0) + (r.deliveredWalletBalancesTotal ?? 0) - (r.receivedDrawerFunds ?? 0) - (r.receivedWalletBalancesTotal ?? 0))) >= 0)\r\n                        ? 'text-green-700'\r\n                        : 'text-red-700'\r\n                    ].join(' ')}> : {r.shiftProfit ?? ((r.deliveredDrawerFunds ?? 0) + (r.deliveredWalletBalancesTotal ?? 0) - (r.receivedDrawerFunds ?? 0) - (r.receivedWalletBalancesTotal ?? 0))}</div>\r\n                  </div>\r\n                  {r.deficit && (\r\n                    <div className=\"text-xs text-red-600 mt-1\">: {r.deficitAmount ?? 0}</div>\r\n                  )}\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button variant=\"secondary\" onClick={() => setDeliveryReportsDialogOpen(false)}></Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*        */}\r\n      <Dialog open={isDeliveryReportOpen} onOpenChange={setIsDeliveryReportOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>  </DialogTitle>\r\n          </DialogHeader>\r\n          {selectedDeliveryReport ? (\r\n            <div className=\"space-y-3\">\r\n              <div className=\"p-3 rounded border bg-gray-50\">\r\n                <div className=\"text-sm\">: {new Date(selectedDeliveryReport.createdAt).toLocaleString('ar-EG')}</div>\r\n                <div className=\"text-xs text-gray-600 mt-1\">  : {selectedDeliveryReport.receiverPhone}</div>\r\n              </div>\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2\">  </div>\r\n                  <div className=\"text-xs text-gray-600\">: {selectedDeliveryReport.receivedDrawerFunds ?? 0}</div>\r\n                  <div className=\"text-xs text-gray-600\">  (): {selectedDeliveryReport.receivedWalletBalancesTotal ?? 0}</div>\r\n                </div>\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2\">  </div>\r\n                  <div className=\"text-xs text-gray-600\">: {selectedDeliveryReport.deliveredDrawerFunds ?? 0}</div>\r\n                  <div className=\"text-xs text-gray-600\">  (): {selectedDeliveryReport.deliveredWalletBalancesTotal ?? 0}</div>\r\n                </div>\r\n              </div>\r\n              {selectedDeliveryReport.deficit && (\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2 text-red-600\"></div>\r\n                  <div className=\"text-xs text-red-600\">: {selectedDeliveryReport.deficitAmount ?? 0}</div>\r\n                </div>\r\n              )}\r\n              {/*      */}\r\n              {(selectedDeliveryReport.receivedWalletBalances && Object.keys(selectedDeliveryReport.receivedWalletBalances).length > 0) && (\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2\">  </div>\r\n                  <div className=\"space-y-1\">\r\n                    {Object.entries(selectedDeliveryReport.receivedWalletBalances as Record<string, number>).map(([k, v]) => (\r\n                      <div key={k} className=\"flex items-center justify-between text-xs\">\r\n                        <span className=\"text-gray-600\">{k}</span>\r\n                        <span className=\"font-semibold\">{v}</span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {(selectedDeliveryReport.deliveredWalletBalances && Object.keys(selectedDeliveryReport.deliveredWalletBalances).length > 0) && (\r\n                <div className=\"rounded border p-3\">\r\n                  <div className=\"text-sm font-semibold mb-2\">  </div>\r\n                  <div className=\"space-y-1\">\r\n                    {Object.entries(selectedDeliveryReport.deliveredWalletBalances as Record<string, number>).map(([k, v]) => (\r\n                      <div key={k} className=\"flex items-center justify-between text-xs\">\r\n                        <span className=\"text-gray-600\">{k}</span>\r\n                        <span className=\"font-semibold\">{v}</span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-xs text-gray-600\">    .</div>\r\n          )}\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button variant=\"secondary\" onClick={() => setIsDeliveryReportOpen(false)}></Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*      */}\r\n      <Dialog open={authDialogOpen} onOpenChange={setAuthDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>   </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-3\">\r\n            <div className=\"text-sm\">{selectedUser ? `${selectedUser.name} (${selectedUser.username})` : ''}</div>\r\n            <Input\r\n              type=\"password\"\r\n              autoComplete=\"off\"\r\n              value={enteredPassword}\r\n              onChange={(e) => setEnteredPassword(e.target.value)}\r\n              placeholder=\"  \"\r\n            />\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              variant=\"secondary\"\r\n              onClick={() => { setEnteredPassword(''); setSelectedUser(null); setAuthDialogOpen(false); }}\r\n            ></Button>\r\n            <Button\r\n              className=\"bg-emerald-600 hover:bg-emerald-700 text-white\"\r\n              onClick={() => {\r\n                if (!selectedUser) return;\r\n                if (enteredPassword.trim() !== selectedUser.password) {\r\n                  toast({ title: '   ', description: '    ', variant: 'destructive' });\r\n                  return;\r\n                }\r\n                setShiftUser({ name: selectedUser.name, username: selectedUser.username });\r\n                setEnteredPassword('');\r\n                setAuthDialogOpen(false);\r\n                onOpenChange(false);\r\n                startShift();\r\n                //       \r\n                setInitialIntakeDialogOpen(true);\r\n              }}\r\n            > </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*          */}\r\n      <Dialog open={initialIntakeDialogOpen} onOpenChange={setInitialIntakeDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>   </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"rounded border p-3\">\r\n              <Label className=\"mb-1 block\">    </Label>\r\n              <Input\r\n                type=\"text\"\r\n                inputMode=\"decimal\"\r\n                value={receivedDrawerFunds}\r\n                onChange={(e) => setReceivedDrawerFunds(normalizeDigits(e.target.value))}\r\n                placeholder=\"       \"\r\n              />\r\n            </div>\r\n            <div className=\"rounded border p-3\">\r\n              <Label className=\"mb-1 block\">   ()  </Label>\r\n              <Input\r\n                type=\"text\"\r\n                inputMode=\"decimal\"\r\n                value={Number.isFinite(receivedWalletBalancesTotal) ? receivedWalletBalancesTotal : 0}\r\n                onChange={(e) => {\r\n                  const v = parseFloat(normalizeDigits(e.target.value));\r\n                  setReceivedWalletBalancesTotal(Number.isFinite(v) ? v : 0);\r\n                }}\r\n                placeholder=\"      \"\r\n              />\r\n              <div className=\"text-xs text-gray-600 mt-1\">        .</div>\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              className=\"bg-emerald-600 hover:bg-emerald-700 text-white\"\r\n              onClick={() => {\r\n                const drawer = parseFloat(receivedDrawerFunds);\r\n                const wallets = receivedWalletBalancesTotal;\r\n                const isDrawerValid = Number.isFinite(drawer) && drawer >= 0;\r\n                const isWalletsValid = Number.isFinite(wallets) && wallets >= 0;\r\n                if (!isDrawerValid || !isWalletsValid) {\r\n                  toast({ title: '   ', description: '        ', variant: 'destructive' });\r\n                  return;\r\n                }\r\n                //        \r\n                try {\r\n                  localStorage.setItem('shiftInitialReceivedDrawerFunds', String(drawer));\r\n                  localStorage.setItem('shiftInitialReceivedWalletBalancesTotal', String(wallets));\r\n                } catch {}\r\n                toast({ title: '   ', description: '      ' });\r\n                setInitialIntakeDialogOpen(false);\r\n              }}\r\n            > </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*   :       */}\r\n      <Dialog open={handoverDialogOpen} onOpenChange={(open) => { if (open) setHandoverDialogOpen(true); }}>\r\n        <DialogContent className=\"sm:max-w-md\" hideClose disableOutsideClose disableEscClose>\r\n          <DialogHeader>\r\n            <DialogTitle>  </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            {/*   */}\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                variant={handoverMode === 'toUser' ? 'default' : 'secondary'}\r\n                onClick={() => setHandoverMode('toUser')}\r\n              >   </Button>\r\n              <Button\r\n                variant={handoverMode === 'toAdmin' ? 'default' : 'secondary'}\r\n                onClick={() => setHandoverMode('toAdmin')}\r\n              >   </Button>\r\n            </div>\r\n\r\n            {/*      */}\r\n            {handoverMode === 'toUser' && (\r\n              <div className=\"space-y-3\">\r\n                {users.length === 0 ? (\r\n                  <div className=\"text-sm text-gray-600\">   .    .</div>\r\n                ) : (\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"text-sm font-medium\">    </div>\r\n                    <div className=\"space-y-2 max-h-40 overflow-auto\">\r\n                      {users.map((u, idx) => (\r\n                        <div\r\n                          key={idx}\r\n                          className={`flex items-center justify-between rounded border px-3 py-2 cursor-pointer ${handoverSelectedUser?.username === u.username ? 'bg-indigo-50 border-indigo-200' : ''}`}\r\n                          onClick={() => setHandoverSelectedUser(u)}\r\n                        >\r\n                          <div>\r\n                            <div className=\"text-sm font-semibold\">{u.name}</div>\r\n                            <div className=\"text-xs text-gray-500\">{u.username}</div>\r\n                          </div>\r\n                          <span className=\"text-xs text-gray-400\"></span>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                <div>\r\n                  <Label className=\"mb-1 block\">   </Label>\r\n                  <Input\r\n                    type=\"password\"\r\n                    autoComplete=\"off\"\r\n                    value={handoverPassword}\r\n                    onChange={(e) => setHandoverPassword(e.target.value)}\r\n                    placeholder=\"  \"\r\n                  />\r\n                </div>\r\n                {handoverError && <div className=\"text-xs text-red-600\">{handoverError}</div>}\r\n              </div>\r\n            )}\r\n\r\n            {/*      */}\r\n            {handoverMode === 'toAdmin' && (\r\n              <div className=\"space-y-3\">\r\n                <div className=\"text-sm text-gray-600\">         .</div>\r\n                <Input\r\n                  type=\"password\"\r\n                  autoComplete=\"off\"\r\n                  value={mainPassword}\r\n                  onChange={(e) => setMainPassword(e.target.value)}\r\n                  placeholder=\" \"\r\n                />\r\n                {mainAuthError && (\r\n                  <div className=\"text-xs text-red-600\">{mainAuthError}</div>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              disabled={isHandoverProcessing || !handoverMode}\r\n              onClick={async () => {\r\n                if (!handoverMode) return;\r\n                setIsHandoverProcessing(true);\r\n                try {\r\n                  const totals = reportTotals;\r\n                  computeShiftTotals().then(setReportTotals).catch(() => {});\r\n                  if (handoverMode === 'toUser') {\r\n                    if (!handoverSelectedUser) {\r\n                      setHandoverError('   ');\r\n                      setIsHandoverProcessing(false);\r\n                      return;\r\n                    }\r\n                    if (handoverPassword.trim() !== handoverSelectedUser.password) {\r\n                      setHandoverError('   ');\r\n                      setIsHandoverProcessing(false);\r\n                      return;\r\n                    }\r\n                    //      \r\n                    endShift();\r\n                    setShiftUser({ name: handoverSelectedUser.name, username: handoverSelectedUser.username });\r\n                    startShift();\r\n                    setHandoverTargetLabel(`${handoverSelectedUser.name} (${handoverSelectedUser.username})`);\r\n                    //   :    \r\n                    try { localStorage.setItem('lastHandoverToAdmin', 'false'); } catch {}\r\n                    //  \r\n                    setHandoverDialogOpen(false);\r\n                    setHandoverMode(null);\r\n                    setHandoverSelectedUser(null);\r\n                    setHandoverPassword('');\r\n                    setHandoverError('');\r\n                    onOpenChange(false);\r\n                    //   \r\n                    setReportTotals(totals);\r\n                    setDeficitChoice(null);\r\n                    setDeficitAmount('');\r\n                    setReportDialogOpen(true);\r\n                  } else if (handoverMode === 'toAdmin') {\r\n                    setMainAuthError('');\r\n                    const email = user?.email || '';\r\n                    if (!email) {\r\n                      setMainAuthError('     ');\r\n                      setIsHandoverProcessing(false);\r\n                      return;\r\n                    }\r\n                    const { error } = await signIn(email, mainPassword);\r\n                    if (error) {\r\n                      setMainAuthError('   ');\r\n                      setIsHandoverProcessing(false);\r\n                      return;\r\n                    }\r\n                    //     (  )\r\n                    endShift();\r\n                    //        \r\n                    setShiftUser(null);\r\n                    //         \r\n                    try { localStorage.setItem('lastHandoverToAdmin', 'true'); } catch {}\r\n                    setMainPassword('');\r\n                    setHandoverDialogOpen(false);\r\n                    onOpenChange(false);\r\n                    setHandoverTargetLabel(' ');\r\n                    //   \r\n                    setReportTotals(totals);\r\n                    setDeficitChoice(null);\r\n                    setDeficitAmount('');\r\n                    setReportDialogOpen(true);\r\n                  }\r\n                } catch (e) {\r\n                  setHandoverError('      ');\r\n                } finally {\r\n                  setIsHandoverProcessing(false);\r\n                }\r\n              }}\r\n            className=\"bg-blue-600 hover:bg-blue-700 text-white\"\r\n            > </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/*      */}\r\n      <Dialog open={reportDialogOpen} onOpenChange={setReportDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-lg\" hideClose disableOutsideClose disableEscClose>\r\n          <DialogHeader>\r\n            <DialogTitle>   </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"p-3 rounded border bg-gray-50\">\r\n              <div className=\"text-sm\">   : <span className=\"font-semibold\">{handoverTargetLabel}</span></div>\r\n              {shiftStartAt && (\r\n                <div className=\"text-xs text-gray-600 mt-1\"> : {new Date(shiftStartAt).toLocaleString('ar-EG')}</div>\r\n              )}\r\n              <div className=\"text-xs text-gray-600\"> : {new Date().toLocaleString('ar-EG')}</div>\r\n            </div>\r\n            {/*         */}\r\n            {/*     */}\r\n            <div className=\"space-y-3\">\r\n                <div className=\"grid grid-cols-2 gap-3\">\r\n                  <div className=\"rounded border p-3\">\r\n                    <Label className=\"mb-1 block\">  </Label>\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={receivedDrawerFunds}\r\n                      readOnly\r\n                      disabled\r\n                      placeholder=\"    \"\r\n                    />\r\n                    <div className=\"text-xs text-gray-600 mt-1\">      .</div>\r\n                  </div>\r\n                  <div className=\"rounded border p-3\">\r\n                    <Label className=\"mb-1 block\">   ()</Label>\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={receivedWalletBalancesTotal}\r\n                      readOnly\r\n                      disabled\r\n                      placeholder=\"    \"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                <div className=\"rounded border p-3\">\r\n                  <Label className=\"mb-1 block\">  </Label>\r\n                  <Input\r\n                    type=\"text\"\r\n                    inputMode=\"decimal\"\r\n                    value={deliveredDrawerFunds}\r\n                    onChange={(e) => {\r\n                      const v = parseFloat(normalizeDigits(e.target.value));\r\n                      setDeliveredDrawerFunds(Number.isFinite(v) ? v : 0);\r\n                    }}\r\n                    placeholder=\"      \"\r\n                  />\r\n                  <div className=\"text-xs text-gray-600 mt-1\">       </div>\r\n                </div>\r\n                <div className=\"rounded border p-3\">\r\n                  <Label className=\"mb-1 block\">   ()</Label>\r\n                  <Input\r\n                    type=\"text\"\r\n                    inputMode=\"decimal\"\r\n                    value={deliveredWalletBalancesTotal}\r\n                    onChange={(e) => {\r\n                      const v = parseFloat(normalizeDigits(e.target.value));\r\n                      setDeliveredWalletBalancesTotal(Number.isFinite(v) ? v : 0);\r\n                    }}\r\n                    placeholder=\"    \"\r\n                  />\r\n                  <div className=\"text-xs text-gray-600 mt-1\">       </div>\r\n                </div>\r\n              </div>\r\n              {/*   */}\r\n              <div className=\"rounded border p-3\">\r\n                <div className=\"text-sm font-semibold mb-1\"> </div>\r\n                <div className={[\r\n                  'text-sm',\r\n                  ((((deliveredDrawerFunds ?? 0) + (deliveredWalletBalancesTotal ?? 0) - (((parseFloat(receivedDrawerFunds || '0') || 0)) + (receivedWalletBalancesTotal ?? 0))) >= 0)\r\n                    ? 'text-green-700'\r\n                    : 'text-red-700')\r\n                ].join(' ')}>\r\n                  {Math.round((((deliveredDrawerFunds ?? 0) + (deliveredWalletBalancesTotal ?? 0) - (((parseFloat(receivedDrawerFunds || '0') || 0)) + (receivedWalletBalancesTotal ?? 0))) ) * 100) / 100}\r\n                </div>\r\n                <div className=\"text-xs text-gray-600\">: (  )  + </div>\r\n                <div className=\"mt-2 grid grid-cols-1 gap-2\">\r\n                  <div className=\"rounded border p-2 bg-gray-50\">\r\n                    <div className=\"text-xs text-gray-700\">   ( )</div>\r\n                    <div className=\"text-sm font-semibold text-gray-900\">\r\n                      {Math.round(((deliveredDrawerFunds ?? 0) - ((parseFloat(receivedDrawerFunds || '0') || 0))) * 100) / 100}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <div className=\"text-sm font-medium\">  </div>\r\n              <div className=\"flex gap-2\">\r\n                <Button variant={deficitChoice === 'no' ? 'default' : 'secondary'} onClick={() => setDeficitChoice('no')}></Button>\r\n                <Button variant={deficitChoice === 'yes' ? 'default' : 'secondary'} onClick={() => setDeficitChoice('yes')}></Button>\r\n              </div>\r\n              {deficitChoice === 'yes' && (\r\n                <div>\r\n                  <Label className=\"mb-1 block\"> </Label>\r\n                  <Input type=\"number\" value={deficitAmount} onChange={(e) => setDeficitAmount(e.target.value)} placeholder=\"  \" />\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <DialogFooter className=\"flex gap-2 justify-between\">\r\n            <Button\r\n              onClick={() => {\r\n                const deficit = deficitChoice === 'yes';\r\n                const amt = parseFloat(deficitAmount) || 0;\r\n                (async () => { await saveShiftReceiptToRecent(reportTotals, deficit, amt); })();\r\n                toast({ title: '    ', description: '        ' });\r\n                setReportDialogOpen(false);\r\n              }}\r\n            className=\"bg-emerald-600 hover:bg-emerald-700 text-white\"\r\n            >  </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default CashierShiftModal;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useShift } from '@/contexts/ShiftContext';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { db } from '@/firebase';\r\nimport { doc, getDoc } from 'firebase/firestore';\r\n\r\ninterface Props {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\ntype CashierUser = { name: string; username: string; password: string };\r\n\r\nconst ShiftProfileDialog: React.FC<Props> = ({ open, onOpenChange }) => {\r\n  const { shiftUser, endShift, setShiftUser } = useShift();\r\n  const [enteredPassword, setEnteredPassword] = useState('');\r\n  const [error, setError] = useState('');\r\n  const [users, setUsers] = useState<CashierUser[]>([]);\r\n  const { user } = useFirebaseAuth();\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      //             fallback \r\n      try {\r\n        if (user?.uid) {\r\n          const ref = doc(db, 'profiles', user.uid, 'cashierUsers', 'list');\r\n          const snap = await getDoc(ref);\r\n          if (snap.exists()) {\r\n            const data = snap.data() as any;\r\n            const cloudUsers: CashierUser[] = Array.isArray(data?.users) ? data.users : [];\r\n            if (cloudUsers && cloudUsers.length > 0) {\r\n              setUsers(cloudUsers);\r\n              return;\r\n            }\r\n          }\r\n        }\r\n      } catch {}\r\n      try {\r\n        const key = `cashierUsers_${user?.uid || 'default'}`;\r\n        let saved = localStorage.getItem(key);\r\n        //             \r\n        if (!saved) {\r\n          const legacy = localStorage.getItem('cashierUsers');\r\n          if (legacy) saved = legacy;\r\n        }\r\n        setUsers(saved ? JSON.parse(saved) : []);\r\n      } catch {\r\n        setUsers([]);\r\n      }\r\n    })();\r\n  }, [open, user?.uid]);\r\n\r\n  //       \r\n  useEffect(() => {\r\n    if (!open || !user?.uid) return;\r\n    \r\n    const fetchCashierUsers = async () => {\r\n      try {\r\n        const ref = doc(db, 'profiles', user.uid, 'cashierUsers', 'list');\r\n        const snap = await getDoc(ref);\r\n        if (snap.exists()) {\r\n          const data = snap.data() as any;\r\n          const cloudUsers: CashierUser[] = Array.isArray(data?.users) ? data.users : [];\r\n          if (cloudUsers && cloudUsers.length > 0) {\r\n            setUsers(cloudUsers);\r\n          } else {\r\n             // Fallback to local storage\r\n             loadFromLocal();\r\n          }\r\n        } else {\r\n          loadFromLocal();\r\n        }\r\n      } catch (err) {\r\n        console.warn('ShiftProfileDialog cashierUsers fetch error:', err);\r\n        loadFromLocal();\r\n      }\r\n    };\r\n\r\n    const loadFromLocal = () => {\r\n      try {\r\n        const key = `cashierUsers_${user?.uid || 'default'}`;\r\n        let saved = localStorage.getItem(key);\r\n        if (!saved) {\r\n          const legacy = localStorage.getItem('cashierUsers');\r\n          if (legacy) saved = legacy;\r\n        }\r\n        setUsers(saved ? JSON.parse(saved) : []);\r\n      } catch {\r\n        setUsers([]);\r\n      }\r\n    };\r\n\r\n    fetchCashierUsers();\r\n  }, [open, user?.uid]);\r\n\r\n  const handleEndShift = async () => {\r\n    setError('');\r\n    if (!shiftUser) return;\r\n    const match = users.find(u => u.username === shiftUser.username);\r\n    if (!match) {\r\n      setError('     ');\r\n      return;\r\n    }\r\n    if (enteredPassword.trim() !== match.password) {\r\n      setError('   ');\r\n      return;\r\n    }\r\n    //       \r\n    endShift();\r\n    setShiftUser(null);\r\n    setEnteredPassword('');\r\n    onOpenChange(false);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={(o) => { setEnteredPassword(''); setError(''); onOpenChange(o); }}>\r\n      <DialogContent className=\"sm:max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle> </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        {shiftUser ? (\r\n          <div className=\"space-y-3\">\r\n            <div className=\"rounded-lg border p-3 bg-gradient-to-r from-blue-50 to-indigo-50\">\r\n              <div className=\"text-sm font-semibold text-gray-800\">{shiftUser.name}</div>\r\n              <div className=\"text-xs text-gray-600\">{shiftUser.username}</div>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label className=\"block\">    </Label>\r\n              <Input\r\n                type=\"password\"\r\n                value={enteredPassword}\r\n                onChange={(e) => setEnteredPassword(e.target.value)}\r\n                placeholder=\"  \"\r\n                dir=\"ltr\"\r\n              />\r\n              {error && (\r\n                <div className=\"text-red-600 text-xs\">{error}</div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-sm text-gray-600\">     </div>\r\n        )}\r\n\r\n        <DialogFooter className=\"flex justify-between\">\r\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)}></Button>\r\n          <Button onClick={handleEndShift} disabled={!shiftUser}> </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default ShiftProfileDialog;","import React from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { ListChecks, Sparkles, Wrench } from 'lucide-react';\r\n\r\ninterface ChangeLogDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nexport const ChangeLogDialog: React.FC<ChangeLogDialogProps> = ({ open, onOpenChange }) => {\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-lg rounded-2xl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"text-right flex items-center gap-2 justify-end\">\r\n            <ListChecks className=\"w-5 h-5\" />\r\n              \r\n          </DialogTitle>\r\n          <DialogDescription className=\"text-right\">\r\n                   .\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4\">\r\n          <div className=\"flex items-start gap-3\">\r\n            <Wrench className=\"w-5 h-5 text-amber-600 mt-1\" />\r\n            <div className=\"text-right\">\r\n              <div className=\"font-semibold\">   </div>\r\n              <div className=\"text-sm text-muted-foreground\">    (prompt)      .</div>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-start gap-3\">\r\n            <Sparkles className=\"w-5 h-5 text-violet-600 mt-1\" />\r\n            <div className=\"text-right\">\r\n              <div className=\"font-semibold\">  </div>\r\n              <div className=\"text-sm text-muted-foreground\">   \"  \"      .</div>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-start gap-3\">\r\n            <ListChecks className=\"w-5 h-5 text-green-600 mt-1\" />\r\n            <div className=\"text-right\">\r\n              <div className=\"font-semibold\">   </div>\r\n              <div className=\"text-sm text-muted-foreground\">          .</div>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-start gap-3\">\r\n            <ListChecks className=\"w-5 h-5 text-blue-600 mt-1\" />\r\n            <div className=\"text-right\">\r\n              <div className=\"font-semibold\">   </div>\r\n              <div className=\"text-sm text-muted-foreground\">         .</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex justify-end gap-2 mt-6\">\r\n          <Button variant=\"secondary\" onClick={() => onOpenChange(false)}></Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default ChangeLogDialog;","/**\r\n *         \r\n * \r\n *    :\r\n * 1. :       \r\n * 2. :       \r\n * 3.       \r\n */\r\n\r\nimport { walletDailyLimitsService } from './walletDailyLimitsService';\r\n\r\nexport interface WalletBalance {\r\n  [walletId: string]: number;\r\n}\r\n\r\nexport interface TransactionResult {\r\n  success: boolean;\r\n  newCashBalance: number;\r\n  newWalletBalances: WalletBalance;\r\n  message: string;\r\n  error?: string;\r\n}\r\n\r\nexport interface TransferOperation {\r\n  amount: number;\r\n  currentCashBalance: number;\r\n  currentWalletBalances: WalletBalance;\r\n  wallets: Array<{ id: string; name: string; isDefault?: boolean }>;\r\n  selectedWalletId?: string; //    \r\n  //  :         \r\n  skipRemoteLimitsCheck?: boolean;\r\n  nonBlockingUsageUpdate?: boolean;\r\n}\r\n\r\nexport interface WithdrawOperation {\r\n  amount: number;\r\n  currentCashBalance: number;\r\n  currentWalletBalances: WalletBalance;\r\n  wallets: Array<{ id: string; name: string; isDefault?: boolean }>;\r\n  selectedWalletId?: string; //    \r\n  //  :         \r\n  skipRemoteLimitsCheck?: boolean;\r\n  nonBlockingUsageUpdate?: boolean;\r\n}\r\n\r\nexport class WalletCashService {\r\n  \r\n  /**\r\n   *  :       \r\n   *      \r\n   * @param operation   \r\n   * @returns  \r\n   */\r\n  static async processTransfer(operation: TransferOperation): Promise<TransactionResult> {\r\n    const { amount, currentCashBalance, currentWalletBalances, wallets, selectedWalletId } = operation;\r\n    \r\n    //    \r\n    if (amount <= 0) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"INVALID_AMOUNT\"\r\n      };\r\n    }\r\n\r\n    //       \r\n    if (selectedWalletId && !operation.skipRemoteLimitsCheck) {\r\n      try {\r\n        const limitCheck = await walletDailyLimitsService.canPerformOperation(selectedWalletId, amount, 'transfer');\r\n        if (!limitCheck.canPerform) {\r\n          return {\r\n            success: false,\r\n            newCashBalance: currentCashBalance,\r\n            newWalletBalances: currentWalletBalances,\r\n            message: limitCheck.message || \"   \",\r\n            error: \"LIMIT_EXCEEDED\"\r\n          };\r\n        }\r\n      } catch (error) {\r\n        console.error('     :', error);\r\n        return {\r\n          success: false,\r\n          newCashBalance: currentCashBalance,\r\n          newWalletBalances: currentWalletBalances,\r\n          message: \"     \",\r\n          error: \"LIMIT_CHECK_ERROR\"\r\n        };\r\n      }\r\n    }\r\n    \r\n    //    \r\n    if (amount <= 0) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"INVALID_AMOUNT\"\r\n      };\r\n    }\r\n\r\n    //         \r\n    if (selectedWalletId) {\r\n      const available = Math.max(currentWalletBalances[selectedWalletId] || 0, 0);\r\n      if (available < amount) {\r\n        const target = wallets.find(w => w.id === selectedWalletId);\r\n        return {\r\n          success: false,\r\n          newCashBalance: currentCashBalance,\r\n          newWalletBalances: currentWalletBalances,\r\n          message: `    ${target ? ` ${target.name}` : ''}. : ${available}  : ${amount} `,\r\n          error: \"INSUFFICIENT_WALLET_BALANCE\"\r\n        };\r\n      }\r\n    } else {\r\n      const totalAvailable = WalletCashService.calculateTotalWalletBalance(currentWalletBalances);\r\n      if (totalAvailable < amount) {\r\n        return {\r\n          success: false,\r\n          newCashBalance: currentCashBalance,\r\n          newWalletBalances: currentWalletBalances,\r\n          message: `    .  : ${totalAvailable}   : ${amount} `,\r\n          error: \"INSUFFICIENT_WALLET_BALANCE\"\r\n        };\r\n      }\r\n    }\r\n\r\n    //       \r\n    const newWalletBalances = { ...currentWalletBalances };\r\n\r\n    if (selectedWalletId) {\r\n      const currentBalance = newWalletBalances[selectedWalletId] || 0;\r\n      newWalletBalances[selectedWalletId] = currentBalance - amount;\r\n    } else {\r\n      let remainingAmount = amount;\r\n      for (const wallet of wallets) {\r\n        if (remainingAmount <= 0) break;\r\n        const currentBalance = Math.max(newWalletBalances[wallet.id] || 0, 0);\r\n        const deductAmount = Math.min(currentBalance, remainingAmount);\r\n        if (deductAmount > 0) {\r\n          newWalletBalances[wallet.id] = (newWalletBalances[wallet.id] || 0) - deductAmount;\r\n          remainingAmount -= deductAmount;\r\n        }\r\n      }\r\n      //   :      \r\n    }\r\n\r\n    const newCashBalance = currentCashBalance + amount;\r\n\r\n    \r\n\r\n    //         \r\n    let message = \"  \";\r\n    if (selectedWalletId) {\r\n      const afterBalance = newWalletBalances[selectedWalletId] || 0;\r\n      if (afterBalance < 0) {\r\n        message = `    :   ${selectedWalletId}  ${afterBalance} .`;\r\n      }\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      newCashBalance,\r\n      newWalletBalances,\r\n      message\r\n    };\r\n  }\r\n\r\n  /**\r\n   *  :       \r\n   * @param operation   \r\n   * @returns  \r\n   */\r\n  static processDeposit(operation: TransferOperation): TransactionResult {\r\n    const { amount, currentCashBalance, currentWalletBalances, wallets } = operation;\r\n    \r\n    //    \r\n    if (amount <= 0) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"INVALID_AMOUNT\"\r\n      };\r\n    }\r\n\r\n    //       \r\n    const totalWalletBalance = this.calculateTotalWalletBalance(currentWalletBalances);\r\n    if (totalWalletBalance < amount) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: `    .  : ${totalWalletBalance}   : ${amount} `,\r\n        error: \"INSUFFICIENT_WALLET_BALANCE\"\r\n      };\r\n    }\r\n\r\n    //    \r\n    const newCashBalance = currentCashBalance + amount;\r\n\r\n    //    \r\n    const newWalletBalances = { ...currentWalletBalances };\r\n    let remainingAmount = amount;\r\n\r\n    //     \r\n    const defaultWallet = wallets.find(w => w.isDefault);\r\n    \r\n    if (defaultWallet && newWalletBalances[defaultWallet.id] >= remainingAmount) {\r\n      //        \r\n      newWalletBalances[defaultWallet.id] -= remainingAmount;\r\n      remainingAmount = 0;\r\n    } else {\r\n      //     \r\n      for (const wallet of wallets) {\r\n        if (remainingAmount <= 0) break;\r\n        \r\n        const balance = newWalletBalances[wallet.id] || 0;\r\n        if (balance > 0) {\r\n          const deductAmount = Math.min(balance, remainingAmount);\r\n          newWalletBalances[wallet.id] = balance - deductAmount;\r\n          remainingAmount -= deductAmount;\r\n        }\r\n      }\r\n    }\r\n\r\n    const message = remainingAmount > 0 \r\n      ? `  .   ${amount - remainingAmount}    `\r\n      : `  .   ${amount}    `;\r\n\r\n    return {\r\n      success: true,\r\n      newCashBalance,\r\n      newWalletBalances,\r\n      message\r\n    };\r\n  }\r\n\r\n  /**\r\n   *  :       \r\n   * @param operation   \r\n   * @returns  \r\n   */\r\n  static async processWithdraw(operation: WithdrawOperation): Promise<TransactionResult> {\r\n    const { amount, currentCashBalance, currentWalletBalances, wallets, selectedWalletId } = operation;\r\n    \r\n    //    \r\n    if (amount <= 0) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"INVALID_AMOUNT\"\r\n      };\r\n    }\r\n\r\n    //       \r\n    if (selectedWalletId && !operation.skipRemoteLimitsCheck) {\r\n      try {\r\n        const limitCheck = await walletDailyLimitsService.canPerformOperation(selectedWalletId, amount, 'withdraw');\r\n        if (!limitCheck.canPerform) {\r\n          return {\r\n            success: false,\r\n            newCashBalance: currentCashBalance,\r\n            newWalletBalances: currentWalletBalances,\r\n            message: limitCheck.message || \"   \",\r\n            error: \"LIMIT_EXCEEDED\"\r\n          };\r\n        }\r\n      } catch (error) {\r\n        console.error('     :', error);\r\n        return {\r\n          success: false,\r\n          newCashBalance: currentCashBalance,\r\n          newWalletBalances: currentWalletBalances,\r\n          message: \"     \",\r\n          error: \"LIMIT_CHECK_ERROR\"\r\n        };\r\n      }\r\n    }\r\n\r\n    //        \r\n    if (currentCashBalance < amount) {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: `     .  : ${currentCashBalance}   : ${amount} `,\r\n        error: \"INSUFFICIENT_CASH_BALANCE\"\r\n      };\r\n    }\r\n\r\n    //     \r\n    const newCashBalance = currentCashBalance - amount;\r\n\r\n    //     \r\n    const newWalletBalances = { ...currentWalletBalances };\r\n    const targetWallet = selectedWalletId ? wallets.find(w => w.id === selectedWalletId) : (wallets.find(w => w.isDefault) || wallets[0]);\r\n    \r\n    if (targetWallet) {\r\n      const currentBalance = newWalletBalances[targetWallet.id] || 0;\r\n      newWalletBalances[targetWallet.id] = currentBalance + amount;\r\n    } else {\r\n      return {\r\n        success: false,\r\n        newCashBalance: currentCashBalance,\r\n        newWalletBalances: currentWalletBalances,\r\n        message: \"      \",\r\n        error: \"NO_WALLETS_AVAILABLE\"\r\n      };\r\n    }\r\n\r\n    \r\n\r\n    return {\r\n      success: true,\r\n      newCashBalance,\r\n      newWalletBalances,\r\n      message: `  .   ${amount}    ${targetWallet?.name || ''}`\r\n    };\r\n  }\r\n\r\n  /**\r\n   *       \r\n   * @param amount \r\n   * @param wallets  \r\n   * @returns true    \r\n   */\r\n  static validateOperation(amount: number, wallets: Array<{ id: string; name: string }>): { valid: boolean; error?: string } {\r\n    if (amount <= 0) {\r\n      return { valid: false, error: \"      \" };\r\n    }\r\n\r\n    if (!wallets || wallets.length === 0) {\r\n      return { valid: false, error: \"   \" };\r\n    }\r\n\r\n    return { valid: true };\r\n  }\r\n\r\n  /**\r\n   *    \r\n   * @param walletBalances  \r\n   * @returns  \r\n   */\r\n  static calculateTotalWalletBalance(walletBalances: WalletBalance): number {\r\n    return Object.values(walletBalances).reduce((total, balance) => total + Math.max(balance, 0), 0);\r\n  }\r\n\r\n  /**\r\n   *         ()\r\n   * @param amount   \r\n   * @param currentCashBalance    \r\n   * @param currentWalletBalances   \r\n   * @param wallets  \r\n   * @returns  \r\n   */\r\n  static deductFromWalletsAddToCash(\r\n    amount: number,\r\n    currentCashBalance: number,\r\n    currentWalletBalances: WalletBalance,\r\n    wallets: Array<{ id: string; name: string; isDefault?: boolean }>\r\n  ): TransactionResult {\r\n    return this.processTransfer({\r\n      amount,\r\n      currentCashBalance,\r\n      currentWalletBalances,\r\n      wallets\r\n    });\r\n  }\r\n\r\n  /**\r\n   *         ()\r\n   * @param amount   \r\n   * @param currentCashBalance    \r\n   * @param currentWalletBalances   \r\n   * @param wallets  \r\n   * @returns  \r\n   */\r\n  static deductFromWalletsAddToCashDeposit(\r\n    amount: number,\r\n    currentCashBalance: number,\r\n    currentWalletBalances: WalletBalance,\r\n    wallets: Array<{ id: string; name: string; isDefault?: boolean }>\r\n  ): TransactionResult {\r\n    return this.processDeposit({\r\n      amount,\r\n      currentCashBalance,\r\n      currentWalletBalances,\r\n      wallets\r\n    });\r\n  }\r\n\r\n  /**\r\n   *         ()\r\n   * @param amount   \r\n   * @param currentCashBalance    \r\n   * @param currentWalletBalances   \r\n   * @param wallets  \r\n   * @returns  \r\n   */\r\n  static deductFromCashAddToWallets(\r\n    amount: number,\r\n    currentCashBalance: number,\r\n    currentWalletBalances: WalletBalance,\r\n    wallets: Array<{ id: string; name: string; isDefault?: boolean }>\r\n  ): TransactionResult {\r\n    return this.processWithdraw({\r\n      amount,\r\n      currentCashBalance,\r\n      currentWalletBalances,\r\n      wallets\r\n    });\r\n  }\r\n\r\n  /**\r\n   *        \r\n   * @param result  \r\n   * @param updateCashBalance    \r\n   * @param updateWalletBalances    \r\n   */\r\n  static applyTransactionResult(\r\n    result: TransactionResult,\r\n    updateCashBalance: (newBalance: number) => void,\r\n    updateWalletBalances: (newBalances: WalletBalance) => void\r\n  ): void {\r\n    if (result.success) {\r\n      updateCashBalance(result.newCashBalance);\r\n      updateWalletBalances(result.newWalletBalances);\r\n    }\r\n  }\r\n\r\n  /**\r\n   *      \r\n   * @param amount \r\n   * @param operationType   (transfer  withdraw  deposit)\r\n   * @param currentCashBalance    \r\n   * @param currentWalletBalances   \r\n   * @returns  \r\n   */\r\n  static validateTransaction(\r\n    amount: number,\r\n    operationType: 'transfer' | 'withdraw' | 'deposit',\r\n    currentCashBalance: number,\r\n    currentWalletBalances: WalletBalance\r\n  ): { isValid: boolean; warning?: string; error?: string } {\r\n    if (amount <= 0) {\r\n      return {\r\n        isValid: false,\r\n        error: \"      \"\r\n      };\r\n    }\r\n\r\n    if (operationType === 'transfer') {\r\n      const totalWalletBalance = this.calculateTotalWalletBalance(currentWalletBalances);\r\n      if (totalWalletBalance < amount) {\r\n        return {\r\n          isValid: false,\r\n          error: `    (${totalWalletBalance} )     (${amount} )`\r\n        };\r\n      }\r\n    } else if (operationType === 'withdraw') {\r\n      if (currentCashBalance < amount) {\r\n        return {\r\n          isValid: false,\r\n          error: `     (${currentCashBalance} )     (${amount} )`\r\n        };\r\n      }\r\n    } else if (operationType === 'deposit') {\r\n      const totalWalletBalance = this.calculateTotalWalletBalance(currentWalletBalances);\r\n      if (totalWalletBalance < amount) {\r\n        return {\r\n          isValid: false,\r\n          error: `    (${totalWalletBalance} )     (${amount} )`\r\n        };\r\n      }\r\n    }\r\n\r\n    return { isValid: true };\r\n  }\r\n\r\n  /**\r\n   *        ( )\r\n   * @param amount   \r\n   * @param currentWalletBalances   \r\n   * @param wallets  \r\n   * @returns  \r\n   */\r\n  static getDeductionPreview(\r\n    amount: number, \r\n    currentWalletBalances: WalletBalance, \r\n    wallets: Array<{ id: string; name: string; isDefault?: boolean }>\r\n  ): Array<{ walletId: string; walletName: string; currentBalance: number; deductedAmount: number; newBalance: number }> {\r\n    const preview: Array<{ walletId: string; walletName: string; currentBalance: number; deductedAmount: number; newBalance: number }> = [];\r\n    let remainingAmount = amount;\r\n\r\n    //    \r\n    for (const wallet of wallets) {\r\n      if (remainingAmount <= 0) break;\r\n      \r\n      const currentBalance = currentWalletBalances[wallet.id] || 0;\r\n      const deductAmount = Math.min(Math.max(currentBalance, 0), remainingAmount);\r\n      \r\n      if (deductAmount > 0) {\r\n        preview.push({\r\n          walletId: wallet.id,\r\n          walletName: wallet.name,\r\n          currentBalance,\r\n          deductedAmount: deductAmount,\r\n          newBalance: currentBalance - deductAmount\r\n        });\r\n        remainingAmount -= deductAmount;\r\n      }\r\n    }\r\n\r\n    //       \r\n\r\n    return preview;\r\n  }\r\n}\r\n\r\nexport default WalletCashService;\r\n","// Simple double-beep (\"tin tin\") sound to play on confirmations\r\n// Uses Web Audio API and keeps a singleton AudioContext for reuse\r\n\r\nlet audioCtx: AudioContext | null = null;\r\n\r\nfunction getAudioContext(): AudioContext {\r\n  const AnyWindow = window as any;\r\n  if (!audioCtx) {\r\n    const Ctx = (AnyWindow.AudioContext || AnyWindow.webkitAudioContext);\r\n    audioCtx = new Ctx();\r\n  }\r\n  if (audioCtx.state === 'suspended') {\r\n    // Resume context on user gesture\r\n    audioCtx.resume();\r\n  }\r\n  return audioCtx;\r\n}\r\n\r\nfunction scheduleBeep(ctx: AudioContext, startTime: number, freq: number, durationMs: number) {\r\n  const osc = ctx.createOscillator();\r\n  const gain = ctx.createGain();\r\n  osc.type = 'sine';\r\n  osc.frequency.value = freq;\r\n  osc.connect(gain);\r\n  gain.connect(ctx.destination);\r\n\r\n  const durationSec = durationMs / 1000;\r\n  // soft attack then decay\r\n  gain.gain.setValueAtTime(0.0001, startTime);\r\n  gain.gain.exponentialRampToValueAtTime(0.2, startTime + 0.02);\r\n  gain.gain.exponentialRampToValueAtTime(0.0001, startTime + durationSec);\r\n\r\n  osc.start(startTime);\r\n  osc.stop(startTime + durationSec + 0.02);\r\n}\r\n\r\nexport function playTinTin() {\r\n  try {\r\n    const ctx = getAudioContext();\r\n    const now = ctx.currentTime;\r\n    // First beep\r\n    scheduleBeep(ctx, now, 880, 140);\r\n    // Second beep a short moment later\r\n    scheduleBeep(ctx, now + 0.18, 980, 140);\r\n  } catch (e) {\r\n    // fail silently to avoid breaking UX if audio is unavailable\r\n    // console.warn('Audio playback failed', e);\r\n  }\r\n}\r\n\r\n// --- Vodafone \"Shakshan\" style tone ---\r\n// Approximation using a short noise burst (\"shak\") followed by a brief tone sweep (\"shan\")\r\nfunction scheduleNoiseBurst(ctx: AudioContext, startTime: number, durationMs: number) {\r\n  const durationSec = durationMs / 1000;\r\n  const bufferSize = Math.floor(ctx.sampleRate * durationSec);\r\n  const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);\r\n  const data = buffer.getChannelData(0);\r\n  for (let i = 0; i < bufferSize; i++) {\r\n    // white noise\r\n    data[i] = (Math.random() * 2 - 1) * 0.6;\r\n  }\r\n  const source = ctx.createBufferSource();\r\n  source.buffer = buffer;\r\n\r\n  const filter = ctx.createBiquadFilter();\r\n  filter.type = 'highpass';\r\n  filter.frequency.value = 1500;\r\n  filter.Q.value = 0.7;\r\n\r\n  const gain = ctx.createGain();\r\n  gain.gain.setValueAtTime(0.0001, startTime);\r\n  gain.gain.exponentialRampToValueAtTime(0.4, startTime + 0.015);\r\n  gain.gain.exponentialRampToValueAtTime(0.0001, startTime + durationSec);\r\n\r\n  source.connect(filter);\r\n  filter.connect(gain);\r\n  gain.connect(ctx.destination);\r\n\r\n  source.start(startTime);\r\n  source.stop(startTime + durationSec + 0.01);\r\n}\r\n\r\nfunction scheduleToneSweep(ctx: AudioContext, startTime: number, startFreq: number, endFreq: number, durationMs: number, type: OscillatorType = 'triangle') {\r\n  const osc = ctx.createOscillator();\r\n  const gain = ctx.createGain();\r\n  osc.type = type;\r\n\r\n  const durationSec = durationMs / 1000;\r\n  osc.frequency.setValueAtTime(startFreq, startTime);\r\n  osc.frequency.linearRampToValueAtTime(endFreq, startTime + durationSec);\r\n\r\n  // gentle attack/decay envelope\r\n  gain.gain.setValueAtTime(0.0001, startTime);\r\n  gain.gain.exponentialRampToValueAtTime(0.25, startTime + 0.02);\r\n  gain.gain.exponentialRampToValueAtTime(0.0001, startTime + durationSec);\r\n\r\n  osc.connect(gain);\r\n  gain.connect(ctx.destination);\r\n\r\n  osc.start(startTime);\r\n  osc.stop(startTime + durationSec + 0.02);\r\n}\r\n\r\nexport function playVodafoneShakshan() {\r\n  try {\r\n    const ctx = getAudioContext();\r\n    const now = ctx.currentTime;\r\n    // \"shak\": short filtered noise burst\r\n    scheduleNoiseBurst(ctx, now, 90);\r\n    // \"shan\": brief downward tone sweep\r\n    scheduleToneSweep(ctx, now + 0.12, 1900, 1100, 180, 'sawtooth');\r\n  } catch (e) {\r\n    // silent fail\r\n  }\r\n}\r\n","/**\r\n *       \r\n * Egyptian wallet number validation utilities\r\n */\r\n\r\n//    \r\nexport type WalletProvider = 'vodafone' | 'orange' | 'etisalat' | 'we';\r\n\r\n//   \r\nexport type ValidationErrorCode = \r\n  | 'INVALID_MSISDN'\r\n  | 'PROVIDER_MISMATCH'\r\n  | 'ALREADY_EXISTS'\r\n  | 'UNAUTHENTICATED'\r\n  | 'RLS_DENIED'\r\n  | 'UNKNOWN';\r\n\r\n//  \r\nexport interface ValidationResult {\r\n  isValid: boolean;\r\n  normalizedMsisdn?: string;\r\n  errorCode?: ValidationErrorCode;\r\n  errorMessage?: string;\r\n}\r\n\r\n//      \r\nconst PROVIDER_PREFIXES: Record<WalletProvider, string> = {\r\n  vodafone: '010',\r\n  orange: '012',\r\n  etisalat: '011',\r\n  we: '015'\r\n};\r\n\r\n/**\r\n *   MSISDN    E.164\r\n * @param rawMsisdn     \r\n * @returns    E.164  null    \r\n */\r\nexport function normalizeEgyptianMsisdn(rawMsisdn: string): string | null {\r\n  if (!rawMsisdn) return null;\r\n\r\n  //      \r\n  let cleaned = rawMsisdn.replace(/[^0-9-]/g, '');\r\n  \r\n  //     \r\n  cleaned = cleaned.replace(/[-]/g, (match) => {\r\n    const arabicDigits = '';\r\n    const englishDigits = '0123456789';\r\n    return englishDigits[arabicDigits.indexOf(match)];\r\n  });\r\n\r\n  //     11    01\r\n  if (cleaned.length !== 11 || !cleaned.startsWith('01')) {\r\n    return null;\r\n  }\r\n\r\n  //   E.164: 01XXXXXXXXX  +201XXXXXXXXX\r\n  return `+20${cleaned.substring(1)}`;\r\n}\r\n\r\n/**\r\n *        \r\n * @param provider   \r\n * @param normalizedMsisdn    E.164\r\n * @returns true       \r\n */\r\nexport function validateProviderMatch(provider: WalletProvider, normalizedMsisdn: string): boolean {\r\n  if (!normalizedMsisdn.startsWith('+201')) return false;\r\n  \r\n  //      ( +201)\r\n  const prefix = normalizedMsisdn.substring(3, 6); // +201XXXXXXXXX  0XX\r\n  const expectedPrefix = PROVIDER_PREFIXES[provider];\r\n  \r\n  return prefix === expectedPrefix;\r\n}\r\n\r\n/**\r\n *      \r\n * @param provider  \r\n * @param rawMsisdn  \r\n * @returns        \r\n */\r\nexport function validateWalletNumber(provider: WalletProvider, rawMsisdn: string): ValidationResult {\r\n  //  \r\n  const normalizedMsisdn = normalizeEgyptianMsisdn(rawMsisdn);\r\n  \r\n  if (!normalizedMsisdn) {\r\n    return {\r\n      isValid: false,\r\n      errorCode: 'INVALID_MSISDN',\r\n      errorMessage: '   .  11    01'\r\n    };\r\n  }\r\n\r\n  //    \r\n  if (!validateProviderMatch(provider, normalizedMsisdn)) {\r\n    const expectedPrefix = PROVIDER_PREFIXES[provider];\r\n    return {\r\n      isValid: false,\r\n      errorCode: 'PROVIDER_MISMATCH',\r\n      errorMessage: `  ${getProviderDisplayName(provider)}     ${expectedPrefix}`\r\n    };\r\n  }\r\n\r\n  return {\r\n    isValid: true,\r\n    normalizedMsisdn\r\n  };\r\n}\r\n\r\n/**\r\n *      \r\n * @param provider  \r\n * @returns   \r\n */\r\nexport function getProviderDisplayName(provider: WalletProvider): string {\r\n  const names: Record<WalletProvider, string> = {\r\n    vodafone: ' ',\r\n    orange: ' ',\r\n    etisalat: ' ',\r\n    we: ' '\r\n  };\r\n  return names[provider];\r\n}\r\n\r\n/**\r\n *       \r\n * @param msisd  \r\n * @returns true     \r\n */\r\nexport function quickValidateMsisdn(msisdn: string): boolean {\r\n  if (!msisdn) return false;\r\n  \r\n  //   \r\n  const cleaned = msisdn.replace(/[^0-9-]/g, '');\r\n  \r\n  //   \r\n  const normalized = cleaned.replace(/[-]/g, (match) => {\r\n    const arabicDigits = '';\r\n    const englishDigits = '0123456789';\r\n    return englishDigits[arabicDigits.indexOf(match)];\r\n  });\r\n\r\n  //   : 11    01\r\n  return /^01[0-9]{9}$/.test(normalized);\r\n}\r\n\r\n/**\r\n *  : 11     010  011  012  015\r\n *      /\r\n */\r\nexport function strictValidateMsisdn(msisdn: string): boolean {\r\n  if (!msisdn) return false;\r\n  const cleaned = msisdn.replace(/[^0-9-]/g, '');\r\n  const normalized = cleaned.replace(/[-]/g, (match) => {\r\n    const arabicDigits = '';\r\n    const englishDigits = '0123456789';\r\n    return englishDigits[arabicDigits.indexOf(match)];\r\n  });\r\n  return /^(010|011|012|015)[0-9]{8}$/.test(normalized);\r\n}\r\n\r\n/**\r\n *      \r\n * @param errorCode  \r\n * @returns   \r\n */\r\nexport function getErrorMessage(errorCode: ValidationErrorCode): string {\r\n  const messages: Record<ValidationErrorCode, string> = {\r\n    INVALID_MSISDN: '   .  11    01',\r\n    PROVIDER_MISMATCH: '      ',\r\n    ALREADY_EXISTS: '   ',\r\n    UNAUTHENTICATED: '   ',\r\n    RLS_DENIED: '      ',\r\n    UNKNOWN: '      '\r\n  };\r\n  return messages[errorCode];\r\n}","import React, { useState, useEffect, useLayoutEffect, useRef } from 'react';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { useLocation, useNavigate, useParams } from 'react-router-dom';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Popover, PopoverTrigger, PopoverContent } from '@/components/ui/popover';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from '@/components/ui/dialog';\nimport { Label } from '@/components/ui/label';\nimport { ArrowUpDown, Plus, PlusCircle, Minus, CheckCircle, Check, Clock, XCircle, X, Phone, DollarSign, Wallet, ArrowDownLeft, ArrowUpRight, Trash2, Edit, LogOut, Settings, Banknote, RefreshCw, Search, Calendar, CalendarDays, Download, Calculator, BarChart, Crown, MessageCircle, FileText, Receipt, CreditCard, Eye, User, Wrench, BatteryCharging, ChevronDown, ChevronUp, AlertTriangle, AlertCircle, Store, Notebook, BadgePercent, Send, Code, Smartphone } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { BranchRequestDialog } from \"@/components/BranchRequestDialog\";\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\nimport WalletManagement from '@/components/WalletManagement';\nimport TransactionDetailsModal from '@/components/TransactionDetailsModal';\nimport ReceiptModal from '@/components/ReceiptModal';\n// import { SecretPinDialog } from '@/components/SecretPinDialog';\nimport { EditBalanceDialog } from '@/components/EditBalanceDialog';\nimport { ChangePinDialog } from '@/components/ChangePinDialog';\nimport { ChangeCashPinDialog } from '@/components/ChangeCashPinDialog';\nimport { ChangeWalletTotalPinDialog } from '@/components/ChangeWalletTotalPinDialog';\nimport PasswordConfirmDialog from '@/components/PasswordConfirmDialog';\nimport { auth, db, firebaseConfig } from '@/firebase';\nimport { EmailAuthProvider, reauthenticateWithCredential, getAuth, createUserWithEmailAndPassword, signOut as firebaseSignOut } from 'firebase/auth';\nimport { initializeApp, deleteApp } from 'firebase/app';\nimport { getFirestore, doc as fsDoc, setDoc as fsSetDoc } from 'firebase/firestore';\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\nimport { Switch } from '@/components/ui/switch';\nimport { AddToWalletDialog } from '@/components/AddToWalletDialog';\nimport { walletLimitsService } from '@/utils/walletLimitsService';\nimport walletDailyLimitsService from '@/utils/walletDailyLimitsService';\nimport { reportsService } from '@/utils/reportsService';\nimport ProfileIcon from '@/components/ProfileIcon';\nimport NotificationBell from '@/components/NotificationBell';\nimport LogoLoader from '@/components/LogoLoader';\nimport { CalculatorDialog } from '@/components/CalculatorDialog';\nimport { SalesDataDialog } from '@/components/SalesDataDialog';\nimport { CashSummaryDialog } from '@/components/CashSummaryDialog';\nimport CreditCardsDialog from '@/components/CreditCardsDialog';\nimport InstallmentModal from '@/components/InstallmentModal';\nimport MaintenanceDialog from '@/components/MaintenanceDialog';\nimport MachineDailyDialog from '@/components/MachineDailyDialog';\nimport FawryMachineIcon from '@/components/icons/FawryMachineIcon';\nimport { useDebouncedValue } from '@/hooks/useDebouncedValue';\nimport { ProfitEyeButton } from '@/components/ProfitDisplayDialog';\nimport { MonthlyProfitEyeButton } from '@/components/MonthlyProfitDisplayDialog';\nimport { DailyProfitEyeButton } from '@/components/DailyProfitDisplayDialog';\nimport { WalletsManagement } from '@/components/merchant/WalletsManagement';\nimport { WalletsListDialog } from '@/components/WalletsListDialog';\nimport { useShift } from '@/contexts/ShiftContext';\nimport CashierShiftModal from '@/components/CashierShiftModal';\nimport ShiftProfileDialog from '@/components/ShiftProfileDialog';\nimport ChangeLogDialog from '@/components/ChangeLogDialog';\nimport ChangeLogFloatingButton from '@/components/ChangeLogFloatingButton';\nimport { useShop } from '@/hooks/useShop';\n// Firebase imports\nimport { userDataService, transactionService, merchantWalletService, auditLogService, dailyReportsArchiveService, telegramNotifier } from '@/integrations/firebase/services';\nimport { doc, getDoc, writeBatch, collection, query as fsQuery, where, getDocs, updateDoc, deleteDoc, addDoc, serverTimestamp, setDoc, orderBy, limit, onSnapshot } from 'firebase/firestore';\nimport WalletCashService from '@/utils/walletCashService';\nimport { FreeTrialService } from '@/utils/freeTrialService';\nimport { getUserSubscription, SubscriptionData, isSubscriptionValid, getDaysRemaining, getPlanDisplayName, formatDate, SubscriptionPlan } from '@/utils/subscriptionService';\nimport { MasterPinService } from '@/utils/masterPinService';\nimport { playVodafoneShakshan } from '@/utils/sound';\nimport { strictValidateMsisdn } from '@/utils/walletValidation';\nimport { openUssdDeepLink, sendTransferDeepLink, getUssdCode, getUssdCodeBySender, sendTransferFromWalletDeepLink } from '@/utils/ussdDialer';\nimport { walletSelectionPinService } from '@/utils/walletSelectionPinService';\nimport { Capacitor } from '@capacitor/core';\nimport PinModal from '@/components/PinModal';\nimport { backupToGoogleDrive, restoreFromGoogleDrive, saveGoogleBackupToken } from '@/utils/googleDriveBackup';\nimport { formatNumberEnglish } from '@/utils/formatters';\nimport { Preferences } from '@capacitor/preferences';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport { getAppDownloads, type AppDownloads } from '@/utils/appDownloadService';\n\nasync function waitForOAuthCode(popup: Window): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const timer = setInterval(() => {\n      try {\n        const url = popup.location.href;\n        if (url.includes('/oauth2/callback') && url.includes('code=')) {\n          const u = new URL(url);\n          const code = u.searchParams.get('code');\n          popup.close();\n          clearInterval(timer);\n          if (code) return resolve(code);\n          return reject(new Error('    '));\n        }\n      } catch { }\n      if (popup.closed) {\n        clearInterval(timer);\n        reject(new Error('     '));\n      }\n    }, 500);\n  });\n}\n\nasync function exchangeCodeForRefreshToken(code: string, clientId: string, redirectUri: string): Promise<{ access_token: string; refresh_token: string }> {\n  const clientSecret = String((import.meta as any)?.env?.VITE_GOOGLE_OAUTH_CLIENT_SECRET || '').trim();\n  const body = new URLSearchParams({\n    code,\n    client_id: clientId,\n    grant_type: 'authorization_code',\n    redirect_uri: redirectUri,\n  });\n  if (clientSecret) body.set('client_secret', clientSecret);\n  const resp = await fetch('https://oauth2.googleapis.com/token', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n    body: body.toString(),\n  });\n  const json = await resp.json();\n  if (!resp.ok || !json.refresh_token || !json.access_token) throw new Error('    tokens');\n  return { access_token: String(json.access_token), refresh_token: String(json.refresh_token) };\n}\n\nasync function fetchGoogleEmail(accessToken: string): Promise<string> {\n  const resp = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {\n    headers: { Authorization: `Bearer ${accessToken}` },\n  });\n  const json = await resp.json();\n  return String(json?.email || '');\n}\n\nfunction GoogleBackupBar({ userId }: { userId?: string }) {\n  const [loading, setLoading] = React.useState<'link' | 'backup' | 'restore' | null>(null);\n  const [message, setMessage] = React.useState<string>('');\n\n  async function linkGoogle() {\n    setLoading('link');\n    setMessage('');\n    try {\n      const clientId = String((import.meta as any)?.env?.VITE_GOOGLE_OAUTH_CLIENT_ID || '').trim();\n      const redirectUri = window.location.origin + '/oauth2/callback';\n      const scope = encodeURIComponent('https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.email');\n      const url = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&response_type=code&access_type=offline&prompt=consent&scope=${scope}&redirect_uri=${encodeURIComponent(redirectUri)}`;\n      const popup = window.open(url, '_blank', 'width=500,height=600');\n      if (!popup) throw new Error('    ');\n      const code = await waitForOAuthCode(popup);\n      const token = await exchangeCodeForRefreshToken(code, clientId, redirectUri);\n      const email = await fetchGoogleEmail(token.access_token);\n      const ok = await saveGoogleBackupToken(userId || 'current', email, token.refresh_token);\n      setMessage(ok ? '   ' : '   ');\n    } catch (e: any) {\n      setMessage(e?.message || '  ');\n    } finally {\n      setLoading(null);\n    }\n  }\n\n  async function backup() {\n    setLoading('backup');\n    setMessage('');\n    const res = await backupToGoogleDrive(userId || 'current');\n    setMessage(res.ok ? '   ' : (res.error || ' '));\n    setLoading(null);\n  }\n\n  async function restore() {\n    setLoading('restore');\n    setMessage('');\n    const res = await restoreFromGoogleDrive(userId || 'current');\n    setMessage(res.ok ? '  ' : (res.error || ' '));\n    setLoading(null);\n  }\n\n  //             \n  return null;\n}\n\ninterface Transaction {\n  id: string;\n  type: 'send' | 'receive' | 'withdraw';\n  senderPhone: string;\n  receiverPhone: string;\n  amount: number;\n  status: 'pending' | 'completed' | 'failed';\n  createdAt: Date;\n  provider?: string;\n  withdrawnAmount?: number; //  \n  sentAmount?: number; //  \n  fromWallet?: string; //   \n  //    \n  senderNumber?: string; //  \n  senderName?: string; //    \n  shopName?: string; //  \n  transferredAmount?: number; //  \n  receiverNumber?: string; //  \n  withdrawnAmountDetailed?: number; //   \n  merchantShopName?: string; //        \n  transactionReference?: string; //  \n  commission?: number; // \n  fee?: number; //   \n  notes?: string; //  \n  commissionMode?: 'add' | 'deduct';\n  totalCharged?: number;\n}\n\ninterface DailyStats {\n  date: string;\n  totalTransactions: number;\n  totalAmount: number;\n  totalWithdrawn: number;\n  totalSent: number;\n}\n\ninterface MonthlyStats {\n  month: string;\n  totalTransactions: number;\n  totalAmount: number;\n  totalWithdrawn: number;\n  totalSent: number;\n}\n\ninterface Debt {\n  id: string;\n  debtorName: string;\n  customerId?: string;\n  mobile?: string;\n  amount: number;\n  reason: string;\n  status: 'pending' | 'paid';\n  createdAt: Date;\n  paidAmount?: number;\n  partialPayments?: { amount: number; paidAt: Date }[];\n  lastUpdated?: Date;\n  type?: 'debtor' | 'creditor'; // 'creditor' = User is Creditor (Receivable), 'debtor' = User is Debtor (Payable)\n}\n\ninterface Customer {\n  id: string;\n  name: string;\n  mobile: string;\n  createdAt: Date;\n}\n\ninterface ShopExpense {\n  id: string;\n  name: string;\n  amount: number;\n  notes?: string;\n  source: 'cash' | 'wallet' | 'fawry';\n  walletId?: string;\n  createdAt: Date;\n}\n\ninterface DeficiencyItem {\n  id: string;\n  name: string;\n  quantity: number;\n  status: 'pending' | 'purchased';\n  createdAt: Date;\n}\n\nconst UserDashboardPage = () => {\n  console.log(' UserDashboardPage component is loading...');\n\n  const { toast } = useToast();\n  const formRef = useRef<HTMLDivElement | null>(null);\n  const [formTranslateY, setFormTranslateY] = useState(0);\n\n  //    \n  const handleOpenMobileScreen = async () => {\n    //     \n    const deviceId = selectedAdbDeviceId;\n    \n    if (!deviceId) {\n      toast({ \n        title: '', \n        description: '      ( )', \n        variant: 'destructive' \n      });\n      return;\n    }\n\n    try {\n      const api = (window as any).electronAPI;\n      if (api && api.openScrcpy) {\n        toast({ title: ' ', description: '    ...' });\n        const result = await api.openScrcpy(deviceId);\n        if (!result.success) {\n          toast({ \n            title: '  ', \n            description: `   : ${result.error}`, \n            variant: 'destructive' \n          });\n        }\n      } else {\n        toast({ \n          title: ' ', \n          description: '       ', \n          variant: 'destructive' \n        });\n      }\n    } catch (e: any) {\n      console.error('Scrcpy error:', e);\n      toast({ \n        title: '  ', \n        description: e.message || '      ', \n        variant: 'destructive' \n      });\n    }\n  };\n\n  //     API\n  const submitTopUp = async () => {\n    const allowedEmail = 'alkaptin678678@gmail.com';\n    const userEmail = auth.currentUser?.email?.toLowerCase();\n    if (!userEmail || userEmail !== allowedEmail) {\n      toast({ title: ' ', description: '    .' });\n      return;\n    }\n    if (!topupPhone || !topupOperator || !topupAmount) {\n      toast({ title: ' ', description: '    ', variant: 'destructive' });\n      return;\n    }\n    try {\n      setTopupLoading(true);\n      const idToken = await auth.currentUser?.getIdToken();\n      const resp = await fetch('/api/topup', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(idToken ? { Authorization: `Bearer ${idToken}` } : {}),\n        },\n        body: JSON.stringify({\n          phone: topupPhone,\n          countryCode: 'EG',\n          operator: topupOperator,\n          amount: Number(topupAmount),\n          useLocalAmount: true,\n        })\n      });\n      const data: any = await resp.json().catch(() => ({}));\n      if (resp.ok && data?.success) {\n        toast({ title: ' ', description: data?.message || '    ' });\n        setIsTopUpOpen(false);\n        setTopupPhone('');\n        setTopupOperator('');\n        setTopupAmount('');\n      } else {\n        toast({ title: ' ', description: data?.message || '    ', variant: 'destructive' });\n      }\n    } catch (err) {\n      console.error('Topup request error:', err);\n      toast({ title: '  ', description: '   .  .', variant: 'destructive' });\n    } finally {\n      setTopupLoading(false);\n    }\n  };\n  const { signOut, user, profile } = useFirebaseAuth();\n  const isVodafoneCashUser = ((user?.email || '').toLowerCase() === 'vodafonecash00@gmail.com');\n  const location = useLocation();\n  const navigate = useNavigate();\n  const params = useParams();\n  const { isShiftActive, shiftUser } = useShift();\n  const { shopId: shopIdCtx, shopName } = useShop();\n  const queryClientHook = useQueryClient();\n  const isMobile = useIsMobile();\n  //     (Electron)\n  const isDesktopApp = (() => {\n    try {\n      return Boolean((window as any).electronAPI) ||\n        (typeof navigator !== 'undefined' && navigator.userAgent.toLowerCase().includes('electron')) ||\n        (typeof window !== 'undefined' && window.location && window.location.protocol === 'file:');\n    } catch {\n      return false;\n    }\n  })();\n  const [isCashierModalOpen, setIsCashierModalOpen] = useState(false);\n  const [isShiftProfileOpen, setIsShiftProfileOpen] = useState(false);\n  const [isChangeLogOpen, setIsChangeLogOpen] = useState(false);\n  const [isDeveloperInfoOpen, setIsDeveloperInfoOpen] = useState(false);\n  const [branchDialogOpen, setBranchDialogOpen] = useState(false);\n  const [branchRequestOpen, setBranchRequestOpen] = useState(false);\n  const [branches, setBranches] = useState<any[]>([]);\n  const [managerNameInput, setManagerNameInput] = useState('');\n  const [branchNameInput, setBranchNameInput] = useState('');\n  const [branchEmailInput, setBranchEmailInput] = useState('');\n  const [loginPasswordInput, setLoginPasswordInput] = useState('');\n  const [branchLoading, setBranchLoading] = useState(false);\n  const [branchLoginOpen, setBranchLoginOpen] = useState(false);\n  const [branchLoginTarget, setBranchLoginTarget] = useState<any | null>(null);\n  const [branchLoginUsername, setBranchLoginUsername] = useState('');\n  const [branchLoginPassword, setBranchLoginPassword] = useState('');\n  const [branchAuthLoading, setBranchAuthLoading] = useState(false);\n  const [branchDetailsOpen, setBranchDetailsOpen] = useState(false);\n  const [branchDetailsLoading, setBranchDetailsLoading] = useState(false);\n  const [selectedBranchDetails, setSelectedBranchDetails] = useState<any>(null);\n  const [showAddBranchForm, setShowAddBranchForm] = useState(false);\n  const [branchesLoaded, setBranchesLoaded] = useState(false);\n  const [appDownloads, setAppDownloads] = useState<AppDownloads | null>(null);\n\n  // Load App Version Logic\n  useEffect(() => {\n    getAppDownloads().then(setAppDownloads).catch(() => {});\n  }, []);\n  const [runtimeDesktopVersion, setRuntimeDesktopVersion] = useState<string | undefined>(undefined);\n  useEffect(() => {\n    try {\n      const api: any = (window as any).electronAPI;\n      if (api && typeof api.appVersion === 'function') {\n        api.appVersion().then((v: any) => {\n          if (typeof v === 'string' && !v.startsWith('err:')) setRuntimeDesktopVersion(v);\n        }).catch(() => {});\n      }\n    } catch {}\n  }, []);\n  const appVersion = (() => {\n    const localVersion = (import.meta as any)?.env?.VITE_APP_VERSION as string | undefined;\n    const isElectronEnv = typeof window !== 'undefined' && ((window as any).electronAPI || window.location.protocol === 'file:' || (typeof navigator !== 'undefined' && navigator.userAgent.toLowerCase().includes('electron')));\n    if (isElectronEnv && (profile as any)?.desktopInstalledVersion) return (profile as any)?.desktopInstalledVersion;\n    if (isElectronEnv && runtimeDesktopVersion) return runtimeDesktopVersion;\n    if (localVersion) return localVersion;\n    if (!appDownloads && !profile) return undefined;\n    if (isMobile) return (profile as any)?.androidInstalledVersion || (profile as any)?.lastAckAndroidVersion || appDownloads?.androidVersion || appDownloads?.pcVersion;\n    if (isElectronEnv) return appDownloads?.pcVersion || appDownloads?.androidVersion;\n    return appDownloads?.pcVersion || appDownloads?.androidVersion;\n  })();\n\n  // Load branches when dialog opens\n  useEffect(() => {\n    if (branchDialogOpen && user?.uid && !branchesLoaded) {\n      const loadBranches = async () => {\n        setBranchLoading(true);\n        try {\n          let subBranches: any[] = [];\n          let rootBranches: any[] = [];\n\n          // 1. Fetch from subcollection (New Standard)\n          try {\n            const branchesRef = collection(db, 'users', user.uid, 'branches');\n            const snapshotSub = await getDocs(branchesRef);\n            subBranches = snapshotSub.docs.map(doc => ({ id: doc.id, ...doc.data(), source: 'sub' }));\n          } catch (e) {\n            console.warn('Failed to fetch subcollection branches:', e);\n          }\n\n          // 2. Fetch from root collection (Legacy/Backup)\n          try {\n            const qRoot = fsQuery(collection(db, 'branches'), where('ownerId', '==', user.uid));\n            const snapshotRoot = await getDocs(qRoot);\n            rootBranches = snapshotRoot.docs.map(doc => ({ id: doc.id, ...doc.data(), source: 'root' }));\n          } catch (e) {\n             console.warn('Failed to fetch root branches:', e);\n          }\n\n          // 3. Merge and deduplicate based on branchUserId\n          const allBranches = [...subBranches, ...rootBranches];\n          // Prefer 'sub' source if duplicates exist\n          const uniqueBranchesMap = new Map();\n          allBranches.forEach(item => {\n             const key = item['branchUserId'] || item.id;\n             if (!uniqueBranchesMap.has(key) || item.source === 'sub') {\n                 uniqueBranchesMap.set(key, item);\n             }\n          });\n          const uniqueBranches = Array.from(uniqueBranchesMap.values());\n          \n          console.log('Loaded branches:', uniqueBranches);\n          setBranches(uniqueBranches);\n          setBranchesLoaded(true);\n        } catch (error) {\n          console.error('Error in branch loading process:', error);\n          toast({\n             title: '',\n             description: '    ',\n             variant: 'destructive'\n          });\n        } finally {\n          setBranchLoading(false);\n        }\n      };\n      loadBranches();\n    }\n  }, [branchDialogOpen, user?.uid, branchesLoaded]);\n\n  // Reset add branch form visibility when dialog closes\n  useEffect(() => {\n    if (!branchDialogOpen) {\n      setShowAddBranchForm(false);\n    }\n  }, [branchDialogOpen]);\n\n  const [branchEditOpen, setBranchEditOpen] = useState(false);\n  const [selectedBranchToEdit, setSelectedBranchToEdit] = useState<any>(null);\n  const [editBranchName, setEditBranchName] = useState('');\n  const [editManagerName, setEditManagerName] = useState('');\n  const [editBranchEmail, setEditBranchEmail] = useState('');\n  const [editBranchLoading, setEditBranchLoading] = useState(false);\n\n  const openEditBranchDialog = (branch: any) => {\n    setSelectedBranchToEdit(branch);\n    setEditBranchName(branch.branchName || '');\n    setEditManagerName(branch.managerName || '');\n    // Try multiple possible keys for the email/username\n    setEditBranchEmail(branch.loginUsername || branch.email || branch.username || '');\n    setBranchEditOpen(true);\n  };\n\n  const handleUpdateBranch = async () => {\n    if (!selectedBranchToEdit || !editBranchName || !editManagerName) return;\n    setEditBranchLoading(true);\n    try {\n        const updates = {\n            branchName: editBranchName,\n            managerName: editManagerName,\n            updatedAt: new Date()\n        };\n\n        // 1. Update in subcollection\n        if (selectedBranchToEdit.branchUserId) {\n             try { \n                 await setDoc(doc(db, 'users', user?.uid || '', 'branches', String(selectedBranchToEdit.branchUserId)), updates, { merge: true });\n                 \n                 // Update the actual branch user document if needed (optional, but good for consistency)\n                 // We might not have permission to write to other users root doc unless admin, but usually creator has some rights or we skip it.\n                 // Actually, usually we can't update another user's root doc directly from client unless rules allow.\n                 // We will try, but catch error.\n                 try {\n                     await updateDoc(doc(db, 'users', selectedBranchToEdit.branchUserId), {\n                         displayName: editBranchName, // Assuming branchName maps to displayName\n                         managerName: editManagerName\n                     });\n                 } catch (e) { console.warn('Could not update branch root user doc', e); }\n\n             } catch (e) { console.warn('Sub branch update failed:', e); }\n        }\n        \n        // 2. Update in root collection (Legacy)\n        try { await updateDoc(doc(db, 'branches', selectedBranchToEdit.id), updates); } catch (e) { }\n\n        // Update local state\n        setBranches(prev => prev.map(b => {\n            if (b.id === selectedBranchToEdit.id) {\n                return { ...b, ...updates };\n            }\n            return b;\n        }));\n        \n        toast({ title: '    ' });\n        setBranchEditOpen(false);\n    } catch (e: any) {\n        console.error('Error updating branch:', e);\n        toast({ title: '  ', description: e.message, variant: 'destructive' });\n    } finally {\n        setEditBranchLoading(false);\n    }\n  };\n\n  const fetchBranchDetails = async (branch: any) => {\n    if (!branch?.branchUserId) {\n      toast({ title: '', description: '   ', variant: 'destructive' });\n      return;\n    }\n    setBranchDetailsLoading(true);\n    setBranchDetailsOpen(true);\n    try {\n      const uid = branch.branchUserId;\n\n      // Self-healing: Ensure branch link exists for security rules\n      // Optimization: Only sync/wait if strictly necessary (legacy branches or missing source)\n      if (user?.uid && branch.branchUserId && branch.source !== 'sub') {\n         try {\n             // Ensure the branch document exists in the subcollection so isBranchOwner rule passes\n             // Only save necessary fields to avoid 'undefined' errors or large payloads\n             await setDoc(doc(db, 'users', user.uid, 'branches', branch.branchUserId), {\n                 branchUserId: branch.branchUserId,\n                 branchName: branch.branchName || 'Unknown Branch',\n                 managerName: branch.managerName || '',\n                 active: true,\n                 lastSynced: serverTimestamp()\n             }, { merge: true });\n             console.log(' Branch link synced successfully');\n             // Wait a moment for Firestore rules to propagate the new document existence\n             await new Promise(resolve => setTimeout(resolve, 500));\n         } catch (e) {\n             console.error(' Failed to sync branch link:', e);\n             // Don't throw, try to proceed, but it will likely fail\n         }\n      }\n\n      // Parallel Fetching of all required data\n      const [userDocSnap, walletsSnap, debtsSnap, salesSnap] = await Promise.all([\n        // 1. Fetch User Profile\n        getDoc(doc(db, 'users', uid)),\n        \n        // 2. Fetch Wallets\n        (async () => {\n          try {\n            // Priority 1: Merchant Wallets (New System)\n            const qMerchant = fsQuery(collection(db, 'merchantWallets'), where('merchantUserId', '==', uid));\n            const snapMerchant = await getDocs(qMerchant);\n            if (!snapMerchant.empty) return snapMerchant;\n\n            // Priority 2: User Subcollection\n            const snapSub = await getDocs(collection(db, 'users', uid, 'wallets'));\n            if (!snapSub.empty) return snapSub;\n\n            // Priority 3: Legacy Wallets\n            return await getDocs(fsQuery(collection(db, 'wallets'), where('userId', '==', uid)));\n          } catch (e) {\n            console.error(\"Error fetching wallets\", e);\n            // Fallback to legacy query if merchantWallets fails (e.g. permission)\n            try {\n              return await getDocs(fsQuery(collection(db, 'wallets'), where('userId', '==', uid)));\n            } catch { return { docs: [] } as any; }\n          }\n        })(),\n\n        // 3. Fetch Debts\n        (async () => {\n          try {\n            return await getDocs(fsQuery(collection(db, 'debts'), where('userId', '==', uid)));\n          } catch {\n            return await getDocs(collection(db, 'users', uid, 'debts'));\n          }\n        })(),\n\n        // 4. Fetch Sales\n        (async () => {\n          try {\n            const q = fsQuery(collection(db, 'dailySales'), where('userId', '==', uid));\n            const s = await getDocs(q);\n            if (!s.empty) return s;\n            return await getDocs(collection(db, 'users', uid, 'dailySales'));\n          } catch (e) {\n            console.error(\"Error fetching sales\", e);\n            return await getDocs(collection(db, 'users', uid, 'dailySales'));\n          }\n        })()\n      ]);\n\n      // Process Data\n      const userData = userDocSnap.exists() ? userDocSnap.data() : {};\n      const cashBalance = Number(userData.cashBalance || 0);\n      const reportsData = (userData.reportsData || {}) as any;\n      const reportsDailyProfit = Number(reportsData.dailyProfit || 0);\n      const reportsMonthlyProfit = Number(reportsData.monthlyProfit || 0);\n\n      // Calculate Wallets Total from User Profile (Primary Source)\n      const walletBalancesMap = (userData.walletBalances || {}) as Record<string, number>;\n      let walletsTotal = Object.values(walletBalancesMap).reduce((sum, val) => sum + Number(val || 0), 0);\n\n      // Fallback/Legacy: If map is empty, try summing from documents\n      if (walletsTotal === 0 && !walletsSnap.empty) {\n        walletsTotal = walletsSnap.docs.reduce((sum, d) => sum + Number(d.data().balance || d.data().amount || 0), 0);\n      }\n\n      let debtsTotal = 0;\n      debtsSnap.forEach(d => {\n        const data = d.data();\n        // Calculate outstanding debt (amount - paid)\n        if (data.type !== 'debtor') {\n            const paid = Number(data.paidAmount || 0);\n            const outstanding = Math.max(0, Number(data.amount || 0) - paid);\n            debtsTotal += outstanding;\n        }\n      });\n\n      const now = new Date();\n      const todayStr = now.toISOString().split('T')[0];\n      const monthStr = todayStr.slice(0, 7); // YYYY-MM\n\n      let todaySales = 0;\n      let monthSales = 0;\n      let todayProfit = reportsDailyProfit;\n      let monthProfit = reportsMonthlyProfit;\n      let totalSalesSection = 0;\n\n      console.log(`Branch Details - UID: ${uid}, Wallets: ${walletsSnap.size}, Sales: ${salesSnap.size}, ReportsDaily: ${reportsDailyProfit}`);\n\n      salesSnap.forEach(d => {\n        const data = d.data();\n        const date = String(data.date || '');\n        const amount = Number(data.sellingPrice || 0) * Number(data.quantity || 1);\n        const profit = Number(data.profit || 0);\n        \n        totalSalesSection += amount;\n        \n        if (date === todayStr) {\n            todaySales += amount;\n            todayProfit += profit;\n        }\n        if (date.startsWith(monthStr)) {\n            monthSales += amount;\n            monthProfit += profit;\n        }\n      });\n\n      setSelectedBranchDetails({\n        branchName: branch.branchName,\n        managerName: branch.managerName,\n        todaySales,\n        monthSales,\n        todayProfit,\n        monthProfit,\n        walletsTotal,\n        cashBalance,\n        totalSalesSection,\n        debtsTotal\n      });\n\n    } catch (e: any) {\n      console.error('Error fetching branch details:', e);\n      toast({ title: '   ', description: e.message, variant: 'destructive' });\n      setBranchDetailsOpen(false);\n    } finally {\n      setBranchDetailsLoading(false);\n    }\n  };\n\n  const [selectedWallet, setSelectedWallet] = useState<string>('');\n  useEffect(() => {\n    const sid = (params as any)?.shopId;\n    if (sid && user?.uid) {\n      try {\n        const key = `selectedShopId_${user.uid}`;\n        localStorage.setItem(key, String(sid));\n        window.dispatchEvent(new Event('selectedShopIdChanged'));\n      } catch { }\n    }\n  }, [(params as any)?.shopId, user?.uid]);\n  //   ADB      \n  const [adbDevices, setAdbDevices] = useState<Array<{ id: string; model?: string; name?: string; type?: string }>>([]);\n  const [selectedAdbDeviceId, setSelectedAdbDeviceId] = useState<string | null>(() => {\n    try { return localStorage.getItem('cashySelectedDevice') || null; } catch { return null; }\n  });\n\n  // Request SMS Permissions on Mount\n  useEffect(() => {\n    //      SMS      \n    //          .\n  }, []);\n\n  // Sync selected wallet to Capacitor Preferences for Native Receiver\n  useEffect(() => {\n    const syncWalletToNative = async () => {\n      if (selectedWallet) {\n        try {\n          await Preferences.set({ key: 'selected_wallet_id', value: selectedWallet });\n          console.log(' Synced selected_wallet_id to Native:', selectedWallet);\n        } catch (e) {\n          console.error('Failed to sync wallet to native:', e);\n        }\n      } else {\n        await Preferences.remove({ key: 'selected_wallet_id' });\n      }\n    };\n    syncWalletToNative();\n  }, [selectedWallet]);\n\n  // Sync shopId to Capacitor Preferences for Native Receiver\n  useEffect(() => {\n    const syncShopIdToNative = async () => {\n      if (shopIdCtx) {\n        try {\n          await Preferences.set({ key: 'shopId', value: shopIdCtx });\n          console.log(' Synced shopId to Native:', shopIdCtx);\n        } catch (e) {\n          console.error('Failed to sync shopId to native:', e);\n        }\n      }\n    };\n    syncShopIdToNative();\n  }, [shopIdCtx]);\n\n  const isDeviceConnected = (id?: string) => !!(id && adbDevices.some(d => d.id === id));\n\n  async function ensureDeviceReadyBeforeSend(): Promise<string | null> {\n    const api: any = (window as any).electronAPI;\n    const sel = selectedAdbDeviceId || '';\n    if (!api || typeof api.sendUssd !== 'function') return null;\n    try { /*        */ } catch { }\n    if (!sel) {\n      toast({ title: '  ', description: '       ', variant: 'destructive' });\n      return null;\n    }\n    if (isDeviceConnected(sel)) return sel;\n    \n    //   USB   \n    try {\n      const usb = adbDevices.find((d: any) => d && d.id && !String(d.id).includes(':'));\n      if (usb && usb.id) { setSelectedAdbDeviceId(usb.id); return usb.id; }\n    } catch { }\n\n    const ip = sel.includes(':') ? sel.split(':').slice(0, 2).join(':') : '';\n    if (ip && typeof api.connectWifi === 'function') {\n      try { \n        const res = await api.connectWifi(ip); \n        //             \n        if (typeof res === 'string' && (res.includes('') || res.toLowerCase().includes('connected'))) {\n           return sel;\n        }\n      } catch { }\n      \n      //    \n      if (typeof api.refreshAdbDevices === 'function') {\n        try { await api.refreshAdbDevices(); } catch {}\n      }\n      \n      await new Promise(r => setTimeout(r, 250));\n      //        sel.      \n    }\n\n    const base = sel.split(':')[0];\n    const wifiCandidate = adbDevices.find(d => (d.id.startsWith(base) || d.id.includes(base)) && d.id.includes(':'));\n    if (wifiCandidate?.id) {\n      const wifiIp = wifiCandidate.id.split(':').slice(0, 2).join(':');\n      if (!isDeviceConnected(wifiCandidate.id) && typeof api.connectWifi === 'function') {\n        try { \n            const res = await api.connectWifi(wifiIp); \n            if (typeof res === 'string' && (res.includes('') || res.toLowerCase().includes('connected'))) {\n                setSelectedAdbDeviceId(wifiCandidate.id);\n                return wifiCandidate.id;\n            }\n        } catch { }\n        await new Promise(r => setTimeout(r, 250));\n      }\n      if (isDeviceConnected(wifiCandidate.id)) {\n        setSelectedAdbDeviceId(wifiCandidate.id);\n        return wifiCandidate.id;\n      }\n    }\n\n    //  :    IP      (     ) \n    if (sel && ip) {\n       return sel;\n    }\n\n    toast({ title: '  ', description: ' Wireless debugging    WiFi   ', variant: 'destructive' });\n    return null;\n  }\n\n  useEffect(() => {\n    const api: any = (window as any).electronAPI;\n    if (api && typeof api.onAdbDevices === 'function') {\n      api.onAdbDevices((devices: Array<{ id: string; model?: string; name?: string; type?: string }>) => {\n        const list = Array.isArray(devices) ? devices : [];\n        setAdbDevices(list);\n        \n        //               \n        //        \n        const saved = (() => { try { return localStorage.getItem('cashySelectedDevice') || ''; } catch { return ''; } })();\n        \n        if (saved) {\n           //          \n           setSelectedAdbDeviceId(saved);\n        } else if (list[0]?.id) {\n           //       \n           setSelectedAdbDeviceId((prev) => prev || list[0].id);\n        } else {\n           setSelectedAdbDeviceId(null);\n        }\n      });\n    }\n  }, []);\n\n  //         \n  function sendTransfer(receiverPhone: string, amount: number) {\n    try {\n      const sw = getSelectedWalletObj?.();\n      const senderPhone = sw?.phone || '';\n      if (!senderPhone) {\n        toast({ title: '  ', description: '   ', variant: 'destructive' });\n        return;\n      }\n      sendTransferFromWalletDeepLink(senderPhone, receiverPhone, amount);\n      toast({ title: '   ', description: '     ' });\n      setIsPostConfirmPopupOpen(false);\n      setIsPinModalOpen(false);\n    } catch (err: any) {\n      const msg = err?.message || '      ';\n      toast({ title: ' ', description: msg, variant: 'destructive' });\n      throw err;\n    }\n  }\n\n  //       (0  1)\n  const [selectedSimSlotForTransfer, setSelectedSimSlotForTransfer] = useState<number | null>(null);\n\n  //           \n  const triggerSendTransferCode = async () => {\n    if (!lastUSSDTransfer || !lastUSSDTransfer.receiver || !lastUSSDTransfer.amount) {\n      toast({\n        title: '  ',\n        description: '       ',\n        variant: 'destructive',\n      });\n      return;\n    }\n    const receiver = String(lastUSSDTransfer.receiver);\n    const amount = Math.round(Number(lastUSSDTransfer.amount));\n    setUssdLoading(true);\n    //     :      \n    try {\n      //    (Android)     USSD  \n      if (Capacitor?.isNativePlatform && Capacitor.getPlatform() === 'android') {\n        const sw = getSelectedWalletObj?.();\n        const senderPhone = sw?.phone || '';\n        if (!senderPhone) {\n          toast({ title: '  ', description: '   ', variant: 'destructive' });\n          setUssdLoading(false);\n          return;\n        }\n        const code = getUssdCodeBySender(senderPhone, receiver, amount);\n        if (!code) {\n          toast({ title: '  ', description: '    010/011/012/015', variant: 'destructive' });\n          setUssdLoading(false);\n          return;\n        }\n        openUssdDeepLink(code);\n        toast({ title: '   ', description: '     ' });\n        setIsPostConfirmPopupOpen(false);\n        setIsPinModalOpen(false);\n        return;\n      }\n\n      //      ADB    \n      const api: any = (window as any).electronAPI;\n      if (api && typeof api.sendUssd === 'function' && selectedAdbDeviceId) {\n        const sw = getSelectedWalletObj?.();\n        const senderPhone = sw?.phone || '';\n        if (!senderPhone) {\n          toast({ title: '  ', description: '   ', variant: 'destructive' });\n          setUssdLoading(false);\n          return;\n        }\n        const readyId = await ensureDeviceReadyBeforeSend();\n        if (!readyId) { setUssdLoading(false); return; }\n        const code = getUssdCodeBySender(senderPhone, receiver, amount);\n        if (!code) {\n          toast({ title: '  ', description: '    010/011/012/015', variant: 'destructive' });\n          setUssdLoading(false);\n          return;\n        }\n        try {\n          //       \n          let decoratedId = '';\n          if (selectedSimSlotForTransfer !== null) {\n            decoratedId = `${readyId}:sim${selectedSimSlotForTransfer}`;\n          } else {\n            //    \n            const pick = typeof api.pickSimAutomatically === 'function'\n              ? await api.pickSimAutomatically(readyId, senderPhone)\n              : { deviceId: readyId, slot: 0 };\n            decoratedId = `${pick.deviceId}:sim${pick.slot}`;\n          }\n\n          setLastDecoratedDeviceId(decoratedId);\n          await api.sendUssd(decoratedId, code);\n        } catch (e1: any) {\n          try {\n            await api.sendUssd(readyId, code);\n          } catch (e2: any) {\n            const maybeIp = readyId.includes(':') ? readyId.split(':').slice(0, 2).join(':') : '';\n            if (maybeIp && typeof api.connectWifi === 'function') {\n              await api.connectWifi(maybeIp);\n              await api.sendUssd(readyId, code);\n            } else {\n              throw e2;\n            }\n          }\n        }\n\n        toast({ title: '   ', description: '  ' });\n        setIsPostConfirmPopupOpen(false);\n        setIsPinModalOpen(true);\n      } else {\n        //           \n        //               \n        sendTransfer(receiver, amount);\n      }\n    } catch (e: any) {\n      const msg = (e && e.message) ? e.message : '     ';\n      const dev = (lastDecoratedDeviceId || selectedAdbDeviceId || ' ');\n      toast({ title: '  ', description: `: ${dev}  ${msg}`, variant: 'destructive' });\n    } finally {\n      setUssdLoading(false);\n    }\n  };\n\n\n  //   USSD   ADB   electronAPI\n  const handleSendUssd = async () => {\n    //        :   \n    await triggerSendTransferCode();\n  };\n\n  //         \n  const handlePinSubmit = async (deviceId: string, pin: string) => {\n    const api: any = (window as any).electronAPI;\n    try {\n      if (api && typeof api.enterPin === 'function' && deviceId) {\n        await api.enterPin(deviceId, pin);\n        setIsPinModalOpen(false);\n        return;\n      }\n\n      //   ADB:  PIN       \n      const rawLink = String((profile as any)?.bridgeLink || '').trim();\n      const devId = String((profile as any)?.bridgeDeviceId || '').trim() || undefined;\n      if (!rawLink) {\n        toast({ title: '  ', description: '   ', variant: 'destructive' });\n        return;\n      }\n      const receiverDigits = String((lastUSSDTransfer?.receiver || receiverPhone || '')).replace(/\\D/g, '');\n      const amountInt = Math.max(1, Math.round(Number(lastUSSDTransfer?.amount || amount || 0)) || 0);\n      const pinDigits = String(pin || '').replace(/\\D/g, '');\n      const normalizeLink = (url: string) => {\n        let u = (url || '').trim();\n        u = u.replace(/\\/+$/, '');\n        if (!/^https?:\\/\\//i.test(u)) u = `https://${u}`;\n        return u;\n      };\n      const baseUrl = normalizeLink(rawLink);\n      //        PIN    \n      setIsPinModalOpen(false);\n    } catch (err: any) {\n      const msg = err?.message || '     ';\n      toast({ title: ' ', description: msg, variant: 'destructive' });\n    }\n  };\n\n  console.log(' UserDashboardPage - user:', user ? 'exists' : 'null');\n\n  //    -   \n  const [isUserActive, setIsUserActive] = useState<boolean>(true);\n  const [isCheckingActivation, setIsCheckingActivation] = useState<boolean>(true);\n\n  //   \n  const [isShopExpensesDialogOpen, setIsShopExpensesDialogOpen] = useState(false);\n  const [isShopExpensesPinDialogOpen, setIsShopExpensesPinDialogOpen] = useState(false);\n  const [expenseName, setExpenseName] = useState('');\n  const [expenseAmount, setExpenseAmount] = useState('');\n  const [expenseNotes, setExpenseNotes] = useState('');\n  const [expenses, setExpenses] = useState<ShopExpense[]>([]);\n  const [isExpenseDeductionChoiceOpen, setIsExpenseDeductionChoiceOpen] = useState(false);\n  const [expenseDeductionSource, setExpenseDeductionSource] = useState<'cash' | 'wallet' | 'fawry' | null>(null);\n  const [selectedWalletForExpense, setSelectedWalletForExpense] = useState('');\n  const [isReceiptsOpen, setIsReceiptsOpen] = useState(false);\n  const [isReceiptsDialogOpen, setIsReceiptsDialogOpen] = useState(false);\n  const [showActivationModal, setShowActivationModal] = useState<boolean>(false);\n\n  //  \n  const [isDeficienciesDialogOpen, setIsDeficienciesDialogOpen] = useState(false);\n  const [deficiencyName, setDeficiencyName] = useState('');\n  const [deficiencyQuantity, setDeficiencyQuantity] = useState('');\n  const [deficiencies, setDeficiencies] = useState<DeficiencyItem[]>([]);\n\n  //   \n  const [isOnFreeTrial, setIsOnFreeTrial] = useState<boolean>(false);\n  const [freeTrialHoursRemaining, setFreeTrialHoursRemaining] = useState<number>(0);\n  const [hasUsedFreeTrial, setHasUsedFreeTrial] = useState<boolean>(false);\n\n  //  \n  const [userSubscription, setUserSubscription] = useState<SubscriptionData | null>(null);\n  const [branchPackage, setBranchPackage] = useState<any>(null); // New local state for branch package\n  const [isRefreshingSubscription, setIsRefreshingSubscription] = useState<boolean>(false);\n\n\n\n  //   useState\n  const [senderPhone, setSenderPhone] = useState<string>('');\n  const [receiverPhone, setReceiverPhone] = useState('');\n  const [amount, setAmount] = useState('');\n  const [withdrawNote, setWithdrawNote] = useState('');\n  const [withdrawSenderName, setWithdrawSenderName] = useState('');\n  //      \n  const [isQuickDebtOpen, setIsQuickDebtOpen] = useState(false);\n  const [quickDebtName, setQuickDebtName] = useState('');\n  const [quickDebtAmount, setQuickDebtAmount] = useState('');\n  const [quickDebtNotes, setQuickDebtNotes] = useState('');\n  const [quickDebtCustomerId, setQuickDebtCustomerId] = useState<string>('');\n  const [quickDebtInfo, setQuickDebtInfo] = useState<{\n    debtorName: string;\n    amount: number;\n    notes?: string;\n    customerId?: string;\n    mobile?: string;\n  } | null>(null);\n  const [didCreateQuickDebt, setDidCreateQuickDebt] = useState<boolean>(false);\n  const [isWalletsDialogOpen, setIsWalletsDialogOpen] = useState<boolean>(false);\n  const [isWalletsPinDialogOpen, setIsWalletsPinDialogOpen] = useState<boolean>(false);\n  // PIN gating for changing selected wallet\n  const [isWalletSelectionPinDialogOpen, setIsWalletSelectionPinDialogOpen] = useState<boolean>(false);\n  const [pendingSelectedWalletId, setPendingSelectedWalletId] = useState<string | null>(null);\n  const [manualCommission, setManualCommission] = useState(''); //    \n  const [transferCommission, setTransferCommission] = useState(''); //    \n  const [transferExtraFee, setTransferExtraFee] = useState(''); //      (010011)\n  const [isMonthlyLimitWarnOpen, setIsMonthlyLimitWarnOpen] = useState(false);\n  const [selectedQuickIcon, setSelectedQuickIcon] = useState<string | null>(null);\n  const [monthlyLimitWarnData, setMonthlyLimitWarnData] = useState<{ type: 'withdraw' | 'transfer'; used: number; limit: number; walletName: string } | null>(null);\n  const [isWithdrawSenderNameInputEnabled, setIsWithdrawSenderNameInputEnabled] = useState<boolean>(false);\n  useEffect(() => {\n    const loadSetting = async () => {\n      try {\n        const key = user?.uid ? `withdrawSenderNameInputEnabled_${user?.uid}` : 'withdrawSenderNameInputEnabled';\n        let v: string | null = null;\n        try { v = localStorage.getItem(key) ?? localStorage.getItem('withdrawSenderNameInputEnabled'); } catch {}\n        if (user?.uid) {\n          try {\n            const data = await withRetry(() => userDataService.getUserData(user.uid));\n            const remote: any = (data as any)?.withdrawSenderNameInputEnabled;\n            if (typeof remote === 'boolean') {\n              setIsWithdrawSenderNameInputEnabled(remote);\n              try { localStorage.setItem(key, remote ? 'true' : 'false'); } catch {}\n              return;\n            }\n          } catch {}\n        }\n        setIsWithdrawSenderNameInputEnabled(v === 'true' ? true : false);\n      } catch {\n        setIsWithdrawSenderNameInputEnabled(false);\n      }\n    };\n    loadSetting();\n  }, [user?.uid]);\n  // Helper: normalize Arabic/Persian digits to ASCII\n  const normalizeDigits = (s: string) => {\n    const arabicIndic = '';\n    const easternIndic = '';\n    return (s || '').split('').map(ch => {\n      const ai = arabicIndic.indexOf(ch);\n      if (ai > -1) return String(ai);\n      const ei = easternIndic.indexOf(ch);\n      if (ei > -1) return String(ei);\n      return ch;\n    }).join('');\n  };\n\n  // Prefill latest pending SMS into withdraw form\n  const normalizeToLocalMsisdn = (input: string): string => {\n    const digits = normalizeDigits(input || '').replace(/\\D/g, '');\n    if (!digits) return '';\n    // Handle common Egypt formats: 201XXXXXXXXX, +201XXXXXXXXX, 010XXXXXXXXX, 011, 012, 015\n    if (digits.startsWith('201') && digits.length === 12) {\n      // 2010XXXXXXXX -> 010XXXXXXXX\n      return '0' + digits.slice(2);\n    }\n    if (digits.startsWith('00201') && digits.length === 14) {\n      return '0' + digits.slice(4);\n    }\n    if (digits.startsWith('01') && digits.length === 11) {\n      return digits;\n    }\n    // Fallback: return original digits; matching will be by digits only\n    return digits;\n  };\n\n  const prefillFromLatest = async () => {\n    try {\n      const res = await fetch('/api/pending_sms');\n      if (!res.ok) throw new Error('   /api/pending_sms');\n      const data = await res.json();\n      if (!Array.isArray(data) || data.length === 0) {\n        toast({ title: '  ', description: '  SMS  ' });\n        return;\n      }\n      const s = data[0] || {};\n      const rawMsisdn = (s.msisdn || s.address || '') as string;\n      const localMsisdn = normalizeToLocalMsisdn(rawMsisdn);\n\n      // Try to select wallet by msisdn\n      if (localMsisdn) {\n        const targetDigits = localMsisdn.replace(/\\D/g, '');\n        const found = wallets.find(w => normalizeDigits(w.phone || '').replace(/\\D/g, '') === targetDigits);\n        if (found) {\n          setWalletSelection(found.id, 'prefillFromLatest');\n        }\n      }\n\n      // Fill amount\n      const rawAmount = (s.amount ?? s.value ?? s.amountEgp ?? '') as any;\n      let nextAmount = '';\n      if (typeof rawAmount === 'number') {\n        nextAmount = String(rawAmount);\n      } else if (typeof rawAmount === 'string' && rawAmount.trim() !== '') {\n        const parsed = parseFloat(normalizeDigits(rawAmount).replace(/[^0-9.]/g, ''));\n        if (!Number.isNaN(parsed)) nextAmount = String(parsed);\n      } else if ((s.message || s.body)) {\n        const msg = normalizeDigits(String(s.message || s.body));\n        const m = msg.match(/([0-9]+(?:\\.[0-9]+)?)/);\n        if (m) nextAmount = m[1];\n      }\n      setAmount(nextAmount || '');\n      setTransactionType('withdraw');\n      toast({ title: '  ', description: '       SMS' });\n    } catch (err: any) {\n      toast({ title: '  ', description: err?.message || '  ', variant: 'destructive' });\n    }\n  };\n\n  const [isCommissionAddMode, setIsCommissionAddMode] = useState<boolean>(() => {\n    try {\n      const v = localStorage.getItem('commissionMode') || localStorage.getItem('commissionMode_default');\n      return v ? v === 'add' : true; // :  \n    } catch { return true; }\n  });\n  const [transactionType, setTransactionType] = useState<'transfer' | 'withdraw'>('transfer');\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\n  const [activeTab, setActiveTab] = useState('all');\n  const [debts, setDebts] = useState<Debt[]>([]);\n  const localTransactionsBuffer = useRef<any[]>([]);\n\n  const recentTransactionsQuery = useQuery({\n    enabled: !!user?.uid,\n    queryKey: ['recentTransactions', user?.uid, (shopIdCtx || 'main')],\n    queryFn: async () => {\n      const { collection, query, where, orderBy, limit, getDocs } = await import('firebase/firestore');\n      const { db } = await import('@/firebase');\n      const q = query(\n        collection(db, 'userTransactions'),\n        where('userId', '==', String(user?.uid || '')),\n        orderBy('createdAt', 'desc'),\n        limit(100)\n      );\n      const snap = await getDocs(q);\n      const items = snap.docs.map((d) => {\n        const data: any = d.data();\n        const created = data.createdAt?.toDate ? data.createdAt.toDate() : new Date(data.createdAt);\n        const rawType = String(data.transactionType || data.txnType || data.type || '').toLowerCase();\n        const type = rawType === 'withdraw' || rawType === 'receive' ? 'withdraw' : 'send';\n        const status = data.status === 'confirmed' ? 'completed' : (data.status || 'completed');\n        const senderPhone = data.senderMsisdn || data.senderPhone || '';\n        const receiverPhone = data.receiverMsisdn || data.receiverPhone || '';\n        const amount = Number(data.amount ?? data.transferredAmount ?? data.withdrawnAmount ?? 0);\n        return { id: d.id, ...data, type, status, senderPhone, receiverPhone, amount, createdAt: created };\n      });\n      const filtered = items.filter((t: any) => !(t?.type === 'report' || String((t as any)?.title || '').includes('  ')));\n      const deletedIds = new Set<string>((deletedTransactions || []).map((dt: any) => String(dt.id || dt.originalTransactionId || '')));\n      const active = filtered.filter((t: any) => !deletedIds.has(String(t.id || '')));\n      const getKey = (t: any) => String(\n        (t as any).transactionId || t.id || (t as any).reference || ((t as any).receipt?.reference) || `${new Date(t.createdAt).getTime()}`\n      );\n      const seen = new Set<string>();\n      const distinct: any[] = [];\n      for (const t of active) {\n        const key = getKey(t);\n        if (!seen.has(key)) { seen.add(key); distinct.push(t); }\n      }\n      return distinct;\n    },\n    staleTime: 60_000,\n    gcTime: 300_000,\n    refetchOnWindowFocus: false,\n    refetchOnReconnect: true,\n  });\n\n  useEffect(() => {\n    const handleTransactionCreated = () => {\n      try {\n        recentTransactionsQuery.refetch();\n      } catch {}\n    };\n    window.addEventListener('transaction-created', handleTransactionCreated);\n    return () => {\n      window.removeEventListener('transaction-created', handleTransactionCreated);\n    };\n  }, [recentTransactionsQuery]);\n\n  useEffect(() => {\n    const data = recentTransactionsQuery.data as any[] | undefined;\n    if (data && Array.isArray(data)) {\n      // Merge with local buffer to prevent data reversion\n      const buffer = localTransactionsBuffer.current;\n      const now = Date.now();\n      // Remove items from buffer that are in data OR older than 5 minutes OR have matching reference in data\n      const activeBuffer = buffer.filter(bt => {\n          const existsById = data.some(dt => dt.id === bt.id);\n          const existsByRef = bt.reference ? data.some(dt => dt.reference === bt.reference) : false;\n          const isOld = (now - new Date(bt.createdAt).getTime()) > 300000; // 5 mins\n          return !existsById && !existsByRef && !isOld;\n      });\n      localTransactionsBuffer.current = activeBuffer;\n      \n      const merged = [...activeBuffer, ...data].sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n      \n      // Deduplicate by ID\n      const seen = new Set();\n      const distinct: any[] = [];\n      for (const t of merged) {\n          if (!seen.has(t.id)) {\n              seen.add(t.id);\n              distinct.push(t);\n          }\n      }\n      setTransactions(distinct);\n    }\n  }, [recentTransactionsQuery.data]);\n\n  useEffect(() => {\n    try {\n      //        \n      localStorage.setItem('commissionMode', isCommissionAddMode ? 'add' : 'deduct');\n      if (user?.uid) {\n        const key = `commissionMode_${user.uid}`;\n        localStorage.setItem(key, isCommissionAddMode ? 'add' : 'deduct');\n      }\n    } catch { }\n  }, [isCommissionAddMode, user?.uid]);\n\n  //     \"\"    :          \"\"\n  useEffect(() => {\n    try {\n      const completedDebtIds = new Set<string>(\n        (transactions || [])\n          .filter((t: any) => String(t?.status || '') === 'completed' && t?.linkedDebtId)\n          .map((t: any) => String(t.linkedDebtId))\n      );\n      if (completedDebtIds.size === 0) return;\n      const updated = debts.map((d) => {\n        if (completedDebtIds.has(String(d.id))) {\n          const amt = Number(d.amount || 0);\n          const paid = Number(d.paidAmount || 0);\n          if (d.status !== 'paid' || paid < amt) {\n            return { ...d, status: 'paid' as const, paidAmount: amt };\n          }\n        }\n        return d;\n      });\n      const changed = updated.some((d, i) => d !== debts[i]);\n      if (changed) {\n        setDebts(updated);\n        (async () => { await saveDebtsToStorage(updated); })();\n        try {\n          if (user?.uid) {\n            const newlyPaid = updated.filter((d, i) => d !== debts[i] && d.status === 'paid');\n            newlyPaid.forEach((dp) => { try { telegramNotifier.send(user.uid!, `     ${dp.debtorName}:  ${Number(dp.paidAmount || dp.amount || 0)} `); } catch {} });\n          }\n        } catch {}\n      }\n    } catch { }\n  }, [transactions, debts, user?.uid]);\n\n  useEffect(() => {\n    try {\n      const userVal = user?.uid ? localStorage.getItem(`commissionMode_${user.uid}`) : null;\n      const globalVal = localStorage.getItem('commissionMode');\n      const defVal = localStorage.getItem('commissionMode_default');\n      const v = userVal ?? globalVal ?? defVal;\n      if (v) setIsCommissionAddMode(v === 'add');\n    } catch { }\n  }, [user?.uid]);\n\n  //    \n  const [isSalesDataOpen, setIsSalesDataOpen] = useState(false);\n  const [pendingBarcode, setPendingBarcode] = useState<string | null>(null);\n  const barcodeBufferRef = React.useRef<string>('');\n  const lastKeyTimeRef = React.useRef<number>(0);\n\n  //        \n  useEffect(() => {\n    const handler = (e: KeyboardEvent) => {\n      if (isSalesDataOpen) return;\n      //   Enter      /\n      try {\n        const active = document.activeElement as HTMLElement | null;\n        if (active) {\n          const tag = active.tagName?.toLowerCase();\n          const isTyping = (\n            tag === 'input' ||\n            tag === 'textarea' ||\n            tag === 'select' ||\n            tag === 'button' ||\n            active.isContentEditable === true\n          );\n          if (isTyping) return;\n        }\n      } catch { }\n      const now = Date.now();\n      if (e.key === 'Enter') {\n        const code = (barcodeBufferRef.current || '').trim();\n        barcodeBufferRef.current = '';\n        if (code) {\n          setPendingBarcode(code);\n          setIsSalesDataOpen(true);\n        }\n        return;\n      }\n      if (e.key.length === 1) {\n        if (now - (lastKeyTimeRef.current || 0) > 100) {\n          barcodeBufferRef.current = '';\n        }\n        barcodeBufferRef.current += e.key;\n        lastKeyTimeRef.current = now;\n      }\n    };\n    window.addEventListener('keydown', handler as unknown as EventListener);\n    return () => window.removeEventListener('keydown', handler as unknown as EventListener);\n  }, [isSalesDataOpen]);\n  const [isWalletManagementOpen, setIsWalletManagementOpen] = useState(false);\n  const [isWalletsListOpen, setIsWalletsListOpen] = useState(false);\n  const [editingWalletForDropdown, setEditingWalletForDropdown] = useState<any | null>(null);\n\n  //        (/)\n  useEffect(() => {\n    if (!isQuickDebtOpen) return;\n    const sw = getSelectedWalletObj();\n    const baseAmount = parseFloat(amount || '0') || 0;\n    let commissionCalc = 0;\n\n    if (transactionType === 'transfer') {\n      if (sw?.defaultTransferCommission != null) {\n        const ratePerThousand = Number(sw.defaultTransferCommission) || 0;\n        commissionCalc = Math.round(((ratePerThousand * baseAmount) / 1000) * 100) / 100;\n      } else {\n        const manual = transferCommission && transferCommission.trim() !== '' ? parseFloat(transferCommission) : 0;\n        commissionCalc = Math.max(0, manual);\n      }\n      const debtAmount = baseAmount + commissionCalc; // :   \n      setQuickDebtAmount((debtAmount || 0).toString());\n    } else {\n      // \n      if (sw?.defaultWithdrawCommission != null) {\n        const ratePerThousand = Number(sw.defaultWithdrawCommission) || 0;\n        commissionCalc = Math.round(((ratePerThousand * baseAmount) / 1000) * 100) / 100;\n      } else {\n        const manual = manualCommission && manualCommission.trim() !== '' ? parseFloat(manualCommission) : Math.round((baseAmount * 0.01) * 100) / 100;\n        commissionCalc = Math.max(0, manual);\n      }\n      const debtAmount = isCommissionAddMode\n        ? baseAmount\n        : Math.max(0, Math.round((baseAmount - commissionCalc) * 100) / 100);\n      setQuickDebtAmount((debtAmount || 0).toString());\n    }\n  }, [isQuickDebtOpen, amount, transferCommission, manualCommission, selectedWallet, isCommissionAddMode, transactionType]);\n\n  //        fallback   \n  const getSelectedWalletObj = () => {\n    let sw = wallets.find((w: any) => w.id === selectedWallet);\n    if (!sw) {\n      try {\n        const savedWalletsStr = localStorage.getItem(getWalletsKey());\n        if (savedWalletsStr) {\n          const parsedWallets = JSON.parse(savedWalletsStr);\n          if (Array.isArray(parsedWallets) && parsedWallets.length > 0) {\n            const savedSelected = localStorage.getItem(getSelectedWalletKey());\n            const candidateId = savedSelected || parsedWallets.find((w: any) => w.isDefault)?.id || parsedWallets[0]?.id;\n            sw = parsedWallets.find((w: any) => w.id === candidateId);\n          }\n        }\n      } catch (e) {\n        //        \n      }\n    }\n    return sw;\n  };\n  //             \n  useLayoutEffect(() => {\n    try {\n      //          user\n      const preferredKey = `wallets_${user?.uid || 'default'}`;\n      let savedWalletsStr = localStorage.getItem(preferredKey);\n      if (!savedWalletsStr) {\n        const anyWalletKey = Object.keys(localStorage).find(k => k.startsWith('wallets_'));\n        if (anyWalletKey) {\n          savedWalletsStr = localStorage.getItem(anyWalletKey) || null;\n        }\n      }\n      if (savedWalletsStr) {\n        const parsedWallets = JSON.parse(savedWalletsStr);\n        if (Array.isArray(parsedWallets) && parsedWallets.length > 0) {\n          //        \n          setWallets(parsedWallets);\n          const savedSelected = localStorage.getItem(getSelectedWalletKey());\n          const walletToSelect =\n            (savedSelected && parsedWallets.find((w: any) => w.id === savedSelected)) ||\n            parsedWallets.find((w: any) => w.isDefault) ||\n            parsedWallets[0];\n          if (walletToSelect) {\n            setSelectedWallet(walletToSelect.id);\n            setSenderPhone(walletToSelect.phone);\n          }\n        }\n      }\n    } catch (e) {\n      console.error('      :', e);\n    }\n    //       \n  }, []);\n\n  // Add logging for selectedWallet state changes\n  useEffect(() => {\n    console.log(' selectedWallet state changed to:', selectedWallet);\n  }, [selectedWallet]);\n\n  //           \n  useEffect(() => {\n    loadExpensesFromStorage();\n  }, [user?.uid]);\n\n  //     \n  useEffect(() => {\n    loadDeficienciesFromStorage();\n  }, []);\n\n  const [wallets, setWallets] = useState<Array<{ id: string, name: string, phone: string, isDefault: boolean, monthlyWithdrawalLimit?: number, monthlyTransferLimit?: number, defaultTransferCommission?: number | null, defaultWithdrawCommission?: number | null }>>(() => {\n    try {\n      const anyWalletKey = Object.keys(localStorage).find(k => k.startsWith('wallets_'));\n      const savedWalletsStr = anyWalletKey ? localStorage.getItem(anyWalletKey) : null;\n      if (savedWalletsStr) {\n        const parsedWallets = JSON.parse(savedWalletsStr);\n        if (Array.isArray(parsedWallets)) {\n          return parsedWallets;\n        }\n      }\n    } catch { }\n    return [];\n  });\n\n  const walletsQuery = useQuery({\n    enabled: !!user?.uid,\n    queryKey: ['wallets', user?.uid],\n    queryFn: async () => {\n      const { merchantWalletService } = await import('@/integrations/firebase/services');\n      const list: any[] = await merchantWalletService.getByMerchantId(String(user?.uid || ''));\n      const actives = (Array.isArray(list) ? list : []).filter((w: any) => (w as any).isActive === true);\n      return actives.map((w: any) => ({\n        id: w.id,\n        name: w.label || '  ',\n        phone: w.msisdn,\n        isDefault: !!(w as any).isDefault,\n        monthlyWithdrawalLimit: (w.monthlyWithdrawalLimit ?? w.withdrawLimit ?? 200000),\n        monthlyTransferLimit: (w.monthlyTransferLimit ?? w.transferLimit ?? 200000),\n        defaultTransferCommission: (w.defaultTransferCommission != null ? Number(w.defaultTransferCommission) : null),\n        defaultWithdrawCommission: (w.defaultWithdrawCommission != null ? Number(w.defaultWithdrawCommission) : null)\n      }));\n    },\n    staleTime: 60_000,\n    gcTime: 300_000,\n    refetchOnReconnect: true,\n  });\n\n  useEffect(() => {\n    const data = walletsQuery.data as any[] | undefined;\n    if (data && Array.isArray(data)) {\n      setWallets(data as any);\n      const savedSelectedWallet = localStorage.getItem(getSelectedWalletKey());\n      const hasCurrent = !!(selectedWallet && data.find((w: any) => w.id === selectedWallet));\n      if (!hasCurrent) {\n        const candidateId = (savedSelectedWallet && data.find((w: any) => w.id === savedSelectedWallet)) ? savedSelectedWallet : (data[0]?.id || '');\n        if (candidateId) {\n          setSelectedWallet(candidateId);\n          const obj = data.find((w: any) => w.id === candidateId);\n          setSenderPhone(String(obj?.phone || ''));\n        }\n      }\n    }\n  }, [walletsQuery.data]);\n\n  // Listen for external updates (e.g. from popup transactions) to update balances immediately\n  useEffect(() => {\n    const handleExternalUpdate = (event: any) => {\n      const { cashBalance: newCash, walletBalances: newWallets, newTransaction, limitUpdate, delta } = event.detail || {};\n      \n      // Handle Delta Update (Preferred for optimistic updates to avoid zeroing)\n      if (delta) {\n          const { amount, type, walletId, commission } = delta;\n          const amt = Number(amount || 0);\n          const comm = Number(commission || 0);\n          \n          setCashBalance(prev => {\n              let change = 0;\n              if (type === 'withdraw') {\n                  // Merchant gives cash, keeps commission (net cash out = amount - commission)\n                  change = -amt + comm;\n              } else if (type === 'send' || type === 'transfer') {\n                  // Merchant receives cash + commission\n                  change = amt + comm;\n              }\n              const newVal = prev + change;\n              \n              try {\n                const cashKey = getCashBalanceKey();\n                localStorage.setItem(cashKey, String(newVal));\n                const now = new Date().toISOString();\n                localStorage.setItem(cashKey + '_lastUpdated', now);\n                \n                // Update main userData object for sync\n                if (user?.uid) {\n                  const localDataKey = `userData_${user.uid}`;\n                  const existing = localStorage.getItem(localDataKey);\n                  const parsed = existing ? JSON.parse(existing) : {};\n                  const updated = { ...parsed, cashBalance: newVal, lastUpdated: now };\n                  localStorage.setItem(localDataKey, JSON.stringify(updated));\n                  setHasLocalDataToSync(true);\n                }\n              } catch {}\n              return newVal;\n          });\n          \n          if (walletId) {\n              setWalletBalances(prev => {\n                  const currentVal = Number(prev[walletId] || 0);\n                  let change = 0;\n                  if (type === 'withdraw') {\n                      // Merchant receives e-money\n                      change = amt;\n                  } else if (type === 'send' || type === 'transfer') {\n                      // Merchant sends e-money\n                      change = -amt;\n                  }\n                  const newVal = currentVal + change;\n                  const updatedWallets = { ...prev, [walletId]: newVal };\n                  \n                  try {\n                    const walletKey = getWalletBalancesKey();\n                    localStorage.setItem(walletKey, JSON.stringify(updatedWallets));\n                    const now = new Date().toISOString();\n                    localStorage.setItem(walletKey + '_lastUpdated', now);\n\n                    // Update main userData object for sync\n                    if (user?.uid) {\n                      const localDataKey = `userData_${user.uid}`;\n                      const existing = localStorage.getItem(localDataKey);\n                      const parsed = existing ? JSON.parse(existing) : {};\n                      const updated = { ...parsed, walletBalances: updatedWallets, lastUpdated: now };\n                      localStorage.setItem(localDataKey, JSON.stringify(updated));\n                      setHasLocalDataToSync(true);\n                    }\n                  } catch {}\n                  return updatedWallets;\n              });\n          }\n      }\n\n      if (typeof newCash === 'number') {\n        setCashBalance(newCash);\n        try {\n          const cashKey = getCashBalanceKey();\n          localStorage.setItem(cashKey, String(newCash));\n          const now = new Date().toISOString();\n          localStorage.setItem(cashKey + '_lastUpdated', now);\n\n          // Update main userData object for sync\n          if (user?.uid) {\n            const localDataKey = `userData_${user.uid}`;\n            const existing = localStorage.getItem(localDataKey);\n            const parsed = existing ? JSON.parse(existing) : {};\n            const updated = { ...parsed, cashBalance: newCash, lastUpdated: now };\n            localStorage.setItem(localDataKey, JSON.stringify(updated));\n            setHasLocalDataToSync(true);\n          }\n        } catch {}\n      }\n      \n      if (newWallets && typeof newWallets === 'object') {\n        setWalletBalances(newWallets);\n        try {\n          const walletKey = getWalletBalancesKey();\n          localStorage.setItem(walletKey, JSON.stringify(newWallets));\n          const now = new Date().toISOString();\n          localStorage.setItem(walletKey + '_lastUpdated', now);\n\n          // Update main userData object for sync\n          if (user?.uid) {\n            const localDataKey = `userData_${user.uid}`;\n            const existing = localStorage.getItem(localDataKey);\n            const parsed = existing ? JSON.parse(existing) : {};\n            const updated = { ...parsed, walletBalances: newWallets, lastUpdated: now };\n            localStorage.setItem(localDataKey, JSON.stringify(updated));\n            setHasLocalDataToSync(true);\n          }\n        } catch {}\n      }\n\n      if (limitUpdate && limitUpdate.walletId === selectedWallet) {\n          setSelectedWalletLimits(prev => {\n              if (!prev) return prev;\n              const amount = Number(limitUpdate.amount || 0);\n              const isTransfer = limitUpdate.type === 'transfer';\n              const newLimits = { ...prev };\n              if (isTransfer) {\n                  newLimits.dailyTransferUsed = (newLimits.dailyTransferUsed || 0) + amount;\n                  newLimits.monthlyTransferUsed = (newLimits.monthlyTransferUsed || 0) + amount;\n              } else {\n                  newLimits.dailyWithdrawUsed = (newLimits.dailyWithdrawUsed || 0) + amount;\n                  newLimits.monthlyWithdrawUsed = (newLimits.monthlyWithdrawUsed || 0) + amount;\n              }\n              return newLimits;\n          });\n      }\n      \n      if (newTransaction) {\n        // Add to local buffer to persist through refetches\n        try {\n            if (localTransactionsBuffer.current) {\n                if (!localTransactionsBuffer.current.some((t: any) => t.id === newTransaction.id)) {\n                    localTransactionsBuffer.current.push(newTransaction);\n                }\n            }\n        } catch {}\n\n        setTransactions((prev: any[]) => {\n          if (prev.some(t => t.id === newTransaction.id)) {\n            return prev;\n          }\n          return [newTransaction, ...prev];\n        });\n        \n        toast({\n          title: \"   \",\n          description: \"    \",\n        });\n        \n        // Trigger refetch of recent transactions to be safe\n        try { recentTransactionsQuery.refetch(); } catch {}\n      }\n    };\n\n    window.addEventListener('dashboard:external-update', handleExternalUpdate);\n    return () => window.removeEventListener('dashboard:external-update', handleExternalUpdate);\n  }, [selectedWallet]);\n\n\n  //       \n  const [walletSearch, setWalletSearch] = useState('');\n  const filteredWallets = (() => {\n    const query = walletSearch.replace(/\\D/g, '');\n    if (!query) return wallets;\n    return wallets.filter(w => (w.phone || '').replace(/\\D/g, '').includes(query));\n  })();\n  const [selectedTransaction, setSelectedTransaction] = useState<Transaction | null>(null);\n  const [isTransactionDetailsOpen, setIsTransactionDetailsOpen] = useState(false);\n  const [isReceiptOpen, setIsReceiptOpen] = useState(false);\n  const [receiptTransaction, setReceiptTransaction] = useState<any | null>(null);\n  const [dailyStats, setDailyStats] = useState<DailyStats[]>([]);\n  const [monthlyStatsArray, setMonthlyStatsArray] = useState<MonthlyStats[]>([]);\n\n  //  \n  const [isResetDialogOpen, setIsResetDialogOpen] = useState(false);\n  const [resetType, setResetType] = useState<'daily' | 'monthly'>('daily');\n\n  //  \n  const [deletedTransactions, setDeletedTransactions] = useState<Transaction[]>([]);\n  const [isRealtimeActive, setIsRealtimeActive] = useState(false);\n  const deletedEffectsAppliedRef = React.useRef<Set<string>>(new Set());\n  const limitsRollbackAppliedRef = React.useRef<Set<string>>(new Set());\n  const transactionsRef = React.useRef<Transaction[]>([]);\n  useEffect(() => { transactionsRef.current = transactions; }, [transactions]);\n\n  //          \n  const applyLocalDeleteEffects = async (tx: Transaction) => {\n    try {\n      if (!user) return;\n      //          \n      const cashKey = getCashBalanceKey();\n      const walletKey = getWalletBalancesKey();\n      const savedCash = localStorage.getItem(cashKey);\n      const savedWallets = localStorage.getItem(walletKey);\n      let newCashBalance = savedCash ? parseFloat(savedCash) : cashBalance;\n      let newWalletBalances: Record<string, number> = savedWallets ? JSON.parse(savedWallets) : { ...walletBalances };\n\n      const amountVal = Number((tx as any).withdrawnAmount ?? (tx as any).sentAmount ?? (tx as any).transferredAmount ?? tx.amount ?? 0);\n\n      if ((tx as any).type === 'send' && ((tx as any).fromWallet || selectedWallet)) {\n        // :      \n        newCashBalance -= amountVal;\n        const walletId = (tx as any).fromWallet || selectedWallet!;\n        newWalletBalances[walletId] = (newWalletBalances[walletId] || 0) + amountVal;\n      } else if ((tx as any).type === 'withdraw' && ((tx as any).fromWallet || selectedWallet)) {\n        // :      \n        newCashBalance += amountVal;\n        const walletId = (tx as any).fromWallet || selectedWallet!;\n        newWalletBalances[walletId] = Math.max(0, (newWalletBalances[walletId] || 0) - amountVal);\n      }\n\n      //    \n      setCashBalance(newCashBalance);\n      setWalletBalances(newWalletBalances);\n      const timestamp = new Date().toISOString();\n      localStorage.setItem(cashKey, newCashBalance.toString());\n      localStorage.setItem(cashKey + '_lastUpdated', timestamp);\n      localStorage.setItem(walletKey, JSON.stringify(newWalletBalances));\n      localStorage.setItem(walletKey + '_lastUpdated', timestamp);\n\n      //      Firebase ( )\n      const updateData = {\n        cashBalance: newCashBalance,\n        walletBalances: newWalletBalances,\n        lastUpdated: new Date().toISOString()\n      };\n      const localDataKey = `userData_${user?.uid}`;\n      localStorage.setItem(localDataKey, JSON.stringify(updateData));\n      try {\n        await userDataService.updateUserData(user.uid, updateData);\n        localStorage.removeItem(localDataKey);\n        setHasLocalDataToSync(false);\n      } catch (err) {\n        console.warn('    Firebase   ( ):', err);\n        setHasLocalDataToSync(true);\n      }\n\n      //    /\n      try {\n        const walletId = (tx as any).fromWallet || selectedWallet!;\n        const opType = (tx as any).type === 'send' ? 'transfer' : 'withdraw';\n        //  rollbackUsage        \n        await walletDailyLimitsService.rollbackUsage(walletId, amountVal, opType as any, tx.createdAt);\n      } catch (e) {\n        console.warn('      ():', e);\n      }\n\n      //     /\n      try {\n        reportsService.removeTransactionEffects(tx as any, user.uid);\n      } catch (e) {\n        console.warn('     ():', e);\n      }\n    } catch (e) {\n      console.warn('     :', e);\n    }\n  };\n\n  //         \n  const handleDeleteReceipt = async (transactionId: string) => {\n    try {\n      const tx = transactions.find(t => t.id === transactionId);\n      if (!tx || !user) return;\n      const idStr = String(transactionId);\n      const refStr = String((tx as any)?.transactionId || (tx as any)?.reference || '');\n      const alreadyApplied = deletedEffectsAppliedRef.current.has(idStr) || (refStr && deletedEffectsAppliedRef.current.has(refStr));\n\n      //        (   Firestore )\n      const updatedTransactions = transactions.filter(t => t.id !== transactionId);\n      setTransactions(updatedTransactions);\n\n      //    Firebase   \n      try {\n        await userDataService.removeUserTransaction(user.uid, transactionId);\n        await auditLogService.permanentlyDeleteTransaction(transactionId, user.uid);\n      } catch (e) {\n        console.warn('        :', e);\n      }\n      //      \n      if (!alreadyApplied) {\n        deletedEffectsAppliedRef.current.add(idStr);\n        if (refStr) deletedEffectsAppliedRef.current.add(refStr);\n        await applyLocalDeleteEffects(tx);\n        try { if (user?.uid) userDataService.removeLocalReceiptById(user.uid, transactionId); } catch { }\n      }\n\n      toast({\n        title: '  ',\n        description: '         .',\n      });\n\n      setIsReceiptOpen(false);\n    } catch (err) {\n      console.error('   :', err);\n      toast({\n        title: '   ',\n        description: '     .',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  //  :     \n  const handleCompleteReceipt = async (transactionId: string) => {\n    try {\n      const tx = transactions.find(t => t.id === transactionId);\n      if (!tx || !user) return;\n\n      //   : 5   /\n      try {\n        const plan = userSubscription?.planType;\n        if (plan === SubscriptionPlan.ZERO) {\n          const { dailyOperationCountService } = await import('@/utils/dailyOperationCountService');\n          const opType = (tx as any).type === 'send' ? 'transfer' : 'withdraw';\n          const res = await dailyOperationCountService.checkAndIncrement(user.uid, opType, 5);\n          if (!res.allowed) {\n            toast({\n              title: '    ',\n              description: '   5   /.     .',\n              variant: 'destructive',\n            });\n            return;\n          }\n        } else if (plan === SubscriptionPlan.TAHWEELA) {\n          const { dailyOperationCountService } = await import('@/utils/dailyOperationCountService');\n          const opType = (tx as any).type === 'send' ? 'transfer' : 'withdraw';\n          const res = await dailyOperationCountService.checkAndIncrementCombined(user.uid, opType, 40);\n          if (!res.allowed) {\n            toast({\n              title: '    ',\n              description: '     40  / .',\n              variant: 'destructive',\n            });\n            return;\n          }\n        }\n      } catch (limitErr) {\n        console.warn('     :', limitErr);\n      }\n\n      await updateDoc(doc(db, 'userTransactions', transactionId), {\n        status: 'completed',\n        confirmedAt: new Date()\n      });\n\n      setTransactions(prev => prev.map(t => t.id === transactionId ? { ...t, status: 'completed' } : t));\n\n      toast({\n        title: ' ',\n        description: '   .'\n      });\n\n      setIsReceiptOpen(false);\n    } catch (err) {\n      console.error('   :', err);\n      toast({\n        title: ' ',\n        description: '      .',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  //          \n  useEffect(() => {\n    if (!user) return;\n    const fetchDeletedTransactions = async () => {\n      try {\n        const q = fsQuery(collection(db, 'deletedTransactions'), where('userId', '==', user.uid), orderBy('createdAt', 'desc'), limit(50));\n        const snap = await getDocs(q);\n        \n        snap.docs.forEach((doc) => {\n          const data: any = doc.data();\n          const originalId = String(data?.originalTransactionId || '');\n          const txnId = String(data?.transactionId || '');\n          const refId = String(data?.reference || '');\n          const key = originalId || txnId || refId || String(doc.id);\n          \n          if (!key) return;\n          if (deletedEffectsAppliedRef.current.has(key)) return;\n          \n          deletedEffectsAppliedRef.current.add(key);\n          setTransactions((prev) => {\n            const tx = prev.find((t) => t.id === originalId);\n            if (!tx) return prev; \n            \n            //     \n            (async () => { await applyLocalDeleteEffects(tx); })();\n            \n            return prev.filter((t) => t.id !== originalId);\n          });\n        });\n      } catch (e) {\n        console.warn('   :', e);\n      }\n    };\n    \n    fetchDeletedTransactions();\n  }, [user?.uid]);\n\n  //        \n  //           \n  useEffect(() => {\n    if (!user) return;\n    const checkReportsData = async () => {\n      try {\n        const ref = doc(db, 'users', user.uid);\n        const snap = await getDoc(ref);\n        if (!snap.exists()) return;\n        const data = snap.data() as any;\n        if (!data?.reportsData) return;\n        \n        //        \n        try {\n          await reportsService.syncReportsDataFromFirebase(user.uid);\n          setDailyStats(calculateDailyStats());\n        } catch (e) {\n          console.warn('  reportsData  :', e);\n        }\n      } catch (e) {\n        console.warn('  users.reportsData:', e);\n      }\n    };\n    checkReportsData();\n  }, [user?.uid]);\n\n  //    \n  const [searchPhone, setSearchPhone] = useState('');\n  const debouncedSearchPhone = useDebouncedValue(searchPhone, 300);\n  const [selectedDate, setSelectedDate] = useState('');\n  const [selectedTime, setSelectedTime] = useState('');\n  //    \n  const [reportSearchPhone, setReportSearchPhone] = useState('');\n\n  //   \n  const [isTransferSuccess, setIsTransferSuccess] = useState(false);\n  const [isWithdrawSuccess, setIsWithdrawSuccess] = useState(false);\n  const [isPostConfirmPopupOpen, setIsPostConfirmPopupOpen] = useState(false);\n  const [postConfirmInfo, setPostConfirmInfo] = useState<{ type: 'transfer' | 'withdraw', amount: number } | null>(null);\n  const [lastUSSDTransfer, setLastUSSDTransfer] = useState<{ receiver: string; amount: number } | null>(null);\n  const [ussdLoading, setUssdLoading] = useState(false);\n  const [isPinModalOpen, setIsPinModalOpen] = useState(false);\n  const [lastDecoratedDeviceId, setLastDecoratedDeviceId] = useState<string>('');\n  //           \n\n  //   \n  const [isCalculatorOpen, setIsCalculatorOpen] = useState(false);\n  const showDesktopQuickIcons = false;\n  const [isInstallmentPinOpen, setIsInstallmentPinOpen] = useState(false);\n  const [isInstallmentModalOpen, setIsInstallmentModalOpen] = useState(false);\n\n\n  //    \n  const [isCreditCardsOpen, setIsCreditCardsOpen] = useState(false);\n  //   \n  const [isMaintenanceOpen, setIsMaintenanceOpen] = useState(false);\n  //    \n  const [isMachineDailyDialogOpen, setIsMachineDailyDialogOpen] = useState(false);\n\n  //          \n  const [isMonthlyLocked, setIsMonthlyLocked] = useState<boolean>(true);\n  const [areReportsCollapsed, setAreReportsCollapsed] = useState<boolean>(false);\n  const [isMonthlyPinDialogOpen, setIsMonthlyPinDialogOpen] = useState<boolean>(false);\n  const [isTelegramOpen, setIsTelegramOpen] = useState(false);\n  const [telegramChatId, setTelegramChatId] = useState('');\n  const [telegramDailyEnabled, setTelegramDailyEnabled] = useState(false);\n  const [isVipOpen, setIsVipOpen] = useState(false);\n\n  //      \n  const [isDailyLocked, setIsDailyLocked] = useState<boolean>(() => {\n    try {\n      const key = user?.uid ? `dailyReportsLockEnabled_${user?.uid}` : 'dailyReportsLockEnabled';\n      const v = localStorage.getItem(key) ?? localStorage.getItem('dailyReportsLockEnabled');\n      return v === 'true';\n    } catch {\n      return false;\n    }\n  });\n  const [isDailyPinDialogOpen, setIsDailyPinDialogOpen] = useState<boolean>(false);\n  useEffect(() => {\n    try {\n      const key = user?.uid ? `dailyReportsLockEnabled_${user?.uid}` : 'dailyReportsLockEnabled';\n      const v = localStorage.getItem(key) ?? localStorage.getItem('dailyReportsLockEnabled');\n      setIsDailyLocked(v === 'true');\n    } catch { }\n  }, [user?.uid]);\n\n  //   \n  const [isDebtsDialogOpen, setIsDebtsDialogOpen] = useState(false);\n  const [isDebtsPasswordDialogOpen, setIsDebtsPasswordDialogOpen] = useState(false);\n  const [isDebtsPinRequired, setIsDebtsPinRequired] = useState<boolean>(() => {\n    try {\n      const uid = user?.uid;\n      const key = uid ? `debtsPinRequired_${uid}` : 'debtsPinRequired';\n      const v = localStorage.getItem(key) ?? localStorage.getItem('debtsPinRequired');\n      return v === 'true';\n    } catch { return false; }\n  });\n  const [isDebtsPinToggleOpen, setIsDebtsPinToggleOpen] = useState(false);\n  const [pendingDebtsPinValue, setPendingDebtsPinValue] = useState<boolean | null>(null);\n  const [debtorName, setDebtorName] = useState('');\n  const [debtAmount, setDebtAmount] = useState('');\n  const [debtReason, setDebtReason] = useState('');\n  const [debtRole, setDebtRole] = useState<'debtor' | 'creditor' | null>(null);\n  const [selectedDebt, setSelectedDebt] = useState<Debt | null>(null);\n  const [isDebtReceiptOpen, setIsDebtReceiptOpen] = useState(false);\n  const [isDebtAdjustDialogOpen, setIsDebtAdjustDialogOpen] = useState<boolean>(false);\n  const [debtAdjustType, setDebtAdjustType] = useState<'increase' | 'decrease' | null>(null);\n  const [debtAdjustAmount, setDebtAdjustAmount] = useState<string>('');\n  const [pendingDebtAdjustment, setPendingDebtAdjustment] = useState<{ debtId: string; delta: number; type: 'increase' | 'decrease' } | null>(null);\n  //     \n  const [isDebtsPinDialogOpen, setIsDebtsPinDialogOpen] = useState(false);\n  //    \n  const [isPartialPaymentOpen, setIsPartialPaymentOpen] = useState(false);\n  const [partialPaymentAmount, setPartialPaymentAmount] = useState('');\n  //    \n  const [isDebtReceiptsListOpen, setIsDebtReceiptsListOpen] = useState(false);\n  const [debtsPage, setDebtsPage] = useState(1);\n  const DEBTS_PAGE_SIZE = isMobile ? 10 : 20;\n  const visibleDebts = React.useMemo(() => debts.slice(0, debtsPage * DEBTS_PAGE_SIZE), [debts, debtsPage]);\n  useEffect(() => {\n    if (isDebtReceiptsListOpen) {\n      setDebtsPage(1);\n    }\n  }, [isDebtReceiptsListOpen]);\n\n  const openDebts = async () => {\n    if (isZeroPlan) {\n      toast({ title: ' ', description: ' /     .  .', variant: 'destructive' });\n      return;\n    }\n    try {\n      const hasPin = await MasterPinService.hasMasterPin(user?.uid);\n      if (isDebtsPinRequired && hasPin) {\n        setIsDebtsPasswordDialogOpen(true);\n      } else {\n        setIsDebtsDialogOpen(true);\n      }\n    } catch {\n      setIsDebtsDialogOpen(true);\n    }\n  };\n\n  const handleDebtsPinToggle = (val: boolean) => {\n    setPendingDebtsPinValue(val);\n    setIsDebtsPinToggleOpen(true);\n  };\n\n  useEffect(() => {\n    try {\n      const uid = user?.uid;\n      const key = uid ? `debtsPinRequired_${uid}` : 'debtsPinRequired';\n      const v = localStorage.getItem(key) ?? localStorage.getItem('debtsPinRequired');\n      if (v === 'true' || v === 'false') setIsDebtsPinRequired(v === 'true');\n    } catch { }\n  }, [user?.uid]);\n\n  useEffect(() => {\n    const handler = () => { try { loadDebtsFromStorage(); } catch { } };\n    try { window.addEventListener('debtsUpdated', handler as EventListener); } catch { }\n    return () => { try { window.removeEventListener('debtsUpdated', handler as EventListener); } catch { } };\n  }, [user?.uid, shopIdCtx, profile?.shopId]);\n\n  //  \n  const [isAddCustomerDialogOpen, setIsAddCustomerDialogOpen] = useState(false);\n  const [customers, setCustomers] = useState<Customer[]>([]);\n  const [newCustomerName, setNewCustomerName] = useState('');\n  const [newCustomerMobile, setNewCustomerMobile] = useState('');\n  const [selectedCustomerId, setSelectedCustomerId] = useState('');\n  const [customerDebtAmount, setCustomerDebtAmount] = useState('');\n  const [isEditCustomerDialogOpen, setIsEditCustomerDialogOpen] = useState(false);\n  const [editingCustomerId, setEditingCustomerId] = useState<string>('');\n  const [editingCustomerName, setEditingCustomerName] = useState<string>('');\n  const [editingCustomerMobile, setEditingCustomerMobile] = useState<string>('');\n  const [isDeleteCustomerConfirmOpen, setIsDeleteCustomerConfirmOpen] = useState(false);\n  const [customerToDeleteId, setCustomerToDeleteId] = useState<string>('');\n  const [customerToDeleteName, setCustomerToDeleteName] = useState<string>('');\n\n  //    \n  const [isDebtDeductionChoiceOpen, setIsDebtDeductionChoiceOpen] = useState(false);\n  const [pendingDebtToCreate, setPendingDebtToCreate] = useState<Debt | null>(null);\n  const [deductionSource, setDeductionSource] = useState<'cash' | 'wallet' | 'none' | null>(null);\n  const [selectedWalletForDeduction, setSelectedWalletForDeduction] = useState<string>('');\n  //      (  )\n  const [isPaymentCreditChoiceOpen, setIsPaymentCreditChoiceOpen] = useState(false);\n  const [paymentAmountPending, setPaymentAmountPending] = useState<number>(0);\n  const [paymentCreditSource, setPaymentCreditSource] = useState<'cash' | 'wallet' | 'fawry' | 'none' | null>(null);\n  const [selectedWalletForPaymentCredit, setSelectedWalletForPaymentCredit] = useState<string>('');\n  const [selectedWalletLimits, setSelectedWalletLimits] = useState<any | null>(null);\n  const [selectedWalletName, setSelectedWalletName] = useState<string>('');\n\n  //    \n  const saveDebtsToStorage = async (debtsToSave: Debt[]) => {\n    try {\n      //   localStorage        \n      const serialized = JSON.stringify(debtsToSave);\n      localStorage.setItem(getDebtsKey(), serialized);\n      try { localStorage.setItem(getDebtsDefaultKey(), serialized); } catch { }\n      //           \n      try { localStorage.setItem(getDebtsLastWriteKey(), Date.now().toString()); } catch { }\n\n      if (user?.uid) {\n        // Mark as unsynced BEFORE starting sync\n        try { localStorage.setItem(`debts_unsynced_${user.uid}`, 'true'); } catch { }\n\n        const promises = [];\n\n        // 1. Update User Document\n        promises.push(userDataService.updateUserData(user.uid, { \n          debts: debtsToSave,\n          debtsDeletedAt: null // Clear deleted flag when saving new debts\n        }));\n\n        // 2. Sync all debts to collection (Background) - DISABLED\n        //               \n        /*\n        if (debtsToSave.length < 100) {\n            const batchPromises = debtsToSave.map(d => {\n                if (!d.id) return Promise.resolve();\n                const ref = doc(db, 'debts', d.id);\n                const p: any = { \n                    ...d, \n                    userId: user.uid, \n                    shopId: shopIdCtx || profile?.shopId || null,\n                    lastUpdated: new Date().toISOString()\n                };\n                Object.keys(p).forEach(key => p[key] === undefined && delete p[key]);\n                return setDoc(ref, p, { merge: true });\n            });\n            promises.push(Promise.all(batchPromises));\n        }\n        */\n\n        Promise.all(promises)\n          .then(() => {\n            try { localStorage.removeItem(`debts_unsynced_${user.uid}`); } catch { }\n          })\n          .catch((err) => {\n            console.error('  :', err);\n            setHasLocalDataToSync(true);\n            // Flag remains true\n          });\n      }\n    } catch (error) {\n      console.error('   :', error);\n    }\n  };\n\n  const loadDebtsFromStorage = async () => {\n    try {\n      // 1)           \n      const localUserKey = getDebtsKey();\n      const localDefaultKey = getDebtsDefaultKey();\n      const localLastWriteKey = getDebtsLastWriteKey();\n      const localByUser = localStorage.getItem(localUserKey);\n      const localByDefault = localStorage.getItem(localDefaultKey);\n      const lastWriteStr = localStorage.getItem(localLastWriteKey);\n      const lastWriteMs = lastWriteStr ? Number(lastWriteStr) : 0;\n\n      const parseDebts = (listStr: string | null) => {\n        if (!listStr) return null;\n        try {\n          const raw = JSON.parse(listStr);\n          return Array.isArray(raw)\n            ? raw.map((debt: any) => ({\n              ...debt,\n              createdAt: debt.createdAt?.toDate ? debt.createdAt.toDate() : new Date(debt.createdAt),\n              partialPayments: Array.isArray(debt.partialPayments)\n                ? debt.partialPayments.map((p: any) => ({\n                  amount: Number(p.amount) || 0,\n                  paidAt: p.paidAt?.toDate ? p.paidAt.toDate() : new Date(p.paidAt)\n                }))\n                : []\n            }))\n            : [];\n        } catch (e) {\n          console.warn('    localStorage:', e);\n          return null;\n        }\n      };\n\n      let localDebts: Debt[] | null = parseDebts(localByUser);\n      if (!localDebts || localDebts.length === 0) {\n        const migrated = parseDebts(localByDefault);\n        if (migrated && migrated.length > 0) {\n          localDebts = migrated;\n          setDebts(migrated);\n          //          Firebase    \n          try {\n            localStorage.setItem(getDebtsKey(), JSON.stringify(migrated));\n            localStorage.removeItem(localDefaultKey);\n          } catch (e) {\n            console.warn('      :', e);\n          }\n        }\n      }\n\n      if (localDebts && localDebts.length > 0) {\n        setDebts(localDebts);\n      }\n\n      // 2)   Firebase           \n      if (user?.uid) {\n        try {\n          const debtsUnsyncedKey = `debts_unsynced_${user.uid}`;\n          const hasDebtsUnsynced = localStorage.getItem(debtsUnsyncedKey) === 'true';\n          const userDocSnap = await getDoc(doc(db, 'users', user.uid));\n\n          //     (/)    \n          const collectionDebts: Debt[] = [];\n          try {\n             const q = query(collection(db, 'debts'), where('userId', '==', user.uid));\n             const snap = await getDocs(q);\n             snap.forEach(d => {\n                 const data = d.data();\n                 collectionDebts.push({\n                     id: d.id,\n                     ...data,\n                     amount: Number(data.amount || 0),\n                     paidAmount: Number(data.paidAmount || 0),\n                     createdAt: data.createdAt?.toDate ? data.createdAt.toDate() : new Date(data.createdAt || Date.now()),\n                     partialPayments: Array.isArray(data.partialPayments) ? data.partialPayments : []\n                 } as Debt);\n             });\n          } catch (e) { console.warn('Failed to fetch from debts collection:', e); } \n\n          if (userDocSnap.exists()) {\n            const userData = userDocSnap.data();\n            let fbDebts: Debt[] = userData.debts && Array.isArray(userData.debts)\n              ? userData.debts.map((debt: any) => ({\n                ...debt,\n                amount: Number(debt.amount || 0),\n                paidAmount: Number(debt.paidAmount || 0),\n                createdAt: debt.createdAt?.toDate ? debt.createdAt.toDate() : new Date(debt.createdAt),\n                partialPayments: Array.isArray(debt.partialPayments)\n                  ? debt.partialPayments.map((p: any) => ({\n                    amount: Number(p.amount) || 0,\n                    paidAt: p.paidAt?.toDate ? p.paidAt.toDate() : new Date(p.paidAt)\n                  }))\n                  : []\n              }))\n              : [];\n\n            //              \n            const debtsDeletedAt = userData.debtsDeletedAt;\n            const remoteMarkedDeleted = !!debtsDeletedAt;\n\n            if (remoteMarkedDeleted) {\n              setDebts([]);\n              try {\n                localStorage.setItem(localUserKey, JSON.stringify([]));\n                localStorage.setItem(localDefaultKey, JSON.stringify([]));\n              } catch {}\n              return; //   \n            }\n\n            //  :        \n            //         (debts_unsynced)\n            if ((fbDebts?.length || 0) > 0) {\n              if (hasDebtsUnsynced) {\n                console.log('               .');\n              } else {\n                setDebts(fbDebts);\n                try { localStorage.setItem(localUserKey, JSON.stringify(fbDebts)); } catch {}\n              }\n            } else {\n              //  :      \n              //         \n            }\n          } else if (collectionDebts.length > 0) {\n             // User doc missing but debts collection has data\n             setDebts(collectionDebts);\n             try { localStorage.setItem(localUserKey, JSON.stringify(collectionDebts)); } catch {}\n          } else if (localDebts && localDebts.length > 0) {\n            //       \n            //             \n            //           \n          }\n        } catch (e) {\n          console.warn('    Firebase   :', e);\n        }\n      }\n    } catch (error) {\n      console.error('   :', error);\n    }\n  };\n\n  //           UI\n  useEffect(() => {\n    try {\n      (window as any).exportDebts = () => {\n        try { return JSON.stringify(debts || []); } catch { return '[]'; }\n      };\n      (window as any).importDebts = async (json: string) => {\n        try {\n          const arr = JSON.parse(json);\n          if (!Array.isArray(arr)) throw new Error('       ');\n          await saveDebtsToStorage(arr);\n          return { ok: true, count: arr.length };\n        } catch (e) {\n          console.error('  :', e);\n          return { ok: false, error: String(e) };\n        }\n      };\n      (window as any).fixWalletsForCurrentUser = async (msisdns: string[]) => {\n        try {\n          if (!user?.uid) throw new Error('   ');\n          const svc = (await import('@/integrations/firebase/services')).merchantWalletService;\n          return await svc.reassignByMsisdns(msisdns, user.uid);\n        } catch (e) {\n          console.error('    :', e);\n          return { updated: 0, failed: (msisdns?.length || 0), error: String(e) };\n        }\n      };\n    } catch (e) {\n      //     window\n    }\n  }, [debts, user?.uid]);\n\n  //       \n  useEffect(() => {\n    if (user?.uid) {\n        loadDebtsFromStorage();\n    }\n  }, [user?.uid]);\n\n\n\n  //       (Real-time Listener)\n  useEffect(() => {\n    if (!user?.uid) return;\n\n    const unsubscribe = onSnapshot(doc(db, 'users', user.uid), async (snapshot) => {\n      if (snapshot.exists()) {\n        const userData = snapshot.data();\n        const isActive = userData.isActive === true;\n        \n        //     \n        if (userData.subscription) {\n           setUserSubscription(userData.subscription);\n        }\n        \n        // Update branch package info (real-time)\n        setBranchPackage(userData.branchPackage || null);\n\n        //     (         )\n        // :            Snapshot\n        //     \"isActive\"    \n        const trialValidity = await FreeTrialService.checkTrialValidity(user.uid);\n        const isOnTrial = trialValidity.isValid && !trialValidity.isExpired;\n\n        //    \n        setIsUserActive(isActive || isOnTrial);\n        setIsOnFreeTrial(isOnTrial);\n        setFreeTrialHoursRemaining(trialValidity.hoursRemaining);\n        setHasUsedFreeTrial(trialValidity.hasUsedTrial);\n        \n        //    :\n        //       ()     \n        const shouldShowModal = !isActive && !isOnTrial;\n        setShowActivationModal(shouldShowModal);\n\n        if (shouldShowModal) {\n           console.log(' User not active, redirecting to pending approval...');\n           navigate('/user/pending-approval', { replace: true });\n        }\n\n        console.log('     (Real-time):', { \n            isActive, \n            isOnTrial, \n            plan: userData.subscription?.planType,\n            showModal: shouldShowModal \n        });\n      }\n    });\n\n    return () => unsubscribe();\n  }, [user?.uid]);\n\n  //     \n  const recheckUserStatus = async () => {\n    if (!user?.uid) return;\n\n    console.log('    ...');\n\n    try {\n      //          \n      await new Promise(resolve => setTimeout(resolve, 500));\n\n      const userDoc = await getDoc(doc(db, 'users', user.uid));\n      if (userDoc.exists()) {\n        const userData = userDoc.data();\n        const isActive = userData.isActive === true;\n\n        //    \n        const trialValidity = await FreeTrialService.checkTrialValidity(user.uid);\n        const isOnTrial = trialValidity.isValid && !trialValidity.isExpired;\n\n        console.log('  :', {\n          isActive,\n          isOnTrial,\n          hoursRemaining: trialValidity.hoursRemaining\n        });\n\n        setIsUserActive(isActive || isOnTrial);\n        setIsOnFreeTrial(isOnTrial);\n        setFreeTrialHoursRemaining(trialValidity.hoursRemaining);\n        setHasUsedFreeTrial(trialValidity.hasUsedTrial);\n        setShowActivationModal(!isActive && !isOnTrial);\n\n        console.log('     :', {\n          userIsActive: isActive || isOnTrial,\n          isOnFreeTrial: isOnTrial\n        });\n      }\n    } catch (error) {\n      console.error('     :', error);\n    }\n  };\n\n  //      \n  const handleTrialStarted = async () => {\n    console.log('        ...');\n    await recheckUserStatus();\n    //      \n  };\n\n  //    \n  const fetchSubscriptionData = async () => {\n    if (!user?.uid) return;\n\n    try {\n      setIsRefreshingSubscription(true);\n      const subscriptionData = await getUserSubscription(user.uid);\n      setUserSubscription(subscriptionData);\n    } catch (error) {\n      console.error('    :', error);\n    } finally {\n      setIsRefreshingSubscription(false);\n    }\n  };\n\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  const [isDatePickerOpen, setIsDatePickerOpen] = useState(false);\n\n  //   \n  const MONTHLY_WITHDRAWAL_LIMIT = 200000; //   \n  const MONTHLY_TRANSFER_LIMIT = 200000; //   \n\n  //   \n  const [cashBalance, setCashBalance] = useState(0); //    \n  const [walletBalances, setWalletBalances] = useState<{ [key: string]: number }>({}); //  \n\n  //   \n  const [isEditCashDialogOpen, setIsEditCashDialogOpen] = useState(false);\n  const [isEditWalletDialogOpen, setIsEditWalletDialogOpen] = useState(false);\n  const [isAddToWalletDialogOpen, setIsAddToWalletDialogOpen] = useState(false);\n  //     \n  const [isResetSelectedWalletDialogOpen, setIsResetSelectedWalletDialogOpen] = useState(false);\n  const [resetSelectedWalletPinInput, setResetSelectedWalletPinInput] = useState('');\n  //    \n  const [isResetRecentDialogOpen, setIsResetRecentDialogOpen] = useState(false);\n\n  //     \n  const [isCashAmountDialogOpen, setIsCashAmountDialogOpen] = useState(false);\n  const [cashAmountInput, setCashAmountInput] = useState('');\n\n  //       \n  const [isTopUpOpen, setIsTopUpOpen] = useState(false);\n  const [topupPhone, setTopupPhone] = useState('');\n  const [topupOperator, setTopupOperator] = useState('');\n  const [topupAmount, setTopupAmount] = useState<number | ''>('');\n  const [topupLoading, setTopupLoading] = useState(false);\n  const [isYourReportsOpen, setIsYourReportsOpen] = useState(false);\n  const [isReportsPinOpen, setIsReportsPinOpen] = useState(false);\n  const [reportArchives, setReportArchives] = useState<any[]>([]);\n  useEffect(() => {\n    (async () => {\n      try {\n        if (!user?.uid || !isYourReportsOpen) return;\n        try { await dailyReportsArchiveService.trimToMaxCount(user.uid, 30); } catch { }\n        const data = await dailyReportsArchiveService.getByUser(user.uid, 30);\n        setReportArchives(data);\n      } catch { }\n    })();\n  }, [user?.uid, isYourReportsOpen]);\n\n  //     localStorage  \n  const getWalletBalancesKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `walletBalances_${user?.uid || 'default'}_${sid}`;\n  };\n  const getCashBalanceKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `cashBalance_${user?.uid || 'default'}_${sid}`;\n  };\n  const getDebtsKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `debts_${user?.uid || 'default'}_${sid}`;\n  };\n  const getCustomersKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `customers_${user?.uid || 'default'}_${sid}`;\n  };\n  //         uid  \n  const getDebtsDefaultKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `debts_default_${sid}`;\n  };\n  //        \n  const getDebtsLastWriteKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `debts_last_write_${user?.uid || 'default'}_${sid}`;\n  };\n\n  // /  \n  const getExpensesKey = () => `shopExpenses_${(shopIdCtx || profile?.shopId || user?.uid || 'default')}`;\n  const loadExpensesFromStorage = () => {\n    try {\n      const saved = localStorage.getItem(getExpensesKey());\n      if (saved) {\n        const parsed = JSON.parse(saved) as ShopExpense[];\n        setExpenses(parsed.map(e => ({ ...e, createdAt: new Date(e.createdAt) })));\n      }\n    } catch (e) {\n      console.error('      :', e);\n    }\n  };\n  const saveExpensesToStorage = async (list: ShopExpense[]) => {\n    try {\n      localStorage.setItem(getExpensesKey(), JSON.stringify(list));\n      setExpenses(list);\n    } catch (e) {\n      console.error('      :', e);\n    }\n  };\n\n  //     (    )\n  const permanentlyDeleteExpense = async (expenseId: string) => {\n    try {\n      const remaining = expenses.filter(e => e.id !== expenseId);\n      await saveExpensesToStorage(remaining);\n\n      //   Firestore       \n      try {\n        if (user?.uid && expenseId) {\n          const { doc, deleteDoc } = await import('firebase/firestore');\n          const { db } = await import('@/firebase');\n          const ref = doc(db, 'shop_expenses', expenseId);\n          await deleteDoc(ref);\n        }\n      } catch (cloudErr) {\n        console.warn('             :', cloudErr);\n      }\n\n      toast({ title: ' ', description: '    .' });\n    } catch (err) {\n      console.error('     :', err);\n      toast({ title: ' ', description: '  .   .', variant: 'destructive' });\n    }\n  };\n\n  //      Firestore (          )\n  React.useEffect(() => {\n    let unsubscribe: (() => void) | undefined;\n    (async () => {\n      try {\n        if (!user?.uid) {\n          //            \n          loadExpensesFromStorage();\n          return;\n        }\n        const { collection, query, where, getDocs } = await import('firebase/firestore');\n        const { db } = await import('@/firebase');\n        const shopId = shopIdCtx || profile?.shopId;\n        //  shopId       userId     \n        const q = shopId\n          ? query(collection(db, 'shop_expenses'), where('shopId', '==', shopId))\n          : query(collection(db, 'shop_expenses'), where('userId', '==', user.uid));\n        \n        const snap = await getDocs(q);\n        const cloudItems: ShopExpense[] = snap.docs.map((d) => {\n          const data: any = d.data();\n          const created = data.createdAt?.toDate\n            ? data.createdAt.toDate()\n            : (data.createdAt ? new Date(data.createdAt) : new Date());\n          return {\n            id: d.id,\n            name: String(data.name || ''),\n            amount: Number(data.amount || 0),\n            notes: data.notes ? String(data.notes) : undefined,\n            source: (data.source === 'wallet') ? 'wallet' : 'cash',\n            walletId: data.walletId ? String(data.walletId) : undefined,\n            createdAt: created,\n          };\n        });\n        //    createdAt        \n        const finalList: ShopExpense[] = cloudItems.sort((a, b) => {\n          const timeA = a.createdAt instanceof Date ? a.createdAt.getTime() : 0;\n          const timeB = b.createdAt instanceof Date ? b.createdAt.getTime() : 0;\n          return timeB - timeA;\n        });\n        setExpenses(finalList);\n        //       \n        try { localStorage.setItem(getExpensesKey(), JSON.stringify(finalList)); } catch { }\n      } catch (e) {\n        console.error('      Firestore:', e);\n      }\n    })();\n\n    return () => unsubscribe?.();\n  }, [user?.uid, profile?.shopId, shopIdCtx]);\n\n  // / \n  const getDeficienciesKey = () => `deficiencies_${(shopIdCtx || profile?.shopId || user?.uid || 'default-shop')}`;\n  const loadDeficienciesFromStorage = () => {\n    try {\n      //        \n      const newKey = getDeficienciesKey();\n      const oldKey = `deficiencies_${(user?.uid || 'default')}`;\n      if (oldKey !== newKey) {\n        const oldRaw = localStorage.getItem(oldKey);\n        const newRaw = localStorage.getItem(newKey);\n        if (oldRaw) {\n          try {\n            const oldList = JSON.parse(oldRaw) || [];\n            const newList = newRaw ? JSON.parse(newRaw) : [];\n            const merged = Array.isArray(newList) ? [...newList] : [];\n            const has = (arr: any[], item: any) => arr.some((d) => (d?.id && item?.id && String(d.id) === String(item.id)) || (String(d?.name || '') === String(item?.name || '') && String(d?.status || 'pending') === String(item?.status || 'pending')));\n            if (Array.isArray(oldList)) {\n              for (const it of oldList) { if (!has(merged, it)) merged.push(it); }\n            }\n            localStorage.setItem(newKey, JSON.stringify(merged));\n            try { localStorage.removeItem(oldKey); } catch { }\n          } catch { }\n        }\n      }\n\n      const saved = localStorage.getItem(newKey);\n      if (saved) {\n        const parsed = JSON.parse(saved) as DeficiencyItem[];\n        setDeficiencies(parsed.map(d => ({ ...d, createdAt: new Date(d.createdAt) })));\n      }\n    } catch (e) {\n      console.error('     :', e);\n    }\n  };\n  const saveDeficienciesToStorage = async (list: DeficiencyItem[]) => {\n    try {\n      localStorage.setItem(getDeficienciesKey(), JSON.stringify(list));\n      setDeficiencies(list);\n    } catch (e) {\n      console.error('     :', e);\n    }\n  };\n\n  //   (  )\n  React.useEffect(() => {\n    const fetchDeficiencies = async () => {\n      try {\n        if (!user?.uid) return;\n        const { collection, query, where, orderBy, getDocs } = await import('firebase/firestore');\n        const { db } = await import('@/firebase');\n        const currentShopId = (shopIdCtx || profile?.shopId || user.uid || 'default-shop');\n        const q = query(collection(db, 'deficiencies'), where('shopId', '==', currentShopId), orderBy('createdAt', 'desc'));\n        \n        const snap = await getDocs(q);\n        const items: DeficiencyItem[] = snap.docs.map((d) => {\n          const data: any = d.data();\n          const created = data.createdAt?.toDate ? data.createdAt.toDate() : (data.createdAt ? new Date(data.createdAt) : new Date());\n          return {\n            id: d.id,\n            name: String(data.name || ''),\n            quantity: Number(data.quantity || 1),\n            status: (data.status === 'purchased') ? 'purchased' : 'pending',\n            createdAt: created,\n          };\n        });\n        setDeficiencies(items);\n        try { localStorage.setItem(getDeficienciesKey(), JSON.stringify(items)); } catch { }\n      } catch (e) {\n        console.warn('    Firestore:', e);\n      }\n    };\n    fetchDeficiencies();\n  }, [user?.uid, profile?.shopId, shopIdCtx]);\n\n  // / \n  const saveCustomersToStorage = async (list: Customer[]) => {\n    try {\n      localStorage.setItem(getCustomersKey(), JSON.stringify(list));\n      setCustomers(list);\n      if (user?.uid) {\n        await userDataService.updateUserData(user.uid, { customers: list });\n      }\n    } catch (e) {\n      console.error('     :', e);\n    }\n  };\n  const loadCustomersFromStorage = async () => {\n    try {\n      if (user?.uid) {\n        const userDoc = await getDoc(doc(db, 'users', user.uid));\n        if (userDoc.exists()) {\n          const userData = userDoc.data();\n          if (userData.customers && Array.isArray(userData.customers)) {\n            const firebaseCustomers = userData.customers.map((c: any) => ({\n              ...c,\n              createdAt: c.createdAt?.toDate ? c.createdAt.toDate() : new Date(c.createdAt)\n            }));\n            setCustomers(firebaseCustomers);\n            return;\n          }\n        }\n      }\n      //      Firestore       \n      setCustomers([]);\n    } catch (e) {\n      console.error('     Firestore:', e);\n      //           \n    }\n  };\n  const getTransactionsKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `transactions_${user?.uid || 'default'}_${sid}`;\n  };\n  const getDeletedTransactionsKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `deletedTransactions_${user?.uid || 'default'}_${sid}`;\n  };\n  const getWalletsKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `wallets_${user?.uid || 'default'}_${sid}`;\n  };\n  const getSelectedWalletKey = () => {\n    const sid = (shopIdCtx || profile?.shopId || 'main');\n    return `selectedWallet_${user?.uid || 'default'}_${sid}`;\n  };\n  const getTransactionKey = (t: any) => {\n    const id = String((t as any)?.transactionId || (t as any)?.id || '');\n    const ref = String((t as any)?.reference || (t as any)?.transactionReference || (t as any)?.receipt?.reference || '');\n    const createdAtMs = new Date(((t as any)?.createdAt || 0)).getTime();\n    return id || ref || `${ref || 'ref'}-${createdAtMs}`;\n  };\n\n  const loadWalletsFromLocalWithMigration = (): any[] | null => {\n    try {\n      const currentKey = getWalletsKey();\n      const current = localStorage.getItem(currentKey);\n      if (current) {\n        const parsed = JSON.parse(current);\n        if (Array.isArray(parsed) && parsed.length > 0) return parsed;\n      }\n    } catch (e) {\n      console.warn('loadWalletsFromLocalWithMigration failed:', e);\n    }\n    return null;\n  };\n\n  //  React Query     \n  const { data: transactionsData, refetch: refetchTransactions } = useQuery({\n    queryKey: ['userTransactions', user?.uid],\n    queryFn: async () => {\n      if (!user?.uid) return [];\n      const { collection, query, where, orderBy, limit, getDocs } = await import('firebase/firestore');\n      const { db } = await import('@/firebase');\n      const q = query(\n        collection(db, 'userTransactions'),\n        where('userId', '==', user.uid),\n        orderBy('createdAt', 'desc'),\n        limit(100)\n      );\n      const snap = await getDocs(q);\n      return snap.docs.map((d) => {\n        const data: any = d.data();\n        const created = data.createdAt?.toDate ? data.createdAt.toDate() : new Date(data.createdAt);\n        const type = data.txnType === 'send' ? 'send' : (data.txnType === 'receive' ? 'withdraw' : (data.type || 'withdraw'));\n        const status = data.status === 'confirmed' ? 'completed' : (data.status || 'completed');\n        const senderPhone = data.senderMsisdn || data.senderPhone || '';\n        const receiverPhone = data.receiverMsisdn || data.receiverPhone || '';\n        const amount = Number(data.amount ?? data.transferredAmount ?? data.withdrawnAmount ?? 0);\n        return { id: d.id, ...data, type, status, senderPhone, receiverPhone, amount, createdAt: created, provider: data.provider || undefined };\n      });\n    },\n    enabled: !!user?.uid,\n    staleTime: 1000 * 60 * 5, // 5 minutes\n    gcTime: 1000 * 60 * 10, // 10 minutes\n  });\n\n  useEffect(() => {\n    if (transactionsData) {\n      const items = transactionsData;\n      const filtered = items.filter((t: any) => !(t?.type === 'report' || String((t as any)?.title || '').includes('  ')));\n      const deletedIds = new Set<string>((deletedTransactions || []).map((dt: any) => String(dt.id || dt.originalTransactionId || '')));\n      const active = filtered.filter((t: any) => !deletedIds.has(String(t.id || '')));\n      const seen = new Set<string>();\n      const distinct: any[] = [];\n      for (const t of active) {\n        const key = getTransactionKey(t);\n        if (!seen.has(key)) {\n          seen.add(key);\n          distinct.push(t);\n        }\n      }\n      setTransactions(distinct);\n    }\n  }, [transactionsData, deletedTransactions]);\n\n  //          \n  useEffect(() => {\n    if (!user?.uid) return;\n    let isActive = true;\n\n    const fetchDeletedTransactions = async () => {\n      try {\n        const { collection, query, where, getDocs, orderBy, limit } = await import('firebase/firestore');\n        const { db } = await import('@/firebase');\n        const q = query(collection(db, 'deletedTransactions'), where('userId', '==', user.uid), orderBy('createdAt', 'desc'), limit(50));\n        \n        //      onSnapshot\n        const snap = await getDocs(q);\n        \n        if (!isActive) return;\n\n        snap.docs.forEach((doc) => {\n          const data: any = doc.data();\n          const originalId = String(data?.originalTransactionId || '');\n          const txnId = String(data?.transactionId || '');\n          const refId = String(data?.reference || '');\n          const key = originalId || txnId || refId || String(doc.id);\n          \n          if (!key) return;\n          if (deletedEffectsAppliedRef.current.has(key)) return;\n          \n          deletedEffectsAppliedRef.current.add(key);\n          setTransactions((prev) => {\n            const tx = prev.find((t) => t.id === originalId);\n            if (!tx) return prev; \n            \n            //     \n            (async () => { await applyLocalDeleteEffects(tx); })();\n            \n            return prev.filter((t) => t.id !== originalId);\n          });\n        });\n      } catch (e) {\n        console.warn('   :', e);\n      }\n    };\n    \n    fetchDeletedTransactions();\n    \n    return () => { isActive = false; };\n  }, [user?.uid]);\n\n\n\n  const migrateSelectedWalletKeyIfNeeded = (walletsList: any[]) => {\n    try {\n      const currentSelectedKey = getSelectedWalletKey();\n      const currentSelected = localStorage.getItem(currentSelectedKey);\n      if (currentSelected && walletsList.find((w: any) => w.id === currentSelected)) {\n        return currentSelected;\n      }\n    } catch { }\n    return null;\n  };\n\n  const [cashPinInput, setCashPinInput] = useState('');\n  const [editingWalletId, setEditingWalletId] = useState<string>('');\n\n  //   /   \n  const isShiftHandoverAllowed = React.useMemo(() => {\n    const sub = userSubscription; //      \n    if (!sub) return false;\n    const valid = isSubscriptionValid(sub);\n    //      enum   \"plan\"  \n    const rawPlan: any = (sub as any).planType ?? (sub as any).plan ?? null;\n    const planStr = typeof rawPlan === 'string' ? rawPlan.toLowerCase() : null;\n    //        \n    const allowedPlan =\n      (planStr === 'monthly' || planStr === 'quarterly' || planStr === 'yearly' || planStr === 'lifetime') ||\n      (rawPlan === SubscriptionPlan.MONTHLY || rawPlan === SubscriptionPlan.QUARTERLY || rawPlan === SubscriptionPlan.YEARLY || rawPlan === SubscriptionPlan.LIFETIME);\n    return valid && allowedPlan;\n  }, [userSubscription]);\n\n  //        \n  const isZeroPlan = React.useMemo(() => {\n    const sub = userSubscription;\n    if (!sub) return false;\n    const rawPlan: any = (sub as any).subscription?.planType ?? (sub as any).subscription?.plan ?? (sub as any).planType ?? (sub as any).plan ?? null;\n    const planStr = typeof rawPlan === 'string' ? rawPlan.toLowerCase() : null;\n    return rawPlan === SubscriptionPlan.ZERO || planStr === 'zero';\n  }, [userSubscription]);\n\n  const isTahweelaPlan = React.useMemo(() => {\n    const sub = userSubscription;\n    if (!sub) return false;\n    const rawPlan: any = (sub as any).subscription?.planType ?? (sub as any).subscription?.plan ?? (sub as any).planType ?? (sub as any).plan ?? null;\n    const planStr = typeof rawPlan === 'string' ? String(rawPlan).trim().toLowerCase() : null;\n    return rawPlan === SubscriptionPlan.TAHWEELA || planStr === 'tahweela' || planStr === '';\n  }, [userSubscription]);\n\n  const handleOpenShiftProfile = () => {\n    if (!isShiftHandoverAllowed) {\n      toast({\n        title: ' ',\n        description: '   :      .   .',\n        variant: 'destructive'\n      });\n      return;\n    }\n    setIsCashierModalOpen(true);\n  };\n  const [isEditCashBalanceOpen, setIsEditCashBalanceOpen] = useState(false);\n  const [isChangePinDialogOpen, setIsChangePinDialogOpen] = useState(false);\n  const [isChangeCashPinDialogOpen, setIsChangeCashPinDialogOpen] = useState(false);\n  const [isChangeWalletTotalPinDialogOpen, setIsChangeWalletTotalPinDialogOpen] = useState(false);\n\n  //     \n  const [isAddCashDialogOpen, setIsAddCashDialogOpen] = useState(false);\n  const [addCashAmountInput, setAddCashAmountInput] = useState('');\n  const [addCashPinInput, setAddCashPinInput] = useState('');\n  const [isAddingCash, setIsAddingCash] = useState(false);\n  const [addCashNoteEnabled, setAddCashNoteEnabled] = useState<'yes' | 'no' | null>(null);\n  const [addCashNoteText, setAddCashNoteText] = useState('');\n\n  //      PIN\n  const [isCashSummaryOpen, setIsCashSummaryOpen] = useState(false);\n  const [isCashSummaryPinDialogOpen, setIsCashSummaryPinDialogOpen] = useState(false);\n\n  //      \n  const [isAddWalletTotalDialogOpen, setIsAddWalletTotalDialogOpen] = useState(false);\n  const [addWalletTotalAmountInput, setAddWalletTotalAmountInput] = useState('');\n  const [addWalletTotalPinInput, setAddWalletTotalPinInput] = useState('');\n  const [isAddingWalletTotal, setIsAddingWalletTotal] = useState(false);\n\n\n\n\n\n\n  //      Firebase\n  const syncLocalDataWithFirebase = async () => {\n    if (!user?.uid) return;\n\n    try {\n      const localDataKey = `userData_${user.uid}`;\n      const localDataStr = localStorage.getItem(localDataKey);\n      const debtsUnsyncedKey = `debts_unsynced_${user.uid}`;\n      const localDebtsStr = localStorage.getItem(getDebtsKey());\n      const hasDebtsUnsynced = localStorage.getItem(debtsUnsyncedKey) === 'true';\n\n      if (localDataStr) {\n        const localData = JSON.parse(localDataStr);\n        console.log('     Firebase...', localData);\n\n        //     undefined   Firestore\n        const payload: any = { lastSynced: new Date().toISOString() };\n        if (typeof localData.cashBalance === 'number') {\n          payload.cashBalance = localData.cashBalance;\n        }\n        if (localData.walletBalances && typeof localData.walletBalances === 'object') {\n          payload.walletBalances = localData.walletBalances;\n        }\n\n        //     Firebase  \n        await userDataService.updateUserData(user.uid, payload);\n\n        //      \n        localStorage.removeItem(localDataKey);\n        setHasLocalDataToSync(false);\n        console.log('      ');\n\n        //        \n      } else {\n        //          \n        console.log('     ');\n      }\n\n      //        \n      if (hasDebtsUnsynced && localDebtsStr) {\n        try {\n          const localDebtsRaw = JSON.parse(localDebtsStr) || [];\n          const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : (v ? new Date(String(v)) : new Date());\n          const normalize = (arr: any[]) => (Array.isArray(arr) ? arr : []).map((d: any) => ({\n            ...d,\n            amount: Number(d.amount || 0),\n            paidAmount: Number(d.paidAmount || 0),\n            createdAt: toJsDate(d.createdAt),\n            partialPayments: Array.isArray(d.partialPayments)\n              ? d.partialPayments.map((p: any) => ({ amount: Number(p.amount || 0), paidAt: toJsDate(p.paidAt) }))\n              : []\n          }));\n          const snap = await getDoc(doc(db, 'users', user.uid));\n          const remoteDebtsRaw = snap.exists() ? (((snap.data() as any)?.debts) || []) : [];\n          const remoteDebts = normalize(remoteDebtsRaw);\n          const localDebts = normalize(localDebtsRaw);\n          const byIdRemote: Record<string, any> = {};\n          for (const r of remoteDebts) { byIdRemote[String(r.id || '')] = r; }\n          const merged: any[] = [];\n          const used = new Set<string>();\n          for (const ld of localDebts) {\n            const id = String(ld.id || '');\n            const rd = byIdRemote[id];\n            if (rd) {\n              const rdPaid = Number(rd.paidAmount || 0) + (Array.isArray(rd.partialPayments) ? rd.partialPayments.reduce((s: number, p: any) => s + Number(p.amount || 0), 0) : 0);\n              const ldPaid = Number(ld.paidAmount || 0) + (Array.isArray(ld.partialPayments) ? ld.partialPayments.reduce((s: number, p: any) => s + Number(p.amount || 0), 0) : 0);\n              const rdStatus = String(rd.status || 'pending');\n              const ldStatus = String(ld.status || 'pending');\n              const take = (rdStatus === 'paid' || rdPaid >= Number(rd.amount || 0))\n                ? rd\n                : (ldStatus === 'paid'\n                  ? { ...rd, paidAmount: Number(ld.paidAmount || 0), partialPayments: ld.partialPayments, status: 'paid' }\n                  : (ldPaid > rdPaid\n                    ? { ...rd, paidAmount: Number(ld.paidAmount || 0), partialPayments: ld.partialPayments, status: (ldPaid >= Number(rd.amount || 0) ? 'paid' : 'pending') }\n                    : rd));\n              merged.push(take);\n              used.add(id);\n            } else {\n              merged.push(ld);\n              used.add(id);\n            }\n          }\n          for (const rd of remoteDebts) {\n            const id = String(rd.id || '');\n            if (!used.has(id)) merged.push(rd);\n          }\n          await userDataService.updateUserData(user.uid, { debts: merged });\n          try { localStorage.removeItem(debtsUnsyncedKey); } catch { }\n          setHasLocalDataToSync(false);\n        } catch (e) {\n          setHasLocalDataToSync(true);\n        }\n      }\n    } catch (error) {\n      console.error('    :', error);\n      toast({\n        title: \"  \",\n        description: \"      \",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  //      \n  const checkForLocalData = () => {\n    if (!user?.uid) return;\n\n    const localDataKey = `userData_${user.uid}`;\n    const localDataStr = localStorage.getItem(localDataKey);\n    setHasLocalDataToSync(!!localDataStr);\n  };\n\n  //   \n  const refreshTransactions = async () => {\n    if (!user?.uid) return;\n\n    setIsRefreshing(true);\n    try {\n      await loadUserData();\n      toast({\n        title: \" \",\n        description: \"   \",\n        variant: \"default\",\n      });\n    } catch (error) {\n      console.error('   :', error);\n      toast({\n        title: \" \",\n        description: \"    \",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsRefreshing(false);\n    }\n  };\n\n  //        +      N  \n  const [recentResetConfig, setRecentResetConfig] = useState<{ keepLastCount: number; intervalDays: number; lastResetAt: Date | null }>({ keepLastCount: 30, intervalDays: 7, lastResetAt: null });\n  useEffect(() => {\n    const initWeeklyReset = async () => {\n      if (!user?.uid) return;\n      try {\n        const data = await userDataService.getUserData(user.uid);\n        const raw = (data?.recentReset || {}) as any;\n        const keep = Number(raw?.keepLastCount) > 0 ? Number(raw.keepLastCount) : 30;\n        const interval = Number(raw?.intervalDays) > 0 ? Number(raw.intervalDays) : 7;\n        const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : (v ? new Date(String(v)) : null);\n        const last: Date | null = raw?.lastResetAt ? toJsDate(raw.lastResetAt) : null;\n        const now = new Date();\n        const needReset = !last || (now.getTime() - last.getTime()) >= interval * 24 * 60 * 60 * 1000;\n        if (needReset) {\n          await userDataService.updateUserData(user.uid, { recentReset: { keepLastCount: keep, intervalDays: interval, lastResetAt: now } });\n          setRecentResetConfig({ keepLastCount: keep, intervalDays: interval, lastResetAt: now });\n        } else {\n          setRecentResetConfig({ keepLastCount: keep, intervalDays: interval, lastResetAt: last });\n        }\n      } catch {\n        setRecentResetConfig({ keepLastCount: 30, intervalDays: 7, lastResetAt: null });\n      }\n    };\n    initWeeklyReset();\n  }, [user?.uid]);\n\n  const effectiveTransactions = React.useMemo(() => {\n    const base = transactions || [];\n    const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : new Date(String(v));\n    const now = new Date();\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n    const nextMonthStart = new Date(now.getFullYear(), now.getMonth() + 1, 1);\n    const sorted = [...base].sort((a: any, b: any) => toJsDate(b.createdAt).getTime() - toJsDate(a.createdAt).getTime());\n    return sorted.filter((t: any) => {\n      const d = toJsDate(t.createdAt);\n      return d >= monthStart && d < nextMonthStart;\n    });\n  }, [transactions]);\n  const hiddenCount = React.useMemo(() => {\n    const base = transactions || [];\n    const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : new Date(String(v));\n    const now = new Date();\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n    const nextMonthStart = new Date(now.getFullYear(), now.getMonth() + 1, 1);\n    const visibleMonthly = base.filter((t: any) => {\n      const d = toJsDate(t.createdAt);\n      return d >= monthStart && d < nextMonthStart;\n    }).length;\n    return Math.max(0, (transactions?.length || 0) - visibleMonthly);\n  }, [transactions?.length]);\n\n  const vipTop10 = React.useMemo(() => {\n    const now = new Date();\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n    const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 1);\n    const items: Record<string, { phone: string; count: number; total: number }> = {};\n    for (const t of transactions) {\n      const d = new Date((t as any).createdAt || 0);\n      if (!(d >= monthStart && d < monthEnd)) continue;\n      const type = String((t as any).type || (t as any).txnType || '').toLowerCase();\n      if (!(type === 'send' || type === 'withdraw' || type === 'transfer')) continue;\n      const phoneRaw = String((t as any).receiverPhone || (t as any).senderPhone || '').trim();\n      if (!phoneRaw) continue;\n      const phone = formatNumberEnglish(phoneRaw);\n      const amount = Number((t as any).amount || (t as any).withdrawnAmount || (t as any).sentAmount || 0) || 0;\n      if (!items[phone]) items[phone] = { phone, count: 0, total: 0 };\n      items[phone].count += 1;\n      items[phone].total += amount;\n    }\n    const arr = Object.values(items).sort((a, b) => {\n      if (b.count !== a.count) return b.count - a.count;\n      return b.total - a.total;\n    });\n    return arr.slice(0, 10);\n  }, [transactions]);\n\n  const toWaNumber = (p: string) => {\n    const s = formatNumberEnglish(String(p));\n    if (s.startsWith('+20')) return '20' + s.slice(3);\n    if (s.startsWith('0')) return '20' + s.slice(1);\n    return s.replace(/[^0-9]/g, '');\n  };\n\n  const sendVipWhatsApp = (item: { phone: string; count: number; total: number }) => {\n    const num = toWaNumber(item.phone);\n    const msg = ` VIP  \\n : ${item.count}\\n: ${item.total} `;\n    const url = `https://wa.me/${num}?text=${encodeURIComponent(msg)}`;\n    try { window.open(url, '_blank'); } catch { }\n  };\n\n  useEffect(() => {\n    (async () => {\n      try {\n        if (!user?.uid) return;\n        const tag = `${new Date().getFullYear()}-${new Date().getMonth() + 1}`;\n        await userDataService.updateUserData(user.uid, { vipTop10, vipMonthTag: tag });\n      } catch { }\n    })();\n  }, [user?.uid, vipTop10]);\n\n  async function composeTelegramDailySummary(): Promise<string> {\n    const now = new Date();\n    const dateStr = new Intl.DateTimeFormat('ar-EG', { timeZone: 'Africa/Cairo', year: 'numeric', month: '2-digit', day: '2-digit' }).format(now);\n    const start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0, 0);\n    const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999);\n    const txToday = (transactions || []).filter((t: any) => {\n      const d = new Date(t.createdAt || 0);\n      return d >= start && d <= end;\n    });\n    const totalOps = txToday.length;\n    const totalWithdrawn = txToday\n      .filter((t: any) => String(t.type || t.txnType || '').toLowerCase() === 'withdraw' || String(t.type || '').toLowerCase() === 'receive')\n      .reduce((s: number, t: any) => s + (t.withdrawnAmount != null ? Number(t.withdrawnAmount) : Number(t.amount || 0)), 0);\n    const totalSent = txToday\n      .filter((t: any) => String(t.type || t.txnType || '').toLowerCase() === 'send' || String(t.type || '').toLowerCase() === 'transfer')\n      .reduce((s: number, t: any) => s + (t.sentAmount != null ? Number(t.sentAmount) : Number(t.amount || 0)), 0);\n    let profit = 0;\n    try { profit = txToday.reduce((sum: number, t: any) => sum + reportsService.calculateTransactionProfit(t), 0); } catch { }\n    let accessoriesSales = 0;\n    try {\n      const cairoDate = new Intl.DateTimeFormat('en-CA', { timeZone: 'Africa/Cairo' }).format(now);\n      const byUser = fsQuery(collection(db, 'dailySales'), where('userId', '==', user?.uid || ''));\n      const snap = await getDocs(byUser);\n      const list = snap.docs.map(d => d.data() as any).filter(v => String(v.date || cairoDate) === cairoDate);\n      accessoriesSales = list.reduce((s, v) => s + Number(v.sellingPrice || v.price || 0) * Number(v.quantity || 1), 0);\n    } catch { }\n    let totalDebts = 0;\n    try {\n      const ds = debts || [];\n      totalDebts = ds.filter(d => String(d.status || '') === 'pending').reduce((s, d: any) => {\n        const paid = Number(d.paidAmount || 0) + ((Array.isArray(d.partialPayments) ? d.partialPayments : []).reduce((pp: number, p: any) => pp + Number(p.amount || 0), 0));\n        return s + Math.max(0, Number(d.amount || 0) - paid);\n      }, 0);\n    } catch { }\n    let deficienciesText = '';\n    try {\n      const sid = shopIdCtx || (profile as any)?.shopId || null;\n      const q = sid ? fsQuery(collection(db, 'deficiencies'), where('shopId', '==', sid)) : fsQuery(collection(db, 'deficiencies'), where('userId', '==', user?.uid || ''));\n      const snap = await getDocs(q);\n      const items = snap.docs.map(d => d.data() as any).filter(v => String(v.status || 'pending') === 'pending');\n      const top = items.slice(0, 10);\n      deficienciesText = top.map((v: any, i: number) => `${i + 1}- ${String(v.name || v.productName || '')}  ${Number(v.quantity || v.qty || 0)}`).join('\\n');\n    } catch { }\n    const lines = [\n      `  - ${dateStr}`,\n      ` : ${totalOps}`,\n      ` : ${totalWithdrawn} `,\n      ` : ${totalSent} `,\n      `: ${profit} `,\n      `  : ${accessoriesSales} `,\n      ` : ${totalDebts} `,\n      ` :`,\n      deficienciesText || '   '\n    ];\n    return lines.join('\\n');\n  }\n\n  const getFilteredTransactions = React.useCallback(() => {\n    let filtered = effectiveTransactions;\n\n    const phoneQuery = debouncedSearchPhone.trim();\n    if (phoneQuery) {\n      filtered = filtered.filter(transaction => {\n        const t: any = transaction as any;\n        const isCashAdd = (String(t.type || '').toLowerCase() === 'cash_addition') ||\n          (String(t.txnType || '').toLowerCase() === 'cash_addition') ||\n          (String(t.title || '').includes('  '));\n        if (isCashAdd) return true;\n        return (\n          (transaction.senderPhone && transaction.senderPhone.includes(phoneQuery)) ||\n          (transaction.receiverPhone && transaction.receiverPhone.includes(phoneQuery))\n        );\n      });\n    }\n\n    //     \n    if (selectedDate) {\n      const selectedDateObj = new Date(selectedDate);\n      filtered = filtered.filter(transaction => {\n        const transactionDate = new Date(transaction.createdAt);\n\n        if (selectedTime) {\n          //         \n          const [hours, minutes] = selectedTime.split(':');\n          const filterDateTime = new Date(selectedDateObj);\n          filterDateTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);\n          const nextHour = new Date(filterDateTime);\n          nextHour.setHours(nextHour.getHours() + 1);\n\n          return transactionDate >= filterDateTime && transactionDate < nextHour;\n        } else {\n          //         \n          return transactionDate.toDateString() === selectedDateObj.toDateString();\n        }\n      });\n    }\n\n    //          \n    try {\n      filtered = [...filtered].sort((a: any, b: any) => {\n        const ad = new Date(a.createdAt || 0).getTime();\n        const bd = new Date(b.createdAt || 0).getTime();\n        return bd - ad;\n      });\n    } catch { }\n\n    return filtered;\n  }, [effectiveTransactions, debouncedSearchPhone, selectedDate, selectedTime]);\n\n  //     \n  const exportDailyReport = () => {\n    if (!selectedDate) {\n      toast({\n        title: \"  \",\n        description: \"    \",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const filteredTransactions = getFilteredTransactions();\n    const totalAmount = filteredTransactions.reduce((sum, tx) => sum + tx.amount, 0);\n    const totalWithdrawn = filteredTransactions\n      .filter(tx => tx.type === 'withdraw' || tx.type === 'withdrawal' || tx.type === 'receive' || (tx as any).txnType === 'receive')\n      .reduce((sum, tx) => sum + (((tx as any).withdrawnAmount !== undefined ? (tx as any).withdrawnAmount : tx.amount) || 0), 0);\n    const totalSent = filteredTransactions\n      .filter(tx => tx.type === 'send' || tx.type === 'transfer' || (tx as any).txnType === 'send')\n      .reduce((sum, tx) => sum + (((tx as any).sentAmount !== undefined ? (tx as any).sentAmount : tx.amount) || 0), 0);\n    const totalReceived = filteredTransactions.filter(tx => tx.type === 'receive').reduce((sum, tx) => sum + tx.amount, 0);\n\n    const reportData = {\n      date: selectedDate,\n      totalTransactions: filteredTransactions.length,\n      totalAmount,\n      totalWithdrawn,\n      totalSent,\n      totalReceived,\n      transactions: filteredTransactions\n    };\n\n    //      \n    const reportText = `\n  - ${selectedDate}\n====================\n : ${reportData.totalTransactions}\n : ${reportData.totalAmount} \n : ${reportData.totalWithdrawn} \n : ${reportData.totalSent} \n : ${reportData.totalReceived} \n\n :\n${filteredTransactions.map(tx =>\n      `${tx.createdAt.toLocaleString('ar-EG')} - ${tx.type === 'withdraw' ? '' : tx.senderPhone + '  ' + tx.receiverPhone} - ${tx.amount}  - ${tx.status}`\n    ).join('\\n')}\n    `;\n\n    //    \n    const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = `_${selectedDate}.txt`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n\n    toast({\n      title: \"  \",\n      description: `   ${selectedDate} `,\n      variant: \"default\",\n    });\n  };\n\n  const handleSendTelegramDailyReport = async () => {\n    if (isZeroPlan || isTahweelaPlan) {\n      toast({ title: ' ', description: '      .', variant: 'destructive' });\n      return;\n    }\n    if (!user?.uid) {\n      toast({ title: '  ', description: '   ', variant: 'destructive' });\n      return;\n    }\n    try {\n      const text = await composeTelegramDailySummary();\n      const key = user?.uid ? `tg_daily_report_last_${user.uid}` : 'tg_daily_report_last';\n      const now = Date.now();\n      let canSend = true;\n      try {\n        const raw = localStorage.getItem(key);\n        if (raw) {\n          const prev = JSON.parse(raw);\n          const prevAt = Number(prev?.at || 0);\n          if (now - prevAt < 30000) canSend = false;\n        }\n      } catch {}\n      if (canSend) {\n        await telegramNotifier.send(user.uid!, text);\n        try { localStorage.setItem(key, JSON.stringify({ at: now })); } catch {}\n      }\n      toast({ title: ' ', description: '     ', variant: 'default' });\n    } catch {\n      toast({ title: ' ', description: '     ', variant: 'destructive' });\n    }\n  };\n  //     \n  const [isResetWalletTotalDialogOpen, setIsResetWalletTotalDialogOpen] = useState(false);\n  const [resetWalletTotalPinInput, setResetWalletTotalPinInput] = useState('');\n\n  //     \n  const [isResetCashDialogOpen, setIsResetCashDialogOpen] = useState(false);\n  const [resetCashPinInput, setResetCashPinInput] = useState('');\n\n  //      \n  const [hasLocalDataToSync, setHasLocalDataToSync] = useState(false);\n  const [isTelegramReportPinOpen, setIsTelegramReportPinOpen] = useState(false);\n\n  const withRetry = async <T,>(fn: () => Promise<T>, retries = 2, delayMs = 700): Promise<T> => {\n    let lastErr: any;\n    for (let i = 0; i <= retries; i++) {\n      try {\n        return await fn();\n      } catch (e) {\n        lastErr = e;\n        if (i === retries) break;\n        await new Promise((r) => setTimeout(r, delayMs * Math.pow(2, i)));\n      }\n    }\n    throw lastErr;\n  };\n\n  // Calculate total wallet balance\n  const totalWalletBalance = wallets.reduce((total, wallet) => {\n    return total + (walletBalances[wallet.id] || 0);\n  }, 0);\n\n  //        -     ( )\n  const verifyWalletTotalPin = async (inputPin: string): Promise<boolean> => {\n    return await MasterPinService.verifyMasterPin(inputPin, user?.uid);\n  };\n\n  //        ( )\n  const verifyCashDrawerPin = async (inputPin: string): Promise<boolean> => {\n    //    \n    return await MasterPinService.verifyMasterPin(inputPin, user?.uid);\n  };\n\n  //       \n  const verifyLoginPassword = async (inputPassword: string): Promise<boolean> => {\n    try {\n      const currentUser = auth.currentUser;\n      if (!currentUser || !currentUser.email) return false;\n      const credential = EmailAuthProvider.credential(currentUser.email, inputPassword);\n      await reauthenticateWithCredential(currentUser, credential);\n      return true;\n    } catch (e) {\n      console.error('    :', e);\n      return false;\n    }\n  };\n\n\n\n  //      (  )   \n  useEffect(() => {\n    if (!user?.uid) return;\n    try {\n      const wbKeyNew = getWalletBalancesKey();\n      const wbKeyOld = `walletBalances_${user.uid}`;\n      const savedWalletBalances = localStorage.getItem(wbKeyNew) ?? localStorage.getItem(wbKeyOld);\n      if (savedWalletBalances) {\n        const parsed = JSON.parse(savedWalletBalances);\n        setWalletBalances(parsed && typeof parsed === 'object' ? parsed : {});\n        try { localStorage.setItem(wbKeyNew, JSON.stringify(parsed || {})); } catch { }\n      }\n    } catch { }\n    try {\n      const cbKeyNew = getCashBalanceKey();\n      const cbKeyOld = `cashBalance_${user.uid}`;\n      const legacyKey = `userCashBalance_${user.uid}`;\n      let savedCashBalance = localStorage.getItem(cbKeyNew) ?? localStorage.getItem(cbKeyOld) ?? localStorage.getItem(legacyKey);\n      if (savedCashBalance != null) {\n        const v = parseFloat(savedCashBalance);\n        setCashBalance(Number.isFinite(v) ? v : 0);\n        try {\n          localStorage.setItem(cbKeyNew, String(Number.isFinite(v) ? v : 0));\n          localStorage.removeItem(cbKeyOld);\n          localStorage.removeItem(legacyKey);\n        } catch { }\n      }\n    } catch { }\n  }, [user?.uid, shopIdCtx, profile?.shopId]);\n\n  //            \n  useEffect(() => {\n    const handler = (e: any) => {\n      try {\n        const v = Number(e?.detail?.value);\n        if (Number.isFinite(v)) {\n          setCashBalance(v);\n        } else {\n          const saved = localStorage.getItem(getCashBalanceKey());\n          if (saved != null) setCashBalance(parseFloat(saved) || 0);\n        }\n      } catch {\n        const saved = localStorage.getItem(getCashBalanceKey());\n        if (saved != null) setCashBalance(parseFloat(saved) || 0);\n      }\n    };\n    window.addEventListener('cashBalanceChanged', handler as EventListener);\n    return () => window.removeEventListener('cashBalanceChanged', handler as EventListener);\n  }, [user?.uid, shopIdCtx, profile?.shopId]);\n\n  //     React Query   \n  const { data: dashboardData } = useQuery({\n    queryKey: ['dashboardData', shopIdCtx || profile?.shopId],\n    queryFn: async () => {\n      const sid = (shopIdCtx || profile?.shopId);\n      if (!sid) return null;\n      const ref = doc(db, 'dashboardData', sid);\n      const snap = await getDoc(ref);\n      return snap.exists() ? snap.data() : null;\n    },\n    enabled: !!(user?.uid && (shopIdCtx || profile?.shopId)),\n    staleTime: 1000 * 60 * 5, // 5 \n    refetchInterval: 1000 * 60 * 5, //   5 \n  });\n\n  useEffect(() => {\n    if (dashboardData) {\n      const d: any = dashboardData;\n      const cb = Number(d?.cashBalance || 0);\n      const wbs = (d?.walletBalances && typeof d.walletBalances === 'object') ? d.walletBalances : {};\n      try {\n        const serverTime = d?.lastUpdated ? new Date(d.lastUpdated).getTime() : 0;\n        const localCashTime = localStorage.getItem(getCashBalanceKey() + '_lastUpdated');\n        const localTime = localCashTime ? new Date(localCashTime).getTime() : 0;\n\n        if (serverTime >= localTime) {\n          setCashBalance(cb);\n          setWalletBalances(wbs);\n          localStorage.setItem(getCashBalanceKey(), String(cb));\n          localStorage.setItem(getWalletBalancesKey(), JSON.stringify(wbs));\n          if (d?.lastUpdated) {\n            localStorage.setItem(getCashBalanceKey() + '_lastUpdated', d.lastUpdated);\n            localStorage.setItem(getWalletBalancesKey() + '_lastUpdated', d.lastUpdated);\n          }\n        }\n      } catch { }\n    }\n  }, [dashboardData]);\n\n  const getWalletLimitsCacheKey = (wid?: string) => `walletLimits_${user?.uid || 'default'}_${wid || 'none'}`;\n  \n  //       React Query\n  const { data: walletLimitsData } = useQuery({\n    queryKey: ['walletLimits', selectedWallet],\n    queryFn: async () => {\n      if (!selectedWallet) return null;\n      const ref = doc(db, 'walletLimits', String(selectedWallet));\n      const snap = await getDoc(ref);\n      return snap.exists() ? snap.data() : null;\n    },\n    enabled: !!selectedWallet,\n    staleTime: 1000 * 60 * 5,\n  });\n\n  useEffect(() => {\n    if (!selectedWallet) return;\n    try {\n      // Load from cache first\n      const k = getWalletLimitsCacheKey(selectedWallet);\n      const s = localStorage.getItem(k);\n      if (s && !walletLimitsData) {\n        const parsed = JSON.parse(s);\n        setSelectedWalletLimits(parsed);\n      }\n      \n      if (walletLimitsData) {\n        const d: any = walletLimitsData;\n        const limitsObj = {\n          walletId: selectedWallet,\n          dailyTransferLimit: d.dailyTransferLimit ?? 60000,\n          dailyWithdrawLimit: d.dailyWithdrawLimit ?? 100000,\n          dailyTransferUsed: d.dailyTransferUsed ?? 0,\n          dailyWithdrawUsed: d.dailyWithdrawUsed ?? 0,\n          monthlyTransferLimit: d.monthlyTransferLimit ?? 200000,\n          monthlyWithdrawLimit: d.monthlyWithdrawLimit ?? 200000,\n          monthlyTransferUsed: d.monthlyTransferUsed ?? 0,\n          monthlyWithdrawUsed: d.monthlyWithdrawUsed ?? 0\n        };\n        setSelectedWalletLimits(limitsObj);\n        try { localStorage.setItem(getWalletLimitsCacheKey(selectedWallet), JSON.stringify(limitsObj)); } catch { }\n      }\n    } catch { }\n  }, [selectedWallet, walletLimitsData]);\n\n  useEffect(() => {\n    if (!selectedWallet) return;\n    const w = wallets.find((x: any) => x.id === selectedWallet);\n    if (w?.name) {\n      setSelectedWalletName(String(w.name));\n      try { localStorage.setItem(`walletName_${user?.uid || 'default'}_${selectedWallet}`, String(w.name)); } catch { }\n      return;\n    }\n    try {\n      const s = localStorage.getItem(`walletName_${user?.uid || 'default'}_${selectedWallet}`);\n      if (s) setSelectedWalletName(String(s));\n    } catch { }\n  }, [selectedWallet, wallets]);\n\n\n\n  //      \n  const refreshSelectedWalletLimits = async () => {\n    try {\n      if (!selectedWallet) return;\n      const limits = await walletDailyLimitsService.autoResetLimitsIfNeeded(selectedWallet);\n      setSelectedWalletLimits(limits);\n    } catch (error) {\n      console.error('     :', error);\n    }\n  };\n\n  //       /   \n  useEffect(() => {\n    refreshSelectedWalletLimits();\n  }, [selectedWallet]);\n\n  //          \n  useEffect(() => {\n    const handler = (e: any) => {\n      if (!e?.detail?.walletId) return;\n      if (e.detail.walletId === selectedWallet) {\n        refreshSelectedWalletLimits();\n      }\n    };\n    window.addEventListener('walletLimitsUpdated', handler as EventListener);\n    return () => window.removeEventListener('walletLimitsUpdated', handler as EventListener);\n  }, [selectedWallet]);\n\n  useEffect(() => {\n    const handler = (e: any) => {\n      try {\n        const wid = String(e?.detail?.walletId || '');\n        if (wid) {\n          setWalletSelection(wid, 'sms:auto');\n        }\n      } catch {}\n    };\n    window.addEventListener('walletSelection:update', handler as EventListener);\n    return () => window.removeEventListener('walletSelection:update', handler as EventListener);\n  }, [wallets]);\n\n  // Handle navigation state for opening specific dialogs\n  useEffect(() => {\n    if (location.state) {\n      console.log('Location state:', location.state); //   \n\n      if (location.state.openDebtDialog) {\n        openDebts();\n        window.history.replaceState({}, document.title);\n      }\n      if (location.state.openSalesDialog) {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n        } else {\n          setIsSalesDataOpen(true);\n        }\n        // Clear the state to prevent reopening on subsequent navigations\n        window.history.replaceState({}, document.title);\n      }\n      //       ()\n      if (location.state.openMaintenanceDialog) {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '     .  .', variant: 'destructive' });\n        } else {\n          setIsMaintenanceOpen(true);\n        }\n        //     \n        window.history.replaceState({}, document.title);\n      }\n      if (location.state.openCreditCardsDialog) {\n        console.log('Opening credit cards dialog'); //   \n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n        } else {\n          setIsCreditCardsOpen(true);\n        }\n        // Clear the state to prevent reopening on subsequent navigations\n        window.history.replaceState({}, document.title);\n      }\n      //        ()\n      if (location.state.openShopExpensesDialog) {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n        } else {\n          if (MasterPinService.hasMasterPin()) {\n            setIsShopExpensesPinDialogOpen(true);\n          } else {\n            setIsShopExpensesDialogOpen(true);\n          }\n        }\n        //     \n        window.history.replaceState({}, document.title);\n      }\n      //       ()\n      if (location.state.openDeficienciesDialog) {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '     .  .', variant: 'destructive' });\n        } else {\n          setIsDeficienciesDialogOpen(true);\n        }\n        window.history.replaceState({}, document.title);\n      }\n      if ((location.state as any).openInstallment) {\n        if (isZeroPlan || isTahweelaPlan) {\n          toast({ title: ' ', description: '      .', variant: 'destructive' });\n        } else {\n          setIsInstallmentPinOpen(true);\n        }\n        window.history.replaceState({}, document.title);\n      }\n      if (location.state.openTransactionSection) {\n        // Scroll to transaction section or set active tab\n        const transactionSection = document.getElementById('transaction-section');\n        if (transactionSection) {\n          transactionSection.scrollIntoView({ behavior: 'smooth' });\n        }\n\n        // Set transaction type if specified\n        if (location.state.transactionType) {\n          setTransactionType(location.state.transactionType);\n        }\n\n        // Start new transaction if specified\n        if (location.state.startNewTransaction) {\n          // Clear all form fields to start fresh\n          setReceiverPhone('');\n          setAmount('');\n          setManualCommission('');\n          setTransferCommission('');\n\n          //  REMOVED: Auto-select default wallet for withdraw transactions\n          // This was causing the wallet to reset when switching to withdraw\n          // The user's wallet selection should persist across all transaction types\n          console.log(' Starting new transaction without changing wallet selection');\n        }\n\n        // Focus on wallet selection if specified (legacy support)\n        if (location.state.focusWalletSelection) {\n          setTimeout(() => {\n            const walletSelect = document.querySelector('[data-testid=\"wallet-select\"]');\n            if (walletSelect) {\n              walletSelect.focus();\n            }\n          }, 500);\n        }\n\n        // Clear the state after handling transaction section\n        window.history.replaceState({}, document.title);\n      }\n      //        ()\n      if (location.state.openCashierShiftModal) {\n        if (!isShiftHandoverAllowed || isTahweelaPlan) {\n          toast({ title: ' ', description: '   :      .', variant: 'destructive' });\n        } else {\n          setIsCashierModalOpen(true);\n        }\n        //     \n        window.history.replaceState({}, document.title);\n      }\n      //       \n      if (location.state.openMachineDailyDialog) {\n        if (!isShiftHandoverAllowed || isTahweelaPlan) {\n          toast({ title: ' ', description: '   :      .', variant: 'destructive' });\n        } else {\n          setIsMachineDailyDialogOpen(true);\n        }\n        //     \n        window.history.replaceState({}, document.title);\n      }\n      \n      //        ()\n      if (location.state.openBranchManagement) {\n        if (branchPackage?.status === 'active') {\n          setBranchDialogOpen(true);\n        } else {\n          setBranchRequestOpen(true);\n        }\n        window.history.replaceState({}, document.title);\n      }\n    }\n  }, [location.state, wallets, isTahweelaPlan, branchPackage]);\n\n  //     localStorage:      Firebase\n  //  useEffect       \n  useEffect(() => {\n    //       \n    if (location.pathname === '/user/dashboard') {\n      const previousPath = sessionStorage.getItem('previousPath');\n      if (previousPath === '/user/add-wallet') {\n        console.log(' Returned from wallet addition page - reloading wallets');\n        loadWalletsFromFirebase();\n        sessionStorage.removeItem('previousPath'); //   \n      }\n    }\n\n    //   \n    sessionStorage.setItem('previousPath', location.pathname);\n  }, [location.pathname, user?.uid]);\n\n\n\n  // Load data from Firebase on component mount\n  //          +   \n  useEffect(() => {\n    if (!user?.uid) return;\n    \n    //     \n    const checkUserStatus = async () => {\n        try {\n            const userDocRef = doc(db, 'users', user.uid);\n            const docSnapshot = await getDoc(userDocRef);\n            if (docSnapshot.exists()) {\n                const userData = docSnapshot.data();\n                const isActive = userData.isActive === true;\n                \n                if (isActive && !isUserActive) {\n                    setIsUserActive(true);\n                    setShowActivationModal(false);\n                    setIsCheckingActivation(false);\n                } else if (!isActive && isUserActive) {\n                    setIsUserActive(false);\n                    setShowActivationModal(true);\n                }\n            }\n        } catch (e) {\n            console.error('Check user status error', e);\n        }\n    };\n    \n    checkUserStatus();\n  }, [user?.uid]);\n\n  //    \n  useEffect(() => {\n    if (!user?.uid) return;\n\n    const handleSubscriptionActivated = (event: CustomEvent) => {\n      const { userId } = event.detail;\n      if (userId === user.uid) {\n        console.log(' Subscription activation event received for current user!');\n        setIsUserActive(true);\n        setShowActivationModal(false);\n        setIsCheckingActivation(false);\n\n        //       \n        setTimeout(() => {\n          //        \n          console.log(' User activation completed - data updated');\n        }, 1000);\n      }\n    };\n\n    const handleUserSubscriptionUpdated = (event: CustomEvent) => {\n      const { userId, isActive } = event.detail;\n      if (userId === user.uid) {\n        console.log(' User subscription update event received:', { userId, isActive });\n        if (isActive && !isUserActive) {\n          setIsUserActive(true);\n          setShowActivationModal(false);\n          setIsCheckingActivation(false);\n\n          //       \n          setTimeout(() => {\n            //        \n            console.log(' User subscription updated - data refreshed');\n          }, 1000);\n        }\n      }\n    };\n\n    window.addEventListener('subscriptionActivated', handleSubscriptionActivated as EventListener);\n    window.addEventListener('userSubscriptionUpdated', handleUserSubscriptionUpdated as EventListener);\n\n    return () => {\n      window.removeEventListener('subscriptionActivated', handleSubscriptionActivated as EventListener);\n      window.removeEventListener('userSubscriptionUpdated', handleUserSubscriptionUpdated as EventListener);\n    };\n  }, [user?.uid, isUserActive]);\n\n  //      (1-9)\n  useEffect(() => {\n    const handleGlobalShortcuts = (e: KeyboardEvent) => {\n      const target = e.target as HTMLElement | null;\n      const tag = target?.tagName?.toLowerCase();\n      const isTyping = tag === 'input' || tag === 'textarea' || tag === 'select' || (target?.isContentEditable ?? false);\n      if (isTyping) return;\n      if (e.ctrlKey || e.altKey || e.metaKey) return;\n      if (e.repeat) return;\n\n      if ((isZeroPlan || isTahweelaPlan) && e.key >= '1' && e.key <= '9') {\n        e.preventDefault();\n        return;\n      }\n\n      switch (e.key) {\n        case '1':\n          break;\n        case '2':\n          setIsCalculatorOpen(true);\n          break;\n        case '3':\n          if (isZeroPlan || isTahweelaPlan) {\n            toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n          } else {\n            setIsCreditCardsOpen(true);\n          }\n          break;\n        case '4':\n          if (!isShiftHandoverAllowed) {\n            toast({ title: ' ', description: '   :      .', variant: 'destructive' });\n          } else {\n            setIsCashierModalOpen(true);\n          }\n          break;\n        case '5':\n          if (isZeroPlan || isTahweelaPlan) {\n            toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n          } else {\n            setIsSalesDataOpen(true);\n          }\n          break;\n        case '6':\n          openDebts();\n          break;\n        case '7':\n          if (isZeroPlan || isTahweelaPlan) {\n            toast({ title: ' ', description: '     .  .', variant: 'destructive' });\n          } else {\n            setIsMaintenanceOpen(true);\n          }\n          break;\n        case '8':\n          if (!isShiftHandoverAllowed) {\n            toast({ title: ' ', description: '   :      .', variant: 'destructive' });\n          } else {\n            setIsMachineDailyDialogOpen(true);\n          }\n          break;\n        case '9':\n          if (isZeroPlan || isTahweelaPlan) {\n            toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n          } else {\n            if (MasterPinService.hasMasterPin()) {\n              setIsShopExpensesPinDialogOpen(true);\n            } else {\n              setIsShopExpensesDialogOpen(true);\n            }\n          }\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleGlobalShortcuts);\n    return () => window.removeEventListener('keydown', handleGlobalShortcuts);\n  }, [isZeroPlan, isTahweelaPlan, isShiftHandoverAllowed]);\n\n  useEffect(() => {\n    console.log(' useEffect loadUserData started', { user: user?.uid, isCheckingActivation });\n\n    const loadUserData = async () => {\n      try {\n        //     \n        if (!user?.uid) {\n          console.log(' No user UID, setting isCheckingActivation to false');\n          setIsCheckingActivation(false);\n          return;\n        }\n\n        //      localStorage:    Firebase \n\n        try {\n          const userDoc = await getDoc(doc(db, 'users', user.uid));\n          if (userDoc.exists()) {\n            const userData = userDoc.data();\n            const isActive = userData.isActive === true;\n\n            //    \n            const trialValidity = await FreeTrialService.checkTrialValidity(user.uid);\n            const isOnTrial = trialValidity.isValid && !trialValidity.isExpired;\n\n            setIsUserActive(isActive || isOnTrial);\n            setIsOnFreeTrial(isOnTrial);\n            setFreeTrialHoursRemaining(trialValidity.hoursRemaining);\n            setHasUsedFreeTrial(trialValidity.hasUsedTrial);\n            setShowActivationModal(!isActive && !isOnTrial);\n\n            console.log('  :', {\n              isActive,\n              isOnTrial,\n              hoursRemaining: trialValidity.hoursRemaining,\n              hasUsedTrial: trialValidity.hasUsedTrial\n            });\n          } else {\n            //           \n            setIsUserActive(false);\n            setShowActivationModal(true);\n          }\n        } catch (error) {\n          console.error('     :', error);\n          setIsUserActive(false);\n          setShowActivationModal(true);\n        } finally {\n          setIsCheckingActivation(false);\n        }\n\n        //     Firebase     \n        console.log('      Firebase...', { userId: user?.uid });\n\n        //      \n        //     :    Firebase \n\n        //   Firebase            \n        if (user?.uid) {\n          const userData = await withRetry(() => userDataService.getUserData(user.uid));\n\n          const localDataKey = `userData_${user?.uid}`;\n          let localData: any = null;\n          try {\n            const raw = localStorage.getItem(localDataKey);\n            if (raw) localData = JSON.parse(raw);\n          } catch {}\n\n          if (userData) {\n            let remoteBalances: Record<string, number> = userData?.walletBalances || {};\n            let remoteCash = userData?.cashBalance;\n            const remoteTs = userData.lastUpdated ? new Date(userData.lastUpdated).getTime() : 0;\n\n            if (localData) {\n               const localTs = localData.lastUpdated ? new Date(localData.lastUpdated).getTime() : 0;\n               if (localTs >= remoteTs) {\n                  if (localData.walletBalances) remoteBalances = localData.walletBalances;\n                  if (localData.cashBalance !== undefined) remoteCash = localData.cashBalance;\n               }\n            }\n\n            // Fallback: Check individual transaction keys if they are newer than remote\n            // This handles cases where userData_${uid} wasn't updated but individual keys were\n            try {\n              const cashKey = getCashBalanceKey();\n              const walletKey = getWalletBalancesKey();\n              const localCashTsStr = localStorage.getItem(cashKey + '_lastUpdated');\n              const localWalletsTsStr = localStorage.getItem(walletKey + '_lastUpdated');\n              \n              const localCashTs = localCashTsStr ? new Date(localCashTsStr).getTime() : 0;\n              const localWalletsTs = localWalletsTsStr ? new Date(localWalletsTsStr).getTime() : 0;\n\n              if (localCashTs > remoteTs) {\n                  const val = localStorage.getItem(cashKey);\n                  if (val !== null) remoteCash = parseFloat(val);\n              }\n              \n              if (localWalletsTs > remoteTs) {\n                  const val = localStorage.getItem(walletKey);\n                  if (val !== null) {\n                      try { remoteBalances = JSON.parse(val); } catch {}\n                  }\n              }\n            } catch (e) {\n              console.error('Error checking individual keys fallback:', e);\n            }\n\n            setWalletBalances(remoteBalances);\n\n            if (remoteCash !== undefined) {\n              setCashBalance(remoteCash);\n            }\n\n            try {\n              const firebaseDeletedTransactions = user?.uid\n                ? await withRetry(() => auditLogService.getDeletedTransactionsByUser(user.uid))\n                : [];\n              setDeletedTransactions(firebaseDeletedTransactions || []);\n            } catch (error) {\n              setDeletedTransactions([]);\n            }\n          } else {\n            setWalletBalances({});\n            try {\n              const firebaseDeletedTransactions = user?.uid\n                ? await auditLogService.getDeletedTransactionsByUser(user.uid)\n                : [];\n              setDeletedTransactions(firebaseDeletedTransactions || []);\n            } catch {\n              setDeletedTransactions([]);\n            }\n          }\n        }\n\n        //    Firebase  merchantWalletService ( )\n        console.log('     Firebase...');\n        try {\n          const firebaseWallets = await withRetry(() => merchantWalletService.getByMerchantId(user?.uid || ''));\n          if (firebaseWallets && firebaseWallets.length > 0) {\n            console.log('      Firebase:', firebaseWallets.length);\n\n            //    Firebase   \n            const activeOnly = firebaseWallets.filter(w => (w as any).isActive === true);\n            const formattedWallets = activeOnly.map(w => ({\n              id: w.id,\n              name: w.label || '  ',\n              phone: w.msisdn,\n              isDefault: false, //     \n              monthlyWithdrawalLimit: (w.monthlyWithdrawalLimit ?? w.withdrawLimit ?? 200000),\n              monthlyTransferLimit: (w.monthlyTransferLimit ?? w.transferLimit ?? 200000),\n              //      \n              defaultTransferCommission: (w.defaultTransferCommission != null ? Number(w.defaultTransferCommission) : null),\n              defaultWithdrawCommission: (w.defaultWithdrawCommission != null ? Number(w.defaultWithdrawCommission) : null)\n            }));\n\n            setWallets(formattedWallets);\n\n            // Set default wallet as selected if available\n            //       localStorage\n            const savedSelectedWallet = localStorage.getItem(getSelectedWalletKey());\n            let walletToSelect = null;\n\n            if (savedSelectedWallet && formattedWallets.find(w => w.id === savedSelectedWallet)) {\n              //      \n              walletToSelect = formattedWallets.find(w => w.id === savedSelectedWallet);\n            } else {\n              //     \n              walletToSelect = formattedWallets[0];\n            }\n\n            if (walletToSelect) {\n              setSelectedWallet(walletToSelect.id);\n              setSenderPhone(walletToSelect.phone);\n            }\n\n            console.log('     Firebase   localStorage');\n          } else {\n            console.log('     Firebase.        .');\n            setWallets([]);\n          }\n        } catch (error) {\n          console.error('     Firebase:', error);\n          //   :      localStorage\n          setWallets([]);\n        }\n\n        //    Firebase     \n        const userTransactions = user?.uid\n          ? await withRetry(() => userDataService.getUserTransactions(user.uid))\n          : [];\n        if (userTransactions && userTransactions.length > 0) {\n          console.log('     Firebase:', userTransactions.length);\n\n          //      Firebase format  Local format\n          const transactionsWithDates = userTransactions.map((tx: any) => ({\n            ...tx,\n            createdAt: new Date(tx.createdAt),\n            //    Firebase format  Local format\n            senderPhone: tx.senderMsisdn || tx.senderPhone || '',\n            receiverPhone: tx.receiverMsisdn || tx.receiverPhone || '',\n            type: tx.txnType === 'send' ? 'send' :\n              tx.txnType === 'receive' ? 'withdraw' :\n                tx.type || 'withdraw',\n            status: tx.status === 'confirmed' ? 'completed' : tx.status || 'completed'\n          }));\n\n          //     \n          const deletedTransactionIds = deletedTransactions.map(dt => dt.id || dt.originalTransactionId);\n\n          //          \n          let permanentDeletedKeys: string[] = [];\n          try {\n            const permQ = fsQuery(\n              collection(db, 'deletedTransactions'),\n              where('userId', '==', user?.uid || ''),\n              where('permanent', '==', true)\n            );\n            const permSnap = await getDocs(permQ);\n            permanentDeletedKeys = permSnap.docs.map(d => {\n              const data: any = d.data();\n              const tombId = String(data.originalTransactionId || data.transactionId || d.id || '');\n              return tombId;\n            }).filter(Boolean);\n          } catch { }\n\n          const permSet = new Set(permanentDeletedKeys);\n          const activeTransactions = transactionsWithDates.filter(tx => {\n            const txId = String(tx.id || '');\n            const txTxnId = String((tx as any).transactionId || '');\n            const txRef = String((tx as any).reference || (tx as any).transactionReference || (tx as any).receipt?.reference || '');\n            const inDeleted = deletedTransactionIds.includes(txId);\n            const blockedByPerm = permSet.has(txId) || (txTxnId && permSet.has(txTxnId));\n            return !inDeleted && !blockedByPerm;\n          });\n\n          console.log('    :', {\n            total: userTransactions.length,\n            deleted: deletedTransactionIds.length,\n            active: activeTransactions.length\n          });\n          //           \n          //             id\n          {\n            const seen = new Set<string>();\n            const distinct: any[] = [];\n            for (const t of activeTransactions) {\n              const key = getTransactionKey(t);\n              if (!seen.has(key)) {\n                seen.add(key);\n                distinct.push(t);\n              }\n            }\n            if (!isRealtimeActive) setTransactions(distinct);\n\n          }\n        }\n\n        //     Firebase   \n        await syncLocalDataWithFirebase();\n\n      } catch (error) {\n        console.error('      Firebase:', error);\n        //   :       localStorage     \n      }\n    };\n\n    loadUserData().then(async () => {\n      await autoMonthlyDbCleanup();\n      await autoResetLimits();\n      await autoResetReports();\n    });\n\n    //          \n    const autoResetLimits = async () => {\n      try {\n        if (!user?.uid) return;\n        //          \n        const wallets = await merchantWalletService.getByMerchantId(user.uid);\n        await Promise.all(\n          wallets.map((w: any) => walletLimitsService.autoResetLimitsIfNeeded(w.id))\n        );\n      } catch (error) {\n        console.error('    :', error);\n      }\n    };\n\n    //      \n    const autoResetReports = async () => {\n      try {\n        //     Firebase      \n        await reportsService.syncReportsDataFromFirebase(user?.uid);\n        const data = reportsService.getReportsData(user?.uid);\n        const shouldArchiveDaily = data.lastDailyResetDate ? reportsService.shouldResetDailyReports(data.lastDailyResetDate) : false;\n        if (shouldArchiveDaily && user?.uid && data.lastDailyResetDate) {\n          const dayDate = new Date(data.lastDailyResetDate);\n          const baseDateStr = dayDate.toDateString();\n          //                \n          const dayTransactions = transactions.filter(tx =>\n            new Date(tx.createdAt).toDateString() === baseDateStr && tx.status === 'completed'\n          );\n          const totalTransactions = dayTransactions.length;\n          const totalAmount = dayTransactions.reduce((sum, tx) => sum + tx.amount, 0);\n          const totalWithdrawn = dayTransactions\n            .filter(isWithdrawTx)\n            .reduce((sum, tx) => {\n              const amount = (tx as any).withdrawnAmount !== undefined ? (tx as any).withdrawnAmount : tx.amount;\n              return sum + amount;\n            }, 0);\n          const totalSent = dayTransactions\n            .filter(isSendTx)\n            .reduce((sum, tx) => {\n              const amount = (tx as any).sentAmount !== undefined ? (tx as any).sentAmount : tx.amount;\n              return sum + amount;\n            }, 0);\n          const profit = dayTransactions.reduce((sum, tx) => sum + reportsService.calculateTransactionProfit(tx), 0);\n\n          const reportDateStr = new Date(dayDate).toISOString().slice(0, 10);\n          await dailyReportsArchiveService.add({\n            userId: user.uid,\n            reportDate: reportDateStr,\n            totalTransactions,\n            totalAmount: Number(totalAmount.toFixed(2)),\n            totalWithdrawn: Number(totalWithdrawn.toFixed(2)),\n            totalSent: Number(totalSent.toFixed(2)),\n            profit: Number(profit.toFixed(2)),\n            walletId: null\n          });\n        }\n\n        const resetResult = reportsService.autoResetReportsIfNeeded(user?.uid);\n        if (resetResult.dailyReset || resetResult.monthlyReset) {\n          console.log('  :', resetResult);\n          //             \n        }\n      } catch (error) {\n        console.error('    :', error);\n      }\n    };\n\n    //      1    (     Firebase )\n    const autoMonthlyDbCleanup = async () => {\n      try {\n        if (!user?.uid) return;\n        const today = new Date();\n        if (today.getDate() !== 1) return; //    1\n        const tag = `${today.getFullYear()}-${today.getMonth() + 1}`;\n        const key = `lastMonthlyDbCleanup:${user.uid}`;\n        const last = localStorage.getItem(key);\n        if (last === tag) return; //     \n\n        const monthStart = new Date(today.getFullYear(), today.getMonth(), 1, 0, 0, 0, 0);\n        const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : new Date(String(v));\n\n        // userTransactions\n        let utDocs: any[] = [];\n        try {\n          const q1 = fsQuery(\n            collection(db, 'userTransactions'),\n            where('userId', '==', user.uid),\n            where('createdAt', '<', monthStart)\n          );\n          const snap1 = await getDocs(q1);\n          utDocs = snap1.docs;\n        } catch {\n          const q1fb = fsQuery(\n            collection(db, 'userTransactions'),\n            where('userId', '==', user.uid)\n          );\n          const snap1fb = await getDocs(q1fb);\n          utDocs = snap1fb.docs.filter(d => toJsDate(d.data()?.createdAt) < monthStart);\n        }\n        await Promise.allSettled(utDocs.map(d => deleteDoc(d.ref)));\n\n        // transactions ( )\n        let gDocs: any[] = [];\n        try {\n          const q2 = fsQuery(\n            collection(db, 'transactions'),\n            where('userId', '==', user.uid),\n            where('createdAt', '<', monthStart)\n          );\n          const snap2 = await getDocs(q2);\n          gDocs = snap2.docs;\n        } catch {\n          const q2fb = fsQuery(\n            collection(db, 'transactions'),\n            where('userId', '==', user.uid)\n          );\n          const snap2fb = await getDocs(q2fb);\n          gDocs = snap2fb.docs.filter(d => toJsDate(d.data()?.createdAt) < monthStart);\n        }\n        await Promise.allSettled(gDocs.map(d => deleteDoc(d.ref)));\n\n        try { localStorage.setItem(key, tag); } catch { }\n        console.log('      (Firebase ):', {\n          userTransactionsDeleted: utDocs.length,\n          globalTransactionsDeleted: gDocs.length,\n          monthStart\n        });\n      } catch (e) {\n        console.error('     :', e);\n      }\n    };\n\n    //   \n    fetchSubscriptionData();\n\n    //  \n    loadDebtsFromStorage();\n    //  \n    loadCustomersFromStorage();\n\n    console.log(' useEffect loadUserData completed');\n  }, [user?.uid]);\n\n  //      Firebase\n  const loadWalletsFromFirebase = async () => {\n    if (!user?.uid) return;\n\n    try {\n      const firebaseWallets = await withRetry(() => merchantWalletService.getByMerchantId(user.uid));\n      if (firebaseWallets && firebaseWallets.length > 0) {\n        //    Firebase   \n        const activeOnly = firebaseWallets.filter(w => (w as any).isActive === true);\n        const formattedWallets = activeOnly.map(w => ({\n          id: w.id,\n          name: w.label || '  ',\n          phone: w.msisdn,\n          isDefault: false, //     \n          monthlyWithdrawalLimit: (w.monthlyWithdrawalLimit ?? w.withdrawLimit ?? 200000),\n          monthlyTransferLimit: (w.monthlyTransferLimit ?? w.transferLimit ?? 200000),\n          //         null  undefined\n          defaultTransferCommission: (w.defaultTransferCommission != null ? Number(w.defaultTransferCommission) : undefined),\n          defaultWithdrawCommission: (w.defaultWithdrawCommission != null ? Number(w.defaultWithdrawCommission) : undefined)\n        }));\n\n        setWallets(formattedWallets);\n\n        //         \n\n        //             \n        if (user?.uid) {\n          const savedWallet = localStorage.getItem(getSelectedWalletKey());\n          const isCurrentValid = !!(selectedWallet && formattedWallets.find(w => w.id === selectedWallet));\n          if (!isCurrentValid) {\n            const validSaved = savedWallet && formattedWallets.find(w => w.id === savedWallet) ? savedWallet : null;\n            const newWalletId = validSaved || formattedWallets[0]?.id;\n            if (newWalletId) {\n              console.log(' Fixing invalid wallet selection:', newWalletId);\n              setWalletSelection(newWalletId);\n            }\n          } else {\n            console.log(' Preserving current wallet selection:', selectedWallet);\n          }\n        }\n\n        console.log('     Firebase:', formattedWallets.length);\n      }\n    } catch (error) {\n      console.error('     Firebase:', error);\n    }\n  };\n\n  // useEffect         \n  useEffect(() => {\n    const currentPath = location.pathname;\n    const previousPath = sessionStorage.getItem('previousPath');\n\n    //           \n    if (previousPath === '/user/add-wallet' && currentPath === '/user/dashboard') {\n      queryClientHook.invalidateQueries({ queryKey: ['wallets', user?.uid] });\n      try { walletsQuery.refetch(); } catch {}\n      sessionStorage.removeItem('previousPath');\n    }\n\n    //   \n    sessionStorage.setItem('previousPath', currentPath);\n  }, [location.pathname, user?.uid]);\n\n  // useEffect      \n  useEffect(() => {\n    const handleWindowFocus = () => {\n      const currentSelectedWallet = selectedWallet;\n      queryClientHook.invalidateQueries({ queryKey: ['wallets', user?.uid] });\n      try { walletsQuery.refetch(); } catch {}\n    };\n\n    //     \n    window.addEventListener('focus', handleWindowFocus);\n\n    //      \n    return () => {\n      window.removeEventListener('focus', handleWindowFocus);\n    };\n  }, [user?.uid, selectedWallet, wallets]);\n\n  // Centralized wallet selection management\n  const setWalletSelection = async (walletId: string, source: string = 'unknown') => {\n    console.log(` setWalletSelection called from ${source} with walletId:`, walletId);\n    console.log(' Previous selectedWallet:', selectedWallet);\n\n    setSelectedWallet(walletId);\n    const wallet = wallets.find(w => w.id === walletId);\n    if (wallet) {\n      setSenderPhone(wallet.phone);\n      console.log(' Wallet set successfully:', walletId, 'Phone:', wallet.phone);\n    }\n\n    //     localStorage\n    if (user?.uid) {\n      localStorage.setItem(getSelectedWalletKey(), walletId);\n      console.log(' Saved wallet to localStorage:', walletId);\n\n      // Save to Capacitor Preferences for native access (SmsReceiver)\n      try {\n        await Preferences.set({\n          key: 'selected_wallet_id',\n          value: walletId\n        });\n        await Preferences.set({\n          key: 'current_user_id',\n          value: user.uid\n        });\n        console.log(' Saved wallet and user ID to Capacitor Preferences:', walletId, user.uid);\n      } catch (err) {\n        console.error(' Failed to save to Capacitor Preferences:', err);\n      }\n    }\n  };\n\n  useEffect(() => {\n    const handler = () => {\n      loadWalletsFromFirebase();\n    };\n    try {\n      window.addEventListener('wallets:activation-updated' as any, handler as unknown as EventListener);\n    } catch { }\n    return () => {\n      try {\n        window.removeEventListener('wallets:activation-updated' as any, handler as unknown as EventListener);\n      } catch { }\n    };\n  }, [user?.uid]);\n\n  // Update sender phone when wallet selection changes\n  const handleWalletChange = (walletId: string) => {\n    //      \n    if (walletId === '__add_wallet') {\n      navigate('/user/add-wallet');\n      return;\n    }\n    if (walletId === '__view_wallets') {\n      setIsWalletsPinDialogOpen(true);\n      return;\n    }\n\n    // Gate changing selected wallet behind master PIN verification (configurable)\n    const requirePin = walletSelectionPinService.isEnabled(user?.uid);\n    if (requirePin) {\n      setPendingSelectedWalletId(walletId);\n      setIsWalletSelectionPinDialogOpen(true);\n    } else {\n      setWalletSelection(walletId, 'walletSelectionNoPin');\n    }\n  };\n\n  // Handle transaction type changes\n  const handleTransactionTypeChange = (type: 'transfer' | 'withdraw') => {\n    console.log(' handleTransactionTypeChange called with type:', type);\n    console.log(' Current selectedWallet before change:', selectedWallet);\n    console.log(' Available wallets count:', wallets.length);\n\n    setTransactionType(type);\n    // Clear receiver phone when switching transaction types\n    setReceiverPhone('');\n    // Clear amount when switching transaction types\n    setAmount('');\n    // Clear commission fields when switching transaction types\n    setManualCommission('');\n    setTransferCommission('');\n\n    // NEVER change the selected wallet when switching transaction types\n    // The user's wallet selection should persist across all transaction types\n    console.log(' Transaction type changed to:', type, '- Wallet selection preserved:', selectedWallet);\n\n    // Scroll to transaction section to show confirm button after a short delay\n    setTimeout(() => {\n      const transactionSection = document.getElementById('transaction-section');\n      if (transactionSection) {\n        transactionSection.scrollIntoView({\n          behavior: 'smooth',\n          block: 'start',\n          inline: 'nearest'\n        });\n      }\n    }, 100);\n  };\n\n  // Keyboard controls: Left/Right to toggle type, Enter to confirm\n  useEffect(() => {\n    const onKeyDown = (e: KeyboardEvent) => {\n      const target = e.target as HTMLElement | null;\n      const isEditable = !!target && (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.tagName === 'SELECT' || target.isContentEditable);\n\n      // Toggle type with arrows only when not editing an input\n      if (!isEditable) {\n        if (e.key === 'ArrowLeft') {\n          e.preventDefault();\n          handleTransactionTypeChange('withdraw');\n        } else if (e.key === 'ArrowRight') {\n          e.preventDefault();\n          handleTransactionTypeChange('transfer');\n        }\n      }\n\n      // Confirm current action with Enter\n      if (e.key === 'Enter') {\n        const id = transactionType === 'transfer' ? 'transferSubmitButton' : 'withdrawSubmitButton';\n        const btn = document.getElementById(id) as HTMLButtonElement | null;\n        if (btn && !btn.disabled) {\n          e.preventDefault();\n          btn.click();\n        }\n      }\n    };\n\n    window.addEventListener('keydown', onKeyDown);\n    return () => window.removeEventListener('keydown', onKeyDown);\n  }, [transactionType]);\n\n  // Handle transaction click to show details\n  const handleTransactionClick = (transaction: Transaction) => {\n    //        \n    const mapToReceiptTransaction = (t: Transaction) => ({\n      id: t.id,\n      type: t.type === 'send' ? 'transfer' : 'withdraw',\n      sender_msisdn: t.senderPhone,\n      receiver_msisdn: t.receiverPhone,\n      amount: t.amount,\n      commission: t.commission || 0,\n      fee: (t as any)?.fee ?? 0,\n      status: t.status === 'failed' ? 'failed' : (t.status === 'completed' ? 'completed' : 'pending'),\n      createdAt: new Date(t.createdAt).toISOString(),\n      updatedAt: new Date(t.createdAt).toISOString(),\n      shopName: shopName ?? profile?.shopName ?? user?.displayName ?? '',\n      //          \n      cashierName: (t as any)?.cashierName ?? null,\n      commissionMode: (t as any)?.commissionMode ?? (t.type === 'send' ? 'add' : (isCommissionAddMode ? 'add' : 'deduct')),\n      totalCharged: (t as any)?.totalCharged ?? (\n        t.type === 'send'\n          ? (Number(t.amount || 0) + Number(t.commission || 0) + Number((t as any)?.fee || 0))\n          : (isCommissionAddMode ? (Number(t.amount || 0) + Number(t.commission || 0)) : Number(t.amount || 0))\n      ),\n      note: (t as any)?.note ?? (t as any)?.notes ?? undefined,\n      senderName: (t as any)?.senderName ?? undefined,\n      provider: (t as any)?.provider ?? undefined,\n      title: (() => {\n        const p = String((t as any)?.provider || '').toLowerCase();\n        const short = p.includes('vodafone') ? 'vf-cash' : (p.includes('instapay') ? 'instapay' : '');\n        const base = t.type === 'send' ? '' : '';\n        return (t.type === 'withdraw' && short) ? `${base} ${short}` : base;\n      })()\n    });\n\n    setReceiptTransaction(mapToReceiptTransaction(transaction));\n    setIsReceiptOpen(true);\n  };\n\n  // Handle transaction deletion\n  const handleDeleteTransaction = async (transactionId: string) => {\n    //     \n    if (!user?.uid) {\n      toast({\n        title: \"  \",\n        description: \"     \",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    //     \n    const transactionToDelete = transactions.find(t => t.id === transactionId);\n\n    if (!transactionToDelete) {\n      toast({\n        title: \"  \",\n        description: \"      \",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const txKey = String(transactionId);\n    const refKey = String((transactionToDelete as any)?.transactionId || (transactionToDelete as any)?.reference || '');\n    deletedEffectsAppliedRef.current.add(txKey);\n    if (refKey) deletedEffectsAppliedRef.current.add(refKey);\n\n    try {\n      console.log('    :', transactionId);\n\n      // :     Firebase    \n      console.log('     Firebase...', {\n        transactionId: transactionToDelete.id,\n        userId: user.uid,\n        transactionData: transactionToDelete\n      });\n\n      //      userTransactions  Firebase\n      await userDataService.removeUserTransaction(user.uid, transactionToDelete.id);\n      console.log('      Firebase userTransactions');\n\n      //       \n      try {\n        await auditLogService.saveDeletedTransaction({\n          ...transactionToDelete,\n          userId: user.uid,\n          originalTransactionId: transactionToDelete.id,\n          transactionId: (transactionToDelete as any).transactionId || transactionToDelete.id,\n          reference: (transactionToDelete as any).reference || (transactionToDelete as any).transactionReference || (transactionToDelete as any).receipt?.reference,\n          deletedAt: new Date().toISOString(),\n          permanent: true\n        });\n        console.log('         ');\n      } catch (saveError) {\n        console.warn('           Firebase :', saveError);\n        //        \n      }\n\n      //          \n      try {\n        await auditLogService.permanentlyDeleteTransaction(transactionToDelete.id, user.uid);\n      } catch (e) {\n        console.warn('       :', e);\n      }\n\n      // :        Firebase\n      const updatedDeletedTransactions = [...deletedTransactions, transactionToDelete];\n      const updatedTransactions = transactions.filter(t => t.id !== transactionId);\n\n      setDeletedTransactions(updatedDeletedTransactions);\n      setTransactions(updatedTransactions);\n      setIsTransactionDetailsOpen(false);\n\n      console.log('       Firebase (  )');\n\n      //   /   Firebase\n      try {\n        const fromWalletId = (transactionToDelete as any).fromWallet;\n        if (fromWalletId) {\n          const { walletDailyLimitsService } = await import('@/utils/walletDailyLimitsService');\n          const limits = await walletDailyLimitsService.getWalletLimits(fromWalletId);\n          if (limits) {\n            const isTransfer = transactionToDelete.type === 'send';\n            const update: any = { updatedAt: (await import('firebase/firestore')).serverTimestamp() };\n            if (isTransfer) {\n              update.dailyTransferUsed = Math.max(0, (limits.dailyTransferUsed || 0) - transactionToDelete.amount);\n              update.monthlyTransferUsed = Math.max(0, (limits.monthlyTransferUsed || 0) - transactionToDelete.amount);\n            } else {\n              update.dailyWithdrawUsed = Math.max(0, (limits.dailyWithdrawUsed || 0) - transactionToDelete.amount);\n              update.monthlyWithdrawUsed = Math.max(0, (limits.monthlyWithdrawUsed || 0) - transactionToDelete.amount);\n            }\n            const { doc, setDoc } = await import('firebase/firestore');\n            const { db } = await import('@/firebase');\n            const ref = doc(db, 'walletLimits', fromWalletId);\n            await setDoc(ref, update, { merge: true });\n          }\n        }\n      } catch (e) {\n        console.warn('     :', e);\n      }\n\n      //       \n      try {\n        const { ProfitService } = await import('@/utils/profitService');\n        const { ReportsService } = await import('@/utils/reportsService');\n        const txnType = transactionToDelete.type === 'send' ? 'send' : 'receive';\n        const transactionData: any = {\n          txnType,\n          amount: transactionToDelete.amount,\n          commission: transactionToDelete.commission || 0,\n          createdAt: transactionToDelete.createdAt,\n          status: 'confirmed'\n        };\n        const profit = ProfitService.calculateProfitFromTransaction(transactionData);\n        if (profit > 0) {\n          ProfitService.addProfit(-profit, user.uid);\n        }\n        try {\n          ReportsService.removeTransactionEffects(transactionToDelete, user.uid);\n        } catch { }\n      } catch (e) {\n        console.warn('  /  :', e);\n      }\n\n      //   \n      toast({\n        title: \"   \",\n        description: \"     .      \",\n      });\n\n    } catch (error) {\n      console.error('      Firebase:', error);\n\n      //      Firebase    \n      let errorMessage = \"     .    \";\n\n      //       \n      if (error instanceof Error) {\n        if (error.message.includes('network') || error.message.includes('offline')) {\n          errorMessage = \"   .      \";\n        } else if (error.message.includes('permission') || error.message.includes('unauthorized')) {\n          errorMessage = \"     \";\n        } else if (error.message.includes('not-found')) {\n          errorMessage = \"      \";\n        }\n      }\n\n      toast({\n        title: \"  \",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Calculate withdrawal commission (no default commission - user must enter manually)\n  const calculateWithdrawalCommission = (amount: number) => {\n    return 0; // No default commission - user must enter manually\n  };\n\n  // Calculate transfer commission (5 per 1000)\n  const calculateTransferCommission = (amount: number) => {\n    return Math.ceil((amount / 1000) * 5);\n  };\n\n  const getWithdrawalTotal = () => {\n    const amountNum = parseFloat(amount) || 0;\n    //     -    \n    const commission = (manualCommission && manualCommission.trim() !== '') ? parseFloat(manualCommission) : 0;\n    return amountNum + commission;\n  };\n\n  const getTransferTotal = () => {\n    const amountNum = parseFloat(amount) || 0;\n    const commission = (transferCommission && transferCommission.trim() !== '') ? parseFloat(transferCommission) : 0;\n    return amountNum + commission;\n  };\n\n  //      \n  const isWithdrawTx = (tx: any) => {\n    const t = tx.type;\n    const xn = (tx as any).txnType;\n    return t === 'withdraw' || t === 'withdrawal' || t === 'receive' || xn === 'receive';\n  };\n  const isSendTx = (tx: any) => {\n    const t = tx.type;\n    const xn = (tx as any).txnType;\n    return t === 'send' || t === 'transfer' || xn === 'send';\n  };\n\n  //      \n  const calculateDailyStats = (walletId?: string, dateOverride?: Date) => {\n    const baseDateStr = (dateOverride ?? new Date()).toDateString();\n    let dayTransactions = transactions.filter(tx => {\n      const sameDay = new Date(tx.createdAt).toDateString() === baseDateStr;\n      const status = String(tx.status || '').toLowerCase();\n      return sameDay && (status === 'completed' || status === 'confirmed' || status === 'pending');\n    });\n\n    //         \n    if (walletId) {\n      dayTransactions = dayTransactions.filter(tx => tx.fromWallet === walletId);\n    }\n\n    //        \n    if (reportSearchPhone && reportSearchPhone.trim() !== '') {\n      dayTransactions = dayTransactions.filter(tx =>\n        (tx.senderPhone && tx.senderPhone.includes(reportSearchPhone)) ||\n        (tx.receiverPhone && tx.receiverPhone.includes(reportSearchPhone))\n      );\n    }\n\n    //      \n    const visibleTransactions = reportsService.filterVisibleTransactions(dayTransactions, 'daily', user?.uid);\n\n    const totalTransactions = visibleTransactions.length;\n    //        ( )\n    const totalAmount = visibleTransactions.reduce((sum, tx) => sum + tx.amount, 0);\n\n    //     \n    const totalWithdrawn = visibleTransactions\n      .filter(isWithdrawTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).withdrawnAmount !== undefined ? (tx as any).withdrawnAmount : tx.amount;\n        return sum + amount;\n      }, 0);\n\n    const totalSent = visibleTransactions\n      .filter(isSendTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).sentAmount !== undefined ? (tx as any).sentAmount : tx.amount;\n        return sum + amount;\n      }, 0);\n\n    return { totalTransactions, totalAmount, totalWithdrawn, totalSent };\n  };\n\n  const calculateMonthlyStats = (walletId?: string) => {\n    const currentMonth = new Date().getMonth();\n    const currentYear = new Date().getFullYear();\n\n    let monthlyTransactions = transactions.filter(tx => {\n      const txDate = new Date(tx.createdAt);\n      return txDate.getMonth() === currentMonth &&\n        txDate.getFullYear() === currentYear &&\n        tx.status === 'completed';\n    });\n\n    //         \n    if (walletId) {\n      monthlyTransactions = monthlyTransactions.filter(tx => tx.fromWallet === walletId);\n    }\n\n    //        \n    if (reportSearchPhone && reportSearchPhone.trim() !== '') {\n      monthlyTransactions = monthlyTransactions.filter(tx =>\n        (tx.senderPhone && tx.senderPhone.includes(reportSearchPhone)) ||\n        (tx.receiverPhone && tx.receiverPhone.includes(reportSearchPhone))\n      );\n    }\n\n    //      \n    const visibleMonthlyTransactions = reportsService.filterVisibleTransactions(monthlyTransactions, 'monthly', user?.uid);\n\n    const totalTransactions = visibleMonthlyTransactions.length;\n    //        ( )\n    const totalAmount = visibleMonthlyTransactions.reduce((sum, tx) => sum + tx.amount, 0);\n\n    //       \n    const totalWithdrawn = visibleMonthlyTransactions\n      .filter(isWithdrawTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).withdrawnAmount !== undefined ? (tx as any).withdrawnAmount : tx.amount;\n        return sum + amount;\n      }, 0);\n\n    const totalSent = visibleMonthlyTransactions\n      .filter(isSendTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).sentAmount !== undefined ? (tx as any).sentAmount : tx.amount;\n        return sum + amount;\n      }, 0);\n\n    return { totalTransactions, totalAmount, totalWithdrawn, totalSent };\n  };\n\n  //     \n  const calculateWalletMonthlyUsage = (walletId: string) => {\n    const currentMonth = new Date().getMonth();\n    const currentYear = new Date().getFullYear();\n\n    const walletTransactions = transactions.filter(tx => {\n      const txDate = new Date(tx.createdAt);\n      return txDate.getMonth() === currentMonth &&\n        txDate.getFullYear() === currentYear &&\n        tx.status === 'completed' &&\n        tx.fromWallet === walletId;\n    });\n\n    const totalWithdrawn = walletTransactions\n      .filter(isWithdrawTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).withdrawnAmount || tx.amount;\n        return sum + amount;\n      }, 0);\n\n    const totalTransferred = walletTransactions\n      .filter(isSendTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).sentAmount || tx.amount;\n        return sum + amount;\n      }, 0);\n\n    return { totalWithdrawn, totalTransferred };\n  };\n\n  //     \n  const calculateWalletDailyUsage = (walletId: string) => {\n    const today = new Date();\n    const currentDay = today.getDate();\n    const currentMonth = today.getMonth();\n    const currentYear = today.getFullYear();\n\n    const walletTransactions = transactions.filter(tx => {\n      const txDate = new Date(tx.createdAt);\n      return txDate.getDate() === currentDay &&\n        txDate.getMonth() === currentMonth &&\n        txDate.getFullYear() === currentYear &&\n        tx.status === 'completed' &&\n        tx.fromWallet === walletId;\n    });\n\n    const totalWithdrawn = walletTransactions\n      .filter(isWithdrawTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).withdrawnAmount || tx.amount;\n        return sum + amount;\n      }, 0);\n\n    const totalTransferred = walletTransactions\n      .filter(isSendTx)\n      .reduce((sum, tx) => {\n        const amount = (tx as any).sentAmount || tx.amount;\n        return sum + amount;\n      }, 0);\n\n    return { totalWithdrawn, totalTransferred };\n  };\n\n  //       (   )\n  const currentMonthlyStats = React.useMemo(() => calculateMonthlyStats(), [transactions, selectedWallet, reportSearchPhone]);\n  const monthlyWithdrawn = currentMonthlyStats.totalWithdrawn;\n  const monthlyTransferred = currentMonthlyStats.totalSent;\n\n  //        \n  const walletMonthlyUsageMemo = React.useMemo(\n    () => calculateWalletMonthlyUsage(selectedWallet),\n    [transactions, selectedWallet]\n  );\n\n  //           ( 85%)\n  useEffect(() => {\n    try {\n      if (!selectedWallet || wallets.length === 0) return;\n      const selectedWalletObj = wallets.find(w => w.id === selectedWallet);\n      if (!selectedWalletObj) return;\n      const monthlyWithdrawalLimit = selectedWalletLimits?.monthlyWithdrawLimit ?? selectedWalletObj?.monthlyWithdrawalLimit ?? 200000;\n      const monthlyTransferLimit = selectedWalletLimits?.monthlyTransferLimit ?? selectedWalletObj?.monthlyTransferLimit ?? 200000;\n      const amountNum = parseFloat(amount || '0') || 0;\n      const monthlyWithdrawUsed = (walletMonthlyUsageMemo as any)?.totalWithdrawn ?? selectedWalletLimits?.monthlyWithdrawUsed ?? 0;\n      const monthlyTransferUsed = (walletMonthlyUsageMemo as any)?.totalTransferred ?? selectedWalletLimits?.monthlyTransferUsed ?? 0;\n      const predictedMonthlyWithdrawUsed = monthlyWithdrawUsed + (transactionType === 'withdraw' ? amountNum : 0);\n      const predictedMonthlyTransferUsed = monthlyTransferUsed + (transactionType === 'transfer' ? amountNum : 0);\n\n      const percent = 0.85;\n      const withdrawThreshold = Math.floor(Math.max(monthlyWithdrawalLimit, 1) * percent);\n      const transferThreshold = Math.floor(Math.max(monthlyTransferLimit, 1) * percent);\n      const monthKey = (() => {\n        const d = new Date();\n        return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;\n      })();\n      const warnKeyBase = `monthlyLimitWarnShown:${selectedWallet}:${monthKey}`;\n\n      if (predictedMonthlyWithdrawUsed >= withdrawThreshold) {\n        const key = `${warnKeyBase}:withdraw`;\n        const shown = localStorage.getItem(key) === 'true';\n        if (!shown) {\n          setMonthlyLimitWarnData({ type: 'withdraw', used: predictedMonthlyWithdrawUsed, limit: monthlyWithdrawalLimit, walletName: selectedWalletObj.name });\n          setIsMonthlyLimitWarnOpen(true);\n          try { localStorage.setItem(key, 'true'); } catch { }\n          return;\n        }\n      }\n\n      if (predictedMonthlyTransferUsed >= transferThreshold) {\n        const key = `${warnKeyBase}:transfer`;\n        const shown = localStorage.getItem(key) === 'true';\n        if (!shown) {\n          setMonthlyLimitWarnData({ type: 'transfer', used: predictedMonthlyTransferUsed, limit: monthlyTransferLimit, walletName: selectedWalletObj.name });\n          setIsMonthlyLimitWarnOpen(true);\n          try { localStorage.setItem(key, 'true'); } catch { }\n          return;\n        }\n      }\n    } catch { }\n  }, [selectedWallet, wallets, selectedWalletLimits, walletMonthlyUsageMemo, transactionType, amount]);\n\n  //      localStorage:    Firebase \n\n  //      localStorage:     \n\n  const handleTransaction = async () => {\n    //    ()     \n    playVodafoneShakshan();\n    console.log('   /');\n    console.log('  :', {\n      senderPhone,\n      receiverPhone,\n      amount,\n      transactionType\n    });\n\n    //      (Optimistic UI)\n    const setSuccessOptimistic = () => {\n      if (transactionType === 'transfer') {\n        setIsTransferSuccess(true);\n      } else {\n        setIsWithdrawSuccess(true);\n      }\n    };\n    const revertSuccess = () => {\n      if (transactionType === 'transfer') {\n        setIsTransferSuccess(false);\n      } else {\n        setIsWithdrawSuccess(false);\n      }\n    };\n    setSuccessOptimistic();\n\n    if (!senderPhone || !amount) {\n      console.log(' :  ');\n      toast({\n        title: \"  \",\n        description: \"    \",\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n\n    if (transactionType === 'transfer' && !receiverPhone && !isVodafoneCashUser) {\n      console.log(' :   ');\n      toast({\n        title: \"  \",\n        description: \"   \",\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n\n    //    :       \n    //    /      \n    if (transactionType === 'transfer' && !isVodafoneCashUser) {\n      const onlyDigits = String(receiverPhone || '').replace(/[^0-9-]/g, '');\n      const hasLettersOrText = /[^0-9-\\s]/.test(String(receiverPhone || ''));\n      if (!hasLettersOrText) {\n        if (!strictValidateMsisdn(receiverPhone)) {\n          toast({\n            title: \"   \",\n            description: \"     11    015  010  012  011\",\n            variant: \"destructive\",\n          });\n          revertSuccess();\n          return;\n        }\n      }\n    }\n\n    const amountNum = parseFloat(amount);\n    console.log('  :', amountNum);\n\n    if (amountNum <= 0) {\n      console.log(' :   ');\n      toast({\n        title: \"  \",\n        description: \"   \",\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n\n    //      : 10  \n    if (isZeroPlan) {\n      try {\n        const today = new Date();\n        const yyyy = today.getFullYear();\n        const mm = String(today.getMonth() + 1).padStart(2, '0');\n        const dd = String(today.getDate()).padStart(2, '0');\n        const dailyKey = `zeroPlanDailyConfirmCount:${user?.uid || 'default'}:${yyyy}-${mm}-${dd}`;\n        const usedCountRaw = localStorage.getItem(dailyKey);\n        const usedCount = usedCountRaw ? parseInt(usedCountRaw, 10) || 0 : 0;\n        if (usedCount >= 10) {\n          toast({\n            title: '  ',\n            description: '    10  /  .',\n            variant: 'destructive',\n          });\n          revertSuccess();\n          return;\n        }\n      } catch (e) {\n        console.warn('        :', e);\n      }\n    }\n\n    //      \n    const selectedWalletObj = wallets.find(w => w.id === selectedWallet);\n    if (!selectedWalletObj) {\n      toast({\n        title: \"  \",\n        description: \"   \",\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n\n    const walletUsage = walletMonthlyUsageMemo;\n    console.log('     ');\n    console.log('   :', {\n      walletId: selectedWallet,\n      walletName: selectedWalletObj.name,\n      currentWithdrawn: walletUsage.totalWithdrawn,\n      currentTransferred: walletUsage.totalTransferred,\n      withdrawalLimit: selectedWalletObj.monthlyWithdrawalLimit,\n      transferLimit: selectedWalletObj.monthlyTransferLimit\n    });\n\n    if (transactionType === 'withdraw') {\n      console.log('     ');\n      console.log(`    : ${walletUsage.totalWithdrawn},  : ${amountNum},  : ${selectedWalletObj.monthlyWithdrawalLimit}`);\n\n      if (walletUsage.totalWithdrawn + amountNum > selectedWalletObj.monthlyWithdrawalLimit) {\n        console.log('     ');\n        toast({\n          title: \"   \",\n          description: `     ${selectedWalletObj.monthlyWithdrawalLimit}     ${selectedWalletObj.name}`,\n          variant: \"destructive\",\n        });\n        revertSuccess();\n        return;\n      }\n    } else {\n      console.log('     ');\n      console.log(`    : ${walletUsage.totalTransferred},  : ${amountNum},  : ${selectedWalletObj.monthlyTransferLimit}`);\n\n      if (walletUsage.totalTransferred + amountNum > selectedWalletObj.monthlyTransferLimit) {\n        console.log('     ');\n        toast({\n          title: \"   \",\n          description: `     ${selectedWalletObj.monthlyTransferLimit}     ${selectedWalletObj.name}`,\n          variant: \"destructive\",\n        });\n        revertSuccess();\n        return;\n      }\n    }\n\n    //        (    )\n    const merchantShopName = profile?.shopName || user?.displayName || '  ';\n\n    const newTransaction: Transaction = {\n      id: Date.now().toString(),\n      type: transactionType === 'transfer' ? 'send' : transactionType === 'deposit' ? 'deposit' : 'withdraw',\n      senderPhone,\n      receiverPhone: transactionType === 'transfer' ? receiverPhone : senderPhone,\n      amount: amountNum,\n      status: 'completed',\n      createdAt: new Date(),\n      withdrawnAmount: transactionType === 'withdraw' ? amountNum : undefined,\n      sentAmount: transactionType === 'transfer' ? amountNum : undefined,\n      depositedAmount: undefined,\n      fromWallet: selectedWallet,\n      //    \n      senderNumber: senderPhone,\n      senderName: transactionType === 'withdraw' && withdrawSenderName.trim() !== '' ? withdrawSenderName.trim() : undefined,\n      shopName: selectedWalletObj?.name || ' ',\n      transferredAmount: transactionType === 'transfer' ? amountNum : undefined,\n      receiverNumber: transactionType === 'transfer' ? receiverPhone : undefined,\n      withdrawnAmountDetailed: transactionType === 'withdraw' ? amountNum : undefined,\n      depositedAmountDetailed: undefined,\n      merchantShopName: merchantShopName,\n      transactionReference: `TXN-${Date.now()}`,\n      commission: 0, //       \n      notes: transactionType === 'transfer'\n        ? undefined\n        : (withdrawNote && withdrawNote.trim() !== '' ? withdrawNote.trim() : undefined)\n    };\n\n    //               \n    if (isShiftActive && (shiftUser?.name || shiftUser?.username)) {\n      (newTransaction as any).cashierName = shiftUser?.name || shiftUser?.username;\n    }\n\n    //       \n    const validation = WalletCashService.validateTransaction(\n      amountNum,\n      transactionType,\n      cashBalance,\n      walletBalances\n    );\n\n    if (!validation.isValid) {\n      toast({\n        title: \"  \",\n        description: validation.error,\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n\n    //      \n    if (validation.warning) {\n      toast({\n        title: \"\",\n        description: validation.warning,\n        variant: \"destructive\",\n      });\n    }\n\n    //  :\n    // -      ( )    .\n    // -          .\n    // -       :    (1%  ).\n    let commissionAmount: number;\n    if (transactionType === 'transfer') {\n      if (selectedWalletObj?.defaultTransferCommission != null) {\n        const rate = Number(selectedWalletObj.defaultTransferCommission) || 0;\n        commissionAmount = Math.round(((rate * amountNum) / 1000) * 100) / 100;\n      } else if (transferCommission && transferCommission.trim() !== '') {\n        commissionAmount = Math.max(0, parseFloat(transferCommission));\n      } else {\n        commissionAmount = 0;\n      }\n    } else { // withdraw\n      if (selectedWalletObj?.defaultWithdrawCommission != null) {\n        const rate = Number(selectedWalletObj.defaultWithdrawCommission) || 0;\n        commissionAmount = Math.round(((rate * amountNum) / 1000) * 100) / 100;\n      } else if (manualCommission && manualCommission.trim() !== '') {\n        commissionAmount = Math.max(0, parseFloat(manualCommission));\n      } else {\n        //   : 1%  \n        commissionAmount = Math.round((amountNum * 0.01) * 100) / 100;\n      }\n    }\n\n    //        /\n    newTransaction.commission = commissionAmount;\n\n    //        (/)\n    if (transactionType !== 'transfer' && !isCommissionAddMode && commissionAmount >= amountNum) {\n      toast({\n        title: \"  \",\n        description: \"      \",\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n    const effectiveAmount = transactionType === 'transfer'\n      ? amountNum\n      : (isCommissionAddMode ? amountNum : Math.round((amountNum - commissionAmount) * 100) / 100);\n    //          \n    newTransaction.amount = effectiveAmount;\n    newTransaction.withdrawnAmount = transactionType === 'withdraw' ? effectiveAmount : undefined;\n    newTransaction.sentAmount = transactionType === 'transfer' ? effectiveAmount : undefined;\n    newTransaction.transferredAmount = transactionType === 'transfer' ? effectiveAmount : undefined;\n    newTransaction.withdrawnAmountDetailed = transactionType === 'withdraw' ? effectiveAmount : undefined;\n\n    //     \n    let result;\n    //         (  )\n    const isDeferredTransfer = transactionType === 'transfer' && !!quickDebtInfo;\n    const isDeferredWithdraw = transactionType === 'withdraw' && !!quickDebtInfo;\n    const skipProcess = isDeferredTransfer || isDeferredWithdraw;\n    let linkedDebtId: string | null = null;\n\n    //     010011   \n    const sDigits = normalizeDigits(senderPhone || '').replace(/\\D/g, '');\n    const rDigits = normalizeDigits(receiverPhone || '').replace(/\\D/g, '');\n    const is010To011 = transactionType === 'transfer' && ((sDigits.startsWith('010') && (rDigits.startsWith('011') || rDigits.startsWith('012') || rDigits.startsWith('015'))) || (sDigits.startsWith('012') && rDigits.startsWith('010')) || (sDigits.startsWith('011') && rDigits.startsWith('010')) || (sDigits.startsWith('015') && rDigits.startsWith('010')));\n    const extraFee = Math.max(0, parseFloat(transferExtraFee || '0'));\n    const fullCommission = Math.round((commissionAmount * 100)) / 100;\n    newTransaction.commission = fullCommission;\n    (newTransaction as any).fee = extraFee;\n    (newTransaction as any).totalCharged = transactionType === 'transfer'\n      ? (Number(effectiveAmount) + Number(fullCommission) + Number(extraFee))\n      : (isCommissionAddMode ? (Number(effectiveAmount) + Number(fullCommission)) : Number(effectiveAmount));\n\n    //       \n    if (is010To011 && !skipProcess && extraFee <= 0) {\n      toast({\n        title: \"\",\n        description: \"    010  011/012/015  012  010  011  010  015  010\",\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n\n    //        (  )\n    if (transactionType === 'transfer' && !skipProcess) {\n      const currentWalletBalance = Number(walletBalances[selectedWallet] || 0);\n      const totalDebit = Number(effectiveAmount) + Number(extraFee);\n      if (currentWalletBalance < totalDebit) {\n        toast({\n          title: \"   \",\n          description: `  ${currentWalletBalance}    ${totalDebit}`,\n          variant: \"destructive\",\n        });\n        revertSuccess();\n        return;\n      }\n    }\n\n    if (skipProcess) {\n      //  \n      if (isDeferredTransfer) {\n        const check = WalletCashService.validateTransaction(\n          effectiveAmount,\n          'transfer',\n          cashBalance,\n          walletBalances\n        );\n        if (!check.isValid) {\n          result = {\n            success: false,\n            newCashBalance: cashBalance,\n            newWalletBalances: walletBalances,\n            message: check.error || '    ',\n            error: 'INSUFFICIENT_WALLET_BALANCE'\n          } as any;\n        } else {\n          const effectiveSelectedWalletId = selectedWallet || (wallets.find((w: any) => w.isDefault)?.id) || (wallets[0]?.id);\n          const limitsSrc = selectedWalletLimits ?? await walletDailyLimitsService.getWalletLimits(effectiveSelectedWalletId!);\n          const todayStr = new Date().toDateString();\n          const pendingToday = transactions\n            .filter(tx => tx.type === 'send' && String(tx.status || '').toLowerCase() === 'pending' && (tx.fromWallet === effectiveSelectedWalletId) && new Date(tx.createdAt).toDateString() === todayStr)\n            .reduce((sum, tx) => sum + Number((tx as any).sentAmount ?? (tx as any).transferredAmount ?? tx.amount ?? 0), 0);\n          const dailyLimit = Number((limitsSrc as any)?.dailyTransferLimit ?? 60000);\n          const dailyUsed = Number((limitsSrc as any)?.dailyTransferUsed ?? 0);\n          if (dailyUsed + pendingToday + Number(effectiveAmount) > dailyLimit) {\n            toast({ title: '   ', description: ` : ${(dailyLimit - dailyUsed - pendingToday).toLocaleString()} .`, variant: 'destructive' });\n            revertSuccess();\n            return;\n          }\n\n          const now = new Date();\n          const pendingMonth = transactions\n            .filter(tx => tx.type === 'send' && String(tx.status || '').toLowerCase() === 'pending' && (tx.fromWallet === effectiveSelectedWalletId) && new Date(tx.createdAt).getMonth() === now.getMonth() && new Date(tx.createdAt).getFullYear() === now.getFullYear())\n            .reduce((sum, tx) => sum + Number((tx as any).sentAmount ?? (tx as any).transferredAmount ?? tx.amount ?? 0), 0);\n          const monthlyLimit = Number((limitsSrc as any)?.monthlyTransferLimit ?? 200000);\n          const monthlyUsed = Number((limitsSrc as any)?.monthlyTransferUsed ?? 0);\n          if (monthlyUsed + pendingMonth + Number(effectiveAmount) > monthlyLimit) {\n            toast({ title: '   ', description: `  : ${(monthlyLimit - monthlyUsed - pendingMonth).toLocaleString()} .`, variant: 'destructive' });\n            revertSuccess();\n            return;\n          }\n\n          result = { success: true, newCashBalance: cashBalance, newWalletBalances: walletBalances } as any;\n        }\n      } else {\n        const effectiveSelectedWalletId = selectedWallet || (wallets.find((w: any) => w.isDefault)?.id) || (wallets[0]?.id);\n        const limitsSrc = selectedWalletLimits ?? await walletDailyLimitsService.getWalletLimits(effectiveSelectedWalletId!);\n        const todayStr = new Date().toDateString();\n        const pendingToday = transactions\n          .filter(tx => tx.type === 'withdraw' && String(tx.status || '').toLowerCase() === 'pending' && (tx.fromWallet === effectiveSelectedWalletId) && new Date(tx.createdAt).toDateString() === todayStr)\n          .reduce((sum, tx) => sum + Number((tx as any).withdrawnAmount ?? tx.amount ?? 0), 0);\n        const dailyLimit = Number((limitsSrc as any)?.dailyWithdrawLimit ?? 100000);\n        const dailyUsed = Number((limitsSrc as any)?.dailyWithdrawUsed ?? 0);\n        if (dailyUsed + pendingToday + Number(effectiveAmount) > dailyLimit) {\n          toast({ title: '   ', description: ` : ${(dailyLimit - dailyUsed - pendingToday).toLocaleString()} .`, variant: 'destructive' });\n          revertSuccess();\n          return;\n        }\n\n        const now = new Date();\n        const pendingMonth = transactions\n          .filter(tx => tx.type === 'withdraw' && String(tx.status || '').toLowerCase() === 'pending' && (tx.fromWallet === effectiveSelectedWalletId) && new Date(tx.createdAt).getMonth() === now.getMonth() && new Date(tx.createdAt).getFullYear() === now.getFullYear())\n          .reduce((sum, tx) => sum + Number((tx as any).withdrawnAmount ?? tx.amount ?? 0), 0);\n        const monthlyLimit = Number((limitsSrc as any)?.monthlyWithdrawLimit ?? 200000);\n        const monthlyUsed = Number((limitsSrc as any)?.monthlyWithdrawUsed ?? 0);\n        if (monthlyUsed + pendingMonth + Number(effectiveAmount) > monthlyLimit) {\n          toast({ title: '   ', description: `  : ${(monthlyLimit - monthlyUsed - pendingMonth).toLocaleString()} .`, variant: 'destructive' });\n          revertSuccess();\n          return;\n        }\n\n        const newCash = Math.round((Number(cashBalance) - Number(effectiveAmount)) * 100) / 100;\n        result = { success: true, newCashBalance: newCash, newWalletBalances: walletBalances } as any;\n      }\n    } else if (transactionType === 'transfer') {\n      // :      \n      result = await WalletCashService.processTransfer({\n        amount: effectiveAmount,\n        currentCashBalance: cashBalance,\n        currentWalletBalances: walletBalances,\n        wallets: wallets,\n        selectedWalletId: selectedWallet,\n        //     /\n        skipRemoteLimitsCheck: false,\n        nonBlockingUsageUpdate: true\n      });\n    } else {\n      // :      \n      result = await WalletCashService.processWithdraw({\n        amount: effectiveAmount,\n        currentCashBalance: cashBalance,\n        currentWalletBalances: walletBalances,\n        wallets: wallets,\n        selectedWalletId: selectedWallet,\n        //     /\n        skipRemoteLimitsCheck: false,\n        nonBlockingUsageUpdate: true\n      });\n    }\n\n    if (!result.success) {\n      toast({\n        title: \"  \",\n        description: result.error || result.message,\n        variant: \"destructive\",\n      });\n      revertSuccess();\n      return;\n    }\n\n    //       \n    let newCashBalance = skipProcess ? (isDeferredWithdraw ? result.newCashBalance : cashBalance) : result.newCashBalance;\n    let newWalletBalances = skipProcess ? walletBalances : result.newWalletBalances;\n    //          \n    if (!skipProcess && transactionType === 'transfer' && extraFee > 0) {\n      const prevBalance = Number(newWalletBalances[selectedWallet] || 0);\n      newWalletBalances = {\n        ...newWalletBalances,\n        [selectedWallet]: Math.round((prevBalance - Number(extraFee)) * 100) / 100,\n      };\n    }\n    //          \n    //       \n\n    //              \n    if (skipProcess && isDeferredTransfer) {\n      const walletObj =\n        wallets.find((w: any) => w.id === selectedWallet) ??\n        wallets.find((w: any) => w.isDefault) ??\n        wallets[0];\n      const effectiveSelectedWalletId = walletObj?.id || selectedWallet;\n\n      if (effectiveSelectedWalletId !== selectedWallet) {\n        try {\n          setWalletSelection(effectiveSelectedWalletId);\n        } catch { }\n      }\n\n      const previousBalance = Number(walletBalances[effectiveSelectedWalletId] || 0);\n      newWalletBalances = {\n        ...walletBalances,\n        [effectiveSelectedWalletId]: Math.round((previousBalance - Number(effectiveAmount) - Number(extraFee)) * 100) / 100\n      };\n    }\n\n    //     (  )       \n    if ((isDeferredTransfer || isDeferredWithdraw) && quickDebtInfo && !didCreateQuickDebt) {\n      const newDebt: Debt = {\n        id: `DEBT-${Date.now()}`,\n        debtorName: quickDebtInfo.debtorName,\n        amount: quickDebtInfo.amount,\n        reason: quickDebtInfo.notes || '',\n        customerId: quickDebtInfo.customerId,\n        mobile: quickDebtInfo.mobile,\n        status: 'pending',\n        createdAt: new Date(),\n      };\n      linkedDebtId = newDebt.id;\n      //        \n      (newTransaction as any).linkedDebtId = linkedDebtId;\n      const updatedDebts = [newDebt, ...debts];\n      setDebts(updatedDebts);\n      try {\n        await saveDebtsToStorage(updatedDebts);\n        // Explicit sync for new deferred debt to debts collection - RE-ENABLED\n        if (user?.uid) {\n           const debtRef = doc(db, 'debts', newDebt.id);\n           const p: any = { \n               ...newDebt, \n               userId: user.uid, \n               shopId: shopIdCtx || profile?.shopId || null, \n               lastUpdated: new Date().toISOString() \n           };\n           Object.keys(p).forEach(key => p[key] === undefined && delete p[key]);\n           await setDoc(debtRef, p, { merge: true });\n        }\n      } catch (e) {\n        console.error('       :', e);\n      }\n      toast({ title: '  ', description: '      ', variant: 'default' });\n    }\n\n    //      ( )\n    //          \n    if (!skipProcess) {\n      const addToCash = Math.max(0, Number(commissionAmount)) + Math.max(0, Number(extraFee));\n      if (addToCash > 0) {\n        newCashBalance = Math.round((newCashBalance + addToCash) * 100) / 100;\n        console.log(`   / ${addToCash}   `);\n      }\n    }\n\n    //          startTransition\n    console.log('       startTransition...');\n    \n    //      \n    const tempTransactionId = 'temp_' + Date.now() + '_' + Math.random().toString(36).substring(7);\n    const transactionDataCreateOptimistic = {\n      shopId: (shopIdCtx || profile?.shopId || user?.uid || 'default-shop'),\n      lineId: selectedWallet || 'default-line',\n      walletId: selectedWallet || undefined,\n      merchantUserId: user?.uid || null,\n      provider: 'vodafone_cash' as const,\n      txnType: transactionType === 'transfer' ? 'send' as const : 'receive' as const,\n      originType: transactionType === 'transfer' ? 'transfer' as const : 'withdraw' as const,\n      amount: effectiveAmount,\n      commission: fullCommission,\n      fee: extraFee,\n      profit: 0,\n      senderMsisdn: senderPhone,\n      receiverMsisdn: transactionType === 'transfer' ? receiverPhone : senderPhone,\n      note: transactionType === 'transfer' ? undefined : (withdrawNote && withdrawNote.trim() !== '' ? withdrawNote.trim() : undefined),\n      status: (skipProcess ? 'pending' as const : 'confirmed' as const),\n      linkedDebtId: linkedDebtId || undefined,\n      createdBy: user?.uid || null,\n      walletEffectAppliedOnCreation: false,\n      cashEffectAppliedOnCreation: !!(skipProcess && isDeferredWithdraw),\n      limitsReservedOnCreation: !!(skipProcess),\n      limitReservedType: (transactionType === 'transfer' ? 'transfer' as const : 'withdraw' as const),\n      profitAddedOnCreation: false\n    };\n\n    const optimisticTransaction = {\n      ...transactionDataCreateOptimistic,\n      id: tempTransactionId,\n      status: (skipProcess ? 'pending' as const : 'completed' as const),\n      commissionMode: transactionType === 'transfer' ? 'add' : (isCommissionAddMode ? 'add' : 'deduct'),\n      totalCharged: transactionType === 'transfer' ? (effectiveAmount + fullCommission + extraFee) : (isCommissionAddMode ? (effectiveAmount + commissionAmount) : effectiveAmount),\n      walletEffectAppliedOnCreation: false,\n      cashEffectAppliedOnCreation: !!(skipProcess && isDeferredWithdraw),\n      limitsReservedOnCreation: !!(skipProcess),\n      limitReservedType: (transactionType === 'transfer' ? 'transfer' as const : 'withdraw' as const),\n      sentAmount: transactionType === 'transfer' ? effectiveAmount : undefined,\n      transferredAmount: transactionType === 'transfer' ? effectiveAmount : undefined,\n      withdrawnAmount: transactionType === 'withdraw' ? effectiveAmount : undefined,\n      senderName: transactionType === 'withdraw' && withdrawSenderName.trim() !== '' ? withdrawSenderName.trim() : undefined,\n      createdAt: new Date(),\n      // Ensure compatibility with display logic\n      type: transactionType === 'transfer' ? 'send' : 'withdraw',\n      senderPhone: senderPhone || '',\n      receiverPhone: receiverPhone || '',\n    };\n\n    //     \n    try {\n        //    \n        localTransactionsBuffer.current = [optimisticTransaction, ...localTransactionsBuffer.current];\n        \n        //   React Query \n        queryClientHook.setQueryData(\n          ['recentTransactions', user?.uid, (shopIdCtx || 'main')],\n          (oldData: any) => {\n             if (!oldData || !Array.isArray(oldData)) return [optimisticTransaction];\n             return [optimisticTransaction, ...oldData];\n          }\n        );\n    } catch (e) { console.error('Error in optimistic update:', e); }\n\n    //    ()\n    if (selectedWallet && selectedWalletLimits) {\n        try {\n            const isTransfer = transactionType === 'transfer';\n            const newLimits = { ...selectedWalletLimits };\n            if (isTransfer) {\n                newLimits.dailyTransferUsed = (newLimits.dailyTransferUsed || 0) + effectiveAmount;\n                newLimits.monthlyTransferUsed = (newLimits.monthlyTransferUsed || 0) + effectiveAmount;\n            } else {\n                newLimits.dailyWithdrawUsed = (newLimits.dailyWithdrawUsed || 0) + effectiveAmount;\n                newLimits.monthlyWithdrawUsed = (newLimits.monthlyWithdrawUsed || 0) + effectiveAmount;\n            }\n            setSelectedWalletLimits(newLimits);\n            // Do NOT dispatch event here as it triggers a re-fetch of old data from Firestore\n            // before the update is committed. We only update the local state optimistically.\n            // try { window.dispatchEvent(new CustomEvent('walletLimitsUpdated', { detail: { walletId: selectedWallet } })); } catch { }\n        } catch (e) { console.error('Error in optimistic limit update:', e); }\n    }\n\n    const updatedTransactionsList = [optimisticTransaction, ...transactions];\n    \n    //   \n    React.startTransition(() => {\n      setCashBalance(newCashBalance);\n      setWalletBalances(newWalletBalances);\n      if (skipProcess) {\n        (newTransaction as any).status = 'pending';\n      }\n      setTransactions(updatedTransactionsList);\n    });\n    \n    try {\n      setTimeout(() => {\n        try {\n          localStorage.setItem(getTransactionsKey(), JSON.stringify(updatedTransactionsList));\n        } catch { }\n      }, 0);\n    } catch { }\n\n    //       \n    if (isZeroPlan) {\n      try {\n        const today = new Date();\n        const yyyy = today.getFullYear();\n        const mm = String(today.getMonth() + 1).padStart(2, '0');\n        const dd = String(today.getDate()).padStart(2, '0');\n        const dailyKey = `zeroPlanDailyConfirmCount:${user?.uid || 'default'}:${yyyy}-${mm}-${dd}`;\n        const usedCountRaw = localStorage.getItem(dailyKey);\n        const usedCount = usedCountRaw ? parseInt(usedCountRaw, 10) || 0 : 0;\n        localStorage.setItem(dailyKey, String(usedCount + 1));\n      } catch { }\n    }\n\n    //     localStorage      \n    setTimeout(() => {\n      try {\n        const timestamp = new Date().toISOString();\n        localStorage.setItem(getCashBalanceKey(), newCashBalance.toString());\n        localStorage.setItem(getCashBalanceKey() + '_lastUpdated', timestamp);\n        localStorage.setItem(getWalletBalancesKey(), JSON.stringify(newWalletBalances));\n        localStorage.setItem(getWalletBalancesKey() + '_lastUpdated', timestamp);\n      } catch { }\n    }, 0);\n\n    try {\n      if (user?.uid) {\n        const walletObj =\n          wallets.find((w: any) => w.id === selectedWallet) ??\n          wallets.find((w: any) => w.isDefault) ??\n          wallets[0];\n        const effectiveWalletId = walletObj?.id || selectedWallet;\n        const remainingWalletBalance = Number((newWalletBalances as any)[effectiveWalletId] || 0);\n        const srcPhone = String(walletObj?.phone || senderPhone || '').trim();\n        const dstPhone = String(receiverPhone || '').trim();\n        const hasFee = Number(extraFee) > 0;\n        const mark = transactionType === 'transfer' ? '' : '';\n        const commissionPart = Number(fullCommission) > 0 ? `${Number(fullCommission)} ` : '0 ';\n        const feePart = hasFee ? `   ${Number(extraFee)} ` : '';\n        const msg = transactionType === 'transfer'\n          ? `${mark}    ${Number(effectiveAmount)}     ${srcPhone}    ${dstPhone}    ${commissionPart}${feePart}.    : ${remainingWalletBalance} .   : ${Number(newCashBalance)} .`\n          : `${mark}    ${Number(effectiveAmount)}       ${srcPhone}    ${commissionPart}${feePart}.    : ${remainingWalletBalance} .   : ${Number(newCashBalance)} .`;\n        const key = user?.uid ? `tg_last_msg_${user.uid}` : 'tg_last_msg';\n        const now = Date.now();\n        let shouldSend = true;\n        try {\n          const raw = localStorage.getItem(key);\n          if (raw) {\n            const prev = JSON.parse(raw);\n            const prevMsg = String(prev?.text || '');\n            const prevAt = Number(prev?.at || 0);\n            if (prevMsg === msg && now - prevAt < 5000) shouldSend = false;\n          }\n        } catch {}\n        if (shouldSend) {\n          Promise.resolve(telegramNotifier.send(user.uid, msg)).catch(() => {});\n          try { localStorage.setItem(key, JSON.stringify({ text: msg, at: now })); } catch {}\n        }\n      }\n    } catch {}\n\n    //     - \n    // toast({\n    //   title: transactionType === 'transfer' ? \"  \" : \"  \",\n    //   description: \"       ...\",\n    // });\n\n    //      Firebase  \n    (async () => {\n      try {\n        console.log('     Firebase  ...');\n\n        //       \n        const transactionDataCreate = { ...transactionDataCreateOptimistic };\n        \n        //          \n        \n        const transactionDataForUser = {\n            ...optimisticTransaction,\n            //    ID \n        };\n\n        //        \n        const { ProfitService } = await import('@/utils/profitService');\n        const profit = ProfitService.calculateProfitFromTransaction({ ...transactionDataForUser, status: 'confirmed' });\n        if (profit > 0) {\n          ProfitService.addProfit(profit, user?.uid);\n          (transactionDataCreate as any).profitAddedOnCreation = true;\n          (transactionDataForUser as any).profitAddedOnCreation = true;\n          console.log('   :', profit, '');\n        }\n\n        //           \n        const createdTransactionId = await transactionService.create(transactionDataCreate);\n\n        if (selectedWallet) {\n          try {\n            //      \n            const updatedLimits = await walletDailyLimitsService.updateUsage(selectedWallet, effectiveAmount, transactionType === 'transfer' ? 'transfer' : 'withdraw');\n            \n            //        \n            if (updatedLimits) {\n              setSelectedWalletLimits(updatedLimits);\n            }\n\n            try { window.dispatchEvent(new CustomEvent('walletLimitsUpdated', { detail: { walletId: selectedWallet } })); } catch { }\n          } catch (e) { }\n        }\n\n        await Promise.all([\n          ...(user?.uid ? [userDataService.updateUserData(user.uid, {\n            cashBalance: newCashBalance,\n            walletBalances: newWalletBalances,\n            lastUpdated: new Date().toISOString()\n          })] : []),\n          ...(user?.uid ? [userDataService.saveUserTransaction(user.uid, {\n            ...transactionDataForUser,\n            transactionId: createdTransactionId, //   \n            transactionType,\n            fromWallet: selectedWallet,\n            toWallet: transactionType === 'transfer' ? (isDeferredTransfer ? null : 'cash') : null,\n            cashierName: isShiftActive ? (shiftUser?.name || shiftUser?.username || ' ') : ' ',\n            linkedDebtId: linkedDebtId || undefined,\n            description: `${transactionType === 'transfer' ? '' : ''} ${effectiveAmount}  ${selectedWallet} ${transactionType === 'transfer' ? (isDeferredTransfer ? '' : '  ') : ''}  : ${commissionAmount} (${transactionType === 'transfer' ? '' : (isCommissionAddMode ? '' : '')})${extraFee > 0 ? `  : ${extraFee}` : ''}${skipProcess ? '    ( )' : ''}`\n          })] : [])\n        ]);\n\n\n\n        console.log('      Firebase ');\n        \n        //        \n        try {\n          //       \n          const realTransaction = { ...optimisticTransaction, id: createdTransactionId };\n          \n          //   \n          localTransactionsBuffer.current = localTransactionsBuffer.current.map(t => \n             t.id === tempTransactionId ? realTransaction : t\n          );\n          \n          queryClientHook.setQueryData(\n            ['recentTransactions', user?.uid, (shopIdCtx || 'main')],\n            (oldData: any) => {\n               if (!oldData || !Array.isArray(oldData)) return [realTransaction];\n               //         \n               return oldData.map((t: any) => t.id === tempTransactionId ? realTransaction : t);\n            }\n          );\n          \n          //      \n          React.startTransition(() => {\n             setTransactions(prev => prev.map(t => (t as any).id === tempTransactionId ? realTransaction : t));\n          });\n          \n        } catch (e) { console.error('Error updating query cache with real ID:', e); }\n\n        //            \n        setTimeout(() => {\n           try { \n             console.log('    (10 )   ...');\n             \n             // 1.   \n             queryClientHook.invalidateQueries({ queryKey: ['recentTransactions', user?.uid, (shopIdCtx || 'main')] });\n             \n             // 2.     (  +  )\n             queryClientHook.invalidateQueries({ queryKey: ['dashboardData', shopIdCtx || profile?.shopId] });\n             \n             // 3.    \n             if (selectedWallet) {\n                queryClientHook.invalidateQueries({ queryKey: ['walletLimits', selectedWallet] });\n                //           \n                refreshSelectedWalletLimits();\n             }\n           } catch (e) { console.error('Error in delayed refresh:', e); }\n        }, 10000);\n\n        //       \n        const localDataKey = `userData_${user?.uid}`;\n        const localData = {\n          cashBalance: newCashBalance,\n          walletBalances: newWalletBalances,\n          lastUpdated: new Date().toISOString()\n        };\n        localStorage.setItem(localDataKey, JSON.stringify(localData));\n\n      } catch (error) {\n        console.error('      Firebase ( ):', error);\n\n        //      Firebase    \n        //     \n        try {\n          if (user?.uid) {\n            userDataService.saveLocalReceipt(user.uid, {\n              ...transactionDataForUser,\n              transactionType,\n              fromWallet: selectedWallet,\n              toWallet: transactionType === 'transfer' ? (isDeferredTransfer ? null : 'cash') : null,\n              cashierName: isShiftActive ? (shiftUser?.name || shiftUser?.username || ' ') : ' ',\n              linkedDebtId: linkedDebtId || undefined,\n              description: `${transactionType === 'transfer' ? '' : ''} ${effectiveAmount}  ${selectedWallet} ${transactionType === 'transfer' ? (isDeferredTransfer ? '' : '  ') : ''}  : ${commissionAmount} (${transactionType === 'transfer' ? '' : (isCommissionAddMode ? '' : '')})${extraFee > 0 ? `  : ${extraFee}` : ''}${skipProcess ? '    ( )' : ''}`\n            });\n          }\n        } catch { }\n        toast({ title: \"\", description: \"        .     .\", variant: \"destructive\" });\n      }\n    })();\n\n    //       +    \n    if (transactionType === 'transfer') {\n      setIsTransferSuccess(true);\n      //        ( )\n      const amountToReceive = Number(amountNum) + Number(commissionAmount) + Math.max(0, Number(extraFee));\n      setPostConfirmInfo({ type: 'transfer', amount: Math.max(0, Math.round(amountToReceive * 100) / 100) });\n      //      USSD \n      setLastUSSDTransfer({ receiver: receiverPhone, amount: amountNum });\n      //        \n      setSelectedSimSlotForTransfer(null);\n      setIsPostConfirmPopupOpen(true);\n      //      \n      setTimeout(() => {\n        setIsTransferSuccess(false);\n      }, 2000);\n    } else {\n      setIsWithdrawSuccess(true);\n      //      \n      const amountToDeliver = isCommissionAddMode\n        ? Number(amountNum)\n        : Math.max(0, Math.round((Number(amountNum) - Number(commissionAmount)) * 100) / 100);\n      setPostConfirmInfo({ type: 'withdraw', amount: Math.max(0, Math.round(amountToDeliver * 100) / 100) });\n      setIsPostConfirmPopupOpen(true);\n      //      \n      setTimeout(() => {\n        setIsWithdrawSuccess(false);\n      }, 2000);\n    }\n\n    // Clear form\n    setReceiverPhone('');\n    setAmount('');\n    setWithdrawNote('');\n    setWithdrawSenderName('');\n    setQuickDebtInfo(null);\n    setQuickDebtName('');\n    setQuickDebtAmount('');\n    setQuickDebtNotes('');\n    setDidCreateQuickDebt(false);\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'completed':\n        return <CheckCircle className=\"h-2.5 w-2.5 text-green-500\" />;\n      case 'pending':\n        return <Clock className=\"h-2.5 w-2.5 text-yellow-500\" />;\n      case 'failed':\n        return <XCircle className=\"h-2.5 w-2.5 text-red-500\" />;\n      default:\n        return <Clock className=\"h-2.5 w-2.5 text-gray-500\" />;\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case 'completed':\n        return '';\n      case 'pending':\n        return ' ';\n      case 'failed':\n        return '';\n      default:\n        return ' ';\n    }\n  };\n\n  const dateFormatter = React.useMemo(() => new Intl.DateTimeFormat('ar-EG'), []);\n  const timeFormatter = React.useMemo(() => new Intl.DateTimeFormat('ar-EG', { hour: '2-digit', minute: '2-digit' }), []);\n  const totalOutstandingDebts = React.useMemo(() => {\n    try {\n      return debts.reduce((sum, d) => {\n        // 'debtor' type means I owe them (Payable), so exclude from \"Outstanding Debts\" (Receivable)\n        if (d.type === 'debtor') return sum;\n        const paid = Number(d.paidAmount || 0);\n        const outstanding = Math.max(0, Number(d.amount || 0) - paid);\n        return sum + outstanding;\n      }, 0);\n    } catch {\n      return 0;\n    }\n  }, [debts]);\n  const filteredTransactions = React.useMemo(() => {\n    const base = getFilteredTransactions();\n    return base.filter(transaction => {\n      if (activeTab === 'all') return true;\n      if (activeTab === 'send') return transaction.type === 'send';\n      if (activeTab === 'receive') return transaction.type === 'receive';\n      if (activeTab === 'withdraw') return transaction.type === 'withdraw';\n      if (activeTab === 'deleted') return false; //    \n      return true;\n    });\n  }, [getFilteredTransactions, activeTab]);\n\n  //    \n  const restoreTransaction = (transactionId: string) => {\n    const transactionToRestore = deletedTransactions.find(t => t.id === transactionId);\n\n    if (transactionToRestore) {\n      //     \n      const updatedTransactions = [transactionToRestore, ...transactions];\n      setTransactions(updatedTransactions);\n\n      //     \n      const updatedDeletedTransactions = deletedTransactions.filter(t => t.id !== transactionId);\n      setDeletedTransactions(updatedDeletedTransactions);\n      localStorage.setItem(getDeletedTransactionsKey(), JSON.stringify(updatedDeletedTransactions));\n\n      toast({\n        title: \"  \",\n        description: \"      \",\n      });\n    }\n  };\n\n  //    \n  const permanentlyDeleteTransaction = async (transactionId: string) => {\n    //     \n    if (!user?.uid) {\n      toast({\n        title: \"  \",\n        description: \"     \",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      //      \n      const updatedDeletedTransactions = deletedTransactions.filter(t => t.id !== transactionId);\n      setDeletedTransactions(updatedDeletedTransactions);\n      localStorage.setItem(getDeletedTransactionsKey(), JSON.stringify(updatedDeletedTransactions));\n\n      //    Firebase (deletedTransactions + userTransactions + transactions)\n      await auditLogService.permanentlyDeleteTransaction(transactionId, user.uid);\n      await userDataService.removeUserTransaction(user.uid, transactionId);\n\n      toast({\n        title: \"   \",\n        description: \"      \",\n      });\n    } catch (error) {\n      console.error('   :', error);\n      toast({\n        title: \"   \",\n        description: \"     .    \",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  //  \n  const handleResetDaily = () => {\n    setResetType('daily');\n    setIsResetDialogOpen(true);\n  };\n\n  const handleResetMonthly = () => {\n    setResetType('monthly');\n    setIsResetDialogOpen(true);\n  };\n\n  const handleResetSuccess = () => {\n    if (resetType === 'daily') {\n      //    \n      const hiddenIds = reportsService.resetReportsManually('daily', transactions, user?.uid);\n\n      //   \n      setIsResetDialogOpen(false);\n\n      //    \n      toast({\n        title: \"   \",\n        description: `  ${hiddenIds.length}     (  )`,\n      });\n    } else {\n      //    \n      const hiddenIds = reportsService.resetReportsManually('monthly', transactions, user?.uid);\n\n      //   \n      setIsResetDialogOpen(false);\n\n      //    \n      toast({\n        title: \"   \",\n        description: `  ${hiddenIds.length}     (  )`,\n      });\n    }\n  };\n\n  const getResetDialogTitle = () => {\n    return resetType === 'daily' ? '  ' : '  ';\n  };\n\n  const getResetDialogDescription = () => {\n    return resetType === 'daily'\n      ? '       '\n      : '       ';\n  };\n\n  //   \n  const handleEditCashBalance = () => {\n    setIsEditCashDialogOpen(true);\n  };\n\n  const handleEditWalletBalance = (walletId: string) => {\n    setEditingWalletId(walletId);\n    setIsAddToWalletDialogOpen(true);\n  };\n\n  const handleEditCashSuccess = (newBalance: number) => {\n    const previousBalance = cashBalance;\n    const delta = Number(newBalance) - Number(previousBalance);\n    setCashBalance(newBalance);\n    const timestamp = new Date().toISOString();\n    localStorage.setItem(getCashBalanceKey(), newBalance.toString());\n    localStorage.setItem(getCashBalanceKey() + '_lastUpdated', timestamp);\n    setIsEditCashDialogOpen(false);\n\n    const updateData = { cashBalance: newBalance, lastUpdated: timestamp };\n    const localDataKey = `userData_${user?.uid}`;\n    try { localStorage.setItem(localDataKey, JSON.stringify(updateData)); } catch { }\n\n    const ops: Array<Promise<any>> = [];\n    if (user?.uid) {\n      ops.push(userDataService.updateUserData(user.uid, updateData).then(() => { try { localStorage.removeItem(localDataKey); } catch { }; }).catch(() => { }));\n      const receiptRef = `${delta > 0 ? 'CASHADD' : 'CASHDEDUCT'}-${user?.uid || 'anon'}-${Date.now()}`;\n      const txToCloud: any = delta > 0\n        ? { txnType: 'cash_addition', type: 'cash_addition', amount: delta, status: 'confirmed', senderMsisdn: ' ', receiverMsisdn: '', reference: receiptRef, title: '  ', merchantUserId: user.uid, createdBy: user.uid, shopId: (profile as any)?.shopId || undefined }\n        : (delta < 0\n          ? { amount: Math.abs(delta), status: 'completed', title: '    ', merchantUserId: user.uid, createdBy: user.uid, shopId: (profile as any)?.shopId || undefined }\n          : null);\n      if (txToCloud) { ops.push(userDataService.saveUserTransaction(user.uid, txToCloud)); }\n      const shopId = (profile as any)?.shopId;\n      if (shopId) {\n        const dataRef = doc(db, 'dashboardData', shopId);\n        ops.push(updateDoc(dataRef, { cashBalance: newBalance }));\n      }\n    }\n    Promise.allSettled(ops).then(() => { }).catch(() => { });\n\n    toast({\n      title: delta > 0 ? '  ' : (delta < 0 ? '  ' : '   '),\n      description: delta !== 0 ? `: ${Math.abs(delta)}   : ${newBalance} ` : `     ${newBalance} `,\n    });\n  };\n\n  //        \n  const handleEditWalletBalanceSuccess = async (newBalance: number) => {\n    if (!editingWalletId) {\n      console.warn('      ');\n      return;\n    }\n\n    const updatedBalances = {\n      ...walletBalances,\n      [editingWalletId]: newBalance,\n    };\n\n    //   \n    setWalletBalances(updatedBalances);\n\n    //     \n    const timestamp = new Date().toISOString();\n    const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp };\n    const localDataKey = `userData_${user?.uid}`;\n    try {\n      localStorage.setItem(localDataKey, JSON.stringify(updateData));\n      localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n      localStorage.setItem(getWalletBalancesKey() + '_lastUpdated', timestamp);\n      localStorage.setItem(`walletBalances_backup_${timestamp}`, JSON.stringify(updatedBalances));\n    } catch { }\n\n    try {\n      if (user?.uid) {\n        await userDataService.updateUserData(user.uid, updateData);\n      }\n    } catch (e) {\n      console.error('      Firebase:', e);\n    }\n\n    setIsEditWalletDialogOpen(false);\n    const walletName = wallets.find(w => w.id === editingWalletId)?.name || '';\n    toast({\n      title: '   ',\n      description: `   ${walletName}  ${newBalance.toLocaleString()} `,\n    });\n  };\n\n  const handleAddToWalletSuccess = async (addedAmount: number) => {\n    console.log('    ');\n    console.log('   :', editingWalletId);\n    console.log('  /:', addedAmount);\n\n    if (editingWalletId) {\n      const currentBalance = walletBalances[editingWalletId] || 0;\n      console.log('  :', currentBalance);\n\n      const newBalance = currentBalance + addedAmount;\n      console.log('  :', newBalance);\n\n      const updatedBalances = {\n        ...walletBalances,\n        [editingWalletId]: newBalance\n      };\n\n      console.log('  :', updatedBalances);\n\n      //    \n      setWalletBalances(updatedBalances);\n\n      //        \n      const timestamp = new Date().toISOString();\n      const updateData = {\n        walletBalances: updatedBalances,\n        lastUpdated: timestamp\n      };\n\n      //  :   localStorage   \n      const localDataKey = `userData_${user?.uid}`;\n      localStorage.setItem(localDataKey, JSON.stringify(updateData));\n\n      //  :    \n      localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n\n      //  :    \n      localStorage.setItem(`walletBalances_backup_${timestamp}`, JSON.stringify(updatedBalances));\n\n      try {\n\n        //    Firebase\n        if (user?.uid) {\n          console.log('    Firebase...');\n          try {\n            await userDataService.updateUserData(user.uid, updateData);\n            console.log('     Firebase ');\n\n            //          \n            setTimeout(() => {\n              localStorage.removeItem(localDataKey);\n              console.log('        ');\n            }, 60000); //    \n\n          } catch (error) {\n            console.error('      Firebase:', error);\n            //       Firebase\n            setHasLocalDataToSync(true);\n          }\n        } else {\n          //         localStorage  \n          console.log('       localStorage');\n          localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n        }\n\n        const walletName = wallets.find(w => w.id === editingWalletId)?.name || '';\n        const operationType = addedAmount > 0 ? '' : '';\n        const operationAmount = Math.abs(addedAmount);\n\n        toast({\n          title: ` ${operationType}  ${operationType === '' ? '' : ''}  `,\n          description: ` ${operationType} ${operationAmount}  ${operationType === '' ? '' : ''}  ${walletName}.  : ${newBalance.toLocaleString()} `,\n        });\n      } catch (error) {\n        console.error('      Firebase:', error);\n\n        //     Firebase   localStorage  \n        localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n\n        //    \n        if (user?.uid) {\n          const localDataKey = `userData_${user.uid}`;\n          const localData = {\n            walletBalances: updatedBalances,\n            lastUpdated: new Date().toISOString()\n          };\n          localStorage.setItem(localDataKey, JSON.stringify(localData));\n          setHasLocalDataToSync(true);\n        }\n\n        toast({\n          title: \"   \",\n          description: \"        \",\n          variant: \"default\",\n        });\n      }\n    } else {\n      console.log('     ');\n    }\n\n    //     (  5  )\n    setTimeout(() => {\n      const allKeys = Object.keys(localStorage);\n      const backupKeys = allKeys.filter(key => key.startsWith('walletBalances_backup_')).sort();\n\n      if (backupKeys.length > 5) {\n        const keysToDelete = backupKeys.slice(0, backupKeys.length - 5);\n        keysToDelete.forEach(key => {\n          localStorage.removeItem(key);\n          console.log('    :', key);\n        });\n      }\n    }, 5000); //   5 \n\n    setIsAddToWalletDialogOpen(false);\n    setEditingWalletId('');\n  };\n\n  console.log(' UserDashboardPage - Render conditions:', {\n    isCheckingActivation,\n    isUserActive,\n    showActivationModal\n  });\n\n  //   :        (  )\n\n  //           \n  if (isCheckingActivation) {\n    console.log(' UserDashboardPage - Showing loading screen');\n    return <LogoLoader />;\n  }\n\n  console.log(' UserDashboardPage - Rendering main dashboard');\n\n  return (\n    <div className=\"user-dashboard min-h-screen px-2 sm:px-4 py-2 sm:py-4 relative bg-gray-100 bg-[radial-gradient(140%_140%_at_10%_10%,#e5e7eb_0%,#d1d5db_45%,#9ca3af_100%)]\">\n      <GoogleBackupBar userId={user?.uid} />\n      {/*       */}\n      {/*               */}\n\n      <div className=\"max-w-screen-2xl mx-auto grid grid-cols-1 xl:grid-cols-3 gap-4 xl:gap-6 relative z-10\">\n        {/* Statistics and Transactions */}\n        <div className=\"lg:col-span-2 space-y-2 sm:space-y-3\">\n\n          {/* Detailed Reports Section */}\n          <div className=\"grid grid-cols-2 gap-2 sm:grid-cols-2 sm:gap-3 fade-in-up\">\n            {/*           */}\n            {/*   */}\n            {!areReportsCollapsed && (\n              <Card className=\"bg-gray-100 border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 relative overflow-hidden\">\n                <CardHeader className=\"pb-2 px-3 pt-3 relative z-10\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-xs font-bold text-gray-900 flex items-center gap-1.5\">\n                      <div className=\"p-1 rounded-md bg-gradient-to-br from-gray-100 to-gray-200\">\n                        <CalendarDays className=\"h-3.5 w-3.5 text-gray-700\" />\n                      </div>\n                      <span className=\"text-xs\"></span>\n                    </CardTitle>\n                    <div className=\"flex items-center gap-1\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => {\n                          setResetType('monthly');\n                          setIsResetDialogOpen(true);\n                        }}\n                        className=\"h-7 w-7 p-0 bg-transparent hover:bg-red-50 text-red-600 hover:text-red-700 rounded-full transition-colors duration-200\"\n                        title=\"  \"\n                      >\n                        <Trash2 className=\"h-3 w-3\" />\n                      </Button>\n                      <div className=\"p-1 bg-green-50 rounded-full border border-green-100\">\n                        <ArrowUpDown className=\"h-3 w-3 text-green-600\" />\n                      </div>\n                    </div>\n                  </div>\n                </CardHeader>\n                {!areReportsCollapsed && (\n                  <CardContent className=\"pt-0 px-2 pb-2\">\n                    <div className=\"grid grid-cols-2 gap-0 rounded-lg overflow-hidden border border-gray-200 divide-x divide-y divide-gray-200 bg-white\">\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-blue-600\"> </span>\n                        <span className=\"text-sm sm:text-lg font-bold text-blue-800 mt-0.5 sm:mt-0\">{calculateMonthlyStats().totalTransactions}</span>\n                      </div>\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-gray-600\"> </span>\n                        <span className=\"text-sm sm:text-lg font-bold text-gray-900 mt-0.5 sm:mt-0\">{calculateMonthlyStats().totalAmount.toFixed(2)}</span>\n                      </div>\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-red-600\"></span>\n                        <span className=\"text-sm sm:text-lg font-bold text-red-800 mt-0.5 sm:mt-0\">{calculateMonthlyStats().totalWithdrawn.toFixed(2)}</span>\n                      </div>\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-green-600\"></span>\n                        <span className=\"text-sm sm:text-lg font-bold text-green-800 mt-0.5 sm:mt-0\">{calculateMonthlyStats().totalSent.toFixed(2)}</span>\n                      </div>\n                    </div>\n                    <div className=\"mt-2 rounded-lg border border-gray-100 bg-white px-2 py-1.5 flex items-center justify-between\">\n                      <span className=\"text-[12px] font-bold text-yellow-600\"></span>\n                      <MonthlyProfitEyeButton userId={user?.uid} transactions={transactions} />\n                    </div>\n                  </CardContent>\n                )}\n                {isMonthlyLocked && (\n                  <div className=\"absolute inset-0 z-20 backdrop-blur-sm bg-amber-50/60 flex items-center justify-center p-0 pointer-events-auto\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={async () => {\n                        if (isZeroPlan) {\n                          toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n                          return;\n                        }\n                        setIsMonthlyPinDialogOpen(true);\n                      }}\n                      className=\"px-4 py-2 rounded-full bg-white border border-gray-100 text-gray-900 shadow-sm hover:bg-gray-50 hover:shadow-md transition-all duration-200 flex items-center gap-2 text-xs font-medium\"\n                      title=\"   (  )\"\n                    >\n                      <span>  </span>\n                      <Eye className=\"h-3.5 w-3.5 text-gray-600\" />\n                    </Button>\n                  </div>\n                )}\n              </Card>\n            )}\n\n            {/*       */}\n            <MasterPinDialog\n              open={isMonthlyPinDialogOpen}\n              onOpenChange={setIsMonthlyPinDialogOpen}\n              mode=\"verify\"\n              title=\"    \"\n              description=\"          \"\n              onSuccess={() => {\n                if (isZeroPlan) {\n                  toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n                  setIsMonthlyPinDialogOpen(false);\n                  setIsMonthlyLocked(true);\n                  return;\n                }\n                setIsMonthlyLocked(false);\n                setIsMonthlyPinDialogOpen(false);\n              }}\n              userId={user?.uid}\n            />\n\n            {/*   */}\n            {userSubscription?.planType !== SubscriptionPlan.TAHWEELA && (\n              <Card className=\"bg-gray-50 border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 relative overflow-hidden\">\n                <CardHeader className=\"pb-2 px-3 pt-3 relative z-10\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-sm font-bold text-gray-900 flex items-center gap-2\">\n                      <div className=\"p-1 rounded-md bg-gradient-to-br from-gray-100 to-gray-200\">\n                        <CalendarDays className=\"h-4 w-4 text-gray-700\" />\n                      </div>\n                      <span className=\"text-sm\"></span>\n                    </CardTitle>\n                    <div className=\"flex items-center gap-1.5\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => {\n                          setResetType('daily');\n                          setIsResetDialogOpen(true);\n                        }}\n                        className=\"h-8 w-8 p-0 bg-transparent hover:bg-red-50 text-red-600 hover:text-red-700 rounded-full transition-colors duration-200\"\n                        title=\"  \"\n                      >\n                        <Trash2 className=\"h-3.5 w-3.5\" />\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => setAreReportsCollapsed(prev => !prev)}\n                        className=\"h-8 w-8 p-0 bg-transparent hover:bg-gray-100 text-gray-600 hover:text-blue-600 rounded-full transition-colors duration-200\"\n                        title={areReportsCollapsed ? '  ' : '  '}\n                      >\n                        {areReportsCollapsed ? (\n                          <ChevronDown className=\"h-3.5 w-3.5\" />\n                        ) : (\n                          <ChevronUp className=\"h-3.5 w-3.5\" />\n                        )}\n                      </Button>\n                      <div className=\"p-2 bg-green-50 rounded-full border border-green-100\">\n                        <ArrowUpDown className=\"h-3.5 w-3.5 text-green-600\" />\n                      </div>\n                    </div>\n                  </div>\n                </CardHeader>\n                {!areReportsCollapsed && (\n                  <CardContent className=\"pt-0 px-2 pb-2\">\n                    <div className=\"grid grid-cols-2 gap-0 rounded-lg overflow-hidden border border-gray-200 divide-x divide-y divide-gray-200 bg-white\">\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-blue-600\"> </span>\n                        <span className=\"text-sm sm:text-lg font-bold text-blue-800 mt-0.5 sm:mt-0\">{calculateDailyStats().totalTransactions}</span>\n                      </div>\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-gray-600\"> </span>\n                        <span className=\"text-sm sm:text-lg font-bold text-gray-900 mt-0.5 sm:mt-0\">{calculateDailyStats().totalAmount.toFixed(2)}</span>\n                      </div>\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-red-600\"></span>\n                        <span className=\"text-sm sm:text-lg font-bold text-red-800 mt-0.5 sm:mt-0\">{calculateDailyStats().totalWithdrawn.toFixed(2)}</span>\n                      </div>\n                      <div className=\"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 transition-colors\">\n                        <span className=\"text-[12px] font-bold text-green-600\"></span>\n                        <span className=\"text-sm sm:text-lg font-bold text-green-800 mt-0.5 sm:mt-0\">{calculateDailyStats().totalSent.toFixed(2)}</span>\n                      </div>\n                    </div>\n                    <div className=\"mt-2 rounded-lg border border-gray-100 bg-white px-2 py-1.5 flex items-center justify-between\">\n                      <span className=\"text-[12px] font-bold text-yellow-600\"></span>\n                      <DailyProfitEyeButton userId={user?.uid} transactions={transactions} />\n                    </div>\n                  </CardContent>\n                )}\n                {isDailyLocked && (\n                  <div className=\"absolute inset-0 z-20 backdrop-blur-sm bg-white/60 flex items-center justify-center p-0 pointer-events-auto\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={() => setIsDailyPinDialogOpen(true)}\n                      className=\"px-4 py-2 rounded-full bg-white border border-gray-100 text-gray-900 shadow-sm hover:bg-gray-50 hover:shadow-md transition-all duration-200 flex items-center gap-2 text-xs font-medium\"\n                      title=\"   (  )\"\n                    >\n                      <span>  </span>\n                      <Eye className=\"h-3.5 w-3.5 text-gray-600\" />\n                    </Button>\n                  </div>\n                )}\n              </Card>\n            )}\n            {/*           */}\n            {/*       */}\n            <MasterPinDialog\n              open={isDailyPinDialogOpen}\n              onOpenChange={setIsDailyPinDialogOpen}\n              mode=\"verify\"\n              title=\"    \"\n              description=\"          \"\n              onSuccess={() => {\n                setIsDailyLocked(false);\n                setIsDailyPinDialogOpen(false);\n              }}\n              userId={user?.uid}\n            />\n          </div>\n\n          {/* Balance Bar */}\n          <Card className=\"balance-bar bg-gray-200 border-2 border-gray-200/50 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 group relative overflow-hidden   transform fade-in-up mb-6\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-emerald-500/5 via-blue-500/5 to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"></div>\n            <div className=\"absolute top-0 left-0 w-40 h-40 bg-gradient-to-br from-emerald-300/10 to-transparent rounded-full -translate-y-20 -translate-x-20 group-hover:scale-150 transition-transform duration-200\"></div>\n            <div className=\"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-blue-300/10 to-transparent rounded-full translate-y-20 translate-x-20 group-hover:scale-150 transition-transform duration-200\"></div>\n            <CardContent className=\"p-2 relative z-10\">\n              <div className=\"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-2\">\n                <div className=\"bg-white border border-gray-200 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/cash relative overflow-hidden\">\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-emerald-500/10 to-transparent opacity-0 group-hover/cash:opacity-100 transition-opacity duration-300\"></div>\n                  <div className=\"flex flex-col relative z-10 w-full\">\n                    <div className=\"flex items-center justify-between w-full\">\n                      <div className=\"flex items-center gap-0.5\">\n                        <div className=\"p-0.5 bg-gradient-to-r from-emerald-100 to-emerald-200 rounded-lg shadow-sm\">\n                          <DollarSign className=\"h-1.5 w-1.5 text-emerald-600\" />\n                        </div>\n                        <span className=\"text-[11px] font-extrabold text-emerald-800\"> </span>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-green-600 hover:bg-green-50 transition-colors\"\n                          onClick={() => setIsAddCashDialogOpen(true)}\n                        >\n                          <Plus className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-emerald-600 hover:bg-emerald-50 transition-colors\"\n                          onClick={() => setIsCashSummaryOpen(true)}\n                          title=\"  \"\n                        >\n                          <Banknote className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-red-600 hover:bg-red-50 transition-colors\"\n                          onClick={() => setIsResetCashDialogOpen(true)}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                    <div className=\"mt-0.5\">\n                      <span className=\"text-[14px] sm:text-xl font-bold text-emerald-800 bg-gradient-to-r from-emerald-100 to-emerald-200 px-1 py-0.5 rounded-lg shadow-sm block w-fit\">\n                        {cashBalance.toLocaleString('en-US')} \n                      </span>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"bg-white border border-gray-200 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/wallet relative overflow-hidden\">\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/10 to-transparent opacity-0 group-hover/wallet:opacity-100 transition-opacity duration-300\"></div>\n                  <div className=\"flex flex-col relative z-10 w-full\">\n                    <div className=\"flex items-center justify-between w-full\">\n                      <div className=\"flex items-center gap-0.5\">\n                        <div className=\"p-0.5 bg-gradient-to-r from-blue-100 to-blue-200 rounded-lg shadow-sm\">\n                          <Wallet className=\"h-1.5 w-1.5 text-blue-600\" />\n                        </div>\n                        <span className=\"text-[11px] font-extrabold text-blue-800\">  </span>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-green-600 hover:bg-green-50 transition-colors\"\n                          onClick={() => setIsAddWalletTotalDialogOpen(true)}\n                          title=\"   \"\n                        >\n                          <Plus className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-blue-600 hover:bg-blue-50 transition-colors\"\n                          onClick={() => setIsWalletsListOpen(true)}\n                          title=\" \"\n                        >\n                          <Wallet className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-red-600 hover:bg-red-50 transition-colors\"\n                          onClick={() => {\n                            setIsResetWalletTotalDialogOpen(true);\n                            setResetWalletTotalPinInput('');\n                          }}\n                          title=\"  \"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                    <div className=\"mt-0.5\">\n                      <span className=\"text-[14px] sm:text-xl font-bold text-blue-800 bg-gradient-to-r from-blue-100 to-blue-200 px-1 py-0.5 rounded-lg shadow-sm block w-fit\">\n                        {Object.values(walletBalances).reduce((sum, balance) => sum + balance, 0).toLocaleString('en-US')} \n                      </span>\n                    </div>\n                  </div>\n                </div>\n                {/*     */}\n                <div className=\"col-span-2 sm:col-span-1 bg-white border border-gray-200 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/selwallet relative overflow-hidden\">\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-transparent opacity-0 group-hover/selwallet:opacity-100 transition-opacity duration-300\"></div>\n                  <div className=\"flex flex-col relative z-10 w-full\">\n                    <div className=\"flex items-center justify-between w-full\">\n                      <div className=\"flex items-center gap-0.5\">\n                        <div className=\"p-0.5 bg-gradient-to-r from-indigo-100 to-indigo-200 rounded-lg shadow-sm\">\n                          <Wallet className=\"h-1.5 w-1.5 text-indigo-600\" />\n                        </div>\n                        <span className=\"text-[11px] font-extrabold text-indigo-800\"> </span>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-green-600 hover:bg-green-50 transition-colors\"\n                          onClick={() => {\n                            if (!selectedWallet) {\n                              toast({\n                                title: ' ',\n                                description: '       ',\n                                variant: 'destructive',\n                              });\n                              return;\n                            }\n                            handleEditWalletBalance(selectedWallet);\n                          }}\n                          title=\"/    \"\n                        >\n                          <Plus className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-7 w-7 p-0 rounded-full text-red-600 hover:bg-red-50 transition-colors\"\n                          onClick={() => {\n                            if (!selectedWallet) {\n                              toast({\n                                title: ' ',\n                                description: '     ',\n                                variant: 'destructive',\n                              });\n                              return;\n                            }\n                            //        \n                            setIsResetSelectedWalletDialogOpen(true);\n                          }}\n                          title=\"   \"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                    <div className=\"mt-0.5\">\n                      <span className=\"text-[14px] sm:text-xl font-bold text-indigo-800 bg-gradient-to-r from-indigo-100 to-indigo-200 px-1 py-0.5 rounded-lg shadow-sm block w-fit\">\n                        {(selectedWallet ? (walletBalances[selectedWallet] || 0) : 0).toLocaleString('en-US')} \n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Recent Transactions Section */}\n          <Card className=\"bg-gray-100 border border-gray-200 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 group relative overflow-hidden fade-in-up\">\n            <CardHeader className={`pb-2 px-4 pt-4 relative z-10 ${isMobile ? 'sticky top-0 z-20 bg-white/90 backdrop-blur supports-[backdrop-filter]:bg-white/60' : ''}`}>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-sm font-bold flex items-center gap-2 text-gray-900\">\n                  {!isMobile && (\n                    <div className=\"p-1.5 sm:p-2 bg-gray-100 rounded-lg\">\n                      <ArrowUpDown className=\"h-3 w-3 sm:h-3.5 sm:w-3.5 text-gray-700\" />\n                    </div>\n                  )}\n                  <span className=\"text-gray-900\">\n                     \n                  </span>\n                </CardTitle>\n                {/*       */}\n                <div className=\"flex items-center gap-2\">\n                  {/*    */}\n                  {!isMobile && (\n                    <div className=\"flex items-center gap-0.5 bg-gray-100 rounded px-1 py-0.5 border border-gray-200 hover:border-blue-300 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]\">\n                      <Search className=\"h-2 w-2 text-gray-400 group-hover:text-blue-600 transition-colors\" />\n                      <Input\n                        placeholder=\"...\"\n                        value={searchPhone}\n                        onChange={(e) => setSearchPhone(e.target.value)}\n                        className=\"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 placeholder:text-gray-400\"\n                      />\n                    </div>\n                  )}\n                  {/*     (    ) */}\n                  {!isMobile && (\n                    <div className=\"flex items-center gap-2\">\n                      {/*  -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({ title: ' ', description: '      .', variant: 'destructive' });\n                              return;\n                            }\n                            setIsInstallmentPinOpen(true);\n                          }}\n                          title=\" \"\n                        >\n                          <BadgePercent className=\"h-5 w-5 text-purple-600\" />\n                        </Button>\n                      </div>\n                      {/*   -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-green-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-green-100 text-green-600 hover:bg-green-200 border border-green-200 ring-3 ring-green-300 transition-all duration-200 hover:scale-105 active:bg-green-600 active:text-white active:border-green-600\"\n                          onClick={() => {\n                            toast({ title: ' ', description: '    .' });\n                          }}\n                          title=\" \"\n                        >\n                          <CreditCard className=\"h-5 w-5 text-green-600\" />\n                        </Button>\n                      </div>\n                      {/*   -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\n                          onClick={() => setIsCalculatorOpen(true)}\n                          title=\" \"\n                        >\n                          <Calculator className=\"h-5 w-5 text-purple-600\" />\n                        </Button>\n                      </div>\n                      {/*   -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({\n                                title: ' ',\n                                description: '      .',\n                                variant: 'destructive'\n                              });\n                            } else {\n                              setIsCreditCardsOpen(true);\n                            }\n                          }}\n                          title=\" \"\n                        >\n                          <CreditCard className=\"h-5 w-5 text-purple-600\" />\n                        </Button>\n                      </div>\n                      {/*  -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-blue-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({ title: ' ', description: '      .', variant: 'destructive' });\n                              return;\n                            }\n                            setIsReportsPinOpen(true);\n                          }}\n                          title=\"\"\n                        >\n                          <Notebook className=\"h-5 w-5 text-blue-600\" />\n                        </Button>\n                      </div>\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-sky-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-sky-100 text-sky-600 hover:bg-sky-200 border border-sky-200 ring-3 ring-sky-300 transition-all duration-200 hover:scale-105 active:bg-sky-600 active:text-white active:border-sky-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({ title: ' ', description: '      .', variant: 'destructive' });\n                            } else {\n                              if (MasterPinService.hasMasterPin()) {\n                                setIsTelegramReportPinOpen(true);\n                              } else {\n                                handleSendTelegramDailyReport();\n                              }\n                            }\n                          }}\n                          title=\"    \"\n                        >\n                          <Send className=\"h-5 w-5 text-sky-600\" />\n                        </Button>\n                      </div>\n                      {/*   /   -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-blue-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600\"\n                          onClick={handleOpenShiftProfile}\n                          title={isShiftActive && (shiftUser?.name || shiftUser?.username) ? ` : ${shiftUser?.name || shiftUser?.username}` : ' '}\n                        >\n                          <User className=\"h-5 w-5 text-blue-600\" />\n                        </Button>\n                      </div>\n                      {/*   -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({\n                                title: ' ',\n                                description: '      .',\n                                variant: 'destructive'\n                              });\n                            } else {\n                              setIsSalesDataOpen(true);\n                            }\n                          }}\n                          title=\" \"\n                        >\n                          <BarChart className=\"h-5 w-5 text-purple-600\" />\n                        </Button>\n                      </div>\n\n                      {/*  -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <span className=\"text-[10px] font-semibold text-purple-600\"></span>\n                          {debts.filter(d => d.status === 'pending').length > 0 && (\n                            <span className=\"h-4 w-4 rounded-full bg-red-600 text-white text-[10px] flex items-center justify-center ring-2 ring-white\">\n                              {debts.filter(d => d.status === 'pending').length}\n                            </span>\n                          )}\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600\"\n                          onClick={() => { openDebts(); }}\n                          title=\"\"\n                        >\n                          <FileText className=\"h-5 w-5 text-purple-600\" />\n                        </Button>\n                      </div>\n                      {/*  -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-amber-700 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-amber-100 text-amber-700 hover:bg-amber-200 border border-amber-200 ring-3 ring-amber-300 transition-all duration-200 hover:scale-105 active:bg-amber-600 active:text-white active:border-amber-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({\n                                title: ' ',\n                                description: '      .',\n                                variant: 'destructive'\n                              });\n                            } else {\n                              setIsMaintenanceOpen(true);\n                            }\n                          }}\n                          title=\"\"\n                        >\n                          <Wrench className=\"h-5 w-5 text-amber-700\" />\n                        </Button>\n                      </div>\n                      {/*   -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-yellow-500 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-violet-100 text-violet-700 hover:bg-violet-200 border border-violet-200 ring-3 ring-violet-300 transition-all duration-200 hover:scale-105 active:bg-violet-700 active:text-white active:border-violet-700\"\n                          onClick={() => {\n                            if (!isShiftHandoverAllowed || isTahweelaPlan) {\n                              toast({\n                                title: ' ',\n                                description: '      .',\n                                variant: 'destructive'\n                              });\n                            } else {\n                              setIsMachineDailyDialogOpen(true);\n                            }\n                          }}\n                          title=\" \"\n                        >\n                          <FawryMachineIcon className=\"h-5 w-5 text-yellow-500\" />\n                        </Button>\n                      </div>\n                      {/*   -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-orange-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-orange-100 text-orange-600 hover:bg-orange-200 border border-orange-200 ring-3 ring-orange-300 transition-all duration-200 hover:scale-105 active:bg-orange-600 active:text-white active:border-orange-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({\n                                title: ' ',\n                                description: '      .',\n                                variant: 'destructive'\n                              });\n                            } else {\n                              if (MasterPinService.hasMasterPin()) {\n                                setIsShopExpensesPinDialogOpen(true);\n                              } else {\n                                setIsShopExpensesDialogOpen(true);\n                              }\n                            }\n                          }}\n                          title=\" \"\n                        >\n                          <Receipt className=\"h-5 w-5 text-orange-600\" />\n                        </Button>\n                      </div>\n\n                      {/*  -    */}\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-[10px] font-semibold text-rose-600 mb-1\"></span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-10 w-10 p-0 rounded-full bg-rose-100 text-rose-600 hover:bg-rose-200 border border-rose-200 ring-3 ring-rose-300 transition-all duration-200 hover:scale-105 active:bg-rose-600 active:text-white active:border-rose-600\"\n                          onClick={() => {\n                            if (isZeroPlan || isTahweelaPlan) {\n                              toast({\n                                title: ' ',\n                                description: '      .',\n                                variant: 'destructive'\n                              });\n                            } else {\n                              setIsDeficienciesDialogOpen(true);\n                            }\n                          }}\n                          title=\"\"\n                        >\n                          <AlertTriangle className=\"h-5 w-5 text-rose-600\" />\n                        </Button>\n                      </div>\n\n                    </div>\n                  )}\n                </div>\n\n              </div>\n\n              {/*         */}\n              {/*    :  /  /  */}\n              {!isMobile && (\n                <div className=\"mt-2 w-full\">\n                  <div className=\"filters-bar flex items-center justify-center gap-3 bg-gray-100 rounded-md p-3 border border-gray-200\">\n                    <Button\n                      variant={'ghost'}\n                      size=\"sm\"\n                      className={`btn-filter-send h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${activeTab === 'send' ? 'bg-green-600 text-white border-green-600' : 'text-green-700 border-green-300 hover:bg-green-100'}`}\n                      onClick={() => setActiveTab('send')}\n                      title=\" \"\n                    >\n                      \n                    </Button>\n                    <Button\n                      variant={'ghost'}\n                      size=\"sm\"\n                      className={`btn-filter-withdraw h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${activeTab === 'withdraw' ? 'bg-red-600 text-white border-red-600' : 'text-red-700 border-red-300 hover:bg-red-100'}`}\n                      onClick={() => setActiveTab('withdraw')}\n                      title=\" \"\n                    >\n                      \n                    </Button>\n                    <Button\n                      variant={'ghost'}\n                      size=\"sm\"\n                      className={`btn-filter-all h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${activeTab === 'all' ? 'bg-green-600 text-white border-green-600' : 'text-green-700 border-green-300 hover:bg-green-100'}`}\n                      onClick={() => setActiveTab('all')}\n                      title=\" \"\n                    >\n                      \n                    </Button>\n\n                    {/*       */}\n                    <div className=\"relative ml-1\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-auto px-2 py-1 text-xs text-red-600 hover:bg-red-50 rounded-md font-medium\"\n                        onClick={() => setIsResetRecentDialogOpen(true)}\n                        title=\"  \"\n                      >\n                        <Trash2 className=\"h-3 w-3 mr-1\" />\n                        \n                      </Button>\n                      {hiddenCount > 0 && (\n                        <span className=\"absolute -top-0.5 -right-0.5 h-2 w-2 rounded-full bg-red-500 ring-2 ring-white\" />\n                      )}\n                    </div>\n                  </div>\n                </div>\n              )}\n            </CardHeader>\n            {/*       */}\n            <MasterPinDialog\n              open={isInstallmentPinOpen}\n              onOpenChange={setIsInstallmentPinOpen}\n              mode=\"verify\"\n              title=\"  \"\n              description=\"       \"\n              onSuccess={() => {\n                setIsInstallmentPinOpen(false);\n                setIsInstallmentModalOpen(true);\n              }}\n            />\n            <InstallmentModal\n              open={isInstallmentModalOpen}\n              onOpenChange={setIsInstallmentModalOpen}\n            />\n            <MasterPinDialog\n              open={isTelegramReportPinOpen}\n              onOpenChange={setIsTelegramReportPinOpen}\n              mode=\"verify\"\n              title=\"    \"\n              description=\"        \"\n              onSuccess={() => {\n                setIsTelegramReportPinOpen(false);\n                handleSendTelegramDailyReport();\n              }}\n            />\n            {/*          */}\n            {showDesktopQuickIcons && (\n              <div className=\"px-4 mt-4 mb-1 flex flex-wrap items-center justify-center gap-3\">\n                {/*   -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-green-600 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-green-100 text-green-600 hover:bg-green-200 border border-green-200 ring-3 ring-green-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'charge' ? ' bg-green-600 text-white border-green-600' : ''}`}\n                    onClick={() => {\n                      toast({ title: ' ', description: '    .' });\n                      setSelectedQuickIcon('charge');\n                    }}\n                    title=\" \"\n                  >\n                    <CreditCard className=\"h-5 w-5 text-green-600\" />\n                  </Button>\n                </div>\n                {/*   -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'calculator' ? ' bg-purple-600 text-white border-purple-600' : ''}`}\n                    onClick={() => setIsCalculatorOpen(true)}\n                    title=\" \"\n                  >\n                    <Calculator className=\"h-5 w-5 text-purple-600\" />\n                  </Button>\n                </div>\n                {/*   -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'creditcards' ? ' bg-purple-600 text-white border-purple-600' : ''}`}\n                    onClick={() => {\n                      if (isZeroPlan) {\n                        toast({\n                          title: ' ',\n                          description: '      .  .',\n                          variant: 'destructive'\n                        });\n                      } else {\n                        setIsCreditCardsOpen(true);\n                        setSelectedQuickIcon('creditcards');\n                      }\n                    }}\n                    title=\" \"\n                  >\n                    <CreditCard className=\"h-5 w-5 text-purple-600\" />\n                  </Button>\n                </div>\n                {/*   /   -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-blue-600 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'shift' ? ' bg-blue-600 text-white border-blue-600' : ''}`}\n                    onClick={handleOpenShiftProfile}\n                    title={isShiftActive && (shiftUser?.name || shiftUser?.username) ? ` : ${shiftUser?.name || shiftUser?.username}` : ' '}\n                  >\n                    <User className=\"h-5 w-5 text-blue-600\" />\n                  </Button>\n                </div>\n                {/*   -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-purple-600 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'sales' ? ' bg-purple-600 text-white border-purple-600' : ''}`}\n                    onClick={() => {\n                      if (isZeroPlan) {\n                        toast({\n                          title: ' ',\n                          description: '      .  .',\n                          variant: 'destructive'\n                        });\n                      } else {\n                        setIsSalesDataOpen(true);\n                        setSelectedQuickIcon('sales');\n                      }\n                    }}\n                    title=\" \"\n                  >\n                    <BarChart className=\"h-5 w-5 text-purple-600\" />\n                  </Button>\n                </div>\n                {/*  -    */}\n                <div className=\"flex flex-col items-center\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <span className=\"text-[10px] font-semibold text-purple-600\"></span>\n                    {debts.filter(d => d.status === 'pending').length > 0 && (\n                      <span className=\"h-4 w-4 rounded-full bg-red-600 text-white text-[10px] flex items-center justify-center ring-2 ring-white\">\n                        {debts.filter(d => d.status === 'pending').length}\n                      </span>\n                    )}\n                  </div>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'debts' ? ' bg-purple-600 text-white border-purple-600' : ''}`}\n                    onClick={() => { openDebts(); }}\n                    title=\"\"\n                  >\n                    <FileText className=\"h-5 w-5 text-purple-600\" />\n                  </Button>\n                </div>\n                {/*  -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-amber-700 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-amber-100 text-amber-700 hover:bg-amber-200 border border-amber-200 ring-3 ring-amber-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'maintenance' ? ' bg-amber-600 text-white border-amber-600' : ''}`}\n                    onClick={() => {\n                      if (isZeroPlan) {\n                        toast({\n                          title: ' ',\n                          description: '     .  .',\n                          variant: 'destructive'\n                        });\n                      } else {\n                        setIsMaintenanceOpen(true);\n                        setSelectedQuickIcon('maintenance');\n                      }\n                    }}\n                    title=\"\"\n                  >\n                    <Wrench className=\"h-5 w-5 text-amber-700\" />\n                  </Button>\n                </div>\n                {/*   -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-yellow-500 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-violet-100 text-violet-700 hover:bg-violet-200 border border-violet-200 ring-3 ring-violet-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'machine' ? ' bg-violet-700 text-white border-violet-700' : ''}`}\n                    onClick={() => {\n                      if (!isShiftHandoverAllowed) {\n                        toast({\n                          title: ' ',\n                          description: '   :      .',\n                          variant: 'destructive'\n                        });\n                      } else {\n                        setIsMachineDailyDialogOpen(true);\n                        setSelectedQuickIcon('machine');\n                      }\n                    }}\n                    title=\" \"\n                  >\n                    <FawryMachineIcon className=\"h-5 w-5 text-yellow-500\" />\n                  </Button>\n                </div>\n                {/*   -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-orange-600 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-orange-100 text-orange-600 hover:bg-orange-200 border border-orange-200 ring-3 ring-orange-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'expenses' ? ' bg-orange-600 text-white border-orange-600' : ''}`}\n                    onClick={() => {\n                      if (isZeroPlan) {\n                        toast({\n                          title: ' ',\n                          description: '      .  .',\n                          variant: 'destructive'\n                        });\n                      } else {\n                        if (MasterPinService.hasMasterPin()) {\n                          setIsShopExpensesPinDialogOpen(true);\n                        } else {\n                          setIsShopExpensesDialogOpen(true);\n                        }\n                        setSelectedQuickIcon('expenses');\n                      }\n                    }}\n                    title=\" \"\n                  >\n                    <Receipt className=\"h-5 w-5 text-orange-600\" />\n                  </Button>\n                </div>\n                {/*  -    */}\n                <div className=\"flex flex-col items-center\">\n                  <span className=\"text-[10px] font-semibold text-rose-600 mb-1\"></span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={`h-10 w-10 p-0 rounded-full bg-rose-100 text-rose-600 hover:bg-rose-200 border border-rose-200 ring-3 ring-rose-300 transition-all duration-200 hover:scale-105${selectedQuickIcon === 'deficiencies' ? ' bg-rose-600 text-white border-rose-600' : ''}`}\n                    onClick={() => {\n                      if (isZeroPlan) {\n                        toast({\n                          title: ' ',\n                          description: '     .  .',\n                          variant: 'destructive'\n                        });\n                      } else {\n                        setIsDeficienciesDialogOpen(true);\n                        setSelectedQuickIcon('deficiencies');\n                      }\n                    }}\n                    title=\"\"\n                  >\n                    <AlertTriangle className=\"h-5 w-5 text-rose-600\" />\n                  </Button>\n                </div>\n              </div>\n            )}\n            <CardContent className=\"space-y-2 pt-0 px-4 pb-4 relative z-10\">\n              {filteredTransactions.length === 0 ? (\n                <div className=\"text-center py-8 text-gray-500\">\n                  <ArrowUpDown className=\"h-12 w-12 mx-auto mb-2 text-gray-300\" />\n                  <p className=\"text-sm\">    </p>\n                </div>\n              ) : (\n                isMobile ? (\n                  <div className={`overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors max-h-[310px]`}>\n                    <div className=\"space-y-2 pr-2\">\n                      {filteredTransactions.map((transaction) => (\n                        <div\n                          key={transaction.id}\n                          className=\"relative flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer\"\n                          onClick={() => handleTransactionClick(transaction)}\n                        >\n                          {/* Icon Column */}\n                          <div className={`h-10 w-10 rounded-full flex items-center justify-center shrink-0 ${\n                             transaction.type === 'withdraw' ? 'bg-red-100' : 'bg-green-100'\n                          }`}>\n                             {(() => {\n                               const t: any = transaction as any;\n                               const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\n                               const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.type || '').toLowerCase() === 'add') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\n                               \n                               if (isShiftReceipt) return <Receipt className=\"h-5 w-5 text-gray-600\" />;\n                               if (isCashAddReceipt) return <Plus className=\"h-5 w-5 text-green-600\" />;\n                               return transaction.type === 'withdraw' ? (\n                                  <ArrowDownLeft className=\"h-5 w-5 text-red-600\" />\n                               ) : (\n                                  <ArrowUpRight className=\"h-5 w-5 text-green-600\" />\n                               );\n                             })()}\n                          </div>\n\n                          {/* Content Column */}\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center justify-between mb-1\">\n                              <h4 className=\"text-base font-bold truncate\">\n                                {(() => {\n                                   const t: any = transaction as any;\n                                   const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\n                                   const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.type || '').toLowerCase() === 'add') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\n                                   \n                                   if (isShiftReceipt) return <span className=\"text-foreground\"> </span>;\n                                   if (isCashAddReceipt) return <span className=\"text-foreground\"> </span>;\n                                   return transaction.type === 'send' ? <span className=\"text-green-600\"> </span> : <span className=\"text-red-600\"> </span>;\n                                })()}\n                              </h4>\n                              <span className={`text-base font-bold whitespace-nowrap ${\n                                 transaction.type === 'withdraw' ? 'text-red-600' : 'text-green-600'\n                              }`}>\n                                {(transaction.type === 'withdraw' || transaction.type === 'cash_addition' || (transaction as any).txnType === 'cash_addition') ? '+' : '-'} {formatNumberEnglish(transaction.amount)} .\n                              </span>\n                            </div>\n\n                            <div className=\"flex items-center justify-between\">\n                               <div className=\"flex flex-col gap-0.5\">\n                                  <p className=\"text-sm text-muted-foreground truncate\">\n                                     {(() => {\n                                         const t: any = transaction as any;\n                                         const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\n                                         const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.type || '').toLowerCase() === 'add') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\n                                         const noteText = (t?.note || t?.notes || '');\n                                         \n                                         if (isShiftReceipt) return `: ${transaction.receiverPhone}`;\n                                         if (isCashAddReceipt) return noteText || ' ';\n                                         \n                                         return transaction.type === 'send' ? (\n                                            <span dir=\"ltr\">{transaction.receiverPhone}</span>\n                                         ) : (\n                                            <span dir=\"ltr\">{transaction.senderPhone}</span>\n                                         );\n                                     })()}\n                                  </p>\n                                  <p className=\"text-sm font-medium text-gray-500 mt-0.5\">\n                                     {dateFormatter.format(transaction.createdAt instanceof Date ? transaction.createdAt : new Date(transaction.createdAt))} - {timeFormatter.format(transaction.createdAt instanceof Date ? transaction.createdAt : new Date(transaction.createdAt))}\n                                  </p>\n                               </div>\n\n                               <div className={`px-2 py-0.5 rounded-full text-[10px] font-medium flex items-center gap-1 ${\n                                  transaction.status === 'completed' \n                                    ? (transaction.type === 'withdraw' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700')\n                                    : transaction.status === 'pending'\n                                    ? 'bg-yellow-100 text-yellow-700'\n                                    : 'bg-red-100 text-red-700'\n                               }`}>\n                                  {transaction.status === 'completed' && <Check className=\"h-3 w-3\" />}\n                                  {transaction.status === 'pending' && <Clock className=\"h-3 w-3\" />}\n                                  {transaction.status === 'failed' && <X className=\"h-3 w-3\" />}\n                                  <span>\n                                     {transaction.status === 'completed' ? '' : transaction.status === 'pending' ? '' : ''}\n                                  </span>\n                               </div>\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                ) : (\n                  <div className={`overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors max-h-[calc(100dvh-300px)]`}>\n                    <div className=\"space-y-2 pr-2\">\n                      {filteredTransactions.map((transaction) => (\n                        <div\n                          key={transaction.id}\n                          className=\"relative flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer\"\n                          onClick={() => handleTransactionClick(transaction)}\n                        >\n                          {/* Icon Column */}\n                          <div className={`h-10 w-10 rounded-full flex items-center justify-center shrink-0 ${\n                             transaction.type === 'withdraw' ? 'bg-red-100' : 'bg-green-100'\n                          }`}>\n                             {(() => {\n                               const t: any = transaction as any;\n                               const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\n                               const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.type || '').toLowerCase() === 'add') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\n                               \n                               if (isShiftReceipt) return <Receipt className=\"h-5 w-5 text-gray-600\" />;\n                               if (isCashAddReceipt) return <Plus className=\"h-5 w-5 text-green-600\" />;\n                               return transaction.type === 'withdraw' ? (\n                                  <ArrowDownLeft className=\"h-5 w-5 text-red-600\" />\n                               ) : (\n                                  <ArrowUpRight className=\"h-5 w-5 text-green-600\" />\n                               );\n                             })()}\n                          </div>\n\n                          {/* Content Column */}\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center justify-between mb-1\">\n                              <h4 className=\"text-base font-bold truncate\">\n                                {(() => {\n                                   const t: any = transaction as any;\n                                   const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\n                                   const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.type || '').toLowerCase() === 'add') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\n                                   \n                                   if (isShiftReceipt) return <span className=\"text-foreground\"> </span>;\n                                   if (isCashAddReceipt) return <span className=\"text-foreground\"> </span>;\n                                   return transaction.type === 'send' ? <span className=\"text-green-600\"> </span> : <span className=\"text-red-600\"> </span>;\n                                })()}\n                              </h4>\n                              <span className={`text-base font-bold whitespace-nowrap ${\n                                 transaction.type === 'withdraw' ? 'text-red-600' : 'text-green-600'\n                              }`}>\n                                {(transaction.type === 'withdraw' || transaction.type === 'cash_addition' || (transaction as any).txnType === 'cash_addition') ? '+' : '-'} {formatNumberEnglish(transaction.amount)} .\n                              </span>\n                            </div>\n\n                            <div className=\"flex items-center justify-between\">\n                               <div className=\"flex flex-col gap-0.5\">\n                                  <p className=\"text-sm text-muted-foreground truncate\">\n                                     {(() => {\n                                         const t: any = transaction as any;\n                                         const isShiftReceipt = t?.type === 'report' || (String(t?.title || '').includes('  '));\n                                         const isCashAddReceipt = (String(t?.type || '').toLowerCase() === 'cash_addition') || (String(t?.type || '').toLowerCase() === 'add') || (String(t?.txnType || '').toLowerCase() === 'cash_addition') || (String(t?.title || '').includes('  '));\n                                         const noteText = (t?.note || t?.notes || '');\n                                         \n                                         if (isShiftReceipt) return `: ${transaction.receiverPhone}`;\n                                         if (isCashAddReceipt) return noteText || ' ';\n                                         \n                                         return transaction.type === 'send' ? (\n                                            <span dir=\"ltr\">{transaction.receiverPhone}</span>\n                                         ) : (\n                                            <span dir=\"ltr\">{transaction.senderPhone}</span>\n                                         );\n                                     })()}\n                                  </p>\n                                  <p className=\"text-sm font-medium text-gray-500 mt-0.5\">\n                                     {dateFormatter.format(transaction.createdAt instanceof Date ? transaction.createdAt : new Date(transaction.createdAt))} - {timeFormatter.format(transaction.createdAt instanceof Date ? transaction.createdAt : new Date(transaction.createdAt))}\n                                  </p>\n                               </div>\n\n                               <div className={`px-2 py-0.5 rounded-full text-[10px] font-medium flex items-center gap-1 ${\n                                  transaction.status === 'completed' \n                                    ? (transaction.type === 'withdraw' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700')\n                                    : transaction.status === 'pending'\n                                    ? 'bg-yellow-100 text-yellow-700'\n                                    : 'bg-red-100 text-red-700'\n                               }`}>\n                                  {transaction.status === 'completed' && <Check className=\"h-3 w-3\" />}\n                                  {transaction.status === 'pending' && <Clock className=\"h-3 w-3\" />}\n                                  {transaction.status === 'failed' && <X className=\"h-3 w-3\" />}\n                                  <span>\n                                     {transaction.status === 'completed' ? '' : transaction.status === 'pending' ? '' : ''}\n                                  </span>\n                               </div>\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )\n              )}\n              {/*         */}\n              {isMobile && (\n                <div className=\"mt-2 flex justify-end\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"h-7 px-2 text-[11px] rounded-full border bg-red-100 text-red-700 border-red-300 hover:bg-red-200\"\n                    onClick={() => setIsResetRecentDialogOpen(true)}\n                    title=\"  \"\n                  >\n                    <Trash2 className=\"h-3 w-3 mr-1\" />\n                    \n                  </Button>\n                  {user?.uid && localStorage.getItem(`recentTransactionsResetAt:${user.uid}`) && (\n                    <span className=\"inline-block h-1.5 w-1.5 rounded-full bg-red-500 ml-1 align-middle\" />\n                  )}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n        </div>\n\n        {/* Receipt Modal for desktop view */}\n        <ReceiptModal\n          isOpen={isReceiptOpen}\n          onClose={() => setIsReceiptOpen(false)}\n          transaction={receiptTransaction}\n          onPrint={() => window.print()}\n          onDelete={handleDeleteReceipt}\n          onComplete={handleCompleteReceipt}\n        />\n\n        <Dialog open={isDeveloperInfoOpen} onOpenChange={setIsDeveloperInfoOpen}>\n          <DialogContent className=\"sm:max-w-md\">\n            <DialogHeader>\n              <DialogTitle> </DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 py-4\">\n              <div className=\"flex flex-col items-center gap-4 bg-gradient-to-br from-indigo-50 to-blue-50 p-6 rounded-xl border border-blue-100 text-center\">\n                <div className=\"h-16 w-16 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 shadow-sm\">\n                  <Code className=\"h-8 w-8\" />\n                </div>\n                <div className=\"space-y-3 w-full\">\n                  <h3 className=\"text-xl font-bold text-gray-900 mb-2\"> </h3>\n                  <p className=\"text-lg font-bold bg-gradient-to-r from-blue-700 to-indigo-700 bg-clip-text text-transparent leading-relaxed\">\n                          /   \n                  </p>\n                  \n                  <div className=\"flex flex-col items-center gap-1 mt-4\">\n                     <p className=\"text-base font-semibold text-gray-800\">\n                           \n                     </p>\n                     <a href=\"tel:01000392539\" className=\"text-2xl font-black text-blue-600 tracking-wider hover:underline\" dir=\"ltr\">\n                       01000392539\n                     </a>\n                  </div>\n\n                  <p className=\"text-sm text-red-600 font-bold bg-red-50 py-1 px-3 rounded-full inline-block mt-2\">\n                         \n                  </p>\n                </div>\n              </div>\n              <div className=\"text-center text-xs text-gray-400 mt-2\">\n                {appVersion ? `v${appVersion}` : 'v1.0.0'}\n              </div>\n            </div>\n            <DialogFooter>\n              <Button onClick={() => setIsDeveloperInfoOpen(false)}></Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        {/* Transaction Form */}\n        <div className=\"space-y-1 fade-in-right w-full\">\n          <Card id=\"transaction-section\" className={`bg-gray-100 border border-blue-200/40 rounded-lg shadow-lg hover:shadow-lg transition-all duration-200 group relative overflow-hidden`}>\n            {/* Animated background elements */}\n            <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/5 via-indigo-500/3 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200\"></div>\n            <div className=\"absolute top-0 right-0 w-32 h-32 sm:w-28 sm:h-28 lg:w-20 lg:h-20 bg-gradient-to-bl from-blue-400/10 to-transparent rounded-full  \"></div>\n            <div className=\"absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-indigo-400/10 to-transparent rounded-full  \" style={{ animationDelay: '1s' }}></div>\n\n            <CardHeader className=\"sticky top-0 z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 pb-0.5 px-3 pt-1 lg:pt-0.5 lg:pb-0.5 lg:px-2\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-sm font-bold flex items-center gap-2 text-gray-800\">\n                  <div className=\"relative\">\n                    <CheckCircle className=\"h-1 w-1 text-emerald-500 \" />\n                    <div className=\"absolute inset-0 h-1 w-1 bg-emerald-400 rounded-full opacity-20 \"></div>\n                  </div>\n                  <span className=\"bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent\">\n                      \n                  </span>\n                </CardTitle>\n\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"top-icons-bar hidden md:flex items-center gap-2 bg-gradient-to-r from-gray-50 to-slate-50 hover:from-gray-100 hover:to-slate-100 border border-gray-200 transition-all duration-300 hover:scale-105 h-9 px-3 rounded-xl shadow-sm\">\n                    <NotificationBell />\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" title=\"VIP\" onClick={() => setIsVipOpen(true)}>\n                      <Crown className=\"h-5 w-5 text-yellow-500\" />\n                    </Button>\n                    {/* Telegram button removed */}\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" title=\" \" onClick={() => branchPackage?.status === 'active' ? setBranchDialogOpen(true) : setBranchRequestOpen(true)}>\n                      <Store className=\"h-5 w-5\" />\n                    </Button>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" title=\" \" onClick={() => setIsDeveloperInfoOpen(true)}>\n                      <Wrench className=\"h-5 w-5 text-gray-600\" />\n                    </Button>\n                    <ProfileIcon />\n                  </div>\n                </div>\n                {hasLocalDataToSync && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"hidden flex items-center gap-1.5 sm:gap-2 bg-gradient-to-r from-cyan-50 to-blue-50 hover:from-cyan-100 hover:to-blue-100 border-cyan-200 text-cyan-800 text-xs sm:text-sm transition-all duration-300 hover:scale-105 hover:shadow-lg h-10 sm:h-12 px-4 sm:px-5 rounded-xl min-w-[44px] touch-manipulation\"\n                    onClick={syncLocalDataWithFirebase}\n                    title=\"     \"\n                  >\n                    <RefreshCw className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 animate-spin\" />\n                    <span className=\"text-xs sm:text-sm font-semibold whitespace-nowrap\"></span>\n                  </Button>\n                )}\n\n              </div>\n            </CardHeader>\n            <Dialog open={isVipOpen} onOpenChange={setIsVipOpen}>\n              <DialogContent className=\"sm:max-w-md\">\n                <DialogHeader>\n                  <DialogTitle> 10   </DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-2\">\n                  {vipTop10.length === 0 ? (\n                    <div className=\"text-sm text-gray-600\">    </div>\n                  ) : (\n                    vipTop10.map((item, idx) => (\n                      <div\n                        key={item.phone + idx}\n                        className={`flex items-center justify-between border rounded-md px-3 py-2 bg-white ${idx === 0 ? 'bg-yellow-50 border-yellow-300' : ''}`}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          <Badge\n                            variant=\"outline\"\n                            className={`min-w-[28px] justify-center ${idx === 0 ? 'border-yellow-300 text-yellow-700 bg-yellow-50' : ''}`}\n                          >\n                            {idx + 1}\n                          </Badge>\n                          <span className={`font-semibold ${idx === 0 ? 'text-yellow-700' : ''}`}>{item.phone}</span>\n                        </div>\n                        <div className=\"text-sm text-gray-700 flex items-center gap-3\">\n                          <span>: {item.count}</span>\n                          <span>: {item.total}</span>\n                          <Button variant=\"outline\" size=\"sm\" className=\"h-8\" onClick={() => sendVipWhatsApp(item)} title=\" \">\n                            <MessageCircle className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    ))\n                  )}\n                </div>\n                <DialogFooter>\n                  <Button onClick={() => setIsVipOpen(false)}></Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n\n            <Dialog open={isTelegramOpen} onOpenChange={setIsTelegramOpen}>\n              <DialogContent className=\"sm:max-w-md\">\n                <DialogHeader>\n                  <DialogTitle>  </DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-3\">\n                  <div className=\"space-y-1\">\n                    <Label>Telegram Chat ID</Label>\n                    <Input value={telegramChatId} onChange={(e) => setTelegramChatId(e.target.value)} placeholder=\"  \" />\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <Label>  12 </Label>\n                    <Switch checked={telegramDailyEnabled} onCheckedChange={(v) => setTelegramDailyEnabled(!!v)} />\n                  </div>\n                </div>\n                <DialogFooter>\n                  <Button variant=\"outline\" onClick={() => setIsTelegramOpen(false)}></Button>\n                  <Button onClick={async () => {\n                    if (!user?.uid) return;\n                    await userDataService.updateUserData(user.uid, { telegramChatId, telegramDailyEnabled });\n                    toast({ title: ' ' });\n                  }}></Button>\n                  <Button onClick={async () => {\n                    if (!user?.uid || !telegramChatId) { toast({ title: ' Chat ID' }); return; }\n                    const text = await composeTelegramDailySummary();\n                    try {\n                      const { sendTelegramMessage } = await import('@/integrations/firebase/functions');\n                      await sendTelegramMessage({ chatId: telegramChatId, text });\n                      toast({ title: ' ' });\n                    } catch (e) {\n                      toast({ title: ' ', description: '   ', variant: 'destructive' });\n                    }\n                  }}> </Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n\n            <Dialog open={branchDialogOpen} onOpenChange={setBranchDialogOpen}>\n              <DialogContent className=\"sm:max-w-2xl bg-gray-50/80 backdrop-blur-sm\">\n                <DialogHeader className=\"border-b pb-4 mb-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"p-2 bg-indigo-100 rounded-lg\">\n                        <Store className=\"w-6 h-6 text-indigo-600\" />\n                      </div>\n                      <div>\n                        <DialogTitle className=\"text-xl font-bold text-gray-900\"> </DialogTitle>\n                        <DialogDescription className=\"text-gray-500 mt-1\">\n                                 \n                        </DialogDescription>\n                      </div>\n                    </div>\n                    \n                    <Button\n                      size=\"icon\"\n                      variant={showAddBranchForm ? \"destructive\" : \"default\"}\n                      className={`rounded-full transition-all duration-300 ${showAddBranchForm ? 'bg-red-50 text-red-600 hover:bg-red-100 border border-red-200' : 'bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg hover:shadow-indigo-200'}`}\n                      onClick={() => setShowAddBranchForm(!showAddBranchForm)}\n                      title={showAddBranchForm ? \" \" : \"  \"}\n                    >\n                      {showAddBranchForm ? <Minus className=\"w-6 h-6\" /> : <Plus className=\"w-6 h-6\" />}\n                    </Button>\n                  </div>\n                </DialogHeader>\n\n                <div className=\"space-y-6\">\n                  {/*     */}\n                  {showAddBranchForm && (\n                  <div className=\"bg-white p-5 rounded-xl border shadow-sm space-y-4 animate-in slide-in-from-top-4 fade-in duration-300\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <div className=\"flex items-center gap-2 text-indigo-700 font-semibold\">\n                        <Plus className=\"w-5 h-5\" />\n                        <h3>  </h3>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button \n                          onClick={() => checkSubscriptionStatus(true).then(() => toast({ title: '  ' }))} \n                          variant=\"ghost\" \n                          size=\"icon\" \n                          title=\"  \"\n                        >\n                          <RefreshCw className=\"w-4 h-4 text-gray-500\" />\n                        </Button>\n                        <Button onClick={() => setBranchRequestOpen(true)} variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                          <PlusCircle className=\"w-4 h-4\" />\n                            \n                        </Button>\n                      </div>\n                    </div>\n                    \n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div className=\"space-y-2\">\n                        <Label className=\"text-gray-700\"> </Label>\n                        <div className=\"relative\">\n                          <User className=\"absolute right-3 top-2.5 h-4 w-4 text-gray-400\" />\n                          <Input \n                            className=\"pr-9\" \n                            value={managerNameInput} \n                            onChange={e => setManagerNameInput(e.target.value)} \n                            placeholder=\":  \" \n                          />\n                        </div>\n                      </div>\n                      \n                      <div className=\"space-y-2\">\n                        <Label className=\"text-gray-700\"> </Label>\n                        <div className=\"relative\">\n                          <Store className=\"absolute right-3 top-2.5 h-4 w-4 text-gray-400\" />\n                          <Input \n                            className=\"pr-9\" \n                            value={branchNameInput} \n                            onChange={e => setBranchNameInput(e.target.value)} \n                            placeholder=\":   \" \n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label className=\"text-gray-700\">  </Label>\n                        <div className=\"relative\">\n                          <MessageCircle className=\"absolute right-3 top-2.5 h-4 w-4 text-gray-400\" />\n                          <Input \n                            className=\"pr-9\" \n                            value={branchEmailInput} \n                            onChange={e => setBranchEmailInput(e.target.value)} \n                            placeholder=\"branch@example.com\" \n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"space-y-2\">\n                        <Label className=\"text-gray-700\"> </Label>\n                        <div className=\"relative\">\n                          <div className=\"absolute right-3 top-2.5 h-4 w-4 text-gray-400\"></div>\n                          <Input \n                            type=\"password\" \n                            className=\"pr-9\" \n                            value={loginPasswordInput} \n                            onChange={e => setLoginPasswordInput(e.target.value)} \n                            placeholder=\"\" \n                          />\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center justify-end gap-3 pt-2\">\n                      <Button \n                        variant=\"ghost\" \n                        onClick={() => { setManagerNameInput(''); setBranchNameInput(''); setBranchEmailInput(''); setLoginPasswordInput(''); }}\n                        className=\"text-gray-500 hover:text-gray-700\"\n                      >\n                         \n                      </Button>\n                      <Button \n                        className=\"bg-indigo-600 hover:bg-indigo-700 text-white min-w-[120px]\" \n                        disabled={branchLoading} \n                        onClick={async () => {\n                      if (!user?.uid) return;\n                      const manager = managerNameInput.trim();\n                      const bname = branchNameInput.trim();\n                      const email = branchEmailInput.trim();\n                      const pw = loginPasswordInput.trim();\n                      \n                      if (!manager || !bname || !email || !pw) { \n                        toast({ title: '    ' }); \n                        return; \n                      }\n\n                      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n                      if (!emailRegex.test(email)) {\n                         toast({ title: '   ', variant: 'destructive' });\n                         return;\n                      }\n\n                      if (pw.length < 6) {\n                         toast({ title: '     6   ', variant: 'destructive' });\n                         return;\n                      }\n\n                      const limit = branchPackage?.limit || 0;\n                      if (branches.length >= limit) {\n                        toast({\n                          title: '',\n                          description: `      (${limit} )`,\n                          variant: 'destructive'\n                        });\n                        return;\n                      }\n\n                      try {\n                        setBranchLoading(true);\n\n                        let newUserId = '';\n                        let shopIdNew = '';\n                        const tempAppName = `tempApp_${Date.now()}`;\n                        const tempApp = initializeApp(firebaseConfig, tempAppName);\n                        const tempAuth = getAuth(tempApp);\n                        const tempDb = getFirestore(tempApp);\n                        \n                        try {\n                            const userCred = await createUserWithEmailAndPassword(tempAuth, email, pw);\n                            newUserId = userCred.user.uid;\n\n                            // Create User Document for Branch User\n                            try {\n                                await setDoc(doc(tempDb, 'users', newUserId), {\n                                    email: email,\n                                    isActive: true,\n                                    isBranch: true,\n                                    ownerId: user.uid,\n                                    createdAt: serverTimestamp(),\n                                    updatedAt: serverTimestamp(),\n                                    role: 'branch',\n                                    // Subscription starts as INACTIVE (Pending Admin Activation)\n                                    isActive: false, \n                                    subscription: {\n                                        isActive: false,\n                                        planType: null,\n                                        startDate: null,\n                                        endDate: null\n                                    }\n                                });\n                            } catch (e) {\n                                console.error('Error creating branch user document:', e);\n                                // Continue, as the auth user is created, but they might get stuck in pending approval\n                            }\n\n                            // Create the shop AS the new user to ensure ownership permissions\n                            try {\n                                const shopRef = await addDoc(collection(tempDb, 'shops'), { \n                                    name: bname, \n                                    ownerId: newUserId, \n                                    managerName: manager, \n                                    createdAt: serverTimestamp(), \n                                    updatedAt: serverTimestamp(), \n                                    isActive: true \n                                });\n                                shopIdNew = shopRef.id;\n                            } catch (shopError: any) {\n                                console.error('Error creating shop as new user:', shopError);\n                                // If root creation fails (e.g. strict rules), try user subcollection\n                                try {\n                                    const shopRef2 = await addDoc(collection(tempDb, 'users', newUserId, 'shops'), { \n                                        name: bname, \n                                        ownerId: newUserId, \n                                        managerName: manager, \n                                        createdAt: serverTimestamp(), \n                                        updatedAt: serverTimestamp(), \n                                        isActive: true \n                                    });\n                                    shopIdNew = shopRef2.id;\n                                } catch (subError) {\n                                    console.error('Error creating shop in subcollection:', subError);\n                                    throw shopError; // Throw the original error\n                                }\n                            }\n\n                            await firebaseSignOut(tempAuth);\n                        } catch (error: any) {\n                            console.error('Registration/Shop Creation Error:', error);\n                            \n                            let msg = '    ';\n                            if (error.code === 'auth/email-already-in-use') msg = '   ';\n                            if (error.code === 'auth/invalid-email') msg = '   ';\n                            if (error.code === 'auth/weak-password') msg = '  ';\n                            if (error.code === 'permission-denied') msg = '      ';\n                            \n                            toast({ title: msg, description: error.message, variant: 'destructive' });\n                            try { await deleteApp(tempApp); } catch {}\n                            return;\n                        } finally {\n                            try { await deleteApp(tempApp); } catch (e) { console.warn('Error deleting temp app:', e); }\n                        }\n\n                        if (!newUserId || !shopIdNew) return;\n\n                        // Now link the branch in the Admin's account (using main db)\n                        const safeEncode = (s: string) => {\n                          try { return btoa(unescape(encodeURIComponent(s))); } catch { return btoa(s); }\n                        };\n                        \n                        try {\n                          // 1. Create in subcollection with ID = branchUserId (Critical for Security Rules)\n                          const branchData = { \n                            ownerId: user.uid, \n                            shopId: shopIdNew, \n                            branchUserId: newUserId,\n                            branchName: bname, \n                            managerName: manager, \n                            loginUsername: email, \n                            passwordEncoded: safeEncode(pw), \n                            createdAt: serverTimestamp() \n                          };\n                          \n                          await fsSetDoc(fsDoc(db, 'users', user.uid, 'branches', newUserId), branchData);\n\n                          // 2. Create in root collection (Optional/Legacy)\n                          try {\n                            await addDoc(collection(db, 'branches'), branchData);\n                          } catch (e) {\n                             console.warn('Branch ref creation error in root collection (non-fatal):', e);\n                          }\n\n                          // Optimistic Update: Add new branch to UI immediately\n                          const newBranch = { \n                              id: newUserId, \n                              branchUserId: newUserId,\n                              branchName: bname, \n                              managerName: manager, \n                              source: 'sub',\n                              ...branchData \n                          };\n                          setBranches(prev => [...prev, newBranch]);\n                          // Removed setBranchesLoaded(false) to prevent immediate re-fetch which might bring back deleted branches if propagation is slow\n                          // setBranchesLoaded(false); \n\n                        } catch (e) {\n                           console.error('Branch ref creation error:', e);\n                           toast({ title: '    ', description: '      ', variant: 'destructive' });\n                           // We might want to not throw here to avoid confusing the user since the user auth is created\n                        }\n\n                        setManagerNameInput(''); \n                        setBranchNameInput(''); \n                        setBranchEmailInput(''); \n                        setLoginPasswordInput('');\n                        toast({ title: '     ' });\n                      } catch (e: any) {\n                        console.error('General Error adding branch:', e);\n                        toast({ title: '  ', description: e.message || '   ' });\n                      } finally { setBranchLoading(false); }\n                    }}>\n                        {branchLoading ? ' ...' : ' '}\n                      </Button>\n                    </div>\n                  </div>\n                  )}\n\n                  {/*   */}\n                  <div className=\"space-y-3\">\n                    <h4 className=\"text-lg font-semibold text-gray-800 flex items-center gap-2\">\n                      <div className=\"w-1.5 h-6 bg-indigo-500 rounded-full\"></div>\n                       \n                      <Badge variant=\"secondary\" className=\"mr-auto\">{branches.length} / {branchPackage?.limit || 0}</Badge>\n                    </h4>\n                    \n                    {branchLoading && branches.length === 0 ? (\n                      <div className=\"flex flex-col items-center justify-center py-8 text-gray-500\">\n                        <RefreshCw className=\"w-8 h-8 animate-spin mb-2 text-indigo-400\" />\n                        <p>  ...</p>\n                      </div>\n                    ) : branches.length === 0 ? (\n                      <div className=\"text-center py-8 border-2 border-dashed rounded-xl bg-gray-50\">\n                        <Store className=\"w-12 h-12 text-gray-300 mx-auto mb-2\" />\n                        <p className=\"text-gray-500\">    </p>\n                      </div>\n                    ) : (\n                      <div className=\"grid grid-cols-1 gap-3\">\n                        {branches.map((b) => (\n                          <div key={b.id} className=\"group relative bg-white border rounded-xl p-4 shadow-sm hover:shadow-md transition-all duration-200\">\n                            <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n                              <div className=\"flex items-center gap-4\">\n                                <div className=\"w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold text-lg\">\n                                  {b.branchName?.charAt(0) || 'B'}\n                                </div>\n                                <div>\n                                  <h5 className=\"font-bold text-gray-900 text-lg\">{b.branchName}</h5>\n                                  <div className=\"flex items-center gap-2 text-sm text-gray-500\">\n                                    <User className=\"w-3 h-3\" />\n                                    <span>: {b.managerName}</span>\n                                  </div>\n                                </div>\n                              </div>\n                              \n                              <div className=\"flex items-center gap-2 w-full sm:w-auto mt-2 sm:mt-0\">\n                                <Button \n                                  className=\"flex-1 sm:flex-none bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200\"\n                                  onClick={() => fetchBranchDetails(b)}\n                                >\n                                  <BarChart className=\"w-4 h-4 ml-2\" />\n                                   \n                                </Button>\n                                <Button \n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  className=\"text-blue-500 hover:text-blue-700 hover:bg-blue-50\"\n                                  title=\"  \"\n                                  onClick={() => openEditBranchDialog(b)}\n                                >\n                                  <Edit className=\"w-4 h-4\" />\n                                </Button>\n\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n            <Dialog open={branchLoginOpen} onOpenChange={setBranchLoginOpen}>\n              <DialogContent className=\"sm:max-w-md\">\n                <DialogHeader>\n                  <DialogTitle> </DialogTitle>\n                  <DialogDescription>    </DialogDescription>\n                </DialogHeader>\n                <div className=\"space-y-3\">\n                  <div>\n                    <Label>  ( )</Label>\n                    <Input value={branchLoginUsername} onChange={e => setBranchLoginUsername(e.target.value)} placeholder=\"example@email.com\" />\n                  </div>\n                  <div>\n                    <Label> </Label>\n                    <Input type=\"password\" value={branchLoginPassword} onChange={e => setBranchLoginPassword(e.target.value)} placeholder=\"\" />\n                  </div>\n                  <div className=\"flex items-center justify-end gap-2\">\n                    <Button variant=\"outline\" onClick={() => { setBranchLoginUsername(''); setBranchLoginPassword(''); }}></Button>\n                    <Button className=\"bg-blue-600 hover:bg-blue-700\" disabled={branchAuthLoading} onClick={async () => {\n                      const b = branchLoginTarget;\n                      if (!b) { setBranchLoginOpen(false); return; }\n                      const expectedUser = String(b.loginUsername || '');\n                      let expectedPw = '';\n                      try {\n                        const enc = String(b.passwordEncoded || '');\n                        expectedPw = enc ? decodeURIComponent(escape(atob(enc))) : '';\n                      } catch {\n                        try { expectedPw = b.passwordEncoded ? atob(String(b.passwordEncoded)) : ''; } catch { expectedPw = ''; }\n                      }\n                      const u = branchLoginUsername.trim();\n                      const p = branchLoginPassword.trim();\n                      if (!u || !p) { toast({ title: '     ' }); return; }\n                      if (u !== expectedUser || p !== expectedPw) { toast({ title: '   ', variant: 'destructive' }); return; }\n                      try {\n                        setBranchAuthLoading(true);\n                        const key = user?.uid ? `selectedShopId_${user.uid}` : 'selectedShopId';\n                        localStorage.setItem(key, String(b.shopId));\n                        toast({ title: '   ', description: String(b.branchName || '') });\n                        setBranchLoginOpen(false);\n                        setBranchDialogOpen(false);\n                        navigate('/user/dashboard');\n                      } catch { }\n                      setBranchAuthLoading(false);\n                    }}></Button>\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n            <Dialog open={branchDetailsOpen} onOpenChange={setBranchDetailsOpen}>\n              <DialogContent className=\"sm:max-w-2xl\">\n                <DialogHeader>\n                  <DialogTitle>  {selectedBranchDetails?.branchName}</DialogTitle>\n                  <DialogDescription> : {selectedBranchDetails?.managerName}</DialogDescription>\n                </DialogHeader>\n                {branchDetailsLoading ? (\n                  <div className=\"py-8 flex justify-center\">\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                  </div>\n                ) : selectedBranchDetails ? (\n                  <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 py-4\">\n                    <div className=\"p-4 border rounded-xl bg-green-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\"> </div>\n                      <div className=\"text-xl font-bold text-green-700\">{formatNumberEnglish(selectedBranchDetails.todaySales)} .</div>\n                    </div>\n                    <div className=\"p-4 border rounded-xl bg-blue-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\"> </div>\n                      <div className=\"text-xl font-bold text-blue-700\">{formatNumberEnglish(selectedBranchDetails.monthSales)} .</div>\n                    </div>\n                    <div className=\"p-4 border rounded-xl bg-emerald-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\"> </div>\n                      <div className=\"text-xl font-bold text-emerald-700\">{formatNumberEnglish(selectedBranchDetails.todayProfit)} .</div>\n                    </div>\n                    <div className=\"p-4 border rounded-xl bg-cyan-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\"> </div>\n                      <div className=\"text-xl font-bold text-cyan-700\">{formatNumberEnglish(selectedBranchDetails.monthProfit)} .</div>\n                    </div>\n                    <div className=\"p-4 border rounded-xl bg-purple-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\"> </div>\n                      <div className=\"text-xl font-bold text-purple-700\">{formatNumberEnglish(selectedBranchDetails.walletsTotal)} .</div>\n                    </div>\n                    <div className=\"p-4 border rounded-xl bg-yellow-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\"> </div>\n                      <div className=\"text-xl font-bold text-yellow-700\">{formatNumberEnglish(selectedBranchDetails.cashBalance)} .</div>\n                    </div>\n                    <div className=\"p-4 border rounded-xl bg-indigo-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\">  </div>\n                      <div className=\"text-xl font-bold text-indigo-700\">{formatNumberEnglish(selectedBranchDetails.totalSalesSection)} .</div>\n                    </div>\n                    <div className=\"p-4 border rounded-xl bg-red-50\">\n                      <div className=\"text-sm text-gray-500 mb-1\"> </div>\n                      <div className=\"text-xl font-bold text-red-700\">{formatNumberEnglish(selectedBranchDetails.debtsTotal)} .</div>\n                    </div>\n                  </div>\n                ) : null}\n                <DialogFooter>\n                    <Button onClick={() => setBranchDetailsOpen(false)}></Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n\n            <Dialog open={branchEditOpen} onOpenChange={setBranchEditOpen}>\n              <DialogContent className=\"sm:max-w-md\">\n                <DialogHeader>\n                  <DialogTitle>  </DialogTitle>\n                  <DialogDescription>\n                        \n                  </DialogDescription>\n                </DialogHeader>\n                <div className=\"space-y-4 py-2\">\n                  <div className=\"space-y-2\">\n                    <Label>  ( )</Label>\n                    <Input \n                      value={editBranchEmail} \n                      readOnly\n                      disabled\n                      placeholder=\"   \"\n                      className=\"bg-gray-100 text-black opacity-100 font-medium\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label> </Label>\n                    <Input \n                      value={editBranchName} \n                      onChange={(e) => setEditBranchName(e.target.value)} \n                      placeholder=\":  \"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label> </Label>\n                    <Input \n                      value={editManagerName} \n                      onChange={(e) => setEditManagerName(e.target.value)} \n                      placeholder=\":  \"\n                    />\n                  </div>\n                </div>\n                <DialogFooter>\n                  <Button variant=\"outline\" onClick={() => setBranchEditOpen(false)}></Button>\n                  <Button onClick={handleUpdateBranch} disabled={editBranchLoading}>\n                    {editBranchLoading ? ' ...' : ' '}\n                  </Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n            <CardContent\n              ref={formRef}\n              className=\"space-y-1 px-2 pb-2 relative z-10 transition-transform duration-200 ease-out will-change-transform\"\n              style={{ transform: formTranslateY ? `translateY(${formTranslateY}px)` : undefined }}\n              onFocusCapture={(e) => {\n                const target = e.target as HTMLElement | null;\n                const isTransferFee = target?.id === 'transferExtraFeeInput';\n                if (!isTransferFee) {\n                  setFormTranslateY(0);\n                  return;\n                }\n                const btn = document.getElementById('transferSubmitButton') as HTMLButtonElement | null;\n                if (btn) {\n                  const rect = btn.getBoundingClientRect();\n                  const viewBottom = window.innerHeight;\n                  if (rect.bottom > viewBottom) {\n                    const needed = rect.bottom - viewBottom;\n                    const offset = Math.min(needed, 220);\n                    setFormTranslateY(-offset);\n                  } else {\n                    setFormTranslateY(0);\n                  }\n                } else {\n                  setFormTranslateY(0);\n                }\n              }}\n              onBlurCapture={(e) => {\n                if (!e.currentTarget.contains(e.relatedTarget as Node)) {\n                  setFormTranslateY(0);\n                }\n              }}\n            >\n              <div className=\"transaction-type-tabs flex w-full rounded-full border border-gray-300 overflow-hidden bg-surface fade-in-up\">\n                <button\n                  type=\"button\"\n                  onClick={() => handleTransactionTypeChange('transfer')}\n                  className={`flex-1 h-10 text-sm font-medium transition-colors duration-200 flex items-center justify-center gap-2 ${transactionType === 'transfer'\n                    ? 'bg-blue-100 text-blue-900'\n                    : 'bg-transparent text-gray-600 hover:bg-gray-50'\n                    }`}\n                >\n                  {transactionType === 'transfer' && <Check className=\"h-4 w-4\" />}\n                  <ArrowUpDown className=\"h-4 w-4\" />\n                  \n                </button>\n                <div className=\"w-[1px] bg-gray-300\"></div>\n                <button\n                  type=\"button\"\n                  onClick={() => handleTransactionTypeChange('withdraw')}\n                  className={`flex-1 h-10 text-sm font-medium transition-colors duration-200 flex items-center justify-center gap-2 ${transactionType === 'withdraw'\n                    ? 'bg-red-100 text-red-900'\n                    : 'bg-transparent text-gray-600 hover:bg-gray-50'\n                    }`}\n                >\n                  {transactionType === 'withdraw' && <Check className=\"h-4 w-4\" />}\n                  <ArrowDownLeft className=\"h-4 w-4\" />\n                  \n                </button>\n              </div>\n\n              {/* Wallet Selection */}\n              <div className=\"fade-in-up\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <label className=\"text-sm font-semibold text-gray-700 block flex items-center gap-2\">\n                    <Wallet className=\"h-1 w-1 text-blue-600\" />\n                     \n                  </label>\n                  <div className=\"flex items-center gap-1\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"h-6 rounded-md px-2 text-[10px] bg-emerald-50 text-emerald-700 hover:bg-emerald-100 border border-emerald-200\"\n                      onClick={() => navigate('/user/add-wallet')}\n                      title=\" \"\n                    >\n                      <Plus className=\"h-3 w-3 mr-1\" />\n                       \n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"h-6 rounded-md px-2 text-[10px] bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200\"\n                      onClick={() => {\n                        //          \n                        setIsWalletsPinDialogOpen(true);\n                      }}\n                      title=\"\"\n                    >\n                      <Wallet className=\"h-3 w-3 mr-1\" />\n                      \n                    </Button>\n                  </div>\n                </div>\n                {wallets.length > 0 ? (\n                  <Select value={selectedWallet} onValueChange={handleWalletChange}>\n                    <SelectTrigger data-testid=\"wallet-select\" className={`w-full h-14 text-base bg-surface border border-gray-400 hover:border-gray-800 focus:border-primary rounded-xl transition-colors duration-200 flex items-center`}>\n                      <SelectValue placeholder=\"  \" className=\"text-gray-700\" />\n                    </SelectTrigger>\n                    <SelectContent className=\"rounded-xl border border-gray-200 shadow-md z-[9999] bg-white dark:bg-gray-900\">\n                      {/* Search Bar */}\n                      <div data-fixed-header=\"true\" className=\"sticky top-0 z-10 bg-white dark:bg-gray-900 p-2 border-b border-gray-100 dark:border-gray-800\">\n                        <Input\n                          value={walletSearch}\n                          onChange={(e) => setWalletSearch(e.target.value)}\n                          placeholder=\"  \"\n                          className=\"h-10 text-sm border-gray-300 rounded-lg\"\n                        />\n                      </div>\n                      <div className=\"p-1\">\n                        {filteredWallets.length === 0 ? (\n                          <div className=\"text-sm text-gray-500 p-3 text-center\">   </div>\n                        ) : (\n                          filteredWallets.map((wallet) => (\n                            <SelectItem key={wallet.id} value={wallet.id} className=\"rounded-lg my-1 cursor-pointer hover:bg-gray-100 focus:bg-blue-50 transition-colors duration-200\">\n                              <div className=\"flex items-center gap-3 py-2 w-full\">\n                                <Wallet className=\"h-5 w-5 text-gray-500\" />\n                                <div className=\"flex items-center gap-2 text-right\">\n                                  <span className=\"text-base font-medium text-gray-900\">{wallet.name}</span>\n                                  <span className=\"text-sm font-bold text-red-600\">{wallet.phone}</span>\n                                </div>\n                                {wallet.isDefault && (\n                                  <span className=\"mr-auto text-[10px] bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full border border-gray-200\"></span>\n                                )}\n                              </div>\n                            </SelectItem>\n                          ))\n                        )}\n                      </div>\n                    </SelectContent>\n                  </Select>\n                ) : (\n                  <div className=\"rounded-xl border-2 border-dashed border-gray-200 bg-gray-50 px-3 py-3 text-xs text-gray-600\">\n                        .      .\n                  </div>\n                )}\n              </div>\n\n              {/* Wallets View Dialog */}\n              <Dialog open={isWalletsDialogOpen} onOpenChange={setIsWalletsDialogOpen}>\n                <DialogContent className=\"sm:max-w-3xl w-[95vw] sm:w-auto max-h-[80vh] overflow-y-auto\">\n                  <DialogHeader>\n                    <DialogTitle> </DialogTitle>\n                  </DialogHeader>\n                  <div className=\"mt-2\">\n                    <WalletsManagement\n                      showAddButton={false}\n                      showUsageBars={false}\n                      showLimitCards={false}\n                      showEditButton={true}\n                    />\n                  </div>\n                </DialogContent>\n              </Dialog>\n\n              {/*       */}\n              <MasterPinDialog\n                open={isWalletsPinDialogOpen}\n                onOpenChange={setIsWalletsPinDialogOpen}\n                mode=\"verify\"\n                title=\"   \"\n                description=\"      \"\n                onSuccess={() => {\n                  setIsWalletsPinDialogOpen(false);\n                  setIsWalletsDialogOpen(true);\n                }}\n                userId={user?.uid}\n              />\n\n              {/*       */}\n              <MasterPinDialog\n                open={isWalletSelectionPinDialogOpen}\n                onOpenChange={(open) => {\n                  setIsWalletSelectionPinDialogOpen(open);\n                  if (!open) {\n                    setPendingSelectedWalletId(null);\n                  }\n                }}\n                mode=\"verify\"\n                title=\"  \"\n                description=\"      \"\n                onSuccess={() => {\n                  if (pendingSelectedWalletId) {\n                    setWalletSelection(pendingSelectedWalletId, 'walletSelectionPin');\n                    setPendingSelectedWalletId(null);\n                  }\n                  setIsWalletSelectionPinDialogOpen(false);\n                }}\n                userId={user?.uid}\n              />\n\n              {/*      */}\n              {/* Monthly Limit Warning Dialog Removed - Converted to Inline Row */}\n\n\n              {/* Combined Progress Bar for Monthly and Daily Limits - Per Wallet */}\n              {selectedWallet && wallets.length > 0 && (() => {\n                const selectedWalletObj = wallets.find(w => w.id === selectedWallet);\n                const walletMonthlyUsage = walletMonthlyUsageMemo;\n                const walletDailyUsage = calculateWalletDailyUsage(selectedWallet);\n\n                //      (    / )\n                const monthlyWithdrawalLimit = selectedWalletLimits?.monthlyWithdrawLimit ?? selectedWalletObj?.monthlyWithdrawalLimit ?? 200000;\n                const monthlyTransferLimit = selectedWalletLimits?.monthlyTransferLimit ?? selectedWalletObj?.monthlyTransferLimit ?? 200000;\n                const monthlyWithdrawUsed = selectedWalletLimits?.monthlyWithdrawUsed ?? walletMonthlyUsage.totalWithdrawn ?? 0;\n                const monthlyTransferUsed = selectedWalletLimits?.monthlyTransferUsed ?? walletMonthlyUsage.totalTransferred ?? 0;\n\n                const isTahweelaPlan = userSubscription?.subscription?.planType === SubscriptionPlan.TAHWEELA;\n                const dailyWithdrawalLimit = isTahweelaPlan ? 0 : (selectedWalletLimits?.dailyWithdrawLimit ?? 100000);\n                const dailyTransferLimit = isTahweelaPlan ? 0 : (selectedWalletLimits?.dailyTransferLimit ?? 60000);\n                const dailyWithdrawUsed = isTahweelaPlan ? 0 : (selectedWalletLimits?.dailyWithdrawUsed ?? walletDailyUsage.totalWithdrawn ?? 0);\n                const dailyTransferUsed = isTahweelaPlan ? 0 : (selectedWalletLimits?.dailyTransferUsed ?? walletDailyUsage.totalTransferred ?? 0);\n\n                //        \n                const amountNum = parseFloat(amount || '0') || 0;\n                const predictedMonthlyWithdrawUsed = monthlyWithdrawUsed + (transactionType === 'withdraw' ? amountNum : 0);\n                const predictedMonthlyTransferUsed = monthlyTransferUsed + (transactionType === 'transfer' ? amountNum : 0);\n                const predictedDailyWithdrawUsed = dailyWithdrawUsed + (transactionType === 'withdraw' ? amountNum : 0);\n                const predictedDailyTransferUsed = dailyTransferUsed + (transactionType === 'transfer' ? amountNum : 0);\n\n                if (!selectedWalletObj) return null;\n\n                return (\n                  <div className=\"fade-in-up mb-2 space-y-2 p-2 bg-gray-50 rounded-xl border border-gray-200 shadow-sm\">\n                    {/* Monthly Limits - Side-by-Side Split */}\n                    <div className=\"space-y-1\">\n                      <div className=\"flex items-center justify-between border-b border-gray-200 pb-1\">\n                        <span className=\"text-sm font-bold text-gray-800\"> </span>\n                        <span className=\"text-xs font-medium text-gray-500 bg-white px-2 py-0.5 rounded-full border border-gray-200\">{selectedWalletName || selectedWalletObj?.name}</span>\n                      </div>\n                      \n                      <div className=\"flex gap-4\">\n                        {/* Withdraw Progress (Right Side) */}\n                        <div className=\"flex-1\">\n                          <div className=\"flex justify-between text-xs mb-1 font-medium\">\n                            <span className=\"text-gray-700\"> </span>\n                            <span className=\"text-gray-600 dir-ltr\">{Math.max(monthlyWithdrawalLimit - predictedMonthlyWithdrawUsed, 0).toLocaleString('en-US', { maximumFractionDigits: 0 })} </span>\n                          </div>\n                          <div className=\"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50\">\n                            <div \n                              className=\"h-full bg-gradient-to-l from-red-500 to-red-600 rounded-full transition-all duration-500 ease-out shadow-sm\"\n                              style={{ width: `${Math.min(((predictedMonthlyWithdrawUsed / Math.max(monthlyWithdrawalLimit, 1)) * 100), 100)}%` }}\n                            />\n                          </div>\n                          <div className=\"flex justify-between mt-0.5\">\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {predictedMonthlyWithdrawUsed.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {monthlyWithdrawalLimit.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                          </div>\n                        </div>\n\n                        {/* Divider Line */}\n                        <div className=\"w-[1px] bg-gray-200 self-stretch\"></div>\n\n                        {/* Transfer Progress (Left Side) */}\n                        <div className=\"flex-1\">\n                          <div className=\"flex justify-between text-xs mb-1 font-medium\">\n                            <span className=\"text-gray-700\"> </span>\n                            <span className=\"text-gray-600 dir-ltr\">{Math.max(monthlyTransferLimit - predictedMonthlyTransferUsed, 0).toLocaleString('en-US', { maximumFractionDigits: 0 })} </span>\n                          </div>\n                          <div className=\"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50\">\n                            <div \n                              className=\"h-full bg-gradient-to-l from-blue-500 to-blue-600 rounded-full transition-all duration-500 ease-out shadow-sm\"\n                              style={{ width: `${Math.min(((predictedMonthlyTransferUsed / Math.max(monthlyTransferLimit, 1)) * 100), 100)}%` }}\n                            />\n                          </div>\n                          <div className=\"flex justify-between mt-0.5\">\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {predictedMonthlyTransferUsed.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {monthlyTransferLimit.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* Daily Limits */}\n                    <div className=\"space-y-1 pt-1.5 border-t border-gray-200\">\n                      <div className=\"flex items-center justify-between mb-0.5\">\n                         <span className=\"text-sm font-bold text-gray-800\"> </span>\n                      </div>\n                      \n                      <div className=\"flex gap-4\">\n                        {/* Withdraw Progress (Right Side) */}\n                        <div className=\"flex-1\">\n                          <div className=\"flex justify-between text-xs mb-1 font-medium\">\n                            <span className=\"text-gray-700\"> </span>\n                            <span className=\"text-gray-600 dir-ltr\">{Math.max(dailyWithdrawalLimit - predictedDailyWithdrawUsed, 0).toLocaleString('en-US', { maximumFractionDigits: 0 })} </span>\n                          </div>\n                          <div className=\"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50\">\n                            <div \n                              className=\"h-full bg-gradient-to-l from-orange-400 to-orange-500 rounded-full transition-all duration-500 ease-out\"\n                              style={{ width: `${Math.min(((predictedDailyWithdrawUsed / Math.max(dailyWithdrawalLimit, 1)) * 100), 100)}%` }}\n                            />\n                          </div>\n                          <div className=\"flex justify-between mt-0.5\">\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {predictedDailyWithdrawUsed.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {dailyWithdrawalLimit.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                          </div>\n                        </div>\n\n                        {/* Divider Line */}\n                        <div className=\"w-[1px] bg-gray-200 self-stretch\"></div>\n\n                        {/* Transfer Progress (Left Side) */}\n                        <div className=\"flex-1\">\n                          <div className=\"flex justify-between text-xs mb-1 font-medium\">\n                            <span className=\"text-gray-700\"> </span>\n                            <span className=\"text-gray-600 dir-ltr\">{Math.max(dailyTransferLimit - predictedDailyTransferUsed, 0).toLocaleString('en-US', { maximumFractionDigits: 0 })} </span>\n                          </div>\n                          <div className=\"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50\">\n                            <div \n                              className=\"h-full bg-gradient-to-l from-green-500 to-green-600 rounded-full transition-all duration-500 ease-out\"\n                              style={{ width: `${Math.min(((predictedDailyTransferUsed / Math.max(dailyTransferLimit, 1)) * 100), 100)}%` }}\n                            />\n                          </div>\n                          <div className=\"flex justify-between mt-0.5\">\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {predictedDailyTransferUsed.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                             <span className=\"text-[10px] text-gray-900 font-medium\">: {dailyTransferLimit.toLocaleString('en-US', { maximumFractionDigits: 0 })}</span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })()}\n\n              {transactionType === 'transfer' ? (\n                <>\n                  <div className=\"fade-in-up\">\n                    <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                       \n                    </label>\n                    <div className=\"relative group\">\n                      <Phone className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-green-600 group-focus-within:text-green-700 transition-colors\" />\n                      <Input\n                        value={senderPhone}\n                        onChange={(e) => setSenderPhone(e.target.value)}\n                        onKeyDown={(e) => {\n                          if (e.key === 'Enter') {\n                            const dest = document.getElementById('receiverPhoneInput') as HTMLInputElement | null;\n                            if (dest) {\n                              dest.focus();\n                            } else {\n                              const amountEl = document.getElementById('amountInput') as HTMLInputElement | null;\n                              amountEl?.focus();\n                            }\n                          }\n                        }}\n                        placeholder=\"01030302038\"\n                        className=\"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-blue-600 focus:ring-1 focus:ring-blue-600 transition-all duration-200\"\n                      />\n                    </div>\n                  </div>\n\n                  {!isVodafoneCashUser && (\n                    <div className=\"fade-in-up\">\n                      <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                         \n                      </label>\n                      <div className=\"relative group\">\n                        <Phone className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-green-600 group-focus-within:text-green-700 transition-colors\" />\n                        <Input\n                          id=\"receiverPhoneInput\"\n                          value={receiverPhone}\n                          onChange={(e) => {\n                            setReceiverPhone(e.target.value);\n                            if (isTransferSuccess) {\n                              setIsTransferSuccess(false);\n                            }\n                          }}\n                          onKeyDown={(e) => {\n                            if (e.key === 'Enter') {\n                              const next = document.getElementById('amountInput') as HTMLInputElement | null;\n                              next?.focus();\n                            }\n                          }}\n                          inputMode=\"numeric\"\n                          maxLength={11}\n                          placeholder=\"  \"\n                          className=\"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-blue-600 focus:ring-1 focus:ring-blue-600 transition-all duration-200\"\n                        />\n                      </div>\n                    </div>\n                  )}\n                </>\n              ) : (\n                <div className=\"fade-in-up\">\n                  <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                     \n                  </label>\n                  <div className=\"relative\">\n                    <Phone className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400\" />\n                    <Input\n                      value={selectedWallet ? wallets.find(w => w.id === selectedWallet)?.phone || '' : ''}\n                      readOnly\n                      placeholder=\"  \"\n                      className=\"pl-10 h-10 text-sm lg:text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl transition-all duration-300\"\n                    />\n                  </div>\n                </div>\n              )}\n\n              {transactionType === 'transfer' ? (\n                <>\n                  <div className=\"fade-in-up\">\n                    <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                       ()\n                    </label>\n                    <div className=\"relative flex items-center gap-2 group\">\n                      <DollarSign className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-yellow-600 group-focus-within:text-yellow-700 transition-colors\" />\n                      <Input\n                        id=\"amountInput\"\n                        value={amount}\n                        onChange={(e) => {\n                          setAmount(e.target.value);\n                          if (isTransferSuccess) {\n                            setIsTransferSuccess(false);\n                          }\n                        }}\n                        onKeyDown={(e) => {\n                          if (e.key === 'Enter') {\n                            const commissionEl = document.getElementById('transferCommissionInput') as HTMLInputElement | null;\n                            if (commissionEl) {\n                              commissionEl.focus();\n                            } else {\n                              const quickBtn = document.getElementById('quickDebtButton') as HTMLButtonElement | null;\n                              quickBtn?.focus();\n                            }\n                          }\n                        }}\n                        placeholder=\" \"\n                        type=\"number\"\n                        className=\"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-blue-600 focus:ring-1 focus:ring-blue-600 transition-all duration-200\"\n                      />\n\n                    </div>\n                    {quickDebtInfo ? (\n                      <div className=\"mt-2 text-xs text-green-700 bg-green-50 border border-green-200 rounded px-2 py-1 flex items-center gap-2\">\n                        <span>     {quickDebtInfo.debtorName}  {quickDebtInfo.amount} </span>\n                        <Button type=\"button\" variant=\"ghost\" size=\"sm\" className=\"h-6 px-2\" onClick={() => setQuickDebtInfo(null)}></Button>\n                      </div>\n                    ) : null}\n                  </div>\n\n                  {(() => {\n                    if (isVodafoneCashUser) return null;\n                    const sw = getSelectedWalletObj();\n                    const hasDefault = sw && sw.defaultTransferCommission != null;\n                    if (hasDefault) {\n                      return (\n                        <div className=\"fade-in-up\">\n                          <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                              ()\n                          </label>\n                          <div className=\"text-xs text-gray-500 mt-1\">\n                                  : {sw?.defaultTransferCommission}   \n                          </div>\n                          <div className=\"mt-2 flex items-center gap-2\">\n                            <Button\n                              id=\"quickDebtButton\"\n                              type=\"button\"\n                              variant=\"destructive\"\n                              size=\"sm\"\n                              className=\"bg-red-600 hover:bg-red-700 text-white font-medium\"\n                              onClick={() => {\n                                const swInner = getSelectedWalletObj();\n                                const commissionPerThousand = swInner?.defaultTransferCommission != null\n                                  ? Number(swInner.defaultTransferCommission)\n                                  : 0;\n                                const baseAmount = parseFloat(amount || '0') || 0;\n                                const commissionCalc = Math.round((((commissionPerThousand || 0) * baseAmount) / 1000) * 100) / 100;\n                                const debtVal = baseAmount + commissionCalc;\n                                setQuickDebtAmount((debtVal || 0).toString());\n                                if (isZeroPlan) {\n                                  toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n                                } else {\n                                  setIsQuickDebtOpen(true);\n                                }\n                              }}\n                            >\n                              \n                            </Button>\n                            <Button\n                              type=\"button\"\n                              variant=\"outline\"\n                              size=\"icon\"\n                              className=\"hidden\"\n                              title={isCommissionAddMode ? ' ' : ' '}\n                            >\n                              {isCommissionAddMode ? <Plus className=\"h-4 w-4 text-green-600\" /> : <Minus className=\"h-4 w-4 text-red-600\" />}\n                            </Button>\n                            <span className=\"hidden\">\n                              {isCommissionAddMode ? ' ' : ' '}\n                            </span>\n                          </div>\n                        </div>\n                      );\n                    }\n                    return (\n                      <div className=\"fade-in-up\">\n                        <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                              ()\n                        </label>\n                        <div className=\"flex items-center gap-2\">\n                          <div className=\"relative flex-1 group\">\n                            <DollarSign className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-yellow-600 group-focus-within:text-yellow-700 transition-colors\" />\n                            <Input\n                              id=\"transferCommissionInput\"\n                              value={transferCommission}\n                              onChange={(e) => setTransferCommission(e.target.value)\n                              }\n                              placeholder=\"  \"\n                              type=\"number\"\n                              className=\"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-all duration-200\"\n                            />\n                          </div>\n                          <Button\n                            type=\"button\"\n                            variant=\"destructive\"\n                            size=\"sm\"\n                            className=\"bg-red-600 hover:bg-red-700 text-white font-medium\"\n                            onClick={() => {\n                              const swInner = getSelectedWalletObj();\n                              const baseAmount = parseFloat(amount || '0') || 0;\n                              let commissionCalc = 0;\n                              if (swInner?.defaultTransferCommission != null) {\n                                const rate = Number(swInner.defaultTransferCommission) || 0;\n                                commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\n                              } else {\n                                const manualFixed = transferCommission && transferCommission.trim() !== '' ? parseFloat(transferCommission) : 0;\n                                commissionCalc = Math.max(0, manualFixed);\n                              }\n                              const debtVal = baseAmount + commissionCalc;\n                              setQuickDebtAmount((debtVal || 0).toString());\n                              if (isZeroPlan) {\n                                toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n                              } else {\n                                setIsQuickDebtOpen(true);\n                              }\n                            }}\n                          >\n                            \n                          </Button>\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            size=\"icon\"\n                            className=\"hidden\"\n                            title={isCommissionAddMode ? ' ' : ' '}\n                          >\n                            {isCommissionAddMode ? <Plus className=\"h-4 w-4 text-green-600\" /> : <Minus className=\"h-4 w-4 text-red-600\" />}\n                          </Button>\n                          <span className=\"hidden\">\n                            {isCommissionAddMode ? ' ' : ' '}\n                          </span>\n                        </div>\n                        <div className=\"text-xs text-gray-500 mt-1\">\n                               ()\n                        </div>\n                      </div>\n                    );\n                  })()}\n\n                  {(() => {\n                    const s = normalizeDigits(senderPhone || '').replace(/\\D/g, '');\n                    const r = normalizeDigits(receiverPhone || '').replace(/\\D/g, '');\n                    const showFee = transactionType === 'transfer' && (\n  (s.startsWith('010') && r.startsWith('010')) ||\n  (s.startsWith('010') && (r.startsWith('011') || r.startsWith('012') || r.startsWith('015'))) ||\n  (s.startsWith('012') && r.startsWith('010')) ||\n  (s.startsWith('011') && r.startsWith('010')) ||\n  (s.startsWith('015') && r.startsWith('010'))\n);\n                    if (!showFee) return null;\n                    return (\n                      <div className=\"fade-in-up\">\n                        <label className=\"text-sm font-medium text-gray-700 mb-1 block\">  ()</label>\n                        <div className=\"relative\">\n                          <DollarSign className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-yellow-600\" />\n                          <Input\n                            id=\"transferExtraFeeInput\"\n                            value={transferExtraFee}\n                            onChange={(e) => setTransferExtraFee(e.target.value)}\n                            placeholder=\"  \"\n                            type=\"number\"\n                            className=\"pl-10 h-10 text-sm lg:text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white transition-all duration-300 hover:border-blue-400 focus:border-blue-500\"\n                          />\n                        </div>\n                        <div className=\"hidden\">\n                                 010  011/012/015  012  010  011  010  015  010\n                        </div>\n                      </div>\n                    );\n                  })()}\n\n                  <div className=\"sticky bottom-0 z-20 pt-2 pb-2 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 backdrop-blur supports-[backdrop-filter]:bg-white/90 dark:supports-[backdrop-filter]:bg-gray-900/90\">\n                    <Button\n                      id=\"transferSubmitButton\"\n                      onClick={handleTransaction}\n                      className=\"w-full h-12 text-base font-medium rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-none hover:shadow-md transition-all duration-200\"\n                    >\n                      {isTransferSuccess ? \"  \" : \" \"}\n                    </Button>\n                    {/* Warning Row */}\n                    {isMonthlyLimitWarnOpen && (\n                      <div className=\"flex items-start gap-2 mt-2 px-1 animate-in fade-in slide-in-from-bottom-2\">\n                        <AlertTriangle className=\"h-4 w-4 text-amber-500 shrink-0 mt-0.5\" />\n                        <p className=\"text-xs text-gray-500 leading-tight\">\n                             85%     {monthlyLimitWarnData?.walletName}\n                        </p>\n                      </div>\n                    )}\n                  </div>\n                </>\n              ) : (\n                <>\n                  <div className=\"fade-in-up\">\n                    <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                        ()\n                    </label>\n                    <div className=\"relative group\">\n                      <ArrowDownLeft className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-primary transition-colors\" />\n                      <Input\n                        id=\"amountInput\"\n                        value={amount}\n                        onChange={(e) => {\n                          setAmount(e.target.value);\n                          if (isWithdrawSuccess) {\n                            setIsWithdrawSuccess(false);\n                          }\n                        }}\n                        onKeyDown={(e) => {\n                          if (e.key === 'Enter') {\n                            const manualEl = document.getElementById('manualWithdrawCommissionInput') as HTMLInputElement | null;\n                            if (manualEl) {\n                              manualEl.focus();\n                            } else {\n                              const submitBtn = document.getElementById('withdrawSubmitButton') as HTMLButtonElement | null;\n                              submitBtn?.focus();\n                            }\n                          }\n                        }}\n                        placeholder=\"  \"\n                        type=\"number\"\n                        className=\"pl-10 h-10 text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-200\"\n                      />\n                    </div>\n                  </div>\n\n                {isWithdrawSenderNameInputEnabled && (\n                  <div className=\"fade-in-up\">\n                    <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                        ()\n                    </label>\n                    <div className=\"relative\">\n                      <User className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-500\" />\n                      <Input\n                        id=\"withdrawSenderNameInput\"\n                        value={withdrawSenderName}\n                        onChange={(e) => setWithdrawSenderName(e.target.value)}\n                        onKeyDown={(e) => {\n                          if (e.key === 'Enter') {\n                            const manualEl = document.getElementById('manualWithdrawCommissionInput') as HTMLInputElement | null;\n                            manualEl?.focus();\n                          }\n                        }}\n                        placeholder=\"    \"\n                        className=\"pl-10 h-10 text-sm lg:text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white transition-all duration-300 hover:border-blue-400 focus:border-blue-500\"\n                        type=\"text\"\n                      />\n                    </div>\n                  </div>\n                )}\n\n                  {(() => {\n                    const sw = getSelectedWalletObj();\n                    const hasDefault = sw && sw.defaultWithdrawCommission != null;\n                    if (hasDefault) {\n                      return (\n                        <div className=\"fade-in-up\">\n                          <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                              ()\n                          </label>\n                          <div className=\"text-xs text-gray-500 mt-1\">\n                                  : {sw?.defaultWithdrawCommission}   \n                          </div>\n                          <div className=\"mt-2 flex items-center gap-2\">\n                            <Button\n                            type=\"button\"\n                            variant=\"destructive\"\n                            size=\"sm\"\n                            className=\"bg-red-600 hover:bg-red-700 text-white font-medium\"\n                              onClick={() => {\n                                const swInner = getSelectedWalletObj();\n                                const baseAmount = parseFloat(amount || '0') || 0;\n                                const rate = swInner?.defaultWithdrawCommission != null ? Number(swInner.defaultWithdrawCommission) || 0 : 0;\n                                const commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\n                                const debtVal = isCommissionAddMode ? (baseAmount + commissionCalc) : baseAmount;\n                                setQuickDebtAmount((debtVal || 0).toString());\n                                if (isZeroPlan) {\n                                  toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n                                } else {\n                                  setIsQuickDebtOpen(true);\n                                }\n                              }}\n                            >\n                              \n                            </Button>\n                            <Button\n                              type=\"button\"\n                              variant=\"outline\"\n                              size=\"icon\"\n                              className=\"h-8 w-8\"\n                              onClick={() => setIsCommissionAddMode((prev) => !prev)}\n                              title={isCommissionAddMode ? '   ' : '   '}\n                            >\n                              {isCommissionAddMode ? (\n                                <Plus className=\"h-4 w-4\" />\n                              ) : (\n                                <Minus className=\"h-4 w-4\" />\n                              )}\n                            </Button>\n                            <span className=\"text-xs text-gray-600\">\n                              {isCommissionAddMode ? ' ' : ' '}\n                            </span>\n                          </div>\n                        </div>\n                      );\n                    }\n                    return (\n                      <div className=\"fade-in-up\">\n                        <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                              ()\n                        </label>\n                        <div className=\"relative\">\n                          <DollarSign className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-yellow-600\" />\n                          <Input\n                            id=\"manualWithdrawCommissionInput\"\n                            value={manualCommission}\n                            onChange={(e) => setManualCommission(e.target.value)}\n                            onKeyDown={(e) => {\n                              if (e.key === 'Enter') {\n                                const submitBtn = document.getElementById('withdrawSubmitButton') as HTMLButtonElement | null;\n                                submitBtn?.focus();\n                              }\n                            }}\n                            placeholder=\"  \"\n                            type=\"number\"\n                            className=\"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base bg-gray-50 border-gray-200 shadow-inner rounded-xl focus:bg-white transition-all duration-300 hover:border-blue-400 focus:border-blue-500\"\n                          />\n                        </div>\n                        <div className=\"text-xs text-gray-500 mt-1\">\n                               \n                        </div>\n                        <div className=\"mt-2 flex items-center gap-2\">\n                          <Button\n                            type=\"button\"\n                            variant=\"destructive\"\n                            size=\"sm\"\n                            className=\"bg-red-600 hover:bg-red-700 text-white font-medium\"\n                            onClick={() => {\n                              const swInner = getSelectedWalletObj();\n                              const baseAmount = parseFloat(amount || '0') || 0;\n                              let commissionCalc = 0;\n                              if (swInner?.defaultWithdrawCommission != null) {\n                                const rate = Number(swInner.defaultWithdrawCommission) || 0;\n                                commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\n                              } else {\n                                const manualFixed = manualCommission && manualCommission.trim() !== ''\n                                  ? parseFloat(manualCommission)\n                                  : Math.round((baseAmount * 0.01) * 100) / 100;\n                                commissionCalc = Math.max(0, manualFixed);\n                              }\n                              const debtVal = isCommissionAddMode ? (baseAmount + commissionCalc) : baseAmount;\n                              setQuickDebtAmount((debtVal || 0).toString());\n                              if (isZeroPlan) {\n                                toast({ title: ' ', description: '      .  .', variant: 'destructive' });\n                              } else {\n                                setIsQuickDebtOpen(true);\n                              }\n                            }}\n                          >\n                            \n                          </Button>\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            size=\"icon\"\n                            title={isCommissionAddMode ? ' ' : ' '}\n                            onClick={() => setIsCommissionAddMode(prev => !prev)}\n                          >\n                            {isCommissionAddMode ? <Plus className=\"h-4 w-4 text-green-600\" /> : <Minus className=\"h-4 w-4 text-red-600\" />}\n                          </Button>\n                          <span className=\"text-xs text-gray-600\">\n                            {isCommissionAddMode ? ' ' : ' '}\n                          </span>\n                        </div>\n                      </div>\n                    );\n                  })()}\n\n                  {/*    */}\n                  {profile?.showWithdrawNote && (\n                    <div className=\"fade-in-up\">\n                      <label className=\"text-sm font-medium text-gray-700 mb-1 block\">\n                          ()\n                      </label>\n                      <div className=\"relative group\">\n                        <MessageCircle className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-primary transition-colors\" />\n                        <Input\n                          id=\"withdrawNoteInput\"\n                          value={withdrawNote}\n                          onChange={(e) => setWithdrawNote(e.target.value)}\n                          onKeyDown={(e) => {\n                            if (e.key === 'Enter') {\n                              const submitBtn = document.getElementById('withdrawSubmitButton') as HTMLButtonElement | null;\n                              submitBtn?.focus();\n                            }\n                          }}\n                          placeholder=\"   ()\"\n                          className=\"pl-10 h-10 text-base border-gray-400 rounded-xl focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-200\"\n                        />\n                      </div>\n                    </div>\n                  )}\n\n                  <div className=\"sticky bottom-0 z-20 pt-2 pb-2 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 backdrop-blur supports-[backdrop-filter]:bg-white/90 dark:supports-[backdrop-filter]:bg-gray-900/90\">\n                    <Button\n                      id=\"withdrawSubmitButton\"\n                      onClick={handleTransaction}\n                      className=\"w-full font-medium h-11 lg:h-12 text-sm lg:text-base btn-bounce hover-glow transition-all duration-300 bg-green-600 hover:bg-green-700 text-white\"\n                    >\n                      {isWithdrawSuccess ? \"  \" : \" \"}\n                    </Button>\n                  </div>\n                </>\n              )}\n\n              {/*      */}\n              <Dialog open={isQuickDebtOpen} onOpenChange={setIsQuickDebtOpen}>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle> </DialogTitle>\n                    <DialogDescription>        </DialogDescription>\n                  </DialogHeader>\n                  <div className=\"space-y-3\">\n                    {customers && customers.length > 0 ? (\n                      <div>\n                        <Label> </Label>\n                        <Select value={quickDebtCustomerId} onValueChange={(val) => {\n                          setQuickDebtCustomerId(val);\n                          const selected = customers.find(c => c.id === val);\n                          if (selected) {\n                            setQuickDebtName(selected.name);\n                          }\n                        }}>\n                          <SelectTrigger className=\"w-full\">\n                            <SelectValue placeholder=\" \" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {customers.map(c => (\n                              <SelectItem key={c.id} value={c.id}>{c.name}{c.mobile ? `  ${c.mobile}` : ''}</SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    ) : (\n                      <div className=\"text-xs text-gray-500\">    .      .</div>\n                    )}\n                    <div>\n                      <Label htmlFor=\"quickDebtName\">  </Label>\n                      <Input id=\"quickDebtName\" value={quickDebtName} onChange={(e) => setQuickDebtName(e.target.value)} placeholder=\" \" />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"quickDebtAmount\"> ( )</Label>\n                      <Input id=\"quickDebtAmount\" type=\"number\" value={quickDebtAmount} readOnly placeholder=\" +  \" />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"quickDebtCommission\"> ( )</Label>\n                      <Input\n                        id=\"quickDebtCommission\"\n                        type=\"number\"\n                        value={(function () {\n                          const sw = getSelectedWalletObj();\n                          const baseAmount = parseFloat((amount || '0').toString()) || 0;\n                          let commissionCalc = 0;\n                          if (transactionType === 'transfer') {\n                            if (sw?.defaultTransferCommission != null) {\n                              const rate = Number(sw.defaultTransferCommission) || 0;\n                              commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\n                            } else {\n                              const manualFixed = transferCommission && transferCommission.trim() !== '' ? parseFloat(transferCommission) : 0;\n                              commissionCalc = Math.max(0, manualFixed);\n                            }\n                          } else {\n                            if (sw?.defaultWithdrawCommission != null) {\n                              const rate = Number(sw.defaultWithdrawCommission) || 0;\n                              commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\n                            } else {\n                              const manualFixed = manualCommission && manualCommission.trim() !== '' ? parseFloat(manualCommission) : Math.round((baseAmount * 0.01) * 100) / 100;\n                              commissionCalc = Math.max(0, manualFixed);\n                            }\n                          }\n                          return String(commissionCalc || 0);\n                        })()}\n                        readOnly\n                        placeholder=\" \"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"quickDebtNotes\"></Label>\n                      <Input id=\"quickDebtNotes\" value={quickDebtNotes} onChange={(e) => setQuickDebtNotes(e.target.value)} placeholder=\"  ()\" />\n                    </div>\n                  </div>\n                  <DialogFooter>\n                    <Button\n                      type=\"button\"\n                      variant=\"default\"\n                      className=\"bg-green-600 text-white hover:bg-green-700\"\n                      onClick={() => {\n                        const sw = getSelectedWalletObj();\n                        const baseAmount = parseFloat((amount || '').toString()) || 0;\n                        let commissionCalc = 0;\n                        if (transactionType === 'transfer') {\n                          if (sw?.defaultTransferCommission != null) {\n                            const rate = Number(sw.defaultTransferCommission) || 0;\n                            commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\n                          } else {\n                            const manualFixed = transferCommission && transferCommission.trim() !== '' ? parseFloat(transferCommission) : 0;\n                            commissionCalc = Math.max(0, manualFixed);\n                          }\n                        } else {\n                          if (sw?.defaultWithdrawCommission != null) {\n                            const rate = Number(sw.defaultWithdrawCommission) || 0;\n                            commissionCalc = Math.round(((rate * baseAmount) / 1000) * 100) / 100;\n                          } else {\n                            const manualFixed = manualCommission && manualCommission.trim() !== '' ? parseFloat(manualCommission) : Math.round((baseAmount * 0.01) * 100) / 100;\n                            commissionCalc = Math.max(0, manualFixed);\n                          }\n                        }\n                        let amountToSave = 0;\n                        if (transactionType === 'withdraw') {\n                          amountToSave = isCommissionAddMode\n                            ? baseAmount\n                            : Math.max(0, Math.round((baseAmount - commissionCalc) * 100) / 100);\n                        } else {\n                          //       \n                          amountToSave = Math.max(0, Math.round((baseAmount + commissionCalc) * 100) / 100);\n                        }\n                        if (!quickDebtName || isNaN(amountToSave) || amountToSave <= 0) {\n                          toast({ title: '   ', description: '     ', variant: 'destructive' });\n                          return;\n                        }\n                        const selectedCustomer = customers.find(c => c.id === quickDebtCustomerId);\n                        //              \n                        setQuickDebtInfo({ debtorName: quickDebtName, amount: amountToSave, notes: quickDebtNotes, customerId: quickDebtCustomerId || undefined, mobile: selectedCustomer?.mobile });\n                        setDidCreateQuickDebt(false);\n                        setIsQuickDebtOpen(false);\n                        toast({ title: '   ', description: '     ', variant: 'default' });\n                      }}\n                    >\n                      \n                    </Button>\n                  </DialogFooter>\n                </DialogContent>\n              </Dialog>\n            </CardContent>\n          </Card>\n\n          {/* Quick Actions */}\n          <Card className=\"bg-gradient-to-br from-red-50 to-red-100 border-red-200 fade-in-up card-float\">\n            <CardContent className=\"p-3 text-center\">\n              <div className=\"text-red-600 font-medium text-[10px] mb-1\">\n                   \n              </div>\n              <div className=\"text-[10px] text-red-700\">\n                         \n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n\n      </div>\n\n      {/* Wallet Management Modal */}\n      <WalletManagement\n        isOpen={isWalletManagementOpen}\n        onClose={() => setIsWalletManagementOpen(false)}\n        initialEditingWallet={editingWalletForDropdown}\n        onWalletUpdate={async () => {\n          try {\n            await loadWalletsFromFirebase();\n          } catch (error) {\n            console.error('Error reloading wallets after update:', error);\n          }\n        }}\n      />\n\n      {/* Transaction Details Modal */}\n      <TransactionDetailsModal\n        isOpen={isTransactionDetailsOpen}\n        onClose={() => setIsTransactionDetailsOpen(false)}\n        transaction={selectedTransaction}\n        onDelete={handleDeleteTransaction}\n      />\n\n      {/* Master PIN Dialog for Reset */}\n      <MasterPinDialog\n        open={isResetDialogOpen}\n        onOpenChange={setIsResetDialogOpen}\n        onSuccess={handleResetSuccess}\n        title={getResetDialogTitle()}\n        description={getResetDialogDescription()}\n        mode=\"verify\"\n      />\n\n\n\n\n      {/* Edit Cash Balance Dialog */}\n      <EditBalanceDialog\n        open={isEditCashDialogOpen}\n        onOpenChange={setIsEditCashDialogOpen}\n        onSuccess={handleEditCashSuccess}\n        title=\"    \"\n        description=\"         \"\n        currentBalance={cashBalance}\n        balanceLabel=\" \"\n        userId={user?.uid}\n      />\n\n      {/* Edit Wallet Balance Dialog */}\n      <EditBalanceDialog\n        open={isEditWalletDialogOpen}\n        onOpenChange={setIsEditWalletDialogOpen}\n        onSuccess={handleEditWalletBalanceSuccess}\n        title=\"  \"\n        description=\"       \"\n        currentBalance={editingWalletId ? (walletBalances[editingWalletId] || 0) : 0}\n        balanceLabel={` ${wallets.find(w => w.id === editingWalletId)?.name || ''}`}\n        userId={user?.uid}\n      />\n\n      {/* Add To Wallet Dialog */}\n      <AddToWalletDialog\n        open={isAddToWalletDialogOpen}\n        onOpenChange={setIsAddToWalletDialogOpen}\n        onSuccess={handleAddToWalletSuccess}\n        title=\"      \"\n        description=\"          \"\n        currentBalance={editingWalletId ? (walletBalances[editingWalletId] || 0) : 0}\n        balanceLabel={` ${wallets.find(w => w.id === editingWalletId)?.name || ''}`}\n        userId={user?.uid}\n      />\n\n      {/* Change Pin Dialog */}\n      <ChangePinDialog\n        open={isChangePinDialogOpen}\n        onOpenChange={setIsChangePinDialogOpen}\n        userId={user?.uid}\n      />\n\n      {/* Change Cash Pin Dialog */}\n      <ChangeCashPinDialog\n        open={isChangeCashPinDialogOpen}\n        onOpenChange={setIsChangeCashPinDialogOpen}\n        userId={user?.uid}\n      />\n\n      {/* Change Wallet Total Pin Dialog */}\n      <ChangeWalletTotalPinDialog\n        open={isChangeWalletTotalPinDialogOpen}\n        onOpenChange={setIsChangeWalletTotalPinDialogOpen}\n      />\n\n      {/* Cash Amount Dialog */}\n      <Dialog open={isCashAmountDialogOpen} onOpenChange={setIsCashAmountDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\">  </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-1 py-4\">\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"amount\" className=\"text-right block\">\n                \n              </Label>\n              <div className=\"flex gap-2 items-center\">\n                <Input\n                  id=\"amount\"\n                  type=\"number\"\n                  placeholder=\" \"\n                  value={cashAmountInput}\n                  onChange={(e) => setCashAmountInput(e.target.value)}\n                  className=\"text-right flex-1\"\n                  dir=\"rtl\"\n                  min=\"0\"\n                />\n                <div className=\"flex gap-1\">\n                  <Button\n                    type=\"button\"\n                    size=\"sm\"\n                    className=\"bg-green-600 hover:bg-green-700 text-white px-3 py-2\"\n                    onClick={async () => {\n                      //    \n                      if (!(await verifyCashDrawerPin(cashPinInput))) {\n                        toast({\n                          title: \"\",\n                          description: \"   \",\n                          variant: \"destructive\",\n                        });\n                        return;\n                      }\n\n                      //    \n                      const amount = parseFloat(cashAmountInput);\n                      if (isNaN(amount) || amount <= 0) {\n                        toast({\n                          title: \"\",\n                          description: \"   \",\n                          variant: \"destructive\",\n                        });\n                        return;\n                      }\n\n                      //  \n                      const newBalance = cashBalance + amount;\n                      setCashBalance(newBalance);\n\n                      //    Firebase  timestamp\n                      const updateData = {\n                        cashBalance: newBalance,\n                        lastUpdated: new Date().toISOString()\n                      };\n\n                      //       \n                      const localDataKey = `userData_${user?.uid}`;\n                      localStorage.setItem(localDataKey, JSON.stringify(updateData));\n\n                      //   Firebase   \n                      if (user?.uid) {\n                        userDataService.updateUserData(user.uid, updateData)\n                          .then(() => {\n                            console.log('       Firebase ');\n                            //      \n                            localStorage.removeItem(localDataKey);\n                            setHasLocalDataToSync(false);\n                          })\n                          .catch(error => {\n                            console.error('      Firebase:', error);\n                            setHasLocalDataToSync(true);\n                            //       Firebase\n                          });\n                      } else {\n                        setHasLocalDataToSync(true);\n                      }\n\n                      toast({\n                        title: \" \",\n                        description: `  ${amount}       `,\n                      });\n\n                      setIsCashAmountDialogOpen(false);\n                      setCashAmountInput('');\n                      setCashPinInput('');\n                    }}\n                  >\n                    <Plus className=\"h-1 w-1 mr-1\" />\n                    \n                  </Button>\n                  <Button\n                    type=\"button\"\n                    size=\"sm\"\n                    className=\"bg-red-600 hover:bg-red-700 text-white px-3 py-2\"\n                    onClick={async () => {\n                      //    \n                      if (!(await verifyCashDrawerPin(cashPinInput))) {\n                        toast({\n                          title: \"\",\n                          description: \"   \",\n                          variant: \"destructive\",\n                        });\n                        return;\n                      }\n\n                      //    \n                      const amount = parseFloat(cashAmountInput);\n                      if (isNaN(amount) || amount <= 0) {\n                        toast({\n                          title: \"\",\n                          description: \"   \",\n                          variant: \"destructive\",\n                        });\n                        return;\n                      }\n\n                      //  \n                      const newBalance = cashBalance - amount;\n                      setCashBalance(newBalance);\n\n                      //    Firebase  timestamp\n                      const updateData = {\n                        cashBalance: newBalance,\n                        lastUpdated: new Date().toISOString()\n                      };\n\n                      //       \n                      const localDataKey = `userData_${user?.uid}`;\n                      localStorage.setItem(localDataKey, JSON.stringify(updateData));\n\n                      //   Firebase  \n                      if (user?.uid) {\n                        userDataService.updateUserData(user.uid, updateData)\n                          .then(() => {\n                            console.log('       Firebase ');\n                            localStorage.removeItem(localDataKey);\n                            setHasLocalDataToSync(false);\n                          })\n                          .catch(error => {\n                            console.error('      Firebase:', error);\n                            setHasLocalDataToSync(true);\n                          });\n                      } else {\n                        setHasLocalDataToSync(true);\n                      }\n\n                      toast({\n                        title: \" \",\n                        description: `  ${amount}       `,\n                      });\n\n                      setIsCashAmountDialogOpen(false);\n                      setCashAmountInput('');\n                      setCashPinInput('');\n                    }}\n                  >\n                    <Minus className=\"h-1 w-1 mr-1\" />\n                    \n                  </Button>\n                </div>\n              </div>\n              <p className=\"text-[10px] text-gray-500 text-right\">\n                 : {cashBalance.toLocaleString()} \n              </p>\n            </div>\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"pin\" className=\"text-right block\">\n                 \n              </Label>\n              <Input\n                id=\"pin\"\n                type=\"password\"\n                placeholder=\"  \"\n                value={cashPinInput}\n                onChange={(e) => setCashPinInput(e.target.value)}\n                className=\"text-right\"\n                dir=\"rtl\"\n              />\n            </div>\n          </div>\n          <DialogFooter className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsCashAmountDialogOpen(false);\n                setCashAmountInput('');\n                setCashPinInput('');\n              }}\n            >\n              \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n\n\n      {/* Reset Wallet Total Dialog */}\n      <Dialog open={isResetWalletTotalDialogOpen} onOpenChange={setIsResetWalletTotalDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right text-red-600\">  </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-1 py-4\">\n            <div className=\"text-center p-4 bg-red-50 rounded-lg border border-red-200\">\n              <p className=\"text-red-800 font-medium mb-2\">!</p>\n              <p className=\"text-red-700 text-sm\">\n                      .      .\n              </p>\n              <p className=\"text-red-600 text-sm mt-2\">\n                 : {Object.values(walletBalances).reduce((sum, balance) => sum + balance, 0).toLocaleString()} \n              </p>\n            </div>\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"resetWalletTotalPin\" className=\"text-right block\">\n                  \n              </Label>\n              <Input\n                id=\"resetWalletTotalPin\"\n                type=\"password\"\n                placeholder=\"   \"\n                value={resetWalletTotalPinInput}\n                onChange={(e) => setResetWalletTotalPinInput(e.target.value)}\n                className=\"text-right\"\n                dir=\"rtl\"\n              />\n            </div>\n          </div>\n          <DialogFooter className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsResetWalletTotalDialogOpen(false);\n                setResetWalletTotalPinInput('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={async () => {\n                //     \n                const isValid = await MasterPinService.verifyMasterPin(resetWalletTotalPinInput, user?.uid);\n                if (!isValid) {\n                  toast({\n                    title: \"\",\n                    description: \"   \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                try {\n                  //    \n                  const updatedBalances: { [key: string]: number } = {};\n                  Object.keys(walletBalances).forEach(walletId => {\n                    updatedBalances[walletId] = 0;\n                  });\n\n                  //     \n                  setWalletBalances(updatedBalances);\n                  localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n\n                  //     \n                  setIsResetWalletTotalDialogOpen(false);\n                  setResetWalletTotalPinInput('');\n\n                  //    \n                  // toast({\n                  //   title: \"  \",\n                  //   description: \"      \",\n                  // });\n\n                  //   Firebase     \n                  const timestamp = new Date().toISOString();\n                  const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp } as any;\n                  const localDataKey = `userData_${user?.uid}`;\n                  localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                  if (user?.uid) {\n                    userDataService.updateUserData(user.uid, updateData)\n                      .then(() => {\n                        localStorage.removeItem(localDataKey);\n                        setHasLocalDataToSync(false);\n                      })\n                      .catch(error => {\n                        console.error('      Firebase:', error);\n                        setHasLocalDataToSync(true);\n                        toast({\n                          title: \"\",\n                          description: \"       \",\n                          variant: \"default\",\n                        });\n                      });\n                  } else {\n                    setHasLocalDataToSync(true);\n                  }\n\n                  //    \n                  setTimeout(() => {\n                    setWalletBalances({ ...updatedBalances });\n                  }, 100);\n\n                } catch (error) {\n                  console.error('    :', error);\n                  toast({\n                    title: \"\",\n                    description: \"    \",\n                    variant: \"destructive\",\n                  });\n                }\n              }}\n            >\n               \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Reset Selected Wallet Dialog */}\n      <Dialog open={isResetSelectedWalletDialogOpen} onOpenChange={setIsResetSelectedWalletDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right text-red-600\">   </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-1 py-4\">\n            <div className=\"text-center p-4 bg-red-50 rounded-lg border border-red-200\">\n              <p className=\"text-red-800 font-medium mb-2\">!</p>\n              <p className=\"text-red-700 text-sm\">\n                      .      .\n              </p>\n              <p className=\"text-red-600 text-sm mt-2\">\n                : {wallets.find(w => w.id === selectedWallet)?.name || selectedWallet}\n              </p>\n              <p className=\"text-red-600 text-sm\">\n                 : {(selectedWallet && walletBalances[selectedWallet] ? walletBalances[selectedWallet] : 0).toLocaleString()} \n              </p>\n            </div>\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"resetSelectedWalletPin\" className=\"text-right block\">\n                  \n              </Label>\n              <Input\n                id=\"resetSelectedWalletPin\"\n                type=\"password\"\n                autoComplete=\"off\"\n                placeholder=\"   \"\n                value={resetSelectedWalletPinInput}\n                onChange={(e) => setResetSelectedWalletPinInput(e.target.value)}\n                className=\"text-right\"\n                dir=\"rtl\"\n              />\n            </div>\n          </div>\n          <DialogFooter className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsResetSelectedWalletDialogOpen(false);\n                setResetSelectedWalletPinInput('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={async () => {\n                if (!selectedWallet) {\n                  toast({ title: ' ', description: '   ', variant: 'destructive' });\n                  return;\n                }\n                //     \n                const isValid = await MasterPinService.verifyMasterPin(resetSelectedWalletPinInput, user?.uid);\n                if (!isValid) {\n                  toast({\n                    title: '',\n                    description: '   ',\n                    variant: 'destructive',\n                  });\n                  return;\n                }\n\n                try {\n                  //    \n                  const updatedBalances: { [key: string]: number } = { ...walletBalances };\n                  updatedBalances[selectedWallet] = 0;\n\n                  //    \n                  setWalletBalances(updatedBalances);\n                  localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n\n                  //     \n                  setIsResetSelectedWalletDialogOpen(false);\n                  setResetSelectedWalletPinInput('');\n\n                  //   Firebase     \n                  const timestamp = new Date().toISOString();\n                  const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp } as any;\n                  const localDataKey = `userData_${user?.uid}`;\n                  localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                  if (user?.uid) {\n                    userDataService.updateUserData(user.uid, updateData)\n                      .then(() => {\n                        localStorage.removeItem(localDataKey);\n                        setHasLocalDataToSync(false);\n                      })\n                      .catch(error => {\n                        console.error('      Firebase:', error);\n                        setHasLocalDataToSync(true);\n                        toast({\n                          title: '',\n                          description: '       ',\n                          variant: 'default',\n                        });\n                      });\n                  } else {\n                    setHasLocalDataToSync(true);\n                  }\n\n                  toast({\n                    title: '  ',\n                    description: `    ${wallets.find(w => w.id === selectedWallet)?.name || selectedWallet}`,\n                  });\n                } catch (error) {\n                  console.error('     :', error);\n                  toast({\n                    title: '',\n                    description: '      ',\n                    variant: 'destructive',\n                  });\n                }\n              }}\n            >\n               \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*      */}\n      <Dialog open={isAddWalletTotalDialogOpen} onOpenChange={setIsAddWalletTotalDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right text-green-600 flex items-center gap-2 justify-end\">\n              <Plus className=\"h-4 w-4\" />\n                 \n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"text-center p-4 bg-green-50 rounded-lg border border-green-200\">\n              <p className=\"text-green-800 font-medium mb-2\"> </p>\n              <p className=\"text-green-700 text-sm\">\n                           .\n              </p>\n              <p className=\"text-green-600 text-sm mt-2\">\n                 : {Object.values(walletBalances).reduce((sum, balance) => sum + balance, 0).toLocaleString()} \n              </p>\n            </div>\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"addWalletTotalAmount\" className=\"text-right block\">\n                    \n                </Label>\n                <Input\n                  id=\"addWalletTotalAmount\"\n                  type=\"number\"\n                  placeholder=\" \"\n                  value={addWalletTotalAmountInput}\n                  onChange={(e) => setAddWalletTotalAmountInput(e.target.value)}\n                  className=\"text-right\"\n                  dir=\"rtl\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"addWalletTotalPin\" className=\"text-right block\">\n                    \n                </Label>\n                <Input\n                  id=\"addWalletTotalPin\"\n                  type=\"password\"\n                  autoComplete=\"off\"\n                  placeholder=\"  \"\n                  value={addWalletTotalPinInput}\n                  onChange={(e) => setAddWalletTotalPinInput(e.target.value)}\n                  className=\"text-right\"\n                  dir=\"rtl\"\n                />\n              </div>\n            </div>\n          </div>\n          <DialogFooter className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsAddWalletTotalDialogOpen(false);\n                setAddWalletTotalAmountInput('');\n                setAddWalletTotalPinInput('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              variant=\"default\"\n              className=\"bg-green-600 hover:bg-green-700\"\n              disabled={isAddingWalletTotal}\n              onClick={async () => {\n                //    \n                const amount = parseFloat(addWalletTotalAmountInput);\n                if (!amount || amount <= 0) {\n                  toast({\n                    title: \"\",\n                    description: \"   \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                //    \n                if (!(await verifyWalletTotalPin(addWalletTotalPinInput))) {\n                  toast({\n                    title: \"\",\n                    description: \"   \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                setIsAddingWalletTotal(true);\n\n                try {\n                  //    \n                  const currentTotal = Object.values(walletBalances).reduce((sum, balance) => sum + balance, 0);\n\n                  //        \n                  if (currentTotal === 0) {\n                    const walletIds = Object.keys(walletBalances);\n                    const amountPerWallet = amount / walletIds.length;\n                    const updatedBalances: { [key: string]: number } = {};\n\n                    walletIds.forEach(walletId => {\n                      updatedBalances[walletId] = amountPerWallet;\n                    });\n\n                    //     localStorage\n                    setWalletBalances(updatedBalances);\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n\n                    //   Firebase  \n                    if (user?.uid) {\n                      await userDataService.updateUserData(user.uid, { walletBalances: updatedBalances, lastUpdated: new Date().toISOString() });\n                    } else {\n                      setHasLocalDataToSync(true);\n                    }\n                  } else {\n                    //      \n                    const updatedBalances: { [key: string]: number } = {};\n\n                    Object.entries(walletBalances).forEach(([walletId, balance]) => {\n                      const ratio = balance / currentTotal;\n                      const additionalAmount = amount * ratio;\n                      updatedBalances[walletId] = balance + additionalAmount;\n                    });\n\n                    //     localStorage\n                    setWalletBalances(updatedBalances);\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n\n                    //   Firebase  \n                    if (user?.uid) {\n                      await userDataService.updateUserData(user.uid, { walletBalances: updatedBalances, lastUpdated: new Date().toISOString() });\n                    } else {\n                      setHasLocalDataToSync(true);\n                    }\n                  }\n\n                  //    \n                  setTimeout(() => {\n                    setWalletBalances(prev => ({ ...prev }));\n                  }, 100);\n\n                  // toast({\n                  //   title: \"   \",\n                  //   description: `  ${amount.toLocaleString()}    `,\n                  // });\n\n                  //    \n                  setIsAddWalletTotalDialogOpen(false);\n                  setAddWalletTotalAmountInput('');\n                  setAddWalletTotalPinInput('');\n                } catch (error) {\n                  console.error('      Firebase:', error);\n                  toast({\n                    title: \"\",\n                    description: \"    \",\n                    variant: \"destructive\",\n                  });\n                } finally {\n                  setIsAddingWalletTotal(false);\n                }\n              }}\n            >\n              {isAddingWalletTotal ? \" ...\" : \" \"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*     */}\n      <Dialog open={isResetCashDialogOpen} onOpenChange={setIsResetCashDialogOpen}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-red-600 flex items-center gap-2\">\n              <Trash2 className=\"h-1 w-1\" />\n                \n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-1\">\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\n              <p className=\"text-sm text-red-700\">\n                 :        .      .\n              </p>\n            </div>\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"resetCashPin\">  </Label>\n              <Input\n                id=\"resetCashPin\"\n                type=\"password\"\n                autoComplete=\"off\"\n                placeholder=\"   \"\n                value={resetCashPinInput}\n                onChange={(e) => setResetCashPinInput(e.target.value)}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsResetCashDialogOpen(false);\n                setResetCashPinInput('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={async () => {\n                if (!resetCashPinInput) {\n                  toast({\n                    title: \"\",\n                    description: \"   \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                const isValid = await MasterPinService.verifyMasterPin(resetCashPinInput, user?.uid);\n                if (!isValid) {\n                  toast({\n                    title: \"\",\n                    description: \"   \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                try {\n                  //    \n                  setCashBalance(0);\n\n                  //     \n                  setIsResetCashDialogOpen(false);\n                  setResetCashPinInput('');\n\n                  //    \n                  // toast({\n                  //   title: \"  \",\n                  //   description: \"       \",\n                  // });\n\n                  //     \n                  const updateData = { cashBalance: 0, lastUpdated: new Date().toISOString() };\n                  localStorage.setItem(getCashBalanceKey(), '0');\n                  localStorage.setItem(getCashBalanceKey() + '_lastUpdated', updateData.lastUpdated);\n                  const localDataKey = `userData_${user?.uid}`;\n                  localStorage.setItem(localDataKey, JSON.stringify(updateData));\n\n                  //   Firebase    fallback\n                  if (user?.uid) {\n                    userDataService.updateUserData(user.uid, updateData)\n                      .then(() => {\n                        localStorage.removeItem(localDataKey);\n                        setHasLocalDataToSync(false);\n                      })\n                      .catch(error => {\n                        console.error('     Firebase:', error);\n                        setHasLocalDataToSync(true);\n                        toast({\n                          title: \"\",\n                          description: \"       \",\n                          variant: \"default\",\n                        });\n                      });\n                  } else {\n                    setHasLocalDataToSync(true);\n                  }\n\n                } catch (error) {\n                  console.error('    :', error);\n                  toast({\n                    title: \"\",\n                    description: \"     \",\n                    variant: \"destructive\",\n                  });\n                }\n              }}\n            >\n               \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Cash Summary Dialog */}\n      <CashSummaryDialog\n        open={isCashSummaryOpen}\n        onOpenChange={setIsCashSummaryOpen}\n        userId={user?.uid}\n        cashBalance={cashBalance}\n        walletBalances={walletBalances}\n        transactions={transactions}\n      />\n\n      {/*     */}\n      <Dialog open={isAddCashDialogOpen} onOpenChange={setIsAddCashDialogOpen}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-green-600 flex items-center gap-2\">\n              <Plus className=\"h-4 w-4\" />\n                \n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"bg-green-50 border border-green-200 rounded-lg p-3\">\n              <p className=\"text-sm text-green-700\">\n                         \n              </p>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"addCashAmount\">  </Label>\n              <Input\n                id=\"addCashAmount\"\n                type=\"number\"\n                placeholder=\" \"\n                value={addCashAmountInput}\n                onChange={(e) => setAddCashAmountInput(e.target.value)}\n                min=\"0\"\n                step=\"0.01\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label className=\"text-right\">   </Label>\n              <div className=\"flex gap-2\">\n                <Button type=\"button\" variant={addCashNoteEnabled === 'yes' ? 'default' : 'outline'} onClick={() => setAddCashNoteEnabled('yes')} className=\"flex-1\"></Button>\n                <Button\n                  type=\"button\"\n                  variant={addCashNoteEnabled === 'no' ? 'default' : 'outline'}\n                  onClick={async () => {\n                    setAddCashNoteEnabled('no');\n                    if (!addCashAmountInput || parseFloat(addCashAmountInput) <= 0) {\n                      toast({ title: '', description: '      ', variant: 'destructive' });\n                      return;\n                    }\n                    if (!addCashPinInput) {\n                      toast({ title: '', description: '   ', variant: 'destructive' });\n                      return;\n                    }\n                    if (!(await verifyCashDrawerPin(addCashPinInput))) {\n                      toast({ title: '', description: '   ', variant: 'destructive' });\n                      return;\n                    }\n                    setIsAddingCash(true);\n                    try {\n                      const amountToAdd = parseFloat(addCashAmountInput);\n                      const newCashBalance = cashBalance + amountToAdd;\n                      setCashBalance(newCashBalance);\n                      const timestamp = new Date().toISOString();\n                      localStorage.setItem(getCashBalanceKey(), newCashBalance.toString());\n                      localStorage.setItem(getCashBalanceKey() + '_lastUpdated', timestamp);\n                      const updateData = { cashBalance: newCashBalance, lastUpdated: timestamp };\n                      const localDataKey = `userData_${user?.uid}`;\n                      localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                      const receiptRef = `CASHADD-${user?.uid || 'anon'}-${Date.now()}`;\n                      setIsAddCashDialogOpen(false);\n                      setAddCashAmountInput('');\n                      setAddCashPinInput('');\n                      setAddCashNoteEnabled(null);\n                      setAddCashNoteText('');\n                      const ops: Array<Promise<any>> = [];\n                      if (user?.uid) {\n                        ops.push(userDataService.updateUserData(user.uid, updateData).then(() => { localStorage.removeItem(localDataKey); setHasLocalDataToSync(false); }).catch(() => { setHasLocalDataToSync(true); }));\n                        const txToCloud: any = { txnType: 'cash_addition', type: 'cash_addition', amount: amountToAdd, status: 'confirmed', senderMsisdn: ' ', receiverMsisdn: '', reference: receiptRef, title: '  ', merchantUserId: user.uid, createdBy: user.uid, shopId: (profile as any)?.shopId || undefined };\n                        ops.push(userDataService.saveUserTransaction(user.uid, txToCloud));\n                        const shopId = (profile as any)?.shopId;\n                        if (shopId) {\n                          const dataRef = doc(db, 'dashboardData', shopId);\n                          ops.push(updateDoc(dataRef, { cashBalance: newCashBalance }));\n                        }\n                      }\n                      Promise.allSettled(ops).then(() => { }).catch(() => { });\n                    } catch (error) {\n                      setCashBalance(cashBalance);\n                      localStorage.setItem('cashBalance', cashBalance.toString());\n                      toast({ title: '', description: '        ', variant: 'destructive' });\n                    } finally {\n                      setIsAddingCash(false);\n                    }\n                  }}\n                  className=\"flex-1\"\n                >\n                  \n                </Button>\n              </div>\n            </div>\n            {addCashNoteEnabled === 'yes' && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"addCashNote\"></Label>\n                <Input id=\"addCashNote\" type=\"text\" placeholder=\" \" value={addCashNoteText} onChange={(e) => setAddCashNoteText(e.target.value)} />\n              </div>\n            )}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"addCashPin\">   </Label>\n              <Input\n                id=\"addCashPin\"\n                type=\"password\"\n                placeholder=\"  \"\n                value={addCashPinInput}\n                onChange={(e) => setAddCashPinInput(e.target.value)}\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsAddCashDialogOpen(false);\n                setAddCashAmountInput('');\n                setAddCashPinInput('');\n                setAddCashNoteEnabled(null);\n                setAddCashNoteText('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              variant=\"default\"\n              className=\"bg-green-600 hover:bg-green-700\"\n              disabled={isAddingCash}\n              onClick={async () => {\n                //    \n                if (!addCashAmountInput || parseFloat(addCashAmountInput) <= 0) {\n                  toast({\n                    title: \"\",\n                    description: \"      \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                if (!addCashPinInput) {\n                  toast({\n                    title: \"\",\n                    description: \"   \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                if (!(await verifyCashDrawerPin(addCashPinInput))) {\n                  toast({\n                    title: \"\",\n                    description: \"   \",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n\n                if (addCashNoteEnabled === 'yes' && addCashNoteText.trim().length === 0) {\n                  toast({ title: '', description: '    ', variant: 'destructive' });\n                  return;\n                }\n\n                setIsAddingCash(true);\n                try {\n                  const amountToAdd = parseFloat(addCashAmountInput);\n                  const newCashBalance = cashBalance + amountToAdd;\n                  setCashBalance(newCashBalance);\n                  const timestamp = new Date().toISOString();\n                  localStorage.setItem(getCashBalanceKey(), newCashBalance.toString());\n                  localStorage.setItem(getCashBalanceKey() + '_lastUpdated', timestamp);\n                  const updateData = { cashBalance: newCashBalance, lastUpdated: timestamp };\n                  const localDataKey = `userData_${user?.uid}`;\n                  localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                  const receiptRef = `CASHADD-${user?.uid || 'anon'}-${Date.now()}`;\n                  setIsAddCashDialogOpen(false);\n                  setAddCashAmountInput('');\n                  setAddCashPinInput('');\n                  setAddCashNoteEnabled(null);\n                  setAddCashNoteText('');\n                  const ops: Array<Promise<any>> = [];\n                  if (user?.uid) {\n                    ops.push(userDataService.updateUserData(user.uid, updateData).then(() => { localStorage.removeItem(localDataKey); setHasLocalDataToSync(false); }).catch(() => { setHasLocalDataToSync(true); }));\n                    const txToCloud: any = { txnType: 'cash_addition', type: 'cash_addition', amount: amountToAdd, status: 'confirmed', senderMsisdn: ' ', receiverMsisdn: '', reference: receiptRef, note: addCashNoteEnabled === 'yes' ? addCashNoteText.trim() : undefined, title: '  ', merchantUserId: user.uid, createdBy: user.uid, shopId: (profile as any)?.shopId || undefined };\n                    ops.push(userDataService.saveUserTransaction(user.uid, txToCloud));\n                    const shopId = (profile as any)?.shopId;\n                    if (shopId) {\n                      const dataRef = doc(db, 'dashboardData', shopId);\n                      ops.push(updateDoc(dataRef, { cashBalance: newCashBalance }));\n                    }\n                  }\n                  Promise.allSettled(ops).then(() => { }).catch(() => { });\n                } catch (error) {\n                  setCashBalance(cashBalance);\n                  localStorage.setItem('cashBalance', cashBalance.toString());\n                  toast({ title: '', description: '        ', variant: 'destructive' });\n                } finally {\n                  setIsAddingCash(false);\n                }\n              }}\n            >\n              {isAddingCash ? \" ...\" : \" \"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*     */}\n      <Dialog open={isDatePickerOpen} onOpenChange={setIsDatePickerOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\">   </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-1 py-4\">\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"search-date\" className=\"text-right block\"></Label>\n              <Input\n                id=\"search-date\"\n                type=\"date\"\n                value={selectedDate}\n                onChange={(e) => setSelectedDate(e.target.value)}\n                className=\"text-right\"\n              />\n            </div>\n            <div className=\"space-y-1\">\n              <Label htmlFor=\"search-time\" className=\"text-right block\"> ()</Label>\n              <Input\n                id=\"search-time\"\n                type=\"time\"\n                value={selectedTime}\n                onChange={(e) => setSelectedTime(e.target.value)}\n                className=\"text-right\"\n                placeholder=\"     \"\n              />\n              <p className=\"text-[10px] text-gray-500 text-right\">\n                         \n              </p>\n            </div>\n          </div>\n          <DialogFooter className=\"flex justify-between\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setSelectedDate('');\n                setSelectedTime('');\n                setIsDatePickerOpen(false);\n              }}\n            >\n              \n            </Button>\n            <Button onClick={() => setIsDatePickerOpen(false)}>\n              \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n\n\n      {/*       */}\n\n      {/*   */}\n      <CalculatorDialog\n        isOpen={isCalculatorOpen}\n        onClose={() => setIsCalculatorOpen(false)}\n      />\n\n      {/*    */}\n      <SalesDataDialog\n        isOpen={isSalesDataOpen}\n        onClose={() => setIsSalesDataOpen(false)}\n        initialBarcode={pendingBarcode}\n      />\n\n      {/*    */}\n      <CreditCardsDialog\n        isOpen={isCreditCardsOpen}\n        onClose={() => setIsCreditCardsOpen(false)}\n      />\n\n      {/*   */}\n      <MaintenanceDialog\n        open={isMaintenanceOpen}\n        onOpenChange={setIsMaintenanceOpen}\n      />\n\n      {/*    */}\n      <MachineDailyDialog\n        open={isMachineDailyDialogOpen}\n        onOpenChange={(open) => {\n          if (open && !isShiftHandoverAllowed) {\n            toast({\n              title: ' ',\n              description: '   :      .',\n              variant: 'destructive'\n            });\n            return;\n          }\n          setIsMachineDailyDialogOpen(open);\n        }}\n      />\n\n      {/*    */}\n      <CashierShiftModal\n        open={isCashierModalOpen}\n        onOpenChange={(open) => {\n          if (open && !isShiftHandoverAllowed) {\n            toast({\n              title: ' ',\n              description: '   :      .   .',\n              variant: 'destructive'\n            });\n            return;\n          }\n          setIsCashierModalOpen(open);\n        }}\n      />\n\n      {/*    */}\n      <ShiftProfileDialog\n        open={isShiftProfileOpen}\n        onOpenChange={(open) => {\n          if (open && !isShiftHandoverAllowed) {\n            toast({\n              title: ' ',\n              description: '   :      .   .',\n              variant: 'destructive'\n            });\n            return;\n          }\n          setIsShiftProfileOpen(open);\n        }}\n      />\n\n      {/*  -      */}\n      <MasterPinDialog\n        open={isReportsPinOpen}\n        onOpenChange={setIsReportsPinOpen}\n        onSuccess={() => setIsYourReportsOpen(true)}\n        title=\"\"\n        description=\"      \"\n        mode=\"verify\"\n      />\n\n      <Dialog open={isYourReportsOpen} onOpenChange={setIsYourReportsOpen}>\n        <DialogContent className=\"sm:max-w-xl\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <BarChart className=\"h-4 w-4 text-blue-600\" />\n               \n            </DialogTitle>\n            <DialogDescription>\n                   30     \n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {(() => {\n              const todayStr = new Date().toDateString();\n              const todayTx = transactions.filter((t: any) => {\n                const dt = new Date(t.createdAt).toDateString();\n                const st = String(t.status || 'completed').toLowerCase();\n                return dt === todayStr && (st === 'completed' || st === 'confirmed');\n              });\n              const totalTransactions = todayTx.length;\n              const totalAmount = todayTx.reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\n              const totalWithdrawn = todayTx.filter((t: any) => t.type === 'withdraw').reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\n              const totalSent = todayTx.filter((t: any) => t.type === 'send').reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\n              const profit = todayTx.reduce((s: number, t: any) => s + Number(reportsService.calculateTransactionProfit(t) || 0), 0);\n              return (\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div className=\"rounded-lg p-3 bg-gradient-to-r from-blue-50 to-slate-100 border\">\n                    <div className=\"text-xs text-blue-700\"> </div>\n                    <div className=\"text-lg font-bold text-blue-800\">{totalTransactions}</div>\n                  </div>\n                  <div className=\"rounded-lg p-3 bg-gradient-to-r from-indigo-50 to-slate-100 border\">\n                    <div className=\"text-xs text-indigo-700\"> </div>\n                    <div className=\"text-lg font-bold text-indigo-800\">{Number(totalAmount).toFixed(2)}</div>\n                  </div>\n                  <div className=\"rounded-lg p-3 bg-gradient-to-r from-red-50 to-slate-100 border\">\n                    <div className=\"text-xs text-red-700\"> </div>\n                    <div className=\"text-lg font-bold text-red-800\">{Number(totalWithdrawn).toFixed(2)}</div>\n                  </div>\n                  <div className=\"rounded-lg p-3 bg-gradient-to-r from-green-50 to-slate-100 border\">\n                    <div className=\"text-xs text-green-700\"> </div>\n                    <div className=\"text-lg font-bold text-green-800\">{Number(totalSent).toFixed(2)}</div>\n                  </div>\n                  <div className=\"col-span-2 rounded-lg p-3 bg-gradient-to-r from-amber-50 to-slate-100 border\">\n                    <div className=\"text-xs text-amber-700\"></div>\n                    <div className=\"text-lg font-bold text-amber-800\">{Number(profit).toFixed(2)}</div>\n                  </div>\n                </div>\n              );\n            })()}\n            <div className=\"flex items-center justify-between\">\n              <Button\n                variant=\"default\"\n                onClick={async () => {\n                  try {\n                    if (!user?.uid) return;\n                    const today = new Date();\n                    const yyyy = today.getFullYear();\n                    const mm = String(today.getMonth() + 1).padStart(2, '0');\n                    const dd = String(today.getDate()).padStart(2, '0');\n                    const reportDate = `${yyyy}-${mm}-${dd}`;\n                    const todayStr = today.toDateString();\n                    const todayTx = transactions.filter((t: any) => {\n                      const dt = new Date(t.createdAt).toDateString();\n                      const st = String(t.status || 'completed').toLowerCase();\n                      return dt === todayStr && (st === 'completed' || st === 'confirmed');\n                    });\n                    const totalTransactions = todayTx.length;\n                    const totalAmount = todayTx.reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\n                    const totalWithdrawn = todayTx.filter((t: any) => t.type === 'withdraw').reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\n                    const totalSent = todayTx.filter((t: any) => t.type === 'send').reduce((s: number, t: any) => s + Number(t.amount || 0), 0);\n                    const profit = todayTx.reduce((s: number, t: any) => s + Number(reportsService.calculateTransactionProfit(t) || 0), 0);\n                    await dailyReportsArchiveService.add({\n                      userId: user.uid,\n                      reportDate,\n                      totalTransactions,\n                      totalAmount: Number(totalAmount.toFixed(2)),\n                      totalWithdrawn: Number(totalWithdrawn.toFixed(2)),\n                      totalSent: Number(totalSent.toFixed(2)),\n                      profit: Number(profit.toFixed(2)),\n                      walletId: null\n                    });\n                    try { await dailyReportsArchiveService.trimToMaxCount(user.uid, 30); } catch { }\n                    toast({ title: ' ', description: `   ${reportDate}` });\n                  } catch (e) {\n                    toast({ title: ' ', description: '  ', variant: 'destructive' });\n                  }\n                }}\n              >\n                 \n              </Button>\n              <Button variant=\"outline\" onClick={() => setIsYourReportsOpen(false)}></Button>\n            </div>\n            <div className=\"mt-2 border-t pt-2\">\n              <div className=\"space-y-2 max-h-[40vh] overflow-auto\">\n                {reportArchives.length === 0 ? (\n                  <div className=\"text-xs text-muted-foreground\">   </div>\n                ) : (\n                  reportArchives.map((a) => (\n                    <div key={a.id || `${a.userId}-${a.reportDate}`} className=\"border rounded-md p-2 bg-gradient-to-r from-white/80 to-blue-50/70\">\n                      <div className=\"flex justify-between items-center\">\n                        <div className=\"font-bold text-blue-800\">{a.reportDate}</div>\n                        <div className=\"text-xs text-blue-700\"> : {a.totalTransactions}</div>\n                      </div>\n                      <div className=\"grid grid-cols-2 gap-2 mt-1\">\n                        <div className=\"text-xs text-blue-800\"> : <span className=\"font-semibold\">{Number(a.totalAmount).toFixed(2)}</span></div>\n                        <div className=\"text-xs text-blue-800\">: <span className=\"font-semibold\">{Number(a.totalWithdrawn).toFixed(2)}</span></div>\n                        <div className=\"text-xs text-blue-800\">: <span className=\"font-semibold\">{Number(a.totalSent).toFixed(2)}</span></div>\n                        <div className=\"text-xs text-blue-800\">: <span className=\"font-semibold\">{Number(a.profit ?? 0).toFixed(2)}</span></div>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/*    -   */}\n      <Dialog open={isTopUpOpen} onOpenChange={(open) => {\n        if (open) {\n          toast({ title: ' ', description: '    .' });\n          return;\n        }\n        setIsTopUpOpen(false);\n      }}>\n        <DialogContent dir=\"rtl\" className=\"sm:max-w-md w-[95vw] sm:w-auto rounded-2xl border border-emerald-200 shadow-xl bg-gradient-to-br from-white via-green-50 to-emerald-50 backdrop-blur-md data-[state=open]:animate-in data-[state=open]:fade-in-0 data-[state=open]:zoom-in-90 data-[state=open]:slide-in-from-bottom-8 duration-300\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right text-green-700\">  </DialogTitle>\n            <DialogDescription className=\"text-right text-gray-600\">    </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-3\">\n            <div>\n              <Label htmlFor=\"topupPhone\" className=\"text-right block\"> </Label>\n              <Input id=\"topupPhone\" value={topupPhone} onChange={(e) => setTopupPhone(e.target.value)} placeholder=\"010xxxxxxx\" className=\"text-right\" />\n            </div>\n\n            <div>\n              <Label className=\"text-right block\"> </Label>\n              <Select value={topupOperator} onValueChange={setTopupOperator}>\n                <SelectTrigger className=\"text-right\">\n                  <SelectValue placeholder=\" \" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"vodafone\"></SelectItem>\n                  <SelectItem value=\"orange\"></SelectItem>\n                  <SelectItem value=\"etisalat\"></SelectItem>\n                  <SelectItem value=\"we\">WE</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <Label htmlFor=\"topupAmount\" className=\"text-right block\"> </Label>\n              <Input id=\"topupAmount\" type=\"number\" value={topupAmount as number | ''} onChange={(e) => setTopupAmount(e.target.value ? Number(e.target.value) : '')} placeholder=\"50\" className=\"text-right\" />\n            </div>\n          </div>\n\n          <DialogFooter className=\"flex gap-2 justify-between\">\n            <Button variant=\"outline\" onClick={() => setIsTopUpOpen(false)} className=\"border-gray-300\"></Button>\n            <Button onClick={submitTopUp} disabled={topupLoading || !topupPhone || !topupOperator || !topupAmount} className=\"bg-emerald-600 hover:bg-emerald-700 text-white\">\n              {topupLoading ? ' ...' : ' '}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*       */}\n      <MasterPinDialog\n        open={isDebtsPasswordDialogOpen}\n        onOpenChange={setIsDebtsPasswordDialogOpen}\n        mode=\"verify\"\n        title=\"    \"\n        description=\"      \"\n        onSuccess={() => {\n          setIsDebtsPasswordDialogOpen(false);\n          setIsDebtsDialogOpen(true);\n        }}\n      />\n\n      <MasterPinDialog\n        open={isDebtsPinToggleOpen}\n        onOpenChange={setIsDebtsPinToggleOpen}\n        mode=\"verify\"\n        title=\"     \"\n        description=\"            \"\n        onSuccess={async () => {\n          if (pendingDebtsPinValue !== null) {\n            const nextVal = pendingDebtsPinValue;\n            setIsDebtsPinRequired(nextVal);\n            try {\n              const uid = user?.uid;\n              const key = uid ? `debtsPinRequired_${uid}` : 'debtsPinRequired';\n              localStorage.setItem(key, String(nextVal));\n              if (uid) await userDataService.updateUserData(uid, { debtsPinRequired: nextVal });\n            } catch { }\n            toast({\n              title: nextVal ? '     ' : '     ',\n              description: nextVal ? '       .' : '       .',\n            });\n          }\n          setPendingDebtsPinValue(null);\n          setIsDebtsPinToggleOpen(false);\n        }}\n      />\n\n      {/*       */}\n      <PasswordConfirmDialog\n        open={isResetRecentDialogOpen}\n        onOpenChange={setIsResetRecentDialogOpen}\n        title=\"     \"\n        description=\"        Firebase.\"\n        onSuccess={async () => {\n          try {\n            if (!user?.uid) {\n              setIsResetRecentDialogOpen(false);\n              return;\n            }\n            const resetAt = new Date();\n            const toJsDate = (v: any) => (v instanceof Date) ? v : (typeof v?.toDate === 'function') ? v.toDate() : new Date(String(v));\n\n            //        (   )\n            const toDelete = transactions.filter(t => toJsDate((t as any).createdAt) < resetAt);\n\n            //          .\n            //           .\n\n            //      Firestore    \n            await userDataService.updateUserData(user.uid, {\n              recentReset: {\n                keepLastCount: recentResetConfig.keepLastCount ?? 30,\n                intervalDays: recentResetConfig.intervalDays ?? 7,\n                lastResetAt: resetAt\n              }\n            });\n            setRecentResetConfig(cfg => ({ ...cfg, lastResetAt: resetAt }));\n\n            toast({ title: '   ', description: '              /  .' });\n          } catch (e) {\n            console.error('   :', e);\n            toast({ title: ' ', description: '     .', variant: 'destructive' });\n          } finally {\n            setIsResetRecentDialogOpen(false);\n          }\n        }}\n      />\n\n      {/*       */}\n      <MasterPinDialog\n        open={isShopExpensesPinDialogOpen}\n        onOpenChange={setIsShopExpensesPinDialogOpen}\n        mode=\"verify\"\n        title=\"    \"\n        description=\"       \"\n        onSuccess={() => {\n          setIsShopExpensesPinDialogOpen(false);\n          setIsShopExpensesDialogOpen(true);\n        }}\n      />\n\n      {/*    */}\n      <Dialog open={isDebtsDialogOpen} onOpenChange={setIsDebtsDialogOpen}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader className=\"flex items-center justify-between\">\n            <DialogTitle className=\"text-right\"> </DialogTitle>\n            <div className=\"flex items-center gap-1 text-orange-700\">\n              <Banknote className=\"h-4 w-4\" />\n              <span className=\"text-xs font-bold\">{totalOutstandingDebts} </span>\n            </div>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"flex items-center justify-center gap-2\">\n              <Button variant={debtRole === 'debtor' ? 'default' : 'outline'} onClick={() => setDebtRole('debtor')}></Button>\n              <Button variant={debtRole === 'creditor' ? 'default' : 'outline'} onClick={() => setDebtRole('creditor')}></Button>\n            </div>\n            {(debtRole === 'creditor' || debtRole === 'debtor') && (\n              <div className=\"grid grid-cols-4 items-center gap-4\">\n                <Label htmlFor=\"debtorName\" className=\"text-right col-span-1\">\n                  {debtRole === 'creditor' ? ' ' : ' '}\n                </Label>\n                <Input \n                  id=\"debtorName\" \n                  value={debtorName} \n                  onChange={(e) => setDebtorName(e.target.value)} \n                  className=\"col-span-3 text-right\" \n                  placeholder={debtRole === 'creditor' ? \"  \" : \"  \"} \n                />\n              </div>\n            )}\n            {debtRole && (\n              <>\n                <div className=\"grid grid-cols-4 items-center gap-4\">\n                  <Label htmlFor=\"debtAmount\" className=\"text-right col-span-1\"></Label>\n                  <Input id=\"debtAmount\" type=\"number\" value={debtAmount} onChange={(e) => setDebtAmount(e.target.value)} className=\"col-span-3 text-right\" placeholder=\" \" />\n                </div>\n                <div className=\"grid grid-cols-4 items-center gap-4\">\n                  <Label htmlFor=\"debtReason\" className=\"text-right col-span-1\"> </Label>\n                  <Input id=\"debtReason\" value={debtReason} onChange={(e) => setDebtReason(e.target.value)} className=\"col-span-3 text-right\" placeholder=\"  \" />\n                </div>\n              </>\n            )}\n          </div>\n          <DialogFooter>\n            <Button\n              onClick={() => {\n                const isDebtor = debtRole === 'debtor';\n                const isCreditor = debtRole === 'creditor';\n                if (!isDebtor && !isCreditor) {\n                  toast({ title: '  ', description: '     ', variant: 'destructive' });\n                  return;\n                }\n                if (!debtAmount || !debtReason || !debtorName) {\n                  toast({ title: '  ', description: '    ', variant: 'destructive' });\n                  return;\n                }\n                const newDebt: Debt = {\n                  id: Date.now().toString(),\n                  debtorName: debtorName,\n                  amount: parseFloat(debtAmount),\n                  reason: debtReason,\n                  status: 'pending',\n                  createdAt: new Date(),\n                  paidAmount: 0,\n                  partialPayments: [],\n                  type: debtRole || 'creditor' // Default to 'creditor' (Receivable) if not set\n                };\n                setPendingDebtToCreate(newDebt);\n                setIsDebtDeductionChoiceOpen(true);\n              }}\n              className=\"bg-orange-500 hover:bg-orange-600\"\n            >\n              \n            </Button>\n          </DialogFooter>\n\n          {/*         */}\n          <div className=\"mt-2\">\n            <Button\n              variant=\"outline\"\n              className=\"w-full\"\n              onClick={() => setIsDebtReceiptsListOpen(true)}\n            >\n               \n            </Button>\n          </div>\n          {/*        */}\n          <div className=\"mt-2\">\n            <Button\n              variant=\"outline\"\n              className=\"w-full\"\n              onClick={() => setIsAddCustomerDialogOpen(true)}\n            >\n               \n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/*     */}\n      <Dialog open={isDebtReceiptsListOpen} onOpenChange={setIsDebtReceiptsListOpen}>\n        <DialogContent className=\"w-[95vw] sm:w-auto sm:max-w-[520px] rounded-2xl\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\"> </DialogTitle>\n            <DialogDescription className=\"text-right\">\n                  \n            </DialogDescription>\n          </DialogHeader>\n          {debts.length > 0 ? (\n            <div\n              className=\"max-h-[70vh] overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 space-y-2 px-1 -mx-1 sm:mx-0 sm:px-0\"\n              style={{ contain: 'layout paint' }}\n              onScroll={(e) => {\n                const target = e.currentTarget;\n                if (visibleDebts.length < debts.length) {\n                  if (target.scrollTop + target.clientHeight >= target.scrollHeight - 50) {\n                    setDebtsPage((p) => p + 1);\n                  }\n                }\n              }}\n            >\n              {visibleDebts.map((debt) => (\n                <div\n                  key={debt.id}\n                  onClick={() => {\n                    setSelectedDebt(debt);\n                    setIsDebtReceiptOpen(true);\n                    //         \n                    setIsDebtReceiptsListOpen(false);\n                    //        \n                    setIsDebtsDialogOpen(false);\n                  }}\n                  className={`p-4 sm:p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors min-h-[64px] ${debt.type === 'debtor' ? 'border-r-4 border-r-red-500 bg-red-50/10' : 'border-r-4 border-r-emerald-500'}`}\n                >\n                  <div className=\"flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center\">\n                    <div className=\"text-right space-y-0.5\">\n                      <div className=\"flex items-center gap-2\">\n                         <p className=\"font-medium text-[14px] sm:text-sm\">{debt.debtorName}</p>\n                         {debt.type === 'debtor' && <Badge variant=\"destructive\" className=\"h-5 text-[10px] px-1\"></Badge>}\n                         {(!debt.type || debt.type === 'creditor') && <Badge variant=\"outline\" className=\"h-5 text-[10px] px-1 text-emerald-700 border-emerald-200 bg-emerald-50\"></Badge>}\n                      </div>\n                      <p className=\"text-[13px] sm:text-sm text-gray-600\">{debt.reason}</p>\n                      <p className=\"text-[12px] sm:text-sm text-gray-500\">\n                        {dateFormatter.format(debt.createdAt instanceof Date ? debt.createdAt : new Date(debt.createdAt))}\n                      </p>\n                    </div>\n                    <div className=\"text-left\">\n                      <p className=\"font-bold text-xl sm:text-lg\">{debt.amount} </p>\n                      <Badge\n                        variant={debt.status === 'paid' ? 'default' : 'secondary'}\n                        className={`${debt.status === 'paid' ? 'bg-green-500' : 'bg-yellow-500'} text-[12px] sm:text-xs`}\n                      >\n                        {debt.status === 'paid' ? '' : ' '}\n                      </Badge>\n                    </div>\n                  </div>\n                </div>\n              ))}\n              {visibleDebts.length < debts.length && (\n                <div className=\"flex justify-center pt-1\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setDebtsPage(p => p + 1)}\n                  >\n                     \n                  </Button>\n                </div>\n              )}\n            </div>\n          ) : (\n            <div className=\"text-center text-sm text-gray-500\">   </div>\n          )}\n\n          {/*       */}\n          <DialogFooter className=\"flex justify-between mt-3\">\n            <Button\n              variant=\"destructive\"\n              onClick={async () => {\n                try {\n                  if (!debts || debts.length === 0) {\n                    toast({ title: '  ', description: '  .' });\n                    return;\n                  }\n                  const confirmed = window.confirm('           .');\n                  if (!confirmed) return;\n                  const cleared: Debt[] = [];\n                  \n                  // Delete all debts from Firestore collection explicitly - DISABLED\n                  /*\n                  if (user?.uid && debts.length > 0) {\n                     debts.forEach(d => {\n                         if (d.id) {\n                             deleteDoc(doc(db, 'debts', d.id)).catch(e => console.error('Failed to delete debt doc:', d.id, e));\n                         }\n                     });\n                  }\n                  */\n\n                  setDebts(cleared);\n                  setSelectedDebt(null);\n                  //      Firebase  \n                  await saveDebtsToStorage(cleared);\n                  if (user?.uid) {\n                    try {\n                      await userDataService.updateUserData(user.uid, { debts: [], debtsDeletedAt: serverTimestamp() });\n                      try { localStorage.removeItem(`debts_unsynced_${user.uid}`); } catch { }\n                    } catch (e) {\n                      console.error('    Firebase:', e);\n                      toast({ title: '   ', description: '    Firebase   .', variant: 'destructive' });\n                      return;\n                    }\n                  }\n                  toast({ title: '    ', description: '   .' });\n                  setIsDebtReceiptsListOpen(false);\n                } catch (e) {\n                  console.error('    :', e);\n                  toast({ title: ' ', description: '      .', variant: 'destructive' });\n                }\n              }}\n            >\n                \n            </Button>\n            <Button variant=\"outline\" onClick={() => setIsDebtReceiptsListOpen(false)}>\n              \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*         -   */}\n      <Dialog open={isAddCustomerDialogOpen} onOpenChange={setIsAddCustomerDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px] w-full max-h-[90vh] overflow-hidden flex flex-col p-0 gap-0 bg-gray-50/50\">\n          <div className=\"p-4 border-b bg-white\">\n            <DialogHeader>\n              <DialogTitle className=\"text-right flex items-center justify-end gap-2\">\n                <User className=\"w-5 h-5 text-primary\" />\n                  \n              </DialogTitle>\n              <DialogDescription className=\"text-right\">\n                    \n              </DialogDescription>\n            </DialogHeader>\n          </div>\n\n          <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n            {/*     */}\n            <Card className=\"border shadow-sm bg-white\">\n              <CardHeader className=\"pb-2 pt-4 px-4\">\n                <CardTitle className=\"text-sm font-medium text-right text-gray-700 flex items-center justify-end gap-2\">\n                  <Plus className=\"w-4 h-4\" />\n                    \n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4 pt-2 space-y-3\">\n                <div className=\"space-y-1\">\n                  <Label className=\"text-right block text-xs text-gray-500\"> </Label>\n                  <Input\n                    value={newCustomerName}\n                    onChange={(e) => setNewCustomerName(e.target.value)}\n                    className=\"text-right h-9\"\n                    placeholder=\"  \"\n                  />\n                </div>\n                <div className=\"space-y-1\">\n                  <Label className=\"text-right block text-xs text-gray-500\"> </Label>\n                  <Input\n                    value={newCustomerMobile}\n                    onChange={(e) => setNewCustomerMobile(e.target.value)}\n                    className=\"text-right h-9\"\n                    placeholder=\"  \"\n                  />\n                </div>\n                <Button\n                  className=\"w-full bg-emerald-600 hover:bg-emerald-700 text-white h-9 mt-2\"\n                  onClick={async () => {\n                    if (!newCustomerName || !newCustomerMobile) {\n                      toast({ title: '  ', description: '     ', variant: 'destructive' });\n                      return;\n                    }\n                    const newCustomer: Customer = {\n                      id: Date.now().toString(),\n                      name: newCustomerName.trim(),\n                      mobile: newCustomerMobile.trim(),\n                      createdAt: new Date(),\n                    };\n                    const updated = [newCustomer, ...customers];\n                    await saveCustomersToStorage(updated);\n                    setNewCustomerName('');\n                    setNewCustomerMobile('');\n                    toast({ title: '  ', description: `  ${newCustomer.name}` });\n                  }}\n                >\n                  <Plus className=\"w-4 h-4 mr-2\" />\n                   \n                </Button>\n              </CardContent>\n            </Card>\n\n            {/*    (     ) */}\n            <Card className=\"border shadow-sm bg-white\">\n              <CardHeader className=\"pb-2 pt-4 px-4\">\n                <CardTitle className=\"text-sm font-medium text-right text-gray-700 flex items-center justify-end gap-2\">\n                  <DollarSign className=\"w-4 h-4 text-orange-600\" />\n                    \n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4 pt-2 space-y-3\">\n                {customers.length > 0 ? (\n                  <>\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-right block text-xs text-gray-500\"> </Label>\n                      <Select value={selectedCustomerId} onValueChange={setSelectedCustomerId}>\n                        <SelectTrigger className=\"w-full h-9 text-right\" dir=\"rtl\">\n                          <SelectValue placeholder=\" \" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {customers.map(c => (\n                            <SelectItem key={c.id} value={c.id} className=\"text-right justify-end\">{c.name}  {c.mobile}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      {selectedCustomerId && (() => {\n                        const totalDebt = debts\n                          .filter(d => d.customerId === selectedCustomerId && d.status === 'pending')\n                          .reduce((sum, d) => sum + (d.amount - (d.paidAmount || 0)), 0);\n                        \n                        if (totalDebt > 0) {\n                          return (\n                            <div className=\"text-xs text-red-600 font-semibold mt-1 text-right\">\n                                : {totalDebt.toFixed(2)} \n                            </div>\n                          );\n                        }\n                        return null;\n                      })()}\n                    </div>\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-right block text-xs text-gray-500\"></Label>\n                      <Input\n                        type=\"number\"\n                        value={customerDebtAmount}\n                        onChange={(e) => setCustomerDebtAmount(e.target.value)}\n                        className=\"text-right h-9\"\n                        placeholder=\"0.00\"\n                      />\n                    </div>\n                    <Button\n                      className=\"w-full bg-orange-600 hover:bg-orange-700 text-white h-9 mt-2\"\n                      onClick={async () => {\n                        const amt = parseFloat(customerDebtAmount);\n                        if (!selectedCustomerId) {\n                          toast({ title: ' ', description: '   ', variant: 'destructive' });\n                          return;\n                        }\n                        if (isNaN(amt) || amt <= 0) {\n                          toast({ title: '  ', description: '   ', variant: 'destructive' });\n                          return;\n                        }\n                        const customer = customers.find(c => c.id === selectedCustomerId);\n                        if (!customer) return;\n                        const newDebt: Debt = {\n                          id: Date.now().toString(),\n                          debtorName: customer.name,\n                          customerId: customer.id,\n                          mobile: customer.mobile,\n                          amount: Number(amt.toFixed(2)),\n                          reason: ' ',\n                          status: 'pending',\n                          createdAt: new Date(),\n                          paidAmount: 0,\n                          partialPayments: []\n                        };\n                        setPendingDebtToCreate(newDebt);\n                        setIsDebtDeductionChoiceOpen(true);\n                      }}\n                    >\n                        \n                    </Button>\n                  </>\n                ) : (\n                  <div className=\"text-center py-4 text-gray-500 text-sm bg-gray-50 rounded border border-dashed\">\n                       .   .\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/*    */}\n            <Card className=\"border shadow-sm bg-white\">\n              <CardHeader className=\"pb-2 pt-4 px-4\">\n                <CardTitle className=\"text-sm font-medium text-right text-gray-700 flex items-center justify-end gap-2\">\n                  <Notebook className=\"w-4 h-4\" />\n                    ({customers.length})\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4 pt-2\">\n                {customers.length > 0 ? (\n                  <div className=\"space-y-2\">\n                    {customers.map((c) => (\n                      <div key={c.id} className=\"p-3 border rounded-lg flex items-center justify-between bg-gray-50 hover:bg-gray-100 transition-colors\">\n                        <div className=\"flex gap-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"h-8 w-8 text-blue-600 hover:text-blue-700 hover:bg-blue-50\"\n                            onClick={() => {\n                              setEditingCustomerId(c.id);\n                              setEditingCustomerName(c.name || '');\n                              setEditingCustomerMobile(c.mobile || '');\n                              setIsEditCustomerDialogOpen(true);\n                            }}\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50\"\n                            onClick={() => {\n                              setCustomerToDeleteId(c.id);\n                              setCustomerToDeleteName(c.name || '');\n                              setIsDeleteCustomerConfirmOpen(true);\n                            }}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                        <div className=\"text-right\">\n                          <div className=\"font-medium text-sm text-gray-900\">{c.name}</div>\n                          <div className=\"text-xs text-gray-500 font-mono\">{c.mobile}</div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-4 text-gray-400 text-sm\">\n                       \n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n\n          <DialogFooter className=\"p-4 border-t bg-white\">\n            <Button variant=\"outline\" className=\"w-full sm:w-auto\" onClick={() => setIsAddCustomerDialogOpen(false)}></Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isDeleteCustomerConfirmOpen} onOpenChange={setIsDeleteCustomerConfirmOpen}>\n        <DialogContent hideClose className=\"sm:max-w-[420px] rounded-2xl bg-gradient-to-br from-white via-rose-50 to-red-50 shadow-2xl border border-red-100 text-center\">\n          <DialogHeader>\n            <DialogTitle className=\"text-center text-xl font-bold text-red-700\">  </DialogTitle>\n            <DialogDescription className=\"text-center text-gray-600\">   : {customerToDeleteName}</DialogDescription>\n          </DialogHeader>\n          <div className=\"py-2 text-sm text-gray-700\">     .</div>\n          <DialogFooter className=\"flex justify-center gap-3\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsDeleteCustomerConfirmOpen(false);\n                setCustomerToDeleteId('');\n                setCustomerToDeleteName('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              variant=\"destructive\"\n              className=\"bg-red-600 hover:bg-red-700\"\n              onClick={async () => {\n                const id = customerToDeleteId;\n                const updated = customers.filter(x => x.id !== id);\n                await saveCustomersToStorage(updated);\n                if (selectedCustomerId === id) setSelectedCustomerId('');\n                setIsDeleteCustomerConfirmOpen(false);\n                setCustomerToDeleteId('');\n                setCustomerToDeleteName('');\n                toast({ title: '  ', description: customerToDeleteName });\n              }}\n            >\n               \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isEditCustomerDialogOpen} onOpenChange={setIsEditCustomerDialogOpen}>\n        <DialogContent className=\"sm:max-w-[420px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\">  </DialogTitle>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"editCustomerName\" className=\"text-right col-span-1\"></Label>\n              <Input id=\"editCustomerName\" value={editingCustomerName} onChange={(e) => setEditingCustomerName(e.target.value)} className=\"col-span-3 text-right\" />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"editCustomerMobile\" className=\"text-right col-span-1\"></Label>\n              <Input id=\"editCustomerMobile\" value={editingCustomerMobile} onChange={(e) => setEditingCustomerMobile(e.target.value)} className=\"col-span-3 text-right\" />\n            </div>\n          </div>\n          <DialogFooter className=\"flex justify-between\">\n            <Button variant=\"outline\" onClick={() => setIsEditCustomerDialogOpen(false)}></Button>\n            <Button\n              className=\"bg-green-600 hover:bg-green-700\"\n              onClick={async () => {\n                const id = editingCustomerId;\n                const name = editingCustomerName.trim();\n                const mobile = editingCustomerMobile.trim();\n                if (!id || !name || !mobile) {\n                  toast({ title: '  ', description: '   ', variant: 'destructive' });\n                  return;\n                }\n                const updated = customers.map(c => c.id === id ? { ...c, name, mobile } : c);\n                await saveCustomersToStorage(updated);\n                const updatedDebts = debts.map(d => d.customerId === id ? { ...d, debtorName: name, mobile } : d);\n                if (updatedDebts !== debts) {\n                  setDebts(updatedDebts);\n                  await saveDebtsToStorage(updatedDebts);\n                  \n                  // Sync updated debts to collection - DISABLED\n                  /*\n                  if (user?.uid) {\n                      updatedDebts.forEach(d => {\n                          if (d.customerId === id && d.id) {\n                              const debtRef = doc(db, 'debts', d.id);\n                              const p: any = { \n                                  ...d, \n                                  userId: user.uid, \n                                  shopId: shopIdCtx || profile?.shopId || null, \n                                  lastUpdated: new Date().toISOString() \n                              };\n                              Object.keys(p).forEach(key => p[key] === undefined && delete p[key]);\n                              setDoc(debtRef, p, { merge: true }).catch(e => console.error('Failed to update debt doc:', d.id, e));\n                          }\n                      });\n                  }\n                  */\n                }\n                setIsEditCustomerDialogOpen(false);\n                setEditingCustomerId('');\n                setEditingCustomerName('');\n                setEditingCustomerMobile('');\n                toast({ title: '  ', description: name });\n              }}\n            >\n              \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*    */}\n      <Dialog open={isShopExpensesDialogOpen} onOpenChange={setIsShopExpensesDialogOpen}>\n        <DialogContent className=\"sm:max-w-[520px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\"> </DialogTitle>\n            <DialogDescription className=\"text-right\">\n                    .\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"expenseName\" className=\"text-right col-span-1\">\n                 \n              </Label>\n              <Input\n                id=\"expenseName\"\n                value={expenseName}\n                onChange={(e) => setExpenseName(e.target.value)}\n                className=\"col-span-3 text-right\"\n                placeholder=\":   \"\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"expenseAmount\" className=\"text-right col-span-1\">\n                 \n              </Label>\n              <Input\n                id=\"expenseAmount\"\n                type=\"number\"\n                value={expenseAmount}\n                onChange={(e) => setExpenseAmount(e.target.value)}\n                className=\"col-span-3 text-right\"\n                placeholder=\"0.00\"\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"expenseNotes\" className=\"text-right col-span-1\">\n                \n              </Label>\n              <Input\n                id=\"expenseNotes\"\n                value={expenseNotes}\n                onChange={(e) => setExpenseNotes(e.target.value)}\n                className=\"col-span-3 text-right\"\n                placeholder=\"   \"\n              />\n            </div>\n          </div>\n          <DialogFooter className=\"flex justify-between\">\n            <Button\n              className=\"bg-orange-600 hover:bg-orange-700\"\n              onClick={() => {\n                if (!expenseName || !expenseAmount) {\n                  toast({ title: '  ', description: '    ', variant: 'destructive' });\n                  return;\n                }\n                setIsExpenseDeductionChoiceOpen(true);\n              }}\n            >\n               \n            </Button>\n            {/*        */}\n            <Button variant=\"outline\" onClick={() => setIsReceiptsDialogOpen(true)}> </Button>\n          </DialogFooter>\n\n\n        </DialogContent>\n      </Dialog>\n\n      {/*     */}\n      <Dialog open={isReceiptsDialogOpen} onOpenChange={setIsReceiptsDialogOpen}>\n        <DialogContent className=\"sm:max-w-[420px]\" dir=\"rtl\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\"> </DialogTitle>\n            <DialogDescription className=\"text-right\">  </DialogDescription>\n          </DialogHeader>\n          {expenses.length > 0 ? (\n            <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n              {expenses.map((ex) => (\n                <div key={ex.id} className=\"p-2 border rounded-lg bg-white hover:bg-gray-50 transition-colors\">\n                  <div className=\"flex justify-between items-start\">\n                    <div className=\"text-right\">\n                      <p className=\"font-medium text-sm\">{ex.name}</p>\n                      <p className=\"text-[11px] text-gray-600\">{ex.notes || ' '}</p>\n                      <p className=\"text-[10px] text-gray-500\">{new Date(ex.createdAt).toLocaleString('ar-EG')}</p>\n                    </div>\n                    <div className=\"text-left flex items-start gap-2\">\n                      <div className=\"text-left\">\n                        <p className=\"font-bold text-sm\">{ex.amount} </p>\n                        <Badge variant=\"secondary\" className={ex.source === 'cash' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'}>\n                          {ex.source === 'cash' ? ' ' : ` ${ex.walletId ? ` (${ex.walletId})` : ''}`}\n                        </Badge>\n                      </div>\n                      <Button\n                        variant=\"destructive\"\n                        size=\"sm\"\n                        className=\"shrink-0\"\n                        onClick={() => permanentlyDeleteExpense(ex.id)}\n                        title=\" \"\n                      >\n                        <Trash2 className=\"w-4 h-4 ml-1\" />\n                        \n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <p className=\"text-sm text-gray-500 text-center\">    </p>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/*      */}\n      <Dialog open={isExpenseDeductionChoiceOpen} onOpenChange={setIsExpenseDeductionChoiceOpen}>\n        <DialogContent className=\"sm:max-w-[480px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\">   </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <p className=\"text-sm text-gray-600 text-right\">\n                            .\n            </p>\n            <div className=\"grid grid-cols-3 gap-3\">\n              <Button\n                variant={expenseDeductionSource === 'cash' ? 'default' : 'outline'}\n                className={expenseDeductionSource === 'cash' ? 'bg-blue-600 hover:bg-blue-700 text-white' : ''}\n                onClick={() => setExpenseDeductionSource('cash')}\n              >\n                 \n              </Button>\n              <Button\n                variant={expenseDeductionSource === 'wallet' ? 'default' : 'outline'}\n                className={expenseDeductionSource === 'wallet' ? 'bg-purple-600 hover:bg-purple-700 text-white' : ''}\n                onClick={() => setExpenseDeductionSource('wallet')}\n              >\n                 \n              </Button>\n              <Button\n                variant={expenseDeductionSource === 'fawry' ? 'default' : 'outline'}\n                className={expenseDeductionSource === 'fawry' ? 'bg-amber-600 hover:bg-amber-700 text-white' : ''}\n                onClick={() => setExpenseDeductionSource('fawry')}\n              >\n                \n              </Button>\n            </div>\n\n            {expenseDeductionSource === 'wallet' && (\n              <div className=\"space-y-2\">\n                <Label className=\"text-right block\">  </Label>\n                <Select value={selectedWalletForExpense} onValueChange={setSelectedWalletForExpense}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\" \" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {wallets.map(w => (\n                      <SelectItem key={w.id} value={w.id}>{w.phone || w.name || w.id}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n          </div>\n          <DialogFooter className=\"flex justify-between\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsExpenseDeductionChoiceOpen(false);\n                setExpenseDeductionSource(null);\n                setSelectedWalletForExpense('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              className=\"bg-green-600 hover:bg-green-700\"\n              onClick={async () => {\n                const amt = Number(expenseAmount);\n                if (isNaN(amt) || amt <= 0) {\n                  toast({ title: '  ', description: '   ', variant: 'destructive' });\n                  return;\n                }\n                if (!expenseDeductionSource) {\n                  toast({ title: '  ', description: '    ', variant: 'destructive' });\n                  return;\n                }\n                try {\n                  if (expenseDeductionSource === 'cash') {\n                    const newCash = Number((cashBalance - amt).toFixed(2));\n                    setCashBalance(newCash);\n                    localStorage.setItem(getCashBalanceKey(), newCash.toString());\n                    const updateData = { cashBalance: newCash, lastUpdated: new Date().toISOString() };\n                    const localDataKey = `userData_${user?.uid}`;\n                    localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                    if (user?.uid) {\n                      await userDataService.updateUserData(user.uid, updateData);\n                      localStorage.removeItem(localDataKey);\n                      setHasLocalDataToSync(false);\n                    } else {\n                      setHasLocalDataToSync(true);\n                    }\n                  } else if (expenseDeductionSource === 'wallet') {\n                    if (!selectedWalletForExpense) {\n                      toast({ title: ' ', description: '   ', variant: 'destructive' });\n                      return;\n                    }\n                    const current = walletBalances[selectedWalletForExpense] || 0;\n                    const newBalance = Number((current - amt).toFixed(2));\n                    const updatedBalances = { ...walletBalances, [selectedWalletForExpense]: newBalance };\n                    setWalletBalances(updatedBalances);\n                    const timestamp = new Date().toISOString();\n                    const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp } as any;\n                    const localDataKey = `userData_${user?.uid}`;\n                    localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n                    localStorage.setItem(`walletBalances_backup_${timestamp}`, JSON.stringify(updatedBalances));\n                    if (user?.uid) {\n                      userDataService.updateUserData(user.uid, updateData).catch(() => {});\n                    }\n                  } else if (expenseDeductionSource === 'fawry') {\n                    //            \"\"\n                  }\n                } catch (e) {\n                  console.error('      :', e);\n                }\n\n                //    Firestore     \n                let newExpenseId = Date.now().toString();\n                try {\n                  if (user?.uid) {\n                    const { addDoc, collection, serverTimestamp } = await import('firebase/firestore');\n                    const { db } = await import('@/firebase');\n                    const docRef = await addDoc(collection(db, 'shop_expenses'), {\n                      userId: user.uid,\n                      shopId: (shopIdCtx || profile?.shopId || user.uid || 'default-shop'),\n                      name: expenseName,\n                      amount: amt,\n                      notes: expenseNotes || '',\n                      source: expenseDeductionSource,\n                      walletId: expenseDeductionSource === 'wallet' ? selectedWalletForExpense : null,\n                      createdAt: serverTimestamp(),\n                    });\n                    newExpenseId = docRef.id;\n                  }\n                } catch (e) {\n                  console.error('     Firestore:', e);\n                }\n\n                //          \n                const newExpense: ShopExpense = {\n                  id: newExpenseId,\n                  name: expenseName,\n                  amount: amt,\n                  notes: expenseNotes,\n                  source: expenseDeductionSource,\n                  walletId: expenseDeductionSource === 'wallet' ? selectedWalletForExpense : undefined,\n                  createdAt: new Date(),\n                };\n                const updatedExpenses = [...expenses, newExpense];\n                await saveExpensesToStorage(updatedExpenses);\n\n                //  \n                setExpenseName('');\n                setExpenseAmount('');\n                setExpenseNotes('');\n                setExpenseDeductionSource(null);\n                setSelectedWalletForExpense('');\n                //         \n                setIsExpenseDeductionChoiceOpen(false);\n                setIsShopExpensesDialogOpen(true);\n\n                //       \n                setIsReceiptsDialogOpen(true);\n\n                toast({\n                  title: '  ',\n                  description:\n                    expenseDeductionSource === 'cash'\n                      ? '   '\n                      : expenseDeductionSource === 'wallet'\n                        ? '    '\n                        : '    ',\n                });\n              }}\n            >\n               \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*   */}\n      <Dialog open={isDeficienciesDialogOpen} onOpenChange={setIsDeficienciesDialogOpen}>\n        <DialogContent className=\"sm:max-w-[520px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\"></DialogTitle>\n            <DialogDescription className=\"text-right\">\n                     .\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"deficiencyName\" className=\"text-right col-span-1\">\n                 \n              </Label>\n              <Input\n                id=\"deficiencyName\"\n                value={deficiencyName}\n                onChange={(e) => setDeficiencyName(e.target.value)}\n                className=\"col-span-3 text-right\"\n                placeholder=\":   \"\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"deficiencyQuantity\" className=\"text-right col-span-1\">\n                \n              </Label>\n              <Input\n                id=\"deficiencyQuantity\"\n                type=\"number\"\n                value={deficiencyQuantity}\n                onChange={(e) => setDeficiencyQuantity(e.target.value)}\n                className=\"col-span-3 text-right\"\n                placeholder=\"1\"\n              />\n            </div>\n            <div className=\"flex justify-end\">\n              <Button\n                className=\"bg-rose-600 hover:bg-rose-700\"\n                onClick={() => {\n                  if (isZeroPlan) {\n                    toast({ title: ' ', description: '     .  .', variant: 'destructive' });\n                    return;\n                  }\n                  const qty = parseInt(deficiencyQuantity || '1', 10);\n                  if (!deficiencyName) {\n                    toast({ title: '  ', description: '   ', variant: 'destructive' });\n                    return;\n                  }\n                  if (isNaN(qty) || qty <= 0) {\n                    toast({ title: '  ', description: '   ', variant: 'destructive' });\n                    return;\n                  }\n                  (async () => {\n                    //  :   Firestore     \n                    if (user?.uid) {\n                      try {\n                        const { collection, addDoc, serverTimestamp } = await import('firebase/firestore');\n                        const { db } = await import('@/firebase');\n                        const docRef = await addDoc(collection(db, 'deficiencies'), {\n                          userId: user.uid,\n                          shopId: (shopIdCtx || profile?.shopId || user.uid || 'default-shop'),\n                          name: deficiencyName,\n                          quantity: qty,\n                          status: 'pending',\n                          createdAt: serverTimestamp(),\n                        });\n                        //          /\n                        try {\n                          const key = getDeficienciesKey();\n                          const raw = localStorage.getItem(key);\n                          const list = raw ? JSON.parse(raw) : [];\n                          const safeList = Array.isArray(list) ? list : [];\n                          const exists = safeList.some((d: any) => String(d?.id || '') === docRef.id);\n                          const optimisticItem = {\n                            id: docRef.id,\n                            name: deficiencyName,\n                            quantity: qty,\n                            status: 'pending',\n                            createdAt: new Date().toISOString(),\n                          };\n                          const updatedOptimistic = exists ? safeList : [...safeList, optimisticItem];\n                          localStorage.setItem(key, JSON.stringify(updatedOptimistic));\n                        } catch { }\n                        setDeficiencyName('');\n                        setDeficiencyQuantity('');\n                        toast({ title: ' ', description: '     ' });\n                        return;\n                      } catch (e) {\n                        console.warn('    Firestore   :', e);\n                      }\n                    }\n                    // :          Firestore\n                    const newItem: DeficiencyItem = {\n                      id: Date.now().toString(),\n                      name: deficiencyName,\n                      quantity: qty,\n                      status: 'pending',\n                      createdAt: new Date(),\n                    };\n                    setDeficiencies(prev => {\n                      const updated = [...prev, newItem];\n                      saveDeficienciesToStorage(updated);\n                      return updated;\n                    });\n                    setDeficiencyName('');\n                    setDeficiencyQuantity('');\n                    toast({ title: ' ', description: '     ' });\n                  })();\n                }}\n              >\n                 \n              </Button>\n            </div>\n\n            {/*   */}\n            {deficiencies.length > 0 ? (\n              <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n                {deficiencies.map((d) => (\n                  <div key={d.id} className=\"p-2 border rounded-lg bg-white hover:bg-gray-50 transition-colors\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"text-right\">\n                        <p className=\"font-medium text-sm\">{d.name}</p>\n                        <p className=\"text-[11px] text-gray-600\">: {d.quantity}</p>\n                        <p className=\"text-[10px] text-gray-500\">{new Date(d.createdAt).toLocaleString('ar-EG')}</p>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant=\"secondary\" className={d.status === 'pending' ? 'bg-rose-100 text-rose-700' : 'bg-green-100 text-green-700'}>\n                          {d.status === 'pending' ? ' ' : ' '}\n                        </Badge>\n                        <Button\n                          variant=\"outline\"\n                          className={d.status === 'pending' ? 'text-green-700 border-green-300 hover:bg-green-50' : 'text-rose-700 border-rose-300 hover:bg-rose-50'}\n                          onClick={() => {\n                            (async () => {\n                              const next = d.status === 'pending' ? 'purchased' : 'pending';\n                              if (user?.uid) {\n                                try {\n                                  const { doc, updateDoc, serverTimestamp } = await import('firebase/firestore');\n                                  const { db } = await import('@/firebase');\n                                  await updateDoc(doc(db, 'deficiencies', d.id), { status: next, updatedAt: serverTimestamp() });\n                                  return;\n                                } catch (e) {\n                                  console.warn('     Firestore   :', e);\n                                }\n                              }\n                              setDeficiencies(prev => {\n                                const updated = prev.map(item => item.id === d.id ? { ...item, status: next } : item);\n                                saveDeficienciesToStorage(updated);\n                                return updated;\n                              });\n                            })();\n                          }}\n                          title={d.status === 'pending' ? ' ' : ' '}\n                        >\n                          {d.status === 'pending' ? ' ' : ' '}\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          className=\"text-red-700 border-red-300 hover:bg-red-50\"\n                          onClick={() => {\n                            (async () => {\n                              if (user?.uid) {\n                                try {\n                                  const { doc, deleteDoc } = await import('firebase/firestore');\n                                  const { db } = await import('@/firebase');\n                                  await deleteDoc(doc(db, 'deficiencies', d.id));\n                                  return;\n                                } catch (e) {\n                                  console.warn('     Firestore   :', e);\n                                }\n                              }\n                              setDeficiencies(prev => {\n                                const updated = prev.filter(item => item.id !== d.id);\n                                saveDeficienciesToStorage(updated);\n                                return updated;\n                              });\n                            })();\n                          }}\n                          title=\"\"\n                        >\n                          \n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-sm text-gray-500 text-center\">     </p>\n            )}\n          </div>\n\n          <DialogFooter className=\"flex justify-end\">\n            <Button variant=\"outline\" onClick={() => setIsDeficienciesDialogOpen(false)}></Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*      */}\n      <Dialog open={isDebtDeductionChoiceOpen} onOpenChange={setIsDebtDeductionChoiceOpen}>\n        <DialogContent className=\"sm:max-w-[480px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\">\n              {pendingDebtAdjustment?.type === 'decrease' ? '    ' : '   '}\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <p className=\"text-sm text-gray-600 text-right\">\n              {pendingDebtAdjustment?.type === 'decrease'\n                ? '                .'\n                : '                  .'}\n            </p>\n            <div className=\"grid grid-cols-3 gap-3\">\n              <Button\n                variant={deductionSource === 'cash' ? 'default' : 'outline'}\n                className={deductionSource === 'cash' ? 'bg-blue-600 hover:bg-blue-700 text-white' : ''}\n                onClick={() => setDeductionSource('cash')}\n              >\n                 \n              </Button>\n              <Button\n                variant={deductionSource === 'wallet' ? 'default' : 'outline'}\n                className={deductionSource === 'wallet' ? 'bg-purple-600 hover:bg-purple-700 text-white' : ''}\n                onClick={() => setDeductionSource('wallet')}\n              >\n                 \n              </Button>\n              <Button\n                variant={deductionSource === 'none' ? 'default' : 'outline'}\n                className={deductionSource === 'none' ? 'bg-gray-600 hover:bg-gray-700 text-white' : ''}\n                onClick={() => setDeductionSource('none')}\n              >\n                {pendingDebtAdjustment?.type === 'decrease' ? ' ' : ' '}\n              </Button>\n            </div>\n\n            {deductionSource === 'wallet' && (\n              <div className=\"space-y-2\">\n                <Label className=\"text-right block\">\n                  {pendingDebtAdjustment?.type === 'decrease' ? '  ' : '  '}\n                </Label>\n                <Select value={selectedWalletForDeduction} onValueChange={setSelectedWalletForDeduction}>\n                  <SelectTrigger className=\"w-full\">\n                    <SelectValue placeholder=\" \" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {wallets.map(w => (\n                      <SelectItem key={w.id} value={w.id}>{w.phone || w.name || w.id}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n          </div>\n          <DialogFooter className=\"flex justify-between\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsDebtDeductionChoiceOpen(false);\n                setPendingDebtToCreate(null);\n                setDeductionSource(null);\n                setSelectedWalletForDeduction('');\n              }}\n            >\n              \n            </Button>\n            <Button\n              className=\"bg-green-600 hover:bg-green-700\"\n              onClick={async () => {\n                const isAdjustment = !!pendingDebtAdjustment;\n                const isDecrease = isAdjustment && pendingDebtAdjustment?.type === 'decrease';\n                const amt = isAdjustment ? Number(pendingDebtAdjustment!.delta) : Number(pendingDebtToCreate?.amount || 0);\n                if (!deductionSource) {\n                  toast({ \n                    title: isDecrease ? '  ' : '  ', \n                    description: '    ', \n                    variant: 'destructive' \n                  });\n                  return;\n                }\n\n                //        \n                const timestamp = new Date().toISOString();\n                // REPLACEMENT_START\n                // --- NEW CONSOLIDATED LOGIC START ---\n                let newCashBalanceValue = cashBalance;\n                let newWalletBalancesValue = walletBalances;\n                let didUpdateCash = false;\n                let didUpdateWallet = false;\n\n                // 1. Calculate Balance Changes\n                try {\n                  if (deductionSource === 'cash') {\n                     newCashBalanceValue = isDecrease\n                      ? Number((cashBalance + amt).toFixed(2))\n                      : Number((cashBalance - amt).toFixed(2));\n                     didUpdateCash = true;\n                  } else if (deductionSource === 'wallet') {\n                     if (!selectedWalletForDeduction) {\n                        toast({ \n                          title: ' ', \n                          description: isDecrease ? '   ' : '   ', \n                          variant: 'destructive' \n                        });\n                        return;\n                     }\n                     const current = walletBalances[selectedWalletForDeduction] || 0;\n                     const newBalance = isDecrease\n                      ? Number((current + amt).toFixed(2))\n                      : Number((current - amt).toFixed(2));\n                     newWalletBalancesValue = { ...walletBalances, [selectedWalletForDeduction]: newBalance };\n                     didUpdateWallet = true;\n                  }\n                } catch (e) {\n                   console.error('Error calculating balances:', e);\n                   return;\n                }\n\n                // 2. Calculate Debt Changes\n                let updatedDebts = [...debts];\n                let finalSelectedDebt = selectedDebt;\n                let didUpdateDebts = false;\n\n                if (isAdjustment) {\n                   if (!selectedDebt) return;\n                   const currentAmount = Number(selectedDebt.amount || 0);\n                   const paid = Number(selectedDebt.paidAmount || 0);\n                   const delta = Number(pendingDebtAdjustment!.delta || 0);\n\n                   if (pendingDebtAdjustment!.type === 'decrease') {\n                      const newAmount = Number((currentAmount - delta).toFixed(2));\n                      const becamePaid = paid >= newAmount;\n                      const updated: Debt = {\n                        ...selectedDebt,\n                        amount: newAmount,\n                        status: becamePaid ? 'paid' : 'pending',\n                      };\n                      updatedDebts = debts.map(d => d.id === selectedDebt.id ? updated : d);\n                      finalSelectedDebt = updated;\n                      didUpdateDebts = true;\n                      \n                      if (becamePaid && user?.uid) {\n                        (async () => {\n                          try {\n                            const [q1, q2, q3] = [\n                              fsQuery(collection(db, 'userTransactions'), where('userId', '==', user.uid), where('linkedDebtId', '==', selectedDebt.id), where('status', '==', 'pending')),\n                              fsQuery(collection(db, 'transactions'), where('userId', '==', user.uid), where('linkedDebtId', '==', selectedDebt.id), where('status', '==', 'pending')),\n                              fsQuery(collection(db, 'transactions'), where('merchantUserId', '==', user.uid), where('linkedDebtId', '==', selectedDebt.id), where('status', '==', 'pending'))\n                            ];\n\n                            const [snap1, snap2, snap3] = await Promise.all([getDocs(q1), getDocs(q2), getDocs(q3)]);\n                            const batch = writeBatch(db);\n                            let batchCount = 0;\n\n                            const processSnap = (snap: any) => {\n                              snap.docs.forEach((docSnap: any) => {\n                                batch.update(docSnap.ref, { status: 'completed', confirmedAt: new Date() });\n                                batchCount++;\n                              });\n                            };\n\n                            processSnap(snap1);\n                            processSnap(snap2);\n                            processSnap(snap3);\n\n                            if (batchCount > 0) {\n                              await batch.commit();\n                            }\n\n                            if (user?.uid) {\n                              const ids = [\n                                ...snap1.docs.map((d: any) => String((d.data() as any)?.transactionId || '')),\n                                ...snap2.docs.map((d: any) => String(d.id || (d.data() as any)?.transactionId || '')),\n                                ...snap3.docs.map((d: any) => String(d.id || (d.data() as any)?.transactionId || ''))\n                              ].filter(Boolean);\n                              \n                              ids.forEach(id => userDataService.removeLocalReceiptById(user.uid!, id));\n                            }\n                          } catch (e) {\n                            console.error('Batch update failed for linked transactions:', e);\n                          }\n                        })().catch((e) => {\n                          console.error('Transaction update error:', e);\n                        });\n                      }\n                      \n                      // Create Receipt for Repayment\n                      if (user?.uid && deductionSource !== 'none') {\n                        try {\n                           const newTxnId = doc(collection(db, 'dummy_collection')).id; \n                           const txnData = {\n                              transactionId: newTxnId,\n                              amount: delta,\n                              transactionType: 'cash_addition', \n                              type: 'cash_addition',\n                              status: 'completed',\n                              createdAt: new Date(),\n                              senderName: selectedDebt.debtorName,\n                              receiverName: '',\n                              description: `    ${selectedDebt.debtorName}`,\n                              paymentMethod: deductionSource,\n                              walletId: deductionSource === 'wallet' ? selectedWalletForDeduction : null,\n                              linkedDebtId: selectedDebt.id,\n                              isDebtRepayment: true\n                           };\n                           await userDataService.saveUserTransaction(user.uid, txnData as any);\n                           try { queryClientHook.invalidateQueries({ queryKey: ['recentTransactions', user?.uid] }); } catch {}\n                        } catch (e) {\n                           console.error('Failed to create repayment receipt:', e);\n                        }\n                      }\n\n                      toast({ title: '  ', description: ` : ${newAmount} ` });\n                   } else {\n                      const newAmount = currentAmount + delta;\n                      const stillPaid = paid >= newAmount;\n                      const updated: Debt = {\n                        ...selectedDebt,\n                        amount: Number(newAmount.toFixed(2)),\n                        status: stillPaid ? 'paid' : 'pending',\n                      };\n                      updatedDebts = debts.map(d => d.id === selectedDebt.id ? updated : d);\n                      finalSelectedDebt = updated;\n                      didUpdateDebts = true;\n                      toast({ title: '  ', description: ` : ${newAmount} ` });\n                      \n                      // Create Receipt for Debt Increase (Cash Deduction)\n                      //           \n                      /*\n                      if (user?.uid && deductionSource !== 'none') {\n                        try {\n                           const newTxnId = doc(collection(db, 'dummy_collection')).id; \n                           const txnData = {\n                              transactionId: newTxnId,\n                              amount: delta,\n                              transactionType: 'cash_subtraction', \n                              type: 'cash_subtraction',\n                              status: 'completed',\n                              createdAt: new Date(),\n                              senderName: '',\n                              receiverName: selectedDebt.debtorName,\n                              description: `    ${selectedDebt.debtorName}`,\n                              paymentMethod: deductionSource,\n                              walletId: deductionSource === 'wallet' ? selectedWalletForDeduction : null,\n                              linkedDebtId: selectedDebt.id,\n                              isDebtCreation: true\n                           };\n                           userDataService.saveUserTransaction(user.uid, txnData as any)\n                               .then(() => {\n                                   try { queryClientHook.invalidateQueries({ queryKey: ['recentTransactions', user?.uid] }); } catch {}\n                               })\n                               .catch(e => console.error('Failed to create increase receipt:', e));\n                        } catch (e) {\n                           console.error('Failed to prepare increase receipt:', e);\n                        }\n                      }\n                      */\n                   }\n                } else if (pendingDebtToCreate) {\n                   // Ensure userId and shopId are present in the local object too for robustness\n                   const enhancedDebt = { \n                       ...pendingDebtToCreate, \n                       userId: user?.uid,\n                       shopId: shopIdCtx || profile?.shopId || null \n                   };\n                   updatedDebts = [enhancedDebt, ...debts];\n                   didUpdateDebts = true;\n                   try { if (user?.uid) { telegramNotifier.send(user.uid, `    ${pendingDebtToCreate.debtorName}  ${pendingDebtToCreate.amount} `).catch(() => {}); } } catch {}\n                   \n                   // Create Receipt for New Debt (Cash Deduction)\n                   //           \n                   /*\n                   if (user?.uid && deductionSource !== 'none') {\n                        try {\n                           const newTxnId = doc(collection(db, 'dummy_collection')).id; \n                           const txnData = {\n                              transactionId: newTxnId,\n                              amount: pendingDebtToCreate.amount,\n                              transactionType: 'cash_subtraction', \n                              type: 'cash_subtraction',\n                              status: 'completed',\n                              createdAt: new Date(),\n                              senderName: '',\n                              receiverName: pendingDebtToCreate.debtorName,\n                              description: `     ${pendingDebtToCreate.debtorName}`,\n                              paymentMethod: deductionSource,\n                              walletId: deductionSource === 'wallet' ? selectedWalletForDeduction : null,\n                              linkedDebtId: pendingDebtToCreate.id,\n                              isDebtCreation: true\n                           };\n                           userDataService.saveUserTransaction(user.uid, txnData as any)\n                               .then(() => {\n                                   try { queryClientHook.invalidateQueries({ queryKey: ['recentTransactions', user?.uid] }); } catch {}\n                               })\n                               .catch(e => console.error('Failed to create new debt receipt:', e));\n                        } catch (e) {\n                           console.error('Failed to prepare new debt receipt:', e);\n                        }\n                   }\n                   */\n                }\n\n                // 3. Update React State\n                if (didUpdateCash) setCashBalance(newCashBalanceValue);\n                if (didUpdateWallet) setWalletBalances(newWalletBalancesValue);\n                if (didUpdateDebts) {\n                    setDebts(updatedDebts);\n                    if (isAdjustment) setSelectedDebt(finalSelectedDebt);\n                }\n\n                // Reset UI State\n                setDebtorName('');\n                setDebtAmount('');\n                setDebtReason('');\n                setIsDebtsDialogOpen(false);\n                setIsDebtDeductionChoiceOpen(false);\n\n                // Open receipts list immediately if it was a new debt creation\n                if (!isAdjustment && didUpdateDebts) {\n                   setIsDebtReceiptsListOpen(true);\n                }\n\n                setPendingDebtToCreate(null);\n                setPendingDebtAdjustment(null);\n                setDeductionSource(null);\n                setSelectedWalletForDeduction('');\n\n                toast({\n                  title: isAdjustment ? '  ' : '  ',\n                  description: deductionSource === 'none'\n                    ? '   '\n                    : deductionSource === 'cash'\n                      ? (isDecrease ? `  ${amt}   ` : `  ${amt}   `)\n                      : (isDecrease ? `  ${amt}   ` : `  ${amt}   `),\n                });\n\n                // 4. Update Local Storage & Firebase (Consolidated)\n                const updatePayload: any = { lastUpdated: timestamp };\n                if (didUpdateCash) updatePayload.cashBalance = newCashBalanceValue;\n                if (didUpdateWallet) updatePayload.walletBalances = newWalletBalancesValue;\n                if (didUpdateDebts) {\n                  updatePayload.debts = updatedDebts;\n                  updatePayload.debtsDeletedAt = null; // Clear deleted flag\n                }\n\n                // Local Storage\n                if (didUpdateCash) {\n                    localStorage.setItem(getCashBalanceKey(), newCashBalanceValue.toString());\n                    localStorage.setItem(getCashBalanceKey() + '_lastUpdated', timestamp);\n                }\n                if (didUpdateWallet) {\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(newWalletBalancesValue));\n                    localStorage.setItem(getWalletBalancesKey() + '_lastUpdated', timestamp);\n                }\n                if (didUpdateDebts) {\n                    localStorage.setItem(getDebtsKey(), JSON.stringify(updatedDebts));\n                    try { localStorage.setItem(getDebtsDefaultKey(), JSON.stringify(updatedDebts)); } catch { }\n                    try { localStorage.setItem(getDebtsLastWriteKey(), Date.now().toString()); } catch { }\n                }\n                \n                const localDataKey = `userData_${user?.uid}`;\n                localStorage.setItem(localDataKey, JSON.stringify(updatePayload));\n\n                // Firebase\n                if (user?.uid) {\n                    // Mark as unsynced BEFORE starting sync to protect local data on refresh\n                    if (didUpdateDebts) {\n                        try { localStorage.setItem(`debts_unsynced_${user.uid}`, 'true'); } catch { }\n                    }\n\n                    const syncPromises = [];\n\n                    // Explicit sync to 'debts' collection for the specific changed debt - DISABLED\n                    /*\n                    if (didUpdateDebts) {\n                        const debtToSync = isAdjustment ? finalSelectedDebt : pendingDebtToCreate;\n                        if (debtToSync) {\n                             syncPromises.push(\n                                 (async () => {\n                                     try {\n                                        const debtRef = doc(db, 'debts', debtToSync.id);\n                                        const p: any = { \n                                            ...debtToSync, \n                                            userId: user.uid, \n                                            shopId: shopIdCtx || profile?.shopId || null, \n                                            lastUpdated: new Date().toISOString() \n                                        };\n                                        Object.keys(p).forEach(key => p[key] === undefined && delete p[key]);\n                                        await setDoc(debtRef, p, { merge: true });\n                                     } catch (e) {\n                                         console.error('Failed to sync debt to collection:', e);\n                                     }\n                                 })()\n                             );\n                        }\n                    }\n                    */\n\n                    // 1. Update userData (Main Sync)\n                    syncPromises.push(\n                        userDataService.updateUserData(user.uid, updatePayload)\n                            .then(() => {\n                                if (didUpdateCash || didUpdateWallet) {\n                                    localStorage.removeItem(localDataKey);\n                                    setHasLocalDataToSync(false);\n                                }\n                                // We don't clear debts_unsynced here yet, wait for all\n                            })\n                    );\n\n                    // 2. Parallel Update to dashboardData (for Shop view)\n                    const sid = (shopIdCtx || profile?.shopId);\n                    if (sid && (didUpdateCash || didUpdateWallet)) {\n                         const dashPayload: any = { lastUpdated: timestamp };\n                         if (didUpdateCash) dashPayload.cashBalance = newCashBalanceValue;\n                         if (didUpdateWallet) dashPayload.walletBalances = newWalletBalancesValue;\n                         syncPromises.push(\n                            setDoc(doc(db, 'dashboardData', sid), dashPayload, { merge: true })\n                                .catch(e => console.error('Failed to sync to dashboardData', e))\n                         );\n                    }\n\n                    // 3. Parallel Update to debts collection (Robust Persistence) - DISABLED\n                    /*\n                    if (didUpdateDebts || isAdjustment) {\n                        const debtsToSync = [];\n                        if (isAdjustment && finalSelectedDebt) {\n                            debtsToSync.push(finalSelectedDebt);\n                        } else if (pendingDebtToCreate) {\n                            debtsToSync.push(pendingDebtToCreate);\n                        }\n                        \n                        // Sync specific debts\n                        const debtPromises = debtsToSync.map(debtItem => {\n                             if (!debtItem.id) return Promise.resolve();\n                             const debtRef = doc(db, 'debts', debtItem.id);\n                             const debtPayload: any = {\n                                 ...debtItem,\n                                 userId: user.uid,\n                                 shopId: shopIdCtx || profile?.shopId || null,\n                                 lastUpdated: timestamp,\n                                 amount: Number(debtItem.amount || 0),\n                                 paidAmount: Number(debtItem.paidAmount || 0),\n                                 createdAt: debtItem.createdAt || new Date(),\n                                 partialPayments: debtItem.partialPayments || []\n                             };\n                             Object.keys(debtPayload).forEach(key => {\n                                 if (debtPayload[key] === undefined) delete debtPayload[key];\n                             });\n                             return setDoc(debtRef, debtPayload, { merge: true });\n                        });\n                        syncPromises.push(...debtPromises);\n                    }\n                    */\n\n                    // Handle completion of all syncs\n                    Promise.all(syncPromises)\n                        .then(() => {\n                            // All syncs success\n                            if (didUpdateDebts) {\n                                try { localStorage.removeItem(`debts_unsynced_${user.uid}`); } catch { }\n                            }\n                        })\n                        .catch(err => {\n                            console.error('Sync error:', err);\n                            setHasLocalDataToSync(true);\n                            // Flag remains true (already set at start)\n                        });\n                }\n                }}\n                // --- NEW CONSOLIDATED LOGIC END ---\n\n\n            >\n              {pendingDebtAdjustment?.type === 'decrease' ? ' ' : ' '}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*    */}\n      <Dialog open={isDebtReceiptOpen} onOpenChange={setIsDebtReceiptOpen}>\n        <DialogContent className=\"w-[95vw] sm:w-auto sm:max-w-[425px] rounded-2xl\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\"> </DialogTitle>\n          </DialogHeader>\n          {selectedDebt && (\n            <div className=\"grid gap-4 py-4\">\n              <div className=\"text-center border-b pb-4\">\n                <h2 className=\"text-xl font-bold\"> </h2>\n                <p className=\"text-sm text-gray-500\">\n                  {dateFormatter.format(selectedDebt.createdAt instanceof Date ? selectedDebt.createdAt : new Date(selectedDebt.createdAt))}\n                </p>\n              </div>\n\n              <div className=\"space-y-3\">\n                <div className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                  <span className=\"font-medium\"> :</span>\n                  <span>{selectedDebt.debtorName}</span>\n                </div>\n                <div className=\"flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center\">\n                  <span className=\"font-medium\">:</span>\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      className=\"h-10 w-10 sm:h-8 sm:w-8 p-0\"\n                      aria-label=\" \"\n                      onClick={() => {\n                        setDebtAdjustType('decrease');\n                        setDebtAdjustAmount('');\n                        //          \n                        setIsDebtReceiptOpen(false);\n                        setIsDebtAdjustDialogOpen(true);\n                      }}\n                    >\n                      \n                    </Button>\n                    <span className=\"font-bold text-xl sm:text-lg\">{selectedDebt.amount} </span>\n                    <Button\n                      variant=\"outline\"\n                      className=\"h-10 w-10 sm:h-8 sm:w-8 p-0\"\n                      aria-label=\" \"\n                      onClick={() => {\n                        setDebtAdjustType('increase');\n                        setDebtAdjustAmount('');\n                        //          \n                        setIsDebtReceiptOpen(false);\n                        setIsDebtAdjustDialogOpen(true);\n                      }}\n                    >\n                      +\n                    </Button>\n                  </div>\n                </div>\n                {(() => {\n                  try {\n                    const profit = (transactions || []).filter((t: any) => String(t?.linkedDebtId || '') === String(selectedDebt.id))\n                      .reduce((sum: number, t: any) => sum + Math.max(0, Number(t?.commission || 0)), 0);\n                    return profit > 0 ? (\n                      <div className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                        <span className=\"font-medium\">:</span>\n                        <span className=\"text-green-700 font-semibold\">{profit} </span>\n                      </div>\n                    ) : null;\n                  } catch {\n                    return null;\n                  }\n                })()}\n                <div className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                  <span className=\"font-medium\"> :</span>\n                  <span>{selectedDebt.reason}</span>\n                </div>\n                <div className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                  <span className=\"font-medium\">:</span>\n                  <Badge\n                    variant={selectedDebt.status === 'paid' ? 'default' : 'secondary'}\n                    className={`${selectedDebt.status === 'paid' ? 'bg-green-500' : 'bg-yellow-500'} w-fit text-[12px] sm:text-xs`}\n                  >\n                    {selectedDebt.status === 'paid' ? '' : ''}\n                  </Badge>\n                </div>\n                {/*      */}\n                {(() => {\n                  try {\n                    const related = (transactions || []).filter((t: any) => String(t?.linkedDebtId || '') === String(selectedDebt.id));\n                    const profit = related.reduce((sum: number, t: any) => sum + Math.max(0, Number(t?.commission || 0)), 0);\n                    const principal = related.reduce((sum: number, t: any) => sum + Math.max(0, Number((t?.sentAmount ?? t?.transferredAmount ?? t?.withdrawnAmount ?? t?.amount) || 0)), 0);\n                    const base = Number(selectedDebt.amount || 0);\n                    const paid = Number(selectedDebt.paidAmount || 0);\n                    const shouldIncludeProfit = base < (principal + profit);\n                    const totalDue = shouldIncludeProfit ? (base + profit) : base;\n                    const remaining = Math.max(0, Number(totalDue) - paid);\n                    return (\n                      <div className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                        <span className=\"font-medium\"> :</span>\n                        <span className=\"font-bold text-xl sm:text-lg\">{remaining} </span>\n                      </div>\n                    );\n                  } catch {\n                    return (\n                      <div className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                        <span className=\"font-medium\"> :</span>\n                        <span className=\"font-bold text-xl sm:text-lg\">{Number(selectedDebt.amount || 0) - Number(selectedDebt.paidAmount || 0)} </span>\n                      </div>\n                    );\n                  }\n                })()}\n                {selectedDebt.paidAmount ? (\n                  <div className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                    <span className=\"font-medium\"> :</span>\n                    <span className=\"text-green-700\">{selectedDebt.paidAmount} </span>\n                  </div>\n                ) : null}\n                <div className=\"mt-3 p-4 border rounded-xl bg-gray-50\">\n                  {!isPartialPaymentOpen ? (\n                    <Button\n                      variant=\"outline\"\n                      className=\"w-full\"\n                      onClick={() => setIsPartialPaymentOpen(true)}\n                    >\n                       \n                    </Button>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"partialAmount\" className=\"text-right block\">  </Label>\n                      <Input\n                        id=\"partialAmount\"\n                        type=\"number\"\n                        value={partialPaymentAmount}\n                        onChange={(e) => setPartialPaymentAmount(e.target.value)}\n                        className=\"text-right\"\n                        placeholder=\" \"\n                      />\n                      <div className=\"flex gap-2\">\n                        <Button\n                          variant=\"outline\"\n                          onClick={() => {\n                            setIsPartialPaymentOpen(false);\n                            setPartialPaymentAmount('');\n                          }}\n                        >\n                          \n                        </Button>\n                        <Button\n                          className=\"bg-blue-600 hover:bg-blue-700\"\n                          onClick={async () => {\n                            const amt = parseFloat(partialPaymentAmount);\n                            if (!selectedDebt || isNaN(amt) || amt <= 0) {\n                              toast({\n                                title: '',\n                                description: '   ',\n                                variant: 'destructive',\n                              });\n                              return;\n                            }\n                            const remainingBefore = Math.max(0, Number(selectedDebt.amount || 0) - Number(selectedDebt.paidAmount || 0));\n                            if (amt > remainingBefore) {\n                              toast({\n                                title: ' ',\n                                description: '    ',\n                                variant: 'destructive',\n                              });\n                              return;\n                            }\n\n                            const newPaidTotal = Number(((selectedDebt.paidAmount || 0) + amt).toFixed(2));\n                            const isFullyPaid = newPaidTotal >= Number(selectedDebt.amount || 0);\n                            const updated: Debt = {\n                              ...selectedDebt,\n                              amount: Number(selectedDebt.amount || 0),\n                              paidAmount: newPaidTotal,\n                              status: isFullyPaid ? 'paid' : 'pending',\n                              partialPayments: [\n                                ...(selectedDebt.partialPayments || []),\n                                { amount: amt, paidAt: new Date() }\n                              ]\n                            };\n\n                            const updatedDebts = debts.map(d => d.id === selectedDebt.id ? updated : d);\n                            setDebts(updatedDebts);\n                            setSelectedDebt(updated);\n                            await saveDebtsToStorage(updatedDebts);\n                            try { if (user?.uid) { const remaining = Math.max(0, Number(updated.amount || 0) - Number(updated.paidAmount || 0)); await telegramNotifier.send(user.uid, `     ${updated.debtorName}:  ${amt}   ${remaining} `); } } catch {}\n                            //              \n                            try {\n                              if (updated.status === 'paid' && user?.uid) {\n                                (async () => {\n                                  const q = fsQuery(\n                                    collection(db, 'userTransactions'),\n                                    where('userId', '==', user.uid),\n                                    where('linkedDebtId', '==', selectedDebt.id),\n                                    where('status', '==', 'pending')\n                                  );\n                                  const snap = await getDocs(q);\n                                  await Promise.allSettled(\n                                    snap.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\n                                  );\n                                  try {\n                                    const ids = snap.docs.map(d => String((d.data() as any)?.transactionId || ''));\n                                    if (user?.uid) ids.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\n                                  } catch { }\n                                  const q2 = fsQuery(\n                                    collection(db, 'transactions'),\n                                    where('userId', '==', user.uid),\n                                    where('linkedDebtId', '==', selectedDebt.id),\n                                    where('status', '==', 'pending')\n                                  );\n                                  const snap2 = await getDocs(q2);\n                                  await Promise.allSettled(\n                                    snap2.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\n                                  );\n                                  try {\n                                    const ids2 = snap2.docs.map(d => String(d.id || (d.data() as any)?.transactionId || ''));\n                                    if (user?.uid) ids2.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\n                                  } catch { }\n                                  const q3 = fsQuery(\n                                    collection(db, 'transactions'),\n                                    where('merchantUserId', '==', user.uid),\n                                    where('linkedDebtId', '==', selectedDebt.id),\n                                    where('status', '==', 'pending')\n                                  );\n                                  const snap3 = await getDocs(q3);\n                                  await Promise.allSettled(\n                                    snap3.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\n                                  );\n                                  try {\n                                    const ids3 = snap3.docs.map(d => String(d.id || (d.data() as any)?.transactionId || ''));\n                                    if (user?.uid) ids3.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\n                                  } catch { }\n                                })().catch((e) => {\n                                  console.error('     :', e);\n                                  toast({ title: '   ', description: '     ', variant: 'destructive' });\n                                });\n                              }\n                            } catch (e) {\n                              console.error('     :', e);\n                            }\n                            try {\n                              const localKey = getTransactionsKey();\n                              const raw = localStorage.getItem(localKey);\n                              if (raw) {\n                                const arr = JSON.parse(raw) || [];\n                                const updatedArr = arr.map((t: any) =>\n                                  (t?.linkedDebtId === selectedDebt.id && t?.status === 'pending')\n                                    ? { ...t, status: 'completed', confirmedAt: new Date() }\n                                    : t\n                                );\n                                localStorage.setItem(localKey, JSON.stringify(updatedArr));\n                                setTransactions(prev => prev.map((t: any) =>\n                                  (t?.linkedDebtId === selectedDebt.id && t?.status === 'pending')\n                                    ? { ...t, status: 'completed', confirmedAt: new Date() }\n                                    : t\n                                ));\n                              }\n                            } catch (err) {\n                              console.warn('        :', err);\n                            }\n                            //          \n                            setPaymentAmountPending(amt);\n                            setPaymentCreditSource('none');\n                            setIsPaymentCreditChoiceOpen(true);\n                            setIsPartialPaymentOpen(false);\n                            setPartialPaymentAmount('');\n                            toast({\n                              title: '   ',\n                              description: `  ${amt}   ${new Date().toLocaleString('ar-EG')}`,\n                            });\n                          }}\n                        >\n                          \n                        </Button>\n                      </div>\n                    </div>\n                  )}\n                  {selectedDebt.partialPayments && selectedDebt.partialPayments.length > 0 && (\n                    <div className=\"mt-3 text-[12px] sm:text-xs text-gray-600\">\n                      <p className=\"font-medium mb-1\">  :</p>\n                      <div className=\"space-y-1 max-h-[30vh] sm:max-h-24 overflow-y-auto\">\n                        {selectedDebt.partialPayments.map((p, idx) => (\n                          <div key={idx} className=\"flex flex-col gap-1 sm:flex-row sm:justify-between\">\n                            <span>: {p.amount} </span>\n                            <span>{new Date(p.paidAt).toLocaleString('ar-EG')}</span>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n          <DialogFooter className=\"flex gap-2 justify-center\">\n            <Button\n              onClick={async () => {\n                if (selectedDebt) {\n                  const updatedDebts = debts.map(debt =>\n                    debt.id === selectedDebt.id\n                      ? { ...debt, status: 'pending' as const }\n                      : debt\n                  );\n                  setDebts(updatedDebts);\n\n                  //    \n                  await saveDebtsToStorage(updatedDebts);\n                  try { if (user?.uid) { const payAmount = computedRemaining; await telegramNotifier.send(user.uid, `     ${selectedDebt.debtorName}:  ${payAmount} `); } } catch {}\n\n                  setIsDebtReceiptOpen(false);\n                  toast({\n                    title: \"   \",\n                    description: \"   \",\n                  });\n                }\n              }}\n              variant=\"outline\"\n              className=\"bg-yellow-500 hover:bg-yellow-600 text-white\"\n            >\n              \n            </Button>\n            <Button\n              onClick={async () => {\n                if (selectedDebt) {\n                  const base = Number(selectedDebt.amount || 0);\n                  const paid = Number(selectedDebt.paidAmount || 0);\n                  let computedRemaining = Math.max(0, base - paid);\n                  try {\n                    const related = (transactions || []).filter((t: any) => String(t?.linkedDebtId || '') === String(selectedDebt.id));\n                    const profit = related.reduce((sum: number, t: any) => sum + Math.max(0, Number(t?.commission || 0)), 0);\n                    const principal = related.reduce((sum: number, t: any) => sum + Math.max(0, Number((t?.sentAmount ?? t?.transferredAmount ?? t?.withdrawnAmount ?? t?.amount) || 0)), 0);\n                    const shouldIncludeProfit = base < (principal + profit);\n                    const totalDue = shouldIncludeProfit ? (base + profit) : base;\n                    computedRemaining = Math.max(0, Number(totalDue) - paid);\n                  } catch { }\n                  const payAmount = computedRemaining;\n                  const updatedDebts = debts.map(debt => {\n                    if (debt.id !== selectedDebt.id) return debt;\n                    const baseAmt = Number(debt.amount || 0);\n                    const prevPaid = Number(debt.paidAmount || 0);\n                    const newPaidTotal = Number((prevPaid + payAmount).toFixed(2));\n                    const isFullyPaid = newPaidTotal >= baseAmt;\n                    return {\n                      ...debt,\n                      amount: baseAmt,\n                      paidAmount: isFullyPaid ? baseAmt : newPaidTotal,\n                      status: 'paid' as const,\n                      partialPayments: [\n                        ...(debt.partialPayments || []),\n                        ...(payAmount > 0 ? [{ amount: payAmount, paidAt: new Date() }] : [])\n                      ]\n                    };\n                  });\n                  setDebts(updatedDebts);\n                  try { setSelectedDebt(updatedDebts.find(d => d.id === selectedDebt.id) || null); } catch {}\n\n                  setPaymentAmountPending(payAmount);\n                  setPaymentCreditSource('none');\n                  setIsPaymentCreditChoiceOpen(true);\n\n                  //    \n                  await saveDebtsToStorage(updatedDebts);\n\n                  // Explicit sync to 'debts' collection - DISABLED\n                  /*\n                  try {\n                    const updatedDebt = updatedDebts.find(d => d.id === selectedDebt.id);\n                    if (user?.uid && updatedDebt?.id) {\n                        const debtRef = doc(db, 'debts', updatedDebt.id);\n                        const p: any = { \n                            ...updatedDebt, \n                            userId: user.uid, \n                            shopId: shopIdCtx || profile?.shopId || null, \n                            lastUpdated: new Date().toISOString() \n                        };\n                        Object.keys(p).forEach(key => p[key] === undefined && delete p[key]);\n                        await setDoc(debtRef, p, { merge: true });\n                    }\n                  } catch (e) {\n                    console.error('Failed to sync debt payment to collection:', e);\n                  }\n                  */\n\n                  //       \n                  try {\n                    if (user?.uid && selectedDebt?.id) {\n                      (async () => {\n                        const q = fsQuery(\n                          collection(db, 'userTransactions'),\n                          where('userId', '==', user.uid),\n                          where('linkedDebtId', '==', selectedDebt.id),\n                          where('status', '==', 'pending')\n                        );\n                        const snap = await getDocs(q);\n                        await Promise.allSettled(\n                          snap.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\n                        );\n                        try {\n                          const ids = snap.docs.map(d => String((d.data() as any)?.transactionId || ''));\n                          if (user?.uid) ids.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\n                        } catch { }\n                        const q2 = fsQuery(\n                          collection(db, 'transactions'),\n                          where('userId', '==', user.uid),\n                          where('linkedDebtId', '==', selectedDebt.id),\n                          where('status', '==', 'pending')\n                        );\n                        const snap2 = await getDocs(q2);\n                        await Promise.allSettled(\n                          snap2.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\n                        );\n                        try {\n                          const ids2 = snap2.docs.map(d => String(d.id || (d.data() as any)?.transactionId || ''));\n                          if (user?.uid) ids2.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\n                        } catch { }\n                        const q3 = fsQuery(\n                          collection(db, 'transactions'),\n                          where('merchantUserId', '==', user.uid),\n                          where('linkedDebtId', '==', selectedDebt.id),\n                          where('status', '==', 'pending')\n                        );\n                        const snap3 = await getDocs(q3);\n                        await Promise.allSettled(\n                          snap3.docs.map(docSnap => updateDoc(docSnap.ref, { status: 'completed', confirmedAt: new Date() }))\n                        );\n                        try {\n                          const ids3 = snap3.docs.map(d => String(d.id || (d.data() as any)?.transactionId || ''));\n                          if (user?.uid) ids3.forEach(id => id && userDataService.removeLocalReceiptById(user.uid!, id));\n                        } catch { }\n                      })().catch((e) => {\n                        console.error('     :', e);\n                        toast({ title: '   ', description: '     ', variant: 'destructive' });\n                      });\n                    }\n                  } catch (e) {\n                    console.error('     :', e);\n                  }\n\n                  try {\n                    const localKey = getTransactionsKey();\n                    const raw = localStorage.getItem(localKey);\n                    if (raw) {\n                      const arr = JSON.parse(raw) || [];\n                      const updatedArr = arr.map((t: any) =>\n                        (t?.linkedDebtId === selectedDebt.id && t?.status === 'pending')\n                          ? { ...t, status: 'completed', confirmedAt: new Date() }\n                          : t\n                      );\n                      localStorage.setItem(localKey, JSON.stringify(updatedArr));\n                      setTransactions(prev => prev.map((t: any) =>\n                        (t?.linkedDebtId === selectedDebt.id && t?.status === 'pending')\n                          ? { ...t, status: 'completed', confirmedAt: new Date() }\n                          : t\n                      ));\n                    }\n                  } catch (err) {\n                    console.warn('        :', err);\n                  }\n\n                  setIsDebtReceiptOpen(false);\n                  toast({\n                    title: \"   \",\n                    description: \"   \",\n                  });\n                }\n              }}\n              className=\"bg-green-500 hover:bg-green-600\"\n            >\n              \n            </Button>\n            <Button\n              onClick={async () => {\n                if (selectedDebt) {\n                  const updatedDebts = debts.filter(debt => debt.id !== selectedDebt.id);\n                  setDebts(updatedDebts);\n\n                  // Delete from Firestore 'debts' collection explicitly - DISABLED\n                  /*\n                  try {\n                    if (user?.uid && selectedDebt.id) {\n                      await deleteDoc(doc(db, 'debts', selectedDebt.id));\n                    }\n                  } catch (e) {\n                    console.error('Failed to delete debt doc:', e);\n                  }\n                  */\n\n                  //    \n                  await saveDebtsToStorage(updatedDebts);\n\n                  setIsDebtReceiptOpen(false);\n                  toast({\n                    title: \"  \",\n                    description: \"   \",\n                  });\n                }\n              }}\n              variant=\"destructive\"\n            >\n              \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*       */}\n      <Dialog open={isDebtAdjustDialogOpen} onOpenChange={setIsDebtAdjustDialogOpen}>\n        <DialogContent className=\"sm:max-w-md rounded-2xl shadow-elegant border border-gray-200\">\n          <DialogHeader>\n            <DialogTitle className={`text-right ${debtAdjustType === 'decrease' ? 'text-red-600' : 'text-green-600'}`}>\n              {debtAdjustType === 'decrease' ? '  ' : debtAdjustType === 'increase' ? '  ' : '  '}\n            </DialogTitle>\n            <DialogDescription className=\"text-right\">\n                    {debtAdjustType === 'decrease' ? '' : ''}.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-2\">\n            <Label htmlFor=\"debtAdjustAmount\" className=\"text-right\"> ()</Label>\n            <Input id=\"debtAdjustAmount\" type=\"number\" placeholder=\"0.00\" value={debtAdjustAmount}\n              onChange={(e) => setDebtAdjustAmount(e.target.value)} />\n            {selectedDebt && (\n              <div className=\"text-right text-sm text-muted-foreground\">\n                 : <span className=\"font-semibold\">{Number(selectedDebt.amount || 0).toFixed(2)}</span> \n              </div>\n            )}\n          </div>\n          <DialogFooter className=\"flex gap-2\">\n            <Button variant=\"secondary\" onClick={() => { setIsDebtAdjustDialogOpen(false); setIsDebtReceiptOpen(true); }}></Button>\n            <Button\n              className={debtAdjustType === 'decrease' ? 'bg-red-600 hover:bg-red-700' : 'bg-green-600 hover:bg-green-700'}\n              onClick={async () => {\n                try {\n                  if (!selectedDebt || !debtAdjustType) return;\n                  const delta = Number(parseFloat(debtAdjustAmount || '0').toFixed(2));\n                  if (!delta || isNaN(delta) || delta <= 0) {\n                    toast({ title: '  ', description: '     ', variant: 'destructive' });\n                    return;\n                  }\n                  setPendingDebtToCreate(null);\n                  setPendingDebtAdjustment({ debtId: selectedDebt.id, delta, type: debtAdjustType });\n                  setIsDebtAdjustDialogOpen(false);\n                  setIsDebtDeductionChoiceOpen(true);\n                } catch (e) {\n                  console.error('    :', e);\n                  toast({ title: '', description: '    ', variant: 'destructive' });\n                }\n              }}\n            >\n              \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*          */}\n      <Dialog open={isPaymentCreditChoiceOpen} onOpenChange={setIsPaymentCreditChoiceOpen}>\n        <DialogContent className=\"sm:max-w-[480px]\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right\">    </DialogTitle>\n            <DialogDescription className=\"text-right\">\n                         \n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-3\">\n            <div className=\"flex flex-wrap gap-2 justify-center\">\n              <Button\n                variant={paymentCreditSource === 'cash' ? 'default' : 'outline'}\n                className={paymentCreditSource === 'cash' ? 'bg-blue-600 text-white' : ''}\n                size=\"sm\"\n                onClick={() => setPaymentCreditSource('cash')}\n              >\n                 \n              </Button>\n              <Button\n                variant={paymentCreditSource === 'wallet' ? 'default' : 'outline'}\n                className={paymentCreditSource === 'wallet' ? 'bg-blue-600 text-white' : ''}\n                size=\"sm\"\n                onClick={() => setPaymentCreditSource('wallet')}\n              >\n                 \n              </Button>\n              <Button\n                variant={paymentCreditSource === 'fawry' ? 'default' : 'outline'}\n                className={paymentCreditSource === 'fawry' ? 'bg-amber-600 text-white' : ''}\n                size=\"sm\"\n                onClick={() => setPaymentCreditSource('fawry')}\n              >\n                \n              </Button>\n              <Button\n                variant={paymentCreditSource === 'none' ? 'default' : 'outline'}\n                className={paymentCreditSource === 'none' ? 'bg-gray-600 text-white' : ''}\n                size=\"sm\"\n                onClick={() => setPaymentCreditSource('none')}\n              >\n                 \n              </Button>\n            </div>\n            {paymentCreditSource === 'wallet' && (\n              <div className=\"space-y-2\">\n                <label className=\"block text-right\">  </label>\n                <select\n                  className=\"w-full border rounded p-2 text-right\"\n                  value={selectedWalletForPaymentCredit}\n                  onChange={(e) => setSelectedWalletForPaymentCredit(e.target.value)}\n                >\n                  <option value=\"\">   </option>\n                  {(wallets && wallets.length > 0\n                    ? wallets.map((w) => (\n                      <option key={w.id} value={w.id}>\n                        {w.phone || w.name || w.id}\n                      </option>\n                    ))\n                    : Object.keys(walletBalances || {}).map((wid) => (\n                      <option key={wid} value={wid}>\n                        {wallets.find(w => w.id === wid)?.phone\n                          || (JSON.parse(localStorage.getItem(getWalletsKey()) || '[]')?.find((w: any) => w.id === wid)?.phone)\n                          || (JSON.parse(localStorage.getItem(getWalletsKey()) || '[]')?.find((w: any) => w.id === wid)?.name)\n                          || (wallets.find(w => w.id === wid)?.name)\n                          || wid}\n                      </option>\n                    ))\n                  )}\n                </select>\n              </div>\n            )}\n            <div className=\"text-right text-sm text-gray-600\">\n                : <span className=\"font-bold\">{paymentAmountPending} </span>\n            </div>\n          </div>\n          <DialogFooter className=\"flex flex-wrap justify-between gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsPaymentCreditChoiceOpen(false);\n                setPaymentAmountPending(0);\n                setPaymentCreditSource(null);\n                setSelectedWalletForPaymentCredit('');\n              }}\n            >\n              \n            </Button>\n              <Button\n                onClick={async () => {\n                  try {\n                    const amt = paymentAmountPending;\n                    if (!amt || amt <= 0) {\n                      setIsPaymentCreditChoiceOpen(false);\n                      return;\n                    }\n                    \n                    // Create Receipt Logic reused for all types except 'none' if needed\n                    const createReceipt = async (method: string, walletId?: string | null) => {\n                         if (user?.uid && selectedDebt) {\n                             try {\n                                const newTxnId = doc(collection(db, 'dummy_collection')).id; \n                                const txnData = {\n                                   transactionId: newTxnId,\n                                   amount: amt,\n                                   transactionType: 'cash_addition', \n                                   type: 'cash_addition',\n                                   status: 'completed',\n                                   createdAt: new Date(),\n                                   senderName: selectedDebt.debtorName,\n                                   receiverName: '',\n                                   description: `    ${selectedDebt.debtorName}`,\n                                   paymentMethod: method,\n                                   walletId: walletId || null,\n                                   linkedDebtId: selectedDebt.id,\n                                   isDebtRepayment: true\n                                };\n                                await userDataService.saveUserTransaction(user.uid, txnData as any);\n                                try { queryClientHook.invalidateQueries({ queryKey: ['recentTransactions', user?.uid] }); } catch {}\n                             } catch (e) {\n                                console.error('Failed to create repayment receipt:', e);\n                             }\n                         }\n                    };\n\n                    if (paymentCreditSource === 'cash') {\n                    const newCashBalance = cashBalance + amt;\n                    setCashBalance(newCashBalance);\n                    localStorage.setItem(getCashBalanceKey(), newCashBalance.toString());\n                    const updateData = { cashBalance: newCashBalance, lastUpdated: new Date().toISOString() };\n                    const localDataKey = `userData_${user?.uid}`;\n                    localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                    if (user?.uid) {\n                      userDataService.updateUserData(user.uid, updateData).catch(() => setHasLocalDataToSync(true));\n                      localStorage.removeItem(localDataKey);\n                      setHasLocalDataToSync(false);\n                    } else {\n                      setHasLocalDataToSync(true);\n                    }\n                      toast({\n                        title: '   ',\n                        description: `  ${amt}    `,\n                      });\n                      await createReceipt('cash');\n                      try {\n                        if (selectedDebt) {\n                          const updatedDebts = debts.map(d => d.id === selectedDebt.id ? { ...d, status: 'paid' as const, paidAmount: Math.max(Number(d.paidAmount || 0), Number(d.amount || 0)) } : d);\n                          setDebts(updatedDebts);\n                          try { setSelectedDebt(updatedDebts.find(d => d.id === selectedDebt.id) || null); } catch {}\n                          try { await saveDebtsToStorage(updatedDebts); } catch {}\n                          \n                          // Explicit sync to collection - DISABLED\n                          /*\n                          try {\n                             if (user?.uid && selectedDebt.id) {\n                                 const d = updatedDebts.find(x => x.id === selectedDebt.id);\n                                 if (d) {\n                                     const debtRef = doc(db, 'debts', d.id);\n                                     const p: any = { \n                                         ...d, \n                                         userId: user.uid, \n                                         shopId: shopIdCtx || profile?.shopId || null, \n                                         lastUpdated: new Date().toISOString() \n                                     };\n                                     Object.keys(p).forEach(key => p[key] === undefined && delete p[key]);\n                                     await setDoc(debtRef, p, { merge: true });\n                                 }\n                             }\n                          } catch (e) { console.error('Failed to sync final payment to collection (none):', e); }\n                          */\n                        }\n                      } catch {}\n                    } else if (paymentCreditSource === 'wallet') {\n                    if (!selectedWalletForPaymentCredit) {\n                      toast({\n                        title: '  ',\n                        description: '      ',\n                        variant: 'destructive',\n                      });\n                      return;\n                    }\n                    const updatedBalances = {\n                      ...walletBalances,\n                      [selectedWalletForPaymentCredit]: (walletBalances[selectedWalletForPaymentCredit] || 0) + amt,\n                    };\n                    setWalletBalances(updatedBalances);\n\n                    const timestamp = new Date().toISOString();\n                    const updateData = { walletBalances: updatedBalances, lastUpdated: timestamp };\n                    const localDataKey = `userData_${user?.uid}`;\n                    localStorage.setItem(localDataKey, JSON.stringify(updateData));\n                    localStorage.setItem(getWalletBalancesKey(), JSON.stringify(updatedBalances));\n                    localStorage.setItem(`walletBalances_backup_${timestamp}`, JSON.stringify(updatedBalances));\n                    if (user?.uid) {\n                      userDataService.updateUserData(user.uid, updateData).catch(() => setHasLocalDataToSync(true));\n                      try { localStorage.removeItem(localDataKey); } catch { }\n                      setHasLocalDataToSync(false);\n                    } else {\n                      setHasLocalDataToSync(true);\n                    }\n                      toast({\n                        title: '   ',\n                        description: `  ${amt}    ${(wallets.find(w => w.id === selectedWalletForPaymentCredit)?.phone || wallets.find(w => w.id === selectedWalletForPaymentCredit)?.name || selectedWalletForPaymentCredit)}`,\n                      });\n                      await createReceipt('wallet', selectedWalletForPaymentCredit);\n                      try {\n                        if (selectedDebt) {\n                          const updatedDebts = debts.map(d => d.id === selectedDebt.id ? { ...d, status: 'paid' as const, paidAmount: Math.max(Number(d.paidAmount || 0), Number(d.amount || 0)) } : d);\n                          setDebts(updatedDebts);\n                          try { setSelectedDebt(updatedDebts.find(d => d.id === selectedDebt.id) || null); } catch {}\n                          try { await saveDebtsToStorage(updatedDebts); } catch {}\n                        }\n                      } catch {}\n                    } else if (paymentCreditSource === 'none') {\n                      toast({\n                        title: '  ',\n                        description: `  ${amt}    `,\n                      });\n                      try {\n                        if (selectedDebt) {\n                          const updatedDebts = debts.map(d => d.id === selectedDebt.id ? { ...d, status: 'paid' as const, paidAmount: Math.max(Number(d.paidAmount || 0), Number(d.amount || 0)) } : d);\n                          setDebts(updatedDebts);\n                          try { setSelectedDebt(updatedDebts.find(d => d.id === selectedDebt.id) || null); } catch {}\n                          try { await saveDebtsToStorage(updatedDebts); } catch {}\n                          \n                          // Explicit sync to collection (None) - DISABLED\n                          /*\n                          try {\n                             if (user?.uid && selectedDebt.id) {\n                                 const d = updatedDebts.find(x => x.id === selectedDebt.id);\n                                 if (d) {\n                                     const debtRef = doc(db, 'debts', d.id);\n                                     const p: any = { \n                                         ...d, \n                                         userId: user.uid, \n                                         shopId: shopIdCtx || profile?.shopId || null, \n                                         lastUpdated: new Date().toISOString() \n                                     };\n                                     Object.keys(p).forEach(key => p[key] === undefined && delete p[key]);\n                                     await setDoc(debtRef, p, { merge: true });\n                                 }\n                             }\n                          } catch (e) { console.error('Failed to sync final payment to collection (none):', e); }\n                          */\n                        }\n                      } catch {}\n                    } else if (paymentCreditSource === 'fawry') {\n                    //        \n                    toast({\n                      title: '    ',\n                      description: `  ${amt}       `,\n                      });\n                      await createReceipt('fawry');\n                    } else {\n                    toast({\n                      title: '  ',\n                      description: '       ',\n                      variant: 'destructive',\n                    });\n                    return;\n                    }\n\n                    try {\n                      const sentAmt = amt > 0 ? amt : Number(selectedDebt?.amount || 0);\n                      if (user?.uid && selectedDebt) {\n                        await telegramNotifier.send(user.uid, `     ${selectedDebt.debtorName}:  ${sentAmt} `);\n                      }\n                    } catch {}\n                  } catch (e) {\n                    console.error('    :', e);\n                    toast({\n                      title: ' ',\n                      description: '      ',\n                    variant: 'destructive',\n                  });\n                } finally {\n                  setIsPaymentCreditChoiceOpen(false);\n                  setPaymentAmountPending(0);\n                  setPaymentCreditSource(null);\n                  setSelectedWalletForPaymentCredit('');\n                  try { setIsDebtReceiptsListOpen(true); } catch {}\n                }\n              }}\n              className=\"bg-green-600 hover:bg-green-700\"\n            >\n               \n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/*     / */}\n      <Dialog open={isPostConfirmPopupOpen} onOpenChange={setIsPostConfirmPopupOpen}>\n        <DialogContent hideClose className=\"post-confirm-card sm:max-w-[420px] w-[90vw] rounded-2xl bg-gradient-to-br from-white via-indigo-50 to-blue-50 shadow-2xl border border-indigo-100\">\n          <DialogHeader>\n            <DialogTitle className=\"text-right text-2xl font-bold\">\n              {postConfirmInfo?.type === 'transfer' ? '  ' : '  '}\n            </DialogTitle>\n            <DialogDescription className=\"text-right text-gray-600\">\n              {postConfirmInfo?.type === 'transfer'\n                ? '        .'\n                : '       .'}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-3 flex flex-col items-center gap-1.5\">\n            <div className=\"text-xl sm:text-2xl font-bold text-blue-700 tracking-wide\">{formatNumberEnglish(postConfirmInfo?.amount || 0)} </div>\n            <div className=\"text-sm text-gray-500 text-right w-full\">\n              {postConfirmInfo?.type === 'transfer'\n                ? '    .'\n                : (isCommissionAddMode\n                  ? '      .'\n                  : '     .')}\n            </div>\n          </div>\n          <DialogFooter className=\"flex justify-end gap-2\">\n            {postConfirmInfo?.type === 'transfer' && (\n              <Button\n                variant=\"outline\"\n                id=\"sendCodeBtn\"\n                onClick={triggerSendTransferCode}\n                disabled={ussdLoading}\n                className=\"btn-transfer-confirm\"\n              >\n                {ussdLoading ? ' ...' : '  '}\n              </Button>\n            )}\n            <Button\n              onClick={() => {\n                setIsPostConfirmPopupOpen(false);\n                setPostConfirmInfo(null);\n              }}\n              className=\"bg-green-600 hover:bg-green-700 text-white\"\n            >\n              {postConfirmInfo?.type === 'transfer' ? ' ' : ' '}\n            </Button>\n          </DialogFooter>\n          {postConfirmInfo?.type === 'transfer' && (\n             <div className=\"mt-4 border-t pt-4 w-full\">\n               <div className=\"flex justify-center gap-4\">\n                  <Button \n                    variant={selectedSimSlotForTransfer === 0 ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setSelectedSimSlotForTransfer(0)}\n                    className={`flex-1 h-10 ${selectedSimSlotForTransfer === 0 ? \"bg-blue-600 hover:bg-blue-700 text-white\" : \"border-blue-200 text-blue-700 hover:bg-blue-50\"}`}\n                  >\n                    SIM 1\n                  </Button>\n                  <Button \n                    variant={selectedSimSlotForTransfer === 1 ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setSelectedSimSlotForTransfer(1)}\n                    className={`flex-1 h-10 ${selectedSimSlotForTransfer === 1 ? \"bg-blue-600 hover:bg-blue-700 text-white\" : \"border-blue-200 text-blue-700 hover:bg-blue-50\"}`}\n                  >\n                    SIM 2\n                  </Button>\n               </div>\n             </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/*   PIN     */}\n      <PinModal\n        open={isPinModalOpen}\n        onClose={() => setIsPinModalOpen(false)}\n        onSubmit={handlePinSubmit}\n        deviceId={(lastDecoratedDeviceId || selectedAdbDeviceId || '')}\n        recipientMsisdn={String(\n          transactionType === 'transfer'\n            //            \n            ? (lastUSSDTransfer?.receiver || receiverPhone || '')\n            //         \n            : ((wallets.find(w => w.id === selectedWallet)?.phone) || '')\n        ).replace(/\\D/g, '')}\n      />\n\n      {/*     :       */}\n\n      <WalletsListDialog\n        isOpen={isWalletsListOpen}\n        onClose={() => setIsWalletsListOpen(false)}\n        wallets={wallets}\n        walletBalances={walletBalances}\n        onSelectWallet={(id) => {\n            setSelectedWallet(id);\n            const w = wallets.find(x => x.id === id);\n            if (w) {\n                setSenderPhone(w.phone);\n                try { localStorage.setItem(getSelectedWalletKey(), id); } catch {}\n            }\n            setIsWalletsListOpen(false);\n        }}\n        selectedWalletId={selectedWallet || undefined}\n      />\n\n      {/* Change Log Dialog */}\n      <ChangeLogDialog open={isChangeLogOpen} onOpenChange={setIsChangeLogOpen} />\n      \n      <BranchRequestDialog open={branchRequestOpen} onOpenChange={setBranchRequestOpen} />\n\n      {/*          */}\n      {showDesktopQuickIcons && <ChangeLogFloatingButton onClick={() => setIsChangeLogOpen(true)} />}\n\n\n    </div>\n  );\n};\n\nexport default UserDashboardPage;\n"],"file":"assets/UserDashboardPage-1AkkOoGQ.js"}