{"version":3,"file":"CashierShiftModal-BJpRDiuL.js","sources":["../../src/components/CashierShiftModal.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Label } from '@/components/ui/label';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Switch } from '@/components/ui/switch';\nimport { useShift } from '@/contexts/ShiftContext';\nimport { SubscriptionPlan } from '@/utils/subscriptionService';\nimport { MasterPinService } from '@/utils/masterPinService';\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\nimport { useToast } from '@/hooks/use-toast';\nimport { getLastTransactions } from '@/integrations/firebase/functions';\nimport { userDataService } from '@/integrations/firebase/services';\nimport { WalletCashService } from '@/utils/walletCashService';\nimport { db } from '@/firebase';\nimport { doc, getDoc, setDoc, addDoc, collection, serverTimestamp } from 'firebase/firestore';\n// إعادة استخدام خدمات حساب أرصدة المحافظ لحساب الإجمالي\n\ninterface Props {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nconst CashierShiftModal: React.FC<Props> = ({ open, onOpenChange }) => {\n  const { shiftUser, isShiftActive, shiftStartAt, setShiftUser, startShift, endShift } = useShift();\n  const { userSubscription, user, signIn, profile, checkSubscriptionStatus } = useFirebaseAuth();\n  const { toast } = useToast();\n  const [name, setName] = useState(shiftUser?.name || '');\n  const [username, setUsername] = useState(shiftUser?.username || '');\n  const [password, setPassword] = useState('');\n  const [handoverDialogOpen, setHandoverDialogOpen] = useState(false);\n  const [handoverMode, setHandoverMode] = useState<'toAdmin' | 'toUser' | null>(null);\n  const [mainPassword, setMainPassword] = useState('');\n  const [mainAuthError, setMainAuthError] = useState('');\n  const [isVerifyingMain, setIsVerifyingMain] = useState(false);\n  const [handoverSelectedUser, setHandoverSelectedUser] = useState<CashierUser | null>(null);\n  const [handoverPassword, setHandoverPassword] = useState('');\n  const [handoverError, setHandoverError] = useState('');\n  const [isHandoverProcessing, setIsHandoverProcessing] = useState(false);\n  const [reportDialogOpen, setReportDialogOpen] = useState(false);\n  const [reportTotals, setReportTotals] = useState<{ totalTransfers: number; totalWithdrawals: number }>({ totalTransfers: 0, totalWithdrawals: 0 });\n  const [deficitChoice, setDeficitChoice] = useState<'yes' | 'no' | null>(null);\n  const [deficitAmount, setDeficitAmount] = useState('');\n  // حقول النقدية والمحافظ للإيصال\n  const [receivedDrawerFunds, setReceivedDrawerFunds] = useState(''); // الفلوس النقدية المستلمة عند بداية الورديه\n  const [receivedWalletBalancesTotal, setReceivedWalletBalancesTotal] = useState<number>(0); // أرصدة المحافظ المستلمة (إجمالي)\n  const [receivedWalletBalancesMap, setReceivedWalletBalancesMap] = useState<Record<string, number>>({}); // تفصيل أرصدة المحافظ المستلمة\n  const [deliveredDrawerFunds, setDeliveredDrawerFunds] = useState<number>(0); // الفلوس النقدية المسلمة عند نهاية الورديه\n  const [deliveredWalletBalancesTotal, setDeliveredWalletBalancesTotal] = useState<number>(0); // أرصدة المحافظ المسلمة (إجمالي)\n  const [deliveredWalletBalancesMap, setDeliveredWalletBalancesMap] = useState<Record<string, number>>({}); // تفصيل أرصدة المحافظ عند التسليم\n  const [handoverTargetLabel, setHandoverTargetLabel] = useState<string>('');\n  // نافذة إدخال أرصدة البداية والنقدية مباشرةً بعد الدخول\n  const [initialIntakeDialogOpen, setInitialIntakeDialogOpen] = useState(false);\n\n  useEffect(() => {\n    if (open && checkSubscriptionStatus) {\n      checkSubscriptionStatus(true);\n    }\n  }, [open, checkSubscriptionStatus]);\n\n  const normalizeDigits = (s: string) => {\n    const map: Record<string, string> = {\n      '٠':'0','١':'1','٢':'2','٣':'3','٤':'4','٥':'5','٦':'6','٧':'7','٨':'8','٩':'9',\n      '۰':'0','۱':'1','۲':'2','۳':'3','۴':'4','۵':'5','۶':'6','۷':'7','۸':'8','۹':'9',\n      '٫':'.','،':'.','٬':'.',' ':'',\n    };\n    return s.split('').map(ch => map[ch] ?? ch).join('');\n  };\n\n  type CashierUser = { \n    name: string; \n    username: string; \n    password: string;\n    permissions?: {\n      sales?: boolean;\n      debts?: boolean;\n      deficiencies?: boolean;\n      cards?: boolean;\n      lines?: boolean;\n      myNumbers?: boolean;\n      installments?: boolean;\n      maintenance?: boolean;\n      machines?: boolean;\n      expenses?: boolean;\n      settings?: boolean;\n      branches?: boolean;\n      transfers?: boolean;\n      withdrawals?: boolean;\n    };\n  };\n  // مفتاح محلي مرتبط بالمستخدم لضمان عدم فقد القائمة بعد التحديث أو تبديل الحساب\n  const getCashierUsersKey = () => `cashierUsers_${user?.uid || 'default'}`;\n  const [users, setUsers] = useState<CashierUser[]>(() => {\n    try {\n      // اقرأ أولاً من المفتاح المرتبط بالمستخدم\n      let saved = localStorage.getItem(getCashierUsersKey());\n      // هجرة ودعم المفتاح القديم غير المربوط بالمستخدم\n      if (!saved) {\n        const legacy = localStorage.getItem('cashierUsers');\n        if (legacy) {\n          saved = legacy;\n        }\n      }\n      return saved ? JSON.parse(saved) : [];\n    } catch {\n      return [];\n    }\n  });\n\n  // حالة للتأكد من اكتمال الجلب الأولي لتجنب الكتابة فوق البيانات السحابية بقائمة فارغة\n  const [isDataLoaded, setIsDataLoaded] = useState(false);\n\n  // جلب مستخدمي الوردية من Firestore أو LocalStorage عند تحميل المكون أو تغيير المستخدم\n  useEffect(() => {\n    if (!user?.uid) return;\n    \n    const fetchCashierUsers = async () => {\n      let foundInCloud = false;\n      try {\n        const ref = doc(db, 'profiles', user.uid, 'cashierUsers', 'list');\n        const snap = await getDoc(ref);\n        if (snap.exists()) {\n          const data = snap.data() as any;\n          const cloudUsers: CashierUser[] = Array.isArray(data?.users) ? data.users : [];\n          if (cloudUsers.length > 0) {\n            setUsers(cloudUsers);\n            foundInCloud = true;\n          }\n        }\n      } catch (err) {\n        console.warn('Failed to fetch cashierUsers from Firestore:', err);\n      }\n\n      // في حال عدم وجود بيانات في السحابة (أو فشل الجلب)، حاول استرجاعها من التخزين المحلي\n      if (!foundInCloud) {\n        try {\n          const saved = localStorage.getItem(getCashierUsersKey());\n          const localUsers: CashierUser[] = saved ? JSON.parse(saved) : [];\n          if (localUsers.length > 0) {\n            setUsers(localUsers);\n          } else {\n             // إذا لم يوجد في السحابة ولا محلياً، نترك الحالة كما هي (فارغة أو محملة مبدئياً)\n             // لكن يمكننا التصفير إذا كنا متأكدين\n             if (users.length > 0) setUsers([]); \n          }\n        } catch {\n          // ignore\n        }\n      }\n      setIsDataLoaded(true);\n    };\n    \n    fetchCashierUsers();\n  }, [user?.uid]);\n\n  // تحديد الحد الأقصى للمستخدمين حسب الباقة\n  const planType = userSubscription?.subscription?.planType as ('monthly' | 'quarterly' | 'half_yearly' | 'yearly' | 'lifetime' | undefined);\n  \n  // التحقق من الكاشير الإضافي المعتمد وصلاحيته\n  const extraCashiers = (userSubscription?.subscription as any)?.extraCashiers || 0;\n  const extraCashiersEndsAt = (userSubscription?.subscription as any)?.extraCashiersEndsAt;\n  \n  let isExtraValid = false;\n  if (extraCashiers > 0 && extraCashiersEndsAt) {\n      // التعامل مع Timestamp أو Date\n      const expiry = extraCashiersEndsAt.seconds ? new Date(extraCashiersEndsAt.seconds * 1000) : new Date(extraCashiersEndsAt);\n      if (expiry > new Date()) {\n          isExtraValid = true;\n      }\n  }\n  \n  const effectiveExtra = isExtraValid ? extraCashiers : 0;\n\n  // شهرية (أو افتراضي): 1 مستخدم\n  // ربع سنوية / سنوية / مدى الحياة: 2 مستخدم\n  const baseLimit = (planType === 'quarterly' || planType === 'half_yearly' || planType === 'yearly' || planType === 'lifetime') ? 2 : 1;\n  const maxCashiers = baseLimit + effectiveExtra;\n\n  useEffect(() => {\n    try {\n      // احفظ تحت المفتاح المرتبط بالمستخدم\n      localStorage.setItem(getCashierUsersKey(), JSON.stringify(users));\n      // نظّف المفتاح القديم إن وُجد للحفاظ على الاتساق (اختياري)\n      try { localStorage.removeItem('cashierUsers'); } catch {}\n    } catch {}\n\n    // حفظ نسخة في السحابة أيضًا\n    const saveToCloud = async () => {\n      try {\n        if (!user?.uid) return;\n        // لا نحفظ قائمة فارغة في السحابة إلا إذا تأكدنا من اكتمال التحميل الأولي\n        if (users.length === 0 && !isDataLoaded) return;\n\n        const ref = doc(db, 'profiles', user.uid, 'cashierUsers', 'list');\n        await setDoc(ref, { users }, { merge: true });\n      } catch (e) {\n        console.warn('Failed to save cashierUsers to Cloud:', e);\n      }\n    };\n    saveToCloud();\n  }, [users, isDataLoaded, user?.uid]);\n\n  const [authDialogOpen, setAuthDialogOpen] = useState(false);\n  const [enteredPassword, setEnteredPassword] = useState('');\n  const [selectedUser, setSelectedUser] = useState<CashierUser | null>(null);\n  // تقارير التسليم المحفوظة محلياً\n  const [deliveryReports, setDeliveryReports] = useState<any[]>([]);\n  const [deliveryReportsDialogOpen, setDeliveryReportsDialogOpen] = useState(false);\n  // عرض إيصال تقرير التسليم عند الضغط على أي تقرير في الموبايل\n  const [selectedDeliveryReport, setSelectedDeliveryReport] = useState<any | null>(null);\n  const [isDeliveryReportOpen, setIsDeliveryReportOpen] = useState(false);\n  // نافذة إضافة مستخدم جديد\n  const [addUserDialogOpen, setAddUserDialogOpen] = useState(false);\n\n  const [limitWarningOpen, setLimitWarningOpen] = useState(false);\n  const [requestCashierDialogOpen, setRequestCashierDialogOpen] = useState(false);\n  const [requestCount, setRequestCount] = useState('1');\n  const [requestPlan, setRequestPlan] = useState<SubscriptionPlan>(SubscriptionPlan.MONTHLY);\n\n  const handleRequestCashier = async () => {\n    if (!user?.uid) return;\n    try {\n      await addDoc(collection(db, 'cashierRequests'), {\n        userId: user.uid,\n        userName: user.displayName || user.email,\n        userEmail: user.email,\n        requestedCount: parseInt(requestCount),\n        planType: requestPlan,\n        status: 'pending',\n        createdAt: serverTimestamp(),\n      });\n      toast({ title: 'تم إرسال الطلب بنجاح', description: 'سيتم مراجعة طلبك من قبل الإدارة' });\n      setRequestCashierDialogOpen(false);\n    } catch (error) {\n      console.error(error);\n      toast({ title: 'خطأ', description: 'حدث خطأ أثناء إرسال الطلب', variant: 'destructive' });\n    }\n  };\n\n  // صلاحيات المستخدمين\n  const [permissionsDialogOpen, setPermissionsDialogOpen] = useState(false);\n  const [userForPermissions, setUserForPermissions] = useState<CashierUser | null>(null);\n  const [permissionsAuthOpen, setPermissionsAuthOpen] = useState(false);\n  const [permissionsAuthPassword, setPermissionsAuthPassword] = useState('');\n  const [permissionsAuthError, setPermissionsAuthError] = useState('');\n\n  const handleOpenPermissionsAuth = (u: CashierUser) => {\n    setUserForPermissions(u);\n    setPermissionsAuthOpen(true);\n    setPermissionsAuthPassword('');\n    setPermissionsAuthError('');\n  };\n\n  const verifyPermissionsAuth = async () => {\n    if (!user?.uid) {\n      setPermissionsAuthError('خطأ في معرف المستخدم');\n      return;\n    }\n    try {\n      const isValid = await MasterPinService.verifyMasterPin(permissionsAuthPassword, user.uid);\n      if (!isValid) {\n        setPermissionsAuthError('الرقم السري الرئيسي غير صحيح');\n        return;\n      }\n      setPermissionsAuthOpen(false);\n      setPermissionsDialogOpen(true);\n    } catch (error) {\n      setPermissionsAuthError('حدث خطأ أثناء التحقق');\n    }\n  };\n\n  const handleSavePermissions = (newPermissions: CashierUser['permissions']) => {\n    if (!userForPermissions) return;\n    setUsers(prev => prev.map(u => \n      u.username === userForPermissions.username \n        ? { ...u, permissions: newPermissions } \n        : u\n    ));\n    \n    // تحديث المستخدم الحالي في السياق إذا كان هو نفسه\n    if (shiftUser?.username === userForPermissions.username) {\n        setShiftUser({ ...shiftUser, permissions: newPermissions });\n    }\n\n    setPermissionsDialogOpen(false);\n    setUserForPermissions(null);\n    toast({ title: 'تم تحديث الصلاحيات بنجاح' });\n  };\n\n  const handleOpenAddUser = () => {\n    if (users.length >= maxCashiers) {\n      setLimitWarningOpen(true);\n    } else {\n      setAddUserDialogOpen(true);\n    }\n  };\n\n  const handleDeleteUser = (usernameToDelete: string) => {\n    const isCurrentShiftUser = shiftUser?.username === usernameToDelete;\n    let lastHandoverToAdmin = false;\n    try { lastHandoverToAdmin = localStorage.getItem('lastHandoverToAdmin') === 'true'; } catch {}\n    const handedToAdmin = handoverTargetLabel === 'الأدمن الرئيسي' || lastHandoverToAdmin;\n    const canDeleteCurrentShiftUser = isCurrentShiftUser && !isShiftActive && handedToAdmin;\n\n    // إن كان المستخدم الجاري هو مستخدم الوردية الحالي، لا نسمح بالحذف إلا إذا تم تسليمها للأدمن الرئيسي وانتهت الوردية\n    if (isCurrentShiftUser && !canDeleteCurrentShiftUser) {\n      toast({ title: 'لا يمكن الحذف', description: 'لا يمكنك حذف مستخدم الوردية أثناء كونها نشطة أو قبل تسليمها للأدمن الرئيسي' });\n      return;\n    }\n\n    const confirmMsg = `هل أنت متأكد من حذف المستخدم ${usernameToDelete}؟\\n\\nهذا الإجراء لا يمكن التراجع عنه.`;\n    if (!window.confirm(confirmMsg)) return;\n\n    setUsers((prev) => prev.filter((u) => u.username !== usernameToDelete));\n\n    // في حال كان المستخدم المحذوف هو المستخدم المحدد للوردية، نقوم بإلغاء تعيينه من السياق بعد التسليم للأدمن\n    if (isCurrentShiftUser) {\n      setShiftUser(null);\n    }\n\n    toast({ title: 'تم حذف المستخدم', description: usernameToDelete });\n  };\n\n  const handleAddUser = () => {\n    if (!name.trim() || !username.trim() || !password.trim()) return;\n    if (users.length >= maxCashiers) {\n      toast({\n        title: 'وصلت الحد الأقصى للمستخدمين',\n        description: `هذه الباقة تسمح بإضافة ${Number.isFinite(maxCashiers) ? maxCashiers : 'عدد غير محدود'} كاشير فقط`,\n        variant: 'destructive',\n      });\n      return;\n    }\n    const newUser: CashierUser = { name: name.trim(), username: username.trim(), password: password.trim() };\n    setUsers(prev => [newUser, ...prev]);\n    // لا يتم الدخول مباشرةً، يتم الحفظ فقط تحت التسجيل\n    setName('');\n    setUsername('');\n    setPassword('');\n  };\n\n  const handleStartShift = () => {\n    // بدء الورديه يفضل أن يتم عبر اختيار مستخدم محفوظ وكلمة السر\n    if (!shiftUser) return;\n    // إعادة ضبط علم آخر تسليم للأدمن عند بدء وردية جديدة\n    try { localStorage.setItem('lastHandoverToAdmin', 'false'); } catch {}\n    startShift();\n  };\n\n  const handleEndShift = () => {\n    // عند تسليم الورديه، يختار المستخدم: التسليم لمستخدم آخر أم للأدمن الرئيسي\n    setHandoverDialogOpen(true);\n    setHandoverMode(null);\n    setHandoverSelectedUser(null);\n    setHandoverPassword('');\n    setHandoverError('');\n  };\n\n  const computeShiftTotals = async () => {\n    try {\n      // 1) المصدر الأساسي: معاملات المستخدم من Firestore\n      let transactions: any[] = [];\n      try {\n        if (user?.uid) {\n          transactions = await userDataService.getUserTransactions(user.uid);\n        }\n      } catch {}\n\n      // 2) إن لم نجد بيانات (أو كانت صفرية)، اجلب آخر المعاملات من وظائف السحابة\n      if (!transactions || transactions.length === 0) {\n        try {\n          const res = await getLastTransactions({ merchantUserId: user?.uid, limit: 200 });\n          transactions = res?.transactions || [];\n        } catch {\n          // تجاهل أي خطأ في الجلب الخارجي\n        }\n      }\n\n      // إزالة الاعتماد على التخزين المحلي لضمان المزامنة عبر الأجهزة\n\n      const startTime = shiftStartAt ? new Date(shiftStartAt) : null;\n      const now = new Date();\n\n      const isWithdrawTx = (t: any) => {\n        const type = t.type;\n        const xn = (t as any).txnType;\n        return (\n          type === 'withdraw' ||\n          type === 'withdrawal' ||\n          type === 'receive' ||\n          xn === 'receive'\n        );\n      };\n\n      const isSendTx = (t: any) => {\n        const type = t.type;\n        const xn = (t as any).txnType;\n        return (\n          type === 'send' ||\n          type === 'transfer' ||\n          xn === 'send'\n        );\n      };\n\n      const parseDate = (val: any) => {\n        if (!val) return null;\n        if (val instanceof Date) return val;\n        // قد يأتي كنص ISO أو Timestamp من Firebase\n        try {\n          const d = new Date(val);\n          return Number.isNaN(d.getTime()) ? null : d;\n        } catch {\n          return null;\n        }\n      };\n\n      const inShiftWindow = (t: any) => {\n        const created = parseDate((t as any).createdAt || (t as any).created_at || (t as any).timestamp);\n        if (!created) return false;\n        if (startTime && created < startTime) return false;\n        return created <= now;\n      };\n\n      const isCompletedStatus = (s: any) => {\n        return s === 'completed' || s === 'confirmed'; // توافق بين مخططات الواجهة وFirebase\n      };\n\n      const completed = transactions.filter((t: any) => isCompletedStatus(t.status) && inShiftWindow(t));\n\n      const totalWithdrawals = completed\n        .filter((t: any) => isWithdrawTx(t))\n        .reduce((sum: number, t: any) => {\n          const amount = (t as any).withdrawnAmount ?? (t as any).receivedAmount ?? (t as any).amount ?? 0;\n          return sum + (Number(amount) || 0);\n        }, 0);\n\n      const totalTransfers = completed\n        .filter((t: any) => isSendTx(t))\n        .reduce((sum: number, t: any) => {\n          const amount = (t as any).sentAmount ?? (t as any).transferredAmount ?? (t as any).amount ?? 0;\n          return sum + (Number(amount) || 0);\n        }, 0);\n\n      return { totalTransfers, totalWithdrawals };\n    } catch {\n      return { totalTransfers: 0, totalWithdrawals: 0 };\n    }\n  };\n\n  // وضع إدخال يدوي: لا نقوم بأي تعبئة تلقائية عند فتح تقرير التسليم\n  useEffect(() => {\n    if (!reportDialogOpen) return;\n    // عند فتح التقرير، نملأ القيم تلقائياً من إدخال البداية إن وُجدت\n    try {\n      const d = localStorage.getItem('shiftInitialReceivedDrawerFunds');\n      if (d !== null) setReceivedDrawerFunds(d);\n    } catch {}\n    try {\n      const w = localStorage.getItem('shiftInitialReceivedWalletBalancesTotal');\n      if (w !== null) {\n        const v = parseFloat(w);\n        setReceivedWalletBalancesTotal(Number.isFinite(v) ? v : 0);\n      }\n    } catch {}\n  }, [reportDialogOpen]);\n\n  useEffect(() => {\n    if (!handoverDialogOpen) return;\n    (async () => {\n      try {\n        const t = await computeShiftTotals();\n        setReportTotals(t);\n      } catch {}\n    })();\n  }, [handoverDialogOpen]);\n\n  // تحميل تقارير التسليم لعرضها داخل صفحة إضافة المستخدم\n  useEffect(() => {\n    if (!open && !deliveryReportsDialogOpen) return;\n    const loadReports = async () => {\n      try {\n        const txs = user?.uid ? await userDataService.getUserTransactions(user.uid) : [];\n        const reports = (txs || []).filter((t: any) => t?.type === 'report' || (t?.title || '').includes('إيصال تسليم وردية'));\n        reports.sort((a: any, b: any) => {\n          const ad = new Date(a.createdAt || 0).getTime();\n          const bd = new Date(b.createdAt || 0).getTime();\n          return bd - ad;\n        });\n        setDeliveryReports(reports);\n      } catch {\n        setDeliveryReports([]);\n      }\n    };\n    loadReports();\n  }, [open, reportDialogOpen, deliveryReportsDialogOpen, user?.uid]);\n\n  const saveShiftReceiptToRecent = async (totals: { totalTransfers: number; totalWithdrawals: number }, deficit: boolean, deficitAmt: number) => {\n    try {\n      // قراءة قيَم البداية المحفوظة لمنع أي تعديل عليها عند التسليم\n      let initialDrawerFunds = 0;\n      let initialWalletBalancesTotal = 0;\n      try {\n        const d = parseFloat(localStorage.getItem('shiftInitialReceivedDrawerFunds') || '0');\n        initialDrawerFunds = Number.isFinite(d) ? d : 0;\n      } catch {}\n      try {\n        const w = parseFloat(localStorage.getItem('shiftInitialReceivedWalletBalancesTotal') || '0');\n        initialWalletBalancesTotal = Number.isFinite(w) ? w : 0;\n      } catch {}\n      const receipt = {\n        id: `shift_receipt_${Date.now()}`,\n        type: 'report',\n        senderPhone: shiftUser?.username || 'cashier',\n        receiverPhone: handoverTargetLabel || 'admin',\n        amount: 0,\n        status: 'completed',\n        createdAt: new Date().toISOString(),\n        title: 'إيصال تسليم وردية',\n        // تثبيت اسم الكاشير على إيصال التسليم حتى بعد انتهاء الوردية\n        cashierName: shiftUser?.name || shiftUser?.username || null,\n        deficit: deficit,\n        deficitAmount: deficit ? deficitAmt : 0,\n        shiftStartAt,\n        // حقول النقدية والمحافظ\n        receivedDrawerFunds: initialDrawerFunds,\n        receivedWalletBalancesTotal: initialWalletBalancesTotal,\n        receivedWalletBalances: receivedWalletBalancesMap,\n        deliveredDrawerFunds: deliveredDrawerFunds || 0,\n        deliveredWalletBalancesTotal: deliveredWalletBalancesTotal || 0,\n        deliveredWalletBalances: deliveredWalletBalancesMap,\n        // ربح الوردية المحسوب من القيم الموثّقة\n        shiftProfit: Math.round((((deliveredDrawerFunds || 0) + (deliveredWalletBalancesTotal || 0)) - (initialDrawerFunds + initialWalletBalancesTotal)) * 100) / 100,\n      };\n\n      if (user?.uid) {\n        await userDataService.saveUserTransaction(user.uid, receipt);\n      }\n\n      // حدِّث قائمة تقارير التسليم في الواجهة فورًا\n      setDeliveryReports(prev => [receipt, ...(prev || [])]);\n    } catch {}\n  };\n\n  const visibleUsers = users.slice(Math.max(0, users.length - maxCashiers));\n\n  return (\n    <>\n      <Dialog open={open} onOpenChange={onOpenChange}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n        <DialogTitle>{isShiftActive ? 'تسليم الورديه والخروج' : 'إضافة مستخدم وردية'}</DialogTitle>\n          </DialogHeader>\n          {!isShiftActive ? (\n            <div className=\"space-y-4\">\n              <div className=\"text-xs text-gray-600\">لاستكمال إضافة مستخدم جديد اضغط الزر أسفل \"إضافة مستخدم جديد\" لفتح النموذج.</div>\n\n              {/* قائمة المستخدمين المسجلين */}\n              {users.length > 0 && (\n                <div className=\"mt-4 border-t pt-3\">\n                  <div className=\"text-sm font-medium mb-2\">المستخدمون المسجلون</div>\n                  <div className=\"space-y-2 max-h-48 overflow-auto\">\n                    {visibleUsers.map((u, idx) => (\n                      <div key={idx} className=\"flex items-center justify-between rounded border px-3 py-2\">\n                        <div>\n                          <div className=\"text-sm font-semibold\">{u.name}</div>\n                          <div className=\"text-xs text-gray-500\">{u.username}</div>\n                        </div>\n                        <div className=\"flex items-center gap-2 flex-wrap\">\n                          <Button size=\"sm\" className=\"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white\" onClick={() => { setSelectedUser(u); setAuthDialogOpen(true); }}>دخول</Button>\n                          <Button size=\"sm\" className=\"w-full sm:w-auto\" variant=\"outline\" onClick={() => handleOpenPermissionsAuth(u)}>الصلاحيات</Button>\n                          <Button size=\"sm\" className=\"w-full sm:w-auto\" variant=\"destructive\" onClick={() => handleDeleteUser(u.username)}>حذف</Button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              <div className=\"p-3 rounded border bg-gray-50\">\n                <div className=\"text-sm\">المستخدم الحالي للوردية:</div>\n                <div className=\"font-semibold text-sm\">{shiftUser?.name} ({shiftUser?.username})</div>\n              </div>\n            <div className=\"text-xs text-gray-600\">لإنهاء الوردية والخروج، اضغط \"تسليم الورديه والخروج\" وسيُطلب الرقم السري.</div>\n            </div>\n          )}\n          <DialogFooter className=\"flex flex-wrap gap-2 justify-between\">\n            {!isShiftActive ? (\n            <div className=\"flex flex-wrap gap-2\">\n              <Button className=\"w-full sm:w-auto bg-emerald-600 hover:bg-emerald-700 text-white\" onClick={handleOpenAddUser}>إضافة مستخدم جديد</Button>\n              <Button className=\"w-full sm:w-auto\" variant=\"outline\" onClick={() => setDeliveryReportsDialogOpen(true)}>إيصالات التسليم</Button>\n            </div>\n          ) : (\n              <div className=\"flex flex-wrap gap-2\">\n                <Button className=\"w-full sm:w-auto\" variant=\"destructive\" onClick={handleEndShift}>تسليم الورديه والخروج</Button>\n              </div>\n            )}\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* نافذة تحذير تجاوز الحد المسموح */}\n      <Dialog open={limitWarningOpen} onOpenChange={setLimitWarningOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"text-red-600 flex items-center gap-2\">\n              <span className=\"text-xl\">⚠️</span> تنبيه: الحد الأقصى للمستخدمين\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <p className=\"text-sm text-gray-700 leading-relaxed\">\n              عفواً، لا يمكنك إضافة المزيد من مستخدمي الوردية. <br />\n              الحد المسموح به لباقة اشتراكك هو <strong>{maxCashiers}</strong> {maxCashiers === 1 ? 'مستخدم' : 'مستخدمين'}.\n            </p>\n            <p className=\"text-sm text-gray-600\">\n              لزيادة عدد المستخدمين، يرجى التواصل مع خدمة العملاء لترقية الباقة أو طلب زيادة العدد.\n            </p>\n          </div>\n          <DialogFooter className=\"flex flex-col sm:flex-row gap-2 justify-end\">\n            <Button \n              className=\"w-full sm:w-auto\" \n              onClick={() => setLimitWarningOpen(false)}\n              variant=\"secondary\"\n            >\n              حسناً، فهمت\n            </Button>\n            <Button \n              className=\"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white\" \n              onClick={() => {\n                  setLimitWarningOpen(false);\n                  setRequestCashierDialogOpen(true);\n              }}\n            >\n              طلب إضافة كاشير\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* نافذة طلب كاشير إضافي */}\n      <Dialog open={requestCashierDialogOpen} onOpenChange={setRequestCashierDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>طلب زيادة عدد الكاشير</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <p className=\"text-sm text-gray-600\">\n              يمكنك طلب زيادة عدد الكاشير المسموح به. سيتم مراجعة الطلب من قبل الإدارة.\n            </p>\n            \n            <div className=\"space-y-2\">\n              <Label>عدد الكاشير المطلوب إضافتهم</Label>\n              <Input \n                type=\"number\" \n                min=\"1\" \n                max=\"10\" \n                value={requestCount} \n                onChange={(e) => setRequestCount(e.target.value)} \n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>نظام الاشتراك للكاشير الإضافي</Label>\n              <Select value={requestPlan} onValueChange={(v) => setRequestPlan(v as SubscriptionPlan)}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"اختر الباقة\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value={SubscriptionPlan.MONTHLY}>شهري</SelectItem>\n                  <SelectItem value={SubscriptionPlan.QUARTERLY}>ربع سنوي</SelectItem>\n                  <SelectItem value={SubscriptionPlan.YEARLY}>سنوي</SelectItem>\n                  <SelectItem value={SubscriptionPlan.LIFETIME}>مدى الحياة</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"secondary\" onClick={() => setRequestCashierDialogOpen(false)}>إلغاء</Button>\n            <Button className=\"bg-blue-600 hover:bg-blue-700 text-white\" onClick={handleRequestCashier}>إرسال الطلب</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* نافذة إضافة مستخدم جديد */}\n      <Dialog open={addUserDialogOpen} onOpenChange={setAddUserDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>إضافة مستخدم جديد</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label className=\"mb-1 block\">الاسم</Label>\n              <Input value={name} onChange={(e) => setName(e.target.value)} placeholder=\"أدخل الاسم\" />\n            </div>\n            <div>\n              <Label className=\"mb-1 block\">اسم المستخدم</Label>\n              <Input value={username} onChange={(e) => setUsername(e.target.value)} placeholder=\"أدخل اسم المستخدم\" />\n            </div>\n            <div>\n              <Label className=\"mb-1 block\">الرقم السري</Label>\n              <Input \n                type=\"password\" \n                autoComplete=\"new-password\" \n                value={password} \n                onChange={(e) => setPassword(e.target.value)} \n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') {\n                    e.preventDefault();\n                    if (name.trim() && username.trim() && password.trim()) {\n                      handleAddUser();\n                      setAddUserDialogOpen(false);\n                    }\n                  }\n                }}\n                placeholder=\"أدخل الرقم السري\" \n              />\n            </div>\n            <div className=\"text-xs text-gray-500\">المستخدم يمكنه: التحويل، السحب، اختيار المحفظة فقط.</div>\n          </div>\n          <DialogFooter className=\"flex gap-2 justify-between\">\n            <Button\n              variant=\"secondary\"\n              onClick={() => {\n                setAddUserDialogOpen(false);\n              }}\n            >إلغاء</Button>\n            <Button\n              onClick={() => {\n                if (!name.trim() || !username.trim() || !password.trim()) return;\n                handleAddUser();\n                setAddUserDialogOpen(false);\n              }}\n            className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n            >حفظ المستخدم</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* نافذة التحقق من المدير للصلاحيات */}\n      <Dialog open={permissionsAuthOpen} onOpenChange={setPermissionsAuthOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>تأكيد هوية المدير</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <p className=\"text-sm text-gray-600\">يرجى إدخال الرقم السري الرئيسي (كلمة مرور حسابك) لفتح إعدادات الصلاحيات.</p>\n            <div>\n              <Label className=\"mb-1 block\">كلمة المرور</Label>\n              <Input\n                type=\"password\"\n                value={permissionsAuthPassword}\n                onChange={(e) => setPermissionsAuthPassword(e.target.value)}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') {\n                    e.preventDefault();\n                    verifyPermissionsAuth();\n                  }\n                }}\n                placeholder=\"أدخل كلمة المرور\"\n              />\n              {permissionsAuthError && <p className=\"text-red-500 text-xs mt-1\">{permissionsAuthError}</p>}\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setPermissionsAuthOpen(false)}>إلغاء</Button>\n            <Button onClick={verifyPermissionsAuth} className=\"bg-blue-600 hover:bg-blue-700 text-white\">تأكيد</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* نافذة إدارة الصلاحيات */}\n      <Dialog open={permissionsDialogOpen} onOpenChange={setPermissionsDialogOpen}>\n        <DialogContent className=\"sm:max-w-lg max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>صلاحيات المستخدم: {userForPermissions?.name}</DialogTitle>\n          </DialogHeader>\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 py-4\">\n             {[\n               { key: 'sales', label: 'المبيعات' },\n               { key: 'debts', label: 'الديون' },\n               { key: 'deficiencies', label: 'النواقص' },\n               { key: 'cards', label: 'البطاقات' },\n               { key: 'lines', label: 'الخطوط' },\n               { key: 'myNumbers', label: 'أرقامي' },\n               { key: 'installments', label: 'تقسيط' },\n               { key: 'maintenance', label: 'صيانة' },\n               { key: 'machines', label: 'المكنة' },\n               { key: 'expenses', label: 'المصروفات' },\n               { key: 'settings', label: 'الإعدادات' },\n               { key: 'branches', label: 'الفروع' },\n               { key: 'transfers', label: 'التحويل' },\n               { key: 'withdrawals', label: 'السحب' },\n             ].map((perm) => {\n               const isPermitted = userForPermissions?.permissions?.[perm.key as keyof import('@/contexts/ShiftContext').ShiftPermissions] !== false;\n               return (\n               <div key={perm.key} className=\"flex items-center justify-between border p-3 rounded bg-gray-50 dark:bg-gray-800\">\n                 <Label htmlFor={`perm-${perm.key}`} className=\"cursor-pointer font-medium\">{perm.label}</Label>\n                 <Button\n                   id={`perm-${perm.key}`}\n                   size=\"sm\"\n                   onClick={() => {\n                     if (!userForPermissions) return;\n                     setUserForPermissions({\n                       ...userForPermissions,\n                       permissions: {\n                         ...userForPermissions.permissions,\n                         [perm.key]: !isPermitted\n                       }\n                     });\n                   }}\n                   className={`w-24 font-bold text-white transition-colors ${\n                     isPermitted \n                       ? 'bg-green-600 hover:bg-green-700' \n                       : 'bg-red-600 hover:bg-red-700'\n                   }`}\n                 >\n                   {isPermitted ? 'مفعل' : 'معطل'}\n                 </Button>\n               </div>\n               );\n             })}\n          </div>\n          <DialogFooter>\n            <Button \n              onClick={() => handleSavePermissions(userForPermissions?.permissions)}\n              className=\"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white\"\n            >\n              حفظ الصلاحيات\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* نافذة عرض كل إيصالات التسليم */}\n      <Dialog open={deliveryReportsDialogOpen} onOpenChange={setDeliveryReportsDialogOpen}>\n        <DialogContent className=\"sm:max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>إيصالات التسليم</DialogTitle>\n          </DialogHeader>\n          {deliveryReports.length === 0 ? (\n            <div className=\"text-xs text-gray-600\">لا توجد إيصالات تسليم محفوظة بعد.</div>\n          ) : (\n            <div className=\"space-y-2 max-h-[60vh] overflow-auto\">\n              {deliveryReports.map((r: any) => (\n                <div\n                  key={r.id}\n                  className=\"rounded border px-3 py-2 cursor-pointer hover:bg-gray-50\"\n                  onClick={() => {\n                    setSelectedDeliveryReport(r);\n                    setIsDeliveryReportOpen(true);\n                  }}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"text-sm font-semibold\">{new Date(r.createdAt).toLocaleString('ar-EG')}</div>\n                    <div className=\"text-xs text-gray-500\">إلى: {r.receiverPhone}</div>\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-2 mt-1\">\n                    <div className=\"text-xs text-gray-600\">نقدية مسلّمة: {r.deliveredDrawerFunds ?? 0}</div>\n                    <div className=\"text-xs text-gray-600\">محافظ مسلّمة (إجمالي): {r.deliveredWalletBalancesTotal ?? 0}</div>\n                    <div className=\"text-xs text-gray-600\">نقدية مستلمة: {r.receivedDrawerFunds ?? 0}</div>\n                    <div className=\"text-xs text-gray-600\">محافظ مستلمة (إجمالي): {r.receivedWalletBalancesTotal ?? 0}</div>\n                    <div className=\"text-xs text-gray-600\">نقدية مسلّمة: {r.deliveredDrawerFunds ?? 0}</div>\n                    <div className=\"text-xs text-gray-600\">محافظ مسلّمة (إجمالي): {r.deliveredWalletBalancesTotal ?? 0}</div>\n                    <div className=\"text-xs text-gray-600\">نقدية مستلمة: {r.receivedDrawerFunds ?? 0}</div>\n                    <div className=\"text-xs text-gray-600\">محافظ مستلمة (إجمالي): {r.receivedWalletBalancesTotal ?? 0}</div>\n                    <div className={[\n                      'text-xs',\n                      ((r.shiftProfit ?? ((r.deliveredDrawerFunds ?? 0) + (r.deliveredWalletBalancesTotal ?? 0) - (r.receivedDrawerFunds ?? 0) - (r.receivedWalletBalancesTotal ?? 0))) >= 0)\n                        ? 'text-green-700'\n                        : 'text-red-700'\n                    ].join(' ')}>أرباح الوردية: {r.shiftProfit ?? ((r.deliveredDrawerFunds ?? 0) + (r.deliveredWalletBalancesTotal ?? 0) - (r.receivedDrawerFunds ?? 0) - (r.receivedWalletBalancesTotal ?? 0))}</div>\n                  </div>\n                  {r.deficit && (\n                    <div className=\"text-xs text-red-600 mt-1\">عجز: {r.deficitAmount ?? 0}</div>\n                  )}\n                </div>\n              ))}\n            </div>\n          )}\n          <DialogFooter className=\"flex gap-2 justify-between\">\n            <Button variant=\"secondary\" onClick={() => setDeliveryReportsDialogOpen(false)}>إغلاق</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* عرض إيصال تقرير التسليم عند اختيار تقرير */}\n      <Dialog open={isDeliveryReportOpen} onOpenChange={setIsDeliveryReportOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>إيصال تسليم وردية</DialogTitle>\n          </DialogHeader>\n          {selectedDeliveryReport ? (\n            <div className=\"space-y-3\">\n              <div className=\"p-3 rounded border bg-gray-50\">\n                <div className=\"text-sm\">التاريخ: {new Date(selectedDeliveryReport.createdAt).toLocaleString('ar-EG')}</div>\n                <div className=\"text-xs text-gray-600 mt-1\">تم التسليم إلى: {selectedDeliveryReport.receiverPhone}</div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div className=\"rounded border p-3\">\n                  <div className=\"text-sm font-semibold mb-2\">المستلم عند الدخول</div>\n                  <div className=\"text-xs text-gray-600\">نقدية: {selectedDeliveryReport.receivedDrawerFunds ?? 0}</div>\n                  <div className=\"text-xs text-gray-600\">أرصدة المحافظ (إجمالي): {selectedDeliveryReport.receivedWalletBalancesTotal ?? 0}</div>\n                </div>\n                <div className=\"rounded border p-3\">\n                  <div className=\"text-sm font-semibold mb-2\">المسلّم عند الخروج</div>\n                  <div className=\"text-xs text-gray-600\">نقدية: {selectedDeliveryReport.deliveredDrawerFunds ?? 0}</div>\n                  <div className=\"text-xs text-gray-600\">أرصدة المحافظ (إجمالي): {selectedDeliveryReport.deliveredWalletBalancesTotal ?? 0}</div>\n                </div>\n              </div>\n              {selectedDeliveryReport.deficit && (\n                <div className=\"rounded border p-3\">\n                  <div className=\"text-sm font-semibold mb-2 text-red-600\">عجز</div>\n                  <div className=\"text-xs text-red-600\">المبلغ: {selectedDeliveryReport.deficitAmount ?? 0}</div>\n                </div>\n              )}\n              {/* تفصيل أرصدة المحافظ إن وُجد */}\n              {(selectedDeliveryReport.receivedWalletBalances && Object.keys(selectedDeliveryReport.receivedWalletBalances).length > 0) && (\n                <div className=\"rounded border p-3\">\n                  <div className=\"text-sm font-semibold mb-2\">تفصيل المحافظ المستلمة</div>\n                  <div className=\"space-y-1\">\n                    {Object.entries(selectedDeliveryReport.receivedWalletBalances as Record<string, number>).map(([k, v]) => (\n                      <div key={k} className=\"flex items-center justify-between text-xs\">\n                        <span className=\"text-gray-600\">{k}</span>\n                        <span className=\"font-semibold\">{v}</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n              {(selectedDeliveryReport.deliveredWalletBalances && Object.keys(selectedDeliveryReport.deliveredWalletBalances).length > 0) && (\n                <div className=\"rounded border p-3\">\n                  <div className=\"text-sm font-semibold mb-2\">تفصيل المحافظ المسلّمة</div>\n                  <div className=\"space-y-1\">\n                    {Object.entries(selectedDeliveryReport.deliveredWalletBalances as Record<string, number>).map(([k, v]) => (\n                      <div key={k} className=\"flex items-center justify-between text-xs\">\n                        <span className=\"text-gray-600\">{k}</span>\n                        <span className=\"font-semibold\">{v}</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n          ) : (\n            <div className=\"text-xs text-gray-600\">لا يوجد تقرير محدد للعرض.</div>\n          )}\n          <DialogFooter className=\"flex gap-2 justify-between\">\n            <Button variant=\"secondary\" onClick={() => setIsDeliveryReportOpen(false)}>إغلاق</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* حوار إدخال كلمة السر للدخول */}\n      <Dialog open={authDialogOpen} onOpenChange={setAuthDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>أدخل الرقم السري للدخول</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-3\">\n            <div className=\"text-sm\">{selectedUser ? `${selectedUser.name} (${selectedUser.username})` : ''}</div>\n            <Input\n              type=\"password\"\n              autoComplete=\"off\"\n              value={enteredPassword}\n              onChange={(e) => setEnteredPassword(e.target.value)}\n              onKeyDown={(e) => {\n                if (e.key === 'Enter') {\n                  e.preventDefault();\n                  document.getElementById('login-confirm-btn')?.click();\n                }\n              }}\n              placeholder=\"أدخل الرقم السري\"\n            />\n          </div>\n          <DialogFooter className=\"flex gap-2 justify-between\">\n            <Button\n              variant=\"secondary\"\n              onClick={() => { setEnteredPassword(''); setSelectedUser(null); setAuthDialogOpen(false); }}\n            >إلغاء</Button>\n            <Button\n              id=\"login-confirm-btn\"\n              className=\"bg-emerald-600 hover:bg-emerald-700 text-white\"\n              onClick={() => {\n                if (!selectedUser) return;\n                if (enteredPassword.trim() !== selectedUser.password) {\n                  toast({ title: 'خطأ في الرقم السري', description: 'الرقم السري للكاشير غير صحيح', variant: 'destructive' });\n                  return;\n                }\n                setShiftUser({ name: selectedUser.name, username: selectedUser.username, permissions: selectedUser.permissions });\n                setEnteredPassword('');\n                setAuthDialogOpen(false);\n                onOpenChange(false);\n                startShift();\n                // فتح نافذة إدخال أرصدة البداية والنقدية مباشرةً\n                setInitialIntakeDialogOpen(true);\n              }}\n            >دخول الورديه</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* نافذة إدخال أرصدة المحافظ والمال النقدي عند بداية الوردية */}\n      <Dialog open={initialIntakeDialogOpen} onOpenChange={setInitialIntakeDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>تسجيل أرصدة البداية والنقدية</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"rounded border p-3\">\n              <Label className=\"mb-1 block\">الفلوس النقدية المستلمة عند الدخول</Label>\n              <Input\n                type=\"text\"\n                inputMode=\"decimal\"\n                value={receivedDrawerFunds}\n                onChange={(e) => setReceivedDrawerFunds(normalizeDigits(e.target.value))}\n                placeholder=\"أدخل قيمة النقدية في الدرج عند بداية الورديه\"\n              />\n            </div>\n            <div className=\"rounded border p-3\">\n              <Label className=\"mb-1 block\">أرصدة المحافظ المستلمة (إجمالي) عند الدخول</Label>\n              <Input\n                type=\"text\"\n                inputMode=\"decimal\"\n                value={Number.isFinite(receivedWalletBalancesTotal) ? receivedWalletBalancesTotal : 0}\n                onChange={(e) => {\n                  const v = parseFloat(normalizeDigits(e.target.value));\n                  setReceivedWalletBalancesTotal(Number.isFinite(v) ? v : 0);\n                }}\n                placeholder=\"أدخل إجمالي أرصدة المحافظ عند بداية الورديه\"\n              />\n              <div className=\"text-xs text-gray-600 mt-1\">يمكن إضافة التفصيل لاحقاً إن لزم، المهم تسجيل الإجمالي.</div>\n            </div>\n          </div>\n          <DialogFooter className=\"flex gap-2 justify-between\">\n            <Button\n              className=\"bg-emerald-600 hover:bg-emerald-700 text-white\"\n              onClick={() => {\n                const drawer = parseFloat(receivedDrawerFunds);\n                const wallets = receivedWalletBalancesTotal;\n                const isDrawerValid = Number.isFinite(drawer) && drawer >= 0;\n                const isWalletsValid = Number.isFinite(wallets) && wallets >= 0;\n                if (!isDrawerValid || !isWalletsValid) {\n                  toast({ title: 'يرجى إدخال قيم صحيحة', description: 'أدخل قيمًا رقمية غير سالبة للنقدية ولإجمالي أرصدة المحافظ', variant: 'destructive' });\n                  return;\n                }\n                // حفظ قيَم البداية محلياً لربطها بإيصال التسليم لاحقاً\n                try {\n                  localStorage.setItem('shiftInitialReceivedDrawerFunds', String(drawer));\n                  localStorage.setItem('shiftInitialReceivedWalletBalancesTotal', String(wallets));\n                } catch {}\n                toast({ title: 'تم تسجيل أرصدة البداية', description: 'سُجّل إجمالي النقدية وأرصدة المحافظ لبداية الورديه' });\n                setInitialIntakeDialogOpen(false);\n              }}\n            >تأكيد وحفظ</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* حوار تسليم الورديه: اختيار التسليم لمستخدم آخر أو للأدمن */}\n      <Dialog open={handoverDialogOpen} onOpenChange={(open) => { if (open) setHandoverDialogOpen(true); }}>\n        <DialogContent className=\"sm:max-w-md\" hideClose disableOutsideClose disableEscClose>\n          <DialogHeader>\n            <DialogTitle>تسليم الورديه والخروج</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {/* اختيار الوجهة */}\n            <div className=\"flex items-center gap-2\">\n              <Button\n                variant={handoverMode === 'toUser' ? 'default' : 'secondary'}\n                onClick={() => setHandoverMode('toUser')}\n              >تسليم إلى مستخدم آخر</Button>\n              <Button\n                variant={handoverMode === 'toAdmin' ? 'default' : 'secondary'}\n                onClick={() => setHandoverMode('toAdmin')}\n              >تسليم إلى الأدمن الرئيسي</Button>\n            </div>\n\n            {/* نموذج تسليم إلى مستخدم آخر */}\n            {handoverMode === 'toUser' && (\n              <div className=\"space-y-3\">\n                {users.length === 0 ? (\n                  <div className=\"text-sm text-gray-600\">لا يوجد مستخدمون مسجلون. قم بإضافة مستخدم أولاً.</div>\n                ) : (\n                  <div className=\"space-y-2\">\n                    <div className=\"text-sm font-medium\">اختر المستخدم الذي سيتسلم الورديه</div>\n                    <div className=\"space-y-2 max-h-40 overflow-auto\">\n                      {visibleUsers.map((u, idx) => (\n                        <div\n                          key={idx}\n                          className={`flex items-center justify-between rounded border px-3 py-2 cursor-pointer ${handoverSelectedUser?.username === u.username ? 'bg-indigo-50 border-indigo-200' : ''}`}\n                          onClick={() => setHandoverSelectedUser(u)}\n                        >\n                          <div>\n                            <div className=\"text-sm font-semibold\">{u.name}</div>\n                            <div className=\"text-xs text-gray-500\">{u.username}</div>\n                          </div>\n                          <span className=\"text-xs text-gray-400\">اختيار</span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n                <div>\n                  <Label className=\"mb-1 block\">كلمة سر المستخدم المحدد</Label>\n                  <Input\n                    type=\"password\"\n                    autoComplete=\"off\"\n                    value={handoverPassword}\n                    onChange={(e) => setHandoverPassword(e.target.value)}\n                    placeholder=\"أدخل كلمة السر\"\n                  />\n                </div>\n                {handoverError && <div className=\"text-xs text-red-600\">{handoverError}</div>}\n              </div>\n            )}\n\n            {/* نموذج تسليم إلى الأدمن الرئيسي */}\n            {handoverMode === 'toAdmin' && (\n              <div className=\"space-y-3\">\n                <div className=\"text-sm text-gray-600\">أدخل كلمة مرور الحساب الرئيسي لتسليم الورديه والخروج إلى الأدمن.</div>\n                <Input\n                  type=\"password\"\n                  autoComplete=\"off\"\n                  value={mainPassword}\n                  onChange={(e) => setMainPassword(e.target.value)}\n                  placeholder=\"كلمة المرور\"\n                />\n                {mainAuthError && (\n                  <div className=\"text-xs text-red-600\">{mainAuthError}</div>\n                )}\n              </div>\n            )}\n          </div>\n          <DialogFooter className=\"flex gap-2 justify-between\">\n            <Button\n              id=\"handover-confirm-btn\"\n              disabled={isHandoverProcessing || !handoverMode}\n              onClick={async () => {\n                if (!handoverMode) return;\n                setIsHandoverProcessing(true);\n                try {\n                  const totals = reportTotals;\n                  computeShiftTotals().then(setReportTotals).catch(() => {});\n                  if (handoverMode === 'toUser') {\n                    if (!handoverSelectedUser) {\n                      setHandoverError('يرجى اختيار المستخدم أولاً');\n                      setIsHandoverProcessing(false);\n                      return;\n                    }\n                    if (handoverPassword.trim() !== handoverSelectedUser.password) {\n                      setHandoverError('كلمة السر غير صحيحة');\n                      setIsHandoverProcessing(false);\n                      return;\n                    }\n                    // إنهاء الورديه الحالية وتسليمها للمستخدم المحدد\n                    endShift();\n                    setShiftUser({ name: handoverSelectedUser.name, username: handoverSelectedUser.username, permissions: handoverSelectedUser.permissions });\n                    startShift();\n                    setHandoverTargetLabel(`${handoverSelectedUser.name} (${handoverSelectedUser.username})`);\n                    // تحديث العلم الدائم: آخر تسليم ليس للأدمن\n                    try { localStorage.setItem('lastHandoverToAdmin', 'false'); } catch {}\n                    // تنظيف وإغلاق\n                    setHandoverDialogOpen(false);\n                    setHandoverMode(null);\n                    setHandoverSelectedUser(null);\n                    setHandoverPassword('');\n                    setHandoverError('');\n                    onOpenChange(false);\n                    // عرض تقرير التسليم\n                    setReportTotals(totals);\n                    setDeficitChoice(null);\n                    setDeficitAmount('');\n                    setReportDialogOpen(true);\n                  } else if (handoverMode === 'toAdmin') {\n                    setMainAuthError('');\n                    if (!user?.uid) {\n                      setMainAuthError('خطأ في معرف المستخدم');\n                      setIsHandoverProcessing(false);\n                      return;\n                    }\n                    const isValid = await MasterPinService.verifyMasterPin(mainPassword, user.uid);\n                    if (!isValid) {\n                      setMainAuthError('الرقم السري الرئيسي غير صحيح');\n                      setIsHandoverProcessing(false);\n                      return;\n                    }\n                    // إنهاء الوردية وتسليمها للأدمن (العودة للوضع الرئيسي)\n                    endShift();\n                    // تسجيل خروج مستخدم الوردية الحالي ليصبح قابلاً للحذف\n                    setShiftUser(null);\n                    // حفظ علم دائم بأن آخر تسليم كان للأدمن الرئيسي\n                    try { localStorage.setItem('lastHandoverToAdmin', 'true'); } catch {}\n                    setMainPassword('');\n                    setHandoverDialogOpen(false);\n                    onOpenChange(false);\n                    setHandoverTargetLabel('الأدمن الرئيسي');\n                    // عرض تقرير التسليم\n                    setReportTotals(totals);\n                    setDeficitChoice(null);\n                    setDeficitAmount('');\n                    setReportDialogOpen(true);\n                  }\n                } catch (e) {\n                  console.error(e);\n                  const errorMsg = 'حدث خطأ أثناء التسليم، حاول مرة أخرى';\n                  if (handoverMode === 'toAdmin') {\n                    setMainAuthError(errorMsg);\n                  } else {\n                    setHandoverError(errorMsg);\n                  }\n                  toast({ title: 'خطأ', description: errorMsg, variant: 'destructive' });\n                } finally {\n                  setIsHandoverProcessing(false);\n                }\n              }}\n            className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n            >\n              {isHandoverProcessing ? (\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                  جاري المعالجة...\n                </div>\n              ) : 'تأكيد التسليم'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* نافذة تقرير تسليم الورديه والخروج */}\n      <Dialog open={reportDialogOpen} onOpenChange={setReportDialogOpen}>\n        <DialogContent className=\"sm:max-w-lg\" hideClose disableOutsideClose disableEscClose>\n          <DialogHeader>\n            <DialogTitle>تقرير تسليم الورديه والخروج</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"p-3 rounded border bg-gray-50\">\n              <div className=\"text-sm\">تم تسليم الورديه إلى: <span className=\"font-semibold\">{handoverTargetLabel}</span></div>\n              {shiftStartAt && (\n                <div className=\"text-xs text-gray-600 mt-1\">بداية الورديه: {new Date(shiftStartAt).toLocaleString('ar-EG')}</div>\n              )}\n              <div className=\"text-xs text-gray-600\">نهاية الورديه: {new Date().toLocaleString('ar-EG')}</div>\n            </div>\n            {/* تمت إزالة عرض إجمالي التحويل والسحب أثناء الورديه */}\n            {/* قسم النقدية والمحافظ المطلوبة */}\n            <div className=\"space-y-3\">\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div className=\"rounded border p-3\">\n                    <Label className=\"mb-1 block\">الفلوس النقدية المستلمة</Label>\n                    <Input\n                      type=\"number\"\n                      value={receivedDrawerFunds}\n                      readOnly\n                      disabled\n                      placeholder=\"قيمة مسجلة عند بداية الورديه\"\n                    />\n                    <div className=\"text-xs text-gray-600 mt-1\">قيمة غير قابلة للتعديل؛ تُسجّل عند الدخول.</div>\n                  </div>\n                  <div className=\"rounded border p-3\">\n                    <Label className=\"mb-1 block\">أرصدة المحافظ المستلمة (إجمالي)</Label>\n                    <Input\n                      type=\"number\"\n                      value={receivedWalletBalancesTotal}\n                      readOnly\n                      disabled\n                      placeholder=\"إجمالي مسجل عند بداية الورديه\"\n                    />\n                  </div>\n                </div>\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div className=\"rounded border p-3\">\n                  <Label className=\"mb-1 block\">الفلوس النقدية المسلمة</Label>\n                  <Input\n                    type=\"text\"\n                    inputMode=\"decimal\"\n                    value={deliveredDrawerFunds}\n                    onChange={(e) => {\n                      const v = parseFloat(normalizeDigits(e.target.value));\n                      setDeliveredDrawerFunds(Number.isFinite(v) ? v : 0);\n                    }}\n                    placeholder=\"أدخل قيمة النقدية المسلمة عند نهاية الورديه\"\n                  />\n                  <div className=\"text-xs text-gray-600 mt-1\">ادخال يدوي لقيمة النقدية المسلّمة عند نهاية الورديه</div>\n                </div>\n                <div className=\"rounded border p-3\">\n                  <Label className=\"mb-1 block\">أرصدة المحافظ المسلمة (إجمالي)</Label>\n                  <Input\n                    type=\"text\"\n                    inputMode=\"decimal\"\n                    value={deliveredWalletBalancesTotal}\n                    onChange={(e) => {\n                      const v = parseFloat(normalizeDigits(e.target.value));\n                      setDeliveredWalletBalancesTotal(Number.isFinite(v) ? v : 0);\n                    }}\n                    placeholder=\"أدخل إجمالي أرصدة المحافظ المسلّمة\"\n                  />\n                  <div className=\"text-xs text-gray-600 mt-1\">يمكنك إدخال الإجمالي يدوياً؛ التفصيل يُحفظ إن لزم</div>\n                </div>\n              </div>\n              {/* أرباح الوردية */}\n              <div className=\"rounded border p-3\">\n                <div className=\"text-sm font-semibold mb-1\">أرباح الوردية</div>\n                <div className={[\n                  'text-sm',\n                  ((((deliveredDrawerFunds ?? 0) + (deliveredWalletBalancesTotal ?? 0) - (((parseFloat(receivedDrawerFunds || '0') || 0)) + (receivedWalletBalancesTotal ?? 0))) >= 0)\n                    ? 'text-green-700'\n                    : 'text-red-700')\n                ].join(' ')}>\n                  {Math.round((((deliveredDrawerFunds ?? 0) + (deliveredWalletBalancesTotal ?? 0) - (((parseFloat(receivedDrawerFunds || '0') || 0)) + (receivedWalletBalancesTotal ?? 0))) ) * 100) / 100}\n                </div>\n                <div className=\"text-xs text-gray-600\">محسوبة: (المسلّم − المستلم) للنقدية + المحافظ</div>\n                <div className=\"mt-2 grid grid-cols-1 gap-2\">\n                  <div className=\"rounded border p-2 bg-gray-50\">\n                    <div className=\"text-xs text-gray-700\">مطلوب من الدرج (بدون أرباح)</div>\n                    <div className=\"text-sm font-semibold text-gray-900\">\n                      {Math.round(((deliveredDrawerFunds ?? 0) - ((parseFloat(receivedDrawerFunds || '0') || 0))) * 100) / 100}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <div className=\"text-sm font-medium\">هل يوجد عجز؟</div>\n              <div className=\"flex gap-2\">\n                <Button variant={deficitChoice === 'no' ? 'default' : 'secondary'} onClick={() => setDeficitChoice('no')}>لا</Button>\n                <Button variant={deficitChoice === 'yes' ? 'default' : 'secondary'} onClick={() => setDeficitChoice('yes')}>نعم</Button>\n              </div>\n              {deficitChoice === 'yes' && (\n                <div>\n                  <Label className=\"mb-1 block\">مبلغ العجز</Label>\n                  <Input type=\"number\" value={deficitAmount} onChange={(e) => setDeficitAmount(e.target.value)} placeholder=\"أدخل مبلغ العجز\" />\n                </div>\n              )}\n            </div>\n          </div>\n          <DialogFooter className=\"flex gap-2 justify-between\">\n            <Button\n              onClick={() => {\n                const deficit = deficitChoice === 'yes';\n                const amt = parseFloat(deficitAmount) || 0;\n                (async () => { await saveShiftReceiptToRecent(reportTotals, deficit, amt); })();\n                toast({ title: 'تم إضافة إيصال تسليم الورديه', description: 'أُضيف الإيصال إلى المعاملات الأخيرة بعنوان إيصال تسليم وردية' });\n                setReportDialogOpen(false);\n              }}\n            className=\"bg-emerald-600 hover:bg-emerald-700 text-white\"\n            >تأكيد وحفظ الإيصال</Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n};\n\nexport default CashierShiftModal;\n"],"names":["CashierShiftModal","open","onOpenChange","shiftUser","isShiftActive","shiftStartAt","setShiftUser","startShift","endShift","useShift","userSubscription","user","signIn","profile","checkSubscriptionStatus","useFirebaseAuth","toast","useToast","name","setName","useState","username","setUsername","password","setPassword","handoverDialogOpen","setHandoverDialogOpen","handoverMode","setHandoverMode","mainPassword","setMainPassword","mainAuthError","setMainAuthError","isVerifyingMain","setIsVerifyingMain","handoverSelectedUser","setHandoverSelectedUser","handoverPassword","setHandoverPassword","handoverError","setHandoverError","isHandoverProcessing","setIsHandoverProcessing","reportDialogOpen","setReportDialogOpen","reportTotals","setReportTotals","deficitChoice","setDeficitChoice","deficitAmount","setDeficitAmount","receivedDrawerFunds","setReceivedDrawerFunds","receivedWalletBalancesTotal","setReceivedWalletBalancesTotal","receivedWalletBalancesMap","setReceivedWalletBalancesMap","deliveredDrawerFunds","setDeliveredDrawerFunds","deliveredWalletBalancesTotal","setDeliveredWalletBalancesTotal","deliveredWalletBalancesMap","setDeliveredWalletBalancesMap","handoverTargetLabel","setHandoverTargetLabel","initialIntakeDialogOpen","setInitialIntakeDialogOpen","useEffect","normalizeDigits","map","ch","getCashierUsersKey","users","setUsers","saved","legacy","isDataLoaded","setIsDataLoaded","foundInCloud","ref","doc","db","snap","getDoc","data","cloudUsers","err","localUsers","planType","_a","extraCashiers","_b","extraCashiersEndsAt","_c","isExtraValid","maxCashiers","setDoc","e","authDialogOpen","setAuthDialogOpen","enteredPassword","setEnteredPassword","selectedUser","setSelectedUser","deliveryReports","setDeliveryReports","deliveryReportsDialogOpen","setDeliveryReportsDialogOpen","selectedDeliveryReport","setSelectedDeliveryReport","isDeliveryReportOpen","setIsDeliveryReportOpen","addUserDialogOpen","setAddUserDialogOpen","limitWarningOpen","setLimitWarningOpen","requestCashierDialogOpen","setRequestCashierDialogOpen","requestCount","setRequestCount","requestPlan","setRequestPlan","SubscriptionPlan","handleRequestCashier","addDoc","collection","serverTimestamp","error","permissionsDialogOpen","setPermissionsDialogOpen","userForPermissions","setUserForPermissions","permissionsAuthOpen","setPermissionsAuthOpen","permissionsAuthPassword","setPermissionsAuthPassword","permissionsAuthError","setPermissionsAuthError","handleOpenPermissionsAuth","u","verifyPermissionsAuth","MasterPinService","handleSavePermissions","newPermissions","prev","handleOpenAddUser","handleDeleteUser","usernameToDelete","isCurrentShiftUser","lastHandoverToAdmin","confirmMsg","handleAddUser","newUser","handleEndShift","computeShiftTotals","transactions","userDataService","res","getLastTransactions","startTime","now","isWithdrawTx","t","type","xn","isSendTx","parseDate","val","d","inShiftWindow","created","isCompletedStatus","s","completed","totalWithdrawals","sum","amount","w","v","reports","a","b","ad","saveShiftReceiptToRecent","totals","deficit","deficitAmt","initialDrawerFunds","initialWalletBalancesTotal","receipt","visibleUsers","jsxs","Fragment","jsx","Dialog","DialogContent","DialogHeader","DialogTitle","idx","Button","DialogFooter","Label","Input","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","perm","isPermitted","r","k","drawer","wallets","isDrawerValid","isWalletsValid","errorMsg","amt"],"mappings":"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"}