import{y as l,i as o,K as d,f as h,s as n,P as f,a4 as y}from"./index-TGIFU2Cb.js";const u={getCurrentDayId(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},async setLimits(e,t){var r;try{const i=l(o,"walletLimits",e),s={updatedAt:n(),ownerId:(r=h.currentUser)==null?void 0:r.uid};return t.dailyTransferLimit!==void 0&&(s.dailyTransferLimit=t.dailyTransferLimit),t.dailyWithdrawLimit!==void 0&&(s.dailyWithdrawLimit=t.dailyWithdrawLimit),t.monthlyTransferLimit!==void 0&&(s.monthlyTransferLimit=t.monthlyTransferLimit),t.monthlyWithdrawLimit!==void 0&&(s.monthlyWithdrawLimit=t.monthlyWithdrawLimit),await d(i,s,{merge:!0}),await this.getWalletLimits(e)}catch(i){return console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©:",i),null}},getCurrentMonthId(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`},shouldResetDailyLimits(e){if(!e)return!0;const t=new Date,r=e.toDate();return t.getDate()!==r.getDate()||t.getMonth()!==r.getMonth()||t.getFullYear()!==r.getFullYear()},shouldResetMonthlyLimits(e){const t=new Date,r=t.getDate()===1;if(!e)return r;const i=e.toDate();return r&&(t.getMonth()!==i.getMonth()||t.getFullYear()!==i.getFullYear())},async getWalletLimits(e){var t;try{const r=l(o,"walletLimits",e);try{const s=await f(r);if(s.exists()){const a=s.data();return{walletId:e,dailyTransferLimit:a.dailyTransferLimit||6e4,dailyWithdrawLimit:a.dailyWithdrawLimit||1e5,dailyTransferUsed:a.dailyTransferUsed||0,dailyWithdrawUsed:a.dailyWithdrawUsed||0,lastDailyReset:a.lastDailyReset||null,monthlyTransferLimit:a.monthlyTransferLimit||2e5,monthlyWithdrawLimit:a.monthlyWithdrawLimit||2e5,monthlyTransferUsed:a.monthlyTransferUsed||0,monthlyWithdrawUsed:a.monthlyWithdrawUsed||0,lastMonthlyReset:a.lastMonthlyReset||null,updatedAt:a.updatedAt||y.now()}}}catch{}const i={walletId:e,dailyTransferLimit:6e4,dailyWithdrawLimit:1e5,dailyTransferUsed:0,dailyWithdrawUsed:0,lastDailyReset:null,monthlyTransferLimit:2e5,monthlyWithdrawLimit:2e5,monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:null,updatedAt:y.now()};return await d(r,{dailyTransferLimit:6e4,dailyWithdrawLimit:1e5,dailyTransferUsed:0,dailyWithdrawUsed:0,lastDailyReset:null,monthlyTransferLimit:2e5,monthlyWithdrawLimit:2e5,monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:null,updatedAt:n(),ownerId:(t=h.currentUser)==null?void 0:t.uid}),i}catch(r){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©:",r),null}},async resetDailyLimits(e){var t;try{const r=l(o,"walletLimits",e);return await d(r,{dailyTransferUsed:0,dailyWithdrawUsed:0,lastDailyReset:n(),updatedAt:n(),ownerId:(t=h.currentUser)==null?void 0:t.uid},{merge:!0}),console.log(`ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„Ù„Ù…Ø­ÙØ¸Ø© ${e}`),!0}catch(r){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:",r),!1}},async resetMonthlyLimits(e){var t;try{const r=l(o,"walletLimits",e);return await d(r,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:n(),updatedAt:n(),ownerId:(t=h.currentUser)==null?void 0:t.uid},{merge:!0}),console.log(`ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ù„Ù„Ù…Ø­ÙØ¸Ø© ${e}`),!0}catch(r){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©:",r),!1}},async autoResetLimitsIfNeeded(e){try{const t=await this.getWalletLimits(e);if(!t)return null;let r=!1;return this.shouldResetDailyLimits(t.lastDailyReset)&&(await this.resetDailyLimits(e),r=!0),this.shouldResetMonthlyLimits(t.lastMonthlyReset)&&(await this.resetMonthlyLimits(e),r=!0),r?await this.getWalletLimits(e):t}catch(t){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯:",t),null}},async canPerformOperation(e,t,r){try{const i=await this.autoResetLimitsIfNeeded(e);if(!i)return{canPerform:!1,message:"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©"};if(r==="transfer"){const s=i.dailyTransferLimit-i.dailyTransferUsed;if(t>s)return{canPerform:!1,message:`ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„ØªØ­ÙˆÙŠÙ„. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${s.toLocaleString()} Ø¬.Ù… Ù…Ù† Ø£ØµÙ„ ${i.dailyTransferLimit.toLocaleString()} Ø¬.Ù…`,dailyRemaining:s,limitType:"daily"};const a=i.monthlyTransferLimit-i.monthlyTransferUsed;return t>a?{canPerform:!1,message:`ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„ØªØ­ÙˆÙŠÙ„. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${a.toLocaleString()} Ø¬.Ù… Ù…Ù† Ø£ØµÙ„ ${i.monthlyTransferLimit.toLocaleString()} Ø¬.Ù…`,monthlyRemaining:a,limitType:"monthly"}:{canPerform:!0,dailyRemaining:s-t,monthlyRemaining:a-t}}if(r==="withdraw"){const s=i.dailyWithdrawLimit-i.dailyWithdrawUsed;if(t>s)return{canPerform:!1,message:`ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„Ø³Ø­Ø¨. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${s.toLocaleString()} Ø¬.Ù… Ù…Ù† Ø£ØµÙ„ ${i.dailyWithdrawLimit.toLocaleString()} Ø¬.Ù…`,dailyRemaining:s,limitType:"daily"};const a=i.monthlyWithdrawLimit-i.monthlyWithdrawUsed;return t>a?{canPerform:!1,message:`ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„Ø³Ø­Ø¨. Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${a.toLocaleString()} Ø¬.Ù… Ù…Ù† Ø£ØµÙ„ ${i.monthlyWithdrawLimit.toLocaleString()} Ø¬.Ù…`,monthlyRemaining:a,limitType:"monthly"}:{canPerform:!0,dailyRemaining:s-t,monthlyRemaining:a-t}}return{canPerform:!1,message:"Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­"}}catch(i){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:",i),{canPerform:!1,message:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯"}}},async updateUsage(e,t,r){try{const i=await this.canPerformOperation(e,t,r);if(!i.canPerform)throw new Error(i.message||"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©");const s=l(o,"walletLimits",e),a=await this.getWalletLimits(e);if(!a)throw new Error("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©");const m={updatedAt:n()};return r==="transfer"?(m.dailyTransferUsed=a.dailyTransferUsed+t,m.monthlyTransferUsed=a.monthlyTransferUsed+t):r==="withdraw"&&(m.dailyWithdrawUsed=a.dailyWithdrawUsed+t,m.monthlyWithdrawUsed=a.monthlyWithdrawUsed+t),await d(s,{...m},{merge:!0}),await this.getWalletLimits(e)}catch(i){throw console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©:",i),i}},async rollbackUsage(e,t,r){try{const i=l(o,"walletLimits",e),s=await this.getWalletLimits(e);if(!s)throw new Error("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©");const a={updatedAt:n()};return r==="transfer"?(a.dailyTransferUsed=Math.max(0,(s.dailyTransferUsed||0)-t),a.monthlyTransferUsed=Math.max(0,(s.monthlyTransferUsed||0)-t)):(a.dailyWithdrawUsed=Math.max(0,(s.dailyWithdrawUsed||0)-t),a.monthlyWithdrawUsed=Math.max(0,(s.monthlyWithdrawUsed||0)-t)),await d(i,{...a},{merge:!0}),await this.getWalletLimits(e)}catch(i){throw console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©:",i),i}},calculateRemaining(e){return{dailyTransferRemaining:Math.max(0,e.dailyTransferLimit-e.dailyTransferUsed),dailyWithdrawRemaining:Math.max(0,e.dailyWithdrawLimit-e.dailyWithdrawUsed),monthlyTransferRemaining:Math.max(0,e.monthlyTransferLimit-e.monthlyTransferUsed),monthlyWithdrawRemaining:Math.max(0,e.monthlyWithdrawLimit-e.monthlyWithdrawUsed)}},async resetAllLimits(e){var t;try{const r=l(o,"walletLimits",e);return await d(r,{dailyTransferUsed:0,dailyWithdrawUsed:0,monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastDailyReset:n(),lastMonthlyReset:n(),updatedAt:n(),ownerId:(t=h.currentUser)==null?void 0:t.uid},{merge:!0}),console.log(`âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© ${e}`),await this.getWalletLimits(e)}catch(r){return console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¯ÙˆØ¯:",r),null}}};export{u as default,u as walletDailyLimitsService};
