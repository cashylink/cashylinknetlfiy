const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-bCWIXU_s.js","./index-D5_0Es3j.css"])))=>i.map(i=>d[i]);
import{aW as We,j as e,aX as Ft,r as c,aY as Et,ae as Ve,aZ as Mt,a9 as Jt,a_ as zt,ad as Ht,a$ as qt,b0 as Gt,b1 as Lt,b2 as Ye,b3 as Wt,b4 as Vt,$ as I,b5 as Ke,i as Yt,ay as Kt,a4 as Xt,aA as Zt,n as A,o as N,q as Q,a5 as Be,a6 as Fe,a7 as Ee,a8 as Me,aS as Qt,C as U,b as ee,c as te,B as y,K as oe,t as H,au as se,e as ae,I as $,y as ve,z as P,ai as Je,az as ze,_ as Ut,W as ye}from"./index-bCWIXU_s.js";import{B as q}from"./badge-D2_MGYyu.js";import{S as He}from"./separator-DNaXqfAL.js";import{F as es}from"./UserDashboardPage-Dfq0JLZl.js";import{S as ts,a as ss,b as as,c as rs,d as is,C as ns}from"./select-C3fHD4AR.js";import{T as qe}from"./trash-2-BWgB-yFB.js";import{C as Ge}from"./calendar-xPArWQ6D.js";import"./ProfileSettingsPage-CoIa9boy.js";import"./switch-BQgZRSUu.js";import"./MasterPinDialog-A5-_nbFS.js";import"./circle-alert-BxhCUO6U.js";import"./square-pen-C3YmbHnp.js";import"./textarea-D3m_oYND.js";import"./dollar-sign-Bao60D_X.js";import"./users-Cpto-nm8.js";import"./circle-x-Cbud-81g.js";import"./circle-check-big-DiwZPFwf.js";import"./crown-A4Ihvi0Y.js";import"./refresh-cw-B5gRT73I.js";import"./arrow-left-s_QvAc0w.js";import"./ProfileIcon--gxl92Z4.js";import"./dropdown-menu-h4nY-sSB.js";import"./index-BPkmrWHC.js";import"./freeTrialService-CWJcN19o.js";import"./broadcastService-Brab-pCG.js";import"./bell-CJI7aseZ.js";import"./profitService-RoVQsoFR.js";import"./arrow-down-left-vpQKucY4.js";import"./formatters-Czs80nJy.js";import"./wallet-BSujvrVP.js";import"./search-BPzTPEA8.js";import"./printer-BDVabvNO.js";import"./phone-CgMYIHl6.js";var Xe="AlertDialog",[ls]=Jt(Xe,[We]),C=We(),Ze=n=>{const{__scopeAlertDialog:d,...i}=n,h=C(d);return e.jsx(Ft,{...h,...i,modal:!0})};Ze.displayName=Xe;var cs="AlertDialogTrigger",os=c.forwardRef((n,d)=>{const{__scopeAlertDialog:i,...h}=n,m=C(i);return e.jsx(Vt,{...m,...h,ref:d})});os.displayName=cs;var ds="AlertDialogPortal",Qe=n=>{const{__scopeAlertDialog:d,...i}=n,h=C(d);return e.jsx(Et,{...h,...i})};Qe.displayName=ds;var ms="AlertDialogOverlay",Ue=c.forwardRef((n,d)=>{const{__scopeAlertDialog:i,...h}=n,m=C(i);return e.jsx(Wt,{...m,...h,ref:d})});Ue.displayName=ms;var G="AlertDialogContent",[ps,hs]=ls(G),gs=qt("AlertDialogContent"),et=c.forwardRef((n,d)=>{const{__scopeAlertDialog:i,children:h,...m}=n,L=C(i),f=c.useRef(null),re=Ve(d,f),T=c.useRef(null);return e.jsx(Mt,{contentName:G,titleName:tt,docsSlug:"alert-dialog",children:e.jsx(ps,{scope:i,cancelRef:T,children:e.jsxs(zt,{role:"alertdialog",...L,...m,ref:re,onOpenAutoFocus:Ht(m.onOpenAutoFocus,O=>{var B;O.preventDefault(),(B=T.current)==null||B.focus({preventScroll:!0})}),onPointerDownOutside:O=>O.preventDefault(),onInteractOutside:O=>O.preventDefault(),children:[e.jsx(gs,{children:h}),e.jsx(xs,{contentRef:f})]})})})});et.displayName=G;var tt="AlertDialogTitle",st=c.forwardRef((n,d)=>{const{__scopeAlertDialog:i,...h}=n,m=C(i);return e.jsx(Gt,{...m,...h,ref:d})});st.displayName=tt;var at="AlertDialogDescription",rt=c.forwardRef((n,d)=>{const{__scopeAlertDialog:i,...h}=n,m=C(i);return e.jsx(Lt,{...m,...h,ref:d})});rt.displayName=at;var us="AlertDialogAction",it=c.forwardRef((n,d)=>{const{__scopeAlertDialog:i,...h}=n,m=C(i);return e.jsx(Ye,{...m,...h,ref:d})});it.displayName=us;var nt="AlertDialogCancel",lt=c.forwardRef((n,d)=>{const{__scopeAlertDialog:i,...h}=n,{cancelRef:m}=hs(nt,i),L=C(i),f=Ve(d,m);return e.jsx(Ye,{...L,...h,ref:f})});lt.displayName=nt;var xs=({contentRef:n})=>{const d=`\`${G}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${G}\` by passing a \`${at}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${G}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return c.useEffect(()=>{var h;document.getElementById((h=n.current)==null?void 0:h.getAttribute("aria-describedby"))||console.warn(d)},[d,n]),null},fs=Ze,vs=Qe,ct=Ue,ot=et,dt=it,mt=lt,pt=st,ht=rt;const ys=fs,Ns=vs,gt=c.forwardRef(({className:n,...d},i)=>e.jsx(ct,{className:I("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...d,ref:i}));gt.displayName=ct.displayName;const ut=c.forwardRef(({className:n,...d},i)=>e.jsxs(Ns,{children:[e.jsx(gt,{}),e.jsx(ot,{ref:i,className:I("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg rounded-2xl duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",n),...d})]}));ut.displayName=ot.displayName;const xt=({className:n,...d})=>e.jsx("div",{className:I("flex flex-col space-y-2 text-center sm:text-left",n),...d});xt.displayName="AlertDialogHeader";const ft=c.forwardRef(({className:n,...d},i)=>e.jsx(pt,{ref:i,className:I("text-lg font-semibold",n),...d}));ft.displayName=pt.displayName;const vt=c.forwardRef(({className:n,...d},i)=>e.jsx(ht,{ref:i,className:I("text-sm text-muted-foreground",n),...d}));vt.displayName=ht.displayName;const Ne=c.forwardRef(({className:n,...d},i)=>e.jsx(dt,{ref:i,className:I(Ke(),n),...d}));Ne.displayName=dt.displayName;const yt=c.forwardRef(({className:n,...d},i)=>e.jsx(mt,{ref:i,className:I(Ke({variant:"outline"}),"mt-2 sm:mt-0",n),...d}));yt.displayName=mt.displayName;const x=n=>{try{return n.toLocaleString("en-US",{maximumFractionDigits:2})}catch{return String(n)}},Le=n=>{try{return(n?new Date(n):new Date).toLocaleString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return new Date().toISOString()}},w="machine_daily_opening_values",_="machine_daily_opening_snapshot";function ra({open:n,onOpenChange:d}){const{toast:i}=Yt(),{shiftUser:h}=Kt(),{shopId:m,shopName:L}=Xt(),f=()=>{try{const t=Object.keys(localStorage||{}).filter(a=>a.startsWith("selectedShopId_"));for(const a of t){const l=localStorage.getItem(a);if(l)return l}return null}catch{return null}};c.useEffect(()=>{try{if(n){const t=document.body.style.overflow;document.body.setAttribute("data-prev-overflow",t),document.body.style.overflow="hidden"}else{const t=document.body.getAttribute("data-prev-overflow")||"";document.body.style.overflow=t,document.body.removeAttribute("data-prev-overflow")}}catch{}return()=>{try{const t=document.body.getAttribute("data-prev-overflow")||"";document.body.style.overflow=t,document.body.removeAttribute("data-prev-overflow")}catch{}}},[n]);const[re,T]=c.useState(""),[O,B]=c.useState(""),[je,be]=c.useState(""),[k,W]=c.useState(null),[R,V]=c.useState(null),[Ae,Y]=c.useState(null),[F,K]=c.useState(null),[De,Nt]=c.useState(!1),[jt,de]=c.useState(!1),[me,Se]=c.useState(""),[pe,we]=c.useState(""),[he,_e]=c.useState(null),[Ce,X]=c.useState([]),[E,ie]=c.useState([]),[bt,ne]=c.useState(!1),[ge,Oe]=c.useState(""),[ue,$e]=c.useState(""),[At,le]=c.useState(!1),[D,Pe]=c.useState(null),[xe,fe]=c.useState([]),[r,Z]=c.useState(null),[ke,Re]=c.useState(""),[js,bs]=c.useState(!1),[As,Ds]=c.useState(!1);c.useEffect(()=>{if(n)try{const t=r?`${w}_${r}`:w,a=r?`${_}_${r}`:_,l=localStorage.getItem(t);if(l){const o=JSON.parse(l);typeof(o==null?void 0:o.openingBase)=="number"&&W(o.openingBase),typeof(o==null?void 0:o.openingAir)=="number"&&V(o.openingAir),typeof(o==null?void 0:o.drawerCash)=="number"&&Y(o.drawerCash)}else W(null),V(null),Y(null);const p=localStorage.getItem(a);if(p){const o=JSON.parse(p);typeof(o==null?void 0:o.openingBase)=="number"&&typeof(o==null?void 0:o.openingAir)=="number"?K({openingBase:o.openingBase,openingAir:o.openingAir,drawerCash:o.drawerCash||0}):K(null)}else K(null)}catch{}},[n,r]),c.useEffect(()=>{(async()=>{try{const t=m||f();if(!n||!t)return;const{getDocs:a}=await Zt(async()=>{const{getDocs:g}=await import("./index-bCWIXU_s.js").then(s=>s.ck);return{getDocs:g}},__vite__mapDeps([0,1]),import.meta.url),l=A(N,"shops",t,"machines"),o=(await a(Q(l))).docs.map(g=>({id:g.id,name:String(g.data().name||"ماكينة")}));fe(o);try{const g=localStorage.getItem(`machineDaily_selected_${t}`);g&&o.some(v=>v.id===g)?Z(g):!r&&o.length>0&&(Z(o[0].id),localStorage.setItem(`machineDaily_selected_${t}`,o[0].id))}catch{}}catch(t){console.error("Load machines error:",t)}})()},[n,m]);const M=c.useMemo(()=>(h==null?void 0:h.displayName)||(h==null?void 0:h.name)||(h==null?void 0:h.username)||void 0,[h]),Dt=c.useMemo(()=>E.reduce((t,a)=>t+(a.profit||0),0),[E]),St=c.useMemo(()=>E.reduce((t,a)=>t+(a.wholesalePrice||0),0),[E]),wt=async()=>{try{const t=m||f();if(t&&r){const a=A(N,"shops",t,"machines",r,"transfers"),l=await H(Q(a));await Promise.all(l.docs.map(p=>se(p.ref)));try{localStorage.setItem(`machineDaily_transfers_${t}_${r}`,JSON.stringify([]))}catch{}}}catch{}ie([]),i({title:"تم حذف الإيصالات",description:"تم مسح كل إيصالات التحويل."})},_t=async()=>{try{const t=m||f();if(t&&r){const a=A(N,"shops",t,"machines",r,"deliveries"),l=await H(Q(a));await Promise.all(l.docs.map(p=>se(p.ref)));try{localStorage.setItem(`machineDaily_deliveries_${t}_${r}`,JSON.stringify([]))}catch{}}}catch{}X([]),i({title:"تم حذف الإيصالات",description:"تم مسح كل إيصالات الماكينة."})},Ct=t=>{X(a=>a.filter(l=>l.id!==t)),i({title:"تم حذف الإيصال",description:"تم إزالة إيصال الماكينة المحدد."})},Ot=()=>{W(null),V(null),Y(null),K(null),T(""),B(""),be("");try{const t=r?`${w}_${r}`:w,a=r?`${_}_${r}`:_;localStorage.removeItem(t),localStorage.removeItem(a)}catch{}i({title:"تم التصفير",description:"يمكنك الآن إدخال رصيد افتتاحي جديد."})},$t=async()=>{var p;const t=parseFloat(re||"0"),a=parseFloat(O||"0"),l=parseFloat(je||"0");if(isNaN(t)||isNaN(a)||isNaN(l)){i({title:"قيمة غير صالحة",description:"يرجى إدخال أرقام صحيحة للرصيد الافتتاحي وفلوس الدرج.",variant:"destructive"});return}if(t<0||a<0||l<0){i({title:"قيمة سالبة",description:"لا يمكن إدخال قيم سالبة.",variant:"destructive"});return}W(t),V(a),Y(l);try{const o=r?`${w}_${r}`:w,g=r?`${_}_${r}`:_;localStorage.setItem(o,JSON.stringify({openingBase:t,openingAir:a,drawerCash:l})),localStorage.setItem(g,JSON.stringify({openingBase:t,openingAir:a,drawerCash:l})),K({openingBase:t,openingAir:a,drawerCash:l});const s=m||f();if(s&&r){const v=oe(N,"shops",s,"machines",r);await ye(v,{name:((p=xe.find(u=>u.id===r))==null?void 0:p.name)||"ماكينة",openingBase:t,openingAir:a,drawerCash:l,cashierName:M,shopName:L||null,updatedAt:P()},{merge:!0})}}catch{}i({title:"تم تسجيل البيانات",description:`الافتتاحي الأساسي: ${x(t)}، الهواء: ${x(a)}، فلوس الدرج: ${x(l)}`})},Pt=()=>{if(k==null||R==null){i({title:"سجل الرصيد الافتتاحي أولاً",description:'يرجى الضغط على زر "إضافة" بعد إدخال الافتتاحي.'});return}de(!0)},kt=()=>{const t=parseFloat(me||"0"),a=parseFloat(pe||"0");if(isNaN(t)||isNaN(a)){i({title:"قيمة غير صالحة",description:"يرجى إدخال أرقام صحيحة لرصيد التسليم.",variant:"destructive"});return}if(t<0||a<0){i({title:"قيمة سالبة",description:"لا يمكن إدخال قيم سالبة.",variant:"destructive"});return}const l=(F==null?void 0:F.openingBase)??(k||0),p=(F==null?void 0:F.openingAir)??(R||0),o=l+p,s=t+a-o;_e(s);const v={id:`${Date.now()}`,openingBase:l,openingAir:p,deliveryBase:t,deliveryAir:a,netResult:s,createdAt:new Date().toISOString(),cashierName:M,requiredDrawerNoProfit:s<0?Math.round(-s*100)/100:0};(async()=>{try{const u=m||f();u&&r&&(await ve(A(N,"shops",u,"machines",r,"deliveries"),{cashierName:M,openingBase:l,openingAir:p,deliveryBase:t,deliveryAir:a,netResult:s,createdAt:P()}),await ye(oe(N,"shops",u,"machines",r),{lastDeliveryAt:P(),updatedAt:P()},{merge:!0}))}catch(u){console.error("Persist delivery error:",u)}})(),X(u=>[v,...u]);try{const u=m||f(),j=u&&r?`machineDaily_deliveries_${u}_${r}`:`machineDaily_deliveries_${r}`,b=localStorage.getItem(j),S=b?JSON.parse(b):[],J=[v,...Array.isArray(S)?S:[]];localStorage.setItem(j,JSON.stringify(J))}catch{}i({title:"تم إنشاء إيصال تسليم",description:`الناتج النهائي: ${x(s)}`})},Rt=()=>{const t=parseFloat(ge||"0"),a=parseFloat(ue||"0");if(!Number.isFinite(t)||!Number.isFinite(a)){i({title:"قيمة غير صالحة",description:"يرجى إدخال أرقام صحيحة لسعر الجملة وسعر التجزئة.",variant:"destructive"});return}if(t<0||a<0){i({title:"قيمة سالبة",description:"لا يمكن إدخال قيم سالبة.",variant:"destructive"});return}if(k==null||R==null){i({title:"سجل الرصيد الافتتاحي أولاً",description:'يرجى إدخال الرصيد الأساسي ورصيد الهواء ثم الضغط "إضافة".'});return}const l=Math.round((a-t)*100)/100;Pe({wholesalePrice:t,retailPrice:a,profit:l}),le(!0)},Ie=async t=>{if(!D)return;const a={id:`transfer_${Date.now()}`,wholesalePrice:D.wholesalePrice,retailPrice:D.retailPrice,profit:D.profit,createdAt:new Date().toISOString(),cashierName:M,deductFrom:t},l=D.wholesalePrice,p=k??0,o=R??0,g=Ae??0;if(l>(t==="base"?p:o)){i({title:"رصيد غير كافٍ",description:"لا يوجد رصيد كافٍ للخصم بسعر الجملة.",variant:"destructive"});return}const v=t==="base"?Math.round((p-l)*100)/100:p,u=t==="air"?Math.round((o-l)*100)/100:o,j=D.retailPrice,b=Math.round((g+j)*100)/100;W(v),V(u),Y(b);try{const S=r?`${w}_${r}`:w,J=r?`${_}_${r}`:_;localStorage.setItem(S,JSON.stringify({openingBase:v,openingAir:u,drawerCash:b})),localStorage.setItem(J,JSON.stringify({openingBase:v,openingAir:u,drawerCash:b}));const z=m||f();if(z&&r){const ce=oe(N,"shops",z,"machines",r);await ye(ce,{openingBase:v,openingAir:u,drawerCash:b,cashierName:M,updatedAt:P()},{merge:!0}),await ve(A(N,"shops",z,"machines",r,"transfers"),{wholesalePrice:D.wholesalePrice,retailPrice:D.retailPrice,profit:D.profit,deductFrom:t,cashierName:M,createdAt:P()})}}catch{}ie(S=>[a,...S]);try{const S=m||f(),J=S&&r?`machineDaily_transfers_${S}_${r}`:"machineDaily_transfers",z=localStorage.getItem(J),ce=z?JSON.parse(z):[],Bt=[a,...Array.isArray(ce)?ce:[]];localStorage.setItem(J,JSON.stringify(Bt))}catch{}ne(!1),Oe(""),$e(""),Pe(null),le(!1),i({title:"تم تسجيل تحويل",description:`الربح الفوري: ${x(a.profit)} | خصم المخزون: -${x(l)} (${t==="base"?"الأساسي":"الهواء"}) | درج (المباع فقط): +${x(j)}`})},It=()=>{T(""),B(""),de(!1),Se(""),we(""),_e(null)},Tt=async()=>{if(!n||!r)return;const t=m||f();if(t){try{const a=A(N,"shops",t,"machines",r,"deliveries"),o=[...(await H(Q(a))).docs.map(g=>{var u,j;const s=g.data(),v=(j=(u=s==null?void 0:s.createdAt)==null?void 0:u.toDate)!=null&&j.call(u)?s.createdAt.toDate():new Date;return{id:g.id,openingBase:Number((s==null?void 0:s.openingBase)||0),openingAir:Number((s==null?void 0:s.openingAir)||0),deliveryBase:Number((s==null?void 0:s.deliveryBase)||0),deliveryAir:Number((s==null?void 0:s.deliveryAir)||0),netResult:typeof(s==null?void 0:s.netResult)=="number"?Number(s.netResult):Math.round((Number((s==null?void 0:s.deliveryBase)||0)+Number((s==null?void 0:s.deliveryAir)||0)-(Number((s==null?void 0:s.openingBase)||0)+Number((s==null?void 0:s.openingAir)||0)))*100)/100,createdAt:v.toISOString(),cashierName:(s==null?void 0:s.cashierName)||void 0,requiredDrawerNoProfit:typeof(s==null?void 0:s.requiredDrawerNoProfit)=="number"?s.requiredDrawerNoProfit:void 0}})].sort((g,s)=>new Date(s.createdAt).getTime()-new Date(g.createdAt).getTime());X(o);try{localStorage.setItem(`machineDaily_deliveries_${t}_${r}`,JSON.stringify(o))}catch{}}catch(a){console.error("Error fetching deliveries:",a)}try{const a=A(N,"shops",t,"machines",r,"transfers"),o=[...(await H(Q(a))).docs.map(g=>{var j,b;const s=g.data(),v=(b=(j=s==null?void 0:s.createdAt)==null?void 0:j.toDate)!=null&&b.call(j)?s.createdAt.toDate():new Date,u=s==null?void 0:s.deductFrom;return{id:g.id,wholesalePrice:Number((s==null?void 0:s.wholesalePrice)||0),retailPrice:Number((s==null?void 0:s.retailPrice)||0),profit:Number((s==null?void 0:s.profit)??(Number((s==null?void 0:s.retailPrice)||0)-Number((s==null?void 0:s.wholesalePrice)||0)||0)),createdAt:v.toISOString(),cashierName:(s==null?void 0:s.cashierName)||void 0,deductFrom:u==="base"||u==="air"?u:void 0}})].sort((g,s)=>new Date(s.createdAt).getTime()-new Date(g.createdAt).getTime());ie(o);try{localStorage.setItem(`machineDaily_transfers_${t}_${r}`,JSON.stringify(o))}catch{}}catch(a){console.error("Error fetching transfers:",a)}i({title:"تم التحديث",description:"تم جلب أحدث البيانات."})}};c.useEffect(()=>{if(!n||!r)return;const t=m||f();try{const a=t?`machineDaily_deliveries_${t}_${r}`:`machineDaily_deliveries_${r}`,l=localStorage.getItem(a);if(l){const g=JSON.parse(l);Array.isArray(g)&&X(g)}const p=t?`machineDaily_transfers_${t}_${r}`:`machineDaily_transfers_${r}`,o=localStorage.getItem(p);if(o){const g=JSON.parse(o);Array.isArray(g)&&ie(g)}}catch{}Tt()},[n,m,r]);const Te=t=>{t||It(),d(t)};return e.jsxs(Be,{open:n,onOpenChange:Te,children:[e.jsxs(Fe,{className:"w-screen h-[100vh] overflow-hidden rounded-none p-0 flex flex-col dark:bg-[#121212]",children:[e.jsxs(Ee,{className:"sticky top-0 bg-white dark:bg-[#0F0F0F] z-20 border-b border-gray-200 dark:border-[#333] px-4 py-3",children:[e.jsx(Me,{className:"flex items-center justify-between text-right",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"h-5 w-5 text-yellow-500"}),"يومية المكنة"]})}),e.jsx(Qt,{className:"text-right",children:'أدخل الرصيد الافتتاحي، ثم في نهاية اليوم قم بإدخال رصيد التسليم لإنشاء إيصال منظم باسم "إيصالات ماكينة".'})]}),e.jsxs("div",{className:"px-4 py-3 overflow-y-auto flex-1 grid grid-cols-1 gap-6",children:[e.jsxs(U,{children:[e.jsx(ee,{className:"pb-2",children:e.jsxs(te,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-right",children:"اختيار ماكينة"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(y,{variant:"destructive",onClick:async()=>{try{if(!m||!r)return;const t=oe(N,"shops",m,"machines",r);try{const l=await H(A(N,"shops",m,"machines",r,"transfers"));await Promise.all(l.docs.map(p=>se(p.ref)))}catch{}try{const l=await H(A(N,"shops",m,"machines",r,"deliveries"));await Promise.all(l.docs.map(p=>se(p.ref)))}catch{}await se(t),fe(l=>l.filter(p=>p.id!==r));const a=xe.find(l=>l.id!==r);Z(a?a.id:null);try{const l=`${w}_${r}`,p=`${_}_${r}`;localStorage.removeItem(l),localStorage.removeItem(p)}catch{}i({title:"تم حذف الماكينة",description:"تمت الإزالة نهائيًا."})}catch{i({title:"فشل الحذف",description:"تعذر حذف الماكينة.",variant:"destructive"})}},disabled:!r,title:"حذف الماكينة",children:e.jsx(qe,{className:"h-4 w-4"})})})]})}),e.jsx(ae,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"الماكينة الحالية"}),e.jsxs(ts,{value:r??"",onValueChange:t=>{Z(t);try{const a=m||f();a&&localStorage.setItem(`machineDaily_selected_${a}`,t)}catch{}},children:[e.jsx(ss,{className:"text-right",children:e.jsx(as,{placeholder:"اختر ماكينة"})}),e.jsx(rs,{children:xe.map(t=>e.jsx(is,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"إنشاء ماكينة جديدة"}),e.jsx($,{value:ke,onChange:t=>Re(t.target.value),placeholder:"اسم الماكينة",className:"text-right"})]}),e.jsx("div",{className:"flex justify-end md:justify-start",children:e.jsx(y,{onClick:async()=>{try{if(!m){i({title:"لا يوجد محل",description:"يرجى التأكد من تحميل بيانات المحل.",variant:"destructive"});return}const t=(ke||"").trim();if(!t){i({title:"اسم الماكينة مطلوب",description:"أدخل اسم للماكينة الجديدة.",variant:"destructive"});return}const a=await ve(A(N,"shops",m,"machines"),{name:t,shopId:m,createdAt:P(),updatedAt:P(),isActive:!0}),l={id:a.id,name:t};fe(p=>[l,...p]),Z(a.id),Re(""),i({title:"تم إنشاء ماكينة",description:`تمت إضافة ${t}`})}catch(t){console.error("Create machine error:",t),i({title:"خطأ في الإنشاء",description:"تعذر إنشاء الماكينة.",variant:"destructive"})}},className:"bg-violet-600 hover:bg-violet-700",children:"إضافة"})})]})]})})]}),e.jsxs(U,{children:[e.jsx(ee,{className:"pb-2",children:e.jsxs(te,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-right",children:"الرصيد الافتتاحي"}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>Nt(t=>!t),className:"flex items-center gap-1",children:e.jsx(ns,{className:`h-4 w-4 transition-transform ${De?"rotate-180":""}`})})]})}),e.jsxs("div",{className:"flex items-center justify-between px-6",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(y,{variant:"outline",onClick:()=>ne(!0),disabled:k==null||R==null,className:"border-violet-300 text-violet-700",children:"تحويل"})}),k!=null&&R!=null&&e.jsxs(q,{className:"bg-violet-100 text-violet-700 border border-violet-200",children:["تم التسجيل: أساسي ",x(k)," | هواء ",x(R)," | درج ",x(Ae??0)]})]}),e.jsxs(ae,{className:`space-y-4 ${De?"":"hidden"}`,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"الرصيد الأساسي"}),e.jsx($,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:re,onChange:t=>T(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"رصيد الهواء"}),e.jsx($,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:O,onChange:t=>B(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"فلوس الدرج"}),e.jsx($,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:je,onChange:t=>be(t.target.value),placeholder:"0.00",className:"text-right"})]})]}),e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx(y,{variant:"outline",className:"mr-2",onClick:Ot,children:"تصفير"}),e.jsx(y,{onClick:$t,className:"bg-violet-600 hover:bg-violet-700",children:"إضافة"})]})]})]}),e.jsxs(U,{children:[e.jsx(ee,{className:"pb-2",children:e.jsxs(te,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-right",children:"إيصالات تحويل"}),e.jsxs(q,{className:"bg-green-100 text-green-700 border border-green-200",children:["ربح: ",x(Dt)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{variant:"outline",size:"sm",onClick:wt,className:"border-red-300 text-red-700 hover:bg-red-50",children:"حذف الإيصالات"}),e.jsx(Je,{className:"h-4 w-4 text-gray-500"})]})]})}),e.jsx(ae,{className:"space-y-3",children:E.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-right",children:"لا توجد تحويلات مسجلة."}):e.jsx("div",{className:"space-y-3 max-h-52 overflow-y-auto pr-1",children:E.map(t=>e.jsxs("div",{className:"rounded-lg border p-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"سعر الجملة"}),e.jsx("p",{className:"text-sm",children:x(t.wholesalePrice)})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"سعر التجزئة"}),e.jsx("p",{className:"text-sm",children:x(t.retailPrice)})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"الربح الفوري"}),e.jsx("p",{className:"text-sm text-green-700",children:x(t.profit)}),t.deductFrom&&e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:"text-[11px] bg-violet-100 text-violet-700 border border-violet-200 rounded px-2 py-0.5",children:["الخصم من: ",t.deductFrom==="base"?"الأساسي":"الهواء"]})}),e.jsxs("div",{className:"flex items-center justify-end gap-2 text-xs text-gray-500",children:[e.jsx(Ge,{className:"h-3 w-3"}),e.jsx("span",{children:Le(t.createdAt)}),t.cashierName&&e.jsxs(e.Fragment,{children:[e.jsx(He,{orientation:"vertical",className:"h-3"}),e.jsxs("span",{children:["الكاشير: ",t.cashierName]})]})]})]})]},t.id))})})]}),e.jsxs(U,{children:[e.jsx(ee,{className:"pb-2",children:e.jsx(te,{className:"text-right",children:"نهاية اليوم"})}),e.jsx(ae,{className:"space-y-4",children:jt?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"الرصيد الأساسي الحالي"}),e.jsx($,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:me,onChange:t=>Se(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"رصيد الهواء الحالي"}),e.jsx($,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:pe,onChange:t=>we(t.target.value),placeholder:"0.00",className:"text-right"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(y,{variant:"secondary",onClick:()=>de(!1),children:"إلغاء"}),e.jsx(y,{onClick:kt,className:"bg-green-600 hover:bg-green-700",children:"تسليم"})]}),he!=null&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-right",children:e.jsxs(q,{className:he>=0?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200",children:["الناتج النهائي: ",x(he)]})}),e.jsxs("div",{className:"mt-2 flex items-center justify-end gap-2",children:[e.jsxs(q,{className:"bg-blue-100 text-blue-700 border border-blue-200",children:["المجموع النهائي: ",x(parseFloat(me||"0")+parseFloat(pe||"0"))]}),e.jsxs(q,{className:"bg-amber-100 text-amber-700 border border-amber-200",children:["مطلوب من الدرج (بدون أرباح): ",x(St)]})]})]})]}):e.jsx("div",{className:"flex justify-end",children:e.jsx(y,{variant:"outline",onClick:Pt,className:"border-violet-300 text-violet-700",children:"تسليم يومية"})})})]}),e.jsxs(U,{children:[e.jsx(ee,{className:"pb-2",children:e.jsxs(te,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-right",children:"إيصالات ماكينة"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{variant:"outline",size:"sm",onClick:_t,className:"border-red-300 text-red-700 hover:bg-red-50",children:"حذف الإيصالات"}),e.jsx(Je,{className:"h-4 w-4 text-gray-500"})]})]})}),e.jsx(ae,{className:"space-y-3",children:Ce.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-right",children:"لا توجد إيصالات حتى الآن."}):e.jsx("div",{className:"space-y-3",children:Ce.map(t=>e.jsxs("div",{className:"rounded-lg border p-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"الافتتاحي"}),e.jsxs("p",{className:"text-sm",children:["أساسي: ",x(t.openingBase)]}),e.jsxs("p",{className:"text-sm",children:["هواء: ",x(t.openingAir)]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"التسليم"}),e.jsxs("p",{className:"text-sm",children:["أساسي: ",x(t.deliveryBase)]}),e.jsxs("p",{className:"text-sm",children:["هواء: ",x(t.deliveryAir)]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>Ct(t.id),className:"border-red-300 text-red-700 hover:bg-red-50",children:[e.jsx(qe,{className:"h-3 w-3 mr-1"})," حذف"]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"النتيجة"}),e.jsx("p",{className:`text-sm ${t.netResult>=0?"text-green-700":"text-red-700"}`,children:x(t.netResult)}),e.jsxs("div",{className:"mt-1 flex items-center justify-end gap-2",children:[e.jsxs("span",{className:"text-[11px] bg-blue-100 text-blue-700 border border-blue-200 rounded px-2 py-0.5",children:["المجموع النهائي: ",x(t.deliveryBase+t.deliveryAir)]}),typeof t.requiredDrawerNoProfit=="number"&&e.jsxs("span",{className:"text-[11px] bg-amber-100 text-amber-700 border border-amber-200 rounded px-2 py-0.5",children:["مطلوب من الدرج (بدون أرباح): ",x(t.requiredDrawerNoProfit||0)]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 text-xs text-gray-500",children:[e.jsx(Ge,{className:"h-3 w-3"}),e.jsx("span",{children:Le(t.createdAt)}),t.cashierName&&e.jsxs(e.Fragment,{children:[e.jsx(He,{orientation:"vertical",className:"h-3"}),e.jsxs("span",{children:["الكاشير: ",t.cashierName]})]})]})]})]},t.id))})})]})]}),e.jsxs(ze,{className:"sticky bottom-0 bg-white dark:bg-[#0F0F0F] z-20 border-t border-gray-200 dark:border-[#333] px-4 py-3 flex items-center justify-between",children:[e.jsx(y,{variant:"outline",onClick:()=>Te(!1),children:"إغلاق"}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(Ut,{className:"h-3 w-3"}),e.jsx("span",{children:"يسجل التاريخ والوقت تلقائياً لكل إيصال"})]})]})]}),e.jsx(Be,{open:bt,onOpenChange:ne,children:e.jsxs(Fe,{className:"sm:max-w-sm",children:[e.jsx(Ee,{children:e.jsx(Me,{children:"تحويل رصيد"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"سعر الجملة"}),e.jsx($,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:ge,onChange:t=>Oe(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block text-right",children:"سعر التجزئة"}),e.jsx($,{inputMode:"decimal",type:"number",min:0,step:"0.01",value:ue,onChange:t=>$e(t.target.value),placeholder:"0.00",className:"text-right"})]}),e.jsx("div",{className:"text-right",children:e.jsxs(q,{className:"bg-green-100 text-green-700 border border-green-200",children:["الربح الفوري: ",x(parseFloat(ue||"0")-parseFloat(ge||"0")||0)]})})]}),e.jsxs(ze,{className:"flex items-center justify-end gap-2",children:[e.jsx(y,{variant:"secondary",onClick:()=>ne(!1),children:"إلغاء"}),e.jsx(y,{onClick:Rt,className:"bg-violet-600 hover:bg-violet-700",children:"تحويل"})]})]})}),e.jsx(ys,{open:At,onOpenChange:le,children:e.jsxs(ut,{children:[e.jsxs(xt,{children:[e.jsx(ft,{children:"اختيار مصدر الخصم"}),e.jsx(vt,{children:"هل يتم الخصم من الرصيد الأساسي أم من رصيد الهواء؟"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-4",children:[e.jsx(yt,{onClick:()=>le(!1),children:"رجوع"}),e.jsx(Ne,{className:"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>Ie("base"),children:"خصم من الأساسي"}),e.jsx(Ne,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>Ie("air"),children:"خصم من الهواء"})]})]})})]})}export{ra as default};
//# sourceMappingURL=MachineDailyDialog-CMRrSK5A.js.map
