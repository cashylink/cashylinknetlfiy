import{aK as w,r as n,u as D,T as y,s as j,$ as S,j as e,af as E,ag as I,ah as k,ai as A,x as P,I as C,aP as F,B as p}from"./index-CzMrJEuC.js";const B=({open:d,onOpenChange:h})=>{const{shiftUser:l,endShift:U,setShiftUser:v}=w(),[m,u]=n.useState(""),[g,f]=n.useState(""),[N,o]=n.useState([]),{user:s}=D();n.useEffect(()=>{(async()=>{try{if(s!=null&&s.uid){const r=y(j,"profiles",s.uid,"cashierUsers","list"),t=await S(r);if(t.exists()){const a=t.data(),i=Array.isArray(a==null?void 0:a.users)?a.users:[];if(i&&i.length>0){o(i);return}}}}catch{}try{const r=`cashierUsers_${(s==null?void 0:s.uid)||"default"}`;let t=localStorage.getItem(r);if(!t){const a=localStorage.getItem("cashierUsers");a&&(t=a)}o(t?JSON.parse(t):[])}catch{o([])}})()},[d,s==null?void 0:s.uid]),n.useEffect(()=>{if(!d||!(s!=null&&s.uid))return;const r=async()=>{try{const a=y(j,"profiles",s.uid,"cashierUsers","list"),i=await S(a);if(i.exists()){const c=i.data(),x=Array.isArray(c==null?void 0:c.users)?c.users:[];x&&x.length>0?o(x):t()}else t()}catch(a){console.warn("ShiftProfileDialog cashierUsers fetch error:",a),t()}},t=()=>{try{const a=`cashierUsers_${(s==null?void 0:s.uid)||"default"}`;let i=localStorage.getItem(a);if(!i){const c=localStorage.getItem("cashierUsers");c&&(i=c)}o(i?JSON.parse(i):[])}catch{o([])}};r()},[d,s==null?void 0:s.uid]);const b=async()=>{if(f(""),!l)return;const r=N.find(t=>t.username===l.username);if(!r){f("لا يوجد مستخدم مطابق لهذه الوردية");return}if(m.trim()!==r.password){f("الرقم السري غير صحيح");return}U(),v(null),u(""),h(!1)};return e.jsx(E,{open:d,onOpenChange:r=>{u(""),f(""),h(r)},children:e.jsxs(I,{className:"sm:max-w-md",children:[e.jsx(k,{children:e.jsx(A,{children:"بروفيل الوردية"})}),l?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-lg border p-3 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-800",children:l.name}),e.jsx("div",{className:"text-xs text-gray-600",children:l.username})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"block",children:"أدخل الرقم السري لتسليم الوردية"}),e.jsx(C,{type:"password",value:m,onChange:r=>u(r.target.value),placeholder:"الرقم السري للمستخدم",dir:"ltr"}),g&&e.jsx("div",{className:"text-red-600 text-xs",children:g})]})]}):e.jsx("div",{className:"text-sm text-gray-600",children:"لا يوجد مستخدم وردية نشط حالياً"}),e.jsxs(F,{className:"flex justify-between",children:[e.jsx(p,{variant:"outline",onClick:()=>h(!1),children:"إغلاق"}),e.jsx(p,{onClick:b,disabled:!l,children:"تسليم الوردية"})]})]})})};export{B as default};
//# sourceMappingURL=ShiftProfileDialog-x0kyOIbL.js.map
