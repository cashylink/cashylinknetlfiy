import{aF as ls,u as rs,l as ns,r as a,j as e,ae as N,af as y,ag as b,ah as w,B as o,aM as S,x as j,I as h,Q as Pe,s as He,_ as is,Y as cs,ac as ve}from"./index-mBSeGJ8K.js";import{getLastTransactions as ds}from"./functions-B8lgosbg.js";const fs=({open:X,onOpenChange:E})=>{var Me;const{shiftUser:n,isShiftActive:M,shiftStartAt:B,setShiftUser:U,startShift:je,endShift:pe}=ls(),{userSubscription:Z,user:l,signIn:Le,profile:os}=rs(),{toast:D}=ns(),[P,fe]=a.useState((n==null?void 0:n.name)||""),[H,ge]=a.useState((n==null?void 0:n.username)||""),[L,Ne]=a.useState(""),[ee,$]=a.useState(!1),[g,_]=a.useState(null),[ye,be]=a.useState(""),[we,se]=a.useState(""),[ms,xs]=a.useState(!1),[f,te]=a.useState(null),[Se,ae]=a.useState(""),[De,k]=a.useState(""),[$e,F]=a.useState(!1),[V,G]=a.useState(!1),[Ce,z]=a.useState({totalTransfers:0,totalWithdrawals:0}),[J,Y]=a.useState(null),[Te,le]=a.useState(""),[I,Fe]=a.useState(""),[W,Ie]=a.useState(0),[_e,hs]=a.useState({}),[A,Ve]=a.useState(0),[O,Ge]=a.useState(0),[ze,us]=a.useState({}),[re,We]=a.useState(""),[Je,ne]=a.useState(!1),K=s=>{const t={"٠":"0","١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9","۰":"0","۱":"1","۲":"2","۳":"3","۴":"4","۵":"5","۶":"6","۷":"7","۸":"8","۹":"9","٫":".","،":".","٬":"."," ":""};return s.split("").map(i=>t[i]??i).join("")},ie=()=>`cashierUsers_${(l==null?void 0:l.uid)||"default"}`,[p,R]=a.useState(()=>{try{let s=localStorage.getItem(ie());if(!s){const t=localStorage.getItem("cashierUsers");t&&(s=t)}return s?JSON.parse(s):[]}catch{return[]}}),[Ae,Ye]=a.useState(!1);a.useEffect(()=>{if(!(l!=null&&l.uid))return;(async()=>{let t=!1;try{const i=Pe(He,"profiles",l.uid,"cashierUsers","list"),c=await is(i);if(c.exists()){const x=c.data(),v=Array.isArray(x==null?void 0:x.users)?x.users:[];v.length>0&&(R(v),t=!0)}}catch(i){console.warn("Failed to fetch cashierUsers from Firestore:",i)}if(!t)try{const i=localStorage.getItem(ie()),c=i?JSON.parse(i):[];c.length>0?R(c):p.length>0&&R([])}catch{}Ye(!0)})()},[l==null?void 0:l.uid]);const Be=(Me=Z==null?void 0:Z.subscription)==null?void 0:Me.planType,ce=Be==="yearly"?2:Be==="lifetime"?4:Number.POSITIVE_INFINITY;a.useEffect(()=>{try{localStorage.setItem(ie(),JSON.stringify(p));try{localStorage.removeItem("cashierUsers")}catch{}}catch{}(async()=>{try{if(!(l!=null&&l.uid)||p.length===0&&!Ae)return;const t=Pe(He,"profiles",l.uid,"cashierUsers","list");await cs(t,{users:p},{merge:!0})}catch(t){console.warn("Failed to save cashierUsers to Cloud:",t)}})()},[p,Ae,l==null?void 0:l.uid]);const[Ke,Q]=a.useState(!1),[ke,de]=a.useState(""),[C,Oe]=a.useState(null),[Re,oe]=a.useState([]),[me,xe]=a.useState(!1),[m,Qe]=a.useState(null),[qe,he]=a.useState(!1),[Xe,q]=a.useState(!1),Ze=s=>{const t=(n==null?void 0:n.username)===s;let i=!1;try{i=localStorage.getItem("lastHandoverToAdmin")==="true"}catch{}if(t&&!(t&&!M&&(re==="الأدمن الرئيسي"||i))){D({title:"لا يمكن الحذف",description:"لا يمكنك حذف مستخدم الوردية أثناء كونها نشطة أو قبل تسليمها للأدمن الرئيسي"});return}const v=`هل أنت متأكد من حذف المستخدم ${s}؟

هذا الإجراء لا يمكن التراجع عنه.`;window.confirm(v)&&(R(u=>u.filter(ue=>ue.username!==s)),t&&U(null),D({title:"تم حذف المستخدم",description:s}))},es=()=>{if(!P.trim()||!H.trim()||!L.trim())return;if(p.length>=ce){D({title:"وصلت الحد الأقصى للمستخدمين",description:`هذه الباقة تسمح بإضافة ${Number.isFinite(ce)?ce:"عدد غير محدود"} كاشير فقط`,variant:"destructive"});return}const s={name:P.trim(),username:H.trim(),password:L.trim()};R(t=>[s,...t]),fe(""),ge(""),Ne("")},ss=()=>{$(!0),_(null),te(null),ae(""),k("")},Ee=async()=>{try{let s=[];try{l!=null&&l.uid&&(s=await ve.getUserTransactions(l.uid))}catch{}if(!s||s.length===0)try{const r=await ds({merchantUserId:l==null?void 0:l.uid,limit:200});s=(r==null?void 0:r.transactions)||[]}catch{}const t=B?new Date(B):null,i=new Date,c=r=>{const d=r.type,T=r.txnType;return d==="withdraw"||d==="withdrawal"||d==="receive"||T==="receive"},x=r=>{const d=r.type,T=r.txnType;return d==="send"||d==="transfer"||T==="send"},v=r=>{if(!r)return null;if(r instanceof Date)return r;try{const d=new Date(r);return Number.isNaN(d.getTime())?null:d}catch{return null}},u=r=>{const d=v(r.createdAt||r.created_at||r.timestamp);return!d||t&&d<t?!1:d<=i},ue=r=>r==="completed"||r==="confirmed",Ue=s.filter(r=>ue(r.status)&&u(r)),as=Ue.filter(r=>c(r)).reduce((r,d)=>{const T=d.withdrawnAmount??d.receivedAmount??d.amount??0;return r+(Number(T)||0)},0);return{totalTransfers:Ue.filter(r=>x(r)).reduce((r,d)=>{const T=d.sentAmount??d.transferredAmount??d.amount??0;return r+(Number(T)||0)},0),totalWithdrawals:as}}catch{return{totalTransfers:0,totalWithdrawals:0}}};a.useEffect(()=>{if(V){try{const s=localStorage.getItem("shiftInitialReceivedDrawerFunds");s!==null&&Fe(s)}catch{}try{const s=localStorage.getItem("shiftInitialReceivedWalletBalancesTotal");if(s!==null){const t=parseFloat(s);Ie(Number.isFinite(t)?t:0)}}catch{}}},[V]),a.useEffect(()=>{ee&&(async()=>{try{const s=await Ee();z(s)}catch{}})()},[ee]),a.useEffect(()=>{if(!X&&!me)return;(async()=>{try{const i=((l!=null&&l.uid?await ve.getUserTransactions(l.uid):[])||[]).filter(c=>(c==null?void 0:c.type)==="report"||((c==null?void 0:c.title)||"").includes("إيصال تسليم وردية"));i.sort((c,x)=>{const v=new Date(c.createdAt||0).getTime();return new Date(x.createdAt||0).getTime()-v}),oe(i)}catch{oe([])}})()},[X,V,me,l==null?void 0:l.uid]);const ts=async(s,t,i)=>{try{let c=0,x=0;try{const u=parseFloat(localStorage.getItem("shiftInitialReceivedDrawerFunds")||"0");c=Number.isFinite(u)?u:0}catch{}try{const u=parseFloat(localStorage.getItem("shiftInitialReceivedWalletBalancesTotal")||"0");x=Number.isFinite(u)?u:0}catch{}const v={id:`shift_receipt_${Date.now()}`,type:"report",senderPhone:(n==null?void 0:n.username)||"cashier",receiverPhone:re||"admin",amount:0,status:"completed",createdAt:new Date().toISOString(),title:"إيصال تسليم وردية",cashierName:(n==null?void 0:n.name)||(n==null?void 0:n.username)||null,deficit:t,deficitAmount:t?i:0,shiftStartAt:B,receivedDrawerFunds:c,receivedWalletBalancesTotal:x,receivedWalletBalances:_e,deliveredDrawerFunds:A||0,deliveredWalletBalancesTotal:O||0,deliveredWalletBalances:ze,shiftProfit:Math.round(((A||0)+(O||0)-(c+x))*100)/100};l!=null&&l.uid&&await ve.saveUserTransaction(l.uid,v),oe(u=>[v,...u||[]])}catch{}};return e.jsxs(e.Fragment,{children:[e.jsx(N,{open:X,onOpenChange:E,children:e.jsxs(y,{className:"sm:max-w-md",children:[e.jsx(b,{children:e.jsx(w,{children:M?"تسليم الورديه والخروج":"إضافة مستخدم وردية"})}),M?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 rounded border bg-gray-50",children:[e.jsx("div",{className:"text-sm",children:"المستخدم الحالي للوردية:"}),e.jsxs("div",{className:"font-semibold text-sm",children:[n==null?void 0:n.name," (",n==null?void 0:n.username,")"]})]}),e.jsx("div",{className:"text-xs text-gray-600",children:'لإنهاء الوردية والخروج، اضغط "تسليم الورديه والخروج" وسيُطلب الرقم السري.'})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:'لاستكمال إضافة مستخدم جديد اضغط الزر أسفل "إضافة مستخدم جديد" لفتح النموذج.'}),p.length>0&&e.jsxs("div",{className:"mt-4 border-t pt-3",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"المستخدمون المسجلون"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-auto",children:p.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.username})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(o,{size:"sm",className:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{Oe(s),Q(!0)},children:"دخول"}),e.jsx(o,{size:"sm",className:"w-full sm:w-auto",variant:"destructive",onClick:()=>Ze(s.username),children:"حذف"})]})]},t))})]})]}),e.jsx(S,{className:"flex flex-wrap gap-2 justify-between",children:M?e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(o,{className:"w-full sm:w-auto",variant:"destructive",onClick:ss,children:"تسليم الورديه والخروج"})}):e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(o,{className:"w-full sm:w-auto bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>q(!0),children:"إضافة مستخدم جديد"}),e.jsx(o,{className:"w-full sm:w-auto",variant:"outline",onClick:()=>xe(!0),children:"إيصالات التسليم"})]})})]})}),e.jsx(N,{open:Xe,onOpenChange:q,children:e.jsxs(y,{className:"sm:max-w-md",children:[e.jsx(b,{children:e.jsx(w,{children:"إضافة مستخدم جديد"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{className:"mb-1 block",children:"الاسم"}),e.jsx(h,{value:P,onChange:s=>fe(s.target.value),placeholder:"أدخل الاسم"})]}),e.jsxs("div",{children:[e.jsx(j,{className:"mb-1 block",children:"اسم المستخدم"}),e.jsx(h,{value:H,onChange:s=>ge(s.target.value),placeholder:"أدخل اسم المستخدم"})]}),e.jsxs("div",{children:[e.jsx(j,{className:"mb-1 block",children:"الرقم السري"}),e.jsx(h,{type:"password",autoComplete:"new-password",value:L,onChange:s=>Ne(s.target.value),placeholder:"أدخل الرقم السري"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"المستخدم يمكنه: التحويل، السحب، اختيار المحفظة فقط."})]}),e.jsxs(S,{className:"flex gap-2 justify-between",children:[e.jsx(o,{variant:"secondary",onClick:()=>{q(!1)},children:"إلغاء"}),e.jsx(o,{onClick:()=>{!P.trim()||!H.trim()||!L.trim()||(es(),q(!1))},className:"bg-blue-600 hover:bg-blue-700 text-white",children:"حفظ المستخدم"})]})]})}),e.jsx(N,{open:me,onOpenChange:xe,children:e.jsxs(y,{className:"sm:max-w-lg",children:[e.jsx(b,{children:e.jsx(w,{children:"إيصالات التسليم"})}),Re.length===0?e.jsx("div",{className:"text-xs text-gray-600",children:"لا توجد إيصالات تسليم محفوظة بعد."}):e.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-auto",children:Re.map(s=>e.jsxs("div",{className:"rounded border px-3 py-2 cursor-pointer hover:bg-gray-50",onClick:()=>{Qe(s),he(!0)},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:new Date(s.createdAt).toLocaleString("ar-EG")}),e.jsxs("div",{className:"text-xs text-gray-500",children:["إلى: ",s.receiverPhone]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية مسلّمة: ",s.deliveredDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["محافظ مسلّمة (إجمالي): ",s.deliveredWalletBalancesTotal??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية مستلمة: ",s.receivedDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["محافظ مستلمة (إجمالي): ",s.receivedWalletBalancesTotal??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية مسلّمة: ",s.deliveredDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["محافظ مسلّمة (إجمالي): ",s.deliveredWalletBalancesTotal??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية مستلمة: ",s.receivedDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["محافظ مستلمة (إجمالي): ",s.receivedWalletBalancesTotal??0]}),e.jsxs("div",{className:["text-xs",(s.shiftProfit??(s.deliveredDrawerFunds??0)+(s.deliveredWalletBalancesTotal??0)-(s.receivedDrawerFunds??0)-(s.receivedWalletBalancesTotal??0))>=0?"text-green-700":"text-red-700"].join(" "),children:["أرباح الوردية: ",s.shiftProfit??(s.deliveredDrawerFunds??0)+(s.deliveredWalletBalancesTotal??0)-(s.receivedDrawerFunds??0)-(s.receivedWalletBalancesTotal??0)]})]}),s.deficit&&e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["عجز: ",s.deficitAmount??0]})]},s.id))}),e.jsx(S,{className:"flex gap-2 justify-between",children:e.jsx(o,{variant:"secondary",onClick:()=>xe(!1),children:"إغلاق"})})]})}),e.jsx(N,{open:qe,onOpenChange:he,children:e.jsxs(y,{className:"sm:max-w-md",children:[e.jsx(b,{children:e.jsx(w,{children:"إيصال تسليم وردية"})}),m?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 rounded border bg-gray-50",children:[e.jsxs("div",{className:"text-sm",children:["التاريخ: ",new Date(m.createdAt).toLocaleString("ar-EG")]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["تم التسليم إلى: ",m.receiverPhone]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"المستلم عند الدخول"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية: ",m.receivedDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["أرصدة المحافظ (إجمالي): ",m.receivedWalletBalancesTotal??0]})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"المسلّم عند الخروج"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية: ",m.deliveredDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["أرصدة المحافظ (إجمالي): ",m.deliveredWalletBalancesTotal??0]})]})]}),m.deficit&&e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2 text-red-600",children:"عجز"}),e.jsxs("div",{className:"text-xs text-red-600",children:["المبلغ: ",m.deficitAmount??0]})]}),m.receivedWalletBalances&&Object.keys(m.receivedWalletBalances).length>0&&e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"تفصيل المحافظ المستلمة"}),e.jsx("div",{className:"space-y-1",children:Object.entries(m.receivedWalletBalances).map(([s,t])=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:s}),e.jsx("span",{className:"font-semibold",children:t})]},s))})]}),m.deliveredWalletBalances&&Object.keys(m.deliveredWalletBalances).length>0&&e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"تفصيل المحافظ المسلّمة"}),e.jsx("div",{className:"space-y-1",children:Object.entries(m.deliveredWalletBalances).map(([s,t])=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:s}),e.jsx("span",{className:"font-semibold",children:t})]},s))})]})]}):e.jsx("div",{className:"text-xs text-gray-600",children:"لا يوجد تقرير محدد للعرض."}),e.jsx(S,{className:"flex gap-2 justify-between",children:e.jsx(o,{variant:"secondary",onClick:()=>he(!1),children:"إغلاق"})})]})}),e.jsx(N,{open:Ke,onOpenChange:Q,children:e.jsxs(y,{className:"sm:max-w-md",children:[e.jsx(b,{children:e.jsx(w,{children:"أدخل الرقم السري للدخول"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm",children:C?`${C.name} (${C.username})`:""}),e.jsx(h,{type:"password",autoComplete:"off",value:ke,onChange:s=>de(s.target.value),placeholder:"أدخل الرقم السري"})]}),e.jsxs(S,{className:"flex gap-2 justify-between",children:[e.jsx(o,{variant:"secondary",onClick:()=>{de(""),Oe(null),Q(!1)},children:"إلغاء"}),e.jsx(o,{className:"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>{if(C){if(ke.trim()!==C.password){D({title:"خطأ في الرقم السري",description:"الرقم السري للكاشير غير صحيح",variant:"destructive"});return}U({name:C.name,username:C.username}),de(""),Q(!1),E(!1),je(),ne(!0)}},children:"دخول الورديه"})]})]})}),e.jsx(N,{open:Je,onOpenChange:ne,children:e.jsxs(y,{className:"sm:max-w-md",children:[e.jsx(b,{children:e.jsx(w,{children:"تسجيل أرصدة البداية والنقدية"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(j,{className:"mb-1 block",children:"الفلوس النقدية المستلمة عند الدخول"}),e.jsx(h,{type:"text",inputMode:"decimal",value:I,onChange:s=>Fe(K(s.target.value)),placeholder:"أدخل قيمة النقدية في الدرج عند بداية الورديه"})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(j,{className:"mb-1 block",children:"أرصدة المحافظ المستلمة (إجمالي) عند الدخول"}),e.jsx(h,{type:"text",inputMode:"decimal",value:Number.isFinite(W)?W:0,onChange:s=>{const t=parseFloat(K(s.target.value));Ie(Number.isFinite(t)?t:0)},placeholder:"أدخل إجمالي أرصدة المحافظ عند بداية الورديه"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"يمكن إضافة التفصيل لاحقاً إن لزم، المهم تسجيل الإجمالي."})]})]}),e.jsx(S,{className:"flex gap-2 justify-between",children:e.jsx(o,{className:"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>{const s=parseFloat(I),t=W,i=Number.isFinite(s)&&s>=0,c=Number.isFinite(t)&&t>=0;if(!i||!c){D({title:"يرجى إدخال قيم صحيحة",description:"أدخل قيمًا رقمية غير سالبة للنقدية ولإجمالي أرصدة المحافظ",variant:"destructive"});return}try{localStorage.setItem("shiftInitialReceivedDrawerFunds",String(s)),localStorage.setItem("shiftInitialReceivedWalletBalancesTotal",String(t))}catch{}D({title:"تم تسجيل أرصدة البداية",description:"سُجّل إجمالي النقدية وأرصدة المحافظ لبداية الورديه"}),ne(!1)},children:"تأكيد وحفظ"})})]})}),e.jsx(N,{open:ee,onOpenChange:s=>{s&&$(!0)},children:e.jsxs(y,{className:"sm:max-w-md",hideClose:!0,disableOutsideClose:!0,disableEscClose:!0,children:[e.jsx(b,{children:e.jsx(w,{children:"تسليم الورديه والخروج"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:g==="toUser"?"default":"secondary",onClick:()=>_("toUser"),children:"تسليم إلى مستخدم آخر"}),e.jsx(o,{variant:g==="toAdmin"?"default":"secondary",onClick:()=>_("toAdmin"),children:"تسليم إلى الأدمن الرئيسي"})]}),g==="toUser"&&e.jsxs("div",{className:"space-y-3",children:[p.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"لا يوجد مستخدمون مسجلون. قم بإضافة مستخدم أولاً."}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"اختر المستخدم الذي سيتسلم الورديه"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-auto",children:p.map((s,t)=>e.jsxs("div",{className:`flex items-center justify-between rounded border px-3 py-2 cursor-pointer ${(f==null?void 0:f.username)===s.username?"bg-indigo-50 border-indigo-200":""}`,onClick:()=>te(s),children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.username})]}),e.jsx("span",{className:"text-xs text-gray-400",children:"اختيار"})]},t))})]}),e.jsxs("div",{children:[e.jsx(j,{className:"mb-1 block",children:"كلمة سر المستخدم المحدد"}),e.jsx(h,{type:"password",autoComplete:"off",value:Se,onChange:s=>ae(s.target.value),placeholder:"أدخل كلمة السر"})]}),De&&e.jsx("div",{className:"text-xs text-red-600",children:De})]}),g==="toAdmin"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"أدخل كلمة مرور الحساب الرئيسي لتسليم الورديه والخروج إلى الأدمن."}),e.jsx(h,{type:"password",autoComplete:"off",value:ye,onChange:s=>be(s.target.value),placeholder:"كلمة المرور"}),we&&e.jsx("div",{className:"text-xs text-red-600",children:we})]})]}),e.jsx(S,{className:"flex gap-2 justify-between",children:e.jsx(o,{disabled:$e||!g,onClick:async()=>{if(g){F(!0);try{const s=Ce;if(Ee().then(z).catch(()=>{}),g==="toUser"){if(!f){k("يرجى اختيار المستخدم أولاً"),F(!1);return}if(Se.trim()!==f.password){k("كلمة السر غير صحيحة"),F(!1);return}pe(),U({name:f.name,username:f.username}),je(),We(`${f.name} (${f.username})`);try{localStorage.setItem("lastHandoverToAdmin","false")}catch{}$(!1),_(null),te(null),ae(""),k(""),E(!1),z(s),Y(null),le(""),G(!0)}else if(g==="toAdmin"){se("");const t=(l==null?void 0:l.email)||"";if(!t){se("لا يوجد بريد للمستخدم الرئيسي للتحقق"),F(!1);return}const{error:i}=await Le(t,ye);if(i){se("كلمة المرور غير صحيحة"),F(!1);return}pe(),U(null);try{localStorage.setItem("lastHandoverToAdmin","true")}catch{}be(""),$(!1),E(!1),We("الأدمن الرئيسي"),z(s),Y(null),le(""),G(!0)}}catch{k("حدث خطأ أثناء التسليم، حاول مرة أخرى")}finally{F(!1)}}},className:"bg-blue-600 hover:bg-blue-700 text-white",children:"تأكيد التسليم"})})]})}),e.jsx(N,{open:V,onOpenChange:G,children:e.jsxs(y,{className:"sm:max-w-lg",hideClose:!0,disableOutsideClose:!0,disableEscClose:!0,children:[e.jsx(b,{children:e.jsx(w,{children:"تقرير تسليم الورديه والخروج"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 rounded border bg-gray-50",children:[e.jsxs("div",{className:"text-sm",children:["تم تسليم الورديه إلى: ",e.jsx("span",{className:"font-semibold",children:re})]}),B&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["بداية الورديه: ",new Date(B).toLocaleString("ar-EG")]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نهاية الورديه: ",new Date().toLocaleString("ar-EG")]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(j,{className:"mb-1 block",children:"الفلوس النقدية المستلمة"}),e.jsx(h,{type:"number",value:I,readOnly:!0,disabled:!0,placeholder:"قيمة مسجلة عند بداية الورديه"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"قيمة غير قابلة للتعديل؛ تُسجّل عند الدخول."})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(j,{className:"mb-1 block",children:"أرصدة المحافظ المستلمة (إجمالي)"}),e.jsx(h,{type:"number",value:W,readOnly:!0,disabled:!0,placeholder:"إجمالي مسجل عند بداية الورديه"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(j,{className:"mb-1 block",children:"الفلوس النقدية المسلمة"}),e.jsx(h,{type:"text",inputMode:"decimal",value:A,onChange:s=>{const t=parseFloat(K(s.target.value));Ve(Number.isFinite(t)?t:0)},placeholder:"أدخل قيمة النقدية المسلمة عند نهاية الورديه"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"ادخال يدوي لقيمة النقدية المسلّمة عند نهاية الورديه"})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(j,{className:"mb-1 block",children:"أرصدة المحافظ المسلمة (إجمالي)"}),e.jsx(h,{type:"text",inputMode:"decimal",value:O,onChange:s=>{const t=parseFloat(K(s.target.value));Ge(Number.isFinite(t)?t:0)},placeholder:"أدخل إجمالي أرصدة المحافظ المسلّمة"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"يمكنك إدخال الإجمالي يدوياً؛ التفصيل يُحفظ إن لزم"})]})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"أرباح الوردية"}),e.jsx("div",{className:["text-sm",(A??0)+(O??0)-((parseFloat(I||"0")||0)+(W??0))>=0?"text-green-700":"text-red-700"].join(" "),children:Math.round(((A??0)+(O??0)-((parseFloat(I||"0")||0)+(W??0)))*100)/100}),e.jsx("div",{className:"text-xs text-gray-600",children:"محسوبة: (المسلّم − المستلم) للنقدية + المحافظ"}),e.jsx("div",{className:"mt-2 grid grid-cols-1 gap-2",children:e.jsxs("div",{className:"rounded border p-2 bg-gray-50",children:[e.jsx("div",{className:"text-xs text-gray-700",children:"مطلوب من الدرج (بدون أرباح)"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:Math.round(((A??0)-(parseFloat(I||"0")||0))*100)/100})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"هل يوجد عجز؟"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:J==="no"?"default":"secondary",onClick:()=>Y("no"),children:"لا"}),e.jsx(o,{variant:J==="yes"?"default":"secondary",onClick:()=>Y("yes"),children:"نعم"})]}),J==="yes"&&e.jsxs("div",{children:[e.jsx(j,{className:"mb-1 block",children:"مبلغ العجز"}),e.jsx(h,{type:"number",value:Te,onChange:s=>le(s.target.value),placeholder:"أدخل مبلغ العجز"})]})]})]}),e.jsx(S,{className:"flex gap-2 justify-between",children:e.jsx(o,{onClick:()=>{const s=J==="yes",t=parseFloat(Te)||0;(async()=>await ts(Ce,s,t))(),D({title:"تم إضافة إيصال تسليم الورديه",description:"أُضيف الإيصال إلى المعاملات الأخيرة بعنوان إيصال تسليم وردية"}),G(!1)},className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:"تأكيد وحفظ الإيصال"})})]})})]})};export{fs as default};
//# sourceMappingURL=CashierShiftModal-uXu3l3hI.js.map
