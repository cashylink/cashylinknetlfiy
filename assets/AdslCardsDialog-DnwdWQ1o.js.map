{"version":3,"file":"AdslCardsDialog-DnwdWQ1o.js","sources":["../../src/components/AdslCardsDialog.tsx"],"sourcesContent":["\nimport React, { useState, useEffect } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Plus, Search, Smartphone, Save, X, Trash2, Edit2, Phone, User, Hash, Globe, Banknote, Clock, Wifi, MessageCircle } from 'lucide-react';\nimport { useToast } from '@/components/ui/use-toast';\nimport { collection, addDoc, query, where, orderBy, onSnapshot, serverTimestamp, doc, updateDoc, deleteDoc, getDoc, writeBatch } from 'firebase/firestore';\nimport { db } from '@/firebase';\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\nimport { formatMoney } from '@/lib/utils';\n\ninterface AdslCard {\n  id: string;\n  name: string;\n  simNumber: string; // Serial Number\n  lineNumber: string; // Line Number\n  agent?: string; // Agent / Distributor\n  whatsappNumber?: string; // WhatsApp Number\n  callsPackage: string; // Unused\n  internetPackage: string; // Unused\n  adslPackage: string; // Package Name\n  totalAmount: number; // Package Price\n  remainingAmount: number;\n  userId: string;\n  shopId?: string;\n  createdAt: any;\n  nationalId?: string;\n  isPaid?: boolean;\n  isDeferred?: boolean;\n  debtId?: string;\n  notes?: string;\n}\n\ninterface PaymentReceipt {\n  id: string;\n  cardId: string;\n  cardName: string;\n  amount: number;\n  userId: string;\n  createdAt: any;\n  type: 'payment';\n}\n\nexport function AdslCardsDialog({ \n  isOpen, \n  onClose,\n  shopId \n}: { \n  isOpen: boolean; \n  onClose: () => void;\n  shopId?: string;\n}) {\n  const { user } = useFirebaseAuth();\n  const { toast } = useToast();\n  const [cards, setCards] = useState<AdslCard[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [statusFilter, setStatusFilter] = useState<'all' | 'paid' | 'unpaid' | 'deferred'>('all');\n  \n  // Add/Edit Form State\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [editingCard, setEditingCard] = useState<AdslCard | null>(null);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  \n  const [formData, setFormData] = useState({\n    name: '',\n    simNumber: '',\n    lineNumber: '',\n    agent: '',\n    whatsappNumber: '',\n    callsPackage: '',\n    internetPackage: '',\n    adslPackage: '',\n    totalAmount: '',\n    remainingAmount: '',\n    nationalId: '',\n    isPaid: false,\n    notes: ''\n  });\n\n  // Deferred Debt State\n  const [isDeferredDialogOpen, setIsDeferredDialogOpen] = useState(false);\n  const [deferredCard, setDeferredCard] = useState<AdslCard | null>(null);\n  const [deferredName, setDeferredName] = useState('');\n  const [deferredAmount, setDeferredAmount] = useState('');\n\n  const [isConfirmResetOpen, setIsConfirmResetOpen] = useState(false);\n  \n  // Receipts State\n  const [isReceiptsOpen, setIsReceiptsOpen] = useState(false);\n  const [allReceipts, setAllReceipts] = useState<PaymentReceipt[]>([]); // Store all receipts\n  const [receiptSearchTerm, setReceiptSearchTerm] = useState(''); // Search state\n  const [receiptDateFilter, setReceiptDateFilter] = useState<string>(() => {\n    const d = new Date();\n    const year = d.getFullYear();\n    const month = String(d.getMonth() + 1).padStart(2, '0');\n    const day = String(d.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n  });\n  const [receiptFilterType, setReceiptFilterType] = useState<'day' | 'month'>('day');\n\n  // Fetch Cards\n  useEffect(() => {\n    if (!user?.uid) return;\n\n    // Load from localStorage first\n    const localKey = `adslCards_${user.uid}`;\n    try {\n      const localData = localStorage.getItem(localKey);\n      if (localData) {\n        setCards(JSON.parse(localData));\n        setIsLoading(false);\n      }\n    } catch (e) {\n      console.warn(\"Error loading adsl cards from localStorage\", e);\n    }\n\n    if (!isOpen) return;\n\n    setIsLoading(true);\n    const q = query(\n      collection(db, 'adslCards'),\n      where('userId', '==', user.uid)\n    );\n\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const data = snapshot.docs\n        .map(doc => ({ id: doc.id, ...doc.data() } as AdslCard))\n        .sort((a, b) => {\n          // Sort by createdAt desc\n          const timeA = a.createdAt?.seconds || 0;\n          const timeB = b.createdAt?.seconds || 0;\n          return timeB - timeA;\n        });\n      \n      setCards(data);\n      // Cache\n      try {\n        localStorage.setItem(localKey, JSON.stringify(data));\n      } catch (e) {}\n      \n      setIsLoading(false);\n    }, (error) => {\n      console.error(\"Error fetching ADSL cards:\", error);\n      toast({ title: 'خطأ', description: 'تعذّر تحميل البيانات. تأكد من الصلاحيات والاتصال.', variant: 'destructive' });\n      setIsLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, [user?.uid, isOpen]);\n\n  const handleOpenForm = (card?: AdslCard) => {\n    if (card) {\n      setEditingCard(card);\n      setFormData({\n        name: card.name,\n        simNumber: card.simNumber,\n        lineNumber: card.lineNumber,\n        agent: card.agent || '',\n        whatsappNumber: card.whatsappNumber || '',\n        callsPackage: card.callsPackage,\n        internetPackage: card.internetPackage,\n        adslPackage: card.adslPackage || '',\n        totalAmount: card.totalAmount.toString(),\n        remainingAmount: card.remainingAmount.toString(),\n        nationalId: card.nationalId || '',\n        isPaid: card.isPaid || false,\n        notes: card.notes || ''\n      });\n    } else {\n      setEditingCard(null);\n      setFormData({\n        name: '',\n        simNumber: '',\n        lineNumber: '',\n        agent: '',\n        whatsappNumber: '',\n        callsPackage: '',\n        internetPackage: '',\n        adslPackage: '',\n        totalAmount: '',\n        remainingAmount: '',\n        nationalId: '',\n        isPaid: false,\n        notes: ''\n      });\n    }\n    setIsFormOpen(true);\n  };\n\n  const handleSave = async () => {\n    console.log(\"handleSave started\");\n    // Explicit check for user\n    if (!user?.uid) {\n      const msg = 'لم يتم العثور على بيانات المستخدم';\n      toast({ title: 'خطأ', description: msg, variant: 'destructive' });\n      alert(msg);\n      return;\n    }\n    \n    // Validation\n    if (!formData.name.trim()) {\n      const msg = 'يرجى إدخال الاسم';\n      toast({ title: 'خطأ', description: msg, variant: 'destructive' });\n      alert(msg);\n      return;\n    }\n    if (!formData.lineNumber.trim()) {\n      const msg = 'يرجى إدخال رقم الخط';\n      toast({ title: 'خطأ', description: msg, variant: 'destructive' });\n      alert(msg);\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      const cardData = {\n        name: formData.name,\n        simNumber: formData.simNumber || '',\n        lineNumber: formData.lineNumber,\n        agent: formData.agent || '',\n        whatsappNumber: formData.whatsappNumber || '',\n        callsPackage: formData.callsPackage || '',\n        internetPackage: formData.internetPackage || '',\n        adslPackage: formData.adslPackage || '',\n        totalAmount: parseFloat(formData.totalAmount) || 0,\n        remainingAmount: parseFloat(formData.remainingAmount) || 0,\n        nationalId: formData.nationalId || '',\n        isPaid: formData.isPaid || false,\n        notes: formData.notes,\n        userId: user.uid,\n        shopId: shopId || user.uid,\n        updatedAt: serverTimestamp()\n      };\n      \n      console.log(\"Saving card data:\", cardData);\n\n      if (editingCard) {\n        await updateDoc(doc(db, 'adslCards', editingCard.id), cardData);\n        toast({ title: 'تم التحديث', description: 'تم تحديث بيانات الاشتراك بنجاح' });\n      } else {\n        await addDoc(collection(db, 'adslCards'), {\n          ...cardData,\n          createdAt: serverTimestamp()\n        });\n        toast({ title: 'تم الإضافة', description: 'تم إضافة الاشتراك الجديد بنجاح' });\n      }\n      setIsFormOpen(false);\n    } catch (error: any) {\n      console.error(\"Error saving ADSL card:\", error);\n      toast({ title: 'خطأ', description: `حدث خطأ أثناء الحفظ: ${error.message}`, variant: 'destructive' });\n      alert(`حدث خطأ أثناء الحفظ: ${error.message}`);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleDelete = async (id: string) => {\n    if (!confirm('هل أنت متأكد من حذف هذا الاشتراك؟')) return;\n    try {\n      await deleteDoc(doc(db, 'adslCards', id));\n      toast({ title: 'تم الحذف', description: 'تم حذف الاشتراك بنجاح' });\n    } catch (error) {\n      console.error(error);\n      toast({ title: 'خطأ', description: 'فشل الحذف', variant: 'destructive' });\n    }\n  };\n\n  const handleSetPaid = async (card: AdslCard, isPaid: boolean) => {\n    // Optimistic UI update\n    setCards(prevCards => prevCards.map(c => c.id === card.id ? { ...c, isPaid, isDeferred: false } : c));\n\n    try {\n      await updateDoc(doc(db, 'adslCards', card.id), {\n        isPaid: isPaid,\n        isDeferred: false,\n        updatedAt: serverTimestamp()\n      });\n\n      if (isPaid) {\n        // Generate Receipt\n        await addDoc(collection(db, 'adslReceipts'), {\n          cardId: card.id,\n          cardName: card.name,\n          amount: card.totalAmount,\n          userId: user?.uid,\n          createdAt: serverTimestamp(),\n          type: 'payment'\n        });\n      }\n\n      toast({ title: 'تم التحديث', description: isPaid ? 'تم تحديد الاشتراك كمدفوع وتم تسجيل إيصال' : 'تم تحديد الاشتراك كغير مدفوع' });\n    } catch (error) {\n      // Revert optimistic update on error\n      setCards(prevCards => prevCards.map(c => c.id === card.id ? { ...c, isPaid: !isPaid, isDeferred: card.isDeferred } : c));\n      console.error(error);\n      toast({ title: 'خطأ', description: 'حدث خطأ أثناء تحديث الحالة', variant: 'destructive' });\n    }\n  };\n\n  const handleOpenDeferred = (card: AdslCard) => {\n    setDeferredCard(card);\n    setDeferredName(card.name || '');\n    setDeferredAmount(card.totalAmount?.toString() || '');\n    setIsDeferredDialogOpen(true);\n  };\n\n  const handleConfirmDeferred = async () => {\n    if (!user?.uid || !deferredCard) return;\n\n    if (!deferredName.trim()) {\n      toast({ title: 'خطأ', description: 'يرجى إدخال اسم العميل', variant: 'destructive' });\n      return;\n    }\n    const amount = parseFloat(deferredAmount);\n    if (isNaN(amount) || amount <= 0) {\n      toast({ title: 'خطأ', description: 'يرجى إدخال مبلغ صحيح', variant: 'destructive' });\n      return;\n    }\n\n    try {\n      const userRef = doc(db, 'users', user.uid);\n      const userSnap = await getDoc(userRef);\n      const userData = userSnap.data() as any;\n      const currentDebts = Array.isArray(userData?.debts) ? userData.debts : [];\n\n      const newDebt = {\n        id: `DEBT-${Date.now()}`,\n        debtorName: deferredName,\n        mobile: deferredCard.lineNumber,\n        amount: amount,\n        reason: 'تمن تسديد باقة ADSL',\n        status: 'pending',\n        createdAt: new Date(),\n        paidAmount: 0,\n        partialPayments: []\n      };\n\n      await updateDoc(userRef, {\n        debts: [newDebt, ...currentDebts]\n      });\n\n      // Set card as Deferred (Orange)\n      setCards(prevCards => prevCards.map(c => c.id === deferredCard.id ? { ...c, isPaid: false, isDeferred: true, debtId: newDebt.id } : c));\n      \n      await updateDoc(doc(db, 'adslCards', deferredCard.id), {\n        isPaid: false,\n        isDeferred: true,\n        debtId: newDebt.id,\n        updatedAt: serverTimestamp()\n      });\n      \n      toast({ title: 'تم الإضافة', description: 'تم إضافة الدين وتأجيل الاشتراك' });\n      setIsDeferredDialogOpen(false);\n    } catch (error) {\n      console.error(error);\n      toast({ title: 'خطأ', description: 'حدث خطأ أثناء حفظ الدين', variant: 'destructive' });\n    }\n  };\n\n  // Listen for debt payments to auto-update deferred cards\n  useEffect(() => {\n    if (!user?.uid) return;\n    \n    const userRef = doc(db, 'users', user.uid);\n    const unsubscribe = onSnapshot(userRef, async (docSnap) => {\n      if (docSnap.exists()) {\n        const userData = docSnap.data();\n        const debts = userData.debts || [];\n        \n        // Find deferred cards that are not yet paid\n        const deferredCards = cards.filter(c => c.isDeferred && !c.isPaid);\n        \n        for (const card of deferredCards) {\n          let shouldUpdate = false;\n\n          // Match by debtId if available\n          if (card.debtId) {\n            const debt = debts.find((d: any) => d.id === card.debtId);\n            if (debt && debt.status === 'paid') {\n              shouldUpdate = true;\n            }\n          } \n          // Fallback: Match by mobile number OR (Name + Amount) for legacy support\n          else {\n             const paidDebt = debts.find((d: any) => \n              d.status === 'paid' && \n              d.reason === 'تمن تسديد باقة ADSL' &&\n              (\n                (d.mobile && d.mobile === card.lineNumber) || \n                // Legacy match for debts created without mobile number\n                (!d.mobile && d.debtorName === card.name && Math.abs(d.amount - card.totalAmount) < 0.1)\n              )\n            );\n            if (paidDebt) {\n              shouldUpdate = true;\n            }\n          }\n\n          if (shouldUpdate) {\n            // Update card to paid\n            await handleSetPaid(card, true);\n          }\n        }\n      }\n    });\n    \n    return () => unsubscribe();\n  }, [user?.uid, cards]);\n\n  const filteredCards = cards.filter(c => {\n    const matchesSearch = c.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      c.lineNumber.includes(searchTerm) ||\n      c.simNumber.includes(searchTerm);\n\n    const matchesStatus = \n      statusFilter === 'all' ? true :\n      statusFilter === 'paid' ? c.isPaid :\n      statusFilter === 'unpaid' ? (!c.isPaid && !c.isDeferred) :\n      statusFilter === 'deferred' ? c.isDeferred : true;\n\n    return matchesSearch && matchesStatus;\n  });\n\n  const paidCount = cards.filter(c => c.isPaid).length;\n  const unpaidCount = cards.filter(c => !c.isPaid && !c.isDeferred).length;\n  const deferredCount = cards.filter(c => c.isDeferred).length;\n\n  const handleResetAllUnpaid = async () => {\n    setIsConfirmResetOpen(true);\n  };\n\n  const confirmResetAll = async () => {\n    if (!user?.uid) return;\n\n    try {\n      const batch = writeBatch(db);\n      // Iterate over all cards (using the main cards state which contains all fetched cards)\n      cards.forEach(card => {\n        if (card.isPaid) {\n          const cardRef = doc(db, 'adslCards', card.id);\n          batch.update(cardRef, { \n            isPaid: false,\n            updatedAt: serverTimestamp() \n          });\n        }\n      });\n\n      await batch.commit();\n      \n      // Optimistic update\n      setCards(prevCards => prevCards.map(c => ({ ...c, isPaid: false })));\n      \n      toast({ title: 'تم التحديث', description: 'تم تحويل جميع الاشتراكات إلى غير مدفوع بنجاح' });\n      setIsConfirmResetOpen(false);\n    } catch (error) {\n      console.error(\"Error resetting cards:\", error);\n      toast({ title: 'خطأ', description: 'حدث خطأ أثناء تحديث الاشتراكات', variant: 'destructive' });\n      setIsConfirmResetOpen(false);\n    }\n  };\n\n  const handleDeleteReceipt = async (receiptId: string) => {\n    if (!confirm('هل أنت متأكد من حذف هذا الإيصال؟\\nسيتم حذف المبلغ من السجل نهائياً.')) return;\n    try {\n      await deleteDoc(doc(db, 'adslReceipts', receiptId));\n      toast({ title: 'تم الحذف', description: 'تم حذف الإيصال بنجاح' });\n    } catch (error) {\n      console.error(error);\n      toast({ title: 'خطأ', description: 'فشل حذف الإيصال', variant: 'destructive' });\n    }\n  };\n\n  // Fetch All Receipts (Once when dialog opens)\n  useEffect(() => {\n    if (!isReceiptsOpen || !user?.uid) return;\n\n    const q = query(\n      collection(db, 'adslReceipts'),\n      where('userId', '==', user.uid)\n    );\n\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() } as PaymentReceipt));\n      // Sort desc by default\n      data.sort((a, b) => {\n        const timeA = a.createdAt?.seconds || Math.floor(Date.now() / 1000);\n        const timeB = b.createdAt?.seconds || Math.floor(Date.now() / 1000);\n        return timeB - timeA;\n      });\n      setAllReceipts(data);\n    }, (error) => {\n      console.error(\"Error fetching receipts:\", error);\n      toast({ title: 'خطأ', description: 'فشل تحميل السجل', variant: 'destructive' });\n    });\n\n    return () => unsubscribe();\n  }, [isReceiptsOpen, user?.uid]);\n\n  // Derived Filtered Receipts\n  const receipts = allReceipts.filter(item => {\n    // 1. Search Filter (Priority)\n    if (receiptSearchTerm.trim()) {\n      const term = receiptSearchTerm.toLowerCase();\n      const card = cards.find(c => c.id === item.cardId);\n      const nameMatch = item.cardName.toLowerCase().includes(term);\n      const numberMatch = card ? (card.lineNumber.includes(term) || card.simNumber.includes(term)) : false;\n      return nameMatch || numberMatch;\n    }\n\n    // 2. Date Filter (If no search)\n    // If createdAt is missing (pending write), treat as current time\n    const timestamp = item.createdAt?.seconds ? item.createdAt.seconds * 1000 : Date.now();\n    const itemDate = new Date(timestamp);\n    \n    // Parse date safely as local time\n    const [y, m, d] = receiptDateFilter.split('-').map(Number);\n    const start = new Date(y, m - 1, d);\n    const end = new Date(y, m - 1, d);\n\n    if (receiptFilterType === 'day') {\n      start.setHours(0, 0, 0, 0);\n      end.setHours(23, 59, 59, 999);\n    } else {\n      start.setDate(1);\n      start.setHours(0, 0, 0, 0);\n      end.setMonth(end.getMonth() + 1);\n      end.setDate(0);\n      end.setHours(23, 59, 59, 999);\n    }\n\n    return itemDate >= start && itemDate <= end;\n  });\n\n  return (\n    <>\n      <Dialog open={isOpen} onOpenChange={(open) => !open && onClose()}>\n        <DialogContent className=\"max-w-screen w-screen h-screen flex flex-col p-0 gap-0 bg-gray-50 dark:bg-gray-900 rounded-none border-0\">\n          {/* Header */}\n          <div className=\"p-3 border-b bg-white dark:bg-gray-800 flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"p-1.5 bg-blue-100 dark:bg-blue-900/30 rounded-full text-blue-600\">\n                <Wifi className=\"h-5 w-5\" />\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <DialogTitle className=\"text-base font-bold\">إدارة ADSL</DialogTitle>\n                <DialogDescription className=\"text-xs\">سجل ومتابعة اشتراكات ADSL</DialogDescription>\n              </div>\n            </div>\n            <Button onClick={() => onClose()} variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n\n          {/* Status Filters */}\n          <div className=\"grid grid-cols-3 gap-2 p-2 bg-gray-50/50 dark:bg-gray-900/50 border-b\">\n            {/* Paid Card */}\n            <div \n              onClick={() => setStatusFilter(statusFilter === 'paid' ? 'all' : 'paid')}\n              className={`cursor-pointer rounded-md border py-1.5 px-2 flex flex-row items-center justify-center gap-2 transition-all hover:shadow-sm ${\n                statusFilter === 'paid' \n                  ? 'bg-green-100 border-green-300 ring-1 ring-green-500 ring-offset-1 dark:ring-offset-gray-900' \n                  : 'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-green-300'\n              }`}\n            >\n              <div className={`p-1 rounded-full ${statusFilter === 'paid' ? 'bg-green-200' : 'bg-green-100'} text-green-700`}>\n                <Banknote className=\"h-3.5 w-3.5\" />\n              </div>\n              <div className=\"flex items-center gap-1.5 leading-none\">\n                <div className=\"text-[10px] font-bold text-gray-600 dark:text-gray-400\">المدفوعة</div>\n                <div className=\"text-sm font-bold text-green-600\">{paidCount}</div>\n              </div>\n            </div>\n\n            {/* Unpaid Card */}\n            <div \n              onClick={() => setStatusFilter(statusFilter === 'unpaid' ? 'all' : 'unpaid')}\n              className={`cursor-pointer rounded-md border py-1.5 px-2 flex flex-row items-center justify-center gap-2 transition-all hover:shadow-sm ${\n                statusFilter === 'unpaid' \n                  ? 'bg-red-100 border-red-300 ring-1 ring-red-500 ring-offset-1 dark:ring-offset-gray-900' \n                  : 'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-red-300'\n              }`}\n            >\n              <div className={`p-1 rounded-full ${statusFilter === 'unpaid' ? 'bg-red-200' : 'bg-red-100'} text-red-700`}>\n                <Clock className=\"h-3.5 w-3.5\" />\n              </div>\n              <div className=\"flex items-center gap-1.5 leading-none\">\n                <div className=\"text-[10px] font-bold text-gray-600 dark:text-gray-400\">غير المدفوعة</div>\n                <div className=\"text-sm font-bold text-red-600\">{unpaidCount}</div>\n              </div>\n            </div>\n\n            {/* Deferred Card */}\n            <div \n              onClick={() => setStatusFilter(statusFilter === 'deferred' ? 'all' : 'deferred')}\n              className={`cursor-pointer rounded-md border py-1.5 px-2 flex flex-row items-center justify-center gap-2 transition-all hover:shadow-sm ${\n                statusFilter === 'deferred' \n                  ? 'bg-orange-100 border-orange-300 ring-1 ring-orange-500 ring-offset-1 dark:ring-offset-gray-900' \n                  : 'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-orange-300'\n              }`}\n            >\n              <div className={`p-1 rounded-full ${statusFilter === 'deferred' ? 'bg-orange-200' : 'bg-orange-100'} text-orange-700`}>\n                <Clock className=\"h-3.5 w-3.5\" />\n              </div>\n              <div className=\"flex items-center gap-1.5 leading-none\">\n                <div className=\"text-[10px] font-bold text-gray-600 dark:text-gray-400\">مؤجلة الدفع</div>\n                <div className=\"text-sm font-bold text-orange-600\">{deferredCount}</div>\n              </div>\n            </div>\n          </div>\n\n          {/* Actions & Search */}\n          <div className=\"p-4 bg-white dark:bg-gray-800 border-b flex flex-col md:flex-row gap-3 justify-between items-center\">\n            <div className=\"relative w-full md:w-64\">\n              <Search className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\n              <Input \n                placeholder=\"بحث بالاسم أو الرقم...\" \n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pr-9\"\n              />\n            </div>\n            <div className=\"flex gap-2 w-full md:w-auto\">\n              <Button onClick={() => setIsReceiptsOpen(true)} variant=\"outline\" className=\"flex-1 md:flex-none gap-2\">\n                 <Banknote className=\"h-4 w-4\" />\n                 سجل السداد\n              </Button>\n              <Button onClick={() => handleOpenForm()} className=\"flex-1 md:flex-none bg-blue-600 hover:bg-blue-700 text-white gap-2\">\n                <Plus className=\"h-4 w-4\" />\n                إضافة اشتراك جديد\n              </Button>\n              <Button \n                onClick={handleResetAllUnpaid} \n                variant=\"destructive\"\n                className=\"flex-1 md:flex-none gap-2\"\n              >\n                <Clock className=\"h-4 w-4\" />\n                تحويل الكل لغير مدفوع\n              </Button>\n            </div>\n          </div>\n\n          {/* Content */}\n          <div className=\"flex-1 overflow-auto p-4\">\n            {isLoading ? (\n              <div className=\"flex justify-center items-center h-40\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n              </div>\n            ) : filteredCards.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center h-64 text-gray-500\">\n                <Wifi className=\"h-12 w-12 mb-3 opacity-20\" />\n                <p>لا توجد اشتراكات مسجلة</p>\n                <Button variant=\"link\" onClick={() => handleOpenForm()} className=\"text-blue-600\">\n                  إضافة أول اشتراك\n                </Button>\n              </div>\n            ) : (\n              <div className=\"flex flex-col gap-3\">\n                {filteredCards.map(card => (\n                  <div key={card.id} className={`rounded-xl shadow-sm border p-3 hover:shadow-md transition-shadow ${\n                    card.isDeferred\n                      ? 'bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800'\n                      : card.isPaid \n                        ? 'bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800' \n                        : 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800'\n                  }`}>\n                    <div className=\"flex flex-col md:flex-row gap-4 items-center\">\n                      \n                      {/* Identity */}\n                      <div className=\"flex items-center gap-3 w-full md:w-auto md:min-w-[200px]\">\n                        <div className={`h-10 w-10 rounded-full flex items-center justify-center font-bold text-sm ${\n                          card.isDeferred\n                            ? 'bg-orange-100 text-orange-700 dark:bg-orange-800 dark:text-orange-100'\n                            : card.isPaid \n                              ? 'bg-green-100 text-green-700 dark:bg-green-800 dark:text-green-100' \n                              : 'bg-red-100 text-red-700 dark:bg-red-800 dark:text-red-100'\n                        }`}>\n                          {card.name.charAt(0)}\n                        </div>\n                        <div>\n                          <h3 className=\"font-bold text-gray-900 dark:text-gray-100 text-sm\">{card.name}</h3>\n                          <div className=\"flex items-center gap-1 text-xs text-gray-500\">\n                            <Phone className=\"h-3 w-3\" />\n                            <span dir=\"ltr\">{card.lineNumber}</span>\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Details - Horizontal Grid */}\n                      <div className=\"flex-1 w-full grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-x-4 gap-y-2 text-xs\">\n                        {card.nationalId && (\n                          <div className=\"flex flex-col\">\n                            <span className=\"text-gray-500 text-[10px] flex items-center gap-1\"><User className=\"h-3 w-3\" /> القومي</span>\n                            <span className=\"font-mono font-medium truncate\">{card.nationalId}</span>\n                          </div>\n                        )}\n                        <div className=\"flex flex-col\">\n                          <span className=\"text-gray-500 text-[10px] flex items-center gap-1\"><Hash className=\"h-3 w-3\" /> سريل الشريحه</span>\n                          <span className=\"font-mono font-medium\">{card.simNumber || '-'}</span>\n                        </div>\n                        {card.agent && (\n                          <div className=\"flex flex-col\">\n                            <span className=\"text-gray-500 text-[10px] flex items-center gap-1\"><User className=\"h-3 w-3\" /> الوكيل</span>\n                            <span className=\"font-medium\">{card.agent}</span>\n                          </div>\n                        )}\n                        <div className=\"flex flex-col\">\n                          <span className=\"text-gray-500 text-[10px] flex items-center gap-1\"><Wifi className=\"h-3 w-3\" /> اسم الباقة</span>\n                          <span className=\"font-medium\">{card.adslPackage || '-'}</span>\n                        </div>\n                        <div className=\"flex flex-col\">\n                          <span className=\"text-gray-500 text-[10px] flex items-center gap-1\"><Banknote className=\"h-3 w-3\" /> سعر الباقة</span>\n                          <span className=\"font-bold text-gray-900\">{formatMoney(card.totalAmount)}</span>\n                        </div>\n                      </div>\n\n                      {/* Actions */}\n                      <div className=\"flex flex-col sm:flex-row gap-2 w-full md:w-auto items-center\">\n                         {card.whatsappNumber && (\n                            <Button \n                              variant=\"ghost\" \n                              size=\"icon\" \n                              className=\"h-8 w-8 text-green-600 hover:bg-green-50\"\n                              onClick={() => {\n                                const message = `مرحباً ${card.name}،\\nتذكير بموعد دفع اشتراك الانترنت الأرضي الخاص بك.\\nالمبلغ المطلوب: ${card.totalAmount} جنيه.\\nشكراً لك!`;\n                                const url = `https://wa.me/2${card.whatsappNumber}?text=${encodeURIComponent(message)}`;\n                                window.open(url, '_blank');\n                              }}\n                              title=\"إرسال تذكير واتساب\"\n                            >\n                              <MessageCircle className=\"h-4 w-4\" />\n                            </Button>\n                          )}\n\n                         <div className=\"flex bg-white/50 rounded-lg p-1 gap-1 shadow-sm\">\n                            <Button \n                              size=\"sm\"\n                              className={`h-7 px-2 text-xs font-bold ${\n                                card.isPaid \n                                  ? 'bg-green-600 hover:bg-green-700 text-white' \n                                  : 'bg-white text-green-600 border border-green-200 hover:bg-green-50'\n                              }`}\n                              onClick={() => handleSetPaid(card, true)}\n                            >\n                              مدفوع\n                            </Button>\n                            <Button \n                              size=\"sm\"\n                              variant=\"destructive\"\n                              className={`h-7 px-2 text-xs font-bold ${\n                                !card.isPaid && !card.isDeferred\n                                  ? 'bg-red-600 hover:bg-red-700 text-white' \n                                  : 'bg-white text-red-600 border border-red-200 hover:bg-red-50'\n                              }`}\n                              onClick={() => handleSetPaid(card, false)}\n                            >\n                              غير\n                            </Button>\n                            <Button \n                              size=\"sm\"\n                              variant=\"outline\"\n                              className={`h-7 px-2 text-xs font-bold ${\n                                card.isDeferred\n                                  ? 'bg-orange-600 hover:bg-orange-700 text-white'\n                                  : 'text-orange-600 border-orange-200 hover:bg-orange-50'\n                              }`}\n                              onClick={() => handleOpenDeferred(card)}\n                            >\n                              أجل\n                            </Button>\n                         </div>\n\n                         <div className=\"flex gap-1\">\n                           <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-blue-600 hover:bg-blue-50\" onClick={() => handleOpenForm(card)}>\n                             <Edit2 className=\"h-4 w-4\" />\n                           </Button>\n                           <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-red-600 hover:bg-red-50\" onClick={() => handleDelete(card.id)}>\n                             <Trash2 className=\"h-4 w-4\" />\n                           </Button>\n                         </div>\n                      </div>\n\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Add/Edit Form Dialog */}\n      <Dialog open={isReceiptsOpen} onOpenChange={setIsReceiptsOpen}>\n        <DialogContent className=\"max-w-2xl h-[80vh] flex flex-col p-0\">\n          <DialogHeader className=\"p-4 border-b\">\n            <DialogTitle>سجل سداد ADSL</DialogTitle>\n            <DialogDescription>\n              عرض إيصالات السداد حسب التاريخ\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"p-4 border-b bg-gray-50 flex flex-col gap-4\">\n            {/* Search Input */}\n            <div className=\"relative w-full\">\n              <Search className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\n              <Input \n                placeholder=\"بحث في السجل بالاسم أو الرقم...\" \n                value={receiptSearchTerm}\n                onChange={(e) => setReceiptSearchTerm(e.target.value)}\n                className=\"pr-9 bg-white\"\n              />\n            </div>\n\n            <div className=\"flex flex-col sm:flex-row gap-4 items-end w-full\">\n              <div className=\"space-y-2 flex-1\">\n                <Label>نوع البحث</Label>\n                <div className=\"flex bg-white rounded-md border p-1\">\n                  <button\n                    onClick={() => setReceiptFilterType('day')}\n                    className={`flex-1 px-3 py-1.5 text-sm rounded-sm transition-colors ${\n                      receiptFilterType === 'day' ? 'bg-blue-100 text-blue-700 font-medium' : 'text-gray-600 hover:bg-gray-50'\n                    }`}\n                  >\n                    يومي\n                  </button>\n                  <button\n                    onClick={() => setReceiptFilterType('month')}\n                    className={`flex-1 px-3 py-1.5 text-sm rounded-sm transition-colors ${\n                      receiptFilterType === 'month' ? 'bg-blue-100 text-blue-700 font-medium' : 'text-gray-600 hover:bg-gray-50'\n                    }`}\n                  >\n                    شهري\n                  </button>\n                </div>\n              </div>\n              \n              <div className=\"space-y-2 flex-1\">\n                <Label>{receiptFilterType === 'day' ? 'اختر اليوم' : 'اختر الشهر'}</Label>\n                <Input\n                  type={receiptFilterType === 'day' ? 'date' : 'month'}\n                  value={receiptFilterType === 'day' ? receiptDateFilter : receiptDateFilter.substring(0, 7)}\n                  onChange={(e) => setReceiptDateFilter(e.target.value)}\n                  className=\"bg-white\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                 <div className=\"text-sm font-medium text-gray-500 mb-1\">إجمالي الفترة</div>\n                 <div className=\"text-lg font-bold text-green-600\">\n                   {formatMoney(receipts.reduce((sum, r) => sum + (r.amount || 0), 0))}\n                 </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex-1 overflow-y-auto p-0 relative\">\n            {receipts.length === 0 ? (\n               <div className=\"flex flex-col items-center justify-center h-48 text-gray-500\">\n                 <Banknote className=\"h-12 w-12 mb-2 opacity-20\" />\n                 <p>لا توجد عمليات سداد في هذه الفترة</p>\n               </div>\n            ) : (\n              <Table>\n                  <TableHeader className=\"sticky top-0 bg-white z-10 shadow-sm\">\n                    <TableRow>\n                      <TableHead className=\"text-right\">التاريخ</TableHead>\n                      <TableHead className=\"text-right\">اسم الاشتراك</TableHead>\n                      <TableHead className=\"text-right\">المبلغ</TableHead>\n                      <TableHead className=\"w-[50px]\"></TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {receipts.map((receipt) => (\n                      <TableRow key={receipt.id}>\n                        <TableCell className=\"font-mono text-xs text-gray-500\">\n                          {receipt.createdAt?.seconds \n                            ? new Date(receipt.createdAt.seconds * 1000).toLocaleString('ar-EG') \n                            : 'الآن'}\n                        </TableCell>\n                        <TableCell className=\"font-medium\">{receipt.cardName}</TableCell>\n                        <TableCell className=\"font-bold text-green-600\">{formatMoney(receipt.amount)}</TableCell>\n                        <TableCell>\n                          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-red-600 hover:bg-red-50\" onClick={() => handleDeleteReceipt(receipt.id)}>\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isConfirmResetOpen} onOpenChange={setIsConfirmResetOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>تأكيد التحويل</DialogTitle>\n            <DialogDescription>\n              هل أنت متأكد من تحويل جميع الاشتراكات إلى \"غير مدفوع\"؟\n              <br />\n              سيتم تغيير حالة الدفع لجميع الاشتراكات المسجلة.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"flex justify-end gap-2 mt-4\">\n            <Button variant=\"outline\" onClick={() => setIsConfirmResetOpen(false)}>\n              إلغاء\n            </Button>\n            <Button variant=\"destructive\" onClick={confirmResetAll}>\n              نعم، تحويل الكل\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>{editingCard ? 'تعديل بيانات الاشتراك' : 'إضافة اشتراك جديد'}</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-2\">\n            <div className=\"space-y-2\">\n              <Label>الاسم</Label>\n              <Input \n                value={formData.name} \n                onChange={(e) => setFormData({...formData, name: e.target.value})}\n                placeholder=\"اسم العميل أو صاحب الخط\"\n              />\n            </div>\n            \n            <div className=\"grid grid-cols-2 gap-4\">\n               <div className=\"space-y-2\">\n                <Label>سريل الشريحه</Label>\n                <Input \n                  value={formData.simNumber} \n                  onChange={(e) => setFormData({...formData, simNumber: e.target.value})}\n                  placeholder=\"سريل الشريحه...\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>رقم الخط</Label>\n                <Input \n                  value={formData.lineNumber} \n                  onChange={(e) => setFormData({...formData, lineNumber: e.target.value})}\n                  placeholder=\"0xxxxxxxx\"\n                  dir=\"ltr\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>الوكيل</Label>\n              <Input \n                value={formData.agent} \n                onChange={(e) => setFormData({...formData, agent: e.target.value})}\n                placeholder=\"اسم الوكيل...\"\n              />\n            </div>\n\n             <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>اسم الباقة</Label>\n                <Input \n                  value={formData.adslPackage} \n                  onChange={(e) => setFormData({...formData, adslPackage: e.target.value})}\n                  placeholder=\"مثال: 140 جيجا\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>سعر الباقة</Label>\n                <Input \n                  type=\"number\"\n                  value={formData.totalAmount} \n                  onChange={(e) => setFormData({...formData, totalAmount: e.target.value})}\n                  placeholder=\"0.00\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>رقم وتساب</Label>\n              <Input \n                value={formData.whatsappNumber} \n                onChange={(e) => setFormData({...formData, whatsappNumber: e.target.value})}\n                placeholder=\"01xxxxxxxxx\"\n                dir=\"ltr\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>ملاحظات (اختياري)</Label>\n              <Textarea \n                value={formData.notes} \n                onChange={(e) => setFormData({...formData, notes: e.target.value})}\n                placeholder=\"أي ملاحظات إضافية...\"\n                className=\"resize-none\"\n              />\n            </div>\n\n            <div className=\"pt-4 flex gap-2\">\n              <Button className=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white\" onClick={handleSave} disabled={isSubmitting}>\n                {isSubmitting ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2\"></div>\n                    جاري الحفظ...\n                  </>\n                ) : (\n                  <>\n                    <Save className=\"h-4 w-4 ml-2\" />\n                    حفظ\n                  </>\n                )}\n              </Button>\n              <Button variant=\"outline\" onClick={() => setIsFormOpen(false)} disabled={isSubmitting}>إلغاء</Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Deferred Debt Dialog */}\n      <Dialog open={isDeferredDialogOpen} onOpenChange={setIsDeferredDialogOpen}>\n        <DialogContent className=\"max-w-sm\">\n          <DialogHeader>\n            <DialogTitle>تسجيل معاملة آجل</DialogTitle>\n            <DialogDescription>سيتم إضافة المبلغ للديون المستحقة</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-2\">\n            <div className=\"space-y-2\">\n              <Label>اسم العميل</Label>\n              <Input \n                value={deferredName} \n                onChange={(e) => setDeferredName(e.target.value)}\n                placeholder=\"اسم العميل...\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>المبلغ</Label>\n              <Input \n                type=\"number\"\n                value={deferredAmount} \n                onChange={(e) => setDeferredAmount(e.target.value)}\n                placeholder=\"0.00\"\n              />\n            </div>\n            <div className=\"pt-2 flex gap-2\">\n              <Button className=\"flex-1 bg-orange-600 hover:bg-orange-700 text-white\" onClick={handleConfirmDeferred}>\n                تأكيد الأجل\n              </Button>\n              <Button variant=\"outline\" onClick={() => setIsDeferredDialogOpen(false)}>إلغاء</Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n"],"names":["AdslCardsDialog","isOpen","onClose","shopId","user","useFirebaseAuth","toast","useToast","cards","setCards","useState","isLoading","setIsLoading","searchTerm","setSearchTerm","statusFilter","setStatusFilter","isFormOpen","setIsFormOpen","editingCard","setEditingCard","isSubmitting","setIsSubmitting","formData","setFormData","isDeferredDialogOpen","setIsDeferredDialogOpen","deferredCard","setDeferredCard","deferredName","setDeferredName","deferredAmount","setDeferredAmount","isConfirmResetOpen","setIsConfirmResetOpen","isReceiptsOpen","setIsReceiptsOpen","allReceipts","setAllReceipts","receiptSearchTerm","setReceiptSearchTerm","receiptDateFilter","setReceiptDateFilter","d","year","month","day","receiptFilterType","setReceiptFilterType","useEffect","localKey","localData","e","q","query","collection","db","where","unsubscribe","onSnapshot","snapshot","data","doc","a","b","timeA","_a","_b","error","handleOpenForm","card","handleSave","msg","cardData","serverTimestamp","updateDoc","addDoc","handleDelete","id","deleteDoc","handleSetPaid","isPaid","prevCards","c","handleOpenDeferred","handleConfirmDeferred","amount","userRef","userData","getDoc","currentDebts","newDebt","docSnap","debts","deferredCards","shouldUpdate","debt","filteredCards","matchesSearch","matchesStatus","paidCount","unpaidCount","deferredCount","handleResetAllUnpaid","confirmResetAll","batch","writeBatch","cardRef","handleDeleteReceipt","receiptId","receipts","item","term","nameMatch","numberMatch","timestamp","itemDate","y","m","start","end","jsxs","Fragment","jsx","Dialog","open","DialogContent","Wifi","DialogTitle","DialogDescription","Button","X","Banknote","Clock","Search","Input","Plus","Phone","User","Hash","formatMoney","message","url","MessageCircle","Edit2","Trash2","DialogHeader","Label","sum","r","Table","TableHeader","TableRow","TableHead","TableBody","receipt","TableCell","Textarea","Save"],"mappings":"+mBA+CO,SAASA,GAAgB,CAC9B,OAAAC,EACA,QAAAC,GACA,OAAAC,EACF,EAIG,CACD,KAAM,CAAE,KAAAC,CAAA,EAASC,GAAA,EACX,CAAE,MAAAC,CAAA,EAAUC,GAAA,EACZ,CAACC,EAAOC,CAAQ,EAAIC,EAAAA,SAAqB,CAAA,CAAE,EAC3C,CAACC,GAAWC,CAAY,EAAIF,EAAAA,SAAS,EAAI,EACzC,CAACG,EAAYC,EAAa,EAAIJ,EAAAA,SAAS,EAAE,EACzC,CAACK,EAAcC,CAAe,EAAIN,EAAAA,SAAiD,KAAK,EAGxF,CAACO,GAAYC,CAAa,EAAIR,EAAAA,SAAS,EAAK,EAC5C,CAACS,EAAaC,EAAc,EAAIV,EAAAA,SAA0B,IAAI,EAC9D,CAACW,EAAcC,EAAe,EAAIZ,EAAAA,SAAS,EAAK,EAEhD,CAACa,EAAUC,CAAW,EAAId,WAAS,CACvC,KAAM,GACN,UAAW,GACX,WAAY,GACZ,MAAO,GACP,eAAgB,GAChB,aAAc,GACd,gBAAiB,GACjB,YAAa,GACb,YAAa,GACb,gBAAiB,GACjB,WAAY,GACZ,OAAQ,GACR,MAAO,EAAA,CACR,EAGK,CAACe,GAAsBC,CAAuB,EAAIhB,EAAAA,SAAS,EAAK,EAChE,CAACiB,EAAcC,EAAe,EAAIlB,EAAAA,SAA0B,IAAI,EAChE,CAACmB,EAAcC,EAAe,EAAIpB,EAAAA,SAAS,EAAE,EAC7C,CAACqB,GAAgBC,EAAiB,EAAItB,EAAAA,SAAS,EAAE,EAEjD,CAACuB,GAAoBC,CAAqB,EAAIxB,EAAAA,SAAS,EAAK,EAG5D,CAACyB,EAAgBC,EAAiB,EAAI1B,EAAAA,SAAS,EAAK,EACpD,CAAC2B,GAAaC,EAAc,EAAI5B,EAAAA,SAA2B,CAAA,CAAE,EAC7D,CAAC6B,EAAmBC,EAAoB,EAAI9B,EAAAA,SAAS,EAAE,EACvD,CAAC+B,EAAmBC,EAAoB,EAAIhC,EAAAA,SAAiB,IAAM,CACvE,MAAMiC,MAAQ,KACRC,EAAOD,EAAE,YAAA,EACTE,EAAQ,OAAOF,EAAE,SAAA,EAAa,CAAC,EAAE,SAAS,EAAG,GAAG,EAChDG,EAAM,OAAOH,EAAE,QAAA,CAAS,EAAE,SAAS,EAAG,GAAG,EAC/C,MAAO,GAAGC,CAAI,IAAIC,CAAK,IAAIC,CAAG,EAChC,CAAC,EACK,CAACC,EAAmBC,EAAoB,EAAItC,EAAAA,SAA0B,KAAK,EAGjFuC,EAAAA,UAAU,IAAM,CACd,GAAI,EAAC7C,GAAA,MAAAA,EAAM,KAAK,OAGhB,MAAM8C,EAAW,aAAa9C,EAAK,GAAG,GACtC,GAAI,CACF,MAAM+C,EAAY,aAAa,QAAQD,CAAQ,EAC3CC,IACF1C,EAAS,KAAK,MAAM0C,CAAS,CAAC,EAC9BvC,EAAa,EAAK,EAEtB,OAASwC,EAAG,CACV,QAAQ,KAAK,6CAA8CA,CAAC,CAC9D,CAEA,GAAI,CAACnD,EAAQ,OAEbW,EAAa,EAAI,EACjB,MAAMyC,EAAIC,GACRC,EAAWC,EAAI,WAAW,EAC1BC,GAAM,SAAU,KAAMrD,EAAK,GAAG,CAAA,EAG1BsD,EAAcC,GAAWN,EAAIO,GAAa,CAC9C,MAAMC,EAAOD,EAAS,KACnB,IAAIE,IAAQ,CAAE,GAAIA,EAAI,GAAI,GAAGA,EAAI,MAAK,EAAgB,EACtD,KAAK,CAACC,EAAGC,IAAM,SAEd,MAAMC,IAAQC,EAAAH,EAAE,YAAF,YAAAG,EAAa,UAAW,EAEtC,SADcC,EAAAH,EAAE,YAAF,YAAAG,EAAa,UAAW,GACvBF,CACjB,CAAC,EAEHxD,EAASoD,CAAI,EAEb,GAAI,CACF,aAAa,QAAQX,EAAU,KAAK,UAAUW,CAAI,CAAC,CACrD,MAAY,CAAC,CAEbjD,EAAa,EAAK,CACpB,EAAIwD,GAAU,CACZ,QAAQ,MAAM,6BAA8BA,CAAK,EACjD9D,EAAM,CAAE,MAAO,MAAO,YAAa,oDAAqD,QAAS,cAAe,EAChHM,EAAa,EAAK,CACpB,CAAC,EAED,MAAO,IAAM8C,EAAA,CACf,EAAG,CAACtD,GAAA,YAAAA,EAAM,IAAKH,CAAM,CAAC,EAEtB,MAAMoE,EAAkBC,GAAoB,CACtCA,GACFlD,GAAekD,CAAI,EACnB9C,EAAY,CACV,KAAM8C,EAAK,KACX,UAAWA,EAAK,UAChB,WAAYA,EAAK,WACjB,MAAOA,EAAK,OAAS,GACrB,eAAgBA,EAAK,gBAAkB,GACvC,aAAcA,EAAK,aACnB,gBAAiBA,EAAK,gBACtB,YAAaA,EAAK,aAAe,GACjC,YAAaA,EAAK,YAAY,SAAA,EAC9B,gBAAiBA,EAAK,gBAAgB,SAAA,EACtC,WAAYA,EAAK,YAAc,GAC/B,OAAQA,EAAK,QAAU,GACvB,MAAOA,EAAK,OAAS,EAAA,CACtB,IAEDlD,GAAe,IAAI,EACnBI,EAAY,CACV,KAAM,GACN,UAAW,GACX,WAAY,GACZ,MAAO,GACP,eAAgB,GAChB,aAAc,GACd,gBAAiB,GACjB,YAAa,GACb,YAAa,GACb,gBAAiB,GACjB,WAAY,GACZ,OAAQ,GACR,MAAO,EAAA,CACR,GAEHN,EAAc,EAAI,CACpB,EAEMqD,GAAa,SAAY,CAG7B,GAFA,QAAQ,IAAI,oBAAoB,EAE5B,EAACnE,GAAA,MAAAA,EAAM,KAAK,CACd,MAAMoE,EAAM,oCACZlE,EAAM,CAAE,MAAO,MAAO,YAAakE,EAAK,QAAS,cAAe,EAChE,MAAMA,CAAG,EACT,MACF,CAGA,GAAI,CAACjD,EAAS,KAAK,OAAQ,CACzB,MAAMiD,EAAM,mBACZlE,EAAM,CAAE,MAAO,MAAO,YAAakE,EAAK,QAAS,cAAe,EAChE,MAAMA,CAAG,EACT,MACF,CACA,GAAI,CAACjD,EAAS,WAAW,OAAQ,CAC/B,MAAMiD,EAAM,sBACZlE,EAAM,CAAE,MAAO,MAAO,YAAakE,EAAK,QAAS,cAAe,EAChE,MAAMA,CAAG,EACT,MACF,CAEAlD,GAAgB,EAAI,EAEpB,GAAI,CACF,MAAMmD,EAAW,CACf,KAAMlD,EAAS,KACf,UAAWA,EAAS,WAAa,GACjC,WAAYA,EAAS,WACrB,MAAOA,EAAS,OAAS,GACzB,eAAgBA,EAAS,gBAAkB,GAC3C,aAAcA,EAAS,cAAgB,GACvC,gBAAiBA,EAAS,iBAAmB,GAC7C,YAAaA,EAAS,aAAe,GACrC,YAAa,WAAWA,EAAS,WAAW,GAAK,EACjD,gBAAiB,WAAWA,EAAS,eAAe,GAAK,EACzD,WAAYA,EAAS,YAAc,GACnC,OAAQA,EAAS,QAAU,GAC3B,MAAOA,EAAS,MAChB,OAAQnB,EAAK,IACb,OAAQD,IAAUC,EAAK,IACvB,UAAWsE,EAAA,CAAgB,EAG7B,QAAQ,IAAI,oBAAqBD,CAAQ,EAErCtD,GACF,MAAMwD,EAAUb,EAAIN,EAAI,YAAarC,EAAY,EAAE,EAAGsD,CAAQ,EAC9DnE,EAAM,CAAE,MAAO,aAAc,YAAa,iCAAkC,IAE5E,MAAMsE,GAAOrB,EAAWC,EAAI,WAAW,EAAG,CACxC,GAAGiB,EACH,UAAWC,EAAA,CAAgB,CAC5B,EACDpE,EAAM,CAAE,MAAO,aAAc,YAAa,iCAAkC,GAE9EY,EAAc,EAAK,CACrB,OAASkD,EAAY,CACnB,QAAQ,MAAM,0BAA2BA,CAAK,EAC9C9D,EAAM,CAAE,MAAO,MAAO,YAAa,wBAAwB8D,EAAM,OAAO,GAAI,QAAS,aAAA,CAAe,EACpG,MAAM,wBAAwBA,EAAM,OAAO,EAAE,CAC/C,QAAA,CACE9C,GAAgB,EAAK,CACvB,CACF,EAEMuD,GAAe,MAAOC,GAAe,CACzC,GAAK,QAAQ,mCAAmC,EAChD,GAAI,CACF,MAAMC,GAAUjB,EAAIN,EAAI,YAAasB,CAAE,CAAC,EACxCxE,EAAM,CAAE,MAAO,WAAY,YAAa,wBAAyB,CACnE,OAAS8D,EAAO,CACd,QAAQ,MAAMA,CAAK,EACnB9D,EAAM,CAAE,MAAO,MAAO,YAAa,YAAa,QAAS,cAAe,CAC1E,CACF,EAEM0E,EAAgB,MAAOV,EAAgBW,IAAoB,CAE/DxE,KAAsByE,EAAU,IAAIC,GAAKA,EAAE,KAAOb,EAAK,GAAK,CAAE,GAAGa,EAAG,OAAAF,EAAQ,WAAY,EAAA,EAAUE,CAAC,CAAC,EAEpG,GAAI,CACF,MAAMR,EAAUb,EAAIN,EAAI,YAAac,EAAK,EAAE,EAAG,CAC7C,OAAAW,EACA,WAAY,GACZ,UAAWP,EAAA,CAAgB,CAC5B,EAEGO,GAEF,MAAML,GAAOrB,EAAWC,EAAI,cAAc,EAAG,CAC3C,OAAQc,EAAK,GACb,SAAUA,EAAK,KACf,OAAQA,EAAK,YACb,OAAQlE,GAAA,YAAAA,EAAM,IACd,UAAWsE,EAAA,EACX,KAAM,SAAA,CACP,EAGHpE,EAAM,CAAE,MAAO,aAAc,YAAa2E,EAAS,2CAA6C,+BAAgC,CAClI,OAASb,EAAO,CAEd3D,KAAsByE,EAAU,OAAS,EAAE,KAAOZ,EAAK,GAAK,CAAE,GAAG,EAAG,OAAQ,CAACW,EAAQ,WAAYX,EAAK,YAAe,CAAC,CAAC,EACvH,QAAQ,MAAMF,CAAK,EACnB9D,EAAM,CAAE,MAAO,MAAO,YAAa,6BAA8B,QAAS,cAAe,CAC3F,CACF,EAEM8E,GAAsBd,GAAmB,OAC7C1C,GAAgB0C,CAAI,EACpBxC,GAAgBwC,EAAK,MAAQ,EAAE,EAC/BtC,KAAkBkC,EAAAI,EAAK,cAAL,YAAAJ,EAAkB,aAAc,EAAE,EACpDxC,EAAwB,EAAI,CAC9B,EAEM2D,GAAwB,SAAY,CACxC,GAAI,EAACjF,GAAA,MAAAA,EAAM,MAAO,CAACuB,EAAc,OAEjC,GAAI,CAACE,EAAa,OAAQ,CACxBvB,EAAM,CAAE,MAAO,MAAO,YAAa,wBAAyB,QAAS,cAAe,EACpF,MACF,CACA,MAAMgF,EAAS,WAAWvD,EAAc,EACxC,GAAI,MAAMuD,CAAM,GAAKA,GAAU,EAAG,CAChChF,EAAM,CAAE,MAAO,MAAO,YAAa,uBAAwB,QAAS,cAAe,EACnF,MACF,CAEA,GAAI,CACF,MAAMiF,EAAUzB,EAAIN,EAAI,QAASpD,EAAK,GAAG,EAEnCoF,GADW,MAAMC,GAAOF,CAAO,GACX,KAAA,EACpBG,EAAe,MAAM,QAAQF,GAAA,YAAAA,EAAU,KAAK,EAAIA,EAAS,MAAQ,CAAA,EAEjEG,EAAU,CACd,GAAI,QAAQ,KAAK,IAAA,CAAK,GACtB,WAAY9D,EACZ,OAAQF,EAAa,WACrB,OAAA2D,EACA,OAAQ,sBACR,OAAQ,UACR,cAAe,KACf,WAAY,EACZ,gBAAiB,CAAA,CAAC,EAGpB,MAAMX,EAAUY,EAAS,CACvB,MAAO,CAACI,EAAS,GAAGD,CAAY,CAAA,CACjC,EAGDjF,EAASyE,GAAaA,EAAU,IAAIC,GAAKA,EAAE,KAAOxD,EAAa,GAAK,CAAE,GAAGwD,EAAG,OAAQ,GAAO,WAAY,GAAM,OAAQQ,EAAQ,IAAOR,CAAC,CAAC,EAEtI,MAAMR,EAAUb,EAAIN,EAAI,YAAa7B,EAAa,EAAE,EAAG,CACrD,OAAQ,GACR,WAAY,GACZ,OAAQgE,EAAQ,GAChB,UAAWjB,EAAA,CAAgB,CAC5B,EAEDpE,EAAM,CAAE,MAAO,aAAc,YAAa,iCAAkC,EAC5EoB,EAAwB,EAAK,CAC/B,OAAS0C,EAAO,CACd,QAAQ,MAAMA,CAAK,EACnB9D,EAAM,CAAE,MAAO,MAAO,YAAa,0BAA2B,QAAS,cAAe,CACxF,CACF,EAGA2C,EAAAA,UAAU,IAAM,CACd,GAAI,EAAC7C,GAAA,MAAAA,EAAM,KAAK,OAEhB,MAAMmF,EAAUzB,EAAIN,EAAI,QAASpD,EAAK,GAAG,EACnCsD,EAAcC,GAAW4B,EAAS,MAAOK,GAAY,CACzD,GAAIA,EAAQ,SAAU,CAEpB,MAAMC,EADWD,EAAQ,KAAA,EACF,OAAS,CAAA,EAG1BE,EAAgBtF,EAAM,OAAO2E,GAAKA,EAAE,YAAc,CAACA,EAAE,MAAM,EAEjE,UAAWb,KAAQwB,EAAe,CAChC,IAAIC,EAAe,GAGnB,GAAIzB,EAAK,OAAQ,CACf,MAAM0B,EAAOH,EAAM,KAAMlD,GAAWA,EAAE,KAAO2B,EAAK,MAAM,EACpD0B,GAAQA,EAAK,SAAW,SAC1BD,EAAe,GAEnB,MAGoBF,EAAM,KAAMlD,GAC5BA,EAAE,SAAW,QACbA,EAAE,SAAW,wBAEVA,EAAE,QAAUA,EAAE,SAAW2B,EAAK,YAE9B,CAAC3B,EAAE,QAAUA,EAAE,aAAe2B,EAAK,MAAQ,KAAK,IAAI3B,EAAE,OAAS2B,EAAK,WAAW,EAAI,GAAA,IAItFyB,EAAe,IAIfA,GAEF,MAAMf,EAAcV,EAAM,EAAI,CAElC,CACF,CACF,CAAC,EAED,MAAO,IAAMZ,EAAA,CACf,EAAG,CAACtD,GAAA,YAAAA,EAAM,IAAKI,CAAK,CAAC,EAErB,MAAMyF,GAAgBzF,EAAM,OAAO2E,GAAK,CACtC,MAAMe,EAAgBf,EAAE,KAAK,cAAc,SAAStE,EAAW,YAAA,CAAa,GAC1EsE,EAAE,WAAW,SAAStE,CAAU,GAChCsE,EAAE,UAAU,SAAStE,CAAU,EAE3BsF,EACJpF,IAAiB,MAAQ,GACzBA,IAAiB,OAASoE,EAAE,OAC5BpE,IAAiB,SAAY,CAACoE,EAAE,QAAU,CAACA,EAAE,WAC7CpE,IAAiB,WAAaoE,EAAE,WAAa,GAE/C,OAAOe,GAAiBC,CAC1B,CAAC,EAEKC,GAAY5F,EAAM,OAAO2E,GAAKA,EAAE,MAAM,EAAE,OACxCkB,GAAc7F,EAAM,OAAO2E,GAAK,CAACA,EAAE,QAAU,CAACA,EAAE,UAAU,EAAE,OAC5DmB,GAAgB9F,EAAM,OAAO2E,GAAKA,EAAE,UAAU,EAAE,OAEhDoB,GAAuB,SAAY,CACvCrE,EAAsB,EAAI,CAC5B,EAEMsE,GAAkB,SAAY,CAClC,GAAKpG,GAAA,MAAAA,EAAM,IAEX,GAAI,CACF,MAAMqG,EAAQC,GAAWlD,CAAE,EAE3BhD,EAAM,QAAQ8D,GAAQ,CACpB,GAAIA,EAAK,OAAQ,CACf,MAAMqC,EAAU7C,EAAIN,EAAI,YAAac,EAAK,EAAE,EAC5CmC,EAAM,OAAOE,EAAS,CACpB,OAAQ,GACR,UAAWjC,EAAA,CAAgB,CAC5B,CACH,CACF,CAAC,EAED,MAAM+B,EAAM,OAAA,EAGZhG,EAASyE,GAAaA,EAAU,IAAIC,IAAM,CAAE,GAAGA,EAAG,OAAQ,EAAA,EAAQ,CAAC,EAEnE7E,EAAM,CAAE,MAAO,aAAc,YAAa,+CAAgD,EAC1F4B,EAAsB,EAAK,CAC7B,OAASkC,EAAO,CACd,QAAQ,MAAM,yBAA0BA,CAAK,EAC7C9D,EAAM,CAAE,MAAO,MAAO,YAAa,iCAAkC,QAAS,cAAe,EAC7F4B,EAAsB,EAAK,CAC7B,CACF,EAEM0E,GAAsB,MAAOC,GAAsB,CACvD,GAAK,QAAQ;AAAA,kCAAqE,EAClF,GAAI,CACF,MAAM9B,GAAUjB,EAAIN,EAAI,eAAgBqD,CAAS,CAAC,EAClDvG,EAAM,CAAE,MAAO,WAAY,YAAa,uBAAwB,CAClE,OAAS8D,EAAO,CACd,QAAQ,MAAMA,CAAK,EACnB9D,EAAM,CAAE,MAAO,MAAO,YAAa,kBAAmB,QAAS,cAAe,CAChF,CACF,EAGA2C,EAAAA,UAAU,IAAM,CACd,GAAI,CAACd,GAAkB,EAAC/B,GAAA,MAAAA,EAAM,KAAK,OAEnC,MAAMiD,EAAIC,GACRC,EAAWC,EAAI,cAAc,EAC7BC,GAAM,SAAU,KAAMrD,EAAK,GAAG,CAAA,EAG1BsD,EAAcC,GAAWN,EAAIO,GAAa,CAC9C,MAAMC,EAAOD,EAAS,KAAK,IAAIE,IAAQ,CAAE,GAAIA,EAAI,GAAI,GAAGA,EAAI,KAAA,GAA2B,EAEvFD,EAAK,KAAK,CAACE,EAAGC,IAAM,SAClB,MAAMC,IAAQC,EAAAH,EAAE,YAAF,YAAAG,EAAa,UAAW,KAAK,MAAM,KAAK,IAAA,EAAQ,GAAI,EAElE,SADcC,EAAAH,EAAE,YAAF,YAAAG,EAAa,UAAW,KAAK,MAAM,KAAK,IAAA,EAAQ,GAAI,GACnDF,CACjB,CAAC,EACD3B,GAAeuB,CAAI,CACrB,EAAIO,GAAU,CACZ,QAAQ,MAAM,2BAA4BA,CAAK,EAC/C9D,EAAM,CAAE,MAAO,MAAO,YAAa,kBAAmB,QAAS,cAAe,CAChF,CAAC,EAED,MAAO,IAAMoD,EAAA,CACf,EAAG,CAACvB,EAAgB/B,GAAA,YAAAA,EAAM,GAAG,CAAC,EAG9B,MAAM0G,EAAWzE,GAAY,OAAO0E,GAAQ,OAE1C,GAAIxE,EAAkB,OAAQ,CAC5B,MAAMyE,EAAOzE,EAAkB,YAAA,EACzB+B,EAAO9D,EAAM,SAAU2E,GAAE,KAAO4B,EAAK,MAAM,EAC3CE,GAAYF,EAAK,SAAS,YAAA,EAAc,SAASC,CAAI,EACrDE,GAAc5C,EAAQA,EAAK,WAAW,SAAS0C,CAAI,GAAK1C,EAAK,UAAU,SAAS0C,CAAI,EAAK,GAC/F,OAAOC,IAAaC,EACtB,CAIA,MAAMC,GAAYjD,EAAA6C,EAAK,YAAL,MAAA7C,EAAgB,QAAU6C,EAAK,UAAU,QAAU,IAAO,KAAK,IAAA,EAC3EK,EAAW,IAAI,KAAKD,CAAS,EAG7B,CAACE,EAAGC,EAAG3E,CAAC,EAAIF,EAAkB,MAAM,GAAG,EAAE,IAAI,MAAM,EACnD8E,EAAQ,IAAI,KAAKF,EAAGC,EAAI,EAAG3E,CAAC,EAC5B6E,EAAM,IAAI,KAAKH,EAAGC,EAAI,EAAG3E,CAAC,EAEhC,OAAII,IAAsB,OACxBwE,EAAM,SAAS,EAAG,EAAG,EAAG,CAAC,EACzBC,EAAI,SAAS,GAAI,GAAI,GAAI,GAAG,IAE5BD,EAAM,QAAQ,CAAC,EACfA,EAAM,SAAS,EAAG,EAAG,EAAG,CAAC,EACzBC,EAAI,SAASA,EAAI,SAAA,EAAa,CAAC,EAC/BA,EAAI,QAAQ,CAAC,EACbA,EAAI,SAAS,GAAI,GAAI,GAAI,GAAG,GAGvBJ,GAAYG,GAASH,GAAYI,CAC1C,CAAC,EAED,OACEC,EAAAA,KAAAC,WAAA,CACE,SAAA,CAAAC,EAAAA,IAACC,EAAA,CAAO,KAAM3H,EAAQ,aAAe4H,GAAS,CAACA,GAAQ3H,GAAA,EACrD,SAAAuH,OAACK,EAAA,CAAc,UAAU,2GAEvB,SAAA,CAAAL,EAAAA,KAAC,MAAA,CAAI,UAAU,2EACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAE,EAAAA,IAAC,OAAI,UAAU,mEACb,eAACI,GAAA,CAAK,UAAU,UAAU,CAAA,CAC5B,EACAN,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAE,EAAAA,IAACK,EAAA,CAAY,UAAU,sBAAsB,SAAA,aAAU,EACvDL,EAAAA,IAACM,EAAA,CAAkB,UAAU,UAAU,SAAA,2BAAA,CAAyB,CAAA,CAAA,CAClE,CAAA,EACF,QACCC,EAAA,CAAO,QAAS,IAAMhI,KAAW,QAAQ,QAAQ,KAAK,OAAO,UAAU,UACtE,SAAAyH,EAAAA,IAACQ,GAAA,CAAE,UAAU,UAAU,CAAA,CACzB,CAAA,EACF,EAGAV,EAAAA,KAAC,MAAA,CAAI,UAAU,wEAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CACC,QAAS,IAAMzG,EAAgBD,IAAiB,OAAS,MAAQ,MAAM,EACvE,UAAW,+HACTA,IAAiB,OACb,8FACA,uFACN,GAEA,SAAA,CAAA4G,EAAAA,IAAC,MAAA,CAAI,UAAW,oBAAoB5G,IAAiB,OAAS,eAAiB,cAAc,kBAC3F,SAAA4G,MAACS,EAAA,CAAS,UAAU,aAAA,CAAc,EACpC,EACAX,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAE,EAAAA,IAAC,MAAA,CAAI,UAAU,yDAAyD,SAAA,WAAQ,EAChFA,EAAAA,IAAC,MAAA,CAAI,UAAU,mCAAoC,SAAAvB,EAAA,CAAU,CAAA,CAAA,CAC/D,CAAA,CAAA,CAAA,EAIFqB,EAAAA,KAAC,MAAA,CACC,QAAS,IAAMzG,EAAgBD,IAAiB,SAAW,MAAQ,QAAQ,EAC3E,UAAW,+HACTA,IAAiB,SACb,wFACA,qFACN,GAEA,SAAA,CAAA4G,EAAAA,IAAC,MAAA,CAAI,UAAW,oBAAoB5G,IAAiB,SAAW,aAAe,YAAY,gBACzF,SAAA4G,MAACU,GAAA,CAAM,UAAU,aAAA,CAAc,EACjC,EACAZ,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAE,EAAAA,IAAC,MAAA,CAAI,UAAU,yDAAyD,SAAA,eAAY,EACpFA,EAAAA,IAAC,MAAA,CAAI,UAAU,iCAAkC,SAAAtB,EAAA,CAAY,CAAA,CAAA,CAC/D,CAAA,CAAA,CAAA,EAIFoB,EAAAA,KAAC,MAAA,CACC,QAAS,IAAMzG,EAAgBD,IAAiB,WAAa,MAAQ,UAAU,EAC/E,UAAW,+HACTA,IAAiB,WACb,iGACA,wFACN,GAEA,SAAA,CAAA4G,EAAAA,IAAC,MAAA,CAAI,UAAW,oBAAoB5G,IAAiB,WAAa,gBAAkB,eAAe,mBACjG,SAAA4G,MAACU,GAAA,CAAM,UAAU,aAAA,CAAc,EACjC,EACAZ,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAE,EAAAA,IAAC,MAAA,CAAI,UAAU,yDAAyD,SAAA,cAAW,EACnFA,EAAAA,IAAC,MAAA,CAAI,UAAU,oCAAqC,SAAArB,EAAA,CAAc,CAAA,CAAA,CACpE,CAAA,CAAA,CAAA,CACF,EACF,EAGAmB,EAAAA,KAAC,MAAA,CAAI,UAAU,sGACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAE,EAAAA,IAACW,GAAA,CAAO,UAAU,iEAAA,CAAkE,EACpFX,EAAAA,IAACY,EAAA,CACC,YAAY,yBACZ,MAAO1H,EACP,SAAWuC,GAAMtC,GAAcsC,EAAE,OAAO,KAAK,EAC7C,UAAU,MAAA,CAAA,CACZ,EACF,EACAqE,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAA,EAAAA,KAACS,EAAA,CAAO,QAAS,IAAM9F,GAAkB,EAAI,EAAG,QAAQ,UAAU,UAAU,4BACzE,SAAA,CAAAuF,EAAAA,IAACS,EAAA,CAAS,UAAU,SAAA,CAAU,EAAE,YAAA,EAEnC,SACCF,EAAA,CAAO,QAAS,IAAM7D,EAAA,EAAkB,UAAU,qEACjD,SAAA,CAAAsD,EAAAA,IAACa,GAAA,CAAK,UAAU,SAAA,CAAU,EAAE,mBAAA,EAE9B,EACAf,EAAAA,KAACS,EAAA,CACC,QAAS3B,GACT,QAAQ,cACR,UAAU,4BAEV,SAAA,CAAAoB,EAAAA,IAACU,GAAA,CAAM,UAAU,SAAA,CAAU,EAAE,uBAAA,CAAA,CAAA,CAE/B,CAAA,CACF,CAAA,EACF,EAGAV,EAAAA,IAAC,OAAI,UAAU,2BACZ,YACCA,EAAAA,IAAC,MAAA,CAAI,UAAU,wCACb,SAAAA,EAAAA,IAAC,OAAI,UAAU,8DAAA,CAA+D,EAChF,EACE1B,GAAc,SAAW,EAC3BwB,EAAAA,KAAC,MAAA,CAAI,UAAU,+DACb,SAAA,CAAAE,EAAAA,IAACI,GAAA,CAAK,UAAU,2BAAA,CAA4B,EAC5CJ,EAAAA,IAAC,KAAE,SAAA,wBAAA,CAAsB,EACzBA,EAAAA,IAACO,EAAA,CAAO,QAAQ,OAAO,QAAS,IAAM7D,EAAA,EAAkB,UAAU,gBAAgB,SAAA,kBAAA,CAElF,CAAA,CAAA,CACF,QAEC,MAAA,CAAI,UAAU,sBACZ,SAAA4B,GAAc,IAAI3B,GACjBqD,EAAAA,IAAC,MAAA,CAAkB,UAAW,qEAC5BrD,EAAK,WACD,8EACAA,EAAK,OACH,0EACA,iEACR,GACE,SAAAmD,EAAAA,KAAC,MAAA,CAAI,UAAU,+CAGb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,4DACb,SAAA,CAAAE,MAAC,MAAA,CAAI,UAAW,6EACdrD,EAAK,WACD,wEACAA,EAAK,OACH,oEACA,2DACR,GACG,SAAAA,EAAK,KAAK,OAAO,CAAC,EACrB,SACC,MAAA,CACC,SAAA,CAAAqD,EAAAA,IAAC,KAAA,CAAG,UAAU,qDAAsD,SAAArD,EAAK,KAAK,EAC9EmD,EAAAA,KAAC,MAAA,CAAI,UAAU,gDACb,SAAA,CAAAE,EAAAA,IAACc,GAAA,CAAM,UAAU,SAAA,CAAU,EAC3Bd,EAAAA,IAAC,OAAA,CAAK,IAAI,MAAO,WAAK,UAAA,CAAW,CAAA,CAAA,CACnC,CAAA,CAAA,CACF,CAAA,EACF,EAGAF,EAAAA,KAAC,MAAA,CAAI,UAAU,uFACZ,SAAA,CAAAnD,EAAK,YACJmD,OAAC,MAAA,CAAI,UAAU,gBACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,oDAAoD,SAAA,CAAAE,EAAAA,IAACe,GAAA,CAAK,UAAU,SAAA,CAAU,EAAE,SAAA,EAAO,EACvGf,EAAAA,IAAC,OAAA,CAAK,UAAU,iCAAkC,WAAK,UAAA,CAAW,CAAA,EACpE,EAEFF,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,oDAAoD,SAAA,CAAAE,EAAAA,IAACgB,GAAA,CAAK,UAAU,SAAA,CAAU,EAAE,eAAA,EAAa,QAC5G,OAAA,CAAK,UAAU,wBAAyB,SAAArE,EAAK,WAAa,GAAA,CAAI,CAAA,EACjE,EACCA,EAAK,OACJmD,OAAC,MAAA,CAAI,UAAU,gBACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,oDAAoD,SAAA,CAAAE,EAAAA,IAACe,GAAA,CAAK,UAAU,SAAA,CAAU,EAAE,SAAA,EAAO,EACvGf,EAAAA,IAAC,OAAA,CAAK,UAAU,cAAe,WAAK,KAAA,CAAM,CAAA,EAC5C,EAEFF,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,oDAAoD,SAAA,CAAAE,EAAAA,IAACI,GAAA,CAAK,UAAU,SAAA,CAAU,EAAE,aAAA,EAAW,QAC1G,OAAA,CAAK,UAAU,cAAe,SAAAzD,EAAK,aAAe,GAAA,CAAI,CAAA,EACzD,EACAmD,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,oDAAoD,SAAA,CAAAE,EAAAA,IAACS,EAAA,CAAS,UAAU,SAAA,CAAU,EAAE,aAAA,EAAW,QAC9G,OAAA,CAAK,UAAU,0BAA2B,SAAAQ,GAAYtE,EAAK,WAAW,CAAA,CAAE,CAAA,CAAA,CAC3E,CAAA,EACF,EAGAmD,EAAAA,KAAC,MAAA,CAAI,UAAU,gEACX,SAAA,CAAAnD,EAAK,gBACHqD,EAAAA,IAACO,EAAA,CACC,QAAQ,QACR,KAAK,OACL,UAAU,2CACV,QAAS,IAAM,CACb,MAAMW,EAAU,UAAUvE,EAAK,IAAI;AAAA;AAAA,kBAAwEA,EAAK,WAAW;AAAA,WACrHwE,EAAM,kBAAkBxE,EAAK,cAAc,SAAS,mBAAmBuE,CAAO,CAAC,GACrF,OAAO,KAAKC,EAAK,QAAQ,CAC3B,EACA,MAAM,qBAEN,SAAAnB,EAAAA,IAACoB,GAAA,CAAc,UAAU,SAAA,CAAU,CAAA,CAAA,EAIxCtB,EAAAA,KAAC,MAAA,CAAI,UAAU,kDACZ,SAAA,CAAAE,EAAAA,IAACO,EAAA,CACC,KAAK,KACL,UAAW,8BACT5D,EAAK,OACD,6CACA,mEACN,GACA,QAAS,IAAMU,EAAcV,EAAM,EAAI,EACxC,SAAA,OAAA,CAAA,EAGDqD,EAAAA,IAACO,EAAA,CACC,KAAK,KACL,QAAQ,cACR,UAAW,8BACT,CAAC5D,EAAK,QAAU,CAACA,EAAK,WAClB,yCACA,6DACN,GACA,QAAS,IAAMU,EAAcV,EAAM,EAAK,EACzC,SAAA,KAAA,CAAA,EAGDqD,EAAAA,IAACO,EAAA,CACC,KAAK,KACL,QAAQ,UACR,UAAW,8BACT5D,EAAK,WACD,+CACA,sDACN,GACA,QAAS,IAAMc,GAAmBd,CAAI,EACvC,SAAA,KAAA,CAAA,CAED,EACH,EAEAmD,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAE,MAACO,GAAO,QAAQ,QAAQ,KAAK,OAAO,UAAU,yCAAyC,QAAS,IAAM7D,EAAeC,CAAI,EACvH,SAAAqD,EAAAA,IAACqB,GAAA,CAAM,UAAU,UAAU,EAC7B,QACCd,EAAA,CAAO,QAAQ,QAAQ,KAAK,OAAO,UAAU,uCAAuC,QAAS,IAAMrD,GAAaP,EAAK,EAAE,EACtH,eAAC2E,GAAA,CAAO,UAAU,UAAU,CAAA,CAC9B,CAAA,CAAA,CACF,CAAA,CAAA,CACH,CAAA,CAAA,CAEF,CAAA,EA3HQ3E,EAAK,EA4Hf,CACD,EACH,CAAA,CAEJ,CAAA,CAAA,CACF,CAAA,CACF,EAGAqD,EAAAA,IAACC,GAAO,KAAMzF,EAAgB,aAAcC,GAC1C,SAAAqF,EAAAA,KAACK,EAAA,CAAc,UAAU,uCACvB,SAAA,CAAAL,EAAAA,KAACyB,EAAA,CAAa,UAAU,eACtB,SAAA,CAAAvB,EAAAA,IAACK,GAAY,SAAA,eAAA,CAAa,EAC1BL,EAAAA,IAACM,GAAkB,SAAA,gCAAA,CAEnB,CAAA,EACF,EAEAR,EAAAA,KAAC,MAAA,CAAI,UAAU,8CAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,kBACb,SAAA,CAAAE,EAAAA,IAACW,GAAA,CAAO,UAAU,iEAAA,CAAkE,EACpFX,EAAAA,IAACY,EAAA,CACC,YAAY,kCACZ,MAAOhG,EACP,SAAWa,GAAMZ,GAAqBY,EAAE,OAAO,KAAK,EACpD,UAAU,eAAA,CAAA,CACZ,EACF,EAEAqE,EAAAA,KAAC,MAAA,CAAI,UAAU,mDACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,mBACb,SAAA,CAAAE,EAAAA,IAACwB,GAAM,SAAA,WAAA,CAAS,EAChB1B,EAAAA,KAAC,MAAA,CAAI,UAAU,sCACb,SAAA,CAAAE,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM3E,GAAqB,KAAK,EACzC,UAAW,2DACTD,IAAsB,MAAQ,wCAA0C,gCAC1E,GACD,SAAA,MAAA,CAAA,EAGD4E,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM3E,GAAqB,OAAO,EAC3C,UAAW,2DACTD,IAAsB,QAAU,wCAA0C,gCAC5E,GACD,SAAA,MAAA,CAAA,CAED,CAAA,CACF,CAAA,EACF,EAEA0E,EAAAA,KAAC,MAAA,CAAI,UAAU,mBACb,SAAA,CAAAE,EAAAA,IAACwB,EAAA,CAAO,SAAApG,IAAsB,MAAQ,aAAe,aAAa,EAClE4E,EAAAA,IAACY,EAAA,CACC,KAAMxF,IAAsB,MAAQ,OAAS,QAC7C,MAAOA,IAAsB,MAAQN,EAAoBA,EAAkB,UAAU,EAAG,CAAC,EACzF,SAAWW,GAAMV,GAAqBU,EAAE,OAAO,KAAK,EACpD,UAAU,UAAA,CAAA,CACZ,EACF,EAEAqE,EAAAA,KAAC,MAAA,CAAI,UAAU,YACZ,SAAA,CAAAE,EAAAA,IAAC,MAAA,CAAI,UAAU,yCAAyC,SAAA,gBAAa,QACpE,MAAA,CAAI,UAAU,mCACZ,SAAAiB,GAAY9B,EAAS,OAAO,CAACsC,EAAKC,IAAMD,GAAOC,EAAE,QAAU,GAAI,CAAC,CAAC,CAAA,CACpE,CAAA,CAAA,CACH,CAAA,CAAA,CACF,CAAA,EACF,EAEA1B,EAAAA,IAAC,MAAA,CAAI,UAAU,sCACZ,SAAAb,EAAS,SAAW,EAClBW,EAAAA,KAAC,MAAA,CAAI,UAAU,+DACb,SAAA,CAAAE,EAAAA,IAACS,EAAA,CAAS,UAAU,2BAAA,CAA4B,EAChDT,EAAAA,IAAC,KAAE,SAAA,mCAAA,CAAiC,CAAA,CAAA,CACtC,SAEA2B,GAAA,CACG,SAAA,CAAA3B,MAAC4B,GAAA,CAAY,UAAU,uCACrB,SAAA9B,EAAAA,KAAC+B,GAAA,CACC,SAAA,CAAA7B,EAAAA,IAAC8B,EAAA,CAAU,UAAU,aAAa,SAAA,UAAO,EACzC9B,EAAAA,IAAC8B,EAAA,CAAU,UAAU,aAAa,SAAA,eAAY,EAC9C9B,EAAAA,IAAC8B,EAAA,CAAU,UAAU,aAAa,SAAA,SAAM,EACxC9B,EAAAA,IAAC8B,EAAA,CAAU,UAAU,UAAA,CAAW,CAAA,CAAA,CAClC,CAAA,CACF,QACCC,GAAA,CACE,SAAA5C,EAAS,IAAK6C,wBACZH,GAAA,CACC,SAAA,CAAA7B,MAACiC,GAAU,UAAU,kCAClB,UAAA1F,EAAAyF,EAAQ,YAAR,MAAAzF,EAAmB,QAChB,IAAI,KAAKyF,EAAQ,UAAU,QAAU,GAAI,EAAE,eAAe,OAAO,EACjE,OACN,EACAhC,EAAAA,IAACiC,EAAA,CAAU,UAAU,cAAe,WAAQ,SAAS,QACpDA,EAAA,CAAU,UAAU,2BAA4B,SAAAhB,GAAYe,EAAQ,MAAM,EAAE,EAC7EhC,EAAAA,IAACiC,GACC,SAAAjC,EAAAA,IAACO,EAAA,CAAO,QAAQ,QAAQ,KAAK,OAAO,UAAU,uCAAuC,QAAS,IAAMtB,GAAoB+C,EAAQ,EAAE,EAChI,eAACV,GAAA,CAAO,UAAU,SAAA,CAAU,CAAA,CAC9B,CAAA,CACF,CAAA,GAZaU,EAAQ,EAavB,EACD,CAAA,CACH,CAAA,CAAA,CACF,CAAA,CAEN,CAAA,CAAA,CACF,CAAA,CACF,EAEAhC,EAAAA,IAACC,GAAO,KAAM3F,GAAoB,aAAcC,EAC9C,SAAAuF,EAAAA,KAACK,EAAA,CAAc,UAAU,WACvB,SAAA,CAAAL,OAACyB,EAAA,CACC,SAAA,CAAAvB,EAAAA,IAACK,GAAY,SAAA,eAAA,CAAa,SACzBC,EAAA,CAAkB,SAAA,CAAA,+DAEhB,KAAA,EAAG,EAAE,iDAAA,CAAA,CAER,CAAA,EACF,EACAR,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAE,EAAAA,IAACO,EAAA,CAAO,QAAQ,UAAU,QAAS,IAAMhG,EAAsB,EAAK,EAAG,SAAA,OAAA,CAEvE,QACCgG,EAAA,CAAO,QAAQ,cAAc,QAAS1B,GAAiB,SAAA,iBAAA,CAExD,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,EAEAmB,EAAAA,IAACC,GAAO,KAAM3G,GAAY,aAAcC,EACtC,SAAAuG,EAAAA,KAACK,EAAA,CAAc,UAAU,WACvB,SAAA,CAAAH,EAAAA,IAACuB,GACC,SAAAvB,EAAAA,IAACK,EAAA,CAAa,SAAA7G,EAAc,wBAA0B,oBAAoB,CAAA,CAC5E,EACAsG,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAE,EAAAA,IAACwB,GAAM,SAAA,OAAA,CAAK,EACZxB,EAAAA,IAACY,EAAA,CACC,MAAOhH,EAAS,KAChB,SAAW6B,GAAM5B,EAAY,CAAC,GAAGD,EAAU,KAAM6B,EAAE,OAAO,MAAM,EAChE,YAAY,yBAAA,CAAA,CACd,EACF,EAEAqE,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACZ,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,YACd,SAAA,CAAAE,EAAAA,IAACwB,GAAM,SAAA,cAAA,CAAY,EACnBxB,EAAAA,IAACY,EAAA,CACC,MAAOhH,EAAS,UAChB,SAAW6B,GAAM5B,EAAY,CAAC,GAAGD,EAAU,UAAW6B,EAAE,OAAO,MAAM,EACrE,YAAY,iBAAA,CAAA,CACd,EACF,EACAqE,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAE,EAAAA,IAACwB,GAAM,SAAA,UAAA,CAAQ,EACfxB,EAAAA,IAACY,EAAA,CACC,MAAOhH,EAAS,WAChB,SAAW6B,GAAM5B,EAAY,CAAC,GAAGD,EAAU,WAAY6B,EAAE,OAAO,MAAM,EACtE,YAAY,YACZ,IAAI,KAAA,CAAA,CACN,CAAA,CACF,CAAA,EACF,EAEAqE,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAE,EAAAA,IAACwB,GAAM,SAAA,QAAA,CAAM,EACbxB,EAAAA,IAACY,EAAA,CACC,MAAOhH,EAAS,MAChB,SAAW6B,GAAM5B,EAAY,CAAC,GAAGD,EAAU,MAAO6B,EAAE,OAAO,MAAM,EACjE,YAAY,eAAA,CAAA,CACd,EACF,EAECqE,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACd,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAE,EAAAA,IAACwB,GAAM,SAAA,YAAA,CAAU,EACjBxB,EAAAA,IAACY,EAAA,CACC,MAAOhH,EAAS,YAChB,SAAW6B,GAAM5B,EAAY,CAAC,GAAGD,EAAU,YAAa6B,EAAE,OAAO,MAAM,EACvE,YAAY,gBAAA,CAAA,CACd,EACF,EACAqE,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAE,EAAAA,IAACwB,GAAM,SAAA,YAAA,CAAU,EACjBxB,EAAAA,IAACY,EAAA,CACC,KAAK,SACL,MAAOhH,EAAS,YAChB,SAAW6B,GAAM5B,EAAY,CAAC,GAAGD,EAAU,YAAa6B,EAAE,OAAO,MAAM,EACvE,YAAY,MAAA,CAAA,CACd,CAAA,CACF,CAAA,EACF,EAEAqE,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAE,EAAAA,IAACwB,GAAM,SAAA,WAAA,CAAS,EAChBxB,EAAAA,IAACY,EAAA,CACC,MAAOhH,EAAS,eAChB,SAAW6B,GAAM5B,EAAY,CAAC,GAAGD,EAAU,eAAgB6B,EAAE,OAAO,MAAM,EAC1E,YAAY,cACZ,IAAI,KAAA,CAAA,CACN,EACF,EAEAqE,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAE,EAAAA,IAACwB,GAAM,SAAA,mBAAA,CAAiB,EACxBxB,EAAAA,IAACkC,GAAA,CACC,MAAOtI,EAAS,MAChB,SAAW6B,GAAM5B,EAAY,CAAC,GAAGD,EAAU,MAAO6B,EAAE,OAAO,MAAM,EACjE,YAAY,uBACZ,UAAU,aAAA,CAAA,CACZ,EACF,EAEAqE,EAAAA,KAAC,MAAA,CAAI,UAAU,kBACb,SAAA,CAAAE,EAAAA,IAACO,EAAA,CAAO,UAAU,kDAAkD,QAAS3D,GAAY,SAAUlD,EAChG,WACCoG,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,gEAAA,CAAiE,EAAM,eAAA,CAAA,CAExF,EAEAF,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAC,EAAAA,IAACmC,GAAA,CAAK,UAAU,cAAA,CAAe,EAAE,KAAA,CAAA,CAEnC,CAAA,CAEJ,EACAnC,EAAAA,IAACO,EAAA,CAAO,QAAQ,UAAU,QAAS,IAAMhH,EAAc,EAAK,EAAG,SAAUG,EAAc,SAAA,OAAA,CAAK,CAAA,CAAA,CAC9F,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,EAGAsG,EAAAA,IAACC,GAAO,KAAMnG,GAAsB,aAAcC,EAChD,SAAA+F,EAAAA,KAACK,EAAA,CAAc,UAAU,WACvB,SAAA,CAAAL,OAACyB,EAAA,CACC,SAAA,CAAAvB,EAAAA,IAACK,GAAY,SAAA,kBAAA,CAAgB,EAC7BL,EAAAA,IAACM,GAAkB,SAAA,mCAAA,CAAiC,CAAA,EACtD,EACAR,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAE,EAAAA,IAACwB,GAAM,SAAA,YAAA,CAAU,EACjBxB,EAAAA,IAACY,EAAA,CACC,MAAO1G,EACP,SAAWuB,GAAMtB,GAAgBsB,EAAE,OAAO,KAAK,EAC/C,YAAY,eAAA,CAAA,CACd,EACF,EACAqE,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAE,EAAAA,IAACwB,GAAM,SAAA,QAAA,CAAM,EACbxB,EAAAA,IAACY,EAAA,CACC,KAAK,SACL,MAAOxG,GACP,SAAWqB,GAAMpB,GAAkBoB,EAAE,OAAO,KAAK,EACjD,YAAY,MAAA,CAAA,CACd,EACF,EACAqE,EAAAA,KAAC,MAAA,CAAI,UAAU,kBACb,SAAA,CAAAE,MAACO,EAAA,CAAO,UAAU,sDAAsD,QAAS7C,GAAuB,SAAA,cAExG,EACAsC,EAAAA,IAACO,GAAO,QAAQ,UAAU,QAAS,IAAMxG,EAAwB,EAAK,EAAG,SAAA,OAAA,CAAK,CAAA,CAAA,CAChF,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,CAAA,EACF,CAEJ"}