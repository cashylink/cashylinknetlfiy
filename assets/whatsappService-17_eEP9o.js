import{R as d,f as m,x as p,i as g,O as E,J as N}from"./index-B6qHa3zL.js";const a={phoneNumber:"201000392539",defaultMessage:"مرحباً، أريد الاستفسار عن خدماتكم",isEnabled:!0,lastUpdated:new Date},h="whatsapp-settings",f="app-settings",l="whatsapp_settings_cache",i=async()=>{var s;try{if(!m.currentUser){try{const e=localStorage.getItem(l);if(e){const r=JSON.parse(e);return{phoneNumber:r.phoneNumber||a.phoneNumber,defaultMessage:r.defaultMessage||a.defaultMessage,isEnabled:r.isEnabled!==void 0?r.isEnabled:a.isEnabled,lastUpdated:r.lastUpdated?new Date(r.lastUpdated):a.lastUpdated}}}catch{}return a}const t=p(g,f,h),n=await E(t);if(n.exists()){const e=n.data(),r={phoneNumber:e.phoneNumber||a.phoneNumber,defaultMessage:e.defaultMessage||a.defaultMessage,isEnabled:e.isEnabled!==void 0?e.isEnabled:a.isEnabled,lastUpdated:((s=e.lastUpdated)==null?void 0:s.toDate())||a.lastUpdated};try{localStorage.setItem(l,JSON.stringify(r))}catch{}return r}else return await S(a),a}catch{try{const n=localStorage.getItem(l);if(n){const e=JSON.parse(n);return{phoneNumber:e.phoneNumber||a.phoneNumber,defaultMessage:e.defaultMessage||a.defaultMessage,isEnabled:e.isEnabled!==void 0?e.isEnabled:a.isEnabled,lastUpdated:e.lastUpdated?new Date(e.lastUpdated):a.lastUpdated}}}catch{}return a}},S=async s=>{try{const t=p(g,f,h),n={...s,lastUpdated:new Date};await N(t,n,{merge:!0});try{localStorage.setItem(l,JSON.stringify(n))}catch{}return!0}catch(t){return console.error("خطأ في حفظ إعدادات الواتساب:",t),!1}},b=s=>{const t=s.replace(/\D/g,"");if(t.length<10)throw new Error("رقم الهاتف يجب أن يحتوي على 10 أرقام على الأقل");return t},w=s=>{try{const t=b(s);return t.length>=10&&t.length<=15}catch{return!1}},D=(s,t)=>{const n=b(s),e=encodeURIComponent(t);return`https://wa.me/${n}?text=${e}`},M=()=>{const[s,t]=d.useState(null),[n,e]=d.useState(!0),[r,c]=d.useState(null);return d.useEffect(()=>{(async()=>{try{e(!0);const o=await i();t(o),c(null)}catch(o){c("فشل في تحميل إعدادات الواتساب"),console.error(o)}finally{e(!1)}})()},[]),{settings:s,loading:n,error:r,updateSettings:async u=>{try{return e(!0),await S(u)&&s?(t({...s,...u,lastUpdated:new Date}),c(null),!0):(c("فشل في حفظ الإعدادات"),!1)}catch(o){return c("خطأ في تحديث الإعدادات"),console.error(o),!1}finally{e(!1)}},refreshSettings:()=>i().then(t)}};export{D as c,b as f,M as u,w as v};
//# sourceMappingURL=whatsappService-17_eEP9o.js.map
