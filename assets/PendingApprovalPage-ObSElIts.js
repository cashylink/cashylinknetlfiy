const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-CpSuNyR6.js","./index-Bmklj-Zt.css"])))=>i.map(i=>d[i]);
import{u as W,a as q,r as l,x as J,i as N,y as K,F as S,j as a,S as Q,B as m,z as d,C as X,D as Y,_ as ee,G as te}from"./index-CpSuNyR6.js";import{R as ae}from"./refresh-cw-CyAu4JsZ.js";function le(){const{user:e,signOut:_,userSubscription:re,isSubscriptionActive:se,checkSubscriptionStatus:p}=W(),c=q(),[k,f]=l.useState(!1),[y,w]=l.useState(!1),[I,E]=l.useState(!1),[$,D]=l.useState(!1),[u,O]=l.useState(4),F=[{title:"Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©",price:150,features:["Ø¯Ø¹Ù… Ù…Ø¬Ø§Ù†ÙŠ ÙƒØ§Ù…Ù„","ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ø³ØªÙ…Ø±Ø©","Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚","20 Ù…Ø­ÙØ¸Ø©"],bg:"from-blue-50 to-indigo-50"},{title:"Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ©",price:350,features:["Ø¯Ø¹Ù… Ù…Ù…ÙŠØ²","Ø­ØªÙ‰ 30 Ù…Ø­ÙØ¸Ø©","Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚","Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ù„Ù‰ ØªÙ„Ø¬Ø±Ø§Ù…"],bg:"from-emerald-50 to-green-50"},{title:"Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ©",price:1e3,features:["Ø¯Ø¹Ù… Ù…Ù…ØªØ§Ø²","Ø¹Ø¯Ø¯ Ù…Ø­Ø§ÙØ¸ Ù…ÙØªÙˆØ­","Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚","Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ù„Ù‰ ØªÙ„Ø¬Ø±Ø§Ù…"],bg:"from-purple-50 to-pink-50"},{title:"Ø¨Ø§Ù‚Ø© Ù…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©",price:3e3,features:["Ø¯Ø¹Ù… Ù…Ù…ØªØ§Ø²","Ø¹Ø¯Ø¯ Ù…Ø­Ø§ÙØ¸ Ù…ÙØªÙˆØ­","Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚","Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ù„Ù‰ ØªÙ„Ø¬Ø±Ø§Ù…"],bg:"from-orange-50 to-amber-50"}];l.useEffect(()=>{if(!(e!=null&&e.uid))return;console.log("ðŸ” PendingApprovalPage: Setting up real-time subscription monitoring for user:",e.uid);const t=J(N,"users",e.uid),s=K(t,async n=>{var g,b;if(n.exists()){const r=n.data();if(console.log("ðŸ“Š PendingApprovalPage: User data updated:",{userId:e.uid,isApproved:r.isApproved,approved:r.approved,freeTrialActive:r.freeTrialActive,subscription:r.subscription,subscriptionActive:(g=r.subscription)==null?void 0:g.isActive}),r.isActive===!1){console.log("â›” PendingApprovalPage: User account is deactivated (isActive=false), staying on page."),sessionStorage.removeItem("dashboard_kick_signature");return}const h=(o=>{var j,T;if(!o)return"null";const i=o.subscription,V=i!=null&&i.activatedAt?i.activatedAt.toDate?i.activatedAt.toDate().toISOString():new Date(i.activatedAt).toISOString():"null",B=(i==null?void 0:i.planType)||"null",H=o.isActive!==!1,Z=(i==null?void 0:i.isActive)===!0,G=((j=o.branchPackage)==null?void 0:j.status)==="active",M=(T=o.branchPackage)!=null&&T.activatedAt?o.branchPackage.activatedAt.toDate?o.branchPackage.activatedAt.toDate().toISOString():new Date(o.branchPackage.activatedAt).toISOString():"null";return`${H}|${Z}|${B}|${V}|${G}|${M}`})(r),A=sessionStorage.getItem("dashboard_kick_signature"),P=()=>A?h!==A:!0;if((r==null?void 0:r.isOnFreeTrial)===!0)if(P()){console.log("âœ… PendingApprovalPage: Free trial active, redirecting..."),sessionStorage.removeItem("dashboard_kick_signature"),setTimeout(()=>{c("/user/dashboard",{replace:!0})},800);return}else console.log("â›” PendingApprovalPage: Free trial active but state signature matches kicked signature. Loop prevented.");if(((b=r==null?void 0:r.branchPackage)==null?void 0:b.status)==="active")if(P()){console.log("âœ… PendingApprovalPage: Branch package active, redirecting..."),sessionStorage.removeItem("dashboard_kick_signature");try{await p()}catch(o){console.error(o)}setTimeout(()=>{c("/user/dashboard",{replace:!0})},800);return}else console.log("â›” PendingApprovalPage: Branch package active but state signature matches kicked signature. Loop prevented.");const v=r.subscription;if(v&&v.isActive===!0){const o=te(v);if(console.log("ðŸ” PendingApprovalPage: Subscription validation result:",{hasSubscription:!!v,isActive:v.isActive,isValid:o,planType:v.planType}),o)if(P()){console.log("âœ… PendingApprovalPage: Valid subscription found, redirecting to dashboard..."),sessionStorage.removeItem("dashboard_kick_signature");try{await p()}catch(i){console.error("Error refreshing subscription status before redirect:",i)}setTimeout(()=>{c("/user/dashboard",{replace:!0})},800);return}else console.log("â›” PendingApprovalPage: Subscription valid but state signature matches kicked signature. Loop prevented.")}}},n=>{console.error("âŒ PendingApprovalPage: Error in real-time listener:",n)});return()=>{console.log("ðŸ”Œ PendingApprovalPage: Cleaning up real-time listener"),s()}},[e==null?void 0:e.uid,c]),l.useEffect(()=>{const t=s=>{const{userId:n,planType:g}=s.detail;console.log("ðŸŽ‰ PendingApprovalPage: Subscription activation event received:",{userId:n,planType:g,currentUserId:e==null?void 0:e.uid}),n===(e==null?void 0:e.uid)&&(console.log("âœ… PendingApprovalPage: Subscription activated for current user"),d.success("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§ÙƒÙƒ! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…..."),sessionStorage.removeItem("dashboard_kick_signature"),setTimeout(async()=>{await p(),c("/user/dashboard",{replace:!0})},1500))};return console.log("ðŸ”” PendingApprovalPage: Setting up subscription activation listener"),window.addEventListener("subscriptionActivated",t),()=>{console.log("ðŸ”Œ PendingApprovalPage: Cleaning up subscription activation listener"),window.removeEventListener("subscriptionActivated",t)}},[e==null?void 0:e.uid,c,p]),l.useEffect(()=>{if(!(e!=null&&e.uid))return;const t=setInterval(async()=>{console.log("ðŸ”„ PendingApprovalPage: Periodic subscription status check"),await p()},3e4);return()=>{clearInterval(t)}},[e==null?void 0:e.uid,p]),l.useEffect(()=>{(async()=>{if(e!=null&&e.uid)try{const s=await S.getTrialData(e.uid);E(s.hasUsedFreeTrial),D(s.isOnFreeTrial)}catch(s){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©:",s)}})()},[e==null?void 0:e.uid]),l.useEffect(()=>{(async()=>{try{const t=await S.getTrialDurationHours();O(t)}catch(t){console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¯Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©:",t)}})()},[]);const C=async()=>{await _(),c("/auth")},R=async()=>{if(e!=null&&e.uid){f(!0);try{await X(e.uid,Y.ZERO,e.uid),d.success("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¨Ø§Ù‚Ø© Ø§Ù„Ø²ÙŠØ±Ùˆ! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡..."),setTimeout(()=>{try{c("/user/dashboard",{replace:!0})}catch{}},1200)}catch(t){console.error("Error activating zero plan:",t),d.error("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙØ¹ÙŠÙ„ Ø¨Ø§Ù‚Ø© Ø§Ù„Ø²ÙŠØ±Ùˆ")}finally{f(!1)}}},U=async()=>{if(e!=null&&e.uid){f(!0);try{const t=await S.startFreeTrial(e.uid);t.success?(d.success(t.message||`ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© Ù„Ù…Ø¯Ø© ${u} ${u>=3&&u<=10?"Ø³Ø§Ø¹Ø§Øª":u===2?"Ø³Ø§Ø¹ØªÙŠÙ†":"Ø³Ø§Ø¹Ø©"}! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡...`),setTimeout(()=>{try{c("/user/dashboard",{replace:!0})}catch{}},1200)):d.error(t.message)}catch(t){console.error("Error activating trial:",t),d.error("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©")}finally{f(!1)}}},L=async()=>{var t,s;w(!0),console.log("ðŸ”„ PendingApprovalPage: Manual refresh triggered");try{if(sessionStorage.removeItem("dashboard_kick_signature"),await p(),e!=null&&e.uid){const{getDoc:n,doc:g}=await ee(async()=>{const{getDoc:r,doc:x}=await import("./index-CpSuNyR6.js").then(h=>h.c5);return{getDoc:r,doc:x}},__vite__mapDeps([0,1]),import.meta.url),b=await n(g(N,"users",e.uid));if(b.exists()){const r=b.data(),x=r.isActive!==!1,h=((t=r.subscription)==null?void 0:t.isActive)===!0,A=((s=r.branchPackage)==null?void 0:s.status)==="active";if(x&&(h||A)){d.success("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡..."),setTimeout(()=>{c("/user/dashboard",{replace:!0})},500);return}}}d.success("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")}catch(n){console.error("âŒ Error during manual refresh:",n),d.error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«")}finally{w(!1)}},z=(t,s,n)=>{try{const g=encodeURIComponent(`Ø£Ø±ØºØ¨ ÙÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ ${t} Ø¨Ø³Ø¹Ø± ${s} Ø¬
Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:
- ${n.join(`
- `)}`);window.open(`https://wa.me/201000392539?text=${g}`,"_blank")}catch{}};return a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:a.jsxs("div",{className:"w-full max-w-5xl bg-white rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 p-4 sm:p-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"flex justify-center mb-2",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:"linear-gradient(135deg, #f59e0b, #d97706)",filter:"blur(8px)",opacity:.3}}),a.jsx("div",{className:"relative bg-gradient-to-br from-orange-400 to-orange-600 p-2 rounded-full",children:a.jsx(Q,{className:"h-10 w-10 text-white"})})]})}),a.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Ù…Ø·Ù„ÙˆØ¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨"}),a.jsx("p",{className:"text-gray-700 text-sm mt-1",children:"Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© ÙˆØ§Ø¶ØºØ· Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„ÙÙˆØ±ÙŠ."}),a.jsx("div",{className:"mt-4 flex justify-center",children:a.jsxs(m,{variant:"outline",size:"sm",onClick:L,disabled:y,className:"flex items-center gap-2 text-blue-600 border-blue-200 hover:bg-blue-50",children:[a.jsx(ae,{className:`w-4 h-4 ${y?"animate-spin":""}`}),y?"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...":"ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ"]})})]}),a.jsx("div",{className:"pt-4",children:a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-2 items-stretch",children:F.map(t=>a.jsxs("div",{className:`h-full rounded-lg p-2 border shadow-sm bg-gradient-to-br ${t.bg} dark:from-gray-800 dark:to-gray-700 dark:border-gray-700`,children:[a.jsx("div",{className:"font-bold text-sm text-gray-800 dark:text-gray-100 mb-1",children:t.title}),a.jsxs("div",{className:"text-lg font-extrabold text-gray-900 dark:text-gray-100 mb-2",children:[t.price," Ø¬"]}),a.jsx("ul",{className:"text-[11px] text-gray-700 dark:text-gray-200 text-right space-y-1 mb-2",children:t.features.map(s=>a.jsxs("li",{children:["â€¢ ",s]},s))}),a.jsx(m,{size:"sm",className:"w-full bg-green-600 hover:bg-green-700 text-xs py-1 h-8",onClick:()=>z(t.title,t.price,t.features),children:"ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨"})]},t.title))})}),a.jsxs("div",{className:"pt-3",children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-2",children:[a.jsx(m,{size:"sm",className:"w-full bg-emerald-600 hover:bg-emerald-700",onClick:R,disabled:k,children:"Ø¬Ø±Ø¨ Ø¨Ø§Ù‚Ø© Ø§Ù„Ø²ÙŠØ±Ùˆ"}),!I&&!$&&a.jsx(m,{size:"sm",className:"w-full bg-blue-600 hover:bg-blue-700",onClick:U,disabled:k,children:`Ø¬Ø±Ø¨ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ${u} ${u>=3&&u<=10?"Ø³Ø§Ø¹Ø§Øª":u===2?"Ø³Ø§Ø¹ØªÙŠÙ†":"Ø³Ø§Ø¹Ø©"}`})]}),a.jsx(m,{variant:"outline",className:"border-2 border-gray-300 hover:border-gray-400 text-gray-700 hover:text-gray-800 px-5 py-2 rounded-lg font-semibold text-xs transition-all duration-300",onClick:C,children:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"})]})]})})}export{le as default};
//# sourceMappingURL=PendingApprovalPage-ObSElIts.js.map
