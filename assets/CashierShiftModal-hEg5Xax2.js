import{ay as as,u as ls,i as rs,r as l,K as ve,o as je,Y as He,W as is,j as e,a5 as N,a6 as y,a7 as b,a8 as w,B as o,az as S,v as j,I as h,a3 as pe}from"./index-bCWIXU_s.js";import{getLastTransactions as ns}from"./functions-5D5Jrxio.js";const js=({open:X,onOpenChange:E})=>{var Ue;const{shiftUser:n,isShiftActive:M,shiftStartAt:k,setShiftUser:U,startShift:fe,endShift:ge}=as(),{userSubscription:Z,user:a,signIn:$e,profile:cs}=ls(),{toast:D}=rs(),[P,Ne]=l.useState((n==null?void 0:n.name)||""),[H,ye]=l.useState((n==null?void 0:n.username)||""),[$,be]=l.useState(""),[ee,L]=l.useState(!1),[f,V]=l.useState(null),[we,Se]=l.useState(""),[De,se]=l.useState(""),[ds,os]=l.useState(!1),[p,te]=l.useState(null),[Ce,ae]=l.useState(""),[Te,O]=l.useState(""),[Le,F]=l.useState(!1),[_,z]=l.useState(!1),[Fe,G]=l.useState({totalTransfers:0,totalWithdrawals:0}),[J,K]=l.useState(null),[We,le]=l.useState(""),[W,Ae]=l.useState(""),[A,Ie]=l.useState(0),[Ve,ms]=l.useState({}),[I,_e]=l.useState(0),[R,ze]=l.useState(0),[Ge,xs]=l.useState({}),[re,Be]=l.useState(""),[Je,ie]=l.useState(!1),Y=s=>{const t={"٠":"0","١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9","۰":"0","۱":"1","۲":"2","۳":"3","۴":"4","۵":"5","۶":"6","۷":"7","۸":"8","۹":"9","٫":".","،":".","٬":"."," ":""};return s.split("").map(c=>t[c]??c).join("")},ne=()=>`cashierUsers_${(a==null?void 0:a.uid)||"default"}`,[g,B]=l.useState(()=>{try{let s=localStorage.getItem(ne());if(!s){const t=localStorage.getItem("cashierUsers");t&&(s=t)}return s?JSON.parse(s):[]}catch{return[]}});l.useEffect(()=>{(async()=>{try{if(!(a!=null&&a.uid))return;const s=ve(je,"profiles",a.uid,"cashierUsers","list"),t=await He(s);if(t.exists()){const c=t.data(),i=Array.isArray(c==null?void 0:c.users)?c.users:[];i&&i.length>0&&B(i)}}catch{}})()},[a==null?void 0:a.uid]),l.useEffect(()=>{if(!(a!=null&&a.uid))return;(async()=>{try{const t=ve(je,"profiles",a.uid,"cashierUsers","list"),c=await He(t);if(c.exists()){const i=c.data(),u=Array.isArray(i==null?void 0:i.users)?i.users:[];if(u&&u.length>0)B(u);else try{const v=localStorage.getItem(ne()),x=v?JSON.parse(v):[];B(x)}catch{B([])}}}catch(t){console.warn("Failed to fetch cashierUsers:",t)}})()},[a==null?void 0:a.uid]);const ke=(Ue=Z==null?void 0:Z.subscription)==null?void 0:Ue.planType,ce=ke==="yearly"?2:ke==="lifetime"?4:Number.POSITIVE_INFINITY;l.useEffect(()=>{try{localStorage.setItem(ne(),JSON.stringify(g));try{localStorage.removeItem("cashierUsers")}catch{}}catch{}(async()=>{try{if(!(a!=null&&a.uid))return;const s=ve(je,"profiles",a.uid,"cashierUsers","list");await is(s,{users:g},{merge:!0})}catch{}})()},[g]);const[Ke,q]=l.useState(!1),[Oe,de]=l.useState(""),[C,Re]=l.useState(null),[Ee,oe]=l.useState([]),[me,xe]=l.useState(!1),[m,Ye]=l.useState(null),[qe,he]=l.useState(!1),[Qe,Q]=l.useState(!1),Xe=s=>{const t=(n==null?void 0:n.username)===s;let c=!1;try{c=localStorage.getItem("lastHandoverToAdmin")==="true"}catch{}if(t&&!(t&&!M&&(re==="الأدمن الرئيسي"||c))){D({title:"لا يمكن الحذف",description:"لا يمكنك حذف مستخدم الوردية أثناء كونها نشطة أو قبل تسليمها للأدمن الرئيسي"});return}const v=`هل أنت متأكد من حذف المستخدم ${s}؟

هذا الإجراء لا يمكن التراجع عنه.`;window.confirm(v)&&(B(x=>x.filter(ue=>ue.username!==s)),t&&U(null),D({title:"تم حذف المستخدم",description:s}))},Ze=()=>{if(!P.trim()||!H.trim()||!$.trim())return;if(g.length>=ce){D({title:"وصلت الحد الأقصى للمستخدمين",description:`هذه الباقة تسمح بإضافة ${Number.isFinite(ce)?ce:"عدد غير محدود"} كاشير فقط`,variant:"destructive"});return}const s={name:P.trim(),username:H.trim(),password:$.trim()};B(t=>[s,...t]),Ne(""),ye(""),be("")},es=()=>{L(!0),V(null),te(null),ae(""),O("")},Me=async()=>{try{let s=[];try{a!=null&&a.uid&&(s=await pe.getUserTransactions(a.uid))}catch{}if(!s||s.length===0)try{const r=await ns({merchantUserId:a==null?void 0:a.uid,limit:200});s=(r==null?void 0:r.transactions)||[]}catch{}const t=k?new Date(k):null,c=new Date,i=r=>{const d=r.type,T=r.txnType;return d==="withdraw"||d==="withdrawal"||d==="receive"||T==="receive"},u=r=>{const d=r.type,T=r.txnType;return d==="send"||d==="transfer"||T==="send"},v=r=>{if(!r)return null;if(r instanceof Date)return r;try{const d=new Date(r);return Number.isNaN(d.getTime())?null:d}catch{return null}},x=r=>{const d=v(r.createdAt||r.created_at||r.timestamp);return!d||t&&d<t?!1:d<=c},ue=r=>r==="completed"||r==="confirmed",Pe=s.filter(r=>ue(r.status)&&x(r)),ts=Pe.filter(r=>i(r)).reduce((r,d)=>{const T=d.withdrawnAmount??d.receivedAmount??d.amount??0;return r+(Number(T)||0)},0);return{totalTransfers:Pe.filter(r=>u(r)).reduce((r,d)=>{const T=d.sentAmount??d.transferredAmount??d.amount??0;return r+(Number(T)||0)},0),totalWithdrawals:ts}}catch{return{totalTransfers:0,totalWithdrawals:0}}};l.useEffect(()=>{if(_){try{const s=localStorage.getItem("shiftInitialReceivedDrawerFunds");s!==null&&Ae(s)}catch{}try{const s=localStorage.getItem("shiftInitialReceivedWalletBalancesTotal");if(s!==null){const t=parseFloat(s);Ie(Number.isFinite(t)?t:0)}}catch{}}},[_]),l.useEffect(()=>{ee&&(async()=>{try{const s=await Me();G(s)}catch{}})()},[ee]),l.useEffect(()=>{if(!X&&!me)return;(async()=>{try{const c=((a!=null&&a.uid?await pe.getUserTransactions(a.uid):[])||[]).filter(i=>(i==null?void 0:i.type)==="report"||((i==null?void 0:i.title)||"").includes("إيصال تسليم وردية"));c.sort((i,u)=>{const v=new Date(i.createdAt||0).getTime();return new Date(u.createdAt||0).getTime()-v}),oe(c)}catch{oe([])}})()},[X,_,me,a==null?void 0:a.uid]);const ss=async(s,t,c)=>{try{let i=0,u=0;try{const x=parseFloat(localStorage.getItem("shiftInitialReceivedDrawerFunds")||"0");i=Number.isFinite(x)?x:0}catch{}try{const x=parseFloat(localStorage.getItem("shiftInitialReceivedWalletBalancesTotal")||"0");u=Number.isFinite(x)?x:0}catch{}const v={id:`shift_receipt_${Date.now()}`,type:"report",senderPhone:(n==null?void 0:n.username)||"cashier",receiverPhone:re||"admin",amount:0,status:"completed",createdAt:new Date().toISOString(),title:"إيصال تسليم وردية",cashierName:(n==null?void 0:n.name)||(n==null?void 0:n.username)||null,deficit:t,deficitAmount:t?c:0,shiftStartAt:k,receivedDrawerFunds:i,receivedWalletBalancesTotal:u,receivedWalletBalances:Ve,deliveredDrawerFunds:I||0,deliveredWalletBalancesTotal:R||0,deliveredWalletBalances:Ge,shiftProfit:Math.round(((I||0)+(R||0)-(i+u))*100)/100};a!=null&&a.uid&&await pe.saveUserTransaction(a.uid,v),oe(x=>[v,...x||[]])}catch{}};return e.jsxs(e.Fragment,{children:[e.jsx(N,{open:X,onOpenChange:E,children:e.jsxs(y,{className:"sm:max-w-md",children:[e.jsx(b,{children:e.jsx(w,{children:M?"تسليم الورديه والخروج":"إضافة مستخدم وردية"})}),M?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 rounded border bg-gray-50",children:[e.jsx("div",{className:"text-sm",children:"المستخدم الحالي للوردية:"}),e.jsxs("div",{className:"font-semibold text-sm",children:[n==null?void 0:n.name," (",n==null?void 0:n.username,")"]})]}),e.jsx("div",{className:"text-xs text-gray-600",children:'لإنهاء الوردية والخروج، اضغط "تسليم الورديه والخروج" وسيُطلب الرقم السري.'})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:'لاستكمال إضافة مستخدم جديد اضغط الزر أسفل "إضافة مستخدم جديد" لفتح النموذج.'}),g.length>0&&e.jsxs("div",{className:"mt-4 border-t pt-3",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"المستخدمون المسجلون"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-auto",children:g.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between rounded border px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.username})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(o,{size:"sm",className:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{Re(s),q(!0)},children:"دخول"}),e.jsx(o,{size:"sm",className:"w-full sm:w-auto",variant:"destructive",onClick:()=>Xe(s.username),children:"حذف"})]})]},t))})]})]}),e.jsx(S,{className:"flex flex-wrap gap-2 justify-between",children:M?e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(o,{className:"w-full sm:w-auto",variant:"destructive",onClick:es,children:"تسليم الورديه والخروج"})}):e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(o,{className:"w-full sm:w-auto bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>Q(!0),children:"إضافة مستخدم جديد"}),e.jsx(o,{className:"w-full sm:w-auto",variant:"outline",onClick:()=>xe(!0),children:"إيصالات التسليم"})]})})]})}),e.jsx(N,{open:Qe,onOpenChange:Q,children:e.jsxs(y,{className:"sm:max-w-md",children:[e.jsx(b,{children:e.jsx(w,{children:"إضافة مستخدم جديد"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{className:"mb-1 block",children:"الاسم"}),e.jsx(h,{value:P,onChange:s=>Ne(s.target.value),placeholder:"أدخل الاسم"})]}),e.jsxs("div",{children:[e.jsx(j,{className:"mb-1 block",children:"اسم المستخدم"}),e.jsx(h,{value:H,onChange:s=>ye(s.target.value),placeholder:"أدخل اسم المستخدم"})]}),e.jsxs("div",{children:[e.jsx(j,{className:"mb-1 block",children:"الرقم السري"}),e.jsx(h,{type:"password",autoComplete:"new-password",value:$,onChange:s=>be(s.target.value),placeholder:"أدخل الرقم السري"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"المستخدم يمكنه: التحويل، السحب، اختيار المحفظة فقط."})]}),e.jsxs(S,{className:"flex gap-2 justify-between",children:[e.jsx(o,{variant:"secondary",onClick:()=>{Q(!1)},children:"إلغاء"}),e.jsx(o,{onClick:()=>{!P.trim()||!H.trim()||!$.trim()||(Ze(),Q(!1))},className:"bg-blue-600 hover:bg-blue-700 text-white",children:"حفظ المستخدم"})]})]})}),e.jsx(N,{open:me,onOpenChange:xe,children:e.jsxs(y,{className:"sm:max-w-lg",children:[e.jsx(b,{children:e.jsx(w,{children:"إيصالات التسليم"})}),Ee.length===0?e.jsx("div",{className:"text-xs text-gray-600",children:"لا توجد إيصالات تسليم محفوظة بعد."}):e.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-auto",children:Ee.map(s=>e.jsxs("div",{className:"rounded border px-3 py-2 cursor-pointer hover:bg-gray-50",onClick:()=>{Ye(s),he(!0)},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:new Date(s.createdAt).toLocaleString("ar-EG")}),e.jsxs("div",{className:"text-xs text-gray-500",children:["إلى: ",s.receiverPhone]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية مسلّمة: ",s.deliveredDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["محافظ مسلّمة (إجمالي): ",s.deliveredWalletBalancesTotal??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية مستلمة: ",s.receivedDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["محافظ مستلمة (إجمالي): ",s.receivedWalletBalancesTotal??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية مسلّمة: ",s.deliveredDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["محافظ مسلّمة (إجمالي): ",s.deliveredWalletBalancesTotal??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية مستلمة: ",s.receivedDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["محافظ مستلمة (إجمالي): ",s.receivedWalletBalancesTotal??0]}),e.jsxs("div",{className:["text-xs",(s.shiftProfit??(s.deliveredDrawerFunds??0)+(s.deliveredWalletBalancesTotal??0)-(s.receivedDrawerFunds??0)-(s.receivedWalletBalancesTotal??0))>=0?"text-green-700":"text-red-700"].join(" "),children:["أرباح الوردية: ",s.shiftProfit??(s.deliveredDrawerFunds??0)+(s.deliveredWalletBalancesTotal??0)-(s.receivedDrawerFunds??0)-(s.receivedWalletBalancesTotal??0)]})]}),s.deficit&&e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["عجز: ",s.deficitAmount??0]})]},s.id))}),e.jsx(S,{className:"flex gap-2 justify-between",children:e.jsx(o,{variant:"secondary",onClick:()=>xe(!1),children:"إغلاق"})})]})}),e.jsx(N,{open:qe,onOpenChange:he,children:e.jsxs(y,{className:"sm:max-w-md",children:[e.jsx(b,{children:e.jsx(w,{children:"إيصال تسليم وردية"})}),m?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 rounded border bg-gray-50",children:[e.jsxs("div",{className:"text-sm",children:["التاريخ: ",new Date(m.createdAt).toLocaleString("ar-EG")]}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["تم التسليم إلى: ",m.receiverPhone]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"المستلم عند الدخول"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية: ",m.receivedDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["أرصدة المحافظ (إجمالي): ",m.receivedWalletBalancesTotal??0]})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"المسلّم عند الخروج"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نقدية: ",m.deliveredDrawerFunds??0]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["أرصدة المحافظ (إجمالي): ",m.deliveredWalletBalancesTotal??0]})]})]}),m.deficit&&e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2 text-red-600",children:"عجز"}),e.jsxs("div",{className:"text-xs text-red-600",children:["المبلغ: ",m.deficitAmount??0]})]}),m.receivedWalletBalances&&Object.keys(m.receivedWalletBalances).length>0&&e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"تفصيل المحافظ المستلمة"}),e.jsx("div",{className:"space-y-1",children:Object.entries(m.receivedWalletBalances).map(([s,t])=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:s}),e.jsx("span",{className:"font-semibold",children:t})]},s))})]}),m.deliveredWalletBalances&&Object.keys(m.deliveredWalletBalances).length>0&&e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:"تفصيل المحافظ المسلّمة"}),e.jsx("div",{className:"space-y-1",children:Object.entries(m.deliveredWalletBalances).map(([s,t])=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:s}),e.jsx("span",{className:"font-semibold",children:t})]},s))})]})]}):e.jsx("div",{className:"text-xs text-gray-600",children:"لا يوجد تقرير محدد للعرض."}),e.jsx(S,{className:"flex gap-2 justify-between",children:e.jsx(o,{variant:"secondary",onClick:()=>he(!1),children:"إغلاق"})})]})}),e.jsx(N,{open:Ke,onOpenChange:q,children:e.jsxs(y,{className:"sm:max-w-md",children:[e.jsx(b,{children:e.jsx(w,{children:"أدخل الرقم السري للدخول"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm",children:C?`${C.name} (${C.username})`:""}),e.jsx(h,{type:"password",autoComplete:"off",value:Oe,onChange:s=>de(s.target.value),placeholder:"أدخل الرقم السري"})]}),e.jsxs(S,{className:"flex gap-2 justify-between",children:[e.jsx(o,{variant:"secondary",onClick:()=>{de(""),Re(null),q(!1)},children:"إلغاء"}),e.jsx(o,{className:"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>{if(C){if(Oe.trim()!==C.password){D({title:"خطأ في الرقم السري",description:"الرقم السري للكاشير غير صحيح",variant:"destructive"});return}U({name:C.name,username:C.username}),de(""),q(!1),E(!1),fe(),ie(!0)}},children:"دخول الورديه"})]})]})}),e.jsx(N,{open:Je,onOpenChange:ie,children:e.jsxs(y,{className:"sm:max-w-md",children:[e.jsx(b,{children:e.jsx(w,{children:"تسجيل أرصدة البداية والنقدية"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(j,{className:"mb-1 block",children:"الفلوس النقدية المستلمة عند الدخول"}),e.jsx(h,{type:"text",inputMode:"decimal",value:W,onChange:s=>Ae(Y(s.target.value)),placeholder:"أدخل قيمة النقدية في الدرج عند بداية الورديه"})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(j,{className:"mb-1 block",children:"أرصدة المحافظ المستلمة (إجمالي) عند الدخول"}),e.jsx(h,{type:"text",inputMode:"decimal",value:Number.isFinite(A)?A:0,onChange:s=>{const t=parseFloat(Y(s.target.value));Ie(Number.isFinite(t)?t:0)},placeholder:"أدخل إجمالي أرصدة المحافظ عند بداية الورديه"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"يمكن إضافة التفصيل لاحقاً إن لزم، المهم تسجيل الإجمالي."})]})]}),e.jsx(S,{className:"flex gap-2 justify-between",children:e.jsx(o,{className:"bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>{const s=parseFloat(W),t=A,c=Number.isFinite(s)&&s>=0,i=Number.isFinite(t)&&t>=0;if(!c||!i){D({title:"يرجى إدخال قيم صحيحة",description:"أدخل قيمًا رقمية غير سالبة للنقدية ولإجمالي أرصدة المحافظ",variant:"destructive"});return}try{localStorage.setItem("shiftInitialReceivedDrawerFunds",String(s)),localStorage.setItem("shiftInitialReceivedWalletBalancesTotal",String(t))}catch{}D({title:"تم تسجيل أرصدة البداية",description:"سُجّل إجمالي النقدية وأرصدة المحافظ لبداية الورديه"}),ie(!1)},children:"تأكيد وحفظ"})})]})}),e.jsx(N,{open:ee,onOpenChange:s=>{s&&L(!0)},children:e.jsxs(y,{className:"sm:max-w-md",hideClose:!0,disableOutsideClose:!0,disableEscClose:!0,children:[e.jsx(b,{children:e.jsx(w,{children:"تسليم الورديه والخروج"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:f==="toUser"?"default":"secondary",onClick:()=>V("toUser"),children:"تسليم إلى مستخدم آخر"}),e.jsx(o,{variant:f==="toAdmin"?"default":"secondary",onClick:()=>V("toAdmin"),children:"تسليم إلى الأدمن الرئيسي"})]}),f==="toUser"&&e.jsxs("div",{className:"space-y-3",children:[g.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"لا يوجد مستخدمون مسجلون. قم بإضافة مستخدم أولاً."}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"اختر المستخدم الذي سيتسلم الورديه"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-auto",children:g.map((s,t)=>e.jsxs("div",{className:`flex items-center justify-between rounded border px-3 py-2 cursor-pointer ${(p==null?void 0:p.username)===s.username?"bg-indigo-50 border-indigo-200":""}`,onClick:()=>te(s),children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.username})]}),e.jsx("span",{className:"text-xs text-gray-400",children:"اختيار"})]},t))})]}),e.jsxs("div",{children:[e.jsx(j,{className:"mb-1 block",children:"كلمة سر المستخدم المحدد"}),e.jsx(h,{type:"password",autoComplete:"off",value:Ce,onChange:s=>ae(s.target.value),placeholder:"أدخل كلمة السر"})]}),Te&&e.jsx("div",{className:"text-xs text-red-600",children:Te})]}),f==="toAdmin"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"أدخل كلمة مرور الحساب الرئيسي لتسليم الورديه والخروج إلى الأدمن."}),e.jsx(h,{type:"password",autoComplete:"off",value:we,onChange:s=>Se(s.target.value),placeholder:"كلمة المرور"}),De&&e.jsx("div",{className:"text-xs text-red-600",children:De})]})]}),e.jsx(S,{className:"flex gap-2 justify-between",children:e.jsx(o,{disabled:Le||!f,onClick:async()=>{if(f){F(!0);try{const s=Fe;if(Me().then(G).catch(()=>{}),f==="toUser"){if(!p){O("يرجى اختيار المستخدم أولاً"),F(!1);return}if(Ce.trim()!==p.password){O("كلمة السر غير صحيحة"),F(!1);return}ge(),U({name:p.name,username:p.username}),fe(),Be(`${p.name} (${p.username})`);try{localStorage.setItem("lastHandoverToAdmin","false")}catch{}L(!1),V(null),te(null),ae(""),O(""),E(!1),G(s),K(null),le(""),z(!0)}else if(f==="toAdmin"){se("");const t=(a==null?void 0:a.email)||"";if(!t){se("لا يوجد بريد للمستخدم الرئيسي للتحقق"),F(!1);return}const{error:c}=await $e(t,we);if(c){se("كلمة المرور غير صحيحة"),F(!1);return}ge(),U(null);try{localStorage.setItem("lastHandoverToAdmin","true")}catch{}Se(""),L(!1),E(!1),Be("الأدمن الرئيسي"),G(s),K(null),le(""),z(!0)}}catch{O("حدث خطأ أثناء التسليم، حاول مرة أخرى")}finally{F(!1)}}},className:"bg-blue-600 hover:bg-blue-700 text-white",children:"تأكيد التسليم"})})]})}),e.jsx(N,{open:_,onOpenChange:z,children:e.jsxs(y,{className:"sm:max-w-lg",hideClose:!0,disableOutsideClose:!0,disableEscClose:!0,children:[e.jsx(b,{children:e.jsx(w,{children:"تقرير تسليم الورديه والخروج"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 rounded border bg-gray-50",children:[e.jsxs("div",{className:"text-sm",children:["تم تسليم الورديه إلى: ",e.jsx("span",{className:"font-semibold",children:re})]}),k&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["بداية الورديه: ",new Date(k).toLocaleString("ar-EG")]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["نهاية الورديه: ",new Date().toLocaleString("ar-EG")]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(j,{className:"mb-1 block",children:"الفلوس النقدية المستلمة"}),e.jsx(h,{type:"number",value:W,readOnly:!0,disabled:!0,placeholder:"قيمة مسجلة عند بداية الورديه"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"قيمة غير قابلة للتعديل؛ تُسجّل عند الدخول."})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(j,{className:"mb-1 block",children:"أرصدة المحافظ المستلمة (إجمالي)"}),e.jsx(h,{type:"number",value:A,readOnly:!0,disabled:!0,placeholder:"إجمالي مسجل عند بداية الورديه"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(j,{className:"mb-1 block",children:"الفلوس النقدية المسلمة"}),e.jsx(h,{type:"text",inputMode:"decimal",value:I,onChange:s=>{const t=parseFloat(Y(s.target.value));_e(Number.isFinite(t)?t:0)},placeholder:"أدخل قيمة النقدية المسلمة عند نهاية الورديه"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"ادخال يدوي لقيمة النقدية المسلّمة عند نهاية الورديه"})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx(j,{className:"mb-1 block",children:"أرصدة المحافظ المسلمة (إجمالي)"}),e.jsx(h,{type:"text",inputMode:"decimal",value:R,onChange:s=>{const t=parseFloat(Y(s.target.value));ze(Number.isFinite(t)?t:0)},placeholder:"أدخل إجمالي أرصدة المحافظ المسلّمة"}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"يمكنك إدخال الإجمالي يدوياً؛ التفصيل يُحفظ إن لزم"})]})]}),e.jsxs("div",{className:"rounded border p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-1",children:"أرباح الوردية"}),e.jsx("div",{className:["text-sm",(I??0)+(R??0)-((parseFloat(W||"0")||0)+(A??0))>=0?"text-green-700":"text-red-700"].join(" "),children:Math.round(((I??0)+(R??0)-((parseFloat(W||"0")||0)+(A??0)))*100)/100}),e.jsx("div",{className:"text-xs text-gray-600",children:"محسوبة: (المسلّم − المستلم) للنقدية + المحافظ"}),e.jsx("div",{className:"mt-2 grid grid-cols-1 gap-2",children:e.jsxs("div",{className:"rounded border p-2 bg-gray-50",children:[e.jsx("div",{className:"text-xs text-gray-700",children:"مطلوب من الدرج (بدون أرباح)"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:Math.round(((I??0)-(parseFloat(W||"0")||0))*100)/100})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"هل يوجد عجز؟"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:J==="no"?"default":"secondary",onClick:()=>K("no"),children:"لا"}),e.jsx(o,{variant:J==="yes"?"default":"secondary",onClick:()=>K("yes"),children:"نعم"})]}),J==="yes"&&e.jsxs("div",{children:[e.jsx(j,{className:"mb-1 block",children:"مبلغ العجز"}),e.jsx(h,{type:"number",value:We,onChange:s=>le(s.target.value),placeholder:"أدخل مبلغ العجز"})]})]})]}),e.jsx(S,{className:"flex gap-2 justify-between",children:e.jsx(o,{onClick:()=>{const s=J==="yes",t=parseFloat(We)||0;(async()=>await ss(Fe,s,t))(),D({title:"تم إضافة إيصال تسليم الورديه",description:"أُضيف الإيصال إلى المعاملات الأخيرة بعنوان إيصال تسليم وردية"}),z(!1)},className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:"تأكيد وحفظ الإيصال"})})]})})]})};export{js as default};
//# sourceMappingURL=CashierShiftModal-hEg5Xax2.js.map
