import{v as d,G as c,F as f,U as s,B as m}from"./index-C_crvORM.js";const l={getCurrentDayId(){const r=new Date;return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`},async getCounts(r,i){const n=i||this.getCurrentDayId(),e=d(c,"users",r,"dailyOps",n),u=await m(e);if(!u.exists()){const a={dayId:n,confirmTransferCount:0,confirmWithdrawCount:0,updatedAt:s()};return await f(e,a),{...a,updatedAt:new Date}}const t=u.data();return{dayId:n,confirmTransferCount:Number((t==null?void 0:t.confirmTransferCount)||0),confirmWithdrawCount:Number((t==null?void 0:t.confirmWithdrawCount)||0),updatedAt:(t==null?void 0:t.updatedAt)||s()}},async checkAndIncrement(r,i,n){const e=this.getCurrentDayId(),u=d(c,"users",r,"dailyOps",e),t=await this.getCounts(r,e),a=i==="transfer"?t.confirmTransferCount:t.confirmWithdrawCount;if(a>=n)return{allowed:!1,remaining:0};const o={updatedAt:s()};return i==="transfer"?o.confirmTransferCount=t.confirmTransferCount+1:o.confirmWithdrawCount=t.confirmWithdrawCount+1,await f(u,o,{merge:!0}),{allowed:!0,remaining:Math.max(0,n-(a+1))}},async checkAndIncrementCombined(r,i,n){const e=this.getCurrentDayId(),u=d(c,"users",r,"dailyOps",e),t=await this.getCounts(r,e),a=Number(t.confirmTransferCount||0)+Number(t.confirmWithdrawCount||0);if(a>=n)return{allowed:!1,remaining:0};const o={updatedAt:s()};return i==="transfer"?o.confirmTransferCount=t.confirmTransferCount+1:o.confirmWithdrawCount=t.confirmWithdrawCount+1,await f(u,o,{merge:!0}),{allowed:!0,remaining:Math.max(0,n-(a+1))}}};export{l as dailyOperationCountService,l as default};
//# sourceMappingURL=dailyOperationCountService-BuoXgFag-CymNVAFH.js.map
