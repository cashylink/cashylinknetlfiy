import{S as n,W as N,C as b,I as e,V as S,t as x,N as C,P as F,m as I,n as k,a7 as a,k as h,A as $,F as P,v as A,G as q,U as p}from"./index-BsVRzvOf.js";import{u as f}from"./label-_mnIMROJ-DudSd8Mh.js";import{o as D,c as E,i as G,n as U,l as L}from"./card-SlwaggFS-BswsJdJN.js";import{c as V}from"./shield-DSoskD-c-BzN5L-qY.js";const J=()=>{const[o,m]=n.useState(""),[i,j]=n.useState(""),[c,g]=n.useState(!1),[d,u]=n.useState(!1),{signIn:v}=N(),y=b();n.useEffect(()=>{try{const s=typeof window<"u"?window.localStorage.getItem("cashy:lastEmail"):null;s&&m(s)}catch{}},[]);const w=async s=>{var l;if(s.preventDefault(),d){a.info("جارٍ تنفيذ تسجيل الدخول، يرجى الانتظار...");return}if(typeof navigator<"u"&&navigator.onLine===!1){a.error("لا يوجد اتصال بالإنترنت. يرجى التأكد من الشبكة ثم المحاولة.");return}if(!o||!i){a.error("يرجى إدخال البريد الإلكتروني وكلمة المرور");return}u(!0);try{const{error:r}=await v(o,i);if(r){const t=r==null?void 0:r.code;t==="auth/invalid-email"?a.error("صيغة البريد الإلكتروني غير صحيحة"):t==="auth/user-not-found"?a.error("لا يوجد حساب بهذا البريد الإلكتروني"):t==="auth/wrong-password"?a.error("كلمة المرور غير صحيحة"):t==="auth/invalid-credential"?a.error("البريد الإلكتروني أو كلمة المرور غير صحيحة"):t==="auth/too-many-requests"?a.error("تم تجاوز عدد المحاولات المسموح، حاول لاحقاً"):a.error((r==null?void 0:r.message)||"حدث خطأ أثناء تسجيل الدخول");return}try{const t=(l=$.currentUser)==null?void 0:l.uid;t&&await P(A(q,"users",t),{branchPackage:{requested:!0,status:"pending",requestedAt:p()},updatedAt:p()},{merge:!0})}catch(t){console.warn("تعذر وسم المستخدم كباقة فروع:",t)}a.success("تم تسجيل الدخول بنجاح"),y("/cpanel")}catch(r){a.error((r==null?void 0:r.message)||"فشل تسجيل الدخول، حاول مرة أخرى")}finally{u(!1)}};return e.jsx("div",{className:"min-h-screen bg-background px-4 py-8 flex items-center justify-center",children:e.jsxs(D,{className:"w-full max-w-md",children:[e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-6 h-6"}),e.jsx(G,{children:"تسجيل دخول لوحة التحكم"})]}),e.jsx(U,{children:"ادخل باستخدام بريدك الإلكتروني وكلمة المرور"})]}),e.jsx(L,{children:e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"email",children:"البريد الإلكتروني"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute right-3 top-2.5 w-5 h-5 text-muted-foreground"}),e.jsx(x,{id:"email",type:"email",value:o,onChange:s=>{const l=s.target.value;m(l);try{window.localStorage.setItem("cashy:lastEmail",l)}catch{}},placeholder:"example@mail.com",className:"pr-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"password",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute right-3 top-2.5 w-5 h-5 text-muted-foreground"}),e.jsx(x,{id:"password",type:c?"text":"password",value:i,onChange:s=>j(s.target.value),placeholder:"••••••••",className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>g(s=>!s),className:"absolute left-3 top-2.5 text-muted-foreground","aria-label":c?"إخفاء كلمة المرور":"إظهار كلمة المرور",children:c?e.jsx(F,{className:"w-5 h-5"}):e.jsx(I,{className:"w-5 h-5"})})]})]}),e.jsx("button",{type:"submit",onClick:s=>{d?(s.preventDefault(),s.stopPropagation(),a.info("جارٍ تنفيذ تسجيل الدخول، يرجى الانتظار...")):typeof navigator<"u"&&navigator.onLine===!1?(s.preventDefault(),s.stopPropagation(),a.error("لا يوجد اتصال بالإنترنت. يرجى التأكد من الشبكة ثم المحاولة.")):(o||a.error("يرجى إدخال البريد الإلكتروني"),i||a.error("يرجى إدخال كلمة المرور"))},className:"w-full inline-flex items-center justify-center gap-2 rounded-md bg-primary px-4 py-2 text-white hover:opacity-90",children:d?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white ml-2"}),"جاري تسجيل الدخول..."]}):e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(k,{className:"w-5 h-5 ml-2"}),"تسجيل الدخول"]})}),e.jsxs("div",{className:"mt-4 text-center space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"نسيت كلمة المرور؟"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(h,{to:"/user/forgot-password",className:"text-primary text-sm",children:"إعادة تعيين كلمة المرور"}),e.jsx("span",{className:"text-muted-foreground",children:"•"}),e.jsx(h,{to:"/auth?mode=signup",className:"text-primary text-sm",children:"إنشاء حساب جديد"})]})]})]})})]})})};export{J as default};
//# sourceMappingURL=CPanelLoginPage-Zrepfhau-pGUMeqjt.js.map
