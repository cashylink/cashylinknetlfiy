import{u as M,r as t,j as e,B as j,W as B,X as E,Y as I,Z as L,I as d,_ as H,m as O,n as T}from"./index-Dosh6Hoe.js";import{C as R,a as W,b as X,d as Y}from"./card-nd4SlYrT.js";import{L as o}from"./label-1gjWFhmG.js";function q(){var w;const{user:v,profile:n,isSubscriptionActive:y,userSubscription:m}=M(),[P,c]=t.useState(!1),[h,C]=t.useState(""),[x,N]=t.useState(""),[g,f]=t.useState(""),[u,b]=t.useState(""),[p,F]=t.useState(!1),[S,l]=t.useState(null),k=((w=m==null?void 0:m.branchPackage)==null?void 0:w.status)==="active",i=(n==null?void 0:n.role)==="admin"||(n==null?void 0:n.role)==="merchant"||y||k,D=()=>{C(""),N(""),f(""),b("")},A=async()=>{if(l(null),!i){l("هذه العملية تتطلب اشتراكًا مفعلًا أو صلاحية مدير/تاجر.");return}if(!h||!x||!g||!u){l("يرجى ملء جميع الحقول المطلوبة.");return}try{F(!0);const r=await O(T,"createShopAndManager")({shopName:h,managerName:x,email:g,password:u}),a=r==null?void 0:r.data;l(a!=null&&a.success?`تم إنشاء المتجر (${a.shopId}) ومدير الحساب بنجاح.`:"فشل إنشاء الحساب، حاول مرة أخرى."),a!=null&&a.success&&(D(),c(!1))}catch(s){const r=(s==null?void 0:s.message)||"حدث خطأ غير متوقع أثناء الإنشاء";l(r)}finally{F(!1)}};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs(R,{children:[e.jsx(W,{children:e.jsx(X,{children:"لوحة التحكم (CPanel)"})}),e.jsxs(Y,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"إضافة محل جديد مع إنشاء حساب المدير ليتسجل من صفحة الدخول العادية."})}),e.jsx(j,{onClick:()=>c(!0),disabled:!i,children:"إضافة محل"})]}),!v&&e.jsx("p",{className:"mt-3 text-sm text-red-600",children:"يجب تسجيل الدخول للوصول إلى لوحة التحكم."}),v&&!i&&e.jsx("p",{className:"mt-3 text-sm text-red-600",children:"حسابك ليس لديه صلاحيات كافية أو اشتراك/باقة فروع مفعّلة لإنشاء المحلات. إذا كنت مشتركًا بباقة مدفوعة أو لديك باقة فروع مفعّلة، ستتمكن من إضافة الحسابات مباشرة."})]})]}),e.jsx(B,{open:P,onOpenChange:c,children:e.jsxs(E,{children:[e.jsx(I,{children:e.jsx(L,{children:"إضافة محل ومدير"})}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"shopName",children:"اسم المحل"}),e.jsx(d,{id:"shopName",value:h,onChange:s=>C(s.target.value),placeholder:"مثال: متجر أحمد"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"managerName",children:"اسم المدير"}),e.jsx(d,{id:"managerName",value:x,onChange:s=>N(s.target.value),placeholder:"مثال: أحمد علي"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"email",children:"الإيميل"}),e.jsx(d,{id:"email",type:"email",value:g,onChange:s=>f(s.target.value),placeholder:"example@mail.com"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"password",children:"الباسوورد"}),e.jsx(d,{id:"password",type:"password",value:u,onChange:s=>b(s.target.value),placeholder:"••••••••"})]}),S&&e.jsx("p",{className:"text-sm text-muted-foreground",children:S})]}),e.jsxs(H,{children:[e.jsx(j,{variant:"outline",onClick:()=>c(!1),disabled:p,children:"إلغاء"}),e.jsx(j,{onClick:A,disabled:p||!i,children:p?"جاري الإنشاء...":"إنشاء الحساب"})]})]})})]})}export{q as default};
//# sourceMappingURL=CPanelPage-CyC65jdS.js.map
