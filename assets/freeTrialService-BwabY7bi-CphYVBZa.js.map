{"version":3,"file":"freeTrialService-BwabY7bi-CphYVBZa.js","sources":["../../assets/freeTrialService-BwabY7bi.js"],"sourcesContent":["var O=Object.defineProperty;var A=(m,a,e)=>a in m?O(m,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[a]=e;var S=(m,a,e)=>A(m,typeof a!=\"symbol\"?a+\"\":a,e);import{y as f,i as D,K as g,H as w,s as h,F as U,O as p}from\"./index-tnWDkOuX.js\";class x{static async startFreeTrialFromAdmin(a){var e,i,r,l;try{const s=f(D,\"users\",a),o=await g(s);if(!o.exists())return{success:!1,message:\"المستخدم غير موجود\"};const t=o.data(),n=!!t.hasUsedFreeTrial,T=(i=(e=t.freeTrialStartDate)==null?void 0:e.toDate)!=null&&i.call(e)?t.freeTrialStartDate.toDate():t.freeTrialStartDate?new Date(t.freeTrialStartDate):null,d=(l=(r=t.freeTrialEndDate)==null?void 0:r.toDate)!=null&&l.call(r)?t.freeTrialEndDate.toDate():t.freeTrialEndDate?new Date(t.freeTrialEndDate):null;if(n&&!(n&&!T&&!d))return{success:!1,message:\"لقد استخدم هذا المستخدم التجربة المجانية من قبل\"};const u=new Date,c=await this.getTrialDurationHours(),E=new Date(u.getTime()+c*60*60*1e3);return await w(s,{hasUsedFreeTrial:!0,freeTrialStartDate:u,freeTrialEndDate:E,isOnFreeTrial:!0,isActive:!0,approved:!0,updatedAt:h()},{merge:!0}),{success:!0,message:`تم تفعيل التجربة المجانية لمدة ${c} ${c>=3&&c<=10?\"ساعات\":c===2?\"ساعتين\":\"ساعة\"}`}}catch(s){return console.error(\"Error starting admin free trial:\",s),{success:!1,message:\"حدث خطأ أثناء تفعيل التجربة المجانية\"}}}static async startFreeTrial(a){var e,i,r,l;try{const s=f(D,\"users\",a),o=await g(s);if(!o.exists())return{success:!1,message:\"المستخدم غير موجود\"};const t=o.data(),n=!!t.hasUsedFreeTrial,T=(i=(e=t.freeTrialStartDate)==null?void 0:e.toDate)!=null&&i.call(e)?t.freeTrialStartDate.toDate():t.freeTrialStartDate?new Date(t.freeTrialStartDate):null,d=(l=(r=t.freeTrialEndDate)==null?void 0:r.toDate)!=null&&l.call(r)?t.freeTrialEndDate.toDate():t.freeTrialEndDate?new Date(t.freeTrialEndDate):null;if(n&&!(n&&!T&&!d))return{success:!1,message:\"لقد استخدمت التجربة المجانية من قبل\"};const u=new Date,c=await this.getTrialDurationHours(),E=new Date(u.getTime()+c*60*60*1e3);return await w(s,{hasUsedFreeTrial:!0,freeTrialStartDate:u,freeTrialEndDate:E,isOnFreeTrial:!0,isActive:!0,approved:!0,updatedAt:h()},{merge:!0}),{success:!0,message:`تم تفعيل التجربة المجانية لمدة ${c} ${c>=3&&c<=10?\"ساعات\":c===2?\"ساعتين\":\"ساعة\"}`}}catch(s){return console.error(\"خطأ في بدء التجربة المجانية:\",s),{success:!1,message:\"حدث خطأ أثناء تفعيل التجربة المجانية\"}}}static async checkTrialValidity(a){var e,i,r,l;try{const s=f(D,\"users\",a),o=await g(s);if(!o.exists())return{isValid:!1,isExpired:!1,hoursRemaining:0,hasUsedTrial:!1};const t=o.data(),n=t.hasUsedFreeTrial||!1,T=t.isOnFreeTrial||!1;let d=(i=(e=t.freeTrialEndDate)==null?void 0:e.toDate)!=null&&i.call(e)?t.freeTrialEndDate.toDate():t.freeTrialEndDate?new Date(t.freeTrialEndDate):null;const F=(l=(r=t.freeTrialStartDate)==null?void 0:r.toDate)!=null&&l.call(r)?t.freeTrialStartDate.toDate():t.freeTrialStartDate?new Date(t.freeTrialStartDate):null;if(!n||!T||!d)return{isValid:!1,isExpired:!1,hoursRemaining:0,hasUsedTrial:n};const u=new Date;if(u>d){const R=U(t.subscription);return await p(s,{isOnFreeTrial:!1,isActive:R,approved:R,updatedAt:h()}),{isValid:!1,isExpired:!0,hoursRemaining:0,hasUsedTrial:n}}const E=d.getTime()-u.getTime();return{isValid:!0,isExpired:!1,hoursRemaining:Math.ceil(E/(1e3*3600)),hasUsedTrial:n}}catch(s){return console.error(\"خطأ في التحقق من صلاحية التجربة المجانية:\",s),{isValid:!1,isExpired:!1,hoursRemaining:0,hasUsedTrial:!1}}}static async getTrialData(a){var e,i;try{const r=f(D,\"users\",a),l=await g(r);if(!l.exists())return{hasUsedFreeTrial:!1,freeTrialStartDate:null,freeTrialEndDate:null,isOnFreeTrial:!1};const s=l.data();return{hasUsedFreeTrial:s.hasUsedFreeTrial||!1,freeTrialStartDate:((e=s.freeTrialStartDate)==null?void 0:e.toDate())||null,freeTrialEndDate:((i=s.freeTrialEndDate)==null?void 0:i.toDate())||null,isOnFreeTrial:s.isOnFreeTrial||!1}}catch(r){return console.error(\"خطأ في الحصول على بيانات التجربة المجانية:\",r),{hasUsedFreeTrial:!1,freeTrialStartDate:null,freeTrialEndDate:null,isOnFreeTrial:!1}}}static async getTrialDurationHours(){try{const a=f(D,\"config\",\"freeTrial\"),e=await g(a);if(e.exists()){const i=e.data(),r=typeof(i==null?void 0:i.durationHours)==\"number\"?i.durationHours:this.TRIAL_DURATION_HOURS;return!Number.isFinite(r)||r<1?this.TRIAL_DURATION_HOURS:r}return this.TRIAL_DURATION_HOURS}catch(a){return console.warn(\"getTrialDurationHours: fallback to default due to error\",a),this.TRIAL_DURATION_HOURS}}static async updateTrialDurationHours(a){try{if(!Number.isFinite(a)||a<1)return{success:!1,message:\"المدة يجب أن تكون ساعة واحدة على الأقل\"};const e=f(D,\"config\",\"freeTrial\");return await w(e,{durationHours:a,updatedAt:h()},{merge:!0}),{success:!0,message:\"تم تحديث مدة التجربة المجانية بنجاح\"}}catch(e){return console.error(\"Error updating trial duration hours:\",e),{success:!1,message:\"تعذر تحديث مدة التجربة المجانية\"}}}static async resetActiveTrialToCurrentDuration(a){var e,i;try{const r=f(D,\"users\",a),l=await g(r);if(!l.exists())return{success:!1,message:\"المستخدم غير موجود\"};const s=l.data(),o=!!s.isOnFreeTrial,t=(i=(e=s.freeTrialStartDate)==null?void 0:e.toDate)!=null&&i.call(e)?s.freeTrialStartDate.toDate():s.freeTrialStartDate?new Date(s.freeTrialStartDate):null;if(!o||!t)return{success:!1,message:\"لا توجد تجربة نشطة لإعادة ضبطها\"};const n=await this.getTrialDurationHours(),T=new Date(t.getTime()+n*60*60*1e3);return await p(r,{freeTrialEndDate:T,updatedAt:h()}),{success:!0,message:`تم ضبط نهاية التجربة إلى ${n} ${n>=3&&n<=10?\"ساعات\":n===2?\"ساعتين\":\"ساعة\"}`}}catch(r){return console.error(\"Error resetting active trial duration:\",r),{success:!1,message:\"تعذر إعادة ضبط مدة التجربة\"}}}static async cancelActiveFreeTrial(a){try{const e=f(D,\"users\",a),i=await g(e);return i.exists()?!i.data().isOnFreeTrial?{success:!1,message:\"لا توجد تجربة مجانية نشطة لهذا المستخدم\"}:(await p(e,{isOnFreeTrial:!1,isActive:!1,approved:!1,freeTrialEndDate:new Date,updatedAt:h()}),{success:!0,message:\"تم إلغاء التجربة المجانية وحُوّل الحساب إلى طلب تفعيل\"}):{success:!1,message:\"المستخدم غير موجود\"}}catch(e){return console.error(\"Error cancelling active free trial:\",e),{success:!1,message:\"تعذر إلغاء التجربة المجانية الآن\"}}}}S(x,\"TRIAL_DURATION_HOURS\",4);export{x as FreeTrialService};\r\n//# sourceMappingURL=freeTrialService-BwabY7bi.js.map\r\n"],"names":["O","A","m","a","S","x","r","l","s","f","D","o","g","t","n","T","d","u","c","E","w","h","F","R","U","p"],"mappings":"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"}