const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-mBSeGJ8K.js","./index-BsQ0vdi0.css","./WalletManagement-BoLvPBKD.js","./badge-D4Cxv57Q.js","./select-DGk4nkpB.js","./wallet-Li-2CV_d.js","./star-C5V4W3t-.js","./square-pen-7FbzHXSb.js","./arrow-left-CoPISNIk.js","./progress-D2Zt4W_R.js","./separator-xJo-nMhI.js","./calendar-DWuCbuTk.js","./chart-column-BnYh_Cge.js","./trending-down-BedbHO92.js","./dollar-sign-tQQ_yre_.js","./activity-C3VcmJNL.js","./circle-x-bWAeF-qD.js","./circle-check-big-C-Uwjs2Z.js","./TransactionDetailsModal-CSxn9Q83.js","./formatters-CO_Y-NDe.js","./printer-C-vYmUsl.js","./ReceiptModal-BFQZdr4L.js","./html2canvas.esm-BfYXEYrK.js","./download-C_W4yx38.js","./EditBalanceDialog-qarNPs8R.js","./ChangePinDialog-Cnqn4nfu.js","./ChangeCashPinDialog-DedQlkhY.js","./ChangeWalletTotalPinDialog-UbPmSLD7.js","./AddToWalletDialog-ib4x4avS.js","./CalculatorDialog-jmN5iz8h.js","./SalesDataDialog-DCdwk3tK.js","./table-B-2w-DVH.js","./tabs-B85OgytT.js","./index-B0RoPUtu.js","./dropdown-menu-Dko4WND7.js","./alert-dialog-D8wnEdgQ.js","./refresh-cw-VJ-sBqT-.js","./pen-line-BxM__rGx.js","./ProfileSettingsPage-BvFHeoPd.js","./switch-8_KpJux-.js","./textarea-BSkR6eBq.js","./users-cmuW5heU.js","./crown-y81xSMbP.js","./ProfileIcon-ElnJff9P.js","./freeTrialService-DU8cwcbX.js","./broadcastService-BVTGigy9.js","./bell-DSbPVF9m.js","./profitService-B3iovAHD.js","./arrow-down-left-BTRRls4w.js","./CashSummaryDialog-BCvGvC4U.js","./battery-charging-Odp8Tilx.js","./CreditCardsDialog-DEPojYwD.js","./InstallmentModal-D08gq3I4.js","./MaintenanceDialog-D00XSB7E.js","./MachineDailyDialog-Czf3I2ct.js","./WalletsManagement-DMptkT8R.js","./WalletPrinterDialog-CoSkJsm5.js","./WalletsListDialog-HQlHnCJO.js","./building-2-Da5VmhQg.js","./CashierShiftModal-uXu3l3hI.js","./functions-B8lgosbg.js","./ShiftProfileDialog-DViQNVlG.js","./ChangeLogDialog-D_M__mBy.js","./sparkles-DaLJvhXR.js","./dailyOperationCountService-CUlR8gDE.js"])))=>i.map(i=>d[i]);
import{Z as Qs,r as u,j as e,bq as z0,br as hu,ao as Y0,bs as K0,ai as J0,ak as H0,an as fu,al as gu,am as zr,bt as pu,b7 as xu,bu as Q0,bv as G0,by as X0,bx as Z0,bz as ef,bA as tf,bB as af,bC as sf,a8 as zs,bj as Ed,$ as ti,Q as Te,s as V,Y as Ht,D as wt,o as Us,cq as ts,_ as ca,q as Oe,p as pe,aE as ae,w as ke,u as ol,aa as yu,bF as rf,B as I,aR as ni,R as G,ab as St,H as Ks,ae as fe,af as ge,ag as ye,ah as be,aD as nf,b3 as Md,a3 as Zt,a4 as bu,l as ll,au as Rt,F as Wd,x as Z,I as Y,G as Rd,a2 as of,ad as vu,a5 as is,aJ as at,aM as Pe,a as lf,cr as cf,aF as df,cb as uf,aQ as mf,m as hf,b1 as as,ac as se,aG as X,O as ff,cs as Mr,T as gf,aK as Ld,ct as Wr,aW as pf,C as Ca,c as ss,d as rs,as as oa,aO as Qn,aT as Rr,f as Ia,a0 as jt,b5 as xf,S as Lr,a1 as yf,cu as bf,U as Fr,b0 as Fd,aH as vf,ar as Br,bH as Bd,P as Gn,aN as Xn,a7 as $d,at as Zn,M as zo,aC as ei,bI as wf,bJ as Nf,bK as jf,bL as Sf,bM as Df,A as Yo,bN as kf,bO as Ud,aq as Xt,cv as Cf,t as If,v as _f,b4 as $r,bo as Tf,cw as Af,bX as Ko,cx as Vd,cy as Pf}from"./index-mBSeGJ8K.js";import{C as Of,P as Ef,a as Mf,w as Wf}from"./ProfileSettingsPage-BvFHeoPd.js";import{B as _a}from"./badge-D4Cxv57Q.js";import{S as Rf,T as Lf,a as Ff,b as qd,c as zd}from"./tabs-B85OgytT.js";import{C as Bf,f as $f,S as Ws,a as Rs,b as Ls,c as Fs,d as Ta}from"./select-DGk4nkpB.js";import{C as Uf,D as Vf,a as qf,b as zf,c as Yf,d as Kf}from"./dropdown-menu-Dko4WND7.js";import{L as Ur,S as Jf}from"./switch-8_KpJux-.js";import{P as Hf}from"./ProfileIcon-ElnJff9P.js";import{E as Qf,a as Gf}from"./broadcastService-BVTGigy9.js";import{B as Jo}from"./bell-DSbPVF9m.js";import{C as ai}from"./circle-check-big-C-Uwjs2Z.js";import{ProfitService as xa}from"./profitService-B3iovAHD.js";import{C as si}from"./calendar-DWuCbuTk.js";import{A as Vs}from"./arrow-down-left-BTRRls4w.js";import{A as wu,u as Vr,f as Jt,C as Xf,a as Ho,b as Yd}from"./formatters-CO_Y-NDe.js";import{D as Pa}from"./dollar-sign-tQQ_yre_.js";import{FreeTrialService as Kd}from"./freeTrialService-DU8cwcbX.js";import{W as Bs}from"./wallet-Li-2CV_d.js";import{C as Zf}from"./crown-y81xSMbP.js";import{R as Qo}from"./refresh-cw-VJ-sBqT-.js";import{a as Jd}from"./square-pen-7FbzHXSb.js";import{P as eg}from"./printer-C-vYmUsl.js";import{S as tg}from"./star-C5V4W3t-.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ag=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],Hd=Qs("banknote",ag);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sg=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],Qd=Qs("calendar-days",sg);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rg=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ng=Qs("chevron-left",rg);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ig=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],og=Qs("circle-plus",ig);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lg=[["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["path",{d:"M16 2v20",key:"rotuqe"}]],Gd=Qs("notebook",lg);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cg=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Nu=Qs("package",cg);function dg(s){const t=ug(s),n=u.forwardRef((o,c)=>{const{children:f,...b}=o,N=u.Children.toArray(f),j=N.find(hg);if(j){const D=j.props.children,C=N.map(P=>P===j?u.Children.count(D)>1?u.Children.only(null):u.isValidElement(D)?D.props.children:null:P);return e.jsx(t,{...b,ref:c,children:u.isValidElement(D)?u.cloneElement(D,void 0,C):null})}return e.jsx(t,{...b,ref:c,children:f})});return n.displayName=`${s}.Slot`,n}function ug(s){const t=u.forwardRef((n,o)=>{const{children:c,...f}=n;if(u.isValidElement(c)){const b=gg(c),N=fg(f,c.props);return c.type!==u.Fragment&&(N.ref=o?z0(o,b):b),u.cloneElement(c,N)}return u.Children.count(c)>1?u.Children.only(null):null});return t.displayName=`${s}.SlotClone`,t}var mg=Symbol("radix.slottable");function hg(s){return u.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===mg}function fg(s,t){const n={...t};for(const o in t){const c=s[o],f=t[o];/^on[A-Z]/.test(o)?c&&f?n[o]=(...N)=>{const j=f(...N);return c(...N),j}:c&&(n[o]=c):o==="style"?n[o]={...c,...f}:o==="className"&&(n[o]=[c,f].filter(Boolean).join(" "))}return{...s,...n}}function gg(s){var o,c;let t=(o=Object.getOwnPropertyDescriptor(s.props,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?s.ref:(t=(c=Object.getOwnPropertyDescriptor(s,"ref"))==null?void 0:c.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?s.props.ref:s.props.ref||s.ref)}var li="Popover",[ju]=J0(li,[hu]),Kr=hu(),[pg,Ua]=ju(li),Su=s=>{const{__scopePopover:t,children:n,open:o,defaultOpen:c,onOpenChange:f,modal:b=!1}=s,N=Kr(t),j=u.useRef(null),[D,C]=u.useState(!1),[P,M]=Y0({prop:o,defaultProp:c??!1,onChange:f,caller:li});return e.jsx(K0,{...N,children:e.jsx(pg,{scope:t,contentId:H0(),triggerRef:j,open:P,onOpenChange:M,onOpenToggle:u.useCallback(()=>M(p=>!p),[M]),hasCustomAnchor:D,onCustomAnchorAdd:u.useCallback(()=>C(!0),[]),onCustomAnchorRemove:u.useCallback(()=>C(!1),[]),modal:b,children:n})})};Su.displayName=li;var Du="PopoverAnchor",xg=u.forwardRef((s,t)=>{const{__scopePopover:n,...o}=s,c=Ua(Du,n),f=Kr(n),{onCustomAnchorAdd:b,onCustomAnchorRemove:N}=c;return u.useEffect(()=>(b(),()=>N()),[b,N]),e.jsx(pu,{...f,...o,ref:t})});xg.displayName=Du;var ku="PopoverTrigger",Cu=u.forwardRef((s,t)=>{const{__scopePopover:n,...o}=s,c=Ua(ku,n),f=Kr(n),b=fu(t,c.triggerRef),N=e.jsx(gu.button,{type:"button","aria-haspopup":"dialog","aria-expanded":c.open,"aria-controls":c.contentId,"data-state":Pu(c.open),...o,ref:b,onClick:zr(s.onClick,c.onOpenToggle)});return c.hasCustomAnchor?N:e.jsx(pu,{asChild:!0,...f,children:N})});Cu.displayName=ku;var cl="PopoverPortal",[yg,bg]=ju(cl,{forceMount:void 0}),Iu=s=>{const{__scopePopover:t,forceMount:n,children:o,container:c}=s,f=Ua(cl,t);return e.jsx(yg,{scope:t,forceMount:n,children:e.jsx(xu,{present:n||f.open,children:e.jsx(Q0,{asChild:!0,container:c,children:o})})})};Iu.displayName=cl;var Js="PopoverContent",_u=u.forwardRef((s,t)=>{const n=bg(Js,s.__scopePopover),{forceMount:o=n.forceMount,...c}=s,f=Ua(Js,s.__scopePopover);return e.jsx(xu,{present:o||f.open,children:f.modal?e.jsx(wg,{...c,ref:t}):e.jsx(Ng,{...c,ref:t})})});_u.displayName=Js;var vg=dg("PopoverContent.RemoveScroll"),wg=u.forwardRef((s,t)=>{const n=Ua(Js,s.__scopePopover),o=u.useRef(null),c=fu(t,o),f=u.useRef(!1);return u.useEffect(()=>{const b=o.current;if(b)return G0(b)},[]),e.jsx(X0,{as:vg,allowPinchZoom:!0,children:e.jsx(Tu,{...s,ref:c,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:zr(s.onCloseAutoFocus,b=>{var N;b.preventDefault(),f.current||(N=n.triggerRef.current)==null||N.focus()}),onPointerDownOutside:zr(s.onPointerDownOutside,b=>{const N=b.detail.originalEvent,j=N.button===0&&N.ctrlKey===!0,D=N.button===2||j;f.current=D},{checkForDefaultPrevented:!1}),onFocusOutside:zr(s.onFocusOutside,b=>b.preventDefault(),{checkForDefaultPrevented:!1})})})}),Ng=u.forwardRef((s,t)=>{const n=Ua(Js,s.__scopePopover),o=u.useRef(!1),c=u.useRef(!1);return e.jsx(Tu,{...s,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:f=>{var b,N;(b=s.onCloseAutoFocus)==null||b.call(s,f),f.defaultPrevented||(o.current||(N=n.triggerRef.current)==null||N.focus(),f.preventDefault()),o.current=!1,c.current=!1},onInteractOutside:f=>{var j,D;(j=s.onInteractOutside)==null||j.call(s,f),f.defaultPrevented||(o.current=!0,f.detail.originalEvent.type==="pointerdown"&&(c.current=!0));const b=f.target;((D=n.triggerRef.current)==null?void 0:D.contains(b))&&f.preventDefault(),f.detail.originalEvent.type==="focusin"&&c.current&&f.preventDefault()}})}),Tu=u.forwardRef((s,t)=>{const{__scopePopover:n,trapFocus:o,onOpenAutoFocus:c,onCloseAutoFocus:f,disableOutsidePointerEvents:b,onEscapeKeyDown:N,onPointerDownOutside:j,onFocusOutside:D,onInteractOutside:C,...P}=s,M=Ua(Js,n),p=Kr(n);return Z0(),e.jsx(ef,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:c,onUnmountAutoFocus:f,children:e.jsx(tf,{asChild:!0,disableOutsidePointerEvents:b,onInteractOutside:C,onEscapeKeyDown:N,onPointerDownOutside:j,onFocusOutside:D,onDismiss:()=>M.onOpenChange(!1),children:e.jsx(af,{"data-state":Pu(M.open),role:"dialog",id:M.contentId,...p,...P,ref:t,style:{...P.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Au="PopoverClose",jg=u.forwardRef((s,t)=>{const{__scopePopover:n,...o}=s,c=Ua(Au,n);return e.jsx(gu.button,{type:"button",...o,ref:t,onClick:zr(s.onClick,()=>c.onOpenChange(!1))})});jg.displayName=Au;var Sg="PopoverArrow",Dg=u.forwardRef((s,t)=>{const{__scopePopover:n,...o}=s,c=Kr(n);return e.jsx(sf,{...c,...o,ref:t})});Dg.displayName=Sg;function Pu(s){return s?"open":"closed"}var kg=Su,Cg=Cu,Ig=Iu,Ou=_u;const Xd=kg,Zd=Cg,sl=u.forwardRef(({className:s,align:t="center",sideOffset:n=4,...o},c)=>e.jsx(Ig,{children:e.jsx(Ou,{ref:c,align:t,sideOffset:n,className:zs("z-[9999] w-72 rounded-xl border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...o})}));sl.displayName=Ou.displayName;function _e(s){const t=Object.prototype.toString.call(s);return s instanceof Date||typeof s=="object"&&t==="[object Date]"?new s.constructor(+s):typeof s=="number"||t==="[object Number]"||typeof s=="string"||t==="[object String]"?new Date(s):new Date(NaN)}function Qt(s,t){return s instanceof Date?new s.constructor(t):new Date(t)}function Pt(s,t){const n=_e(s);return isNaN(t)?Qt(s,NaN):(t&&n.setDate(n.getDate()+t),n)}function ua(s,t){const n=_e(s);if(isNaN(t))return Qt(s,NaN);if(!t)return n;const o=n.getDate(),c=Qt(s,n.getTime());c.setMonth(n.getMonth()+t+1,0);const f=c.getDate();return o>=f?c:(n.setFullYear(c.getFullYear(),c.getMonth(),o),n)}const dl=6048e5,_g=864e5;let Tg={};function Jr(){return Tg}function wa(s,t){var N,j,D,C;const n=Jr(),o=(t==null?void 0:t.weekStartsOn)??((j=(N=t==null?void 0:t.locale)==null?void 0:N.options)==null?void 0:j.weekStartsOn)??n.weekStartsOn??((C=(D=n.locale)==null?void 0:D.options)==null?void 0:C.weekStartsOn)??0,c=_e(s),f=c.getDay(),b=(f<o?7:0)+f-o;return c.setDate(c.getDate()-b),c.setHours(0,0,0,0),c}function os(s){return wa(s,{weekStartsOn:1})}function Eu(s){const t=_e(s),n=t.getFullYear(),o=Qt(s,0);o.setFullYear(n+1,0,4),o.setHours(0,0,0,0);const c=os(o),f=Qt(s,0);f.setFullYear(n,0,4),f.setHours(0,0,0,0);const b=os(f);return t.getTime()>=c.getTime()?n+1:t.getTime()>=b.getTime()?n:n-1}function Hs(s){const t=_e(s);return t.setHours(0,0,0,0),t}function ii(s){const t=_e(s),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+s-+n}function va(s,t){const n=Hs(s),o=Hs(t),c=+n-ii(n),f=+o-ii(o);return Math.round((c-f)/_g)}function Ag(s){const t=Eu(s),n=Qt(s,0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),os(n)}function rl(s,t){const n=t*7;return Pt(s,n)}function Pg(s,t){return ua(s,t*12)}function Og(s){let t;return s.forEach(function(n){const o=_e(n);(t===void 0||t<o||isNaN(Number(o)))&&(t=o)}),t||new Date(NaN)}function Eg(s){let t;return s.forEach(n=>{const o=_e(n);(!t||t>o||isNaN(+o))&&(t=o)}),t||new Date(NaN)}function Lt(s,t){const n=Hs(s),o=Hs(t);return+n==+o}function ul(s){return s instanceof Date||typeof s=="object"&&Object.prototype.toString.call(s)==="[object Date]"}function Mg(s){if(!ul(s)&&typeof s!="number")return!1;const t=_e(s);return!isNaN(Number(t))}function Yr(s,t){const n=_e(s),o=_e(t),c=n.getFullYear()-o.getFullYear(),f=n.getMonth()-o.getMonth();return c*12+f}function Wg(s,t,n){const o=wa(s,n),c=wa(t,n),f=+o-ii(o),b=+c-ii(c);return Math.round((f-b)/dl)}function ml(s){const t=_e(s),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function Ft(s){const t=_e(s);return t.setDate(1),t.setHours(0,0,0,0),t}function Mu(s){const t=_e(s),n=Qt(s,0);return n.setFullYear(t.getFullYear(),0,1),n.setHours(0,0,0,0),n}function hl(s,t){var N,j,D,C;const n=Jr(),o=(t==null?void 0:t.weekStartsOn)??((j=(N=t==null?void 0:t.locale)==null?void 0:N.options)==null?void 0:j.weekStartsOn)??n.weekStartsOn??((C=(D=n.locale)==null?void 0:D.options)==null?void 0:C.weekStartsOn)??0,c=_e(s),f=c.getDay(),b=(f<o?-7:0)+6-(f-o);return c.setDate(c.getDate()+b),c.setHours(23,59,59,999),c}function Wu(s){return hl(s,{weekStartsOn:1})}const Rg={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Lg=(s,t,n)=>{let o;const c=Rg[s];return typeof c=="string"?o=c:t===1?o=c.one:o=c.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+o:o+" ago":o};function Ys(s){return(t={})=>{const n=t.width?String(t.width):s.defaultWidth;return s.formats[n]||s.formats[s.defaultWidth]}}const Fg={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Bg={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},$g={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Ug={date:Ys({formats:Fg,defaultWidth:"full"}),time:Ys({formats:Bg,defaultWidth:"full"}),dateTime:Ys({formats:$g,defaultWidth:"full"})},Vg={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},qg=(s,t,n,o)=>Vg[s];function ya(s){return(t,n)=>{const o=n!=null&&n.context?String(n.context):"standalone";let c;if(o==="formatting"&&s.formattingValues){const b=s.defaultFormattingWidth||s.defaultWidth,N=n!=null&&n.width?String(n.width):b;c=s.formattingValues[N]||s.formattingValues[b]}else{const b=s.defaultWidth,N=n!=null&&n.width?String(n.width):s.defaultWidth;c=s.values[N]||s.values[b]}const f=s.argumentCallback?s.argumentCallback(t):t;return c[f]}}const zg={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Yg={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Kg={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Jg={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Hg={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Qg={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Gg=(s,t)=>{const n=Number(s),o=n%100;if(o>20||o<10)switch(o%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},Xg={ordinalNumber:Gg,era:ya({values:zg,defaultWidth:"wide"}),quarter:ya({values:Yg,defaultWidth:"wide",argumentCallback:s=>s-1}),month:ya({values:Kg,defaultWidth:"wide"}),day:ya({values:Jg,defaultWidth:"wide"}),dayPeriod:ya({values:Hg,defaultWidth:"wide",formattingValues:Qg,defaultFormattingWidth:"wide"})};function ba(s){return(t,n={})=>{const o=n.width,c=o&&s.matchPatterns[o]||s.matchPatterns[s.defaultMatchWidth],f=t.match(c);if(!f)return null;const b=f[0],N=o&&s.parsePatterns[o]||s.parsePatterns[s.defaultParseWidth],j=Array.isArray(N)?ep(N,P=>P.test(b)):Zg(N,P=>P.test(b));let D;D=s.valueCallback?s.valueCallback(j):j,D=n.valueCallback?n.valueCallback(D):D;const C=t.slice(b.length);return{value:D,rest:C}}}function Zg(s,t){for(const n in s)if(Object.prototype.hasOwnProperty.call(s,n)&&t(s[n]))return n}function ep(s,t){for(let n=0;n<s.length;n++)if(t(s[n]))return n}function Ru(s){return(t,n={})=>{const o=t.match(s.matchPattern);if(!o)return null;const c=o[0],f=t.match(s.parsePattern);if(!f)return null;let b=s.valueCallback?s.valueCallback(f[0]):f[0];b=n.valueCallback?n.valueCallback(b):b;const N=t.slice(c.length);return{value:b,rest:N}}}const tp=/^(\d+)(th|st|nd|rd)?/i,ap=/\d+/i,sp={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},rp={any:[/^b/i,/^(a|c)/i]},np={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},ip={any:[/1/i,/2/i,/3/i,/4/i]},op={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},lp={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},cp={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},dp={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},up={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},mp={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},hp={ordinalNumber:Ru({matchPattern:tp,parsePattern:ap,valueCallback:s=>parseInt(s,10)}),era:ba({matchPatterns:sp,defaultMatchWidth:"wide",parsePatterns:rp,defaultParseWidth:"any"}),quarter:ba({matchPatterns:np,defaultMatchWidth:"wide",parsePatterns:ip,defaultParseWidth:"any",valueCallback:s=>s+1}),month:ba({matchPatterns:op,defaultMatchWidth:"wide",parsePatterns:lp,defaultParseWidth:"any"}),day:ba({matchPatterns:cp,defaultMatchWidth:"wide",parsePatterns:dp,defaultParseWidth:"any"}),dayPeriod:ba({matchPatterns:up,defaultMatchWidth:"any",parsePatterns:mp,defaultParseWidth:"any"})},Lu={code:"en-US",formatDistance:Lg,formatLong:Ug,formatRelative:qg,localize:Xg,match:hp,options:{weekStartsOn:0,firstWeekContainsDate:1}};function fp(s){const t=_e(s);return va(t,Mu(t))+1}function Fu(s){const t=_e(s),n=+os(t)-+Ag(t);return Math.round(n/dl)+1}function Bu(s,t){var C,P,M,p;const n=_e(s),o=n.getFullYear(),c=Jr(),f=(t==null?void 0:t.firstWeekContainsDate)??((P=(C=t==null?void 0:t.locale)==null?void 0:C.options)==null?void 0:P.firstWeekContainsDate)??c.firstWeekContainsDate??((p=(M=c.locale)==null?void 0:M.options)==null?void 0:p.firstWeekContainsDate)??1,b=Qt(s,0);b.setFullYear(o+1,0,f),b.setHours(0,0,0,0);const N=wa(b,t),j=Qt(s,0);j.setFullYear(o,0,f),j.setHours(0,0,0,0);const D=wa(j,t);return n.getTime()>=N.getTime()?o+1:n.getTime()>=D.getTime()?o:o-1}function gp(s,t){var N,j,D,C;const n=Jr(),o=(t==null?void 0:t.firstWeekContainsDate)??((j=(N=t==null?void 0:t.locale)==null?void 0:N.options)==null?void 0:j.firstWeekContainsDate)??n.firstWeekContainsDate??((C=(D=n.locale)==null?void 0:D.options)==null?void 0:C.firstWeekContainsDate)??1,c=Bu(s,t),f=Qt(s,0);return f.setFullYear(c,0,o),f.setHours(0,0,0,0),wa(f,t)}function $u(s,t){const n=_e(s),o=+wa(n,t)-+gp(n,t);return Math.round(o/dl)+1}function Ee(s,t){const n=s<0?"-":"",o=Math.abs(s).toString().padStart(t,"0");return n+o}const Ba={y(s,t){const n=s.getFullYear(),o=n>0?n:1-n;return Ee(t==="yy"?o%100:o,t.length)},M(s,t){const n=s.getMonth();return t==="M"?String(n+1):Ee(n+1,2)},d(s,t){return Ee(s.getDate(),t.length)},a(s,t){const n=s.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(s,t){return Ee(s.getHours()%12||12,t.length)},H(s,t){return Ee(s.getHours(),t.length)},m(s,t){return Ee(s.getMinutes(),t.length)},s(s,t){return Ee(s.getSeconds(),t.length)},S(s,t){const n=t.length,o=s.getMilliseconds(),c=Math.trunc(o*Math.pow(10,n-3));return Ee(c,t.length)}},$s={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},eu={G:function(s,t,n){const o=s.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(o,{width:"abbreviated"});case"GGGGG":return n.era(o,{width:"narrow"});case"GGGG":default:return n.era(o,{width:"wide"})}},y:function(s,t,n){if(t==="yo"){const o=s.getFullYear(),c=o>0?o:1-o;return n.ordinalNumber(c,{unit:"year"})}return Ba.y(s,t)},Y:function(s,t,n,o){const c=Bu(s,o),f=c>0?c:1-c;if(t==="YY"){const b=f%100;return Ee(b,2)}return t==="Yo"?n.ordinalNumber(f,{unit:"year"}):Ee(f,t.length)},R:function(s,t){const n=Eu(s);return Ee(n,t.length)},u:function(s,t){const n=s.getFullYear();return Ee(n,t.length)},Q:function(s,t,n){const o=Math.ceil((s.getMonth()+1)/3);switch(t){case"Q":return String(o);case"QQ":return Ee(o,2);case"Qo":return n.ordinalNumber(o,{unit:"quarter"});case"QQQ":return n.quarter(o,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(o,{width:"wide",context:"formatting"})}},q:function(s,t,n){const o=Math.ceil((s.getMonth()+1)/3);switch(t){case"q":return String(o);case"qq":return Ee(o,2);case"qo":return n.ordinalNumber(o,{unit:"quarter"});case"qqq":return n.quarter(o,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(o,{width:"wide",context:"standalone"})}},M:function(s,t,n){const o=s.getMonth();switch(t){case"M":case"MM":return Ba.M(s,t);case"Mo":return n.ordinalNumber(o+1,{unit:"month"});case"MMM":return n.month(o,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(o,{width:"wide",context:"formatting"})}},L:function(s,t,n){const o=s.getMonth();switch(t){case"L":return String(o+1);case"LL":return Ee(o+1,2);case"Lo":return n.ordinalNumber(o+1,{unit:"month"});case"LLL":return n.month(o,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(o,{width:"wide",context:"standalone"})}},w:function(s,t,n,o){const c=$u(s,o);return t==="wo"?n.ordinalNumber(c,{unit:"week"}):Ee(c,t.length)},I:function(s,t,n){const o=Fu(s);return t==="Io"?n.ordinalNumber(o,{unit:"week"}):Ee(o,t.length)},d:function(s,t,n){return t==="do"?n.ordinalNumber(s.getDate(),{unit:"date"}):Ba.d(s,t)},D:function(s,t,n){const o=fp(s);return t==="Do"?n.ordinalNumber(o,{unit:"dayOfYear"}):Ee(o,t.length)},E:function(s,t,n){const o=s.getDay();switch(t){case"E":case"EE":case"EEE":return n.day(o,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(o,{width:"short",context:"formatting"});case"EEEE":default:return n.day(o,{width:"wide",context:"formatting"})}},e:function(s,t,n,o){const c=s.getDay(),f=(c-o.weekStartsOn+8)%7||7;switch(t){case"e":return String(f);case"ee":return Ee(f,2);case"eo":return n.ordinalNumber(f,{unit:"day"});case"eee":return n.day(c,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(c,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(c,{width:"short",context:"formatting"});case"eeee":default:return n.day(c,{width:"wide",context:"formatting"})}},c:function(s,t,n,o){const c=s.getDay(),f=(c-o.weekStartsOn+8)%7||7;switch(t){case"c":return String(f);case"cc":return Ee(f,t.length);case"co":return n.ordinalNumber(f,{unit:"day"});case"ccc":return n.day(c,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(c,{width:"narrow",context:"standalone"});case"cccccc":return n.day(c,{width:"short",context:"standalone"});case"cccc":default:return n.day(c,{width:"wide",context:"standalone"})}},i:function(s,t,n){const o=s.getDay(),c=o===0?7:o;switch(t){case"i":return String(c);case"ii":return Ee(c,t.length);case"io":return n.ordinalNumber(c,{unit:"day"});case"iii":return n.day(o,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(o,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(o,{width:"short",context:"formatting"});case"iiii":default:return n.day(o,{width:"wide",context:"formatting"})}},a:function(s,t,n){const c=s.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(c,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(c,{width:"wide",context:"formatting"})}},b:function(s,t,n){const o=s.getHours();let c;switch(o===12?c=$s.noon:o===0?c=$s.midnight:c=o/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(c,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(c,{width:"wide",context:"formatting"})}},B:function(s,t,n){const o=s.getHours();let c;switch(o>=17?c=$s.evening:o>=12?c=$s.afternoon:o>=4?c=$s.morning:c=$s.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(c,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(c,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(c,{width:"wide",context:"formatting"})}},h:function(s,t,n){if(t==="ho"){let o=s.getHours()%12;return o===0&&(o=12),n.ordinalNumber(o,{unit:"hour"})}return Ba.h(s,t)},H:function(s,t,n){return t==="Ho"?n.ordinalNumber(s.getHours(),{unit:"hour"}):Ba.H(s,t)},K:function(s,t,n){const o=s.getHours()%12;return t==="Ko"?n.ordinalNumber(o,{unit:"hour"}):Ee(o,t.length)},k:function(s,t,n){let o=s.getHours();return o===0&&(o=24),t==="ko"?n.ordinalNumber(o,{unit:"hour"}):Ee(o,t.length)},m:function(s,t,n){return t==="mo"?n.ordinalNumber(s.getMinutes(),{unit:"minute"}):Ba.m(s,t)},s:function(s,t,n){return t==="so"?n.ordinalNumber(s.getSeconds(),{unit:"second"}):Ba.s(s,t)},S:function(s,t){return Ba.S(s,t)},X:function(s,t,n){const o=s.getTimezoneOffset();if(o===0)return"Z";switch(t){case"X":return au(o);case"XXXX":case"XX":return ns(o);case"XXXXX":case"XXX":default:return ns(o,":")}},x:function(s,t,n){const o=s.getTimezoneOffset();switch(t){case"x":return au(o);case"xxxx":case"xx":return ns(o);case"xxxxx":case"xxx":default:return ns(o,":")}},O:function(s,t,n){const o=s.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+tu(o,":");case"OOOO":default:return"GMT"+ns(o,":")}},z:function(s,t,n){const o=s.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+tu(o,":");case"zzzz":default:return"GMT"+ns(o,":")}},t:function(s,t,n){const o=Math.trunc(s.getTime()/1e3);return Ee(o,t.length)},T:function(s,t,n){const o=s.getTime();return Ee(o,t.length)}};function tu(s,t=""){const n=s>0?"-":"+",o=Math.abs(s),c=Math.trunc(o/60),f=o%60;return f===0?n+String(c):n+String(c)+t+Ee(f,2)}function au(s,t){return s%60===0?(s>0?"-":"+")+Ee(Math.abs(s)/60,2):ns(s,t)}function ns(s,t=""){const n=s>0?"-":"+",o=Math.abs(s),c=Ee(Math.trunc(o/60),2),f=Ee(o%60,2);return n+c+t+f}const su=(s,t)=>{switch(s){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Uu=(s,t)=>{switch(s){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},pp=(s,t)=>{const n=s.match(/(P+)(p+)?/)||[],o=n[1],c=n[2];if(!c)return su(s,t);let f;switch(o){case"P":f=t.dateTime({width:"short"});break;case"PP":f=t.dateTime({width:"medium"});break;case"PPP":f=t.dateTime({width:"long"});break;case"PPPP":default:f=t.dateTime({width:"full"});break}return f.replace("{{date}}",su(o,t)).replace("{{time}}",Uu(c,t))},xp={p:Uu,P:pp},yp=/^D+$/,bp=/^Y+$/,vp=["D","DD","YY","YYYY"];function wp(s){return yp.test(s)}function Np(s){return bp.test(s)}function jp(s,t,n){const o=Sp(s,t,n);if(console.warn(o),vp.includes(s))throw new RangeError(o)}function Sp(s,t,n){const o=s[0]==="Y"?"years":"days of the month";return`Use \`${s.toLowerCase()}\` instead of \`${s}\` (in \`${t}\`) for formatting ${o} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Dp=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,kp=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Cp=/^'([^]*?)'?$/,Ip=/''/g,_p=/[a-zA-Z]/;function da(s,t,n){var C,P,M,p,q,ee,$,xe;const o=Jr(),c=(n==null?void 0:n.locale)??o.locale??Lu,f=(n==null?void 0:n.firstWeekContainsDate)??((P=(C=n==null?void 0:n.locale)==null?void 0:C.options)==null?void 0:P.firstWeekContainsDate)??o.firstWeekContainsDate??((p=(M=o.locale)==null?void 0:M.options)==null?void 0:p.firstWeekContainsDate)??1,b=(n==null?void 0:n.weekStartsOn)??((ee=(q=n==null?void 0:n.locale)==null?void 0:q.options)==null?void 0:ee.weekStartsOn)??o.weekStartsOn??((xe=($=o.locale)==null?void 0:$.options)==null?void 0:xe.weekStartsOn)??0,N=_e(s);if(!Mg(N))throw new RangeError("Invalid time value");let j=t.match(kp).map(L=>{const J=L[0];if(J==="p"||J==="P"){const te=xp[J];return te(L,c.formatLong)}return L}).join("").match(Dp).map(L=>{if(L==="''")return{isToken:!1,value:"'"};const J=L[0];if(J==="'")return{isToken:!1,value:Tp(L)};if(eu[J])return{isToken:!0,value:L};if(J.match(_p))throw new RangeError("Format string contains an unescaped latin alphabet character `"+J+"`");return{isToken:!1,value:L}});c.localize.preprocessor&&(j=c.localize.preprocessor(N,j));const D={firstWeekContainsDate:f,weekStartsOn:b,locale:c};return j.map(L=>{if(!L.isToken)return L.value;const J=L.value;(!(n!=null&&n.useAdditionalWeekYearTokens)&&Np(J)||!(n!=null&&n.useAdditionalDayOfYearTokens)&&wp(J))&&jp(J,t,String(s));const te=eu[J[0]];return te(N,J,c.localize,D)}).join("")}function Tp(s){const t=s.match(Cp);return t?t[1].replace(Ip,"'"):s}function Ap(s){const t=_e(s),n=t.getFullYear(),o=t.getMonth(),c=Qt(s,0);return c.setFullYear(n,o+1,0),c.setHours(0,0,0,0),c.getDate()}function Pp(s){return Math.trunc(+_e(s)/1e3)}function Op(s){const t=_e(s),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(0,0,0,0),t}function Ep(s,t){return Wg(Op(s),Ft(s),t)+1}function nl(s,t){const n=_e(s),o=_e(t);return n.getTime()>o.getTime()}function Vu(s,t){const n=_e(s),o=_e(t);return+n<+o}function fl(s,t){const n=_e(s),o=_e(t);return n.getFullYear()===o.getFullYear()&&n.getMonth()===o.getMonth()}function Mp(s,t){const n=_e(s),o=_e(t);return n.getFullYear()===o.getFullYear()}function Go(s,t){return Pt(s,-t)}function Xo(s,t){const n=_e(s),o=n.getFullYear(),c=n.getDate(),f=Qt(s,0);f.setFullYear(o,t,15),f.setHours(0,0,0,0);const b=Ap(f);return n.setMonth(t,Math.min(c,b)),n}function ru(s,t){const n=_e(s);return isNaN(+n)?Qt(s,NaN):(n.setFullYear(t),n)}const Wp={lessThanXSeconds:{one:"أقل من ثانية",two:"أقل من ثانيتين",threeToTen:"أقل من {{count}} ثواني",other:"أقل من {{count}} ثانية"},xSeconds:{one:"ثانية واحدة",two:"ثانيتان",threeToTen:"{{count}} ثواني",other:"{{count}} ثانية"},halfAMinute:"نصف دقيقة",lessThanXMinutes:{one:"أقل من دقيقة",two:"أقل من دقيقتين",threeToTen:"أقل من {{count}} دقائق",other:"أقل من {{count}} دقيقة"},xMinutes:{one:"دقيقة واحدة",two:"دقيقتان",threeToTen:"{{count}} دقائق",other:"{{count}} دقيقة"},aboutXHours:{one:"ساعة واحدة تقريباً",two:"ساعتين تقريبا",threeToTen:"{{count}} ساعات تقريباً",other:"{{count}} ساعة تقريباً"},xHours:{one:"ساعة واحدة",two:"ساعتان",threeToTen:"{{count}} ساعات",other:"{{count}} ساعة"},xDays:{one:"يوم واحد",two:"يومان",threeToTen:"{{count}} أيام",other:"{{count}} يوم"},aboutXWeeks:{one:"أسبوع واحد تقريبا",two:"أسبوعين تقريبا",threeToTen:"{{count}} أسابيع تقريبا",other:"{{count}} أسبوعا تقريبا"},xWeeks:{one:"أسبوع واحد",two:"أسبوعان",threeToTen:"{{count}} أسابيع",other:"{{count}} أسبوعا"},aboutXMonths:{one:"شهر واحد تقريباً",two:"شهرين تقريبا",threeToTen:"{{count}} أشهر تقريبا",other:"{{count}} شهرا تقريباً"},xMonths:{one:"شهر واحد",two:"شهران",threeToTen:"{{count}} أشهر",other:"{{count}} شهرا"},aboutXYears:{one:"سنة واحدة تقريباً",two:"سنتين تقريبا",threeToTen:"{{count}} سنوات تقريباً",other:"{{count}} سنة تقريباً"},xYears:{one:"سنة واحد",two:"سنتان",threeToTen:"{{count}} سنوات",other:"{{count}} سنة"},overXYears:{one:"أكثر من سنة",two:"أكثر من سنتين",threeToTen:"أكثر من {{count}} سنوات",other:"أكثر من {{count}} سنة"},almostXYears:{one:"ما يقارب سنة واحدة",two:"ما يقارب سنتين",threeToTen:"ما يقارب {{count}} سنوات",other:"ما يقارب {{count}} سنة"}},Rp=(s,t,n)=>{const o=Wp[s];let c;return typeof o=="string"?c=o:t===1?c=o.one:t===2?c=o.two:t<=10?c=o.threeToTen.replace("{{count}}",String(t)):c=o.other.replace("{{count}}",String(t)),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"خلال "+c:"منذ "+c:c},Lp={full:"EEEE، do MMMM y",long:"do MMMM y",medium:"d MMM y",short:"dd/MM/yyyy"},Fp={full:"HH:mm:ss",long:"HH:mm:ss",medium:"HH:mm:ss",short:"HH:mm"},Bp={full:"{{date}} 'عند الساعة' {{time}}",long:"{{date}} 'عند الساعة' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},$p={date:Ys({formats:Lp,defaultWidth:"full"}),time:Ys({formats:Fp,defaultWidth:"full"}),dateTime:Ys({formats:Bp,defaultWidth:"full"})},Up={lastWeek:"eeee 'الماضي عند الساعة' p",yesterday:"'الأمس عند الساعة' p",today:"'اليوم عند الساعة' p",tomorrow:"'غدا عند الساعة' p",nextWeek:"eeee 'القادم عند الساعة' p",other:"P"},Vp=s=>Up[s],qp={narrow:["ق","ب"],abbreviated:["ق.م.","ب.م."],wide:["قبل الميلاد","بعد الميلاد"]},zp={narrow:["1","2","3","4"],abbreviated:["ر1","ر2","ر3","ر4"],wide:["الربع الأول","الربع الثاني","الربع الثالث","الربع الرابع"]},Yp={narrow:["ي","ف","م","أ","م","ي","ي","أ","س","أ","ن","د"],abbreviated:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],wide:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"]},Kp={narrow:["ح","ن","ث","ر","خ","ج","س"],short:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],abbreviated:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],wide:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"]},Jp={narrow:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"},abbreviated:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"},wide:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"}},Hp={narrow:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"},abbreviated:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"},wide:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"}},Qp=s=>String(s),Gp={ordinalNumber:Qp,era:ya({values:qp,defaultWidth:"wide"}),quarter:ya({values:zp,defaultWidth:"wide",argumentCallback:s=>s-1}),month:ya({values:Yp,defaultWidth:"wide"}),day:ya({values:Kp,defaultWidth:"wide"}),dayPeriod:ya({values:Jp,defaultWidth:"wide",formattingValues:Hp,defaultFormattingWidth:"wide"})},Xp=/^(\d+)(th|st|nd|rd)?/i,Zp=/\d+/i,ex={narrow:/[قب]/,abbreviated:/[قب]\.م\./,wide:/(قبل|بعد) الميلاد/},tx={any:[/قبل/,/بعد/]},ax={narrow:/^[1234]/i,abbreviated:/ر[1234]/,wide:/الربع (الأول|الثاني|الثالث|الرابع)/},sx={any:[/1/i,/2/i,/3/i,/4/i]},rx={narrow:/^[أيفمسند]/,abbreviated:/^(يناير|فبراير|مارس|أبريل|مايو|يونيو|يوليو|أغسطس|سبتمبر|أكتوبر|نوفمبر|ديسمبر)/,wide:/^(يناير|فبراير|مارس|أبريل|مايو|يونيو|يوليو|أغسطس|سبتمبر|أكتوبر|نوفمبر|ديسمبر)/},nx={narrow:[/^ي/i,/^ف/i,/^م/i,/^أ/i,/^م/i,/^ي/i,/^ي/i,/^أ/i,/^س/i,/^أ/i,/^ن/i,/^د/i],any:[/^يناير/i,/^فبراير/i,/^مارس/i,/^أبريل/i,/^مايو/i,/^يونيو/i,/^يوليو/i,/^أغسطس/i,/^سبتمبر/i,/^أكتوبر/i,/^نوفمبر/i,/^ديسمبر/i]},ix={narrow:/^[حنثرخجس]/i,short:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,abbreviated:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,wide:/^(الأحد|الاثنين|الثلاثاء|الأربعاء|الخميس|الجمعة|السبت)/i},ox={narrow:[/^ح/i,/^ن/i,/^ث/i,/^ر/i,/^خ/i,/^ج/i,/^س/i],wide:[/^الأحد/i,/^الاثنين/i,/^الثلاثاء/i,/^الأربعاء/i,/^الخميس/i,/^الجمعة/i,/^السبت/i],any:[/^أح/i,/^اث/i,/^ث/i,/^أر/i,/^خ/i,/^ج/i,/^س/i]},lx={narrow:/^(ص|م|منتصف الليل|الظهر|بعد الظهر|في الصباح|في المساء|في الليل)/,any:/^(ص|م|منتصف الليل|الظهر|بعد الظهر|في الصباح|في المساء|في الليل)/},cx={any:{am:/^ص/,pm:/^م/,midnight:/منتصف الليل/,noon:/الظهر/,afternoon:/بعد الظهر/,morning:/في الصباح/,evening:/في المساء/,night:/في الليل/}},dx={ordinalNumber:Ru({matchPattern:Xp,parsePattern:Zp,valueCallback:s=>parseInt(s,10)}),era:ba({matchPatterns:ex,defaultMatchWidth:"wide",parsePatterns:tx,defaultParseWidth:"any"}),quarter:ba({matchPatterns:ax,defaultMatchWidth:"wide",parsePatterns:sx,defaultParseWidth:"any",valueCallback:s=>s+1}),month:ba({matchPatterns:rx,defaultMatchWidth:"wide",parsePatterns:nx,defaultParseWidth:"any"}),day:ba({matchPatterns:ix,defaultMatchWidth:"wide",parsePatterns:ox,defaultParseWidth:"any"}),dayPeriod:ba({matchPatterns:lx,defaultMatchWidth:"any",parsePatterns:cx,defaultParseWidth:"any"})},nu={code:"ar",formatDistance:Rp,formatLong:$p,formatRelative:Vp,localize:Gp,match:dx,options:{weekStartsOn:6,firstWeekContainsDate:1}};var oe=function(){return oe=Object.assign||function(t){for(var n,o=1,c=arguments.length;o<c;o++){n=arguments[o];for(var f in n)Object.prototype.hasOwnProperty.call(n,f)&&(t[f]=n[f])}return t},oe.apply(this,arguments)};function ux(s,t){var n={};for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&t.indexOf(o)<0&&(n[o]=s[o]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,o=Object.getOwnPropertySymbols(s);c<o.length;c++)t.indexOf(o[c])<0&&Object.prototype.propertyIsEnumerable.call(s,o[c])&&(n[o[c]]=s[o[c]]);return n}function qu(s,t,n){for(var o=0,c=t.length,f;o<c;o++)(f||!(o in t))&&(f||(f=Array.prototype.slice.call(t,0,o)),f[o]=t[o]);return s.concat(f||Array.prototype.slice.call(t))}function Hr(s){return s.mode==="multiple"}function Qr(s){return s.mode==="range"}function ci(s){return s.mode==="single"}var mx={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function hx(s,t){return da(s,"LLLL y",t)}function fx(s,t){return da(s,"d",t)}function gx(s,t){return da(s,"LLLL",t)}function px(s){return"".concat(s)}function xx(s,t){return da(s,"cccccc",t)}function yx(s,t){return da(s,"yyyy",t)}var bx=Object.freeze({__proto__:null,formatCaption:hx,formatDay:fx,formatMonthCaption:gx,formatWeekNumber:px,formatWeekdayName:xx,formatYearCaption:yx}),vx=function(s,t,n){return da(s,"do MMMM (EEEE)",n)},wx=function(){return"Month: "},Nx=function(){return"Go to next month"},jx=function(){return"Go to previous month"},Sx=function(s,t){return da(s,"cccc",t)},Dx=function(s){return"Week n. ".concat(s)},kx=function(){return"Year: "},Cx=Object.freeze({__proto__:null,labelDay:vx,labelMonthDropdown:wx,labelNext:Nx,labelPrevious:jx,labelWeekNumber:Dx,labelWeekday:Sx,labelYearDropdown:kx});function Ix(){var s="buttons",t=mx,n=Lu,o={},c={},f=1,b={},N=new Date;return{captionLayout:s,classNames:t,formatters:bx,labels:Cx,locale:n,modifiersClassNames:o,modifiers:c,numberOfMonths:f,styles:b,today:N,mode:"default"}}function _x(s){var t=s.fromYear,n=s.toYear,o=s.fromMonth,c=s.toMonth,f=s.fromDate,b=s.toDate;return o?f=Ft(o):t&&(f=new Date(t,0,1)),c?b=ml(c):n&&(b=new Date(n,11,31)),{fromDate:f?Hs(f):void 0,toDate:b?Hs(b):void 0}}var zu=u.createContext(void 0);function Tx(s){var t,n=s.initialProps,o=Ix(),c=_x(n),f=c.fromDate,b=c.toDate,N=(t=n.captionLayout)!==null&&t!==void 0?t:o.captionLayout;N!=="buttons"&&(!f||!b)&&(N="buttons");var j;(ci(n)||Hr(n)||Qr(n))&&(j=n.onSelect);var D=oe(oe(oe({},o),n),{captionLayout:N,classNames:oe(oe({},o.classNames),n.classNames),components:oe({},n.components),formatters:oe(oe({},o.formatters),n.formatters),fromDate:f,labels:oe(oe({},o.labels),n.labels),mode:n.mode||o.mode,modifiers:oe(oe({},o.modifiers),n.modifiers),modifiersClassNames:oe(oe({},o.modifiersClassNames),n.modifiersClassNames),onSelect:j,styles:oe(oe({},o.styles),n.styles),toDate:b});return e.jsx(zu.Provider,{value:D,children:s.children})}function Le(){var s=u.useContext(zu);if(!s)throw new Error("useDayPicker must be used within a DayPickerProvider.");return s}function Yu(s){var t=Le(),n=t.locale,o=t.classNames,c=t.styles,f=t.formatters.formatCaption;return e.jsx("div",{className:o.caption_label,style:c.caption_label,"aria-live":"polite",role:"presentation",id:s.id,children:f(s.displayMonth,{locale:n})})}function Ax(s){return e.jsx("svg",oe({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},s,{children:e.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Ku(s){var t,n,o=s.onChange,c=s.value,f=s.children,b=s.caption,N=s.className,j=s.style,D=Le(),C=(n=(t=D.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&n!==void 0?n:Ax;return e.jsxs("div",{className:N,style:j,children:[e.jsx("span",{className:D.classNames.vhidden,children:s["aria-label"]}),e.jsx("select",{name:s.name,"aria-label":s["aria-label"],className:D.classNames.dropdown,style:D.styles.dropdown,value:c,onChange:o,children:f}),e.jsxs("div",{className:D.classNames.caption_label,style:D.styles.caption_label,"aria-hidden":"true",children:[b,e.jsx(C,{className:D.classNames.dropdown_icon,style:D.styles.dropdown_icon})]})]})}function Px(s){var t,n=Le(),o=n.fromDate,c=n.toDate,f=n.styles,b=n.locale,N=n.formatters.formatMonthCaption,j=n.classNames,D=n.components,C=n.labels.labelMonthDropdown;if(!o)return e.jsx(e.Fragment,{});if(!c)return e.jsx(e.Fragment,{});var P=[];if(Mp(o,c))for(var M=Ft(o),p=o.getMonth();p<=c.getMonth();p++)P.push(Xo(M,p));else for(var M=Ft(new Date),p=0;p<=11;p++)P.push(Xo(M,p));var q=function($){var xe=Number($.target.value),L=Xo(Ft(s.displayMonth),xe);s.onChange(L)},ee=(t=D==null?void 0:D.Dropdown)!==null&&t!==void 0?t:Ku;return e.jsx(ee,{name:"months","aria-label":C(),className:j.dropdown_month,style:f.dropdown_month,onChange:q,value:s.displayMonth.getMonth(),caption:N(s.displayMonth,{locale:b}),children:P.map(function($){return e.jsx("option",{value:$.getMonth(),children:N($,{locale:b})},$.getMonth())})})}function Ox(s){var t,n=s.displayMonth,o=Le(),c=o.fromDate,f=o.toDate,b=o.locale,N=o.styles,j=o.classNames,D=o.components,C=o.formatters.formatYearCaption,P=o.labels.labelYearDropdown,M=[];if(!c)return e.jsx(e.Fragment,{});if(!f)return e.jsx(e.Fragment,{});for(var p=c.getFullYear(),q=f.getFullYear(),ee=p;ee<=q;ee++)M.push(ru(Mu(new Date),ee));var $=function(L){var J=ru(Ft(n),Number(L.target.value));s.onChange(J)},xe=(t=D==null?void 0:D.Dropdown)!==null&&t!==void 0?t:Ku;return e.jsx(xe,{name:"years","aria-label":P(),className:j.dropdown_year,style:N.dropdown_year,onChange:$,value:n.getFullYear(),caption:C(n,{locale:b}),children:M.map(function(L){return e.jsx("option",{value:L.getFullYear(),children:C(L,{locale:b})},L.getFullYear())})})}function Ex(s,t){var n=u.useState(s),o=n[0],c=n[1],f=t===void 0?o:t;return[f,c]}function Mx(s){var t=s.month,n=s.defaultMonth,o=s.today,c=t||n||o||new Date,f=s.toDate,b=s.fromDate,N=s.numberOfMonths,j=N===void 0?1:N;if(f&&Yr(f,c)<0){var D=-1*(j-1);c=ua(f,D)}return b&&Yr(c,b)<0&&(c=b),Ft(c)}function Wx(){var s=Le(),t=Mx(s),n=Ex(t,s.month),o=n[0],c=n[1],f=function(b){var N;if(!s.disableNavigation){var j=Ft(b);c(j),(N=s.onMonthChange)===null||N===void 0||N.call(s,j)}};return[o,f]}function Rx(s,t){for(var n=t.reverseMonths,o=t.numberOfMonths,c=Ft(s),f=Ft(ua(c,o)),b=Yr(f,c),N=[],j=0;j<b;j++){var D=ua(c,j);N.push(D)}return n&&(N=N.reverse()),N}function Lx(s,t){if(!t.disableNavigation){var n=t.toDate,o=t.pagedNavigation,c=t.numberOfMonths,f=c===void 0?1:c,b=o?f:1,N=Ft(s);if(!n)return ua(N,b);var j=Yr(n,s);if(!(j<f))return ua(N,b)}}function Fx(s,t){if(!t.disableNavigation){var n=t.fromDate,o=t.pagedNavigation,c=t.numberOfMonths,f=c===void 0?1:c,b=o?f:1,N=Ft(s);if(!n)return ua(N,-b);var j=Yr(N,n);if(!(j<=0))return ua(N,-b)}}var Ju=u.createContext(void 0);function Bx(s){var t=Le(),n=Wx(),o=n[0],c=n[1],f=Rx(o,t),b=Lx(o,t),N=Fx(o,t),j=function(P){return f.some(function(M){return fl(P,M)})},D=function(P,M){j(P)||(M&&Vu(P,M)?c(ua(P,1+t.numberOfMonths*-1)):c(P))},C={currentMonth:o,displayMonths:f,goToMonth:c,goToDate:D,previousMonth:N,nextMonth:b,isDateDisplayed:j};return e.jsx(Ju.Provider,{value:C,children:s.children})}function Gr(){var s=u.useContext(Ju);if(!s)throw new Error("useNavigation must be used within a NavigationProvider");return s}function iu(s){var t,n=Le(),o=n.classNames,c=n.styles,f=n.components,b=Gr().goToMonth,N=function(C){b(ua(C,s.displayIndex?-s.displayIndex:0))},j=(t=f==null?void 0:f.CaptionLabel)!==null&&t!==void 0?t:Yu,D=e.jsx(j,{id:s.id,displayMonth:s.displayMonth});return e.jsxs("div",{className:o.caption_dropdowns,style:c.caption_dropdowns,children:[e.jsx("div",{className:o.vhidden,children:D}),e.jsx(Px,{onChange:N,displayMonth:s.displayMonth}),e.jsx(Ox,{onChange:N,displayMonth:s.displayMonth})]})}function $x(s){return e.jsx("svg",oe({width:"16px",height:"16px",viewBox:"0 0 120 120"},s,{children:e.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Ux(s){return e.jsx("svg",oe({width:"16px",height:"16px",viewBox:"0 0 120 120"},s,{children:e.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var oi=u.forwardRef(function(s,t){var n=Le(),o=n.classNames,c=n.styles,f=[o.button_reset,o.button];s.className&&f.push(s.className);var b=f.join(" "),N=oe(oe({},c.button_reset),c.button);return s.style&&Object.assign(N,s.style),e.jsx("button",oe({},s,{ref:t,type:"button",className:b,style:N}))});function Vx(s){var t,n,o=Le(),c=o.dir,f=o.locale,b=o.classNames,N=o.styles,j=o.labels,D=j.labelPrevious,C=j.labelNext,P=o.components;if(!s.nextMonth&&!s.previousMonth)return e.jsx(e.Fragment,{});var M=D(s.previousMonth,{locale:f}),p=[b.nav_button,b.nav_button_previous].join(" "),q=C(s.nextMonth,{locale:f}),ee=[b.nav_button,b.nav_button_next].join(" "),$=(t=P==null?void 0:P.IconRight)!==null&&t!==void 0?t:Ux,xe=(n=P==null?void 0:P.IconLeft)!==null&&n!==void 0?n:$x;return e.jsxs("div",{className:b.nav,style:N.nav,children:[!s.hidePrevious&&e.jsx(oi,{name:"previous-month","aria-label":M,className:p,style:N.nav_button_previous,disabled:!s.previousMonth,onClick:s.onPreviousClick,children:c==="rtl"?e.jsx($,{className:b.nav_icon,style:N.nav_icon}):e.jsx(xe,{className:b.nav_icon,style:N.nav_icon})}),!s.hideNext&&e.jsx(oi,{name:"next-month","aria-label":q,className:ee,style:N.nav_button_next,disabled:!s.nextMonth,onClick:s.onNextClick,children:c==="rtl"?e.jsx(xe,{className:b.nav_icon,style:N.nav_icon}):e.jsx($,{className:b.nav_icon,style:N.nav_icon})})]})}function ou(s){var t=Le().numberOfMonths,n=Gr(),o=n.previousMonth,c=n.nextMonth,f=n.goToMonth,b=n.displayMonths,N=b.findIndex(function(q){return fl(s.displayMonth,q)}),j=N===0,D=N===b.length-1,C=t>1&&(j||!D),P=t>1&&(D||!j),M=function(){o&&f(o)},p=function(){c&&f(c)};return e.jsx(Vx,{displayMonth:s.displayMonth,hideNext:C,hidePrevious:P,nextMonth:c,previousMonth:o,onPreviousClick:M,onNextClick:p})}function qx(s){var t,n=Le(),o=n.classNames,c=n.disableNavigation,f=n.styles,b=n.captionLayout,N=n.components,j=(t=N==null?void 0:N.CaptionLabel)!==null&&t!==void 0?t:Yu,D;return c?D=e.jsx(j,{id:s.id,displayMonth:s.displayMonth}):b==="dropdown"?D=e.jsx(iu,{displayMonth:s.displayMonth,id:s.id}):b==="dropdown-buttons"?D=e.jsxs(e.Fragment,{children:[e.jsx(iu,{displayMonth:s.displayMonth,displayIndex:s.displayIndex,id:s.id}),e.jsx(ou,{displayMonth:s.displayMonth,displayIndex:s.displayIndex,id:s.id})]}):D=e.jsxs(e.Fragment,{children:[e.jsx(j,{id:s.id,displayMonth:s.displayMonth,displayIndex:s.displayIndex}),e.jsx(ou,{displayMonth:s.displayMonth,id:s.id})]}),e.jsx("div",{className:o.caption,style:f.caption,children:D})}function zx(s){var t=Le(),n=t.footer,o=t.styles,c=t.classNames.tfoot;return n?e.jsx("tfoot",{className:c,style:o.tfoot,children:e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:n})})}):e.jsx(e.Fragment,{})}function Yx(s,t,n){for(var o=n?os(new Date):wa(new Date,{locale:s,weekStartsOn:t}),c=[],f=0;f<7;f++){var b=Pt(o,f);c.push(b)}return c}function Kx(){var s=Le(),t=s.classNames,n=s.styles,o=s.showWeekNumber,c=s.locale,f=s.weekStartsOn,b=s.ISOWeek,N=s.formatters.formatWeekdayName,j=s.labels.labelWeekday,D=Yx(c,f,b);return e.jsxs("tr",{style:n.head_row,className:t.head_row,children:[o&&e.jsx("td",{style:n.head_cell,className:t.head_cell}),D.map(function(C,P){return e.jsx("th",{scope:"col",className:t.head_cell,style:n.head_cell,"aria-label":j(C,{locale:c}),children:N(C,{locale:c})},P)})]})}function Jx(){var s,t=Le(),n=t.classNames,o=t.styles,c=t.components,f=(s=c==null?void 0:c.HeadRow)!==null&&s!==void 0?s:Kx;return e.jsx("thead",{style:o.head,className:n.head,children:e.jsx(f,{})})}function Hx(s){var t=Le(),n=t.locale,o=t.formatters.formatDay;return e.jsx(e.Fragment,{children:o(s.date,{locale:n})})}var gl=u.createContext(void 0);function Qx(s){if(!Hr(s.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return e.jsx(gl.Provider,{value:t,children:s.children})}return e.jsx(Gx,{initialProps:s.initialProps,children:s.children})}function Gx(s){var t=s.initialProps,n=s.children,o=t.selected,c=t.min,f=t.max,b=function(D,C,P){var M,p;(M=t.onDayClick)===null||M===void 0||M.call(t,D,C,P);var q=!!(C.selected&&c&&(o==null?void 0:o.length)===c);if(!q){var ee=!!(!C.selected&&f&&(o==null?void 0:o.length)===f);if(!ee){var $=o?qu([],o):[];if(C.selected){var xe=$.findIndex(function(L){return Lt(D,L)});$.splice(xe,1)}else $.push(D);(p=t.onSelect)===null||p===void 0||p.call(t,$,D,C,P)}}},N={disabled:[]};o&&N.disabled.push(function(D){var C=f&&o.length>f-1,P=o.some(function(M){return Lt(M,D)});return!!(C&&!P)});var j={selected:o,onDayClick:b,modifiers:N};return e.jsx(gl.Provider,{value:j,children:n})}function pl(){var s=u.useContext(gl);if(!s)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return s}function Xx(s,t){var n=t||{},o=n.from,c=n.to;return o&&c?Lt(c,s)&&Lt(o,s)?void 0:Lt(c,s)?{from:c,to:void 0}:Lt(o,s)?void 0:nl(o,s)?{from:s,to:c}:{from:o,to:s}:c?nl(s,c)?{from:c,to:s}:{from:s,to:c}:o?Vu(s,o)?{from:s,to:o}:{from:o,to:s}:{from:s,to:void 0}}var xl=u.createContext(void 0);function Zx(s){if(!Qr(s.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return e.jsx(xl.Provider,{value:t,children:s.children})}return e.jsx(ey,{initialProps:s.initialProps,children:s.children})}function ey(s){var t=s.initialProps,n=s.children,o=t.selected,c=o||{},f=c.from,b=c.to,N=t.min,j=t.max,D=function(p,q,ee){var $,xe;($=t.onDayClick)===null||$===void 0||$.call(t,p,q,ee);var L=Xx(p,o);(xe=t.onSelect)===null||xe===void 0||xe.call(t,L,p,q,ee)},C={range_start:[],range_end:[],range_middle:[],disabled:[]};if(f?(C.range_start=[f],b?(C.range_end=[b],Lt(f,b)||(C.range_middle=[{after:f,before:b}])):C.range_end=[f]):b&&(C.range_start=[b],C.range_end=[b]),N&&(f&&!b&&C.disabled.push({after:Go(f,N-1),before:Pt(f,N-1)}),f&&b&&C.disabled.push({after:f,before:Pt(f,N-1)}),!f&&b&&C.disabled.push({after:Go(b,N-1),before:Pt(b,N-1)})),j){if(f&&!b&&(C.disabled.push({before:Pt(f,-j+1)}),C.disabled.push({after:Pt(f,j-1)})),f&&b){var P=va(b,f)+1,M=j-P;C.disabled.push({before:Go(f,M)}),C.disabled.push({after:Pt(b,M)})}!f&&b&&(C.disabled.push({before:Pt(b,-j+1)}),C.disabled.push({after:Pt(b,j-1)}))}return e.jsx(xl.Provider,{value:{selected:o,onDayClick:D,modifiers:C},children:n})}function yl(){var s=u.useContext(xl);if(!s)throw new Error("useSelectRange must be used within a SelectRangeProvider");return s}function ri(s){return Array.isArray(s)?qu([],s):s!==void 0?[s]:[]}function ty(s){var t={};return Object.entries(s).forEach(function(n){var o=n[0],c=n[1];t[o]=ri(c)}),t}var ma;(function(s){s.Outside="outside",s.Disabled="disabled",s.Selected="selected",s.Hidden="hidden",s.Today="today",s.RangeStart="range_start",s.RangeEnd="range_end",s.RangeMiddle="range_middle"})(ma||(ma={}));var ay=ma.Selected,Aa=ma.Disabled,sy=ma.Hidden,ry=ma.Today,Zo=ma.RangeEnd,el=ma.RangeMiddle,tl=ma.RangeStart,ny=ma.Outside;function iy(s,t,n){var o,c=(o={},o[ay]=ri(s.selected),o[Aa]=ri(s.disabled),o[sy]=ri(s.hidden),o[ry]=[s.today],o[Zo]=[],o[el]=[],o[tl]=[],o[ny]=[],o);return s.fromDate&&c[Aa].push({before:s.fromDate}),s.toDate&&c[Aa].push({after:s.toDate}),Hr(s)?c[Aa]=c[Aa].concat(t.modifiers[Aa]):Qr(s)&&(c[Aa]=c[Aa].concat(n.modifiers[Aa]),c[tl]=n.modifiers[tl],c[el]=n.modifiers[el],c[Zo]=n.modifiers[Zo]),c}var Hu=u.createContext(void 0);function oy(s){var t=Le(),n=pl(),o=yl(),c=iy(t,n,o),f=ty(t.modifiers),b=oe(oe({},c),f);return e.jsx(Hu.Provider,{value:b,children:s.children})}function Qu(){var s=u.useContext(Hu);if(!s)throw new Error("useModifiers must be used within a ModifiersProvider");return s}function ly(s){return!!(s&&typeof s=="object"&&"before"in s&&"after"in s)}function cy(s){return!!(s&&typeof s=="object"&&"from"in s)}function dy(s){return!!(s&&typeof s=="object"&&"after"in s)}function uy(s){return!!(s&&typeof s=="object"&&"before"in s)}function my(s){return!!(s&&typeof s=="object"&&"dayOfWeek"in s)}function hy(s,t){var n,o=t.from,c=t.to;if(o&&c){var f=va(c,o)<0;f&&(n=[c,o],o=n[0],c=n[1]);var b=va(s,o)>=0&&va(c,s)>=0;return b}return c?Lt(c,s):o?Lt(o,s):!1}function fy(s){return ul(s)}function gy(s){return Array.isArray(s)&&s.every(ul)}function py(s,t){return t.some(function(n){if(typeof n=="boolean")return n;if(fy(n))return Lt(s,n);if(gy(n))return n.includes(s);if(cy(n))return hy(s,n);if(my(n))return n.dayOfWeek.includes(s.getDay());if(ly(n)){var o=va(n.before,s),c=va(n.after,s),f=o>0,b=c<0,N=nl(n.before,n.after);return N?b&&f:f||b}return dy(n)?va(s,n.after)>0:uy(n)?va(n.before,s)>0:typeof n=="function"?n(s):!1})}function bl(s,t,n){var o=Object.keys(t).reduce(function(f,b){var N=t[b];return py(s,N)&&f.push(b),f},[]),c={};return o.forEach(function(f){return c[f]=!0}),n&&!fl(s,n)&&(c.outside=!0),c}function xy(s,t){for(var n=Ft(s[0]),o=ml(s[s.length-1]),c,f,b=n;b<=o;){var N=bl(b,t),j=!N.disabled&&!N.hidden;if(!j){b=Pt(b,1);continue}if(N.selected)return b;N.today&&!f&&(f=b),c||(c=b),b=Pt(b,1)}return f||c}var yy=365;function Gu(s,t){var n=t.moveBy,o=t.direction,c=t.context,f=t.modifiers,b=t.retry,N=b===void 0?{count:0,lastFocused:s}:b,j=c.weekStartsOn,D=c.fromDate,C=c.toDate,P=c.locale,M={day:Pt,week:rl,month:ua,year:Pg,startOfWeek:function($){return c.ISOWeek?os($):wa($,{locale:P,weekStartsOn:j})},endOfWeek:function($){return c.ISOWeek?Wu($):hl($,{locale:P,weekStartsOn:j})}},p=M[n](s,o==="after"?1:-1);o==="before"&&D?p=Og([D,p]):o==="after"&&C&&(p=Eg([C,p]));var q=!0;if(f){var ee=bl(p,f);q=!ee.disabled&&!ee.hidden}return q?p:N.count>yy?N.lastFocused:Gu(p,{moveBy:n,direction:o,context:c,modifiers:f,retry:oe(oe({},N),{count:N.count+1})})}var Xu=u.createContext(void 0);function by(s){var t=Gr(),n=Qu(),o=u.useState(),c=o[0],f=o[1],b=u.useState(),N=b[0],j=b[1],D=xy(t.displayMonths,n),C=c??(N&&t.isDateDisplayed(N))?N:D,P=function(){j(c),f(void 0)},M=function($){f($)},p=Le(),q=function($,xe){if(c){var L=Gu(c,{moveBy:$,direction:xe,context:p,modifiers:n});Lt(c,L)||(t.goToDate(L,c),M(L))}},ee={focusedDay:c,focusTarget:C,blur:P,focus:M,focusDayAfter:function(){return q("day","after")},focusDayBefore:function(){return q("day","before")},focusWeekAfter:function(){return q("week","after")},focusWeekBefore:function(){return q("week","before")},focusMonthBefore:function(){return q("month","before")},focusMonthAfter:function(){return q("month","after")},focusYearBefore:function(){return q("year","before")},focusYearAfter:function(){return q("year","after")},focusStartOfWeek:function(){return q("startOfWeek","before")},focusEndOfWeek:function(){return q("endOfWeek","after")}};return e.jsx(Xu.Provider,{value:ee,children:s.children})}function vl(){var s=u.useContext(Xu);if(!s)throw new Error("useFocusContext must be used within a FocusProvider");return s}function vy(s,t){var n=Qu(),o=bl(s,n,t);return o}var wl=u.createContext(void 0);function wy(s){if(!ci(s.initialProps)){var t={selected:void 0};return e.jsx(wl.Provider,{value:t,children:s.children})}return e.jsx(Ny,{initialProps:s.initialProps,children:s.children})}function Ny(s){var t=s.initialProps,n=s.children,o=function(f,b,N){var j,D,C;if((j=t.onDayClick)===null||j===void 0||j.call(t,f,b,N),b.selected&&!t.required){(D=t.onSelect)===null||D===void 0||D.call(t,void 0,f,b,N);return}(C=t.onSelect)===null||C===void 0||C.call(t,f,f,b,N)},c={selected:t.selected,onDayClick:o};return e.jsx(wl.Provider,{value:c,children:n})}function Zu(){var s=u.useContext(wl);if(!s)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return s}function jy(s,t){var n=Le(),o=Zu(),c=pl(),f=yl(),b=vl(),N=b.focusDayAfter,j=b.focusDayBefore,D=b.focusWeekAfter,C=b.focusWeekBefore,P=b.blur,M=b.focus,p=b.focusMonthBefore,q=b.focusMonthAfter,ee=b.focusYearBefore,$=b.focusYearAfter,xe=b.focusStartOfWeek,L=b.focusEndOfWeek,J=function(H){var K,Bt,Ot,Dt;ci(n)?(K=o.onDayClick)===null||K===void 0||K.call(o,s,t,H):Hr(n)?(Bt=c.onDayClick)===null||Bt===void 0||Bt.call(c,s,t,H):Qr(n)?(Ot=f.onDayClick)===null||Ot===void 0||Ot.call(f,s,t,H):(Dt=n.onDayClick)===null||Dt===void 0||Dt.call(n,s,t,H)},te=function(H){var K;M(s),(K=n.onDayFocus)===null||K===void 0||K.call(n,s,t,H)},Ce=function(H){var K;P(),(K=n.onDayBlur)===null||K===void 0||K.call(n,s,t,H)},Me=function(H){var K;(K=n.onDayMouseEnter)===null||K===void 0||K.call(n,s,t,H)},Be=function(H){var K;(K=n.onDayMouseLeave)===null||K===void 0||K.call(n,s,t,H)},de=function(H){var K;(K=n.onDayPointerEnter)===null||K===void 0||K.call(n,s,t,H)},Ne=function(H){var K;(K=n.onDayPointerLeave)===null||K===void 0||K.call(n,s,t,H)},F=function(H){var K;(K=n.onDayTouchCancel)===null||K===void 0||K.call(n,s,t,H)},Fe=function(H){var K;(K=n.onDayTouchEnd)===null||K===void 0||K.call(n,s,t,H)},Re=function(H){var K;(K=n.onDayTouchMove)===null||K===void 0||K.call(n,s,t,H)},Gt=function(H){var K;(K=n.onDayTouchStart)===null||K===void 0||K.call(n,s,t,H)},ze=function(H){var K;(K=n.onDayKeyUp)===null||K===void 0||K.call(n,s,t,H)},Je=function(H){var K;switch(H.key){case"ArrowLeft":H.preventDefault(),H.stopPropagation(),n.dir==="rtl"?N():j();break;case"ArrowRight":H.preventDefault(),H.stopPropagation(),n.dir==="rtl"?j():N();break;case"ArrowDown":H.preventDefault(),H.stopPropagation(),D();break;case"ArrowUp":H.preventDefault(),H.stopPropagation(),C();break;case"PageUp":H.preventDefault(),H.stopPropagation(),H.shiftKey?ee():p();break;case"PageDown":H.preventDefault(),H.stopPropagation(),H.shiftKey?$():q();break;case"Home":H.preventDefault(),H.stopPropagation(),xe();break;case"End":H.preventDefault(),H.stopPropagation(),L();break}(K=n.onDayKeyDown)===null||K===void 0||K.call(n,s,t,H)},lt={onClick:J,onFocus:te,onBlur:Ce,onKeyDown:Je,onKeyUp:ze,onMouseEnter:Me,onMouseLeave:Be,onPointerEnter:de,onPointerLeave:Ne,onTouchCancel:F,onTouchEnd:Fe,onTouchMove:Re,onTouchStart:Gt};return lt}function Sy(){var s=Le(),t=Zu(),n=pl(),o=yl(),c=ci(s)?t.selected:Hr(s)?n.selected:Qr(s)?o.selected:void 0;return c}function Dy(s){return Object.values(ma).includes(s)}function ky(s,t){var n=[s.classNames.day];return Object.keys(t).forEach(function(o){var c=s.modifiersClassNames[o];if(c)n.push(c);else if(Dy(o)){var f=s.classNames["day_".concat(o)];f&&n.push(f)}}),n}function Cy(s,t){var n=oe({},s.styles.day);return Object.keys(t).forEach(function(o){var c;n=oe(oe({},n),(c=s.modifiersStyles)===null||c===void 0?void 0:c[o])}),n}function Iy(s,t,n){var o,c,f,b=Le(),N=vl(),j=vy(s,t),D=jy(s,j),C=Sy(),P=!!(b.onDayClick||b.mode!=="default");u.useEffect(function(){var Me;j.outside||N.focusedDay&&P&&Lt(N.focusedDay,s)&&((Me=n.current)===null||Me===void 0||Me.focus())},[N.focusedDay,s,n,P,j.outside]);var M=ky(b,j).join(" "),p=Cy(b,j),q=!!(j.outside&&!b.showOutsideDays||j.hidden),ee=(f=(c=b.components)===null||c===void 0?void 0:c.DayContent)!==null&&f!==void 0?f:Hx,$=e.jsx(ee,{date:s,displayMonth:t,activeModifiers:j}),xe={style:p,className:M,children:$,role:"gridcell"},L=N.focusTarget&&Lt(N.focusTarget,s)&&!j.outside,J=N.focusedDay&&Lt(N.focusedDay,s),te=oe(oe(oe({},xe),(o={disabled:j.disabled,role:"gridcell"},o["aria-selected"]=j.selected,o.tabIndex=J||L?0:-1,o)),D),Ce={isButton:P,isHidden:q,activeModifiers:j,selectedDays:C,buttonProps:te,divProps:xe};return Ce}function _y(s){var t=u.useRef(null),n=Iy(s.date,s.displayMonth,t);return n.isHidden?e.jsx("div",{role:"gridcell"}):n.isButton?e.jsx(oi,oe({name:"day",ref:t},n.buttonProps)):e.jsx("div",oe({},n.divProps))}function Ty(s){var t=s.number,n=s.dates,o=Le(),c=o.onWeekNumberClick,f=o.styles,b=o.classNames,N=o.locale,j=o.labels.labelWeekNumber,D=o.formatters.formatWeekNumber,C=D(Number(t),{locale:N});if(!c)return e.jsx("span",{className:b.weeknumber,style:f.weeknumber,children:C});var P=j(Number(t),{locale:N}),M=function(p){c(t,n,p)};return e.jsx(oi,{name:"week-number","aria-label":P,className:b.weeknumber,style:f.weeknumber,onClick:M,children:C})}function Ay(s){var t,n,o=Le(),c=o.styles,f=o.classNames,b=o.showWeekNumber,N=o.components,j=(t=N==null?void 0:N.Day)!==null&&t!==void 0?t:_y,D=(n=N==null?void 0:N.WeekNumber)!==null&&n!==void 0?n:Ty,C;return b&&(C=e.jsx("td",{className:f.cell,style:c.cell,children:e.jsx(D,{number:s.weekNumber,dates:s.dates})})),e.jsxs("tr",{className:f.row,style:c.row,children:[C,s.dates.map(function(P){return e.jsx("td",{className:f.cell,style:c.cell,role:"presentation",children:e.jsx(j,{displayMonth:s.displayMonth,date:P})},Pp(P))})]})}function lu(s,t,n){for(var o=n!=null&&n.ISOWeek?Wu(t):hl(t,n),c=n!=null&&n.ISOWeek?os(s):wa(s,n),f=va(o,c),b=[],N=0;N<=f;N++)b.push(Pt(c,N));var j=b.reduce(function(D,C){var P=n!=null&&n.ISOWeek?Fu(C):$u(C,n),M=D.find(function(p){return p.weekNumber===P});return M?(M.dates.push(C),D):(D.push({weekNumber:P,dates:[C]}),D)},[]);return j}function Py(s,t){var n=lu(Ft(s),ml(s),t);if(t!=null&&t.useFixedWeeks){var o=Ep(s,t);if(o<6){var c=n[n.length-1],f=c.dates[c.dates.length-1],b=rl(f,6-o),N=lu(rl(f,1),b,t);n.push.apply(n,N)}}return n}function Oy(s){var t,n,o,c=Le(),f=c.locale,b=c.classNames,N=c.styles,j=c.hideHead,D=c.fixedWeeks,C=c.components,P=c.weekStartsOn,M=c.firstWeekContainsDate,p=c.ISOWeek,q=Py(s.displayMonth,{useFixedWeeks:!!D,ISOWeek:p,locale:f,weekStartsOn:P,firstWeekContainsDate:M}),ee=(t=C==null?void 0:C.Head)!==null&&t!==void 0?t:Jx,$=(n=C==null?void 0:C.Row)!==null&&n!==void 0?n:Ay,xe=(o=C==null?void 0:C.Footer)!==null&&o!==void 0?o:zx;return e.jsxs("table",{id:s.id,className:b.table,style:N.table,role:"grid","aria-labelledby":s["aria-labelledby"],children:[!j&&e.jsx(ee,{}),e.jsx("tbody",{className:b.tbody,style:N.tbody,children:q.map(function(L){return e.jsx($,{displayMonth:s.displayMonth,dates:L.dates,weekNumber:L.weekNumber},L.weekNumber)})}),e.jsx(xe,{displayMonth:s.displayMonth})]})}function Ey(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var My=Ey()?u.useLayoutEffect:u.useEffect,al=!1,Wy=0;function cu(){return"react-day-picker-".concat(++Wy)}function Ry(s){var t,n=s??(al?cu():null),o=u.useState(n),c=o[0],f=o[1];return My(function(){c===null&&f(cu())},[]),u.useEffect(function(){al===!1&&(al=!0)},[]),(t=s??c)!==null&&t!==void 0?t:void 0}function Ly(s){var t,n,o=Le(),c=o.dir,f=o.classNames,b=o.styles,N=o.components,j=Gr().displayMonths,D=Ry(o.id?"".concat(o.id,"-").concat(s.displayIndex):void 0),C=o.id?"".concat(o.id,"-grid-").concat(s.displayIndex):void 0,P=[f.month],M=b.month,p=s.displayIndex===0,q=s.displayIndex===j.length-1,ee=!p&&!q;c==="rtl"&&(t=[p,q],q=t[0],p=t[1]),p&&(P.push(f.caption_start),M=oe(oe({},M),b.caption_start)),q&&(P.push(f.caption_end),M=oe(oe({},M),b.caption_end)),ee&&(P.push(f.caption_between),M=oe(oe({},M),b.caption_between));var $=(n=N==null?void 0:N.Caption)!==null&&n!==void 0?n:qx;return e.jsxs("div",{className:P.join(" "),style:M,children:[e.jsx($,{id:D,displayMonth:s.displayMonth,displayIndex:s.displayIndex}),e.jsx(Oy,{id:C,"aria-labelledby":D,displayMonth:s.displayMonth})]},s.displayIndex)}function Fy(s){var t=Le(),n=t.classNames,o=t.styles;return e.jsx("div",{className:n.months,style:o.months,children:s.children})}function By(s){var t,n,o=s.initialProps,c=Le(),f=vl(),b=Gr(),N=u.useState(!1),j=N[0],D=N[1];u.useEffect(function(){c.initialFocus&&f.focusTarget&&(j||(f.focus(f.focusTarget),D(!0)))},[c.initialFocus,j,f.focus,f.focusTarget,f]);var C=[c.classNames.root,c.className];c.numberOfMonths>1&&C.push(c.classNames.multiple_months),c.showWeekNumber&&C.push(c.classNames.with_weeknumber);var P=oe(oe({},c.styles.root),c.style),M=Object.keys(o).filter(function(q){return q.startsWith("data-")}).reduce(function(q,ee){var $;return oe(oe({},q),($={},$[ee]=o[ee],$))},{}),p=(n=(t=o.components)===null||t===void 0?void 0:t.Months)!==null&&n!==void 0?n:Fy;return e.jsx("div",oe({className:C.join(" "),style:P,dir:c.dir,id:c.id,nonce:o.nonce,title:o.title,lang:o.lang},M,{children:e.jsx(p,{children:b.displayMonths.map(function(q,ee){return e.jsx(Ly,{displayIndex:ee,displayMonth:q},ee)})})}))}function $y(s){var t=s.children,n=ux(s,["children"]);return e.jsx(Tx,{initialProps:n,children:e.jsx(Bx,{children:e.jsx(wy,{initialProps:n,children:e.jsx(Qx,{initialProps:n,children:e.jsx(Zx,{initialProps:n,children:e.jsx(oy,{children:e.jsx(by,{children:t})})})})})})})}function Uy(s){return e.jsx($y,oe({},s,{children:e.jsx(By,{initialProps:s})}))}function il({className:s,classNames:t,showOutsideDays:n=!0,...o}){return e.jsx(Uy,{showOutsideDays:n,className:zs("p-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:zs(Ed({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:zs(Ed({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...c})=>e.jsx(ng,{className:"h-4 w-4"}),IconRight:({...c})=>e.jsx(Uf,{className:"h-4 w-4"})},...o})}il.displayName="Calendar";const du={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_VERSION:"0.0.0",VITE_DEV_MODE:"true",VITE_ENABLE_OFFLINE_PERSISTENCE:"false",VITE_FIREBASE_API_KEY:["AI","za","SyA33RTf43u2QE2OsK1RepQHSKrSet9ZI0s"].join(""),VITE_FIREBASE_APP_ID:"1:483702062341:web:b1ff06ad175cb7ae428b6c",VITE_FIREBASE_AUTH_DOMAIN:"voda-c6abd.firebaseapp.com",VITE_FIREBASE_AUTH_EMULATOR_URL:"http://localhost:9099",VITE_FIREBASE_FIRESTORE_EMULATOR_HOST:"localhost:8080",VITE_FIREBASE_FUNCTIONS_EMULATOR_HOST:"localhost:5001",VITE_FIREBASE_MEASUREMENT_ID:"G-CV6QGH7G7P",VITE_FIREBASE_MESSAGING_SENDER_ID:"483702062341",VITE_FIREBASE_PROJECT_ID:"voda-c6abd",VITE_FIREBASE_STORAGE_BUCKET:"voda-c6abd.appspot.com",VITE_FORCE_HASH_ROUTER:"true",VITE_SHOP_ID:"demo-shop-001",VITE_SHOP_NAME:"محل كاشي لينك التجريبي",VITE_SHOW_ENV_BANNER:"true",VITE_USE_EMULATORS:"false",VITE_USE_FIREBASE_EMULATOR:"false"},$a=s=>typeof s=="string"&&s.trim().length>0,Vy={getCurrentMonthId(){const s=new Date;return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`},async getWalletUsage(s){var t;try{if(!$a(s))return console.error("Error getting wallet usage: invalid walletId",s),null;const n=Te(V,"walletLimits",s),o=await ca(n);if(o.exists()){const f=o.data();return{walletId:s,used_transfer:f.monthlyTransferUsed??f.used_transfer??0,used_withdraw:f.monthlyWithdrawUsed??f.used_withdraw??0,monthly_limit:f.monthlyLimit??f.monthlyTransferLimit??f.monthlyWithdrawLimit??2e5,last_reset:f.lastMonthlyReset??f.last_reset??null,updatedAt:f.updatedAt||ts.now()}}const c={walletId:s,used_transfer:0,used_withdraw:0,monthly_limit:2e5,last_reset:null,updatedAt:ts.now()};return await Ht(n,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,monthlyTransferLimit:2e5,monthlyWithdrawLimit:2e5,lastMonthlyReset:null,updatedAt:wt(),ownerId:(t=Us.currentUser)==null?void 0:t.uid}),c}catch(n){return console.error("Error getting wallet usage:",n),{walletId:s,used_transfer:0,used_withdraw:0,monthly_limit:2e5,last_reset:null,updatedAt:ts.now()}}},shouldResetLimits(s){const t=new Date,n=t.getDate();if(!s)return n===1;if(n===1){const o=s.toDate(),c=t.getMonth(),f=t.getFullYear();return o.getMonth()!==c||o.getFullYear()!==f}return!1},async autoResetLimitsIfNeeded(s){try{if(!$a(s))return console.error("خطأ في التصفير التلقائي للحدود: walletId غير صالح",s),!1;typeof import.meta<"u";const t=await this.getWalletUsage(s);return t&&this.shouldResetLimits(t.last_reset)?(console.log(`🔄 تصفير تلقائي للحدود للمحفظة ${s} - اليوم الأول من الشهر`),await this.resetWalletUsage(s)):!1}catch(t){return console.error("خطأ في التصفير التلقائي للحدود:",t),!1}},async resetWalletUsage(s){try{if(!$a(s))return console.error("خطأ في تصفير استخدام المحفظة: walletId غير صالح",s),!1;const t=Te(V,"walletLimits",s);return await Ht(t,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:wt(),updatedAt:wt()},{merge:!0}),console.log(`🔄 تم تصفير استخدام المحفظة ${s} بنجاح`),!0}catch(t){return console.error("خطأ في تصفير استخدام المحفظة:",t),!1}},async calculateUsageFromTransactions(s){var t,n;try{if(!$a(s))return console.error("خطأ في حساب الاستخدام من المعاملات: walletId غير صالح",s),{used_transfer:0,used_withdraw:0};const o=Te(V,"walletLimits",s),c=new Date;let f=ts.fromDate(new Date(c.getFullYear(),c.getMonth(),1));try{const C=await ca(o);f=C.exists()?((t=C.data())==null?void 0:t.lastMonthlyReset)??((n=C.data())==null?void 0:n.last_reset)??f:f}catch{}const b=Oe(pe(V,"tx"),ae("uid","==",s),...f?[ae("createdAt",">=",f)]:[]),N=await ke(b);let j=0,D=0;return N.forEach(C=>{const P=C.data();P.status==="completed"&&(P.type==="transfer"?j+=P.amount:P.type==="withdraw"&&(D+=P.amount))}),{used_transfer:j,used_withdraw:D}}catch(o){return console.error("خطأ في حساب الاستخدام من المعاملات:",o),{used_transfer:0,used_withdraw:0}}},async getWalletUsageWithRefresh(s){var t,n;try{if(!$a(s))return console.error("خطأ في الحصول على الاستخدام مع التحديث: walletId غير صالح",s),null;typeof import.meta<"u";const o=await this.getWalletUsage(s);if(!o){const f=await this.calculateUsageFromTransactions(s),b=Te(V,"walletLimits",s);try{await Ht(b,{monthlyTransferUsed:f.used_transfer,monthlyWithdrawUsed:f.used_withdraw,updatedAt:wt(),ownerId:(t=Us.currentUser)==null?void 0:t.uid},{merge:!0})}catch{}return{walletId:s,used_transfer:f.used_transfer,used_withdraw:f.used_withdraw,monthly_limit:2e5,last_reset:null,updatedAt:ts.now()}}const c=await this.calculateUsageFromTransactions(s);if(o.used_transfer!==c.used_transfer||o.used_withdraw!==c.used_withdraw){const f=Te(V,"walletLimits",s);try{await Ht(f,{monthlyTransferUsed:c.used_transfer,monthlyWithdrawUsed:c.used_withdraw,updatedAt:wt(),ownerId:(n=Us.currentUser)==null?void 0:n.uid},{merge:!0})}catch{}return await this.getWalletUsage(s)}return o}catch(o){return console.error("خطأ في الحصول على الاستخدام مع التحديث:",o),{walletId:s,used_transfer:0,used_withdraw:0,monthly_limit:2e5,last_reset:null,updatedAt:ts.now()}}},calculateRemaining(s){return{remainingTransfer:Math.max(0,s.monthly_limit-s.used_transfer),remainingWithdraw:Math.max(0,s.monthly_limit-s.used_withdraw)}},async canPerformOperation(s,t,n){try{if(!$a(s))return console.error("Error checking operation limits: invalid walletId",s),{canPerform:!1,message:"walletId غير صالح"};const o=await this.getWalletUsageWithRefresh(s);if(!o)return{canPerform:!1,message:"لا يمكن العثور على بيانات الاستخدام للمحفظة"};const c=this.calculateRemaining(o);return n==="transfer"&&t>c.remainingTransfer?{canPerform:!1,message:`تجاوز حد التحويل المسموح. المتبقي: ${c.remainingTransfer.toLocaleString()} ج.م من أصل ${o.monthly_limit.toLocaleString()} ج.م`,remaining:c.remainingTransfer}:n==="withdraw"&&t>c.remainingWithdraw?{canPerform:!1,message:`تجاوز حد السحب المسموح. المتبقي: ${c.remainingWithdraw.toLocaleString()} ج.م من أصل ${o.monthly_limit.toLocaleString()} ج.م`,remaining:c.remainingWithdraw}:{canPerform:!0}}catch(o){return console.error("Error checking operation limits:",o),{canPerform:!1,message:"خطأ في التحقق من الحدود"}}},async updateUsage(s,t,n){var o;try{if(!$a(s))throw new Error("walletId غير صالح");const c=await this.getWalletUsageWithRefresh(s);if(!c)throw new Error("لا يمكن العثور على بيانات الاستخدام للمحفظة");const f=await this.canPerformOperation(s,t,n);if(!f.canPerform)throw new Error(f.message||"لا يمكن إجراء العملية");const b=n==="transfer"?c.used_transfer+t:c.used_transfer,N=n==="withdraw"?c.used_withdraw+t:c.used_withdraw,j=Te(V,"walletLimits",c.walletId);try{await Ht(j,{monthlyTransferUsed:b,monthlyWithdrawUsed:N,updatedAt:wt(),ownerId:(o=Us.currentUser)==null?void 0:o.uid},{merge:!0})}catch{}let D=await this.getWalletUsageWithRefresh(s);return D||(D={walletId:s,used_transfer:b,used_withdraw:N,monthly_limit:c.monthly_limit,last_reset:c.last_reset,updatedAt:ts.now()}),D}catch(c){throw console.error("Error updating wallet usage:",c),c}},async resetWalletUsageManually(s){try{if(!$a(s))throw new Error("walletId غير صالح");const t=Te(V,"walletLimits",s),n={walletId:s,used_transfer:0,used_withdraw:0,monthly_limit:0,last_reset:null,updatedAt:new Date};return Ht(t,{monthlyTransferUsed:0,monthlyWithdrawUsed:0,lastMonthlyReset:wt(),updatedAt:wt()},{merge:!0}).catch(o=>{console.error("خطأ في حفظ تصفير الاستخدام في Firebase:",o)}),console.log(`✅ تم تصفير استخدام المحفظة ${s} بنجاح`),n}catch(t){throw console.error("Error resetting wallet usage:",t),t}},async getAllWalletsUsage(s){try{const n=(await ti.getByMerchantId(s)).map(c=>this.getWalletUsageWithRefresh(c.id));return(await Promise.all(n)).filter(c=>c!==null)}catch(t){return console.error("Error getting all wallets usage:",t),[]}}};function qy(s){return s?`readBroadcastIds_${s}`:"readBroadcastIds_guest"}function zy({className:s}){const{user:t,profile:n,isSubscriptionActive:o}=ol(),c=yu(),[f,b]=u.useState([]),[N,j]=u.useState(new Set),[D,C]=u.useState(!1),[P,M]=u.useState(""),[p,q]=u.useState(!1),[ee,$]=u.useState(null),[xe,L]=u.useState("none"),[J,te]=u.useState(null),[Ce,Me]=u.useState(!1),Be=u.useRef(new Set);u.useRef(!1);const de=u.useRef(!0),Ne=u.useRef(null),F=u.useRef(null),Fe=u.useRef(null),[Re,Gt]=u.useState({position:"fixed",top:0,left:0,zIndex:1e4}),ze=u.useMemo(()=>{const Q=["global"];return t!=null&&t.uid&&Q.push(`user:${t.uid}`),n!=null&&n.shopId&&Q.push(`shop:${n.shopId}`),Q},[t==null?void 0:t.uid,n==null?void 0:n.shopId]),Je=qy(t==null?void 0:t.uid),lt=u.useMemo(()=>{var le;const Q=(le=c==null?void 0:c.pathname)==null?void 0:le.includes("/user/pending-approval");return!!(t!=null&&t.uid)&&!Q},[t==null?void 0:t.uid,c==null?void 0:c.pathname]);u.useEffect(()=>{try{const Q=localStorage.getItem(Je);if(Q){const ue=JSON.parse(Q);Array.isArray(ue)&&j(new Set(ue.filter(Boolean)))}else j(new Set)}catch(Q){console.warn("Failed to load read ids",Q),j(new Set)}},[Je]),u.useEffect(()=>{if(!lt){b([]);return}de.current=!0;const Q=()=>{Gf(ze,le=>{if(de.current){const Ye=Date.now(),He=60*1e3,$t=le.filter(Qe=>{var cs,ta;const ea=(cs=Qe.createdAt)!=null&&cs.toMillis?Qe.createdAt.toMillis():(ta=Qe.createdAt)!=null&&ta.seconds?Qe.createdAt.seconds*1e3:0;return!(Ye-ea<He)}).map(Qe=>Qe.id).filter(Boolean);Be.current=new Set($t),de.current=!1}b(le)})};Q();const ue=le=>{console.log("🔔 OneSignal Notification received",le);try{const Ye=le.notification||le;if(Ye&&(Ye.title||Ye.body)){const He={id:`temp_${Date.now()}`,title:Ye.title||"إشعار جديد",message:Ye.body||Ye.message||"",audienceKey:"global",active:!0,createdAt:{toMillis:()=>Date.now(),seconds:Math.floor(Date.now()/1e3),nanoseconds:0}};te(He),Me(!0),Ne.current&&clearTimeout(Ne.current),Ne.current=window.setTimeout(()=>{Me(!1),te(null)},5e3)}}catch(Ye){console.error("Error parsing OneSignal event for instant alert",Ye)}Q()};try{const le=window.OneSignal;le&&le.Notifications&&le.Notifications.addEventListener&&le.Notifications.addEventListener("foregroundWillDisplay",ue)}catch(le){console.error("Failed to add OneSignal listener",le)}return()=>{try{const le=window.OneSignal;le&&le.Notifications&&le.Notifications.removeEventListener&&le.Notifications.removeEventListener("foregroundWillDisplay",ue)}catch{}}},[ze,lt]),u.useEffect(()=>{const Q=new Set(f.map(le=>le.id).filter(Boolean)),ue=f.filter(le=>le.id&&!Be.current.has(le.id));ue.length>0&&(te(ue[0]),Me(!0),Ne.current&&clearTimeout(Ne.current),Ne.current=window.setTimeout(()=>{Me(!1),te(null)},5e3)),Be.current=Q},[f]),u.useEffect(()=>()=>{Ne.current&&clearTimeout(Ne.current)},[]);const H=f.reduce((Q,ue)=>Q+(ue.id&&!N.has(ue.id)?1:0),0),K=Q=>{if(!Q||N.has(Q))return;const ue=new Set(N);ue.add(Q),j(ue);try{localStorage.setItem(Je,JSON.stringify(Array.from(ue)))}catch{}},Bt=()=>{const Q=f.map(le=>le.id).filter(Boolean),ue=new Set(N);Q.forEach(le=>ue.add(le)),j(ue);try{localStorage.setItem(Je,JSON.stringify(Array.from(ue)))}catch{}},Ot=(Q,ue)=>{var le;if(Q)try{const Ye=((le=ni)==null?void 0:le.isNativePlatform)&&ni.getPlatform()==="android",He=/\.apk(\?|$)/i.test(Q);if(Ye&&He){const $t=`cashy://update?url=${encodeURIComponent(Q)}`;window.location.href=$t}else window.open(Q,"_blank")}catch{try{window.open(Q,"_blank")}catch{}}ue&&K(ue)},Dt=()=>{if(!F.current||!Fe.current)return;const Q=F.current.getBoundingClientRect(),ue=8,le=Fe.current.offsetWidth||320,Ye=Q.bottom+ue;let He=Q.right-le;const $t=window.innerWidth;He=Math.min(Math.max(He,ue),$t-le-ue),Gt(Qe=>({...Qe,top:Ye,left:He}))};return u.useEffect(()=>{if(!Ce)return;Dt();const Q=()=>Dt();return window.addEventListener("resize",Q),window.addEventListener("scroll",Q,!0),()=>{window.removeEventListener("resize",Q),window.removeEventListener("scroll",Q,!0)}},[Ce]),u.useEffect(()=>{if(!(t!=null&&t.uid)){L("none");return}(async()=>{try{const ue=Oe(pe(V,"waiting_list"),ae("userId","==",t.uid)),Ye=(await ke(ue)).docs.map(Qe=>({id:Qe.id,...Qe.data()})).sort((Qe,ea)=>{var ta,Gs,ds,Va,us,ms;const ls=((Gs=(ta=Qe==null?void 0:Qe.createdAt)==null?void 0:ta.toMillis)==null?void 0:Gs.call(ta))??((ds=Qe==null?void 0:Qe.createdAt)==null?void 0:ds.seconds)*1e3??0;return(((us=(Va=ea==null?void 0:ea.createdAt)==null?void 0:Va.toMillis)==null?void 0:us.call(Va))??((ms=ea==null?void 0:ea.createdAt)==null?void 0:ms.seconds)*1e3??0)-ls});if(Ye.length===0){L("none");return}const He=Ye[0],$t=(He==null?void 0:He.contacted)===!0||(He==null?void 0:He.status)==="contacted";L($t?"contacted":"pending")}catch(ue){console.warn("⚠️ فشل جلب حالة waiting_list:",ue),L("none")}})()},[t==null?void 0:t.uid]),lt?e.jsxs("div",{className:`relative inline-flex items-center gap-2 ${s||""}`,ref:F,children:[e.jsxs(Vf,{onOpenChange:Q=>{Q&&H>0&&Bt()},children:[e.jsx(qf,{asChild:!0,children:e.jsx(I,{variant:"ghost",className:"relative h-8 w-8 rounded-full p-0 hover:bg-transparent focus:ring-1 focus:ring-primary focus:ring-offset-1 transition-all",title:"الإشعارات",children:e.jsxs("div",{className:"relative h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center border border-border shadow-sm hover:shadow-md",children:[e.jsx(Jo,{className:"h-4 w-4 text-primary"}),H>0&&e.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-red-500 text-white text-[10px] font-bold flex items-center justify-center shadow",children:H})]})})}),e.jsxs(zf,{className:"w-80",align:"end",forceMount:!0,children:[e.jsxs(Yf,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"الإشعارات"}),f.length>0&&e.jsxs(I,{variant:"outline",size:"sm",className:"h-7 text-xs",onClick:Bt,children:[e.jsx(ai,{className:"h-3 w-3 mr-1"}),"تمييز الكل كمقروء"]})]}),e.jsx(Kf,{}),f.length===0?e.jsx("div",{className:"p-3 text-sm text-muted-foreground",children:"لا توجد إشعارات حالياً"}):e.jsx("div",{className:"max-h-64 overflow-y-auto pr-1",children:f.map(Q=>{const ue=Q.id?!N.has(Q.id):!1;return e.jsx("div",{className:`px-2 py-2 rounded-md ${ue?"bg-primary/5":""}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Jo,{className:`h-4 w-4 ${ue?"text-primary":"text-muted-foreground"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:Q.title||"إشعار"}),e.jsx("div",{className:"text-xs text-muted-foreground whitespace-pre-line",children:Q.message}),Q.linkUrl&&e.jsxs(I,{variant:"link",className:"px-0 h-6 text-xs",onClick:()=>Ot(Q.linkUrl,Q.id),children:["فتح الرابط ",e.jsx(Qf,{className:"h-3 w-3 ml-1"})]})]}),ue?e.jsx(I,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>K(Q.id),title:"تمييز كمقروء",children:e.jsx(ai,{className:"h-4 w-4 text-primary"})}):e.jsx(I,{variant:"ghost",size:"icon",className:"h-6 w-6",disabled:!0,title:"مقروء",children:e.jsx(ai,{className:"h-4 w-4 text-muted-foreground"})})]})},Q.id)})})]})]}),J&&rf.createPortal(e.jsx("div",{ref:Fe,style:Re,className:`pointer-events-auto transition-all duration-300 ${Ce?"opacity-100 translate-y-0":"opacity-0 -translate-y-3"}`,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-gray-200 p-4 w-80 max-w-[calc(100vw-16px)] flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Jo,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-semibold",children:J.title||"إشعار جديد"}),e.jsx("div",{className:"text-xs text-muted-foreground whitespace-pre-line",children:J.message}),J.linkUrl&&e.jsx(I,{variant:"link",className:"px-0 h-6 text-xs",onClick:()=>Ot(J.linkUrl,J.id),children:"فتح الرابط"})]})]})}),document.body)]}):null}function Yy(s,t=300){const[n,o]=G.useState(s);return G.useEffect(()=>{const c=setTimeout(()=>o(s),t);return()=>clearTimeout(c)},[s,t]),n}const Ky=({userId:s,transactions:t})=>{const[n,o]=u.useState(!1),[c,f]=u.useState(!1),[b,N]=u.useState(!1),[j,D]=u.useState({monthlyWithdrawalProfit:0,monthlyTransferProfit:0,monthlySalesProfit:0,lastUpdated:new Date}),{userSubscription:C}=ol();u.useEffect(()=>{s&&n&&b&&M()},[s,n,b]),u.useEffect(()=>{if(!n||!b)return;const L=setInterval(()=>{const J=new Date;(j.lastUpdated.getMonth()!==J.getMonth()||j.lastUpdated.getFullYear()!==J.getFullYear())&&M()},3e4);return()=>clearInterval(L)},[n,b,j.lastUpdated]);const P=async()=>{try{if(!s)return 0;const L=new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Cairo"}),J=new Date,te=L.format(J),[Ce,Me]=te.split("-"),Be=`${Ce}-${Me}-01`,de=parseInt(Ce),Ne=parseInt(Me),F=new Date(de,Ne,0).getDate(),Fe=`${Ce}-${Me}-${String(F).padStart(2,"0")}`;let Re;try{const ze=Oe(pe(V,"dailySales"),ae("userId","==",s));Re=await ke(ze)}catch{const ze=Oe(pe(V,"users",s,"dailySales"));Re=await ke(ze)}let Gt=0;return Re.forEach(ze=>{const Je=ze.data(),lt=String(Je.date??"").slice(0,10);if(lt&&!Je.isDeferred&&lt>=Be&&lt<=Fe){const H=Number(Je.sellingPrice??Je.price??0),K=Number(Je.wholesalePrice??0),Bt=Number(Je.quantity??Je.qty??0),Ot=Number(Je.profit??(H-K)*Bt);Gt+=Ot}}),Math.round(Gt*100)/100}catch(L){return console.warn("تعذر حساب أرباح المبيعات الشهرية:",L),0}},M=async()=>{if(s)try{if(Array.isArray(t)&&t.length>0){const te=new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Cairo"}),Ce=new Date,[Me,Be]=te.format(Ce).split("-"),de=parseInt(Me),Ne=parseInt(Be)-1,F=St.filterVisibleTransactions(t,"monthly",s);let Fe=0,Re=0;F.forEach(ze=>{var Q,ue,le;let Je;ze.createdAt instanceof Date?Je=ze.createdAt:typeof((Q=ze.createdAt)==null?void 0:Q.toDate)=="function"?Je=ze.createdAt.toDate():Je=new Date(ze.createdAt||0);const lt=te.formatToParts(Je),H=parseInt(((ue=lt.find(Ye=>Ye.type==="year"))==null?void 0:ue.value)||"0"),K=parseInt(((le=lt.find(Ye=>Ye.type==="month"))==null?void 0:le.value)||"0")-1,Bt=String(ze.status||"confirmed").toLowerCase();if(H!==de||K!==Ne||Bt!=="completed"&&Bt!=="confirmed")return;const Ot=(ze.type||ze.txnType||"").toLowerCase(),Dt={type:Ot==="withdrawal"||Ot==="machine_withdrawal"?"withdraw":Ot,amount:Number(ze.amount||0),commission:ze.commission};Dt.type==="withdraw"?Fe+=xa.calculateProfitFromTransaction(Dt):(Dt.type==="send"||Dt.type==="receive"||Dt.type==="transfer")&&(Re+=xa.calculateProfitFromTransaction(Dt))});const Gt=await P();D({monthlyWithdrawalProfit:Math.round(Fe*100)/100,monthlyTransferProfit:Math.round(Re*100)/100,monthlySalesProfit:Gt,lastUpdated:new Date});return}const L=xa.getWithdrawTransferProfits(s),J=await P();D({monthlyWithdrawalProfit:L.monthlyWithdrawProfit||0,monthlyTransferProfit:L.monthlyTransferProfit||0,monthlySalesProfit:J,lastUpdated:new Date})}catch(L){console.error("Error loading profit data:",L)}},p=L=>`${L.toFixed(2)} ج.م`,q=async()=>{try{const L=(C==null?void 0:C.subscription)||null,J=(L==null?void 0:L.planType)??(L==null?void 0:L.plan)??null,te=typeof J=="string"?J.toLowerCase():null;if(J===Zt.ZERO||te==="zero"||te==="0"||J===0)return!0}catch{}try{if(s){const L=await bu(s),J=(L==null?void 0:L.planType)??(L==null?void 0:L.plan)??null,te=typeof J=="string"?J.toLowerCase():null;if(J===Zt.ZERO||te==="zero"||te==="0"||J===0)return!0}}catch{}return!1},ee=()=>{try{const L=s?`monthlyReportsLockEnabled_${s}`:"monthlyReportsLockEnabled";return(localStorage.getItem(L)??localStorage.getItem("monthlyReportsLockEnabled"))==="true"}catch{return!1}},$=async()=>{try{if(await q()){Md({title:"الخطة زيرو",description:"عرض الأرباح الشهرية غير متاح في خطة زيرو. قم بالترقية للوصول إلى التقارير.",variant:"destructive"});return}}catch{}ee()?f(!0):(N(!0),o(!0))},xe=async()=>{try{if(await q()){Md({title:"الخطة زيرو",description:"عرض الأرباح الشهرية غير متاح في خطة زيرو. قم بالترقية للوصول إلى التقارير.",variant:"destructive"}),f(!1);return}}catch{}N(!0),o(!0),f(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(I,{size:"sm",variant:"ghost",onClick:$,className:"h-6 w-6 p-0 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded-full transition-colors duration-200",title:"عرض الأرباح الشهرية",children:e.jsx(Ks,{className:"h-4 w-4"})}),e.jsx(fe,{open:n,onOpenChange:o,children:e.jsxs(ge,{className:"max-w-[280px] sm:max-w-[320px] mx-auto bg-white dark:bg-[#0f172a] border border-gray-200 dark:border-slate-800 shadow-xl rounded-xl p-0 overflow-hidden",children:[e.jsx(ye,{className:"bg-gray-50 dark:bg-slate-900/50 px-4 py-3 border-b border-gray-100 dark:border-slate-800",children:e.jsxs(be,{className:"text-sm font-bold text-gray-900 dark:text-slate-100 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white dark:bg-slate-800 rounded-full border border-gray-200 dark:border-slate-700",children:e.jsx(si,{className:"h-4 w-4 text-purple-600 dark:text-purple-400"})}),"أرباح الشهر"]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-red-50 dark:bg-red-900/20 rounded-md",children:e.jsx(Vs,{className:"h-3.5 w-3.5 text-red-600 dark:text-red-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"سحب"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:p(j.monthlyWithdrawalProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-green-50 dark:bg-green-900/20 rounded-md",children:e.jsx(wu,{className:"h-3.5 w-3.5 text-green-600 dark:text-green-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"تحويل"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:p(j.monthlyTransferProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-violet-50 dark:bg-violet-900/20 rounded-md",children:e.jsx(Nu,{className:"h-3.5 w-3.5 text-violet-600 dark:text-violet-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"أرباح المبيعات"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:p(j.monthlySalesProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-100 dark:border-purple-900/30 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white dark:bg-slate-800 rounded-md shadow-sm",children:e.jsx(Pa,{className:"h-3.5 w-3.5 text-purple-600 dark:text-purple-400"})}),e.jsx("span",{className:"font-bold text-purple-900 dark:text-purple-100 text-sm",children:"الإجمالي"})]}),e.jsx("span",{className:"font-bold text-base text-purple-700 dark:text-purple-300",children:p(j.monthlyWithdrawalProfit+j.monthlyTransferProfit+j.monthlySalesProfit)})]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-slate-900/50 px-4 py-3 border-t border-gray-100 dark:border-slate-800 flex justify-center",children:e.jsx(I,{onClick:()=>o(!1),className:"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 hover:text-gray-900 w-full sm:w-auto px-8 rounded-lg text-sm font-medium shadow-sm",children:"إغلاق"})})]})}),e.jsx(nf,{open:c,onOpenChange:f,onSuccess:xe,description:"لا يمكن الاطلاع على الأرباح الشهرية إلا بإدخال الرقم السري الرئيسي"})]})},Jy=s=>e.jsx(Ky,{...s});function Hy({open:s,onOpenChange:t,onSuccess:n,userId:o}){const[c,f]=u.useState(""),[b,N]=u.useState(""),[j,D]=u.useState(!1),[C,P]=u.useState(!1),[M,p]=u.useState(""),[q,ee]=u.useState(!1),[$,xe]=u.useState(!1),{toast:L}=ll();u.useEffect(()=>{let Ce=!0;return(async()=>{const Me=await Rt.hasMasterPin(o);Ce&&xe(Me)})(),()=>{Ce=!1}},[o,s]);const J=()=>{f(""),N(""),p(""),D(!1),P(!1),t(!1)},te=async Ce=>{Ce.preventDefault(),p(""),ee(!0);try{if($){if(!await Rt.verifyMasterPin(c,o)){p("الرقم السري غير صحيح"),ee(!1);return}}else{if(c.length<4){p("يجب أن يكون الرقم السري 4 أرقام على الأقل"),ee(!1);return}if(c!==b){p("الرقم السري غير متطابق"),ee(!1);return}if(!await Rt.createMasterPin(c,o)){p("تعذر إنشاء الرقم السري الرئيسي"),ee(!1);return}}L({title:"نجح العملية",description:$?"تم التحقق من الرقم السري الرئيسي بنجاح":"تم إنشاء الرقم السري الرئيسي بنجاح"}),n(),J()}catch{p("حدث خطأ أثناء معالجة الرقم السري")}finally{ee(!1)}};return e.jsx(fe,{open:s,onOpenChange:t,children:e.jsxs(ge,{className:"sm:max-w-md",dir:"rtl",children:[e.jsx(ye,{children:e.jsxs(be,{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(Wd,{className:"h-5 w-5 text-green-600"}),$?"أدخل الرقم السري الرئيسي":"إنشاء الرقم السري الرئيسي"]})}),e.jsxs("form",{onSubmit:te,className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 bg-blue-50 p-3 rounded-lg",children:$?"أدخل الرقم السري الرئيسي لعرض بيانات الأرباح":"قم بإنشاء الرقم السري الرئيسي لحماية بيانات الأرباح. يمكنك تغييره لاحقاً من إعدادات البروفيل."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"pin",children:$?"الرقم السري الرئيسي":"الرقم السري الرئيسي الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{id:"pin",type:j?"text":"password",value:c,onChange:Ce=>f(Ce.target.value),placeholder:$?"أدخل الرقم السري":"أدخل رقم سري جديد (4 أرقام على الأقل)",className:"pr-10",dir:"ltr",autoComplete:"off",required:!0}),e.jsx(I,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>D(!j),children:j?e.jsx(Rd,{className:"h-4 w-4"}):e.jsx(Ks,{className:"h-4 w-4"})})]})]}),!$&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"confirmPin",children:"تأكيد الرقم السري"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{id:"confirmPin",type:C?"text":"password",value:b,onChange:Ce=>N(Ce.target.value),placeholder:"أعد إدخال الرقم السري",className:"pr-10",dir:"ltr",autoComplete:"off",required:!0}),e.jsx(I,{type:"button",variant:"ghost",size:"sm",className:"absolute left-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>P(!C),children:C?e.jsx(Rd,{className:"h-4 w-4"}):e.jsx(Ks,{className:"h-4 w-4"})})]})]}),M&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(of,{className:"h-4 w-4"}),M]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs(I,{type:"submit",disabled:q,className:"flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx(Wd,{className:"h-4 w-4 mr-2"}),q?"جاري المعالجة...":$?"عرض الأرباح":"إنشاء وعرض الأرباح"]}),e.jsx(I,{type:"button",variant:"outline",onClick:J,disabled:q,children:"إلغاء"})]})]})]})})}const Qy=({userId:s,transactions:t})=>{const[n,o]=u.useState(!1),[c,f]=u.useState(!1),[b,N]=u.useState(!1),[j,D]=u.useState({dailyWithdrawalProfit:0,dailyTransferProfit:0,dailySalesProfit:0,lastUpdated:new Date}),{shopId:C}=vu();u.useEffect(()=>{s&&n&&b&&M()},[s,n,b,t,C]),u.useEffect(()=>{if(!n||!b)return;const $=setInterval(()=>{const xe=new Date;j.lastUpdated.getDate()!==xe.getDate()&&M()},3e4);return()=>clearInterval($)},[n,b,j.lastUpdated]);const P=async()=>{if(!s)return 0;const $=new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Cairo"}),xe=$.format(new Date);let L=0;try{const J=Oe(pe(V,"dailySales"),ae("userId","==",s),...C?[ae("shopId","==",C)]:[]),te=await ke(J),Ce=[];te.forEach(de=>{Ce.push({id:de.id,data:de.data()})}),(await ke(pe(V,"users",s,"dailySales"))).forEach(de=>{const Ne=de.data();C&&Ne.shopId&&Ne.shopId!==C||Ce.push({id:de.id,data:Ne})});const Be=new Map;Ce.forEach(de=>{const Ne=String(de.data.clientId||de.id);Be.has(Ne)||Be.set(Ne,de.data)}),Be.forEach(de=>{if(de.isDeferred)return;let Ne=null;if(de.createdAt)typeof de.createdAt.toDate=="function"?Ne=de.createdAt.toDate():de.createdAt instanceof Date?Ne=de.createdAt:typeof de.createdAt=="number"?Ne=new Date(de.createdAt):typeof de.createdAt=="string"&&(Ne=new Date(de.createdAt));else if(de.date){const Fe=de.time||"00:00";Ne=new Date(`${de.date}T${Fe}:00`)}let F=!1;if(Ne&&!isNaN(Ne.getTime())?$.format(Ne)===xe&&(F=!0):String(de.date||"").slice(0,10)===xe&&(F=!0),F){const Fe=Number(de.quantity||1),Re=Number(de.profit??(Number(de.sellingPrice||0)-Number(de.wholesalePrice||0))*Fe);L+=Re}})}catch(J){console.warn("تعذر جلب أرباح المبيعات اليومية:",J)}return Math.round(L*100)/100},M=async()=>{if(s)try{if(Array.isArray(t)&&t.length>0){const L=new Date,J=St.filterVisibleTransactions(t,"daily",s);let te=0,Ce=0;J.forEach(Be=>{const de=new Date(Be.createdAt),Ne=String(Be.status||"confirmed").toLowerCase();if(de.toDateString()!==L.toDateString())return;const F=(Be.type||Be.txnType||"").toLowerCase(),Fe=String(Be.title||"");if(F==="cash_addition"||Fe.includes("إيصال إضافة نقدية"))return;const Re={type:F==="withdrawal"||F==="machine_withdrawal"?"withdraw":F,amount:Number(Be.amount||0),commission:Be.commission};Re.type==="withdraw"?te+=xa.calculateProfitFromTransaction(Re):(Re.type==="send"||Re.type==="receive"||Re.type==="transfer")&&(Ce+=xa.calculateProfitFromTransaction(Re))});const Me=await P();D({dailyWithdrawalProfit:Math.round(te*100)/100,dailyTransferProfit:Math.round(Ce*100)/100,dailySalesProfit:Me,lastUpdated:new Date});try{xa.updateProfitsFromTransactions(t,s)}catch{}return}const $=xa.getWithdrawTransferProfits(s),xe=await P();D({dailyWithdrawalProfit:$.dailyWithdrawProfit||0,dailyTransferProfit:$.dailyTransferProfit||0,dailySalesProfit:xe,lastUpdated:new Date})}catch($){console.error("Error loading profit data:",$)}},p=$=>`${$.toFixed(2)} ج.م`,q=()=>{xa.hasProfitPin(s),f(!0)},ee=()=>{N(!0),o(!0),f(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(I,{size:"sm",variant:"ghost",onClick:q,className:"h-6 w-6 p-0 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-colors duration-200",title:"عرض الأرباح اليومية",children:e.jsx(Ks,{className:"h-4 w-4"})}),e.jsx(fe,{open:n,onOpenChange:o,children:e.jsxs(ge,{className:"max-w-[280px] sm:max-w-[320px] mx-auto bg-white dark:bg-[#0f172a] border border-gray-200 dark:border-slate-800 shadow-xl rounded-xl p-0 overflow-hidden",children:[e.jsx(ye,{className:"bg-gray-50 dark:bg-slate-900/50 px-4 py-3 border-b border-gray-100 dark:border-slate-800",children:e.jsxs(be,{className:"text-sm font-bold text-gray-900 dark:text-slate-100 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white dark:bg-slate-800 rounded-full border border-gray-200 dark:border-slate-700",children:e.jsx(Pa,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})}),"أرباح اليوم"]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-red-50 dark:bg-red-900/20 rounded-md",children:e.jsx(Vs,{className:"h-3.5 w-3.5 text-red-600 dark:text-red-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"سحب"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:p(j.dailyWithdrawalProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-green-50 dark:bg-green-900/20 rounded-md",children:e.jsx(wu,{className:"h-3.5 w-3.5 text-green-600 dark:text-green-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"تحويل"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:p(j.dailyTransferProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-violet-50 dark:bg-violet-900/20 rounded-md",children:e.jsx(Nu,{className:"h-3.5 w-3.5 text-violet-600 dark:text-violet-400"})}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-slate-300 text-sm",children:"أرباح المبيعات"})]}),e.jsx("span",{className:"font-bold text-sm text-gray-900 dark:text-slate-100",children:p(j.dailySalesProfit)})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-900/30 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-white dark:bg-slate-800 rounded-md shadow-sm",children:e.jsx(Pa,{className:"h-3.5 w-3.5 text-blue-600 dark:text-blue-400"})}),e.jsx("span",{className:"font-bold text-blue-900 dark:text-blue-100 text-sm",children:"الإجمالي"})]}),e.jsx("span",{className:"font-bold text-base text-blue-700 dark:text-blue-300",children:p(j.dailyWithdrawalProfit+j.dailyTransferProfit+j.dailySalesProfit)})]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-slate-900/50 px-4 py-3 border-t border-gray-100 dark:border-slate-800 flex justify-center",children:e.jsx(I,{onClick:()=>o(!1),className:"bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-700 text-gray-700 dark:text-slate-200 hover:bg-gray-50 dark:hover:bg-slate-700 hover:text-gray-900 w-full sm:w-auto px-8 rounded-lg text-sm font-medium shadow-sm",children:"إغلاق"})})]})}),e.jsx(Hy,{open:c,onOpenChange:f,onSuccess:ee,userId:s})]})},Gy=s=>e.jsx(Qy,{...s});class qs{static async processTransfer(t){const{amount:n,currentCashBalance:o,currentWalletBalances:c,wallets:f,selectedWalletId:b}=t;if(n<=0)return{success:!1,newCashBalance:o,newWalletBalances:c,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};if(b&&!t.skipRemoteLimitsCheck)try{const C=await is.canPerformOperation(b,n,"transfer");if(!C.canPerform)return{success:!1,newCashBalance:o,newWalletBalances:c,message:C.message||"تم تجاوز الحد الأقصى",error:"LIMIT_EXCEEDED"}}catch(C){return console.error("خطأ في التحقق من حدود التحويل:",C),{success:!1,newCashBalance:o,newWalletBalances:c,message:"خطأ في التحقق من حدود التحويل",error:"LIMIT_CHECK_ERROR"}}if(n<=0)return{success:!1,newCashBalance:o,newWalletBalances:c,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};if(b){const C=Math.max(c[b]||0,0);if(C<n){const P=f.find(M=>M.id===b);return{success:!1,newCashBalance:o,newWalletBalances:c,message:`رصيد غير كافي في المحفظة${P?` ${P.name}`:""}. المتاح: ${C} جنيه، المطلوب: ${n} جنيه`,error:"INSUFFICIENT_WALLET_BALANCE"}}}else{const C=qs.calculateTotalWalletBalance(c);if(C<n)return{success:!1,newCashBalance:o,newWalletBalances:c,message:`رصيد غير كافي في المحافظ. الرصيد المتاح: ${C} جنيه، المبلغ المطلوب: ${n} جنيه`,error:"INSUFFICIENT_WALLET_BALANCE"}}const N={...c};if(b){const C=N[b]||0;N[b]=C-n}else{let C=n;for(const P of f){if(C<=0)break;const M=Math.max(N[P.id]||0,0),p=Math.min(M,C);p>0&&(N[P.id]=(N[P.id]||0)-p,C-=p)}}const j=o+n;let D="تم التحويل بنجاح";if(b){const C=N[b]||0;C<0&&(D=`تم التحويل بنجاح مع تحذير: رصيد محفظة ${b} أصبح ${C} جنيه.`)}return{success:!0,newCashBalance:j,newWalletBalances:N,message:D}}static processDeposit(t){const{amount:n,currentCashBalance:o,currentWalletBalances:c,wallets:f}=t;if(n<=0)return{success:!1,newCashBalance:o,newWalletBalances:c,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};const b=this.calculateTotalWalletBalance(c);if(b<n)return{success:!1,newCashBalance:o,newWalletBalances:c,message:`رصيد غير كافي في المحافظ. الرصيد المتاح: ${b} جنيه، المبلغ المطلوب: ${n} جنيه`,error:"INSUFFICIENT_WALLET_BALANCE"};const N=o+n,j={...c};let D=n;const C=f.find(M=>M.isDefault);if(C&&j[C.id]>=D)j[C.id]-=D,D=0;else for(const M of f){if(D<=0)break;const p=j[M.id]||0;if(p>0){const q=Math.min(p,D);j[M.id]=p-q,D-=q}}const P=D>0?`تم الإيداع جزئياً. تم إيداع ${n-D} جنيه في صندوق النقدية`:`تم الإيداع بنجاح. تم إضافة ${n} جنيه إلى صندوق النقدية`;return{success:!0,newCashBalance:N,newWalletBalances:j,message:P}}static async processWithdraw(t){const{amount:n,currentCashBalance:o,currentWalletBalances:c,wallets:f,selectedWalletId:b}=t;if(n<=0)return{success:!1,newCashBalance:o,newWalletBalances:c,message:"المبلغ يجب أن يكون أكبر من الصفر",error:"INVALID_AMOUNT"};if(b&&!t.skipRemoteLimitsCheck)try{const C=await is.canPerformOperation(b,n,"withdraw");if(!C.canPerform)return{success:!1,newCashBalance:o,newWalletBalances:c,message:C.message||"تم تجاوز الحد الأقصى",error:"LIMIT_EXCEEDED"}}catch(C){return console.error("خطأ في التحقق من حدود السحب:",C),{success:!1,newCashBalance:o,newWalletBalances:c,message:"خطأ في التحقق من حدود السحب",error:"LIMIT_CHECK_ERROR"}}if(o<n)return{success:!1,newCashBalance:o,newWalletBalances:c,message:`رصيد غير كافي في صندوق النقدية. الرصيد المتاح: ${o} جنيه، المبلغ المطلوب: ${n} جنيه`,error:"INSUFFICIENT_CASH_BALANCE"};const N=o-n,j={...c},D=b?f.find(C=>C.id===b):f.find(C=>C.isDefault)||f[0];if(D){const C=j[D.id]||0;j[D.id]=C+n}else return{success:!1,newCashBalance:o,newWalletBalances:c,message:"لا توجد محافظ متاحة لإضافة المبلغ إليها",error:"NO_WALLETS_AVAILABLE"};return{success:!0,newCashBalance:N,newWalletBalances:j,message:`تم السحب بنجاح. تم إضافة ${n} جنيه إلى محفظة ${(D==null?void 0:D.name)||""}`}}static validateOperation(t,n){return t<=0?{valid:!1,error:"المبلغ يجب أن يكون أكبر من الصفر"}:!n||n.length===0?{valid:!1,error:"لا توجد محافظ متاحة"}:{valid:!0}}static calculateTotalWalletBalance(t){return Object.values(t).reduce((n,o)=>n+Math.max(o,0),0)}static deductFromWalletsAddToCash(t,n,o,c){return this.processTransfer({amount:t,currentCashBalance:n,currentWalletBalances:o,wallets:c})}static deductFromWalletsAddToCashDeposit(t,n,o,c){return this.processDeposit({amount:t,currentCashBalance:n,currentWalletBalances:o,wallets:c})}static deductFromCashAddToWallets(t,n,o,c){return this.processWithdraw({amount:t,currentCashBalance:n,currentWalletBalances:o,wallets:c})}static applyTransactionResult(t,n,o){t.success&&(n(t.newCashBalance),o(t.newWalletBalances))}static validateTransaction(t,n,o,c){if(t<=0)return{isValid:!1,error:"المبلغ يجب أن يكون أكبر من الصفر"};if(n==="transfer"){const f=this.calculateTotalWalletBalance(c);if(f<t)return{isValid:!1,error:`الرصيد المتاح في المحافظ (${f} جنيه) غير كافي للمبلغ المطلوب (${t} جنيه)`}}else if(n==="withdraw"){if(o<t)return{isValid:!1,error:`الرصيد المتاح في صندوق النقدية (${o} جنيه) غير كافي للمبلغ المطلوب (${t} جنيه)`}}else if(n==="deposit"){const f=this.calculateTotalWalletBalance(c);if(f<t)return{isValid:!1,error:`الرصيد المتاح في المحافظ (${f} جنيه) غير كافي للمبلغ المطلوب (${t} جنيه)`}}return{isValid:!0}}static getDeductionPreview(t,n,o){const c=[];let f=t;for(const b of o){if(f<=0)break;const N=n[b.id]||0,j=Math.min(Math.max(N,0),f);j>0&&(c.push({walletId:b.id,walletName:b.name,currentBalance:N,deductedAmount:j,newBalance:N-j}),f-=j)}return c}}let qr=null;function Xy(){const s=window;if(!qr){const t=s.AudioContext||s.webkitAudioContext;qr=new t}return qr.state==="suspended"&&qr.resume(),qr}function Zy(s,t,n){const o=n/1e3,c=Math.floor(s.sampleRate*o),f=s.createBuffer(1,c,s.sampleRate),b=f.getChannelData(0);for(let C=0;C<c;C++)b[C]=(Math.random()*2-1)*.6;const N=s.createBufferSource();N.buffer=f;const j=s.createBiquadFilter();j.type="highpass",j.frequency.value=1500,j.Q.value=.7;const D=s.createGain();D.gain.setValueAtTime(1e-4,t),D.gain.exponentialRampToValueAtTime(.4,t+.015),D.gain.exponentialRampToValueAtTime(1e-4,t+o),N.connect(j),j.connect(D),D.connect(s.destination),N.start(t),N.stop(t+o+.01)}function eb(s,t,n,o,c,f="triangle"){const b=s.createOscillator(),N=s.createGain();b.type=f;const j=c/1e3;b.frequency.setValueAtTime(n,t),b.frequency.linearRampToValueAtTime(o,t+j),N.gain.setValueAtTime(1e-4,t),N.gain.exponentialRampToValueAtTime(.25,t+.02),N.gain.exponentialRampToValueAtTime(1e-4,t+j),b.connect(N),N.connect(s.destination),b.start(t),b.stop(t+j+.02)}function tb(){try{const s=Xy(),t=s.currentTime;Zy(s,t,90),eb(s,t+.12,1900,1100,180,"sawtooth")}catch{}}function ab(s){if(!s)return!1;const n=s.replace(/[^0-9٠-٩]/g,"").replace(/[٠-٩]/g,o=>"0123456789"["٠١٢٣٤٥٦٧٨٩".indexOf(o)]);return/^(010|011|012|015)[0-9]{8}$/.test(n)}const sb=({isOpen:s,onClose:t,senderPhone:n,receiverPhone:o,amount:c,deviceId:f,api:b})=>{const{toast:N}=ll(),[j,D]=u.useState(1),[C,P]=u.useState(!1),[M,p]=u.useState("");u.useEffect(()=>{s&&(D(1),p(""))},[s]);const q=async te=>{try{return b&&typeof b.enterPin=="function"?(await b.enterPin(f,te),!0):!1}catch(Ce){return console.error("ADB error:",Ce),N({title:"خطأ ADB",description:Ce.message||"فشل الاتصال",variant:"destructive"}),!1}},ee=async()=>{if(!M){N({title:"أدخل الرقم السري",variant:"destructive"});return}P(!0);const te=await q(M);P(!1),te&&D(2)},$=async()=>{P(!0);const te=await q(String(c));P(!1),te&&D(3)},xe=async()=>{P(!0);const te=await q(o);P(!1),te&&D(4)},L=async()=>{P(!0);const te=await q(o);P(!1),te&&D(5)},J=async()=>{P(!0);const te=await q("1");P(!1),te&&(N({title:"تم التحويل بنجاح",description:"تم تأكيد العملية"}),t())};return e.jsx(fe,{open:s,onOpenChange:te=>!te&&t(),children:e.jsxs(ge,{className:"sm:max-w-[400px]",children:[e.jsxs(ye,{children:[e.jsx(be,{children:"تحويل اتصالات كاش (USSD)"}),e.jsxs(at,{children:[j===1&&"الخطوة 1: أدخل الرقم السري للمحفظة",j===2&&"الخطوة 2: تأكيد مبلغ التحويل",j===3&&"الخطوة 3: إدخال رقم المستقبل",j===4&&"الخطوة 4: تأكيد رقم المستقبل",j===5&&"الخطوة 5: تأكيد العملية النهائية"]})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[j===1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"الرقم السري (PIN)"}),e.jsx(Y,{type:"password",value:M,onChange:te=>p(te.target.value),placeholder:"****",autoFocus:!0,className:"text-center text-lg tracking-widest",maxLength:6,onKeyDown:te=>{te.key==="Enter"&&M&&ee()}})]}),j===2&&e.jsxs("div",{className:"text-center bg-gray-50 dark:bg-slate-800 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"سيتم إرسال المبلغ:"}),e.jsx("p",{className:"text-2xl font-bold font-mono tracking-wider",children:c})]}),j===3&&e.jsxs("div",{className:"text-center bg-gray-50 dark:bg-slate-800 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"سيتم إرسال رقم المستقبل:"}),e.jsx("p",{className:"text-2xl font-bold font-mono tracking-wider",children:o})]}),j===4&&e.jsxs("div",{className:"text-center bg-gray-50 dark:bg-slate-800 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"تأكيد الرقم مرة أخرى:"}),e.jsx("p",{className:"text-2xl font-bold font-mono tracking-wider",children:o})]}),j===5&&e.jsxs("div",{className:"text-center bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-100 dark:border-green-900",children:[e.jsx("p",{className:"text-lg font-bold text-green-700 dark:text-green-400 mb-2",children:"جاهز للتأكيد"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"سيتم إرسال رقم 1 لتأكيد التحويل"})]})]}),e.jsxs(Pe,{children:[j===1&&e.jsx(I,{onClick:ee,disabled:C||!M,className:"w-full bg-black hover:bg-neutral-800 text-white",children:C?e.jsx(Ur,{className:"animate-spin h-4 w-4 mr-2"}):"إرسال الرقم السري"}),j===2&&e.jsx(I,{onClick:$,disabled:C,className:"w-full bg-black hover:bg-neutral-800 text-white",children:C?e.jsx(Ur,{className:"animate-spin h-4 w-4 mr-2"}):"إرسال المبلغ"}),j===3&&e.jsx(I,{onClick:xe,disabled:C,className:"w-full bg-black hover:bg-neutral-800 text-white",children:C?e.jsx(Ur,{className:"animate-spin h-4 w-4 mr-2"}):"إرسال الرقم"}),j===4&&e.jsx(I,{onClick:L,disabled:C,className:"w-full bg-black hover:bg-neutral-800 text-white",children:C?e.jsx(Ur,{className:"animate-spin h-4 w-4 mr-2"}):"تأكيد الرقم"}),j===5&&e.jsx(I,{onClick:J,disabled:C,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:C?e.jsx(Ur,{className:"animate-spin h-4 w-4 mr-2"}):"تأكيد (1)"})]})]})})},rb=G.lazy(()=>X(()=>import("./index-mBSeGJ8K.js").then(s=>s.cG),__vite__mapDeps([0,1]),import.meta.url).then(s=>({default:s.BranchRequestDialog}))),nb=G.lazy(()=>X(()=>import("./WalletManagement-BoLvPBKD.js"),__vite__mapDeps([2,0,1,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),import.meta.url)),ib=G.lazy(()=>X(()=>import("./TransactionDetailsModal-CSxn9Q83.js"),__vite__mapDeps([18,0,1,19,3,14,11,20,16,17]),import.meta.url)),ob=G.lazy(()=>X(()=>import("./ReceiptModal-BFQZdr4L.js"),__vite__mapDeps([21,0,1,19,10,3,22,17,20,23]),import.meta.url)),uu=G.lazy(()=>X(()=>import("./EditBalanceDialog-qarNPs8R.js"),__vite__mapDeps([24,0,1,14]),import.meta.url).then(s=>({default:s.EditBalanceDialog}))),lb=G.lazy(()=>X(()=>import("./ChangePinDialog-Cnqn4nfu.js"),__vite__mapDeps([25,0,1]),import.meta.url).then(s=>({default:s.ChangePinDialog}))),cb=G.lazy(()=>X(()=>import("./ChangeCashPinDialog-DedQlkhY.js"),__vite__mapDeps([26,0,1,14]),import.meta.url).then(s=>({default:s.ChangeCashPinDialog}))),db=G.lazy(()=>X(()=>import("./ChangeWalletTotalPinDialog-UbPmSLD7.js"),__vite__mapDeps([27,0,1,5]),import.meta.url).then(s=>({default:s.ChangeWalletTotalPinDialog}))),ub=G.lazy(()=>X(()=>import("./index-mBSeGJ8K.js").then(s=>s.cE),__vite__mapDeps([0,1]),import.meta.url)),la=G.lazy(()=>X(()=>import("./index-mBSeGJ8K.js").then(s=>s.cF),__vite__mapDeps([0,1]),import.meta.url)),mb=G.lazy(()=>X(()=>import("./AddToWalletDialog-ib4x4avS.js"),__vite__mapDeps([28,0,1]),import.meta.url).then(s=>({default:s.AddToWalletDialog}))),hb=G.lazy(()=>X(()=>import("./CalculatorDialog-jmN5iz8h.js"),__vite__mapDeps([29,0,1,19]),import.meta.url).then(s=>({default:s.CalculatorDialog}))),fb=G.lazy(()=>X(()=>import("./SalesDataDialog-DCdwk3tK.js"),__vite__mapDeps([30,0,1,31,3,32,33,4,34,10,35,12,36,14,11,7,20,37,8,13,16,38,39,40,41,17,42,43,44,45,46,47,48,19,5,6]),import.meta.url).then(s=>({default:s.SalesDataDialog}))),gb=G.lazy(()=>X(()=>import("./CashSummaryDialog-BCvGvC4U.js"),__vite__mapDeps([49,0,1,14,19,50,38,39,7,40,4,41,16,17,36,42,8,3,32,33,34,43,44,45,46,47,11,48,5,20,6]),import.meta.url).then(s=>({default:s.CashSummaryDialog}))),pb=G.lazy(()=>X(()=>import("./CreditCardsDialog-DEPojYwD.js"),__vite__mapDeps([51,0,1,17,37,11,14]),import.meta.url)),xb=G.lazy(()=>X(()=>import("./InstallmentModal-D08gq3I4.js"),__vite__mapDeps([52,0,1,3,11]),import.meta.url)),yb=G.lazy(()=>X(()=>import("./MaintenanceDialog-D00XSB7E.js"),__vite__mapDeps([53,0,1,3,10,47,36,17]),import.meta.url).then(s=>({default:s.default}))),bb=G.lazy(()=>X(()=>import("./MachineDailyDialog-Czf3I2ct.js"),__vite__mapDeps([54,0,1,3,10,35,4,11]),import.meta.url)),vb=G.lazy(()=>X(()=>import("./WalletsManagement-DMptkT8R.js"),__vite__mapDeps([55,0,1,3,9,4,56,40,22,20,5,8,7,23]),import.meta.url).then(s=>({default:s.WalletsManagement}))),wb=G.lazy(()=>X(()=>import("./WalletsListDialog-HQlHnCJO.js"),__vite__mapDeps([57,0,1,4,5,58]),import.meta.url).then(s=>({default:s.WalletsListDialog}))),mu=G.lazy(()=>X(()=>import("./WalletPrinterDialog-CoSkJsm5.js"),__vite__mapDeps([56,0,1,40,22,20,5,8,7,23]),import.meta.url)),Nb=G.lazy(()=>X(()=>import("./CashierShiftModal-uXu3l3hI.js"),__vite__mapDeps([59,0,1,60]),import.meta.url)),jb=G.lazy(()=>X(()=>import("./ShiftProfileDialog-DViQNVlG.js"),__vite__mapDeps([61,0,1]),import.meta.url)),Sb=G.lazy(()=>X(()=>import("./ChangeLogDialog-D_M__mBy.js"),__vite__mapDeps([62,0,1,63]),import.meta.url));function Db({userId:s}){const[t,n]=G.useState(null),[o,c]=G.useState("");return null}const kb=()=>{var kd,Cd,Id,_d,Td,Ad,Pd;console.log("🔥 UserDashboardPage component is loading...");const{signOut:s,user:t,profile:n}=ol(),o=((t==null?void 0:t.email)||"").toLowerCase()==="vodafonecash00@gmail.com",c=yu(),f=lf(),b=cf(),{isShiftActive:N,shiftUser:j}=df(),{shopId:D,shopName:C}=vu(),P=uf(),M=mf(),{toast:p}=ll(),q=u.useRef(null),[ee,$]=u.useState(0),[xe,L]=u.useState(!1),[J,te]=u.useState(!1),[Ce,Me]=u.useState(!1),[Be,de]=u.useState(!1),Ne=u.useRef(!1),[F,Fe]=u.useState(()=>{try{const a=Object.keys(localStorage).find(i=>i.startsWith("wallets_")),r=a?localStorage.getItem(a):null;if(r){const i=JSON.parse(r);if(Array.isArray(i))return i}}catch{}return[]}),[Re,Gt]=u.useState([]);u.useEffect(()=>{var a;(a=c.state)!=null&&a.openProfileSettings&&(L(!0),window.history.replaceState({},document.title))},[c.state]);const ze=async()=>{var i,l,d;const a="alkaptin678678@gmail.com",r=(l=(i=Us.currentUser)==null?void 0:i.email)==null?void 0:l.toLowerCase();if(!r||r!==a){p({title:"قيد التطوير",description:"هذه الميزة غير متاحة حالياً."});return}if(!An||!Pn||!On){p({title:"بيانات ناقصة",description:"أدخل رقم الموبايل، الشركة والمبلغ",variant:"destructive"});return}try{Zc(!0);const m=await((d=Us.currentUser)==null?void 0:d.getIdToken()),h=await fetch("/api/topup",{method:"POST",headers:{"Content-Type":"application/json",...m?{Authorization:`Bearer ${m}`}:{}},body:JSON.stringify({phone:An,countryCode:"EG",operator:Pn,amount:Number(On),useLocalAmount:!0})}),g=await h.json().catch(()=>({}));h.ok&&(g!=null&&g.success)?(p({title:"تم الشحن",description:(g==null?void 0:g.message)||"تم تنفيذ عملية الشحن بنجاح"}),So(!1),Hc(""),Qc(""),Gc("")):p({title:"فشل الشحن",description:(g==null?void 0:g.message)||"حدث خطأ أثناء طلب الشحن",variant:"destructive"})}catch(m){console.error("Topup request error:",m),p({title:"خطأ غير متوقع",description:"تعذّر تنفيذ عملية الشحن. حاول لاحقاً.",variant:"destructive"})}finally{Zc(!1)}};(()=>{try{return!!window.electronAPI||typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("electron")||typeof window<"u"&&window.location&&window.location.protocol==="file:"}catch{return!1}})();const[Je,lt]=u.useState(!1),[H,K]=u.useState(!1),[Bt,Ot]=u.useState(!1),[Dt,Q]=u.useState(!1),[ue,le]=u.useState(!1),[Ye,He]=u.useState(!1),[$t,Qe]=u.useState([]),[ea,ls]=u.useState(""),[cs,ta]=u.useState(""),[Gs,ds]=u.useState(""),[Va,us]=u.useState(""),[ms,Xr]=u.useState(!1),[em,di]=u.useState(!1),[tm,Cb]=u.useState(null),[Nl,jl]=u.useState(""),[Sl,Dl]=u.useState(""),[am,kl]=u.useState(!1),[sm,Zr]=u.useState(!1),[rm,Cl]=u.useState(!1),[kt,nm]=u.useState(null),[hs,Il]=u.useState(!1),[_l,im]=u.useState(!1),[it,om]=u.useState(null);u.useEffect(()=>{hf().then(om).catch(()=>{})},[]);const[Tl,lm]=u.useState(void 0);u.useEffect(()=>{try{const a=window.electronAPI;a&&typeof a.appVersion=="function"&&a.appVersion().then(r=>{typeof r=="string"&&!r.startsWith("err:")&&lm(r)}).catch(()=>{})}catch{}},[]);const Al=(()=>{var i,l;const a=(l=(i=import.meta)==null?void 0:i.env)==null?void 0:l.VITE_APP_VERSION,r=typeof window<"u"&&(window.electronAPI||window.location.protocol==="file:"||typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("electron"));if(r&&(n!=null&&n.desktopInstalledVersion))return n==null?void 0:n.desktopInstalledVersion;if(r&&Tl)return Tl;if(a)return a;if(!(!it&&!n))return M?(n==null?void 0:n.androidInstalledVersion)||(n==null?void 0:n.lastAckAndroidVersion)||(it==null?void 0:it.androidVersion)||(it==null?void 0:it.pcVersion):(it==null?void 0:it.pcVersion)||(it==null?void 0:it.androidVersion)})();u.useEffect(()=>{ue&&(t!=null&&t.uid)&&!_l&&(async()=>{Xr(!0);try{let r=[],i=[];try{const h=pe(V,"users",t.uid,"branches");r=(await ke(h)).docs.map(v=>({id:v.id,...v.data(),source:"sub"}))}catch(h){console.warn("Failed to fetch subcollection branches:",h)}try{const h=Oe(pe(V,"branches"),ae("ownerId","==",t.uid));i=(await ke(h)).docs.map(v=>({id:v.id,...v.data(),source:"root"}))}catch(h){console.warn("Failed to fetch root branches:",h)}const l=[...r,...i],d=new Map;l.forEach(h=>{const g=h.branchUserId||h.id;(!d.has(g)||h.source==="sub")&&d.set(g,h)});const m=Array.from(d.values());console.log("Loaded branches:",m),Qe(m),im(!0)}catch(r){console.error("Error in branch loading process:",r),p({title:"تنبيه",description:"حدث خطأ أثناء تحديث القائمة",variant:"destructive"})}finally{Xr(!1)}})()},[ue,t==null?void 0:t.uid,_l]),u.useEffect(()=>{ue||Il(!1)},[ue]);const[cm,en]=u.useState(!1),[fs,dm]=u.useState(null),[tn,Pl]=u.useState(""),[an,Ol]=u.useState(""),[um,mm]=u.useState(""),[El,Ml]=u.useState(!1),hm=a=>{dm(a),Pl(a.branchName||""),Ol(a.managerName||""),mm(a.loginUsername||a.email||a.username||""),en(!0)},fm=async()=>{if(!(!fs||!tn||!an)){Ml(!0);try{const a={branchName:tn,managerName:an,updatedAt:new Date};if(fs.branchUserId)try{await Ht(Te(V,"users",(t==null?void 0:t.uid)||"","branches",String(fs.branchUserId)),a,{merge:!0});try{await Xt(Te(V,"users",fs.branchUserId),{displayName:tn,managerName:an})}catch(r){console.warn("Could not update branch root user doc",r)}}catch(r){console.warn("Sub branch update failed:",r)}try{await Xt(Te(V,"branches",fs.id),a)}catch{}Qe(r=>r.map(i=>i.id===fs.id?{...i,...a}:i)),p({title:"تم تحديث بيانات الفرع بنجاح"}),en(!1)}catch(a){console.error("Error updating branch:",a),p({title:"فشل تحديث البيانات",description:a.message,variant:"destructive"})}finally{Ml(!1)}}},gm=async a=>{if(!(a!=null&&a.branchUserId)){p({title:"خطأ",description:"بيانات الفرع غير مكتملة",variant:"destructive"});return}Cl(!0),Zr(!0);try{const r=a.branchUserId;if(t!=null&&t.uid&&a.branchUserId&&a.source!=="sub")try{await Ht(Te(V,"users",t.uid,"branches",a.branchUserId),{branchUserId:a.branchUserId,branchName:a.branchName||"Unknown Branch",managerName:a.managerName||"",active:!0,lastSynced:wt()},{merge:!0}),console.log("✅ Branch link synced successfully"),await new Promise(je=>setTimeout(je,500))}catch(je){console.error("❌ Failed to sync branch link:",je)}const[i,l,d,m]=await Promise.all([ca(Te(V,"users",r)),(async()=>{try{const je=Oe(pe(V,"merchantWallets"),ae("merchantUserId","==",r)),ce=await ke(je);if(!ce.empty)return ce;const nt=await ke(pe(V,"users",r,"wallets"));return nt.empty?await ke(Oe(pe(V,"wallets"),ae("userId","==",r))):nt}catch(je){console.error("Error fetching wallets",je);try{return await ke(Oe(pe(V,"wallets"),ae("userId","==",r)))}catch{return{docs:[]}}}})(),(async()=>{try{return await ke(Oe(pe(V,"debts"),ae("userId","==",r)))}catch{return await ke(pe(V,"users",r,"debts"))}})(),(async()=>{try{const je=Oe(pe(V,"dailySales"),ae("userId","==",r)),ce=await ke(je);return ce.empty?await ke(pe(V,"users",r,"dailySales")):ce}catch(je){return console.error("Error fetching sales",je),await ke(pe(V,"users",r,"dailySales"))}})()]),h=i.exists()?i.data():{},g=Number(h.cashBalance||0),v=h.reportsData||{},y=Number(v.dailyProfit||0),x=Number(v.monthlyProfit||0),w=h.walletBalances||{},k=l.docs.filter(je=>je.data().isActive===!0),S=new Set(k.map(je=>je.id));let T=0;S.size>0&&(T=Object.entries(w).filter(([je])=>S.has(je)).reduce((je,[ce,nt])=>je+Number(nt||0),0)),T===0&&k.length>0&&(T=k.reduce((je,ce)=>je+Number(ce.data().balance||ce.data().amount||0),0));let O=0;d.forEach(je=>{const ce=je.data();if(ce.type!=="debtor"){const nt=Number(ce.paidAmount||0),ut=Math.max(0,Number(ce.amount||0)-nt);O+=ut}});const A=new Date().toISOString().split("T")[0],B=A.slice(0,7);let z=0,re=0,tt=y,yt=x,dt=0;console.log(`Branch Details - UID: ${r}, Wallets: ${l.size}, Sales: ${m.size}, ReportsDaily: ${y}`),m.forEach(je=>{const ce=je.data(),nt=String(ce.date||""),ut=Number(ce.sellingPrice||0)*Number(ce.quantity||1),mt=Number(ce.profit||0);dt+=ut,nt===A&&(z+=ut,tt+=mt),nt.startsWith(B)&&(re+=ut,yt+=mt)}),nm({branchName:a.branchName,managerName:a.managerName,todaySales:z,monthSales:re,todayProfit:tt,monthProfit:yt,walletsTotal:T,cashBalance:g,totalSalesSection:dt,debtsTotal:O})}catch(r){console.error("Error fetching branch details:",r),p({title:"تعذر تحميل بيانات الفرع",description:r.message,variant:"destructive"}),Zr(!1)}finally{Cl(!1)}},[E,Xs]=u.useState("");u.useEffect(()=>{const a=b==null?void 0:b.shopId;if(a&&(t!=null&&t.uid))try{const r=`selectedShopId_${t.uid}`;localStorage.setItem(r,String(a)),window.dispatchEvent(new Event("selectedShopIdChanged"))}catch{}},[b==null?void 0:b.shopId,t==null?void 0:t.uid]);const[ui,pm]=u.useState([]),[qa,za]=u.useState(()=>{try{return localStorage.getItem("cashySelectedDevice")||null}catch{return null}});u.useEffect(()=>{},[]),u.useEffect(()=>{(async()=>{if(E)try{await Wr.set({key:"selected_wallet_id",value:E}),console.log("📱 Synced selected_wallet_id to Native:",E)}catch(r){console.error("Failed to sync wallet to native:",r)}else await Wr.remove({key:"selected_wallet_id"})})()},[E]),u.useEffect(()=>{(async()=>{if(D)try{await Wr.set({key:"shopId",value:D}),console.log("📱 Synced shopId to Native:",D)}catch(r){console.error("Failed to sync shopId to native:",r)}})()},[D]);const mi=a=>!!(a&&ui.some(r=>r.id===a));async function hi(){const a=window.electronAPI,r=qa||"";if(!a||typeof a.sendUssd!="function")return null;if(!r)return p({title:"الجهاز غير محدد",description:"اتصل بالموبايل أولاً ثم اختر الجهاز من القائمة",variant:"destructive"}),null;if(mi(r))return r;try{const m=ui.find(h=>h&&h.id&&!String(h.id).includes(":"));if(m&&m.id)return za(m.id),m.id}catch{}const i=r.includes(":")?r.split(":").slice(0,2).join(":"):"";if(i&&typeof a.connectWifi=="function"){try{const m=await a.connectWifi(i);if(typeof m=="string"&&(m.includes("✅")||m.toLowerCase().includes("connected")))return r}catch{}if(typeof a.refreshAdbDevices=="function")try{await a.refreshAdbDevices()}catch{}await new Promise(m=>setTimeout(m,250))}const l=r.split(":")[0],d=ui.find(m=>(m.id.startsWith(l)||m.id.includes(l))&&m.id.includes(":"));if(d!=null&&d.id){const m=d.id.split(":").slice(0,2).join(":");if(!mi(d.id)&&typeof a.connectWifi=="function"){try{const h=await a.connectWifi(m);if(typeof h=="string"&&(h.includes("✅")||h.toLowerCase().includes("connected")))return za(d.id),d.id}catch{}await new Promise(h=>setTimeout(h,250))}if(mi(d.id))return za(d.id),d.id}return r&&i?r:(p({title:"الجهاز غير متصل",description:"فعّل Wireless debugging أو استخدم اتصال Wi‑Fi ثم أعد المحاولة",variant:"destructive"}),null)}u.useEffect(()=>{const a=window.electronAPI;a&&typeof a.onAdbDevices=="function"&&a.onAdbDevices(r=>{var m;const i=Array.isArray(r)?r:[];pm(i);const l=(()=>{try{return localStorage.getItem("cashySelectedDevice")||""}catch{return""}})();if(l&&i.some(h=>h.id===l))za(l);else{const h=l?String(l).split(":")[0]:"",g=h?i.find(v=>(v.id.startsWith(h)||v.id.includes(h))&&String(v.type||"").toLowerCase().includes("wifi")):void 0;g!=null&&g.id?za(g.id):!l&&((m=i[0])!=null&&m.id)?za(v=>v||i[0].id):i.length||za(null)}})},[]);function xm(a,r){try{const i=Ge==null?void 0:Ge(),l=(i==null?void 0:i.phone)||"";if(!l){p({title:"يجب اختيار محفظة",description:"اختر محفظة المُرسل أولاً",variant:"destructive"});return}if(M&&l.startsWith("011")){Ko("*777*1#"),p({title:"تم إرسال كود التحويل",description:"تم طلب كود اتصالات *777*1#"}),ra(!1),Sa(!1);return}Pf(l,a,r),p({title:"تم إرسال كود التحويل",description:"تم تنفيذ الاتصال مباشرة على الهاتف"}),ra(!1),Sa(!1)}catch(i){const l=(i==null?void 0:i.message)||"تعذر إرسال الكود — تحقق من البيانات";throw p({title:"فشل الإرسال",description:l,variant:"destructive"}),i}}const[Et,fi]=u.useState(null),ym=async()=>{var h;if(!rt||!rt.receiver||!rt.amount){p({title:"بيانات غير مكتملة",description:"تأكد من إدخال رقم المستقبل والمبلغ قبل الإرسال",variant:"destructive"});return}const a=String(rt.receiver),r=Math.round(Number(rt.amount));na(!0);const i=Ge==null?void 0:Ge(),l=(i==null?void 0:i.phone)||"",d=Af(l),m=window.electronAPI;if(d==="etisalat"&&l.startsWith("011")&&m&&typeof m.sendUssd=="function"&&qa){try{const g=await hi();if(!g){na(!1);return}let v=g;Et!==null&&(v=`${g}:sim${Et}`),Ki(v),await m.sendUssd(v,"*777*1#"),xc(!0),ra(!1)}catch(g){console.error("Etisalat flow init error",g),p({title:"خطأ",description:"فشل بدء تحويل اتصالات: "+(g.message||""),variant:"destructive"})}finally{na(!1)}return}if(d==="orange"&&l.startsWith("012")&&m&&typeof m.sendUssd=="function"&&qa){try{const g=await hi();if(!g){na(!1);return}const v=`*7115*7*${a}*${r}#`;let y=g;Et!==null&&(y=`${g}:sim${Et}`),Ki(y),await m.sendUssd(y,v),Sa(!0),ra(!1)}catch(g){console.error("Orange flow init error",g),p({title:"خطأ",description:"فشل بدء تحويل أورنج: "+(g.message||""),variant:"destructive"})}finally{na(!1)}return}try{if((h=ni)!=null&&h.isNativePlatform&&ni.getPlatform()==="android"){const v=Ge==null?void 0:Ge(),y=(v==null?void 0:v.phone)||"";if(!y){p({title:"يجب اختيار محفظة",description:"اختر محفظة المُرسل أولاً",variant:"destructive"}),na(!1);return}if(y.startsWith("011")){Ko("*777*1#",Et===0?"sim1":Et===1?"sim2":void 0),p({title:"تم الاتصال",description:"تم طلب كود اتصالات *777*1#"}),ra(!1),Sa(!1);return}const x=Vd(y,a,r);if(!x){p({title:"رقم غير مدعوم",description:"تحقق من بداية الرقم 010/011/012/015",variant:"destructive"}),na(!1);return}Ko(x,Et===0?"sim1":Et===1?"sim2":void 0),p({title:"تم إرسال كود التحويل",description:"تم تنفيذ الاتصال مباشرة على الهاتف"}),ra(!1),Sa(!1);return}const g=window.electronAPI;if(g&&typeof g.sendUssd=="function"&&qa){const v=Ge==null?void 0:Ge(),y=(v==null?void 0:v.phone)||"";if(!y){p({title:"يجب اختيار محفظة",description:"اختر محفظة المُرسل أولاً",variant:"destructive"}),na(!1);return}const x=await hi();if(!x){na(!1);return}const w=Vd(y,a,r);if(!w){p({title:"رقم غير مدعوم",description:"تحقق من بداية الرقم 010/011/012/015",variant:"destructive"}),na(!1);return}try{let k="";if(Et!==null)k=`${x}:sim${Et}`;else{const S=typeof g.pickSimAutomatically=="function"?await g.pickSimAutomatically(x,y):{deviceId:x,slot:0};k=`${S.deviceId}:sim${S.slot}`}Ki(k),await g.sendUssd(k,w)}catch{try{await g.sendUssd(x,w)}catch(S){const T=x.includes(":")?x.split(":").slice(0,2).join(":"):"";if(T&&typeof g.connectWifi=="function")await g.connectWifi(T),await g.sendUssd(x,w);else throw S}}p({title:"تم إرسال كود التحويل",description:"تم التنفيذ بنجاح"}),ra(!1),Sa(!0)}else xm(a,r)}catch(g){const v=g&&g.message?g.message:"حدث خطأ غير متوقع أثناء الإرسال";p({title:"خطأ أثناء الإرسال",description:`الجهاز: ${Yi||qa||"غير معروف"} — ${v}`,variant:"destructive"})}finally{na(!1)}},bm=async(a,r)=>{const i=window.electronAPI;try{if(i&&typeof i.enterPin=="function"&&a){await i.enterPin(a,r),Sa(!1);return}const l=String((n==null?void 0:n.bridgeLink)||"").trim(),d=String((n==null?void 0:n.bridgeDeviceId)||"").trim()||void 0;if(!l){p({title:"الرابط غير مُعدّ",description:"احفظ رابط الجسر أولاً",variant:"destructive"});return}const m=String((rt==null?void 0:rt.receiver)||pt||"").replace(/\D/g,""),h=Math.max(1,Math.round(Number((rt==null?void 0:rt.amount)||ot||0))||0),g=String(r||"").replace(/\D/g,""),y=(x=>{let w=(x||"").trim();return w=w.replace(/\/+$/,""),/^https?:\/\//i.test(w)||(w=`https://${w}`),w})(l);Sa(!1)}catch(l){const d=(l==null?void 0:l.message)||"حدث خطأ أثناء إدخال الرقم السري";p({title:"فشل الإدخال",description:d,variant:"destructive"})}};console.log("🔥 UserDashboardPage - user:",t?"exists":"null");const[Zs,Oa]=u.useState(!0),[gi,er]=u.useState(!0),[vm,Ya]=u.useState(!1),[wm,gs]=u.useState(!1),[sn,Wl]=u.useState(""),[pi,Rl]=u.useState(""),[xi,Ll]=u.useState(""),[rn,yi]=u.useState([]),[Nm,nn]=u.useState(!1),[ft,tr]=u.useState(null),[ps,bi]=u.useState(""),[Ib,_b]=u.useState(!1),[jm,vi]=u.useState(!1),[Sm,Ea]=u.useState(!1),[Dm,ar]=u.useState(!1),[sr,wi]=u.useState(""),[Fl,Ni]=u.useState(""),[Bl,xs]=u.useState([]),[km,on]=u.useState(!1),[ji,ys]=u.useState({}),[ln,cn]=u.useState(null),[$l,rr]=u.useState(""),[Ul,nr]=u.useState(""),[Tb,Vl]=u.useState(!1),[Ab,ql]=u.useState(0),[Pb,zl]=u.useState(!1),[Ct,Yl]=u.useState(null),[gt,Cm]=u.useState(null),[Ob,Kl]=u.useState(!1),[Ut,bs]=u.useState(""),[pt,ir]=u.useState(""),[ot,vs]=u.useState(""),[Ka,Jl]=u.useState(""),[or,Hl]=u.useState(""),[Si,ws]=u.useState(!1),[Di,ki]=u.useState(""),[Im,Ja]=u.useState(""),[Ql,Gl]=u.useState(""),[Ci,_m]=u.useState(""),[aa,Ii]=u.useState(null),[Tm,Xl]=u.useState(!1),[Am,Zl]=u.useState(!1),[Pm,dn]=u.useState(!1),[Om,_i]=u.useState(!1),[ec,Ti]=u.useState(null),[st,un]=u.useState(""),[xt,mn]=u.useState(""),[tc,Em]=u.useState(""),[Mm,ac]=u.useState(!1),[Eb,Mb]=u.useState(null),[Ai,sc]=u.useState(null),[Wm,Pi]=u.useState(!1);u.useEffect(()=>{(async()=>{try{const r=t!=null&&t.uid?`withdrawSenderNameInputEnabled_${t==null?void 0:t.uid}`:"withdrawSenderNameInputEnabled";let i=null;try{i=localStorage.getItem(r)??localStorage.getItem("withdrawSenderNameInputEnabled")}catch{}if(t!=null&&t.uid)try{const l=await es(()=>se.getUserData(t.uid)),d=l==null?void 0:l.withdrawSenderNameInputEnabled;if(typeof d=="boolean"){Pi(d);try{localStorage.setItem(r,d?"true":"false")}catch{}return}}catch{}Pi(i==="true")}catch{Pi(!1)}})()},[t==null?void 0:t.uid]),u.useEffect(()=>{try{const a=`clientNumberAssignments_${(t==null?void 0:t.uid)||"default"}`,r=localStorage.getItem(a);if(!r){ys({});return}const i=JSON.parse(r);if(i&&typeof i=="object"){const l={};Object.entries(i).forEach(([d,m])=>{if(typeof m=="string")l[d]={name:m,amount:""};else if(m&&typeof m=="object"){const h=m,g=typeof h.name=="string"?h.name:"",v=typeof h.amount=="string"||typeof h.amount=="number"?String(h.amount):"";(g||v)&&(l[d]={name:g,amount:v})}}),ys(l)}else ys({})}catch{ys({})}},[t==null?void 0:t.uid]);const lr=a=>{const r="٠١٢٣٤٥٦٧٨٩",i="۰۱۲۳۴۵۶۷۸۹";return(a||"").split("").map(l=>{const d=r.indexOf(l);if(d>-1)return String(d);const m=i.indexOf(l);return m>-1?String(m):l}).join("")},[$e,Rm]=u.useState(!0),Oi=G.useMemo(()=>{if((n==null?void 0:n.transferFeesEnabled)!==void 0)return n.transferFeesEnabled;try{const a=t!=null&&t.uid?`transferFeesEnabled_${t.uid}`:"transferFeesEnabled";return(localStorage.getItem(a)??localStorage.getItem("transferFeesEnabled"))!=="false"}catch{return!0}},[n,t==null?void 0:t.uid]),[R,Ei]=u.useState("transfer"),Lm=G.useMemo(()=>{const a=lr(Ut||"").replace(/\D/g,""),r=lr(pt||"").replace(/\D/g,"");return!Oi||R!=="transfer"?!1:a.startsWith("010")&&r.startsWith("010")||a.startsWith("010")&&(r.startsWith("011")||r.startsWith("012")||r.startsWith("015"))||a.startsWith("012")&&r.startsWith("010")||a.startsWith("011")&&r.startsWith("010")||a.startsWith("015")&&r.startsWith("010")},[Ut,pt,Oi,R]),[ie,Vt]=u.useState([]),[Na,Mi]=u.useState("all"),[Ie,Mt]=u.useState([]),ja=u.useRef([]),[Wi,Ri]=u.useState(!1),[Ma,Fm]=u.useState(""),[hn,Bm]=u.useState("daily"),[Wa,$m]=u.useState(""),[Ns,cr]=u.useState(null),Um=a=>{if(!a){cr(null);return}const r=new Date(a),i=new Date(r.setHours(0,0,0,0)),l=new Date(r.setHours(23,59,59,999)),d=ie.filter(x=>{const w=new Date(x.createdAt);return w>=i&&w<=l});let m=0,h=0,g=0,v=0,y=0;d.forEach(x=>{m++,h+=Number(x.amount||0);const w=(x.type||x.txnType||"").toLowerCase(),k=w==="machine_withdrawal"||x.title==="إيصال سحب فوري";!k&&(w==="withdraw"||w==="withdrawal"||w==="receive")?g+=Number(x.amount||0):!k&&(w==="send"||w==="transfer")&&(v+=Number(x.amount||0)),y+=xa.calculateProfitFromTransaction(x)}),cr({count:m,totalAmount:h,totalWithdrawn:g,totalSent:v,totalProfit:y})},Vm=a=>{if(!a){cr(null);return}const[r,i]=a.split("-"),l=Number(r),d=Number(i)-1,m=new Date(l,d,1,0,0,0,0),h=new Date(l,d+1,0,23,59,59,999),g=ie.filter(S=>{const T=new Date(S.createdAt),O=String(S.status||S.status||"completed").toLowerCase();return T>=m&&T<=h&&(O==="completed"||O==="confirmed")});let v=0,y=0,x=0,w=0,k=0;g.forEach(S=>{v++,y+=Number(S.amount||0);const T=(S.type||S.txnType||"").toLowerCase(),O=T==="machine_withdrawal"||S.title==="إيصال سحب فوري";!O&&(T==="withdraw"||T==="withdrawal"||T==="receive")?x+=Number(S.amount||0):!O&&(T==="send"||T==="transfer")&&(w+=Number(S.amount||0)),k+=xa.calculateProfitFromTransaction(S)}),cr({count:v,totalAmount:y,totalWithdrawn:x,totalSent:w,totalProfit:k})};u.useEffect(()=>{Wi&&(hn==="daily"&&Ma?Um(Ma):hn==="monthly"&&Wa?Vm(Wa):cr(null))},[Ma,Wa,hn,ie,Wi]);const dr=Vr({enabled:!!(t!=null&&t.uid),queryKey:["recentTransactions",t==null?void 0:t.uid,D||"main"],queryFn:async()=>{const{collection:a,query:r,where:i,orderBy:l,limit:d,getDocs:m}=await X(async()=>{const{collection:_,query:A,where:B,orderBy:z,limit:re,getDocs:tt}=await import("./index-mBSeGJ8K.js").then(yt=>yt.cA);return{collection:_,query:A,where:B,orderBy:z,limit:re,getDocs:tt}},__vite__mapDeps([0,1]),import.meta.url),{db:h}=await X(async()=>{const{db:_}=await import("./index-mBSeGJ8K.js").then(A=>A.cB);return{db:_}},__vite__mapDeps([0,1]),import.meta.url),g=r(a(h,"userTransactions"),i("userId","==",String((t==null?void 0:t.uid)||"")),l("createdAt","desc"),d(100)),x=(await m(g)).docs.map(_=>{var ce;const A=_.data(),B=(ce=A.createdAt)!=null&&ce.toDate?A.createdAt.toDate():new Date(A.createdAt),z=String(A.transactionType||A.txnType||A.type||"").toLowerCase();let re="send";z==="withdraw"||z==="receive"?re="withdraw":z==="machine_withdrawal"?re="machine_withdrawal":z==="cash_addition"||z==="add"?re="cash_addition":re="send";const tt=A.status==="confirmed"?"completed":A.status||"completed",yt=A.senderMsisdn||A.senderPhone||"",dt=A.receiverMsisdn||A.receiverPhone||"",je=Number(A.amount??A.transferredAmount??A.withdrawnAmount??0);return{id:_.id,...A,type:re,status:tt,senderPhone:yt,receiverPhone:dt,amount:je,createdAt:B}}).filter(_=>!((_==null?void 0:_.type)==="report"||String((_==null?void 0:_.title)||"").includes("إيصال تسليم وردية"))),w=new Set((mr||[]).map(_=>String(_.id||_.originalTransactionId||""))),k=x.filter(_=>!w.has(String(_.id||""))),S=_=>{var A;return String(_.transactionId||_.id||_.reference||((A=_.receipt)==null?void 0:A.reference)||`${new Date(_.createdAt).getTime()}`)},T=new Set,O=[];for(const _ of k){const A=S(_);T.has(A)||(T.add(A),O.push(_))}return O},staleTime:6e4,gcTime:3e5,refetchOnWindowFocus:!1,refetchOnReconnect:!0});u.useEffect(()=>{const a=()=>{try{dr.refetch()}catch{}};return window.addEventListener("transaction-created",a),()=>{window.removeEventListener("transaction-created",a)}},[dr]),u.useEffect(()=>{const a=dr.data;if(a&&Array.isArray(a)){const r=ja.current,i=Date.now(),l=r.filter(g=>{const v=a.some(w=>w.id===g.id),y=g.reference?a.some(w=>w.reference===g.reference):!1,x=i-new Date(g.createdAt).getTime()>3e5;return!v&&!y&&!x});ja.current=l;const d=[...l,...a].sort((g,v)=>new Date(v.createdAt).getTime()-new Date(g.createdAt).getTime()),m=new Set,h=[];for(const g of d)m.has(g.id)||(m.add(g.id),h.push(g));Vt(h)}},[dr.data]),u.useEffect(()=>{try{if(localStorage.setItem("commissionMode",$e?"add":"deduct"),t!=null&&t.uid){const a=`commissionMode_${t.uid}`;localStorage.setItem(a,$e?"add":"deduct")}}catch{}},[$e,t==null?void 0:t.uid]),u.useEffect(()=>{try{const a=new Set((ie||[]).filter(l=>String((l==null?void 0:l.status)||"")==="completed"&&(l==null?void 0:l.linkedDebtId)).map(l=>String(l.linkedDebtId)));if(a.size===0||Ie.length===0)return;const r=Ie.map(l=>{if(!a.has(String(l.id)))return l;const d=Number(l.amount||0),m=Number(l.paidAmount||0),h=Array.isArray(l.partialPayments)?l.partialPayments.reduce((v,y)=>v+Number(y.amount||0),0):0;return m+h>=d&&l.status!=="paid"?{...l,amount:d,paidAmount:d,status:"paid"}:m>d?{...l,amount:d,paidAmount:d}:l});if(r.some((l,d)=>l!==Ie[d])){Mt(r),(async()=>await Da(r))();try{t!=null&&t.uid&&r.filter((d,m)=>d!==Ie[m]&&d.status==="paid").forEach(d=>{try{const m=Number(d.paidAmount||0),h=m>0?m:Number(d.amount||0);as.send(t.uid,`تم سداد الدين بالكامل للعميل ${d.debtorName}: المدفوع ${h} جنيه`).catch(()=>{})}catch{}})}catch{}}}catch{}},[ie,Ie,t==null?void 0:t.uid]),u.useEffect(()=>{try{const a=t!=null&&t.uid?localStorage.getItem(`commissionMode_${t.uid}`):null,r=localStorage.getItem("commissionMode"),i=localStorage.getItem("commissionMode_default"),l=a??r??i;l&&Rm(l==="add")}catch{}},[t==null?void 0:t.uid]);const[Li,js]=u.useState(!1),[qm,zm]=u.useState(null),fn=G.useRef(""),rc=G.useRef(0);u.useEffect(()=>{const a=r=>{var l;if(Li)return;try{const d=document.activeElement;if(d){const m=(l=d.tagName)==null?void 0:l.toLowerCase();if(m==="input"||m==="textarea"||m==="select"||m==="button"||d.isContentEditable===!0)return}}catch{}const i=Date.now();if(r.key==="Enter"){const d=(fn.current||"").trim();fn.current="",d&&(zm(d),js(!0));return}r.key.length===1&&(i-(rc.current||0)>100&&(fn.current=""),fn.current+=r.key,rc.current=i)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[Li]);const[Ym,Km]=u.useState(!1),[Jm,Fi]=u.useState(!1),[Hm,Wb]=u.useState(null);u.useEffect(()=>{if(!Si)return;const a=Ge(),r=parseFloat(ot||"0")||0;let i=0;if(R==="transfer"){if((a==null?void 0:a.defaultTransferCommission)!=null){const d=Number(a.defaultTransferCommission)||0;i=Math.round(d*r/1e3*100)/100}else{const d=xt&&xt.trim()!==""?parseFloat(xt):0;i=Math.max(0,d)}const l=r+i;Ja((l||0).toString())}else{if((a==null?void 0:a.defaultWithdrawCommission)!=null){const d=Number(a.defaultWithdrawCommission)||0;i=Math.round(d*r/1e3*100)/100}else{const d=st&&st.trim()!==""?parseFloat(st):Math.round(r*.01*100)/100;i=Math.max(0,d)}const l=$e?r:Math.max(0,Math.round((r-i)*100)/100);Ja((l||0).toString())}},[Si,ot,xt,st,E,$e,R]);const Ge=()=>{var r,i;let a=F.find(l=>l.id===E);if(!a)try{const l=localStorage.getItem(rd());if(l){const d=JSON.parse(l);if(Array.isArray(d)&&d.length>0){const h=localStorage.getItem(Xa())||((r=d.find(g=>g.isDefault))==null?void 0:r.id)||((i=d[0])==null?void 0:i.id);a=d.find(g=>g.id===h)}}}catch{}return a};u.useLayoutEffect(()=>{try{const a=`wallets_${(t==null?void 0:t.uid)||"default"}`;let r=localStorage.getItem(a);if(!r){const i=Object.keys(localStorage).find(l=>l.startsWith("wallets_"));i&&(r=localStorage.getItem(i)||null)}if(r){const i=JSON.parse(r);if(Array.isArray(i)&&i.length>0){Fe(i);const l=localStorage.getItem(Xa()),d=l&&i.find(m=>m.id===l)||i.find(m=>m.isDefault)||i[0];d&&(Xs(d.id),bs(d.phone))}}}catch(a){console.error("تهيئة فورية للمحافظ من التخزين المحلي فشلت:",a)}},[]),u.useEffect(()=>{console.log("🔍 selectedWallet state changed to:",E)},[E]),u.useEffect(()=>{ad()},[t==null?void 0:t.uid]),u.useEffect(()=>{c0()},[]);const gn=Vr({enabled:!!(t!=null&&t.uid),queryKey:["wallets",t==null?void 0:t.uid],queryFn:async()=>{const{merchantWalletService:a}=await X(async()=>{const{merchantWalletService:l}=await import("./index-mBSeGJ8K.js").then(d=>d.cC);return{merchantWalletService:l}},__vite__mapDeps([0,1]),import.meta.url),r=await a.getByMerchantId(String((t==null?void 0:t.uid)||""));return(Array.isArray(r)?r:[]).filter(l=>l.isActive===!0).map(l=>({id:l.id,name:l.label||"محفظة بدون اسم",phone:l.msisdn,isDefault:!!l.isDefault,monthlyWithdrawalLimit:l.monthlyWithdrawalLimit??l.withdrawLimit??2e5,monthlyTransferLimit:l.monthlyTransferLimit??l.transferLimit??2e5,defaultTransferCommission:l.defaultTransferCommission!=null?Number(l.defaultTransferCommission):null,defaultWithdrawCommission:l.defaultWithdrawCommission!=null?Number(l.defaultWithdrawCommission):null}))},staleTime:6e4,gcTime:3e5,refetchOnReconnect:!0});u.useEffect(()=>{var r;const a=gn.data;if(a&&Array.isArray(a)){Fe(a);const i=localStorage.getItem(Xa());if(!!!(E&&a.find(d=>d.id===E))){const d=i&&a.find(m=>m.id===i)?i:((r=a[0])==null?void 0:r.id)||"";if(d){Xs(d);const m=a.find(h=>h.id===d);bs(String((m==null?void 0:m.phone)||""))}}}},[gn.data]),u.useEffect(()=>{const a=r=>{const{cashBalance:i,walletBalances:l,newTransaction:d,limitUpdate:m,delta:h}=r.detail||{};if(h){const{amount:g,type:v,walletId:y,commission:x}=h,w=Number(g||0),k=Number(x||0);Ze(S=>{let T=0;v==="withdraw"?T=-w+k:(v==="send"||v==="transfer")&&(T=w+k);const O=S+T;try{const _=Ve();localStorage.setItem(_,String(O));const A=new Date().toISOString();if(localStorage.setItem(_+"_lastUpdated",A),t!=null&&t.uid){const B=`userData_${t.uid}`,z=localStorage.getItem(B),tt={...z?JSON.parse(z):{},cashBalance:O,lastUpdated:A};localStorage.setItem(B,JSON.stringify(tt)),me(!0)}}catch{}return O}),y&&ct(S=>{const T=Number(S[y]||0);let O=0;v==="withdraw"?O=w:(v==="send"||v==="transfer")&&(O=-w);const _=T+O,A={...S,[y]:_};try{const B=et();localStorage.setItem(B,JSON.stringify(A));const z=new Date().toISOString();if(localStorage.setItem(B+"_lastUpdated",z),t!=null&&t.uid){const re=`userData_${t.uid}`,tt=localStorage.getItem(re),dt={...tt?JSON.parse(tt):{},walletBalances:A,lastUpdated:z};localStorage.setItem(re,JSON.stringify(dt)),me(!0)}}catch{}return A})}if(typeof i=="number"){Ze(i);try{const g=Ve();localStorage.setItem(g,String(i));const v=new Date().toISOString();if(localStorage.setItem(g+"_lastUpdated",v),t!=null&&t.uid){const y=`userData_${t.uid}`,x=localStorage.getItem(y),k={...x?JSON.parse(x):{},cashBalance:i,lastUpdated:v};localStorage.setItem(y,JSON.stringify(k)),me(!0)}}catch{}}if(l&&typeof l=="object"){ct(l);try{const g=et();localStorage.setItem(g,JSON.stringify(l));const v=new Date().toISOString();if(localStorage.setItem(g+"_lastUpdated",v),t!=null&&t.uid){const y=`userData_${t.uid}`,x=localStorage.getItem(y),k={...x?JSON.parse(x):{},walletBalances:l,lastUpdated:v};localStorage.setItem(y,JSON.stringify(k)),me(!0)}}catch{}}if(m&&m.walletId===E&&_s(g=>{if(!g)return g;const v=Number(m.amount||0),y=m.type==="transfer",x={...g};return y?(x.dailyTransferUsed=(x.dailyTransferUsed||0)+v,x.monthlyTransferUsed=(x.monthlyTransferUsed||0)+v):(x.dailyWithdrawUsed=(x.dailyWithdrawUsed||0)+v,x.monthlyWithdrawUsed=(x.monthlyWithdrawUsed||0)+v),x}),d){const g=d.type==="machine_withdrawal"||d.txnType==="machine_withdrawal",v=dc.current||[];if(g&&v.find(x=>{if((x.type||x.txnType)!=="machine_withdrawal")return!1;const k=Number(x.amount)===Number(d.amount),S=x.senderName===d.senderName,T=new Date(x.createdAt).getTime(),O=new Date(d.createdAt||Date.now()).getTime(),_=Math.abs(O-T);return k&&S&&_<6e4})){console.log("Skipping duplicate machine withdrawal event (fuzzy match):",d);return}try{ja.current&&(ja.current.some(y=>y.id===d.id)||ja.current.push(d))}catch{}Vt(y=>y.some(x=>x.id===d.id)?y:[d,...y]),p({title:"تم تسجيل عملية خارجية",description:"تم تحديث الأرصدة والسجلات بنجاح"});try{dr.refetch()}catch{}}};return window.addEventListener("dashboard:external-update",a),()=>window.removeEventListener("dashboard:external-update",a)},[E]);const[nc,Qm]=u.useState(""),ic=(()=>{const a=nc.replace(/\D/g,"");return a?F.filter(r=>(r.phone||"").replace(/\D/g,"").includes(a)):F})();u.useEffect(()=>{(async()=>{try{let r=[];if(t!=null&&t.uid)try{const i=await es(()=>se.getUserData(t.uid)),l=i==null?void 0:i.favoriteWalletIds;Array.isArray(l)&&(r=l.map(d=>String(d)))}catch{}if(!r.length)try{const i=t!=null&&t.uid?`favoriteWallets_${t.uid}`:"favoriteWallets",l=localStorage.getItem(i)??localStorage.getItem("favoriteWallets");if(l){const d=JSON.parse(l);Array.isArray(d)&&(r=d.filter(m=>typeof m=="string"))}}catch{}r.length&&Gt(r)}catch{Gt([])}})()},[t==null?void 0:t.uid]),u.useEffect(()=>{try{const a=t!=null&&t.uid?`favoriteWallets_${t.uid}`:"favoriteWallets";localStorage.setItem(a,JSON.stringify(Re)),t!=null&&t.uid&&se.updateUserData(t.uid,{favoriteWalletIds:Re})}catch{}},[Re,t==null?void 0:t.uid]);const oc=G.useMemo(()=>{const a=new Set(Re);return[...ic].sort((r,i)=>{const l=a.has(r.id),d=a.has(i.id);return l===d?0:l?-1:1})},[ic,Re]),Gm=a=>{Gt(r=>r.includes(a)?r.filter(i=>i!==a):[...r,a])},[Xm,Rb]=u.useState(null),[Zm,lc]=u.useState(!1),[eh,pn]=u.useState(!1),[th,ah]=u.useState(null),[Lb,sh]=u.useState([]),[Fb,Bb]=u.useState([]),[rh,ur]=u.useState(!1),[Bi,cc]=u.useState("daily"),[mr,hr]=u.useState([]),[nh,$b]=u.useState(!1),ha=G.useRef(new Set);G.useRef(new Set);const dc=G.useRef([]);u.useEffect(()=>{dc.current=ie},[ie]);const $i=async a=>{try{if(!t)return;const r=Ve(),i=et(),l=localStorage.getItem(r),d=localStorage.getItem(i);let m=l?parseFloat(l):We,h=d?JSON.parse(d):{...ve};const g=Number(a.withdrawnAmount??a.sentAmount??a.transferredAmount??a.amount??0);if(a.type==="send"&&(a.fromWallet||E)){m-=g;const w=a.fromWallet||E;h[w]=(h[w]||0)+g}else if(a.type==="withdraw"&&(a.fromWallet||E)){m+=g;const w=a.fromWallet||E;h[w]=Math.max(0,(h[w]||0)-g)}Ze(m),ct(h);const v=new Date().toISOString();localStorage.setItem(r,m.toString()),localStorage.setItem(r+"_lastUpdated",v),localStorage.setItem(i,JSON.stringify(h)),localStorage.setItem(i+"_lastUpdated",v);const y={cashBalance:m,walletBalances:h,lastUpdated:new Date().toISOString()},x=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(x,JSON.stringify(y));try{await se.updateUserData(t.uid,y),localStorage.removeItem(x),me(!1)}catch(w){console.warn("تعذر حفظ الأرصدة في Firebase بعد الحذف (مزامنة تلقائية):",w),me(!0)}try{const w=a.fromWallet||E,k=a.type==="send"?"transfer":"withdraw";await is.rollbackUsage(w,g,k,a.createdAt)}catch(w){console.warn("تعذر تحديث حدود المحفظة بعد الحذف (مزامنة):",w)}try{St.removeTransactionEffects(a,t.uid)}catch(w){console.warn("تعذر تحديث التقارير بعد الحذف (مزامنة):",w)}}catch(r){console.warn("خطأ أثناء تطبيق تأثيرات الحذف محليًا:",r)}},ih=async a=>{try{const r=ie.find(h=>h.id===a);if(!r||!t)return;const i=String(a),l=String((r==null?void 0:r.transactionId)||(r==null?void 0:r.reference)||""),d=ha.current.has(i)||l&&ha.current.has(l),m=ie.filter(h=>h.id!==a);Vt(m);try{await se.removeUserTransaction(t.uid,a),await $r.permanentlyDeleteTransaction(a,t.uid)}catch(h){console.warn("تعذر الحذف النهائي من قواعد البيانات أثناء حذف الإيصال:",h)}if(!d){ha.current.add(i),l&&ha.current.add(l),await $i(r);try{t!=null&&t.uid&&se.removeLocalReceiptById(t.uid,a)}catch{}}p({title:"تم الحذف نهائيًا",description:"تم حذف الإيصال نهائيًا وعكس تأثيراته على الأرصدة والحدود والتقارير."}),pn(!1)}catch(r){console.error("خطأ أثناء حذف الإيصال:",r),p({title:"خطأ في حذف الإيصال",description:"حدث خطأ غير متوقع أثناء الحذف.",variant:"destructive"})}},oh=async a=>{try{const r=ie.find(i=>i.id===a);if(!r||!t)return;try{const i=Ct==null?void 0:Ct.planType;if(i===Zt.ZERO){const{dailyOperationCountService:l}=await X(async()=>{const{dailyOperationCountService:h}=await import("./dailyOperationCountService-CUlR8gDE.js");return{dailyOperationCountService:h}},__vite__mapDeps([64,0,1]),import.meta.url),d=r.type==="send"?"transfer":"withdraw";if(!(await l.checkAndIncrement(t.uid,d,5)).allowed){p({title:"تم بلوغ حد باقة الزيرو",description:"مسموح بحد أقصى 5 تأكيدات يوميًا للتحويل/السحب. جرّب غدًا أو قم بالترقية.",variant:"destructive"});return}}else if(i===Zt.TAHWEELA){const{dailyOperationCountService:l}=await X(async()=>{const{dailyOperationCountService:h}=await import("./dailyOperationCountService-CUlR8gDE.js");return{dailyOperationCountService:h}},__vite__mapDeps([64,0,1]),import.meta.url),d=r.type==="send"?"transfer":"withdraw";if(!(await l.checkAndIncrementCombined(t.uid,d,40)).allowed){p({title:"تم بلوغ حد باقة تحويله",description:"هذه الباقة تسمح بحد أقصى 40 عملية تحويل/سحب يومياً.",variant:"destructive"});return}}}catch(i){console.warn("تعذر التحقق من حد التأكيد اليومي:",i)}await Xt(Te(V,"userTransactions",a),{status:"completed",confirmedAt:new Date}),Vt(i=>i.map(l=>l.id===a?{...l,status:"completed"}:l)),p({title:"تم الإكمال",description:"تم وسم المعاملة كمكتملة."}),pn(!1)}catch(r){console.error("خطأ أثناء إكمال الإيصال:",r),p({title:"فشل الإكمال",description:"حدث خطأ غير متوقع أثناء تحديث الحالة.",variant:"destructive"})}};u.useEffect(()=>{if(!t)return;(async()=>{try{const r=Oe(pe(V,"deletedTransactions"),ae("userId","==",t.uid),If("createdAt","desc"),_f(50));(await ke(r)).docs.forEach(l=>{const d=l.data(),m=String((d==null?void 0:d.originalTransactionId)||""),h=String((d==null?void 0:d.transactionId)||""),g=String((d==null?void 0:d.reference)||""),v=m||h||g||String(l.id);v&&(ha.current.has(v)||(ha.current.add(v),Vt(y=>{const x=y.find(w=>w.id===m);return x?((async()=>await $i(x))(),y.filter(w=>w.id!==m)):y})))})}catch(r){console.warn("تعذر جلب المعاملات المحذوفة:",r)}})()},[t==null?void 0:t.uid]),u.useEffect(()=>{if(!t)return;(async()=>{try{const r=Te(V,"users",t.uid),i=await ca(r);if(!i.exists())return;const l=i.data();if(!(l!=null&&l.reportsData))return;try{await St.syncReportsDataFromFirebase(t.uid),sh(jd())}catch(d){console.warn("تعذر مزامنة reportsData من السحابة:",d)}}catch(r){console.warn("تعذر جلب users.reportsData:",r)}})()},[t==null?void 0:t.uid]);const[uc,lh]=u.useState(""),mc=Yy(uc,300),[xn,hc]=u.useState(""),[yn,fc]=u.useState(""),[fa,Ub]=u.useState(""),[Ui,Ss]=u.useState(!1),[Vi,fr]=u.useState(!1),[ch,gc]=u.useState(null),[sa,qi]=u.useState(!1),[dh,ra]=u.useState(!1),[Ue,zi]=u.useState(null),[rt,uh]=u.useState(null),[pc,na]=u.useState(!1),[mh,Sa]=u.useState(!1),[hh,xc]=u.useState(!1),[Yi,Ki]=u.useState(""),[fh,Ji]=u.useState(!1),[gh,gr]=u.useState(!1),[ph,yc]=u.useState(!1),[xh,pr]=u.useState(!1),[yh,xr]=u.useState(!1),[bh,yr]=u.useState(!1),[vh,Hi]=u.useState(()=>{try{const a=t!=null&&t.uid?`monthlyReportsLockEnabled_${t==null?void 0:t.uid}`:"monthlyReportsLockEnabled";return(localStorage.getItem(a)??localStorage.getItem("monthlyReportsLockEnabled"))==="true"}catch{return!1}});u.useEffect(()=>{try{const a=t!=null&&t.uid?`monthlyReportsLockEnabled_${t==null?void 0:t.uid}`:"monthlyReportsLockEnabled",r=localStorage.getItem(a)??localStorage.getItem("monthlyReportsLockEnabled");Hi(r==="true")}catch{}},[t==null?void 0:t.uid]);const[br,wh]=u.useState(!1),[Nh,bn]=u.useState(!1),[jh,bc]=u.useState(!1),[vn,Sh]=u.useState(""),[vc,Dh]=u.useState(!1),[kh,Qi]=u.useState(!1),[qt,wc]=u.useState(()=>{try{const a=(t==null?void 0:t.uid)||"default",r=localStorage.getItem(`hiddenQuickActions_${a}`)??localStorage.getItem("hiddenQuickActions"),i=r?JSON.parse(r):[];return Array.isArray(i)?i.filter(l=>typeof l=="string"):[]}catch{return[]}}),[Ch,Nc]=u.useState(()=>{try{const a=t!=null&&t.uid?`dailyReportsLockEnabled_${t==null?void 0:t.uid}`:"dailyReportsLockEnabled";return(localStorage.getItem(a)??localStorage.getItem("dailyReportsLockEnabled"))==="true"}catch{return!1}}),[Ih,Gi]=u.useState(!1);u.useEffect(()=>{try{const a=t!=null&&t.uid?`dailyReportsLockEnabled_${t==null?void 0:t.uid}`:"dailyReportsLockEnabled",r=localStorage.getItem(a)??localStorage.getItem("dailyReportsLockEnabled");Nc(r==="true")}catch{}},[t==null?void 0:t.uid]);const[_h,Ds]=u.useState(!1),[Th,Xi]=u.useState(!1),[Ah,jc]=u.useState(()=>{try{const a=t==null?void 0:t.uid,r=a?`debtsPinRequired_${a}`:"debtsPinRequired";return(localStorage.getItem(r)??localStorage.getItem("debtsPinRequired"))==="true"}catch{return!1}}),[Ph,Sc]=u.useState(!1),[Dc,Oh]=u.useState(null),[Zi,kc]=u.useState(""),[eo,Cc]=u.useState(""),[to,Ic]=u.useState(""),[ga,_c]=u.useState(null),[W,vr]=u.useState(null),[Eh,Ra]=u.useState(!1),[Mh,wn]=u.useState(!1),[pa,Wh]=u.useState(null),[Tc,Ac]=u.useState(""),[Pc,Nn]=u.useState(""),[Xe,Oc]=u.useState(null),[Vb,qb]=u.useState(!1),[Rh,jn]=u.useState(!1),[Ec,wr]=u.useState(""),[ao,Ha]=u.useState(!1),[Mc,so]=u.useState(1),Lh=M?10:20,ro=G.useMemo(()=>Ie.slice(0,Mc*Lh),[Ie,Mc]);u.useEffect(()=>{ao&&so(1)},[ao]),u.useEffect(()=>{try{const a=(t==null?void 0:t.uid)||"default",r=localStorage.getItem(`hiddenQuickActions_${a}`)??localStorage.getItem("hiddenQuickActions"),i=r?JSON.parse(r):[];Array.isArray(i)&&wc(i.filter(l=>typeof l=="string"))}catch{}},[t==null?void 0:t.uid]),u.useEffect(()=>{const a=r=>{var i;try{const l=(i=r==null?void 0:r.detail)==null?void 0:i.hiddenQuickActions;Array.isArray(l)&&wc(l.map(d=>String(d)))}catch{}};try{window.addEventListener("hiddenQuickActionsChanged",a)}catch{}return()=>{try{window.removeEventListener("hiddenQuickActionsChanged",a)}catch{}}},[]);const Sn=async()=>{if(we){p({title:"غير متاح",description:"إدارة الديون/الأجل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"});return}try{const a=await Rt.hasMasterPin(t==null?void 0:t.uid);Ah&&a?Xi(!0):Ds(!0)}catch{Ds(!0)}};u.useEffect(()=>{try{const a=t==null?void 0:t.uid,r=a?`debtsPinRequired_${a}`:"debtsPinRequired",i=localStorage.getItem(r)??localStorage.getItem("debtsPinRequired");(i==="true"||i==="false")&&jc(i==="true")}catch{}},[t==null?void 0:t.uid]),u.useEffect(()=>{const a=()=>{try{bo()}catch{}};try{window.addEventListener("debtsUpdated",a)}catch{}return()=>{try{window.removeEventListener("debtsUpdated",a)}catch{}}},[t==null?void 0:t.uid,D,n==null?void 0:n.shopId]);const[Fh,no]=u.useState(!1),[ks,io]=u.useState("customers_list"),[It,oo]=u.useState([]),[lo,Wc]=u.useState(""),[co,Rc]=u.useState(""),[Qa,Lc]=u.useState(""),[Fc,Bh]=u.useState(""),[$h,Dn]=u.useState(!1),[Uh,Bc]=u.useState(""),[$c,uo]=u.useState(""),[Uc,mo]=u.useState(""),[Vh,kn]=u.useState(!1),[qh,ho]=u.useState(""),[Vc,fo]=u.useState(""),[zh,go]=u.useState(!1),[po,Yh]=u.useState(""),[Kh,Cs]=u.useState(!1),[Ga,Nr]=u.useState(null),[_t,jr]=u.useState(null),[Sr,xo]=u.useState(""),[Jh,Is]=u.useState(!1),[qc,Cn]=u.useState(0),[zt,La]=u.useState(null),[Fa,yo]=u.useState(""),[he,_s]=u.useState(null),[Hh,zc]=u.useState(""),Da=async a=>{try{const r=JSON.stringify(a);localStorage.setItem(kr(),r);try{localStorage.setItem(Co(),r)}catch{}try{localStorage.setItem(Io(),Date.now().toString())}catch{}if(t!=null&&t.uid){try{localStorage.setItem(`debts_unsynced_${t.uid}`,"true")}catch{}const i=[];i.push(se.updateUserData(t.uid,{debts:a,debtsDeletedAt:null})),Promise.all(i).then(()=>{try{localStorage.removeItem(`debts_unsynced_${t.uid}`)}catch{}}).catch(l=>{console.error("فشل مزامنة الديون:",l),me(!0)})}}catch(r){console.error("خطأ في حفظ الديون:",r)}},bo=async()=>{try{const a=kr(),r=Co(),i=Io(),l=localStorage.getItem(a),d=localStorage.getItem(r),m=localStorage.getItem(i),h=m?Number(m):0,g=y=>{if(!y)return null;try{const x=JSON.parse(y);return Array.isArray(x)?x.map(w=>{var k;return{...w,createdAt:(k=w.createdAt)!=null&&k.toDate?w.createdAt.toDate():new Date(w.createdAt),partialPayments:Array.isArray(w.partialPayments)?w.partialPayments.map(S=>{var T;return{amount:Number(S.amount)||0,paidAt:(T=S.paidAt)!=null&&T.toDate?S.paidAt.toDate():new Date(S.paidAt)}}):[],additionReceipts:Array.isArray(w.additionReceipts)?w.additionReceipts.map(S=>{var T;return{amount:Number(S.amount)||0,note:typeof S.note=="string"?S.note:void 0,addedAt:(T=S.addedAt)!=null&&T.toDate?S.addedAt.toDate():new Date(S.addedAt)}}):[]}}):[]}catch(x){return console.warn("فشل في تحليل ديون localStorage:",x),null}};let v=g(l);if(!v||v.length===0){const y=g(d);if(y&&y.length>0){v=y,Mt(y);try{localStorage.setItem(kr(),JSON.stringify(y)),localStorage.removeItem(r)}catch(x){console.warn("تعذر ترحيل الديون محلياً من المفتاح الافتراضي:",x)}}}if(v&&v.length>0&&Mt(v),t!=null&&t.uid)try{const y=`debts_unsynced_${t.uid}`,x=localStorage.getItem(y)==="true",w=await ca(Te(V,"users",t.uid)),k=[];try{const S=query(pe(V,"debts"),ae("userId","==",t.uid));(await ke(S)).forEach(O=>{var A;const _=O.data();k.push({id:O.id,..._,amount:Number(_.amount||0),paidAmount:Number(_.paidAmount||0),createdAt:(A=_.createdAt)!=null&&A.toDate?_.createdAt.toDate():new Date(_.createdAt||Date.now()),partialPayments:Array.isArray(_.partialPayments)?_.partialPayments:[],additionReceipts:Array.isArray(_.additionReceipts)?_.additionReceipts.map(B=>{var z;return{amount:Number(B.amount)||0,note:typeof B.note=="string"?B.note:void 0,addedAt:(z=B.addedAt)!=null&&z.toDate?B.addedAt.toDate():new Date(B.addedAt)}}):[]})})}catch(S){console.warn("Failed to fetch from debts collection:",S)}if(w.exists()){const S=w.data();let T=S.debts&&Array.isArray(S.debts)?S.debts.map(A=>{var B;return{...A,amount:Number(A.amount||0),paidAmount:Number(A.paidAmount||0),createdAt:(B=A.createdAt)!=null&&B.toDate?A.createdAt.toDate():new Date(A.createdAt),partialPayments:Array.isArray(A.partialPayments)?A.partialPayments.map(z=>{var re;return{amount:Number(z.amount)||0,paidAt:(re=z.paidAt)!=null&&re.toDate?z.paidAt.toDate():new Date(z.paidAt)}}):[],additionReceipts:Array.isArray(A.additionReceipts)?A.additionReceipts.map(z=>{var re;return{amount:Number(z.amount)||0,note:typeof z.note=="string"?z.note:void 0,addedAt:(re=z.addedAt)!=null&&re.toDate?z.addedAt.toDate():new Date(z.addedAt)}}):[]}}):[];if(!!S.debtsDeletedAt){Mt([]);try{localStorage.setItem(a,JSON.stringify([])),localStorage.setItem(r,JSON.stringify([]))}catch{}return}if(((T==null?void 0:T.length)||0)>0)if(x)console.log("⚠️ تم اكتشاف ديون غير متزامنة محلياً، سيتم تجاهل نسخة السحابة مؤقتاً للحفاظ على البيانات الجديدة.");else{Mt(T);try{localStorage.setItem(a,JSON.stringify(T))}catch{}}}else if(k.length>0){Mt(k);try{localStorage.setItem(a,JSON.stringify(k))}catch{}}else v&&v.length>0}catch(y){console.warn("تعذر تحميل الديون من Firebase، الاعتماد على المحلي:",y)}}catch(a){console.error("خطأ في تحميل الديون:",a)}};u.useEffect(()=>{try{window.exportDebts=()=>{try{return JSON.stringify(Ie||[])}catch{return"[]"}},window.importDebts=async a=>{try{const r=JSON.parse(a);if(!Array.isArray(r))throw new Error("صيغة غير صحيحة — يجب أن تكون مصفوفة");return await Da(r),{ok:!0,count:r.length}}catch(r){return console.error("فشل استيراد الديون:",r),{ok:!1,error:String(r)}}},window.fixWalletsForCurrentUser=async a=>{try{if(!(t!=null&&t.uid))throw new Error("يجب تسجيل الدخول أولاً");return await(await X(async()=>{const{merchantWalletService:i}=await import("./index-mBSeGJ8K.js").then(l=>l.cC);return{merchantWalletService:i}},__vite__mapDeps([0,1]),import.meta.url)).merchantWalletService.reassignByMsisdns(a,t.uid)}catch(r){return console.error("فشل إصلاح المحافظ للمستخدم الحالي:",r),{updated:0,failed:(a==null?void 0:a.length)||0,error:String(r)}}}}catch{}},[Ie,t==null?void 0:t.uid]),u.useEffect(()=>{t!=null&&t.uid&&bo()},[t==null?void 0:t.uid]),u.useEffect(()=>{if(!(t!=null&&t.uid))return;const a=ff(Te(V,"users",t.uid),async r=>{var i;if(r.exists()){const l=r.data(),d=l.isActive===!0;l.subscription&&Yl(l.subscription),Cm(l.branchPackage||null);const m=await Kd.checkTrialValidity(t.uid),h=m.isValid&&!m.isExpired;Oa(d||h),Vl(h),ql(m.hoursRemaining),zl(m.hasUsedTrial);const g=!d&&!h;Ea(g),g&&(console.log("⛔ User not active, redirecting to pending approval..."),f("/user/pending-approval",{replace:!0})),console.log("🔄 تحديث فوري لحالة المستخدم (Real-time):",{isActive:d,isOnTrial:h,plan:(i=l.subscription)==null?void 0:i.planType,showModal:g})}});return()=>a()},[t==null?void 0:t.uid]);const Qh=async()=>{if(t!=null&&t.uid)try{Kl(!0);const a=await bu(t.uid);Yl(a)}catch(a){console.error("خطأ في جلب بيانات الاشتراك:",a)}finally{Kl(!1)}},[zb,Yb]=u.useState(!1),[Gh,vo]=u.useState(!1),[We,Ze]=u.useState(0),[ve,ct]=u.useState({}),[Xh,Yc]=u.useState(!1),[Zh,Kc]=u.useState(!1),[e0,wo]=u.useState(!1),[t0,In]=u.useState(!1),[Jc,No]=u.useState(""),[a0,Dr]=u.useState(!1),[s0,_n]=u.useState(!1),[jo,Tn]=u.useState(""),[r0,So]=u.useState(!1),[An,Hc]=u.useState(""),[Pn,Qc]=u.useState(""),[On,Gc]=u.useState(""),[Xc,Zc]=u.useState(!1),[Do,ko]=u.useState(!1),[n0,ed]=u.useState(!1),[td,i0]=u.useState([]);u.useEffect(()=>{(async()=>{try{if(!(t!=null&&t.uid)||!Do)return;try{await Mr.trimToMaxCount(t.uid,30)}catch{}const a=await Mr.getByUser(t.uid,30);i0(a)}catch{}})()},[t==null?void 0:t.uid,Do]);const et=()=>{const a=D||(n==null?void 0:n.shopId)||"main";return`walletBalances_${(t==null?void 0:t.uid)||"default"}_${a}`},Ve=()=>{const a=D||(n==null?void 0:n.shopId)||"main";return`cashBalance_${(t==null?void 0:t.uid)||"default"}_${a}`},kr=()=>{const a=D||(n==null?void 0:n.shopId)||"main";return`debts_${(t==null?void 0:t.uid)||"default"}_${a}`},o0=()=>{const a=D||(n==null?void 0:n.shopId)||"main";return`customers_${(t==null?void 0:t.uid)||"default"}_${a}`},Co=()=>`debts_default_${D||(n==null?void 0:n.shopId)||"main"}`,Io=()=>{const a=D||(n==null?void 0:n.shopId)||"main";return`debts_last_write_${(t==null?void 0:t.uid)||"default"}_${a}`},_o=()=>`shopExpenses_${D||(n==null?void 0:n.shopId)||(t==null?void 0:t.uid)||"default"}`,ad=()=>{try{const a=localStorage.getItem(_o());if(a){const r=JSON.parse(a);yi(r.map(i=>({...i,createdAt:new Date(i.createdAt)})))}}catch(a){console.error("خطأ أثناء تحميل مصروفات المحل من التخزين:",a)}},sd=async a=>{try{localStorage.setItem(_o(),JSON.stringify(a)),yi(a)}catch(r){console.error("خطأ أثناء حفظ مصروفات المحل في التخزين:",r)}},l0=async a=>{try{const r=rn.filter(i=>i.id!==a);await sd(r);try{if(t!=null&&t.uid&&a){const{doc:i,deleteDoc:l}=await X(async()=>{const{doc:h,deleteDoc:g}=await import("./index-mBSeGJ8K.js").then(v=>v.cA);return{doc:h,deleteDoc:g}},__vite__mapDeps([0,1]),import.meta.url),{db:d}=await X(async()=>{const{db:h}=await import("./index-mBSeGJ8K.js").then(g=>g.cB);return{db:h}},__vite__mapDeps([0,1]),import.meta.url),m=i(d,"shop_expenses",a);await l(m)}}catch(i){console.warn("تعذر حذف المصروف من السحابة الآن، تم الحذف محليًا وسيبقى مخزّنًا دون هذا الإيصال:",i)}p({title:"تم الحذف",description:"تم حذف إيصال المصروف نهائيًا."})}catch(r){console.error("خطأ أثناء الحذف النهائي لإيصال المصروف:",r),p({title:"فشل الحذف",description:"تعذر حذف الإيصال. حاول مرة أخرى.",variant:"destructive"})}};G.useEffect(()=>{let a;return(async()=>{try{if(!(t!=null&&t.uid)){ad();return}const{collection:r,query:i,where:l,getDocs:d}=await X(async()=>{const{collection:w,query:k,where:S,getDocs:T}=await import("./index-mBSeGJ8K.js").then(O=>O.cA);return{collection:w,query:k,where:S,getDocs:T}},__vite__mapDeps([0,1]),import.meta.url),{db:m}=await X(async()=>{const{db:w}=await import("./index-mBSeGJ8K.js").then(k=>k.cB);return{db:w}},__vite__mapDeps([0,1]),import.meta.url),h=D||(n==null?void 0:n.shopId),g=h?i(r(m,"shop_expenses"),l("shopId","==",h)):i(r(m,"shop_expenses"),l("userId","==",t.uid)),x=(await d(g)).docs.map(w=>{var T;const k=w.data(),S=(T=k.createdAt)!=null&&T.toDate?k.createdAt.toDate():k.createdAt?new Date(k.createdAt):new Date;return{id:w.id,name:String(k.name||""),amount:Number(k.amount||0),notes:k.notes?String(k.notes):void 0,source:k.source==="wallet"?"wallet":"cash",walletId:k.walletId?String(k.walletId):void 0,createdAt:S}}).sort((w,k)=>{const S=w.createdAt instanceof Date?w.createdAt.getTime():0;return(k.createdAt instanceof Date?k.createdAt.getTime():0)-S});yi(x);try{localStorage.setItem(_o(),JSON.stringify(x))}catch{}}catch(r){console.error("خطأ في مزامنة مصروفات المحل من Firestore:",r)}})(),()=>a==null?void 0:a()},[t==null?void 0:t.uid,n==null?void 0:n.shopId,D]);const En=()=>`deficiencies_${D||(n==null?void 0:n.shopId)||(t==null?void 0:t.uid)||"default-shop"}`,c0=()=>{try{const a=En(),r=`deficiencies_${(t==null?void 0:t.uid)||"default"}`;if(r!==a){const l=localStorage.getItem(r),d=localStorage.getItem(a);if(l)try{const m=JSON.parse(l)||[],h=d?JSON.parse(d):[],g=Array.isArray(h)?[...h]:[],v=(y,x)=>y.some(w=>(w==null?void 0:w.id)&&(x==null?void 0:x.id)&&String(w.id)===String(x.id)||String((w==null?void 0:w.name)||"")===String((x==null?void 0:x.name)||"")&&String((w==null?void 0:w.status)||"pending")===String((x==null?void 0:x.status)||"pending"));if(Array.isArray(m))for(const y of m)v(g,y)||g.push(y);localStorage.setItem(a,JSON.stringify(g));try{localStorage.removeItem(r)}catch{}}catch{}}const i=localStorage.getItem(a);if(i){const l=JSON.parse(i);xs(l.map(d=>({...d,createdAt:new Date(d.createdAt)})))}}catch(a){console.error("خطأ أثناء تحميل النواقص من التخزين:",a)}},To=async a=>{try{localStorage.setItem(En(),JSON.stringify(a)),xs(a)}catch(r){console.error("خطأ أثناء حفظ النواقص في التخزين:",r)}};G.useEffect(()=>{(async()=>{try{if(!(t!=null&&t.uid))return;const{collection:r,query:i,where:l,orderBy:d,getDocs:m}=await X(async()=>{const{collection:w,query:k,where:S,orderBy:T,getDocs:O}=await import("./index-mBSeGJ8K.js").then(_=>_.cA);return{collection:w,query:k,where:S,orderBy:T,getDocs:O}},__vite__mapDeps([0,1]),import.meta.url),{db:h}=await X(async()=>{const{db:w}=await import("./index-mBSeGJ8K.js").then(k=>k.cB);return{db:w}},__vite__mapDeps([0,1]),import.meta.url),g=D||(n==null?void 0:n.shopId)||t.uid||"default-shop",v=i(r(h,"deficiencies"),l("shopId","==",g),d("createdAt","desc")),x=(await m(v)).docs.map(w=>{var T;const k=w.data(),S=(T=k.createdAt)!=null&&T.toDate?k.createdAt.toDate():k.createdAt?new Date(k.createdAt):new Date;return{id:w.id,name:String(k.name||""),quantity:Number(k.quantity||1),status:k.status==="purchased"?"purchased":"pending",createdAt:S}});xs(x);try{localStorage.setItem(En(),JSON.stringify(x))}catch{}}catch(r){console.warn("فشل جلب النواقص من Firestore:",r)}})()},[t==null?void 0:t.uid,n==null?void 0:n.shopId,D]);const Ao=async a=>{try{localStorage.setItem(o0(),JSON.stringify(a)),oo(a),t!=null&&t.uid&&await se.updateUserData(t.uid,{customers:a})}catch(r){console.error("خطأ أثناء حفظ العملاء في التخزين:",r)}},d0=async()=>{try{if(t!=null&&t.uid){const a=await ca(Te(V,"users",t.uid));if(a.exists()){const r=a.data();if(r.customers&&Array.isArray(r.customers)){const i=r.customers.map(l=>{var d;return{...l,createdAt:(d=l.createdAt)!=null&&d.toDate?l.createdAt.toDate():new Date(l.createdAt)}});oo(i);return}}}oo([])}catch(a){console.error("خطأ أثناء تحميل العملاء من Firestore:",a)}},Po=()=>{const a=D||(n==null?void 0:n.shopId)||"main";return`transactions_${(t==null?void 0:t.uid)||"default"}_${a}`},rd=()=>{const a=D||(n==null?void 0:n.shopId)||"main";return`wallets_${(t==null?void 0:t.uid)||"default"}_${a}`},Xa=()=>{const a=D||(n==null?void 0:n.shopId)||"main";return`selectedWallet_${(t==null?void 0:t.uid)||"default"}_${a}`},nd=a=>{var d;const r=String((a==null?void 0:a.transactionId)||(a==null?void 0:a.id)||""),i=String((a==null?void 0:a.reference)||(a==null?void 0:a.transactionReference)||((d=a==null?void 0:a.receipt)==null?void 0:d.reference)||""),l=new Date((a==null?void 0:a.createdAt)||0).getTime();return r||i||`${i||"ref"}-${l}`},{data:Oo,refetch:Kb}=Vr({queryKey:["userTransactions",t==null?void 0:t.uid],queryFn:async()=>{if(!(t!=null&&t.uid))return[];const{collection:a,query:r,where:i,orderBy:l,limit:d,getDocs:m}=await X(async()=>{const{collection:y,query:x,where:w,orderBy:k,limit:S,getDocs:T}=await import("./index-mBSeGJ8K.js").then(O=>O.cA);return{collection:y,query:x,where:w,orderBy:k,limit:S,getDocs:T}},__vite__mapDeps([0,1]),import.meta.url),{db:h}=await X(async()=>{const{db:y}=await import("./index-mBSeGJ8K.js").then(x=>x.cB);return{db:y}},__vite__mapDeps([0,1]),import.meta.url),g=r(a(h,"userTransactions"),i("userId","==",t.uid),l("createdAt","desc"),d(100));return(await m(g)).docs.map(y=>{var B;const x=y.data(),w=(B=x.createdAt)!=null&&B.toDate?x.createdAt.toDate():new Date(x.createdAt),k=(x.txnType||"").toLowerCase(),S=k==="send"?"send":k==="receive"?"withdraw":x.type||"withdraw",T=x.status==="confirmed"?"completed":x.status||"completed",O=x.senderMsisdn||x.senderPhone||"",_=x.receiverMsisdn||x.receiverPhone||"",A=Number(x.amount??x.transferredAmount??x.withdrawnAmount??0);return{id:y.id,...x,type:S,status:T,senderPhone:O,receiverPhone:_,amount:A,createdAt:w,provider:x.provider||void 0}})},enabled:!!(t!=null&&t.uid),staleTime:1e3*60*5,gcTime:1e3*60*10});u.useEffect(()=>{if(Oo){const r=Oo.filter(h=>!((h==null?void 0:h.type)==="report"||String((h==null?void 0:h.title)||"").includes("إيصال تسليم وردية"))),i=new Set((mr||[]).map(h=>String(h.id||h.originalTransactionId||""))),l=r.filter(h=>!i.has(String(h.id||""))),d=new Set,m=[];for(const h of l){const g=nd(h);d.has(g)||(d.add(g),m.push(h))}Vt(m)}},[Oo,mr]),u.useEffect(()=>{if(!(t!=null&&t.uid))return;let a=!0;return(async()=>{try{const{collection:i,query:l,where:d,getDocs:m,orderBy:h,limit:g}=await X(async()=>{const{collection:w,query:k,where:S,getDocs:T,orderBy:O,limit:_}=await import("./index-mBSeGJ8K.js").then(A=>A.cA);return{collection:w,query:k,where:S,getDocs:T,orderBy:O,limit:_}},__vite__mapDeps([0,1]),import.meta.url),{db:v}=await X(async()=>{const{db:w}=await import("./index-mBSeGJ8K.js").then(k=>k.cB);return{db:w}},__vite__mapDeps([0,1]),import.meta.url),y=l(i(v,"deletedTransactions"),d("userId","==",t.uid),h("createdAt","desc"),g(50)),x=await m(y);if(!a)return;x.docs.forEach(w=>{const k=w.data(),S=String((k==null?void 0:k.originalTransactionId)||""),T=String((k==null?void 0:k.transactionId)||""),O=String((k==null?void 0:k.reference)||""),_=S||T||O||String(w.id);_&&(ha.current.has(_)||(ha.current.add(_),Vt(A=>{const B=A.find(z=>z.id===S);return B?((async()=>await $i(B))(),A.filter(z=>z.id!==S)):A})))})}catch(i){console.warn("تعذر جلب المعاملات المحذوفة:",i)}})(),()=>{a=!1}},[t==null?void 0:t.uid]);const[Eo,Mn]=u.useState(""),[Wt,id]=u.useState(""),Yt=G.useMemo(()=>{const a=Ct;if(!a)return!1;const r=gf(a),i=a.planType??a.plan??null,l=typeof i=="string"?i.toLowerCase():null,d=l==="monthly"||l==="quarterly"||l==="yearly"||l==="lifetime"||i===Zt.MONTHLY||i===Zt.QUARTERLY||i===Zt.YEARLY||i===Zt.LIFETIME;return r&&d},[Ct]),we=G.useMemo(()=>{var l,d;const a=Ct;if(!a)return!1;const r=((l=a.subscription)==null?void 0:l.planType)??((d=a.subscription)==null?void 0:d.plan)??a.planType??a.plan??null,i=typeof r=="string"?r.toLowerCase():null;return r===Zt.ZERO||i==="zero"},[Ct]),De=G.useMemo(()=>{var l,d;const a=Ct;if(!a)return!1;const r=((l=a.subscription)==null?void 0:l.planType)??((d=a.subscription)==null?void 0:d.plan)??a.planType??a.plan??null,i=typeof r=="string"?String(r).trim().toLowerCase():null;return r===Zt.TAHWEELA||i==="tahweela"||i==="تحويله"},[Ct]),u0=()=>{if(!Yt){p({title:"غير متاح",description:"هذه الميزة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة. يرجى تفعيل اشتراكك.",variant:"destructive"});return}lt(!0)},[Jb,Hb]=u.useState(!1),[m0,h0]=u.useState(!1),[f0,g0]=u.useState(!1),[p0,x0]=u.useState(!1),[y0,Cr]=u.useState(!1),[Za,Wn]=u.useState(""),[Ir,Rn]=u.useState(""),[od,Ln]=u.useState(!1),[_r,Tr]=u.useState(null),[Mo,Fn]=u.useState(""),[b0,ld]=u.useState(!1),[Qb,Gb]=u.useState(!1),[v0,Bn]=u.useState(!1),[cd,Wo]=u.useState(""),[dd,Ro]=u.useState(""),[ud,md]=u.useState(!1);u.useEffect(()=>{const a=r=>{var d,m;const i=(d=r.detail)==null?void 0:d.action,l=((m=r.detail)==null?void 0:m.payload)||{};if(console.log("🔔 Dashboard Navigation Action:",i,l),i==="profile-settings")L(!0);else if(i==="debts")Sn();else if(i==="sales")we||De?p({title:"غير متاح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):js(!0);else if(i==="maintenance")we||De?p({title:"غير متاح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):xr(!0);else if(i==="credit-cards")we||De?p({title:"غير متاح",description:"كروت الائتمان غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):pr(!0);else if(i==="shop-expenses")we||De?p({title:"غير متاح",description:"مصروفات المحل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Rt.hasMasterPin()?gs(!0):Ya(!0);else if(i==="deficiencies")we||De?p({title:"غير متاح",description:"النواقص غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):ar(!0);else if(i==="installment")we||De?p({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"}):gr(!0);else if(i==="cashier-shift")!Yt||De?p({title:"غير متاح",description:"وردية الكاشير متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"}):lt(!0);else if(i==="machine-daily")!Yt||De?p({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"}):yr(!0);else if(i==="branch-management")(gt==null?void 0:gt.status)==="active"?le(!0):He(!0);else if(i==="my-client-numbers")on(!0);else if(i==="transaction-section"){const h=document.getElementById("transaction-section");if(h){const g=l.skipAnimation?"auto":"smooth";h.scrollIntoView({behavior:g})}l.transactionType&&Ei(l.transactionType),l.startNewTransaction&&(ir(""),vs(""),un(""),mn(""),console.log("🔒 Starting new transaction via event"))}};return window.addEventListener("dashboard-navigation-action",a),()=>window.removeEventListener("dashboard-navigation-action",a)},[F,De,gt,we,Yt]);const hd=async()=>{var a;if(t!=null&&t.uid)try{const r=`userData_${t.uid}`,i=localStorage.getItem(r),l=`debts_unsynced_${t.uid}`,d=localStorage.getItem(kr()),m=localStorage.getItem(l)==="true";if(i){const h=JSON.parse(i);console.log("🔄 مزامنة البيانات المحلية مع Firebase...",h);const g={lastSynced:new Date().toISOString()};typeof h.cashBalance=="number"&&(g.cashBalance=h.cashBalance),h.walletBalances&&typeof h.walletBalances=="object"&&(g.walletBalances=h.walletBalances),await se.updateUserData(t.uid,g),localStorage.removeItem(r),me(!1),console.log("✅ تمت المزامنة بنجاح وحذف البيانات المحلية")}else console.log("لا توجد بيانات محلية تحتاج للمزامنة");if(m&&d)try{const h=JSON.parse(d)||[],g=_=>_ instanceof Date?_:typeof(_==null?void 0:_.toDate)=="function"?_.toDate():_?new Date(String(_)):new Date,v=_=>(Array.isArray(_)?_:[]).map(A=>({...A,amount:Number(A.amount||0),paidAmount:Number(A.paidAmount||0),createdAt:g(A.createdAt),partialPayments:Array.isArray(A.partialPayments)?A.partialPayments.map(B=>({amount:Number(B.amount||0),paidAt:g(B.paidAt)})):[]})),y=await ca(Te(V,"users",t.uid)),x=y.exists()?((a=y.data())==null?void 0:a.debts)||[]:[],w=v(x),k=v(h),S={};for(const _ of w)S[String(_.id||"")]=_;const T=[],O=new Set;for(const _ of k){const A=String(_.id||""),B=S[A];if(B){const z=Number(B.paidAmount||0)+(Array.isArray(B.partialPayments)?B.partialPayments.reduce((je,ce)=>je+Number(ce.amount||0),0):0),re=Number(_.paidAmount||0)+(Array.isArray(_.partialPayments)?_.partialPayments.reduce((je,ce)=>je+Number(ce.amount||0),0):0),tt=String(B.status||"pending"),yt=String(_.status||"pending"),dt=tt==="paid"||z>=Number(B.amount||0)?B:yt==="paid"?{...B,paidAmount:Number(_.paidAmount||0),partialPayments:_.partialPayments,status:"paid"}:re>z?{...B,paidAmount:Number(_.paidAmount||0),partialPayments:_.partialPayments,status:re>=Number(B.amount||0)?"paid":"pending"}:B;T.push(dt),O.add(A)}else T.push(_),O.add(A)}for(const _ of w){const A=String(_.id||"");O.has(A)||T.push(_)}await se.updateUserData(t.uid,{debts:T});try{localStorage.removeItem(l)}catch{}me(!1)}catch{me(!0)}}catch(r){console.error("❌ فشل في مزامنة البيانات:",r),p({title:"فشل في المزامنة",description:"حدث خطأ أثناء مزامنة البيانات مع الخادم",variant:"destructive"})}},[fd,$n]=u.useState({keepLastCount:30,intervalDays:7,lastResetAt:null});u.useEffect(()=>{(async()=>{if(t!=null&&t.uid)try{const r=await se.getUserData(t.uid),i=(r==null?void 0:r.recentReset)||{},l=Number(i==null?void 0:i.keepLastCount)>0?Number(i.keepLastCount):30,d=Number(i==null?void 0:i.intervalDays)>0?Number(i.intervalDays):7,m=y=>y instanceof Date?y:typeof(y==null?void 0:y.toDate)=="function"?y.toDate():y?new Date(String(y)):null,h=i!=null&&i.lastResetAt?m(i.lastResetAt):null,g=new Date;!h||g.getTime()-h.getTime()>=d*24*60*60*1e3?(await se.updateUserData(t.uid,{recentReset:{keepLastCount:l,intervalDays:d,lastResetAt:g}}),$n({keepLastCount:l,intervalDays:d,lastResetAt:g})):$n({keepLastCount:l,intervalDays:d,lastResetAt:h})}catch{$n({keepLastCount:30,intervalDays:7,lastResetAt:null})}})()},[t==null?void 0:t.uid]);const gd=G.useMemo(()=>{const a=ie||[],r=h=>h instanceof Date?h:typeof(h==null?void 0:h.toDate)=="function"?h.toDate():new Date(String(h)),i=new Date,l=new Date(i.getFullYear(),i.getMonth(),1),d=new Date(i.getFullYear(),i.getMonth()+1,1);return[...a].sort((h,g)=>r(g.createdAt).getTime()-r(h.createdAt).getTime()).filter(h=>{const g=r(h.createdAt);return g>=l&&g<d})},[ie]),w0=G.useMemo(()=>{const a=ie||[],r=h=>h instanceof Date?h:typeof(h==null?void 0:h.toDate)=="function"?h.toDate():new Date(String(h)),i=new Date,l=new Date(i.getFullYear(),i.getMonth(),1),d=new Date(i.getFullYear(),i.getMonth()+1,1),m=a.filter(h=>{const g=r(h.createdAt);return g>=l&&g<d}).length;return Math.max(0,((ie==null?void 0:ie.length)||0)-m)},[ie==null?void 0:ie.length]),Un=G.useMemo(()=>{const a=new Date,r=new Date(a.getFullYear(),a.getMonth(),1),i=new Date(a.getFullYear(),a.getMonth()+1,1),l={};for(const m of ie){const h=new Date(m.createdAt||0);if(!(h>=r&&h<i))continue;const g=String(m.type||m.txnType||"").toLowerCase();if(!(g==="send"||g==="withdraw"||g==="transfer"))continue;const v=String(m.receiverPhone||m.senderPhone||"").trim();if(!v)continue;const y=Jt(v),x=Number(m.amount||m.withdrawnAmount||m.sentAmount||0)||0;l[y]||(l[y]={phone:y,count:0,total:0}),l[y].count+=1,l[y].total+=x}return Object.values(l).sort((m,h)=>h.count!==m.count?h.count-m.count:h.total-m.total).slice(0,10)},[ie]),N0=a=>{const r=Jt(String(a));return r.startsWith("+20")?"20"+r.slice(3):r.startsWith("0")?"20"+r.slice(1):r.replace(/[^0-9]/g,"")},j0=a=>{const r=N0(a.phone),i=`عميل VIP هذا الشهر
عدد العمليات: ${a.count}
الإجمالي: ${a.total} جنيه`,l=`https://wa.me/${r}?text=${encodeURIComponent(i)}`;try{window.open(l,"_blank")}catch{}};u.useEffect(()=>{(async()=>{try{if(!(t!=null&&t.uid))return;const a=`${new Date().getFullYear()}-${new Date().getMonth()+1}`;await se.updateUserData(t.uid,{vipTop10:Un,vipMonthTag:a})}catch{}})()},[t==null?void 0:t.uid,Un]);async function pd(){const a=new Date,r=new Intl.DateTimeFormat("ar-EG",{timeZone:"Africa/Cairo",year:"numeric",month:"2-digit",day:"2-digit"}).format(a),i=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),l=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59,999),d=(ie||[]).filter(S=>{const T=new Date(S.createdAt||0);return T>=i&&T<=l}),m=d.length,h=d.filter(S=>String(S.type||S.txnType||"").toLowerCase()==="withdraw"||String(S.type||"").toLowerCase()==="receive").reduce((S,T)=>S+(T.withdrawnAmount!=null?Number(T.withdrawnAmount):Number(T.amount||0)),0),g=d.filter(S=>String(S.type||S.txnType||"").toLowerCase()==="send"||String(S.type||"").toLowerCase()==="transfer").reduce((S,T)=>S+(T.sentAmount!=null?Number(T.sentAmount):Number(T.amount||0)),0);let v=0;try{v=d.reduce((S,T)=>S+St.calculateTransactionProfit(T),0)}catch{}let y=0;try{const S=new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Cairo"}).format(a),T=Oe(pe(V,"dailySales"),ae("userId","==",(t==null?void 0:t.uid)||""));y=(await ke(T)).docs.map(A=>A.data()).filter(A=>String(A.date||S)===S).reduce((A,B)=>A+Number(B.sellingPrice||B.price||0)*Number(B.quantity||1),0)}catch{}let x=0;try{x=(Ie||[]).filter(T=>String(T.status||"")==="pending").reduce((T,O)=>{const _=Number(O.paidAmount||0)+(Array.isArray(O.partialPayments)?O.partialPayments:[]).reduce((A,B)=>A+Number(B.amount||0),0);return T+Math.max(0,Number(O.amount||0)-_)},0)}catch{}let w="";try{const S=D||(n==null?void 0:n.shopId)||null,T=S?Oe(pe(V,"deficiencies"),ae("shopId","==",S)):Oe(pe(V,"deficiencies"),ae("userId","==",(t==null?void 0:t.uid)||""));w=(await ke(T)).docs.map(B=>B.data()).filter(B=>String(B.status||"pending")==="pending").slice(0,10).map((B,z)=>`${z+1}- ${String(B.name||B.productName||"عنصر")} × ${Number(B.quantity||B.qty||0)}`).join(`
`)}catch{}return[`تقرير يومي - ${r}`,`عدد العمليات: ${m}`,`إجمالي المسحوبات: ${h} جنيه`,`إجمالي الإرسال: ${g} جنيه`,`الأرباح: ${v} جنيه`,`إجمالي مبيعات الاكسسوار: ${y} جنيه`,`إجمالي الديون: ${x} جنيه`,"نواقص الاكسسوار:",w||"لا توجد عناصر مسجلة"].join(`
`)}const xd=G.useCallback(()=>{let a=gd;const r=mc.trim();if(r&&(a=a.filter(i=>{const l=i;return String(l.type||"").toLowerCase()==="cash_addition"||String(l.txnType||"").toLowerCase()==="cash_addition"||String(l.title||"").includes("إيصال إضافة نقدية")?!0:i.senderPhone&&i.senderPhone.includes(r)||i.receiverPhone&&i.receiverPhone.includes(r)})),xn){const i=new Date(xn);a=a.filter(l=>{const d=new Date(l.createdAt);if(yn){const[m,h]=yn.split(":"),g=new Date(i);g.setHours(parseInt(m),parseInt(h),0,0);const v=new Date(g);return v.setHours(v.getHours()+1),d>=g&&d<v}else return d.toDateString()===i.toDateString()})}try{a=[...a].sort((i,l)=>{const d=new Date(i.createdAt||0).getTime();return new Date(l.createdAt||0).getTime()-d})}catch{}return a},[gd,mc,xn,yn]),yd=async()=>{if(we||De){p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"});return}if(!(t!=null&&t.uid)){p({title:"خطأ في المصادقة",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}try{const a=await pd(),r=t!=null&&t.uid?`tg_daily_report_last_${t.uid}`:"tg_daily_report_last",i=Date.now();let l=!0;try{const d=localStorage.getItem(r);if(d){const m=JSON.parse(d),h=Number((m==null?void 0:m.at)||0);i-h<3e4&&(l=!1)}}catch{}if(l){await as.send(t.uid,a);try{localStorage.setItem(r,JSON.stringify({at:i}))}catch{}}p({title:"تم الإرسال",description:"تم إرسال التقرير اليومي إلى تليجرام",variant:"default"})}catch{p({title:"فشل الإرسال",description:"تعذّر إرسال التقرير اليومي إلى تليجرام",variant:"destructive"})}},[S0,Vn]=u.useState(!1),[bd,qn]=u.useState(""),[D0,zn]=u.useState(!1),[Lo,Fo]=u.useState(""),[k0,me]=u.useState(!1),[C0,Bo]=u.useState(!1),es=async(a,r=2,i=700)=>{let l;for(let d=0;d<=r;d++)try{return await a()}catch(m){if(l=m,d===r)break;await new Promise(h=>setTimeout(h,i*Math.pow(2,d)))}throw l};F.reduce((a,r)=>a+(ve[r.id]||0),0);const I0=async a=>await Rt.verifyMasterPin(a,t==null?void 0:t.uid),Yn=async a=>await Rt.verifyMasterPin(a,t==null?void 0:t.uid);u.useEffect(()=>{if(t!=null&&t.uid){try{const a=et(),r=`walletBalances_${t.uid}`,i=localStorage.getItem(a)??localStorage.getItem(r);if(i){const l=JSON.parse(i);ct(l&&typeof l=="object"?l:{});try{localStorage.setItem(a,JSON.stringify(l||{}))}catch{}}}catch{}try{const a=Ve(),r=`cashBalance_${t.uid}`,i=`userCashBalance_${t.uid}`;let l=localStorage.getItem(a)??localStorage.getItem(r)??localStorage.getItem(i);if(l!=null){const d=parseFloat(l);Ze(Number.isFinite(d)?d:0);try{localStorage.setItem(a,String(Number.isFinite(d)?d:0)),localStorage.removeItem(r),localStorage.removeItem(i)}catch{}}}catch{}}},[t==null?void 0:t.uid,D,n==null?void 0:n.shopId]),u.useEffect(()=>{const a=r=>{var i;try{const l=Number((i=r==null?void 0:r.detail)==null?void 0:i.value);if(Number.isFinite(l))Ze(l);else{const d=localStorage.getItem(Ve());d!=null&&Ze(parseFloat(d)||0)}}catch{const l=localStorage.getItem(Ve());l!=null&&Ze(parseFloat(l)||0)}};return window.addEventListener("cashBalanceChanged",a),()=>window.removeEventListener("cashBalanceChanged",a)},[t==null?void 0:t.uid,D,n==null?void 0:n.shopId]);const{data:$o}=Vr({queryKey:["dashboardData",D||(n==null?void 0:n.shopId)],queryFn:async()=>{const a=D||(n==null?void 0:n.shopId);if(!a)return null;const r=Te(V,"dashboardData",a),i=await ca(r);return i.exists()?i.data():null},enabled:!!(t!=null&&t.uid&&(D||n!=null&&n.shopId)),staleTime:1e3*60*5,refetchInterval:1e3*60*5});u.useEffect(()=>{if($o){const a=$o,r=Number((a==null?void 0:a.cashBalance)||0),i=a!=null&&a.walletBalances&&typeof a.walletBalances=="object"?a.walletBalances:{};try{const l=a!=null&&a.lastUpdated?new Date(a.lastUpdated).getTime():0,d=localStorage.getItem(Ve()+"_lastUpdated"),m=d?new Date(d).getTime():0;l>=m&&(Ze(r),ct(i),localStorage.setItem(Ve(),String(r)),localStorage.setItem(et(),JSON.stringify(i)),a!=null&&a.lastUpdated&&(localStorage.setItem(Ve()+"_lastUpdated",a.lastUpdated),localStorage.setItem(et()+"_lastUpdated",a.lastUpdated)))}catch{}}},[$o]);const vd=a=>`walletLimits_${(t==null?void 0:t.uid)||"default"}_${a||"none"}`,{data:Kn}=Vr({queryKey:["walletLimits",E],queryFn:async()=>{if(!E)return null;const a=Te(V,"walletLimits",String(E)),r=await ca(a);return r.exists()?r.data():null},enabled:!!E,staleTime:1e3*60*5});u.useEffect(()=>{if(E)try{const a=vd(E),r=localStorage.getItem(a);if(r&&!Kn){const i=JSON.parse(r);_s(i)}if(Kn){const i=Kn,l={walletId:E,dailyTransferLimit:i.dailyTransferLimit??6e4,dailyWithdrawLimit:i.dailyWithdrawLimit??1e5,dailyTransferUsed:i.dailyTransferUsed??0,dailyWithdrawUsed:i.dailyWithdrawUsed??0,monthlyTransferLimit:i.monthlyTransferLimit??2e5,monthlyWithdrawLimit:i.monthlyWithdrawLimit??2e5,monthlyTransferUsed:i.monthlyTransferUsed??0,monthlyWithdrawUsed:i.monthlyWithdrawUsed??0};_s(l);try{localStorage.setItem(vd(E),JSON.stringify(l))}catch{}}}catch{}},[E,Kn]),u.useEffect(()=>{if(!E)return;const a=F.find(r=>r.id===E);if(a!=null&&a.name){zc(String(a.name));try{localStorage.setItem(`walletName_${(t==null?void 0:t.uid)||"default"}_${E}`,String(a.name))}catch{}return}try{const r=localStorage.getItem(`walletName_${(t==null?void 0:t.uid)||"default"}_${E}`);r&&zc(String(r))}catch{}},[E,F]);const Uo=async()=>{try{if(!E)return;const a=await is.autoResetLimitsIfNeeded(E);_s(a)}catch(a){console.error("خطأ في جلب حدود المحفظة المختارة:",a)}};u.useEffect(()=>{Uo()},[E]),u.useEffect(()=>{const a=r=>{var i;(i=r==null?void 0:r.detail)!=null&&i.walletId&&r.detail.walletId===E&&Uo()};return window.addEventListener("walletLimitsUpdated",a),()=>window.removeEventListener("walletLimitsUpdated",a)},[E]),u.useEffect(()=>{const a=r=>{var i;try{const l=String(((i=r==null?void 0:r.detail)==null?void 0:i.walletId)||"");l&&Ar(l,"sms:auto")}catch{}};return window.addEventListener("walletSelection:update",a),()=>window.removeEventListener("walletSelection:update",a)},[F]),u.useEffect(()=>{if(c.state){if(console.log("Location state:",c.state),c.state.openDebtDialog&&(Sn(),window.history.replaceState({},document.title)),c.state.openSalesDialog&&(we||De?p({title:"غير متاح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):js(!0),window.history.replaceState({},document.title)),c.state.openMaintenanceDialog&&(we||De?p({title:"غير متاح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):xr(!0),window.history.replaceState({},document.title)),c.state.openCreditCardsDialog&&(console.log("Opening credit cards dialog"),we||De?p({title:"غير متاح",description:"كروت الائتمان غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):pr(!0),window.history.replaceState({},document.title)),c.state.openShopExpensesDialog&&(we||De?p({title:"غير متاح",description:"مصروفات المحل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Rt.hasMasterPin()?gs(!0):Ya(!0),window.history.replaceState({},document.title)),c.state.openDeficienciesDialog&&(we||De?p({title:"غير متاح",description:"النواقص غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):ar(!0),window.history.replaceState({},document.title)),c.state.openInstallment&&(we||De?p({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"}):gr(!0),window.history.replaceState({},document.title)),c.state.openTransactionSection){const a=document.getElementById("transaction-section");a&&a.scrollIntoView({behavior:"smooth"}),c.state.transactionType&&Ei(c.state.transactionType),c.state.startNewTransaction&&(ir(""),vs(""),un(""),mn(""),console.log("🔒 Starting new transaction without changing wallet selection")),c.state.focusWalletSelection&&setTimeout(()=>{const r=document.querySelector('[data-testid="wallet-select"]');r&&r.focus()},500),window.history.replaceState({},document.title)}c.state.openCashierShiftModal&&(!Yt||De?p({title:"غير متاح",description:"وردية الكاشير متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"}):lt(!0),window.history.replaceState({},document.title)),c.state.openMachineDailyDialog&&(!Yt||De?p({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"}):yr(!0),window.history.replaceState({},document.title)),c.state.openBranchManagement&&((gt==null?void 0:gt.status)==="active"?le(!0):He(!0),window.history.replaceState({},document.title)),c.state.openMyClientNumbersDialog&&(on(!0),window.history.replaceState({},document.title))}},[c.state,F,De,gt]),u.useEffect(()=>{c.pathname==="/user/dashboard"&&sessionStorage.getItem("previousPath")==="/user/add-wallet"&&(console.log("🔄 Returned from wallet addition page - reloading wallets"),Vo(),sessionStorage.removeItem("previousPath")),sessionStorage.setItem("previousPath",c.pathname)},[c.pathname,t==null?void 0:t.uid]),u.useEffect(()=>{if(!(t!=null&&t.uid))return;(async()=>{try{const r=Te(V,"users",t.uid),i=await ca(r);if(i.exists()){const d=i.data().isActive===!0;d&&!Zs?(Oa(!0),Ea(!1),er(!1)):!d&&Zs&&(Oa(!1),Ea(!0))}}catch(r){console.error("Check user status error",r)}})()},[t==null?void 0:t.uid]),u.useEffect(()=>{if(!(t!=null&&t.uid))return;const a=i=>{const{userId:l}=i.detail;l===t.uid&&(console.log("🎉 Subscription activation event received for current user!"),Oa(!0),Ea(!1),er(!1),setTimeout(()=>{console.log("✅ User activation completed - data updated")},1e3))},r=i=>{const{userId:l,isActive:d}=i.detail;l===t.uid&&(console.log("🔄 User subscription update event received:",{userId:l,isActive:d}),d&&!Zs&&(Oa(!0),Ea(!1),er(!1),setTimeout(()=>{console.log("✅ User subscription updated - data refreshed")},1e3)))};return window.addEventListener("subscriptionActivated",a),window.addEventListener("userSubscriptionUpdated",r),()=>{window.removeEventListener("subscriptionActivated",a),window.removeEventListener("userSubscriptionUpdated",r)}},[t==null?void 0:t.uid,Zs]),u.useEffect(()=>{const a=r=>{var m;const i=r.target,l=(m=i==null?void 0:i.tagName)==null?void 0:m.toLowerCase();if(!(l==="input"||l==="textarea"||l==="select"||((i==null?void 0:i.isContentEditable)??!1))&&!(r.ctrlKey||r.altKey||r.metaKey)&&!r.repeat){if((we||De)&&r.key>="1"&&r.key<="9"){r.preventDefault();return}switch(r.key){case"1":break;case"2":Ji(!0);break;case"3":we||De?p({title:"غير متاح",description:"كروت الائتمان غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):pr(!0);break;case"4":Yt?lt(!0):p({title:"غير متاح",description:"وردية الكاشير متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"});break;case"5":we||De?p({title:"غير متاح",description:"بيانات المبيعات غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):js(!0);break;case"6":Sn();break;case"7":we||De?p({title:"غير متاح",description:"الصيانة غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):xr(!0);break;case"8":Yt?yr(!0):p({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"});break;case"9":we||De?p({title:"غير متاح",description:"مصروفات المحل غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}):Rt.hasMasterPin()?gs(!0):Ya(!0);break}}};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[we,De,Yt]),u.useEffect(()=>{console.log("🔥 useEffect loadUserData started",{user:t==null?void 0:t.uid,isCheckingActivation:gi}),(async()=>{try{if(!(t!=null&&t.uid)){console.log("🔥 No user UID, setting isCheckingActivation to false"),er(!1);return}try{const m=await ca(Te(V,"users",t.uid));if(m.exists()){const g=m.data().isActive===!0,v=await Kd.checkTrialValidity(t.uid),y=v.isValid&&!v.isExpired;Oa(g||y),Vl(y),ql(v.hoursRemaining),zl(v.hasUsedTrial),Ea(!g&&!y),console.log("📊 حالة المستخدم:",{isActive:g,isOnTrial:y,hoursRemaining:v.hoursRemaining,hasUsedTrial:v.hasUsedTrial})}else Oa(!1),Ea(!0)}catch(m){console.error("خطأ في فحص حالة تفعيل المستخدم:",m),Oa(!1),Ea(!0)}finally{er(!1)}if(console.log("🔄 بدء تحميل بيانات المستخدم من Firebase...",{userId:t==null?void 0:t.uid}),t!=null&&t.uid){const m=await es(()=>se.getUserData(t.uid)),h=`userData_${t==null?void 0:t.uid}`;let g=null;try{const v=localStorage.getItem(h);v&&(g=JSON.parse(v))}catch{}if(m){let v=(m==null?void 0:m.walletBalances)||{},y=m==null?void 0:m.cashBalance;const x=m.lastUpdated?new Date(m.lastUpdated).getTime():0;g&&(g.lastUpdated?new Date(g.lastUpdated).getTime():0)>=x&&(g.walletBalances&&(v=g.walletBalances),g.cashBalance!==void 0&&(y=g.cashBalance));try{const w=Ve(),k=et(),S=localStorage.getItem(w+"_lastUpdated"),T=localStorage.getItem(k+"_lastUpdated"),O=S?new Date(S).getTime():0,_=T?new Date(T).getTime():0;if(O>x){const A=localStorage.getItem(w);A!==null&&(y=parseFloat(A))}if(_>x){const A=localStorage.getItem(k);if(A!==null)try{v=JSON.parse(A)}catch{}}}catch(w){console.error("Error checking individual keys fallback:",w)}ct(v),y!==void 0&&Ze(y);try{const w=t!=null&&t.uid?await es(()=>$r.getDeletedTransactionsByUser(t.uid)):[];hr(w||[])}catch{hr([])}}else{ct({});try{const v=t!=null&&t.uid?await $r.getDeletedTransactionsByUser(t.uid):[];hr(v||[])}catch{hr([])}}}console.log("🔄 بدء تحميل المحافظ من Firebase...");try{const m=await es(()=>ti.getByMerchantId((t==null?void 0:t.uid)||""));if(m&&m.length>0){console.log("✅ تم العثور على محافظ في Firebase:",m.length);const g=m.filter(x=>x.isActive===!0).map(x=>({id:x.id,name:x.label||"محفظة بدون اسم",phone:x.msisdn,isDefault:!1,monthlyWithdrawalLimit:x.monthlyWithdrawalLimit??x.withdrawLimit??2e5,monthlyTransferLimit:x.monthlyTransferLimit??x.transferLimit??2e5,defaultTransferCommission:x.defaultTransferCommission!=null?Number(x.defaultTransferCommission):null,defaultWithdrawCommission:x.defaultWithdrawCommission!=null?Number(x.defaultWithdrawCommission):null,ownerName:x.ownerName,nationalId:x.nationalId,providerName:x.provider}));Fe(g);const v=localStorage.getItem(Xa());let y=null;v&&g.find(x=>x.id===v)?y=g.find(x=>x.id===v):y=g[0],y&&(Xs(y.id),bs(y.phone)),console.log("🔄 تم تحديث المحافظ من Firebase وحفظها في localStorage")}else console.log("⚠️ لا توجد محافظ في Firebase. سيتم عرض قائمة فارغة بدون أي استرجاع محلي."),Fe([])}catch(m){console.error("خطأ في تحميل المحافظ من Firebase:",m),Fe([])}const d=t!=null&&t.uid?await es(()=>se.getUserTransactions(t.uid)):[];if(d&&d.length>0){console.log("📊 تم تحميل المعاملات من Firebase:",d.length);const m=d.map(x=>({...x,createdAt:new Date(x.createdAt),senderPhone:x.senderMsisdn||x.senderPhone||"",receiverPhone:x.receiverMsisdn||x.receiverPhone||"",type:x.txnType==="send"?"send":x.txnType==="receive"?"withdraw":x.type||"withdraw",status:x.status==="confirmed"?"completed":x.status||"completed"})),h=mr.map(x=>x.id||x.originalTransactionId);let g=[];try{const x=Oe(pe(V,"deletedTransactions"),ae("userId","==",(t==null?void 0:t.uid)||""),ae("permanent","==",!0));g=(await ke(x)).docs.map(k=>{const S=k.data();return String(S.originalTransactionId||S.transactionId||k.id||"")}).filter(Boolean)}catch{}const v=new Set(g),y=m.filter(x=>{var _;const w=String(x.id||""),k=String(x.transactionId||""),S=String(x.reference||x.transactionReference||((_=x.receipt)==null?void 0:_.reference)||""),T=h.includes(w),O=v.has(w)||k&&v.has(k);return!T&&!O});console.log("✅ تم فلترة المعاملات المحذوفة:",{total:d.length,deleted:h.length,active:y.length});{const x=new Set,w=[];for(const k of y){const S=nd(k);x.has(S)||(x.add(S),w.push(k))}nh||Vt(w)}}await hd()}catch(d){console.error("خطأ في تحميل بيانات المستخدم من Firebase:",d)}})().then(async()=>{await l(),await r(),await i()});const r=async()=>{try{if(!(t!=null&&t.uid))return;const d=await ti.getByMerchantId(t.uid);await Promise.all(d.map(m=>Vy.autoResetLimitsIfNeeded(m.id)))}catch(d){console.error("خطأ في التصفير التلقائي للحدود:",d)}},i=async()=>{try{await St.syncReportsDataFromFirebase(t==null?void 0:t.uid);const d=St.getReportsData(t==null?void 0:t.uid);if((d.lastDailyResetDate?St.shouldResetDailyReports(d.lastDailyResetDate):!1)&&(t!=null&&t.uid)&&d.lastDailyResetDate){const g=new Date(d.lastDailyResetDate),v=g.toDateString(),y=ie.filter(_=>new Date(_.createdAt).toDateString()===v&&_.status==="completed"),x=y.length,w=y.reduce((_,A)=>_+A.amount,0),k=y.filter(Pr).reduce((_,A)=>{const B=A.withdrawnAmount!==void 0?A.withdrawnAmount:A.amount;return _+B},0),S=y.filter(Or).reduce((_,A)=>{const B=A.sentAmount!==void 0?A.sentAmount:A.amount;return _+B},0),T=y.reduce((_,A)=>_+St.calculateTransactionProfit(A),0),O=new Date(g).toISOString().slice(0,10);await Mr.add({userId:t.uid,reportDate:O,totalTransactions:x,totalAmount:Number(w.toFixed(2)),totalWithdrawn:Number(k.toFixed(2)),totalSent:Number(S.toFixed(2)),profit:Number(T.toFixed(2)),walletId:null})}const h=St.autoResetReportsIfNeeded(t==null?void 0:t.uid);(h.dailyReset||h.monthlyReset)&&console.log("تم التصفير التلقائي:",h)}catch(d){console.error("خطأ في التصفير التلقائي للتقارير:",d)}},l=async()=>{try{if(!(t!=null&&t.uid))return;const d=new Date;if(d.getDate()!==1)return;const m=`${d.getFullYear()}-${d.getMonth()+1}`,h=`lastMonthlyDbCleanup:${t.uid}`;if(localStorage.getItem(h)===m)return;const v=new Date(d.getFullYear(),d.getMonth(),1,0,0,0,0),y=k=>k instanceof Date?k:typeof(k==null?void 0:k.toDate)=="function"?k.toDate():new Date(String(k));let x=[];try{const k=Oe(pe(V,"userTransactions"),ae("userId","==",t.uid),ae("createdAt","<",v));x=(await ke(k)).docs}catch{const k=Oe(pe(V,"userTransactions"),ae("userId","==",t.uid));x=(await ke(k)).docs.filter(T=>{var O;return y((O=T.data())==null?void 0:O.createdAt)<v})}await Promise.allSettled(x.map(k=>Ld(k.ref)));let w=[];try{const k=Oe(pe(V,"transactions"),ae("userId","==",t.uid),ae("createdAt","<",v));w=(await ke(k)).docs}catch{const k=Oe(pe(V,"transactions"),ae("userId","==",t.uid));w=(await ke(k)).docs.filter(T=>{var O;return y((O=T.data())==null?void 0:O.createdAt)<v})}await Promise.allSettled(w.map(k=>Ld(k.ref)));try{localStorage.setItem(h,m)}catch{}console.log("✅ تم تنظيف قاعدة البيانات شهريًا (Firebase فقط):",{userTransactionsDeleted:x.length,globalTransactionsDeleted:w.length,monthStart:v})}catch(d){console.error("فشل التنظيف الشهري التلقائي لقاعدة البيانات:",d)}};Qh(),bo(),d0(),console.log("🔥 useEffect loadUserData completed")},[t==null?void 0:t.uid]);const Vo=async()=>{var a;if(t!=null&&t.uid)try{const r=await es(()=>ti.getByMerchantId(t.uid));if(r&&r.length>0){const l=r.filter(d=>d.isActive===!0).map(d=>({id:d.id,name:d.label||"محفظة بدون اسم",phone:d.msisdn,isDefault:!1,monthlyWithdrawalLimit:d.monthlyWithdrawalLimit??d.withdrawLimit??2e5,monthlyTransferLimit:d.monthlyTransferLimit??d.transferLimit??2e5,defaultTransferCommission:d.defaultTransferCommission!=null?Number(d.defaultTransferCommission):void 0,defaultWithdrawCommission:d.defaultWithdrawCommission!=null?Number(d.defaultWithdrawCommission):void 0}));if(Fe(l),t!=null&&t.uid){const d=localStorage.getItem(Xa());if(!!(E&&l.find(h=>h.id===E)))console.log("🔒 Preserving current wallet selection:",E);else{const g=(d&&l.find(v=>v.id===d)?d:null)||((a=l[0])==null?void 0:a.id);g&&(console.log("🔄 Fixing invalid wallet selection:",g),Ar(g))}}console.log("🔄 تم تحديث المحافظ من Firebase:",l.length)}}catch(r){console.error("خطأ في تحميل المحافظ من Firebase:",r)}};u.useEffect(()=>{const a=c.pathname;if(sessionStorage.getItem("previousPath")==="/user/add-wallet"&&a==="/user/dashboard"){P.invalidateQueries({queryKey:["wallets",t==null?void 0:t.uid]});try{gn.refetch()}catch{}sessionStorage.removeItem("previousPath")}sessionStorage.setItem("previousPath",a)},[c.pathname,t==null?void 0:t.uid]),u.useEffect(()=>{const a=()=>{P.invalidateQueries({queryKey:["wallets",t==null?void 0:t.uid]});try{gn.refetch()}catch{}};return window.addEventListener("focus",a),()=>{window.removeEventListener("focus",a)}},[t==null?void 0:t.uid,E,F]);const Ar=async(a,r="unknown")=>{console.log(`🎯 setWalletSelection called from ${r} with walletId:`,a),console.log("🔍 Previous selectedWallet:",E),Xs(a);const i=F.find(l=>l.id===a);if(i&&(bs(i.phone),console.log("✅ Wallet set successfully:",a,"Phone:",i.phone)),t!=null&&t.uid){localStorage.setItem(Xa(),a),console.log("💾 Saved wallet to localStorage:",a);try{await Wr.set({key:"selected_wallet_id",value:a}),await Wr.set({key:"current_user_id",value:t.uid}),console.log("📱 Saved wallet and user ID to Capacitor Preferences:",a,t.uid)}catch(l){console.error("❌ Failed to save to Capacitor Preferences:",l)}}};u.useEffect(()=>{const a=()=>{Vo()};try{window.addEventListener("wallets:activation-updated",a)}catch{}return()=>{try{window.removeEventListener("wallets:activation-updated",a)}catch{}}},[t==null?void 0:t.uid]);const _0=a=>{if(a==="__add_wallet"){f("/user/add-wallet");return}if(a==="__view_wallets"){dn(!0);return}Wf.isEnabled(t==null?void 0:t.uid)?(Ti(a),_i(!0)):Ar(a,"walletSelectionNoPin")},Jn=a=>{console.log("🔄 handleTransactionTypeChange called with type:",a),console.log("🔍 Current selectedWallet before change:",E),console.log("🔍 Available wallets count:",F.length),Ei(a),ir(""),vs(""),un(""),mn(""),console.log("✅ Transaction type changed to:",a,"- Wallet selection preserved:",E),setTimeout(()=>{const r=document.getElementById("transaction-section");r&&r.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)};u.useEffect(()=>{const a=r=>{const i=r.target;if(!!i&&(i.tagName==="INPUT"||i.tagName==="TEXTAREA"||i.tagName==="SELECT"||i.isContentEditable)||(r.key==="ArrowLeft"?(r.preventDefault(),Jn("withdraw")):r.key==="ArrowRight"&&(r.preventDefault(),Jn("transfer"))),r.key==="Enter"){const d=R==="transfer"?"transferSubmitButton":"withdrawSubmitButton",m=document.getElementById(d);m&&!m.disabled&&(r.preventDefault(),m.click())}};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[R]);const wd=a=>{ah((i=>{const l=String(i.description||""),d=String(i.title||""),m=l.includes("تحويل مكنه")||l.includes("تحويل مكينه")||l.includes("machine transfer")||d.includes("تحويل مكنه")||d.includes("تحويل مكينه"),h=String((i==null?void 0:i.provider)||"").toLowerCase(),g=h.includes("vodafone")?"vf-cash":h.includes("instapay")?"instapay":"",v=i.type==="send"?"تحويل":"سحب";let y=i.type==="withdraw"&&g?`${v} ${g}`:v;return m?y="تحويل مكينه":i.title&&(y=i.title),{id:i.id,type:m||i.type==="send"||i.type==="transfer"?"transfer":"withdraw",sender_msisdn:i.senderPhone,receiver_msisdn:i.receiverPhone,amount:i.amount,commission:i.commission||0,fee:(i==null?void 0:i.fee)??0,status:i.status==="failed"?"failed":i.status==="completed"?"completed":"pending",createdAt:new Date(i.createdAt).toISOString(),updatedAt:new Date(i.createdAt).toISOString(),shopName:C??(n==null?void 0:n.shopName)??(t==null?void 0:t.displayName)??"المحل",cashierName:(i==null?void 0:i.cashierName)??null,commissionMode:(i==null?void 0:i.commissionMode)??(i.type==="send"||$e?"add":"deduct"),totalCharged:(i==null?void 0:i.totalCharged)??(i.type==="send"?Number(i.amount||0)+Number(i.commission||0)+Number((i==null?void 0:i.fee)||0):$e?Number(i.amount||0)+Number(i.commission||0):Number(i.amount||0)),note:(i==null?void 0:i.note)??(i==null?void 0:i.notes)??void 0,senderName:(i==null?void 0:i.senderName)??void 0,provider:(i==null?void 0:i.provider)??void 0,title:y,description:(i==null?void 0:i.description)??void 0}})(a)),pn(!0)},T0=async a=>{var d;if(!(t!=null&&t.uid)){p({title:"خطأ في المصادقة",description:"يجب تسجيل الدخول أولاً لحذف المعاملات",variant:"destructive"});return}const r=ie.find(m=>m.id===a);if(!r){p({title:"خطأ في الحذف",description:"لم يتم العثور على المعاملة المطلوب حذفها",variant:"destructive"});return}const i=String(a),l=String((r==null?void 0:r.transactionId)||(r==null?void 0:r.reference)||"");ha.current.add(i),l&&ha.current.add(l);try{console.log("🗑️ بدء عملية حذف المعاملة:",a),console.log("🔄 حذف المعاملة نهائياً من Firebase...",{transactionId:r.id,userId:t.uid,transactionData:r}),await se.removeUserTransaction(t.uid,r.id),console.log("✅ تم حذف المعاملة نهائياً من Firebase userTransactions");try{await $r.saveDeletedTransaction({...r,userId:t.uid,originalTransactionId:r.id,transactionId:r.transactionId||r.id,reference:r.reference||r.transactionReference||((d=r.receipt)==null?void 0:d.reference),deletedAt:new Date().toISOString(),permanent:!0}),console.log("✅ تم حفظ المعاملة في سجل المحذوفات مع تاريخ الحذف")}catch(g){console.warn("⚠️ فشل في حفظ المعاملة في سجل المحذوفات، لكن الحذف من Firebase نجح:",g)}try{await $r.permanentlyDeleteTransaction(r.id,t.uid)}catch(g){console.warn("⚠️ فشل وسم الحذف النهائي أو التنظيف الإضافي:",g)}const m=[...mr,r],h=ie.filter(g=>g.id!==a);hr(m),Vt(h),lc(!1),console.log("✅ تم تحديث الحالة بعد الحذف من Firebase (بدون نسخ محلية)");try{const g=r.fromWallet;if(g){const{walletDailyLimitsService:v}=await X(async()=>{const{walletDailyLimitsService:x}=await import("./index-mBSeGJ8K.js").then(w=>w.cJ);return{walletDailyLimitsService:x}},__vite__mapDeps([0,1]),import.meta.url),y=await v.getWalletLimits(g);if(y){const x=r.type==="send",w={updatedAt:(await X(async()=>{const{serverTimestamp:_}=await import("./index-mBSeGJ8K.js").then(A=>A.cA);return{serverTimestamp:_}},__vite__mapDeps([0,1]),import.meta.url)).serverTimestamp()};x?(w.dailyTransferUsed=Math.max(0,(y.dailyTransferUsed||0)-r.amount),w.monthlyTransferUsed=Math.max(0,(y.monthlyTransferUsed||0)-r.amount)):(w.dailyWithdrawUsed=Math.max(0,(y.dailyWithdrawUsed||0)-r.amount),w.monthlyWithdrawUsed=Math.max(0,(y.monthlyWithdrawUsed||0)-r.amount));const{doc:k,setDoc:S}=await X(async()=>{const{doc:_,setDoc:A}=await import("./index-mBSeGJ8K.js").then(B=>B.cA);return{doc:_,setDoc:A}},__vite__mapDeps([0,1]),import.meta.url),{db:T}=await X(async()=>{const{db:_}=await import("./index-mBSeGJ8K.js").then(A=>A.cB);return{db:_}},__vite__mapDeps([0,1]),import.meta.url),O=k(T,"walletLimits",g);await S(O,w,{merge:!0})}}}catch(g){console.warn("فشل استرجاع حدود المحفظة بعد الحذف:",g)}try{const{ProfitService:g}=await X(async()=>{const{ProfitService:k}=await import("./profitService-B3iovAHD.js");return{ProfitService:k}},__vite__mapDeps([47,0,1]),import.meta.url),{ReportsService:v}=await X(async()=>{const{ReportsService:k}=await import("./index-mBSeGJ8K.js").then(S=>S.cI);return{ReportsService:k}},__vite__mapDeps([0,1]),import.meta.url),x={txnType:r.type==="send"?"send":"receive",amount:r.amount,commission:r.commission||0,createdAt:r.createdAt,status:"confirmed"},w=g.calculateProfitFromTransaction(x);w>0&&g.addProfit(-w,t.uid);try{v.removeTransactionEffects(r,t.uid)}catch{}}catch(g){console.warn("فشل تحديث الأرباح/التقارير بعد الحذف:",g)}p({title:"تم حذف المعاملة نهائياً",description:"تم حذف المعاملة نهائياً من النظام. يمكنك العثور عليها في قائمة المحذوفات"})}catch(m){console.error("❌ خطأ في حذف المعاملة من Firebase:",m);let h="فشل في حذف المعاملة من الخادم. يرجى المحاولة مرة أخرى";m instanceof Error&&(m.message.includes("network")||m.message.includes("offline")?h="مشكلة في الاتصال بالإنترنت. تحقق من الاتصال وحاول مرة أخرى":m.message.includes("permission")||m.message.includes("unauthorized")?h="ليس لديك صلاحية لحذف هذه المعاملة":m.message.includes("not-found")&&(h="المعاملة غير موجودة أو تم حذفها مسبقاً")),p({title:"خطأ في الحذف",description:h,variant:"destructive"})}},Pr=a=>{const r=(a.type||"").toLowerCase(),i=(a.txnType||"").toLowerCase();return r==="withdraw"||r==="withdrawal"||r==="receive"||i==="receive"},Or=a=>{const r=(a.type||"").toLowerCase(),i=(a.txnType||"").toLowerCase();return r==="send"||r==="transfer"||i==="send"},Nd=a=>a.title==="إيصال سحب فوري",jd=(a,r)=>{const i=new Date().toDateString();let l=ie.filter(y=>{const x=new Date(y.createdAt).toDateString()===i,w=String(y.status||"").toLowerCase();return x&&(w==="completed"||w==="confirmed"||w==="pending")});fa&&fa.trim()!==""&&(l=l.filter(y=>y.senderPhone&&y.senderPhone.includes(fa)||y.receiverPhone&&y.receiverPhone.includes(fa)));const d=St.filterVisibleTransactions(l,"daily",t==null?void 0:t.uid),m=d.length,h=d.reduce((y,x)=>y+x.amount,0),g=d.filter(Pr).reduce((y,x)=>{const w=x.withdrawnAmount!==void 0?x.withdrawnAmount:x.amount;return y+w},0),v=d.filter(y=>Or(y)&&!Nd(y)).reduce((y,x)=>{const w=x.sentAmount!==void 0?x.sentAmount:x.amount;return y+w},0);return{totalTransactions:m,totalAmount:h,totalWithdrawn:g,totalSent:v}},A0=a=>{const r=new Date().getMonth(),i=new Date().getFullYear();let l=ie.filter(y=>{const x=new Date(y.createdAt);return x.getMonth()===r&&x.getFullYear()===i&&y.status==="completed"});fa&&fa.trim()!==""&&(l=l.filter(y=>y.senderPhone&&y.senderPhone.includes(fa)||y.receiverPhone&&y.receiverPhone.includes(fa)));const d=St.filterVisibleTransactions(l,"monthly",t==null?void 0:t.uid),m=d.length,h=d.reduce((y,x)=>y+x.amount,0),g=d.filter(Pr).reduce((y,x)=>{const w=x.withdrawnAmount!==void 0?x.withdrawnAmount:x.amount;return y+w},0),v=d.filter(y=>Or(y)&&!Nd(y)).reduce((y,x)=>{const w=x.sentAmount!==void 0?x.sentAmount:x.amount;return y+w},0);return{totalTransactions:m,totalAmount:h,totalWithdrawn:g,totalSent:v}},P0=a=>{const r=new Date().getMonth(),i=new Date().getFullYear(),l=ie.filter(h=>{const g=new Date(h.createdAt);return g.getMonth()===r&&g.getFullYear()===i&&h.status==="completed"&&h.fromWallet===a}),d=l.filter(Pr).reduce((h,g)=>{const v=g.withdrawnAmount||g.amount;return h+v},0),m=l.filter(Or).reduce((h,g)=>{const v=g.sentAmount||g.amount;return h+v},0);return{totalWithdrawn:d,totalTransferred:m}},O0=a=>{const r=new Date,i=r.getDate(),l=r.getMonth(),d=r.getFullYear(),m=ie.filter(v=>{const y=new Date(v.createdAt);return y.getDate()===i&&y.getMonth()===l&&y.getFullYear()===d&&v.status==="completed"&&v.fromWallet===a}),h=m.filter(Pr).reduce((v,y)=>{const x=y.withdrawnAmount||y.amount;return v+x},0),g=m.filter(Or).reduce((v,y)=>{const x=y.sentAmount||y.amount;return v+x},0);return{totalWithdrawn:h,totalTransferred:g}},Ts=G.useMemo(()=>A0(),[ie,E,fa]),Hn=G.useMemo(()=>jd(),[ie,E,fa,t==null?void 0:t.uid]);Ts.totalWithdrawn,Ts.totalSent;const ka=G.useMemo(()=>P0(E),[ie,E]),E0=G.useMemo(()=>O0(E),[ie,E]),As=G.useMemo(()=>{try{return JSON.parse(localStorage.getItem(rd())||"[]")}catch{return[]}},[t==null?void 0:t.uid]);u.useEffect(()=>{try{if(!E||F.length===0)return;const a=F.find(S=>S.id===E);if(!a)return;const r=(he==null?void 0:he.monthlyWithdrawLimit)??(a==null?void 0:a.monthlyWithdrawalLimit)??2e5,i=(he==null?void 0:he.monthlyTransferLimit)??(a==null?void 0:a.monthlyTransferLimit)??2e5,l=parseFloat(ot||"0")||0,d=(ka==null?void 0:ka.totalWithdrawn)??(he==null?void 0:he.monthlyWithdrawUsed)??0,m=(ka==null?void 0:ka.totalTransferred)??(he==null?void 0:he.monthlyTransferUsed)??0,h=d+(R==="withdraw"?l:0),g=m+(R==="transfer"?l:0),v=.85,y=Math.floor(Math.max(r,1)*v),x=Math.floor(Math.max(i,1)*v),w=(()=>{const S=new Date;return`${S.getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}`})(),k=`monthlyLimitWarnShown:${E}:${w}`;if(h>=y){const S=`${k}:withdraw`;if(!(localStorage.getItem(S)==="true")){sc({type:"withdraw",used:h,limit:r,walletName:a.name}),ac(!0);try{localStorage.setItem(S,"true")}catch{}return}}if(g>=x){const S=`${k}:transfer`;if(!(localStorage.getItem(S)==="true")){sc({type:"transfer",used:g,limit:i,walletName:a.name}),ac(!0);try{localStorage.setItem(S,"true")}catch{}return}}}catch{}},[E,F,he,ka,R,ot]);const Sd=async(a,r=!1)=>{var d,m,h,g;if(Ne.current)return;const i=R==="withdraw"&&(r||sa||!$e);Ne.current=!0,de(!0);const l=()=>{R==="transfer"?Ss(!1):fr(!1),Ne.current=!1,de(!1)};try{if(tb(),console.log("🔄 بدء عملية التحويل/السحب"),console.log("📊 البيانات المدخلة:",{senderPhone:Ut,receiverPhone:pt,amount:ot,transactionType:R}),(()=>{R==="transfer"?Ss(!0):fr(!0)})(),!Ut||!ot){console.log("❌ خطأ: بيانات ناقصة"),p({title:"خطأ في البيانات",description:"يرجى ملء جميع الحقول المطلوبة",variant:"destructive"}),l();return}if(R==="transfer"&&!pt&&!o){console.log("❌ خطأ: رقم المستقبل مفقود"),p({title:"خطأ في البيانات",description:"يرجى إدخال رقم المستقبل",variant:"destructive"}),l();return}if(R==="transfer"&&!o){const U=String(pt||"").replace(/[^0-9٠-٩]/g,"");if(!/[^0-9٠-٩\s]/.test(String(pt||""))&&!ab(pt)){p({title:"رقم المستقبل غير صالح",description:"اكتب رقم صحيح مكون من 11 رقم ويبدأ بـ 015 أو 010 أو 012 أو 011",variant:"destructive"}),l();return}}const y=parseFloat(ot);if(console.log("💰 المبلغ المحول:",y),y<=0){console.log("❌ خطأ: مبلغ غير صحيح"),p({title:"خطأ في المبلغ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"}),l();return}if(we)try{const U=new Date,ne=U.getFullYear(),Ae=String(U.getMonth()+1).padStart(2,"0"),qe=String(U.getDate()).padStart(2,"0"),ht=`zeroPlanDailyConfirmCount:${(t==null?void 0:t.uid)||"default"}:${ne}-${Ae}-${qe}`,Tt=localStorage.getItem(ht);if((Tt&&parseInt(Tt,10)||0)>=10){p({title:"حد التأكيد اليومي",description:"باقة زيرو تسمح بـ 10 تأكيدات تحويل/سحب يومياً فقط.",variant:"destructive"}),l();return}}catch(U){console.warn("فشل قراءة عداد تأكيدات باقة زيرو من التخزين المحلي:",U)}const x=F.find(U=>U.id===E);if(!x){p({title:"خطأ في المحفظة",description:"يرجى اختيار محفظة صحيحة",variant:"destructive"}),l();return}const w=ka;if(console.log("📈 فحص الحدود الشهرية للمحفظة المختارة"),console.log("📊 الإحصائيات الشهرية للمحفظة:",{walletId:E,walletName:x.name,currentWithdrawn:w.totalWithdrawn,currentTransferred:w.totalTransferred,withdrawalLimit:x.monthlyWithdrawalLimit,transferLimit:x.monthlyTransferLimit}),R==="withdraw"){if(console.log("🏧 فحص حد السحب الشهري للمحفظة"),console.log(`💸 المسحوب حالياً من المحفظة: ${w.totalWithdrawn}, المبلغ الجديد: ${y}, الحد الأقصى: ${x.monthlyWithdrawalLimit}`),w.totalWithdrawn+y>x.monthlyWithdrawalLimit){console.log("❌ تجاوز حد السحب الشهري للمحفظة"),p({title:"تجاوز حد السحب الشهري",description:`لا يمكن سحب أكثر من ${x.monthlyWithdrawalLimit} جنيه شهرياً من محفظة ${x.name}`,variant:"destructive"}),l();return}}else if(console.log("💸 فحص حد التحويل الشهري للمحفظة"),console.log(`📤 المحول حالياً من المحفظة: ${w.totalTransferred}, المبلغ الجديد: ${y}, الحد الأقصى: ${x.monthlyTransferLimit}`),w.totalTransferred+y>x.monthlyTransferLimit){console.log("❌ تجاوز حد التحويل الشهري للمحفظة"),p({title:"تجاوز حد التحويل الشهري",description:`لا يمكن تحويل أكثر من ${x.monthlyTransferLimit} جنيه شهرياً من محفظة ${x.name}`,variant:"destructive"}),l();return}const k=(n==null?void 0:n.shopName)||(t==null?void 0:t.displayName)||"محل كاشي لينك",S={id:Date.now().toString(),type:R==="transfer"?"send":R==="deposit"?"deposit":"withdraw",senderPhone:Ut,receiverPhone:R==="transfer"?pt:Ut,amount:y,status:"completed",createdAt:new Date,withdrawnAmount:R==="withdraw"?y:void 0,sentAmount:R==="transfer"?y:void 0,depositedAmount:void 0,fromWallet:E,senderNumber:Ut,senderName:R==="withdraw"&&or.trim()!==""?or.trim():void 0,shopName:(x==null?void 0:x.name)||"المحفظة الرئيسية",transferredAmount:R==="transfer"?y:void 0,receiverNumber:R==="transfer"?pt:void 0,withdrawnAmountDetailed:R==="withdraw"?y:void 0,depositedAmountDetailed:void 0,merchantShopName:k,transactionReference:`TXN-${Date.now()}`,commission:0,notes:R==="transfer"?void 0:Ka&&Ka.trim()!==""?Ka.trim():void 0};N&&(j!=null&&j.name||j!=null&&j.username)&&(S.cashierName=(j==null?void 0:j.name)||(j==null?void 0:j.username));const T=qs.validateTransaction(y,R,We,ve);if(!T.isValid){p({title:"خطأ في العملية",description:T.error,variant:"destructive"}),l();return}T.warning&&p({title:"تحذير",description:T.warning,variant:"destructive"});let O;if(R==="transfer")if((x==null?void 0:x.defaultTransferCommission)!=null){const U=Number(x.defaultTransferCommission)||0;O=Math.round(U*y/1e3*100)/100}else xt&&xt.trim()!==""?O=Math.max(0,parseFloat(xt)):O=0;else if((x==null?void 0:x.defaultWithdrawCommission)!=null){const U=Number(x.defaultWithdrawCommission)||0;O=Math.round(U*y/1e3*100)/100}else st&&st.trim()!==""?O=Math.max(0,parseFloat(st)):O=Math.round(y*.01*100)/100;if(S.commission=O,R!=="transfer"&&!$e&&O>=y){p({title:"خطأ في العمولة",description:"العمولة أكبر من أو تساوي المبلغ المدخل",variant:"destructive"}),l();return}const _=R==="transfer"?y:i?Math.round((y-O)*100)/100:y;R==="withdraw"&&gc(i?`سلم للعميل: ${_} جنيه`:null),S.amount=i?y:_,S.withdrawnAmount=R==="withdraw"?i?y:_:void 0,S.sentAmount=R==="transfer"?_:void 0,S.transferredAmount=R==="transfer"?_:void 0,S.withdrawnAmountDetailed=R==="withdraw"?i?y:_:void 0;let A;const B=R==="transfer"&&!!aa,z=R==="withdraw"&&!!aa,re=B||z;let tt=null;const yt=lr(Ut||"").replace(/\D/g,""),dt=lr(pt||"").replace(/\D/g,""),je=R==="transfer"&&(yt.startsWith("010")&&(dt.startsWith("011")||dt.startsWith("012")||dt.startsWith("015"))||yt.startsWith("012")&&dt.startsWith("010")||yt.startsWith("011")&&dt.startsWith("010")||yt.startsWith("015")&&dt.startsWith("010")),ce=Math.max(0,parseFloat(tc||"0")),nt=Math.round(O*100)/100;if(S.commission=nt,S.fee=ce,S.totalCharged=R==="transfer"?Number(_)+Number(nt)+Number(ce):$e?Number(_)+Number(nt):Number(y),Oi&&je&&!re&&ce<=0){p({title:"خطأ",description:"أدخل رسوم التحويل لعمليات 010 → 011/012/015 أو 012 → 010 أو 011 → 010 أو 015 → 010",variant:"destructive"}),l();return}if(R==="transfer"&&!re){const U=Number(ve[E]||0),ne=Number(_)+Number(ce);if(U<ne){p({title:"رصيد المحفظة غير كافٍ",description:`الرصيد الحالي ${U} لا يكفي لخصم ${ne}`,variant:"destructive"}),l();return}}if(re)if(B){const U=qs.validateTransaction(_,"transfer",We,ve);if(!U.isValid)A={success:!1,newCashBalance:We,newWalletBalances:ve,message:U.error||"رصيد غير كافٍ للتحويل المؤجل",error:"INSUFFICIENT_WALLET_BALANCE"};else{const ne=E||((d=F.find(Se=>Se.isDefault))==null?void 0:d.id)||((m=F[0])==null?void 0:m.id),Ae=he??await is.getWalletLimits(ne),qe=new Date().toDateString(),ht=ie.filter(Se=>Se.type==="send"&&String(Se.status||"").toLowerCase()==="pending"&&Se.fromWallet===ne&&new Date(Se.createdAt).toDateString()===qe).reduce((Se,Nt)=>Se+Number(Nt.sentAmount??Nt.transferredAmount??Nt.amount??0),0),Tt=Number((Ae==null?void 0:Ae.dailyTransferLimit)??6e4),Kt=Number((Ae==null?void 0:Ae.dailyTransferUsed)??0);if(Kt+ht+Number(_)>Tt){p({title:"تجاوز الحد اليومي للتحويل",description:`المتبقي اليوم: ${(Tt-Kt-ht).toLocaleString()} ج.م`,variant:"destructive"}),l();return}const Ke=new Date,vt=ie.filter(Se=>Se.type==="send"&&String(Se.status||"").toLowerCase()==="pending"&&Se.fromWallet===ne&&new Date(Se.createdAt).getMonth()===Ke.getMonth()&&new Date(Se.createdAt).getFullYear()===Ke.getFullYear()).reduce((Se,Nt)=>Se+Number(Nt.sentAmount??Nt.transferredAmount??Nt.amount??0),0),At=Number((Ae==null?void 0:Ae.monthlyTransferLimit)??2e5),Os=Number((Ae==null?void 0:Ae.monthlyTransferUsed)??0);if(Os+vt+Number(_)>At){p({title:"تجاوز الحد الشهري للتحويل",description:`المتبقي هذا الشهر: ${(At-Os-vt).toLocaleString()} ج.م`,variant:"destructive"}),l();return}A={success:!0,newCashBalance:We,newWalletBalances:ve}}}else{const U=E||((h=F.find(Se=>Se.isDefault))==null?void 0:h.id)||((g=F[0])==null?void 0:g.id),ne=he??await is.getWalletLimits(U),Ae=new Date().toDateString(),qe=ie.filter(Se=>Se.type==="withdraw"&&String(Se.status||"").toLowerCase()==="pending"&&Se.fromWallet===U&&new Date(Se.createdAt).toDateString()===Ae).reduce((Se,Nt)=>Se+Number(Nt.withdrawnAmount??Nt.amount??0),0),ht=Number((ne==null?void 0:ne.dailyWithdrawLimit)??1e5),Tt=Number((ne==null?void 0:ne.dailyWithdrawUsed)??0);if(Tt+qe+Number(_)>ht){p({title:"تجاوز الحد اليومي للسحب",description:`المتبقي اليوم: ${(ht-Tt-qe).toLocaleString()} ج.م`,variant:"destructive"}),l();return}const Kt=new Date,Ke=ie.filter(Se=>Se.type==="withdraw"&&String(Se.status||"").toLowerCase()==="pending"&&Se.fromWallet===U&&new Date(Se.createdAt).getMonth()===Kt.getMonth()&&new Date(Se.createdAt).getFullYear()===Kt.getFullYear()).reduce((Se,Nt)=>Se+Number(Nt.withdrawnAmount??Nt.amount??0),0),vt=Number((ne==null?void 0:ne.monthlyWithdrawLimit)??2e5),At=Number((ne==null?void 0:ne.monthlyWithdrawUsed)??0);if(At+Ke+Number(_)>vt){p({title:"تجاوز الحد الشهري للسحب",description:`المتبقي هذا الشهر: ${(vt-At-Ke).toLocaleString()} ج.م`,variant:"destructive"}),l();return}A={success:!0,newCashBalance:Math.round((Number(We)-Number(_))*100)/100,newWalletBalances:ve}}else R==="transfer"?A=await qs.processTransfer({amount:_,currentCashBalance:We,currentWalletBalances:ve,wallets:F,selectedWalletId:E,skipRemoteLimitsCheck:!1,nonBlockingUsageUpdate:!0}):A=await qs.processWithdraw({amount:_,currentCashBalance:We,currentWalletBalances:ve,wallets:F,selectedWalletId:E,skipRemoteLimitsCheck:!1,nonBlockingUsageUpdate:!0});if(!A.success){p({title:"فشل في العملية",description:A.error||A.message,variant:"destructive"}),l();return}let ut=re?z?A.newCashBalance:We:A.newCashBalance,mt=re?ve:A.newWalletBalances;if(!re&&i&&R==="withdraw"){const U=E,ne=Number(mt[U]||0);mt={...mt,[U]:Math.round((ne+O)*100)/100}}if(!re&&R==="transfer"&&ce>0){const U=Number(mt[E]||0);mt={...mt,[E]:Math.round((U-Number(ce))*100)/100}}if(re&&B){const U=F.find(qe=>qe.id===E)??F.find(qe=>qe.isDefault)??F[0],ne=(U==null?void 0:U.id)||E;if(ne!==E)try{Ar(ne)}catch{}const Ae=Number(ve[ne]||0);mt={...ve,[ne]:Math.round((Ae-Number(_)-Number(ce))*100)/100}}if((B||z)&&aa&&!Tm){const U={id:`DEBT-${Date.now()}`,debtorName:aa.debtorName,amount:aa.amount,reason:aa.notes||"",customerId:aa.customerId,mobile:aa.mobile,status:"pending",createdAt:new Date};tt=U.id,S.linkedDebtId=tt;const ne=[U,...Ie];Mt(ne);try{if(await Da(ne),t!=null&&t.uid){const Ae=Te(V,"debts",U.id),qe={...U,userId:t.uid,shopId:D||(n==null?void 0:n.shopId)||null,lastUpdated:new Date().toISOString()};Object.keys(qe).forEach(ht=>qe[ht]===void 0&&delete qe[ht]),await Ht(Ae,qe,{merge:!0})}}catch(Ae){console.error("⚠️ فشل حفظ الدين المؤجل محلياً أو سحابياً:",Ae)}p({title:"تم إضافة الدين",description:"أضيف إلى إيصالات الديون حتى يتم السداد",variant:"default"})}if(!re&&!i){const U=Math.max(0,Number(O))+Math.max(0,Number(ce));U>0&&(ut=Math.round((ut+U)*100)/100,console.log(`💰 تم إضافة عمولة/رسوم ${U} جنيه لدرج النقدية`))}console.log("⚡ تحديث الواجهة فوراً بدون حجب باستخدام startTransition...");const bt="temp_"+Date.now()+"_"+Math.random().toString(36).substring(7),ia={reference:bt,shopId:D||(n==null?void 0:n.shopId)||(t==null?void 0:t.uid)||"default-shop",lineId:E||"default-line",walletId:E||void 0,merchantUserId:(t==null?void 0:t.uid)||null,provider:"vodafone_cash",txnType:R==="transfer"?"send":"receive",originType:R==="transfer"?"transfer":"withdraw",amount:i?y:_,commission:nt,fee:ce,profit:0,senderMsisdn:Ut,receiverMsisdn:R==="transfer"?pt:Ut,note:R==="transfer"?void 0:Ka&&Ka.trim()!==""?Ka.trim():void 0,status:re?"pending":"confirmed",linkedDebtId:tt||void 0,createdBy:(t==null?void 0:t.uid)||null,walletEffectAppliedOnCreation:!1,cashEffectAppliedOnCreation:!!(re&&z),limitsReservedOnCreation:!!re,limitReservedType:R==="transfer"?"transfer":"withdraw",profitAddedOnCreation:!1},Ps={...ia,id:bt,status:re?"pending":"completed",commissionMode:R==="transfer"||$e?"add":"deduct",totalCharged:R==="transfer"?_+nt+ce:$e?_+O:y,walletEffectAppliedOnCreation:!1,cashEffectAppliedOnCreation:!!(re&&z),limitsReservedOnCreation:!!re,limitReservedType:R==="transfer"?"transfer":"withdraw",sentAmount:R==="transfer"?_:void 0,transferredAmount:R==="transfer"?_:void 0,withdrawnAmount:R==="withdraw"?i?y:_:void 0,senderName:R==="withdraw"&&or.trim()!==""?or.trim():void 0,createdAt:new Date,type:R==="transfer"?"send":"withdraw",senderPhone:Ut||"",receiverPhone:pt||""};try{ja.current=[Ps,...ja.current],P.setQueryData(["recentTransactions",t==null?void 0:t.uid,D||"main"],U=>!U||!Array.isArray(U)?[Ps]:[Ps,...U])}catch(U){console.error("Error in optimistic update:",U)}if(E&&he)try{const U=R==="transfer",ne={...he};U?(ne.dailyTransferUsed=(ne.dailyTransferUsed||0)+_,ne.monthlyTransferUsed=(ne.monthlyTransferUsed||0)+_):(ne.dailyWithdrawUsed=(ne.dailyWithdrawUsed||0)+_,ne.monthlyWithdrawUsed=(ne.monthlyWithdrawUsed||0)+_),_s(ne)}catch(U){console.error("Error in optimistic limit update:",U)}const Od=[Ps,...ie];G.startTransition(()=>{Ze(ut),ct(mt),re&&(S.status="pending"),Vt(Od),i&&!re&&p({title:"تم خصم العموله",description:`سلم للعميل: ${_} جنيه`,variant:"default",duration:5e3})});try{setTimeout(()=>{try{localStorage.setItem(Po(),JSON.stringify(Od))}catch{}},0)}catch{}if(we)try{const U=new Date,ne=U.getFullYear(),Ae=String(U.getMonth()+1).padStart(2,"0"),qe=String(U.getDate()).padStart(2,"0"),ht=`zeroPlanDailyConfirmCount:${(t==null?void 0:t.uid)||"default"}:${ne}-${Ae}-${qe}`,Tt=localStorage.getItem(ht),Kt=Tt&&parseInt(Tt,10)||0;localStorage.setItem(ht,String(Kt+1))}catch{}setTimeout(()=>{try{const U=new Date().toISOString();localStorage.setItem(Ve(),ut.toString()),localStorage.setItem(Ve()+"_lastUpdated",U),localStorage.setItem(et(),JSON.stringify(mt)),localStorage.setItem(et()+"_lastUpdated",U)}catch{}},0);try{if(t!=null&&t.uid){const U=F.find(Es=>Es.id===E)??F.find(Es=>Es.isDefault)??F[0],ne=(U==null?void 0:U.id)||E,Ae=Number(mt[ne]||0),qe=String((U==null?void 0:U.phone)||Ut||"").trim(),ht=String(pt||"").trim(),Tt=Number(ce)>0,Kt=R==="transfer"?"🟢":"🔴",Ke=Number(nt)>0?`${Number(nt)} جنيه`:"0 جنيه",vt=Tt?` و رسوم ${Number(ce)} جنيه`:"",At=R==="transfer"?`${Kt} تم تحويل مبلغ ${Number(_)} جنيه من رقم المحفظة ${qe} إلى رقم المحفظة ${ht} وتم أخذ عمولة ${Ke}${vt}. الرصيد المتبقي في المحفظة: ${Ae} جنيه. الفلوس النقدية المتبقية: ${Number(ut)} جنيه.`:`${Kt} تم السحب مبلغ ${Number(_)} جنيه من الدرج إلى رقم المحفظة ${qe} وتم أخذ عمولة ${Ke}${vt}. الرصيد المتبقي في المحفظة: ${Ae} جنيه. الفلوس النقدية المتبقية: ${Number(ut)} جنيه.`,Os=t!=null&&t.uid?`tg_last_msg_${t.uid}`:"tg_last_msg",Se=Date.now();let Nt=!0;try{const Es=localStorage.getItem(Os);if(Es){const Ms=JSON.parse(Es),V0=String((Ms==null?void 0:Ms.text)||""),q0=Number((Ms==null?void 0:Ms.at)||0);V0===At&&Se-q0<5e3&&(Nt=!1)}}catch{}if(Nt){Promise.resolve(as.send(t.uid,At)).catch(()=>{});try{localStorage.setItem(Os,JSON.stringify({text:At,at:Se}))}catch{}}}}catch{}if((async()=>{try{console.log("🔄 بدء حفظ المعاملة في Firebase في الخلفية...");const U={...ia},ne={...Ps},{ProfitService:Ae}=await X(async()=>{const{ProfitService:Ke}=await import("./profitService-B3iovAHD.js");return{ProfitService:Ke}},__vite__mapDeps([47,0,1]),import.meta.url),qe=Ae.calculateProfitFromTransaction({...ne,status:"confirmed"});qe>0&&(Ae.addProfit(qe,t==null?void 0:t.uid),U.profitAddedOnCreation=!0,ne.profitAddedOnCreation=!0,console.log("✅ تم إضافة الربح:",qe,"جنيه"));const ht=await Tf.create(U);if(E)try{const Ke=await is.updateUsage(E,_,R==="transfer"?"transfer":"withdraw");Ke&&_s(Ke);try{window.dispatchEvent(new CustomEvent("walletLimitsUpdated",{detail:{walletId:E}}))}catch{}}catch{}await Promise.all([...t!=null&&t.uid?[se.updateUserData(t.uid,{cashBalance:ut,walletBalances:mt,lastUpdated:new Date().toISOString()})]:[],...t!=null&&t.uid?[se.saveUserTransaction(t.uid,{...ne,transactionId:ht,transactionType:R,fromWallet:E,toWallet:R==="transfer"?B?null:"cash":null,cashierName:N&&((j==null?void 0:j.name)||(j==null?void 0:j.username))||"الحساب الرئيسي",linkedDebtId:tt||void 0,description:`${R==="transfer"?"تحويل":"سحب"} ${_} من ${E} ${R==="transfer"?B?"":"إلى الدرج النقدي":""} — عمولة: ${O} (${R==="transfer"||$e?"مضافة":"مخصومة"})${ce>0?` — رسوم: ${ce}`:""}${re?" — دين مؤجل (قيد المراجعة)":""}`})]:[]]),console.log("✅ تم حفظ جميع البيانات في Firebase بنجاح");try{const Ke={...Ps,id:ht};ja.current=ja.current.map(vt=>vt.id===bt?Ke:vt),P.setQueryData(["recentTransactions",t==null?void 0:t.uid,D||"main"],vt=>!vt||!Array.isArray(vt)?[Ke]:vt.map(At=>At.id===bt?Ke:At)),G.startTransition(()=>{Vt(vt=>vt.map(At=>At.id===bt?Ke:At))})}catch(Ke){console.error("Error updating query cache with real ID:",Ke)}setTimeout(()=>{try{console.log("🔄 تنفيذ التحديث المؤجل (10 ثواني) لضمان تطابق البيانات..."),P.invalidateQueries({queryKey:["recentTransactions",t==null?void 0:t.uid,D||"main"]}),P.invalidateQueries({queryKey:["dashboardData",D||(n==null?void 0:n.shopId)]}),E&&(P.invalidateQueries({queryKey:["walletLimits",E]}),Uo())}catch(Ke){console.error("Error in delayed refresh:",Ke)}},1e4);const Tt=`userData_${t==null?void 0:t.uid}`,Kt={cashBalance:ut,walletBalances:mt,lastUpdated:new Date().toISOString()};localStorage.setItem(Tt,JSON.stringify(Kt))}catch(U){console.error("❌ خطأ في حفظ المعاملة في Firebase (في الخلفية):",U);try{t!=null&&t.uid&&se.saveLocalReceipt(t.uid,{...transactionDataForUser,transactionType:R,fromWallet:E,toWallet:R==="transfer"?B?null:"cash":null,cashierName:N&&((j==null?void 0:j.name)||(j==null?void 0:j.username))||"الحساب الرئيسي",linkedDebtId:tt||void 0,description:`${R==="transfer"?"تحويل":"سحب"} ${_} من ${E} ${R==="transfer"?B?"":"إلى الدرج النقدي":""} — عمولة: ${O} (${R==="transfer"||$e?"مضافة":"مخصومة"})${ce>0?` — رسوم: ${ce}`:""}${re?" — دين مؤجل (قيد المراجعة)":""}`})}catch{}p({title:"تحذير",description:"تم تنفيذ العملية محلياً، لكن فشلت المزامنة مع الخادم. ستتم المحاولة مرة أخرى تلقائياً.",variant:"destructive"})}})(),R==="transfer"){Ss(!0);const U=Number(y)+Number(O)+Math.max(0,Number(ce));zi({type:"transfer",amount:Math.max(0,Math.round(U*100)/100)}),uh({receiver:pt,amount:y}),fi(null),ra(!0),setTimeout(()=>{Ss(!1)},2e3)}else fr(!0),zi({type:"withdraw",amount:_,isDeduct:i}),ra(!0),setTimeout(()=>{fr(!1)},2e3);ir(""),vs(""),qi(!1),Jl(""),Hl(""),Ii(null),ki(""),Ja(""),Gl(""),Xl(!1),setTimeout(()=>{Ne.current=!1,de(!1)},1500)}catch(v){console.error("CRITICAL ERROR IN TRANSACTION:",v),p({title:"خطأ غير متوقع",description:"حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.",variant:"destructive"}),l()}},Er=G.useMemo(()=>new Intl.DateTimeFormat("ar-EG"),[]),Dd=G.useMemo(()=>new Intl.DateTimeFormat("ar-EG",{hour:"2-digit",minute:"2-digit"}),[]),M0=G.useMemo(()=>{try{return Ie.reduce((a,r)=>{if(r.type==="debtor")return a;const i=Number(r.paidAmount||0),l=Math.max(0,Number(r.amount||0)-i);return a+l},0)}catch{return 0}},[Ie]),qo=G.useMemo(()=>xd().filter(r=>Na==="all"?!0:Na==="send"?r.type==="send":Na==="receive"?r.type==="receive":Na==="withdraw"?r.type==="withdraw":Na!=="deleted"),[xd,Na]),W0=()=>{if(Bi==="daily"){const a=St.resetReportsManually("daily",ie,t==null?void 0:t.uid);ur(!1),p({title:"تم تصفير المعاملات اليومية",description:`تم إخفاء ${a.length} معاملة من تقارير اليوم (الحدود لم تتأثر)`})}else{const a=St.resetReportsManually("monthly",ie,t==null?void 0:t.uid);ur(!1),p({title:"تم تصفير المعاملات الشهرية",description:`تم إخفاء ${a.length} معاملة من تقارير الشهر (الحدود لم تتأثر)`})}},R0=()=>Bi==="daily"?"تصفير المعاملات اليومية":"تصفير المعاملات الشهرية",L0=()=>Bi==="daily"?"أدخل الرقم السري الرئيسي لتصفير تقارير اليوم عن طريق إخفاء معاملات اليوم من التقارير":"أدخل الرقم السري الرئيسي لتصفير تقارير الشهر عن طريق إخفاء معاملات الشهر من التقارير",F0=a=>{id(a),wo(!0)},B0=a=>{const r=We,i=Number(a)-Number(r);Ze(a);const l=new Date().toISOString();localStorage.setItem(Ve(),a.toString()),localStorage.setItem(Ve()+"_lastUpdated",l),Yc(!1);const d={cashBalance:a,lastUpdated:l},m=`userData_${t==null?void 0:t.uid}`;try{localStorage.setItem(m,JSON.stringify(d))}catch{}const h=[];if(t!=null&&t.uid){h.push(se.updateUserData(t.uid,d).then(()=>{try{localStorage.removeItem(m)}catch{}}).catch(()=>{}));const g=`${i>0?"CASHADD":"CASHDEDUCT"}-${(t==null?void 0:t.uid)||"anon"}-${Date.now()}`,v=i>0?{txnType:"cash_addition",type:"cash_addition",amount:i,status:"confirmed",senderMsisdn:"إضافة نقدية",receiverMsisdn:"",reference:g,title:"إيصال إضافة نقدية",merchantUserId:t.uid,createdBy:t.uid,shopId:(n==null?void 0:n.shopId)||void 0}:i<0?{amount:Math.abs(i),status:"completed",title:"ايصال خصم من الفلوس النقديه",merchantUserId:t.uid,createdBy:t.uid,shopId:(n==null?void 0:n.shopId)||void 0}:null;v&&h.push(se.saveUserTransaction(t.uid,v));const y=n==null?void 0:n.shopId;if(y){const x=Te(V,"dashboardData",y);h.push(Xt(x,{cashBalance:a}))}}Promise.allSettled(h).then(()=>{}).catch(()=>{}),p({title:i>0?"تم إضافة نقدية":i<0?"تم خصم نقدية":"تم تحديث الرصيد النقدي",description:i!==0?`التغيير: ${Math.abs(i)} جنيه، الرصيد الجديد: ${a} جنيه`:`تم تحديث الرصيد النقدي إلى ${a} جنيه`})},$0=async a=>{var h;if(!Wt){console.warn("لا يوجد معرف محفظة محدد لتعديل الرصيد");return}const r={...ve,[Wt]:a};ct(r);const i=new Date().toISOString(),l={walletBalances:r,lastUpdated:i},d=`userData_${t==null?void 0:t.uid}`;try{localStorage.setItem(d,JSON.stringify(l)),localStorage.setItem(et(),JSON.stringify(r)),localStorage.setItem(et()+"_lastUpdated",i),localStorage.setItem(`walletBalances_backup_${i}`,JSON.stringify(r))}catch{}try{t!=null&&t.uid&&await se.updateUserData(t.uid,l)}catch(g){console.error("خطأ أثناء حفظ رصيد المحفظة في Firebase:",g)}Kc(!1);const m=((h=F.find(g=>g.id===Wt))==null?void 0:h.name)||"المحفظة";p({title:"تم تحديث رصيد المحفظة",description:`تم تحديث رصيد ${m} إلى ${a.toLocaleString()} جنيه`})},U0=async a=>{var r;if(console.log("💰 بدء تحديث رصيد المحفظة"),console.log("📊 معرف المحفظة المحررة:",Wt),console.log("💵 المبلغ المضاف/المخصوم:",a),Wt){const i=ve[Wt]||0;console.log("💰 الرصيد الحالي:",i);const l=i+a;console.log("💰 الرصيد الجديد:",l);const d={...ve,[Wt]:l};console.log("📊 الأرصدة المحدثة:",d),ct(d);const m=new Date().toISOString(),h={walletBalances:d,lastUpdated:m},g=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(g,JSON.stringify(h)),localStorage.setItem(et(),JSON.stringify(d)),localStorage.setItem(`walletBalances_backup_${m}`,JSON.stringify(d));try{if(t!=null&&t.uid){console.log("🔄 حفظ البيانات في Firebase...");try{await se.updateUserData(t.uid,h),console.log("✅ تم حفظ الأرصدة في Firebase بنجاح"),setTimeout(()=>{localStorage.removeItem(g),console.log("🧹 تم حذف النسخة المحلية المؤقتة بعد دقيقة واحدة")},6e4)}catch(w){console.error("❌ فشل في حفظ البيانات في Firebase:",w),me(!0)}}else console.log("⚠️ المستخدم غير مسجل دخول، حفظ في localStorage"),localStorage.setItem(et(),JSON.stringify(d));const v=((r=F.find(w=>w.id===Wt))==null?void 0:r.name)||"المحفظة",y=a>0?"إضافة":"خصم",x=Math.abs(a);p({title:`تم ${y} مبلغ ${y==="إضافة"?"إلى":"من"} رصيد المحفظة`,description:`تم ${y} ${x} جنيه ${y==="إضافة"?"إلى":"من"} رصيد ${v}. الرصيد الجديد: ${l.toLocaleString()} جنيه`})}catch(v){if(console.error("❌ فشل في حفظ البيانات في Firebase:",v),localStorage.setItem(et(),JSON.stringify(d)),t!=null&&t.uid){const y=`userData_${t.uid}`,x={walletBalances:d,lastUpdated:new Date().toISOString()};localStorage.setItem(y,JSON.stringify(x)),me(!0)}p({title:"تم حفظ البيانات محلياً",description:"تم حفظ التغييرات محلياً وسيتم مزامنتها مع الخادم لاحقاً",variant:"default"})}}else console.log("❌ لا يوجد معرف محفظة للتحرير");setTimeout(()=>{const l=Object.keys(localStorage).filter(d=>d.startsWith("walletBalances_backup_")).sort();l.length>5&&l.slice(0,l.length-5).forEach(m=>{localStorage.removeItem(m),console.log("🗑️ حذف النسخة الاحتياطية القديمة:",m)})},5e3),wo(!1),id("")};return console.log("🔥 UserDashboardPage - Render conditions:",{isCheckingActivation:gi,isUserActive:Zs,showActivationModal:Sm}),gi?(console.log("🔥 UserDashboardPage - Showing loading screen"),e.jsx(pf,{})):(console.log("🔥 UserDashboardPage - Rendering main dashboard"),e.jsxs("div",{id:"dashboard-content-container",className:"user-dashboard h-[100dvh] overflow-y-auto px-2 sm:px-4 pt-2 sm:py-4 relative bg-gray-100 bg-[radial-gradient(140%_140%_at_10%_10%,#e5e7eb_0%,#d1d5db_45%,#9ca3af_100%)] no-scrollbar",children:[e.jsx(Db,{userId:t==null?void 0:t.uid}),e.jsxs("div",{className:"max-w-screen-2xl mx-auto grid grid-cols-1 xl:grid-cols-3 gap-4 xl:gap-6 relative z-10",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-2 sm:gap-3 fade-in-up",children:[!br&&e.jsxs(Ca,{className:"bg-gray-100 dark:bg-card border border-gray-200 dark:border-gray-800 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 relative overflow-hidden",children:[e.jsx(ss,{className:"pb-2 px-3 pt-3 relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(rs,{className:"text-sm font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 rounded-md bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700",children:e.jsx(Qd,{className:"h-4 w-4 text-gray-700 dark:text-gray-300"})}),e.jsx("span",{className:"text-sm",children:"الشهر"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>{cc("monthly"),ur(!0)},className:"h-8 w-8 p-0 bg-transparent hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 rounded-full transition-colors duration-200",title:"تصفير معاملات الشهر",children:e.jsx(oa,{className:"h-3.5 w-3.5"})}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>Ri(!0),className:"h-8 w-8 p-0 bg-transparent hover:bg-purple-50 dark:hover:bg-purple-900/20 text-purple-600 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300 rounded-full transition-colors duration-200",title:"عرض تقارير يوم/شهر محدد",children:e.jsx(si,{className:"h-3.5 w-3.5"})}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>Ri(!0),className:"h-8 w-8 p-0 bg-transparent hover:bg-blue-50 dark:hover:bg-blue-900/20 text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 rounded-full transition-colors duration-200",title:"تقاريرك",children:e.jsx(Qn,{className:"h-3.5 w-3.5"})}),e.jsx("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 rounded-full border border-green-100 dark:border-green-900/30",children:e.jsx(Rr,{className:"h-3.5 w-3.5 text-green-600 dark:text-green-400"})})]})]})}),!br&&e.jsxs(Ia,{className:"pt-0 px-2 pb-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-0 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-800 divide-x divide-y divide-gray-200 dark:divide-gray-800 bg-white dark:bg-gray-900",children:[e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-blue-600 dark:text-blue-400",children:"عدد المعاملات"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-blue-800 dark:text-blue-300 mt-0.5 sm:mt-0",children:Ts.totalTransactions})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-gray-600 dark:text-gray-400",children:"إجمالي المبالغ"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-gray-900 dark:text-gray-100 mt-0.5 sm:mt-0",children:Ts.totalAmount.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-red-600 dark:text-red-400",children:"المسحوب"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-red-800 dark:text-red-300 mt-0.5 sm:mt-0",children:Ts.totalWithdrawn.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-green-600 dark:text-green-400",children:"المرسل"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-green-800 dark:text-green-300 mt-0.5 sm:mt-0",children:Ts.totalSent.toFixed(2)})]})]}),e.jsxs("div",{className:"mt-2 rounded-lg border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-900 px-2 py-1.5 flex items-center justify-between",children:[e.jsx("span",{className:"text-[12px] font-bold text-yellow-600 dark:text-yellow-400",children:"الأرباح"}),e.jsx(Jy,{userId:t==null?void 0:t.uid,transactions:ie})]})]}),vh&&e.jsx("div",{className:"absolute inset-0 z-20 backdrop-blur-sm bg-amber-50/60 dark:bg-amber-900/10 flex items-center justify-center p-0 pointer-events-auto",children:e.jsxs(I,{size:"sm",variant:"ghost",onClick:async()=>{if(we){p({title:"غير متاح",description:"تقارير الشهر غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"});return}bn(!0)},className:"px-4 py-2 rounded-full bg-white dark:bg-card border border-gray-100 dark:border-gray-800 text-gray-900 dark:text-gray-100 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-800 hover:shadow-md transition-all duration-200 flex items-center gap-2 text-xs font-medium",title:"عرض تقارير الشهر (يتطلب الرقم السري)",children:[e.jsx("span",{children:"عرض تقارير الشهر"}),e.jsx(Ks,{className:"h-3.5 w-3.5 text-gray-600 dark:text-gray-400"})]})})]}),e.jsx(la,{open:Nh,onOpenChange:bn,mode:"verify",title:"الرقم السري لفتح تقارير الشهر",description:"لا يمكن الاطلاع على إحصائيات الشهر إلا بإدخال الرقم السري الرئيسي",onSuccess:()=>{if(we){p({title:"غير متاح",description:"تقارير الشهر غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"}),bn(!1),Hi(!0);return}Hi(!1),bn(!1)},userId:t==null?void 0:t.uid}),(Ct==null?void 0:Ct.planType)!==Zt.TAHWEELA&&e.jsxs(Ca,{className:"bg-gray-50 dark:bg-card border border-gray-200 dark:border-gray-800 rounded-xl shadow-sm hover:shadow-md transition-all duration-200 relative overflow-hidden",children:[e.jsx(ss,{className:"pb-2 px-3 pt-3 relative z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(rs,{className:"text-sm font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx("div",{className:"p-1 rounded-md bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700",children:e.jsx(Qd,{className:"h-4 w-4 text-gray-700 dark:text-gray-300"})}),e.jsx("span",{className:"text-sm",children:"اليوم"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>{cc("daily"),ur(!0)},className:"h-8 w-8 p-0 bg-transparent hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 rounded-full transition-colors duration-200",title:"تصفير معاملات اليوم",children:e.jsx(oa,{className:"h-3.5 w-3.5"})}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>wh(a=>!a),className:"h-8 w-8 p-0 bg-transparent hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 rounded-full transition-colors duration-200",title:br?"توسيع اليوم والشهر":"طي اليوم والشهر",children:br?e.jsx(Bf,{className:"h-3.5 w-3.5"}):e.jsx($f,{className:"h-3.5 w-3.5"})}),e.jsx("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 rounded-full border border-green-100 dark:border-green-900/30",children:e.jsx(Rr,{className:"h-3.5 w-3.5 text-green-600 dark:text-green-400"})})]})]})}),!br&&e.jsxs(Ia,{className:"pt-0 px-2 pb-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-0 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-800 divide-x divide-y divide-gray-200 dark:divide-gray-800 bg-white dark:bg-gray-900",children:[e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-blue-600 dark:text-blue-400",children:"عدد المعاملات"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-blue-800 dark:text-blue-300 mt-0.5 sm:mt-0",children:Hn.totalTransactions})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-gray-600 dark:text-gray-400",children:"إجمالي المبالغ"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-gray-900 dark:text-gray-100 mt-0.5 sm:mt-0",children:Hn.totalAmount.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-red-600 dark:text-red-400",children:"المسحوب"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-red-800 dark:text-red-300 mt-0.5 sm:mt-0",children:Hn.totalWithdrawn.toFixed(2)})]}),e.jsxs("div",{className:"px-2 py-1 flex flex-col sm:flex-row sm:items-center sm:justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("span",{className:"text-[12px] font-bold text-green-600 dark:text-green-400",children:"المرسل"}),e.jsx("span",{className:"text-sm sm:text-lg font-bold text-green-800 dark:text-green-300 mt-0.5 sm:mt-0",children:Hn.totalSent.toFixed(2)})]})]}),e.jsxs("div",{className:"mt-2 rounded-lg border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-900 px-2 py-1.5 flex items-center justify-between",children:[e.jsx("span",{className:"text-[12px] font-bold text-yellow-600 dark:text-yellow-400",children:"الأرباح"}),e.jsx(Gy,{userId:t==null?void 0:t.uid,transactions:ie})]})]}),Ch&&e.jsx("div",{className:"absolute inset-0 z-20 backdrop-blur-sm bg-white/60 dark:bg-black/60 flex items-center justify-center p-0 pointer-events-auto",children:e.jsxs(I,{size:"sm",variant:"ghost",onClick:()=>Gi(!0),className:"px-4 py-2 rounded-full bg-white dark:bg-card border border-gray-100 dark:border-gray-800 text-gray-900 dark:text-gray-100 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-800 hover:shadow-md transition-all duration-200 flex items-center gap-2 text-xs font-medium",title:"عرض تقارير اليوم (يتطلب الرقم السري)",children:[e.jsx("span",{children:"عرض تقارير اليوم"}),e.jsx(Ks,{className:"h-3.5 w-3.5 text-gray-600 dark:text-gray-400"})]})})]}),e.jsx(la,{open:Ih,onOpenChange:Gi,mode:"verify",title:"الرقم السري لفتح تقارير اليوم",description:"لا يمكن الاطلاع على تقارير اليوم إلا بإدخال الرقم السري الرئيسي",onSuccess:()=>{Nc(!1),Gi(!1)},userId:t==null?void 0:t.uid})]}),e.jsxs(Ca,{className:"balance-bar bg-gray-200 border-2 border-gray-200/50 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 group relative overflow-hidden   transform fade-in-up mb-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-500/5 via-blue-500/5 to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),e.jsx("div",{className:"absolute top-0 left-0 w-40 h-40 bg-gradient-to-br from-emerald-300/10 to-transparent rounded-full -translate-y-20 -translate-x-20 group-hover:scale-150 transition-transform duration-200"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-br from-blue-300/10 to-transparent rounded-full translate-y-20 translate-x-20 group-hover:scale-150 transition-transform duration-200"}),e.jsx(Ia,{className:"p-2 relative z-10",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:[e.jsxs("div",{className:"bg-white dark:bg-card border border-gray-200 dark:border-gray-800 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/cash relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-500/10 to-transparent opacity-0 group-hover/cash:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex flex-col relative z-10 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-emerald-100 to-emerald-200 dark:from-emerald-900/30 dark:to-emerald-800/30 rounded-lg shadow-sm",children:e.jsx(Pa,{className:"h-1.5 w-1.5 text-emerald-600 dark:text-emerald-400"})}),e.jsx("span",{className:"text-[11px] font-extrabold text-emerald-800 dark:text-emerald-300",children:"الفلوس النقدية"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors",onClick:()=>Cr(!0),children:e.jsx(jt,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-emerald-600 dark:text-emerald-400 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-colors",onClick:()=>ld(!0),title:"تفاصيل الفلوس النقدية",children:e.jsx(Hd,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",onClick:()=>zn(!0),children:e.jsx(oa,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-0.5",children:e.jsxs("span",{className:"text-[14px] sm:text-xl font-bold text-emerald-800 dark:text-emerald-200 bg-gradient-to-r from-emerald-100 to-emerald-200 dark:from-emerald-900/30 dark:to-emerald-800/30 px-1 py-0.5 rounded-lg shadow-sm block w-fit",children:[We.toLocaleString("en-US")," جنيه"]})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-card border border-gray-200 dark:border-gray-800 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/wallet relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/10 to-transparent opacity-0 group-hover/wallet:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex flex-col relative z-10 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-blue-100 to-blue-200 dark:from-blue-900/30 dark:to-blue-800/30 rounded-lg shadow-sm",children:e.jsx(Bs,{className:"h-1.5 w-1.5 text-blue-600 dark:text-blue-400"})}),e.jsx("span",{className:"text-[11px] font-extrabold text-blue-800 dark:text-blue-300",children:"الأرصدة علي المحافظ"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors",onClick:()=>Bn(!0),title:"إضافة أموال لإجمالي المحفظة",children:e.jsx(jt,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors",onClick:()=>Fi(!0),title:"عرض المحافظ",children:e.jsx(Bs,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",onClick:()=>{Vn(!0),qn("")},title:"تصفير إجمالي المحفظة",children:e.jsx(oa,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-0.5",children:e.jsxs("span",{className:"text-[14px] sm:text-xl font-bold text-blue-800 dark:text-blue-200 bg-gradient-to-r from-blue-100 to-blue-200 dark:from-blue-900/30 dark:to-blue-800/30 px-1 py-0.5 rounded-lg shadow-sm block w-fit",children:[F.reduce((a,r)=>a+(Number(ve[r.id])||0),0).toLocaleString("en-US")," جنيه"]})})]})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1 bg-white dark:bg-card border border-gray-200 dark:border-gray-800 p-1 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 group/selwallet relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-transparent opacity-0 group-hover/selwallet:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"flex flex-col relative z-10 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"p-0.5 bg-gradient-to-r from-indigo-100 to-indigo-200 dark:from-indigo-900/30 dark:to-indigo-800/30 rounded-lg shadow-sm",children:e.jsx(Bs,{className:"h-1.5 w-1.5 text-indigo-600 dark:text-indigo-400"})}),e.jsx("span",{className:"text-[11px] font-extrabold text-indigo-800 dark:text-indigo-300",children:"رصيد المحفظه"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors",onClick:()=>{if(!E){p({title:"اختر محفظة",description:"يرجى اختيار محفظة من اختيار المحافظ بالأعلى أولاً",variant:"destructive"});return}F0(E)},title:"إضافة/خصم إلى رصيد المحفظة المختارة",children:e.jsx(jt,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 rounded-full text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",onClick:()=>{if(!E){p({title:"اختر محفظة",description:"يرجى اختيار محفظة لتصفير رصيدها فقط",variant:"destructive"});return}In(!0)},title:"تصفير رصيد المحفظة المختارة",children:e.jsx(oa,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-0.5",children:e.jsxs("span",{className:"text-[14px] sm:text-xl font-bold text-indigo-800 dark:text-indigo-200 bg-gradient-to-r from-indigo-100 to-indigo-200 dark:from-indigo-900/30 dark:to-indigo-800/30 px-1 py-0.5 rounded-lg shadow-sm block w-fit",children:[(E&&ve[E]||0).toLocaleString("en-US")," جنيه"]})})]})]})]})})]}),e.jsxs(Ca,{className:"bg-gray-100 dark:bg-card border border-gray-200 dark:border-gray-800 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 group relative overflow-hidden fade-in-up",children:[e.jsxs(ss,{className:`pb-2 px-4 pt-4 relative z-10 ${M?"sticky top-0 z-20 bg-white/90 dark:bg-card/90 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:supports-[backdrop-filter]:bg-card/60":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(rs,{className:"text-sm font-bold flex items-center gap-2 text-gray-900 dark:text-gray-100",children:[!M&&e.jsx("div",{className:"p-1.5 sm:p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Rr,{className:"h-3 w-3 sm:h-3.5 sm:w-3.5 text-gray-700 dark:text-gray-300"})}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:"المعاملات الأخيرة"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!M&&e.jsxs("div",{className:"flex items-center gap-0.5 bg-gray-100 dark:bg-gray-800 rounded px-1 py-0.5 border border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-500 transition-all duration-200 group relative overflow-hidden max-w-[140px] md:max-w-[220px]",children:[e.jsx(Rf,{className:"h-2 w-2 text-gray-400 dark:text-gray-500 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors"}),e.jsx(Y,{placeholder:"بحث...",value:uc,onChange:a=>lh(a.target.value),className:"h-3 text-[8px] border-0 bg-transparent focus:ring-0 focus:outline-none text-gray-700 dark:text-gray-200 placeholder:text-gray-400 dark:placeholder:text-gray-500"})]}),!M&&e.jsxs("div",{className:"flex items-center gap-2",children:[!qt.includes("installment")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"تقسيط"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>{if(we||De){p({title:"غير متاح",description:"إدارة التقسيط غير متاحة في هذه الخطة.",variant:"destructive"});return}gr(!0)},title:"إدارة التقسيط",children:e.jsx(xf,{className:"h-5 w-5 text-purple-600"})})]}),!qt.includes("store")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 mb-1",children:"متجرك"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600",onClick:()=>Me(!0),title:"متجرك",children:e.jsx(Lr,{className:"h-5 w-5 text-blue-600"})})]}),!qt.includes("calculator")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"حاسبة"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>Ji(!0),title:"آلة حاسبة",children:e.jsx(Xf,{className:"h-5 w-5 text-purple-600"})})]}),!qt.includes("credit-cards")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"كروت"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>{we||De?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):pr(!0)},title:"كروت الائتمان",children:e.jsx(yf,{className:"h-5 w-5 text-purple-600"})})]}),e.jsxs("div",{className:"hidden flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 mb-1",children:"تقاريرك"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600",onClick:()=>{if(we||De){p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"});return}ed(!0)},title:"تقاريرك",children:e.jsx(Gd,{className:"h-5 w-5 text-blue-600"})})]}),!qt.includes("telegram")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-sky-600 mb-1",children:"تلجرام"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-sky-100 text-sky-600 hover:bg-sky-200 border border-sky-200 ring-3 ring-sky-300 transition-all duration-200 hover:scale-105 active:bg-sky-600 active:text-white active:border-sky-600",onClick:()=>{we||De?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):Rt.hasMasterPin()?Bo(!0):yd()},title:"إرسال تقرير يومي إلى تليجرام",children:e.jsx(bf,{className:"h-5 w-5 text-sky-600"})})]}),!qt.includes("cashier-shift")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-blue-600 mb-1",children:"الوردية"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 border border-blue-200 ring-3 ring-blue-300 transition-all duration-200 hover:scale-105 active:bg-blue-600 active:text-white active:border-blue-600",onClick:u0,title:N&&(j!=null&&j.name||j!=null&&j.username)?`بروفيل الوردية: ${(j==null?void 0:j.name)||(j==null?void 0:j.username)}`:"وردية الكاشير",children:e.jsx(Fr,{className:"h-5 w-5 text-blue-600"})})]}),!qt.includes("sales")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600 mb-1",children:"المبيعات"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>{we||De?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):js(!0)},title:"بيانات المبيعات",children:e.jsx(Ho,{className:"h-5 w-5 text-purple-600"})})]}),!qt.includes("debts")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[10px] font-semibold text-purple-600",children:"الديون"}),Ie.filter(a=>a.status==="pending").length>0&&e.jsx("span",{className:"h-4 w-4 rounded-full bg-red-600 text-white text-[10px] flex items-center justify-center ring-2 ring-white",children:Ie.filter(a=>a.status==="pending").length})]}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-purple-100 text-purple-600 hover:bg-purple-200 border border-purple-200 ring-3 ring-purple-300 transition-all duration-200 hover:scale-105 active:bg-purple-600 active:text-white active:border-purple-600",onClick:()=>{Sn()},title:"الديون",children:e.jsx(Qn,{className:"h-5 w-5 text-purple-600"})})]}),!qt.includes("maintenance")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-amber-700 mb-1",children:"الصيانة"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-amber-100 text-amber-700 hover:bg-amber-200 border border-amber-200 ring-3 ring-amber-300 transition-all duration-200 hover:scale-105 active:bg-amber-600 active:text-white active:border-amber-600",onClick:()=>{we||De?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):xr(!0)},title:"الصيانة",children:e.jsx(Fd,{className:"h-5 w-5 text-amber-700"})})]}),!qt.includes("machine")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-yellow-500 mb-1",children:"المكنة"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-violet-100 text-violet-700 hover:bg-violet-200 border border-violet-200 ring-3 ring-violet-300 transition-all duration-200 hover:scale-105 active:bg-violet-700 active:text-white active:border-violet-700",onClick:()=>{!Yt||De?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):yr(!0)},title:"يومية المكنة",children:e.jsx(vf,{className:"h-5 w-5 text-yellow-500"})})]}),!qt.includes("shop-expenses")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-orange-600 mb-1",children:"مصروفات"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-orange-100 text-orange-600 hover:bg-orange-200 border border-orange-200 ring-3 ring-orange-300 transition-all duration-200 hover:scale-105 active:bg-orange-600 active:text-white active:border-orange-600",onClick:()=>{we||De?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):Rt.hasMasterPin()?gs(!0):Ya(!0)},title:"مصروفات المحل",children:e.jsx(Br,{className:"h-5 w-5 text-orange-600"})})]}),!qt.includes("deficiencies")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-rose-600 mb-1",children:"النواقص"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-rose-100 text-rose-600 hover:bg-rose-200 border border-rose-200 ring-3 ring-rose-300 transition-all duration-200 hover:scale-105 active:bg-rose-600 active:text-white active:border-rose-600",onClick:()=>{we||De?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):ar(!0)},title:"النواقص",children:e.jsx(Bd,{className:"h-5 w-5 text-rose-600"})})]}),!qt.includes("my-client-numbers")&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-semibold text-emerald-600 mb-1",children:"أرقامي"}),e.jsx(I,{variant:"ghost",size:"sm",className:"h-10 w-10 p-0 rounded-full bg-emerald-100 text-emerald-700 hover:bg-emerald-200 border border-emerald-200 ring-3 ring-emerald-300 transition-all duration-200 hover:scale-105 active:bg-emerald-600 active:text-white active:border-emerald-600",onClick:()=>{we||De?p({title:"غير متاح",description:"هذه الميزة غير متاحة في هذه الخطة.",variant:"destructive"}):on(!0)},title:"أرقامي",children:e.jsx(Gn,{className:"h-5 w-5 text-emerald-700"})})]})]})]})]}),!M&&e.jsx("div",{className:"mt-2 w-full",children:e.jsxs("div",{className:"filters-bar flex items-center justify-center gap-3 bg-gray-100 rounded-md p-3 border border-gray-200",children:[e.jsx(I,{variant:"ghost",size:"sm",className:`btn-filter-send h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${Na==="send"?"bg-green-600 text-white border-green-600":"text-green-700 border-green-300 hover:bg-green-100"}`,onClick:()=>Mi("send"),title:"تصفية التحويل",children:"التحويل"}),e.jsx(I,{variant:"ghost",size:"sm",className:`btn-filter-withdraw h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${Na==="withdraw"?"bg-red-600 text-white border-red-600":"text-red-700 border-red-300 hover:bg-red-100"}`,onClick:()=>Mi("withdraw"),title:"تصفية السحب",children:"السحب"}),e.jsx(I,{variant:"ghost",size:"sm",className:`btn-filter-all h-8 px-4 text-[12px] min-w-[96px] rounded-full border ${Na==="all"?"bg-green-600 text-white border-green-600":"text-green-700 border-green-300 hover:bg-green-100"}`,onClick:()=>Mi("all"),title:"عرض الكل",children:"الكل"}),e.jsxs("div",{className:"relative ml-1",children:[e.jsxs(I,{variant:"ghost",size:"sm",className:"h-auto px-2 py-1 text-xs text-red-600 hover:bg-red-50 rounded-md font-medium",onClick:()=>Dr(!0),title:"تصفير المعاملات الأخيرة",children:[e.jsx(oa,{className:"h-3 w-3 mr-1"}),"تصفير"]}),w0>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"})]})]})})]}),e.jsx(la,{open:gh,onOpenChange:gr,mode:"verify",title:"فتح إدارة التقسيط",description:"أدخل الرقم السري الرئيسي للوصول إلى إدارة التقسيط",onSuccess:()=>{gr(!1),yc(!0)}}),e.jsx(xb,{open:ph,onOpenChange:yc}),e.jsx(la,{open:C0,onOpenChange:Bo,mode:"verify",title:"إرسال تقرير يومي إلى تليجرام",description:"أدخل الرقم السري الرئيسي لإرسال التقرير اليومي إلى تليجرام",onSuccess:()=>{Bo(!1),yd()}}),e.jsxs(Ia,{className:"space-y-2 pt-0 px-4 pb-4 relative z-10",children:[qo.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Rr,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"لا توجد معاملات حتى الآن"})]}):M?e.jsx("div",{className:"overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors max-h-[310px]",children:e.jsx("div",{className:"space-y-2 pr-2",children:qo.map(a=>e.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>wd(a),children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center shrink-0 ${a.type==="withdraw"?"bg-red-100":"bg-green-100"}`,children:(()=>{const r=a,i=(r==null?void 0:r.type)==="report"||String((r==null?void 0:r.title)||"").includes("إيصال تسليم وردية"),l=String((r==null?void 0:r.type)||"").toLowerCase()==="cash_addition"||String((r==null?void 0:r.type)||"").toLowerCase()==="add"||String((r==null?void 0:r.txnType)||"").toLowerCase()==="cash_addition"||String((r==null?void 0:r.title)||"").includes("إيصال إضافة نقدية"),d=String((r==null?void 0:r.type)||"").toLowerCase()==="sales"||String((r==null?void 0:r.txnType)||"").toLowerCase()==="sales"||String((r==null?void 0:r.title)||"").includes("إيصال مبيعات")||String((r==null?void 0:r.senderMsisdn)||"")==="مبيعات";return i?e.jsx(Br,{className:"h-5 w-5 text-gray-600"}):l?e.jsx(jt,{className:"h-5 w-5 text-green-600"}):d?e.jsx(Br,{className:"h-5 w-5 text-green-600"}):a.type==="withdraw"?e.jsx(Vs,{className:"h-5 w-5 text-red-600"}):e.jsx(Yd,{className:"h-5 w-5 text-green-600"})})()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"text-base font-bold truncate",children:(()=>{const r=a,i=(r==null?void 0:r.type)==="report"||String((r==null?void 0:r.title)||"").includes("إيصال تسليم وردية"),l=String((r==null?void 0:r.type)||"").toLowerCase()==="cash_addition"||String((r==null?void 0:r.type)||"").toLowerCase()==="add"||String((r==null?void 0:r.txnType)||"").toLowerCase()==="cash_addition"||String((r==null?void 0:r.title)||"").includes("إيصال إضافة نقدية"),d=String((r==null?void 0:r.type)||"").toLowerCase()==="sales"||String((r==null?void 0:r.txnType)||"").toLowerCase()==="sales"||String((r==null?void 0:r.title)||"").includes("إيصال مبيعات")||String((r==null?void 0:r.senderMsisdn)||"")==="مبيعات",m=String((r==null?void 0:r.title)||"").includes("إيصال تحويل مكينه")||String((r==null?void 0:r.description)||"").includes("تحويل مكنه");return i?e.jsx("span",{className:"text-foreground",children:"تسليم وردية"}):m?e.jsx("span",{className:"text-foreground",children:"إيصال تحويل مكينه"}):l?e.jsx("span",{className:"text-foreground",children:"إضافة نقدية"}):d?e.jsx("span",{className:"text-foreground",children:"مبيعات"}):a.type==="send"?e.jsx("span",{className:"text-green-600",children:"تحويل أموال"}):e.jsx("span",{className:"text-red-600",children:"سحب نقدي"})})()}),e.jsxs("span",{className:`text-base font-bold whitespace-nowrap ${a.type==="withdraw"?"text-red-600":"text-green-600"}`,children:[a.type==="withdraw"||a.type==="cash_addition"||a.txnType==="cash_addition"||a.type==="sales"||a.txnType==="sales"?"+":"-"," ",Jt(a.amount)," ج.م"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:(()=>{const r=a,i=(r==null?void 0:r.type)==="report"||String((r==null?void 0:r.title)||"").includes("إيصال تسليم وردية"),l=String((r==null?void 0:r.type)||"").toLowerCase()==="cash_addition"||String((r==null?void 0:r.type)||"").toLowerCase()==="add"||String((r==null?void 0:r.txnType)||"").toLowerCase()==="cash_addition"||String((r==null?void 0:r.title)||"").includes("إيصال إضافة نقدية"),d=String((r==null?void 0:r.type)||"").toLowerCase()==="sales"||String((r==null?void 0:r.txnType)||"").toLowerCase()==="sales"||String((r==null?void 0:r.title)||"").includes("إيصال مبيعات")||String((r==null?void 0:r.senderMsisdn)||"")==="مبيعات",m=String((r==null?void 0:r.title)||"").includes("إيصال تحويل مكينه")||String((r==null?void 0:r.description)||"").includes("تحويل مكنه"),h=(r==null?void 0:r.note)||(r==null?void 0:r.notes)||"";if(i)return`إلى: ${a.receiverPhone}`;if(l)return h||"إضافة يدوية";if(d){const g=((r==null?void 0:r.saleProductName)||"").trim(),v=((r==null?void 0:r.saleQuantity)??"").toString();return g&&v?`${g} × ${v}`:g||"عملية بيع"}return m?`من: ${r.senderName||"ماكينة"}`:a.type==="send"?e.jsx("span",{dir:"ltr",children:a.receiverPhone}):e.jsx("span",{dir:"ltr",children:a.senderPhone})})()}),e.jsxs("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:[Er.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))," - ",Dd.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))]})]}),e.jsxs("div",{className:`px-2 py-0.5 rounded-full text-[10px] font-medium flex items-center gap-1 ${a.status==="completed"?a.type==="withdraw"?"bg-red-100 text-red-700":"bg-green-100 text-green-700":a.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[a.status==="completed"&&e.jsx(Xn,{className:"h-3 w-3"}),a.status==="pending"&&e.jsx($d,{className:"h-3 w-3"}),a.status==="failed"&&e.jsx(Zn,{className:"h-3 w-3"}),e.jsx("span",{children:a.status==="completed"?"ناجحة":a.status==="pending"?"معالجة":"فشلت"})]})]})]})]},a.id))})}):e.jsx("div",{className:"overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 transition-colors max-h-[calc(100dvh-300px)]",children:e.jsx("div",{className:"space-y-2 pr-2",children:qo.map(a=>e.jsxs("div",{className:"relative flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>wd(a),children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center shrink-0 ${a.type==="withdraw"?"bg-red-100":"bg-green-100"}`,children:(()=>{const r=a,i=(r==null?void 0:r.type)==="report"||String((r==null?void 0:r.title)||"").includes("إيصال تسليم وردية"),l=String((r==null?void 0:r.type)||"").toLowerCase()==="cash_addition"||String((r==null?void 0:r.type)||"").toLowerCase()==="add"||String((r==null?void 0:r.txnType)||"").toLowerCase()==="cash_addition"||String((r==null?void 0:r.title)||"").includes("إيصال إضافة نقدية"),d=String((r==null?void 0:r.type)||"").toLowerCase()==="sales"||String((r==null?void 0:r.txnType)||"").toLowerCase()==="sales"||String((r==null?void 0:r.title)||"").includes("إيصال مبيعات")||String((r==null?void 0:r.senderMsisdn)||"")==="مبيعات";return i?e.jsx(Br,{className:"h-5 w-5 text-gray-600"}):l?e.jsx(jt,{className:"h-5 w-5 text-green-600"}):d?e.jsx(Br,{className:"h-5 w-5 text-green-600"}):a.type==="withdraw"?e.jsx(Vs,{className:"h-5 w-5 text-red-600"}):e.jsx(Yd,{className:"h-5 w-5 text-green-600"})})()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"text-base font-bold truncate",children:(()=>{const r=a,i=(r==null?void 0:r.type)==="report"||String((r==null?void 0:r.title)||"").includes("إيصال تسليم وردية"),l=String((r==null?void 0:r.type)||"").toLowerCase()==="cash_addition"||String((r==null?void 0:r.type)||"").toLowerCase()==="add"||String((r==null?void 0:r.txnType)||"").toLowerCase()==="cash_addition"||String((r==null?void 0:r.title)||"").includes("إيصال إضافة نقدية"),d=String((r==null?void 0:r.type)||"").toLowerCase()==="sales"||String((r==null?void 0:r.txnType)||"").toLowerCase()==="sales"||String((r==null?void 0:r.title)||"").includes("إيصال مبيعات")||String((r==null?void 0:r.senderMsisdn)||"")==="مبيعات",m=String((r==null?void 0:r.title)||"").includes("إيصال تحويل مكينه")||String((r==null?void 0:r.description)||"").includes("تحويل مكنه");return i?e.jsx("span",{className:"text-foreground",children:"تسليم وردية"}):l?e.jsx("span",{className:"text-foreground",children:"إضافة نقدية"}):d?e.jsx("span",{className:"text-foreground",children:"مبيعات"}):m?e.jsx("span",{className:"text-foreground",children:"إيصال تحويل مكينه"}):a.type==="send"?e.jsx("span",{className:"text-green-600",children:"تحويل أموال"}):e.jsx("span",{className:"text-red-600",children:"سحب نقدي"})})()}),e.jsxs("span",{className:`text-base font-bold whitespace-nowrap ${a.type==="withdraw"?"text-red-600":"text-green-600"}`,children:[a.type==="withdraw"||a.type==="cash_addition"||a.txnType==="cash_addition"||a.type==="sales"||a.txnType==="sales"?"+":"-"," ",Jt(a.amount)," ج.م"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:(()=>{const r=a,i=(r==null?void 0:r.type)==="report"||String((r==null?void 0:r.title)||"").includes("إيصال تسليم وردية"),l=String((r==null?void 0:r.type)||"").toLowerCase()==="cash_addition"||String((r==null?void 0:r.type)||"").toLowerCase()==="add"||String((r==null?void 0:r.txnType)||"").toLowerCase()==="cash_addition"||String((r==null?void 0:r.title)||"").includes("إيصال إضافة نقدية"),d=String((r==null?void 0:r.type)||"").toLowerCase()==="sales"||String((r==null?void 0:r.txnType)||"").toLowerCase()==="sales"||String((r==null?void 0:r.title)||"").includes("إيصال مبيعات")||String((r==null?void 0:r.senderMsisdn)||"")==="مبيعات",m=String((r==null?void 0:r.title)||"").includes("إيصال تحويل مكينه")||String((r==null?void 0:r.description)||"").includes("تحويل مكنه"),h=(r==null?void 0:r.note)||(r==null?void 0:r.notes)||"";if(i)return`إلى: ${a.receiverPhone}`;if(l)return h||"إضافة يدوية";if(d){const g=((r==null?void 0:r.saleProductName)||"").trim(),v=((r==null?void 0:r.saleQuantity)??"").toString();return g&&v?`${g} × ${v}`:g||"عملية بيع"}return m?`من: ${r.senderName||"ماكينة"}`:a.type==="send"?e.jsx("span",{dir:"ltr",children:a.receiverPhone}):e.jsx("span",{dir:"ltr",children:a.senderPhone})})()}),e.jsxs("p",{className:"text-sm font-medium text-gray-500 mt-0.5",children:[Er.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))," - ",Dd.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))]})]}),e.jsxs("div",{className:`px-2 py-0.5 rounded-full text-[10px] font-medium flex items-center gap-1 ${a.status==="completed"?a.type==="withdraw"?"bg-red-100 text-red-700":"bg-green-100 text-green-700":a.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[a.status==="completed"&&e.jsx(Xn,{className:"h-3 w-3"}),a.status==="pending"&&e.jsx($d,{className:"h-3 w-3"}),a.status==="failed"&&e.jsx(Zn,{className:"h-3 w-3"}),e.jsx("span",{children:a.status==="completed"?"ناجحة":a.status==="pending"?"معالجة":"فشلت"})]})]})]})]},a.id))})}),M&&e.jsxs("div",{className:"mt-2 flex justify-end",children:[e.jsxs(I,{variant:"ghost",size:"sm",className:"h-7 px-2 text-[11px] rounded-full border bg-red-100 text-red-700 border-red-300 hover:bg-red-200",onClick:()=>Dr(!0),title:"تصفير المعاملات الأخيرة",children:[e.jsx(oa,{className:"h-3 w-3 mr-1"}),"تصفير"]}),(t==null?void 0:t.uid)&&localStorage.getItem(`recentTransactionsResetAt:${t.uid}`)&&e.jsx("span",{className:"inline-block h-1.5 w-1.5 rounded-full bg-red-500 ml-1 align-middle"})]})]})]})]}),e.jsx(ob,{isOpen:eh,onClose:()=>pn(!1),transaction:th,onPrint:()=>window.print(),onDelete:ih,onComplete:oh}),e.jsx(fe,{open:Dt,onOpenChange:Q,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(ye,{children:e.jsx(be,{children:"معلومات المطور"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4 bg-gradient-to-br from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 p-6 rounded-xl border border-blue-100 dark:border-blue-800 text-center",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400 shadow-sm",children:e.jsx(Of,{className:"h-8 w-8"})}),e.jsxs("div",{className:"space-y-3 w-full",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"معلومات التطوير"}),e.jsx("p",{className:"text-lg font-bold bg-gradient-to-r from-blue-700 to-indigo-700 dark:from-blue-400 dark:to-indigo-400 bg-clip-text text-transparent leading-relaxed",children:"تم تطوير الابلكيشن بالكامل بواسطة م/أحمد عبد الرحيم محمد"}),e.jsxs("div",{className:"flex flex-col items-center gap-1 mt-4",children:[e.jsx("p",{className:"text-base font-semibold text-gray-800 dark:text-gray-300",children:"رقم خدمة العملاء الوحيد لنا"}),e.jsx("a",{href:"tel:01000392539",className:"text-2xl font-black text-blue-600 dark:text-blue-400 tracking-wider hover:underline",dir:"ltr",children:"01000392539"})]}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 font-bold bg-red-50 dark:bg-red-900/20 py-1 px-3 rounded-full inline-block mt-2",children:"ليس لنا اي ارقام اخري"})]})]}),e.jsx("div",{className:"text-center text-xs text-gray-400 mt-2",children:Al?`v${Al}`:"v1.0.0"})]}),e.jsx(Pe,{children:e.jsx(I,{onClick:()=>Q(!1),children:"إغلاق"})})]})}),e.jsxs("div",{className:"space-y-1 fade-in-right w-full",children:[e.jsxs(Ca,{id:"transaction-section",className:"bg-gray-100 border border-blue-200/40 rounded-lg shadow-lg hover:shadow-lg transition-all duration-200 group relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/5 via-indigo-500/3 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 sm:w-28 sm:h-28 lg:w-20 lg:h-20 bg-gradient-to-bl from-blue-400/10 to-transparent rounded-full  "}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-indigo-400/10 to-transparent rounded-full  ",style:{animationDelay:"1s"}}),e.jsx(ss,{className:"sticky top-0 z-20 bg-white/80 dark:bg-gray-900/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:supports-[backdrop-filter]:bg-gray-900/60 pb-0.5 px-3 pt-1 lg:pt-0.5 lg:pb-0.5 lg:px-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(rs,{className:"text-sm font-bold flex items-center gap-2 text-gray-800",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ai,{className:"h-1 w-1 text-emerald-500 "}),e.jsx("div",{className:"absolute inset-0 h-1 w-1 bg-emerald-400 rounded-full opacity-20 "})]}),e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"إجراء معاملة جديدة"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"top-icons-bar hidden md:flex items-center gap-2 bg-gradient-to-r from-gray-50 to-slate-50 hover:from-gray-100 hover:to-slate-100 border border-gray-200 transition-all duration-300 hover:scale-105 h-9 px-3 rounded-xl shadow-sm",children:[e.jsx(zy,{}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"VIP",onClick:()=>Qi(!0),children:e.jsx(Zf,{className:"h-5 w-5 text-yellow-500"})}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"إدارة الفروع",onClick:()=>(gt==null?void 0:gt.status)==="active"?le(!0):He(!0),children:e.jsx(Lr,{className:"h-5 w-5"})}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"معلومات المطور",onClick:()=>Q(!0),children:e.jsx(Fd,{className:"h-5 w-5 text-gray-600"})}),e.jsx(Hf,{})]})}),k0&&e.jsxs(I,{variant:"outline",size:"sm",className:"hidden flex items-center gap-1.5 sm:gap-2 bg-gradient-to-r from-cyan-50 to-blue-50 hover:from-cyan-100 hover:to-blue-100 border-cyan-200 text-cyan-800 text-xs sm:text-sm transition-all duration-300 hover:scale-105 hover:shadow-lg h-10 sm:h-12 px-4 sm:px-5 rounded-xl min-w-[44px] touch-manipulation",onClick:hd,title:"مزامنة البيانات المحفوظة محلياً مع الخادم",children:[e.jsx(Qo,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 animate-spin"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold whitespace-nowrap",children:"مزامنة"})]})]})}),e.jsx(fe,{open:kh,onOpenChange:Qi,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(ye,{children:e.jsx(be,{children:"أفضل 10 عملاء هذا الشهر"})}),e.jsx("div",{className:"space-y-2",children:Un.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"لا توجد بيانات لهذا الشهر"}):Un.map((a,r)=>e.jsxs("div",{className:`flex items-center justify-between border rounded-md px-3 py-2 bg-white dark:bg-gray-800 dark:border-gray-700 ${r===0?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-300 dark:border-yellow-700":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_a,{variant:"outline",className:`min-w-[28px] justify-center ${r===0?"border-yellow-300 text-yellow-700 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20":""}`,children:r+1}),e.jsx("span",{className:`font-semibold ${r===0?"text-yellow-700":""}`,children:a.phone})]}),e.jsxs("div",{className:"text-sm text-gray-700 flex items-center gap-3",children:[e.jsxs("span",{children:["عدد: ",a.count]}),e.jsxs("span",{children:["إجمالي: ",a.total]}),e.jsx(I,{variant:"outline",size:"sm",className:"h-8",onClick:()=>j0(a),title:"إرسال واتساب",children:e.jsx(zo,{className:"h-4 w-4"})})]})]},a.phone+r))}),e.jsx(Pe,{children:e.jsx(I,{onClick:()=>Qi(!1),children:"إغلاق"})})]})}),e.jsx(fe,{open:jh,onOpenChange:bc,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(ye,{children:e.jsx(be,{children:"ربط بوت التلجرام"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{children:"Telegram Chat ID"}),e.jsx(Y,{value:vn,onChange:a=>Sh(a.target.value),placeholder:"اكتب رقم المحادثة"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Z,{children:"إرسال يومي 12 صباحاً"}),e.jsx(Jf,{checked:vc,onCheckedChange:a=>Dh(!!a)})]})]}),e.jsxs(Pe,{children:[e.jsx(I,{variant:"outline",onClick:()=>bc(!1),children:"إغلاق"}),e.jsx(I,{onClick:async()=>{t!=null&&t.uid&&(await se.updateUserData(t.uid,{telegramChatId:vn,telegramDailyEnabled:vc}),p({title:"تم الحفظ"}))},children:"حفظ"}),e.jsx(I,{onClick:async()=>{if(!(t!=null&&t.uid)||!vn){p({title:"أدخل Chat ID"});return}const a=await pd();try{const{sendTelegramMessage:r}=await X(async()=>{const{sendTelegramMessage:i}=await import("./functions-B8lgosbg.js");return{sendTelegramMessage:i}},__vite__mapDeps([60,0,1]),import.meta.url);await r({chatId:vn,text:a}),p({title:"تم الإرسال"})}catch{p({title:"تعذر الإرسال",description:"تحقق من ربط البوت",variant:"destructive"})}},children:"إرسال الآن"})]})]})}),e.jsx(fe,{open:ue,onOpenChange:le,children:e.jsxs(ge,{className:"sm:max-w-2xl bg-gray-50/80 backdrop-blur-sm",children:[e.jsx(ye,{className:"border-b pb-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg",children:e.jsx(Lr,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx(be,{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"إدارة الفروع"}),e.jsx(at,{className:"text-gray-500 dark:text-gray-400 mt-1",children:"أضف فروعاً جديدة وتابع أداء كل فرع بسهولة"})]})]}),e.jsx(I,{size:"icon",variant:hs?"destructive":"default",className:`rounded-full transition-all duration-300 ${hs?"bg-red-50 text-red-600 hover:bg-red-100 border border-red-200":"bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg hover:shadow-indigo-200"}`,onClick:()=>Il(!hs),title:hs?"إلغاء الإضافة":"إضافة فرع جديد",children:hs?e.jsx(ei,{className:"w-6 h-6"}):e.jsx(jt,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"space-y-6",children:[hs&&e.jsxs("div",{className:"bg-white dark:bg-card p-5 rounded-xl border border-gray-200 dark:border-gray-800 shadow-sm space-y-4 animate-in slide-in-from-top-4 fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-700 dark:text-indigo-400 font-semibold",children:[e.jsx(jt,{className:"w-5 h-5"}),e.jsx("h3",{children:"إضافة فرع جديد"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{onClick:()=>checkSubscriptionStatus(!0).then(()=>p({title:"تم تحديث البيانات"})),variant:"ghost",size:"icon",title:"تحديث بيانات الاشتراك",children:e.jsx(Qo,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"})}),e.jsxs(I,{onClick:()=>He(!0),variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(og,{className:"w-4 h-4"}),"طلب زيادة فرع"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-gray-700 dark:text-gray-300",children:"اسم المدير"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fr,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(Y,{className:"pr-9 bg-white dark:bg-gray-950 dark:border-gray-700 dark:text-gray-100",value:ea,onChange:a=>ls(a.target.value),placeholder:"مثال: أحمد محمد"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-gray-700 dark:text-gray-300",children:"اسم الفرع"}),e.jsxs("div",{className:"relative",children:[e.jsx(Lr,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(Y,{className:"pr-9 bg-white dark:bg-gray-950 dark:border-gray-700 dark:text-gray-100",value:cs,onChange:a=>ta(a.target.value),placeholder:"مثال: فرع وسط البلد"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-gray-700 dark:text-gray-300",children:"البريد الإلكتروني للدخول"}),e.jsxs("div",{className:"relative",children:[e.jsx(zo,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(Y,{className:"pr-9 bg-white dark:bg-gray-950 dark:border-gray-700 dark:text-gray-100",value:Gs,onChange:a=>ds(a.target.value),placeholder:"branch@example.com"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-gray-700 dark:text-gray-300",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-400",children:"🔒"}),e.jsx(Y,{type:"password",className:"pr-9 bg-white dark:bg-gray-950 dark:border-gray-700 dark:text-gray-100",value:Va,onChange:a=>us(a.target.value),placeholder:"••••••"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-2",children:[e.jsx(I,{variant:"ghost",onClick:()=>{ls(""),ta(""),ds(""),us("")},className:"text-gray-500 hover:text-gray-700",children:"مسح الحقول"}),e.jsx(I,{className:"bg-indigo-600 hover:bg-indigo-700 text-white min-w-[120px]",disabled:ms,onClick:async()=>{if(!(t!=null&&t.uid))return;const a=ea.trim(),r=cs.trim(),i=Gs.trim(),l=Va.trim();if(!a||!r||!i||!l){p({title:"يرجى ملء جميع الحقول المطلوبة"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){p({title:"البريد الإلكتروني غير صالح",variant:"destructive"});return}if(l.length<6){p({title:"كلمة السر يجب أن تكون 6 أحرف على الأقل",variant:"destructive"});return}const m=(gt==null?void 0:gt.limit)||0;if($t.length>=m){p({title:"عفواً",description:`لقد وصلت للحد الأقصى من الفروع (${m} فروع)`,variant:"destructive"});return}try{Xr(!0);let h="",g="";const v=`tempApp_${Date.now()}`,y=wf(Nf,v),x=jf(y),w=Sf(y);try{h=(await Df(x,i,l)).user.uid;try{await Ht(Te(w,"users",h),{email:i,isActive:!0,isBranch:!0,ownerId:t.uid,createdAt:wt(),updatedAt:wt(),role:"branch",isActive:!1,subscription:{isActive:!1,planType:null,startDate:null,endDate:null}})}catch(T){console.error("Error creating branch user document:",T)}try{g=(await Yo(pe(w,"shops"),{name:r,ownerId:h,managerName:a,createdAt:wt(),updatedAt:wt(),isActive:!0})).id}catch(T){console.error("Error creating shop as new user:",T);try{g=(await Yo(pe(w,"users",h,"shops"),{name:r,ownerId:h,managerName:a,createdAt:wt(),updatedAt:wt(),isActive:!0})).id}catch(O){throw console.error("Error creating shop in subcollection:",O),T}}await kf(x)}catch(S){console.error("Registration/Shop Creation Error:",S);let T="تعذر إنشاء المستخدم أو المتجر";S.code==="auth/email-already-in-use"&&(T="البريد الإلكتروني مستخدم بالفعل"),S.code==="auth/invalid-email"&&(T="البريد الإلكتروني غير صالح"),S.code==="auth/weak-password"&&(T="كلمة المرور ضعيفة"),S.code==="permission-denied"&&(T="ليس لديك صلاحية لإنشاء متجر لهذا المستخدم"),p({title:T,description:S.message,variant:"destructive"});try{await Ud(y)}catch{}return}finally{try{await Ud(y)}catch(S){console.warn("Error deleting temp app:",S)}}if(!h||!g)return;const k=S=>{try{return btoa(unescape(encodeURIComponent(S)))}catch{return btoa(S)}};try{const S={ownerId:t.uid,shopId:g,branchUserId:h,branchName:r,managerName:a,loginUsername:i,passwordEncoded:k(l),createdAt:wt()};await Ht(Te(V,"users",t.uid,"branches",h),S);try{await Yo(pe(V,"branches"),S)}catch(O){console.warn("Branch ref creation error in root collection (non-fatal):",O)}const T={id:h,branchUserId:h,branchName:r,managerName:a,source:"sub",...S};Qe(O=>[...O,T])}catch(S){console.error("Branch ref creation error:",S),p({title:"خطأ في حفظ بيانات الفرع",description:"تم إنشاء المستخدم ولكن فشل حفظ البيانات",variant:"destructive"})}ls(""),ta(""),ds(""),us(""),p({title:"تم إضافة الفرع وإنشاء المستخدم بنجاح"})}catch(h){console.error("General Error adding branch:",h),p({title:"تعذّر إضافة الفرع",description:h.message||"حدث خطأ غير متوقع"})}finally{Xr(!1)}},children:ms?"جارٍ الإضافة...":"إضافة فرع"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-6 bg-indigo-500 rounded-full"}),"الفروع الحالية",e.jsxs(_a,{variant:"secondary",className:"mr-auto",children:[$t.length," / ",(gt==null?void 0:gt.limit)||0]})]}),ms&&$t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:[e.jsx(Qo,{className:"w-8 h-8 animate-spin mb-2 text-indigo-400"}),e.jsx("p",{children:"جارٍ تحميل الفروع..."})]}):$t.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-200 dark:border-gray-800 rounded-xl bg-gray-50 dark:bg-gray-900/50",children:[e.jsx(Lr,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"لا يوجد فروع مضافة حالياً"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-3",children:$t.map(a=>{var r;return e.jsx("div",{className:"group relative bg-white dark:bg-card border border-gray-200 dark:border-gray-800 rounded-xl p-4 shadow-sm hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-700 dark:text-indigo-400 font-bold text-lg",children:((r=a.branchName)==null?void 0:r.charAt(0))||"B"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-gray-900 dark:text-gray-100 text-lg",children:a.branchName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(Fr,{className:"w-3 h-3"}),e.jsxs("span",{children:["المدير: ",a.managerName]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto mt-2 sm:mt-0",children:[e.jsxs(I,{className:"flex-1 sm:flex-none bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200 dark:bg-indigo-900/20 dark:text-indigo-300 dark:hover:bg-indigo-900/30 dark:border-indigo-800",onClick:()=>gm(a),children:[e.jsx(Ho,{className:"w-4 h-4 ml-2"}),"عرض البيانات"]}),e.jsx(I,{variant:"ghost",size:"icon",className:"text-blue-500 hover:text-blue-700 hover:bg-blue-50 dark:text-blue-400 dark:hover:text-blue-300 dark:hover:bg-blue-900/20",title:"تعديل بيانات الفرع",onClick:()=>hm(a),children:e.jsx(Jd,{className:"w-4 h-4"})})]})]})},a.id)})})]})]})]})}),e.jsx(fe,{open:em,onOpenChange:di,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsxs(ye,{children:[e.jsx(be,{children:"دخول الفرع"}),e.jsx(at,{children:"أدخل بيانات الدخول للفرع المحدد"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(Z,{children:"اسم المستخدم (البريد الإلكتروني)"}),e.jsx(Y,{value:Nl,onChange:a=>jl(a.target.value),placeholder:"example@email.com"})]}),e.jsxs("div",{children:[e.jsx(Z,{children:"كلمة السر"}),e.jsx(Y,{type:"password",value:Sl,onChange:a=>Dl(a.target.value),placeholder:"••••••"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{jl(""),Dl("")},children:"مسح"}),e.jsx(I,{className:"bg-blue-600 hover:bg-blue-700",disabled:am,onClick:async()=>{const a=tm;if(!a){di(!1);return}const r=String(a.loginUsername||"");let i="";try{const m=String(a.passwordEncoded||"");i=m?decodeURIComponent(escape(atob(m))):""}catch{try{i=a.passwordEncoded?atob(String(a.passwordEncoded)):""}catch{i=""}}const l=Nl.trim(),d=Sl.trim();if(!l||!d){p({title:"يرجى إدخال اسم المستخدم وكلمة السر"});return}if(l!==r||d!==i){p({title:"بيانات الدخول غير صحيحة",variant:"destructive"});return}try{kl(!0);const m=t!=null&&t.uid?`selectedShopId_${t.uid}`:"selectedShopId";localStorage.setItem(m,String(a.shopId)),p({title:"تم الدخول إلى الفرع",description:String(a.branchName||"")}),di(!1),le(!1),f("/user/dashboard")}catch{}kl(!1)},children:"دخول"})]})]})]})}),e.jsx(fe,{open:sm,onOpenChange:Zr,children:e.jsxs(ge,{className:"sm:max-w-2xl",children:[e.jsxs(ye,{children:[e.jsxs(be,{children:["بيانات فرع ",kt==null?void 0:kt.branchName]}),e.jsxs(at,{children:["مدير الفرع: ",kt==null?void 0:kt.managerName]})]}),rm?e.jsx("div",{className:"py-8 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):kt?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 py-4",children:[e.jsxs("div",{className:"p-4 border rounded-xl bg-green-50 dark:bg-green-950/20 dark:border-green-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"مبيعات اليوم"}),e.jsxs("div",{className:"text-xl font-bold text-green-700 dark:text-green-400",children:[Jt(kt.todaySales)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-blue-50 dark:bg-blue-950/20 dark:border-blue-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"مبيعات الشهر"}),e.jsxs("div",{className:"text-xl font-bold text-blue-700 dark:text-blue-400",children:[Jt(kt.monthSales)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-emerald-50 dark:bg-emerald-950/20 dark:border-emerald-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"ارباح اليوم"}),e.jsxs("div",{className:"text-xl font-bold text-emerald-700 dark:text-emerald-400",children:[Jt(kt.todayProfit)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-cyan-50 dark:bg-cyan-950/20 dark:border-cyan-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"ارباح الشهر"}),e.jsxs("div",{className:"text-xl font-bold text-cyan-700 dark:text-cyan-400",children:[Jt(kt.monthProfit)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-purple-50 dark:bg-purple-950/20 dark:border-purple-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"أرصدة المحافظ"}),e.jsxs("div",{className:"text-xl font-bold text-purple-700 dark:text-purple-400",children:[Jt(kt.walletsTotal)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-yellow-50 dark:bg-yellow-950/20 dark:border-yellow-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"نقدية الدرج"}),e.jsxs("div",{className:"text-xl font-bold text-yellow-700 dark:text-yellow-400",children:[Jt(kt.cashBalance)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-indigo-50 dark:bg-indigo-950/20 dark:border-indigo-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"مبيعات قسم المبيعات"}),e.jsxs("div",{className:"text-xl font-bold text-indigo-700 dark:text-indigo-400",children:[Jt(kt.totalSalesSection)," ج.م"]})]}),e.jsxs("div",{className:"p-4 border rounded-xl bg-red-50 dark:bg-red-950/20 dark:border-red-900/30",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"مجموع الديون"}),e.jsxs("div",{className:"text-xl font-bold text-red-700 dark:text-red-400",children:[Jt(kt.debtsTotal)," ج.م"]})]})]}):null,e.jsx(Pe,{children:e.jsx(I,{onClick:()=>Zr(!1),children:"إغلاق"})})]})}),e.jsx(fe,{open:cm,onOpenChange:en,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsxs(ye,{children:[e.jsx(be,{children:"تعديل بيانات الفرع"}),e.jsx(at,{children:"تعديل اسم الفرع واسم المدير"})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{children:"البريد الإلكتروني (اسم المستخدم)"}),e.jsx(Y,{value:um,readOnly:!0,disabled:!0,placeholder:"لا يوجد بريد مسجل",className:"bg-gray-100 dark:bg-gray-800 text-black dark:text-gray-100 opacity-100 font-medium"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{children:"اسم الفرع"}),e.jsx(Y,{value:tn,onChange:a=>Pl(a.target.value),placeholder:"مثال: فرع القاهرة"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{children:"اسم المدير"}),e.jsx(Y,{value:an,onChange:a=>Ol(a.target.value),placeholder:"مثال: أحمد محمد"})]})]}),e.jsxs(Pe,{children:[e.jsx(I,{variant:"outline",onClick:()=>en(!1),children:"إلغاء"}),e.jsx(I,{onClick:fm,disabled:El,children:El?"جارٍ الحفظ...":"حفظ التعديلات"})]})]})}),e.jsxs(Ia,{ref:q,className:"space-y-1 px-2 pb-2 relative z-10 transition-transform duration-200 ease-out will-change-transform",style:{transform:ee?`translateY(${ee}px)`:void 0},onFocusCapture:a=>{const r=a.target;if(!((r==null?void 0:r.id)==="transferExtraFeeInput")){$(0);return}const l=document.getElementById("transferSubmitButton");if(l){const d=l.getBoundingClientRect(),m=window.innerHeight;if(d.bottom>m){const h=d.bottom-m,g=Math.min(h,220);$(-g)}else $(0)}else $(0)},onBlurCapture:a=>{a.currentTarget.contains(a.relatedTarget)||$(0)},children:[e.jsxs("div",{className:"transaction-type-tabs flex w-full rounded-full border border-gray-300 dark:border-gray-700 overflow-hidden bg-surface dark:bg-card",children:[e.jsxs("button",{type:"button",onClick:()=>Jn("transfer"),className:`flex-1 h-10 text-sm font-medium transition-colors duration-200 flex items-center justify-center gap-2 ${R==="transfer"?"bg-blue-100 text-blue-900 dark:bg-blue-900/40 dark:text-blue-100":"bg-transparent text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[R==="transfer"&&e.jsx(Xn,{className:"h-4 w-4"}),e.jsx(Rr,{className:"h-4 w-4"}),"تحويل"]}),e.jsx("div",{className:"w-[1px] bg-gray-300 dark:bg-gray-700"}),e.jsxs("button",{type:"button",onClick:()=>Jn("withdraw"),className:`flex-1 h-10 text-sm font-medium transition-colors duration-200 flex items-center justify-center gap-2 ${R==="withdraw"?"bg-red-100 text-red-900 dark:bg-red-900/40 dark:text-red-100":"bg-transparent text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[R==="withdraw"&&e.jsx(Xn,{className:"h-4 w-4"}),e.jsx(Vs,{className:"h-4 w-4"}),"سحب"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-3",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-700 flex items-center gap-2 whitespace-nowrap",children:[e.jsx(Bs,{className:"h-4 w-4 text-blue-600"}),"اختيار المحفظة"]}),e.jsxs("div",{className:"flex items-center gap-1 justify-end overflow-x-auto scrollbar-hide",children:[e.jsxs(I,{variant:"outline",size:"sm",className:"h-7 rounded-md px-2 text-[10px] font-medium bg-emerald-50 text-emerald-700 hover:bg-emerald-100 border-emerald-200 shadow-sm whitespace-nowrap",onClick:()=>f("/user/add-wallet"),title:"إضافة محفظة",children:[e.jsx(jt,{className:"h-3 w-3 mr-1"}),"إضافة محفظة"]}),e.jsxs(I,{variant:"outline",size:"sm",className:"h-7 rounded-md px-2 text-[10px] font-medium bg-orange-50 text-orange-700 hover:bg-orange-100 border-orange-200 shadow-sm whitespace-nowrap",onClick:()=>te(!0),title:"طباعة محفظة",children:[e.jsx(eg,{className:"h-3 w-3 mr-1"}),"طباعة"]}),e.jsxs(I,{variant:"outline",size:"sm",className:"h-7 rounded-md px-2 text-[10px] font-medium bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border-indigo-200 shadow-sm whitespace-nowrap",onClick:()=>{dn(!0)},title:"المحافظ",children:[e.jsx(Bs,{className:"h-3 w-3 mr-1"}),"المحافظ"]})]})]}),F.length>0?e.jsxs(Ws,{value:E,onValueChange:_0,children:[e.jsx(Rs,{"data-testid":"wallet-select",className:"w-full h-14 text-base bg-surface border border-gray-400 hover:border-gray-800 focus:border-primary rounded-xl transition-colors duration-200 flex items-center",children:e.jsx(Ls,{placeholder:"اختر محفظة للمعاملة",className:"text-gray-700"})}),e.jsxs(Fs,{className:"rounded-xl border border-gray-200 dark:border-gray-800 shadow-md z-[9999] bg-white dark:bg-gray-900",children:[e.jsx("div",{"data-fixed-header":"true",className:"sticky top-0 z-10 bg-white dark:bg-gray-900 p-2 border-b border-gray-100 dark:border-gray-800",children:e.jsx(Y,{value:nc,onChange:a=>Qm(a.target.value),placeholder:"ابحث برقم المحفظة",className:"h-10 text-sm border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 rounded-lg"})}),e.jsx("div",{className:"p-1",children:oc.length===0?e.jsx("div",{className:"text-sm text-gray-500 p-3 text-center",children:"لا توجد نتائج مطابقة"}):oc.map(a=>{const r=Re.includes(a.id);return e.jsx(Ta,{value:a.id,className:"rounded-lg my-1 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 focus:bg-blue-50 dark:focus:bg-blue-900/20 transition-colors duration-200",children:e.jsxs("div",{className:"flex items-center gap-3 py-2 w-full",children:[e.jsx(Bs,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"}),e.jsxs("div",{className:"flex items-center gap-2 text-right",children:[e.jsx("span",{className:"text-base font-medium text-gray-900 dark:text-gray-100",children:a.name}),e.jsx("span",{className:"text-sm font-bold text-red-600 dark:text-red-400",children:a.phone})]}),a.isDefault&&e.jsx("span",{className:"mr-auto text-[10px] bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 px-2 py-0.5 rounded-full border border-gray-200 dark:border-gray-700",children:"افتراضي"}),e.jsx("button",{type:"button",onMouseDown:i=>{i.preventDefault(),i.stopPropagation(),Gm(a.id)},className:"ml-2 mr-auto rounded-full p-1 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 cursor-pointer",title:r?"إزالة من المفضلة":"تعيين كمحفظة مفضلة",children:e.jsx(tg,{className:`h-4 w-4 ${r?"text-yellow-500 fill-yellow-400 drop-shadow-[0_0_4px_rgba(250,204,21,0.8)]":"text-gray-400"}`})})]})},a.id)})})]})]}):e.jsx("div",{className:"rounded-xl border-2 border-dashed border-gray-200 bg-gray-50 px-3 py-3 text-xs text-gray-600",children:"لا توجد محافظ حتى الآن. اضغط “إضافة محفظة” لإضافة أول محفظة."})]}),e.jsx(fe,{open:Am,onOpenChange:Zl,children:e.jsxs(ge,{className:"sm:max-w-3xl w-[95vw] sm:w-auto max-h-[80vh] overflow-y-auto",children:[e.jsx(ye,{children:e.jsx(be,{children:"عرض المحافظ"})}),e.jsx("div",{className:"mt-2",children:e.jsx(vb,{showAddButton:!1,showUsageBars:!1,showLimitCards:!1,showEditButton:!0})})]})}),e.jsx(la,{open:Pm,onOpenChange:dn,mode:"verify",title:"الرقم السري لفتح المحافظ",description:"أدخل الرقم السري الرئيسي لعرض وإدارة المحافظ",onSuccess:()=>{dn(!1),Zl(!0)},userId:t==null?void 0:t.uid}),e.jsx(mu,{isOpen:J,onClose:()=>te(!1),wallets:F}),e.jsx(la,{open:Om,onOpenChange:a=>{_i(a),a||Ti(null)},mode:"verify",title:"تأكيد تغيير المحفظة",description:"أدخل الرقم السري الرئيسي لتغيير المحفظة المختارة",onSuccess:()=>{ec&&(Ar(ec,"walletSelectionPin"),Ti(null)),_i(!1)},userId:t==null?void 0:t.uid}),E&&F.length>0&&(()=>{var A;const a=F.find(B=>B.id===E),r=ka,i=E0,l=(he==null?void 0:he.monthlyWithdrawLimit)??(a==null?void 0:a.monthlyWithdrawalLimit)??2e5,d=(he==null?void 0:he.monthlyTransferLimit)??(a==null?void 0:a.monthlyTransferLimit)??2e5,m=(he==null?void 0:he.monthlyWithdrawUsed)??r.totalWithdrawn??0,h=(he==null?void 0:he.monthlyTransferUsed)??r.totalTransferred??0,g=((A=Ct==null?void 0:Ct.subscription)==null?void 0:A.planType)===Zt.TAHWEELA,v=g?0:(he==null?void 0:he.dailyWithdrawLimit)??1e5,y=g?0:(he==null?void 0:he.dailyTransferLimit)??6e4,x=g?0:(he==null?void 0:he.dailyWithdrawUsed)??i.totalWithdrawn??0,w=g?0:(he==null?void 0:he.dailyTransferUsed)??i.totalTransferred??0,k=parseFloat(ot||"0")||0,S=m+(R==="withdraw"?k:0),T=h+(R==="transfer"?k:0),O=x+(R==="withdraw"?k:0),_=w+(R==="transfer"?k:0);return a?e.jsxs("div",{className:"mb-2 space-y-2 p-2 bg-gray-50 dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 shadow-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 dark:border-gray-800 pb-1",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800 dark:text-gray-200",children:"الحدود الشهرية"}),e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 px-2 py-0.5 rounded-full border border-gray-200 dark:border-gray-700",children:Hh||(a==null?void 0:a.name)})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700",children:"سحب شهري"}),e.jsxs("span",{className:"text-gray-600 dir-ltr",children:[Math.max(l-S,0).toLocaleString("en-US",{maximumFractionDigits:0})," متبقي"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50 dark:ring-gray-700/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-red-500 to-red-600 rounded-full transition-all duration-500 ease-out shadow-sm",style:{width:`${Math.min(S/Math.max(l,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["المستخدم: ",S.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["الحد: ",l.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]}),e.jsx("div",{className:"w-[1px] bg-gray-200 self-stretch"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"تحويل شهري"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 dir-ltr",children:[Math.max(d-T,0).toLocaleString("en-US",{maximumFractionDigits:0})," متبقي"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50 dark:ring-gray-700/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-blue-500 to-blue-600 rounded-full transition-all duration-500 ease-out shadow-sm",style:{width:`${Math.min(T/Math.max(d,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["المستخدم: ",T.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["الحد: ",d.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]})]})]}),e.jsxs("div",{className:"space-y-1 pt-1.5 border-t border-gray-200 dark:border-gray-800",children:[e.jsx("div",{className:"flex items-center justify-between mb-0.5",children:e.jsx("span",{className:"text-sm font-bold text-gray-800 dark:text-gray-200",children:"الحدود اليومية"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"سحب يومي"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 dir-ltr",children:[Math.max(v-O,0).toLocaleString("en-US",{maximumFractionDigits:0})," متبقي"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50 dark:ring-gray-700/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-orange-400 to-orange-500 rounded-full transition-all duration-500 ease-out",style:{width:`${Math.min(O/Math.max(v,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["المستخدم: ",O.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["الحد: ",v.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]}),e.jsx("div",{className:"w-[1px] bg-gray-200 dark:bg-gray-800 self-stretch"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"تحويل يومي"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 dir-ltr",children:[Math.max(y-_,0).toLocaleString("en-US",{maximumFractionDigits:0})," متبقي"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden shadow-inner ring-1 ring-gray-200/50 dark:ring-gray-700/50",children:e.jsx("div",{className:"h-full bg-gradient-to-l from-green-500 to-green-600 rounded-full transition-all duration-500 ease-out",style:{width:`${Math.min(_/Math.max(y,1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["المستخدم: ",_.toLocaleString("en-US",{maximumFractionDigits:0})]}),e.jsxs("span",{className:"text-[10px] text-gray-900 dark:text-gray-300 font-medium",children:["الحد: ",y.toLocaleString("en-US",{maximumFractionDigits:0})]})]})]})]})]})]}):null})(),R==="transfer"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"رقم المرسل"}),e.jsxs("div",{className:"relative group",children:[e.jsx(Gn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-green-600 group-focus-within:text-green-700"}),e.jsx(Y,{value:Ut,onChange:a=>bs(a.target.value),onKeyDown:a=>{if(a.key==="Enter"){const r=document.getElementById("receiverPhoneInput");if(r)r.focus();else{const i=document.getElementById("amountInput");i==null||i.focus()}}},placeholder:"01030302038",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-blue-600 focus:ring-1 focus:ring-blue-600 dark:text-gray-100"})]})]}),!o&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"رقم المستقبل"}),e.jsxs("div",{className:"relative group",children:[e.jsx(Gn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-green-600 group-focus-within:text-green-700"}),e.jsx(Y,{id:"receiverPhoneInput",value:pt,onChange:a=>{ir(a.target.value),Ui&&Ss(!1)},onKeyDown:a=>{if(a.key==="Enter"){const r=document.getElementById("amountInput");r==null||r.focus()}},inputMode:"numeric",maxLength:11,placeholder:"أدخل رقم المستقبل",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-blue-600 focus:ring-1 focus:ring-blue-600 dark:text-gray-100"})]})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"رقم المستقبل"}),e.jsxs("div",{className:"relative",children:[e.jsx(Gn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-400"}),e.jsx(Y,{value:E&&((kd=F.find(a=>a.id===E))==null?void 0:kd.phone)||"",readOnly:!0,placeholder:"اختر محفظة أولاً",className:"pl-10 h-10 text-sm lg:text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl dark:text-gray-100"})]})]}),R==="transfer"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"المبلغ (جنيه)"}),e.jsxs("div",{className:"relative flex items-center gap-2 group",children:[e.jsx(Pa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-yellow-600 group-focus-within:text-yellow-700"}),e.jsx(Y,{id:"amountInput",value:ot,onChange:a=>{vs(a.target.value),Ui&&Ss(!1)},onKeyDown:a=>{if(a.key==="Enter"){const r=document.getElementById("transferCommissionInput");if(r)r.focus();else{const i=document.getElementById("quickDebtButton");i==null||i.focus()}}},placeholder:"أدخل المبلغ",type:"number",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-blue-600 focus:ring-1 focus:ring-blue-600 dark:text-gray-100"})]}),aa?e.jsxs("div",{className:"mt-2 text-xs text-green-700 dark:text-green-400 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-900/30 rounded px-2 py-1 flex items-center gap-2",children:[e.jsxs("span",{children:["تم إدخال تفاصيل الأجل لـ ",aa.debtorName," بمبلغ ",aa.amount," جنيه"]}),e.jsx(I,{type:"button",variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>Ii(null),children:"إلغاء"})]}):null]}),(()=>{if(o)return null;const a=Ge();return a&&a.defaultTransferCommission!=null?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"عمولة التحويل (تلقائية)"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["سيتم تطبيق عمولة التحويل الافتراضية لكل ألف: ",a==null?void 0:a.defaultTransferCommission," جنيه لكل ألف"]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(I,{id:"quickDebtButton",type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium",onClick:()=>{const i=Ge(),l=(i==null?void 0:i.defaultTransferCommission)!=null?Number(i.defaultTransferCommission):0,d=parseFloat(ot||"0")||0,m=Math.round((l||0)*d/1e3*100)/100,h=d+m;Ja((h||0).toString()),we?p({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):ws(!0)},children:"أجل"}),e.jsx(I,{type:"button",variant:"outline",size:"icon",className:"hidden",title:$e?"العمولة تُضاف":"العمولة تُخصم",children:$e?e.jsx(jt,{className:"h-4 w-4 text-green-600"}):e.jsx(ei,{className:"h-4 w-4 text-red-600"})}),e.jsx("span",{className:"hidden",children:$e?"العمولة تُضاف":"العمولة تُخصم"})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"عمولة التحويل على العملية (جنيه)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(Pa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-yellow-600 group-focus-within:text-yellow-700"}),e.jsx(Y,{id:"transferCommissionInput",value:xt,onChange:i=>mn(i.target.value),placeholder:"أدخل عمولة التحويل",type:"number",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-orange-500 focus:ring-1 focus:ring-orange-500 dark:text-gray-100"})]}),e.jsx(I,{type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium dark:bg-red-700 dark:hover:bg-red-800",onClick:()=>{const i=Ge(),l=parseFloat(ot||"0")||0;let d=0;if((i==null?void 0:i.defaultTransferCommission)!=null){const h=Number(i.defaultTransferCommission)||0;d=Math.round(h*l/1e3*100)/100}else{const h=xt&&xt.trim()!==""?parseFloat(xt):0;d=Math.max(0,h)}const m=l+d;Ja((m||0).toString()),we?p({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):ws(!0)},children:"أجل"}),e.jsx(I,{type:"button",variant:"outline",size:"icon",className:"hidden",title:$e?"العمولة تُضاف":"العمولة تُخصم",children:$e?e.jsx(jt,{className:"h-4 w-4 text-green-600"}):e.jsx(ei,{className:"h-4 w-4 text-red-600"})}),e.jsx("span",{className:"hidden",children:$e?"العمولة تُضاف":"العمولة تُخصم"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"يمكنك إدخال عمولة العملية الإجمالية (اختياري)"})]})})(),Lm&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"رسوم التحويل (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-yellow-600"}),e.jsx(Y,{id:"transferExtraFeeInput",value:tc,onChange:a=>Em(a.target.value),placeholder:"أدخل رسوم التحويل",type:"number",className:"pl-10 h-10 text-sm lg:text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 hover:border-blue-400 focus:border-blue-500 dark:text-gray-100"})]}),e.jsx("div",{className:"hidden",children:"تُخصم من المحفظة وتضاف للدرج — لعمليات 010 → 011/012/015 أو 012 → 010 أو 011 → 010 أو 015 → 010"})]}),e.jsxs("div",{className:"sticky bottom-0 z-20 pt-2 pb-2 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 backdrop-blur supports-[backdrop-filter]:bg-white/90 dark:supports-[backdrop-filter]:bg-gray-900/90",children:[e.jsx(I,{id:"transferSubmitButton",onClick:Sd,className:"w-full h-12 text-base font-medium rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-none hover:shadow-md",children:Ui?"تم التحويل بنجاح":"تأكيد التحويل"}),Mm&&e.jsxs("div",{className:"flex items-start gap-2 mt-2 px-1",children:[e.jsx(Bd,{className:"h-4 w-4 text-amber-500 shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-gray-500 leading-tight",children:["تم الوصول إلى 85% من الحد الشهري للمحفظة ",Ai==null?void 0:Ai.walletName]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"مبلغ السحب (جنيه)"}),e.jsxs("div",{className:"relative group",children:[e.jsx(Vs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-primary"}),e.jsx(Y,{id:"amountInput",value:ot,onChange:a=>{vs(a.target.value),Vi&&fr(!1)},onKeyDown:a=>{if(a.key==="Enter"){const r=document.getElementById("manualWithdrawCommissionInput");if(r)r.focus();else{const i=document.getElementById("withdrawSubmitButton");i==null||i.focus()}}},placeholder:"أدخل مبلغ السحب",type:"number",className:"pl-10 h-10 text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 focus:border-primary focus:ring-1 focus:ring-primary dark:text-gray-100"})]})]}),Wm&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"اسم الراسل (اختياري)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Fr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-gray-500"}),e.jsx(Y,{id:"withdrawSenderNameInput",value:or,onChange:a=>Hl(a.target.value),onKeyDown:a=>{if(a.key==="Enter"){const r=document.getElementById("manualWithdrawCommissionInput");r==null||r.focus()}},placeholder:"أدخل اسم الراسل إن وجد",className:"pl-10 h-10 text-sm lg:text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 hover:border-blue-400 focus:border-blue-500 dark:text-gray-100",type:"text"})]})]}),(()=>{const a=Ge();return a&&a.defaultWithdrawCommission!=null?e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"عمولة السحب (تلقائية)"}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["سيتم تطبيق عمولة السحب الافتراضية لكل ألف: ",a==null?void 0:a.defaultWithdrawCommission," جنيه لكل ألف"]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(I,{type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium",onClick:()=>{const i=Ge(),l=parseFloat(ot||"0")||0,d=(i==null?void 0:i.defaultWithdrawCommission)!=null&&Number(i.defaultWithdrawCommission)||0,m=Math.round(d*l/1e3*100)/100,h=$e?l+m:l;Ja((h||0).toString()),we?p({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):ws(!0)},children:"أجل"}),e.jsx(I,{type:"button",variant:sa?"default":"outline",size:"sm",className:sa?"bg-green-600 hover:bg-green-700 text-white font-medium ring-2 ring-green-400 ring-offset-2":"bg-blue-600 hover:bg-blue-700 text-white font-medium",onClick:()=>qi(!sa),children:sa?"إلغاء خصم العموله":"خصم العموله"})]}),sa&&e.jsxs("div",{className:"mt-2 text-sm font-semibold text-green-600 animate-in fade-in slide-in-from-top-1",children:["سيتم تسليم العميل: ",(()=>{const i=Ge(),l=parseFloat(ot||"0")||0,d=(i==null?void 0:i.defaultWithdrawCommission)!=null&&Number(i.defaultWithdrawCommission)||0,m=Math.round(d*l/1e3*100)/100;return Math.round((l-m)*100)/100})()," جنيه"]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"عمولة السحب على العملية (جنيه)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-1 w-1 text-yellow-600"}),e.jsx(Y,{id:"manualWithdrawCommissionInput",value:st,onChange:i=>un(i.target.value),onKeyDown:i=>{if(i.key==="Enter"){const l=document.getElementById("withdrawSubmitButton");l==null||l.focus()}},placeholder:"أدخل العمولة المطلوبة",type:"number",className:"pl-10 h-10 md:h-11 lg:h-12 text-sm lg:text-base bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 shadow-inner rounded-xl focus:bg-white dark:focus:bg-gray-800 hover:border-blue-400 focus:border-blue-500 dark:text-gray-100"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"أدخل العمولة الإجمالية لإتمام عملية السحب"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(I,{type:"button",variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white font-medium",onClick:()=>{const i=Ge(),l=parseFloat(ot||"0")||0;let d=0;if((i==null?void 0:i.defaultWithdrawCommission)!=null){const h=Number(i.defaultWithdrawCommission)||0;d=Math.round(h*l/1e3*100)/100}else{const h=st&&st.trim()!==""?parseFloat(st):Math.round(l*.01*100)/100;d=Math.max(0,h)}const m=$e?l+d:l;Ja((m||0).toString()),we?p({title:"غير متاح",description:"الأجل السريع غير متاح في خطة زيرو. قم بالترقية.",variant:"destructive"}):ws(!0)},children:"أجل"}),e.jsx(I,{type:"button",variant:sa?"default":"outline",size:"sm",className:sa?"bg-green-600 hover:bg-green-700 text-white font-medium ring-2 ring-green-400 ring-offset-2":"bg-blue-600 hover:bg-blue-700 text-white font-medium",onClick:()=>qi(!sa),children:sa?"إلغاء خصم العموله":"خصم العموله"})]}),sa&&e.jsxs("div",{className:"mt-2 text-sm font-semibold text-green-600 animate-in fade-in slide-in-from-top-1",children:["سيتم تسليم العميل: ",(()=>{const i=parseFloat(ot||"0")||0,l=st&&st.trim()!==""?parseFloat(st):Math.round(i*.01*100)/100,d=Math.max(0,l);return Math.round((i-d)*100)/100})()," جنيه"]})]})})(),(n==null?void 0:n.showWithdrawNote)&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 block",children:"ملاحظة السحب (اختياري)"}),e.jsxs("div",{className:"relative group",children:[e.jsx(zo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-primary"}),e.jsx(Y,{id:"withdrawNoteInput",value:Ka,onChange:a=>Jl(a.target.value),onKeyDown:a=>{if(a.key==="Enter"){const r=document.getElementById("withdrawSubmitButton");r==null||r.focus()}},placeholder:"أدخل ملاحظة للسحب (اختياري)",className:"pl-10 h-10 text-base border-gray-400 dark:border-gray-600 rounded-xl focus:border-primary focus:ring-1 focus:ring-primary bg-white dark:bg-gray-900 dark:text-gray-100 dark:placeholder:text-gray-400"})]})]}),e.jsx("div",{className:"sticky bottom-0 z-20 pt-2 pb-2 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 backdrop-blur supports-[backdrop-filter]:bg-white/90 dark:supports-[backdrop-filter]:bg-gray-900/90",children:e.jsx(I,{id:"withdrawSubmitButton",onClick:Sd,disabled:Be||Vi,className:"w-full font-medium h-11 lg:h-12 text-sm lg:text-base bg-green-600 hover:bg-green-700 text-white disabled:opacity-70 disabled:cursor-not-allowed",children:Be?"جاري التنفيذ...":Vi?ch||"تم السحب بنجاح":"تأكيد السحب"})})]}),e.jsx(fe,{open:Si,onOpenChange:ws,children:e.jsxs(ge,{children:[e.jsxs(ye,{children:[e.jsx(be,{children:"تحويل مؤجل"}),e.jsx(at,{children:"أدخل بيانات صاحب الدين والمبلغ والملاحظات ثم اضغط حفظ"})]}),e.jsxs("div",{className:"space-y-3",children:[It&&It.length>0?e.jsxs("div",{children:[e.jsx(Z,{children:"اختيار عميل"}),e.jsxs(Ws,{value:Ci,onValueChange:a=>{_m(a);const r=It.find(i=>i.id===a);r&&ki(r.name)},children:[e.jsx(Rs,{className:"w-full",children:e.jsx(Ls,{placeholder:"اختر عميل"})}),e.jsx(Fs,{children:It.map(a=>e.jsxs(Ta,{value:a.id,children:[a.name,a.mobile?` — ${a.mobile}`:""]},a.id))})]})]}):e.jsx("div",{className:"text-xs text-gray-500",children:"لا يوجد عملاء مُسجلين حالياً. يمكنك إضافة عميل من نافذة الديون."}),e.jsxs("div",{children:[e.jsx(Z,{htmlFor:"quickDebtName",children:"اسم صاحب الدين"}),e.jsx(Y,{id:"quickDebtName",value:Di,onChange:a=>ki(a.target.value),placeholder:"اكتب الاسم"})]}),e.jsxs("div",{children:[e.jsx(Z,{htmlFor:"quickDebtAmount",children:"المبلغ (محسوب تلقائياً)"}),e.jsx(Y,{id:"quickDebtAmount",type:"number",value:Im,readOnly:!0,placeholder:"المبلغ + عمولة التحويل"})]}),e.jsxs("div",{children:[e.jsx(Z,{htmlFor:"quickDebtCommission",children:"العمولة (محسوبة تلقائياً)"}),e.jsx(Y,{id:"quickDebtCommission",type:"number",value:function(){const a=Ge(),r=parseFloat((ot||"0").toString())||0;let i=0;if(R==="transfer")if((a==null?void 0:a.defaultTransferCommission)!=null){const l=Number(a.defaultTransferCommission)||0;i=Math.round(l*r/1e3*100)/100}else{const l=xt&&xt.trim()!==""?parseFloat(xt):0;i=Math.max(0,l)}else if((a==null?void 0:a.defaultWithdrawCommission)!=null){const l=Number(a.defaultWithdrawCommission)||0;i=Math.round(l*r/1e3*100)/100}else{const l=st&&st.trim()!==""?parseFloat(st):Math.round(r*.01*100)/100;i=Math.max(0,l)}return String(i||0)}(),readOnly:!0,placeholder:"قيمة العمولة",className:"dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300"})]}),e.jsxs("div",{children:[e.jsx(Z,{htmlFor:"quickDebtNotes",children:"ملاحظات"}),e.jsx(Y,{id:"quickDebtNotes",value:Ql,onChange:a=>Gl(a.target.value),placeholder:"اكتب ملاحظات (اختياري)"})]})]}),e.jsx(Pe,{children:e.jsx(I,{type:"button",variant:"default",className:"bg-green-600 text-white hover:bg-green-700",onClick:()=>{const a=Ge(),r=parseFloat((ot||"").toString())||0;let i=0;if(R==="transfer")if((a==null?void 0:a.defaultTransferCommission)!=null){const m=Number(a.defaultTransferCommission)||0;i=Math.round(m*r/1e3*100)/100}else{const m=xt&&xt.trim()!==""?parseFloat(xt):0;i=Math.max(0,m)}else if((a==null?void 0:a.defaultWithdrawCommission)!=null){const m=Number(a.defaultWithdrawCommission)||0;i=Math.round(m*r/1e3*100)/100}else{const m=st&&st.trim()!==""?parseFloat(st):Math.round(r*.01*100)/100;i=Math.max(0,m)}let l=0;if(R==="withdraw"?l=$e?r:Math.max(0,Math.round((r-i)*100)/100):l=Math.max(0,Math.round((r+i)*100)/100),!Di||isNaN(l)||l<=0){p({title:"خطأ في بيانات الأجل",description:"يرجى إدخال الاسم والمبلغ بشكل صحيح",variant:"destructive"});return}const d=It.find(m=>m.id===Ci);Ii({debtorName:Di,amount:l,notes:Ql,customerId:Ci||void 0,mobile:d==null?void 0:d.mobile}),Xl(!1),ws(!1),p({title:"تم حفظ بيانات الأجل",description:"سيتم إضافة الدين عند تأكيد العملية",variant:"default"})},children:"حفظ"})})]})})]})]}),e.jsx(Ca,{className:"bg-gradient-to-br from-red-50 to-red-100 border-red-200 fade-in-up card-float",children:e.jsxs(Ia,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-red-600 font-medium text-[10px] mb-1",children:"⚠️ تحذير من التحويل"}),e.jsx("div",{className:"text-[10px] text-red-700",children:"لا يمكن إلغاء أي عملية بعد تأكيدها للمحافظة على الأمان"})]})})]})]}),e.jsx(nb,{isOpen:Ym,onClose:()=>Km(!1),initialEditingWallet:Hm,onWalletUpdate:async()=>{try{await Vo()}catch(a){console.error("Error reloading wallets after update:",a)}}}),e.jsx(ib,{isOpen:Zm,onClose:()=>lc(!1),transaction:Xm,onDelete:T0}),e.jsx(la,{open:rh,onOpenChange:ur,onSuccess:W0,title:R0(),description:L0(),mode:"verify"}),e.jsx(uu,{open:Xh,onOpenChange:Yc,onSuccess:B0,title:"تعديل الرصيد النقدي في الدرج",description:"أدخل الرقم السري والمبلغ الجديد لتعديل الرصيد النقدي في الدرج",currentBalance:We,balanceLabel:"الرصيد النقدي",userId:t==null?void 0:t.uid}),e.jsx(uu,{open:Zh,onOpenChange:Kc,onSuccess:$0,title:"تعديل رصيد المحفظة",description:"أدخل الرقم السري والمبلغ الجديد لتعديل رصيد المحفظة",currentBalance:Wt&&ve[Wt]||0,balanceLabel:`رصيد ${((Cd=F.find(a=>a.id===Wt))==null?void 0:Cd.name)||"المحفظة"}`,userId:t==null?void 0:t.uid}),e.jsx(mb,{open:e0,onOpenChange:wo,onSuccess:U0,title:"إضافة أو خصم مبلغ من رصيد المحفظة",description:"أدخل الرقم السري والمبلغ المراد إضافته أو خصمه من رصيد المحفظة",currentBalance:Wt&&ve[Wt]||0,balanceLabel:`رصيد ${((Id=F.find(a=>a.id===Wt))==null?void 0:Id.name)||"المحفظة"}`,userId:t==null?void 0:t.uid}),e.jsx(lb,{open:m0,onOpenChange:h0,userId:t==null?void 0:t.uid}),e.jsx(cb,{open:f0,onOpenChange:g0,userId:t==null?void 0:t.uid}),e.jsx(db,{open:p0,onOpenChange:x0}),e.jsx(fe,{open:s0,onOpenChange:_n,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(ye,{children:e.jsx(be,{className:"text-right",children:"تعديل الدرج النقدية"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{htmlFor:"amount",className:"text-right block",children:"المبلغ"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(Y,{id:"amount",type:"number",placeholder:"أدخل المبلغ",value:jo,onChange:a=>Tn(a.target.value),className:"text-right flex-1",dir:"rtl",min:"0"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(I,{type:"button",size:"sm",className:"bg-green-600 hover:bg-green-700 text-white px-3 py-2",onClick:async()=>{if(!await Yn(Eo)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}const a=parseFloat(jo);if(isNaN(a)||a<=0){p({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const r=We+a;Ze(r);const i={cashBalance:r,lastUpdated:new Date().toISOString()},l=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(l,JSON.stringify(i)),t!=null&&t.uid?se.updateUserData(t.uid,i).then(()=>{console.log("✅ تم حفظ رصيد الدرج النقدي في Firebase بنجاح"),localStorage.removeItem(l),me(!1)}).catch(d=>{console.error("❌ خطأ في حفظ الرصيد في Firebase:",d),me(!0)}):me(!0),p({title:"تم بنجاح",description:`تم إضافة ${a} جنيه إلى الدرج النقدية وحفظه في السحابة`}),_n(!1),Tn(""),Mn("")},children:[e.jsx(jt,{className:"h-1 w-1 mr-1"}),"إضافة"]}),e.jsxs(I,{type:"button",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white px-3 py-2",onClick:async()=>{if(!await Yn(Eo)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}const a=parseFloat(jo);if(isNaN(a)||a<=0){p({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const r=We-a;Ze(r);const i={cashBalance:r,lastUpdated:new Date().toISOString()},l=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(l,JSON.stringify(i)),t!=null&&t.uid?se.updateUserData(t.uid,i).then(()=>{console.log("✅ تم حفظ رصيد الدرج النقدي في Firebase بنجاح"),localStorage.removeItem(l),me(!1)}).catch(d=>{console.error("❌ خطأ في حفظ الرصيد في Firebase:",d),me(!0)}):me(!0),p({title:"تم بنجاح",description:`تم خصم ${a} جنيه من الدرج النقدية وحفظه في السحابة`}),_n(!1),Tn(""),Mn("")},children:[e.jsx(ei,{className:"h-1 w-1 mr-1"}),"خصم"]})]})]}),e.jsxs("p",{className:"text-[10px] text-gray-500 text-right",children:["الرصيد الحالي: ",We.toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{htmlFor:"pin",className:"text-right block",children:"الرقم السري"}),e.jsx(Y,{id:"pin",type:"password",placeholder:"أدخل الرقم السري",value:Eo,onChange:a=>Mn(a.target.value),className:"text-right",dir:"rtl"})]})]}),e.jsx(Pe,{className:"flex gap-2",children:e.jsx(I,{variant:"outline",onClick:()=>{_n(!1),Tn(""),Mn("")},children:"إلغاء"})})]})}),e.jsx(fe,{open:S0,onOpenChange:Vn,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(ye,{children:e.jsx(be,{className:"text-right text-red-600",children:"تصفير إجمالي المحفظة"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-red-800 font-medium mb-2",children:"تحذير!"}),e.jsx("p",{className:"text-red-700 text-sm",children:"سيتم تصفير جميع أرصدة المحافظ إلى صفر. هذا الإجراء لا يمكن التراجع عنه."}),e.jsxs("p",{className:"text-red-600 text-sm mt-2",children:["الرصيد الحالي: ",F.reduce((a,r)=>a+(Number(ve[r.id])||0),0).toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{htmlFor:"resetWalletTotalPin",className:"text-right block",children:"الرقم السري الرئيسي"}),e.jsx(Y,{id:"resetWalletTotalPin",type:"password",placeholder:"أدخل الرقم السري الرئيسي",value:bd,onChange:a=>qn(a.target.value),className:"text-right",dir:"rtl"})]})]}),e.jsxs(Pe,{className:"flex gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{Vn(!1),qn("")},children:"إلغاء"}),e.jsx(I,{variant:"destructive",onClick:async()=>{if(!await Rt.verifyMasterPin(bd,t==null?void 0:t.uid)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}try{const r={};Object.keys(ve).forEach(m=>{r[m]=0}),ct(r),localStorage.setItem(et(),JSON.stringify(r)),Vn(!1),qn("");const i=new Date().toISOString(),l={walletBalances:r,lastUpdated:i},d=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(d,JSON.stringify(l)),t!=null&&t.uid?se.updateUserData(t.uid,l).then(()=>{localStorage.removeItem(d),me(!1)}).catch(m=>{console.error("خطأ في حفظ أرصدة المحافظ في Firebase:",m),me(!0),p({title:"تنبيه",description:"تم التصفير محلياً، سيتم المزامنة مع الخادم قريباً",variant:"default"})}):me(!0),setTimeout(()=>{ct({...r})},100)}catch(r){console.error("خطأ في تصفير أرصدة المحافظ:",r),p({title:"خطأ",description:"حدث خطأ أثناء تصفير المحافظ",variant:"destructive"})}},children:"تصفير المحفظة"})]})]})}),e.jsx(fe,{open:t0,onOpenChange:In,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(ye,{children:e.jsx(be,{className:"text-right text-red-600",children:"تصفير رصيد المحفظة المختارة"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"text-red-800 font-medium mb-2",children:"تحذير!"}),e.jsx("p",{className:"text-red-700 text-sm",children:"سيتم تصفير رصيد المحفظة المحددة إلى صفر. هذا الإجراء لا يمكن التراجع عنه."}),e.jsxs("p",{className:"text-red-600 text-sm mt-2",children:["المحفظة: ",((_d=F.find(a=>a.id===E))==null?void 0:_d.name)||E]}),e.jsxs("p",{className:"text-red-600 text-sm",children:["الرصيد الحالي: ",(E&&ve[E]?ve[E]:0).toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{htmlFor:"resetSelectedWalletPin",className:"text-right block",children:"الرقم السري الرئيسي"}),e.jsx(Y,{id:"resetSelectedWalletPin",type:"password",autoComplete:"off",placeholder:"أدخل الرقم السري الرئيسي",value:Jc,onChange:a=>No(a.target.value),className:"text-right",dir:"rtl"})]})]}),e.jsxs(Pe,{className:"flex gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{In(!1),No("")},children:"إلغاء"}),e.jsx(I,{variant:"destructive",onClick:async()=>{var r;if(!E){p({title:"اختر محفظة",description:"يرجى اختيار محفظة أولاً",variant:"destructive"});return}if(!await Rt.verifyMasterPin(Jc,t==null?void 0:t.uid)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}try{const i={...ve};i[E]=0,ct(i),localStorage.setItem(et(),JSON.stringify(i)),In(!1),No("");const l=new Date().toISOString(),d={walletBalances:i,lastUpdated:l},m=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(m,JSON.stringify(d)),t!=null&&t.uid?se.updateUserData(t.uid,d).then(()=>{localStorage.removeItem(m),me(!1)}).catch(h=>{console.error("خطأ في حفظ أرصدة المحافظ في Firebase:",h),me(!0),p({title:"تنبيه",description:"تم التصفير محلياً، سيتم المزامنة مع الخادم قريباً",variant:"default"})}):me(!0),p({title:"تم التصفير بنجاح",description:`تم تصفير رصيد المحفظة ${((r=F.find(h=>h.id===E))==null?void 0:r.name)||E}`})}catch(i){console.error("خطأ في تصفير رصيد المحفظة المختارة:",i),p({title:"خطأ",description:"حدث خطأ أثناء تصفير رصيد المحفظة المختارة",variant:"destructive"})}},children:"تصفير المحفظة"})]})]})}),e.jsx(mu,{isOpen:J,onClose:()=>te(!1),wallets:F}),e.jsx(fe,{open:v0,onOpenChange:Bn,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(ye,{children:e.jsxs(be,{className:"text-right text-green-600 flex items-center gap-2 justify-end",children:[e.jsx(jt,{className:"h-4 w-4"}),"إضافة أموال لإجمالي المحفظة"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-green-800 font-medium mb-2",children:"إضافة أموال"}),e.jsx("p",{className:"text-green-700 text-sm",children:"سيتم إضافة المبلغ المحدد إلى إجمالي المحفظة بشكل متناسب على جميع المحافظ."}),e.jsxs("p",{className:"text-green-600 text-sm mt-2",children:["الرصيد الحالي: ",F.reduce((a,r)=>a+(Number(ve[r.id])||0),0).toLocaleString()," جنيه"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"addWalletTotalAmount",className:"text-right block",children:"المبلغ المراد إضافته"}),e.jsx(Y,{id:"addWalletTotalAmount",type:"number",placeholder:"أدخل المبلغ",value:cd,onChange:a=>Wo(a.target.value),className:"text-right",dir:"rtl"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"addWalletTotalPin",className:"text-right block",children:"الرقم السري للتأكيد"}),e.jsx(Y,{id:"addWalletTotalPin",type:"password",autoComplete:"off",placeholder:"أدخل الرقم السري",value:dd,onChange:a=>Ro(a.target.value),className:"text-right",dir:"rtl"})]})]})]}),e.jsxs(Pe,{className:"flex gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{Bn(!1),Wo(""),Ro("")},children:"إلغاء"}),e.jsx(I,{variant:"default",className:"bg-green-600 hover:bg-green-700",disabled:ud,onClick:async()=>{const a=parseFloat(cd);if(!a||a<=0){p({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}if(!await I0(dd)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}md(!0);try{const r=F.reduce((l,d)=>l+(Number(ve[d.id])||0),0),i={...ve};if(r===0){if(F.length>0){const l=a/F.length;F.forEach(d=>{i[d.id]=(Number(i[d.id])||0)+l})}}else F.forEach(l=>{const d=Number(ve[l.id])||0,m=d/r,h=a*m;i[l.id]=d+h});ct(i),localStorage.setItem(et(),JSON.stringify(i)),t!=null&&t.uid?await se.updateUserData(t.uid,{walletBalances:i,lastUpdated:new Date().toISOString()}):me(!0),setTimeout(()=>{ct(l=>({...l}))},100),Bn(!1),Wo(""),Ro("")}catch(r){console.error("خطأ في حفظ أرصدة المحافظ في Firebase:",r),p({title:"خطأ",description:"حدث خطأ أثناء حفظ البيانات",variant:"destructive"})}finally{md(!1)}},children:ud?"جاري الإضافة...":"إضافة الأموال"})]})]})}),e.jsx(fe,{open:D0,onOpenChange:zn,children:e.jsxs(ge,{className:"sm:max-w-[425px]",children:[e.jsx(ye,{children:e.jsxs(be,{className:"text-red-600 flex items-center gap-2",children:[e.jsx(oa,{className:"h-1 w-1"}),"تصفير الرصيد النقدي"]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-700",children:"⚠️ تحذير: سيتم تصفير الرصيد النقدي في الدرج إلى صفر. هذا الإجراء لا يمكن التراجع عنه."})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{htmlFor:"resetCashPin",children:"الرقم السري الرئيسي"}),e.jsx(Y,{id:"resetCashPin",type:"password",autoComplete:"off",placeholder:"أدخل الرقم السري الرئيسي",value:Lo,onChange:a=>Fo(a.target.value)})]})]}),e.jsxs(Pe,{children:[e.jsx(I,{variant:"outline",onClick:()=>{zn(!1),Fo("")},children:"إلغاء"}),e.jsx(I,{variant:"destructive",onClick:async()=>{if(!Lo){p({title:"خطأ",description:"يرجى إدخال الرقم السري",variant:"destructive"});return}if(!await Rt.verifyMasterPin(Lo,t==null?void 0:t.uid)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}try{Ze(0),zn(!1),Fo("");const r={cashBalance:0,lastUpdated:new Date().toISOString()};localStorage.setItem(Ve(),"0"),localStorage.setItem(Ve()+"_lastUpdated",r.lastUpdated);const i=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(i,JSON.stringify(r)),t!=null&&t.uid?se.updateUserData(t.uid,r).then(()=>{localStorage.removeItem(i),me(!1)}).catch(l=>{console.error("خطأ في حفظ الرصيد في Firebase:",l),me(!0),p({title:"تنبيه",description:"تم التصفير محلياً، سيتم المزامنة مع الخادم قريباً",variant:"default"})}):me(!0)}catch(r){console.error("خطأ في تصفير الرصيد النقدي:",r),p({title:"خطأ",description:"حدث خطأ أثناء تصفير الرصيد النقدي",variant:"destructive"})}},children:"تصفير الرصيد"})]})]})}),e.jsx(gb,{open:b0,onOpenChange:ld,userId:t==null?void 0:t.uid,cashBalance:We,walletBalances:ve,transactions:ie}),e.jsx(fe,{open:y0,onOpenChange:Cr,children:e.jsxs(ge,{className:"sm:max-w-[425px]",children:[e.jsx(ye,{children:e.jsxs(be,{className:"text-green-600 flex items-center gap-2",children:[e.jsx(jt,{className:"h-4 w-4"}),"إضافة أموال للدرج"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-green-700",children:"💰 سيتم إضافة المبلغ المحدد إلى الرصيد النقدي في الدرج"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"addCashAmount",children:"المبلغ المراد إضافته"}),e.jsx(Y,{id:"addCashAmount",type:"number",placeholder:"أدخل المبلغ",value:Za,onChange:a=>Wn(a.target.value),min:"0",step:"0.01"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-right",children:"هل تريد إضافة ملاحظة؟"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{type:"button",variant:_r==="yes"?"default":"outline",onClick:()=>Tr("yes"),className:"flex-1",children:"نعم"}),e.jsx(I,{type:"button",variant:_r==="no"?"default":"outline",onClick:async()=>{if(Tr("no"),!Za||parseFloat(Za)<=0){p({title:"خطأ",description:"يرجى إدخال مبلغ صحيح أكبر من صفر",variant:"destructive"});return}if(!Ir){p({title:"خطأ",description:"يرجى إدخال الرقم السري",variant:"destructive"});return}if(!await Yn(Ir)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}Ln(!0);try{const a=parseFloat(Za),r=We+a;Ze(r);const i=new Date().toISOString();localStorage.setItem(Ve(),r.toString()),localStorage.setItem(Ve()+"_lastUpdated",i);const l={cashBalance:r,lastUpdated:i},d=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(d,JSON.stringify(l));const m=`CASHADD-${(t==null?void 0:t.uid)||"anon"}-${Date.now()}`;Cr(!1),Wn(""),Rn(""),Tr(null),Fn("");const h=[];if(t!=null&&t.uid){h.push(se.updateUserData(t.uid,l).then(()=>{localStorage.removeItem(d),me(!1)}).catch(()=>{me(!0)}));const g={txnType:"cash_addition",type:"cash_addition",amount:a,status:"confirmed",senderMsisdn:"إضافة نقدية",receiverMsisdn:"",reference:m,title:"إيصال إضافة نقدية",merchantUserId:t.uid,createdBy:t.uid,shopId:(n==null?void 0:n.shopId)||void 0};h.push(se.saveUserTransaction(t.uid,g));const v=n==null?void 0:n.shopId;if(v){const y=Te(V,"dashboardData",v);h.push(Xt(y,{cashBalance:r}))}}Promise.allSettled(h).then(()=>{}).catch(()=>{})}catch{Ze(We),localStorage.setItem("cashBalance",We.toString()),p({title:"خطأ",description:"حدث خطأ أثناء حفظ البيانات، يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{Ln(!1)}},className:"flex-1",children:"لا"})]})]}),_r==="yes"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"addCashNote",children:"الملاحظة"}),e.jsx(Y,{id:"addCashNote",type:"text",placeholder:"اكتب الملاحظة",value:Mo,onChange:a=>Fn(a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"addCashPin",children:"الرقم السري لدرج النقدية"}),e.jsx(Y,{id:"addCashPin",type:"password",placeholder:"أدخل الرقم السري",value:Ir,onChange:a=>Rn(a.target.value)})]})]}),e.jsxs(Pe,{children:[e.jsx(I,{variant:"outline",onClick:()=>{Cr(!1),Wn(""),Rn(""),Tr(null),Fn("")},children:"إلغاء"}),e.jsx(I,{variant:"default",className:"bg-green-600 hover:bg-green-700",disabled:od,onClick:async()=>{if(!Za||parseFloat(Za)<=0){p({title:"خطأ",description:"يرجى إدخال مبلغ صحيح أكبر من صفر",variant:"destructive"});return}if(!Ir){p({title:"خطأ",description:"يرجى إدخال الرقم السري",variant:"destructive"});return}if(!await Yn(Ir)){p({title:"خطأ",description:"الرقم السري غير صحيح",variant:"destructive"});return}if(_r==="yes"&&Mo.trim().length===0){p({title:"تنبيه",description:"أدخل الملاحظة أو اختر لا",variant:"destructive"});return}Ln(!0);try{const a=parseFloat(Za),r=We+a;Ze(r);const i=new Date().toISOString();localStorage.setItem(Ve(),r.toString()),localStorage.setItem(Ve()+"_lastUpdated",i);const l={cashBalance:r,lastUpdated:i},d=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(d,JSON.stringify(l));const m=`CASHADD-${(t==null?void 0:t.uid)||"anon"}-${Date.now()}`;Cr(!1),Wn(""),Rn(""),Tr(null),Fn("");const h=[];if(t!=null&&t.uid){h.push(se.updateUserData(t.uid,l).then(()=>{localStorage.removeItem(d),me(!1)}).catch(()=>{me(!0)}));const g={txnType:"cash_addition",type:"cash_addition",amount:a,status:"confirmed",senderMsisdn:"إضافة نقدية",receiverMsisdn:"",reference:m,note:_r==="yes"?Mo.trim():void 0,title:"إيصال إضافة نقدية",merchantUserId:t.uid,createdBy:t.uid,shopId:(n==null?void 0:n.shopId)||void 0};h.push(se.saveUserTransaction(t.uid,g));const v=n==null?void 0:n.shopId;if(v){const y=Te(V,"dashboardData",v);h.push(Xt(y,{cashBalance:r}))}}Promise.allSettled(h).then(()=>{}).catch(()=>{})}catch{Ze(We),localStorage.setItem("cashBalance",We.toString()),p({title:"خطأ",description:"حدث خطأ أثناء حفظ البيانات، يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{Ln(!1)}},children:od?"جاري الإضافة...":"إضافة الأموال"})]})]})}),e.jsx(fe,{open:Gh,onOpenChange:vo,children:e.jsxs(ge,{className:"sm:max-w-md",children:[e.jsx(ye,{children:e.jsx(be,{className:"text-right",children:"اختيار التاريخ والوقت للبحث"})}),e.jsxs("div",{className:"space-y-1 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{htmlFor:"search-date",className:"text-right block",children:"التاريخ"}),e.jsx(Y,{id:"search-date",type:"date",value:xn,onChange:a=>hc(a.target.value),className:"text-right"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{htmlFor:"search-time",className:"text-right block",children:"الوقت (اختياري)"}),e.jsx(Y,{id:"search-time",type:"time",value:yn,onChange:a=>fc(a.target.value),className:"text-right",placeholder:"اختر الوقت للبحث في ساعة محددة"}),e.jsx("p",{className:"text-[10px] text-gray-500 text-right",children:"إذا لم تختر وقتاً محدداً، سيتم البحث في كامل اليوم"})]})]}),e.jsxs(Pe,{className:"flex justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>{hc(""),fc(""),vo(!1)},children:"مسح"}),e.jsx(I,{onClick:()=>vo(!1),children:"تطبيق"})]})]})}),e.jsx(hb,{isOpen:fh,onClose:()=>Ji(!1)}),e.jsx(fb,{isOpen:Li,onClose:()=>js(!1),initialBarcode:qm}),e.jsx(pb,{isOpen:xh,onClose:()=>pr(!1)}),e.jsx(yb,{open:yh,onOpenChange:xr}),e.jsx(bb,{open:bh,onOpenChange:a=>{if(a&&!Yt){p({title:"غير متاح",description:"يومية المكنة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة.",variant:"destructive"});return}yr(a)}}),e.jsx(Nb,{open:Je,onOpenChange:a=>{if(a&&!Yt){p({title:"غير متاح",description:"هذه الميزة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة. يرجى تفعيل اشتراكك.",variant:"destructive"});return}lt(a)}}),e.jsx(jb,{open:H,onOpenChange:a=>{if(a&&!Yt){p({title:"غير متاح",description:"هذه الميزة متاحة للاشتراكات: شهري، ربع سنوي، سنوي، ومدى الحياة. يرجى تفعيل اشتراكك.",variant:"destructive"});return}K(a)}}),e.jsx(la,{open:n0,onOpenChange:ed,onSuccess:()=>ko(!0),title:"تقاريرك",description:"أدخل الرقم السري الرئيسي للوصول إلى تقاريرك",mode:"verify"}),e.jsx(fe,{open:Do,onOpenChange:ko,children:e.jsxs(ge,{className:"sm:max-w-xl",children:[e.jsxs(ye,{children:[e.jsxs(be,{className:"flex items-center gap-2",children:[e.jsx(Ho,{className:"h-4 w-4 text-blue-600"}),"تقارير اليوم"]}),e.jsx(at,{children:"ملخص معاملات اليوم محفوظ لآخر 30 يومًا مع أرشفة في السحابة"})]}),e.jsxs("div",{className:"space-y-4",children:[(()=>{const a=new Date().toDateString(),r=ie.filter(g=>{const v=new Date(g.createdAt).toDateString(),y=String(g.status||"completed").toLowerCase();return v===a&&(y==="completed"||y==="confirmed")}),i=r.length,l=r.reduce((g,v)=>g+Number(v.amount||0),0),d=r.filter(g=>g.type==="withdraw").reduce((g,v)=>g+Number(v.amount||0),0),m=r.filter(g=>g.type==="send").reduce((g,v)=>g+Number(v.amount||0),0),h=r.reduce((g,v)=>g+Number(St.calculateTransactionProfit(v)||0),0);return e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-blue-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-blue-700",children:"عدد المعاملات"}),e.jsx("div",{className:"text-lg font-bold text-blue-800",children:i})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-indigo-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-indigo-700",children:"إجمالي المبالغ"}),e.jsx("div",{className:"text-lg font-bold text-indigo-800",children:Number(l).toFixed(2)})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-red-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-red-700",children:"المبالغ المسحوبة"}),e.jsx("div",{className:"text-lg font-bold text-red-800",children:Number(d).toFixed(2)})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-gradient-to-r from-green-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-green-700",children:"المبالغ المرسلة"}),e.jsx("div",{className:"text-lg font-bold text-green-800",children:Number(m).toFixed(2)})]}),e.jsxs("div",{className:"col-span-2 rounded-lg p-3 bg-gradient-to-r from-amber-50 to-slate-100 border",children:[e.jsx("div",{className:"text-xs text-amber-700",children:"الأرباح"}),e.jsx("div",{className:"text-lg font-bold text-amber-800",children:Number(h).toFixed(2)})]})]})})(),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(I,{variant:"default",onClick:async()=>{try{if(!(t!=null&&t.uid))return;const a=new Date,r=a.getFullYear(),i=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0"),d=`${r}-${i}-${l}`,m=a.toDateString(),h=ie.filter(k=>{const S=new Date(k.createdAt).toDateString(),T=String(k.status||"completed").toLowerCase();return S===m&&(T==="completed"||T==="confirmed")}),g=h.length,v=h.reduce((k,S)=>k+Number(S.amount||0),0),y=h.filter(k=>k.type==="withdraw").reduce((k,S)=>k+Number(S.amount||0),0),x=h.filter(k=>k.type==="send").reduce((k,S)=>k+Number(S.amount||0),0),w=h.reduce((k,S)=>k+Number(St.calculateTransactionProfit(S)||0),0);await Mr.add({userId:t.uid,reportDate:d,totalTransactions:g,totalAmount:Number(v.toFixed(2)),totalWithdrawn:Number(y.toFixed(2)),totalSent:Number(x.toFixed(2)),profit:Number(w.toFixed(2)),walletId:null});try{await Mr.trimToMaxCount(t.uid,30)}catch{}p({title:"تم الأرشفة",description:`تم حفظ تقرير ${d}`})}catch{p({title:"فشل الأرشفة",description:"تعذر حفظ التقرير",variant:"destructive"})}},children:"أرشفة اليوم"}),e.jsx(I,{variant:"outline",onClick:()=>ko(!1),children:"إغلاق"})]}),e.jsx("div",{className:"mt-2 border-t pt-2",children:e.jsx("div",{className:"space-y-2 max-h-[40vh] overflow-auto",children:td.length===0?e.jsx("div",{className:"text-xs text-muted-foreground",children:"لا توجد تقارير محفوظة"}):td.map(a=>e.jsxs("div",{className:"border rounded-md p-2 bg-gradient-to-r from-white/80 to-blue-50/70",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"font-bold text-blue-800",children:a.reportDate}),e.jsxs("div",{className:"text-xs text-blue-700",children:["عدد المعاملات: ",a.totalTransactions]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[e.jsxs("div",{className:"text-xs text-blue-800",children:["إجمالي المبالغ: ",e.jsx("span",{className:"font-semibold",children:Number(a.totalAmount).toFixed(2)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["المسحوب: ",e.jsx("span",{className:"font-semibold",children:Number(a.totalWithdrawn).toFixed(2)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["المرسل: ",e.jsx("span",{className:"font-semibold",children:Number(a.totalSent).toFixed(2)})]}),e.jsxs("div",{className:"text-xs text-blue-800",children:["الربح: ",e.jsx("span",{className:"font-semibold",children:Number(a.profit??0).toFixed(2)})]})]})]},a.id||`${a.userId}-${a.reportDate}`))})})]})]})}),e.jsx(fe,{open:r0,onOpenChange:a=>{if(a){p({title:"قيد التطوير",description:"هذه الميزة غير متاحة حالياً."});return}So(!1)},children:e.jsxs(ge,{dir:"rtl",className:"sm:max-w-md w-[95vw] sm:w-auto rounded-2xl border border-emerald-200 shadow-xl bg-gradient-to-br from-white via-green-50 to-emerald-50 backdrop-blur-md data-[state=open]:animate-in data-[state=open]:fade-in-0 data-[state=open]:zoom-in-90 data-[state=open]:slide-in-from-bottom-8 duration-300",children:[e.jsxs(ye,{children:[e.jsx(be,{className:"text-right text-green-700",children:"شحن رصيد الموبايل"}),e.jsx(at,{className:"text-right text-gray-600",children:"أدخل البيانات ثم اضغط تأكيد"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(Z,{htmlFor:"topupPhone",className:"text-right block",children:"رقم الموبايل"}),e.jsx(Y,{id:"topupPhone",value:An,onChange:a=>Hc(a.target.value),placeholder:"010xxxxxxx",className:"text-right"})]}),e.jsxs("div",{children:[e.jsx(Z,{className:"text-right block",children:"شركة التشغيل"}),e.jsxs(Ws,{value:Pn,onValueChange:Qc,children:[e.jsx(Rs,{className:"text-right",children:e.jsx(Ls,{placeholder:"اختر الشركة"})}),e.jsxs(Fs,{children:[e.jsx(Ta,{value:"vodafone",children:"فودافون"}),e.jsx(Ta,{value:"orange",children:"أورنج"}),e.jsx(Ta,{value:"etisalat",children:"اتصالات"}),e.jsx(Ta,{value:"we",children:"WE"})]})]})]}),e.jsxs("div",{children:[e.jsx(Z,{htmlFor:"topupAmount",className:"text-right block",children:"المبلغ بالجنيه"}),e.jsx(Y,{id:"topupAmount",type:"number",value:On,onChange:a=>Gc(a.target.value?Number(a.target.value):""),placeholder:"50",className:"text-right"})]})]}),e.jsxs(Pe,{className:"flex gap-2 justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>So(!1),className:"border-gray-300",children:"إلغاء"}),e.jsx(I,{onClick:ze,disabled:Xc||!An||!Pn||!On,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:Xc?"جارٍ التنفيذ...":"تأكيد الشحن"})]})]})}),e.jsx(la,{open:Th,onOpenChange:Xi,mode:"verify",title:"الرقم السري الرئيسي لفتح الديون",description:"أدخل الرقم السري الرئيسي لفتح صفحة الديون",className:"!bg-[#0f172a] !text-slate-100 border border-slate-800 shadow-2xl",overlayClassName:"backdrop-blur-[5px] bg-black/10 !dark:bg-black",onSuccess:()=>{Xi(!1),Ds(!0)}}),e.jsx(la,{open:Ph,onOpenChange:Sc,mode:"verify",title:"تأكيد تغيير طلب الرقم السري للديون",description:"أدخل الرقم السري الرئيسي لتفعيل أو إلغاء طلب الرقم السري عند فتح الديون",onSuccess:async()=>{if(Dc!==null){const a=Dc;jc(a);try{const r=t==null?void 0:t.uid,i=r?`debtsPinRequired_${r}`:"debtsPinRequired";localStorage.setItem(i,String(a)),r&&await se.updateUserData(r,{debtsPinRequired:a})}catch{}p({title:a?"تم تفعيل طلب الرقم السري للديون":"تم إلغاء طلب الرقم السري للديون",description:a?"سيُطلب الرقم السري الرئيسي عند فتح نافذة الديون.":"يمكن فتح نافذة الديون بدون طلب الرقم السري."})}Oh(null),Sc(!1)}}),e.jsx(ub,{open:a0,onOpenChange:Dr,title:"تأكيد كلمة المرور لإخفاء المعاملات السابقة من العرض",description:"سيتم إخفاء كل المعاملات السابقة من شاشة المعاملات والتقارير فقط، ولن تُحذف نهائيًا من حسابك أو من Firebase.",onSuccess:async()=>{try{if(!(t!=null&&t.uid)){Dr(!1);return}const a=new Date,r=l=>l instanceof Date?l:typeof(l==null?void 0:l.toDate)=="function"?l.toDate():new Date(String(l)),i=ie.filter(l=>r(l.createdAt)<a);await se.updateUserData(t.uid,{recentReset:{keepLastCount:fd.keepLastCount??30,intervalDays:fd.intervalDays??7,lastResetAt:a}}),$n(l=>({...l,lastResetAt:a})),p({title:"تم إخفاء المعاملات السابقة",description:"تم إخفاء كل الإيصالات الأقدم من وقت التصفير من العرض بدون التأثير على تقارير اليوم/الشهر أو الحدود."})}catch(a){console.error("فشل تنفيذ التصفير النهائي:",a),p({title:"فشل التصفير",description:"تحقق من الاتصال ثم أعد المحاولة.",variant:"destructive"})}finally{Dr(!1)}}}),e.jsx(la,{open:wm,onOpenChange:gs,mode:"verify",title:"الرقم السري لفتح مصروفات المحل",description:"أدخل الرقم السري الرئيسي لفتح نافذة مصروفات المحل",onSuccess:()=>{gs(!1),Ya(!0)}}),e.jsx(fe,{open:Ce,onOpenChange:Me,children:e.jsx(ge,{className:"w-full h-full max-w-full max-h-full p-0 m-0 rounded-none border-none",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx(I,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-50 bg-white/50 dark:bg-black/50 hover:bg-white dark:hover:bg-black/80 rounded-full",onClick:()=>Me(!1),children:e.jsx(Zn,{className:"h-6 w-6"})}),e.jsx("iframe",{src:"https://naweshop.com/login",className:"w-full h-full border-none",title:"NaweShop Login"})]})})}),e.jsx(fe,{open:_h,onOpenChange:Ds,children:e.jsxs(ge,{className:"sm:max-w-[425px] border border-slate-800 shadow-2xl",overlayClassName:"backdrop-blur-[5px] bg-black/10 !dark:bg-black",children:[e.jsxs(ye,{className:"flex items-center justify-between",children:[e.jsx(be,{className:"text-right",children:"إدارة الديون"}),e.jsxs("div",{className:"flex items-center gap-1 text-orange-700",children:[e.jsx(Hd,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-xs font-bold",children:[M0," جنيه"]})]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(I,{variant:ga==="debtor"?"default":"outline",onClick:()=>_c("debtor"),children:"مدين"}),e.jsx(I,{variant:ga==="creditor"?"default":"outline",onClick:()=>_c("creditor"),children:"دائن"})]}),(ga==="creditor"||ga==="debtor")&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Z,{htmlFor:"debtorName",className:"text-right col-span-1",children:ga==="creditor"?"اسم المديون":"اسم الدائن"}),e.jsx(Y,{id:"debtorName",value:Zi,onChange:a=>kc(a.target.value),className:"col-span-3 text-right",placeholder:ga==="creditor"?"أدخل اسم المديون":"أدخل اسم الدائن"})]}),ga&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Z,{htmlFor:"debtAmount",className:"text-right col-span-1",children:"المبلغ"}),e.jsx(Y,{id:"debtAmount",type:"text",inputMode:"decimal",value:eo,onChange:a=>Cc(lr(a.target.value)),className:"col-span-3 text-right",placeholder:"أدخل المبلغ"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Z,{htmlFor:"debtReason",className:"text-right col-span-1",children:"سبب الدين"}),e.jsx(Y,{id:"debtReason",value:to,onChange:a=>Ic(a.target.value),className:"col-span-3 text-right",placeholder:"أدخل سبب الدين"})]})]})]}),e.jsx(Pe,{children:e.jsx(I,{onClick:()=>{if(!(ga==="debtor")&&!(ga==="creditor")){p({title:"اختر نوع الدين",description:"يرجى اختيار مدين أو دائن أولاً",variant:"destructive"});return}if(!eo||!to||!Zi){p({title:"بيانات غير مكتملة",description:"يرجى إدخال الاسم والمبلغ والسبب",variant:"destructive"});return}const i={id:Date.now().toString(),debtorName:Zi,amount:parseFloat(eo),reason:to,status:"pending",createdAt:new Date,paidAmount:0,partialPayments:[],type:ga||"creditor"};Nr(i),Cs(!0)},className:"bg-orange-500 hover:bg-orange-600",children:"حفظ"})}),e.jsx("div",{className:"mt-2",children:e.jsx(I,{variant:"outline",className:"w-full",onClick:()=>Ha(!0),children:"إيصالات الديون"})}),e.jsx("div",{className:"mt-2",children:e.jsx(I,{variant:"outline",className:"w-full",onClick:()=>no(!0),children:"إضافة عميل"})})]})}),e.jsx(fe,{open:ao,onOpenChange:Ha,children:e.jsxs(ge,{className:"w-[95vw] sm:w-auto sm:max-w-[520px] rounded-2xl border border-slate-800 shadow-2xl",overlayClassName:"backdrop-blur-[5px] bg-black/10 !dark:bg-black",children:[e.jsxs(ye,{children:[e.jsx(be,{className:"text-right",children:"إيصالات الديون"}),e.jsx(at,{className:"text-right",children:"اختر دينًا لعرض إيصاله بالتفصيل"})]}),Ie.length>0?e.jsxs("div",{className:"max-h-[70vh] overflow-y-auto overscroll-contain scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 space-y-2 px-1 -mx-1 sm:mx-0 sm:px-0",style:{contain:"layout paint"},onScroll:a=>{const r=a.currentTarget;ro.length<Ie.length&&r.scrollTop+r.clientHeight>=r.scrollHeight-50&&so(i=>i+1)},children:[ro.map(a=>e.jsx("div",{onClick:()=>{vr(a),Ra(!0),Ha(!1),Ds(!1)},className:`p-4 sm:p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors min-h-[64px] ${a.type==="debtor"?"border-r-4 border-r-red-500 bg-red-50/10":"border-r-4 border-r-emerald-500"}`,children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center",children:[e.jsxs("div",{className:"text-right space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-[14px] sm:text-sm",children:a.debtorName}),a.type==="debtor"&&e.jsx(_a,{variant:"destructive",className:"h-5 text-[10px] px-1",children:"علينا"}),(!a.type||a.type==="creditor")&&e.jsx(_a,{variant:"outline",className:"h-5 text-[10px] px-1 text-emerald-700 border-emerald-200 bg-emerald-50",children:"لنا"})]}),e.jsx("p",{className:"text-[13px] sm:text-sm text-gray-600",children:a.reason}),e.jsx("p",{className:"text-[12px] sm:text-sm text-gray-500",children:Er.format(a.createdAt instanceof Date?a.createdAt:new Date(a.createdAt))})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-bold text-xl sm:text-lg",children:[a.amount," جنيه"]}),e.jsx(_a,{variant:a.status==="paid"?"default":"secondary",className:`${a.status==="paid"?"bg-green-500":"bg-yellow-500"} text-[12px] sm:text-xs`,children:a.status==="paid"?"مدفوع":"قيد المراجعة"})]})]})},a.id)),ro.length<Ie.length&&e.jsx("div",{className:"flex justify-center pt-1",children:e.jsx(I,{variant:"outline",size:"sm",onClick:()=>so(a=>a+1),children:"تحميل المزيد"})})]}):e.jsx("div",{className:"text-center text-sm text-gray-500",children:"لا توجد ديون مسجلة"}),e.jsxs(Pe,{className:"flex justify-between mt-3",children:[e.jsx(I,{variant:"destructive",onClick:async()=>{try{if(!Ie||Ie.length===0){p({title:"لا توجد ديون",description:"القائمة فارغة بالفعل."});return}if(!window.confirm("هل تريد حذف كل إيصالات الديون؟ هذا الإجراء لا يمكن التراجع عنه."))return;const r=[];if(Mt(r),vr(null),await Da(r),t!=null&&t.uid)try{await se.updateUserData(t.uid,{debts:[],debtsDeletedAt:wt()});try{localStorage.removeItem(`debts_unsynced_${t.uid}`)}catch{}}catch(i){console.error("تعذر حذف الديون من Firebase:",i),p({title:"فشل الحذف من السحابة",description:"تعذر حذف الإيصالات من Firebase، حاول مرة أخرى.",variant:"destructive"});return}p({title:"تم حذف كل إيصالات الديون",description:"تم تفريغ القائمة بالكامل."}),Ha(!1)}catch(a){console.error("تعذر حذف كل إيصالات الديون:",a),p({title:"فشل الحذف",description:"حدث خطأ أثناء الحذف، حاول مرة أخرى.",variant:"destructive"})}},children:"حذف كل الإيصالات"}),e.jsx(I,{variant:"outline",onClick:()=>Ha(!1),children:"إغلاق"})]})]})}),e.jsx(fe,{open:Fh,onOpenChange:no,children:e.jsxs(ge,{className:"sm:max-w-[500px] w-full max-h-[90vh] overflow-hidden flex flex-col p-0 gap-0 !bg-[#0f172a] !text-slate-100 border border-slate-800 shadow-2xl",overlayClassName:"backdrop-blur-[5px] bg-black/10 !dark:bg-black",children:[e.jsxs("div",{className:"p-4 border-b border-slate-800 bg-[#0f172a]",children:[e.jsxs(ye,{children:[e.jsxs(be,{className:"text-right flex items-center justify-end gap-2",children:[e.jsx(Fr,{className:"w-5 h-5 text-primary"}),"إدارة العملاء والديون"]}),e.jsx(at,{className:"text-right",children:"سجل بيانات العملاء والديون بسهولة"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4",dir:"rtl",children:[e.jsx(I,{variant:ks==="customers_list"?"default":"outline",onClick:()=>io("customers_list"),size:"sm",className:"flex-1 text-xs h-8",children:"العملاء المسجلين"}),e.jsx(I,{variant:ks==="add_debt"?"default":"outline",onClick:()=>io("add_debt"),size:"sm",className:"flex-1 text-xs h-8",children:"تسجيل دين"}),e.jsx(I,{variant:ks==="add_customer"?"default":"outline",onClick:()=>io("add_customer"),size:"sm",className:"flex-1 text-xs h-8",children:"إضافة عميل"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[ks==="add_customer"&&e.jsxs(Ca,{className:"border shadow-sm bg-white dark:bg-card dark:border-gray-800",children:[e.jsx(ss,{className:"pb-2 pt-4 px-4",children:e.jsxs(rs,{className:"text-sm font-medium text-right text-gray-700 dark:text-gray-200 flex items-center justify-end gap-2",children:[e.jsx(jt,{className:"w-4 h-4"}),"إضافة عميل جديد"]})}),e.jsxs(Ia,{className:"p-4 pt-2 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{className:"text-right block text-xs text-gray-500 dark:text-gray-400",children:"اسم العميل"}),e.jsx(Y,{value:lo,onChange:a=>Wc(a.target.value),className:"text-right h-9 dark:bg-gray-900 dark:border-gray-700",placeholder:"اكتب اسم العميل"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{className:"text-right block text-xs text-gray-500 dark:text-gray-400",children:"رقم الموبايل"}),e.jsx(Y,{value:co,onChange:a=>Rc(a.target.value),className:"text-right h-9 dark:bg-gray-900 dark:border-gray-700",placeholder:"اكتب رقم الموبايل"})]}),e.jsxs(I,{className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white h-9 mt-2",onClick:async()=>{if(!lo||!co){p({title:"بيانات غير مكتملة",description:"يرجى إدخال اسم العميل ورقم الموبايل",variant:"destructive"});return}const a={id:Date.now().toString(),name:lo.trim(),mobile:co.trim(),createdAt:new Date},r=[a,...It];await Ao(r),Wc(""),Rc(""),p({title:"تمت إضافة العميل",description:`تم إضافة ${a.name}`})},children:[e.jsx(jt,{className:"w-4 h-4 mr-2"}),"إضافة العميل"]})]})]}),ks==="add_debt"&&e.jsxs(Ca,{className:"border shadow-sm bg-white dark:bg-card dark:border-gray-800",children:[e.jsx(ss,{className:"pb-2 pt-4 px-4",children:e.jsxs(rs,{className:"text-sm font-medium text-right text-gray-700 dark:text-gray-200 flex items-center justify-end gap-2",children:[e.jsx(Pa,{className:"w-4 h-4 text-orange-600"}),"تسجيل مبلغ دين"]})}),e.jsx(Ia,{className:"p-4 pt-2 space-y-3",children:It.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{className:"text-right block text-xs text-gray-500 dark:text-gray-400",children:"اختر العميل"}),e.jsxs(Ws,{value:Qa,onValueChange:Lc,children:[e.jsx(Rs,{className:"w-full h-9 text-right dark:bg-gray-900 dark:border-gray-700",dir:"rtl",children:e.jsx(Ls,{placeholder:"اختر عميل"})}),e.jsx(Fs,{className:"dark:bg-gray-900 dark:border-gray-800",children:It.map(a=>e.jsxs(Ta,{value:a.id,className:"text-right justify-end",children:[a.name," — ",a.mobile]},a.id))})]}),Qa&&(()=>{const a=Ie.filter(r=>r.customerId===Qa&&r.status==="pending").reduce((r,i)=>r+(i.amount-(i.paidAmount||0)),0);return e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(I,{variant:"ghost",size:"sm",className:"h-6 text-xs text-blue-600 hover:text-blue-700 hover:bg-blue-50 px-2",onClick:()=>{Yh(Qa),go(!0)},children:"إيصالات ديونه"}),a>0&&e.jsxs("div",{className:"text-xs text-red-600 font-semibold text-right",children:["إجمالي الديون الحالية: ",a.toFixed(2)," جنيه"]})]})})()]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{className:"text-right block text-xs text-gray-500",children:"المبلغ"}),e.jsx(Y,{type:"number",value:Fc,onChange:a=>Bh(a.target.value),className:"text-right h-9",placeholder:"0.00"})]}),e.jsx(I,{className:"w-full bg-orange-600 hover:bg-orange-700 text-white h-9 mt-2",onClick:async()=>{const a=parseFloat(Fc);if(!Qa){p({title:"اختر عميل",description:"يرجى اختيار عميل أولاً",variant:"destructive"});return}if(isNaN(a)||a<=0){p({title:"قيمة غير صحيحة",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const r=It.find(l=>l.id===Qa);if(!r)return;const i={id:Date.now().toString(),debtorName:r.name,customerId:r.id,mobile:r.mobile,amount:Number(a.toFixed(2)),reason:"دين عميل",status:"pending",createdAt:new Date,paidAmount:0,partialPayments:[]};Nr(i),Cs(!0)},children:"متابعة وإضافة المبلغ"})]}):e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm bg-gray-50 rounded border border-dashed",children:"لا يوجد عملاء مسجلين. أضف عميلاً أولاً."})})]}),ks==="customers_list"&&e.jsxs(Ca,{className:"border shadow-sm bg-white dark:bg-card dark:border-gray-800",children:[e.jsx(ss,{className:"pb-2 pt-4 px-4",children:e.jsxs(rs,{className:"text-sm font-medium text-right text-gray-700 dark:text-gray-200 flex items-center justify-end gap-2",children:[e.jsx(Gd,{className:"w-4 h-4"}),"العملاء المسجلين (",It.length,")"]})}),e.jsx(Ia,{className:"p-4 pt-2",children:It.length>0?e.jsx("div",{className:"space-y-2",children:It.map(a=>e.jsxs("div",{className:"p-3 border rounded-lg flex items-center justify-between bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors dark:border-gray-700",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-600 hover:text-blue-700 hover:bg-blue-50",onClick:()=>{Bc(a.id),uo(a.name||""),mo(a.mobile||""),Dn(!0)},children:e.jsx(Jd,{className:"h-4 w-4"})}),e.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>{ho(a.id),fo(a.name||""),kn(!0)},children:e.jsx(oa,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-gray-100",children:a.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono",children:a.mobile})]})]},a.id))}):e.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"لا توجد بيانات لعرضها"})})]})]}),e.jsx(Pe,{className:"p-4 border-t bg-white dark:bg-card dark:border-gray-800",children:e.jsx(I,{variant:"outline",className:"w-full sm:w-auto dark:bg-gray-800 dark:text-white dark:border-gray-700 dark:hover:bg-gray-700",onClick:()=>no(!1),children:"إغلاق"})})]})}),e.jsx(fe,{open:zh,onOpenChange:go,children:e.jsxs(ge,{className:"sm:max-w-[500px] max-h-[80vh] overflow-hidden flex flex-col p-0 gap-0",children:[e.jsx("div",{className:"p-4 border-b bg-white dark:bg-card dark:border-gray-800",children:e.jsxs(ye,{children:[e.jsxs(be,{className:"text-right flex items-center justify-end gap-2 dark:text-gray-100",children:[e.jsx(Qn,{className:"w-5 h-5 text-blue-600"}),"إيصالات العميل"]}),e.jsx(at,{className:"text-right dark:text-gray-400",children:(Td=It.find(a=>a.id===po))==null?void 0:Td.name})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50/50 dark:bg-black/50",children:[Ie.filter(a=>a.customerId===po).sort((a,r)=>new Date(r.createdAt).getTime()-new Date(a.createdAt).getTime()).map(a=>e.jsxs("div",{className:"p-3 border rounded-lg bg-white dark:bg-card dark:border-gray-700 shadow-sm flex justify-between items-center",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold text-sm dark:text-gray-100",children:[a.amount," جنيه"]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:a.reason}),e.jsx(_a,{variant:a.status==="paid"?"default":"secondary",className:`mt-1 h-5 text-[10px] ${a.status==="paid"?"bg-green-500":"bg-yellow-500 text-yellow-950"}`,children:a.status==="paid"?"مدفوع":"قيد المراجعة"})]}),e.jsxs("div",{className:"text-left text-xs text-gray-400 flex flex-col items-end gap-1",children:[e.jsx("div",{className:"font-mono",children:Er.format(new Date(a.createdAt))}),e.jsx("div",{className:"font-mono",children:new Date(a.createdAt).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})})]})]},a.id)),Ie.filter(a=>a.customerId===po).length===0&&e.jsxs("div",{className:"text-center text-gray-500 py-8 flex flex-col items-center gap-2",children:[e.jsx(Qn,{className:"w-8 h-8 text-gray-300"}),e.jsx("span",{children:"لا توجد إيصالات لهذا العميل"})]})]}),e.jsx(Pe,{className:"p-4 border-t bg-white dark:bg-card dark:border-gray-800",children:e.jsx(I,{variant:"outline",className:"w-full dark:bg-gray-800 dark:text-white dark:border-gray-700 dark:hover:bg-gray-700",onClick:()=>go(!1),children:"إغلاق"})})]})}),e.jsx(fe,{open:Vh,onOpenChange:kn,children:e.jsxs(ge,{hideClose:!0,className:"sm:max-w-[420px] rounded-2xl bg-gradient-to-br from-white via-rose-50 to-red-50 dark:from-gray-900 dark:via-red-950/30 dark:to-red-900/10 shadow-2xl border border-red-100 dark:border-red-900/50 text-center",children:[e.jsxs(ye,{children:[e.jsx(be,{className:"text-center text-xl font-bold text-red-700 dark:text-red-400",children:"تأكيد حذف العميل"}),e.jsxs(at,{className:"text-center text-gray-600 dark:text-gray-300",children:["سيتم حذف العميل نهائيًا: ",Vc]})]}),e.jsx("div",{className:"py-2 text-sm text-gray-700 dark:text-gray-400",children:"لا يمكن التراجع عن هذا الإجراء."}),e.jsxs(Pe,{className:"flex justify-center gap-3",children:[e.jsx(I,{variant:"outline",onClick:()=>{kn(!1),ho(""),fo("")},children:"إلغاء"}),e.jsx(I,{variant:"destructive",className:"bg-red-600 hover:bg-red-700",onClick:async()=>{const a=qh,r=It.filter(i=>i.id!==a);await Ao(r),Qa===a&&Lc(""),kn(!1),ho(""),fo(""),p({title:"تم حذف العميل",description:Vc})},children:"حذف نهائي"})]})]})}),e.jsx(fe,{open:$h,onOpenChange:Dn,children:e.jsxs(ge,{className:"sm:max-w-[420px]",children:[e.jsx(ye,{children:e.jsx(be,{className:"text-right",children:"تعديل بيانات العميل"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Z,{htmlFor:"editCustomerName",className:"text-right col-span-1",children:"الاسم"}),e.jsx(Y,{id:"editCustomerName",value:$c,onChange:a=>uo(a.target.value),className:"col-span-3 text-right"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Z,{htmlFor:"editCustomerMobile",className:"text-right col-span-1",children:"الموبايل"}),e.jsx(Y,{id:"editCustomerMobile",value:Uc,onChange:a=>mo(a.target.value),className:"col-span-3 text-right"})]})]}),e.jsxs(Pe,{className:"flex justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>Dn(!1),children:"إلغاء"}),e.jsx(I,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{const a=Uh,r=$c.trim(),i=Uc.trim();if(!a||!r||!i){p({title:"بيانات غير مكتملة",description:"أدخل الاسم ورقم الموبايل",variant:"destructive"});return}const l=It.map(m=>m.id===a?{...m,name:r,mobile:i}:m);await Ao(l);const d=Ie.map(m=>m.customerId===a?{...m,debtorName:r,mobile:i}:m);d!==Ie&&(Mt(d),await Da(d)),Dn(!1),Bc(""),uo(""),mo(""),p({title:"تم تحديث العميل",description:r})},children:"حفظ"})]})]})}),e.jsx(fe,{open:vm,onOpenChange:Ya,children:e.jsxs(ge,{className:"sm:max-w-[520px]",children:[e.jsxs(ye,{children:[e.jsx(be,{className:"text-right",children:"مصروفات المحل"}),e.jsx(at,{className:"text-right",children:"أدخل تفاصيل المصروف ثم اختر مصدر الخصم."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Z,{htmlFor:"expenseName",className:"text-right col-span-1",children:"اسم المصروف"}),e.jsx(Y,{id:"expenseName",value:sn,onChange:a=>Wl(a.target.value),className:"col-span-3 text-right",placeholder:"مثال: كهرباء، صيانة، مشتريات"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Z,{htmlFor:"expenseAmount",className:"text-right col-span-1",children:"تمن المصروف"}),e.jsx(Y,{id:"expenseAmount",type:"number",value:pi,onChange:a=>Rl(a.target.value),className:"col-span-3 text-right",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Z,{htmlFor:"expenseNotes",className:"text-right col-span-1",children:"ملاحظات"}),e.jsx(Y,{id:"expenseNotes",value:xi,onChange:a=>Ll(a.target.value),className:"col-span-3 text-right",placeholder:"معلومات إضافية إن وجدت"})]})]}),e.jsxs(Pe,{className:"flex justify-between",children:[e.jsx(I,{className:"bg-orange-600 hover:bg-orange-700",onClick:()=>{if(!sn||!pi){p({title:"بيانات غير مكتملة",description:"يرجى إدخال اسم المصروف وقيمته",variant:"destructive"});return}nn(!0)},children:"إضافة مصروف"}),e.jsx(I,{variant:"outline",onClick:()=>vi(!0),children:"إيصالات المصاريف"})]})]})}),e.jsx(fe,{open:jm,onOpenChange:vi,children:e.jsxs(ge,{className:"sm:max-w-[420px]",dir:"rtl",children:[e.jsxs(ye,{children:[e.jsx(be,{className:"text-right",children:"إيصالات المصاريف"}),e.jsx(at,{className:"text-right",children:"آخر المصاريف المسجلة"})]}),rn.length>0?e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:rn.map(a=>e.jsx("div",{className:"p-2 border rounded-lg bg-white dark:bg-card dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-sm dark:text-gray-200",children:a.name}),e.jsx("p",{className:"text-[11px] text-gray-600 dark:text-gray-400",children:a.notes||"بدون ملاحظات"}),e.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-500",children:new Date(a.createdAt).toLocaleString("ar-EG")})]}),e.jsxs("div",{className:"text-left flex items-start gap-2",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-bold text-sm dark:text-gray-200",children:[a.amount," جنيه"]}),e.jsx(_a,{variant:"secondary",className:a.source==="cash"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300",children:a.source==="cash"?"من النقدية":`من المحفظة${a.walletId?` (${a.walletId})`:""}`})]}),e.jsxs(I,{variant:"destructive",size:"sm",className:"shrink-0",onClick:()=>l0(a.id),title:"حذف نهائي",children:[e.jsx(oa,{className:"w-4 h-4 ml-1"}),"حذف"]})]})]})},a.id))}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"لا توجد مصاريف مسجلة بعد"})]})}),e.jsx(fe,{open:Nm,onOpenChange:nn,children:e.jsxs(ge,{className:"sm:max-w-[480px]",children:[e.jsx(ye,{children:e.jsx(be,{className:"text-right",children:"اختيار مصدر خصم المصروف"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-right",children:"اختر هل تريد خصم مبلغ المصروف من الرصيد النقدي في الدرج أم من إحدى المحافظ."}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(I,{variant:ft==="cash"?"default":"outline",className:ft==="cash"?"bg-blue-600 hover:bg-blue-700 text-white":"",onClick:()=>tr("cash"),children:"الفلوس النقدية"}),e.jsx(I,{variant:ft==="wallet"?"default":"outline",className:ft==="wallet"?"bg-purple-600 hover:bg-purple-700 text-white":"",onClick:()=>tr("wallet"),children:"أرصدة المحافظ"}),e.jsx(I,{variant:ft==="fawry"?"default":"outline",className:ft==="fawry"?"bg-amber-600 hover:bg-amber-700 text-white":"",onClick:()=>tr("fawry"),children:"فوري"})]}),ft==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-right block",children:"اختر المحفظة للخصم"}),e.jsxs(Ws,{value:ps,onValueChange:bi,children:[e.jsx(Rs,{className:"w-full",children:e.jsx(Ls,{placeholder:"اختر محفظة"})}),e.jsx(Fs,{children:F.map(a=>e.jsx(Ta,{value:a.id,children:a.phone||a.name||a.id},a.id))})]})]})]}),e.jsxs(Pe,{className:"flex justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>{nn(!1),tr(null),bi("")},children:"إلغاء"}),e.jsx(I,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{const a=Number(pi);if(isNaN(a)||a<=0){p({title:"قيمة غير صحيحة",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}if(!ft){p({title:"اختر مصدر الخصم",description:"يرجى اختيار النقدية أو المحفظة",variant:"destructive"});return}try{if(ft==="cash"){const d=Number((We-a).toFixed(2));Ze(d),localStorage.setItem(Ve(),d.toString());const m={cashBalance:d,lastUpdated:new Date().toISOString()},h=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(h,JSON.stringify(m)),t!=null&&t.uid?(await se.updateUserData(t.uid,m),localStorage.removeItem(h),me(!1)):me(!0)}else if(ft==="wallet"){if(!ps){p({title:"اختر محفظة",description:"يرجى اختيار محفظة للخصم",variant:"destructive"});return}const d=ve[ps]||0,m=Number((d-a).toFixed(2)),h={...ve,[ps]:m};ct(h);const g=new Date().toISOString(),v={walletBalances:h,lastUpdated:g},y=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(y,JSON.stringify(v)),localStorage.setItem(et(),JSON.stringify(h)),localStorage.setItem(`walletBalances_backup_${g}`,JSON.stringify(h)),t!=null&&t.uid&&se.updateUserData(t.uid,v).catch(()=>{})}}catch(d){console.error("خطأ أثناء تحديث الأرصدة عند حفظ المصروف:",d)}let r=Date.now().toString();try{if(t!=null&&t.uid){const{addDoc:d,collection:m,serverTimestamp:h}=await X(async()=>{const{addDoc:y,collection:x,serverTimestamp:w}=await import("./index-mBSeGJ8K.js").then(k=>k.cA);return{addDoc:y,collection:x,serverTimestamp:w}},__vite__mapDeps([0,1]),import.meta.url),{db:g}=await X(async()=>{const{db:y}=await import("./index-mBSeGJ8K.js").then(x=>x.cB);return{db:y}},__vite__mapDeps([0,1]),import.meta.url);r=(await d(m(g,"shop_expenses"),{userId:t.uid,shopId:D||(n==null?void 0:n.shopId)||t.uid||"default-shop",name:sn,amount:a,notes:xi||"",source:ft,walletId:ft==="wallet"?ps:null,createdAt:h()})).id}}catch(d){console.error("خطأ أثناء حفظ المصروف في Firestore:",d)}const i={id:r,name:sn,amount:a,notes:xi,source:ft,walletId:ft==="wallet"?ps:void 0,createdAt:new Date},l=[...rn,i];await sd(l),Wl(""),Rl(""),Ll(""),tr(null),bi(""),nn(!1),Ya(!0),vi(!0),p({title:"تم إضافة المصروف",description:ft==="cash"?"تم الخصم من النقدية":ft==="wallet"?"تم الخصم من أرصدة المحافظ":"تم تسجيل الدفع عبر فوري"})},children:"تأكيد الخصم"})]})]})}),e.jsx(fe,{open:Dm,onOpenChange:ar,children:e.jsxs(ge,{className:"sm:max-w-[520px]",children:[e.jsxs(ye,{children:[e.jsx(be,{className:"text-right",children:"النواقص"}),e.jsx(at,{className:"text-right",children:"سجل العناصر الناقصة التي تحتاج شراء وتابع حالتها."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Z,{htmlFor:"deficiencyName",className:"text-right col-span-1",children:"اسم العنصر"}),e.jsx(Y,{id:"deficiencyName",value:sr,onChange:a=>wi(a.target.value),className:"col-span-3 text-right",placeholder:"مثال: سكر، زيت، مناديل"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Z,{htmlFor:"deficiencyQuantity",className:"text-right col-span-1",children:"الكمية"}),e.jsx(Y,{id:"deficiencyQuantity",type:"number",value:Fl,onChange:a=>Ni(a.target.value),className:"col-span-3 text-right",placeholder:"1"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(I,{className:"bg-rose-600 hover:bg-rose-700",onClick:()=>{if(we){p({title:"غير متاح",description:"النواقص غير متاحة في خطة زيرو. قم بالترقية.",variant:"destructive"});return}const a=parseInt(Fl||"1",10);if(!sr){p({title:"بيانات غير مكتملة",description:"يرجى إدخال اسم العنصر",variant:"destructive"});return}if(isNaN(a)||a<=0){p({title:"كمية غير صحيحة",description:"يرجى إدخال كمية صحيحة",variant:"destructive"});return}(async()=>{if(t!=null&&t.uid)try{const{collection:i,addDoc:l,serverTimestamp:d}=await X(async()=>{const{collection:g,addDoc:v,serverTimestamp:y}=await import("./index-mBSeGJ8K.js").then(x=>x.cA);return{collection:g,addDoc:v,serverTimestamp:y}},__vite__mapDeps([0,1]),import.meta.url),{db:m}=await X(async()=>{const{db:g}=await import("./index-mBSeGJ8K.js").then(v=>v.cB);return{db:g}},__vite__mapDeps([0,1]),import.meta.url),h=await l(i(m,"deficiencies"),{userId:t.uid,shopId:D||(n==null?void 0:n.shopId)||t.uid||"default-shop",name:sr,quantity:a,status:"pending",createdAt:d()});try{const g=En(),v=localStorage.getItem(g),y=v?JSON.parse(v):[],x=Array.isArray(y)?y:[],w=x.some(T=>String((T==null?void 0:T.id)||"")===h.id),k={id:h.id,name:sr,quantity:a,status:"pending",createdAt:new Date().toISOString()},S=w?x:[...x,k];localStorage.setItem(g,JSON.stringify(S))}catch{}wi(""),Ni(""),p({title:"تمت الإضافة",description:"تمت إضافة العنصر إلى قائمة النواقص"});return}catch(i){console.warn("فشل حفظ النواقص إلى Firestore، سيُستخدم التخزين المحلي:",i)}const r={id:Date.now().toString(),name:sr,quantity:a,status:"pending",createdAt:new Date};xs(i=>{const l=[...i,r];return To(l),l}),wi(""),Ni(""),p({title:"تمت الإضافة",description:"تمت إضافة العنصر إلى قائمة النواقص"})})()},children:"إضافة للنواقص"})}),Bl.length>0?e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Bl.map(a=>e.jsx("div",{className:"p-2 border rounded-lg bg-white dark:bg-card dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-sm dark:text-gray-200",children:a.name}),e.jsxs("p",{className:"text-[11px] text-gray-600 dark:text-gray-400",children:["الكمية: ",a.quantity]}),e.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-500",children:new Date(a.createdAt).toLocaleString("ar-EG")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_a,{variant:"secondary",className:a.status==="pending"?"bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-300":"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",children:a.status==="pending"?"قيد الشراء":"تم الشراء"}),e.jsx(I,{variant:"outline",className:a.status==="pending"?"text-green-700 border-green-300 hover:bg-green-50":"text-rose-700 border-rose-300 hover:bg-rose-50",onClick:()=>{(async()=>{const r=a.status==="pending"?"purchased":"pending";if(t!=null&&t.uid)try{const{doc:i,updateDoc:l,serverTimestamp:d}=await X(async()=>{const{doc:h,updateDoc:g,serverTimestamp:v}=await import("./index-mBSeGJ8K.js").then(y=>y.cA);return{doc:h,updateDoc:g,serverTimestamp:v}},__vite__mapDeps([0,1]),import.meta.url),{db:m}=await X(async()=>{const{db:h}=await import("./index-mBSeGJ8K.js").then(g=>g.cB);return{db:h}},__vite__mapDeps([0,1]),import.meta.url);await l(i(m,"deficiencies",a.id),{status:r,updatedAt:d()});return}catch(i){console.warn("فشل تحديث حالة النواقص على Firestore، استخدام التخزين المحلي:",i)}xs(i=>{const l=i.map(d=>d.id===a.id?{...d,status:r}:d);return To(l),l})})()},title:a.status==="pending"?"تم الشراء":"إلغاء الشراء",children:a.status==="pending"?"تم الشراء":"إلغاء الشراء"}),e.jsx(I,{variant:"outline",className:"text-red-700 border-red-300 hover:bg-red-50",onClick:()=>{(async()=>{if(t!=null&&t.uid)try{const{doc:r,deleteDoc:i}=await X(async()=>{const{doc:d,deleteDoc:m}=await import("./index-mBSeGJ8K.js").then(h=>h.cA);return{doc:d,deleteDoc:m}},__vite__mapDeps([0,1]),import.meta.url),{db:l}=await X(async()=>{const{db:d}=await import("./index-mBSeGJ8K.js").then(m=>m.cB);return{db:d}},__vite__mapDeps([0,1]),import.meta.url);await i(r(l,"deficiencies",a.id));return}catch(r){console.warn("فشل حذف عنصر النواقص من Firestore، استخدام التخزين المحلي:",r)}xs(r=>{const i=r.filter(l=>l.id!==a.id);return To(i),i})})()},title:"حذف",children:"حذف"})]})]})},a.id))}):e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"لا توجد عناصر مسجلة في النواقص"})]}),e.jsx(Pe,{className:"flex justify-end",children:e.jsx(I,{variant:"outline",onClick:()=>ar(!1),children:"إغلاق"})})]})}),e.jsx(fe,{open:km,onOpenChange:a=>{on(a),a||(cn(null),rr(""),nr(""))},children:e.jsxs(ge,{className:"sm:max-w-[520px]",children:[e.jsxs(ye,{children:[e.jsx(be,{className:"text-right",children:"أرقامي مع عملائي"}),e.jsx(at,{className:"text-right",children:"استعرض أرقام المحافظ واضغط على علامة الزائد لتسليم رقم لعميل. هذه القائمة مخصصة للأرقام التي تعطيها لعملاء خارج المحل ليحوّلوا عليها، حتى تكون عارف أن الخطوط دي مخصصة لعملاء هيحولو عليها من برا المحل علشان متستلمش عليها وتوقف ليميتك"})]}),e.jsx("div",{className:"grid gap-3 py-2",children:F.length===0?e.jsx("div",{className:"text-center text-sm text-gray-500",children:"لا توجد محافظ مضافة حتى الآن."}):F.map(a=>{const r=ji[a.id],i=!!r;return e.jsxs("div",{className:`p-3 rounded-lg border flex flex-col gap-2 ${i?"border-red-500 bg-red-50 text-red-700":"border-emerald-500 bg-emerald-50 text-emerald-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"font-semibold text-base",children:a.phone||"بدون رقم"}),a.name?e.jsx("span",{className:"text-xs text-gray-600",children:a.name}):null,i&&e.jsxs("span",{className:"text-xs mt-1",children:["لعميل: ",r.name,r.amount&&r.amount.trim()!==""?` - مبلغ: ${r.amount}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{type:"button",size:"icon",className:"h-9 w-9 rounded-full bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>{cn(a.id),rr((r==null?void 0:r.name)||""),nr((r==null?void 0:r.amount)||"")},children:e.jsx(jt,{className:"h-4 w-4"})}),i&&e.jsx(I,{type:"button",size:"icon",variant:"outline",className:"h-9 w-9 rounded-full border-red-300 text-red-600 hover:bg-red-50",onClick:()=>{const l=`clientNumberAssignments_${(t==null?void 0:t.uid)||"default"}`,d={...ji};delete d[a.id],ys(d);try{localStorage.setItem(l,JSON.stringify(d))}catch{}ln===a.id&&(cn(null),rr(""),nr(""))},children:e.jsx(oa,{className:"h-4 w-4"})})]})]}),ln===a.id&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-stretch",children:[e.jsx(Y,{placeholder:"اسم مستلم الرقم",className:"text-right",value:$l,onChange:l=>rr(l.target.value)}),e.jsx(Y,{placeholder:"المبلغ المتوقع تحويله",className:"text-right sm:max-w-[160px]",value:Ul,onChange:l=>nr(l.target.value),inputMode:"decimal"}),e.jsx(I,{className:"bg-red-600 hover:bg-red-700 text-white px-4",onClick:()=>{const l=$l.trim();if(!l){p({title:"اسم غير صحيح",description:"يرجى إدخال اسم مستلم الرقم",variant:"destructive"});return}if(!ln)return;const d=Ul.trim(),m=`clientNumberAssignments_${(t==null?void 0:t.uid)||"default"}`,h={...ji,[ln]:{name:l,amount:d}};ys(h);try{localStorage.setItem(m,JSON.stringify(h))}catch{}cn(null),rr(""),nr("")},children:"تسليم"})]})]},a.id)})})]})}),e.jsx(fe,{open:Kh,onOpenChange:Cs,children:e.jsxs(ge,{className:"sm:max-w-[480px]",children:[e.jsx(ye,{children:e.jsx(be,{className:"text-right",children:(Xe==null?void 0:Xe.type)==="decrease"?"اختيار مكان إضافة مبلغ السداد":"اختيار مصدر خصم الدين"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 text-right",children:(Xe==null?void 0:Xe.type)==="decrease"?"اختر هل تريد إضافة مبلغ السداد إلى الرصيد النقدي أم إلى إحدى المحافظ أو تسجيله بدون خصم.":"اختر هل تريد خصم مبلغ الدين من الرصيد النقدي في الدرج أم من إحدى المحافظ أو تسجيله بدون خصم."}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(I,{variant:_t==="cash"?"default":"outline",className:_t==="cash"?"bg-blue-600 hover:bg-blue-700 text-white":"",onClick:()=>jr("cash"),children:"الفلوس النقدية"}),e.jsx(I,{variant:_t==="wallet"?"default":"outline",className:_t==="wallet"?"bg-purple-600 hover:bg-purple-700 text-white":"",onClick:()=>jr("wallet"),children:"أرصدة المحافظ"}),e.jsx(I,{variant:_t==="none"?"default":"outline",className:_t==="none"?"bg-gray-600 hover:bg-gray-700 text-white":"",onClick:()=>jr("none"),children:(Xe==null?void 0:Xe.type)==="decrease"?"بدون إضافة":"بدون خصم"})]}),_t==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-right block",children:(Xe==null?void 0:Xe.type)==="decrease"?"اختر المحفظة للإضافة":"اختر المحفظة للخصم"}),e.jsxs(Ws,{value:Sr,onValueChange:xo,children:[e.jsx(Rs,{className:"w-full",children:e.jsx(Ls,{placeholder:"اختر محفظة"})}),e.jsx(Fs,{children:F.map(a=>e.jsx(Ta,{value:a.id,children:a.phone||a.name||a.id},a.id))})]})]})]}),e.jsxs(Pe,{className:"flex justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>{Cs(!1),Nr(null),jr(null),xo("")},children:"إلغاء"}),e.jsx(I,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{const a=!!Xe,r=a&&(Xe==null?void 0:Xe.type)==="decrease",i=Number(a?Xe.delta:(Ga==null?void 0:Ga.amount)||0);if(!_t){p({title:r?"اختر مكان الإضافة":"اختر مصدر الخصم",description:"يرجى اختيار النقدية أو المحفظة",variant:"destructive"});return}const l=new Date().toISOString();let d=We,m=ve,h=!1,g=!1;try{if(_t==="cash")d=Number(r?(We+i).toFixed(2):(We-i).toFixed(2)),h=!0;else if(_t==="wallet"){if(!Sr){p({title:"اختر محفظة",description:r?"يرجى اختيار محفظة للإضافة":"يرجى اختيار محفظة للخصم",variant:"destructive"});return}const S=ve[Sr]||0,T=Number(r?(S+i).toFixed(2):(S-i).toFixed(2));m={...ve,[Sr]:T},g=!0}}catch(S){console.error("Error calculating balances:",S);return}let v=[...Ie],y=W,x=!1;if(a){if(!W)return;const S=Number(W.amount||0),T=Number(W.paidAmount||0),O=Number(Xe.delta||0);if(Xe.type==="decrease"){const _=Number((S-O).toFixed(2)),A=T>=_,B={...W,amount:_,status:A?"paid":"pending"};if(v=Ie.map(z=>z.id===W.id?B:z),y=B,x=!0,A&&(t!=null&&t.uid)&&(async()=>{try{const[z,re,tt]=[Oe(pe(V,"userTransactions"),ae("userId","==",t.uid),ae("linkedDebtId","==",W.id),ae("status","==","pending")),Oe(pe(V,"transactions"),ae("userId","==",t.uid),ae("linkedDebtId","==",W.id),ae("status","==","pending")),Oe(pe(V,"transactions"),ae("merchantUserId","==",t.uid),ae("linkedDebtId","==",W.id),ae("status","==","pending"))],[yt,dt,je]=await Promise.all([ke(z),ke(re),ke(tt)]),ce=Cf(V);let nt=0;const ut=mt=>{mt.docs.forEach(bt=>{ce.update(bt.ref,{status:"completed",confirmedAt:new Date}),nt++})};ut(yt),ut(dt),ut(je),nt>0&&await ce.commit(),t!=null&&t.uid&&[...yt.docs.map(bt=>{var ia;return String(((ia=bt.data())==null?void 0:ia.transactionId)||"")}),...dt.docs.map(bt=>{var ia;return String(bt.id||((ia=bt.data())==null?void 0:ia.transactionId)||"")}),...je.docs.map(bt=>{var ia;return String(bt.id||((ia=bt.data())==null?void 0:ia.transactionId)||"")})].filter(Boolean).forEach(bt=>se.removeLocalReceiptById(t.uid,bt))}catch(z){console.error("Batch update failed for linked transactions:",z)}})().catch(z=>{console.error("Transaction update error:",z)}),t!=null&&t.uid&&_t!=="none")try{const re={transactionId:Te(pe(V,"dummy_collection")).id,amount:O,transactionType:"cash_addition",type:"cash_addition",status:"completed",createdAt:new Date,senderName:W.debtorName,receiverName:"المحل",description:`سداد دين من العميل ${W.debtorName}`,paymentMethod:_t,walletId:_t==="wallet"?Sr:null,linkedDebtId:W.id,isDebtRepayment:!0};await se.saveUserTransaction(t.uid,re);try{P.invalidateQueries({queryKey:["recentTransactions",t==null?void 0:t.uid]})}catch{}}catch(z){console.error("Failed to create repayment receipt:",z)}p({title:"تم إنقاص المبلغ",description:`المبلغ الجديد: ${_} جنيه`})}else{const _=S+O,A=T>=_,B={amount:O,note:Pc||void 0,addedAt:new Date},z={...W,amount:Number(_.toFixed(2)),status:A?"paid":"pending",additionReceipts:[...W.additionReceipts||[],B]};v=Ie.map(re=>re.id===W.id?z:re),y=z,x=!0,p({title:"تم زيادة المبلغ",description:`المبلغ الجديد: ${_} جنيه`})}}else if(Ga){v=[{...Ga,userId:t==null?void 0:t.uid,shopId:D||(n==null?void 0:n.shopId)||null},...Ie],x=!0;try{t!=null&&t.uid&&as.send(t.uid,`تم إضافة دين على ${Ga.debtorName} بمبلغ ${Ga.amount} جنيه`).catch(()=>{})}catch{}}h&&Ze(d),g&&ct(m),x&&(Mt(v),a&&vr(y)),kc(""),Cc(""),Ic(""),Ds(!1),Cs(!1),!a&&x&&Ha(!0),Nr(null),Oc(null),jr(null),xo(""),Nn(""),p({title:a?"تم تعديل الدين":"تم حفظ الدين",description:_t==="none"?"لم يتم تعديل الأرصدة":_t==="cash"?r?`تمت إضافة ${i} إلى الرصيد النقدي`:`تم خصم ${i} من الرصيد النقدي`:r?`تمت إضافة ${i} إلى رصيد المحفظة`:`تم خصم ${i} من رصيد المحفظة`});const w={lastUpdated:l};if(h&&(w.cashBalance=d),g&&(w.walletBalances=m),x&&(w.debts=v,w.debtsDeletedAt=null),h&&(localStorage.setItem(Ve(),d.toString()),localStorage.setItem(Ve()+"_lastUpdated",l)),g&&(localStorage.setItem(et(),JSON.stringify(m)),localStorage.setItem(et()+"_lastUpdated",l)),x){localStorage.setItem(kr(),JSON.stringify(v));try{localStorage.setItem(Co(),JSON.stringify(v))}catch{}try{localStorage.setItem(Io(),Date.now().toString())}catch{}}const k=`userData_${t==null?void 0:t.uid}`;if(localStorage.setItem(k,JSON.stringify(w)),t!=null&&t.uid){if(x)try{localStorage.setItem(`debts_unsynced_${t.uid}`,"true")}catch{}const S=[];S.push(se.updateUserData(t.uid,w).then(()=>{(h||g)&&(localStorage.removeItem(k),me(!1))}));const T=D||(n==null?void 0:n.shopId);if(T&&(h||g)){const O={lastUpdated:l};h&&(O.cashBalance=d),g&&(O.walletBalances=m),S.push(Ht(Te(V,"dashboardData",T),O,{merge:!0}).catch(_=>console.error("Failed to sync to dashboardData",_)))}Promise.all(S).then(()=>{if(x)try{localStorage.removeItem(`debts_unsynced_${t.uid}`)}catch{}}).catch(O=>{console.error("Sync error:",O),me(!0)})}},children:(Xe==null?void 0:Xe.type)==="decrease"?"تأكيد الإضافة":"تأكيد الخصم"})]})]})}),e.jsx(fe,{open:Eh,onOpenChange:Ra,children:e.jsxs(ge,{className:"w-[95vw] sm:w-auto sm:max-w-[425px] max-h-[90vh] overflow-y-auto rounded-2xl",hideClose:!0,children:[e.jsx("div",{className:"absolute left-4 top-4 z-50",children:e.jsxs(I,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full opacity-70 hover:opacity-100",onClick:()=>Ra(!1),children:[e.jsx(Zn,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"إغلاق"})]})}),e.jsx(ye,{children:e.jsx(be,{className:"text-right",children:"إيصال الدين"})}),W&&e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"text-center border-b pb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"إيصال دين"}),e.jsx("p",{className:"text-sm text-gray-500",children:Er.format(W.createdAt instanceof Date?W.createdAt:new Date(W.createdAt))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"اسم المديون:"}),e.jsx("span",{children:W.debtorName})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center",children:[e.jsx("span",{className:"font-medium",children:"المبلغ:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{variant:"outline",className:"h-10 w-10 sm:h-8 sm:w-8 p-0","aria-label":"دفع جزء من الدين",onClick:()=>{wr(""),jn(!0)},children:"−"}),e.jsxs("span",{className:"font-bold text-xl sm:text-lg",children:[W.amount," جنيه"]}),e.jsx(I,{variant:"outline",className:"h-10 w-10 sm:h-8 sm:w-8 p-0","aria-label":"زيادة الدين",onClick:()=>{Wh("increase"),Ac(""),Nn(""),Ra(!1),wn(!0)},children:"+"})]})]}),(()=>{try{const a=(ie||[]).filter(r=>String((r==null?void 0:r.linkedDebtId)||"")===String(W.id)).reduce((r,i)=>r+Math.max(0,Number((i==null?void 0:i.commission)||0)),0);return a>0?e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"الربح:"}),e.jsxs("span",{className:"text-green-700 font-semibold",children:[a," جنيه"]})]}):null}catch{return null}})(),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"سبب الدين:"}),e.jsx("span",{children:W.reason})]}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"الحالة:"}),e.jsx(_a,{variant:W.status==="paid"?"default":"secondary",className:`${W.status==="paid"?"bg-green-500":"bg-yellow-500"} w-fit text-[12px] sm:text-xs`,children:W.status==="paid"?"مدفوع":"مؤجل"})]}),(()=>{const a=Number(W.amount||0),r=Number(W.paidAmount||0),i=Math.max(0,a-r);return e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"المبلغ المتبقي:"}),e.jsxs("span",{className:"font-bold text-xl sm:text-lg",children:[i," جنيه"]})]})})(),W.paidAmount?e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"إجمالي المدفوع:"}),e.jsxs("span",{className:"text-green-700",children:[W.paidAmount," جنيه"]})]}):null,W.partialPayments&&W.partialPayments.length>0&&e.jsxs("div",{className:"mt-3 text-[12px] sm:text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium mb-1",children:"سجل الدفعات الجزئية:"}),e.jsx("div",{className:"space-y-1 max-h-[30vh] sm:max-h-24 overflow-y-auto",children:W.partialPayments.map((a,r)=>e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsxs("span",{children:["دفع: ",a.amount," جنيه"]}),e.jsx("span",{children:new Date(a.paidAt).toLocaleString("ar-EG")})]},r))})]}),W.additionReceipts&&W.additionReceipts.length>0&&e.jsxs("div",{className:"mt-3 text-[12px] sm:text-xs text-gray-600",children:[e.jsx("p",{className:"font-medium mb-1",children:"إيصالات الإضافة الجزئية:"}),e.jsx("div",{className:"space-y-1 max-h-[20vh] sm:max-h-32 overflow-y-auto",children:W.additionReceipts.map((a,r)=>e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsxs("span",{children:["إضافة: ",a.amount," جنيه"]}),e.jsx("span",{children:new Date(a.addedAt).toLocaleString("ar-EG")}),a.note&&e.jsxs("span",{className:"sm:col-span-2 text-right text-[11px] text-gray-500",children:["ملاحظة: ",a.note]})]},r))})]})]})]}),e.jsxs(Pe,{className:"flex gap-2 justify-center",children:[e.jsx(I,{onClick:async()=>{if(W){const a=Ie.map(r=>r.id===W.id?{...r,status:"pending"}:r);Mt(a),await Da(a);try{if(t!=null&&t.uid){const r=computedRemaining;await as.send(t.uid,`تم سداد الدين بالكامل للعميل ${W.debtorName}: المدفوع ${r} جنيه`)}}catch{}Ra(!1),p({title:"تم تحديث حالة الدين",description:"تم تعيين الدين كمؤجل"})}},variant:"outline",className:"bg-yellow-500 hover:bg-yellow-600 text-white",children:"مؤجل"}),e.jsx(I,{onClick:async()=>{if(W){const a=Number(W.amount||0),r=Number(W.paidAmount||0);let i=Math.max(0,a-r);try{const m=(ie||[]).filter(x=>String((x==null?void 0:x.linkedDebtId)||"")===String(W.id)),h=m.reduce((x,w)=>x+Math.max(0,Number((w==null?void 0:w.commission)||0)),0),g=m.reduce((x,w)=>x+Math.max(0,Number(((w==null?void 0:w.sentAmount)??(w==null?void 0:w.transferredAmount)??(w==null?void 0:w.withdrawnAmount)??(w==null?void 0:w.amount))||0)),0),y=a<g+h?a+h:a;i=Math.max(0,Number(y)-r)}catch{}const l=i,d=Ie.map(m=>{if(m.id!==W.id)return m;const h=Number(m.amount||0),g=Number(m.paidAmount||0),v=Number((g+l).toFixed(2)),y=v>=h;return{...m,amount:h,paidAmount:y?h:v,status:"paid",partialPayments:[...m.partialPayments||[],...l>0?[{amount:l,paidAt:new Date}]:[]]}});Mt(d);try{vr(d.find(m=>m.id===W.id)||null)}catch{}Cn(l),La("none"),Is(!0),await Da(d);try{const m=d.find(h=>h.id===W.id);if(t!=null&&t.uid&&(m!=null&&m.id)){const h=Te(V,"debts",m.id),g={...m,userId:t.uid,shopId:D||(n==null?void 0:n.shopId)||null,lastUpdated:new Date().toISOString()};Object.keys(g).forEach(v=>g[v]===void 0&&delete g[v]),await Ht(h,g,{merge:!0})}}catch(m){console.error("Failed to sync debt payment to collection:",m)}try{t!=null&&t.uid&&(W!=null&&W.id)&&(async()=>{const m=Oe(pe(V,"userTransactions"),ae("userId","==",t.uid),ae("linkedDebtId","==",W.id),ae("status","==","pending")),h=await ke(m);await Promise.allSettled(h.docs.map(w=>Xt(w.ref,{status:"completed",confirmedAt:new Date})));try{const w=h.docs.map(k=>{var S;return String(((S=k.data())==null?void 0:S.transactionId)||"")});t!=null&&t.uid&&w.forEach(k=>k&&se.removeLocalReceiptById(t.uid,k))}catch{}const g=Oe(pe(V,"transactions"),ae("userId","==",t.uid),ae("linkedDebtId","==",W.id),ae("status","==","pending")),v=await ke(g);await Promise.allSettled(v.docs.map(w=>Xt(w.ref,{status:"completed",confirmedAt:new Date})));try{const w=v.docs.map(k=>{var S;return String(k.id||((S=k.data())==null?void 0:S.transactionId)||"")});t!=null&&t.uid&&w.forEach(k=>k&&se.removeLocalReceiptById(t.uid,k))}catch{}const y=Oe(pe(V,"transactions"),ae("merchantUserId","==",t.uid),ae("linkedDebtId","==",W.id),ae("status","==","pending")),x=await ke(y);await Promise.allSettled(x.docs.map(w=>Xt(w.ref,{status:"completed",confirmedAt:new Date})));try{const w=x.docs.map(k=>{var S;return String(k.id||((S=k.data())==null?void 0:S.transactionId)||"")});t!=null&&t.uid&&w.forEach(k=>k&&se.removeLocalReceiptById(t.uid,k))}catch{}})().catch(m=>{console.error("تعذر تحديث حالة المعاملات المرتبطة بالدين:",m),p({title:"فشل تحديث حالة المعاملة",description:"تعذر تحديث حالة المعاملات المرتبطة بالدين",variant:"destructive"})})}catch(m){console.error("تعذر تجهيز تحديث حالة المعاملات المرتبطة:",m)}try{const m=Po(),h=localStorage.getItem(m);if(h){const v=(JSON.parse(h)||[]).map(y=>(y==null?void 0:y.linkedDebtId)===W.id&&(y==null?void 0:y.status)==="pending"?{...y,status:"completed",confirmedAt:new Date}:y);localStorage.setItem(m,JSON.stringify(v)),Vt(y=>y.map(x=>(x==null?void 0:x.linkedDebtId)===W.id&&(x==null?void 0:x.status)==="pending"?{...x,status:"completed",confirmedAt:new Date}:x))}}catch(m){console.warn("فشل تحديث حالة المعاملات المرتبطة محلياً بعد سداد الدين:",m)}Ra(!1),p({title:"تم تحديث حالة الدين",description:"تم تعيين الدين كمدفوع"})}},className:"bg-green-500 hover:bg-green-600",children:"مدفوع"}),e.jsx(I,{onClick:async()=>{if(W){const a=Ie.filter(r=>r.id!==W.id);Mt(a),await Da(a),Ra(!1),p({title:"تم حذف الدين",description:"تم حذف الدين بنجاح"})}},variant:"destructive",children:"حذف"})]})]})}),e.jsx(fe,{open:Rh,onOpenChange:a=>{jn(a),a||wr("")},children:e.jsxs(ge,{className:"w-[95vw] sm:max-w-[425px] rounded-2xl",children:[e.jsxs(ye,{children:[e.jsx(be,{className:"text-right",children:"دفع جزء من الدين"}),e.jsx(at,{className:"text-right",children:"أدخل المبلغ الذي تريد دفعه من هذا الدين ثم اضغط دفع."})]}),W&&e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"اسم المديون:"}),e.jsx("span",{children:W.debtorName})]}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"المبلغ الكلي:"}),e.jsxs("span",{children:[W.amount," جنيه"]})]}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"إجمالي المدفوع:"}),e.jsxs("span",{className:"text-green-700",children:[Number(W.paidAmount||0)," جنيه"]})]}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:justify-between",children:[e.jsx("span",{className:"font-medium",children:"المبلغ المتبقي:"}),e.jsxs("span",{className:"font-semibold",children:[Math.max(0,Number(W.amount||0)-Number(W.paidAmount||0))," ","جنيه"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"partialAmountDialog",className:"text-right block",children:"المبلغ المراد دفعه"}),e.jsx(Y,{id:"partialAmountDialog",type:"number",value:Ec,onChange:a=>wr(a.target.value),className:"text-right",placeholder:"أدخل المبلغ"})]})]}),e.jsxs(Pe,{className:"flex gap-2 justify-between",children:[e.jsx(I,{variant:"outline",onClick:()=>{jn(!1),wr("")},children:"إلغاء"}),e.jsx(I,{className:"bg-blue-600 hover:bg-blue-700",onClick:async()=>{const a=parseFloat(Ec);if(!W||isNaN(a)||a<=0){p({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}const r=Math.max(0,Number(W.amount||0)-Number(W.paidAmount||0));if(a>r){p({title:"مبلغ زائد",description:"المبلغ المدفوع أكبر من المتبقي",variant:"destructive"});return}const i=Number(((W.paidAmount||0)+a).toFixed(2)),d=Number(W.amount||0)-i<.01,m={...W,amount:Number(W.amount||0),paidAmount:i,status:d?"paid":"pending",partialPayments:[...W.partialPayments||[],{amount:a,paidAt:new Date}]},h=Ie.map(g=>g.id===W.id?m:g);Mt(h),vr(m),await Da(h);try{if(t!=null&&t.uid){const g=Math.max(0,Number(m.amount||0)-Number(m.paidAmount||0));await as.send(t.uid,`تم سداد جزء من دين ${m.debtorName}: المدفوع ${a} جنيه، المتبقي ${g} جنيه`)}}catch{}try{m.status==="paid"&&(t!=null&&t.uid)&&(async()=>{const g=Oe(pe(V,"userTransactions"),ae("userId","==",t.uid),ae("linkedDebtId","==",W.id),ae("status","==","pending")),v=await ke(g);await Promise.allSettled(v.docs.map(S=>Xt(S.ref,{status:"completed",confirmedAt:new Date})));try{const S=v.docs.map(T=>{var O;return String(((O=T.data())==null?void 0:O.transactionId)||"")});t!=null&&t.uid&&S.forEach(T=>T&&se.removeLocalReceiptById(t.uid,T))}catch{}const y=Oe(pe(V,"transactions"),ae("userId","==",t.uid),ae("linkedDebtId","==",W.id),ae("status","==","pending")),x=await ke(y);await Promise.allSettled(x.docs.map(S=>Xt(S.ref,{status:"completed",confirmedAt:new Date})));try{const S=x.docs.map(T=>{var O;return String(T.id||((O=T.data())==null?void 0:O.transactionId)||"")});t!=null&&t.uid&&S.forEach(T=>T&&se.removeLocalReceiptById(t.uid,T))}catch{}const w=Oe(pe(V,"transactions"),ae("merchantUserId","==",t.uid),ae("linkedDebtId","==",W.id),ae("status","==","pending")),k=await ke(w);await Promise.allSettled(k.docs.map(S=>Xt(S.ref,{status:"completed",confirmedAt:new Date})));try{const S=k.docs.map(T=>{var O;return String(T.id||((O=T.data())==null?void 0:O.transactionId)||"")});t!=null&&t.uid&&S.forEach(T=>T&&se.removeLocalReceiptById(t.uid,T))}catch{}})().catch(g=>{console.error("تعذر تحديث حالة المعاملات المرتبطة بالدين:",g),p({title:"فشل تحديث حالة المعاملة",description:"تعذر تحديث حالة المعاملات المرتبطة بالدين",variant:"destructive"})})}catch(g){console.error("تعذر تجهيز تحديث حالة المعاملات المرتبطة:",g)}try{const g=Po(),v=localStorage.getItem(g);if(v){const x=(JSON.parse(v)||[]).map(w=>(w==null?void 0:w.linkedDebtId)===W.id&&(w==null?void 0:w.status)==="pending"?{...w,status:"completed",confirmedAt:new Date}:w);localStorage.setItem(g,JSON.stringify(x)),Vt(w=>w.map(k=>(k==null?void 0:k.linkedDebtId)===W.id&&(k==null?void 0:k.status)==="pending"?{...k,status:"completed",confirmedAt:new Date}:k))}}catch(g){console.warn("فشل تحديث حالة المعاملات المرتبطة محلياً بعد سداد الدين:",g)}Cn(a),La("none"),Is(!0),jn(!1),wr(""),p({title:"تم تسجيل دفع جزء",description:`تم دفع ${a} جنيه بتاريخ ${new Date().toLocaleString("ar-EG")}`})},children:"دفع"})]})]})}),e.jsx(fe,{open:Mh,onOpenChange:wn,children:e.jsxs(ge,{className:"sm:max-w-md rounded-2xl shadow-elegant border border-gray-200",children:[e.jsxs(ye,{children:[e.jsx(be,{className:`text-right ${pa==="decrease"?"text-red-600":"text-green-600"}`,children:pa==="increase"?"كتابة بيانات الاضافة":pa==="decrease"?"إنقاص مبلغ الدين":"تعديل مبلغ الدين"}),e.jsx(at,{className:"text-right",children:pa==="increase"?"أدخل مبلغ الإضافة وملاحظات الاضافة ثم اضغط تأكيد.":`أدخل المبلغ ثم اضغط تأكيد لإتمام ${pa==="decrease"?"الإنقاص":"التعديل"}.`})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsx(Z,{htmlFor:"debtAdjustAmount",className:"text-right",children:pa==="increase"?"مبلغ الإضافة (جنيه)":"المبلغ (جنيه)"}),e.jsx(Y,{id:"debtAdjustAmount",type:"number",placeholder:"0.00",value:Tc,onChange:a=>Ac(a.target.value)}),pa==="increase"&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{htmlFor:"debtAdditionNote",className:"text-right",children:"ملاحظات الإضافة (اختياري)"}),e.jsx(Y,{id:"debtAdditionNote",placeholder:"اكتب ملاحظات عن سبب الإضافة",value:Pc,onChange:a=>Nn(a.target.value)})]}),W&&e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:["المبلغ الحالي: ",e.jsx("span",{className:"font-semibold",children:Number(W.amount||0).toFixed(2)})," جنيه"]})]}),e.jsxs(Pe,{className:"flex gap-2",children:[e.jsx(I,{variant:"secondary",onClick:()=>{wn(!1),Ra(!0),Nn("")},children:"إلغاء"}),e.jsx(I,{className:pa==="decrease"?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700",onClick:async()=>{try{if(!W||!pa)return;const a=Number(parseFloat(Tc||"0").toFixed(2));if(!a||isNaN(a)||a<=0){p({title:"قيمة غير صالحة",description:"يرجى إدخال مبلغ أكبر من صفر",variant:"destructive"});return}Nr(null),Oc({debtId:W.id,delta:a,type:pa}),wn(!1),Cs(!0)}catch(a){console.error("فشل تجهيز تعديل مبلغ الدين:",a),p({title:"خطأ",description:"تعذّر تجهيز تعديل مبلغ الدين",variant:"destructive"})}},children:"تأكيد"})]})]})}),e.jsx(fe,{open:Jh,onOpenChange:Is,children:e.jsxs(ge,{className:"sm:max-w-[480px]",children:[e.jsxs(ye,{children:[e.jsx(be,{className:"text-right",children:"اختيار مكان إضافة مبلغ السداد"}),e.jsx(at,{className:"text-right",children:"هل تريد إضافة مبلغ السداد إلى الفلوس النقدية أم إلى إحدى المحافظ؟"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsx(I,{variant:zt==="cash"?"default":"outline",className:zt==="cash"?"bg-blue-600 text-white":"",size:"sm",onClick:()=>La("cash"),children:"الفلوس النقدية"}),e.jsx(I,{variant:zt==="wallet"?"default":"outline",className:zt==="wallet"?"bg-blue-600 text-white":"",size:"sm",onClick:()=>La("wallet"),children:"أرصدة المحافظ"}),e.jsx(I,{variant:zt==="fawry"?"default":"outline",className:zt==="fawry"?"bg-amber-600 text-white":"",size:"sm",onClick:()=>La("fawry"),children:"فوري"}),e.jsx(I,{variant:zt==="none"?"default":"outline",className:zt==="none"?"bg-gray-600 text-white":"",size:"sm",onClick:()=>La("none"),children:"بدون إضافة"})]}),zt==="wallet"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-right",children:"اختر المحفظة للإضافة"}),e.jsxs("select",{className:"w-full border rounded p-2 text-right",value:Fa,onChange:a=>yo(a.target.value),children:[e.jsx("option",{value:"",children:"— اختر محفظة —"}),F&&F.length>0?F.map(a=>e.jsx("option",{value:a.id,children:a.phone||a.name||a.id},a.id)):Object.keys(ve||{}).map(a=>{var r,i,l,d;return e.jsx("option",{value:a,children:((r=F.find(m=>m.id===a))==null?void 0:r.phone)||((i=As==null?void 0:As.find(m=>m.id===a))==null?void 0:i.phone)||((l=As==null?void 0:As.find(m=>m.id===a))==null?void 0:l.name)||((d=F.find(m=>m.id===a))==null?void 0:d.name)||a},a)})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:["المبلغ المراد إضافته: ",e.jsxs("span",{className:"font-bold",children:[qc," جنيه"]})]})]}),e.jsxs(Pe,{className:"flex flex-wrap justify-between gap-2",children:[e.jsx(I,{variant:"outline",onClick:()=>{Is(!1),Cn(0),La(null),yo("")},children:"إلغاء"}),e.jsx(I,{onClick:async()=>{var a,r;try{const i=qc;if(!i||i<=0){Is(!1);return}const l=async(d,m)=>{if(t!=null&&t.uid&&W)try{const g={transactionId:Te(pe(V,"dummy_collection")).id,amount:i,transactionType:"cash_addition",type:"cash_addition",status:"completed",createdAt:new Date,senderName:W.debtorName,receiverName:"المحل",description:`سداد دين من العميل ${W.debtorName}`,paymentMethod:d,walletId:m||null,linkedDebtId:W.id,isDebtRepayment:!0};await se.saveUserTransaction(t.uid,g);try{P.invalidateQueries({queryKey:["recentTransactions",t==null?void 0:t.uid]})}catch{}}catch(h){console.error("Failed to create repayment receipt:",h)}};if(zt==="cash"){const d=We+i;Ze(d),localStorage.setItem(Ve(),d.toString());const m={cashBalance:d,lastUpdated:new Date().toISOString()},h=`userData_${t==null?void 0:t.uid}`;localStorage.setItem(h,JSON.stringify(m)),t!=null&&t.uid?(se.updateUserData(t.uid,m).catch(()=>me(!0)),localStorage.removeItem(h),me(!1)):me(!0),p({title:"تم إضافة مبلغ السداد",description:`تم إضافة ${i} جنيه إلى الفلوس النقدية`}),await l("cash")}else if(zt==="wallet"){if(!Fa){p({title:"اختر محفظة أولاً",description:"يرجى اختيار المحفظة لإضافة مبلغ السداد إليها",variant:"destructive"});return}const d={...ve,[Fa]:(ve[Fa]||0)+i};ct(d);const m=new Date().toISOString(),h={walletBalances:d,lastUpdated:m},g=`userData_${t==null?void 0:t.uid}`;if(localStorage.setItem(g,JSON.stringify(h)),localStorage.setItem(et(),JSON.stringify(d)),localStorage.setItem(`walletBalances_backup_${m}`,JSON.stringify(d)),t!=null&&t.uid){se.updateUserData(t.uid,h).catch(()=>me(!0));try{localStorage.removeItem(g)}catch{}me(!1)}else me(!0);p({title:"تم إضافة مبلغ السداد",description:`تم إضافة ${i} جنيه إلى المحفظة ${((a=F.find(v=>v.id===Fa))==null?void 0:a.phone)||((r=F.find(v=>v.id===Fa))==null?void 0:r.name)||Fa}`}),await l("wallet",Fa)}else if(zt==="none")p({title:"تم تسجيل السداد",description:`تم تسجيل ${i} جنيه بدون تعديل الأرصدة`});else if(zt==="fawry")p({title:"تم تسجيل سداد عبر فوري",description:`تم تسجيل ${i} جنيه كسداد عبر فوري بدون تعديل الأرصدة`}),await l("fawry");else{p({title:"اختر مصدر الإضافة",description:"يرجى اختيار إضافة المبلغ إلى النقدية أو المحفظة",variant:"destructive"});return}try{if(t!=null&&t.uid&&W){const d=Number(W.amount||0),m=Number(W.paidAmount||0),h=W.status==="paid"||m>=d,g=i>0?i:m||d,v=h?`تم سداد الدين بالكامل للعميل ${W.debtorName}: المدفوع ${m||g} جنيه`:`تم تسجيل سداد ${g} جنيه من دين العميل ${W.debtorName}`;await as.send(t.uid,v)}}catch{}}catch(i){console.error("خطأ أثناء إضافة مبلغ السداد:",i),p({title:"حدث خطأ",description:"تعذر إضافة مبلغ السداد، حاول مرة أخرى",variant:"destructive"})}finally{Is(!1),Cn(0),La(null),yo("");try{Ha(!0)}catch{}}},className:"bg-green-600 hover:bg-green-700",children:"تأكيد الإضافة"})]})]})}),e.jsx(fe,{open:dh,onOpenChange:ra,children:e.jsxs(ge,{hideClose:!0,className:"post-confirm-card sm:max-w-[420px] w-[90vw] rounded-2xl bg-gradient-to-br from-white via-indigo-50 to-blue-50 shadow-2xl border border-indigo-100",children:[e.jsxs(ye,{children:[e.jsx(be,{className:"text-right text-2xl font-bold",children:(Ue==null?void 0:Ue.type)==="transfer"?"مبلغ يجب استلامه":"مبلغ يجب تسليمه"}),e.jsx(at,{className:"text-right text-gray-600",children:(Ue==null?void 0:Ue.type)==="transfer"?"هذا هو المبلغ الواجب استلامه من العميل بعد التأكيد.":"هذا هو المبلغ الواجب تسليمه للعميل بعد التأكيد."})]}),e.jsxs("div",{className:"py-3 flex flex-col items-center gap-1.5",children:[e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-blue-700 tracking-wide",children:[Jt((Ue==null?void 0:Ue.amount)||0)," جنيه"]}),e.jsx("div",{className:"text-sm text-gray-500 text-right w-full",children:(Ue==null?void 0:Ue.type)==="transfer"?"المبلغ المعروض شامل عمولة التحويل.":Ue!=null&&Ue.isDeduct||!$e?"العمولة مخصومة من المبلغ المسلّم للعميل.":"العمولة مضافة ولا تؤثر على قيمة التسليم."})]}),e.jsxs(Pe,{className:"flex justify-end gap-2",children:[(Ue==null?void 0:Ue.type)==="transfer"&&e.jsx(I,{variant:"default",id:"sendCodeBtn",onClick:ym,disabled:pc,className:"btn-transfer-confirm bg-blue-600 hover:bg-blue-700 text-white border-0",children:pc?"جارٍ الإرسال...":"إرسال كود التحويل"}),e.jsx(I,{onClick:()=>{ra(!1),zi(null)},className:"bg-green-600 hover:bg-green-700 text-white",children:(Ue==null?void 0:Ue.type)==="transfer"?"تم الاستلام":"تم التسليم"})]}),(Ue==null?void 0:Ue.type)==="transfer"&&e.jsx("div",{className:"mt-4 border-t pt-4 w-full",children:e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(I,{variant:Et===0?"default":"outline",size:"sm",onClick:()=>fi(0),className:`flex-1 h-10 ${Et===0?"bg-blue-600 hover:bg-blue-700 text-white":"border-blue-200 text-blue-700 hover:bg-blue-50"}`,children:"SIM 1"}),e.jsx(I,{variant:Et===1?"default":"outline",size:"sm",onClick:()=>fi(1),className:`flex-1 h-10 ${Et===1?"bg-blue-600 hover:bg-blue-700 text-white":"border-blue-200 text-blue-700 hover:bg-blue-50"}`,children:"SIM 2"})]})})]})}),e.jsx(Ef,{open:mh,onClose:()=>Sa(!1),onSubmit:bm,deviceId:Yi||qa||"",recipientMsisdn:String(R==="transfer"?(rt==null?void 0:rt.receiver)||pt||"":((Ad=F.find(a=>a.id===E))==null?void 0:Ad.phone)||"").replace(/\D/g,"")}),e.jsx(sb,{isOpen:hh,onClose:()=>xc(!1),senderPhone:((Pd=F.find(a=>a.id===E))==null?void 0:Pd.phone)||"",receiverPhone:(rt==null?void 0:rt.receiver)||"",amount:Number((rt==null?void 0:rt.amount)||0),deviceId:Yi||qa||"",api:window.electronAPI}),e.jsx(wb,{isOpen:Jm,onClose:()=>Fi(!1),wallets:F,walletBalances:ve,onSelectWallet:a=>{Xs(a);const r=F.find(i=>i.id===a);if(r){bs(r.phone);try{localStorage.setItem(Xa(),a)}catch{}}Fi(!1)},selectedWalletId:E||void 0}),e.jsx(Sb,{open:Bt,onOpenChange:Ot}),e.jsx(rb,{open:Ye,onOpenChange:He}),!1,xe&&e.jsx("div",{className:"fixed inset-0 z-[100] bg-white dark:bg-slate-950 overflow-y-auto",children:e.jsx(Mf,{onBack:()=>L(!1)})}),e.jsx(fe,{open:Wi,onOpenChange:Ri,children:e.jsxs(ge,{className:"sm:max-w-md",dir:"rtl",children:[e.jsxs(ye,{children:[e.jsx(be,{children:"تقاريرك"}),e.jsx(at,{children:"اختر نوع التقرير ثم حدّد الشهر أو اليوم"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(Lf,{value:hn,onValueChange:a=>Bm(a),children:[e.jsxs(Ff,{className:"grid grid-cols-2 w-full",children:[e.jsx(qd,{value:"monthly",children:"تقارير شهر"}),e.jsx(qd,{value:"daily",children:"تقارير يوم"})]}),e.jsx(zd,{value:"monthly",className:"mt-3",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(Z,{className:"text-right",children:"الشهر"}),e.jsxs(Xd,{children:[e.jsx(Zd,{asChild:!0,children:e.jsxs(I,{variant:"outline",className:zs("w-full justify-start text-left font-normal",!Wa&&"text-muted-foreground"),children:[e.jsx(si,{className:"mr-2 h-4 w-4"}),Wa?da(new Date(`${Wa}-01`),"LLLL yyyy",{locale:nu}):e.jsx("span",{children:"اختر شهر"})]})}),e.jsx(sl,{className:"w-auto p-0",align:"start",children:e.jsx(il,{mode:"single",selected:Wa?new Date(`${Wa}-01`):void 0,onSelect:a=>$m(a?da(a,"yyyy-MM"):""),initialFocus:!0})})]})]})}),e.jsx(zd,{value:"daily",className:"mt-3",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(Z,{className:"text-right",children:"التاريخ"}),e.jsxs(Xd,{children:[e.jsx(Zd,{asChild:!0,children:e.jsxs(I,{variant:"outline",className:zs("w-full justify-start text-left font-normal",!Ma&&"text-muted-foreground"),children:[e.jsx(si,{className:"mr-2 h-4 w-4"}),Ma?da(new Date(Ma),"PPP",{locale:nu}):e.jsx("span",{children:"اختر تاريخ"})]})}),e.jsx(sl,{className:"w-auto p-0",align:"start",children:e.jsx(il,{mode:"single",selected:Ma?new Date(Ma):void 0,onSelect:a=>Fm(a?da(a,"yyyy-MM-dd"):""),initialFocus:!0})})]})]})})]}),Ns&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/20 p-3 rounded-lg border border-blue-100 dark:border-blue-900/30",children:[e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"عدد المعاملات"}),e.jsx("div",{className:"text-lg font-bold text-blue-800 dark:text-blue-200",children:Ns.count})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"إجمالي المبالغ"}),e.jsx("div",{className:"text-lg font-bold text-gray-800 dark:text-gray-200",children:Ns.totalAmount.toFixed(2)})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-950/20 p-3 rounded-lg border border-red-100 dark:border-red-900/30",children:[e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 mb-1",children:"المسحوب"}),e.jsx("div",{className:"text-lg font-bold text-red-800 dark:text-red-200",children:Ns.totalWithdrawn.toFixed(2)})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-950/20 p-3 rounded-lg border border-green-100 dark:border-green-900/30",children:[e.jsx("div",{className:"text-xs text-green-600 dark:text-green-400 mb-1",children:"المرسل"}),e.jsx("div",{className:"text-lg font-bold text-green-800 dark:text-green-200",children:Ns.totalSent.toFixed(2)})]}),e.jsx("div",{className:"col-span-2 bg-yellow-50 dark:bg-yellow-950/20 p-3 rounded-lg border border-yellow-100 dark:border-yellow-900/30",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:"الأرباح"}),e.jsx("div",{className:"text-lg font-bold text-yellow-800 dark:text-yellow-200",children:Ns.totalProfit.toFixed(2)})]})})]})]})]})})]}))},wv=Object.freeze(Object.defineProperty({__proto__:null,default:kb},Symbol.toStringTag,{value:"Module"}));export{il as C,Nu as P,wv as U,ya as a,Ys as b,ba as c,Ru as d,Xd as e,Zd as f,da as g,sl as h};
//# sourceMappingURL=UserDashboardPage-C8NukZg-.js.map
