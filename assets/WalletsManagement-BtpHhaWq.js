import{a0 as X,r as x,u as Y,m as G,j as e,aa as J,ab as K,ac as Q,ad as w,y as L,I as N,B as g,aT as B,a_ as ne,aU as U,bA as H,a as de,ay as $,c as Z,d as oe,a3 as ce,e as me,ap as le,g as q}from"./index-DhbnydJl.js";import{P as E}from"./progress-QxZkw5ok.js";import{S as he,a as xe,b as ge,c as ue,d as A}from"./select-Bn8RCTk-.js";import fe from"./WalletPrinterDialog-B3yID8sa.js";import{P as ye}from"./printer-DeiqlOce.js";import{S as pe}from"./square-pen-CSLFtBCt.js";import"./html2canvas.esm-BfYXEYrK.js";import"./wallet--cZcBirk.js";import"./arrow-left-DTf_k4UZ.js";import"./save-DZuHrrpv.js";import"./download-CAzB5lkL.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],ve=X("toggle-left",je);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],be=X("toggle-right",Le);function Ne({open:y,onOpenChange:S,wallet:s,onSuccess:F}){const[t,c]=x.useState({provider:(s==null?void 0:s.provider)||"",msisdn:(s==null?void 0:s.msisdn)||"",dailyLimit:(s==null?void 0:s.dailyLimit)||0,monthlyLimit:(s==null?void 0:s.monthlyLimit)||0,transferLimit:(s==null?void 0:s.transferLimit)||2e5,withdrawLimit:(s==null?void 0:s.withdrawLimit)||2e5,dailyTransferLimit:(s==null?void 0:s.dailyTransferLimit)||6e4,dailyWithdrawLimit:(s==null?void 0:s.dailyWithdrawLimit)||1e5,monthlyTransferLimit:(s==null?void 0:s.monthlyTransferLimit)||(s==null?void 0:s.transferLimit)||2e5,monthlyWithdrawLimit:(s==null?void 0:s.monthlyWithdrawLimit)||(s==null?void 0:s.withdrawLimit)||2e5,ownerName:(s==null?void 0:s.ownerName)||"",nationalId:(s==null?void 0:s.nationalId)||""}),[d,W]=x.useState(!1),[k,p]=x.useState(null),{user:m,userSubscription:j}=Y(),{toast:T}=G();x.useEffect(()=>{y&&s?(c({provider:s.provider||"",msisdn:s.msisdn||"",dailyLimit:s.dailyLimit??0,monthlyLimit:s.monthlyLimit??0,transferLimit:s.transferLimit??2e5,withdrawLimit:s.withdrawLimit??2e5,dailyTransferLimit:s.dailyTransferLimit??6e4,dailyWithdrawLimit:s.dailyWithdrawLimit??1e5,monthlyTransferLimit:s.monthlyTransferLimit??s.transferLimit??2e5,monthlyWithdrawLimit:s.monthlyWithdrawLimit??s.withdrawLimit??2e5,ownerName:s.ownerName||"",nationalId:s.nationalId||""}),p(null)):y&&!s&&(c({provider:"",msisdn:"",dailyLimit:0,monthlyLimit:0,transferLimit:2e5,withdrawLimit:2e5,dailyTransferLimit:6e4,dailyWithdrawLimit:1e5,monthlyTransferLimit:2e5,monthlyWithdrawLimit:2e5,ownerName:"",nationalId:""}),p(null))},[s,y]);const D=(r,u)=>{const a=r.slice(0,3);return u==="vodafone_cash"&&a==="010"||u==="orange_cash"&&a==="012"||u==="etisalat_cash"&&a==="011"||u==="instapay"&&a==="015"},_=r=>{switch(r){case"INVALID_MSISDN":return"رقم المحفظة غير صالح.";case"PROVIDER_MISMATCH":return"المزوّد لا يطابق مقدمة الرقم.";case"ALREADY_EXISTS":return"المحفظة مضافة قبل كده.";case"RLS_DENIED":return"ليست لديك صلاحية لإضافة المحفظة.";default:return"خطأ غير متوقع."}},P=async r=>{var u;if(r.preventDefault(),p(null),!/^01\d{9}$/.test(t.msisdn)){p("اكتب رقم 11 رقم يبدأ بـ 01.");return}if(!D(t.msisdn,t.provider)){p("مقدم الخدمة لا يتطابق مع مقدمة الرقم.");return}if(!(s!=null&&s.id)&&(m!=null&&m.uid))try{let a=!1;const n=((u=j==null?void 0:j.subscription)==null?void 0:u.planType)??(j==null?void 0:j.planType)??null,v=typeof n=="string"?n.toLowerCase():null;if(n===B.ZERO||v==="zero"||n===0||v==="0")a=!0;else{const f=await ne(m.uid),C=(f==null?void 0:f.planType)??(f==null?void 0:f.plan)??null,l=typeof C=="string"?C.toLowerCase():null;a=C===B.ZERO||l==="zero"||C===0||l==="0"}if(a&&(await U.getByMerchantId(m.uid)).length>=5){p("باقة زيرو تسمح بإضافة 5 محافظ فقط. قم بالترقية."),T({title:"تحذير",description:"لا يمكنك إضافة أكثر من 5 محافظ في باقة زيرو. قم بالترقية.",variant:"destructive"});return}}catch(a){console.warn("Zero plan limit check failed:",a)}W(!0);try{if(!(m!=null&&m.uid)){console.warn("يجب تسجيل الدخول قبل حفظ/إضافة المحفظة");return}const a={...t,merchantUserId:m==null?void 0:m.uid,isActive:!0,provider:t.provider};if(console.log("Saving wallet data:",a),s!=null&&s.id)await U.update(s.id,a),await H.setLimits(s.id,{dailyTransferLimit:t.dailyTransferLimit,dailyWithdrawLimit:t.dailyWithdrawLimit,monthlyTransferLimit:t.monthlyTransferLimit??t.transferLimit,monthlyWithdrawLimit:t.monthlyWithdrawLimit??t.withdrawLimit}),console.log("Wallet updated successfully"),F();else{console.log("Creating new wallet...");const n=await U.create(a);console.log("Wallet created with ID:",n),await H.setLimits(n,{dailyTransferLimit:t.dailyTransferLimit,dailyWithdrawLimit:t.dailyWithdrawLimit,monthlyTransferLimit:t.monthlyTransferLimit??t.transferLimit,monthlyWithdrawLimit:t.monthlyWithdrawLimit??t.withdrawLimit});const v={id:n,...a,dailyUsage:0,monthlyUsage:0};console.log("Final wallet object:",v),F(v)}T({title:"تم إضافة المحفظة",description:`تم ${s!=null&&s.id?"تحديث":"إضافة"} المحفظة بنجاح`}),S(!1)}catch(a){console.error("Error saving wallet:",a);let n="حصل خطأ أثناء الإضافة";a.code?n=_(a.code):a.message&&(n=a.message),T({title:"خطأ",description:n,variant:"destructive"})}finally{W(!1)}};return e.jsx(J,{open:y,onOpenChange:S,children:e.jsxs(K,{className:"sm:max-w-md",children:[e.jsx(Q,{children:e.jsx(w,{children:s!=null&&s.id?"تعديل المحفظة":"إضافة محفظة جديدة"})}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"provider",children:"المزود"}),e.jsxs(he,{value:t.provider,onValueChange:r=>c({...t,provider:r}),disabled:d,children:[e.jsx(xe,{children:e.jsx(ge,{placeholder:"اختر المزود"})}),e.jsxs(ue,{children:[e.jsx(A,{value:"vodafone_cash",children:"Vodafone Cash"}),e.jsx(A,{value:"etisalat_cash",children:"Etisalat Cash"}),e.jsx(A,{value:"orange_cash",children:"Orange Cash"}),e.jsx(A,{value:"instapay",children:"InstaPay"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"msisdn",children:"رقم الهاتف"}),e.jsx(N,{id:"msisdn",placeholder:"01xxxxxxxxx",value:t.msisdn,onChange:r=>c({...t,msisdn:r.target.value}),disabled:d,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"ownerName",children:"اسم صاحب المحفظة (اختياري)"}),e.jsx(N,{id:"ownerName",type:"text",value:t.ownerName,onChange:r=>c({...t,ownerName:r.target.value}),disabled:d,placeholder:"اكتب اسم صاحب المحفظة"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"nationalId",children:"الرقم القومي (اختياري)"}),e.jsx(N,{id:"nationalId",type:"text",value:t.nationalId,onChange:r=>c({...t,nationalId:r.target.value}),disabled:d,placeholder:"الرقم القومي"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"dailyWithdrawLimit",children:"حد السحب اليومي (ج.م)"}),e.jsx(N,{id:"dailyWithdrawLimit",type:"number",min:"0",step:"0.01",value:t.dailyWithdrawLimit,onChange:r=>c({...t,dailyWithdrawLimit:parseFloat(r.target.value)||0}),disabled:d,placeholder:"100000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"dailyTransferLimit",children:"حد التحويل اليومي (ج.م)"}),e.jsx(N,{id:"dailyTransferLimit",type:"number",min:"0",step:"0.01",value:t.dailyTransferLimit,onChange:r=>c({...t,dailyTransferLimit:parseFloat(r.target.value)||0}),disabled:d,placeholder:"60000"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"monthlyWithdrawLimit",children:"حد السحب الشهري (ج.م)"}),e.jsx(N,{id:"monthlyWithdrawLimit",type:"number",min:"0",step:"0.01",value:t.monthlyWithdrawLimit,onChange:r=>c({...t,monthlyWithdrawLimit:parseFloat(r.target.value)||2e5}),disabled:d,placeholder:"200000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"monthlyTransferLimit",children:"حد التحويل الشهري (ج.م)"}),e.jsx(N,{id:"monthlyTransferLimit",type:"number",min:"0",step:"0.01",value:t.monthlyTransferLimit,onChange:r=>c({...t,monthlyTransferLimit:parseFloat(r.target.value)||2e5}),disabled:d,placeholder:"200000"})]})]}),k&&e.jsx("div",{className:"text-red-600 text-sm mt-2",children:k}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>S(!1),disabled:d,children:"إلغاء"}),e.jsx(g,{type:"submit",disabled:d,className:"btn-primary",children:d?e.jsxs(e.Fragment,{children:[e.jsx(Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"جارِ الإضافة…"]}):s!=null&&s.id?"تحديث المحفظة":"إضافة المحفظة"})]})]})]})})}function Me({showAddButton:y=!0,showUsageBars:S=!0,showLimitCards:s=!0,showEditButton:F=!0,onWalletEdit:t}){const[c,d]=x.useState([]),[W,k]=x.useState(!0),[p,m]=x.useState(!1),[j,T]=x.useState(!1),[D,_]=x.useState(null),[P,r]=x.useState(y),[u,a]=x.useState(!1),[n,v]=x.useState(null),[f,C]=x.useState(void 0),{user:l}=Y(),{toast:I}=G();de(),x.useEffect(()=>{l!=null&&l.uid&&M()},[l==null?void 0:l.uid]);const M=async()=>{try{if(!(l!=null&&l.uid)){d([]),k(!1);return}k(!0);const h=(await U.getByMerchantId(l.uid)).map(o=>({...o,dailyUsage:o.dailyUsage||0,monthlyUsage:o.monthlyUsage||0,transferUsage:o.transferUsage||0,withdrawUsage:o.withdrawUsage||0}));d(h)}catch(i){console.error("Error fetching wallets from Firebase:",i),I({title:"خطأ",description:"فشل في تحميل المحافظ من الخادم. يرجى المحاولة مرة أخرى.",variant:"destructive"}),d([])}finally{k(!1)}},ee=async(i,h)=>{try{await U.update(i,{isActive:!h});const o=c.map(b=>b.id===i?{...b,isActive:!b.isActive}:b);d(o),I({title:"تم التحديث",description:`تم ${h?"إلغاء تفعيل":"تفعيل"} المحفظة بنجاح`})}catch(o){console.error("Error toggling wallet status:",o),I({title:"خطأ",description:"فشل في تحديث حالة المحفظة",variant:"destructive"})}},ie=async(i,h)=>{v({id:i,msisdn:h}),a(!0)},se=async()=>{if(n)try{await U.delete(n.id);const i=c.filter(h=>h.id!==n.id);d(i),l!=null&&l.uid&&await M(),I({title:"تم الحذف",description:`تم حذف المحفظة ${n.msisdn} بنجاح`})}catch(i){console.error("Error deleting wallet:",i),I({title:"خطأ",description:"فشل في حذف المحفظة",variant:"destructive"})}finally{a(!1),v(null)}},O=(i,h)=>{if(h===0)return"bg-muted";const o=i/h*100;return o>=100?"bg-destructive":o>=80?"bg-warning":"bg-success"},te=i=>{switch(i){case"vodafone_cash":return"bg-red-600";case"etisalat_cash":return"bg-green-600";case"orange_cash":return"bg-orange-600";case"instapay":return"bg-blue-600";default:return"bg-gray-600"}},re=i=>{switch(i){case"vodafone_cash":return"#dc2626";case"etisalat_cash":return"#16a34a";case"orange_cash":return"#ea580c";case"instapay":return"#2563eb";default:return"#6b7280"}},ae=i=>{switch(i){case"vodafone_cash":return"فودافون كاش";case"etisalat_cash":return"اتصالات كاش";case"orange_cash":return"أورانج كاش";case"instapay":return"إنستاباي";default:return String(i).replace(/_/g," ")}};return W?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"}),e.jsx("p",{className:"text-muted-foreground animate-pulse",children:"جاري تحميل المحافظ..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"محافظي"}),e.jsxs(g,{variant:"outline",size:"sm",onClick:M,disabled:W,className:"flex items-center gap-2",children:[e.jsx("svg",{className:`w-4 h-4 ${W?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"تحديث"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{onClick:()=>T(!0),variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"طباعة محفظة"]}),y&&P&&e.jsxs(g,{onClick:()=>{m(!0),r(!1)},className:"btn-primary",children:[e.jsx($,{className:"ml-2 h-4 w-4"}),"إضافة محفظة جديدة"]})]})]}),e.jsxs("div",{className:"grid gap-6",children:[c.map(i=>{var h,o,b,R,V,z;return e.jsxs(Z,{className:"card-glass hover:shadow-lg transition-all duration-300 border-l-4",style:{borderLeftColor:re(i.provider)},children:[e.jsx(oe,{className:"pb-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:`${te(i.provider)} text-white font-medium px-3 py-1`,children:ae(i.provider)}),e.jsx("div",{className:`w-3 h-3 rounded-full ${i.isActive?"bg-green-500":"bg-gray-400"}`,title:i.isActive?"نشط":"غير نشط"})]}),e.jsx(me,{className:"text-xl font-bold text-primary",children:i.msisdn}),i.label&&e.jsxs("span",{className:"text-sm text-muted-foreground font-medium",children:["(",i.label,")"]})]})}),e.jsxs("div",{className:"flex items-center gap-2 bg-muted/50 rounded-lg p-2",children:[F&&e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>{t&&t(i)},children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>ee(i.id,i.isActive),children:i.isActive?e.jsx(be,{className:"h-5 w-5 text-success"}):e.jsx(ve,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>ie(i.id,i.msisdn),className:"text-destructive hover:text-destructive",children:e.jsx(le,{className:"h-4 w-4"})})]})]})}),e.jsx(q,{className:"pt-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 p-3 rounded-md border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium mb-2 text-center",children:["الحدود الشهرية: ",i.provider," - ",i.msisdn]}),e.jsxs("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden flex",children:[e.jsx("div",{className:"w-1/2 bg-red-200 dark:bg-red-900/50 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-red-400 to-red-600 h-2 transition-all duration-200 ease-out",style:{width:`${i.withdrawLimit?Math.min((i.withdrawUsage||0)/i.withdrawLimit*100,100):0}%`}})}),e.jsx("div",{className:"w-1/2 bg-blue-200 dark:bg-blue-900/50 relative",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 h-2 transition-all duration-200 ease-out",style:{width:`${i.transferLimit?Math.min((i.transferUsage||0)/i.transferLimit*100,100):0}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsxs("div",{className:"text-xs text-red-600 dark:text-red-400 font-medium",children:["متبقي سحب: ",Math.max((i.withdrawLimit||0)-(i.withdrawUsage||0),0).toLocaleString()," جنيه"]}),e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium",children:["متبقي تحويل: ",Math.max((i.transferLimit||0)-(i.transferUsage||0),0).toLocaleString("en-US",{maximumFractionDigits:0})," جنيه"]})]})]}),S&&e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-3",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"الاستخدام اليومي"}),e.jsxs("span",{className:"font-bold",children:[(h=i.dailyUsage)==null?void 0:h.toLocaleString("en-US",{maximumFractionDigits:0})," / ",i.dailyLimit>0?i.dailyLimit.toLocaleString("en-US",{maximumFractionDigits:0}):"∞"," جنيه"]})]}),e.jsx(E,{value:i.dailyLimit>0?Math.min((i.dailyUsage||0)/i.dailyLimit*100,100):0,className:`h-3 ${O(i.dailyUsage||0,i.dailyLimit)}`}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1 text-right",children:[i.dailyLimit>0?((i.dailyUsage||0)/i.dailyLimit*100).toFixed(1):0,"% مستخدم"]})]}),S&&e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-3",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"الاستخدام الشهري"}),e.jsxs("span",{className:"font-bold",children:[(o=i.monthlyUsage)==null?void 0:o.toLocaleString()," / ",i.monthlyLimit>0?i.monthlyLimit.toLocaleString():"∞"," جنيه"]})]}),e.jsx(E,{value:i.monthlyLimit>0?Math.min((i.monthlyUsage||0)/i.monthlyLimit*100,100):0,className:`h-3 ${O(i.monthlyUsage||0,i.monthlyLimit)}`}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1 text-right",children:[i.monthlyLimit>0?((i.monthlyUsage||0)/i.monthlyLimit*100).toFixed(1):0,"% مستخدم"]})]}),s&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/30 rounded-lg p-4 border border-blue-200 dark:border-blue-900/50",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-3",children:[e.jsx("span",{className:"font-medium text-blue-700 dark:text-blue-400",children:"حد التحويل"}),e.jsxs("span",{className:"font-bold text-blue-900 dark:text-blue-200",children:[((b=i.transferUsage)==null?void 0:b.toLocaleString())||0," / ",((R=i.transferLimit)==null?void 0:R.toLocaleString())||2e5," جنيه"]})]}),e.jsx(E,{value:i.transferLimit?Math.min((i.transferUsage||0)/i.transferLimit*100,100):0,className:"h-3 bg-blue-100 dark:bg-blue-900/30"}),e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1 text-right",children:[i.transferLimit?((i.transferUsage||0)/i.transferLimit*100).toFixed(1):0,"% مستخدم"]}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1 text-right font-medium",children:["المتبقي: ",Math.max((i.transferLimit||0)-(i.transferUsage||0),0).toLocaleString()," جنيه"]})]}),s&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-950/30 rounded-lg p-4 border border-green-200 dark:border-green-900/50",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-3",children:[e.jsx("span",{className:"font-medium text-green-700 dark:text-green-400",children:"حد السحب"}),e.jsxs("span",{className:"font-bold text-green-900 dark:text-green-200",children:[((V=i.withdrawUsage)==null?void 0:V.toLocaleString())||0," / ",((z=i.withdrawLimit)==null?void 0:z.toLocaleString())||2e5," جنيه"]})]}),e.jsx(E,{value:i.withdrawLimit?Math.min((i.withdrawUsage||0)/i.withdrawLimit*100,100):0,className:"h-3 bg-green-100 dark:bg-green-900/30"}),e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1 text-right",children:[i.withdrawLimit?((i.withdrawUsage||0)/i.withdrawLimit*100).toFixed(1):0,"% مستخدم"]}),e.jsxs("div",{className:"text-xs text-green-700 dark:text-green-300 mt-1 text-right font-medium",children:["المتبقي: ",Math.max((i.withdrawLimit||0)-(i.withdrawUsage||0),0).toLocaleString()," جنيه"]})]})]})})]},i.id)}),c.length===0&&e.jsx(Z,{className:"card-glass",children:e.jsxs(q,{className:"text-center py-16",children:[e.jsx("div",{className:"bg-muted/30 rounded-full w-24 h-24 mx-auto mb-6 flex items-center justify-center",children:e.jsx($,{className:"w-12 h-12 text-muted-foreground"})}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"لا توجد محافظ"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"ابدأ بإضافة محفظتك الأولى لتتمكن من استقبال المدفوعات من عملائك"}),y&&P&&e.jsxs(g,{onClick:()=>{m(!0),r(!1)},size:"lg",className:"btn-primary px-8",children:[e.jsx($,{className:"w-5 h-5 ml-2"}),"إضافة محفظة جديدة"]})]})})]}),e.jsx(Ne,{open:p,onOpenChange:i=>{m(i),i||(_(null),r(!0))},wallet:D,onSuccess:i=>{console.log("onSuccess called with:",i),console.log("editingWallet:",D),i&&!D?(console.log("Adding new wallet to list"),d(h=>{const o=[...h,i];return console.log("Updated wallets list:",o),o})):(console.log("Refreshing wallets from Firebase"),M()),m(!1),_(null),r(!0)}}),e.jsx(J,{open:u,onOpenChange:a,children:e.jsxs(K,{children:[e.jsx(Q,{children:e.jsx(w,{children:"تأكيد حذف المحفظة"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["هل أنت متأكد من حذف المحفظة ",n==null?void 0:n.msisdn,"؟ هذا الإجراء لا يمكن التراجع عنه."]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{variant:"outline",onClick:()=>a(!1),children:"إلغاء"}),e.jsx(g,{variant:"destructive",onClick:se,children:"حذف"})]})]})]})}),e.jsx(fe,{isOpen:j,onClose:()=>{T(!1),C(void 0)},wallets:c.map(i=>({id:i.id,name:i.label||i.msisdn,phone:i.msisdn,walletProvider:i.provider})),initialWalletId:f})]})}export{Me as WalletsManagement};
//# sourceMappingURL=WalletsManagement-BtpHhaWq.js.map
