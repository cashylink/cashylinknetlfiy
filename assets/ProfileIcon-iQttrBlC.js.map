{"version":3,"file":"ProfileIcon-iQttrBlC.js","sources":["../../node_modules/lucide-react/dist/esm/icons/activity.js","../../node_modules/lucide-react/dist/esm/icons/cloud-download.js","../../node_modules/use-sync-external-store/cjs/use-sync-external-store-shim.production.js","../../node_modules/use-sync-external-store/shim/index.js","../../node_modules/@radix-ui/react-use-is-hydrated/dist/index.mjs","../../node_modules/@radix-ui/react-avatar/dist/index.mjs","../../src/components/ui/avatar.tsx","../../src/components/ChangePasswordDialog.tsx","../../src/utils/googleDriveBackup.ts","../../src/components/ProfileIcon.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Activity = createLucideIcon(\"Activity\", [\n  [\n    \"path\",\n    {\n      d: \"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2\",\n      key: \"169zse\"\n    }\n  ]\n]);\n\nexport { Activity as default };\n//# sourceMappingURL=activity.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst CloudDownload = createLucideIcon(\"CloudDownload\", [\n  [\"path\", { d: \"M12 13v8l-4-4\", key: \"1f5nwf\" }],\n  [\"path\", { d: \"m12 21 4-4\", key: \"1lfcce\" }],\n  [\"path\", { d: \"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284\", key: \"ui1hmy\" }]\n]);\n\nexport { CloudDownload as default };\n//# sourceMappingURL=cloud-download.js.map\n","/**\n * @license React\n * use-sync-external-store-shim.production.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\nvar React = require(\"react\");\nfunction is(x, y) {\n  return (x === y && (0 !== x || 1 / x === 1 / y)) || (x !== x && y !== y);\n}\nvar objectIs = \"function\" === typeof Object.is ? Object.is : is,\n  useState = React.useState,\n  useEffect = React.useEffect,\n  useLayoutEffect = React.useLayoutEffect,\n  useDebugValue = React.useDebugValue;\nfunction useSyncExternalStore$2(subscribe, getSnapshot) {\n  var value = getSnapshot(),\n    _useState = useState({ inst: { value: value, getSnapshot: getSnapshot } }),\n    inst = _useState[0].inst,\n    forceUpdate = _useState[1];\n  useLayoutEffect(\n    function () {\n      inst.value = value;\n      inst.getSnapshot = getSnapshot;\n      checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n    },\n    [subscribe, value, getSnapshot]\n  );\n  useEffect(\n    function () {\n      checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n      return subscribe(function () {\n        checkIfSnapshotChanged(inst) && forceUpdate({ inst: inst });\n      });\n    },\n    [subscribe]\n  );\n  useDebugValue(value);\n  return value;\n}\nfunction checkIfSnapshotChanged(inst) {\n  var latestGetSnapshot = inst.getSnapshot;\n  inst = inst.value;\n  try {\n    var nextValue = latestGetSnapshot();\n    return !objectIs(inst, nextValue);\n  } catch (error) {\n    return !0;\n  }\n}\nfunction useSyncExternalStore$1(subscribe, getSnapshot) {\n  return getSnapshot();\n}\nvar shim =\n  \"undefined\" === typeof window ||\n  \"undefined\" === typeof window.document ||\n  \"undefined\" === typeof window.document.createElement\n    ? useSyncExternalStore$1\n    : useSyncExternalStore$2;\nexports.useSyncExternalStore =\n  void 0 !== React.useSyncExternalStore ? React.useSyncExternalStore : shim;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('../cjs/use-sync-external-store-shim.production.js');\n} else {\n  module.exports = require('../cjs/use-sync-external-store-shim.development.js');\n}\n","// src/use-is-hydrated.tsx\nimport { useSyncExternalStore } from \"use-sync-external-store/shim\";\nfunction useIsHydrated() {\n  return useSyncExternalStore(\n    subscribe,\n    () => true,\n    () => false\n  );\n}\nfunction subscribe() {\n  return () => {\n  };\n}\nexport {\n  useIsHydrated\n};\n//# sourceMappingURL=index.mjs.map\n","\"use client\";\n\n// src/avatar.tsx\nimport * as React from \"react\";\nimport { createContextScope } from \"@radix-ui/react-context\";\nimport { useCallbackRef } from \"@radix-ui/react-use-callback-ref\";\nimport { useLayoutEffect } from \"@radix-ui/react-use-layout-effect\";\nimport { Primitive } from \"@radix-ui/react-primitive\";\nimport { useIsHydrated } from \"@radix-ui/react-use-is-hydrated\";\nimport { jsx } from \"react/jsx-runtime\";\nvar AVATAR_NAME = \"Avatar\";\nvar [createAvatarContext, createAvatarScope] = createContextScope(AVATAR_NAME);\nvar [AvatarProvider, useAvatarContext] = createAvatarContext(AVATAR_NAME);\nvar Avatar = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAvatar, ...avatarProps } = props;\n    const [imageLoadingStatus, setImageLoadingStatus] = React.useState(\"idle\");\n    return /* @__PURE__ */ jsx(\n      AvatarProvider,\n      {\n        scope: __scopeAvatar,\n        imageLoadingStatus,\n        onImageLoadingStatusChange: setImageLoadingStatus,\n        children: /* @__PURE__ */ jsx(Primitive.span, { ...avatarProps, ref: forwardedRef })\n      }\n    );\n  }\n);\nAvatar.displayName = AVATAR_NAME;\nvar IMAGE_NAME = \"AvatarImage\";\nvar AvatarImage = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAvatar, src, onLoadingStatusChange = () => {\n    }, ...imageProps } = props;\n    const context = useAvatarContext(IMAGE_NAME, __scopeAvatar);\n    const imageLoadingStatus = useImageLoadingStatus(src, imageProps);\n    const handleLoadingStatusChange = useCallbackRef((status) => {\n      onLoadingStatusChange(status);\n      context.onImageLoadingStatusChange(status);\n    });\n    useLayoutEffect(() => {\n      if (imageLoadingStatus !== \"idle\") {\n        handleLoadingStatusChange(imageLoadingStatus);\n      }\n    }, [imageLoadingStatus, handleLoadingStatusChange]);\n    return imageLoadingStatus === \"loaded\" ? /* @__PURE__ */ jsx(Primitive.img, { ...imageProps, ref: forwardedRef, src }) : null;\n  }\n);\nAvatarImage.displayName = IMAGE_NAME;\nvar FALLBACK_NAME = \"AvatarFallback\";\nvar AvatarFallback = React.forwardRef(\n  (props, forwardedRef) => {\n    const { __scopeAvatar, delayMs, ...fallbackProps } = props;\n    const context = useAvatarContext(FALLBACK_NAME, __scopeAvatar);\n    const [canRender, setCanRender] = React.useState(delayMs === void 0);\n    React.useEffect(() => {\n      if (delayMs !== void 0) {\n        const timerId = window.setTimeout(() => setCanRender(true), delayMs);\n        return () => window.clearTimeout(timerId);\n      }\n    }, [delayMs]);\n    return canRender && context.imageLoadingStatus !== \"loaded\" ? /* @__PURE__ */ jsx(Primitive.span, { ...fallbackProps, ref: forwardedRef }) : null;\n  }\n);\nAvatarFallback.displayName = FALLBACK_NAME;\nfunction resolveLoadingStatus(image, src) {\n  if (!image) {\n    return \"idle\";\n  }\n  if (!src) {\n    return \"error\";\n  }\n  if (image.src !== src) {\n    image.src = src;\n  }\n  return image.complete && image.naturalWidth > 0 ? \"loaded\" : \"loading\";\n}\nfunction useImageLoadingStatus(src, { referrerPolicy, crossOrigin }) {\n  const isHydrated = useIsHydrated();\n  const imageRef = React.useRef(null);\n  const image = (() => {\n    if (!isHydrated) return null;\n    if (!imageRef.current) {\n      imageRef.current = new window.Image();\n    }\n    return imageRef.current;\n  })();\n  const [loadingStatus, setLoadingStatus] = React.useState(\n    () => resolveLoadingStatus(image, src)\n  );\n  useLayoutEffect(() => {\n    setLoadingStatus(resolveLoadingStatus(image, src));\n  }, [image, src]);\n  useLayoutEffect(() => {\n    const updateStatus = (status) => () => {\n      setLoadingStatus(status);\n    };\n    if (!image) return;\n    const handleLoad = updateStatus(\"loaded\");\n    const handleError = updateStatus(\"error\");\n    image.addEventListener(\"load\", handleLoad);\n    image.addEventListener(\"error\", handleError);\n    if (referrerPolicy) {\n      image.referrerPolicy = referrerPolicy;\n    }\n    if (typeof crossOrigin === \"string\") {\n      image.crossOrigin = crossOrigin;\n    }\n    return () => {\n      image.removeEventListener(\"load\", handleLoad);\n      image.removeEventListener(\"error\", handleError);\n    };\n  }, [image, crossOrigin, referrerPolicy]);\n  return loadingStatus;\n}\nvar Root = Avatar;\nvar Image = AvatarImage;\nvar Fallback = AvatarFallback;\nexport {\n  Avatar,\n  AvatarFallback,\n  AvatarImage,\n  Fallback,\n  Image,\n  Root,\n  createAvatarScope\n};\n//# sourceMappingURL=index.mjs.map\n","import * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","import React, { useState } from \"react\";\r\nimport { Eye, EyeOff, Loader2 } from \"lucide-react\";\r\nimport { updatePassword, reauthenticateWithCredential, EmailAuthProvider } from \"firebase/auth\";\r\nimport { useFirebaseAuth } from \"@/contexts/FirebaseAuthContext\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { MasterPinDialog } from \"@/components/MasterPinDialog\";\r\n\r\ninterface ChangePasswordDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nexport function ChangePasswordDialog({ open, onOpenChange }: ChangePasswordDialogProps) {\r\n  const { user } = useFirebaseAuth();\r\n  const { toast } = useToast();\r\n  const [loading, setLoading] = useState(false);\r\n  const [showCurrentPassword, setShowCurrentPassword] = useState(false);\r\n  const [showNewPassword, setShowNewPassword] = useState(false);\r\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\r\n  const [isMasterPinDialogOpen, setIsMasterPinDialogOpen] = useState(false);\r\n  const [isReauthenticated, setIsReauthenticated] = useState(false);\r\n  \r\n  const [formData, setFormData] = useState({\r\n    currentPassword: \"\",\r\n    newPassword: \"\",\r\n    confirmPassword: \"\",\r\n  });\r\n\r\n  const [errors, setErrors] = useState({\r\n    currentPassword: \"\",\r\n    newPassword: \"\",\r\n    confirmPassword: \"\",\r\n  });\r\n\r\n  const validateForm = () => {\r\n    const newErrors = {\r\n      currentPassword: \"\",\r\n      newPassword: \"\",\r\n      confirmPassword: \"\",\r\n    };\r\n\r\n    if (!formData.currentPassword) {\r\n      newErrors.currentPassword = \"كلمة المرور الحالية مطلوبة\";\r\n    }\r\n\r\n    if (!formData.newPassword) {\r\n      newErrors.newPassword = \"كلمة المرور الجديدة مطلوبة\";\r\n    } else if (formData.newPassword.length < 6) {\r\n      newErrors.newPassword = \"كلمة المرور يجب أن تكون 6 أحرف على الأقل\";\r\n    }\r\n\r\n    if (!formData.confirmPassword) {\r\n      newErrors.confirmPassword = \"تأكيد كلمة المرور مطلوب\";\r\n    } else if (formData.newPassword !== formData.confirmPassword) {\r\n      newErrors.confirmPassword = \"كلمات المرور غير متطابقة\";\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return !Object.values(newErrors).some(error => error !== \"\");\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm() || !user || !user.email) {\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      // إعادة المصادقة أولاً\r\n      const credential = EmailAuthProvider.credential(user.email, formData.currentPassword);\r\n      await reauthenticateWithCredential(user, credential);\r\n\r\n      // افتح حوار الرقم السري الرئيسي للتحقق قبل التنفيذ الفعلي\r\n      setIsReauthenticated(true);\r\n      setIsMasterPinDialogOpen(true);\r\n      toast({\r\n        title: \"تأكيد الهوية\",\r\n        description: \"أدخل الرقم السري الرئيسي لتأكيد تغيير كلمة المرور\",\r\n      });\r\n\r\n    } catch (error: any) {\r\n      console.error(\"خطأ في تغيير كلمة المرور:\", error);\r\n      \r\n      let errorMessage = \"حدث خطأ أثناء تغيير كلمة المرور\";\r\n      \r\n      if (error.code === \"auth/wrong-password\") {\r\n        setErrors(prev => ({ ...prev, currentPassword: \"كلمة المرور الحالية غير صحيحة\" }));\r\n        return;\r\n      } else if (error.code === \"auth/weak-password\") {\r\n        setErrors(prev => ({ ...prev, newPassword: \"كلمة المرور ضعيفة جداً\" }));\r\n        return;\r\n      } else if (error.code === \"auth/requires-recent-login\") {\r\n        errorMessage = \"يجب تسجيل الدخول مرة أخرى لتغيير كلمة المرور\";\r\n      }\r\n\r\n      toast({\r\n        title: \"خطأ في تغيير كلمة المرور\",\r\n        description: errorMessage,\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const performPasswordUpdate = async () => {\r\n    if (!user) return;\r\n    setLoading(true);\r\n    try {\r\n      await updatePassword(user, formData.newPassword);\r\n\r\n      toast({\r\n        title: \"تم تغيير كلمة المرور بنجاح\",\r\n        description: \"تم تحديث كلمة المرور الخاصة بك بنجاح\",\r\n      });\r\n\r\n      // إعادة تعيين النموذج وإغلاق الحوارات\r\n      setFormData({\r\n        currentPassword: \"\",\r\n        newPassword: \"\",\r\n        confirmPassword: \"\",\r\n      });\r\n      setErrors({\r\n        currentPassword: \"\",\r\n        newPassword: \"\",\r\n        confirmPassword: \"\",\r\n      });\r\n      setIsMasterPinDialogOpen(false);\r\n      setIsReauthenticated(false);\r\n      onOpenChange(false);\r\n\r\n    } catch (error: any) {\r\n      console.error(\"خطأ في تحديث كلمة المرور:\", error);\r\n      let errorMessage = \"حدث خطأ أثناء تغيير كلمة المرور\";\r\n      if (error.code === \"auth/requires-recent-login\") {\r\n        errorMessage = \"انتهت جلسة المصادقة. يرجى إعادة إدخال كلمة المرور الحالية\";\r\n      }\r\n      toast({ title: \"خطأ في تغيير كلمة المرور\", description: errorMessage, variant: \"destructive\" });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (field: keyof typeof formData) => (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setFormData(prev => ({ ...prev, [field]: e.target.value }));\r\n    // مسح الخطأ عند الكتابة\r\n    if (errors[field]) {\r\n      setErrors(prev => ({ ...prev, [field]: \"\" }));\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setFormData({\r\n      currentPassword: \"\",\r\n      newPassword: \"\",\r\n      confirmPassword: \"\",\r\n    });\r\n    setErrors({\r\n      currentPassword: \"\",\r\n      newPassword: \"\",\r\n      confirmPassword: \"\",\r\n    });\r\n    setIsMasterPinDialogOpen(false);\r\n    setIsReauthenticated(false);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={open} onOpenChange={handleClose}>\r\n        <DialogContent className=\"sm:max-w-[425px]\">\r\n          <DialogHeader>\r\n            <DialogTitle>تغيير كلمة المرور</DialogTitle>\r\n            <DialogDescription>\r\n              أدخل كلمة المرور الحالية وكلمة المرور الجديدة لتحديث حسابك\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          \r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"currentPassword\">كلمة المرور الحالية</Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"currentPassword\"\r\n                  type={showCurrentPassword ? \"text\" : \"password\"}\r\n                  value={formData.currentPassword}\r\n                  onChange={handleInputChange(\"currentPassword\")}\r\n                  className={errors.currentPassword ? \"border-red-500\" : \"\"}\r\n                  autoComplete=\"off\"\r\n                  disabled={loading}\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowCurrentPassword(!showCurrentPassword)}\r\n                  disabled={loading}\r\n                >\r\n                  {showCurrentPassword ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n              {errors.currentPassword && (\r\n                <p className=\"text-sm text-red-500\">{errors.currentPassword}</p>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"newPassword\">كلمة المرور الجديدة</Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"newPassword\"\r\n                  type={showNewPassword ? \"text\" : \"password\"}\r\n                  value={formData.newPassword}\r\n                  onChange={handleInputChange(\"newPassword\")}\r\n                  className={errors.newPassword ? \"border-red-500\" : \"\"}\r\n                  autoComplete=\"new-password\"\r\n                  disabled={loading}\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowNewPassword(!showNewPassword)}\r\n                  disabled={loading}\r\n                >\r\n                  {showNewPassword ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n              {errors.newPassword && (\r\n                <p className=\"text-sm text-red-500\">{errors.newPassword}</p>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"confirmPassword\">تأكيد كلمة المرور الجديدة</Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"confirmPassword\"\r\n                  type={showConfirmPassword ? \"text\" : \"password\"}\r\n                  value={formData.confirmPassword}\r\n                  onChange={handleInputChange(\"confirmPassword\")}\r\n                  className={errors.confirmPassword ? \"border-red-500\" : \"\"}\r\n                  autoComplete=\"new-password\"\r\n                  disabled={loading}\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\r\n                  onClick={() => setShowConfirmPassword(!showConfirmPassword)}\r\n                  disabled={loading}\r\n                >\r\n                  {showConfirmPassword ? (\r\n                    <EyeOff className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <Eye className=\"h-4 w-4\" />\r\n                  )}\r\n                </Button>\r\n              </div>\r\n              {errors.confirmPassword && (\r\n                <p className=\"text-sm text-red-500\">{errors.confirmPassword}</p>\r\n              )}\r\n            </div>\r\n\r\n            <DialogFooter>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"outline\"\r\n                onClick={handleClose}\r\n                disabled={loading}\r\n              >\r\n                إلغاء\r\n              </Button>\r\n              <Button type=\"submit\" disabled={loading}>\r\n                {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                تغيير كلمة المرور\r\n              </Button>\r\n            </DialogFooter>\r\n          </form>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* حوار التحقق من الرقم السري الرئيسي */}\r\n      <MasterPinDialog\r\n        open={isMasterPinDialogOpen && isReauthenticated}\r\n        onOpenChange={(open) => {\r\n          setIsMasterPinDialogOpen(open);\r\n          if (!open) setIsReauthenticated(false);\r\n        }}\r\n        mode=\"verify\"\r\n        title=\"التحقق من الرقم السري الرئيسي\"\r\n        description=\"لا يمكن تغيير كلمة المرور إلا بعد التحقق من الرقم السري الرئيسي\"\r\n        onSuccess={performPasswordUpdate}\r\n        onCancel={() => {\r\n          setIsMasterPinDialogOpen(false);\r\n          setIsReauthenticated(false);\r\n        }}\r\n      />\r\n    </>\r\n  );\r\n}","import { Capacitor } from '@capacitor/core';\nimport { userDataService, merchantWalletService, dailyReportsArchiveService } from '@/integrations/firebase/services';\nimport { GoogleAuthProvider, OAuthCredential, signInWithPopup, type Auth } from 'firebase/auth';\n\nexport interface BackupResult {\n  ok: boolean;\n  error?: string;\n}\n\n// ====== تخزين واسترجاع توكن جوجل على الواجهة ======\nconst GOOGLE_TOKEN_KEY = 'cashy.google.accessToken';\nconst GOOGLE_EMAIL_KEY = 'cashy.google.email';\nconst GOOGLE_EXPIRES_KEY = 'cashy.google.expiresAt';\n\nfunction setGoogleAccessToken(token: string, email?: string, expiresAtSeconds?: number) {\n  try {\n    localStorage.setItem(GOOGLE_TOKEN_KEY, token);\n    if (email) localStorage.setItem(GOOGLE_EMAIL_KEY, email);\n    const exp = expiresAtSeconds ?? Math.floor(Date.now() / 1000) + 3500; // ~58min\n    localStorage.setItem(GOOGLE_EXPIRES_KEY, String(exp));\n  } catch {}\n}\n\nexport function getGoogleAccessTokenInfo(): { token: string | null; email: string | null; expiresAt: number | null } {\n  try {\n    const token = localStorage.getItem(GOOGLE_TOKEN_KEY);\n    const email = localStorage.getItem(GOOGLE_EMAIL_KEY);\n    const expiresAtStr = localStorage.getItem(GOOGLE_EXPIRES_KEY);\n    const expiresAt = expiresAtStr ? Number(expiresAtStr) : null;\n    return { token, email, expiresAt };\n  } catch {\n    return { token: null, email: null, expiresAt: null };\n  }\n}\n\nfunction isGoogleTokenValid(): boolean {\n  const { token, expiresAt } = getGoogleAccessTokenInfo();\n  if (!token) return false;\n  if (!expiresAt) return true;\n  return Math.floor(Date.now() / 1000) < expiresAt - 30; // 30s margin\n}\n\nexport async function signInWithGoogleForBackup(auth: Auth): Promise<{ ok: boolean; email?: string; error?: string }> {\n  try {\n    const provider = new GoogleAuthProvider();\n    provider.addScope('https://www.googleapis.com/auth/drive.file');\n    provider.addScope('https://www.googleapis.com/auth/userinfo.email');\n    provider.setCustomParameters({ prompt: 'consent', access_type: 'offline', include_granted_scopes: 'true' });\n\n    const result = await signInWithPopup(auth, provider);\n    const credential = GoogleAuthProvider.credentialFromResult(result) as OAuthCredential | null;\n    const accessToken = credential?.accessToken || null;\n    const email = result.user?.email || undefined;\n    if (!accessToken) {\n      return { ok: false, error: 'تعذر الحصول على توكن الوصول من جوجل' };\n    }\n    setGoogleAccessToken(accessToken, email);\n    return { ok: true, email };\n  } catch (e: any) {\n    const message = e?.message || 'فشل تسجيل الدخول بجوجل';\n    return { ok: false, error: message };\n  }\n}\n\n// ====== Google Identity Services (GIS) للحصول على access token باستخدام Client ID مخصص ======\nfunction loadGisScript(): Promise<void> {\n  return new Promise((resolve, reject) => {\n    if ((window as any).google?.accounts?.oauth2) {\n      resolve();\n      return;\n    }\n    const s = document.createElement('script');\n    s.src = 'https://accounts.google.com/gsi/client';\n    s.async = true;\n    s.onload = () => resolve();\n    s.onerror = () => reject(new Error('فشل تحميل مكتبة Google Identity Services'));\n    document.head.appendChild(s);\n  });\n}\n\nexport async function signInWithGoogleForBackupGis(clientId: string): Promise<{ ok: boolean; email?: string; error?: string }> {\n  try {\n    await loadGisScript();\n    const googleAny = (window as any).google;\n    if (!googleAny?.accounts?.oauth2) return { ok: false, error: 'مكتبة Google غير متاحة' };\n\n    const scopes = 'https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.email';\n    const tokenPromise = new Promise<string>((resolve, reject) => {\n      const client = googleAny.accounts.oauth2.initTokenClient({\n        client_id: clientId,\n        scope: scopes,\n        callback: (resp: any) => {\n          if (resp?.access_token) resolve(String(resp.access_token));\n          else reject(new Error('تعذر الحصول على access token'));\n        },\n        prompt: 'consent',\n      });\n      // أطلق الطلب وحضّر مهلة زمنية لضمان عدم التعليق في حال ظهور صفحة خطأ من جوجل\n      try { client.requestAccessToken({ prompt: 'consent' }); } catch (e) { reject(e); }\n\n      const timeoutMs = 12000; // 12 ثوانٍ مهلة كافية لالتقاط الأخطاء\n      const timer = setTimeout(() => {\n        reject(new Error('انتهت المهلة أثناء طلب رمز الوصول من جوجل'));\n      }, timeoutMs);\n\n      // نظّف المؤقت عند الحسم\n      const clear = (fn: Function) => (value: any) => { clearTimeout(timer); fn(value); };\n      // التفاف resolve/reject لضمان تنظيف المؤقت\n      (resolve as any) = clear(resolve);\n      (reject as any) = clear(reject);\n    });\n\n    const accessToken = await tokenPromise;\n    // جلب البريد من userinfo.email\n    let email: string | undefined = undefined;\n    try {\n      const resp = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {\n        headers: { Authorization: `Bearer ${accessToken}` },\n      });\n      const data = await resp.json().catch(() => ({}));\n      if (data?.email) email = String(data.email);\n    } catch {}\n\n    setGoogleAccessToken(accessToken, email);\n    return { ok: true, email };\n  } catch (e: any) {\n    const msg = e?.message || 'فشل تسجيل الدخول بجوجل';\n    return { ok: false, error: msg };\n  }\n}\n\n// بدء تدفق OAuth عبر خادم التطبيق\nexport async function startServerGoogleOauth(baseUrl?: string): Promise<boolean> {\n  try {\n    // لضمان تطابق redirect_uri تمامًا مع إعداد Google Cloud\n    // نستخدم دومين الإنتاج مباشرة: https://cashy.link/api/google/oauth2/start\n    const target = 'https://cashy.link/api/google/oauth2/start';\n    const w = window.open(target, 'cashy_google_oauth', 'width=600,height=650,menubar=no,toolbar=no');\n    return !!w;\n  } catch {\n    return false;\n  }\n}\n\n// انتظار توفر توكن السيرفر بعد إتمام الموافقة\nexport async function pollForServerGoogleToken(userId?: string, timeoutMs = 20000, intervalMs = 1500): Promise<boolean> {\n  const start = Date.now();\n  while (Date.now() - start < timeoutMs) {\n    const t = await fetchStoredRefreshToken(userId);\n    if (t && t.refresh_token) return true;\n    await new Promise(r => setTimeout(r, intervalMs));\n  }\n  return false;\n}\n\nexport async function fetchStoredRefreshToken(userId?: string): Promise<{ refresh_token: string; email: string } | null> {\n  // نحاول أولاً نقطة نهاية الإنتاج لضمان التطابق مع redirect_uri\n  try {\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), 6000); // 6s مهلة سريعة لتجنب التعليق\n    const resp = await fetch('https://cashy.link/api/google/oauth2/token', {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        ...(userId ? { 'X-USER-ID': userId } : {}),\n      },\n      credentials: 'include',\n      signal: controller.signal,\n    }).finally(() => clearTimeout(timeoutId));\n    const data = await resp.json().catch(() => ({}));\n    if (resp.ok && data?.ok && data?.refresh_token && data?.email) {\n      return { refresh_token: String(data.refresh_token), email: String(data.email) };\n    }\n  } catch {}\n\n  // مسارات محلية احتياطية إن كانت متاحة\n  for (const url of ['/api/google/oauth2/token', '/user/google-backup-token']) {\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 5000);\n      const resp = await fetch(url, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(userId ? { 'X-USER-ID': userId } : {}),\n        },\n        signal: controller.signal,\n      }).finally(() => clearTimeout(timeoutId));\n      const data = await resp.json().catch(() => ({}));\n      if (resp.ok && data?.ok && data?.refresh_token && data?.email) {\n        return { refresh_token: String(data.refresh_token), email: String(data.email) };\n      }\n    } catch {}\n  }\n  return null;\n}\n\nasync function exchangeRefreshToken(refreshToken: string): Promise<string | null> {\n  try {\n    const clientId = String((import.meta as any)?.env?.VITE_GOOGLE_OAUTH_CLIENT_ID || '').trim();\n    const clientSecret = String((import.meta as any)?.env?.VITE_GOOGLE_OAUTH_CLIENT_SECRET || '').trim();\n    const body = new URLSearchParams({\n      grant_type: 'refresh_token',\n      refresh_token: refreshToken,\n      client_id: clientId,\n    });\n    if (clientSecret) body.set('client_secret', clientSecret);\n    const resp = await fetch('https://oauth2.googleapis.com/token', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n      body: body.toString(),\n    });\n    const json = await resp.json().catch(() => ({}));\n    return json?.access_token ? String(json.access_token) : null;\n  } catch {\n    return null;\n  }\n}\n\nasync function ensureAppFolder(accessToken: string): Promise<string | null> {\n  const headers = { Authorization: `Bearer ${accessToken}` };\n  const q = encodeURIComponent(\"name='Cashy Backup' and mimeType='application/vnd.google-apps.folder' and trashed=false\");\n  const listUrl = `https://www.googleapis.com/drive/v3/files?q=${q}&fields=files(id,name)`;\n  const resp = await fetch(listUrl, { headers });\n  const data = await resp.json().catch(() => ({}));\n  const existing = Array.isArray(data?.files) ? data.files[0] : null;\n  if (existing?.id) return String(existing.id);\n  const createResp = await fetch('https://www.googleapis.com/drive/v3/files', {\n    method: 'POST',\n    headers: { ...headers, 'Content-Type': 'application/json' },\n    body: JSON.stringify({ name: 'Cashy Backup', mimeType: 'application/vnd.google-apps.folder' }),\n  });\n  const created = await createResp.json().catch(() => ({}));\n  return created?.id ? String(created.id) : null;\n}\n\nasync function findLatestFileInFolder(accessToken: string, parentFolderId: string): Promise<{ id: string; name: string } | null> {\n  const headers = { Authorization: `Bearer ${accessToken}` };\n  const q = encodeURIComponent(`'${parentFolderId}' in parents and trashed=false`);\n  const url = `https://www.googleapis.com/drive/v3/files?q=${q}&orderBy=modifiedTime desc&fields=files(id,name,modifiedTime,createdTime)`;\n  const resp = await fetch(url, { headers });\n  const data = await resp.json().catch(() => ({}));\n  const f = Array.isArray(data?.files) ? data.files[0] : null;\n  if (f?.id) return { id: String(f.id), name: String(f.name) };\n  return null;\n}\n\nasync function uploadJsonFile(accessToken: string, parentFolderId: string, filename: string, content: any): Promise<boolean> {\n  const metadata = { name: filename, parents: [parentFolderId] };\n  const boundary = 'foo_bar_baz_' + Math.random().toString(16).slice(2);\n  const delimiter = `\\r\\n--${boundary}\\r\\n`;\n  const closeDelim = `\\r\\n--${boundary}--`;\n  const body =\n    delimiter +\n    'Content-Type: application/json; charset=UTF-8\\r\\n\\r\\n' +\n    JSON.stringify(metadata) +\n    delimiter +\n    'Content-Type: application/json\\r\\n\\r\\n' +\n    JSON.stringify(content) +\n    closeDelim;\n  const resp = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {\n    method: 'POST',\n    headers: {\n      Authorization: `Bearer ${accessToken}`,\n      'Content-Type': `multipart/related; boundary=${boundary}`,\n    },\n    body,\n  });\n  return resp.ok;\n}\n\nasync function findFile(accessToken: string, parentFolderId: string, name: string): Promise<string | null> {\n  const headers = { Authorization: `Bearer ${accessToken}` };\n  const q = encodeURIComponent(`name='${name}' and '${parentFolderId}' in parents and trashed=false`);\n  const url = `https://www.googleapis.com/drive/v3/files?q=${q}&fields=files(id,name)`;\n  const resp = await fetch(url, { headers });\n  const data = await resp.json().catch(() => ({}));\n  const f = Array.isArray(data?.files) ? data.files[0] : null;\n  return f?.id ? String(f.id) : null;\n}\n\nasync function downloadFileJson(accessToken: string, fileId: string): Promise<any | null> {\n  const url = `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`;\n  const resp = await fetch(url, { headers: { Authorization: `Bearer ${accessToken}` } });\n  if (!resp.ok) return null;\n  const text = await resp.text();\n  try { return JSON.parse(text); } catch { return null; }\n}\n\nfunction collectLocalBackupData(): any {\n  const data: Record<string, any> = {};\n  try {\n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (!key) continue;\n      const val = localStorage.getItem(key);\n      data[key] = val;\n    }\n  } catch {}\n  return { platform: Capacitor.getPlatform(), ts: new Date().toISOString(), localStorage: data };\n}\n\nfunction restoreLocalBackupData(content: any): boolean {\n  try {\n    const obj = content?.localStorage;\n    if (obj && typeof obj === 'object') {\n      for (const [k, v] of Object.entries(obj)) {\n        localStorage.setItem(String(k), String(v ?? ''));\n      }\n      return true;\n    }\n  } catch {}\n  return false;\n}\n\nexport async function backupToGoogleDrive(userId?: string): Promise<BackupResult> {\n  // أولاً جرّب التوكن المخزّن في الواجهة (تسجيل الدخول بجوجل عبر Firebase)\n  let accessToken: string | null = null;\n  if (isGoogleTokenValid()) {\n    accessToken = getGoogleAccessTokenInfo().token;\n  }\n  // إن لم يكن متاحاً، نعود للتوكن المخزن بالخادم (في حال تم ربط سابقاً)\n  if (!accessToken) {\n    const stored = await fetchStoredRefreshToken(userId);\n    if (!stored) return { ok: false, error: 'لا يوجد ربط بحساب جوجل. يرجى تسجيل الدخول بجوجل أولاً.' };\n    accessToken = await exchangeRefreshToken(stored.refresh_token);\n  }\n  if (!accessToken) return { ok: false, error: 'فشل إنشاء access token' };\n  const folderId = await ensureAppFolder(accessToken);\n  if (!folderId) return { ok: false, error: 'فشل إنشاء/إيجاد مجلد التطبيق' };\n  const content = await collectFullBackupData(userId);\n  const tsName = `cashy-backup-${new Date().toISOString().replace(/[.:]/g, '-')}.json`;\n  const ok = await uploadJsonFile(accessToken, folderId, tsName, content);\n  return ok ? { ok: true } : { ok: false, error: 'فشل رفع الملف' };\n}\n\nexport async function restoreFromGoogleDrive(userId?: string): Promise<BackupResult> {\n  // أولاً جرّب التوكن المخزّن في الواجهة\n  let accessToken: string | null = null;\n  if (isGoogleTokenValid()) {\n    accessToken = getGoogleAccessTokenInfo().token;\n  }\n  // إن لم يكن متاحاً، نعود للتوكن المخزن بالخادم\n  if (!accessToken) {\n    const stored = await fetchStoredRefreshToken(userId);\n    if (!stored) return { ok: false, error: 'لا يوجد ربط بحساب جوجل. يرجى تسجيل الدخول بجوجل أولاً.' };\n    accessToken = await exchangeRefreshToken(stored.refresh_token);\n  }\n  if (!accessToken) return { ok: false, error: 'فشل إنشاء access token' };\n  const folderId = await ensureAppFolder(accessToken);\n  if (!folderId) return { ok: false, error: 'فشل إيجاد مجلد التطبيق' };\n  const latest = await findLatestFileInFolder(accessToken, folderId);\n  if (!latest?.id) return { ok: false, error: 'لا توجد نسخة احتياطية' };\n  const json = await downloadFileJson(accessToken, latest.id);\n  if (!json) return { ok: false, error: 'فشل تنزيل النسخة' };\n  const okLocal = restoreLocalBackupData(json);\n  const okFirestore = await restoreFullBackupData(userId, json);\n  return okLocal && okFirestore ? { ok: true } : { ok: false, error: 'فشل الاسترجاع' };\n}\n\n// إصدارات صريحة تعتمد فقط على التوكن المخزن في الواجهة\nexport async function backupToGoogleDriveWithUiToken(userId?: string): Promise<BackupResult> {\n  if (!isGoogleTokenValid()) return { ok: false, error: 'يرجى تسجيل الدخول بجوجل أولاً' };\n  const token = getGoogleAccessTokenInfo().token!;\n  const folderId = await ensureAppFolder(token);\n  if (!folderId) return { ok: false, error: 'فشل إنشاء/إيجاد مجلد التطبيق' };\n  const content = await collectFullBackupData(userId);\n  const tsName = `cashy-backup-${new Date().toISOString().replace(/[.:]/g, '-')}.json`;\n  const ok = await uploadJsonFile(token, folderId, tsName, content);\n  return ok ? { ok: true } : { ok: false, error: 'فشل رفع الملف' };\n}\n\nexport async function restoreFromGoogleDriveWithUiToken(userId?: string): Promise<BackupResult> {\n  if (!isGoogleTokenValid()) return { ok: false, error: 'يرجى تسجيل الدخول بجوجل أولاً' };\n  const token = getGoogleAccessTokenInfo().token!;\n  const folderId = await ensureAppFolder(token);\n  if (!folderId) return { ok: false, error: 'فشل إيجاد مجلد التطبيق' };\n  const latest = await findLatestFileInFolder(token, folderId);\n  if (!latest?.id) return { ok: false, error: 'لا توجد نسخة احتياطية' };\n  const json = await downloadFileJson(token, latest.id);\n  if (!json) return { ok: false, error: 'فشل تنزيل النسخة' };\n  const okLocal = restoreLocalBackupData(json);\n  const okFirestore = await restoreFullBackupData(userId, json);\n  return okLocal && okFirestore ? { ok: true } : { ok: false, error: 'فشل الاسترجاع' };\n}\n\nexport async function saveGoogleBackupToken(userId: string, email: string, refreshToken: string): Promise<boolean> {\n  try {\n    const resp = await fetch('/user/google-backup-token', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json', 'X-USER-ID': userId },\n      body: JSON.stringify({ email, refresh_token: refreshToken }),\n    });\n    const data = await resp.json().catch(() => ({}));\n    return !!(resp.ok && data?.ok);\n  } catch {\n    return false;\n  }\n}\n\n// ====== دعم النسخ الاحتياطي/الاسترجاع لبيانات Firestore (المحافظ – المعاملات – الديون – العملاء – التقارير) ======\n\nfunction serializeDate(val: any): any {\n  if (val instanceof Date) return val.toISOString();\n  return val;\n}\n\nfunction deepSerializeDates(obj: any): any {\n  if (obj === null || obj === undefined) return obj;\n  if (Array.isArray(obj)) return obj.map(deepSerializeDates);\n  if (typeof obj === 'object') {\n    const out: Record<string, any> = {};\n    for (const [k, v] of Object.entries(obj)) {\n      if (v instanceof Date) out[k] = serializeDate(v);\n      else out[k] = deepSerializeDates(v);\n    }\n    return out;\n  }\n  return obj;\n}\n\nasync function collectFullBackupData(userId?: string): Promise<any> {\n  // في حال عدم توفر userId، نوفر نسخة احتياطية محلية فقط\n  if (!userId) {\n    return {\n      version: 2,\n      ts: new Date().toISOString(),\n      userId: null,\n      local: collectLocalBackupData(),\n    };\n  }\n\n  try {\n    const [userData, wallets, transactions, reports] = await Promise.all([\n      userDataService.getUserData(userId),\n      merchantWalletService.getByMerchantId(userId),\n      userDataService.getUserTransactions(userId),\n      dailyReportsArchiveService.getByUser(userId, 500),\n    ]);\n\n    return {\n      version: 2,\n      ts: new Date().toISOString(),\n      userId,\n      local: collectLocalBackupData(),\n      firestore: {\n        userData: deepSerializeDates(userData),\n        wallets: deepSerializeDates(wallets),\n        userTransactions: deepSerializeDates(transactions),\n        dailyReportsArchive: deepSerializeDates(reports),\n      },\n    };\n  } catch (e) {\n    // في حال فشل جمع Firestore، لا نفشل النسخ الاحتياطي بالكامل — نعود للنسخة المحلية\n    return {\n      version: 2,\n      ts: new Date().toISOString(),\n      userId,\n      local: collectLocalBackupData(),\n      firestore: null,\n      error: 'تعذر جمع بعض بيانات Firestore',\n    };\n  }\n}\n\nfunction parseDateMaybe(val: any): any {\n  if (typeof val === 'string') {\n    const d = new Date(val);\n    if (!isNaN(d.getTime())) return d;\n  }\n  return val;\n}\n\nfunction deepParseDates(obj: any): any {\n  if (obj === null || obj === undefined) return obj;\n  if (Array.isArray(obj)) return obj.map(deepParseDates);\n  if (typeof obj === 'object') {\n    const out: Record<string, any> = {};\n    for (const [k, v] of Object.entries(obj)) {\n      out[k] = v instanceof Date ? v : parseDateMaybe(deepParseDates(v));\n    }\n    return out;\n  }\n  return obj;\n}\n\nasync function restoreFullBackupData(userId: string | undefined, content: any): Promise<boolean> {\n  try {\n    if (!userId) return false;\n    const firestore = content?.firestore;\n    const hasFs = firestore && typeof firestore === 'object';\n    if (!hasFs) return true; // اكتفِ بالنسخة المحلية\n\n    // 1) استرجاع بيانات المستخدم (تشمل الديون والعملاء والأرصدة والتقارير الملخصة)\n    if (firestore.userData) {\n      const parsedUserData = deepParseDates(firestore.userData);\n      try {\n        await userDataService.saveUserData(userId, parsedUserData);\n      } catch {}\n    }\n\n    // 2) استرجاع المحافظ\n    if (Array.isArray(firestore.wallets)) {\n      try {\n        const existing = await merchantWalletService.getByMerchantId(userId);\n        const existingKey = new Set(\n          existing.map(w => `${w.provider}|${w.msisdn}`)\n        );\n        for (const wRaw of firestore.wallets) {\n          const w = deepParseDates(wRaw);\n          const key = `${w.provider}|${w.msisdn}`;\n          if (!existingKey.has(key)) {\n            // أنشئ محفظة جديدة للمستخدم الحالي\n            await merchantWalletService.create({\n              merchantUserId: userId,\n              provider: w.provider,\n              msisdn: w.msisdn,\n              label: w.label ?? undefined,\n              isActive: w.isActive ?? true,\n              dailyLimit: Number(w.dailyLimit ?? 0),\n              monthlyLimit: Number(w.monthlyLimit ?? 0),\n              transferLimit: Number(w.transferLimit ?? 200000),\n              withdrawLimit: Number(w.withdrawLimit ?? 200000),\n              transferUsage: Number(w.transferUsage ?? 0),\n              withdrawUsage: Number(w.withdrawUsage ?? 0),\n              dailyTransferLimit: w.dailyTransferLimit ?? undefined,\n              dailyWithdrawLimit: w.dailyWithdrawLimit ?? undefined,\n              defaultTransferCommission: w.defaultTransferCommission ?? null,\n              defaultWithdrawCommission: w.defaultWithdrawCommission ?? null,\n            } as any);\n          }\n        }\n      } catch {}\n    }\n\n    // 3) استرجاع المعاملات (userTransactions) مع منع التكرار عبر الخدمة\n    if (Array.isArray(firestore.userTransactions)) {\n      try {\n        for (const tRaw of firestore.userTransactions) {\n          const t = deepParseDates(tRaw);\n          await userDataService.saveUserTransaction(userId, t);\n        }\n      } catch {}\n    }\n\n    // 4) استرجاع أرشيف التقارير اليومية مع تخطي الموجود\n    if (Array.isArray(firestore.dailyReportsArchive)) {\n      try {\n        const existingReports = await dailyReportsArchiveService.getByUser(userId, 1000);\n        const existKey = new Set(\n          existingReports.map(r => `${r.reportDate}|${r.walletId ?? 'null'}`)\n        );\n        for (const rRaw of firestore.dailyReportsArchive) {\n          const r = deepParseDates(rRaw);\n          const key = `${r.reportDate}|${r.walletId ?? 'null'}`;\n          if (!existKey.has(key)) {\n            await dailyReportsArchiveService.add({\n              userId,\n              reportDate: String(r.reportDate),\n              totalTransactions: Number(r.totalTransactions || 0),\n              totalAmount: Number(r.totalAmount || 0),\n              totalWithdrawn: Number(r.totalWithdrawn || 0),\n              totalSent: Number(r.totalSent || 0),\n              profit: r.profit !== undefined ? Number(r.profit) : undefined,\n              walletId: r.walletId ?? null,\n            });\n          }\n        }\n      } catch {}\n    }\n\n    return true;\n  } catch {\n    return false;\n  }\n}","import React, { useState, useEffect } from \"react\";\nimport { User, Settings, LogOut, Shield, CloudUpload, RefreshCw, LogIn, Cloud, MessageCircle, DownloadCloud } from \"lucide-react\";\nimport { useFirebaseAuth } from \"@/contexts/FirebaseAuthContext\";\nimport { useShift } from \"@/contexts/ShiftContext\";\nimport { useNavigate } from \"react-router-dom\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { ChangePasswordDialog } from \"./ChangePasswordDialog\";\nimport { getAvatarById } from \"@/utils/avatars\";\nimport { backupToGoogleDriveWithUiToken, restoreFromGoogleDriveWithUiToken, signInWithGoogleForBackupGis, signInWithGoogleForBackup, getGoogleAccessTokenInfo, startServerGoogleOauth, pollForServerGoogleToken, fetchStoredRefreshToken, saveGoogleBackupToken } from \"@/utils/googleDriveBackup\";\nimport { auth } from \"@/firebase\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { listenDesktopUpdates, selectDesktopUrl } from \"@/utils/appDownloadService\";\n\ninterface ProfileIconProps {\n  className?: string;\n}\n\nexport function ProfileIcon({ className }: ProfileIconProps) {\n  const { user, profile, signOut, updateUserProfile } = useFirebaseAuth();\n  const navigate = useNavigate();\n  const [showChangePassword, setShowChangePassword] = useState(false);\n  const { isShiftActive } = useShift();\n  const { toast } = useToast();\n  const [isBackingUp, setIsBackingUp] = useState(false);\n  const [isRestoring, setIsRestoring] = useState(false);\n  const [isGoogleSigning, setIsGoogleSigning] = useState(false);\n  const [{ token: googleToken }, setGoogleTokenInfo] = useState(() => getGoogleAccessTokenInfo());\n\n  type ElectronAPI = {\n    onUpdateAvailable: (cb: (payload: unknown) => void) => void;\n    onUpdateDownloaded: (cb: (payload: unknown) => void) => void;\n    onUpdateError: (cb: (payload: any) => void) => void;\n    onUpdateProgress?: (cb: (payload: { percent?: number|null; downloaded?: number; total?: number }) => void) => void;\n    checkUpdate: () => Promise<unknown>;\n    downloadUpdate: () => Promise<unknown>;\n    applyUpdate: () => Promise<unknown>;\n    openUpdateFolder?: () => Promise<unknown>;\n    appVersion?: () => Promise<string>;\n  };\n  const electronAPI = (typeof window !== 'undefined' ? (window as unknown as { electronAPI?: ElectronAPI }).electronAPI : undefined);\n  const isElectron = !!electronAPI;\n  const [updateAvailable, setUpdateAvailable] = useState<boolean>(false);\n  const [updateDialogOpen, setUpdateDialogOpen] = useState<boolean>(false);\n  const [updateVersion, setUpdateVersion] = useState<string>('');\n  const [updateNotes, setUpdateNotes] = useState<string>('');\n  const [updateProgress, setUpdateProgress] = useState<number>(0);\n  const [isDownloadingUpdate, setIsDownloadingUpdate] = useState<boolean>(false);\n  const [updateDownloadUrl, setUpdateDownloadUrl] = useState<string>(\"\");\n  const [currentVersion, setCurrentVersion] = useState<string>(\"\");\n  const [autoApplied, setAutoApplied] = useState<boolean>(false);\n\n  const compareVersions = (a?: string, b?: string): number => {\n    const pa = String(a || '').split('.').map((x) => parseInt(x, 10) || 0);\n    const pb = String(b || '').split('.').map((x) => parseInt(x, 10) || 0);\n    for (let i = 0; i < Math.max(pa.length, pb.length); i++) {\n      const da = pa[i] || 0; const db = pb[i] || 0;\n      if (da > db) return 1; if (da < db) return -1;\n    }\n    return 0;\n  };\n\n  useEffect(() => {\n    if (!isElectron || !electronAPI) return;\n    try {\n      electronAPI.onUpdateAvailable((payload: { source?: string; info?: { version?: string; updateUrl?: string; notes?: string } }) => {\n        const v = String(payload?.info?.version || '');\n        setUpdateVersion(v);\n        setUpdateNotes(String(payload?.info?.notes || ''));\n        if (compareVersions(v, currentVersion) > 0) {\n          setUpdateAvailable(true);\n        } else {\n          setUpdateAvailable(false);\n        }\n      });\n      electronAPI.onUpdateDownloaded((payload: { source?: string; info?: { version?: string; updateUrl?: string; notes?: string } }) => {\n        const v = String(payload?.info?.version || '');\n        setUpdateVersion(v);\n        setUpdateNotes(String(payload?.info?.notes || ''));\n        setIsDownloadingUpdate(false);\n        setUpdateProgress(100);\n        if (compareVersions(v, currentVersion) > 0) {\n          setUpdateAvailable(true);\n        } else {\n          setUpdateAvailable(false);\n        }\n        try { if (isElectron && user?.uid && v) { (updateUserProfile as any)?.({ lastAckDesktopVersion: v }); } } catch {}\n      });\n      electronAPI.onUpdateError((payload: any) => {\n        try { toast({ title: 'فشل التحديث', description: String(payload?.message || payload?.code || 'تعذر التحميل'), variant: 'destructive' }); } catch {}\n      });\n      if (typeof electronAPI.onUpdateProgress === 'function') {\n        electronAPI.onUpdateProgress((payload) => {\n          const p = (payload?.percent == null ? 0 : Number(payload.percent));\n          setIsDownloadingUpdate(true);\n          setUpdateProgress(Math.max(0, Math.min(100, isNaN(p) ? 0 : p)));\n        });\n      }\n      if (typeof electronAPI.appVersion === 'function') {\n        electronAPI.appVersion().then((ver) => {\n          if (typeof ver === 'string') setCurrentVersion(ver);\n          try { if (isElectron && user?.uid && typeof ver === 'string' && ver) { (updateUserProfile as any)?.({ desktopInstalledVersion: ver }); } } catch {}\n        }).catch(() => {});\n      }\n    } catch (e) { void e; }\n  }, [isElectron, electronAPI]);\n\n  useEffect(() => {\n    if (!isElectron) return;\n    if (updateProgress >= 100) {\n      setUpdateDialogOpen(true);\n    }\n  }, [isElectron, updateProgress]);\n\n  useEffect(() => {\n    const unsub = listenDesktopUpdates((data) => {\n      const v = String(data?.version || \"\");\n      const uidVal = String(user?.uid || 'anon');\n      const seenKey = `desktop_update_seen_${uidVal}`;\n      let seen = '';\n      try { seen = localStorage.getItem(seenKey) || ''; } catch {}\n      if (v && v !== updateVersion) {\n        if (compareVersions(v, currentVersion) > 0) {\n          if (seen === v) {\n            setUpdateAvailable(false);\n            setUpdateDialogOpen(false);\n          } else {\n            setUpdateAvailable(true);\n            setUpdateDialogOpen(true);\n            try { localStorage.setItem(seenKey, v); } catch {}\n          }\n        } else {\n          setUpdateAvailable(false);\n        }\n        setUpdateVersion(v);\n        setUpdateNotes(String(data?.notes || \"\"));\n        const preferred = selectDesktopUrl({ downloadURL_64: data?.downloadURL_64, downloadURL_32: data?.downloadURL_32 }) || \"\";\n        setUpdateDownloadUrl(preferred);\n      }\n    });\n    return () => { try { unsub(); } catch {} };\n  }, [updateVersion, currentVersion, user?.uid]);\n\n  const handleConfirmUpdate = async () => {\n    try {\n      if (electronAPI) {\n        try { await electronAPI.checkUpdate(); } catch {}\n        setUpdateDialogOpen(true);\n        setIsDownloadingUpdate(true);\n        setUpdateProgress(0);\n        const res = await (electronAPI as any).downloadUpdate?.(updateDownloadUrl) ?? await electronAPI.downloadUpdate();\n        if (typeof res === 'string' && res.startsWith('err:')) {\n          try { toast({ title: 'فشل التحديث', description: res.slice(4), variant: 'destructive' }); } catch {}\n          setIsDownloadingUpdate(false);\n        } else if (res === 'noop') {\n          try { toast({ title: 'لا يوجد تحديث', description: 'لا تتوفر نسخة أحدث حالياً.' }); } catch {}\n        } else if (res === 'manual') {\n          try { toast({ title: 'جارٍ تنزيل التحديث', description: 'سيتم تطبيق التحديث تلقائيًا بعد اكتمال التنزيل.' }); } catch {}\n        } else if (res === 'autoUpdater') {\n          try { toast({ title: 'تنزيل تلقائي', description: 'سيتم تطبيق التحديث تلقائياً بواسطة النظام.' }); } catch {}\n        }\n      }\n    } catch (e) {\n      try { toast({ title: 'فشل التحديث', description: (e as any)?.message || 'حدث خطأ أثناء التنزيل', variant: 'destructive' }); } catch {}\n    }\n  };\n\n  const handleApplyUpdate = async () => {\n    try {\n      if (electronAPI) {\n        const res = await electronAPI.applyUpdate();\n        if (typeof res === 'string' && res.startsWith('err:')) {\n          try { toast({ title: 'فشل تطبيق التحديث', description: res.slice(4), variant: 'destructive' }); } catch {}\n        }\n      }\n    } catch (e) {\n      try { toast({ title: 'فشل تطبيق التحديث', description: (e as any)?.message || 'حدث خطأ أثناء تطبيق التحديث', variant: 'destructive' }); } catch {}\n    }\n  };\n\n\n  // استخراج الأحرف الأولى من الاسم أو البريد الإلكتروني\n  const getInitials = () => {\n    if (profile?.fullName) {\n      return profile?.fullName\n        .split(\" \")\n        .map((name) => name.charAt(0))\n        .join(\"\")\n        .toUpperCase()\n        .slice(0, 2);\n    }\n    if (user.email) {\n      return user.email.charAt(0).toUpperCase();\n    }\n    return \"U\";\n  };\n\n  // الحصول على صورة البروفيل الكرتونية\n  const selectedAvatar = profile?.avatarId ? getAvatarById(profile.avatarId) : null;\n\n  // مراقبة تغييرات البروفيل لإعادة التحديث\n  useEffect(() => {\n    console.log('Profile updated in ProfileIcon:', profile?.avatarId);\n  }, [profile?.avatarId]);\n\n  // التقط التوكن من نافذة الموافقة (cashy.link) عبر postMessage إن كانت مُهيأة على الخادم\n  useEffect(() => {\n    const handler = async (evt: MessageEvent) => {\n      try {\n        if (!evt?.data || typeof evt.data !== 'object') return;\n        if (evt.origin !== 'https://cashy.link') return;\n        const { type, email, refresh_token } = evt.data || {};\n        if (type === 'cashy_oauth_token' && user?.uid && email && refresh_token) {\n          const ok = await saveGoogleBackupToken(user.uid, String(email), String(refresh_token));\n          if (ok) {\n            toast({ title: 'تم ربط جوجل', description: 'تم حفظ توكن النسخ الاحتياطي عبر الخادم.' });\n          }\n        }\n      } catch (e) { void e; }\n    };\n    window.addEventListener('message', handler);\n    return () => window.removeEventListener('message', handler);\n  }, [user?.uid]);\n\n  if (!user) {\n    return null;\n  }\n\n  const handleSignOut = async () => {\n    try {\n      await signOut();\n    } catch (error) {\n      console.error(\"خطأ في تسجيل الخروج:\", error);\n    }\n  };\n\n  const handleBackup = async () => {\n    if (!user?.uid) return;\n    try {\n      setIsBackingUp(true);\n      // إذا لا يوجد توكن، نفّذ تسجيل الدخول أولاً ثم أكمل النسخ\n      if (!googleToken) {\n        // جرّب أولاً تدفق الخادم لربط حساب جوجل وحفظ refresh_token\n        const opened = await startServerGoogleOauth();\n        if (opened) {\n          const linked = await pollForServerGoogleToken(user.uid, 20000, 1500);\n          if (!linked) {\n            // لم يتم العثور على التوكن من الخادم خلال المهلة — جرّب GIS ثم Firebase\n            const signRes = await signInWithGoogleForBackupGis('483702062341-bhdprmoot8rto79jmjvkijdl7pbz28b.apps.googleusercontent.com');\n            if (!signRes.ok) {\n              const fbRes = await signInWithGoogleForBackup(auth);\n              if (!fbRes.ok) {\n                toast({ title: 'فشل تسجيل الدخول', description: fbRes.error || signRes.error || 'يرجى التسجيل بجوجل أولاً.', variant: 'destructive' });\n                return;\n              }\n            }\n            setGoogleTokenInfo(getGoogleAccessTokenInfo());\n          }\n        } else {\n          // تعذّر فتح نافذة الموافقة — جرّب GIS ثم Firebase مباشرة\n          const signRes = await signInWithGoogleForBackupGis('483702062341-bhdprmoot8rto79jmjvkijdl7pbz28b.apps.googleusercontent.com');\n          if (!signRes.ok) {\n            const fbRes = await signInWithGoogleForBackup(auth);\n            if (!fbRes.ok) {\n              toast({ title: 'فشل تسجيل الدخول', description: fbRes.error || signRes.error || 'يرجى التسجيل بجوجل أولاً.', variant: 'destructive' });\n              return;\n            }\n          }\n          setGoogleTokenInfo(getGoogleAccessTokenInfo());\n        }\n      }\n      const res = await backupToGoogleDriveWithUiToken(user.uid);\n      if (res.ok) {\n        toast({ title: 'تم النسخ الاحتياطي', description: 'تم حفظ بياناتك إلى Google Drive بنجاح.' });\n      } else {\n        toast({ title: 'فشل النسخ الاحتياطي', description: res.error || 'حدث خطأ أثناء النسخ الاحتياطي.', variant: 'destructive' });\n      }\n    } catch (e) {\n      toast({ title: 'خطأ غير متوقع', description: 'تعذر إكمال النسخ الاحتياطي.', variant: 'destructive' });\n    } finally {\n      setIsBackingUp(false);\n    }\n  };\n\n  const handleRestore = async () => {\n    if (!user?.uid) return;\n    try {\n      setIsRestoring(true);\n      // إذا لا يوجد توكن، نفّذ تسجيل الدخول أولاً ثم أكمل الاسترجاع\n      if (!googleToken) {\n        const opened = await startServerGoogleOauth();\n        if (opened) {\n          const linked = await pollForServerGoogleToken(user.uid, 20000, 1500);\n          if (!linked) {\n            const signRes = await signInWithGoogleForBackupGis('483702062341-bhdprmoot8rto79jmjvkijdl7pbz28b.apps.googleusercontent.com');\n            if (!signRes.ok) {\n              const fbRes = await signInWithGoogleForBackup(auth);\n              if (!fbRes.ok) {\n                toast({ title: 'فشل تسجيل الدخول', description: fbRes.error || signRes.error || 'يرجى التسجيل بجوجل أولاً.', variant: 'destructive' });\n                return;\n              }\n            }\n            setGoogleTokenInfo(getGoogleAccessTokenInfo());\n          }\n        } else {\n          const signRes = await signInWithGoogleForBackupGis('483702062341-bhdprmoot8rto79jmjvkijdl7pbz28b.apps.googleusercontent.com');\n          if (!signRes.ok) {\n            const fbRes = await signInWithGoogleForBackup(auth);\n            if (!fbRes.ok) {\n              toast({ title: 'فشل تسجيل الدخول', description: fbRes.error || signRes.error || 'يرجى التسجيل بجوجل أولاً.', variant: 'destructive' });\n              return;\n            }\n          }\n          setGoogleTokenInfo(getGoogleAccessTokenInfo());\n        }\n      }\n      const res = await restoreFromGoogleDriveWithUiToken(user.uid);\n      if (res.ok) {\n        toast({ title: 'تم الاسترجاع', description: 'تم استرجاع بياناتك بنجاح من Google Drive.' });\n      } else {\n        toast({ title: 'فشل الاسترجاع', description: res.error || 'حدث خطأ أثناء الاسترجاع.', variant: 'destructive' });\n      }\n    } catch (e) {\n      toast({ title: 'خطأ غير متوقع', description: 'تعذر إكمال الاسترجاع.', variant: 'destructive' });\n    } finally {\n      setIsRestoring(false);\n    }\n  };\n\n  const handleGoogleSignIn = async () => {\n    try {\n      setIsGoogleSigning(true);\n      // ابدأ أولاً تدفق الخادم وفق إعداداتك (start → callback)\n      const opened = await startServerGoogleOauth();\n      let linked = false;\n      if (opened && user?.uid) {\n        linked = await pollForServerGoogleToken(user.uid, 20000, 1500);\n      }\n      if (linked) {\n        toast({ title: 'تم ربط جوجل', description: `تم تفعيل النسخ الاحتياطي عبر الخادم` });\n        return;\n      }\n\n      // إن لم يكتمل ربط السيرفر، جرّب GIS ثم Firebase\n      const res = await signInWithGoogleForBackupGis('483702062341-bhdprmoot8rto79jmjvkijdl7pbz28b.apps.googleusercontent.com');\n      if (res.ok) {\n        const info = getGoogleAccessTokenInfo();\n        setGoogleTokenInfo(info);\n        toast({ title: 'تم ربط جوجل', description: `تم تفعيل النسخ الاحتياطي على Google Drive` });\n      } else {\n        const fb = await signInWithGoogleForBackup(auth);\n        if (fb.ok) {\n          const info = getGoogleAccessTokenInfo();\n          setGoogleTokenInfo(info);\n          toast({ title: 'تم ربط جوجل', description: `تم تفعيل النسخ الاحتياطي على Google Drive` });\n        } else {\n          toast({ title: 'فشل ربط جوجل', description: fb.error || res.error || 'حدث خطأ أثناء تسجيل الدخول بجوجل.', variant: 'destructive' });\n        }\n      }\n    } catch (e) {\n      toast({ title: 'خطأ غير متوقع', description: 'تعذر إكمال تسجيل الدخول بجوجل.', variant: 'destructive' });\n    } finally {\n      setIsGoogleSigning(false);\n    }\n  };\n\n  return (\n    <>\n      <div className=\"flex items-center gap-2\">\n        {/* تم إخفاء أيقونة النسخ الاحتياطي على جوجل */}\n\n        {isElectron && (\n          <Button\n            type=\"button\"\n            onClick={() => {\n              setUpdateDialogOpen(true);\n              if (compareVersions(updateVersion, currentVersion) > 0) {\n                setUpdateAvailable(true);\n              }\n            }}\n            title=\"تحديث التطبيق\"\n            className=\"relative inline-flex items-center justify-center w-9 h-9 rounded-md bg-transparent text-blue-600 hover:bg-blue-500/10 focus:outline-none dark:text-blue-400 dark:hover:bg-blue-400/10\"\n            variant=\"ghost\"\n          >\n            <DownloadCloud className=\"w-5 h-5\" />\n            {updateAvailable && (\n              <span className=\"absolute -top-0.5 -right-0.5 inline-block w-2 h-2 rounded-full bg-red-500\"></span>\n            )}\n          </Button>\n        )}\n\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              disabled={isShiftActive}\n              title={isShiftActive ? \"غير متاح أثناء وجود وردية كاشير نشطة\" : undefined}\n              className={`relative h-8 w-8 rounded-full p-0 hover:bg-transparent focus:ring-1 focus:ring-primary focus:ring-offset-1 transition-all duration-200 disabled:opacity-60 disabled:cursor-not-allowed ${className}`}\n            >\n              <Avatar className=\"h-8 w-8 border border-border shadow-sm hover:shadow-md transition-all duration-200 hover:scale-105 bg-white\">\n                {selectedAvatar ? (\n                  <div className=\"w-full h-full flex items-center justify-center bg-white dark:bg-neutral-900/20 rounded-full overflow-hidden\">\n                    <div className=\"w-full h-full flex items-center justify-center scale-[2.5]\">\n                      {selectedAvatar.component}\n                    </div>\n                  </div>\n                ) : (\n                  <>\n                    <AvatarImage\n                      src={user.photoURL || undefined}\n                      alt={profile?.fullName || user.email || \"المستخدم\"}\n                      className=\"object-cover\"\n                    />\n                    <AvatarFallback className=\"bg-white text-gray-900 font-semibold text-lg border-0\">\n                      {getInitials()}\n                    </AvatarFallback>\n                  </>\n                )}\n              </Avatar>\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent className=\"w-64\" align=\"end\" forceMount>\n          <DropdownMenuLabel className=\"font-normal\">\n            <div className=\"flex flex-col space-y-1\">\n              <p className=\"text-sm font-medium leading-none\">\n                {profile?.fullName || \"المستخدم\"}\n              </p>\n              <p className=\"text-xs leading-none text-muted-foreground\">\n                {user.email}\n              </p>\n              {profile?.role && (\n                <p className=\"text-xs leading-none text-muted-foreground\">\n                  الدور: {profile.role === \"staff\" ? \"مدير\" : profile.role === \"merchant\" ? \"تاجر\" : \"مستخدم\"}\n                </p>\n              )}\n            </div>\n          </DropdownMenuLabel>\n          <DropdownMenuSeparator />\n          <DropdownMenuItem \n            onClick={async () => {\n              try {\n                await updateUserProfile({ showWithdrawNote: !(profile?.showWithdrawNote ?? true) });\n              } catch (e) { void e; }\n            }}\n            className=\"cursor-pointer\"\n          >\n            <MessageCircle className=\"mr-2 h-4 w-4\" />\n            <span>{(profile?.showWithdrawNote ?? true) ? 'إخفاء خانة ملاحظة السحب' : 'إظهار خانة ملاحظة السحب'}</span>\n          </DropdownMenuItem>\n          <DropdownMenuSeparator />\n          <DropdownMenuItem \n            onClick={() => navigate('/profile-settings')}\n            className=\"cursor-pointer\"\n          >\n            <Settings className=\"mr-2 h-4 w-4\" />\n            <span>إعدادات البروفيل</span>\n          </DropdownMenuItem>\n          {(profile?.role === \"admin\" || profile?.role === \"staff\") && (\n            <DropdownMenuItem \n              onClick={() => navigate('/admin')}\n              className=\"cursor-pointer\"\n            >\n              <Shield className=\"mr-2 h-4 w-4\" />\n              <span>لوحة الإدارة</span>\n            </DropdownMenuItem>\n          )}\n          <DropdownMenuSeparator />\n          <DropdownMenuItem\n            onClick={handleSignOut}\n            className=\"cursor-pointer text-red-600 focus:text-red-600\"\n          >\n            <LogOut className=\"mr-2 h-4 w-4\" />\n            <span>تسجيل الخروج</span>\n          </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </div>\n\n      {isElectron && (\n        <Dialog open={updateDialogOpen} onOpenChange={(open) => {\n          setUpdateDialogOpen(open);\n          if (!open) {\n            const uidVal = String(user?.uid || 'anon');\n            const seenKey = `desktop_update_seen_${uidVal}`;\n            try { if (updateVersion) localStorage.setItem(seenKey, updateVersion); } catch {}\n            setUpdateAvailable(false);\n          }\n        }}>\n          <DialogContent className=\"sm:max-w-md\">\n            <DialogHeader>\n              <DialogTitle>يوجد تحديث جديد للبرنامج</DialogTitle>\n            </DialogHeader>\n            <div className=\"text-sm\">\n              {isDownloadingUpdate\n                ? 'جارٍ تنزيل التحديث...'\n                : (updateAvailable && compareVersions(updateVersion, currentVersion) > 0\n                    ? 'هل ترغب في تنزيله الآن؟'\n                    : 'التطبيق مُحدَّث لآخر إصدار')}\n            </div>\n            {updateVersion && (\n              <div className=\"mt-2 text-xs\">الإصدار الجديد: <span className=\"font-semibold\">v{updateVersion}</span></div>\n            )}\n            {currentVersion && (\n              <div className=\"mt-1 text-xs text-muted-foreground\">إصدار التطبيق لديك: <span className=\"font-semibold\">v{currentVersion}</span></div>\n            )}\n            {updateNotes && (\n              <div className=\"mt-2 text-xs text-muted-foreground whitespace-pre-line\">{updateNotes}</div>\n            )}\n            {isDownloadingUpdate && (\n              <div className=\"mt-3\">\n                <div className=\"w-full h-2 bg-gray-200 rounded\">\n                  <div className=\"h-2 bg-blue-600 rounded\" style={{ width: `${updateProgress}%` }} />\n                </div>\n                <div className=\"mt-1 text-xs text-muted-foreground\">{Math.round(updateProgress)}%</div>\n              </div>\n            )}\n            <div className=\"flex items-center justify-end gap-2 mt-3\">\n              <Button variant=\"outline\" onClick={() => {\n                const uidVal = String(user?.uid || 'anon');\n                const seenKey = `desktop_update_seen_${uidVal}`;\n                try { if (updateVersion) localStorage.setItem(seenKey, updateVersion); } catch {}\n                setUpdateAvailable(false);\n                setUpdateDialogOpen(false);\n              }}>إلغاء</Button>\n              {!isDownloadingUpdate && updateProgress < 100 && updateAvailable && compareVersions(updateVersion, currentVersion) > 0 && (\n                <Button className=\"bg-blue-600 hover:bg-blue-700\" onClick={handleConfirmUpdate}>بدء التنزيل</Button>\n              )}\n              {updateProgress >= 100 && (\n                <Button\n                  className=\"bg-green-600 hover:bg-green-700\"\n                  onClick={async () => {\n                    try {\n                      if (electronAPI?.openUpdateFolder) {\n                        const res = await electronAPI.openUpdateFolder();\n                        if (typeof res === 'string' && res.startsWith('err:')) {\n                          toast({ title: 'تعذر فتح مجلد التحديث', description: res.slice(4), variant: 'destructive' });\n                        } else {\n                          toast({ title: 'افتح ملف التثبيت', description: 'تم فتح مجلد التحديث — اضغط على الملف لتثبيت.' });\n                        }\n                      } else {\n                        await handleApplyUpdate();\n                      }\n                    } catch (e) {\n                      toast({ title: 'تعذر فتح مجلد التحديث', description: (e as any)?.message || 'حدث خطأ غير متوقع', variant: 'destructive' });\n                    }\n                  }}\n                >تحديث الآن</Button>\n              )}\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n\n      <ChangePasswordDialog\n        open={showChangePassword}\n        onOpenChange={setShowChangePassword}\n      />\n    </>\n  );\n}\n\nexport default ProfileIcon;\n"],"names":["Activity","createLucideIcon","CloudDownload","React","require$$0","is","x","y","objectIs","useState","useEffect","useLayoutEffect","useDebugValue","useSyncExternalStore$2","subscribe","getSnapshot","value","_useState","inst","forceUpdate","checkIfSnapshotChanged","latestGetSnapshot","nextValue","useSyncExternalStore$1","shim","useSyncExternalStoreShim_production","shimModule","useIsHydrated","useSyncExternalStore","AVATAR_NAME","createAvatarContext","createContextScope","AvatarProvider","useAvatarContext","Avatar","React.forwardRef","props","forwardedRef","__scopeAvatar","avatarProps","imageLoadingStatus","setImageLoadingStatus","React.useState","jsx","Primitive","IMAGE_NAME","AvatarImage","src","onLoadingStatusChange","imageProps","context","useImageLoadingStatus","handleLoadingStatusChange","useCallbackRef","status","FALLBACK_NAME","AvatarFallback","delayMs","fallbackProps","canRender","setCanRender","React.useEffect","timerId","resolveLoadingStatus","image","referrerPolicy","crossOrigin","isHydrated","imageRef","React.useRef","loadingStatus","setLoadingStatus","updateStatus","handleLoad","handleError","Root","Image","Fallback","className","ref","AvatarPrimitive.Root","cn","AvatarPrimitive.Image","AvatarPrimitive.Fallback","ChangePasswordDialog","open","onOpenChange","user","useFirebaseAuth","toast","useToast","loading","setLoading","showCurrentPassword","setShowCurrentPassword","showNewPassword","setShowNewPassword","showConfirmPassword","setShowConfirmPassword","isMasterPinDialogOpen","setIsMasterPinDialogOpen","isReauthenticated","setIsReauthenticated","formData","setFormData","errors","setErrors","validateForm","newErrors","error","handleSubmit","e","credential","EmailAuthProvider","reauthenticateWithCredential","errorMessage","prev","performPasswordUpdate","updatePassword","handleInputChange","field","handleClose","jsxs","Fragment","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","Label","Input","Button","EyeOff","Eye","DialogFooter","Loader2","MasterPinDialog","GOOGLE_TOKEN_KEY","GOOGLE_EMAIL_KEY","GOOGLE_EXPIRES_KEY","getGoogleAccessTokenInfo","token","email","expiresAtStr","expiresAt","saveGoogleBackupToken","userId","refreshToken","resp","data","ProfileIcon","profile","signOut","updateUserProfile","navigate","useNavigate","showChangePassword","setShowChangePassword","isShiftActive","useShift","isBackingUp","setIsBackingUp","isRestoring","setIsRestoring","isGoogleSigning","setIsGoogleSigning","googleToken","setGoogleTokenInfo","electronAPI","isElectron","updateAvailable","setUpdateAvailable","updateDialogOpen","setUpdateDialogOpen","updateVersion","setUpdateVersion","updateNotes","setUpdateNotes","updateProgress","setUpdateProgress","isDownloadingUpdate","setIsDownloadingUpdate","updateDownloadUrl","setUpdateDownloadUrl","currentVersion","setCurrentVersion","autoApplied","setAutoApplied","compareVersions","b","pa","pb","i","da","db","payload","v","_a","_b","p","ver","unsub","listenDesktopUpdates","seenKey","seen","preferred","selectDesktopUrl","handleConfirmUpdate","res","handleApplyUpdate","getInitials","name","selectedAvatar","getAvatarById","handler","evt","type","refresh_token","handleSignOut","DownloadCloud","DropdownMenu","DropdownMenuTrigger","DropdownMenuContent","DropdownMenuLabel","DropdownMenuSeparator","DropdownMenuItem","MessageCircle","Settings","Shield","LogOut"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5]}