import{$ as ts,u as Re,r as i,m as Ee,q as ae,aI as te,s as T,t as p,T as _,j as e,af as O,ag as L,ah as J,ai as M,aJ as V,y as f,I as j,B as d,a2 as Fe,at as fe,D as be,E as $,aL as je,V as y,S as Se,au as rs,C as ue,P as Ae,U as ns,aK as pe,M as is,ar as Q,aM as ls,a0 as ds}from"./index-F79wE54_.js";import{A as cs,a as os,b as ms,c as xs,d as hs,e as gs,f as us,g as ps}from"./alert-dialog-D_Ggvzn4.js";import{T as fs}from"./textarea-FNjKYb28.js";import{T as bs,a as js,b as Pe,c as Z,d as Ns,e as ee}from"./table-BFPgeLWW.js";import{S as vs,a as ys,b as ws,c as ks,d as Ie}from"./select-_viMUn4-.js";import{U as Oe}from"./users-DWr6-GT6.js";import{B as se}from"./SimCardsAccessDialog-D-7liTlf.js";import{S as $e}from"./tabs-Bk08CLam.js";import{W as Te,H as Cs,P as Ds}from"./wifi-BKprsSog.js";import{S as Ss}from"./save-Cw6XuImU.js";import"./index-Celli3AO.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Ps=ts("globe",As);function Is({isOpen:C,onClose:G,simCards:re}){const{user:D}=Re(),[t,x]=i.useState([]),[v,S]=i.useState(!1),[z,A]=i.useState(""),[w,B]=i.useState(""),[b,R]=i.useState(!1),{toast:k}=Ee();i.useEffect(()=>{if(!D||!C)return;const a=ae(T(p,"distributors"),te("userId","==",D.uid)),m=_(a,U=>{const P=[];U.forEach(I=>{P.push({id:I.id,...I.data()})}),x(P)},U=>{console.error("Error fetching distributors:",U)});return()=>m()},[C]);const E=async()=>{if(!D){k({title:"خطأ",description:"يجب تسجيل الدخول أولاً",variant:"destructive"});return}if(!z||!w){k({title:"خطأ",description:"يرجى إدخال الاسم والرقم",variant:"destructive"});return}R(!0);try{await be(T(p,"distributors"),{name:z,number:w,userId:D.uid,createdAt:$()}),A(""),B(""),k({title:"تم",description:"تم إضافة الموزع بنجاح"})}catch(a){console.error(a),k({title:"خطأ",description:"حدث خطأ أثناء الإضافة",variant:"destructive"})}finally{R(!1)}},H=async a=>{if(confirm("هل أنت متأكد من الحذف؟"))try{await je(y(p,"distributors",a)),k({title:"تم",description:"تم حذف الموزع"})}catch(m){console.error(m),k({title:"خطأ",description:"حدث خطأ أثناء الحذف",variant:"destructive"})}},K=a=>re.filter(m=>m.simNumber===a).length;return e.jsx(O,{open:C,onOpenChange:a=>!a&&G(),children:e.jsxs(L,{className:"sm:max-w-[425px]",dir:"rtl",children:[e.jsxs(J,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5"}),"إدارة الموزعين"]}),e.jsx(V,{children:"إضافة وحذف أرقام الموزعين لاستخدامها عند إضافة الخطوط"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg border",children:[e.jsx(f,{className:"text-xs font-semibold text-gray-500",children:"إضافة موزع جديد"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(j,{placeholder:"الاسم",value:z,onChange:a=>A(a.target.value),className:"h-8 text-sm"}),e.jsx(j,{placeholder:"الرقم",value:w,onChange:a=>B(a.target.value),className:"h-8 text-sm"})]}),e.jsxs(d,{onClick:E,disabled:b,size:"sm",className:"w-full h-8 gap-2 bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx(Fe,{className:"h-4 w-4"}),"إضافة"]})]}),e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:t.length===0?e.jsx("div",{className:"text-center text-gray-400 py-4 text-sm",children:"لا يوجد موزعين مضافين"}):t.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md border hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-sm",children:a.name}),e.jsx("span",{className:"text-xs text-gray-500 font-mono",children:a.number})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 px-2 py-0.5 rounded-full text-xs font-bold flex items-center gap-1",children:[e.jsx("span",{children:K(a.number)}),e.jsx("span",{className:"text-[10px] font-normal",children:"خط"})]}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>H(a.id),className:"h-7 w-7 text-red-500 hover:text-red-700 hover:bg-red-50",children:e.jsx(fe,{className:"h-4 w-4"})})]})]},a.id))})]})]})})}function Us({isOpen:C,onClose:G,shopId:re,onOpenAdsl:D}){const{user:t}=Re(),{toast:x}=Ee(),[v,S]=i.useState([]),[z,A]=i.useState(!0),[w,B]=i.useState(""),[b,R]=i.useState("all"),[k,E]=i.useState(!1),[H,K]=i.useState(null),[a,m]=i.useState({name:"",simNumber:"",lineNumber:"",callsPackage:"",internetPackage:"",adslPackage:"",totalAmount:"",remainingAmount:"",nationalId:"",whatsappNumber:"",notes:"",isPaid:!1}),[U,P]=i.useState(!1),[I,Le]=i.useState(null),[ne,Ne]=i.useState(""),[ve,ye]=i.useState(""),[Me,q]=i.useState(!1),[ie,le]=i.useState(null),[ze,we]=i.useState(!1),[de,Be]=i.useState([]);i.useEffect(()=>{if(!t)return;const s=ae(T(p,"distributors"),te("userId","==",t.uid)),r=_(s,l=>{const n=[];l.forEach(c=>{n.push({id:c.id,...c.data()})}),Be(n)});return()=>r()},[t]);const[ce,ke]=i.useState(!1),[He,Ue]=i.useState([]),[oe,qe]=i.useState(""),[me,_e]=i.useState(()=>{const s=new Date,r=s.getFullYear(),l=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return`${r}-${l}-${n}`}),[F,Ce]=i.useState("day");i.useEffect(()=>{if(!(t!=null&&t.uid))return;const s=`simCards_${t.uid}`;try{const n=localStorage.getItem(s);n&&(S(JSON.parse(n)),A(!1))}catch(n){console.warn("Error loading sim cards from localStorage",n)}if(!C)return;A(!0);const r=ae(T(p,"simCards"),te("userId","==",t.uid)),l=_(r,n=>{const c=n.docs.map(g=>({id:g.id,...g.data()})).sort((g,o)=>{var X,Y;const h=g.simNumber||"",N=o.simNumber||"";if(h!==N)return h?N?h.localeCompare(N):-1:1;const u=((X=g.createdAt)==null?void 0:X.seconds)||0;return(((Y=o.createdAt)==null?void 0:Y.seconds)||0)-u});console.log("Fetched SIM cards:",c),S(c),A(!1);try{localStorage.setItem(s,JSON.stringify(c))}catch(g){console.warn("Error saving sim cards to localStorage",g)}},n=>{console.error("Error fetching sim cards:",n),A(!1)});return()=>l()},[t==null?void 0:t.uid,C]);const xe=s=>{s?(K(s),m({name:s.name,simNumber:s.simNumber,lineNumber:s.lineNumber,callsPackage:s.callsPackage,internetPackage:s.internetPackage,adslPackage:s.adslPackage||"",totalAmount:s.totalAmount.toString(),remainingAmount:s.remainingAmount.toString(),nationalId:s.nationalId||"",whatsappNumber:s.whatsappNumber||"",notes:s.notes||"",isPaid:s.isPaid||!1})):(K(null),m({name:"",simNumber:"",lineNumber:"",callsPackage:"",internetPackage:"",adslPackage:"",totalAmount:"",remainingAmount:"",nationalId:"",whatsappNumber:"",notes:"",isPaid:!1})),E(!0)},Je=async()=>{if(t!=null&&t.uid)try{const s={name:a.name||"بدون اسم",simNumber:a.simNumber,lineNumber:a.lineNumber||"",callsPackage:a.callsPackage,internetPackage:a.internetPackage,adslPackage:a.adslPackage,totalAmount:parseFloat(a.totalAmount)||0,remainingAmount:parseFloat(a.remainingAmount)||0,nationalId:a.nationalId,whatsappNumber:a.whatsappNumber,notes:a.notes,isPaid:a.isPaid,userId:t.uid,shopId:re||t.uid,updatedAt:$()};H?(await Q(y(p,"simCards",H.id),s),x({title:"تم التحديث",description:"تم تحديث بيانات الخط بنجاح"})):(await be(T(p,"simCards"),{...s,createdAt:$()}),x({title:"تم الإضافة",description:"تم إضافة الخط الجديد بنجاح"})),E(!1)}catch(s){console.error(s),x({title:"خطأ",description:"حدث خطأ أثناء الحفظ",variant:"destructive"})}},Ve=s=>{le(s)},Ge=async()=>{if(ie)try{await je(y(p,"simCards",ie)),x({title:"تم الحذف",description:"تم حذف الخط بنجاح"})}catch(s){console.error(s),x({title:"خطأ",description:"فشل الحذف",variant:"destructive"})}finally{le(null)}},he=async(s,r)=>{S(l=>l.map(n=>n.id===s.id?{...n,isPaid:r,isDeferred:!1}:n));try{await Q(y(p,"simCards",s.id),{isPaid:r,isDeferred:!1,updatedAt:$()}),r&&await be(T(p,"simCardReceipts"),{cardId:s.id,cardName:s.name,amount:s.totalAmount,userId:t==null?void 0:t.uid,createdAt:$(),type:"payment"}),x({title:"تم التحديث",description:r?"تم تحديد الخط كمدفوع وتم تسجيل إيصال":"تم تحديد الخط كغير مدفوع"})}catch(l){S(n=>n.map(c=>c.id===s.id?{...c,isPaid:!r,isDeferred:s.isDeferred}:c)),console.error(l),x({title:"خطأ",description:"حدث خطأ أثناء تحديث الحالة",variant:"destructive"})}},Ke=s=>{var r;Le(s),Ne(s.name||""),ye(((r=s.totalAmount)==null?void 0:r.toString())||""),P(!0)},We=async()=>{if(!(t!=null&&t.uid)||!I)return;if(!ne.trim()){x({title:"خطأ",description:"يرجى إدخال اسم العميل",variant:"destructive"});return}const s=parseFloat(ve);if(isNaN(s)||s<=0){x({title:"خطأ",description:"يرجى إدخال مبلغ صحيح",variant:"destructive"});return}try{const r=y(p,"users",t.uid),n=(await ds(r)).data(),c=Array.isArray(n==null?void 0:n.debts)?n.debts:[],g={id:`DEBT-${Date.now()}`,debtorName:ne,mobile:I.lineNumber,amount:s,reason:"تمن تسديد باقة",status:"pending",createdAt:new Date,paidAmount:0,partialPayments:[]};await Q(r,{debts:[g,...c]}),S(o=>o.map(h=>h.id===I.id?{...h,isPaid:!1,isDeferred:!0,debtId:g.id}:h)),await Q(y(p,"simCards",I.id),{isPaid:!1,isDeferred:!0,debtId:g.id,updatedAt:$()}),x({title:"تم الإضافة",description:"تم إضافة الدين وتأجيل الخط"}),P(!1)}catch(r){console.error(r),x({title:"خطأ",description:"حدث خطأ أثناء حفظ الدين",variant:"destructive"})}};i.useEffect(()=>{if(!(t!=null&&t.uid))return;const s=y(p,"users",t.uid),r=_(s,async l=>{if(l.exists()){const c=l.data().debts||[],g=v.filter(o=>o.isDeferred&&!o.isPaid);for(const o of g){let h=!1;if(o.debtId){const N=c.find(u=>u.id===o.debtId);N&&N.status==="paid"&&(h=!0)}else c.find(u=>u.status==="paid"&&u.reason==="تمن تسديد باقة"&&(u.mobile&&u.mobile===o.lineNumber||!u.mobile&&u.debtorName===o.name&&Math.abs(u.amount-o.totalAmount)<.1))&&(h=!0);h&&await he(o,!0)}}});return()=>r()},[t==null?void 0:t.uid,v]);const De=v.filter(s=>{const r=s.name.toLowerCase().includes(w.toLowerCase())||s.lineNumber.includes(w)||s.simNumber.includes(w),l=b==="all"?!0:b==="paid"?s.isPaid:b==="unpaid"?!s.isPaid&&!s.isDeferred:b==="deferred"?s.isDeferred:!0;return r&&l}),Xe=v.filter(s=>s.isPaid).length,Ye=v.filter(s=>!s.isPaid&&!s.isDeferred).length,Qe=v.filter(s=>s.isDeferred).length,Ze=async()=>{q(!0)},es=async()=>{if(t!=null&&t.uid)try{const s=ls(p);v.forEach(r=>{if(r.isPaid){const l=y(p,"simCards",r.id);s.update(l,{isPaid:!1,updatedAt:$()})}}),await s.commit(),S(r=>r.map(l=>({...l,isPaid:!1}))),x({title:"تم التحديث",description:"تم تحويل جميع الخطوط إلى غير مدفوع بنجاح"}),q(!1)}catch(s){console.error("Error resetting cards:",s),x({title:"خطأ",description:"حدث خطأ أثناء تحديث الخطوط",variant:"destructive"}),q(!1)}},ss=async s=>{if(confirm(`هل أنت متأكد من حذف هذا الإيصال؟
سيتم حذف المبلغ من السجل نهائياً.`))try{await je(y(p,"simCardReceipts",s)),x({title:"تم الحذف",description:"تم حذف الإيصال بنجاح"})}catch(r){console.error(r),x({title:"خطأ",description:"فشل حذف الإيصال",variant:"destructive"})}};i.useEffect(()=>{if(!ce||!(t!=null&&t.uid))return;const s=ae(T(p,"simCardReceipts"),te("userId","==",t.uid)),r=_(s,l=>{const n=l.docs.map(c=>({id:c.id,...c.data()}));n.sort((c,g)=>{var N,u;const o=((N=c.createdAt)==null?void 0:N.seconds)||Math.floor(Date.now()/1e3);return(((u=g.createdAt)==null?void 0:u.seconds)||Math.floor(Date.now()/1e3))-o}),Ue(n)},l=>{console.error("Error fetching receipts:",l),x({title:"خطأ",description:"فشل تحميل السجل",variant:"destructive"})});return()=>r()},[ce,t==null?void 0:t.uid]);const ge=He.filter(s=>{var N;if(oe.trim()){const u=oe.toLowerCase(),W=v.find(as=>as.id===s.cardId),X=s.cardName.toLowerCase().includes(u),Y=W?W.lineNumber.includes(u)||W.simNumber.includes(u):!1;return X||Y}const r=(N=s.createdAt)!=null&&N.seconds?s.createdAt.seconds*1e3:Date.now(),l=new Date(r),[n,c,g]=me.split("-").map(Number),o=new Date(n,c-1,g),h=new Date(n,c-1,g);return F==="day"?(o.setHours(0,0,0,0),h.setHours(23,59,59,999)):(o.setDate(1),o.setHours(0,0,0,0),h.setMonth(h.getMonth()+1),h.setDate(0),h.setHours(23,59,59,999)),l>=o&&l<=h});return e.jsxs(e.Fragment,{children:[e.jsx(O,{open:C,onOpenChange:s=>!s&&G(),children:e.jsxs(L,{className:"max-w-screen w-screen h-screen flex flex-col p-0 gap-0 bg-gray-50 dark:bg-gray-900 rounded-none border-0",children:[e.jsxs("div",{className:"p-3 border-b bg-white dark:bg-gray-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-purple-100 dark:bg-purple-900/30 rounded-full text-purple-600",children:e.jsx(Se,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"text-base font-bold",children:"إدارة الخطوط"}),e.jsx(V,{className:"text-xs",children:"سجل ومتابعة خطوط الموبايل والباقات"})]})]}),e.jsx(d,{onClick:()=>G(),variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(rs,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 p-2 bg-gray-50/50 dark:bg-gray-900/50 border-b",children:[e.jsxs("div",{onClick:()=>R(b==="paid"?"all":"paid"),className:`cursor-pointer rounded-md border py-1.5 px-2 flex flex-row items-center justify-center gap-2 transition-all hover:shadow-sm ${b==="paid"?"bg-green-100 border-green-300 ring-1 ring-green-500 ring-offset-1 dark:ring-offset-gray-900":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-green-300"}`,children:[e.jsx("div",{className:`p-1 rounded-full ${b==="paid"?"bg-green-200":"bg-green-100"} text-green-700`,children:e.jsx(se,{className:"h-3.5 w-3.5"})}),e.jsxs("div",{className:"flex items-center gap-1.5 leading-none",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-600 dark:text-gray-400",children:"المدفوعة"}),e.jsx("div",{className:"text-sm font-bold text-green-600",children:Xe})]})]}),e.jsxs("div",{onClick:()=>R(b==="unpaid"?"all":"unpaid"),className:`cursor-pointer rounded-md border py-1.5 px-2 flex flex-row items-center justify-center gap-2 transition-all hover:shadow-sm ${b==="unpaid"?"bg-red-100 border-red-300 ring-1 ring-red-500 ring-offset-1 dark:ring-offset-gray-900":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-red-300"}`,children:[e.jsx("div",{className:`p-1 rounded-full ${b==="unpaid"?"bg-red-200":"bg-red-100"} text-red-700`,children:e.jsx(ue,{className:"h-3.5 w-3.5"})}),e.jsxs("div",{className:"flex items-center gap-1.5 leading-none",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-600 dark:text-gray-400",children:"غير المدفوعة"}),e.jsx("div",{className:"text-sm font-bold text-red-600",children:Ye})]})]}),e.jsxs("div",{onClick:()=>R(b==="deferred"?"all":"deferred"),className:`cursor-pointer rounded-md border py-1.5 px-2 flex flex-row items-center justify-center gap-2 transition-all hover:shadow-sm ${b==="deferred"?"bg-orange-100 border-orange-300 ring-1 ring-orange-500 ring-offset-1 dark:ring-offset-gray-900":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-orange-300"}`,children:[e.jsx("div",{className:`p-1 rounded-full ${b==="deferred"?"bg-orange-200":"bg-orange-100"} text-orange-700`,children:e.jsx(ue,{className:"h-3.5 w-3.5"})}),e.jsxs("div",{className:"flex items-center gap-1.5 leading-none",children:[e.jsx("div",{className:"text-[10px] font-bold text-gray-600 dark:text-gray-400",children:"مؤجلة الدفع"}),e.jsx("div",{className:"text-sm font-bold text-orange-600",children:Qe})]})]})]}),e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 border-b flex flex-col md:flex-row gap-3 justify-between items-center",children:[e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx($e,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(j,{placeholder:"بحث بالاسم أو الرقم...",value:w,onChange:s=>B(s.target.value),className:"pr-9"})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs(d,{onClick:()=>we(!0),variant:"outline",className:"flex-1 md:flex-none gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"الموزع"]}),D&&e.jsxs(d,{onClick:D,variant:"outline",className:"flex-1 md:flex-none gap-2 text-blue-600 border-blue-200 hover:bg-blue-50",children:[e.jsx(Te,{className:"h-4 w-4"}),"ADSL"]}),e.jsxs(d,{onClick:()=>ke(!0),variant:"outline",className:"flex-1 md:flex-none gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"سجل السداد"]}),e.jsxs(d,{onClick:()=>xe(),className:"flex-1 md:flex-none bg-purple-600 hover:bg-purple-700 text-white gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),"إضافة خط جديد"]}),e.jsxs(d,{onClick:Ze,variant:"destructive",className:"flex-1 md:flex-none gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"تحويل الكل لغير مدفوع"]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:z?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):De.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(Se,{className:"h-12 w-12 mb-3 opacity-20"}),e.jsx("p",{children:"لا توجد خطوط مسجلة"}),e.jsx(d,{variant:"link",onClick:()=>xe(),className:"text-purple-600",children:"إضافة أول خط"})]}):e.jsx("div",{className:"flex flex-col gap-3",children:De.map(s=>e.jsx("div",{className:`rounded-xl shadow-sm border p-3 hover:shadow-md transition-shadow ${s.isDeferred?"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800":s.isPaid?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"}`,children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto md:min-w-[200px]",children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center font-bold text-sm ${s.isDeferred?"bg-orange-100 text-orange-700 dark:bg-orange-800 dark:text-orange-100":s.isPaid?"bg-green-100 text-green-700 dark:bg-green-800 dark:text-green-100":"bg-red-100 text-red-700 dark:bg-red-800 dark:text-red-100"}`,children:s.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-gray-100 text-sm",children:s.name}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(Ae,{className:"h-3 w-3"}),e.jsx("span",{dir:"ltr",children:s.lineNumber})]})]})]}),e.jsxs("div",{className:"flex-1 w-full grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-x-4 gap-y-2 text-xs",children:[s.nationalId&&e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-500 text-[10px] flex items-center gap-1",children:[e.jsx(ns,{className:"h-3 w-3"})," القومي"]}),e.jsx("span",{className:"font-mono font-medium truncate",children:s.nationalId})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-500 text-[10px] flex items-center gap-1",children:[e.jsx(Cs,{className:"h-3 w-3"})," الموزع"]}),e.jsx("span",{className:`font-mono font-medium transition-colors ${s.simNumber?"cursor-pointer hover:text-purple-600 hover:underline":""}`,onClick:r=>{s.simNumber&&(r.stopPropagation(),B(s.simNumber),x({description:`تم تصفية الخطوط للموزع: ${s.simNumber}`}))},title:s.simNumber?"اضغط لعرض جميع خطوط هذا الموزع":void 0,children:s.simNumber||"-"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-500 text-[10px] flex items-center gap-1",children:[e.jsx(Ae,{className:"h-3 w-3"})," مكالمات"]}),e.jsx("span",{className:"font-medium",children:s.callsPackage||"-"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-500 text-[10px] flex items-center gap-1",children:[e.jsx(Ps,{className:"h-3 w-3"})," نت"]}),e.jsx("span",{className:"font-medium",children:s.internetPackage||"-"})]}),s.adslPackage&&e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-500 text-[10px] flex items-center gap-1",children:[e.jsx(Te,{className:"h-3 w-3"})," ADSL"]}),e.jsx("span",{className:"font-medium",children:s.adslPackage})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-gray-500 text-[10px] flex items-center gap-1",children:[e.jsx(se,{className:"h-3 w-3"})," الإجمالي"]}),e.jsx("span",{className:"font-bold text-gray-900",children:pe(s.totalAmount)})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full md:w-auto items-center",children:[s.whatsappNumber&&e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 text-green-600 hover:bg-green-50",onClick:()=>{const r=`مرحباً ${s.name}،
تذكير بموعد دفع فاتورة الخط رقم ${s.lineNumber}.
المبلغ المطلوب: ${s.totalAmount} جنيه.
شكراً لك!`,l=`https://wa.me/2${s.whatsappNumber}?text=${encodeURIComponent(r)}`;window.open(l,"_blank")},title:"إرسال تذكير واتساب",children:e.jsx(is,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex bg-white/50 rounded-lg p-1 gap-1 shadow-sm",children:[e.jsx(d,{size:"sm",className:`h-7 px-2 text-xs font-bold ${s.isPaid?"bg-green-600 hover:bg-green-700 text-white":"bg-white text-green-600 border border-green-200 hover:bg-green-50"}`,onClick:()=>he(s,!0),children:"مدفوع"}),e.jsx(d,{size:"sm",variant:"destructive",className:`h-7 px-2 text-xs font-bold ${!s.isPaid&&!s.isDeferred?"bg-red-600 hover:bg-red-700 text-white":"bg-white text-red-600 border border-red-200 hover:bg-red-50"}`,onClick:()=>he(s,!1),children:"غير"}),e.jsx(d,{size:"sm",variant:"outline",className:`h-7 px-2 text-xs font-bold ${s.isDeferred?"bg-orange-600 hover:bg-orange-700 text-white":"text-orange-600 border-orange-200 hover:bg-orange-50"}`,onClick:()=>Ke(s),children:"أجل"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-600 hover:bg-blue-50",onClick:()=>xe(s),children:e.jsx(Ds,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 hover:bg-red-50",onClick:()=>Ve(s.id),children:e.jsx(fe,{className:"h-4 w-4"})})]})]})]})},s.id))})})]})}),e.jsx(Is,{isOpen:ze,onClose:()=>we(!1),simCards:v}),e.jsx(cs,{open:!!ie,onOpenChange:s=>!s&&le(null),children:e.jsxs(os,{children:[e.jsxs(ms,{children:[e.jsx(xs,{children:"هل أنت متأكد من حذف هذا الخط؟"}),e.jsx(hs,{children:"لا يمكن التراجع عن هذا الإجراء بعد تنفيذه."})]}),e.jsxs(gs,{children:[e.jsx(us,{children:"إلغاء"}),e.jsx(ps,{onClick:Ge,className:"bg-red-600 hover:bg-red-700",children:"حذف"})]})]})}),e.jsx(O,{open:ce,onOpenChange:ke,children:e.jsxs(L,{className:"max-w-2xl h-[80vh] flex flex-col p-0",children:[e.jsxs(J,{className:"p-4 border-b",children:[e.jsx(M,{children:"سجل سداد الخطوط"}),e.jsx(V,{children:"عرض إيصالات السداد حسب التاريخ"})]}),e.jsxs("div",{className:"p-4 border-b bg-gray-50 flex flex-col gap-4",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx($e,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(j,{placeholder:"بحث في السجل بالاسم أو الرقم...",value:oe,onChange:s=>qe(s.target.value),className:"pr-9 bg-white"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-end w-full",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(f,{children:"نوع البحث"}),e.jsxs("div",{className:"flex bg-white rounded-md border p-1",children:[e.jsx("button",{onClick:()=>Ce("day"),className:`flex-1 px-3 py-1.5 text-sm rounded-sm transition-colors ${F==="day"?"bg-purple-100 text-purple-700 font-medium":"text-gray-600 hover:bg-gray-50"}`,children:"يومي"}),e.jsx("button",{onClick:()=>Ce("month"),className:`flex-1 px-3 py-1.5 text-sm rounded-sm transition-colors ${F==="month"?"bg-purple-100 text-purple-700 font-medium":"text-gray-600 hover:bg-gray-50"}`,children:"شهري"})]})]}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(f,{children:F==="day"?"اختر اليوم":"اختر الشهر"}),e.jsx(j,{type:F==="day"?"date":"month",value:F==="day"?me:me.substring(0,7),onChange:s=>_e(s.target.value),className:"bg-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-500 mb-1",children:"إجمالي الفترة"}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:pe(ge.reduce((s,r)=>s+(r.amount||0),0))})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-0 relative",children:ge.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-500",children:[e.jsx(se,{className:"h-12 w-12 mb-2 opacity-20"}),e.jsx("p",{children:"لا توجد عمليات سداد في هذه الفترة"})]}):e.jsxs(bs,{children:[e.jsx(js,{className:"sticky top-0 bg-white z-10 shadow-sm",children:e.jsxs(Pe,{children:[e.jsx(Z,{className:"text-right",children:"التاريخ"}),e.jsx(Z,{className:"text-right",children:"اسم الاشتراك"}),e.jsx(Z,{className:"text-right",children:"المبلغ"}),e.jsx(Z,{className:"w-[50px]"})]})}),e.jsx(Ns,{children:ge.map(s=>{var r;return e.jsxs(Pe,{children:[e.jsx(ee,{className:"font-mono text-xs text-gray-500",children:(r=s.createdAt)!=null&&r.seconds?new Date(s.createdAt.seconds*1e3).toLocaleString("ar-EG"):"الآن"}),e.jsx(ee,{className:"font-medium",children:s.cardName}),e.jsx(ee,{className:"font-bold text-green-600",children:pe(s.amount)}),e.jsx(ee,{children:e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-600 hover:bg-red-50",onClick:()=>ss(s.id),children:e.jsx(fe,{className:"h-4 w-4"})})})]},s.id)})})]})})]})}),e.jsx(O,{open:Me,onOpenChange:q,children:e.jsxs(L,{className:"max-w-md",children:[e.jsxs(J,{children:[e.jsx(M,{children:"تأكيد التحويل"}),e.jsxs(V,{children:['هل أنت متأكد من تحويل جميع الخطوط إلى "غير مدفوع"؟',e.jsx("br",{}),"سيتم تغيير حالة الدفع لجميع الخطوط المسجلة."]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(d,{variant:"outline",onClick:()=>q(!1),children:"إلغاء"}),e.jsx(d,{variant:"destructive",onClick:es,children:"نعم، تحويل الكل"})]})]})}),e.jsx(O,{open:k,onOpenChange:E,children:e.jsxs(L,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsx(M,{children:H?"تعديل بيانات الخط":"إضافة خط جديد"})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"الاسم"}),e.jsx(j,{value:a.name,onChange:s=>m({...a,name:s.target.value}),placeholder:"اسم العميل أو صاحب الخط"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"الرقم القومي (اختياري)"}),e.jsx(j,{value:a.nationalId,onChange:s=>m({...a,nationalId:s.target.value}),placeholder:"الرقم القومي...",dir:"ltr"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"رقم الخط"}),e.jsx(j,{value:a.lineNumber,onChange:s=>m({...a,lineNumber:s.target.value}),placeholder:"01xxxxxxxxx",dir:"ltr"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"رقم الموزع"}),e.jsxs(vs,{value:a.simNumber,onValueChange:s=>m({...a,simNumber:s}),children:[e.jsx(ys,{className:"text-right h-10",dir:"rtl",children:e.jsx(ws,{placeholder:"اختر الموزع"})}),e.jsxs(ks,{children:[de.map(s=>e.jsxs(Ie,{value:s.number,children:[s.name," (",s.number,")"]},s.id)),a.simNumber&&!de.some(s=>s.number===a.simNumber)&&e.jsxs(Ie,{value:a.simNumber,children:[a.simNumber," (غير مسجل)"]}),de.length===0&&!a.simNumber&&e.jsx("div",{className:"p-2 text-center text-xs text-gray-500",children:"لا يوجد موزعين"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"رقم الواتساب (اختياري)"}),e.jsx(j,{value:a.whatsappNumber,onChange:s=>m({...a,whatsappNumber:s.target.value}),placeholder:"رقم الواتساب...",dir:"ltr"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"باقة المكالمات"}),e.jsx(j,{value:a.callsPackage,onChange:s=>m({...a,callsPackage:s.target.value}),placeholder:"مثال: فليكس 45"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"باقة النت"}),e.jsx(j,{value:a.internetPackage,onChange:s=>m({...a,internetPackage:s.target.value}),placeholder:"مثال: سوبر ميجا 20"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"باقة ADSL (اختياري)"}),e.jsx(j,{value:a.adslPackage,onChange:s=>m({...a,adslPackage:s.target.value}),placeholder:"مثال: 140 جيجا"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"ملاحظات (اختياري)"}),e.jsx(fs,{value:a.notes,onChange:s=>m({...a,notes:s.target.value}),placeholder:"أي ملاحظات إضافية...",className:"resize-none"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"المبلغ الإجمالي"}),e.jsx(j,{type:"number",value:a.totalAmount,onChange:s=>m({...a,totalAmount:s.target.value}),placeholder:"0.00"})]})}),e.jsxs("div",{className:"space-y-2 pt-2 hidden",children:[e.jsx(f,{children:"حالة الدفع"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{type:"button",variant:a.isPaid?"default":"outline",className:`flex-1 ${a.isPaid?"bg-green-600 hover:bg-green-700":"text-green-600 border-green-200 hover:bg-green-50"}`,onClick:()=>m({...a,isPaid:!0}),children:"مدفوع"}),e.jsx(d,{type:"button",variant:a.isPaid?"outline":"default",className:`flex-1 ${a.isPaid?"text-red-600 border-red-200 hover:bg-red-50":"bg-red-600 hover:bg-red-700"}`,onClick:()=>m({...a,isPaid:!1}),children:"لم يتم الدفع"})]})]}),e.jsxs("div",{className:"pt-4 flex gap-2",children:[e.jsxs(d,{className:"flex-1 bg-purple-600 hover:bg-purple-700 text-white",onClick:Je,children:[e.jsx(Ss,{className:"h-4 w-4 ml-2"}),"حفظ"]}),e.jsx(d,{variant:"outline",onClick:()=>E(!1),children:"إلغاء"})]})]})]})}),e.jsx(O,{open:U,onOpenChange:P,children:e.jsxs(L,{className:"max-w-sm",children:[e.jsxs(J,{children:[e.jsx(M,{children:"تسجيل معاملة آجل"}),e.jsx(V,{children:"سيتم إضافة المبلغ للديون المستحقة"})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"اسم العميل"}),e.jsx(j,{value:ne,onChange:s=>Ne(s.target.value),placeholder:"اسم العميل..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"المبلغ"}),e.jsx(j,{type:"number",value:ve,onChange:s=>ye(s.target.value),placeholder:"0.00"})]}),e.jsxs("div",{className:"pt-2 flex gap-2",children:[e.jsx(d,{className:"flex-1 bg-orange-600 hover:bg-orange-700 text-white",onClick:We,children:"تأكيد الأجل"}),e.jsx(d,{variant:"outline",onClick:()=>P(!1),children:"إلغاء"})]})]})]})})]})}export{Us as SimCardsDialog};
//# sourceMappingURL=SimCardsDialog-DFrs3tua.js.map
