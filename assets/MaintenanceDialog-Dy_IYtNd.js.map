{"version":3,"file":"MaintenanceDialog-Dy_IYtNd.js","sources":["../../src/components/MaintenanceDialog.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { Wrench, CheckCircle, Clock, Trash2, Shield, Eye, EyeOff, X, RefreshCw } from 'lucide-react';\r\nimport { useFirebaseAuth } from '@/contexts/FirebaseAuthContext';\r\nimport { db } from '@/firebase';\r\nimport { addDoc, collection, deleteDoc, doc, orderBy, query, serverTimestamp, updateDoc, where, getDocs, limit } from 'firebase/firestore';\r\nimport { ProfitService } from '@/utils/profitService';\r\nimport { useShop } from '@/hooks/useShop';\r\nimport { userDataService, telegramNotifier } from '@/integrations/firebase/services';\r\nimport { MasterPinDialog } from '@/components/MasterPinDialog';\r\n\r\ntype MaintenanceItemStatus = 'in_progress' | 'completed';\r\n\r\ninterface MaintenanceItem {\r\n  id: string;\r\n  productName: string;\r\n  faultType?: string;\r\n  customerName?: string;\r\n  mobile?: string;\r\n  repairPrice: number; // سعر التصليح\r\n  wholesalePrice?: number; // سعر الجملة\r\n  profit?: number; // الأرباح (تحسب: سعر التصليح - سعر الجملة)\r\n  profitAdded?: boolean; // تم تسجيل الربح في التقارير\r\n  partialPayment?: number;\r\n  remainingDue?: number;\r\n  status: MaintenanceItemStatus;\r\n  createdAt: Date;\r\n  completedAt?: Date;\r\n  userId: string;\r\n}\r\n\r\ninterface Props {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nconst MaintenanceDialog: React.FC<Props> = ({ open, onOpenChange }) => {\r\n  const { user } = useFirebaseAuth();\r\n  const { shopId: shopIdCtx } = useShop() || ({} as any);\r\n\r\n  const [items, setItems] = useState<MaintenanceItem[]>([]);\r\n  const [productName, setProductName] = useState('');\r\n  const [faultType, setFaultType] = useState('');\r\n  const [customerName, setCustomerName] = useState('');\r\n  const [mobile, setMobile] = useState('');\r\n  const [repairPrice, setRepairPrice] = useState<string>('');\r\n  const [wholesalePrice, setWholesalePrice] = useState<string>('');\r\n  const [partialPayment, setPartialPayment] = useState<string>('');\r\n  // لا توجد خانة منفصلة لسعر الزبون؛ سعر الزبون هو سعر التصليح\r\n  const [showProfit, setShowProfit] = useState<boolean>(false);\r\n  const [pinDialogOpen, setPinDialogOpen] = useState<boolean>(false);\r\n  const [formVisible, setFormVisible] = useState<boolean>(false);\r\n  const [isRefreshing, setIsRefreshing] = useState(false);\r\n\r\n  // تنسيق المبالغ\r\n  const formatMoney = (n: number) => `${new Intl.NumberFormat('ar-EG', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(Number(n || 0))} ج.م`;\r\n\r\n  // حساب نوافذ التصفير المطلوبة لعرض أرباح الصيانة\r\n  const getDailyWindowStart = () => {\r\n    const now = new Date();\r\n    const start = new Date(now);\r\n    start.setHours(2, 0, 0, 0); // الساعة 2 صباحاً اليوم\r\n    // إن كان الوقت الحالي قبل 2 صباحاً، نرجع لبداية نافذة أمس الساعة 2\r\n    if (now.getTime() < start.getTime()) {\r\n      start.setDate(start.getDate() - 1);\r\n    }\r\n    return start;\r\n  };\r\n\r\n  const getMonthlyWindowStart = () => {\r\n    const now = new Date();\r\n    const start = new Date(now.getFullYear(), now.getMonth(), 1, 0, 0, 0, 0); // أول يوم من الشهر 12 منتصف الليل\r\n    return start;\r\n  };\r\n\r\n  const dailyWindowStart = getDailyWindowStart();\r\n  const monthlyWindowStart = getMonthlyWindowStart();\r\n\r\n  // تجميع أرباح الصيانة المكتملة داخل النوافذ الزمنية\r\n  const maintenanceDailyProfit = items\r\n    .filter(it => it.status === 'completed' && it.completedAt && (it.completedAt.getTime() >= dailyWindowStart.getTime()))\r\n    .reduce((sum, it) => sum + (typeof it.profit === 'number' ? it.profit : 0), 0);\r\n\r\n  const maintenanceMonthlyProfit = items\r\n    .filter(it => it.status === 'completed' && it.completedAt && (it.completedAt.getTime() >= monthlyWindowStart.getTime()))\r\n    .reduce((sum, it) => sum + (typeof it.profit === 'number' ? it.profit : 0), 0);\r\n\r\n  // استبدال onSnapshot بـ getDocs لتقليل القراءات\r\n  const fetchItems = async () => {\r\n    if (!user?.uid) return;\r\n    setIsRefreshing(true);\r\n\r\n    const handleSnap = (snap: any) => {\r\n      const list: MaintenanceItem[] = snap.docs.map((d: any) => {\r\n        const data = d.data() as any;\r\n        return {\r\n          id: d.id,\r\n          productName: data.productName,\r\n          faultType: data.faultType,\r\n          customerName: data.customerName,\r\n          mobile: data.mobile,\r\n          // في حال كانت البيانات القديمة تحتوي على customerPrice فقط\r\n          repairPrice: Number((data.repairPrice ?? data.customerPrice ?? 0)),\r\n          wholesalePrice: data.wholesalePrice !== undefined ? Number(data.wholesalePrice) : undefined,\r\n          profit: data.profit !== undefined ? Number(data.profit) : undefined,\r\n          partialPayment: data.partialPayment !== undefined ? Number(data.partialPayment) : undefined,\r\n          remainingDue: data.remainingDue !== undefined\r\n            ? Number(data.remainingDue)\r\n            : (data.partialPayment !== undefined\r\n              ? Math.max(0, Math.round(((Number(data.repairPrice ?? data.customerPrice ?? 0)) - Number(data.partialPayment)) * 100) / 100)\r\n              : undefined),\r\n          profitAdded: !!data.profitAdded,\r\n          status: (data.status as MaintenanceItemStatus) || 'in_progress',\r\n          createdAt: data.createdAt?.toDate?.() || new Date(),\r\n          completedAt: data.completedAt?.toDate?.(),\r\n          userId: data.userId || user.uid,\r\n        };\r\n      });\r\n      setItems(list);\r\n    };\r\n\r\n    try {\r\n      // المحاولة الأولى: مع ترتيب حسب createdAt (أفضلية)\r\n      const q1 = query(\r\n        collection(db, 'maintenance_items'),\r\n        where('userId', '==', user.uid),\r\n        orderBy('createdAt', 'desc')\r\n      );\r\n      const snap = await getDocs(q1);\r\n      handleSnap(snap);\r\n    } catch (err) {\r\n      console.warn('Failed to fetch with ordering, falling back without orderBy:', err);\r\n      try {\r\n        const q2 = query(\r\n          collection(db, 'maintenance_items'),\r\n          where('userId', '==', user.uid)\r\n        );\r\n        const snap2 = await getDocs(q2);\r\n        // ترتيب محلي\r\n        const docs = snap2.docs.sort((a, b) => {\r\n          const da = a.data().createdAt?.toDate?.() || new Date(0);\r\n          const db = b.data().createdAt?.toDate?.() || new Date(0);\r\n          return db.getTime() - da.getTime();\r\n        });\r\n        handleSnap({ docs });\r\n      } catch (e) {\r\n        console.warn('Failed to fetch maintenance items (fallback):', e);\r\n      }\r\n    } finally {\r\n      setIsRefreshing(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      fetchItems();\r\n    }\r\n  }, [user?.uid, open]);\r\n\r\n  const resetForm = () => {\r\n    setProductName('');\r\n    setFaultType('');\r\n    setCustomerName('');\r\n    setMobile('');\r\n    setRepairPrice('');\r\n    setWholesalePrice('');\r\n    setPartialPayment('');\r\n  };\r\n\r\n  const addItem = async (status: MaintenanceItemStatus) => {\r\n    // تأكيد تسجيل الدخول قبل الإضافة\r\n    if (!user?.uid) {\r\n      alert('يرجى تسجيل الدخول قبل إضافة عنصر الصيانة');\r\n      return;\r\n    }\r\n    const numericRepair = Number(repairPrice);\r\n    const numericWholesale = wholesalePrice ? Number(wholesalePrice) : undefined;\r\n    const numericPartial = partialPayment ? Number(partialPayment) : undefined;\r\n    if (!productName.trim() || !numericRepair || Number.isNaN(numericRepair) || numericRepair <= 0) {\r\n      alert('يرجى إدخال اسم المنتج وسعر التصليح بشكل صحيح');\r\n      return;\r\n    }\r\n    try {\r\n      const profit = (numericWholesale !== undefined)\r\n        ? Math.round((numericRepair - numericWholesale) * 100) / 100\r\n        : undefined;\r\n\r\n      // ابنِ الحمولة بدون أي حقول undefined\r\n      const payload: any = {\r\n        productName: productName.trim(),\r\n        repairPrice: numericRepair,\r\n        status,\r\n        createdAt: serverTimestamp(),\r\n        userId: user.uid,\r\n        profitAdded: status === 'completed' ? (profit !== undefined) : false,\r\n      };\r\n      const _fault = faultType.trim();\r\n      const _customer = customerName.trim();\r\n      const _mobile = mobile.trim();\r\n      if (_fault) payload.faultType = _fault;\r\n      if (_customer) payload.customerName = _customer;\r\n      if (_mobile) payload.mobile = _mobile;\r\n      if (numericWholesale !== undefined) payload.wholesalePrice = numericWholesale;\r\n      if (profit !== undefined) payload.profit = profit;\r\n      if (status === 'completed') payload.completedAt = serverTimestamp();\r\n      if (numericPartial !== undefined) payload.partialPayment = numericPartial;\r\n      if (numericPartial !== undefined) payload.remainingDue = Math.max(0, Math.round((numericRepair - numericPartial) * 100) / 100);\r\n\r\n      const docRef = await addDoc(collection(db, 'maintenance_items'), payload);\r\n\r\n      // كتابة إلى المجموعات القديمة المستخدمة بواسطة تطبيقات الموبايل/الكمبيوتر لضمان التزامن عبر المنصات\r\n      try {\r\n        const commonFields: any = {\r\n          linkedId: docRef.id,\r\n          productName: payload.productName,\r\n          faultType: payload.faultType,\r\n          customerName: payload.customerName,\r\n          mobile: payload.mobile,\r\n          repairPrice: payload.repairPrice,\r\n          wholesalePrice: payload.wholesalePrice,\r\n          profit: payload.profit,\r\n          partialPayment: payload.partialPayment,\r\n          remainingDue: payload.remainingDue,\r\n          userId: user.uid,\r\n        };\r\n        if (status === 'in_progress') {\r\n          await addDoc(collection(db, 'maintenance_pending'), {\r\n            ...commonFields,\r\n            status: 'in_progress',\r\n            createdAt: serverTimestamp(),\r\n          });\r\n        } else {\r\n          await addDoc(collection(db, 'maintenance_done'), {\r\n            ...commonFields,\r\n            status: 'completed',\r\n            profitAdded: commonFields.profit !== undefined,\r\n            createdAt: serverTimestamp(),\r\n            completedAt: serverTimestamp(),\r\n          });\r\n        }\r\n      } catch (syncErr) {\r\n        console.warn('تعذر مزامنة عنصر الصيانة مع مجموعات الموبايل/الكمبيوتر:', syncErr);\r\n      }\r\n\r\n      // تحديث تفاؤلي للقائمة حتى لو تأخر الـ snapshot\r\n      setItems(prev => [{\r\n        id: docRef.id,\r\n        productName: payload.productName,\r\n        faultType: payload.faultType,\r\n        customerName: payload.customerName,\r\n        mobile: payload.mobile,\r\n        repairPrice: payload.repairPrice,\r\n        wholesalePrice: payload.wholesalePrice,\r\n        profit: payload.profit,\r\n        partialPayment: payload.partialPayment,\r\n        remainingDue: payload.remainingDue,\r\n        profitAdded: !!payload.profitAdded,\r\n        status: payload.status,\r\n        createdAt: new Date(),\r\n        completedAt: payload.status === 'completed' ? new Date() : undefined,\r\n        userId: user.uid,\r\n      }, ...prev]);\r\n      // إذا تمت الإضافة كمكتمل، أضف الربح للتقارير\r\n      if (status === 'completed' && profit !== undefined) {\r\n        try { ProfitService.addProfit(profit, user.uid); } catch {}\r\n      }\r\n\r\n      // إذا تمت الإضافة كمكتمل، أضف مبلغ التصليح بالكامل إلى رصيد الدرج النقدي\r\n      if (status === 'completed') {\r\n        try {\r\n          const amount = Math.max(0, Number(numericRepair || 0));\r\n          const genericKey = `cashBalance_${user?.uid || 'default'}`;\r\n          const shopKey = `cashBalance_${user?.uid || 'default'}_${shopIdCtx || 'main'}`;\r\n          const saved = localStorage.getItem(shopKey) ?? localStorage.getItem(genericKey) ?? '0';\r\n          const currentCash = parseFloat(saved || '0') || 0;\r\n          const newCash = currentCash + amount;\r\n          try { localStorage.setItem(genericKey, String(newCash)); } catch {}\r\n          try { localStorage.setItem(shopKey, String(newCash)); } catch {}\r\n          try { await userDataService.updateUserData(user.uid, { cashBalance: newCash }); } catch {}\r\n          try { window.dispatchEvent(new CustomEvent('cashBalanceChanged', { detail: { value: newCash } })); } catch {}\r\n        } catch {}\r\n      }\r\n      resetForm();\r\n      try { if (user?.uid) { const paidPart = (payload.partialPayment !== undefined) ? `، المدفوع مقدمًا ${payload.partialPayment} جنيه` : ''; const mobileText = payload.mobile ? `، رقم تليفون ${payload.mobile}` : ''; await telegramNotifier.send(user.uid, `تم استلام جهاز صيانة باسم ${payload.customerName || 'بدون اسم'}، الجهاز ${payload.productName}${mobileText}، سعر التصليح ${payload.repairPrice} جنيه${paidPart}`); } } catch {}\r\n    } catch (e) {\r\n      console.error('Failed to add maintenance item:', e);\r\n      const err: any = e || {};\r\n      const msgParts = [err.code, err.message].filter(Boolean).join(' — ');\r\n      const msg = msgParts || 'غير معروف';\r\n      alert(`حدث خطأ أثناء إضافة عنصر الصيانة: ${msg}`);\r\n    }\r\n  };\r\n\r\n  const markCompleted = async (id: string) => {\r\n    try {\r\n      const item = items.find(i => i.id === id);\r\n      const profit = (item?.wholesalePrice !== undefined)\r\n        ? Math.round(((item.repairPrice || 0) - (item.wholesalePrice || 0)) * 100) / 100\r\n        : undefined;\r\n      const updatePayload: any = {\r\n        status: 'completed',\r\n        completedAt: serverTimestamp(),\r\n        profitAdded: profit !== undefined ? true : item?.profitAdded || false,\r\n      };\r\n      if (profit !== undefined) updatePayload.profit = profit;\r\n      // عند الضغط على تم التصليح: يعتبر أن العميل سدد المبلغ بالكامل\r\n      const fullPaid = Math.round(((item?.repairPrice || 0)) * 100) / 100;\r\n      updatePayload.partialPayment = fullPaid;\r\n      updatePayload.remainingDue = 0;\r\n      await updateDoc(doc(db, 'maintenance_items', id), updatePayload);\r\n      if (profit !== undefined && !item?.profitAdded && user?.uid) {\r\n        try { ProfitService.addProfit(profit, user.uid); } catch {}\r\n      }\r\n\r\n      try {\r\n        const amount = Math.max(0, Number(item?.repairPrice || 0));\r\n        const genericKey = `cashBalance_${user?.uid || 'default'}`;\r\n        const shopKey = `cashBalance_${user?.uid || 'default'}_${shopIdCtx || 'main'}`;\r\n        const saved = localStorage.getItem(shopKey) ?? localStorage.getItem(genericKey) ?? '0';\r\n        const currentCash = parseFloat(saved || '0') || 0;\r\n        const newCash = currentCash + amount;\r\n        try { localStorage.setItem(genericKey, String(newCash)); } catch {}\r\n        try { localStorage.setItem(shopKey, String(newCash)); } catch {}\r\n        if (user?.uid) {\r\n          try { await userDataService.updateUserData(user.uid, { cashBalance: newCash }); } catch {}\r\n        }\r\n        try {\r\n          const shopId = (profile as any)?.shopId || shopIdCtx;\r\n          if (shopId) {\r\n            await updateDoc(doc(db, 'dashboardData', shopId), { cashBalance: newCash, lastUpdated: new Date().toISOString() } as any);\r\n          }\r\n        } catch {}\r\n        try { window.dispatchEvent(new CustomEvent('cashBalanceChanged', { detail: { value: newCash } })); } catch {}\r\n      } catch {}\r\n\r\n      // مزامنة مع مجموعات تطبيقات الموبايل/الكمبيوتر\r\n      try {\r\n        const commonFields: any = {\r\n          linkedId: id,\r\n          productName: item?.productName,\r\n          faultType: item?.faultType,\r\n          customerName: item?.customerName,\r\n          mobile: item?.mobile,\r\n          repairPrice: item?.repairPrice,\r\n          wholesalePrice: item?.wholesalePrice,\r\n          profit,\r\n          partialPayment: fullPaid,\r\n          remainingDue: 0,\r\n          userId: user?.uid || item?.userId,\r\n          status: 'completed',\r\n          createdAt: item?.createdAt ? item.createdAt : serverTimestamp(),\r\n          completedAt: serverTimestamp(),\r\n          profitAdded: profit !== undefined,\r\n        };\r\n        // أضف إلى مجموعة المكتمل\r\n        await addDoc(collection(db, 'maintenance_done'), commonFields);\r\n        // احذف من مجموعة جاري التصليح إن وجد\r\n        try {\r\n          const q = query(collection(db, 'maintenance_pending'), where('linkedId', '==', id), limit(1));\r\n          const snap = await getDocs(q);\r\n          const pendingDoc = snap.docs[0];\r\n          if (pendingDoc?.id) {\r\n            await deleteDoc(doc(db, 'maintenance_pending', pendingDoc.id));\r\n          }\r\n        } catch (delErr) {\r\n          console.warn('تعذر حذف العنصر من مجموعة جاري التصليح:', delErr);\r\n        }\r\n      } catch (syncErr) {\r\n        console.warn('تعذر مزامنة حالة الصيانة المكتملة مع مجموعات الموبايل/الكمبيوتر:', syncErr);\r\n      }\r\n      try { if (user?.uid) { const mobileText = item?.mobile ? `، رقم تليفون ${item.mobile}` : ''; await telegramNotifier.send(user.uid, `تم تصليح الجهاز ${item?.productName || ''} للعميل ${item?.customerName || 'بدون اسم'}${mobileText}، مبلغ التصليح الكامل ${(item?.repairPrice || 0)} جنيه`); } } catch {}\r\n    } catch (e) {\r\n      alert('حدث خطأ أثناء تحديث حالة الصيانة إلى تم التصليح');\r\n    }\r\n  };\r\n\r\n  const removeItem = async (id: string) => {\r\n    try {\r\n      await deleteDoc(doc(db, 'maintenance_items', id));\r\n      // حاول أيضاً حذف النسخ المتزامنة في المجموعات الأخرى\r\n      try {\r\n        const qPending = query(collection(db, 'maintenance_pending'), where('linkedId', '==', id), limit(1));\r\n        const snapPending = await getDocs(qPending);\r\n        if (snapPending.docs[0]?.id) await deleteDoc(doc(db, 'maintenance_pending', snapPending.docs[0].id));\r\n      } catch {}\r\n      try {\r\n        const qDone = query(collection(db, 'maintenance_done'), where('linkedId', '==', id), limit(1));\r\n        const snapDone = await getDocs(qDone);\r\n        if (snapDone.docs[0]?.id) await deleteDoc(doc(db, 'maintenance_done', snapDone.docs[0].id));\r\n      } catch {}\r\n\r\n      // تحديث الحالة محلياً\r\n      setItems(prev => prev.filter(i => i.id !== id));\r\n    } catch (e) {\r\n      alert('حدث خطأ أثناء حذف عنصر الصيانة');\r\n    }\r\n  };\r\n\r\n  const inProgressItems = items.filter(it => it.status === 'in_progress');\r\n  const completedItems = items.filter(it => it.status === 'completed');\r\n\r\n  const computedProfitPreview = (() => {\r\n    const w = wholesalePrice ? Number(wholesalePrice) : undefined;\r\n    const r = repairPrice ? Number(repairPrice) : undefined;\r\n    if (w === undefined || r === undefined) return '';\r\n    const p = Math.round((r - w) * 100) / 100;\r\n    return isNaN(p as any) ? '' : String(p);\r\n  })();\r\n\r\n  // حساب أرباح عنصر الصيانة بطريقة مبسطة لتقليل تعقيد JSX\r\n  const computeProfit = (item: MaintenanceItem) => {\r\n    if (typeof item.profit === 'number') return item.profit;\r\n    const repair = item.repairPrice ?? 0;\r\n    const wholesale = item.wholesalePrice ?? 0;\r\n    return Math.round((repair - wholesale) * 100) / 100;\r\n  };\r\n\r\n  return (\r\n    <>\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"maintenance-dialog sm:max-w-3xl w-screen sm:w-auto h-[90vh] sm:h-auto overflow-hidden rounded-none sm:rounded-lg p-0 dark:bg-[#121212]\">\r\n        <DialogHeader className=\"sticky top-0 bg-white dark:bg-[#0F0F0F] z-20 border-b border-gray-200 dark:border-[#333] px-4 py-3\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <Wrench className=\"h-4 w-4 text-amber-600\" />\r\n              إدارة الصيانة\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"ghost\"\r\n                className=\"mr-2 p-1 h-auto rounded-full\"\r\n                onClick={fetchItems}\r\n                disabled={isRefreshing}\r\n                title=\"تحديث البيانات\"\r\n              >\r\n                <RefreshCw className={`h-4 w-4 ${isRefreshing ? 'animate-spin' : ''}`} />\r\n              </Button>\r\n            </DialogTitle>\r\n            <Button\r\n              size=\"sm\"\r\n              variant=\"ghost\"\r\n              className=\"ml-auto\"\r\n              onClick={() => onOpenChange(false)}\r\n              title=\"إغلاق\"\r\n            >\r\n              <X className=\"h-4 w-4\" />\r\n            </Button>\r\n          </div>\r\n        </DialogHeader>\r\n\r\n        \r\n        <div className=\"px-4 py-3 space-y-3 overflow-y-auto\">\r\n        \r\n        <div className=\"flex items-center justify-between\">\r\n          \r\n          <div className=\"flex items-center gap-2\">\r\n            \r\n            <div className=\"relative\">\r\n              <div className={showProfit ? \"\" : \"filter blur-sm pointer-events-none select-none\"}>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className=\"text-xs text-gray-700 dark:text-gray-300 font-medium\">أرباح الصيانة</span>\r\n                  <Badge variant=\"secondary\" className=\"text-[10px]\">اليوم</Badge>\r\n                  <span className=\"text-sm text-green-700 dark:text-green-400 font-semibold\">{formatMoney(maintenanceDailyProfit)}</span>\r\n                  <Badge variant=\"secondary\" className=\"text-[10px] ml-2\">الشهر</Badge>\r\n                  <span className=\"text-sm text-green-700 dark:text-green-400 font-semibold\">{formatMoney(maintenanceMonthlyProfit)}</span>\r\n                </div>\r\n              </div>\r\n              {!showProfit && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setPinDialogOpen(true)}\r\n                  className=\"absolute inset-0 rounded bg-white/30 dark:bg-black/30 backdrop-blur-sm cursor-pointer\"\r\n                  aria-label=\"أدخل الرقم السري لعرض أرباح الصيانة\"\r\n                />\r\n              )}\r\n            </div>\r\n\r\n            \r\n            <div className=\"flex items-center gap-2 z-10\">\r\n              {showProfit ? (\r\n                <Button size=\"sm\" variant=\"ghost\" onClick={() => setShowProfit(false)} title=\"إخفاء الأرباح\">\r\n                  <EyeOff className=\"h-4 w-4\" />\r\n                </Button>\r\n              ) : (\r\n                <Button size=\"sm\" variant=\"ghost\" onClick={() => setPinDialogOpen(true)} title=\"عرض أرباح الصيانة\">\r\n                  <Eye className=\"h-4 w-4\" />\r\n                </Button>\r\n              )}\r\n              <Button size=\"sm\" variant=\"outline\" onClick={() => setPinDialogOpen(true)} className=\"text-xs\">عرض أرباح الصيانة</Button>\r\n            </div>\r\n          </div>\r\n\r\n          \r\n          <div className=\"flex items-center gap-2\">\r\n            {!formVisible && (\r\n              <Button className=\"bg-amber-600 hover:bg-amber-700\" onClick={() => setFormVisible(true)}>\r\n                إضافة جهاز صيانة\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        \r\n        {formVisible && (\r\n        <Card className=\"mb-3\">\r\n          <CardHeader className=\"pb-2\">\r\n            <CardTitle className=\"text-sm\">إضافة منتج للصيانة</CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-2\">\r\n            \r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\r\n              <div>\r\n                <label className=\"text-xs text-gray-700 dark:text-gray-300\">اسم المنتج</label>\r\n                <Input value={productName} onChange={e => setProductName(e.target.value)} placeholder=\"اسم المنتج\" />\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs text-gray-700 dark:text-gray-300\">نوع العطل - اختياري</label>\r\n                <Input value={faultType} onChange={e => setFaultType(e.target.value)} placeholder=\"نوع العطل\" />\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs text-gray-700 dark:text-gray-300\">اسم العميل - اختياري</label>\r\n                <Input value={customerName} onChange={e => setCustomerName(e.target.value)} placeholder=\"اسم العميل\" />\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs text-gray-700 dark:text-gray-300\">رقم الموبايل - اختياري</label>\r\n                <Input value={mobile} onChange={e => setMobile(e.target.value)} placeholder=\"01xxxxxxxxx\" />\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs text-gray-700 dark:text-gray-300\">سعر التصليح</label>\r\n                <Input value={repairPrice} onChange={e => setRepairPrice(e.target.value)} placeholder=\"سعر التصليح بالجنيه\" />\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs text-gray-700 dark:text-gray-300\">سعر الجملة</label>\r\n                <Input value={wholesalePrice} onChange={e => setWholesalePrice(e.target.value)} placeholder=\"سعر الجملة بالجنيه\" />\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs text-gray-700 dark:text-gray-300\">دفع جزء من التصليح</label>\r\n                <Input value={partialPayment} onChange={e => setPartialPayment(e.target.value)} placeholder=\"المبلغ المدفوع مقدمًا\" />\r\n              </div>\r\n              \r\n              <div>\r\n                <label className=\"text-xs text-gray-700 dark:text-gray-300\">الأرباح: سعر التصليح - سعر الجملة</label>\r\n                <Input value={computedProfitPreview} readOnly placeholder={showProfit ? '' : 'أدخل الرقم السري لعرض الأرباح'} />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-2 pt-2\">\r\n              <Button className=\"bg-amber-600 hover:bg-amber-700\" onClick={() => addItem('in_progress')}>جاري التصليح</Button>\r\n              <Button className=\"bg-green-600 hover:bg-green-700\" onClick={() => addItem('completed')}>تم التصليح</Button>\r\n              <Button variant=\"outline\" onClick={() => setFormVisible(false)}>إخفاء النموذج</Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        )}\r\n\r\n        <Separator />\r\n\r\n        \r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3\">\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n              <CardTitle className=\"text-sm flex items-center gap-2\">\r\n                <Clock className=\"h-4 w-4 text-amber-600\" />\r\n                جاري التصليح\r\n                <Badge variant=\"secondary\" className=\"ml-auto text-[10px]\">{inProgressItems.length}</Badge>\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-2 sm:max-h-[280px] sm:overflow-y-auto\">\r\n              {inProgressItems.length === 0 ? (\r\n                <div className=\"text-xs text-gray-500 dark:text-gray-400\">لا توجد عناصر قيد التصليح</div>\r\n              ) : (\r\n                inProgressItems.map(item => (\r\n                  <div key={item.id} className=\"flex items-center justify-between p-2 bg-white dark:bg-[#1A1A1A] rounded border border-gray-200 dark:border-[#333]\">\r\n                    <div>\r\n                      <p className=\"text-sm font-semibold\">{item.productName} <span className=\"text-gray-600 dark:text-gray-300\">— {item.repairPrice} جنيه</span></p>\r\n                      <p className=\"text-[11px] text-gray-600 dark:text-gray-300\">\r\n                        {item.faultType || 'بدون'}\r\n                        {item.customerName && <span> • {item.customerName}</span>}\r\n                        {item.mobile && <span> • {item.mobile}</span>}\r\n                      </p>\r\n                      {typeof (item as any).remainingDue === 'number' && (\r\n                        <p className=\"text-[11px] text-orange-700 dark:text-orange-400\">المتبقي على العميل: {(item as any).remainingDue} جنيه</p>\r\n                      )}\r\n                      {showProfit && (\r\n                        <p className=\"text-[11px] text-green-700 dark:text-green-400\">الأرباح المتوقعة: {item.wholesalePrice !== undefined && item.repairPrice !== undefined ? Math.round(((item.repairPrice || 0) - (item.wholesalePrice || 0)) * 100) / 100 : 0} جنيه</p>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <Button size=\"sm\" className=\"h-7 bg-green-600 hover:bg-green-700\" onClick={() => markCompleted(item.id)}>تم التصليح</Button>\r\n                      <Button size=\"sm\" variant=\"outline\" className=\"h-7\" onClick={() => removeItem(item.id)}>\r\n                        <Trash2 className=\"h-3 w-3\" />\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                ))\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader className=\"pb-2\">\r\n              <CardTitle className=\"text-sm flex items-center gap-2\">\r\n                <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n                تم التصليح\r\n                <Badge variant=\"secondary\" className=\"ml-auto text-[10px]\">{completedItems.length}</Badge>\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-2 sm:max-h-[280px] sm:overflow-y-auto\">\r\n              {completedItems.length === 0 ? (\r\n                <div className=\"text-xs text-gray-500 dark:text-gray-400\">لا توجد عناصر منتهية</div>\r\n              ) : (\r\n                completedItems.map(item => (\r\n                  <div key={item.id} className=\"flex items-center justify-between p-2 bg-white dark:bg-[#1A1A1A] rounded border border-gray-200 dark:border-[#333]\">\r\n                    <div>\r\n                      <p className=\"text-sm font-semibold\">{item.productName} <span className=\"text-gray-600 dark:text-gray-300\">— {item.repairPrice} جنيه</span></p>\r\n                      <p className=\"text-[11px] text-gray-600 dark:text-gray-300\">\r\n                        {item.faultType || 'بدون'}\r\n                        {item.customerName && <span> • {item.customerName}</span>}\r\n                        {item.mobile && <span> • {item.mobile}</span>}\r\n                      </p>\r\n                      {typeof (item as any).partialPayment === 'number' && (\r\n                        <p className=\"text-[11px] text-emerald-700 dark:text-emerald-400\">المدفوع: {(item as any).partialPayment} جنيه</p>\r\n                      )}\r\n                      {typeof (item as any).remainingDue === 'number' && (\r\n                        <p className=\"text-[11px] text-orange-700 dark:text-orange-400\">المتبقي على العميل: {(item as any).remainingDue} جنيه</p>\r\n                      )}\r\n                      {showProfit && (\r\n                        <p className=\"text-[11px] text-green-700 dark:text-green-400\">الأرباح: {computeProfit(item)} جنيه</p>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <Badge className=\"text-[10px] bg-green-100 text-green-800\">مكتمل</Badge>\r\n                      <Button size=\"sm\" variant=\"outline\" className=\"h-7\" onClick={() => removeItem(item.id)} title=\"حذف\">\r\n                        <Trash2 className=\"h-3 w-3\" />\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                ))\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n        \r\n        {/* زر إضافة للصيانة مثبت لأسفل في الموبايل لضمان الظهور */}\r\n        <div className=\"sm:hidden sticky bottom-0 left-0 right-0 bg-white dark:bg-[#0F0F0F] border-t border-gray-200 dark:border-[#333] p-3 z-20\">\r\n          <Button className=\"w-full bg-amber-600 hover:bg-amber-700\" onClick={() => setFormVisible(true)}>\r\n            إضافة جهاز صيانة\r\n          </Button>\r\n        </div>\r\n        </div>\r\n\r\n      </DialogContent>\r\n    </Dialog>\r\n    <MasterPinDialog\r\n      open={pinDialogOpen}\r\n      onOpenChange={setPinDialogOpen}\r\n      mode=\"verify\"\r\n      title=\"تأكيد الرقم السري الرئيسي\"\r\n      description=\"أدخل الرقم السري لعرض خانة الأرباح\"\r\n      onSuccess={() => setShowProfit(true)}\r\n    />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default MaintenanceDialog;\r\n"],"names":["MaintenanceDialog","open","onOpenChange","user","useFirebaseAuth","shopIdCtx","useShop","items","setItems","useState","productName","setProductName","faultType","setFaultType","customerName","setCustomerName","mobile","setMobile","repairPrice","setRepairPrice","wholesalePrice","setWholesalePrice","partialPayment","setPartialPayment","showProfit","setShowProfit","pinDialogOpen","setPinDialogOpen","formVisible","setFormVisible","isRefreshing","setIsRefreshing","formatMoney","n","getDailyWindowStart","now","start","getMonthlyWindowStart","dailyWindowStart","monthlyWindowStart","maintenanceDailyProfit","it","sum","maintenanceMonthlyProfit","fetchItems","handleSnap","snap","list","d","data","_b","_a","_d","_c","q1","query","collection","db","where","orderBy","getDocs","err","q2","docs","a","b","da","e","useEffect","resetForm","addItem","status","numericRepair","numericWholesale","numericPartial","profit","payload","serverTimestamp","_fault","_customer","_mobile","docRef","addDoc","commonFields","syncErr","prev","ProfitService","amount","genericKey","shopKey","saved","newCash","userDataService","paidPart","mobileText","telegramNotifier","msg","markCompleted","id","item","i","updatePayload","fullPaid","updateDoc","doc","shopId","q","limit","pendingDoc","deleteDoc","delErr","removeItem","qPending","snapPending","qDone","snapDone","inProgressItems","completedItems","computedProfitPreview","w","r","p","computeProfit","repair","wholesale","jsxs","Fragment","jsx","Dialog","DialogContent","DialogHeader","DialogTitle","Wrench","Button","RefreshCw","X","Badge","EyeOff","Eye","Card","CardHeader","CardTitle","CardContent","Input","Separator","Clock","Trash2","CheckCircle","MasterPinDialog"],"mappings":"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"}