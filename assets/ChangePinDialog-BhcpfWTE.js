import{r as a,m as B,R as O,av as u,j as e,af as T,ag as A,ah as J,ai as z,aF as G,a4 as R,y as p,H as g,I as j,J as y,K as w,B as F}from"./index-F79wE54_.js";function V({open:N,onOpenChange:K,userId:c}){const[o,b]=a.useState(""),[i,v]=a.useState(""),[P,S]=a.useState(""),[x,C]=a.useState(!1),[m,D]=a.useState(!1),[d,k]=a.useState(!1),[E,n]=a.useState(""),[M,r]=a.useState(!1),[l,L]=a.useState(!1),{toast:q}=B(),h=O.useRef(null);a.useEffect(()=>{let t=!0;return(async()=>{const s=await u.hasMasterPin(c);t&&L(s)})(),()=>{t=!1}},[c,N]);const H=async t=>{t.preventDefault(),n(""),r(!0);try{if(!i||i.length<4){n("يجب أن يكون الرقم السري 4 أرقام على الأقل"),r(!1);return}if(i!==P){n("الرقم السري الجديد وتأكيده غير متطابقين"),r(!1);return}if(l){if(!o){n("يرجى إدخال الرقم السري الحالي"),r(!1);return}if(!await u.verifyMasterPin(o,c)){n("الرقم السري الحالي غير صحيح"),r(!1);return}}if(!(l?await u.changeMasterPin(o,i,c):await u.createMasterPin(i,c))){n("تعذر حفظ الرقم السري"),r(!1);return}q({title:l?"تم تغيير الرقم السري":"تم تعيين الرقم السري",description:l?"تم تغيير الرقم السري بنجاح (سيتم تطبيقه على جميع النوافذ)":"تم تعيين الرقم السري بنجاح (سيتم تطبيقه على جميع النوافذ)"}),f()}catch{n("حدث خطأ أثناء حفظ الرقم السري")}finally{r(!1)}},f=()=>{b(""),v(""),S(""),n(""),C(!1),D(!1),k(!1),K(!1)};return e.jsx(T,{open:N,onOpenChange:f,children:e.jsxs(A,{className:"sm:max-w-[425px]",dir:"rtl",children:[e.jsx(J,{children:e.jsxs(z,{className:"flex items-center gap-2 text-right",children:[e.jsx(G,{className:"h-5 w-5 text-gray-600"}),l?"تغيير الرقم السري الرئيسي":"تعيين الرقم السري الرئيسي"]})}),e.jsxs("form",{ref:h,onSubmit:H,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-md text-sm text-blue-700 mb-4 flex items-start gap-2",children:[e.jsx(R,{className:"h-4 w-4 mt-0.5 shrink-0"}),e.jsx("p",{children:"هذا الرقم السري موحد لجميع العمليات الحساسة في التطبيق."})]}),E&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded-md text-sm flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),E]}),l&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"current-pin",children:"الرقم السري الحالي"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(j,{id:"current-pin",type:x?"text":"password",value:o,onChange:t=>b(t.target.value),onKeyDown:t=>{var s;t.key==="Enter"&&(t.preventDefault(),(s=h.current)==null||s.requestSubmit())},className:"pr-10 pl-10 text-left",dir:"ltr",placeholder:"****"}),e.jsx("button",{type:"button",onClick:()=>C(!x),className:"absolute left-3 top-2.5 text-gray-500 hover:text-gray-700",children:x?e.jsx(y,{className:"h-4 w-4"}):e.jsx(w,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"new-pin",children:"الرقم السري الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(j,{id:"new-pin",type:m?"text":"password",value:i,onChange:t=>v(t.target.value),onKeyDown:t=>{var s;t.key==="Enter"&&(t.preventDefault(),(s=h.current)==null||s.requestSubmit())},className:"pr-10 pl-10 text-left",dir:"ltr",placeholder:"****"}),e.jsx("button",{type:"button",onClick:()=>D(!m),className:"absolute left-3 top-2.5 text-gray-500 hover:text-gray-700",children:m?e.jsx(y,{className:"h-4 w-4"}):e.jsx(w,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"confirm-pin",children:"تأكيد الرقم السري الجديد"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute right-3 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(j,{id:"confirm-pin",type:d?"text":"password",value:P,onChange:t=>S(t.target.value),onKeyDown:t=>{var s;t.key==="Enter"&&(t.preventDefault(),(s=h.current)==null||s.requestSubmit())},className:"pr-10 pl-10 text-left",dir:"ltr",placeholder:"****"}),e.jsx("button",{type:"button",onClick:()=>k(!d),className:"absolute left-3 top-2.5 text-gray-500 hover:text-gray-700",children:d?e.jsx(y,{className:"h-4 w-4"}):e.jsx(w,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(F,{type:"button",variant:"outline",onClick:f,children:"إلغاء"}),e.jsx(F,{type:"submit",disabled:M,className:"bg-blue-600 hover:bg-blue-700 text-white",children:M?"جاري الحفظ...":l?"تغيير الرقم السري":"تعيين الرقم السري"})]})]})]})})}export{V as ChangePinDialog};
//# sourceMappingURL=ChangePinDialog-BhcpfWTE.js.map
